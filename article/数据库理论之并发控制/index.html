<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="数据库理论之并发控制, 代码段小站">
    <meta name="description" content="1 并发控制概述多用户数据库：允许多个用户同时使用的数据库（订票系统）
不同的多事务执行方式：

串行执行：每个时刻只有一个事务运行，其他事务必须等到这个事务结束后方能运行。
交叉并发方式：单处理机系统中，事务的并发执行实际上是这些并行事务">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>数据库理论之并发控制 | 代码段小站</title>
    <link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="/favicon.ico">
    
    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    
    <script src="/libs/jquery/jquery.min.js"></script>
    
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/code.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">代码段小站</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/runcode" class="waves-effect waves-light">
      
      <i class="fas fa-code" style="zoom: 0.6;"></i>
      
      <span>写代码</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/code.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">代码段小站</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/runcode" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-code"></i>
			
			写代码
		</a>
          
        </li>
        
        
    </ul>
</div>

        </div>

        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/20.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">数据库理论之并发控制</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">
                                <span class="chip bg-color">数据库</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/" class="post-category">
                                中间件/工具/框架
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-02-24
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    4.2k
                </div>
                

                
				
                
            </div>
            
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="并发控制概述">1 并发控制概述</h1><p>多用户数据库：允许多个用户同时使用的数据库（订票系统）</p>
<p><strong>不同的多事务执行方式：</strong></p>
<ol>
<li>串行执行：每个时刻只有一个事务运行，其他事务必须等到这个事务结束后方能运行。</li>
<li>交叉并发方式：单处理机系统中，事务的并发执行实际上是这些并行事务的并行操作轮流交叉运行（不是真正的并发，但是提高了系统效率）</li>
<li>同时并发方式：多处理机系统中，每个处理机可以运行一个事务，多个处理机可以同时运行多个事务，实现多个事务真正的并行运行</li>
</ol>
<p><strong>并发执行带来的问题：</strong></p>
<ul>
<li>多个事务同时存取同一数据（共享资源）</li>
<li>存取不正确的数据，破坏事务一致性和数据库一致性</li>
</ul>
<p><strong>并发操作带来的数据不一致性包括</strong></p>
<ol>
<li>丢失修改（lost update）</li>
<li>不可重复读（non-repeatable read）</li>
<li>读脏数据（dirty read）</li>
</ol>
<p><strong>并发控制机制的任务：</strong></p>
<ol>
<li>对并发操作进行正确的调度</li>
<li>保证事务的隔离性</li>
<li>保证数据库的一致性</li>
</ol>
<p><strong>并发控制的主要技术：</strong></p>
<ol>
<li>封锁（locking）（主要使用的）</li>
<li>时间戳（timestamp）</li>
<li>乐观控制法（optimistic scheduler）</li>
<li>多版本并发控制（multi-version concurrency control ，MVCC）</li>
</ol>
<h1 id="封锁">2 封锁</h1><p>封锁：封锁就是事务 T 在对某个数据对象（例如表、记录等）操作之前，先向系统发出请求，对其加锁。加锁后事务 T 就对该数据对象有了一定的控制，在事务 T 释放它的锁之前，其它的事务不能更新此数据对象</p>
<p>确切的控制由封锁的类型决定，基本的封锁类型有两种：排它锁（X 锁，exclusive locks）、共享锁（S 锁，share locks）</p>
<p>排它锁又称写锁，对 A 加了排它锁之后，其他事务不能对 A 加 任何类型的锁（排斥读和写）</p>
<p>共享锁又称读锁，对 A 加了共享锁之后，其他事务只能对 A 加 S 锁，不能加 X 锁（只排斥写）</p>
<h2 id="封锁协议">2.1 封锁协议</h2><p>在运用 X 锁和 S 锁对数据对象加锁时，需要约定一些规则：封锁协议（Locking Protocol）</p>
<ul>
<li>何时申请 X 锁或 S 锁</li>
<li>持锁时间、何时释放</li>
</ul>
<p>对封锁方式制定不同的规则，就形成了各种不同的封锁协议。</p>
<p>常用的封锁协议：三级封锁协议</p>
<p>三级封锁协议在不同程度上解决了并发问题，为并发操作的正确调度提供一定的保证。</p>
<h3 id="一级封锁协议">2.1.1 一级封锁协议</h3><p><strong>事务 T 在修改数据 R 之前，必须先对其加 X 锁，直到事务结束（commit/rollback）才释放。</strong></p>
<p>一级封锁协议可以防止丢失修改。</p>
<p><strong>如果是读数据，不需要加锁，所以它不能保证可重复读和不读“脏”数据。</strong></p>
<p><img src="https://api.codetool.top/img/15825236965916.png" alt></p>
<p><img src="https://api.codetool.top/img/15825294522854.png" alt></p>
<h3 id="二级封锁协议">2.1.2 二级封锁协议</h3><p><strong>在一级封锁协议的基础（写要加 X 锁，事务结束释放）上，增加事务 T 在读入数据 R 之前必须先对其加 S 锁，读完后即可释放 S 锁。（读要加 S 锁，读完即释放）</strong></p>
<p>二级封锁协议除了可以防止丢失修改，还可以防止读脏数据</p>
<p>由于读完数据即释放 S 锁， 不能保证不可重复读</p>
<p><img src="https://api.codetool.top/img/15825297612341.png" alt></p>
<h3 id="三级封锁协议">2.1.3 三级封锁协议</h3><p>注意事务的隔离级别，如果事务的隔离级别是重复读（即MySQL默认的隔离级别，那么二级封锁协议和三级封锁协议没有区别，因为在T1执行的时候T2不能操作）</p>
<p>在一级封锁协议基础上增加事务 T 在读取数据 R 之前必须先对其加 S 锁，<strong>直到事务结束后释放。</strong></p>
<p>三级封锁协议除了可以防止丢失修改和读脏数据外，还防止了不可重复读。</p>
<p><img src="https://api.codetool.top/img/15825301047305.png" alt></p>
<h1 id="饥饿和死锁">3 饥饿和死锁</h1><h2 id="饥饿">3.1 饥饿</h2><p>事务 T1 封锁了数据 R，事务 T2 又请求封锁 R，于是 T2 等待。T3 也请求封锁 R，当<br>T1 释放了 R 上的封锁之后，系统首先批准了 T3 的请求，T2 仍然等待。 T4 又请求封锁 R，<br>当 T3 释放了 R 上的封锁之后系统又批准了 T4 的请求……T2 有可能永远等待，这就是饥饿<br>的情形</p>
<p><img src="https://api.codetool.top/img/15825318081699.png" alt></p>
<p><strong>避免饥饿的方法：先来先服务</strong></p>
<p>当多个事务请求封锁同一数据对象时，按请求封锁的先后次序对这些事务排队。<br>该数据对象上的锁一旦释放，首先批准申请队列中第一个事务获得锁。</p>
<h2 id="死锁">3.2 死锁</h2><p>死锁：事务 T1 封锁了数据 R1，T2 封锁了数据 R2。T1 又请求封锁 R2，因 T2 已封锁了 R2， 于是 T1 等待 T2 释放 R2 上的锁。接着 T2 又申请封锁 R1 ，因 T1 已封锁了 R1 ，T2 也只能等待 T1 释放 R1 上的锁。这样 T1 在等待 T2，而 T2 又在等待 T1 ，T1 和 T2 两个事务永远不能结束，形成死锁。</p>
<p><strong>解决死锁的方法：</strong> 预防、诊断和解除</p>
<h3 id="死锁的预防">3.2.1 死锁的预防</h3><p>产生死锁的原因是两个或多个事务都已经封锁了一些数据对象，然后又都请求对已被其他事务封锁的数据对象加锁，从而出现死等待。</p>
<p><strong>预防死锁发生就是破坏产生死锁的条件</strong></p>
<p><strong>方法</strong></p>
<ol>
<li>一次封锁法：</li>
</ol>
<p>要求每个事务必须一次将所有要使用的数据全部加锁，否则就不能继续执行。</p>
<p><strong>存在的问题：</strong>降低系统的并发度；难以实现精确确定封锁对象</p>
<ol start="2">
<li>顺序封锁法：</li>
</ol>
<p>预先对数据对象规定一个封锁顺序，所有事务都按这个顺序实施封锁。</p>
<p><strong>存在的问题：</strong>   </p>
<ul>
<li>维护成本：数据库系统中的封锁对象极多，并且在不断地变化  </li>
<li>难以实现：很难实现确定每一个事务要封锁哪些对象</li>
</ul>
<p>DBMS普通采用采用的诊断并解除死锁的方法</p>
<h3 id="死锁的诊断和解除">3.2.2 死锁的诊断和解除</h3><p><strong>方法：</strong>超时法和事务等待图法</p>
<p><strong>超时法：</strong>如果一个事务的等待时间超过了规定的时限，就认为发生了死锁。优点是实现简单，缺点是会误判。</p>
<p><strong>事务等待图法：</strong>用事务等待图动态反映所有事务的等待情况。</p>
<p>事务等待图是一个有向图 <code>G=(T,U)</code>，T 为结点的集合，每个结点表示正运行的事务，U为边的集合，每条边表示事务等待的情况。若 T1 等待 T2 ，则 T1 、T2 之间划一条有向边，从 T1 指向 T2。</p>
<p>如果图中形成了环说明发生了死锁。</p>
<p><strong>解除死锁：</strong>并发控制子系统选择一个处理死锁代价最小的事务，将其撤销。释放该事务持有的所有的锁，使其他事务能够继续运行下去。</p>
<h1 id="并发调度的可串行性">4 并发调度的可串行性</h1><h2 id="可串行化调度">4.1 可串行化调度</h2><p><strong>执行结果等价于串行调度的调度就是正确的，这样的调度称为可串行化调度。</strong></p>
<p>可串行性是并发事务正确调度的准则。按这个准则规定，一个给定的并发调度，当且仅当它是可串行化的，才认为是正确调度。</p>
<p><strong>例：</strong>现在有两个事务，分别包含下列操作：</p>
<ul>
<li>事务T1：读B；A=B+1；写回A</li>
<li>事务T2：读A；B=A+1；写回B</li>
</ul>
<p><img src="https://api.codetool.top/img/15825390287716.png" alt="串行调度"></p>
<p><img src="https://api.codetool.top/img/15825395076807.png" alt="可串行化调度"></p>
<h2 id="冲突可串行化调度">4.2 冲突可串行化调度</h2><p><strong>冲突操作：</strong>不同的事务对同一个数据的读写和写写操作。</p>
<p><strong>判断可串行化调度的充分条件:</strong></p>
<p>不同事务的冲突操作和同一事务的两个操作是不能交换的。</p>
<p>我们用R<sub>i</sub>(x)表示事务Ti读x，W<sub>i</sub>(x)表示事务Ti写x。则R<sub>i</sub>(x)和 W<sub>j</sub>(x)不可交换，W<sub>i</sub>(x)和W<sub>j</sub>(x)不可交换</p>
<p><strong>冲突可串行化调度：</strong><br>一个调度 <code>Sc</code> 在保证冲突操作的次序不变的情况下，通过交换两个事务不冲突操作的次序得到另一个调度 <code>Sc’</code> ，如果 <code>Sc’</code> 是串行的，称调度 <code>Sc</code> 为冲突可串行化的调度。</p>
<p><img src="https://api.codetool.top/img/15825408805403.png" alt></p>
<p>若一个调度是冲突可串行化，则一定是可串行化的。冲突可串行化调度是可串行化调度的充分条件而非必要条件，同样存在不满足冲突可串行化调度的可串行化调度。</p>
<h1 id="两段锁协议">5 两段锁协议</h1><p>DBMS 的并发控制机制必须提供一定的手段来保证调度是可串行化的。目前 DBMS 普遍采用两段锁协议（TwoPhase Locking，简称 2PL）的方法来显示并发调度的可串行性。</p>
<p>两段锁协议是指所有<strong>事务必须分两个阶段对数据对象进行加锁和解锁：</strong></p>
<ol>
<li>在对任何数据进行读写操作以前，首先要申请并获得对该数据的锁 。</li>
<li>在释放一个锁之后，事务不再申请和获得其他任何的锁。</li>
</ol>
<p>“两段” 锁的含义：事务分为两个阶段:</p>
<p><strong>第一阶段是获得封锁，也称为扩展阶段</strong><br>事务可以申请获得任何数据对象上的任何类型的锁，但是不能释放任何锁 </p>
<p><strong>第二阶段是释放封锁，也称为收缩阶段</strong><br>事务可以释放任何数据对象上的任何类型的锁，但是不能再申请任何锁</p>
<p><img src="https://api.codetool.top/img/15825411925304.png" alt></p>
<p><strong>事务遵守两段锁协议是可串行化调度的充分条件，而不是必要条件。</strong><br>若并发事务都遵守两段锁协议，则对这些事务的任何并发调度策略都是可串行化的<br>若并发事务的一个调度是可串行化的，不一定所有事务都符合两段锁协议  </p>
<p><strong>两段锁协议与防止死锁的一次封锁法:</strong></p>
<p>一次封锁法要求每个事务必须一次将所有要使用的数据全部加锁，否则就不能继续执行，因此一次封锁法遵守两段锁协议</p>
<p>但是两段锁协议并不要求事务必须一次将所有要使用的数据全部加锁，因此遵守两段锁协议的事务可能发生死锁</p>
<h1 id="封锁的粒度">6 封锁的粒度</h1><p><strong>封锁对象的大小称为封锁粒度（granularity）。</strong></p>
<p>封锁的对象可以是逻辑单元（属性值、属性值集合、元组、关系、索引项、数据库），也可以是物理单元（页、物理记录）</p>
<p><strong>选择封锁粒度原则：</strong></p>
<p>封锁粒度和系统的并发度和并发控制的开销密切相关</p>
<ul>
<li>封锁的粒度越大，数据库所能够封锁的数据单元就越少，并发度就越低，系统开销也越小；</li>
<li>封锁的粒度越小，并发度较高，但系统开销也就越大。</li>
</ul>
<p><img src="https://api.codetool.top/img/15825478053271.png" alt></p>
<h2 id="多粒度封锁">6.1 多粒度封锁</h2><p>如果在一个系统中同时支持多种封锁粒度供不同的事务选择，这种封锁方法称为多粒度封锁。（multiple granularity locking）</p>
<p>选择封锁粒度应该同时考虑封锁开销和并发度两个因素，适当选择封锁粒度以求得最优的效果。</p>
<ul>
<li>需要处理多个关系的大量元组的用户事务：以数据库为封锁单位</li>
<li>需要处理大量元组的用户事务：以关系为封锁单元</li>
<li>只处理少量元组的用户事务：以元组为封锁单位</li>
</ul>
<p><strong>多粒度树：</strong></p>
<p>以树形结构来表示多级封锁粒度。根结点是整个数据库，表示最大的数据粒度，叶结点表示最小的数据粒度</p>
<p><img src="https://api.codetool.top/img/15825479887217.png" alt></p>
<p><strong>多粒度封锁协议：</strong>允许多粒度树中的每个节点被独立地加锁，对一个节点加锁意味着这个节点的所有子节点也被加以同样类型的锁。因此，在多粒度封锁中一个数据对象可能以显式封锁和隐式封锁两种方式封锁。</p>
<ul>
<li>显式封锁：直接加到数据对象上的封锁</li>
<li>隐式封锁：该数据对象没有独立加锁，是由于其上级结点加锁而使该数据对象加上了锁</li>
<li>显式封锁和隐式封锁的效果是一样的</li>
</ul>
<p><strong>系统检查封锁冲突时要检查显式封锁，还要检查隐式封锁</strong></p>
<p>例如事务 T 要对关系 R1 加 X 锁，系统必须搜索其上级结点数据库、关系 R1，还要搜索 R1 的下级结点，即 R1 中的每一个元组 。 如果其中某一个数据对象已经加了不相容锁，则 T 必须等待。</p>
<p>对某个数据对象加锁，<strong>系统要检查该数据对象上有无显式封锁与之冲突；再检查其所有上级节点</strong>，看本事务的显式封锁是否与该数据对象上的隐式封锁 （由于上级节点已加的封锁造成的）冲突 ；<strong>还要检查其所有下级节点</strong>，看它们的显式封锁是否与本事务的隐式封锁（将加到下级节点的封锁）冲突 。</p>
<p>这种检查方法效率较低，引入一种新的锁：<strong>意向锁</strong>。有了 意向锁，DBMS 就无须逐个检查下一级节点的显式封锁。</p>
<h2 id="意向锁">6.2 意向锁</h2><p>意向锁：<strong>如果对一个节点加意向锁，则可说明该节点的下层节点正在被加锁；对任一节点加锁时，必须先对它的上层节点加意向锁。</strong></p>
<p>例如，<strong>对任一元组加锁时，必须先对它所在的数据库和关系加意向锁。</strong></p>
<p>三种常用的意向锁：<strong>意向共享锁（Intent Share Lock，IS 锁）；意向排它锁（Intent Exclusive Lock，IX 锁）；共享意向排它锁（Share Intent Exclusive Lock ，SIX 锁）。</strong></p>
<h3 id="IS-锁">6.2.1 IS 锁</h3><p><strong>如果对一个数据对象加 IS 锁，表示它加的子节点拟加 S 锁。</strong></p>
<p><strong>例如：</strong>事务 T1 要对 R1 中某个元组加 S 锁，则要首先对关系 R1 和数据库加 IS 锁。</p>
<h3 id="IX-锁">6.2.2 IX 锁</h3><p><strong>如果对一个数据对象加 IX 锁，表示它的子节点拟加 X 锁。</strong></p>
<p><strong>例如：</strong>事务 T1 要对 R1 中某个元组加 X 锁，则要首先对关系 R1 和数据库加 IX 锁。</p>
<h3 id="SIX-锁">6.2.3 SIX 锁</h3><p><strong>如果对一个数据对象加 SIX 锁，表示对它加 S 锁，再加 IX 锁，即 SIX = S + IX。</strong></p>
<p><strong>例如：</strong>对某个表加 SIX 锁，则表示该事务要读整个表（所以要对该表加 S 锁），同时会更新个别元组（所以要对该表加 IX 锁）。</p>
<p><strong>意向锁的强度：</strong>锁的强度是指它对其他锁的排斥程度。一个事务在申请封锁时以强锁代替弱锁是安全的，反之则不然。</p>
<p>具有意向锁的多粒度封锁方法：</p>
<ul>
<li>申请封锁时应该按自上而下的次序进行</li>
<li>释放封锁时则应该按自下而上的次序进行</li>
</ul>
<p>优点：</p>
<ol>
<li>提高了系统并发度。</li>
<li>减少了加锁和解锁的开销。</li>
</ol>
<h1 id="其他并发控制机制">7 其他并发控制机制</h1><p>并发控制的方法除了封锁技术外，还有<strong>时间戳方法、乐观控制法和多版本并发控制。</strong></p>
<ul>
<li>时间戳方法：给每一个事务盖上一个时标，即事务开始的时间。每个事务具有唯一的时间戳，并按照这个时间戳来解决事务的冲突操作。如果发生冲突操作，就回滚到具有较早时间戳的事务，以保证其他事务的正常执行，被回滚的事务被赋予新的时间戳被从头开始执行。</li>
<li>乐观控制法：乐观控制法认为事务执行时很少发生冲突，所以不对事务进行特殊的管制，而是让 它自由执行，事务提交前再进行正确性检查。如果检查后 发现该事务执行中出现过冲突并影响了可串行性，则拒绝提交并回滚该事务。又称为验证方法。</li>
<li>多版本控制： 指在数据库中通过维护数据对象的多个版本信息来实现高效并发的一种策略。</li>
</ul>

            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://www.codetool.top" rel="external nofollow noreferrer">Rhett Peng</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。部分转载即网络资源均已注明来源，若有版权问题请联系站长。转载请注明来源
                    <a href="https://www.codetool.top" target="_blank">Rhett Peng</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">
                                    <span class="chip bg-color">数据库</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'VUmN3m0ICuwaL4jNPnxBRln8-gzGzoHsz',
        appKey: 'QH8FVT32jvi4qBllLg6Cf0dU',
        notify: 'false' === 'true',
        verify: 'true' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '说点什么吧'
    });
</script>

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/article/Spring%E4%B9%8B%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AEIoC/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/19.jpg" class="responsive-img" alt="Spring之注解配置IoC">
                        
                        <span class="card-title">Spring之注解配置IoC</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            1 注解配置1.1 定义配置
@Configuration：指定当前类是一个配置类
@ComponentScan：用于通过注解指定Spring在创建容器时要扫描的包@ComponentScan(basePackages=&quot;&quo
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-02-24
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/" class="post-category">
                                    中间件/工具/框架
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Spring/">
                        <span class="chip bg-color">Spring</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/article/leetcode64-%E6%9C%80%E5%B0%8F%E8%B7%AF%E5%BE%84%E5%92%8C/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/22.jpg" class="responsive-img" alt="leetcode64-最小路径和">
                        
                        <span class="card-title">leetcode64-最小路径和</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            1 原题给定一个包含非负整数的 m x n 网格，请找出一条从左上角到右下角的路径，使得路径上的数字总和为最小。
说明： 每次只能向下或者向右移动一步。
示例:

输入：[  [1,3,1],  [1,5,1],  [4,2,1]]输出： 
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-02-24
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="post-category">
                                    算法/数据结构
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/leetcode/">
                        <span class="chip bg-color">leetcode</span>
                    </a>
                    
                    <a href="/tags/%E7%AE%97%E6%B3%95/">
                        <span class="chip bg-color">算法</span>
                    </a>
                    
                    <a href="/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/">
                        <span class="chip bg-color">动态规划</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

    
<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>

    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2019-2020</span>
            <a href="https://www.codetool.top" target="_blank">Rhett Peng</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">311.2k</span>&nbsp;字
            
            
            
            
            
            <br>
            
            <br>
            
            <span id="icp"><img src="/medias/icp.png" style="vertical-align: text-bottom;" />
                <a href="http://beian.miit.gov.cn/" target="_blank">赣ICP备19011928号</a>
            </span>
            
        </div>
        <div class="col s12 m4 l4 social-link ">
    <a href="https://github.com/codeband-top" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:pctdyx@qq.net" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=995632825" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 995632825" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    

    

    

    

    

    
    
    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":200,"height":200,"hOffset":20,"vOffset":100},"mobile":{"show":false},"dialog":{"enable":true,"hitokoto":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
<div id="chat_input"><input id="question" type="text" placeholder="陪我聊聊天吧" onkeypress="return onKeyPress(event)"/></div>
</html>

<!--动态线条背景-->
<script type="text/javascript"
color="0,0,0" opacity='0.5' zIndex="-2" count="150" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>

<script>

//聊天框按回车
function onKeyPress(e){
    var keyCode = null;
    if(e.which)
        keyCode = e.which;
    else if(e.keyCode)
        keyCode = e.keyCode;
        
    //如果按下回车
    if(keyCode == 13) {
        // 1.获取界面上的元素value
        var question_box = document.getElementById('question')
        var question = question_box.value
        question_box.value = ""
        question_box.setAttribute("disabled","disabled")
        var api_key = "78c33a07808c7b9e1905c89c88b3be14"
        var api_secret = "q707tevnk00f"

        // 2.通过XHR发送一个POST请求
        var xhr = new XMLHttpRequest()
        xhr.open('GET','https://api.codetool.top/robottalk?question='+encodeURIComponent(question)+"&api_key="+api_key+"&api_secret="+api_secret)
		xhr.send(null)
		xhr.onload = function(){
            question_box.removeAttribute('disabled');
            var live2d_dialog = document.getElementsByClassName("live2d-widget-dialog")[0]
            live2d_dialog.style.opacity=1
            live2d_dialog.innerHTML = this.responseText
            window.setTimeout(()=>{
                live2d_dialog.style.opacity=0
            }, 5000);
		}
    }

}

</script>

<style> 
#chat_input{
    width: 200px;
    height: 40px;
    position: fixed;
    right: 0px;
    bottom: 80px;
    right: 20px;
} 

#question{
    border: none;
    border-bottom: 1px #aaaaaa solid;
    background-color: transparent;
    padding: 5px;
}

@media screen and (max-width: 480px) {
    #chat_input{
        display: none;
    }
    #live2d-widget{
        display: none;
    }
}
</style>