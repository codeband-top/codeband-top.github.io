{"meta":{"title":"ä»£ç æ®µå°ç«™","subtitle":"CodeTool - ä¸ªäººè®¡ç®—æœºç±»ç»ƒæ‰‹å°åšå®¢","description":"","author":"Rhett Peng","url":"https://www.codetool.top","root":"/"},"pages":[{"title":"åˆ†ç±»","date":"2018-09-30T09:25:30.000Z","updated":"2020-01-10T10:46:37.167Z","comments":true,"path":"categories/index.html","permalink":"https://www.codetool.top/categories/index.html","excerpt":"","text":""},{"title":"åœ¨çº¿å†™ä»£ç ","date":"2019-11-08T14:16:45.000Z","updated":"2020-01-10T11:34:38.770Z","comments":true,"path":"runcode/index.html","permalink":"https://www.codetool.top/runcode/index.html","excerpt":"","text":""},{"title":"å…³äº","date":"2018-09-30T09:25:30.000Z","updated":"2020-01-10T10:07:22.666Z","comments":true,"path":"about/index.html","permalink":"https://www.codetool.top/about/index.html","excerpt":"","text":"@column-2{ } @column-2{ @card{ 1 ç¥ç§˜çš„ç«™é•¿ç°å—æ˜Œå¤§å­¦è½¯ä»¶å­¦é™¢å¤§ä¸‰å­¦ç”Ÿï¼Œå­¦ä¹ ä½œé£å·®ï¼Œä¸åŠ¡æ­£ä¸š.å–œæ¬¢æŠ˜è…¾æ–°å¥‡çš„ä¸œè¥¿ï¼Œå­¦ä¹ é»‘ç§‘æŠ€æ­£åœ¨ç”±ä¸€åªå°èœé¸¡æˆä¸ºä¸€åªå¤§èœé¸¡çš„è½¬å˜çš„è·¯ä¸Šï¼ˆå…¶å®æˆ‘ä¹Ÿä¸çŸ¥é“å°èœé¸¡ä¸ºå•¥è¦å†™åšå®¢ï¼Œåæ­£ä¹Ÿæ²¡äººçœ‹ï¼‰ } @card{ 2 å…³äºå°ç«™ä»£ç æ®µå°ç«™ï¼ˆCodeBandï¼‰åˆ›å»ºäº2018å¹´8æœˆ19æ—¥ï¼Œé—²æ—¶åœ¨è¿™é‡Œéšä¾¿å†™ç‚¹ä¸œè¥¿ã€‚å¯èƒ½æ˜¯è„‘æµ·é‡Œçš„ä¸€äº›é—ªå…‰ç‚¹ï¼Œä¹Ÿå¯èƒ½æ˜¯æŸä¸€å¤©çš„å­¦ä¹ å†…å®¹çš„è®°å½•ï¼Œæ›´å¤šçš„æ˜¯æœ‰å…³ç¼–ç¨‹æ–¹é¢çš„ã€æˆ‘è§‰å¾—æœ‰æ„ä¹‰è®°ä¸‹æ¥çš„ä¸€äº›çŸ¥è¯†ã€‚ä¹Ÿå¸Œæœ›è¿™ä¸ªç½‘ç«™èƒ½ä¼´éšæˆ‘ä»ç¼–ç¨‹æ–°æ‰‹å°ç™½æˆé•¿ä¸ºä¸€ä¸ªä¸ç®—å¤ªå°ç™½çš„å°ç™½? } } @timeline{ 2.0.0.0.1 2019@item{ 2.0.0.0.1.1 12æœˆ19æ—¥å†™åšå®¢å†å²ä¸Šæœ€é»‘æš—çš„ä¸€å¤© } @item{ 2.0.0.0.1.2 12æœˆ10æ—¥åœ¨å³ä¸‹è§’æ”¾äº†åªç‹—ï¼ŒèƒŒæ™¯åŠ äº†ç‚¹åŠ¨ç”»æ•ˆæœ } @item{ 2.0.0.0.1.3 11æœˆ8æ—¥æŠ›å¼ƒwordpressï¼Œä½¿ç”¨hexoé‡æ–°æ­å»ºåšå®¢ï¼Œå®Œå…¨æ¬è‡³å›½å†…æœåŠ¡å™¨ } @item{ 2.0.0.0.1.4 9æœˆ6æ—¥æ–°æœåŠ¡å™¨åŸŸåé€šè¿‡å¤‡æ¡ˆï¼Œä½¿ç”¨å›½å†…æœåŠ¡å™¨åå‘ä»£ç† } @item{ 2.0.0.0.1.5 8æœˆ19æ—¥æ›´æ¢wordpressä¸»é¢˜ } 2.0.0.0.2 2018@item{ 2.0.0.0.2.1 8æœˆ19æ—¥ä½¿ç”¨wordpressæ­å»ºäº†ç¬¬ä¸€ç‰ˆåšå®¢å†™ä¸‹äº†æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢ã€ŠJavaæŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«ã€‹ } }"},{"title":"contact","date":"2018-09-30T09:25:30.000Z","updated":"2020-01-10T10:07:52.273Z","comments":true,"path":"contact/index.html","permalink":"https://www.codetool.top/contact/index.html","excerpt":"","text":""},{"title":"tags","date":"2018-09-30T10:23:38.000Z","updated":"2020-01-10T10:07:22.666Z","comments":true,"path":"tags/index.html","permalink":"https://www.codetool.top/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"leetcode39-ç»„åˆæ€»å’Œ","slug":"leetcode39-ç»„åˆæ€»å’Œ","date":"2020-05-01T05:20:51.000Z","updated":"2020-05-01T06:01:44.821Z","comments":true,"path":"article/leetcode39-ç»„åˆæ€»å’Œ/","link":"","permalink":"https://www.codetool.top/article/leetcode39-%E7%BB%84%E5%90%88%E6%80%BB%E5%92%8C/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ— é‡å¤å…ƒç´ çš„æ•°ç»„ candidates å’Œä¸€ä¸ªç›®æ ‡æ•° target ï¼Œæ‰¾å‡º candidates ä¸­æ‰€æœ‰å¯ä»¥ä½¿æ•°å­—å’Œä¸º target çš„ç»„åˆã€‚ candidates ä¸­çš„æ•°å­—å¯ä»¥æ— é™åˆ¶é‡å¤è¢«é€‰å–ã€‚ è¯´æ˜ï¼š æ‰€æœ‰æ•°å­—ï¼ˆåŒ…æ‹¬ targetï¼‰éƒ½æ˜¯æ­£æ•´æ•°ã€‚ è§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„ç»„åˆã€‚ ç¤ºä¾‹ 1: è¾“å…¥: candidates = [2,3,6,7], target = 7, æ‰€æ±‚è§£é›†ä¸º: [ [7], [2,2,3] ] ç¤ºä¾‹ 2: è¾“å…¥: candidates = [2,3,5], target = 8, æ‰€æ±‚è§£é›†ä¸º: [ &nbsp; [2,2,2,2], &nbsp; [2,3,3], &nbsp; [3,5] ] 2 è§£æ³•æœ¬é¢˜è§£åŒæ­¥å‘äºleetcodeé¢˜è§£ï¼šJava DFSï¼Œè®©ä½ çŸ¥é“ç»„åˆæ€ä¹ˆå»é‡&amp;å‰ªæ&amp;å›æº¯åˆ°åº•æ˜¯ä»€ä¹ˆ 2.1 æ€æƒ³è¯¥é¢˜éš¾ç‚¹åœ¨äºç»„åˆçš„å»é‡ï¼Œå¦‚æœç›´æ¥ä¸åŠ æ¡ä»¶çš„dfså¾ˆå®¹æ˜“æ‰¾åˆ°ç›¸åŒçš„ç»„åˆï¼Œä¾‹å¦‚ç¤ºä¾‹ä¸€å¯ä»¥æ‰¾å‡º[2,2,3]å’Œ[2,3,2]ã€[3,2,2]ï¼Œå®ƒä»¬å®è´¨ä¸Šæ˜¯åŒä¸€ä¸ªç»„åˆã€‚å¦‚æœè¦è¿›è¡Œå»é‡ï¼Œå¯ä»¥è€ƒè™‘ç»™ç»„åˆæ·»åŠ ä¸€ä¸ªé™åˆ¶æ¡ä»¶ï¼Œä¾‹å¦‚æˆ‘ä»¬è¦æ±‚ï¼Œæ‰¾åˆ°çš„ç»„åˆä¸­å‰é¢çš„æ•°å¿…é¡»å¤§äºç­‰äºåé¢çš„æ•°ã€‚ é‚£ä¹ˆä¸ºäº†åªæ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ç»„åˆï¼Œå¯ä»¥å…ˆå°†candidatesæ•°ç»„ä»å°åˆ°å¤§æ’åºï¼Œæ¯æ¬¡dfsé€‰å–ä¸€ä¸ªå…ƒç´ ä¹‹åï¼Œæˆ‘ä»¬å°±ä¸å†é€‰å–æ¯”å®ƒå¤§çš„å…ƒç´ ï¼ˆå³åé¢åªåœ¨ä¸‹æ ‡å°äºç­‰äºå®ƒçš„å…ƒç´ ä¸­æŸ¥æ‰¾ï¼‰ã€‚è¿™æ ·å°±å¯ä»¥åšåˆ°æŸ¥æ‰¾åˆ°çš„ç»„åˆæ»¡è¶³å‰é¢çš„æ•°æ€»æ˜¯å¤§äºç­‰äºåé¢çš„æ•°ã€‚ è¿™æ ·çš„dfsæŸ¥æ‰¾ï¼Œå¦‚æœç”»å‡ºæ ‘çŠ¶å›¾çš„è¯ï¼Œä¼šçœ‹åˆ°è¿™ä¸ªæœç´¢æ ‘å› ä¸ºæŸäº›éƒ¨åˆ†æ¡ä»¶ä¸æ»¡è¶³ï¼Œäºæ˜¯ä¸å†å‘ä¸‹æŸ¥æ‰¾ï¼Œç§°ä¸ºâ€œå‰ªæâ€ã€‚ é‚£ä¹ˆå…¶ä»–é¢˜è§£è¯´çš„â€œå›æº¯ç®—æ³•â€æ˜¯ä»€ä¹ˆå‘¢ï¼Œå…¶å®ç”¨é€’å½’å®ç°çš„DFSå°±å¿…ç„¶ä¼šç»è¿‡å›æº¯ï¼Œå½“æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œé€’å½’å‡½æ•°éœ€è¦è¿”å›åˆ°ä¸Šä¸€å±‚èŠ‚ç‚¹ï¼Œç»§ç»­æŸ¥æ‰¾ï¼Œç§°ä¸ºâ€œå›æº¯â€ã€‚ 2.2 ä»£ç class Solution { List&lt;List&lt;Integer>> ans; int[] candidates; public List&lt;List&lt;Integer>> combinationSum(int[] candidates, int target) { ans = new ArrayList&lt;>(); //å…ˆå¯¹candidatesä»å°åˆ°å¤§æ’åº Arrays.sort(candidates); this.candidates = candidates; List&lt;Integer> list = new ArrayList&lt;>(); dfs(list,target,candidates.length-1); return ans; } //maxIndexè¡¨ç¤ºå…è®¸åœ¨candidatesæœç´¢åˆ°çš„æœ€å¤§ä¸‹æ ‡ public void dfs(List&lt;Integer> list,int target,int maxIndex){ for(int i = 0;i&lt;=maxIndex;i++){ if(candidates[i]&lt;=target){ List&lt;Integer> copyList = new ArrayList&lt;>(list); copyList.add(candidates[i]); if(candidates[i]==target) { ans.add(copyList); return; } //å½“é€‰å–ä¸‹æ ‡ä¸ºiçš„èŠ‚ç‚¹åï¼Œä¸‹ä¸€æ­¥åªå…è®¸åœ¨ä¸‹æ ‡å°äºç­‰äºiçš„å…ƒç´ ä¸­æŸ¥æ‰¾ dfs(copyList,target-candidates[i],i); } } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ“ä½œç³»ç»Ÿå¤ä¹ 06-æ–‡ä»¶ç®¡ç†","slug":"æ“ä½œç³»ç»Ÿå¤ä¹ 06-æ–‡ä»¶ç®¡ç†","date":"2020-04-30T16:57:34.000Z","updated":"2020-04-30T16:57:34.021Z","comments":true,"path":"article/æ“ä½œç³»ç»Ÿå¤ä¹ 06-æ–‡ä»¶ç®¡ç†/","link":"","permalink":"https://www.codetool.top/article/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A006-%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86/","excerpt":"","text":"","categories":[],"tags":[]},{"title":"Handler dispatch failed; nested exception is java.lang.NoSuchMethodError","slug":"å°å¿ƒæ›´æ–°åˆ°Idea-2020-01ã€‚ã€‚ã€‚","date":"2020-04-30T13:53:43.000Z","updated":"2020-04-30T14:17:04.845Z","comments":true,"path":"article/å°å¿ƒæ›´æ–°åˆ°Idea-2020-01ã€‚ã€‚ã€‚/","link":"","permalink":"https://www.codetool.top/article/%E5%B0%8F%E5%BF%83%E6%9B%B4%E6%96%B0%E5%88%B0Idea-2020-01%E3%80%82%E3%80%82%E3%80%82/","excerpt":"","text":"ã€åŸæ–‡ã€‘ ideaå‰æ®µæ—¶é—´ä¸æ˜¯å‡ºäº†2020.01å˜›ã€‚ã€‚æˆ‘å¾ˆå¿«å°±è£…äº† è¿™æ®µæ—¶é—´ä¸€ç›´ç”¨ç€lombokï¼Œä»Šå¤©è¿è¡Œé¡¹ç›®lombokæ³¨è§£éƒ½å¤±æ•ˆäº† ï¼ˆäº‹å®è¯æ˜ä¸æ˜¯lombokå¤±æ•ˆäº†ï¼‰ ï¼Œæ£€æŸ¥äº†ä¸€ä¸‹æ³¨è§£ä¹Ÿåœ¨ï¼Œä¾èµ–ä¹Ÿåœ¨ï¼Œæ’ä»¶ä¹Ÿåœ¨ï¼Œé…ç½®ä¹Ÿé…ç½®äº†ï¼Œå¯å°±æ˜¯æ²¡æœ‰ç”¨ã€‚ ä¸çŸ¥é“æ˜¯ä¸ºä»€ä¹ˆï¼Œåæ­£æˆ‘å°±æ˜¯å½’ä¸ºIdeaæ–°ç‰ˆbugçš„åŸå› ã€‚ã€‚ æˆ‘ç°åœ¨å°±ä¸€ä¸ªä¸€ä¸ªçš„ç»™é‚£äº›å®ä½“ç±»åŠ getter/setterï¼Œå¤ªæµªè´¹æ—¶é—´äº†/(ã„’oã„’)/~~ äº‹åï¼šå¯èƒ½å¹¶ä¸æ˜¯lombokæ³¨è§£å¤±æ•ˆï¼Œæˆ‘é”™æ€ªIDEAäº† æˆ‘ä¸€å¼€å§‹è¿è¡Œé¡¹ç›®ç”¨åˆ°æŸä¸€ä¸ªæ–¹æ³•æŠ¥é”™ï¼š Handler dispatch failed; nested exception is java.lang.NoSuchMethodErrorç„¶ååé¢æ˜¯ä»€ä¹ˆgetã€setæ–¹æ³•æ²¡æ‰¾åˆ°ï¼Œæˆ‘è¿˜ä»¥ä¸ºæ˜¯@Dataå¤±æ•ˆäº†ï¼Œåé¢æˆ‘æŠŠæ‰€æœ‰çš„å®ä½“ç±»åŠ äº†ä¸€égetter/setterå‘ç°è¿˜æ˜¯ä¸è¡ŒğŸ˜€ æœ€åç™¾åº¦äº†ä¸€ä¸‹å‘ç°æ˜¯å› ä¸ºmavené¡¹ç›®é‡å¤ä¾èµ–ï¼š é€ æˆè¿™ä¸ªé”™è¯¯çš„åŸå› å¯èƒ½ä¸º: A-moduleçš„pomä¾èµ–äº†B-moduleå’ŒC-module, ç„¶è€ŒB-moduleçš„pomä¹Ÿä¾èµ–äº†C-moduleå¯¼è‡´","categories":[{"name":"æ—¥å¸¸/éšç¬”","slug":"æ—¥å¸¸-éšç¬”","permalink":"https://www.codetool.top/categories/%E6%97%A5%E5%B8%B8-%E9%9A%8F%E7%AC%94/"}],"tags":[{"name":"æ—¥å¸¸","slug":"æ—¥å¸¸","permalink":"https://www.codetool.top/tags/%E6%97%A5%E5%B8%B8/"}]},{"title":"leetcode38-å¤–è§‚æ•°åˆ—","slug":"leetcode38-å¤–è§‚æ•°åˆ—","date":"2020-04-30T05:45:04.000Z","updated":"2020-04-30T05:50:42.945Z","comments":true,"path":"article/leetcode38-å¤–è§‚æ•°åˆ—/","link":"","permalink":"https://www.codetool.top/article/leetcode38-%E5%A4%96%E8%A7%82%E6%95%B0%E5%88%97/","excerpt":"","text":"1 åŸé¢˜ã€Œå¤–è§‚æ•°åˆ—ã€æ˜¯ä¸€ä¸ªæ•´æ•°åºåˆ—ï¼Œä»æ•°å­— 1 å¼€å§‹ï¼Œåºåˆ—ä¸­çš„æ¯ä¸€é¡¹éƒ½æ˜¯å¯¹å‰ä¸€é¡¹çš„æè¿°ã€‚å‰äº”é¡¹å¦‚ä¸‹ï¼š 1. 1 2. 11 3. 21 4. 1211 5. 111221 1 è¢«è¯»ä½œ &quot;one 1&quot; (&quot;ä¸€ä¸ªä¸€&quot;) , å³ 11ã€‚11 è¢«è¯»ä½œ &quot;two 1s&quot; (&quot;ä¸¤ä¸ªä¸€&quot;ï¼‰, å³ 21ã€‚21 è¢«è¯»ä½œ &quot;one 2&quot;, &quot;one 1&quot; ï¼ˆ&quot;ä¸€ä¸ªäºŒ&quot; , &quot;ä¸€ä¸ªä¸€&quot;) , å³ 1211ã€‚ ç»™å®šä¸€ä¸ªæ­£æ•´æ•° nï¼ˆ1 â‰¤ n â‰¤ 30ï¼‰ï¼Œè¾“å‡ºå¤–è§‚æ•°åˆ—çš„ç¬¬ n é¡¹ã€‚ æ³¨æ„ï¼šæ•´æ•°åºåˆ—ä¸­çš„æ¯ä¸€é¡¹å°†è¡¨ç¤ºä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: 1è¾“å‡º: â€œ1â€è§£é‡Šï¼š è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬æ ·ä¾‹ã€‚ ç¤ºä¾‹ 2: è¾“å…¥: 4è¾“å‡º: â€œ1211â€è§£é‡Šï¼š å½“ n = 3 æ—¶ï¼Œåºåˆ—æ˜¯ â€œ21â€ï¼Œå…¶ä¸­æˆ‘ä»¬æœ‰ â€œ2â€ å’Œ â€œ1â€ ä¸¤ç»„ï¼Œâ€2â€ å¯ä»¥è¯»ä½œ â€œ12â€ï¼Œä¹Ÿå°±æ˜¯å‡ºç°é¢‘æ¬¡ = 1 è€Œ å€¼ = 2ï¼›ç±»ä¼¼ â€œ1â€ å¯ä»¥è¯»ä½œ â€œ11â€ã€‚æ‰€ä»¥ç­”æ¡ˆæ˜¯ â€œ12â€ å’Œ â€œ11â€ ç»„åˆåœ¨ä¸€èµ·ï¼Œä¹Ÿå°±æ˜¯ â€œ1211â€ã€‚ 2 è§£æ³•2.1 æ€æƒ³åŠ¨æ€è§„åˆ’ï¼Œæ¯”è¾ƒç®€å•ã€‚ 2.2 ä»£ç class Solution { public String countAndSay(int n) { String[] strings = new String[n]; strings[0] = \"1\"; for(int i = 1;i&lt;n;i++){ char[] chars = strings[i-1].toCharArray(); StringBuilder sb = new StringBuilder(); int count = 0; for(int j = 0;j&lt;chars.length;j++){ count++; if(j==chars.length-1||chars[j+1]!=chars[j]){ sb.append(count); sb.append(chars[j]); count = 0; } } strings[i] = sb.toString(); } return strings[n-1]; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"OpenFeignä½¿ç”¨HystrixæŠ¥é”™ï¼šAmbiguous mapping. Cannot map xx method...","slug":"OpenFeignæŠ¥é”™ï¼šAmbiguous-mapping-Cannot-map-xx-method","date":"2020-04-29T14:06:31.000Z","updated":"2020-04-29T14:17:32.617Z","comments":true,"path":"article/OpenFeignæŠ¥é”™ï¼šAmbiguous-mapping-Cannot-map-xx-method/","link":"","permalink":"https://www.codetool.top/article/OpenFeign%E6%8A%A5%E9%94%99%EF%BC%9AAmbiguous-mapping-Cannot-map-xx-method/","excerpt":"","text":"ä»Šå¤©åšé¡¹ç›®çš„æ—¶å€™ï¼Œfeignè°ƒç”¨çš„æ—¶å€™å†™äº†ä¸€ä¸ªHystrixçš„æœåŠ¡é™çº§å¤„ç†ç±»ï¼Œä½†æ˜¯è¿è¡Œæ—¶æŠ¥äº†ä»¥ä¸‹é”™è¯¯ï¼š Ambiguous mapping. Cannot map &#39;com.guli.vod.feign.VodFeign&#39; method com.guli.vod.feign.VodFeign#removeVideo(String) to {DELETE /vod/video/{id}}: There is already &#39;vodFallback&#39; bean method com.guli.vod.fallback.VodFallback#removeVideo(String) mapped.åŸæ¥å†™çš„FeignClientï¼š(è¿™é‡Œåæ§½ä¸€ä¸‹ï¼ŒRestful apiæ ¹æœ¬æ²¡åŠæ³•è®¾è®¡æ‰¹é‡åˆ é™¤çš„è·¯å¾„å˜›ï¼ŒDELETEæ–¹æ³•åˆä¸æ¨èä½¿ç”¨è¯·æ±‚ä½“ï¼Œè€Œä¸”å°†èµ„æºidæ”¾åœ¨è¯·æ±‚ä½“é‡Œä¹Ÿä¸ç¬¦åˆRestful urlçš„è¯­ä¹‰) @Component @FeignClient(value = \"service-vod\",fallback = VodFallback.class) @RequestMapping(\"/vod\") public interface VodFeign { @DeleteMapping(value = \"/video/{id}\") public Result removeVideo(@PathVariable(\"id\") String videoId); @DeleteMapping(value = \"/video/delete-batch\") public Result removeVideoList(@RequestParam(\"videoIdList\") List&lt;String> videoIdList); } æœåŠ¡é™çº§å¤„ç†ç±»ï¼š @Component public class VodFallback implements VodFeign { @Override public Result removeVideo(String videoId) { return Result.error().msg(\"time out\"); } @Override public Result removeVideoList(List&lt;String> videoIdList) { return Result.error().msg(\"time out\"); } } åŸå› åœ¨äºVodFallbackå®ç°äº†VodFeignæ¥å£åï¼ŒæŠŠ@RequestMappingçš„è·¯å¾„æ˜ å°„ä¹Ÿç»§æ‰¿äº†è¿‡å»ï¼Œè€Œä¸¤ä¸ªç±»éƒ½ä¼šæ³¨å†Œbeanå®ä¾‹å¯¹è±¡ï¼Œå°±ä¼šå‡ºç°æ˜ å°„å†²çªçš„é—®é¢˜ï¼Œæœ€åæˆ‘æ˜¯å°†FeignClientçš„@RequestMappingéƒ½å†™åœ¨äº†æ–¹æ³•ä¸Šï¼ŒæˆåŠŸè§£å†³ï¼š @Component @FeignClient(value = \"service-vod\",fallback = VodFallback.class) public interface VodFeign { @DeleteMapping(value = \"/vod/video/{id}\") public Result removeVideo(@PathVariable(\"id\") String videoId); @DeleteMapping(value = \"/vod/video/delete-batch\") public Result removeVideoList(@RequestParam(\"videoIdList\") List&lt;String> videoIdList); }","categories":[{"name":"æ—¥å¸¸/éšç¬”","slug":"æ—¥å¸¸-éšç¬”","permalink":"https://www.codetool.top/categories/%E6%97%A5%E5%B8%B8-%E9%9A%8F%E7%AC%94/"}],"tags":[{"name":"æ—¥å¸¸","slug":"æ—¥å¸¸","permalink":"https://www.codetool.top/tags/%E6%97%A5%E5%B8%B8/"},{"name":"OpenFeign","slug":"OpenFeign","permalink":"https://www.codetool.top/tags/OpenFeign/"},{"name":"Hystrix","slug":"Hystrix","permalink":"https://www.codetool.top/tags/Hystrix/"}]},{"title":"leetcode74-æœç´¢äºŒç»´çŸ©é˜µ","slug":"leetcode74-æœç´¢äºŒç»´çŸ©é˜µ","date":"2020-04-29T12:46:39.000Z","updated":"2020-04-29T12:48:19.275Z","comments":true,"path":"article/leetcode74-æœç´¢äºŒç»´çŸ©é˜µ/","link":"","permalink":"https://www.codetool.top/article/leetcode74-%E6%90%9C%E7%B4%A2%E4%BA%8C%E7%BB%B4%E7%9F%A9%E9%98%B5/","excerpt":"","text":"1 åŸé¢˜ç¼–å†™ä¸€ä¸ªé«˜æ•ˆçš„ç®—æ³•æ¥åˆ¤æ–­ m x n çŸ©é˜µä¸­ï¼Œæ˜¯å¦å­˜åœ¨ä¸€ä¸ªç›®æ ‡å€¼ã€‚è¯¥çŸ©é˜µå…·æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š æ¯è¡Œä¸­çš„æ•´æ•°ä»å·¦åˆ°å³æŒ‰å‡åºæ’åˆ—ã€‚ æ¯è¡Œçš„ç¬¬ä¸€ä¸ªæ•´æ•°å¤§äºå‰ä¸€è¡Œçš„æœ€åä¸€ä¸ªæ•´æ•°ã€‚ ç¤ºä¾‹1: è¾“å…¥: matrix = [ [1, 3, 5, 7], [10, 11, 16, 20], [23, 30, 34, 50] ] target = 3 è¾“å‡º: true ç¤ºä¾‹2: è¾“å…¥: matrix = [ [1, 3, 5, 7], [10, 11, 16, 20], [23, 30, 34, 50] ] target = 13 è¾“å‡º: false 2 è§£æ³•2.1 æ€æƒ³å…ˆè¿›è¡Œè¡Œçš„äºŒåˆ†æœç´¢ï¼Œæ‰¾å‡ºåœ¨å“ªä¸€è¡Œä¹‹åå†å¯¹åˆ—è¿›è¡ŒäºŒåˆ†æœç´¢ã€‚ 2.2 ä»£ç class Solution { public boolean searchMatrix(int[][] matrix, int target) { if(matrix.length == 0||matrix[0].length==0) return false; int start = 0; int end = matrix.length-1; int width = matrix[0].length-1; while(start&lt;end){ int mid = (start+end)/2; if(matrix[mid][width]==target) return true; else if(matrix[mid][width]>target) end = mid; else start = mid+1; } int row = start; start = 0; end = width; while(start&lt;end){ int mid = (start+end)/2; if(matrix[row][mid]==target) return true; else if(matrix[row][mid]>target) end = mid-1; else start = mid+1; } if(matrix[row][start]!=target) return false; return true; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode1095-å±±è„‰æ•°ç»„ä¸­æŸ¥æ‰¾ç›®æ ‡å€¼","slug":"leetcode1095-å±±è„‰æ•°ç»„ä¸­æŸ¥æ‰¾ç›®æ ‡å€¼","date":"2020-04-29T06:32:06.000Z","updated":"2020-04-29T06:51:09.428Z","comments":true,"path":"article/leetcode1095-å±±è„‰æ•°ç»„ä¸­æŸ¥æ‰¾ç›®æ ‡å€¼/","link":"","permalink":"https://www.codetool.top/article/leetcode1095-%E5%B1%B1%E8%84%89%E6%95%B0%E7%BB%84%E4%B8%AD%E6%9F%A5%E6%89%BE%E7%9B%AE%E6%A0%87%E5%80%BC/","excerpt":"","text":"1 åŸé¢˜ï¼ˆè¿™æ˜¯ä¸€ä¸ª äº¤äº’å¼é—®é¢˜ ï¼‰ ç»™ä½ ä¸€ä¸ª å±±è„‰æ•°ç»„ mountainArrï¼Œè¯·ä½ è¿”å›èƒ½å¤Ÿä½¿å¾— mountainArr.get(index) ç­‰äº target æœ€å° çš„ä¸‹æ ‡ index å€¼ã€‚ å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„ä¸‹æ ‡ indexï¼Œå°±è¯·è¿”å› -1ã€‚ ä½•ä¸ºå±±è„‰æ•°ç»„ï¼Ÿå¦‚æœæ•°ç»„ A æ˜¯ä¸€ä¸ªå±±è„‰æ•°ç»„çš„è¯ï¼Œé‚£å®ƒæ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š é¦–å…ˆï¼ŒA.length &gt;= 3 å…¶æ¬¡ï¼Œåœ¨ 0 &lt; i &lt; A.length - 1 æ¡ä»¶ä¸‹ï¼Œå­˜åœ¨ i ä½¿å¾—ï¼š A[0] &lt; A[1] &lt; ... A[i-1] &lt; A[i] A[i] &gt; A[i+1] &gt; ... &gt; A[A.length - 1] ä½ å°† ä¸èƒ½ç›´æ¥è®¿é—®è¯¥å±±è„‰æ•°ç»„ï¼Œå¿…é¡»é€šè¿‡ MountainArray æ¥å£æ¥è·å–æ•°æ®ï¼š MountainArray.get(k) - ä¼šè¿”å›æ•°ç»„ä¸­ç´¢å¼•ä¸ºk çš„å…ƒç´ ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ MountainArray.length() - ä¼šè¿”å›è¯¥æ•°ç»„çš„é•¿åº¦ æ³¨æ„ï¼š å¯¹ MountainArray.get å‘èµ·è¶…è¿‡ 100 æ¬¡è°ƒç”¨çš„æäº¤å°†è¢«è§†ä¸ºé”™è¯¯ç­”æ¡ˆã€‚æ­¤å¤–ï¼Œä»»ä½•è¯•å›¾è§„é¿åˆ¤é¢˜ç³»ç»Ÿçš„è§£å†³æ–¹æ¡ˆéƒ½å°†ä¼šå¯¼è‡´æ¯”èµ›èµ„æ ¼è¢«å–æ¶ˆã€‚ ä¸ºäº†å¸®åŠ©å¤§å®¶æ›´å¥½åœ°ç†è§£äº¤äº’å¼é—®é¢˜ï¼Œæˆ‘ä»¬å‡†å¤‡äº†ä¸€ä¸ªæ ·ä¾‹ â€œç­”æ¡ˆâ€ï¼šhttps://leetcode-cn.com/playground/RKhe3aveï¼Œè¯·æ³¨æ„è¿™ ä¸æ˜¯ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥ï¼š array = [1,2,3,4,5,3,1], target = 3è¾“å‡ºï¼š 2è§£é‡Šï¼š 3 åœ¨æ•°ç»„ä¸­å‡ºç°äº†ä¸¤æ¬¡ï¼Œä¸‹æ ‡åˆ†åˆ«ä¸º 2 å’Œ 5ï¼Œæˆ‘ä»¬è¿”å›æœ€å°çš„ä¸‹æ ‡ 2ã€‚ ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼š array = [0,1,2,4,2,1], target = 3è¾“å‡ºï¼š -1è§£é‡Šï¼š 3 åœ¨æ•°ç»„ä¸­æ²¡æœ‰å‡ºç°ï¼Œè¿”å› -1ã€‚ æç¤ºï¼š 3 &lt;= mountain_arr.length() &lt;= 10000 0 &lt;= target &lt;= 10^9 0 &lt;= mountain_arr.get(index) &lt;= 10^9 2 è§£æ³•2.1 æ€æƒ³è¶…è¿‡ 100 æ¬¡è°ƒç”¨çš„æäº¤å°†è¢«è§†ä¸ºé”™è¯¯ç­”æ¡ˆï¼Œæ•°æ®è§„æ¨¡åˆå°äºç­‰äºä¸€ä¸‡ï¼Œå¾ˆæ˜æ˜¾æ˜¯è¦ç”¨lognçš„æ—¶é—´å¤æ‚åº¦æ±‚è§£ï¼Œå› ä¸ºæ˜¯æœ‰åºæ•°ç»„ï¼Œä¹Ÿå¾ˆå®¹æ˜“æƒ³åˆ°äºŒåˆ†æŸ¥æ‰¾ã€‚ç”±äºè¿™ä¸ªæ•°ç»„ä¸æ˜¯å®Œå…¨æœ‰åºçš„ï¼Œå¯ä»¥åˆ†æˆå‡åºå’Œé™åºçš„ä¸¤éƒ¨åˆ†ï¼Œåˆ™å¯ä»¥å…ˆæ‰¾å‡ºå³°é¡¶å€¼ï¼Œç„¶åå¯¹ä¸¤éƒ¨åˆ†è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ã€‚ 2.2 ä»£ç ï¼ˆä½œè€…ï¼šliweiwei1419ï¼‰ class Solution { public int findInMountainArray(int target, MountainArray mountainArr) { int size = mountainArr.length(); // æ­¥éª¤ 1ï¼šå…ˆæ‰¾åˆ°å±±é¡¶å…ƒç´ æ‰€åœ¨çš„ç´¢å¼• int mountaintop = findMountaintop(mountainArr, 0, size - 1); // æ­¥éª¤ 2ï¼šåœ¨å‰æœ‰åºä¸”å‡åºæ•°ç»„ä¸­æ‰¾ target æ‰€åœ¨çš„ç´¢å¼• int res = findFromSortedArr(mountainArr, 0, mountaintop, target); if (res != -1) { return res; } // æ­¥éª¤ 3ï¼šå¦‚æœæ­¥éª¤ 2 æ‰¾ä¸åˆ°ï¼Œå°±åœ¨åæœ‰åºä¸”é™åºæ•°ç»„ä¸­æ‰¾ target æ‰€åœ¨çš„ç´¢å¼• return findFromInversedArr(mountainArr, mountaintop + 1, size - 1, target); } // è¿”å›å±±é¡¶å…ƒç´  private int findMountaintop(MountainArray mountainArr, int l, int r) { while (l &lt; r) { int mid = l + (r - l) / 2; // å–å·¦ä¸­ä½æ•°ï¼Œå› ä¸ºè¿›å…¥å¾ªç¯ï¼Œæ•°ç»„ä¸€å®šè‡³å°‘æœ‰ 2 ä¸ªå…ƒç´  // å› æ­¤ï¼Œå·¦ä¸­ä½æ•°ä¸€å®šæœ‰å³è¾¹å…ƒç´ ï¼Œæ•°ç»„ä¸‹æ ‡ä¸ä¼šå‘ç”Ÿè¶Šç•Œ if (mountainArr.get(mid) &lt; mountainArr.get(mid + 1)) { // å¦‚æœå½“å‰çš„æ•°æ¯”å³è¾¹çš„æ•°å°ï¼Œå®ƒä¸€å®šä¸æ˜¯å±±é¡¶ l = mid + 1; } else { r = mid; } } return l; } private int findFromSortedArr(MountainArray mountainArr, int l, int r, int target) { while (l &lt; r) { int mid = l + (r - l) / 2; if (mountainArr.get(mid) &lt; target) { l = mid + 1; } else { r = mid; } } if (mountainArr.get(l) == target) { return l; } return -1; } private int findFromInversedArr(MountainArray mountainArr, int l, int r, int target) { while (l &lt; r) { int mid = l + (r - l) / 2; if (mountainArr.get(mid) > target) { l = mid + 1; } else { r = mid; } } if (mountainArr.get(l) == target) { return l; } return -1; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ“ä½œç³»ç»Ÿå¤ä¹ 05-è®¾å¤‡ç®¡ç†","slug":"æ“ä½œç³»ç»Ÿå¤ä¹ 05-æ–‡ä»¶ç®¡ç†","date":"2020-04-28T14:58:05.000Z","updated":"2020-04-29T09:15:13.476Z","comments":true,"path":"article/æ“ä½œç³»ç»Ÿå¤ä¹ 05-æ–‡ä»¶ç®¡ç†/","link":"","permalink":"https://www.codetool.top/article/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A005-%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86/","excerpt":"","text":"è®¾å¤‡ç®¡ç†çš„åŠŸèƒ½ï¼š å¤–å›´è®¾å¤‡ä¸­æ–­å¤„ç† ç¼“å†²åŒºç®¡ç† å¤–å›´è®¾å¤‡çš„åˆ†é…å’Œå»é… å¤–å›´è®¾å¤‡é©±åŠ¨è°ƒåº¦ è™šæ‹Ÿè®¾å¤‡åŠå…¶å®ç° 1 I/Oç¡¬ä»¶åŸç† 1.1 IOç³»ç»ŸI/Oç³»ç»Ÿæ˜¯I/Oè®¾å¤‡åŠå…¶æ¥å£çº¿è·¯ã€æ§åˆ¶éƒ¨ä»¶ã€é€šé“å’Œç®¡ç†è½¯ä»¶çš„æ€»ç§°ã€‚ I/Oå°±æ˜¯â€œè¾“å…¥/è¾“å‡ºâ€(Input/Output) 1.1.1 I/Oè®¾å¤‡I/Oè®¾å¤‡å°±æ˜¯å¯ä»¥å°†æ•°æ®è¾“å…¥åˆ°è®¡ç®—æœºï¼Œæˆ–è€…å¯ä»¥æ¥æ”¶è®¡ç®—æœºè¾“å‡ºæ•°æ®çš„å¤–éƒ¨è®¾å¤‡ï¼Œå±äºè®¡ç®—æœºä¸­çš„ç¡¬ä»¶éƒ¨ä»¶ã€‚ I/Oè®¾å¤‡æŒ‰ä½¿ç”¨ç‰¹æ€§åˆ†ç±»ï¼š äººæœºäº¤äº’ç±»å¤–è®¾ï¼šé¼ æ ‡ã€é”®ç›˜ã€æ‰“å°æœºç­‰â€”â€”ç”¨äºäººæœºäº¤äº’ï¼Œæ•°æ®ä¼ è¾“é€Ÿåº¦æ…¢ã€‚ å­˜å‚¨è®¾å¤‡ï¼šç§»åŠ¨ç¡¬ç›˜ã€å…‰ç›˜ç­‰â€”â€”ç”¨äºæ•°æ®å­˜å‚¨ï¼Œæ•°æ®ä¼ è¾“é€Ÿåº¦å¿«ã€‚ ç½‘ç»œé€šä¿¡è®¾å¤‡ï¼šè°ƒåˆ¶è§£è°ƒå™¨ç­‰â€”â€”ç”¨äºç½‘ç»œé€šä¿¡ï¼Œæ•°æ®ä¼ è¾“é€Ÿåº¦ä»‹äºä¸Šè¿°äºŒè€…ä¹‹é—´ã€‚ I/Oè®¾å¤‡æŒ‰ä¿¡æ¯äº¤æ¢çš„å•ä½åˆ†ç±»ï¼š å—è®¾å¤‡ï¼šå¦‚ç£ç›˜ç­‰â€”â€”æ•°æ®ä¼ è¾“çš„åŸºæœ¬å•ä½æ˜¯â€œå—â€ï¼Œä¼ è¾“é€Ÿç‡è¾ƒé«˜ï¼Œå¯å¯»å€ï¼Œå³å¯¹å®ƒå¯éšæœºåœ°è¯»/å†™ä»»ä¸€å—ã€‚ å­—ç¬¦è®¾å¤‡ï¼šé¼ æ ‡ã€é”®ç›˜ç­‰â€”â€”æ•°æ®ä¼ è¾“çš„åŸºæœ¬å•ä½æ˜¯å­—ç¬¦ï¼Œä¼ è¾“é€Ÿç‡è¾ƒæ…¢ï¼Œä¸å¯å¯»å€ï¼Œåœ¨è¾“å…¥/è¾“å‡ºæ—¶å¸¸é‡‡ç”¨ä¸­æ–­é©±åŠ¨æ–¹å¼ 1.2 è®¾å¤‡æ§åˆ¶å™¨CPUæ— æ³•ç›´æ¥æ§åˆ¶I/Oè®¾å¤‡çš„æœºæ¢°éƒ¨ä»¶ï¼Œå› æ­¤I/Oè®¾å¤‡è¿˜è¦æœ‰ä¸€ä¸ªç”µå­éƒ¨ä»¶ï¼ˆç§°è®¾å¤‡æ§åˆ¶å™¨æˆ–é€‚é…å™¨ï¼‰ä½œä¸ºCPUå’ŒI/Oè®¾å¤‡æœºæ¢°éƒ¨ä»¶ä¹‹é—´çš„â€œä¸­ä»‹â€ï¼Œç”¨äºå®ç°CPUå¯¹è®¾å¤‡çš„æ§åˆ¶ã€‚ å¦‚æœæ²¡æœ‰æ§åˆ¶å™¨ï¼Œå¤æ‚æ“ä½œå¿…é¡»ç”±æ“ä½œç³»ç»Ÿæ¥è§£å†³ï¼Œå¼•å…¥æ§åˆ¶å™¨åï¼Œé€šè¿‡ä¼ é€’ç®€å•å‚æ•°å°±å¯è¿›è¡ŒI/Oæ“ä½œï¼Œå¤§å¤§ç®€åŒ–ç³»ç»Ÿçš„è®¾è®¡ï¼Œæœ‰åˆ©äºè®¡ç®—æœºç³»ç»Ÿå¯¹å„ç±»æ§åˆ¶å™¨å’Œè®¾å¤‡çš„å…¼å®¹æ€§ã€‚ ä¸»è¦åŠŸèƒ½: æ¥æ”¶å’Œè¯†åˆ«CPUæˆ–é€šé“å‘æ¥çš„å‘½ä»¤ï¼šå¦‚CPUå‘æ¥çš„read/writeå‘½ä»¤ï¼ŒI/Oæ§åˆ¶å™¨ä¸­ä¼šæœ‰ç›¸åº”çš„æ§åˆ¶å¯„å­˜å™¨æ¥å­˜æ”¾å‘½ä»¤å’Œå‚æ•°ã€‚ å®ç°æ•°æ®äº¤æ¢,åŒ…æ‹¬è®¾å¤‡å’Œæ§åˆ¶å™¨é—´çš„æ•°æ®ä¼ è¾“ï¼šI/Oæ§åˆ¶å™¨ä¸­ä¼šè®¾ç½®ç›¸åº”çš„æ•°æ®å¯„å­˜å™¨ã€‚è¾“å‡ºæ—¶ï¼Œæ•°æ®å¯„å­˜å™¨ç”¨äºæš‚å­˜CPUå‘æ¥çš„æ•°æ®ï¼Œä¹‹åå†ç”±æ§åˆ¶å™¨ä¼ é€è®¾å¤‡ã€‚è¾“å…¥æ—¶ï¼Œæ•°æ®å¯„å­˜å™¨ç”¨äºæš‚å­˜è®¾å¤‡å‘æ¥çš„æ•°æ®ï¼Œä¹‹åCPUä»æ•°æ®å¯„å­˜å™¨ä¸­å–èµ°æ•°æ®ã€‚ å‘ç°å’Œè®°å½•è®¾å¤‡åŠè‡ªèº«çš„çŠ¶æ€ä¿¡æ¯ï¼Œä¾›CPUå¤„ç†ï¼šI/Oæ§åˆ¶å™¨ä¸­ä¼šæœ‰ç›¸åº”çš„çŠ¶æ€å¯„å­˜å™¨ï¼Œç”¨äºè®°å½•I/Oè®¾å¤‡çš„å½“å‰çŠ¶æ€ã€‚å¦‚:1è¡¨ç¤ºç©ºé—²ï¼Œ0è¡¨ç¤ºå¿™ç¢Œã€‚ è®¾å¤‡åœ°å€è¯†åˆ«ï¼šç±»ä¼¼äºå†…å­˜çš„åœ°å€ï¼Œä¸ºäº†åŒºåˆ†è®¾å¤‡æ§åˆ¶å™¨ä¸­çš„å„ä¸ªå¯„å­˜å™¨ï¼Œä¹Ÿéœ€è¦ç»™å„ä¸ªå¯„å­˜å™¨è®¾ç½®ä¸€ä¸ªç‰¹å®šçš„â€œåœ°å€â€ã€‚I/Oæ§åˆ¶å™¨é€šè¿‡CPUæä¾›çš„â€œåœ°å€â€æ¥åˆ¤æ–­CPUè¦è¯»/å†™çš„æ˜¯å“ªä¸ªå¯„å­˜å™¨ å®ƒæ˜¯ä¸€ä¸ªå¯ç¼–å€è®¾å¤‡,å½“å®ƒè¿æ¥å¤šå°è®¾å¤‡æ—¶,åˆ™åº”å…·æœ‰å¤šä¸ªè®¾å¤‡åœ°å€ã€‚ 1.3 I/Oæ§åˆ¶æ–¹å¼1.3.1 è½®è¯¢æ–¹å¼åˆç§°ç¨‹åºç›´æ¥æ§åˆ¶æ–¹å¼ï¼Œä½¿ç”¨æŸ¥è¯¢æŒ‡ä»¤æµ‹è¯•è®¾å¤‡æ§åˆ¶å™¨çš„å¿™é—²çŠ¶æ€ä½ï¼Œå†³å®šå†…å­˜å’Œè®¾å¤‡æ˜¯å¦èƒ½äº¤æ¢æ•°æ®ã€‚ è½®è¯¢ç¨‹åºä¸­ç”¨åˆ°çš„ä¸‰ç§æŒ‡ä»¤ï¼š æŸ¥è¯¢æŒ‡ä»¤ï¼šæŸ¥è¯¢è®¾å¤‡æ˜¯å¦å°±ç»ª è¯»/å†™æŒ‡ä»¤ï¼šå½“è®¾å¤‡å°±ç»ªæ—¶ï¼Œæ‰§è¡Œæ•°æ®äº¤æ¢ è½¬ç§»æŒ‡ä»¤ï¼šå½“è®¾å¤‡æœªå°±ç»ªæ—¶ï¼Œæ‰§è¡Œè½¬ç§»æŒ‡ä»¤è½¬å‘æŸ¥è¯¢æŒ‡ä»¤ç»§ç»­æŸ¥è¯¢ã€‚ ç‰¹ç‚¹ï¼š CPUå¹²é¢„çš„é¢‘ç‡å¾ˆé¢‘ç¹ï¼ŒI/Oæ“ä½œå¼€å§‹ä¹‹å‰ã€å®Œæˆä¹‹åéœ€è¦CPUä»‹å…¥ï¼Œå¹¶ä¸”åœ¨ç­‰å¾…I/Oå®Œæˆçš„è¿‡ç¨‹ä¸­CPUéœ€è¦ä¸æ–­åœ°è½®è¯¢æ£€æŸ¥ã€‚ æ¯æ¬¡è¯»å†™ä¸€ä¸ªå­— éœ€è¦CPUçš„å¸®åŠ© ç¼ºç‚¹:CPUå’ŒI/Oè®¾å¤‡åªèƒ½ä¸²è¡Œå·¥ä½œï¼ŒCPUéœ€è¦ä¸€ç›´è½®è¯¢æ£€æŸ¥ï¼Œé•¿æœŸå¤„äºâ€œå¿™ç­‰â€çŠ¶æ€ï¼ŒCPUåˆ©ç”¨ç‡ä½ã€‚ 1.3.2 ä¸­æ–­æ–¹å¼ä¸­æ–­æ–¹å¼è¦æ±‚CPUä¸è®¾å¤‡æ§åˆ¶å™¨åŠè®¾å¤‡ä¹‹é—´æœ‰ä¸­æ–­è¯·æ±‚çº¿ï¼Œæ§åˆ¶å™¨çš„çŠ¶æ€å¯„å­˜å™¨æœ‰ç›¸åº”ä¸­æ–­å…è®¸ä½ã€‚ åœ¨CPUå‘å‡ºè¯»/å†™å‘½ä»¤åï¼Œå¯å°†ç­‰å¾…I/Oçš„è¿›ç¨‹é˜»å¡ï¼Œå…ˆåˆ‡æ¢åˆ°åˆ«çš„è¿›ç¨‹æ‰§è¡Œã€‚å½“I/Oå®Œæˆåï¼Œæ§åˆ¶å™¨ä¼šå‘CPUå‘å‡ºä¸€ä¸ªä¸­æ–­ä¿¡å·ï¼ŒCPUæ£€æµ‹åˆ°ä¸­æ–­ä¿¡å·åï¼Œä¼šä¿å­˜å½“å‰è¿›ç¨‹çš„è¿è¡Œç¯å¢ƒä¿¡æ¯ï¼Œè½¬å»æ‰§è¡Œä¸­æ–­å¤„ç†ç¨‹åºå¤„ç†è¯¥ä¸­æ–­ã€‚å¤„ç†ä¸­æ–­çš„è¿‡ç¨‹ä¸­ï¼ŒCPUä»I/Oæ§åˆ¶å™¨è¯»ä¸€ä¸ªå­—çš„æ•°æ®ä¼ é€åˆ°CPUå¯„å­˜å™¨ï¼Œå†å†™å…¥ä¸»å­˜ã€‚æ¥ç€ï¼ŒCPUæ¢å¤ç­‰å¾…I/Oçš„è¿›ç¨‹ï¼ˆæˆ–å…¶ä»–è¿›ç¨‹ï¼‰çš„è¿è¡Œç¯å¢ƒï¼Œç„¶åç»§ç»­æ‰§è¡Œ æ³¨æ„ï¼š CPUä¼šåœ¨æ¯ä¸ªæŒ‡ä»¤å‘¨æœŸçš„æœ«å°¾æ£€æŸ¥ä¸­æ–­ ä¸­æ–­å¤„ç†è¿‡ç¨‹ä¸­éœ€è¦ä¿å­˜ã€æ¢å¤è¿›ç¨‹çš„è¿è¡Œç¯å¢ƒï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯éœ€è¦ä¸€å®šæ—¶é—´å¼€é”€çš„ã€‚å¯è§ï¼Œå¦‚æœä¸­æ–­å‘ç”Ÿçš„é¢‘ç‡å¤ªé«˜ï¼Œä¹Ÿä¼šé™ä½ç³»ç»Ÿæ€§èƒ½ ç‰¹ç‚¹ï¼š æ¯æ¬¡I/Oæ“ä½œå¼€å§‹ä¹‹å‰ã€å®Œæˆä¹‹åéœ€è¦CPUä»‹å…¥ã€‚ç­‰å¾…I/Oå®Œæˆçš„è¿‡ç¨‹ä¸­CPUå¯ä»¥åˆ‡æ¢åˆ°åˆ«çš„è¿›ç¨‹æ‰§è¡Œã€‚ æ¯æ¬¡è¯»å†™ä¸€ä¸ªå­— éœ€è¦CPUçš„å¸®åŠ© ç¼ºç‚¹ï¼šæ¯ä¸ªå­—åœ¨I/Oè®¾å¤‡ä¸å†…å­˜ä¹‹é—´çš„ä¼ è¾“ï¼Œéƒ½éœ€è¦ç»è¿‡CPUã€‚è€Œé¢‘ç¹çš„ä¸­æ–­å¤„ç†ä¼šæ¶ˆè€—è¾ƒå¤šçš„CPUæ—¶é—´ã€‚ 1.3.3 DMAæ–¹å¼ä¸â€œä¸­æ–­é©±åŠ¨æ–¹å¼â€ç›¸æ¯”ï¼ŒDMAæ–¹å¼ï¼ˆDirect Memory Accessï¼Œç›´æ¥å­˜å‚¨å™¨å­˜å–ã€‚ä¸»è¦ç”¨äºå—è®¾å¤‡çš„I/0æ§åˆ¶ï¼‰æœ‰è¿™æ ·å‡ ä¸ªæ”¹è¿›: æ•°æ®çš„ä¼ é€å•ä½æ˜¯â€œå—â€ã€‚ä¸å†æ˜¯ä¸€ä¸€ä¸ªå­—ã€ä¸€ä¸ªå­—çš„ä¼ é€ æ•°æ®çš„æµå‘æ˜¯ä»è®¾å¤‡ç›´æ¥æ”¾å…¥å†…å­˜ï¼Œæˆ–è€…ä»å†…å­˜ç›´æ¥åˆ°è®¾å¤‡ã€‚ä¸å†éœ€è¦CPUçš„å¸®åŠ©ã€‚ ä»…åœ¨ä¼ é€ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å—çš„å¼€å§‹å’Œç»“æŸæ—¶ï¼Œæ‰éœ€è¦CPUå¹²é¢„ã€‚ æ­¥éª¤ï¼š CPUæŒ‡æ˜æ­¤æ¬¡è¦è¿›è¡Œçš„æ“ä½œï¼ˆå¦‚ï¼šè¯»æ“ä½œï¼‰ï¼Œå¹¶è¯´æ˜è¦è¯»å…¥å¤šå°‘æ•°æ®ã€æ•°æ®è¦å­˜æ”¾åœ¨å†…å­˜çš„ä»€ä¹ˆä½ç½®ã€æ•°æ®åœ¨å¤–éƒ¨è®¾å¤‡ä¸Šçš„åœ°å€ï¼ˆå¦‚ï¼šåœ¨ç£ç›˜ä¸Šçš„åœ°å€ï¼‰ æ§åˆ¶å™¨ä¼šæ ¹æ®CPUæå‡ºçš„è¦æ±‚å®Œæˆæ•°æ®çš„è¯»/å†™å·¥ä½œï¼Œæ•´å—æ•°æ®çš„ä¼ è¾“å®Œæˆåï¼Œæ‰å‘CPUå‘å‡ºä¸­æ–­ä¿¡å· DMAæ–¹å¼éœ€ä»¥ä¸‹è®¾æ–½ï¼š å†…å­˜åœ°å€å¯„å­˜å™¨ï¼šåœ¨è¾“å…¥æ—¶è¡¨ç¤ºæ•°æ®åº”æ”¾åˆ°å†…å­˜ä¸­çš„ä»€ä¹ˆä½ç½®ï¼Œè¾“å‡ºæ—¶è¡¨ç¤ºè¦è¾“å‡ºçš„æ•°æ®æ”¾åœ¨å†…å­˜ä¸­çš„ä»€ä¹ˆä½ç½®ä¸­ã€‚ æ•°æ®è®¡æ•°å™¨ï¼šè¡¨ç¤ºå‰©ä½™è¦è¯»/å†™çš„å­—èŠ‚æ•°ã€‚ æ•°æ®ç¼“å†²å¯„å­˜å™¨æˆ–æ•°æ®ç¼“å†²åŒºï¼šæš‚å­˜ä»è®¾å¤‡åˆ°å†…å­˜ï¼Œæˆ–ä»å†…å­˜åˆ°è®¾å¤‡çš„æ•°æ®ã€‚ è®¾å¤‡åœ°å€å¯„å­˜å™¨ï¼šæš‚å­˜å­˜å‚¨è®¾å¤‡ä¸­çš„åœ°å€ã€‚ ä¸­æ–­æœºåˆ¶å’Œæ§åˆ¶é€»è¾‘ï¼šé€šè¿‡ä¸­æ–­æœºåˆ¶é€šçŸ¥CPU ç‰¹ç‚¹ï¼š ä»…åœ¨ä¼ é€ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å—çš„å¼€å§‹å’Œç»“æŸæ—¶ï¼Œæ‰éœ€è¦CPUå¹²é¢„ã€‚ æ¯æ¬¡è¯»/å†™ä¸€ä¸ªæˆ–å¤šä¸ªå—ï¼ˆæ³¨æ„ï¼šæ¯æ¬¡è¯»å†™çš„åªèƒ½æ˜¯è¿ç»­çš„å¤šä¸ªå—ï¼Œä¸”è¿™äº›å—è¯»å…¥å†…å­˜ååœ¨å†…å­˜ä¸­ä¹Ÿå¿…é¡»æ˜¯è¿ç»­çš„ï¼‰ æ•°æ®ä¼ è¾“ä¸å†éœ€è¦ç»è¿‡CPU ç¼ºç‚¹: CPUæ¯å‘å‡ºä¸€æ¡I/OæŒ‡ä»¤ï¼Œåªèƒ½è¯»/å†™ä¸€ä¸ªæˆ–å¤šä¸ªè¿ç»­çš„æ•°æ®å—ã€‚å¦‚æœè¦è¯»/å†™å¤šä¸ªç¦»æ•£å­˜å‚¨çš„æ•°æ®å—ï¼Œæˆ–è€…è¦å°†æ•°æ®åˆ†åˆ«å†™åˆ°ä¸åŒçš„å†…å­˜åŒºåŸŸæ—¶ï¼ŒCPUè¦åˆ†åˆ«å‘å‡ºå¤šæ¡I/OæŒ‡ä»¤ï¼Œè¿›è¡Œå¤šæ¬¡ä¸­æ–­å¤„ç†æ‰èƒ½å®Œæˆã€‚ 1.3.4 é€šé“æ–¹å¼ä¸ºè·å¾—CPUå’Œå¤–å›´è®¾å¤‡é—´æ›´é«˜çš„å¹¶è¡Œå·¥ä½œèƒ½åŠ›ï¼Œä¸ºè®©ç§ç±»ç¹å¤šï¼Œç‰©ç†ç‰¹æ€§å„å¼‚çš„å¤–å›´è®¾å¤‡èƒ½ä»¥æ ‡å‡†çš„æ¥å£è¿æ¥åˆ°ç³»ç»Ÿä¸­ï¼Œè®¡ç®—æœºç³»ç»Ÿå¼•å…¥äº†è‡ªæˆç‹¬ç«‹ä½“ç³»çš„é€šé“ç»“æ„ã€‚ é€šé“ä¹Ÿæ˜¯ä¸€ç§ç¡¬ä»¶ï¼Œå¯ä»¥è¯†åˆ«å¹¶æ‰§è¡Œä¸€ç³»åˆ—é€šé“æŒ‡ä»¤ï¼Œå®Œæˆä¸€éƒ¨åˆ†CPUçš„å·¥ä½œã€‚ é‡‡ç”¨é€šé“åçš„I/Oæ“ä½œè¿‡ç¨‹ï¼š CPUå‘é€šé“å‘å‡ºI/OæŒ‡ä»¤ã€‚æŒ‡æ˜é€šé“ç¨‹åºåœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼Œå¹¶æŒ‡æ˜è¦æ“ä½œçš„æ˜¯å“ªä¸ªI/Oè®¾å¤‡ï¼Œä¹‹åCPUå°±åˆ‡æ¢åˆ°å…¶ä»–è¿›ç¨‹æ‰§è¡Œäº†ã€‚ é€šé“æ‰§è¡Œå†…å­˜ä¸­çš„é€šé“ç¨‹åºï¼ˆå…¶ä¸­æŒ‡æ˜äº†è¦è¯»å…¥/å†™å‡ºå¤šå°‘æ•°æ®ï¼Œè¯»/å†™çš„æ•°æ®åº”æ”¾åœ¨å†…å­˜çš„ä»€ä¹ˆä½ç½®ç­‰ä¿¡æ¯ï¼‰ é€šé“æ‰§è¡Œå®Œè§„å®šçš„ä»»åŠ¡åï¼Œå‘CPUå‘å‡ºä¸­æ–­ä¿¡å·ï¼Œä¹‹åCPUå¯¹ä¸­æ–­è¿›è¡Œå¤„ç† ç‰¹ç‚¹ï¼š CPUå¹²é¢„çš„é¢‘ç‡æä½ï¼Œé€šé“ä¼šæ ¹æ®CPUçš„æŒ‡ç¤ºæ‰§è¡Œç›¸åº”çš„é€šé“ç¨‹åºï¼Œåªæœ‰å®Œæˆä¸€ç»„æ•°æ®å—çš„è¯»/å†™åæ‰éœ€è¦å‘å‡ºä¸­æ–­ä¿¡å·ï¼Œè¯·æ±‚CPUå¹²é¢„ã€‚ æ¯æ¬¡è¯»/å†™ä¸€ç»„æ•°æ®å— CPUã€é€šé“ã€I/Oè®¾å¤‡å¯å¹¶è¡Œå·¥ä½œï¼Œèµ„æºåˆ©ç”¨ç‡å¾ˆé«˜ã€‚ ç¼ºç‚¹ï¼šéœ€è¦ä¸“é—¨çš„é€šé“ç¡¬ä»¶æ”¯æŒã€‚ 2 I/Oè½¯ä»¶åŸç† 2.1 I/Oè½¯ä»¶è®¾è®¡ç›®æ ‡å’ŒåŸåˆ™I/Oè½¯ä»¶æ€»ä½“è®¾è®¡ç›®æ ‡: é«˜æ•ˆç‡ é€šç”¨æ€§ I/Oè½¯ä»¶æ€»ä½“è®¾è®¡è¦è€ƒè™‘çš„é—®é¢˜ï¼š è®¾å¤‡æ— å…³æ€§ å‡ºé”™å¤„ç† åŒæ­¥ï¼ˆé˜»å¡ï¼‰â€”å¼‚æ­¥ï¼ˆä¸­æ–­é©±åŠ¨ï¼‰ä¼ è¾“ ç‹¬å æ€§å¤–å›´è®¾å¤‡å’Œå…±äº«æ€§å¤–å›´è®¾å¤‡ 2.2 I/Oè½¯ä»¶ç»„ç»‡æˆå››ä¸ªå±‚æ¬¡ I/Oä¸­æ–­å¤„ç†ç¨‹åºã€‚ I/Oè®¾å¤‡é©±åŠ¨ç¨‹åºã€‚ ç‹¬ç«‹äºè®¾å¤‡çš„æ“ä½œç³»ç»ŸI/Oè½¯ä»¶ã€‚ ç”¨æˆ·ç©ºé—´çš„I/Oè½¯ä»¶ã€‚ è¶Šå¾€ä¸Šè¶Šæ¥è¿‘ç¡¬ä»¶ï¼Œè¶Šå¾€ä¸‹è¶Šé è¿‘ç”¨æˆ· 2.2.1 I/Oä¸­æ–­å¤„ç†ç¨‹åºå½“I/Oä»»åŠ¡å®Œæˆæ—¶ï¼ŒI/Oæ§åˆ¶å™¨ä¼šå‘é€ä¸€ä¸ªä¸­æ–­ä¿¡å·ï¼Œç³»ç»Ÿä¼šæ ¹æ®ä¸­æ–­ä¿¡å·ç±»å‹æ‰¾åˆ°ç›¸åº”çš„ä¸­æ–­å¤„ç†ç¨‹åºå¹¶æ‰§è¡Œã€‚ I/Oä¸­æ–­çš„ç±»å‹å’ŒåŠŸèƒ½ï¼š é€šçŸ¥ç”¨æˆ·ç¨‹åºI/Oæ“ä½œæ²¿é“¾æ¨è¿›ç¨‹åº¦ é€šçŸ¥ç”¨æˆ·ç¨‹åºI/Oæ“ä½œæ­£å¸¸ç»“æŸ é€šçŸ¥ç”¨æˆ·ç¨‹åºå‘ç°çš„I/Oæ“ä½œå¼‚å¸¸ é€šçŸ¥ç¨‹åºå¤–å›´è®¾å¤‡ä¸Šé‡è¦çš„å¼‚æ­¥ä¿¡å· I/Oä¸­æ–­çš„å¤„ç†åŸåˆ™ï¼šï¼ˆæ ¹æ®ä¸åŒçš„ä¸­æ–­åŸå› åšç›¸åº”çš„å¤„ç†ï¼‰ æ“ä½œæ­£å¸¸ç»“æŸå¤„ç† æ“ä½œå‘ç”Ÿæ•…éšœæˆ–ç‰¹æ®Šäº‹ä»¶çš„ä¸­æ–­å¤„ç† äººä¸ºè¦æ±‚è€Œäº§ç”Ÿçš„ä¸­æ–­å¤„ç† å¤–å›´è®¾å¤‡çš„å¼‚æ­¥ä¿¡å·å¤„ç† 2.2.2 è®¾å¤‡é©±åŠ¨ç¨‹åºä¸åŒè®¾å¤‡çš„å†…éƒ¨ç¡¬ä»¶ç‰¹æ€§ä¹Ÿä¸åŒï¼Œè¿™äº›ç‰¹æ€§åªæœ‰å‚å®¶æ‰çŸ¥é“ï¼Œå› æ­¤å‚å®¶é¡»æä¾›ä¸è®¾å¤‡ç›¸å¯¹åº”çš„é©±åŠ¨ç¨‹åºï¼ŒCPUæ‰§è¡Œé©±åŠ¨ç¨‹åºçš„æŒ‡ä»¤åºåˆ—ï¼Œæ¥å®Œæˆè®¾ç½®è®¾å¤‡å¯„å­˜å™¨ï¼Œæ£€æŸ¥è®¾å¤‡çŠ¶æ€ç­‰å·¥ä½œ è®¾å¤‡é©±åŠ¨ç¨‹åºåŒ…æ‹¬ä¸è®¾å¤‡ç›¸å…³çš„ä»£ç ï¼Œå…¶å·¥ä½œæ˜¯ï¼šæŠŠç”¨æˆ·æäº¤çš„é€»è¾‘I/Oè¯·æ±‚è½¬åŒ–ä¸ºç‰©ç†I/Oæ“ä½œçš„å¯åŠ¨å’Œæ‰§è¡Œï¼Œå¦‚è®¾å¤‡åè½¬åŒ–ä¸ºç«¯å£åœ°å€ã€é€»è¾‘è®°å½•è½¬åŒ–ä¸ºç‰©ç†è®°å½•ã€é€»è¾‘æ“ä½œè½¬åŒ–ä¸ºç‰©ç†æ“ä½œç­‰ã€‚ è®¾å¤‡é©±åŠ¨ç¨‹åºä¸»è¦åŠŸèƒ½ï¼š è®¾å¤‡åˆå§‹åŒ– æ‰§è¡Œè®¾å¤‡é©±åŠ¨ä¾‹ç¨‹ æ‰§è¡Œä¸­æ–­å¤„ç†ä¾‹ç¨‹ 2.2.3 ç‹¬ç«‹äºè®¾å¤‡çš„æ“ä½œç³»ç»ŸI/Oè½¯ä»¶è®¾å¤‡ç‹¬ç«‹æ€§è½¯ä»¶ï¼Œåˆç§°è®¾å¤‡æ— å…³æ€§è½¯ä»¶ã€‚ä¸è®¾å¤‡çš„ç¡¬ä»¶ç‰¹æ€§æ— å…³çš„åŠŸèƒ½å‡ ä¹éƒ½åœ¨è¿™ä¸€å±‚å®ç°ã€‚ è®¾å¤‡æ— å…³è½¯ä»¶å®Œæˆçš„åŠŸèƒ½ï¼š å¯¹è®¾å¤‡é©±åŠ¨ç¨‹åºçš„ç»Ÿä¸€æ¥å£ï¼ˆå‘ç”¨æˆ·æä¾›ï¼Œå¦‚read/writeç³»ç»Ÿè°ƒç”¨ï¼‰ è®¾å¤‡å‘½å è®¾å¤‡ä¿æŠ¤ï¼šåœ¨unixç³»ç»Ÿä¸­ï¼Œè®¾å¤‡è¢«çœ‹åšæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶ï¼Œä¸åŒç”¨æˆ·å¯¹å„ä¸ªæ–‡ä»¶çš„è®¿é—®æƒé™æ˜¯ä¸ä¸€æ ·çš„ï¼ŒåŒç†ï¼Œå¯¹è®¾å¤‡çš„è®¿é—®æƒé™ä¹Ÿä¸ä¸€æ ·ã€‚ æä¾›ç‹¬ç«‹äºè®¾å¤‡çš„å—å¤§å° ç¼“å†²åŒºç®¡ç†ï¼šå¯ä»¥é€šè¿‡ç¼“å†²æŠ€æœ¯å±è”½è®¾å¤‡ä¹‹é—´æ•°æ®äº¤æ¢å•ä½å¤§å°å’Œä¼ è¾“é€Ÿåº¦çš„å·®å¼‚ å—è®¾å¤‡çš„å­˜å‚¨åˆ†é… ç‹¬å æ€§å¤–å›´è®¾å¤‡çš„åˆ†é…å’Œé‡Šæ”¾ é”™è¯¯æŠ¥å‘Š æ–‡ä»¶å’ŒI/Oè®¾å¤‡çš„å‘½åæ–¹å¼ å¦‚ä½•ä¿æŠ¤å¯¹è®¾å¤‡çš„æœªæˆæƒè®¿é—® å±è”½ä¸åŒç£ç›˜æ‰‡åŒºå¤§å°å¹¶å‘é«˜å±‚è½¯ä»¶æä¾›ç»Ÿä¸€å¤§å°çš„é€»è¾‘å— å—è®¾å¤‡å’Œå­—ç¬¦è®¾å¤‡éœ€è¦ç¼“å†²æŠ€æœ¯ è®¾å¤‡åˆ†é…å’ŒçŠ¶æ€è·Ÿè¸ª é”™è¯¯å¤„ç†å¤šæ•°ç”±é©±åŠ¨ç¨‹åºå®Œæˆï¼Œè®¾å¤‡ç‹¬ç«‹æ€§è½¯ä»¶éœ€è¦å¯¹ä¸€äº›è®¾å¤‡çš„é”™è¯¯è¿›è¡Œå¤„ç†ã€‚ ç¼“å†²æŠ€æœ¯ã€é©±åŠ¨è°ƒåº¦æŠ€æœ¯ã€è®¾å¤‡åˆ†é…ä¼šåœ¨åé¢è®²åˆ°ã€‚ 2.2.4 ç”¨æˆ·ç©ºé—´çš„I/Oè½¯ä»¶ç”¨æˆ·å±‚è½¯ä»¶å®ç°äº†ä¸ç”¨æˆ·äº¤äº’çš„æ¥å£ï¼Œç”¨æˆ·å¯ç›´æ¥ä½¿ç”¨è¯¥å±‚æä¾›çš„ã€ä¸I/Oæ“ä½œç›¸å…³çš„åº“å‡½æ•°å¯¹è®¾å¤‡è¿›è¡Œæ“ä½œã€‚ ç”¨æˆ·ç©ºé—´çš„I/Oè½¯ä»¶ï¼šI/Oç³»ç»Ÿè°ƒç”¨é€šå¸¸å…ˆæ˜¯åº“å‡½æ•°è°ƒç”¨count=write(fdï¼Œbufferï¼Œnbytes)ï¼› éåº“å‡½æ•°å®ç°çš„I/Oç³»ç»Ÿè°ƒç”¨ï¼šSPOOLingç³»ç»Ÿ Windowsæ“ä½œç³»ç»Ÿå‘å¤–æä¾›çš„ä¸€ç³»åˆ—ç³»ç»Ÿè°ƒç”¨ï¼Œä½†æ˜¯ç”±äºç³»ç»Ÿè°ƒç”¨çš„æ ¼å¼ä¸¥æ ¼ï¼Œä½¿ç”¨éº»çƒ¦ï¼Œå› æ­¤åœ¨ç”¨æˆ·å±‚ä¸Šå°è£…äº†ä¸€ç³»åˆ—æ›´æ–¹ä¾¿çš„åº“å‡½æ•°æ¥å£ä¾›ç”¨æˆ·ä½¿ç”¨(Windows API) 2.3 I/Oæ“ä½œè¿‡ç¨‹æ€»è§ˆ è¿›ç¨‹å¯¹å·²æ‰“å¼€æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦æ‰§è¡Œè¯»åº“å‡½æ•°ï¼› ç‹¬ç«‹è®¾å¤‡I/Oè½¯ä»¶æ£€æŸ¥å‚æ•°æ­£ç¡®æ€§ã€‚é«˜é€Ÿç¼“å­˜ä¸­æœ‰è¦è¯»çš„ä¿¡æ¯å—ï¼Œä»ç¼“å†²åŒºç›´æ¥è¯»åˆ°ç”¨æˆ·åŒºï¼Œå®ŒæˆI/Oè¯·æ±‚ï¼› è‹¥æ•°æ®ä¸åœ¨ç¼“å†²åŒºï¼Œæ‰§è¡Œç‰©ç†I/Oï¼Œå®ç°å°†è®¾å¤‡é€»è¾‘åè½¬æ¢æˆç‰©ç†åï¼Œæ£€æŸ¥å¯¹è®¾å¤‡æ“ä½œçš„æƒé™ï¼Œå°†I/Oè¯·æ±‚æ’é˜Ÿï¼Œé˜»å¡è¿›ç¨‹ä¸”ç­‰å¾…I/Oå®Œæˆï¼› å†…æ ¸å¯åŠ¨è®¾å¤‡é©±åŠ¨ç¨‹åºï¼Œåˆ†é…å­˜æ”¾è¯»å‡ºå—çš„ç¼“å†²åŒºï¼Œå‡†å¤‡æ¥æ”¶æ•°æ®ï¼Œä¸”å‘è®¾å¤‡æ§åˆ¶å¯„å­˜å™¨å‘å¯åŠ¨å‘½ä»¤ï¼Œæˆ–å»ºç«‹DMAä¼ è¾“ï¼Œå¯åŠ¨I/Oï¼› è®¾å¤‡æ§åˆ¶å™¨æ“ä½œè®¾å¤‡ï¼Œæ‰§è¡Œæ•°æ®ä¼ è¾“ï¼› DMAæ§åˆ¶å™¨æ§åˆ¶ä¸€å—ä¼ è¾“å®Œæˆï¼Œç¡¬ä»¶äº§ç”ŸI/Oç»“æŸä¸­æ–­ï¼› CPUå“åº”ä¸­æ–­ï¼Œè½¬å‘ç£ç›˜ä¸­æ–­å¤„ç†ç¨‹åºã€‚ å½“åº”ç”¨è¿›ç¨‹è¢«å†æ¬¡è°ƒåº¦æ‰§è¡Œæ—¶ï¼Œä»I/Oç³»ç»Ÿè°ƒç”¨çš„æ–­ç‚¹æ¢å¤æ‰§è¡Œã€‚ 3 ç¼“å†²æŠ€æœ¯ 3.1 ç¼“å†²æŠ€æœ¯æ¦‚å¿µç¼“å†²åŒºæ˜¯ä¸€ä¸ªå­˜å‚¨åŒºåŸŸï¼Œå¯ä»¥ç”±ä¸“é—¨çš„ç¡¬ä»¶å¯„å­˜å™¨ç»„æˆï¼Œä¹Ÿå¯åˆ©ç”¨å†…å­˜ä½œä¸ºç¼“å†²åŒºã€‚ ä½¿ç”¨ç¡¬ä»¶ä½œä¸ºç¼“å†²åŒºçš„æˆæœ¬è¾ƒé«˜ï¼Œå®¹é‡ä¹Ÿè¾ƒå°ï¼Œä¸€èˆ¬ä»…ç”¨åœ¨å¯¹é€Ÿåº¦è¦æ±‚éå¸¸é«˜çš„åœºåˆ(å¦‚å­˜å‚¨å™¨ç®¡ç†ä¸­æ‰€ç”¨çš„è”æƒ³å¯„å­˜å™¨ï¼Œç”±äºå¯¹é¡µè¡¨çš„è®¿é—®é¢‘ç‡æé«˜ï¼Œå› æ­¤ä½¿ç”¨é€Ÿåº¦å¾ˆå¿«çš„è”æƒ³å¯„å­˜å™¨æ¥å­˜æ”¾é¡µè¡¨é¡¹çš„å‰¯æœ¬) ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ›´å¤šçš„æ˜¯åˆ©ç”¨å†…å­˜ä½œä¸ºç¼“å†²åŒºï¼Œâ€œè®¾å¤‡ç‹¬ç«‹æ€§è½¯ä»¶â€çš„ç¼“å†²åŒºç®¡ç†å°±æ˜¯è¦ç»„ç»‡ç®¡ç†å¥½è¿™äº›ç¼“å†²åŒºã€‚ å¼•å…¥ç¼“å†²æŠ€æœ¯çš„ç›®çš„ï¼š æ”¹å–„ä¸­å¤®å¤„ç†å™¨ä¸å¤–å›´è®¾å¤‡ä¹‹é—´é€Ÿåº¦ä¸é…çš„çŸ›ç›¾ï¼Œ å‡å°‘å¯¹CPUçš„ä¸­æ–­é¢‘ç‡ï¼Œæ”¾å®½å¯¹CPUä¸­æ–­ç›¸åº”æ—¶é—´çš„é™åˆ¶ åè°ƒé€»è¾‘è®°å½•å¤§å°ä¸ç‰©ç†è®°å½•å¤§å°ä¸ä¸€è‡´ æé«˜CPUå’ŒI/Oè®¾å¤‡çš„å¹¶è¡Œæ€§ å®ç°ç¼“å†²æŠ€æœ¯çš„åŸºæœ¬æ€æƒ³ï¼š è¿›ç¨‹æ‰§è¡Œå†™æ“ä½œè¾“å‡ºæ•°æ®æ—¶ï¼Œå‘ç³»ç»Ÿç”³è¯·ä¸€ä¸ªç¼“å†²åŒºï¼Œè‹¥ä¸ºé¡ºåºå†™è¯·æ±‚ï¼Œåˆ™ä¸æ–­æŠŠæ•°æ®å¡«åˆ°ç¼“å†²åŒºï¼Œç›´åˆ°è¢«è£…æ»¡ã€‚æ­¤åï¼Œè¿›ç¨‹ç»§ç»­å®ƒçš„è®¡ç®—ï¼Œç³»ç»Ÿå°†ç¼“å†²åŒºå†…å®¹å†™åˆ°I/Oè®¾å¤‡ä¸Šã€‚ è¿›ç¨‹æ‰§è¡Œæ“ä½œè¾“å…¥æ•°æ®æ—¶ï¼Œå‘ç³»ç»Ÿç”³è¯·ä¸€ä¸ªç¼“å†²åŒºï¼Œç³»ç»Ÿå°†ä¸€ä¸ªç‰©ç†è®°å½•çš„å†…å®¹è¯»åˆ°ç¼“å†²åŒºï¼Œæ ¹æ®è¿›ç¨‹è¦æ±‚ï¼ŒæŠŠå½“å‰éœ€è¦çš„é€»è¾‘è®°å½•ä»ç¼“å†²åŒºä¸­é€‰å‡ºå¹¶ä¼ é€ç»™è¿›ç¨‹ã€‚ åœ¨è¾“å‡ºæ•°æ®æ—¶ï¼Œåªæœ‰åœ¨ç³»ç»Ÿè¿˜æ¥ä¸åŠè…¾ç©ºç¼“å†²è€Œè¿›ç¨‹åˆè¦å†™æ•°æ®æ—¶ï¼Œå®ƒæ‰éœ€è¦ç­‰å¾…ï¼› åœ¨è¾“å…¥æ•°æ®æ—¶ï¼Œä»…å½“ç¼“å†²åŒºç©ºè€Œè¿›ç¨‹åˆè¦ä»ä¸­è¯»å–æ•°æ®æ—¶ï¼Œå®ƒæ‰è¢«è¿«ç­‰å¾…ã€‚ 4 é©±åŠ¨è°ƒåº¦æŠ€æœ¯ 4.1 é©±åŠ¨è°ƒåº¦æŠ€æœ¯çš„æ¦‚å¿µé©±åŠ¨è°ƒåº¦èƒ½å‡å°‘ä¸ºè‹¥å¹²ä¸ªI/Oè¯·æ±‚æœåŠ¡æ‰€éœ€çš„æ€»æ—¶é—´ï¼Œæé«˜ç³»ç»Ÿæ•ˆç‡ã€é™¤äº†I/Oè¯·æ±‚çš„ä¼˜åŒ–æ’åºå¤–ï¼Œä¿¡æ¯åœ¨è¾…åŠ©å­˜å‚¨å™¨ä¸Šçš„æ’åˆ—æ–¹å¼ï¼Œå­˜å‚¨ç©ºé—´åˆ†é…æ–¹æ³•éƒ½èƒ½å½±å“å­˜å–è®¿é—®é€Ÿåº¦ã€‚ 4.2 å­˜å‚¨è®¾å¤‡çš„ç‰©ç†ç»“æ„é¡ºåºå­˜å–å­˜å‚¨è®¾å¤‡æ˜¯ä¸¥æ ¼ä¾èµ–ä¿¡æ¯çš„ç‰©ç†ä½ç½®è¿›è¡Œå®šä½å’Œè¯»å†™çš„å­˜å‚¨è®¾å¤‡ï¼Œå…·æœ‰å­˜å‚¨å®¹é‡å¤§ã€ç¨³å®šå¯é ã€å·å¯è£…å¸å’Œä¾¿äºä¿å­˜ç­‰ä¼˜ç‚¹ã€‚ ç£ç›˜æ˜¯ä¸€ç§ç›´æ¥(éšæœº)å­˜å–å­˜å‚¨è®¾å¤‡ã€‚æ¯ä¸ªç‰©ç†è®°å½•æœ‰ç¡®å®šçš„ä½ç½®å’Œå”¯ä¸€çš„åœ°å€ï¼Œå­˜å–ä»»ä½•ä¸€ä¸ªç‰©ç†å—æ‰€éœ€çš„æ—¶é—´å‡ ä¹ä¸ä¾èµ–äºæ­¤ä¿¡æ¯çš„ä½ç½®ã€‚ è®¿é—®ç£ç›˜è®°å½•å‚æ•°ï¼šç›˜é¢å·ã€ç£é“å·ã€æ‰‡åŒºå·ã€‚ 4.3 ç§»è‡‚è°ƒåº¦çš„ç®—æ³• â€œå…ˆæ¥å…ˆæœåŠ¡â€ ç®—æ³•ï¼šç£ç›˜è‡‚æ˜¯éšæœºç§»åŠ¨çš„ï¼ŒæŒ‰ç…§I/Oè¯·æ±‚çš„æ¬¡åºå¯»é“ï¼Œä¸è€ƒè™‘å„ I/O è¯·æ±‚é—´çš„ç›¸å¯¹æ¬¡åºå’Œç§»åŠ¨è‡‚å½“å‰æ‰€å¤„ä½ç½®ï¼Œè¿›ç¨‹ç­‰å¾… I/O è¯·æ±‚æ—¶é—´ä¼šå¾ˆé•¿ï¼Œå¯»é“æ€§èƒ½è¾ƒå·®ã€‚ â€œæœ€çŸ­æŸ¥æ‰¾æ—¶é—´ä¼˜å…ˆâ€ç®—æ³•ï¼šæ¯æ¬¡é€‰æ‹©ç¦»å½“å‰ç£å¤´æœ€è¿‘çš„ç£é“ï¼Œä¸FIFO ç®—æ³•ç›¸æ¯”æœ‰è¾ƒå¥½å¯»é“æ€§èƒ½ã€‚ â€œæ‰«æâ€ç®—æ³•ï¼šç£ç›˜è‡‚æ¯æ¬¡æ²¿ä¸€ä¸ªæ–¹å‘ç§»åŠ¨ï¼Œæ‰«è¿‡æ‰€æœ‰æŸ±é¢ï¼Œé‡åˆ°æœ€è¿‘çš„I/Oè¯·æ±‚ä¾¿è¿›è¡Œå¤„ç†ï¼Œç›´åˆ°æœ€åä¸€ä¸ªæŸ±é¢åï¼Œå†å‘ç›¸åæ–¹å‘ç§»åŠ¨å›æ¥ã€‚ â€œåˆ†æ­¥æ‰«æâ€ç®—æ³•ï¼šè¿›ç¨‹é‡å¤è¯·æ±‚è®¿é—®åŒä¸€æŸ±é¢ä¼šå„æ–­è®¾å¤‡ï¼Œé€ æˆâ€œç£è‡‚ç²˜æ€§â€ï¼Œå¯¼è‡´å…¶ä»–æŸ±é¢è®¿é—®è¯·æ±‚é•¿æ—¶é—´å¾—ä¸åˆ°æœåŠ¡ï¼Œé‡‡ç”¨â€œåˆ†æ­¥æ‰«æâ€ç®—æ³•å¯ä»¥é¿å…è¿™ç±»é—®é¢˜ã€‚å…·ä½“åšæ³•æ˜¯ï¼šå°† I/O è¯·æ±‚åˆ†ä¸ºé•¿åº¦ä¸ºNçš„å­é˜Ÿåˆ—ï¼ŒæŒ‰FIFOç®—æ³•ä¾æ¬¡å¤„ç†æ¯ä¸ªå­é˜Ÿåˆ—ï¼Œè€Œæ¯ä¸ªå­é˜Ÿåˆ—é‡‡ç”¨æ‰«æç®—æ³•ï¼Œå¤„ç†å®Œä¸€ä¸ªåå†æœåŠ¡ä¸‹ä¸€ä¸ªå­é˜Ÿåˆ—ï¼Œä»¥é¿å…å‡ºç°ç£è‡‚ç²˜ä½ç°è±¡ã€‚è¿™ç§è°ƒåº¦ç®—æ³•èƒ½ä¿è¯æ¯ä¸ªI/Oè¯·æ±‚çš„ç­‰å¾…æ—¶é—´ä¸è‡´å¤ªé•¿ï¼Œå½“ N å€¼å¾ˆå¤§æ—¶ï¼Œæ¥è¿‘äºâ€œæ‰«æâ€ç®—æ³•æ€§èƒ½ï¼›å½“Nï¼ï¼‘æ—¶ï¼Œæ¥è¿‘äº FIFOç®—æ³•æ€§èƒ½ã€‚ â€œç”µæ¢¯è°ƒåº¦â€ç®—æ³•ï¼šæ˜¯æ‰«æç®—æ³•çš„ä¸€ç§æ”¹è¿›ï¼Œæ— è®¿é—®è¯·æ±‚æ—¶ï¼Œç§»åŠ¨è‡‚åœæ­¢ä¸åŠ¨ï¼Œæœ‰è®¿é—®è¯·æ±‚æ—¶ï¼Œç§»åŠ¨è‡‚æŒ‰ç”µæ¢¯è§„å¾‹ç§»åŠ¨ã€‚ â€œå¾ªç¯æ‰«æâ€ç®—æ³•ï¼šä¸ºé€‚åº”æœ‰å¤§é‡æŸ±é¢å‡åŒ€åˆ†å¸ƒçš„å­˜å–è¯·æ±‚è¿›å…¥ç³»ç»Ÿè€Œè®¾è®¡çš„æ‰«ææ–¹å¼ã€‚ç§»åŠ¨è‡‚æ€»æ˜¯ä»ï¼æŸ±é¢è‡³æœ€å¤§å·æŸ±é¢é¡ºåºæ‰«æï¼Œç„¶åï¼Œç›´æ¥è¿”å›ï¼æŸ±é¢é‡å¤è¿›è¡Œï¼Œå½’é€”ä¸­ä¸å†æä¾›æœåŠ¡ï¼Œæ„æˆä¸€ä¸ªå¾ªç¯ï¼Œç¼©çŸ­å¤„ç†æ–°æ¥è¯·æ±‚çš„æœ€å¤§å»¶è¿Ÿã€‚ 5 è®¾å¤‡åˆ†é… 5.1 è®¾å¤‡ç‹¬ç«‹æ€§ç”¨æˆ·ä¸æŒ‡å®šç‰¹å®šè®¾å¤‡ï¼ŒæŒ‡å®šé€»è¾‘è®¾å¤‡ï¼Œä½¿å¾—ç”¨æˆ·ä½œä¸šå’Œç‰©ç†è®¾å¤‡ç‹¬ç«‹å¼€æ¥ï¼Œé€šè¿‡å…¶å®ƒé€”å¾„å»ºç«‹é€»è¾‘è®¾å¤‡å’Œç‰©ç†è®¾å¤‡ä¹‹é—´å¯¹åº”å…³ç³»ï¼Œè¿™ç§ç‰¹æ€§ä¸ºâ€œè®¾å¤‡ç‹¬ç«‹æ€§â€ã€‚ å¥½å¤„ï¼šç”¨æˆ·ä¸ç‰©ç†çš„å¤–å›´è®¾å¤‡æ— å…³ï¼Œç³»ç»Ÿå¢å‡æˆ–å˜æ›´å¤–å›´è®¾å¤‡æ—¶ç¨‹åºä¸å¿…ä¿®æ”¹ï¼›æ˜“äºå¯¹ä»˜è¾“å…¥è¾“å‡ºè®¾å¤‡çš„æ•…éšœã€‚ ä»è®¾å¤‡çš„ç‰¹æ€§æ¥çœ‹ï¼Œå¯ä»¥æŠŠè®¾å¤‡åˆ†æˆç‹¬å è®¾å¤‡ã€å…±äº«è®¾å¤‡å’Œè™šæ‹Ÿè®¾å¤‡ä¸‰ç±»ï¼Œç›¸åº”çš„ç®¡ç†å’Œåˆ†é…å¤–å›´è®¾å¤‡çš„æŠ€æœ¯å¯åˆ†æˆï¼šç‹¬å æ–¹å¼ã€å…±äº«æ–¹å¼å’Œè™šæ‹Ÿæ–¹å¼ã€‚ ä»è¿›ç¨‹è¿è¡Œçš„å®‰å…¨æ€§ä¸Šè€ƒè™‘ï¼Œè®¾å¤‡åˆ†é…æœ‰ä¸¤ç§æ–¹å¼: å®‰å…¨åˆ†é…æ–¹å¼:ä¸ºè¿›ç¨‹åˆ†é…ä¸€ä¸ªè®¾å¤‡åå°±å°†è¿›ç¨‹é˜»å¡ï¼Œæœ¬æ¬¡I/Oå®Œæˆåæ‰å°†è¿›ç¨‹å”¤é†’ã€‚ä¸€ä¸ªæ—¶æ®µå†…æ¯ä¸ªè¿›ç¨‹åªèƒ½ä½¿ç”¨ä¸€ä¸ªè®¾å¤‡ã€‚ ä¼˜ç‚¹:ç ´åäº†â€œè¯·æ±‚å’Œä¿æŒâ€æ¡ä»¶ï¼Œä¸ä¼šæ­»é”ç¼ºç‚¹:å¯¹äºä¸€ä¸ªè¿›ç¨‹æ¥è¯´ï¼ŒCPUå’ŒI/Oè®¾å¤‡åªèƒ½ä¸²è¡Œå·¥ä½œ ä¸å®‰å…¨åˆ†é…æ–¹å¼:è¿›ç¨‹å‘å‡ºI/Oè¯·æ±‚åï¼Œç³»ç»Ÿä¸ºå…¶åˆ†é…I/Oè®¾å¤‡ï¼Œè¿›ç¨‹å¯ç»§ç»­æ‰§è¡Œï¼Œä¹‹åè¿˜å¯ä»¥å‘å‡ºæ–°çš„I/Oè¯·æ±‚ã€‚åªæœ‰æŸä¸ªI/Oè¯·æ±‚å¾—ä¸åˆ°æ»¡è¶³æ—¶æ‰å°†è¿›ç¨‹é˜»å¡ã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ªè®¾å¤‡ã€‚ ä¼˜ç‚¹:è¿›ç¨‹çš„è®¡ç®—ä»»åŠ¡å’ŒI/Oä»»åŠ¡å¯ä»¥å¹¶è¡Œå¤„ç†ï¼Œä½¿è¿›ç¨‹è¿…é€Ÿæ¨è¿›ç¼ºç‚¹:æœ‰å¯èƒ½å‘ç”Ÿæ­»é”(éœ€è¦è€ƒè™‘æ­»é”é¿å…ã€æ­»é”çš„æ£€æµ‹å’Œè§£é™¤) 5.2 è®¾å¤‡åˆ†é…çš„æ•°æ®ç»“æ„è®¾å¤‡åˆ†é…çš„æ•°æ®ç»“æ„ï¼šè®¾å¤‡ç±»è¡¨å’Œè®¾å¤‡è¡¨ã€‚ ç³»ç»Ÿä¸­æ‹¥æœ‰ä¸€å¼ è®¾å¤‡ç±»è¡¨ï¼Œæ¯ç±»è®¾å¤‡å¯¹åº”äºè¡¨ä¸­ä¸€æ ï¼ŒåŒ…æ‹¬å†…å®¹æœ‰ï¼šè®¾å¤‡ç±»ã€æ€»å°æ•°ã€ç©ºé—²å°æ•°å’Œè®¾å¤‡è¡¨èµ·å§‹åœ°å€ç­‰ã€‚ æ¯ä¸€ç±»è®¾å¤‡éƒ½æœ‰å„è‡ªçš„è®¾å¤‡è¡¨ï¼Œç”¨æ¥ç™»è®°è¿™ç±»è®¾å¤‡ä¸­æ¯ä¸€å°è®¾å¤‡çš„çŠ¶æ€ï¼ŒåŒ…å«çš„å†…å®¹æœ‰ï¼šç‰©ç†è®¾å¤‡åã€é€»è¾‘è®¾å¤‡åã€å æœ‰è®¾å¤‡çš„è¿›ç¨‹å·ã€å·²åˆ†é…/æœªåˆ†é…ã€å¥½/åç­‰ã€‚ é‡‡ç”¨é€šé“ç»“æ„çš„ç³»ç»Ÿä¸­ï¼Œè®¾å¤‡åˆ†é…çš„æ•°æ®ç»“æ„è®¾ç½®ï¼šç³»ç»Ÿè®¾å¤‡è¡¨ã€é€šé“æ§åˆ¶è¡¨ã€æ§åˆ¶å™¨æ§åˆ¶è¡¨å’Œè®¾å¤‡æ§åˆ¶è¡¨ã€‚ å¸¸ç”¨çš„I/Oè®¾å¤‡åˆ†é…ç®—æ³•æœ‰å…ˆè¯·æ±‚å…ˆæœåŠ¡ï¼Œä¼˜å…ˆçº§é«˜è€…å…ˆæœåŠ¡ç­‰ã€‚æ­¤å¤–ï¼Œåœ¨å¤šè¿›ç¨‹è¯·æ±‚I/Oè®¾å¤‡åˆ†é…æ—¶ï¼Œåº”é˜²æ­¢å› å¾ªç¯ç­‰å¾…å¯¹æ–¹æ‰€å ç”¨çš„è®¾å¤‡è€Œäº§ç”Ÿæ­»é”ï¼Œåº”é¢„å…ˆè¿›è¡Œæ€§æ£€æŸ¥ã€‚ 6 è™šæ‹Ÿè®¾å¤‡","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://www.codetool.top/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"}]},{"title":"leetcode260-åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—III","slug":"leetcode260-åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—III","date":"2020-04-28T04:55:15.000Z","updated":"2020-04-28T06:24:45.972Z","comments":true,"path":"article/leetcode260-åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—III/","link":"","permalink":"https://www.codetool.top/article/leetcode260-%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E6%95%B0%E5%AD%97III/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼Œå…¶ä¸­æ°å¥½æœ‰ä¸¤ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ï¼Œå…¶ä½™æ‰€æœ‰å…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚ æ‰¾å‡ºåªå‡ºç°ä¸€æ¬¡çš„é‚£ä¸¤ä¸ªå…ƒç´ ã€‚ ç¤ºä¾‹ï¼š è¾“å…¥: [1,2,1,3,2,5]è¾“å‡º: [3,5] æ³¨æ„ï¼š ç»“æœè¾“å‡ºçš„é¡ºåºå¹¶ä¸é‡è¦ï¼Œå¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œ [5, 3] ä¹Ÿæ˜¯æ­£ç¡®ç­”æ¡ˆã€‚ ä½ çš„ç®—æ³•åº”è¯¥å…·æœ‰çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚ä½ èƒ½å¦ä»…ä½¿ç”¨å¸¸æ•°ç©ºé—´å¤æ‚åº¦æ¥å®ç°ï¼Ÿ 2 è§£æ³•2.1 æ€æƒ³å¦‚æœä¸é™åˆ¶å¸¸æ•°ç©ºé—´å¤æ‚åº¦ç”¨å“ˆå¸Œè¡¨è®¡æ•°å¯ä»¥å¾ˆå®¹æ˜“åšå‡ºæ¥ï¼Œä½†æ˜¯é™åˆ¶äº†ç©ºé—´å¤æ‚åº¦ï¼Œå¯ä»¥ç”¨ä½è¿ç®—ï¼š åªçœ‹é¢˜ç›®ï¼Œå’Œleetcode136-åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—å¾ˆç›¸ä¼¼ï¼Œå¯¹äºå”¯ä¸€ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¼‚æˆ–å°†å…¶æ‰¾å‡ºï¼Œè¿™é“é¢˜æœ‰ä¸¤ä¸ªåªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ï¼Œå¦‚æœå°†æ‰€æœ‰çš„æ•°å­—å¼‚æˆ–ï¼Œç»“æœå¹¶ä¸èƒ½æ˜¾ç¤ºæ˜¯å“ªä¸¤ä¸ªæ•°å­—åªå‡ºç°ä¸€æ¬¡ã€‚å¯ä»¥æƒ³åŠæ³•å°†è¿™äº›æ•°å­—åˆ†ä¸ºä¸¤ç»„ï¼Œå¹¶å°†ä¸¤ä¸ªä¸åŒçš„æ•°å­—åˆ†åˆ°ä¸åŒçš„ç»„ä¸­ï¼Œå†è¿›è¡ŒæŸ¥æ‰¾ã€‚ é‚£ä¹ˆå¦‚ä½•å°†ä¸¤ä¸ªä¸åŒçš„æ•°å­—åˆ†åˆ°ä¸¤ä¸ªä¸åŒçš„ç»„ä¸­å‘¢ï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ä¸€æ¬¡å°†å…¨éƒ¨æ•°å­—å¼‚æˆ–çš„ç»“æœï¼Œå¾—åˆ°çš„ç»“æœå…¶å®å°±æ˜¯è¿™ä¸¤ä¸ªæ•°å­—å¼‚æˆ–çš„ç»“æœã€‚å› ä¸ºè¿™ä¸¤ä¸ªæ•°å­—ä¸ä¸€æ ·ï¼Œå¾—åˆ°çš„å¼‚æˆ–ç»“æœä¹Ÿå¿…å®šæœ‰è‡³å°‘ä¸€ä½æ˜¯1ã€‚åªè¦å°†è¿™ä¸€ä½æ˜¯1çš„æ•°å­—åˆ†ä¸ºä¸€ç»„ï¼Œæ˜¯0çš„æ•°å­—åˆ†ä¸ºä¸€ç»„ï¼Œå°±èƒ½å°†æ‰€æœ‰æ•°å­—åˆ†ä¸ºä¸¤ç»„ï¼Œè€Œè¿™ä¸¤ç»„ä¸­åªæœ‰ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ï¼Œå¼‚æˆ–çš„ç»“æœå°±æ˜¯è¿™ä¸ªæ•°å­—ã€‚ 2.2 ä»£ç class Solution { public int[] singleNumbers(int[] nums) { int k = 0; for(int num: nums) { k ^= num; } int mask = 1; //æ‰¾åˆ°kä¸­æœ€é è¿‘ä½ä½çš„1 while((k &amp; mask) == 0) { mask &lt;&lt;= 1; } int a = 0; int b = 0; //ä½¿ç”¨æ©ç è¿›è¡Œä¸è¿ç®—ï¼Œç»“æœæ˜¯0åˆ†ä¸ºä¸€ç»„ï¼Œç»“æœæ˜¯1åˆ†ä¸ºä¸€ç»„ for(int num: nums) { if((num &amp; mask) == 0) { a ^= num; } else { b ^= num; } } return new int[]{a, b}; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"äºŒå‰æ ‘ä¸­åºéå†-æŠ˜çº¸é—®é¢˜","slug":"äºŒå‰æ ‘ä¸­åºéå†-æŠ˜çº¸é—®é¢˜","date":"2020-04-27T15:16:19.000Z","updated":"2020-04-27T15:28:58.172Z","comments":true,"path":"article/äºŒå‰æ ‘ä¸­åºéå†-æŠ˜çº¸é—®é¢˜/","link":"","permalink":"https://www.codetool.top/article/%E4%BA%8C%E5%8F%89%E6%A0%91%E4%B8%AD%E5%BA%8F%E9%81%8D%E5%8E%86-%E6%8A%98%E7%BA%B8%E9%97%AE%E9%A2%98/","excerpt":"","text":"1 åŸé¢˜ï¼ˆæ¥æºç‰›å®¢ç½‘ï¼‰è¯·æŠŠçº¸æ¡ç«–ç€æ”¾åœ¨æ¡Œâ¼¦ä¸Šï¼Œç„¶åä»çº¸æ¡çš„ä¸‹è¾¹å‘ä¸Šâ½…å¯¹æŠ˜ï¼Œå‹å‡ºæŠ˜ç—•åå†å±•å¼€ã€‚æ­¤æ—¶æœ‰1æ¡æŠ˜ç—•ï¼Œçªèµ·çš„â½…å‘æŒ‡å‘çº¸æ¡çš„èƒŒâ¾¯ï¼Œè¿™æ¡æŠ˜ç—•å«åšâ€œä¸‹â€æŠ˜ç—• ï¼›çªèµ·çš„â½…å‘æŒ‡å‘çº¸æ¡æ­£â¾¯çš„æŠ˜ç—•å«åšâ€œä¸Šâ€æŠ˜ç—•ã€‚å¦‚æœæ¯æ¬¡éƒ½ä»ä¸‹è¾¹å‘ä¸Šâ½… å¯¹æŠ˜ï¼Œå¯¹æŠ˜Næ¬¡ã€‚è¯·ä»ä¸Šåˆ°ä¸‹è®¡ç®—å‡ºæ‰€æœ‰æŠ˜ç—•çš„â½…å‘ã€‚ ç»™å®šæŠ˜çš„æ¬¡æ•°n,è¯·è¿”å›ä»ä¸Šåˆ°ä¸‹çš„æŠ˜ç—•çš„æ•°ç»„ï¼Œè‹¥ä¸ºä¸‹æŠ˜ç—•åˆ™å¯¹åº”å…ƒç´ ä¸ºâ€downâ€,è‹¥ä¸ºä¸ŠæŠ˜ç—•åˆ™ä¸ºâ€upâ€. ç¤ºä¾‹: è¾“å…¥: 1è¾“å‡º: [â€œdownâ€] 2 è§£æ³•2.1 æ€æƒ³æ¯ä¸€æ¬¡æŠ˜å ï¼Œä¼šåœ¨ç°æœ‰æŠ˜ç—•çš„ä¸Šæ–¹äº§ç”Ÿä¸€ä¸ªä¸‹çš„æŠ˜ç—•ï¼Œåœ¨æŠ˜ç—•çš„ä¸‹æ–¹äº§ç”Ÿä¸€ä¸ªä¸Šçš„æŠ˜ç—•ã€‚ï¼ˆå¯ä»¥åŠ¨æ‰‹å°è¯•ç†è§£ï¼‰ è¿™æ ·å°±ä¼šå½¢æˆä¸€ä¸ªäºŒå‰æ ‘ï¼š ä»çº¸çš„ä¸Šé¢åˆ°ä¸‹é¢æ‰“å°å°±æ˜¯äºŒå‰æ ‘çš„ RVL çš„éå†ï¼ˆå³æ ¹å·¦ï¼Œç‰¹æ®Šçš„ä¸­åºéå†ï¼‰ã€‚ 2.2 ä»£ç import java.util.*; public class FoldPaper { public String[] foldPaper(int n) { List&lt;String> result = new ArrayList&lt;>(); fold(1, n, \"down\", result); return result.toArray(new String[result.size()]); } private static void fold(int level, int n, String type, List&lt;String> result){ if (level &lt;= n) { fold(level + 1, n, \"down\", result); result.add(type); fold(level + 1, n, \"up\", result); } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode86-åˆ†éš”é“¾è¡¨","slug":"leetcode86-åˆ†éš”é“¾è¡¨","date":"2020-04-27T06:36:11.000Z","updated":"2020-04-27T06:39:10.625Z","comments":true,"path":"article/leetcode86-åˆ†éš”é“¾è¡¨/","link":"","permalink":"https://www.codetool.top/article/leetcode86-%E5%88%86%E9%9A%94%E9%93%BE%E8%A1%A8/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªé“¾è¡¨å’Œä¸€ä¸ªç‰¹å®šå€¼ xï¼Œå¯¹é“¾è¡¨è¿›è¡Œåˆ†éš”ï¼Œä½¿å¾—æ‰€æœ‰å°äº x çš„èŠ‚ç‚¹éƒ½åœ¨å¤§äºæˆ–ç­‰äº x çš„èŠ‚ç‚¹ä¹‹å‰ã€‚ ä½ åº”å½“ä¿ç•™ä¸¤ä¸ªåˆ†åŒºä¸­æ¯ä¸ªèŠ‚ç‚¹çš„åˆå§‹ç›¸å¯¹ä½ç½®ã€‚ ç¤ºä¾‹: è¾“å…¥: head = 1-&gt;4-&gt;3-&gt;2-&gt;5-&gt;2, x = 3è¾“å‡º: 1-&gt;2-&gt;2-&gt;4-&gt;3-&gt;5 2 è§£æ³•2.1 æ€æƒ³åŒæŒ‡é’ˆæ³•ï¼Œå› ä¸ºæŸäº›èŠ‚ç‚¹å¯èƒ½ç§°ä¸ºæ–°çš„å¤´èŠ‚ç‚¹ï¼Œéœ€è¦è®¾ç½®å“¨å…µèŠ‚ç‚¹ã€‚ 2.2 ä»£ç class Solution { public ListNode partition(ListNode head, int x) { ListNode before_head = new ListNode(0); ListNode before = before_head; ListNode after_head = new ListNode(0); ListNode after = after_head; while (head != null) { if (head.val &lt; x) { before.next = head; before = before.next; } else { after.next = head; after = after.next; } head = head.next; } after.next = null; before.next = after_head.next; return before_head.next; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ•°ç»„å…ƒç´ å·¦å³ä¸¤è¾¹æœ€è¿‘è¾ƒå°å…ƒç´ ","slug":"æ•°ç»„å…ƒç´ å·¦å³ä¸¤è¾¹æœ€è¿‘è¾ƒå°å…ƒç´ ","date":"2020-04-26T05:40:33.000Z","updated":"2020-04-26T06:19:06.373Z","comments":true,"path":"article/æ•°ç»„å…ƒç´ å·¦å³ä¸¤è¾¹æœ€è¿‘è¾ƒå°å…ƒç´ /","link":"","permalink":"https://www.codetool.top/article/%E6%95%B0%E7%BB%84%E5%85%83%E7%B4%A0%E5%B7%A6%E5%8F%B3%E4%B8%A4%E8%BE%B9%E6%9C%80%E8%BF%91%E8%BE%83%E5%B0%8F%E5%85%83%E7%B4%A0/","excerpt":"","text":"1 åŸé¢˜ï¼ˆæ¥æºç‰›å®¢ç½‘ï¼‰ç»™å®šä¸€ä¸ªä¸å«æœ‰é‡å¤å€¼çš„æ•°ç»„ arrï¼Œæ‰¾åˆ°æ¯ä¸€ä¸ª i ä½ç½®å·¦è¾¹å’Œå³è¾¹ç¦» i ä½ç½®æœ€è¿‘ä¸”å€¼æ¯” arr[i] å°çš„ä½ç½®ã€‚è¿”å›æ‰€æœ‰ä½ç½®ç›¸åº”çš„ä¿¡æ¯ã€‚ å®ä¾‹ï¼š è¾“å…¥: arr = {3,4,1,5,6,2,7}è¾“å‡º{&nbsp;&nbsp;{-1,&nbsp;2},&nbsp;&nbsp;{&nbsp;0,&nbsp;2},&nbsp;&nbsp;{-1,-1},&nbsp;&nbsp;{&nbsp;2,&nbsp;5},&nbsp;&nbsp;{&nbsp;3,&nbsp;5},&nbsp;&nbsp;{&nbsp;2,-1},&nbsp;&nbsp;{&nbsp;5,-1}} 2 è§£æ³•2.1 æ€æƒ³å•è°ƒæ ˆï¼Œæˆ–ä½¿ç”¨åŠ¨æ€è§„åˆ’çš„æ–¹å¼åšï¼Œéƒ½å¯ä»¥è¾¾åˆ°çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚ 2.2 ä»£ç åŠ¨æ€è§„åˆ’ï¼šï¼ˆå…¶å®ä¹Ÿæ˜¯å•è°ƒæ ˆçš„æ€æƒ³ï¼‰ class Solution { public int[][] getNearLessNoRepeat(int[] arr) { int[][] res = new int[arr.length][2]; //ä»å·¦åˆ°å³æ‰«æ for (int i = 0; i &lt; arr.length; i++) { if(i == 0){ res[i][0] = -1; continue; } int left = i-1; while(left!=-1 &amp;&amp; arr[left]>arr[i]) left = res[left][0]; if(left!=-1&amp;&amp;arr[left]&lt;arr[i]) res[i][0] = left; else res[i][0] = -1; } //ä»å³åˆ°å·¦æ‰«æ for (int i = arr.length-1; i >= 0; i--) { if(i == arr.length-1){ res[i][1] = -1; continue; } int right = i+1; while(right!=-1 &amp;&amp; arr[right]>arr[i]) right = res[right][1]; if(right!=-1&amp;&amp;arr[right]&lt;arr[i]) res[i][1] = right; else res[i][1] = -1; } return res; } } å•è°ƒæ ˆï¼š class Solution { public int[][] getNearLessNoRepeat(int[] arr) { int[][] res = new int[arr.length][2]; Stack&lt;Integer> stack = new Stack&lt;>(); for (int i = 0; i &lt; arr.length; i++) { // å¦‚æœå½“å‰éå†åˆ°çš„æ•°ç»„çš„å€¼å°ï¼Œéœ€è¦å¼¹å‡º while (!stack.isEmpty() &amp;&amp; arr[stack.peek()] > arr[i]) { int popIndex = stack.pop(); int leftLessIndex = stack.isEmpty() ? -1 : stack.peek(); res[popIndex][0] = leftLessIndex; res[popIndex][1] = i; } stack.push(i); } while (!stack.isEmpty()) { int popIndex = stack.pop(); int leftLessIndex = stack.isEmpty() ? -1 : stack.peek(); res[popIndex][0] = leftLessIndex; res[popIndex][1] = -1; } return res; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode124-äºŒå‰æ ‘ä¸­çš„æœ€å¤§è·¯å¾„å’Œ","slug":"leetcode124-äºŒå‰æ ‘ä¸­çš„æœ€å¤§è·¯å¾„å’Œ","date":"2020-04-26T05:03:04.000Z","updated":"2020-04-26T05:15:41.491Z","comments":true,"path":"article/leetcode124-äºŒå‰æ ‘ä¸­çš„æœ€å¤§è·¯å¾„å’Œ/","link":"","permalink":"https://www.codetool.top/article/leetcode124-%E4%BA%8C%E5%8F%89%E6%A0%91%E4%B8%AD%E7%9A%84%E6%9C%80%E5%A4%A7%E8%B7%AF%E5%BE%84%E5%92%8C/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªéç©ºäºŒå‰æ ‘ï¼Œè¿”å›å…¶æœ€å¤§è·¯å¾„å’Œã€‚ æœ¬é¢˜ä¸­ï¼Œè·¯å¾„è¢«å®šä¹‰ä¸ºä¸€æ¡ä»æ ‘ä¸­ä»»æ„èŠ‚ç‚¹å‡ºå‘ï¼Œè¾¾åˆ°ä»»æ„èŠ‚ç‚¹çš„åºåˆ—ã€‚è¯¥è·¯å¾„è‡³å°‘åŒ…å«ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸”ä¸ä¸€å®šç»è¿‡æ ¹èŠ‚ç‚¹ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: [1,2,3] 1 / \\ 2 3 è¾“å‡º: 6 ç¤ºä¾‹ 2: è¾“å…¥: [-10,9,20,null,null,15,7] &nbsp; -10 &nbsp; &nbsp;/ \\ &nbsp; 9 &nbsp;20 &nbsp; &nbsp; / &nbsp;\\ &nbsp; &nbsp;15 &nbsp; 7 è¾“å‡º: 42 2 è§£æ³•2.1 æ€æƒ³è®¾è®¡ä¸€ä¸ªå‡½æ•°max_gainï¼Œç”¨äºè¿”å›ä¸€ä¸ªèŠ‚ç‚¹ä¸å®ƒçš„å·¦å­æ ‘æˆ–å³å­æ ‘è¿æˆçš„æœ€é•¿è·¯å¾„ã€‚ ä½¿ç”¨ä¸€ä¸ªå…¨å±€å˜é‡è®°å½•é€’å½’å›æº¯è¿‡ç¨‹ä¸­å‡ºç°çš„æœ€å¤§è·¯å¾„é•¿ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªèŠ‚ç‚¹, å¦‚æœæœ€å¤§å’Œè·¯å¾„åŒ…å«è¯¥èŠ‚ç‚¹, é‚£ä¹ˆåªå¯èƒ½æ˜¯ä¸¤ç§æƒ…å†µ: å…¶å·¦å³å­æ ‘ä¸­æ‰€æ„æˆçš„å’Œè·¯å¾„å€¼è¾ƒå¤§çš„é‚£ä¸ªåŠ ä¸Šè¯¥èŠ‚ç‚¹çš„å€¼åå‘çˆ¶èŠ‚ç‚¹å›æº¯æ„æˆæœ€å¤§è·¯å¾„ï¼ˆå³é€’å½’å‡½æ•°è¿”å›çš„å€¼ï¼‰ å·¦å³å­æ ‘éƒ½åœ¨æœ€å¤§è·¯å¾„ä¸­, åŠ ä¸Šè¯¥èŠ‚ç‚¹çš„å€¼æ„æˆäº†æœ€ç»ˆçš„æœ€å¤§è·¯å¾„ï¼ˆåœ¨å‡½æ•°ä¸­ä¸ä¸Šé¢çš„æƒ…å†µäº§ç”Ÿçš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œæ›´æ–°æœ€å¤§å€¼ï¼‰ 2.2 ä»£ç class Solution { int max_sum = Integer.MIN_VALUE; public int max_gain(TreeNode node) { if (node == null) return 0; int left_gain = Math.max(max_gain(node.left), 0); int right_gain = Math.max(max_gain(node.right), 0); int price_newpath = node.val + left_gain + right_gain; max_sum = Math.max(max_sum, price_newpath); return node.val + Math.max(left_gain, right_gain); } public int maxPathSum(TreeNode root) { max_gain(root); return max_sum; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"net.ipv4.ip_local_port_rangeçš„å«ä¹‰","slug":"net-ipv4-ip-local-port-rangeçš„å«ä¹‰","date":"2020-04-25T15:55:45.000Z","updated":"2020-04-25T17:18:58.440Z","comments":true,"path":"article/net-ipv4-ip-local-port-rangeçš„å«ä¹‰/","link":"","permalink":"https://www.codetool.top/article/net-ipv4-ip-local-port-range%E7%9A%84%E5%90%AB%E4%B9%89/","excerpt":"","text":"åœ¨ã€Šæ·±å…¥åˆ†æJava WebæŠ€æœ¯å†…å¹•ã€‹ä¸€ä¹¦ä¸­çœ‹åˆ°ä¸‹é¢è¿™æ®µè¯ï¼š è¦èƒ½å¤Ÿå»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼Œå¿…é¡»çŸ¥é“å¯¹æ–¹çš„IPå’Œä¸€ä¸ªæœªè¢«ä½¿ç”¨çš„ç«¯å£å·ï¼Œç”±äº32ä½æ“ä½œç³»ç»Ÿçš„ç«¯å£å·é€šå¸¸ç”±ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œä¹Ÿå°±æ˜¯åªæœ‰216=65535ä¸ªï¼Œæ‰€ä»¥ä¸€å°ä¸»æœºèƒ½å¤ŸåŒæ—¶å»ºç«‹çš„è¿æ¥æ•°æ˜¯æœ‰é™çš„ï¼Œå½“ç„¶æ“ä½œç³»ç»Ÿè¿˜æœ‰ä¸€äº›ç«¯å£0~1024æ˜¯å—ä¿æŠ¤çš„ï¼Œå¦‚80ç«¯å£ã€22ç«¯å£ï¼Œè¿™äº›ç«¯å£éƒ½ä¸èƒ½è¢«éšæ„å ç”¨ã€‚ åœ¨Linuxä¸­å¯ä»¥é€šè¿‡æŸ¥çœ‹/proc/sys/net/ipv4/ip_local_port_rangeæ–‡ä»¶æ¥çŸ¥é“å½“å‰è¿™ä¸ªä¸»æœºå¯ä»¥ä½¿ç”¨çš„ç«¯å£èŒƒå›´ã€‚ çœ‹å®Œè¿™æ®µè¯æˆ‘å¯¹å‡ ä¸ªåœ°æ–¹éƒ½æœ‰ç‚¹è´¨ç–‘ï¼š 32ä½æ“ä½œç³»ç»Ÿçš„ç«¯å£å·é€šå¸¸ç”±ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œéš¾é“64ä½æœºå™¨çš„ç«¯å£å·è¿˜èƒ½è¶…è¿‡ä¸¤ä¸ªå­—èŠ‚ï¼Ÿå¤§äº65535çš„ç«¯å£ä»æ¥æ²¡è§è¿‡ã€‚åº”è¯¥æ˜¯å’Œåè®®è§„å®šçš„æœ‰å…³ç³»ï¼Œæˆ‘åœ¨è®¡ç½‘å¤ä¹ 05-ä¼ è¾“å±‚ä¸­å¯¹TCPå’ŒUDPçš„æŠ¥æ–‡æ ¼å¼éƒ½æœ‰æè¿°ï¼Œæ— è®ºæ˜¯TCPè¿˜æ˜¯UDPçš„æŠ¥æ–‡å¤´éƒ¨éƒ½æœ‰ä¸€ä¸ªä¸¤å­—èŠ‚çš„æºç«¯å£å·å’Œä¸¤å­—èŠ‚çš„ç›®çš„ç«¯å£å·ï¼Œè¿™åº”è¯¥æ˜¯TCP/IPåè®®å¯¹ç«¯å£å·é•¿åº¦åšå‡ºçš„è§„å®šã€‚ æ‰€ä»¥ä¸€å°ä¸»æœºèƒ½å¤ŸåŒæ—¶å»ºç«‹çš„è¿æ¥æ•°æ˜¯æœ‰é™çš„ï¼ŒåŸå› è®²çš„å¾ˆæ¨¡ç³Šï¼Œä»–æåˆ°å’Œç«¯å£çš„æ•°é‡æœ‰å…³ç³»ï¼Œä½†å®é™…ä¸Šæˆ‘ä»¬è¯´ä¸€ä¸ªsocketè¿æ¥æ˜¯ç”±ä¸€ä¸ªå››å…ƒç»„å”¯ä¸€æ ‡è¯†çš„ï¼Œå³ä¸¤ä¸ªsocketï¼ˆä¸¤å°ä¸»æœºçš„ipå’Œç«¯å£å·ï¼‰ï¼Œè¿™å››ä¸ªå±æ€§ä¸­ä»»ä½•ä¸€ä¸ªä¸ä¸€æ ·éƒ½å¯ä»¥æ˜¯çš„socketè¿æ¥ï¼Œè€Œå¦ä¸€å°ä¸»æœºæ˜¯ä¸ç¡®å®šçš„ï¼Œæ‰€ä»¥åº”è¯¥è¯´ä¸¤å°ä¸»æœºä¹‹é—´èƒ½å¤ŸåŒæ—¶å»ºç«‹çš„è¿æ¥æ•°æ˜¯æœ‰é™çš„ï¼Œè¿™é‡Œå¯èƒ½ä¸Šä¸‹æ–‡æ˜¯è¿™ä¸ªæ„æ€ï¼Œä½†æ²¡æœ‰è¡¨è¿°æ¸…æ¥šã€‚ æ“ä½œç³»ç»Ÿè¿˜æœ‰ä¸€äº›ç«¯å£0~1024æ˜¯å—ä¿æŠ¤çš„ï¼Œå¦‚80ç«¯å£ã€22ç«¯å£ï¼Œè¿™äº›ç«¯å£éƒ½ä¸èƒ½è¢«éšæ„å ç”¨å’Œåœ¨Linuxä¸­å¯ä»¥é€šè¿‡æŸ¥çœ‹/proc/sys/net/ipv4/ip_local_port_rangeæ–‡ä»¶æ¥çŸ¥é“å½“å‰è¿™ä¸ªä¸»æœºå¯ä»¥ä½¿ç”¨çš„ç«¯å£èŒƒå›´ã€‚ï¼Œæ˜¾ç„¶ä½œè€…å¯¹ç«¯å£å·çš„åˆ’åˆ†æ²¡æœ‰å¾ˆå¥½çš„ç†è§£ï¼Œåé¢è¿™å¥è¯ä¹Ÿæœ‰å¾ˆæ˜æ˜¾çš„é”™è¯¯ã€‚æˆ‘åœ¨è®¡ç½‘å¤ä¹ 05-ä¼ è¾“å±‚çš„ç¬¬ä¸€èŠ‚çš„æ€ç»´å¯¼å›¾ä¸­æœ‰æ€»ç»“ç«¯å£å·çš„åˆ†ç±»ï¼Œä½†å½“æ—¶æ²¡æœ‰è¯¦è°ˆï¼Œçœ‹åˆ°è¿™æ®µè¯ä¹‹åæŸ¥é˜…äº†ç›¸å…³èµ„æ–™ï¼Œè¿™é‡Œè¯¦ç»†ä»‹ç»ä¸€ä¸‹ã€‚ 1 ç«¯å£çš„åˆ†ç±»è®¡ç½‘å¤ä¹ 05-ä¼ è¾“å±‚è¿™ä¸€ç¯‡çš„æ€ç»´å¯¼å›¾ä¸­å…ˆæŠŠç«¯å£å·åˆ†ä¸ºäº†æœåŠ¡ç«¯ä½¿ç”¨çš„ç«¯å£ï¼ˆ0-49151ï¼‰å’Œå®¢æˆ·ç«¯ä½¿ç”¨çš„ç«¯å£ï¼ˆ49151-65535ï¼‰ã€‚å®é™…ä¸Šè¿™æ˜¯ä¸ä¸€å®šçš„ï¼Œæ²¡æœ‰å¼ºåˆ¶è¦æ±‚æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åªèƒ½ä½¿ç”¨è¿™ä¸ªç«¯å£èŒƒå›´ï¼Œè¿™åº”è¯¥æ˜¯tcp/ipåè®®çš„å»ºè®®ï¼Œå¹¶ä¸”å¾ˆæ˜æ˜¾è¿™ä¸ªå»ºè®®ä¹Ÿè¢«å¹¿æ³›é‡‡çº³ï¼Œè¿™ä¸æ„å‘³ç€æœåŠ¡å™¨å°±ä¸å¯ä»¥ä½¿ç”¨ï¼ˆ49151-65535ï¼‰ä¸­çš„ç«¯å£ä½œä¸ºé•¿æœŸæœåŠ¡ç«¯å£ã€‚ ä¸‹é¢ä»‹ç»çš„ç«¯å£åˆ†ç±»å¯¹åº”çš„èŒƒå›´æ˜¯ç”±IANAï¼ˆäº’è”ç½‘æ•°å­—åˆ†é…æœºæ„ï¼‰è§„å®šçš„ã€‚ 1.1 ç†ŸçŸ¥ç«¯å£ç†ŸçŸ¥ç«¯å£ï¼ˆWellKnown Portsï¼‰ï¼Œæ•°å€¼ä¸€èˆ¬ä¸º 0 ~ 1023ã€‚ 0ç«¯å£æ˜¯ä¿ç•™ç«¯å£ï¼Œåœ¨ç¼–ç¨‹APIä¸­ï¼ˆç‰¹åˆ«æ˜¯linux socketç¼–ç¨‹ï¼‰ä½œä¸ºè¯·æ±‚ç³»ç»Ÿåˆ†é…çš„ï¼ˆåŠ¨æ€ï¼‰ç«¯å£ã€‚ å¾ˆå¤šçŸ¥åçš„åº”ç”¨å±‚åè®®ä¼šé€‰æ‹©è¿™ä¸ªç«¯å£èŒƒå›´å†…çš„ç«¯å£å·ï¼Œä¾‹å¦‚HTTPæœåŠ¡é»˜è®¤çš„ç«¯å£å·æ˜¯80ï¼ŒHTTPSæ˜¯443ï¼ŒDNSæ˜¯53ã€FTPæ˜¯20ã€21ï¼ŒSSHæ˜¯22ç­‰ã€‚æ‰€ä»¥ä¸€èˆ¬ä¸æ¨èæ²¡æœ‰ç†ŸçŸ¥ç«¯å£å·çš„åº”ç”¨ç¨‹åºä½¿ç”¨è¿™éƒ¨åˆ†çš„ç«¯å£å·ï¼Œå¦åˆ™å¾ˆå®¹æ˜“å†²çªï¼Œä½†ä¸æ„å‘³ç€åªæœ‰è¿™äº›åº”ç”¨ç¨‹åºæ‰èƒ½ä½¿ç”¨è¿™éƒ¨åˆ†çš„ç«¯å£å·ï¼Œåªè¦ä¸å†²çªï¼Œå…¶ä»–æœåŠ¡ä¹Ÿèƒ½ä½¿ç”¨è¿™äº›ç«¯å£ï¼Œä½†æ˜¯linuxä¸­rootæƒé™ç”¨æˆ·çš„æ‰å¯ä»¥å¯ç”¨1~1023çš„æœåŠ¡ã€‚ 1.2 ç™»è®°ç«¯å£å·ç™»è®°ç«¯å£å·ï¼ˆRegistered Portsï¼‰ï¼Œæ•°å€¼ä¸º 1024 ~ 49151ï¼Œä¸ºæ²¡æœ‰ç†ŸçŸ¥ç«¯å£å·çš„åº”ç”¨ç¨‹åºä½¿ç”¨çš„ã€‚ 1.3 çŸ­æš‚ç«¯å£å·çŸ­æš‚ç«¯å£å·ï¼ˆEphemeral Portsï¼‰ï¼Œä¹Ÿè¢«ç§°ä¸ºåŠ¨æ€ç«¯å£ï¼ˆDynamic Portsï¼‰ï¼ŒIANAæ¨èä½¿ç”¨ 49152 ~ 65535ï¼Œç•™ç»™å®¢æˆ·è¿›ç¨‹é€‰æ‹©æš‚æ—¶ä½¿ç”¨ã€‚è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå®¢æˆ·ç«¯ä½¿ç”¨TCPã€UDPåè®®ä¸æœåŠ¡ç«¯è¿›è¡Œè¿æ¥æ—¶ï¼Œé€šå¸¸ä¼šä»è¿™ä¸ªç«¯å£èŒƒå›´å†…è¢«éšæœºåˆ†é…ä¸€ä¸ªæœªä½¿ç”¨çš„ç«¯å£ï¼Œä»è€Œä¸æœåŠ¡ç«¯å»ºç«‹socketè¿æ¥ã€‚è¿™ä¸ªåˆ†é…çš„ç«¯å£æ˜¯ä¸´æ—¶çš„ï¼Œä»…åœ¨é€šä¿¡ä¼šè¯æœŸé—´æœ‰æ•ˆï¼Œæ‰€ä»¥ç§°ä¸ºâ€œçŸ­æš‚ç«¯å£â€ï¼Œä¸æœåŠ¡å™¨ä¸Šé•¿æœŸæœåŠ¡çš„ç«¯å£åŒºåˆ†å¼€ã€‚ è™½ç„¶è¯´æ¨èæ˜¯å®¢æˆ·ç«¯ä½¿ç”¨çš„ï¼Œä½†å®é™…ä¸ŠæœåŠ¡å™¨ä¹Ÿèƒ½ä½¿ç”¨è¿™ä¸€éƒ¨åˆ†çš„ç«¯å£å·åšé•¿æœŸæœåŠ¡ã€‚ 49152 ~ 65535æ˜¯IANAæ¨èä½¿ç”¨çš„çŸ­æš‚ç«¯å£å·èŒƒå›´ï¼Œè€Œlinuxé»˜è®¤ä½¿ç”¨çš„çŸ­æš‚ç«¯å£å·èŒƒå›´å®é™…ä¸Šæ˜¯32768åˆ°60999ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä½¿ç”¨å‘½ä»¤cat /proc/sys/net/ipv4/ip_local_port_rangeæˆ–sysctl -a|grep ip_local_port_rangeçœ‹åˆ°çš„ä¸¤ä¸ªæ•°å­—ã€‚linuxä¸¥æ ¼éµå®ˆè¿™ä¸ªé…ç½®ï¼Œä½œä¸ºå®¢æˆ·ç«¯å»ºç«‹socketè¿æ¥æ—¶åªä¼šä»è¿™ä¸ªç«¯å£èŒƒå›´è·å–åŠ¨æ€åˆ†é…çš„ç«¯å£ã€‚ ä¸‹é¢è°ˆè°ˆå¦‚ä½•ä¿®æ”¹è¿™ä¸ªå€¼ï¼Œæ˜¾ç„¶ä¿®æ”¹è¿™ä¸ªå€¼èƒ½æ˜æ˜¾æé«˜linuxä½œä¸ºå®¢æˆ·ç«¯èƒ½å»ºç«‹çš„å¹¶å‘è¿æ¥æ•°ã€‚å› ä¸ºtcpå¸¸å¸¸å› ä¸ºtime_waitçŠ¶æ€å ç”¨å¤§é‡çŸ­æš‚ç«¯å£ï¼Œé€‚å½“æé«˜è¿™ä¸ªèŒƒå›´ä¹Ÿå¯ä»¥å‡å°‘ç«¯å£ä¸å¤Ÿç”¨çš„å½±å“ã€‚ linuxä¿®æ”¹æ–¹æ³•ï¼š vi /etc/sysctl.confä¿®æ”¹ net.ipv4.ip_local_port_range = 1024 65535ç„¶å sysctl -pç”Ÿæ•ˆ","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"ä¼˜åŒ–","slug":"ä¼˜åŒ–","permalink":"https://www.codetool.top/tags/%E4%BC%98%E5%8C%96/"},{"name":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","permalink":"https://www.codetool.top/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"}]},{"title":"leetcode13-ç½—é©¬æ•°å­—è½¬æ•´æ•°","slug":"leetcode13-ç½—é©¬æ•°å­—è½¬æ•´æ•°","date":"2020-04-25T03:47:19.000Z","updated":"2020-04-25T04:23:05.003Z","comments":true,"path":"article/leetcode13-ç½—é©¬æ•°å­—è½¬æ•´æ•°/","link":"","permalink":"https://www.codetool.top/article/leetcode13-%E7%BD%97%E9%A9%AC%E6%95%B0%E5%AD%97%E8%BD%AC%E6%95%B4%E6%95%B0/","excerpt":"","text":"1 åŸé¢˜ç½—é©¬æ•°å­—åŒ…å«ä»¥ä¸‹ä¸ƒç§å­—ç¬¦: Iï¼Œ Vï¼Œ Xï¼Œ Lï¼ŒCï¼ŒD å’Œ Mã€‚ å­—ç¬¦ æ•°å€¼ I 1 V 5 X 10 L 50 C 100 D 500 M 1000 ä¾‹å¦‚ï¼Œ ç½—é©¬æ•°å­— 2 å†™åš II ï¼Œå³ä¸ºä¸¤ä¸ªå¹¶åˆ—çš„ 1ã€‚12 å†™åš XII ï¼Œå³ä¸º X + II ã€‚ 27 å†™åš XXVII, å³ä¸º XX + V + II ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œç½—é©¬æ•°å­—ä¸­å°çš„æ•°å­—åœ¨å¤§çš„æ•°å­—çš„å³è¾¹ã€‚ä½†ä¹Ÿå­˜åœ¨ç‰¹ä¾‹ï¼Œä¾‹å¦‚ 4 ä¸å†™åš IIIIï¼Œè€Œæ˜¯ IVã€‚æ•°å­— 1 åœ¨æ•°å­— 5 çš„å·¦è¾¹ï¼Œæ‰€è¡¨ç¤ºçš„æ•°ç­‰äºå¤§æ•° 5 å‡å°æ•° 1 å¾—åˆ°çš„æ•°å€¼ 4 ã€‚åŒæ ·åœ°ï¼Œæ•°å­— 9 è¡¨ç¤ºä¸º IXã€‚è¿™ä¸ªç‰¹æ®Šçš„è§„åˆ™åªé€‚ç”¨äºä»¥ä¸‹å…­ç§æƒ…å†µï¼š I å¯ä»¥æ”¾åœ¨ V (5) å’Œ X (10) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 4 å’Œ 9ã€‚ X å¯ä»¥æ”¾åœ¨ L (50) å’Œ C (100) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 40 å’Œ 90ã€‚ C å¯ä»¥æ”¾åœ¨ D (500) å’Œ M (1000) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 400 å’Œ 900ã€‚ ç»™å®šä¸€ä¸ªç½—é©¬æ•°å­—ï¼Œå°†å…¶è½¬æ¢æˆæ•´æ•°ã€‚è¾“å…¥ç¡®ä¿åœ¨ 1 åˆ° 3999 çš„èŒƒå›´å†…ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š â€œIIIâ€è¾“å‡ºï¼š 3 ç¤ºä¾‹2: è¾“å…¥ï¼š â€œIVâ€è¾“å‡ºï¼š 4 ç¤ºä¾‹3: è¾“å…¥ï¼š â€œIXâ€è¾“å‡ºï¼š 9 ç¤ºä¾‹4: è¾“å…¥ï¼š â€œLVIIIâ€è¾“å‡ºï¼š 58è§£é‡Š: L = 50, V= 5, III = 3. ç¤ºä¾‹5: è¾“å…¥ï¼š â€œMCMXCIVâ€è¾“å‡ºï¼š 1994è§£é‡Š: M = 1000, CM = 900, XC = 90, IV = 4. 2 è§£æ³•2.1 æ€æƒ³å¯¹äºå­—ç¬¦ä¸²ä¸­ä»å·¦åˆ°å³æ¯ä¸ªå­—ç¬¦ï¼Œå¦‚æœå½“å‰å­—ç¬¦ä»£è¡¨çš„å€¼ä¸å°äºå…¶å³è¾¹ï¼Œå°±åŠ ä¸Šè¯¥å€¼ï¼›å¦åˆ™å°±å‡å»è¯¥å€¼ã€‚ 2.2 ä»£ç class Solution { public int romanToInt(String s) { char[] chars = s.toCharArray(); int ans = 0; for(int i = 0;i&lt;chars.length;i++){ if(i+1!=chars.length&amp;&amp;romanChartoNum(chars[i+1])>romanChartoNum(chars[i])){ ans += (romanChartoNum(chars[i+1])-romanChartoNum(chars[i])); i++; }else{ ans += romanChartoNum(chars[i]); } } return ans; } public int romanChartoNum(char i){ if(i == 'I') return 1; if(i == 'V') return 5; if(i == 'X') return 10; if(i == 'L') return 50; if(i == 'C') return 100; if(i == 'D') return 500; if(i == 'M') return 1000; return 0; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ“ä½œç³»ç»Ÿå¤ä¹ 04-å­˜å‚¨ç®¡ç†","slug":"æ“ä½œç³»ç»Ÿå¤ä¹ 04-å­˜å‚¨ç®¡ç†","date":"2020-04-24T13:58:15.000Z","updated":"2020-04-25T13:09:28.308Z","comments":true,"path":"article/æ“ä½œç³»ç»Ÿå¤ä¹ 04-å­˜å‚¨ç®¡ç†/","link":"","permalink":"https://www.codetool.top/article/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A004-%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/","excerpt":"","text":"1 ç›¸å…³æ¦‚å¿µ 1.1 ä»å†™ç¨‹åºåˆ°ç¨‹åºè¿è¡Œ ç¼–è¾‘æºä»£ç æ–‡ä»¶ ç¼–è¯‘ï¼šç”±æºä»£ç æ–‡ä»¶ç”Ÿæˆç›®æ ‡æ¨¡å—(é«˜çº§è¯­è¨€â€œç¿»è¯‘â€œä¸ºæœºå™¨è¯­è¨€) é“¾æ¥ï¼šç”±ç›®æ ‡æ¨¡å—ç”Ÿæˆè£…å…¥æ¨¡å—ï¼Œé“¾æ¥åå½¢æˆå®Œæ•´çš„é€»è¾‘åœ°å€ è£…å…¥ï¼šå°†è£…å…¥æ¨¡å—è£…å…¥å†…å­˜ï¼Œè£…å…¥åå½¢æˆç‰©ç†åœ°å€ ç¨‹åºç»è¿‡ç¼–è¯‘ã€é“¾æ¥åç”Ÿæˆçš„æŒ‡ä»¤ä¸­æŒ‡æ˜çš„æ˜¯é€»è¾‘åœ°å€ï¼ˆç›¸å¯¹åœ°å€ï¼‰ï¼Œå³ï¼šç›¸å¯¹äºè¿›ç¨‹çš„èµ·å§‹åœ°å€è€Œè¨€çš„åœ°å€ã€‚åœ¨è£…å…¥è¿è¡Œåï¼Œæ‰ä¼šå°†é€»è¾‘åœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ã€‚ 1.2 é“¾æ¥çš„ä¸‰ç§æ–¹å¼ é™æ€é“¾æ¥ï¼šåœ¨ç¨‹åºè¿è¡Œä¹‹å‰ï¼Œå…ˆå°†å„ç›®æ ‡æ¨¡å—åŠå®ƒä»¬æ‰€éœ€çš„åº“å‡½æ•°è¿æ¥æˆä¸€ä¸ªå®Œæ•´çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆè£…å…¥æ¨¡å—ï¼‰ï¼Œä¹‹åä¸å†æ‹†å¼€ã€‚ è£…å…¥æ—¶åŠ¨æ€é“¾æ¥ï¼šå°†å„ç›®æ ‡æ¨¡å—è£…å…¥å†…å­˜æ—¶ï¼Œè¾¹è£…å…¥è¾¹é“¾æ¥çš„é“¾æ¥æ–¹å¼ã€‚ è¿è¡Œæ—¶åŠ¨æ€é“¾æ¥ï¼šåœ¨ç¨‹åºæ‰§è¡Œä¸­éœ€è¦è¯¥ç›®æ ‡æ¨¡å—æ—¶ï¼Œæ‰å¯¹å®ƒè¿›è¡Œé“¾æ¥ã€‚å…¶ä¼˜ç‚¹æ˜¯ä¾¿äºä¿®æ”¹å’Œæ›´æ–°ï¼Œä¾¿äºå®ç°å¯¹ç›®æ ‡æ¨¡å—çš„å…±äº«ã€‚ 1.3 è£…å…¥ï¼ˆè£…è½½ï¼‰çš„ä¸‰ç§æ–¹å¼ ç»å¯¹è£…å…¥ï¼šåœ¨ç¼–è¯‘æ—¶ï¼Œå¦‚æœçŸ¥é“ç¨‹åºå°†æ”¾åˆ°å†…å­˜ä¸­çš„å“ªä¸ªä½ç½®ï¼Œç¼–è¯‘ç¨‹åºå°†äº§ç”Ÿç»å¯¹åœ°å€çš„ç›®æ ‡ä»£ç ã€‚è£…å…¥ç¨‹åºæŒ‰ç…§è£…å…¥æ¨¡å—ä¸­çš„åœ°å€ï¼Œå°†ç¨‹åºå’Œæ•°æ®è£…å…¥å†…å­˜ã€‚ç»å¯¹è£…å…¥åªé€‚ç”¨äºå•é“ç¨‹åºç¯å¢ƒã€‚ é™æ€é‡å®šä½ï¼šåˆç§°å¯é‡å®šä½è£…å…¥ã€‚ç¼–è¯‘ã€é“¾æ¥åçš„è£…å…¥æ¨¡å—çš„åœ°å€éƒ½æ˜¯ä»0å¼€å§‹çš„ï¼ŒæŒ‡ä»¤ä¸­ä½¿ç”¨çš„åœ°å€ã€æ•°æ®å­˜æ”¾çš„åœ°å€éƒ½æ˜¯ç›¸å¯¹äºèµ·å§‹åœ°å€è€Œè¨€çš„é€»è¾‘åœ°å€ã€‚å¯æ ¹æ®å†…å­˜çš„å½“å‰æƒ…å†µï¼Œå°†è£…å…¥æ¨¡å—è£…å…¥åˆ°å†…å­˜çš„é€‚å½“ä½ç½®ã€‚è£…å…¥æ—¶å¯¹åœ°å€è¿›è¡Œâ€œé‡å®šä½â€ï¼Œå°†é€»è¾‘åœ°å€å˜æ¢ä¸ºç‰©ç†åœ°å€ï¼ˆåœ°å€å˜æ¢æ˜¯åœ¨è£…å…¥æ—¶ä¸€æ¬¡å®Œæˆçš„ï¼‰ã€‚ é™æ€é‡å®šä½çš„ç‰¹ç‚¹æ˜¯åœ¨ä¸€ä¸ªä½œä¸šè£…å…¥å†…å­˜æ—¶ï¼Œå¿…é¡»åˆ†é…å…¶è¦æ±‚çš„å…¨éƒ¨å†…å­˜ç©ºé—´ï¼Œå¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œå°±ä¸èƒ½è£…å…¥è¯¥ä½œä¸šã€‚ä½œä¸šä¸€æ—¦è¿›å…¥å†…å­˜åï¼Œåœ¨è¿è¡ŒæœŸé—´å°±ä¸èƒ½å†ç§»åŠ¨ï¼Œä¹Ÿä¸èƒ½å†ç”³è¯·å†…å­˜ç©ºé—´ã€‚ åŠ¨æ€é‡å®šä½ï¼šåˆç§°åŠ¨æ€è¿è¡Œæ—¶è£…å…¥ã€‚ç¼–è¯‘ã€é“¾æ¥åçš„è£…å…¥æ¨¡å—çš„åœ°å€éƒ½æ˜¯ä»0å¼€å§‹çš„ã€‚è£…å…¥ç¨‹åºæŠŠè£…å…¥æ¨¡å—è£…å…¥å†…å­˜åï¼Œå¹¶ä¸ä¼šç«‹å³æŠŠé€»è¾‘åœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ï¼Œè€Œæ˜¯æŠŠåœ°å€è½¬æ¢æ¨è¿Ÿåˆ°ç¨‹åºçœŸæ­£è¦æ‰§è¡Œæ—¶æ‰è¿›è¡Œã€‚å› æ­¤è£…å…¥å†…å­˜åæ‰€æœ‰çš„åœ°å€ä¾ç„¶æ˜¯é€»è¾‘åœ°å€ã€‚è¿™ç§æ–¹å¼éœ€è¦ä¸€ä¸ªé‡å®šä½å¯„å­˜å™¨çš„æ”¯æŒã€‚é‡‡ç”¨åŠ¨æ€é‡å®šä½æ—¶å…è®¸ç¨‹åºåœ¨å†…å­˜ä¸­å‘ç”Ÿç§»åŠ¨ã€‚ å¯å°†ç¨‹åºåˆ†é…åˆ°ä¸è¿ç»­çš„å­˜å‚¨åŒºä¸­ï¼›åœ¨ç¨‹åºè¿è¡Œå‰åªéœ€è£…å…¥å®ƒçš„éƒ¨åˆ†ä»£ç å³å¯æŠ•å…¥è¿è¡Œï¼Œç„¶ååœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œæ ¹æ®éœ€è¦åŠ¨æ€ç”³è¯·åˆ†é…å†…å­˜ï¼›ä¾¿äºç¨‹åºæ®µçš„å…±äº«ï¼Œå¯ä»¥å‘ç”¨æˆ·æä¾›ä¸€ä¸ªæ¯”å­˜å‚¨ç©ºé—´å¤§å¾—å¤šçš„åœ°å€ç©ºé—´ã€‚ 2 å­˜å‚¨ç®¡ç†çš„åŠŸèƒ½ å®šä½(å­˜å‚¨åˆ†é…)ï¼šä¸ºå…·ä½“çš„ç¨‹åºå’Œæ•°æ®ç­‰åˆ†é…å­˜å‚¨å•å…ƒæˆ–å­˜å‚¨åŒºå·¥ä½œã€‚ åœ°å€æ˜ å°„ï¼šå°†é€»è¾‘åœ°å€è½¬æ¢ä¸ºç›¸åº”çš„ç‰©ç†åœ°å€ã€‚åœ°å€ç©ºé—´æ˜¯ç¨‹åºç”¨æ¥è®¿é—®ä¿¡æ¯æ‰€ç”¨åœ°å€å•å…ƒçš„é›†åˆã€‚ å­˜å‚¨å…±äº«ï¼šä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹å…±ç”¨å†…å­˜ä¸­ç›¸åŒåŒºåŸŸã€‚ç›®çš„ï¼šèŠ‚çœå†…å­˜ç©ºé—´ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡ã€å®ç°è¿›ç¨‹é€šä¿¡(æ•°æ®å…±äº«)ã€‚ å­˜å‚¨ä¿æŠ¤ï¼šå„é“ç¨‹åºåªèƒ½è®¿é—®è‡ªå·±çš„å†…å­˜åŒºè€Œä¸èƒ½äº’ç›¸å¹²æ‰°ï¼Œå¿…é¡»å¯¹å†…å­˜ä¸­çš„ç¨‹åºå’Œæ•°æ®è¿›è¡Œä¿æŠ¤ï¼Œä»¥å…å—åˆ°å…¶ä»–ç¨‹åºæœ‰æ„æˆ–æ— æ„çš„ç ´åã€‚å¯å¯¹è¿›ç¨‹æ‰§è¡Œæ—¶æ‰€äº§ç”Ÿçš„æ‰€æœ‰å†…å­˜è®¿é—®åœ°å€è¿›è¡Œæ£€æŸ¥ï¼Œç¡®ä¿è¿›ç¨‹ä»…è®¿é—®å®ƒè‡ªå·±çš„å†…å­˜åŒºï¼Œè¿™å°±æ˜¯åœ°å€è¶Šç•Œä¿æŠ¤ï¼Œè¶Šç•Œä¿æŠ¤ä¾èµ–äºç¡¬ä»¶è®¾æ–½ï¼Œå¸¸ç”¨çš„æœ‰ï¼šç•Œåœ°å€å¯„å­˜å™¨å’Œå­˜å‚¨é”®ã€‚ å­˜å‚¨æ‰©å……ï¼šç”¨æˆ·åœ¨ç¼–åˆ¶ç¨‹åºæ—¶ï¼Œä¸åº”è¯¥å—å†…å­˜å®¹é‡é™åˆ¶ï¼Œæ‰€ä»¥è¦é‡‡ç”¨ä¸€å®šæŠ€æœ¯æ¥â€œæ‰©å……â€å†…å­˜çš„å®¹é‡ï¼Œä½¿ç”¨æˆ·å¾—åˆ°æ¯”å®é™…å†…å­˜å®¹é‡å¤§çš„å¤šçš„å†…å­˜ç©ºé—´ã€‚ è¦†ç›–æŠ€æœ¯ï¼šå°†ç¨‹åºåˆ†ä¸ºå¤šä¸ªæ®µ(å¤šä¸ªæ¨¡å—)ã€‚å¸¸ç”¨çš„æ®µå¸¸é©»å†…å­˜ï¼Œä¸å¸¸ç”¨çš„æ®µåœ¨éœ€è¦æ—¶è°ƒå…¥å†…å­˜ã€‚å†…å­˜ä¸­åˆ†ä¸ºä¸€ä¸ªâ€œå›ºå®šåŒºâ€å’Œè‹¥å¹²ä¸ªâ€œè¦†ç›–åŒºâ€ã€‚éœ€è¦å¸¸é©»å†…å­˜çš„æ®µæ”¾åœ¨â€œå›ºå®šåŒºâ€ä¸­ï¼Œè°ƒå…¥åå°±ä¸å†è°ƒå‡º(é™¤éè¿è¡Œç»“æŸ)ã€‚è¿™ç§å®ç°æ–¹å¼éœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨å£°æ˜è¦†ç›–åŒºï¼Œä¸ä¾¿äºå®ç°ã€‚ äº¤æ¢æŠ€æœ¯ï¼šäº¤æ¢(å¯¹æ¢)æŠ€æœ¯çš„è®¾è®¡æ€æƒ³ï¼šå†…å­˜ç©ºé—´ç´§å¼ æ—¶ï¼Œç³»ç»Ÿå°†å†…å­˜ä¸­æŸäº›è¿›ç¨‹æš‚æ—¶æ¢å‡ºå¤–å­˜ï¼ŒæŠŠå¤–å­˜ä¸­æŸäº›å·²å…·å¤‡è¿è¡Œæ¡ä»¶çš„è¿›ç¨‹æ¢å…¥å†…å­˜(è¿›ç¨‹åœ¨å†…å­˜ä¸ç£ç›˜é—´åŠ¨æ€è°ƒåº¦)ï¼Œæ¢åˆ°å¤–å­˜ä¸­çš„è¿›ç¨‹å°±ç§°ä¸ºæŒ‚èµ·æ€ï¼Œå³ä½¿è¿›ç¨‹è¢«æ¢å‡ºå†…å­˜ï¼ŒPCBå¿…é¡»å¸¸é©»å†…å­˜ã€‚ è™šæ‹Ÿå­˜å‚¨æŠ€æœ¯ï¼šå…·ä½“å®ç°æ˜¯åœ¨ç¡¬ä»¶æ”¯æŒä¸‹ï¼Œè½¯ç¡¬ä»¶ç›¸äº’åä½œï¼Œå°†å†…å­˜å’Œå¤–å­˜ç»“åˆèµ·æ¥ç»Ÿä¸€ä½¿ç”¨ã€‚ å…·æœ‰å¯¹æ¢åŠŸèƒ½çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œé€šå¸¸æŠŠç£ç›˜ç©ºé—´åˆ†ä¸ºæ–‡ä»¶åŒºå’Œå¯¹æ¢åŒºä¸¤éƒ¨åˆ†ã€‚æ–‡ä»¶åŒºä¸»è¦ç”¨äºå­˜æ”¾æ–‡ä»¶ï¼Œä¸»è¦è¿½æ±‚å­˜å‚¨ç©ºé—´çš„åˆ©ç”¨ç‡ï¼Œå› æ­¤å¯¹æ–‡ä»¶åŒºç©ºé—´çš„ç®¡ç†é‡‡ç”¨ç¦»æ•£åˆ†é…æ–¹å¼ï¼›å¯¹æ¢åŒºç©ºé—´åªå ç£ç›˜ç©ºé—´çš„å°éƒ¨åˆ†ï¼Œè¢«æ¢å‡ºçš„è¿›ç¨‹æ•°æ®å°±å­˜æ”¾åœ¨å¯¹æ¢åŒºã€‚ç”±äºå¯¹æ¢çš„é€Ÿåº¦ç›´æ¥å½±å“åˆ°ç³»ç»Ÿçš„æ•´ä½“é€Ÿåº¦ï¼Œå› æ­¤å¯¹æ¢åŒºç©ºé—´çš„ç®¡ç†ä¸»è¦è¿½æ±‚æ¢å…¥æ¢å‡ºé€Ÿåº¦ï¼Œå› æ­¤é€šå¸¸å¯¹æ¢åŒºé‡‡ç”¨è¿ç»­åˆ†é…æ–¹å¼ã€‚æ€»ä¹‹ï¼Œå¯¹æ¢åŒºçš„I/Oé€Ÿåº¦æ¯”æ–‡ä»¶åŒºçš„æ›´å¿«ã€‚ 3 å®å­˜ç®¡ç† 3.1 è¿ç»­åˆ†é…ç®¡ç†æ–¹å¼ï¼ˆåˆ†åŒºï¼‰è¿ç»­åˆ†é…ï¼šæŒ‡ä¸ºç”¨æˆ·è¿›ç¨‹åˆ†é…çš„å¿…é¡»æ˜¯ä¸€ä¸ªè¿ç»­çš„å†…å­˜ç©ºé—´ã€‚ 3.1.1 å•ä¸€è¿ç»­åˆ†é…åœ¨å•ä¸€è¿ç»­åˆ†é…æ–¹å¼ä¸­ï¼Œå†…å­˜è¢«åˆ†ä¸ºç³»ç»ŸåŒºå’Œç”¨æˆ·åŒºã€‚ç³»ç»ŸåŒºé€šå¸¸ä½äºå†…å­˜çš„ä½åœ°å€éƒ¨åˆ†ï¼Œç”¨äºå­˜æ”¾æ“ä½œç³»ç»Ÿç›¸å…³æ•°æ®ï¼›ç”¨æˆ·åŒºç”¨äºå­˜æ”¾ç”¨æˆ·è¿›ç¨‹ç›¸å…³æ•°æ®ã€‚å†…å­˜ä¸­åªèƒ½æœ‰ä¸€é“ç”¨æˆ·ç¨‹åºï¼Œç”¨æˆ·ç¨‹åºç‹¬å æ•´ä¸ªç”¨æˆ·åŒºç©ºé—´ã€‚ ä¼˜ç‚¹ï¼š å®ç°ç®€å• æ— å¤–éƒ¨ç¢ç‰‡ å¯ä»¥é‡‡ç”¨è¦†ç›–æŠ€æœ¯æ‰©å……å†…å­˜ ä¸ä¸€å®šéœ€è¦é‡‡å–å†…å­˜ä¿æŠ¤ 3.1.2 å›ºå®šåˆ†åŒºåˆ†é…20ä¸–çºª60å¹´ä»£å‡ºç°äº†æ”¯æŒå¤šé“ç¨‹åºçš„ç³»ç»Ÿï¼Œä¸ºäº†èƒ½åœ¨å†…å­˜ä¸­è£…å…¥å¤šé“ç¨‹åºï¼Œä¸”è¿™äº›ç¨‹åºä¹‹é—´åˆä¸ä¼šç›¸äº’å¹²æ‰°ï¼Œäºæ˜¯å°†æ•´ä¸ªç”¨æˆ·ç©ºé—´åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå›ºå®šå¤§å°çš„åˆ†åŒºï¼Œåœ¨æ¯ä¸ªåˆ†åŒºä¸­åªè£…å…¥ä¸€é“ä½œä¸šï¼Œè¿™æ ·å°±å½¢æˆäº†æœ€æ—©çš„ã€æœ€ç®€å•çš„ä¸€ç§å¯è¿è¡Œå¤šé“ç¨‹åºçš„å†…å­˜ç®¡ç†æ–¹å¼ã€‚ å¯åˆ†ä¸ºå¤§å°ç›¸åŒçš„åˆ†åŒºå’Œå¤§å°ä¸åŒçš„åˆ†åŒºï¼Œä½†ä¾ç„¶ç¼ºä¹çµæ´»æ€§ã€‚ å›ºå®šåˆ†åŒºåˆ†é…ä¼šäº§ç”Ÿå†…éƒ¨ç¢ç‰‡ï¼š å†…éƒ¨ç¢ç‰‡ï¼Œåˆ†é…ç»™æŸè¿›ç¨‹çš„å†…å­˜åŒºåŸŸä¸­ï¼Œæœ‰äº›éƒ¨åˆ†æ²¡æœ‰ç”¨ä¸Šã€‚å¤–éƒ¨ç¢ç‰‡ï¼Œæ˜¯æŒ‡å†…å­˜ä¸­çš„æŸäº›ç©ºé—²åˆ†åŒºç”±äºå¤ªå°è€Œéš¾ä»¥åˆ©ç”¨ã€‚ æ“ä½œç³»ç»Ÿéœ€è¦å»ºç«‹ä¸€ä¸ªæ•°æ®ç»“æ„â€”â€”åˆ†åŒºè¯´æ˜è¡¨ï¼Œæ¥å®ç°å„ä¸ªåˆ†åŒºçš„åˆ†é…ä¸å›æ”¶ã€‚æ¯ä¸ªè¡¨é¡¹å¯¹åº”ä¸€ä¸ªåˆ†åŒºï¼Œé€šå¸¸æŒ‰åˆ†åŒºå¤§å°æ’åˆ—ã€‚æ¯ä¸ªè¡¨é¡¹åŒ…æ‹¬å¯¹åº”åˆ†åŒºçš„å¤§å°ã€èµ·å§‹åœ°å€ã€çŠ¶æ€(æ˜¯å¦å·²åˆ†é…) 3.1.3 åŠ¨æ€åˆ†åŒºåˆ†é…åŠ¨æ€åˆ†åŒºåˆ†é…åˆç§°ä¸ºå¯å˜åˆ†åŒºåˆ†é…ã€‚è¿™ç§åˆ†é…æ–¹å¼ä¸ä¼šé¢„å…ˆåˆ’åˆ†å†…å­˜åˆ†åŒºï¼Œè€Œæ˜¯åœ¨è¿›ç¨‹è£…å…¥å†…å­˜æ—¶ï¼Œæ ¹æ®è¿›ç¨‹çš„å¤§å°åŠ¨æ€åœ°å»ºç«‹åˆ†åŒºï¼Œå¹¶ä½¿åˆ†åŒºçš„å¤§å°æ­£å¥½é€‚åˆè¿›ç¨‹çš„éœ€è¦ã€‚å› æ­¤ç³»ç»Ÿåˆ†åŒºçš„å¤§å°å’Œæ•°ç›®æ˜¯å¯å˜çš„ã€‚ åˆ†é…ä¸å›æ”¶æ–¹æ¡ˆï¼š å½“ä½œä¸šè£…å…¥å†…å­˜æ—¶ï¼š è‹¥æœ‰è¶³å¤Ÿç©ºé—´ï¼Œåˆ†å‰²ä¸€ä¸ªåˆ†åŒºç»™è¯¥ä½œä¸šï¼ˆå…·ä½“é€‰æ‹©ç­–ç•¥ç”±åˆ†é…ç®—æ³•å†³å®šï¼‰ è‹¥æ²¡æœ‰è¶³å¤Ÿç©ºé—´ï¼Œç­‰å¾…å†…å­˜èµ„æº ç©ºé—´å›æ”¶ï¼šè‹¥ä¸¤ç«¯æœ‰ç©ºé—²åŒºï¼Œå’Œç©ºé—²åŒºåˆå¹¶ åŠ¨æ€åˆ†åŒºä¼šäº§ç”Ÿå¤–éƒ¨ç¢ç‰‡ï¼š åŠ¨æ€åˆ†åŒºåˆ†é…ç®—æ³•ï¼š é¦–æ¬¡é€‚åº”ç®—æ³•ï¼šæ¯æ¬¡éƒ½ä»ä½åœ°å€å¼€å§‹æŸ¥æ‰¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªèƒ½æ»¡è¶³å¤§å°çš„ç©ºé—²åˆ†åŒºã€‚ä¼šå‡ºç°ä½åœ°å€ç©ºé—²åŒºç”¨å¾—è¾ƒé¢‘ç¹çš„æƒ…å†µï¼Œå†…å­˜å„åŒºåŸŸä½¿ç”¨é¢‘ç‡ä¸å‡ã€‚ä½†ä¼˜ç‚¹æ˜¯é€šå¸¸èƒ½ä¿ç•™é«˜åœ°å€åŒºåŸŸçš„è¾ƒå¤§åˆ†åŒºï¼Œæ›´ä¸å®¹æ˜“äº§ç”Ÿå¤–éƒ¨ç¢ç‰‡ã€‚ ä¸ºäº†è§£å†³é¦–æ¬¡é€‚åº”ç®—æ³•çš„ç¼ºç‚¹ï¼Œå¯ä»¥ä½¿ç”¨æ”¹è¿›åçš„â€œä¸‹æ¬¡é€‚åº”ç®—æ³•â€ï¼Œå®ƒä¼šæ¥ç€ä¸Šä¸€æ¬¡æ‰«æåˆ°çš„ä½ç½®ç»§ç»­å¾€ä¸‹æ‰«æï¼Œä¸ä¼šå¯¼è‡´å„åŒºåŸŸä½¿ç”¨é¢‘ç‡ä¸å‡ã€‚ æœ€ä½³é€‚åº”ç®—æ³•ï¼šç”±äºåŠ¨æ€åˆ†åŒºåˆ†é…æ˜¯ä¸€ç§è¿ç»­åˆ†é…æ–¹å¼ï¼Œä¸ºå„è¿›ç¨‹åˆ†é…çš„ç©ºé—´å¿…é¡»æ˜¯è¿ç»­çš„ä¸€æ•´ç‰‡åŒºåŸŸã€‚å› æ­¤ä¸ºäº†ä¿è¯å½“â€œå¤§è¿›ç¨‹â€åˆ°æ¥æ—¶èƒ½æœ‰è¿ç»­çš„å¤§ç‰‡ç©ºé—´ï¼Œå¯ä»¥å°½å¯èƒ½å¤šåœ°ç•™ä¸‹å¤§ç‰‡çš„ç©ºé—²åŒºï¼Œå³ï¼Œä¼˜å…ˆä½¿ç”¨æ›´å°çš„ç©ºé—²åŒºã€‚ç¼ºç‚¹ï¼šä¼šäº§ç”Ÿè¾ƒå¤šå¤–éƒ¨ç¢ç‰‡ã€‚ æœ€åé€‚åº”ç®—æ³•ï¼šä¸ºäº†è§£å†³æœ€ä½³é€‚åº”ç®—æ³•çš„é—®é¢˜â€”â€”å³ç•™ä¸‹å¤ªå¤šéš¾ä»¥åˆ©ç”¨çš„å°ç¢ç‰‡ï¼Œå¯ä»¥åœ¨æ¯æ¬¡åˆ†é…æ—¶ä¼˜å…ˆä½¿ç”¨æœ€å¤§çš„è¿ç»­ç©ºé—²åŒºï¼Œè¿™æ ·åˆ†é…åå‰©ä½™çš„ç©ºé—²åŒºå°±ä¸ä¼šå¤ªå°ï¼Œæ›´æ–¹ä¾¿ä½¿ç”¨ã€‚ç¼ºç‚¹ï¼šæ¯æ¬¡éƒ½é€‰æœ€å¤§çš„åˆ†åŒºè¿›è¡Œåˆ†é…ï¼Œè™½ç„¶å¯ä»¥è®©åˆ†é…åç•™ä¸‹çš„ç©ºé—²åŒºæ›´å¤§ï¼Œæ›´å¯ç”¨ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼ä¼šå¯¼è‡´è¾ƒå¤§çš„è¿ç»­ç©ºé—²åŒºè¢«è¿…é€Ÿç”¨å®Œã€‚å¦‚æœä¹‹åæœ‰â€œå¤§è¿›ç¨‹â€åˆ°è¾¾ï¼Œå°±æ²¡æœ‰å†…å­˜åˆ†åŒºå¯ç”¨äº†ã€‚ 3.2 éè¿ç»­åˆ†é…ç®¡ç†æ–¹å¼ï¼ˆåˆ†é¡µï¼‰ç¨‹åºå­˜æ”¾åˆ°è‹¥ä¸ç›¸é‚»çš„ç©ºé—´å—ä¸­ã€‚ å°†å†…å­˜ç©ºé—´åˆ†ä¸ºä¸€ä¸ªä¸ªå¤§å°ç›¸ç­‰çš„åˆ†åŒº(æ¯”å¦‚ï¼šæ¯ä¸ªåˆ†åŒº4KB)ï¼Œæ¯ä¸ªåˆ†åŒºå°±æ˜¯ä¸€ä¸ªâ€œé¡µæ¡†â€ï¼Œæˆ–ç§°â€œé¡µå¸§â€ã€â€œå†…å­˜å—â€ã€â€œç‰©ç†å—â€ã€‚æ¯ä¸ªé¡µæ¡†æœ‰ä¸€ä¸ªç¼–å·ï¼Œå³â€œé¡µæ¡†å·â€(æˆ–è€…â€œå†…å­˜å—å·â€ã€â€œé¡µå¸§å·â€ã€â€œç‰©ç†å—å·â€)ã€‚é¡µæ¡†å·ä»0å¼€å§‹ã€‚ å°†ç”¨æˆ·è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¹Ÿåˆ†ä¸ºä¸é¡µæ¡†å¤§å°ç›¸ç­‰çš„ä¸€ä¸ªä¸ªåŒºåŸŸï¼Œç§°ä¸ºâ€œé¡µâ€æˆ–â€œé¡µé¢â€ã€‚æ¯ä¸ªé¡µé¢ä¹Ÿæœ‰ä¸€ä¸ªç¼–å·ï¼Œå³â€œé¡µå·â€ï¼Œé¡µå·ä¹Ÿæ˜¯ä»0å¼€å§‹ã€‚ é€»è¾‘åœ°å€ç”±é¡µå·ï¼ˆé€»è¾‘åœ°å€/é¡µçš„å¤§å°ï¼‰å’Œé¡µå†…åç§»ï¼ˆé€»è¾‘åœ°å€%é¡µçš„å¤§å°ï¼‰æ„æˆï¼Œç‰©ç†åœ°å€=é¡µå·å¯¹åº”çš„é¡µæ¡†å·Ã—å—é•¿+é¡µå†…åœ°å€ã€‚ä¸ºäº†æ–¹ä¾¿è®¡ç®—é¡µå·ã€é¡µå†…åç§»é‡ï¼Œé¡µé¢å¤§å°ä¸€èˆ¬è®¾ä¸º2çš„æ•´æ•°å¹‚ é‚£ä¹ˆå¦‚ä½•çŸ¥é“é¡µå·å¯¹åº”çš„é¡µæ¡†å·ï¼Ÿä¸ºäº†èƒ½çŸ¥é“è¿›ç¨‹çš„æ¯ä¸ªé¡µé¢åœ¨å†…å­˜ä¸­å­˜æ”¾çš„ä½ç½®ï¼Œæ“ä½œç³»ç»Ÿè¦ä¸ºæ¯ä¸ªè¿›ç¨‹å»ºç«‹ä¸€å¼ é¡µè¡¨ã€‚ è¿›ç¨‹çš„é¡µè¡¨åœ¨è¿›ç¨‹è¿è¡Œçš„æ—¶å€™ä¹Ÿä¼šè¢«è£…è½½åˆ°é¡µæ¡†ä¸­ã€‚ è¿›ç¨‹çš„æ¯ä¸€é¡µå¯¹åº”ä¸€ä¸ªé¡µè¡¨é¡¹ æ¯ä¸ªé¡µè¡¨é¡¹ç”±â€œé¡µå·â€å’Œâ€œå—å·â€ï¼ˆé¡µæ¡†å·ï¼‰ç»„æˆ é¡µè¡¨è®°å½•è¿›ç¨‹é¡µé¢å’Œå®é™…å­˜æ”¾çš„å†…å­˜å—ä¹‹é—´çš„å¯¹åº”å…³ç³» 3.2.1 åŸºæœ¬åœ°å€å˜æ¢æœºæ„åŸºæœ¬åœ°å€å˜æ¢æœºæ„å¯ä»¥å€ŸåŠ©è¿›ç¨‹çš„é¡µè¡¨å°†é€»è¾‘åœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ã€‚ é€šå¸¸ä¼šåœ¨ç³»ç»Ÿä¸­è®¾ç½®ä¸€ä¸ªé¡µè¡¨å¯„å­˜å™¨(PTR)ï¼Œå­˜æ”¾é¡µè¡¨åœ¨å†…å­˜ä¸­çš„èµ·å§‹åœ°å€Få’Œé¡µè¡¨é•¿åº¦Mã€‚ è¿›ç¨‹æœªæ‰§è¡Œæ—¶ï¼Œé¡µè¡¨çš„å§‹å€å’Œé¡µè¡¨é•¿åº¦æ”¾åœ¨è¿›ç¨‹æ§åˆ¶å—(PCB) ä¸­ï¼Œå½“è¿›ç¨‹è¢«è°ƒåº¦æ—¶ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸ä¼šæŠŠå®ƒä»¬æ”¾åˆ°é¡µè¡¨å¯„å­˜å™¨ä¸­ã€‚ åœ°å€å˜æ¢è¿‡ç¨‹ï¼š æ ¹æ®é€»è¾‘åœ°å€è®¡ç®—å‡ºé¡µå·ã€é¡µå†…åç§»é‡ åˆ¤æ–­é¡µå·æ˜¯å¦è¶Šç•Œï¼Œå¦‚æœè¶Šç•Œä¼šè§¦å‘è¶Šç•Œä¸­æ–­ï¼ˆå¦‚æœé¡µå·å¤§äºæˆ–ç­‰äºé¡µè¡¨é•¿åº¦ï¼‰ æŸ¥è¯¢é¡µè¡¨ï¼Œæ‰¾åˆ°é¡µå·å¯¹åº”çš„é¡µè¡¨é¡¹ï¼Œç¡®å®šé¡µé¢å­˜æ”¾çš„å†…å­˜å—å· ç”¨å†…å­˜å—å·å’Œé¡µå†…åç§»é‡å¾—åˆ°ç‰©ç†åœ°å€ ç”±äºé¡µè¡¨ä¸­çš„é¡µè¡¨é¡¹éƒ½æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œè€Œé¡µè¡¨é¡¹çš„å¤§å°æ˜¯ç›¸ç­‰çš„ï¼Œå› æ­¤é¡µå·å¯ä»¥éšå«ï¼ˆä»0å¼€å§‹çš„è¿ç»­è®¡æ•°ï¼‰ï¼Œåªå­˜å‚¨å—å·ã€‚ 3.2.2 ç¿»è¯‘å¿«è¡¨ç”±ä¸Šè¿°å†…å®¹æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œè®¿é—®è¿›ç¨‹ä¸­çš„ä¸€ä¸ªé€»è¾‘åœ°å€éœ€è¦ç»è¿‡ä¸¤æ¬¡è®¿å­˜ï¼ˆç¬¬ä¸€æ¬¡æŸ¥è¯¢é¡µè¡¨ï¼Œç¬¬äºŒæ¬¡æ‰æ˜¯çœŸæ­£çš„è®¿é—®é€»è¾‘åœ°å€å¯¹åº”çš„ç‰©ç†åœ°å€ï¼‰ï¼Œé‚£æœ‰æ²¡æœ‰åŠæ³•å‡å°‘è®¿å­˜æ¬¡æ•°å‘¢ï¼Ÿ å¿«è¡¨ï¼ˆTLBï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„é«˜é€Ÿç¼“å†²å­˜å‚¨å™¨ï¼ˆCacheï¼‰ï¼Œå†…å®¹æ˜¯é¡µè¡¨ä¸­çš„ä¸€éƒ¨åˆ†æˆ–å…¨éƒ¨å†…å®¹ã€‚åœ¨æ“ä½œç³»ç»Ÿä¸­å¼•å…¥å¿«è¡¨æ˜¯ä¸ºäº†åŠ å¿«åœ°å€æ˜ å°„é€Ÿåº¦ã€‚ åœ°å€å˜æ¢è¿‡ç¨‹ï¼š æ ¹æ®é€»è¾‘åœ°å€è®¡ç®—å‡ºé¡µå·ã€é¡µå†…åç§»é‡ åˆ¤æ–­é¡µå·æ˜¯å¦è¶Šç•Œï¼Œå¦‚æœè¶Šç•Œä¼šè§¦å‘è¶Šç•Œä¸­æ–­ï¼ˆå¦‚æœé¡µå·å¤§äºæˆ–ç­‰äºé¡µè¡¨é•¿åº¦ï¼‰ æŸ¥è¯¢å¿«è¡¨ è‹¥å¿«è¡¨ä¸­æ²¡æœ‰ç›®æ ‡é¡µè¡¨é¡¹ï¼Œåˆ™éœ€è¦æŸ¥è¯¢å†…å­˜ä¸­çš„é¡µè¡¨ï¼Œå¹¶å°†æŸ¥è¯¢åˆ°çš„é¡µè¡¨é¡¹æ”¾å…¥å¿«è¡¨ è‹¥æŸ¥è¯¢å¿«è¡¨å‘½ä¸­ï¼Œå°±è·å–äº†é¡µå·å¯¹åº”çš„é¡µè¡¨é¡¹ ç”¨å†…å­˜å—å·å’Œé¡µå†…åç§»é‡å¾—åˆ°ç‰©ç†åœ°å€ å› æ­¤ï¼Œå¦‚æœæŸ¥è¯¢å¿«è¡¨å‘½ä¸­ï¼Œåˆ™è®¿é—®æŸä¸ªé€»è¾‘åœ°å€ä»…éœ€ä¸€æ¬¡è®¿å­˜å³å¯ã€‚æœ‰çš„ç³»ç»Ÿè¿˜æ”¯æŒå¿«è¡¨å’Œæ…¢è¡¨ï¼ˆå¯¹åº”å†…å­˜ä¸­çš„é¡µè¡¨ï¼‰åŒæ—¶æŸ¥æ‰¾ï¼Œå‡å°‘å¹³å‡è€—æ—¶ã€‚ 3.2.3 å¤šçº§é¡µè¡¨å¦‚æœç¨‹åºä½¿ç”¨ç©ºé—´å¾ˆå¤§ï¼Œå®ƒçš„é¡µè¡¨ä¹Ÿä¼šå¾ˆå¤§ï¼Œéœ€è¦å ç”¨å¾ˆå¤šä¸ªè¿ç»­çš„é¡µæ¡†ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç´¢å¼•çš„æ€æƒ³ï¼Œä¸ºé¡µè¡¨ä¹Ÿå»ºç«‹ç´¢å¼•ï¼Œä½¿å…¶å¯ä»¥ç¦»æ•£å­˜å‚¨äºå†…å­˜çš„å„ä¸ªé¡µæ¡†ä¸­ï¼Œç§°ä¸ºå¤šçº§é¡µè¡¨ã€‚ ç³»ç»Ÿä¸ºæ¯ä¸ªè¿›ç¨‹å»ºä¸€å¼ é¡µç›®å½•è¡¨ï¼Œå®ƒçš„æ¯ä¸ªè¡¨é¡¹å¯¹åº”ä¸€ä¸ªé¡µè¡¨é¡µï¼Œè€Œé¡µè¡¨é¡µçš„æ¯ä¸ªè¡¨é¡¹ç»™å‡ºäº†é¡µé¢å’Œé¡µæ¡†çš„å¯¹åº”å…³ç³»ï¼Œé¡µç›®å½•è¡¨æ˜¯ä¸€çº§é¡µè¡¨ï¼Œé¡µè¡¨é¡µæ˜¯äºŒçº§é¡µè¡¨ã€‚ ä½¿ç”¨äºŒçº§é¡µè¡¨åçš„é€»è¾‘åœ°å€ç»“æ„ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šä¸€çº§é¡µå·ã€äºŒçº§é¡µå·å’Œé¡µå†…åç§» æ³¨æ„ï¼šå„çº§é¡µè¡¨çš„å¤§å°ä¸èƒ½è¶…è¿‡ä¸€ä¸ªé¡µé¢ã€‚ 3.3 åŸºæœ¬åˆ†æ®µå­˜å‚¨ç®¡ç†ä¸â€œåˆ†é¡µâ€æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ç¦»æ•£åˆ†é…æ—¶æ‰€åˆ†é…åœ°å€ç©ºé—´çš„åŸºæœ¬å•ä½ä¸åŒ åˆ†é¡µå­˜å‚¨ç®¡ç†æ˜¯ä¸€ç»´åœ°å€ç»“æ„ï¼Œåˆ†æ®µå­˜å‚¨ç®¡ç†æ˜¯äºŒç»´åœ°å€ç»“æ„ã€‚ è¿›ç¨‹çš„åœ°å€ç©ºé—´æŒ‰ç…§ç¨‹åºè‡ªèº«çš„é€»è¾‘å…³ç³»åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªæ®µï¼Œæ¯ä¸ªæ®µéƒ½æœ‰ä¸€ä¸ªæ®µå(åœ¨ä½çº§è¯­è¨€ä¸­ï¼Œç¨‹åºå‘˜ä½¿ç”¨æ®µåæ¥ç¼–ç¨‹)ï¼Œæ¯æ®µä»0å¼€å§‹ç¼–å€ã€‚ åˆ†æ®µç³»ç»Ÿçš„é€»è¾‘åœ°å€ç»“æ„ç”±æ®µå·(æ®µå)å’Œæ®µå†…åœ°å€(æ®µå†…åç§»é‡)æ‰€ç»„æˆã€‚æ®µå·çš„ä½æ•°å†³å®šäº†æ¯ä¸ªè¿›ç¨‹æœ€å¤šå¯ä»¥åˆ†å‡ ä¸ªæ®µï¼Œæ®µå†…åœ°å€ä½æ•°å†³å®šäº†æ¯ä¸ªæ®µçš„æœ€å¤§é•¿åº¦æ˜¯å¤šå°‘ã€‚ æ®µè¡¨ï¼šç¨‹åºåˆ†å¤šä¸ªæ®µï¼Œå„æ®µç¦»æ•£åœ°è£…å…¥å†…å­˜ï¼Œä¸ºäº†ä¿è¯ç¨‹åºèƒ½æ­£å¸¸è¿è¡Œï¼Œå°±å¿…é¡»èƒ½ä»ç‰©ç†å†…å­˜ä¸­æ‰¾åˆ°å„ä¸ªé€»è¾‘æ®µçš„å­˜æ”¾ä½ç½®ã€‚ä¸ºæ­¤ï¼Œéœ€ä¸ºæ¯ä¸ªè¿›ç¨‹å»ºç«‹ä¸€å¼ æ®µæ˜ å°„è¡¨ï¼Œç®€ç§°æ®µè¡¨ã€‚æ¯ä¸ªæ®µå¯¹åº”ä¸€ä¸ªæ®µè¡¨é¡¹ï¼Œå…¶ä¸­è®°å½•äº†è¯¥æ®µåœ¨å†…å­˜ä¸­çš„èµ·å§‹ä½ç½®(åˆç§°â€œåŸºå€â€)å’Œæ®µçš„é•¿åº¦ã€‚ åˆ†é¡µå’Œåˆ†æ®µçš„åŒºåˆ«ï¼š é¡µæ˜¯ä¿¡æ¯çš„ç‰©ç†å•ä½ã€‚åˆ†é¡µçš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å®ç°ç¦»æ•£åˆ†é…ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡ã€‚åˆ†é¡µä»…ä»…æ˜¯ç³»ç»Ÿç®¡ç†ä¸Šçš„éœ€è¦ï¼Œå®Œå…¨æ˜¯ç³»ç»Ÿè¡Œä¸ºï¼Œå¯¹ç”¨æˆ·æ˜¯ä¸å¯è§çš„ã€‚ æ®µæ˜¯ä¿¡æ¯çš„é€»è¾‘å•ä½ã€‚åˆ†æ®µçš„ä¸»è¦ç›®çš„æ˜¯æ›´å¥½åœ°æ»¡è¶³ç”¨æˆ·éœ€æ±‚ã€‚ä¸€ä¸ªæ®µé€šå¸¸åŒ…å«ç€ä¸€ç»„å±äºä¸€ä¸ªé€»è¾‘æ¨¡å—çš„ä¿¡æ¯ã€‚åˆ†æ®µå¯¹ç”¨æˆ·æ˜¯å¯è§çš„ï¼Œç”¨æˆ·ç¼–ç¨‹æ—¶éœ€è¦æ˜¾å¼åœ°ç»™å‡ºæ®µåã€‚ 3.4 æ®µé¡µå¼å­˜å‚¨ç®¡ç† ç®¡ç†æ–¹å¼ ä¼˜ç‚¹ ç¼ºç‚¹ åˆ†é¡µç®¡ç† å†…å­˜ç©ºé—´åˆ©ç”¨ç‡é«˜ï¼Œä¸ä¼šäº§ç”Ÿå¤–éƒ¨ç¢ç‰‡ï¼Œåªä¼šæœ‰å°‘é‡çš„é¡µå†…ç¢ç‰‡ ä¸æ–¹ä¾¿æŒ‰ç…§é€»è¾‘æ¨¡å—å®ç°ä¿¡æ¯çš„å…±äº«å’Œä¿æŠ¤ åˆ†æ®µç®¡ç† å¾ˆæ–¹ä¾¿æŒ‰ç…§é€»è¾‘æ¨¡å—å®ç°ä¿¡æ¯çš„å…±äº«å’Œä¿æŠ¤ å¦‚æœæ®µé•¿è¿‡å¤§ï¼Œä¸ºå…¶åˆ†é…å¾ˆå¤§çš„è¿ç»­ç©ºé—´ä¼šå¾ˆä¸æ–¹ä¾¿ã€‚å¦å¤–ï¼Œæ®µå¼ç®¡ç†ä¼šäº§ç”Ÿå¤–éƒ¨ç¢ç‰‡ æ®µé¡µå¼å­˜å‚¨ç®¡ç†ç»“åˆäº†åˆ†é¡µç®¡ç†å’Œåˆ†æ®µç®¡ç†çš„ä¼˜ç¼ºç‚¹ï¼Œå°†è¿›ç¨‹æŒ‰é€»è¾‘æ¨¡å—åˆ†æ®µï¼Œå†å°†å„æ®µåˆ†é¡µ(å¦‚æ¯ä¸ªé¡µé¢4KB)ã€‚å†…å­˜ä¾ç„¶æŒ‰é¡µçš„å¤§å°åˆ†ä¸ºå„ä¸ªé¡µæ¡†ã€‚ æ®µé¡µå¼ç³»ç»Ÿçš„é€»è¾‘åœ°å€ç»“æ„ç”±æ®µå·ã€é¡µå·ã€é¡µå†…åœ°å€(é¡µå†…åç§»é‡)ç»„æˆã€‚æ®µå·çš„ä½æ•°å†³å®šäº†æ¯ä¸ªè¿›ç¨‹æœ€å¤šå¯ä»¥åˆ†å‡ ä¸ªæ®µï¼Œé¡µå·ä½æ•°å†³å®šäº†æ¯ä¸ªæ®µæœ€å¤§æœ‰å¤šå°‘é¡µï¼Œé¡µå†…åç§»é‡å†³å®šäº†é¡µé¢å¤§å°ã€å†…å­˜å—å¤§å°æ˜¯å¤šå°‘ å› æ­¤æ®µé¡µå¼ç®¡ç†çš„åœ°å€ç»“æ„ä¹Ÿæ˜¯äºŒç»´çš„ã€‚ æ®µé¡µå¼ç®¡ç†ä¸­çš„æ®µè¡¨å­˜å‚¨çš„å°±ä¸æ˜¯åŸºå€äº†ï¼Œè€Œæ˜¯é¡µè¡¨é•¿åº¦å’Œé¡µè¡¨çš„å­˜æ”¾å—å·ã€‚åœ°å€è½¬æ¢æ—¶å…ˆæŸ¥è¯¢æ®µè¡¨ï¼Œå†æŸ¥è¯¢é¡µè¡¨ã€‚ 4 è™šå­˜ç®¡ç† 4.1 ç›¸å…³æ¦‚å¿µæœ‰çš„æ—¶å€™å¯ä»¥åœ¨è¿›ç¨‹è¿è¡Œæ—¶å®æ—¶å°†æ‰€éœ€è¦çš„é¡µè£…å…¥å†…å­˜ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å…¨éƒ¨è£…å…¥ï¼Œç§°ä¸ºéƒ¨åˆ†è£…å…¥ã€‚å½“å†…å­˜å·²æ»¡è€Œåˆæœ‰æ–°çš„â€œéƒ¨åˆ†â€éœ€è¦è£…å…¥æ—¶ï¼Œè¦æŠŠå·²åœ¨å†…å­˜çš„æŸä¸€â€œéƒ¨åˆ†â€æ¢å‡ºå»ï¼Œç§°ä¸ºéƒ¨åˆ†å¯¹æ¢ ç¨‹åºå±€éƒ¨æ€§åŸç†ï¼š æ—¶é—´å±€éƒ¨æ€§ï¼šå¦‚æœæ‰§è¡Œäº†ç¨‹åºä¸­çš„æŸæ¡æŒ‡ä»¤ï¼Œé‚£ä¹ˆä¸ä¹…åè¿™æ¡æŒ‡ä»¤å¾ˆæœ‰å¯èƒ½å†æ¬¡æ‰§è¡Œï¼›å¦‚æœæŸä¸ªæ•°æ®è¢«è®¿é—®è¿‡ï¼Œä¸ä¹…ä¹‹åè¯¥æ•°æ®å¾ˆå¯èƒ½å†æ¬¡è¢«è®¿é—®ã€‚(å› ä¸ºç¨‹åºä¸­å­˜åœ¨å¤§é‡çš„å¾ªç¯) ç©ºé—´å±€éƒ¨æ€§ï¼šä¸€æ—¦ç¨‹åºè®¿é—®äº†æŸä¸ªå­˜å‚¨å•å…ƒï¼Œåœ¨ä¸ä¹…ä¹‹åï¼Œå…¶é™„è¿‘çš„å­˜å‚¨å•å…ƒä¹Ÿå¾ˆæœ‰å¯èƒ½è¢«è®¿é—®ã€‚(å› ä¸ºå¾ˆå¤šæ•°æ®åœ¨å†…å­˜ä¸­éƒ½æ˜¯è¿ç»­å­˜æ”¾çš„ï¼Œå¹¶ä¸”ç¨‹åºçš„æŒ‡ä»¤ä¹Ÿæ˜¯é¡ºåºåœ°åœ¨å†…å­˜ä¸­å­˜æ”¾çš„) åŸºäºå±€éƒ¨æ€§åŸç†ï¼Œåœ¨ç¨‹åºè£…å…¥æ—¶ï¼Œå¯ä»¥å°†ç¨‹åºä¸­å¾ˆå¿«ä¼šç”¨åˆ°çš„éƒ¨åˆ†è£…å…¥å†…å­˜ï¼Œæš‚æ—¶ç”¨ä¸åˆ°çš„éƒ¨åˆ†ç•™åœ¨å¤–å­˜ï¼Œå°±å¯ä»¥è®©ç¨‹åºå¼€å§‹æ‰§è¡Œã€‚ åˆ†é¡µè™šå­˜ç³»ç»Ÿçš„ç¡¬ä»¶æ”¯æ’‘ï¼šå†…å­˜ç®¡ç†å•å…ƒMMUå®Œæˆé€»è¾‘åœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢åŠŸèƒ½ï¼Œå®ƒæ¥å—é€»è¾‘åœ°å€ä½œä¸ºè¾“å…¥ï¼Œç‰©ç†åœ°å€ä½œä¸ºè¾“å‡ºï¼Œç›´æ¥é€åˆ°æ€»çº¿ä¸Šï¼Œå¯¹å†…å­˜å•å…ƒè¿›è¡Œå¯»å€ã€‚ MMUçš„ä¸»è¦åŠŸèƒ½ï¼š ç®¡ç†ç¡¬ä»¶é¡µè¡¨åŸºå€å¯„å­˜å™¨ã€‚ åˆ†è§£é€»è¾‘åœ°å€ã€‚ ç®¡ç†å¿«è¡¨TLBã€‚ è®¿é—®é¡µè¡¨ã€‚ å‘å‡ºç¼ºé¡µä¸­æ–­æˆ–è¶Šç•Œä¸­æ–­ï¼Œå¹¶å°†æ§åˆ¶æƒäº¤ç»™å†…æ ¸å­˜å‚¨ç®¡ç†å¤„ç†ã€‚ è®¾ç½®å’Œæ£€æŸ¥é¡µè¡¨ä¸­å„ä¸ªç‰¹å¾ä½ã€‚ è™šæ‹Ÿå†…å­˜çš„å®é™…å®¹é‡= min(å†…å­˜å’Œå¤–å­˜å®¹é‡ä¹‹å’Œï¼ŒCPUå¯»å€èŒƒå›´) ä¸åŸºæœ¬åˆ†é¡µç®¡ç†ç›¸æ¯”ï¼Œè¯·æ±‚åˆ†é¡µç®¡ç†ä¸­ï¼Œä¸ºäº†å®ç°â€œè¯·æ±‚è°ƒé¡µâ€ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦çŸ¥é“æ¯ä¸ªé¡µé¢æ˜¯å¦å·²ç»è°ƒå…¥å†…å­˜ã€‚å¦‚æœè¿˜æ²¡è°ƒå…¥ï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦çŸ¥é“è¯¥é¡µé¢åœ¨å¤–å­˜ä¸­å­˜æ”¾çš„ä½ç½®ã€‚å½“å†…å­˜ç©ºé—´ä¸å¤Ÿæ—¶ï¼Œè¦å®ç°â€œé¡µé¢ç½®æ¢â€ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦é€šè¿‡æŸäº›æŒ‡æ ‡æ¥å†³å®šåˆ°åº•æ¢å‡ºå“ªä¸ªé¡µé¢ã€‚æœ‰çš„é¡µé¢æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ï¼Œå°±ä¸ç”¨å†æµªè´¹æ—¶é—´å†™å›å¤–å­˜ã€‚æœ‰çš„é¡µé¢ä¿®æ”¹è¿‡ï¼Œå°±éœ€è¦å°†å¤–å­˜ä¸­çš„æ—§æ•°æ®è¦†ç›–ï¼Œå› æ­¤ï¼Œæ“ä½œç³»ç»Ÿä¹Ÿéœ€è¦è®°å½•å„ä¸ªé¡µé¢æ˜¯å¦è¢«ä¿®æ”¹çš„ä¿¡æ¯ã€‚ äºæ˜¯ï¼Œè¯·æ±‚åˆ†é¡µå­˜å‚¨ç®¡ç†çš„é¡µè¡¨é™¤äº†å¯¹åº”çš„å†…å­˜å—å·å¤–ï¼Œè¿˜è®°å½•äº†çŠ¶æ€ä½ï¼ˆæ˜¯å¦å·²è°ƒå…¥å†…å­˜ï¼Œ1ä¸ºæ˜¯ï¼Œ0ä¸ºå¦ï¼‰ã€å¼•ç”¨ä½ï¼ˆå¯è®°å½•æœ€è¿‘è¢«è®¿é—®è¿‡å‡ æ¬¡ï¼Œæˆ–è®°å½•ä¸Šæ¬¡è®¿é—®çš„æ—¶é—´ï¼Œä¾›ç½®æ¢ç®—æ³•å‚è€ƒï¼‰ã€ä¿®æ”¹ä½ï¼ˆé¡µé¢è°ƒå…¥å†…å­˜åæ˜¯å¦è¢«ä¿®æ”¹è¿‡ï¼‰ã€å¤–å­˜åœ°å€ åœ¨è¯·æ±‚åˆ†é¡µç³»ç»Ÿä¸­ï¼Œæ¯å½“è¦è®¿é—®çš„é¡µé¢ä¸åœ¨å†…å­˜æ—¶ï¼Œä¾¿äº§ç”Ÿä¸€ä¸ªç¼ºé¡µä¸­æ–­ï¼Œç„¶åç”±æ“ä½œç³»ç»Ÿçš„ç¼ºé¡µä¸­æ–­å¤„ç†ç¨‹åºå¤„ç†ä¸­æ–­ã€‚æ­¤æ—¶ç¼ºé¡µçš„è¿›ç¨‹é˜»å¡ï¼Œæ”¾å…¥é˜»å¡é˜Ÿåˆ—ï¼Œè°ƒé¡µå®Œæˆåå†å°†å…¶å”¤é†’ï¼Œæ”¾å›å°±ç»ªé˜Ÿåˆ—ã€‚ å¦‚æœå†…å­˜ä¸­æœ‰ç©ºé—²å—ï¼Œåˆ™ä¸ºè¿›ç¨‹åˆ†é…ä¸€ä¸ªç©ºé—²å—ï¼Œå°†æ‰€ç¼ºé¡µé¢è£…å…¥è¯¥å—ï¼Œå¹¶ä¿®æ”¹é¡µè¡¨ä¸­ç›¸åº”çš„é¡µè¡¨é¡¹ã€‚ å¦‚æœå†…å­˜ä¸­æ²¡æœ‰ç©ºé—²å—ï¼Œåˆ™ç”±é¡µé¢ç½®æ¢ç®—æ³•é€‰æ‹©ä¸€ä¸ªé¡µé¢æ·˜æ±°ï¼Œè‹¥è¯¥é¡µé¢åœ¨å†…å­˜æœŸé—´è¢«ä¿®æ”¹è¿‡ï¼Œåˆ™è¦å°†å…¶å†™å›å¤–å­˜ã€‚æœªä¿®æ”¹è¿‡çš„é¡µé¢ä¸ç”¨å†™å›å¤–å­˜ã€‚ 4.2 é¡µé¢ç½®æ¢ç®—æ³•æœ€ä½³é¡µé¢ç½®æ¢ç®—æ³•OPTï¼šè°ƒå…¥ä¸€é¡µè€Œå¿…é¡»æ·˜æ±°ä¸€ä¸ªæ—§é¡µæ—¶ï¼Œæ‰€æ·˜æ±°çš„é¡µåº”è¯¥æ˜¯ä»¥åä¸å†è®¿é—®çš„é¡µæˆ–è·ç°åœ¨æœ€é•¿æ—¶é—´åå†è®¿é—®çš„é¡µã€‚æœ€ä½³ç½®æ¢ç®—æ³•å¯ä»¥ä¿è¯æœ€ä½çš„ç¼ºé¡µç‡ï¼Œä½†å®é™…ä¸Šï¼Œåªæœ‰åœ¨è¿›ç¨‹æ‰§è¡Œçš„è¿‡ç¨‹ä¸­æ‰èƒ½çŸ¥é“æ¥ä¸‹æ¥ä¼šè®¿é—®åˆ°çš„æ˜¯å“ªä¸ªé¡µé¢ã€‚æ“ä½œç³»ç»Ÿæ— æ³•æå‰é¢„åˆ¤é¡µé¢è®¿é—®åºåˆ—ã€‚å› æ­¤ï¼Œæœ€ä½³ç½®æ¢ç®—æ³•æ˜¯æ— æ³•å®ç°çš„ã€‚ å…ˆè¿›å…ˆå‡ºé¡µé¢æ›¿æ¢ç®—æ³•FIFOï¼šåŸºäºç¨‹åºæ€»æ˜¯æŒ‰çº¿æ€§é¡ºåºæ¥è®¿é—®ç‰©ç†ç©ºé—´è¿™ä¸€å‡è®¾ã€‚ç®—æ³•æ·˜æ±°æœ€å…ˆè°ƒå…¥å†…å­˜çš„é¡µï¼Œæˆ–è€…è¯´åœ¨å†…å­˜ä¸­é©»ç•™æ—¶é—´æœ€é•¿çš„é¡µã€‚è¯¥ç®—æ³•å¯ä»¥ä½¿ç”¨å›ºå®šå¤§å°çš„é˜Ÿåˆ—å®ç°ï¼Œé˜Ÿåˆ—çš„å¤§å°ä¸ºç³»ç»Ÿä¸ºè¿›ç¨‹åˆ†é…çš„å†…å­˜å—æ•°ã€‚å¹¶ä¸”è¯¥ç®—æ³•çš„æ€§èƒ½ä¸æ˜¯å¾ˆå¥½ï¼Œå³ä½¿æœ€å…ˆè°ƒå…¥å†…å­˜çš„é¡µé¢ä¹Ÿå¯èƒ½ç»å¸¸ç”¨åˆ°ã€‚ æœ€è¿‘æœ€å°‘ç”¨é¡µé¢æ›¿æ¢ç®—æ³•LRUï¼šç®—æ³•æ·˜æ±°çš„é¡µé¢æ˜¯åœ¨æœ€è¿‘ä¸€æ®µæ—¶é—´é‡Œè¾ƒä¹…æœªè¢«è®¿é—®çš„é‚£é¡µã€‚ è¯¥ç®—æ³•çš„æ€§èƒ½è¾ƒå¥½ï¼Œæœ€æ¥è¿‘æœ€ä½³é¡µé¢ç½®æ¢ç®—æ³•ã€‚å®ç°æ–¹æ³•ï¼š è¯¥ç®—æ³•å¯ä»¥ç”¨å›ºå®šå¤§å°çš„é“¾è¡¨å®ç°ï¼Œå½“ä½¿ç”¨æŸä¸ªé¡µçš„æ—¶å€™å°†å…¶è¿æ¥åˆ°é“¾è¡¨çš„å°¾éƒ¨ã€‚ å¼•ç”¨ä½æ³•ï¼šæ¯é¡µè®¾ç½®ä¸€ä¸ªå¼•ç”¨ä½Rï¼Œè®¿é—®æŸé¡µæ—¶ï¼Œç”±ç¡¬ä»¶å°†é¡µæ ‡å¿—ä½Rç½®1ï¼Œéš”ä¸€å®šæ—¶é—´tå°†æ‰€æœ‰é¡µçš„æ ‡å¿—Rå‡æ¸…0ã€‚å‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶ï¼Œä»æ ‡å¿—ä½Rä¸º0çš„é¡µä¸­æŒ‘é€‰ä¸€é¡µæ·˜æ±°ã€‚æŒ‘é€‰åˆ°è¦æ·˜æ±°çš„é¡µåï¼Œä¹Ÿå°†æ‰€æœ‰é¡µçš„æ ‡å¿—ä½Ræ¸…0ã€‚ è®¡æ•°æ³•ï¼šæ¯ä¸ªé¡µé¢è®¾ç½®ä¸€ä¸ªå¤šä½è®¡æ•°å™¨ï¼Œåˆå«æœ€ä¸å¸¸ç”¨é¡µé¢æ›¿æ¢ç®—æ³•LFUã€‚æ¯å½“è®¿é—®ä¸€é¡µæ—¶ï¼Œå°±ä½¿å®ƒå¯¹åº”çš„è®¡æ•°å™¨åŠ ï¼‘ã€‚å½“å‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶ï¼Œå¯é€‰æ‹©è®¡æ•°å€¼æœ€å°çš„å¯¹åº”é¡µé¢æ·˜æ±°ï¼Œå¹¶å°†æ‰€æœ‰è®¡æ•°å™¨å…¨éƒ¨æ¸…ï¼ã€‚ è®¡æ—¶æ³•ï¼šä¸ºæ¯ä¸ªé¡µé¢è®¾ç½®ä¸€ä¸ªå¤šä½è®¡æ—¶å™¨ï¼Œæ¯å½“é¡µé¢è¢«è®¿é—®æ—¶ï¼Œç³»ç»Ÿçš„ç»å¯¹æ—¶é—´è®°å…¥è®¡æ—¶å™¨ã€‚æ·˜æ±°æ—¶æ¯”è¾ƒå„é¡µé¢çš„è®¡æ—¶å™¨çš„å€¼ï¼Œé€‰æœ€å°å€¼çš„æœªä½¿ç”¨çš„é¡µé¢æ·˜æ±°ã€‚ è€åŒ–ç®—æ³•ï¼šä¸ºæ¯ä¸ªé¡µè®¾ç½®ä¸€ä¸ªå¤šä½å¯„å­˜å™¨rã€‚å½“é¡µé¢è¢«è®¿é—®æ—¶ï¼Œå¯¹åº”å¯„å­˜å™¨çš„æœ€å·¦è¾¹ä½ç½®1ï¼›æ¯éš”æ—¶é—´tï¼Œå°†rå¯„å­˜å™¨å³ç§»ä¸€ä½ï¼›åœ¨å‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶ï¼Œæ‰¾æœ€å°æ•°å€¼çš„rå¯„å­˜å™¨å¯¹åº”çš„é¡µé¢æ·˜æ±°ã€‚ ç¬¬äºŒæ¬¡æœºä¼šé¡µé¢æ›¿æ¢ç®—æ³•SCRï¼šæ”¹è¿›FIFOç®—æ³•ï¼ŒæŠŠFIFOä¸é¡µè¡¨ä¸­çš„â€å¼•ç”¨ä½â€ç»“åˆèµ·æ¥ä½¿ç”¨ï¼š æ£€æŸ¥FIFOä¸­çš„é˜Ÿé¦–é¡µé¢(æœ€æ—©è¿›å…¥å†…å­˜é¡µé¢)ï¼Œå¦‚æœå®ƒçš„â€å¼•ç”¨ä½â€æ˜¯0ï¼Œè¿™ä¸ªé¡µé¢æ—¢è€åˆæ²¡æœ‰ç”¨ï¼Œé€‰æ‹©è¯¥é¡µé¢æ·˜æ±°ï¼› å¦‚æœâ€å¼•ç”¨ä½â€æ˜¯1ï¼Œè¯´æ˜å®ƒè¿›å…¥å†…å­˜è¾ƒæ—©ï¼Œä½†æœ€è¿‘ä»åœ¨ä½¿ç”¨ã€‚æŠŠå®ƒçš„â€å¼•ç”¨ä½â€æ¸…0ï¼Œå¹¶æŠŠè¿™ä¸ªé¡µé¢ç§»åˆ°é˜Ÿå°¾ï¼ŒæŠŠå®ƒçœ‹ä½œæ˜¯ä¸€ä¸ªæ–°è°ƒå…¥çš„é¡µã€‚ æ—¶é’Ÿé¡µé¢æ›¿æ¢ç®—æ³•Clockï¼šä¸€ä¸ªé¡µé¢é¦–æ¬¡è£…å…¥å†…å­˜ï¼Œå…¶â€œå¼•ç”¨ä½â€ç½®1ã€‚å†…å­˜ä¸­çš„ä»»ä½•é¡µé¢è¢«è®¿é—®æ—¶ï¼Œ â€å¼•ç”¨ä½â€ç½®1ã€‚æ·˜æ±°é¡µé¢æ—¶ï¼Œä»æŒ‡é’ˆå½“å‰æŒ‡å‘çš„é¡µé¢å¼€å§‹æ‰«æå¾ªç¯é˜Ÿåˆ—ï¼ŒæŠŠè¿åˆ°çš„â€å¼•ç”¨ä½â€æ˜¯1çš„é¡µé¢çš„â€å¼•ç”¨ä½â€æ¸…0ï¼Œè·³è¿‡è¿™ä¸ªé¡µé¢ï¼›æŠŠæ‰€è¿åˆ°çš„â€å¼•ç”¨ä½â€æ˜¯0çš„é¡µé¢æ·˜æ±°æ‰ï¼ŒæŒ‡é’ˆæ¨è¿›ä¸€æ­¥ã€‚æ‰«æå¾ªç¯é˜Ÿåˆ—æ—¶ï¼Œå¦‚æœè¿åˆ°çš„æ‰€æœ‰é¡µé¢çš„â€å¼•ç”¨ä½â€ä¸º1ï¼ŒæŒ‡é’ˆå°±ä¼šç»•æ•´ä¸ªå¾ªç¯é˜Ÿåˆ—ä¸€åœˆï¼ŒæŠŠç¢°åˆ°çš„æ‰€æœ‰é¡µé¢çš„â€å¼•ç”¨ä½â€æ¸…0ï¼›æŒ‡é’ˆåœåœ¨èµ·å§‹ä½ç½®ï¼Œå¹¶æ·˜æ±°æ‰è¿™ä¸€é¡µï¼Œç„¶åï¼ŒæŒ‡é’ˆæ¨è¿›ä¸€æ­¥ã€‚ å¯ä»¥ç»“åˆä¿®æ”¹ä½å¯¹æ—¶é’Ÿé¡µé¢æ›¿æ¢ç®—æ³•è¿›è¡Œæ”¹è¿›ã€‚è‹¥ç”¨(è®¿é—®ä½ï¼Œä¿®æ”¹ä½)çš„å½¢å¼è¡¨è¿°ï¼Œåˆ™ ç¬¬ä¸€è½®ï¼šæ·˜æ±°(0, 0) ç¬¬äºŒè½®ï¼šæ·˜æ±°(0, 1) ï¼Œå¹¶å°†æ‰«æè¿‡çš„é¡µé¢è®¿é—®ä½éƒ½ç½®ä¸º0 ç¬¬ä¸‰è½®ï¼šæ·˜æ±°(0, 0) ç¬¬å››è½®ï¼šæ·˜æ±°(0, 1) 4.3 é¡µé¢åˆ†é…ç­–ç•¥é©»ç•™é›†ï¼šæŒ‡è¯·æ±‚åˆ†é¡µå­˜å‚¨ç®¡ç†ä¸­ç»™è¿›ç¨‹åˆ†é…çš„ç‰©ç†å—çš„é›†åˆã€‚ åœ¨é‡‡ç”¨äº†è™šæ‹Ÿå­˜å‚¨æŠ€æœ¯çš„ç³»ç»Ÿä¸­ï¼Œé©»ç•™é›†å¤§å°ä¸€èˆ¬å°äºè¿›ç¨‹çš„æ€»å¤§å°ã€‚è‹¥é©»ç•™é›†å¤ªå°ï¼Œä¼šå¯¼è‡´ç¼ºé¡µé¢‘ç¹ï¼Œç³»ç»Ÿè¦èŠ±å¤§é‡çš„æ—¶é—´æ¥å¤„ç†ç¼ºé¡µï¼Œå®é™…ç”¨äºè¿›ç¨‹æ¨è¿›çš„æ—¶é—´å¾ˆå°‘;é©»ç•™é›†å¤ªå¤§ï¼Œåˆä¼šå¯¼è‡´å¤šé“ç¨‹åºå¹¶å‘åº¦ä¸‹é™ï¼Œèµ„æºåˆ©ç”¨ç‡é™ä½ã€‚æ‰€ä»¥åº”è¯¥é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„é©»ç•™é›†å¤§å°ã€‚ åˆ†é…ç­–ç•¥ï¼š å›ºå®šåˆ†é…ï¼šæ“ä½œç³»ç»Ÿä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸€ç»„å›ºå®šæ•°ç›®çš„ç‰©ç†å—ï¼Œåœ¨è¿›ç¨‹è¿è¡ŒæœŸé—´ä¸å†æ”¹å˜ã€‚å³ï¼Œé©»ç•™é›†å¤§å°ä¸å˜ã€‚åªè¦æœ‰ä¸€ä¸ªç¼ºé¡µä¸­æ–­äº§ç”Ÿ,è¿›ç¨‹å°±ä¼šæœ‰ä¸€é¡µè¢«æ›¿æ¢ã€‚ å¯å˜åˆ†é…ï¼šå…ˆä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†ä¸€å®šæ•°ç›®çš„ç‰©ç†å—ï¼Œåœ¨è¿›ç¨‹è¿è¡ŒæœŸé—´ï¼Œå¯æ ¹æ®æƒ…å†µåšé€‚å½“çš„å¢åŠ æˆ–å‡å°‘ã€‚å³ï¼Œé©»ç•™é›†å¤§å°å¯å˜ã€‚è¿›ç¨‹æ‰§è¡Œçš„æŸé˜¶æ®µç¼ºé¡µç‡è¾ƒé«˜,è¯´æ˜ç›®å‰å±€éƒ¨æ€§è¾ƒå·®ï¼Œç³»ç»Ÿå¯å¤šåˆ†äº›é¡µæ¡†ä»¥é™ä½ç¼ºé¡µç‡ï¼Œåä¹‹è¯´æ˜è¿›ç¨‹ç›®å‰çš„å±€éƒ¨æ€§è¾ƒå¥½,å¯å‡å°‘åˆ†ç»™è¿›ç¨‹çš„é¡µæ¡†æ•°ã€‚ ç½®æ¢ç­–ç•¥ï¼š å±€éƒ¨ç½®æ¢ï¼šå‘ç”Ÿç¼ºé¡µæ—¶åªèƒ½é€‰è¿›ç¨‹è‡ªå·±çš„ç‰©ç†å—è¿›è¡Œç½®æ¢ã€‚ å…¨å±€ç½®æ¢ï¼šå¯ä»¥å°†æ“ä½œç³»ç»Ÿä¿ç•™çš„ç©ºé—²ç‰©ç†å—åˆ†é…ç»™ç¼ºé¡µè¿›ç¨‹ï¼Œä¹Ÿå¯ä»¥å°†åˆ«çš„è¿›ç¨‹æŒæœ‰çš„ç‰©ç†å—ç½®æ¢åˆ°å¤–å­˜ï¼Œå†åˆ†é…ç»™ç¼ºé¡µè¿›ç¨‹ã€‚ ä»ä½•å¤„è°ƒå…¥é¡µé¢ï¼š ç³»ç»Ÿæ‹¥æœ‰è¶³å¤Ÿçš„å¯¹æ¢åŒºç©ºé—´ï¼šé¡µé¢çš„è°ƒå…¥ã€è°ƒå‡ºéƒ½æ˜¯åœ¨å†…å­˜ä¸å¯¹æ¢åŒºä¹‹é—´è¿›è¡Œï¼Œè¿™æ ·å¯ä»¥ä¿è¯é¡µé¢çš„è°ƒå…¥ã€è°ƒå‡ºé€Ÿåº¦å¾ˆå¿«ã€‚åœ¨è¿›ç¨‹è¿è¡Œå‰ï¼Œéœ€å°†è¿›ç¨‹ç›¸å…³çš„æ•°æ®ä»æ–‡ä»¶åŒºå¤åˆ¶åˆ°å¯¹æ¢åŒºã€‚ ç³»ç»Ÿç¼ºå°‘è¶³å¤Ÿçš„å¯¹æ¢åŒºç©ºé—´ï¼šå‡¡æ˜¯ä¸ä¼šè¢«ä¿®æ”¹çš„æ•°æ®éƒ½ç›´æ¥ä»æ–‡ä»¶åŒºè°ƒå…¥ï¼Œç”±äºè¿™äº›é¡µé¢ä¸ä¼šè¢«ä¿®æ”¹ï¼Œå› æ­¤æ¢å‡ºæ—¶ä¸å¿…å†™å›ç£ç›˜ï¼Œä¸‹æ¬¡éœ€è¦æ—¶å†ä»æ–‡ä»¶åŒºè°ƒå…¥å³å¯ã€‚å¯¹äºå¯èƒ½è¢«ä¿®æ”¹çš„éƒ¨åˆ†ï¼Œæ¢å‡ºæ—¶éœ€å†™å›ç£ç›˜å¯¹æ¢åŒºï¼Œä¸‹æ¬¡éœ€è¦æ—¶å†ä»å¯¹æ¢åŒºè°ƒå…¥ã€‚ UNIXæ–¹å¼ï¼šè¿è¡Œä¹‹å‰è¿›ç¨‹æœ‰å…³çš„æ•°æ®å…¨éƒ¨æ”¾åœ¨æ–‡ä»¶åŒºï¼Œæ•…æœªä½¿ç”¨è¿‡çš„é¡µé¢ï¼Œéƒ½å¯ä»æ–‡ä»¶åŒºè°ƒå…¥ã€‚è‹¥è¢«ä½¿ç”¨è¿‡çš„é¡µé¢éœ€è¦æ¢å‡ºï¼Œåˆ™å†™å›å¯¹æ¢åŒºï¼Œä¸‹æ¬¡éœ€è¦æ—¶ä»å¯¹æ¢åŒºè°ƒå…¥ã€‚","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://www.codetool.top/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"}]},{"title":"å‰‘æŒ‡offer51-æ•°ç»„ä¸­çš„é€†åºå¯¹","slug":"å‰‘æŒ‡offer51-æ•°ç»„ä¸­çš„é€†åºå¯¹","date":"2020-04-24T02:01:16.000Z","updated":"2020-04-24T03:11:34.201Z","comments":true,"path":"article/å‰‘æŒ‡offer51-æ•°ç»„ä¸­çš„é€†åºå¯¹/","link":"","permalink":"https://www.codetool.top/article/%E5%89%91%E6%8C%87offer51-%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%80%86%E5%BA%8F%E5%AF%B9/","excerpt":"","text":"1 åŸé¢˜ï¼ˆæ¥æºLeetcodeï¼‰åœ¨æ•°ç»„ä¸­çš„ä¸¤ä¸ªæ•°å­—ï¼Œå¦‚æœå‰é¢ä¸€ä¸ªæ•°å­—å¤§äºåé¢çš„æ•°å­—ï¼Œåˆ™è¿™ä¸¤ä¸ªæ•°å­—ç»„æˆä¸€ä¸ªé€†åºå¯¹ã€‚è¾“å…¥ä¸€ä¸ªæ•°ç»„ï¼Œæ±‚å‡ºè¿™ä¸ªæ•°ç»„ä¸­çš„é€†åºå¯¹çš„æ€»æ•°ã€‚ ç¤ºä¾‹ 1: è¾“å…¥ï¼š [7,5,6,4]è¾“å‡ºï¼š 5 é™åˆ¶ï¼š 0 &lt;= æ•°ç»„é•¿åº¦ &lt;= 50000 2 è§£æ³•2.1 æ€æƒ³æš´åŠ›ï¼šåŒé‡å¾ªç¯æ£€æŸ¥ï¼Œleetcodeä¸­è¶…æ—¶ åˆ†æ²»æ€æƒ³ï¼šä½¿ç”¨å½’å¹¶æ’åºçš„ç®—æ³•ï¼Œæ¯æ¬¡ç»™å·¦å³ä¸¤ä¸ªæ•°ç»„åˆå¹¶çš„æ—¶å€™ï¼Œè‹¥å³è¾¹æ•°ç»„ä¸­æŒ‡å‘çš„å…ƒç´ å°äºå·¦è¾¹æ•°ç»„æŒ‡å‘çš„å…ƒç´ ï¼Œåˆ™ä¹Ÿå°äºå·¦è¾¹æ•°ç»„æŒ‡å‘çš„å…ƒç´ åé¢çš„ä»»ä½•ä¸€ä¸ªå…ƒç´ ï¼ˆå½’å¹¶æ’åºåˆå¹¶çš„æ—¶å€™å·¦å³ä¸¤ä¸ªæ•°ç»„éƒ½æ˜¯æœ‰åºçš„ï¼‰ï¼Œåˆ™æ­¤æ—¶åŠ ä¸Šå·¦è¾¹æ•°ç»„å‰©ä½™çš„å…ƒç´ ä¸ªæ•°å³å¯ã€‚ 2.2 ä»£ç å½’å¹¶æ’åºå¤§å¤ä¹ ï¼Œè¿™é‡Œæä¾›ä¸¤ç§å†™æ³•ï¼š ä¸‹é¢æ˜¯å½’å¹¶æ’åºè¾ƒç®€å•çš„å†™æ³•ï¼Œå°±æ˜¯æ¯æ¬¡å°†æ•°ç»„å‡åˆ†æˆä¸¤ä¸ªå­æ•°ç»„ï¼Œåˆ†åˆ°ä¸èƒ½å†åˆ†çš„æ—¶å€™å¼€å§‹åˆå¹¶ç›¸é‚»çš„ä¸¤ä¸ªå­æ•°ç»„ã€‚è¿™ç§å†™æ³•é€’å½’ä¸­ä¼šåˆ›å»ºæ–°æ•°ç»„å¹¶æ‹·è´ï¼Œå› æ­¤æ—¶é—´æˆæœ¬ä¼šç•¥é«˜äº›ã€‚ class Solution { int count;//å…¨å±€å˜é‡è®¡æ•° public int reversePairs(int[] nums) { MergeSort(nums); return count; } public int[] MergeSort(int[] array) { if (array.length &lt; 2) return array; int mid = array.length / 2; int[] left = Arrays.copyOfRange(array, 0, mid); int[] right = Arrays.copyOfRange(array, mid, array.length); return merge(MergeSort(left), MergeSort(right)); } public int[] merge(int[] left, int[] right) { int[] result = new int[left.length + right.length]; for (int index = 0, i = 0, j = 0; index &lt; result.length; index++) { if (i == left.length) result[index] = right[j++]; else if (j == right.length) result[index] = left[i++]; else if (left[i] > right[j]){ count+=left.length-i;//åŠ ä¸Šå·¦è¾¹æ•°ç»„å‰©ä½™çš„å…ƒç´ ä¸ªæ•° result[index] = right[j++]; } else result[index] = left[i++]; } return result; } } ä¸‹é¢æ˜¯ä¸€ç§é€’å½’è¿‡ç¨‹ä¸­ä¸ç”¨åˆ›å»ºæ•°ç»„çš„å½’å¹¶æ’åºå†™æ³•ï¼Œåªä½¿ç”¨ä¸¤ä¸ªå’ŒåŸæ•°ç»„ç›¸åŒå¤§å°çš„æ•°ç»„æ¥å›äº¤æ¢æ•°æ®ï¼ˆåšå¯¹æ–¹çš„ç¼“å­˜ï¼‰ï¼Œåœ¨å±€éƒ¨ä¸Šæ“ä½œï¼Œæ—¶é—´æˆæœ¬ä¼šæ¯”ä¸Šé¢åˆ›å»ºæ•°ç»„çš„æ–¹æ³•æ›´ä½äº›ï¼Œä½†æ˜¯æ˜¯ä¸€ä¸ªé‡çº§çš„ï¼Œåœ¨leetcodeä¸­èƒ½å–å¾—æ›´å¥½çš„æˆç»©ï¼š class Solution { public int reversePairs(int[] nums) { int[] temp = nums.clone();//åˆ›å»ºä¸€ä¸ªå’ŒåŸæ•°ç»„ç›¸åŒå¤§å°çš„æ•°ç»„ return MergeSort(nums, temp, 0, nums.length - 1); } //[start,end]ç¡®å®šä¸€ä¸ªæ•°ç»„èŒƒå›´ï¼Œå³é€’å½’ä¸­è¦æ’åºçš„èŒƒå›´ï¼Œè¿”å›å€¼ä¸ºåˆå¹¶è¿‡ç¨‹ä¸­çš„è®¡æ•° private int MergeSort(int[] nums, int[] temp, int start, int end) { if (start >= end) return 0; int mid = (start + end)/2; int left = MergeSort(temp, nums, start, mid); int right = MergeSort(temp, nums, mid + 1, end); int count = merge(nums, temp, start, mid+1, end); return left + right + count; } //[left,right)å’Œ[right,end]ç¡®å®šæ•°ç»„çš„ä¸¤éƒ¨åˆ†ï¼Œåˆå¹¶tempæ•°ç»„ä¸­çš„è¿™ä¸¤éƒ¨åˆ†åˆ°numsæ•°ç»„ private int merge(int[] nums, int[] temp, int left, int right, int end) { int index = left; int leftSize = right;//å› ä¸ºç›´æ¥ä½¿ç”¨leftå’Œrightä½œä¸ºåé¢ä½¿ç”¨çš„åŒæŒ‡é’ˆï¼Œè¿™é‡Œä¿å­˜rightåŸä½ç½®ä½œä¸ºleftæŒ‡é’ˆèƒ½ç§»åŠ¨åˆ°çš„æœ€è¿œå¤„ int count = 0;//åˆå¹¶è¿‡ç¨‹ä¸­è®¡æ•° while (index &lt;= end) { if (left==leftSize) nums[index] = temp[right++]; else if (right==end+1) nums[index] = temp[left++]; else if (temp[left] > temp[right]) { count += (leftSize - left);//åŠ ä¸Šå·¦è¾¹éƒ¨åˆ†å‰©ä½™çš„å…ƒç´ ä¸ªæ•° nums[index] = temp[right++]; } else nums[index] = temp[left++]; index++; } return count; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"å‰‘æŒ‡offer","slug":"å‰‘æŒ‡offer","permalink":"https://www.codetool.top/tags/%E5%89%91%E6%8C%87offer/"}]},{"title":"npmå®‰è£…node-sassé€Ÿåº¦æ…¢ï¼Œå¡æ­»çš„è§£å†³æ–¹æ¡ˆ","slug":"npmå®‰è£…node-sassé€Ÿåº¦æ…¢ï¼Œå¡æ­»çš„è§£å†³æ–¹æ¡ˆ","date":"2020-04-23T05:54:09.000Z","updated":"2020-04-23T06:05:18.281Z","comments":true,"path":"article/npmå®‰è£…node-sassé€Ÿåº¦æ…¢ï¼Œå¡æ­»çš„è§£å†³æ–¹æ¡ˆ/","link":"","permalink":"https://www.codetool.top/article/npm%E5%AE%89%E8%A3%85node-sass%E9%80%9F%E5%BA%A6%E6%85%A2%EF%BC%8C%E5%8D%A1%E6%AD%BB%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/","excerpt":"","text":"æ˜¨å¤©åœ¨ç”¨npm installå®‰è£…ä¸€ä¸ªå‰ç«¯é¡¹ç›®ä¾èµ–çš„æ—¶å€™æµªè´¹äº†æˆ‘å¥½é•¿æ—¶é—´ï¼Œå³ä½¿æ³¨å†Œäº†æ·˜å®é•œåƒï¼Œä½†ä¸­é—´è¿˜æ˜¯ä¼šå»node.orgå’Œgithub.comä¸Šé¢ä¸‹è½½ä¸€äº›ä¸œè¥¿ï¼Œä¸­é—´ç»å¸¸å¡æ­»ï¼Œå¯¼è‡´æˆ‘ä¸åœçš„ä¸­æ­¢ã€åˆ node_modulesã€é‡æ–°å®‰è£…ã€‚ æ—¥å¿—å°±æ˜¯gypä»€ä¹ˆä»€ä¹ˆçš„é”™è¯¯ã€‚ åæ¥æ³¨æ„åˆ°æ˜¯å®ƒåœ¨å®‰è£…node-sassï¼Œå¹¶ä¸”ä¸€å¼€å§‹ä¾èµ–çš„æ˜¯python2ï¼ˆæˆ‘ç”µè„‘ä¸Šè£…çš„python3ï¼‰ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™pythonç‰ˆæœ¬é—®é¢˜ï¼Œè¯­æ³•è¯†åˆ«é”™è¯¯ä»€ä¹ˆçš„ï¼Œå¯ä»¥ç”¨ç®¡ç†å‘˜æƒé™æ‰“å¼€powershellï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤å®‰è£…windows-build-tools npm install -g windows-build-toolsæˆ–è€…è‡ªå·±å®‰è£…python2å¹¶é…ç½®ç¯å¢ƒå˜é‡ ç„¶åä¸­é€”å¡æ­»çš„é—®é¢˜ä¸»è¦è¿˜æ˜¯å»å¤–ç½‘ä¸‹è½½çš„ï¼Œé…ç½®npmçš„é•œåƒæ²¡æœ‰ç”¨ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªç¯å¢ƒå˜é‡ï¼š npm install --sass_binary_site=https://npm.taobao.org/mirrors/node-sass/åšåˆ°è¿™ä¸€æ­¥å¦‚æœè¿˜æ˜¯å¤±è´¥å¯èƒ½æ˜¯nodejså’Œnode-gypçš„ç‰ˆæœ¬ä¸æ­ï¼Œæˆ‘æ˜¨å¤©å°±æ˜¯å› ä¸ºä¸€å¼€å§‹ç”¨äº†nodejs14.0.0ï¼Œç‰ˆæœ¬å¤ªé«˜äº†ï¼Œåæ¥ä¸­é—´å®‰è£…çš„æ—¶å€™åˆå¡æ­»ã€‚","categories":[{"name":"æ—¥å¸¸/éšç¬”","slug":"æ—¥å¸¸-éšç¬”","permalink":"https://www.codetool.top/categories/%E6%97%A5%E5%B8%B8-%E9%9A%8F%E7%AC%94/"}],"tags":[{"name":"æ—¥å¸¸","slug":"æ—¥å¸¸","permalink":"https://www.codetool.top/tags/%E6%97%A5%E5%B8%B8/"}]},{"title":"ç¨‹åºå‘˜é¢è¯•é‡‘å…¸08.11-ç¡¬å¸","slug":"ç¨‹åºå‘˜é¢è¯•é‡‘å…¸08-11-ç¡¬å¸","date":"2020-04-23T05:36:28.000Z","updated":"2020-04-23T05:42:59.001Z","comments":true,"path":"article/ç¨‹åºå‘˜é¢è¯•é‡‘å…¸08-11-ç¡¬å¸/","link":"","permalink":"https://www.codetool.top/article/%E7%A8%8B%E5%BA%8F%E5%91%98%E9%9D%A2%E8%AF%95%E9%87%91%E5%85%B808-11-%E7%A1%AC%E5%B8%81/","excerpt":"","text":"1 åŸé¢˜ï¼ˆæ¥æºLeetcodeï¼‰ç¡¬å¸ã€‚ç»™å®šæ•°é‡ä¸é™çš„ç¡¬å¸ï¼Œå¸å€¼ä¸º25åˆ†ã€10åˆ†ã€5åˆ†å’Œ1åˆ†ï¼Œç¼–å†™ä»£ç è®¡ç®—nåˆ†æœ‰å‡ ç§è¡¨ç¤ºæ³•ã€‚(ç»“æœå¯èƒ½ä¼šå¾ˆå¤§ï¼Œä½ éœ€è¦å°†ç»“æœæ¨¡ä¸Š1000000007) ç¤ºä¾‹ 1: è¾“å…¥: n = 5è¾“å‡º: 2è§£é‡Š: æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥å‡‘æˆæ€»é‡‘é¢:5=55=1+1+1+1+1 ç¤ºä¾‹ 2: è¾“å…¥: n = 10è¾“å‡º: 4è§£é‡Š: æœ‰å››ç§æ–¹å¼å¯ä»¥å‡‘æˆæ€»é‡‘é¢:10=1010=5+510=5+1+1+1+1+110=1+1+1+1+1+1+1+1+1+1 2 è§£æ³•2.1 æ€æƒ³åŠ¨æ€è§„åˆ’ï¼Œä¸è¿‡éœ€è¦æ³¨æ„æ’åˆ—ç»„åˆå»é‡ 2.2 ä»£ç å¸¸è§é”™è¯¯æ˜¯ï¼š class Solution { public int waysToChange(int n) { int[] dp = new int[n + 1]; int[] coins = new int[]{1,5,10,25}; for(int i = 1; i &lt;= n; i++) { for(int coin: coins) { if(i - coin &lt; 0) break; dp[i] = (dp[i] + dp[i - coin]) % 1000000007; } } return dp[n]; } } ç„¶è€Œå´å¿½ç•¥äº†é‡å¤çš„æƒ…å†µï¼Œä¾‹å¦‚6å¯ä»¥ç”±1+5ç»„åˆæ¥ï¼Œä¹Ÿå¯ä»¥ç”±5+1ç»„åˆæ¥ã€‚ æ­£ç¡®çš„ç­”æ¡ˆå…¶å®åªæ˜¯å°†å†…å¤–å¾ªç¯æ¢äº†ä¸ªé¡ºåºï¼Œä¿è¯è¿™äº›æ•°å­—æ˜¯æŒ‰é€’å¢çš„æ–¹å¼ç»„åˆçš„ï¼Œå°±èƒ½åšåˆ°å»é‡ã€‚ï¼š class Solution { public int waysToChange(int n) { int[] dp = new int[n + 1]; int[] coins = new int[]{1,5,10,25}; for(int coin : coins) { for(int i = coin; i &lt;= n; i++) { dp[i] = (dp[i] + dp[i - coin]) % 1000000007; } } return dp[n]; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode199-äºŒå‰æ ‘çš„å³è§†å›¾","slug":"leetcode199-äºŒå‰æ ‘çš„å³è§†å›¾","date":"2020-04-22T04:20:57.000Z","updated":"2020-04-22T05:01:54.897Z","comments":true,"path":"article/leetcode199-äºŒå‰æ ‘çš„å³è§†å›¾/","link":"","permalink":"https://www.codetool.top/article/leetcode199-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E5%8F%B3%E8%A7%86%E5%9B%BE/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€æ£µäºŒå‰æ ‘ï¼Œæƒ³è±¡è‡ªå·±ç«™åœ¨å®ƒçš„å³ä¾§ï¼ŒæŒ‰ç…§ä»é¡¶éƒ¨åˆ°åº•éƒ¨çš„é¡ºåºï¼Œè¿”å›ä»å³ä¾§æ‰€èƒ½çœ‹åˆ°çš„èŠ‚ç‚¹å€¼ã€‚ ç¤ºä¾‹ï¼š è¾“å…¥:&nbsp;[1,2,3,null,5,null,4] è¾“å‡º:&nbsp;[1, 3, 4] è§£é‡Š: 1 &lt;--- / \\ 2 3 &lt;--- \\ \\ 5 4 &lt;--- pre,pre>*{ color:#e8eaf6; } 2 è§£æ³•2.1 æ€æƒ³dfsï¼Œæ³¨æ„æŸ¥æ‰¾é¡ºåºå³å¯ï¼Œç”¨listå­˜å‚¨ç­”æ¡ˆä¸‹æ ‡ä»£è¡¨å±‚æ•°ï¼Œåæ‰¾åˆ°çš„ä¸ä¼šè¦†ç›–å…ˆæ‰¾åˆ°çš„ 2.2 ä»£ç class Solution { List&lt;Integer> ans; public List&lt;Integer> rightSideView(TreeNode root) { ans = new ArrayList&lt;>(); dfs(root,1); return ans; } public void dfs(TreeNode node,int depth){ if(node==null) return; if(ans.size()&lt;depth){ ans.add(node.val); } dfs(node.right,depth+1); dfs(node.left,depth+1); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ“ä½œç³»ç»Ÿå¤ä¹ 03-åŒæ­¥ã€é€šä¿¡ä¸æ­»é”","slug":"æ“ä½œç³»ç»Ÿå¤ä¹ 03-åŒæ­¥ã€é€šä¿¡ä¸æ­»é”","date":"2020-04-21T17:02:02.000Z","updated":"2020-04-22T07:41:59.655Z","comments":true,"path":"article/æ“ä½œç³»ç»Ÿå¤ä¹ 03-åŒæ­¥ã€é€šä¿¡ä¸æ­»é”/","link":"","permalink":"https://www.codetool.top/article/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A003-%E5%90%8C%E6%AD%A5%E3%80%81%E9%80%9A%E4%BF%A1%E4%B8%8E%E6%AD%BB%E9%94%81/","excerpt":"","text":"1 å¹¶å‘è¿›ç¨‹ 1.1 é¡ºåºç¨‹åºè®¾è®¡é¡ºåºç¨‹åºè®¾è®¡æ˜¯æŠŠä¸€ä¸ªç¨‹åºè®¾è®¡æˆä¸€ä¸ªé¡ºåºæ‰§è¡Œçš„ç¨‹åºæ¨¡å—ï¼Œé¡ºåºçš„å«ä¹‰ä¸ä½†æŒ‡ä¸€ä¸ªç¨‹åºæ¨¡å—å†…éƒ¨ï¼Œä¹ŸæŒ‡ä¸¤ä¸ªç¨‹åºæ¨¡å—ä¹‹é—´ã€‚ é¡ºåºç¨‹åºè®¾è®¡çš„ç‰¹ç‚¹ï¼š ç¨‹åºæ‰§è¡Œçš„é¡ºåºæ€§ ç¨‹åºç¯å¢ƒçš„å°é—­æ€§ï¼šè¿è¡Œç¨‹åºç‹¬å å…¨éƒ¨èµ„æºï¼Œé™¤åˆå§‹çŠ¶æ€å¤–ï¼Œå…¶æ‰€å¤„çš„ç¯å¢ƒç”±ç¨‹åºæœ¬èº«å†³å®šï¼Œåªæœ‰ç¨‹åºæœ¬èº«çš„åŠ¨ä½œæ‰èƒ½æ”¹å˜å…¶ç¯å¢ƒ æ‰§è¡Œç»“æœçš„ç¡®å®šæ€§ï¼šç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­å…è®¸è¢«ä¸­æ–­ï¼Œä½†è¿™ç§ä¸­æ–­å¯¹ç¨‹åºçš„æœ€ç»ˆç»“æœæ— å½±å“ï¼Œä¹Ÿå³ç¨‹åºçš„æ‰§è¡Œç»“æœä¸å®ƒçš„æ‰§è¡Œé€Ÿç‡æ— å…³ è®¡ç®—è¿‡ç¨‹çš„å¯å†ç°æ€§ï¼šåœ¨åŒä¸€ä¸ªæ•°æ®é›†åˆä¸Šé‡å¤æ‰§è¡Œä¸€ä¸ªç¨‹åºä¼šå¾—åˆ°ç›¸åŒç»“æœï¼Œå› è€Œé”™è¯¯ä¹Ÿå¯ä»¥é‡ç°ï¼Œä¾¿äºåˆ†æ 1.2 å¹¶å‘ç¨‹åºè®¾è®¡1.2.1 ç¨‹åºå¹¶å‘æœºåˆ¶è¿›ç¨‹æ‰§è¡Œçš„å¹¶å‘æ€§ï¼š ä¸€ç»„è¿›ç¨‹çš„æ‰§è¡Œåœ¨æ—¶é—´ä¸Šæ˜¯é‡å çš„ã€‚ï¼ˆå’Œå¹¶è¡ŒåŒºåˆ†å¼€ï¼‰ ä»å®è§‚ä¸Šçœ‹ï¼Œå¹¶å‘æ€§åæ˜ ä¸€ä¸ªæ—¶é—´æ®µä¸­å‡ ä¸ªè¿›ç¨‹éƒ½åœ¨åŒä¸€å¤„ç†å™¨ä¸Šï¼Œå¤„äºè¿è¡Œè¿˜æœªè¿è¡Œç»“æŸçŠ¶æ€ã€‚ ä»å¾®è§‚ä¸Šçœ‹ï¼Œä»»ä¸€æ—¶åˆ»ä»…æœ‰ä¸€ä¸ªè¿›ç¨‹åœ¨å¤„ç†å™¨ä¸Šè¿è¡Œã€‚ å¹¶å‘çš„å®è´¨æ˜¯ä¸€ä¸ªå¤„ç†å™¨åœ¨å‡ ä¸ªè¿›ç¨‹ä¹‹é—´çš„å¤šè·¯å¤ç”¨ï¼Œå¹¶å‘æ˜¯å¯¹æœ‰é™çš„ç‰©ç†èµ„æºå¼ºåˆ¶è¡Œä½¿å¤šç”¨æˆ·å…±äº«ï¼Œæ¶ˆé™¤è®¡ç®—æœºéƒ¨ä»¶ä¹‹é—´çš„äº’ç­‰ç°è±¡ï¼Œä»¥æé«˜ç³»ç»Ÿèµ„æºåˆ©ç”¨ç‡ã€‚ 1.2.2 å¹¶å‘è¿›ç¨‹çš„ç‰¹æ€§å¹¶å‘è¿›ç¨‹ä¹‹é—´çš„å…³ç³»åˆ†ä¸ºä¸¤ç±»ï¼šæ— å…³çš„å’Œäº¤äº’çš„ æ— å…³çš„å¹¶å‘è¿›ç¨‹ï¼š ä¸€ç»„å¹¶å‘è¿›ç¨‹åˆ†åˆ«åœ¨ä¸åŒçš„å˜é‡é›†åˆä¸Šæ“ä½œï¼Œä¸€ä¸ªè¿›ç¨‹çš„æ‰§è¡Œä¸å…¶ä»–å¹¶å‘è¿›ç¨‹çš„è¿›å±•æ— å…³ï¼Œå³ä¸€ä¸ªå¹¶å‘ï¼Œè¿›ç¨‹ä¸ä¼šæ”¹å˜å¦ä¸€ä¸ªå¹¶å‘è¿›ç¨‹çš„å˜é‡å€¼ã€‚ äº¤äº’çš„å¹¶å‘è¿›ç¨‹ï¼š ä¸€ç»„å¹¶å‘è¿›ç¨‹å…±äº«æŸäº›å˜é‡ï¼Œä¸€ä¸ªè¿›ç¨‹çš„æ‰§è¡Œå¯èƒ½å½±å“å…¶ä»–å¹¶å‘è¿›ç¨‹çš„æ‰§è¡Œç»“æœã€‚äº¤äº’çš„å¹¶å‘è¿›ç¨‹ä¹‹é—´å…·æœ‰åˆ¶çº¦å…³ç³»ï¼Œè¿™ç§äº¤äº’å¿…é¡»æ˜¯æœ‰æ§åˆ¶çš„,å¦åˆ™ä¼šå‡ºç°ä¸æ­£ç¡®çš„ç»“æœã€‚ å¯¹äºä¸€ç»„äº¤äº’çš„å¹¶å‘è¿›ç¨‹ï¼Œè‹¥æ‰§è¡Œçš„ç›¸å¯¹é€Ÿåº¦æ— æ³•ç›¸äº’æ§åˆ¶ï¼Œåˆ™å„ç§ä¸æ—¶é—´æœ‰å…³çš„é”™è¯¯å°±å¯èƒ½å‡ºç°ã€‚ä¸æ—¶é—´æœ‰å…³çš„é”™è¯¯æœ‰ä¸¤ç§è¡¨ç°å½¢å¼: ç»“æœä¸å”¯ä¸€ æ°¸è¿œç­‰å¾… å¹¶å‘å¤šé“ç¨‹åºçš„ä¼˜ç‚¹ï¼š å¯¹äºå•å¤„ç†å™¨ç³»ç»Ÿï¼Œå¯è®©å¤„ç†å™¨å’Œå„I/Oè®¾å¤‡åŒæ—¶å·¥ä½œ,å‘æŒ¥ç¡¬éƒ¨ä»¶çš„å¹¶è¡Œèƒ½åŠ›ã€‚ å¯¹äºå¤šå¤„ç†å™¨ç³»ç»Ÿï¼Œå¯è®©å„è¿›ç¨‹åœ¨ä¸åŒå¤„ç†å™¨ä¸Šç‰©ç†åœ°å¹¶è¡Œï¼ŒåŠ å¿«è®¡ç®—é€Ÿåº¦ã€‚ ç®€åŒ–ç¨‹åºè®¾è®¡ä»»åŠ¡ã€‚ å¹¶å‘ç¨‹åºè®¾è®¡çš„ç‰¹å¾ï¼š å¹¶è¡Œæ€§ï¼šè¿›ç¨‹çš„æ‰§è¡Œåœ¨æ—¶é—´ä¸Šå¯ä»¥é‡å ï¼Œåœ¨å•å¤„ç†å™¨ç³»ç»Ÿä¸­å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œåœ¨å¤šå¤„ç†å™¨ç¯å¢ƒä¸­å¯ä»¥å¹¶è¡Œæ‰§è¡Œ å…±äº«æ€§ï¼šå¹¶å‘è¿›ç¨‹é€šè¿‡å¼•ç”¨å…±äº«å˜é‡äº¤æ¢ä¿¡å·ï¼Œä»è€Œï¼Œç¨‹åºè¿è¡Œçš„ç¯å¢ƒä¸å†æ˜¯å°é—­çš„ åˆ¶çº¦æ€§ï¼šè¿›ç¨‹å¹¶å‘æ‰§è¡Œæˆ–ååŒå®ŒæˆåŒä¸€ä»»åŠ¡æ—¶ï¼Œä¼šäº§ç”Ÿç›¸äº’åˆ¶çº¦å…³ç³»ï¼Œå¿…é¡»å¯¹å®ƒä»¬å¹¶å‘æ‰§è¡Œçš„æ¬¡åºåŠ ä»¥åè°ƒ äº¤äº’æ€§ï¼šç”±äºå¹¶å‘è¿›ç¨‹å…±äº«æŸäº›å˜é‡ï¼Œæ‰€ä»¥ï¼Œä¸€ä¸ªè¿›ç¨‹çš„æ‰§è¡Œå¯èƒ½å½±å“å…¶ä»–è¿›ç¨‹çš„æ‰§è¡Œç»“æœï¼Œç¨‹åºè¿è¡Œç»“æœå¯èƒ½ä¸ç¡®å®šï¼Œè®¡ç®—è¿‡ç¨‹å…·æœ‰ä¸å¯å†ç°æ€§ã€‚å› æ­¤ï¼Œè¿™ç§äº¤äº’å¿…é¡»æ˜¯æœ‰æ§åˆ¶çš„ï¼Œå¦åˆ™ä¼šå‡ºç°ä¸æ­£ç¡®çš„ç»“æœ 1.2.3 è¿›ç¨‹çš„äº¤äº’äº¤äº’è¿›ç¨‹æœ‰ä¸¤ç§å…³ç³»ï¼š ç«äº‰å…³ç³»ï¼šç³»ç»Ÿä¸­çš„å¤šä¸ªè¿›ç¨‹ä¹‹é—´å½¼æ­¤æ— å…³ï¼Œç›¸äº’å¹¶ä¸çŸ¥é“å…¶å®ƒè¿›ç¨‹çš„å­˜åœ¨ï¼Œç›¸äº’ä¹‹é—´å¹¶ä¸äº¤æ¢ä¿¡æ¯ã€‚ä½†æ˜¯ç”±äºè¿™äº›è¿›ç¨‹å…±ç”¨äº†ä¸€å¥—è®¡ç®—æœºç³»ç»Ÿèµ„æº,å› è€Œå¿…ç„¶äº§ç”Ÿç«äº‰èµ„æºçš„é—®é¢˜ï¼Œä¸€ä¸ªè¿›ç¨‹çš„æ‰§è¡Œå¯èƒ½å½±å“åˆ°åŒå…¶ç«äº‰èµ„æºçš„å…¶å®ƒè¿›ç¨‹ã€‚æ“ä½œç³»ç»Ÿå¿…é¡»åè°ƒå¥½è¯¸è¿›ç¨‹å¯¹èµ„æºçš„äº‰ç”¨ã€‚ä¸€æ—¦ä¸€ä¸ªè¿›ç¨‹è¦ä½¿ç”¨å·²åˆ†é…ç»™å¦ä¸€ä¸ªè¿›ç¨‹çš„èµ„æºï¼Œåˆ™è¯¥è¿›ç¨‹å¿…é¡»ç­‰å¾…ã€‚èµ„æºç«äº‰äº§ç”Ÿä¸¤ä¸ªé—®é¢˜: ä¸€ä¸ªæ˜¯æ­»é”(Deadlock)é—®é¢˜ï¼Œå°±æ˜¯ä¸€ç»„è¿›ç¨‹å¦‚æœéƒ½è·å¾—äº†éƒ¨åˆ†èµ„æºï¼Œè¿˜æƒ³è¦å¾—åˆ°å…¶ä»–è¿›ç¨‹æ‰€å ç”¨çš„èµ„æºï¼Œæœ€ç»ˆæ‰€æœ‰è¿›ç¨‹éƒ½å°†é™·å…¥æ­»é” ä¸€ä¸ªæ˜¯é¥¥é¥¿(Starvation)é—®é¢˜ï¼Œæ˜¯æŒ‡ä¸€ä¸ªè¿›ç¨‹ç”±äºå…¶å®ƒè¿›ç¨‹æ€»æ˜¯ä¼˜å…ˆäºå®ƒè€Œè¢«æ— é™æœŸæ‹–å»¶ æ—¢è¦è§£å†³é¥¥é¥¿é—®é¢˜ï¼Œåˆè¦è§£å†³æ­»é”é—®é¢˜ã€‚è§£å†³é¥¥é¥¿é—®é¢˜çš„æœ€ç®€å•ç­–ç•¥æ˜¯FCFSèµ„æºåˆ†é…ç­–ç•¥ ç«äº‰å…³ç³»çš„è¿›ç¨‹ä½¿ç”¨åŒä¸€èµ„æºæ—¶ï¼ŒåŒä¸€æ—¶åˆ»æœ€å¤šåªå…è®¸ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œå…¶ä»–è¿›ç¨‹å¿…é¡»ç­‰å¾…ï¼Œæˆ‘ä»¬ç§°è¿™ç§ç°è±¡ä¸ºè¿›ç¨‹äº’æ–¥ã€‚ åä½œå…³ç³»ï¼šæŸäº›è¿›ç¨‹ä¸ºå®ŒæˆåŒä¸€ä»»åŠ¡éœ€è¦åˆ†å·¥åä½œï¼Œç”±äºåˆä½œçš„æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æ˜¯ç‹¬ç«‹åœ°ä»¥ä¸å¯é¢„çŸ¥çš„é€Ÿåº¦æ¨è¿›ï¼Œè¿™å°±éœ€è¦ç›¸äº’åä½œçš„è¿›ç¨‹åœ¨æŸäº›åè°ƒç‚¹ä¸Šåè°ƒå„è‡ªçš„å·¥ä½œã€‚å½“åä½œè¿›ç¨‹ä¸­çš„ä¸€ä¸ªåˆ°è¾¾åè°ƒç‚¹åï¼Œåœ¨å°šæœªå¾—åˆ°å…¶ä¼™ä¼´è¿›ç¨‹å‘æ¥çš„æ¶ˆæ¯æˆ–ä¿¡å·ä¹‹å‰åº”é˜»å¡è‡ªå·±ï¼Œç›´åˆ°å…¶ä»–åˆä½œè¿›ç¨‹å‘æ¥åè°ƒä¿¡å·æˆ–æ¶ˆæ¯åæ‰è¢«å”¤é†’å¹¶ç»§ç»­æ‰§è¡Œã€‚è¿™ç§åä½œè¿›ç¨‹ä¹‹é—´ç›¸äº’ç­‰å¾…å¯¹æ–¹æ¶ˆæ¯æˆ–ä¿¡å·çš„åè°ƒå…³ç³»ç§°ä¸ºè¿›ç¨‹åŒæ­¥ è¿›ç¨‹é—´çš„åä½œå¯ä»¥æ˜¯åŒæ–¹ä¸çŸ¥é“å¯¹æ–¹åå­—çš„é—´æ¥åä½œï¼ˆå¦‚å¤šä¸ªè¿›ç¨‹é€šè¿‡è®¿é—®ä¸€ä¸ªå…¬å…±ç¼“å†²åŒºè¿›è¡Œæ¾æ•£å¼åä½œï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯åŒæ–¹çŸ¥é“å¯¹æ–¹åå­—çš„ç›´æ¥åä½œï¼Œè¿›ç¨‹é—´é€šè¿‡é€šä¿¡æœºåˆ¶ç´§å¯†åä½œã€‚ 2 ä¸´ç•ŒåŒºç®¡ç† 2.1 äº’æ–¥ä¸ä¸´ç•ŒåŒºå¹¶å‘è¿›ç¨‹ä¸­ä¸å…±äº«å˜é‡æœ‰å…³çš„ç¨‹åºæ®µå«â€œä¸´ç•ŒåŒºâ€ï¼Œ å…±äº«å˜é‡ä»£è¡¨çš„èµ„æºå«â€œä¸´ç•Œèµ„æºâ€ã€‚ ä¸åŒä¸€å˜é‡æœ‰å…³çš„ä¸´ç•ŒåŒºåˆ†æ•£åœ¨å„è¿›ç¨‹çš„ç¨‹åºæ®µä¸­ï¼Œè€Œå„è¿›ç¨‹çš„æ‰§è¡Œé€Ÿåº¦ä¸å¯é¢„çŸ¥ã€‚å¦‚æœèƒ½ä¿è¯è¿›ç¨‹åœ¨ä¸´ç•ŒåŒºæ‰§è¡Œæ—¶ï¼Œä¸è®©å¦ä¸€ä¸ªè¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒºï¼Œå³å„è¿›ç¨‹å¯¹å…±äº«å˜é‡çš„è®¿é—®æ˜¯äº’æ–¥çš„ï¼Œå°±ä¸ä¼šé€ æˆä¸æ—¶é—´æœ‰å…³çš„é”™è¯¯ 2.2 ä¸´ç•ŒåŒºè°ƒåº¦åŸåˆ™ ä¸€æ¬¡è‡³å¤šä¸€ä¸ªè¿›ç¨‹èƒ½å¤Ÿè¿›å…¥ä¸´ç•ŒåŒºå†…æ‰§è¡Œ å¦‚æœå·²æœ‰è¿›ç¨‹åœ¨ä¸´ç•ŒåŒºï¼Œå…¶ä»–è¯•å›¾è¿›å…¥çš„è¿›ç¨‹åº”ç­‰å¾… è¿›å…¥ä¸´ç•ŒåŒºå†…çš„è¿›ç¨‹åº”åœ¨æœ‰é™æ—¶é—´å†…é€€å‡ºï¼Œä»¥ä¾¿è®©ç­‰å¾…è¿›ç¨‹ä¸­çš„ä¸€ä¸ªè¿›å…¥ ä¸´ç•ŒåŒºè°ƒåº¦åŸåˆ™å¯æ€»ç»“ä¸ºï¼š äº’æ–¥ä½¿ç”¨ã€æœ‰ç©ºè®©è¿›ï¼Œå¿™åˆ™ç­‰å¾…ã€æœ‰é™ç­‰å¾…ï¼Œæ‹©ä¸€è€Œå…¥ã€ç®—æ³•å¯è¡Œã€‚ ç®—æ³•å¯è¡Œæ˜¯æŒ‡ä¸èƒ½å› ä¸ºæ‰€é€‰çš„è°ƒåº¦ç­–ç•¥é€ æˆè¿›ç¨‹é¥¥é¥¿ç”šè‡³æ­»é”ã€‚ 2.3 è½¯ä»¶ç®¡ç†ä¸´ç•ŒåŒºè½¯ä»¶æ–¹æ³•æ˜¯ä¸ºåœ¨å…·æœ‰ä¸€ä¸ªå¤„ç†å™¨æˆ–å…±äº«ä¸»å­˜çš„å¤šå¤„ç†å™¨ä¸Šæ‰§è¡Œçš„å¹¶å‘è¿›ç¨‹å®ç°çš„ï¼Œè¿™ç§æ–¹æ³•å‡å®šå¯¹ä¸»å­˜ä¸­åŒä¸€ä¸ªå•å…ƒçš„åŒæ—¶è®¿é—®å¿…å®šç”±å­˜å‚¨å™¨è¿›è¡Œä»²è£ï¼Œä½¿å…¶ä¸²è¡ŒåŒ–ã€‚ ä¸´ç•ŒåŒºç®¡ç†çš„å°è¯•ï¼šï¼ˆä¸‹é¢æ˜¯ä¸€æ®µä¼ªä»£ç ï¼ŒéCè¯­è¨€ï¼‰ bool inside1=false; /*P1ä¸åœ¨å…¶ä¸´ç•ŒåŒºå†…*/ bool inside2=false; /*P2ä¸åœ¨å…¶ä¸´ç•ŒåŒºå†…*/ cobegin /*cobeginå’Œcoendè¡¨ç¤ºæ‹¬å·ä¸­çš„è¿›ç¨‹æ˜¯ä¸€ç»„å¹¶å‘è¿›ç¨‹*/ process P1() { while(inside2);/*ç­‰å¾…*/ inside1=true; /*ä¸´ç•ŒåŒº*/ inside1=false; } process P2() { while(inside1); /*ç­‰å¾…*/ inside2=true; /*ä¸´ç•ŒåŒº*/; inside2=false; } coend è¿™ç§æ–¹æ³•çœ‹ä¼¼æ²¡æœ‰é—®é¢˜ï¼Œå®åˆ™æ˜¯é”™è¯¯çš„ï¼Œ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç”±äºP1æ‰§è¡Œçš„æ—¶å€™å°†inside1è®¾ä¸ºtrueå­˜åœ¨ä¸€å®šçš„æ—¶é—´å»¶è¿Ÿï¼ˆå’Œä¸Šä¸€ä¸ªæ“ä½œä¸æ˜¯åŸå­çš„ï¼‰ï¼Œåœ¨è¿™æ®µå»¶è¿Ÿçš„æ—¶é—´å†…ï¼ŒP2å‘ç°inside1ä»ä¸ºfalseï¼Œäºæ˜¯ä¹Ÿè¿›å…¥ä¸´ç•ŒåŒºæ‰§è¡Œã€‚å‡ºç°äº†ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶è¿›å…¥ä¸´ç•ŒåŒºçš„æƒ…å†µã€‚ æ­¤å¤–è¿˜æœ‰å¯èƒ½P1åœ¨ä¸´ç•ŒåŒºå†…å¤±è´¥ï¼ˆå¼‚å¸¸ï¼‰ï¼Œå¯¼è‡´æ— æ³•å°†inside1ç½®ä¸ºfalseï¼Œä½¿å¾—å…¶ä»–è¿›ç¨‹å†ä¹Ÿæ— æ³•è¿›å…¥ä¸´ç•ŒåŒºã€‚ é™¤æ­¤ä¹‹å¤–è¿˜å‡ºç°äº†è®¸å¤šå°è¯•ï¼Œä½†ä»å­˜åœ¨ä¸€äº›æ— æ³•è§£å†³çš„é—®é¢˜ã€‚ åæ¥å‡ºç°äº†ä¸¤ä¸ªçœŸæ­£å®ç°äº†ä¸´ç•ŒåŒºç®¡ç†çš„è½¯ä»¶æ–¹æ³•ï¼šDekkerç®—æ³•å’ŒPetersonç®—æ³•ã€‚ç”±äºè½¯ä»¶å®ç°ä¸´ç•ŒåŒºç®¡ç†ä¹Ÿä¸æ˜¯ä¸»æµï¼Œè¿™é‡Œä¸é‡ç‚¹ç ”ç©¶äº†ã€‚ Dekkerç®—æ³•çš„å®ç°ï¼šï¼ˆä¸‹é¢ä¸¤æ®µä»£ç æ¥è‡ª https://blog.csdn.net/JustJavaC2016/article/details/78660768ï¼‰ #include&lt;stdio.h> #include&lt;stdlib.h> #include&lt;pthread.h> #define true 1 #define false 0 typedef int bool; bool flag[2]; int turn; void visit(int num) { sleep(1); printf(\"P%d is visting\\n\",num); } void P0() { while(true) { flag[0] = true;//P0æƒ³ä½¿ç”¨å…³é”®åŒºã€‚ while(flag[1])//æ£€æŸ¥P1æ˜¯ä¸æ˜¯ä¹Ÿæƒ³ç”¨ï¼Ÿ { if(turn == 1)//å¦‚æœP1æƒ³ç”¨ï¼Œåˆ™æŸ¥çœ‹P1æ˜¯å¦å…·æœ‰è®¿é—®æƒé™ï¼Ÿ { flag[0] = false;//å¦‚æœæœ‰ï¼Œåˆ™P0æ”¾å¼ƒã€‚ while(turn == 1);//æ£€æŸ¥turnæ˜¯å¦å±äºP1ã€‚ flag[0] = true;//P0æƒ³ä½¿ç”¨ã€‚ } } visit(0); //è®¿é—®Critical Partitionã€‚ turn = 1; //è®¿é—®å®Œæˆï¼Œå°†æƒé™ç»™P1ã€‚ flag[0] = false;//P0ç»“æŸä½¿ç”¨ã€‚ } } void P1() { while(true) { flag[1] = true; //P1æƒ³ä½¿ç”¨å…³é”®åŒºã€‚ while(flag[0]) //æ£€æŸ¥P0æ˜¯ä¸æ˜¯ä¹Ÿæƒ³ç”¨ï¼Ÿ { if(turn == 0) //å¦‚æœP0æƒ³ç”¨ï¼Œåˆ™æŸ¥çœ‹P0æ˜¯å¦å…·æœ‰è®¿é—®æƒé™ï¼Ÿ { flag[1] = false; //å¦‚æœæœ‰ï¼Œåˆ™P1æ”¾å¼ƒã€‚ while(turn == 0); //æ£€æŸ¥turnæ˜¯å¦å±äºP1ã€‚ flag[1] = true; // P1æƒ³ä½¿ç”¨ã€‚ } } visit(1); //è®¿é—®Critical Partitionã€‚ turn = 0; //è®¿é—®å®Œæˆï¼Œå°†æƒé™ç»™P0ã€‚ flag[1] = false; //P1ç»“æŸä½¿ç”¨ã€‚ } } void main() { pthread_t t1,t2; flag[0] = flag[1] = false; turn = 0; int err; err = pthread_create(&amp;t1,NULL,(void*)P0,NULL); if(err != 0) exit(-1); err = pthread_create(&amp;t2,NULL,(void*)P1,NULL); if(err != 0 ) exit(-1); pthread_join(t1,NULL); pthread_join(t2,NULL); exit(0); } Petersonç®—æ³•çš„å®ç°ï¼š #include&lt;stdio.h> #include&lt;stdlib.h> #include&lt;pthread.h> #define true 1 #define false 0 typedef int bool; bool flag[2]; int turn; void procedure0() { while(true) { flag[0] = true; turn = 1; while(flag[1] &amp;&amp; turn == 1) //é€€å‡ºwhileå¾ªç¯çš„æ¡ä»¶å°±æ˜¯ï¼Œè¦ä¹ˆå¦ä¸€ä¸ªçº¿ç¨‹ //ä¸æƒ³è¦ä½¿ç”¨å…³é”®åŒºï¼Œè¦ä¹ˆæ­¤çº¿ç¨‹æ‹¥æœ‰è®¿é—®æƒé™ã€‚ { sleep(1); printf(\"procedure0 is waiting!\\n\"); } //critical section flag[0] = false; } } void procedure1() { while(true) { flag[1] = true; turn = 0; while(flag[0] &amp;&amp; turn == 0) { sleep(1); printf(\"procedure1 is waiting!\\n\"); } //critical section flag[1] = false; } } void main() { pthread_t t1,t2; flag[0] = flag[1] = false; int err; turn = 0; err = pthread_create(&amp;t1,NULL,(void*)procedure0,NULL); if(err != 0) exit(-1); err = pthread_create(&amp;t2,NULL,(void*)procedure1,NULL); if(err != 0 ) exit(-1); pthread_join(t1,NULL); pthread_join(t2,NULL); exit(0); } 2.4 ç¡¬ä»¶ç®¡ç†ä¸´ç•ŒåŒºä½¿ç”¨è½¯ä»¶æ–¹æ³•å®ç°è¿›ç¨‹äº’æ–¥ä½¿ç”¨ä¸´ç•Œèµ„æºæ˜¯å¾ˆå›°éš¾çš„ï¼Œä»–ä»¬é€šå¸¸èƒ½å®ç°ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´çš„äº’æ–¥ï¼Œå¾ˆéš¾æ§åˆ¶å¤šä¸ªè¿›ç¨‹çš„äº’æ–¥ã€‚ 2.4.1 å…³ä¸­æ–­å…³ä¸­æ–­æ˜¯å®ç°äº’æ–¥çš„æœ€ç®€å•æ–¹æ³•ä¹‹ä¸€ã€‚ è¿›ç¨‹åœ¨æµ‹è¯•æ ‡å¿—ä¹‹å‰ï¼Œé¦–å…ˆå…³ä¸­æ–­ï¼Œç›´åˆ°æµ‹è¯•å®Œå¹¶è®¾ç½®æ ‡å¿—ä¹‹åæ‰å¼€ä¸­æ–­ã€‚è¿›ç¨‹åœ¨ä¸´ç•ŒåŒºæ‰§è¡ŒæœŸé—´ï¼Œè®¡ç®—æœºç³»ç»Ÿä¸å“åº”ä¸­æ–­ã€‚å› æ­¤ä¸ä¼šè½¬å‘è°ƒåº¦ï¼Œä¹Ÿå°±ä¸ä¼šå¼•èµ·è¿›ç¨‹æˆ–çº¿ç¨‹åˆ‡æ¢ï¼Œæ­£åœ¨æ‰§è¡Œæ ‡å¿—æµ‹è¯•å’Œè®¾ç½®çš„è¿›ç¨‹æˆ–çº¿ç¨‹ä¸ä¼šè¢«æ‰“æ–­ï¼Œä»è€Œä¿è¯äº†äº’æ–¥ã€‚ å…³ä¸­æ–­æ–¹æ³•çš„ç¼ºç‚¹: å…³ä¸­æ–­æ—¶é—´è¿‡é•¿ä¼šå½±å“ç³»ç»Ÿæ•ˆç‡ï¼Œé™åˆ¶å¤„ç†å™¨äº¤å‰æ‰§è¡Œç¨‹åºçš„èƒ½åŠ› å…³ä¸­æ–­æ–¹æ³•ä¹Ÿä¸é€‚ç”¨äºå¤šCPUç³»ç»Ÿï¼Œå› ä¸ºåœ¨ä¸€ä¸ªå¤„ç†å™¨ä¸Šå…³ä¸­æ–­å¹¶ä¸èƒ½é˜²æ­¢è¿›ç¨‹åœ¨å…¶ä»–å¤„ç†å™¨ä¸Šæ‰§è¡Œç›¸åŒä¸´ç•ŒåŒºä»£ç  2.4.2 æµ‹è¯•å¹¶è®¾ç½®æŒ‡ä»¤å…¶å®å°±æ˜¯TestAndSetï¼ŒJava CASçš„åŸç†ï¼Œæ“ä½œç³»ç»Ÿå±‚é¢æä¾›çš„åŸå­æ“ä½œæŒ‡ä»¤ã€‚ å› ä¸ºè¯¥æŒ‡ä»¤æ˜¯åŸå­çš„ï¼Œå°±å¯ä»¥ä½¿ç”¨è¯¥æŒ‡ä»¤ç®¡ç†ä¸€ä¸ªäº’æ–¥é‡ï¼Œä»è€Œå®ç°ä¸´ç•ŒåŒºç®¡ç†ã€‚ TSæŒ‡ä»¤å®ç°ä¸´ç•ŒåŒºç®¡ç†çš„ç®—æ³•å¦‚ä¸‹ï¼šï¼ˆè‡ªæ—‹é”ï¼‰ bool s=true; cobegin process Pi() { //i=1,2,...,n while(!TS(s)); /*ä¸Šé”*/ /*ä¸´ç•ŒåŒº*/; s=true; /*å¼€é”*/ } coend 2.4.3 å¯¹æ¢æŒ‡ä»¤å¯¹æ¢æŒ‡ä»¤ï¼ˆswapï¼‰äº¤æ¢ä¸¤ä¸ªå­—çš„å†…å®¹ï¼Œåœ¨Intel 80x86ä¸­ï¼Œå¯¹æ¢æŒ‡ä»¤ç§°ä¸ºXCHGæŒ‡ä»¤ swapæŒ‡ä»¤ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯åŒæ—¶è®¾ç½®ä¸¤ä¸ªå€¼çš„åŸå­æŒ‡ä»¤å®ç°ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç”¨äºä¸´ç•ŒåŒºç®¡ç†ï¼Œæ€æƒ³ç±»ä¼¼ã€‚ è½¯ä»¶æ–¹æ³•å’Œç¡¬ä»¶æ–¹æ³•éƒ½å­˜åœ¨å¿™ç­‰é—®é¢˜ï¼ˆå½“ä¸€ä¸ªè¿›ç¨‹æ­£å¤„åœ¨æŸä¸´ç•ŒåŒºå†…ï¼Œä»»ä½•è¯•å›¾è¿›å…¥å…¶ä¸´ç•ŒåŒºçš„è¿›ç¨‹éƒ½å¿…é¡»è¿›å…¥ä»£ç è¿ç»­å¾ªç¯æµ‹è¯•ä¸€ä¸ªå˜é‡ç›´åˆ°æŸä¸ªå€¼å‡ºç°ä¸ºæ­¢ï¼‰ï¼Œæµªè´¹äº†å¤„ç†å™¨çš„æ—¶é—´ï¼Œä¸ä¼šæˆä¸ºä¸€ç§é€šç”¨çš„æ–¹æ³•ã€‚ 3 ä¿¡å·é‡ä¸PVæ“ä½œ 3.1 ä¿¡å·é‡æœºåˆ¶ç”¨æˆ·è¿›ç¨‹å¯ä»¥é€šè¿‡ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€å¯¹åŸè¯­æ¥å¯¹ä¿¡å·é‡è¿›è¡Œæ“ä½œï¼Œä»è€Œå¾ˆæ–¹ä¾¿çš„å®ç°äº†è¿›ç¨‹äº’æ–¥ã€è¿›ç¨‹åŒæ­¥ã€‚ ä¿¡å·é‡å…¶å®å°±æ˜¯ä¸€ä¸ªå˜é‡(å¯ä»¥æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯æ›´å¤æ‚çš„è®°å½•å‹å˜é‡)ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªä¿¡å·é‡æ¥è¡¨ç¤ºç³»ç»Ÿä¸­æŸç§èµ„æºçš„æ•°é‡ï¼Œæ¯”å¦‚:ç³»ç»Ÿä¸­åªæœ‰ä¸€å°æ‰“å°æœºï¼Œå°±å¯ä»¥è®¾ç½®ä¸€ä¸ªåˆå€¼ä¸º1çš„ä¿¡å·é‡ã€‚ ä¸€å¯¹åŸè¯­ï¼šwait(S)åŸè¯­å’Œsignal(S)åŸè¯­ï¼Œå¸¸ç®€ç§°ä¸ºPã€Væ“ä½œã€‚ wait(S)ç›¸å½“äºå ç”¨ä¸€ä¸ªSèµ„æºï¼Œsignal(S)ç›¸å½“äºé‡Šæ”¾ä¸€ä¸ªSèµ„æºã€‚ 3.1.1 æ•´å‹ä¿¡å·é‡ç”¨ä¸€ä¸ªæ•´æ•°å‹çš„å˜é‡ä½œä¸ºä¿¡å·é‡ï¼Œç”¨æ¥è¡¨ç¤ºç³»ç»Ÿä¸­æŸç§èµ„æºçš„æ•°é‡ã€‚ä¸‹é¢æ˜¯Pã€VåŸè¯­çš„å®ç°æ€æƒ³ï¼š int S = 1; //åˆå§‹åŒ–æ•´å‹ä¿¡å·é‡Sï¼Œè¡¨ç¤ºå½“å‰ç³»ç»Ÿä¸­å¯ç”¨çš„æ‰“å°æœºæ•° void wait(int S){ while(S&lt;=0); //å¦‚æœèµ„æºæ•°ä¸å¤Ÿï¼Œå°±ä¸€ç›´å¾ªç¯ç­‰å¾… S = S-1; //å¦‚æœèµ„æºæ•°å¤Ÿï¼Œåˆ™å ç”¨ä¸€ä¸ªèµ„æº } void signal(int S){ S = S+1; } è¿›ç¨‹Pnï¼š wait(S); //ä½¿ç”¨æ‰“å°æœºèµ„æº... signal(S); 3.1.2 è®°å½•å‹ä¿¡å·é‡ï¼ˆæ€ç»´å¯¼å›¾ä¸­çš„äºŒå€¼ä¿¡å·é‡å’Œä¸€èˆ¬ä¿¡å·é‡éƒ½æ˜¯å±äºè¿™é‡Œçš„è®°å½•å‹ä¿¡å·é‡ï¼‰ æ•´å‹ä¿¡å·é‡çš„ç¼ºé™·æ˜¯å­˜åœ¨â€œå¿™ç­‰â€é—®é¢˜ï¼Œå› æ­¤äººä»¬åˆæå‡ºäº†â€œè®°å½•å‹ä¿¡å·é‡â€ï¼Œå³ç”¨è®°å½•å‹æ•°æ®ç»“æ„è¡¨ç¤ºçš„ä¿¡å·é‡ã€‚ /*è®°å½•å‹ä¿¡å·é‡çš„å®šä¹‰*/ typedef struct { int value;//å‰©ä½™èµ„æºæ•° struct process *L;//ç­‰å¾…é˜Ÿåˆ— } semaphore; void wait(semaphore S){ S.value--; if(S.value&lt;0){ //å¦‚æœå‰©ä½™èµ„æºæ•°ä¸å¤Ÿ //ä½¿ç”¨blockåŸè¯­ä½¿è¿›ç¨‹ä»è¿è¡Œæ€è¿›å…¥é˜»å¡ //å¹¶æŠŠè¿›ç¨‹æŒ‚åˆ°ä¿¡å·é‡Sçš„ç­‰å¾…é˜Ÿåˆ—(å³é˜»å¡é˜Ÿåˆ—)ä¸­ block(S.L); } } void signal(semaphore S){ S.value++; if(S.value&lt;=0){ //é‡Šæ”¾èµ„æºåï¼Œè‹¥è¿˜æœ‰åˆ«çš„è¿›ç¨‹åœ¨ç­‰å¾…è¿™ç§èµ„æº //åˆ™ä½¿ç”¨wakeupåŸè¯­å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸ªè¿›ç¨‹ //è¯¥è¿›ç¨‹ä»é˜»å¡æ€å˜ä¸ºå°±ç»ªæ€ wakeup(S.L); } } è¿™é‡Œä¿¡å·é‡çš„è¯­ä¹‰å°±æ˜¯èµ„æºçš„ä¸ªæ•°ï¼Œå¹¶ä¸”å®ç°äº†è®©æƒç­‰å¾…ï¼Œä¸ä¼šå½¢æˆå¿™ç­‰ã€‚ 3.2 ä¿¡å·é‡æœºåˆ¶å®ç°è¿›ç¨‹äº’æ–¥æˆ‘ä»¬å¯ä»¥æŠŠä¸´ç•ŒåŒºçœ‹ä½œä¸€ç§ç‰¹æ®Šçš„èµ„æºï¼Œä¸ºä¸´ç•ŒåŒºæŠ½è±¡å‡ºä¸€ä¸ªäº’æ–¥ä¿¡å·é‡mutexï¼Œå®ƒæ˜¯äºŒå€¼çš„ï¼Œåˆå€¼ä¸º1ï¼Œä»£è¡¨åŒä¸€ä¸ªæ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªè¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒºã€‚ åœ¨è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰æ‰§è¡ŒP(mutex) åœ¨é€€å‡ºä¸´ç•ŒåŒºä¹‹åæ‰§è¡ŒV(mutex) 3.3 ä¿¡å·é‡æœºåˆ¶å®ç°è¿›ç¨‹åŒæ­¥è¿›ç¨‹åŒæ­¥é—®é¢˜è¦æ±‚å¤šä¸ªè¿›ç¨‹æŒ‰ä¸€å®šæ¬¡åºå…ˆåæ‰§è¡Œä¸€æ®µä»£ç ã€‚è¿™ä¸ªå‰é©±å…³ç³»å¯èƒ½æ˜¯è¾ƒå¤æ‚çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥ä¸ºæ¯ä¸€å¯¹å‰é©±å…³ç³»å„è®¾ç½®ä¸€ä¸ªåŒæ­¥ä¿¡å·é‡ï¼Œåˆå€¼ä¸º0ï¼Œè¦æ‰§è¡ŒæŸæ“ä½œå‰éœ€è¦å¯¹å‰é©±æ“ä½œå¯¹åº”çš„ä¿¡å·é‡è¿›è¡ŒPæ“ä½œï¼Œå½“å®Œæˆäº†å‰é©±æ“ä½œæ—¶å¯¹å¯¹åº”çš„ä¿¡å·é‡æ‰§è¡ŒVæ“ä½œã€‚ semaphore a = 0,b = 0,c = 0,d = 0,e = 0,f = 0,g = 0; P1(){ ... S1; V(a); V(b); ... } P2(){ ... P(a); S2; V(c); V(d); ... } P3(){ ... P(b); S3; V(g); ... } P4(){ ... P(c); S4; V(e); ... } P5(){ ... P(d); S5; V(f); ... } P6(){ ... P(e); P(f); P(g); S6; ... }4 ç®¡ç¨‹ 4.1 ç®¡ç¨‹å’Œæ¡ä»¶å˜é‡4.1.1 ä¸ºä»€ä¹ˆè¦å¼•å…¥ç®¡ç¨‹ä¿¡å·é‡æœºåˆ¶å­˜åœ¨çš„é—®é¢˜ï¼šç¼–å†™ç¨‹åºå›°éš¾ã€æ˜“å‡ºé”™ã€‚ ç®¡ç¨‹ï¼š æŠŠåˆ†æ•£åœ¨å„è¿›ç¨‹ä¸­çš„ä¸´ç•ŒåŒºé›†ä¸­èµ·æ¥è¿›è¡Œç®¡ç† é˜²æ­¢è¿›ç¨‹æœ‰æ„æˆ–æ— æ„çš„è¿æ³•åŒæ­¥æ“ä½œ ä¾¿äºç”¨é«˜çº§è¯­è¨€æ¥ä¹¦å†™ç¨‹åºï¼Œä¹Ÿä¾¿äºç¨‹åºæ­£ç¡®æ€§éªŒè¯ 4.1.2 ç®¡ç¨‹çš„å®šä¹‰ç®¡ç¨‹æ˜¯ç”±å±€éƒ¨äºè‡ªå·±çš„è‹¥å¹²å…¬å…±å˜é‡åŠå…¶è¯´æ˜å’Œæ‰€æœ‰è®¿é—®è¿™äº›å…¬å…±å˜é‡çš„è¿‡ç¨‹æ‰€ç»„æˆçš„è½¯ä»¶æ¨¡å—ã€‚ ç®¡ç¨‹çš„åŸºæœ¬ç‰¹å¾: å±€éƒ¨äºç®¡ç¨‹çš„æ•°æ®åªèƒ½è¢«å±€éƒ¨äºç®¡ç¨‹çš„è¿‡ç¨‹æ‰€è®¿é—® ä¸€ä¸ªè¿›ç¨‹åªæœ‰é€šè¿‡è°ƒç”¨ç®¡ç¨‹å†…çš„è¿‡ç¨‹æ‰èƒ½è¿›å…¥ç®¡ç¨‹è®¿é—®å…±äº«æ•°æ® æ¯æ¬¡ä»…å…è®¸ä¸€ä¸ªè¿›ç¨‹åœ¨ç®¡ç¨‹å†…æ‰§è¡ŒæŸä¸ªå†…éƒ¨è¿‡ç¨‹ ç®¡ç¨‹çš„å±æ€§: å…±äº«æ€§ å®‰å…¨æ€§ äº’æ–¥æ€§ 4.1.3 ç®¡ç¨‹çš„ç»“æ„ç®¡ç¨‹æ˜¯ä¸€ç§ç‰¹æ®Šçš„è½¯ä»¶æ¨¡å—ï¼Œæœ‰è¿™äº›éƒ¨åˆ†ç»„æˆ: å±€éƒ¨äºç®¡ç¨‹çš„å…±äº«æ•°æ®ç»“æ„è¯´æ˜ å¯¹è¯¥æ•°æ®ç»“æ„è¿›è¡Œæ“ä½œçš„ä¸€ç»„è¿‡ç¨‹ å¯¹å±€éƒ¨äºç®¡ç¨‹çš„å…±äº«æ•°æ®è®¾ç½®åˆå§‹å€¼çš„è¯­å¥ ç®¡ç¨‹æœ‰ä¸€ä¸ªåå­— ä¾‹å¦‚ï¼š(ä½¿ç”¨ç±»Cè¯­è¨€è¯­æ³•æ¨¡æ‹Ÿç®¡ç¨‹ç»“æ„) type ProducerConsumer = monitor{ condition full, empty;//æ¡ä»¶å˜é‡ç”¨æ¥å®ç°åŒæ­¥æ’é˜Ÿ int count=0;//ç¼“å†²åŒºä¸­çš„äº§å“æ•° void insert(Item item){//æŠŠäº§å“itemæ”¾å…¥ç¼“å†²åŒº if (count ==N) wait(full); count++; insert_item(item); if (count = 1) signal(empty); } Item remove(){//ä»ç¼“å†²åŒºä¸­å–å‡ºä¸€ä¸ªäº§å“ if (count ==0) wait(empty); count--; if(count==N-1) signal(full); return remove_item() } } //ç”Ÿäº§è€…è¿›ç¨‹ producer(){ while(1){ item = ç”Ÿäº§ä¸€ä¸ªäº§å“; ProducerConsumer.insert(item); } } //æ¶ˆè´¹è€…è¿›ç¨‹ producer(){ while(1){ item = ProducerConsumer.remove(item); æ¶ˆè´¹äº§å“item } } 4.1.4 ç®¡ç¨‹çš„æ¡ä»¶å˜é‡æ¡ä»¶å˜é‡æ˜¯å‡ºç°åœ¨ç®¡ç¨‹å†…çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œä¸”åªæœ‰åœ¨ç®¡ç¨‹ä¸­æ‰èƒ½è¢«è®¿é—®ï¼Œå®ƒå¯¹ç®¡ç¨‹å†…çš„æ‰€æœ‰è¿‡ç¨‹æ˜¯å…¨å±€çš„ï¼Œåªèƒ½é€šè¿‡ä¸¤ä¸ªåŸè¯­æ“ä½œæ¥æ§åˆ¶å®ƒã€‚ wait()ï¼šæŒ‚èµ·è°ƒç”¨è¿›ç¨‹å¹¶é‡Šæ”¾ç®¡ç¨‹ï¼Œç›´åˆ°å¦ä¸€ä¸ªè¿›ç¨‹åœ¨è¯¥æ¡ä»¶å˜é‡ä¸Šæ‰§è¡Œsignal()ã€‚ signal( )ï¼šå¦‚æœå­˜åœ¨å…¶ä»–è¿›ç¨‹ç”±äºå¯¹æ¡ä»¶å˜é‡æ‰§è¡Œwait()è€Œè¢«æŒ‚èµ·ï¼Œä¾¿é‡Šæ”¾ä¹‹ï¼›å¦‚æœæ²¡æœ‰è¿›ç¨‹åœ¨ç­‰å¾…ï¼Œé‚£ä¹ˆï¼Œä¿¡å·ä¸è¢«ä¿å­˜ã€‚ è¿™ä¸å°±æ˜¯Java sychronizedçš„monitorenterå’Œmonitorexitå—ï¼ï¼ï¼ 5 æ­»é” 5.1 æ­»é”çš„äº§ç”Ÿæ“ä½œç³»ç»Ÿä¸­çš„æ­»é”æŒ‡ï¼šå¦‚æœåœ¨ä¸€ä¸ªè¿›ç¨‹é›†åˆä¸­çš„æ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…åªèƒ½ç”±è¯¥é›†åˆä¸­çš„å…¶ä»–ä¸€ä¸ªè¿›ç¨‹æ‰èƒ½å¼•å‘çš„äº‹ä»¶ï¼Œåˆ™ç§°ä¸€ç»„è¿›ç¨‹æˆ–ç³»ç»Ÿæ­¤æ—¶å‘ç”Ÿæ­»é”ã€‚ æ­»é”äº§ç”Ÿçš„ä¾‹å­ï¼š è®¾ç³»ç»Ÿæœ‰æ‰“å°æœºã€è¯»å¡æœºå„ä¸€å°ï¼Œè¢«è¿›ç¨‹ï¼°å’Œï¼±å…±äº«ã€‚ä¸¤ä¸ªè¿›ç¨‹å¹¶å‘æ‰§è¡Œï¼ŒæŒ‰ä¸‹åˆ—æ¬¡åºè¯·æ±‚å’Œé‡Šæ”¾èµ„æºï¼š è¿›ç¨‹ï¼° è¿›ç¨‹ï¼± è¯·æ±‚è¯»å¡æœº è¯·æ±‚æ‰“å°æœº è¯·æ±‚æ‰“å°æœº è¯·æ±‚è¯»å¡æœº é‡Šæ”¾è¯»å¡æœº é‡Šæ”¾è¯»å¡æœº é‡Šæ”¾æ‰“å°æœº é‡Šæ”¾æ‰“å°æœº åœ¨PVæ“ä½œä¸­å¯¹åº” è¿›ç¨‹Q1 è¿›ç¨‹Q2 P(S1) P(S2) P(S2) P(S1) ä½¿ç”¨r1å’Œr2 ä½¿ç”¨r1å’Œr2 V(S1) V(S2); V(S2) V(S1); åœ¨ç¬¬ä¸€æ­¥ä¸­ï¼ŒåŒæ–¹éƒ½æ‹¿åˆ°äº†è¯·æ±‚çš„èµ„æºï¼Œä½†æ˜¯ç¬¬äºŒæ­¥ä¸­è¯·æ±‚çš„èµ„æºéƒ½è¢«å¯¹æ–¹æ‰€æŒæœ‰ï¼Œäºæ˜¯éƒ½åœ¨ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºï¼Œä»è€Œé™·å…¥æ­»é”ã€‚ è‹¥ç³»ç»Ÿä¸­æœ‰mä¸ªèµ„æºè¢«nä¸ªè¿›ç¨‹å…±äº«ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½è¦æ±‚ï¼«ä¸ªèµ„æºï¼Œè€Œm &lt; nÂ·Kæ—¶ï¼Œå³èµ„æºæ•°å°äºè¿›ç¨‹æ‰€è¦æ±‚çš„æ€»æ•°æ—¶ï¼Œå¦‚æœåˆ†é…ä¸å¾—å½“å°±å¯èƒ½å¼•èµ·æ­»é”ã€‚ åœ¨è‘—åçš„å“²å­¦å®¶å°±é¤é—®é¢˜ä¸­ï¼Œè‹¥äº”ä¸ªå“²å­¦å®¶åŒæ—¶æ‹¿èµ·å³æ‰‹è¾¹çš„é¤å…·ï¼Œæ­¤æ—¶å·¦æ‰‹è¾¹çš„çš„é¤å…·å°±è¢«å¦å¤–ä¸€ä¸ªå“²å­¦å®¶å ç”¨ï¼Œæ‰€æœ‰å“²å­¦å®¶éƒ½é™·å…¥äº†æ— æ­¢å¢ƒçš„ç­‰å¾…èµ„æºé‡Šæ”¾çŠ¶æ€ï¼Œå³æ­»é”ã€‚ 5.2 æ­»é”äº§ç”Ÿçš„å¿…è¦æ¡ä»¶äº§ç”Ÿæ­»é”å¿…é¡»åŒæ—¶æ»¡è¶³ä¸€ä¸‹å››ä¸ªæ¡ä»¶ï¼Œåªè¦å…¶ä¸­ä»»ä¸€æ¡ä»¶ä¸æˆç«‹ï¼Œæ­»é”å°±ä¸ä¼šå‘ç”Ÿã€‚ äº’æ–¥æ¡ä»¶ï¼šåªæœ‰å¯¹å¿…é¡»äº’æ–¥ä½¿ç”¨çš„èµ„æºçš„äº‰æŠ¢æ‰ä¼šå¯¼è‡´æ­»é”ï¼ˆå¦‚å“²å­¦å®¶çš„ç­·å­ã€æ‰“å°æœºè®¾å¤‡ï¼‰ã€‚åƒå†…å­˜ã€æ‰¬å£°å™¨è¿™æ ·å¯ä»¥åŒæ—¶è®©å¤šä¸ªè¿›ç¨‹ä½¿ç”¨çš„èµ„æºæ˜¯ä¸ä¼šå¯¼è‡´æ­»é”çš„(å› ä¸ºè¿›ç¨‹ä¸ç”¨é˜»å¡ç­‰å¾…è¿™ç§èµ„æº)ã€‚ ä¸å‰¥å¤ºæ¡ä»¶ï¼š è¿›ç¨‹æ‰€è·å¾—çš„èµ„æºåœ¨æœªä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½ç”±å…¶ä»–è¿›ç¨‹å¼ºè¡Œå¤ºèµ°ï¼Œåªèƒ½ä¸»åŠ¨é‡Šæ”¾ã€‚ è¯·æ±‚å’Œä¿æŒæ¡ä»¶ï¼š è¿›ç¨‹å·²ç»ä¿æŒäº†è‡³å°‘ä¸€ä¸ªèµ„æºï¼Œä½†åˆæå‡ºäº†æ–°çš„èµ„æºè¯·æ±‚ï¼Œè€Œè¯¥èµ„æºåˆè¢«å…¶ä»–è¿›ç¨‹å æœ‰ï¼Œæ­¤æ—¶è¯·æ±‚è¿›ç¨‹è¢«é˜»å¡ï¼Œä½†åˆå¯¹è‡ªå·±å·²æœ‰çš„èµ„æºä¿æŒä¸æ”¾ã€‚ å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼š å­˜åœ¨ä¸€ç§è¿›ç¨‹èµ„æºçš„å¾ªç¯ç­‰å¾…é“¾ï¼Œé“¾ä¸­çš„æ¯ä¸€ä¸ªè¿›ç¨‹å·²è·å¾—çš„èµ„æºåŒæ—¶è¢«ä¸‹ä¸€ä¸ªè¿›ç¨‹æ‰€è¯·æ±‚ã€‚ å½’æ ¹ç»“åº•ï¼Œå¾ªç¯ç­‰å¾…æ¡ä»¶æ˜¯å‰ä¸‰ç§æ¡ä»¶å¯¼è‡´çš„ç»“æœã€‚ 5.3 è§£å†³æ–¹æ³•5.3.1 æ­»é”é˜²æ­¢æ­»é”é˜²æ­¢å°±æ˜¯è¦ç ´åæ­»é”äº§ç”Ÿçš„å¿…è¦æ¡ä»¶ã€‚ ç ´åäº’æ–¥æ¡ä»¶ï¼š å¦‚æœæŠŠåªèƒ½äº’æ–¥ä½¿ç”¨çš„èµ„æºæ”¹é€ ä¸ºå…è®¸å…±äº«ä½¿ç”¨ï¼Œåˆ™ç³»ç»Ÿä¸ä¼šè¿›å…¥æ­»é”çŠ¶æ€ã€‚æ¯”å¦‚: æ“ä½œç³»ç»Ÿå¯ä»¥é‡‡ç”¨SPOOLingæŠ€æœ¯æŠŠç‹¬å è®¾å¤‡åœ¨é€»è¾‘ä¸Šæ”¹é€ æˆå…±äº«è®¾å¤‡ã€‚ä¾‹å¦‚ä½¿ç”¨SPOOLingæŠ€æœ¯å°†æ‰“å°æœºæ”¹é€ ä¸ºå…±äº«è®¾å¤‡ã€‚ ç ´åä¸å‰¥å¤ºæ¡ä»¶ï¼š æ–¹æ¡ˆä¸€ï¼šå½“æŸä¸ªè¿›ç¨‹è¯·æ±‚æ–°çš„èµ„æºå¾—ä¸åˆ°æ»¡è¶³æ—¶ï¼Œå®ƒå¿…é¡»ç«‹å³é‡Šæ”¾ä¿æŒçš„æ‰€æœ‰èµ„æºï¼Œå¾…ä»¥åéœ€è¦æ—¶å†é‡æ–°ç”³è¯·ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿æŸäº›èµ„æºå°šæœªä½¿ç”¨å®Œï¼Œä¹Ÿéœ€è¦ä¸»åŠ¨é‡Šæ”¾ï¼Œä»è€Œç ´åäº†ä¸å¯å‰¥å¤ºæ¡ä»¶ã€‚ æ–¹æ¡ˆäºŒï¼šå½“æŸä¸ªè¿›ç¨‹éœ€è¦çš„èµ„æºè¢«å…¶ä»–è¿›ç¨‹æ‰€å æœ‰çš„æ—¶å€™ï¼Œå¯ä»¥ç”±æ“ä½œç³»ç»ŸååŠ©ï¼Œå°†æƒ³è¦çš„èµ„æºå¼ºè¡Œå‰¥å¤ºã€‚è¿™ç§æ–¹å¼ä¸€èˆ¬éœ€è¦è€ƒè™‘å„è¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼ˆæ¯”å¦‚ï¼šå‰¥å¤ºè°ƒåº¦æ–¹å¼ï¼Œå°±æ˜¯å°†å¤„ç†æœºèµ„æºå¼ºè¡Œå‰¥å¤ºç»™ä¼˜å…ˆçº§æ›´é«˜çš„è¿›ç¨‹ä½¿ç”¨ï¼‰ è¯¥ç­–ç•¥çš„ç¼ºç‚¹ï¼š å®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚ã€‚ é‡Šæ”¾å·²è·å¾—çš„èµ„æºå¯èƒ½é€ æˆå‰ä¸€é˜¶æ®µå·¥ä½œçš„å¤±æ•ˆã€‚å› æ­¤è¿™ç§æ–¹æ³•ä¸€èˆ¬åªé€‚ç”¨äºæ˜“ä¿å­˜å’Œæ¢å¤çŠ¶æ€çš„èµ„æºï¼Œå¦‚CPUã€‚ åå¤åœ°ç”³è¯·å’Œé‡Šæ”¾èµ„æºä¼šå¢åŠ ç³»ç»Ÿå¼€é”€ï¼Œé™ä½ç³»ç»Ÿååé‡ã€‚ è‹¥é‡‡ç”¨æ–¹æ¡ˆä¸€ï¼Œæ„å‘³ç€åªè¦æš‚æ—¶å¾—ä¸åˆ°æŸä¸ªèµ„æºï¼Œä¹‹å‰è·å¾—çš„é‚£äº›èµ„æºå°±éƒ½éœ€è¦æ”¾å¼ƒï¼Œä»¥åå†é‡æ–°ç”³è¯·ã€‚å¦‚æœä¸€ç›´å‘ç”Ÿè¿™æ ·çš„æƒ…å†µï¼Œå°±ä¼šå¯¼è‡´è¿›ç¨‹é¥¥é¥¿ã€‚ ç ´åè¯·æ±‚å’Œä¿æŒæ¡ä»¶ï¼šå¯ä»¥é‡‡ç”¨é™æ€åˆ†é…æ–¹æ³•ï¼Œå³è¿›ç¨‹åœ¨è¿è¡Œå‰ä¸€æ¬¡ç”³è¯·å®Œå®ƒæ‰€éœ€è¦çš„å…¨éƒ¨èµ„æºï¼Œåœ¨å®ƒçš„èµ„æºæœªæ»¡è¶³å‰ï¼Œä¸è®©å®ƒæŠ•å…¥è¿è¡Œã€‚ ä¸€æ—¦æŠ•å…¥è¿è¡Œåï¼Œè¿™äº›èµ„æºå°±ä¸€ç›´å½’å®ƒæ‰€æœ‰ï¼Œè¯¥è¿›ç¨‹å°±ä¸ä¼šå†è¯·æ±‚åˆ«çš„ä»»ä½•èµ„æºäº†ã€‚ è¯¥ç­–ç•¥çš„ç¼ºç‚¹ï¼šæœ‰äº›èµ„æºå¯èƒ½åªéœ€è¦ç”¨å¾ˆçŸ­çš„æ—¶é—´ï¼Œå› æ­¤å¦‚æœè¿›ç¨‹çš„æ•´ä¸ªè¿è¡ŒæœŸé—´éƒ½â€“ç›´ä¿æŒç€æ‰€æœ‰èµ„æºï¼Œå°±ä¼šé€ æˆä¸¥é‡çš„èµ„æºæµªè´¹ï¼Œèµ„æºåˆ©ç”¨ç‡æä½ã€‚å¦å¤–ï¼Œè¯¥ç­–ç•¥ä¹Ÿæœ‰å¯èƒ½å¯¼è‡´æŸäº›è¿›ç¨‹é¥¥é¥¿ã€‚ ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶ï¼š å¯é‡‡ç”¨é¡ºåºèµ„æºåˆ†é…æ³•ã€‚é¦–å…ˆç»™ç³»ç»Ÿä¸­çš„èµ„æºç¼–å·ï¼Œè§„å®šæ¯ä¸ªè¿›ç¨‹å¿…é¡»æŒ‰ç¼–å·é€’å¢çš„é¡ºåºè¯·æ±‚èµ„æºï¼ŒåŒç±»èµ„æºï¼ˆå³ç¼–å·ç›¸åŒçš„èµ„æºï¼‰ä¸€æ¬¡ç”³è¯·å®Œã€‚ è¯¥ç­–ç•¥çš„ç¼ºç‚¹: ä¸æ–¹ä¾¿å¢åŠ æ–°çš„è®¾å¤‡ï¼Œå› ä¸ºå¯èƒ½éœ€è¦é‡æ–°åˆ†é…æ‰€æœ‰çš„ç¼–å· è¿›ç¨‹å®é™…ä½¿ç”¨èµ„æºçš„é¡ºåºå¯èƒ½å’Œç¼–å·é€’å¢é¡ºåºä¸ä¸€è‡´ï¼Œä¼šå¯¼è‡´èµ„æºæµªè´¹ å¿…é¡»æŒ‰è§„å®šæ¬¡åºç”³è¯·èµ„æºï¼Œç”¨æˆ·ç¼–ç¨‹éº»çƒ¦ 5.3.2 æ­»é”é¿å…æ‰€è°“å®‰å…¨åºåˆ—ï¼Œå°±æ˜¯æŒ‡å¦‚æœç³»ç»ŸæŒ‰ç…§è¿™ç§åºåˆ—åˆ†é…èµ„æºï¼Œåˆ™æ¯ä¸ªè¿›ç¨‹éƒ½èƒ½é¡ºåˆ©å®Œæˆã€‚åªè¦èƒ½æ‰¾å‡ºä¸€ä¸ªå®‰å…¨åºåˆ—ï¼Œç³»ç»Ÿå°±æ˜¯å®‰å…¨çŠ¶æ€ã€‚å½“ç„¶ï¼Œå®‰å…¨åºåˆ—å¯èƒ½æœ‰å¤šä¸ªã€‚ å¦‚æœåˆ†é…äº†èµ„æºä¹‹åï¼Œç³»ç»Ÿä¸­æ‰¾ä¸å‡ºä»»ä½•ä¸€ä¸ªå®‰å…¨åºåˆ—ï¼Œç³»ç»Ÿå°±è¿›å…¥äº†ä¸å®‰å…¨çŠ¶æ€ã€‚è¿™å°±æ„å‘³ç€ä¹‹åå¯èƒ½æ‰€æœ‰è¿›ç¨‹éƒ½æ— æ³•é¡ºåˆ©çš„æ‰§è¡Œä¸‹å»ã€‚å½“ç„¶ï¼Œå¦‚æœæœ‰è¿›ç¨‹æå‰å½’è¿˜äº†ä¸€äº›èµ„æºï¼Œé‚£ç³»ç»Ÿä¹Ÿæœ‰å¯èƒ½é‡æ–°å›åˆ°å®‰å…¨çŠ¶æ€ï¼Œä¸è¿‡æˆ‘ä»¬åœ¨åˆ†é…èµ„æºä¹‹å‰æ€»æ˜¯è¦è€ƒè™‘åˆ°æœ€åçš„æƒ…å†µã€‚ æ­»é”é¿å…å°±æ˜¯é¿å…ç³»ç»Ÿè¿›å…¥ä¸å®‰å…¨çŠ¶æ€ã€‚ é“¶è¡Œå®¶ç®—æ³•çš„æ•°æ®ç»“æ„ï¼š ä¸€ä¸ªç³»ç»Ÿæœ‰nä¸ªè¿›ç¨‹å’Œmç§ä¸åŒç±»å‹çš„èµ„æº,å®šä¹‰åŒ…å«ä»¥ä¸‹å‘é‡å’ŒçŸ©é˜µçš„æ•°æ®ç»“æ„ï¼š ç³»ç»Ÿæ¯ç±»èµ„æºæ€»æ•°ï¼šè¯¥mä¸ªå…ƒç´ çš„å‘é‡ä¸ºç³»ç»Ÿä¸­æ¯ç±»èµ„æºæ•°é‡Resource=(R1,R2,â€¦,Rm) æ¯ç±»èµ„æºæœªåˆ†é…æ•°é‡ï¼šè¯¥mä¸ªå…ƒç´ çš„å‘é‡ä¸ºç³»ç»Ÿä¸­æ¯ç±»èµ„æºå°šå¯ä¾›åˆ†é…æ•°é‡Avilable=(V1,V2,â€¦,Vm) æœ€å¤§éœ€æ±‚çŸ©é˜µï¼šæ¯ä¸ªè¿›ç¨‹å¯¹æ¯ç±»èµ„æºçš„æœ€å¤§éœ€æ±‚é‡ï¼ŒClaim[I,j]è¡¨ç¤ºè¿›ç¨‹Piéœ€Rjç±»èµ„æºæœ€å¤§æ•° åˆ†é…çŸ©é˜µï¼šè¡¨ç¤ºè¿›ç¨‹å½“å‰å·²åˆ†å¾—çš„èµ„æºæ•°ï¼ŒAllocation[i,j]è¡¨ç¤ºè¿›ç¨‹Piå·²åˆ†åˆ°Rjç±»èµ„æºä¸ªæ•° å°šéœ€çŸ©é˜µï¼šè¡¨ç¤ºè¿›ç¨‹å½“å‰å°šéœ€èµ„æºæ•°ï¼ŒNeed[i,j]è¡¨ç¤ºè¿›ç¨‹Piå°šéœ€Rjç±»èµ„æºä¸ªæ•° é“¶è¡Œå®¶ç®—æ³•ä¸­ä¸‹åˆ—å…³ç³»å¼ç¡®ä¿æˆç«‹ï¼š Ri=Vi+âˆ‘Allocation[k,i]ï¼ˆå¯¹i=1,..,m,k=1,..,nï¼‰ï¼šè¡¨ç¤ºæ‰€æœ‰èµ„æºè¦ä¹ˆå·²è¢«åˆ†é…ã€è¦ä¹ˆå°šå¯åˆ†é… Claim[k,i]â‰¤Rjï¼ˆå¯¹i=1,..,m,k=1,..,nï¼‰ï¼šè¡¨ç¤ºè¿›ç¨‹ç”³è¯·èµ„æºæ•°ä¸èƒ½è¶…è¿‡ç³»ç»Ÿæ‹¥æœ‰çš„èµ„æºæ€»æ•° Allocation[k,i] â‰¤ Claim[k,i]ï¼ˆå¯¹i=1,..,m,k=1,..,nï¼‰ï¼šè¡¨ç¤ºè¿›ç¨‹ç”³è¯·ä»»ä½•ç±»èµ„æºæ•°ä¸èƒ½è¶…è¿‡å£°æ˜çš„æœ€å¤§èµ„æºéœ€æ±‚æ•° ç³»ç»Ÿä¸­è‹¥è¦å¯åŠ¨ä¸€ä¸ªæ–°è¿›ç¨‹å·¥ä½œ,å…¶å¯¹èµ„æºRiçš„éœ€æ±‚ä»…å½“æ»¡è¶³ä¸‹åˆ—ä¸ç­‰å¼ï¼š Ri â‰¥ C[(n+1),i]+ âˆ‘C[k,i] å¯¹i=1,..,m,k=1,..,n; å³åº”æ»¡è¶³å½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰è¿›ç¨‹å¯¹èµ„æºRiçš„æœ€å¤§èµ„æºéœ€æ±‚æ•°åŠ ä¸Šå¯åŠ¨çš„æ–°è¿›ç¨‹çš„æœ€å¤§èµ„æºéœ€æ±‚æ•°ä¸è¶…è¿‡ç³»ç»Ÿæ‹¥æœ‰çš„æœ€å¤§æ•°ã€‚ ç³»ç»Ÿå®‰å…¨æ€§å®šä¹‰ï¼šåœ¨æ—¶åˆ»T0ç³»ç»Ÿæ˜¯å®‰å…¨çš„,ä»…å½“å­˜åœ¨ä¸€ä¸ªè¿›ç¨‹åºåˆ—P1,..,Pn,å¯¹è¿›ç¨‹Pkæ»¡è¶³å…¬å¼ï¼š Need[k,i] â‰¤Available [i]+ âˆ‘Allocation[j,i] å¯¹äºk=1,â€¦,n;i=1,â€¦,m; å³å¯¹ä»»ä½•ä¸€ä¸ªè¿›ç¨‹éƒ½èƒ½æ»¡è¶³å…¶æ‰€éœ€è¦çš„èµ„æºã€‚ é“¶è¡Œå®¶ç®—æ³•çš„åŸºæœ¬æ€æƒ³ï¼š ç³»ç»Ÿä¸­çš„æ‰€æœ‰è¿›ç¨‹è¿›å…¥è¿›ç¨‹é›†åˆ, åœ¨å®‰å…¨çŠ¶æ€ä¸‹ç³»ç»Ÿæ”¶åˆ°è¿›ç¨‹çš„èµ„æºè¯·æ±‚å,å…ˆæŠŠèµ„æºè¯•æ¢æ€§åˆ†é…ç»™å®ƒã€‚ ç³»ç»Ÿç”¨å‰©ä¸‹çš„å¯ç”¨èµ„æºå’Œè¿›ç¨‹é›†åˆä¸­å…¶ä»–è¿›ç¨‹è¿˜è¦çš„èµ„æºæ•°ä½œæ¯”è¾ƒï¼Œåœ¨è¿›ç¨‹é›†åˆä¸­æ‰¾åˆ°å‰©ä½™èµ„æºèƒ½æ»¡è¶³æœ€å¤§éœ€æ±‚é‡çš„è¿›ç¨‹,ä»è€Œ,ä¿è¯è¿™ä¸ªè¿›ç¨‹è¿è¡Œå®Œæ¯•å¹¶å½’è¿˜å…¨éƒ¨èµ„æºã€‚ æŠŠè¿™ä¸ªè¿›ç¨‹ä»é›†åˆä¸­å»æ‰, ç³»ç»Ÿçš„å‰©ä½™èµ„æºæ›´å¤šäº†,åå¤æ‰§è¡Œä¸Šè¿°æ­¥éª¤ã€‚ æœ€å,æ£€æŸ¥è¿›ç¨‹é›†åˆ,è‹¥ä¸ºç©ºè¡¨æ˜æœ¬æ¬¡ç”³è¯·å¯è¡Œ,ç³»ç»Ÿå¤„äºå®‰å…¨çŠ¶æ€,å¯å®æ–½æœ¬æ¬¡åˆ†é…;å¦åˆ™,æœ‰è¿›ç¨‹æ‰§è¡Œä¸å®Œï¼Œç³»ç»Ÿå¤„äºä¸å®‰å…¨çŠ¶æ€,æœ¬æ¬¡èµ„æºåˆ†é…æš‚ä¸å®æ–½,è®©ç”³è¯·è¿›ç¨‹ç­‰å¾…ã€‚ 5.3.3 æ­»é”çš„æ£€æµ‹å’Œè§£é™¤è¯¥éƒ¨åˆ†å‚è€ƒè‡ªï¼šæ­»é”çš„æ£€æµ‹å’Œè§£é™¤ è§£å†³æ­»é”é—®é¢˜çš„ä¸€æ¡é€”å¾„æ˜¯æ­»é”æ£€æµ‹å’Œè§£é™¤ï¼Œè¿™ç§æ–¹æ³•å¯¹èµ„æºçš„åˆ†é…ä¸åŠ ä»»ä½•é™åˆ¶ï¼Œä¹Ÿä¸é‡‡å–æ­»é”é¿å…æªæ–½ï¼Œä½†ç³»ç»Ÿå®šæ—¶åœ°è¿è¡Œä¸€ä¸ªâ€œæ­»é”æ£€æµ‹â€ç¨‹åºï¼Œåˆ¤æ–­ç³»ç»Ÿå†…æ˜¯å¦å·²å‡ºç°æ­»é”ï¼Œå¦‚æœæ£€æµ‹åˆ°ç³»ç»Ÿå·²å‘æ€§äº†æ­»é”ï¼Œå†é‡‡å–æªæ–½è§£é™¤å®ƒã€‚ è¿›ç¨‹-èµ„æºåˆ†é…å›¾ï¼š å¦‚å›¾æ‰€ç¤ºï¼Œç”¨åœ†åœˆä»£è¡¨ä¸€ä¸ªè¿›ç¨‹ï¼Œç”¨æ¡†ä»£è¡¨ä¸€ç±»èµ„æºã€‚ç”±äºä¸€ç§ç±»å‹çš„èµ„æºå¯èƒ½æœ‰å¤šä¸ªï¼Œç”¨æ¡†ä¸­çš„ä¸€ä¸ªç‚¹ä»£è¡¨ä¸€ç±»èµ„æºä¸­çš„ä¸€ä¸ªèµ„æºã€‚ä»è¿›ç¨‹åˆ°èµ„æºçš„æœ‰å‘è¾¹å«è¯·æ±‚è¾¹ï¼Œè¡¨ç¤ºè¯¥è¿›ç¨‹ç”³è¯·ä¸€ä¸ªå•ä½çš„è¯¥ç±»èµ„æºï¼›ä»èµ„æºåˆ°è¿›ç¨‹çš„è¾¹å«åˆ†é…è¾¹ï¼Œè¡¨ç¤ºè¯¥ç±»èµ„æºå·²ç»æœ‰ä¸€ä¸ªèµ„æºè¢«åˆ†é…ç»™äº†è¯¥è¿›ç¨‹ã€‚ å¦‚æœè¿›ç¨‹-èµ„æºåˆ†é…å›¾ä¸­æ— ç¯è·¯ï¼Œåˆ™æ­¤æ—¶ç³»ç»Ÿæ²¡æœ‰å‘ç”Ÿæ­»é”ã€‚ å¦‚æœè¿›ç¨‹-èµ„æºåˆ†é…å›¾ä¸­æœ‰ç¯è·¯ï¼Œä¸”æ¯ä¸ªèµ„æºç±»ä¸­ä»…æœ‰ä¸€ä¸ªèµ„æºï¼Œåˆ™ç³»ç»Ÿä¸­å‘ç”Ÿäº†æ­»é”ï¼Œæ­¤æ—¶ï¼Œç¯è·¯æ˜¯ç³»ç»Ÿå‘ç”Ÿæ­»é”çš„å……è¦æ¡ä»¶ï¼Œç¯è·¯ä¸­çš„è¿›ç¨‹ä¾¿ä¸ºæ­»é”è¿›ç¨‹ã€‚ å¦‚æœè¿›ç¨‹-èµ„æºåˆ†é…å›¾ä¸­æœ‰ç¯è·¯ï¼Œä¸”æ¶‰åŠçš„èµ„æºç±»ä¸­æœ‰å¤šä¸ªèµ„æºï¼Œåˆ™ç¯è·¯çš„å­˜åœ¨åªæ˜¯äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶è€Œä¸æ˜¯å……åˆ†æ¡ä»¶ã€‚å¯ä»¥ä½¿ç”¨å°†èµ„æºåˆ†é…å›¾ç®€åŒ–çš„æ–¹æ³•æ¥æ£€æµ‹ç³»ç»Ÿæ˜¯å¦å¤„äºæ­»é”çŠ¶æ€ï¼š åœ¨èµ„æºåˆ†é…å›¾ä¸­ï¼Œæ‰¾å‡ºæ—¢ä¸é˜»å¡åˆä¸æ˜¯å­¤ç‚¹çš„è¿›ç¨‹ Piï¼ˆå³æ‰¾å‡ºä¸€æ¡æœ‰å‘è¾¹ä¸å®ƒç›¸è¿ï¼Œä¸”è¯¥æœ‰å‘è¾¹å¯¹åº”èµ„æºçš„ç”³è¯·æ•°é‡å°äºç­‰äºç³»ç»Ÿä¸­å·²æœ‰ç©ºé—²èµ„æºæ•°é‡ã€‚å¦‚ä¸Šå›¾ä¸­ï¼ŒR1æ²¡æœ‰ç©ºé—²èµ„æºï¼ŒR2æœ‰ä¸€ä¸ªç©ºé—²èµ„æºã€‚è‹¥æ‰€æœ‰çš„è¿æ¥è¯¥è¿›ç¨‹çš„è¾¹å‡æ»¡è¶³ä¸Šè¿°æ¡ä»¶ï¼Œåˆ™è¿™ä¸ªè¿›ç¨‹èƒ½ç»§ç»­è¿è¡Œç›´è‡³å®Œæˆï¼Œç„¶åé‡Šæ”¾å®ƒæ‰€å æœ‰çš„æ‰€æœ‰èµ„æºï¼‰ã€‚æ¶ˆå»å®ƒæ‰€æœ‰çš„è¯·æ±‚è¾¹å’Œåˆ†é…è¾¹ï¼Œä½¿ä¹‹ç§°ä¸ºå­¤ç«‹çš„ç»“ç‚¹ã€‚åœ¨ä¸Šå›¾ä¸­ï¼ŒP1 æ˜¯æ»¡è¶³è¿™ä¸€æ¡ä»¶çš„è¿›ç¨‹ç»“ç‚¹ï¼Œäºæ˜¯å°†P1çš„æ‰€æœ‰è¾¹æ¶ˆå»ã€‚ è¿›ç¨‹ Pi æ‰€é‡Šæ”¾çš„èµ„æºï¼Œå¯ä»¥å”¤é†’æŸäº›å› ç­‰å¾…è¿™äº›èµ„æºè€Œé˜»å¡çš„è¿›ç¨‹ï¼ŒåŸæ¥çš„é˜»å¡è¿›ç¨‹å¯èƒ½å˜ä¸ºéé˜»å¡è¿›ç¨‹ã€‚åœ¨ä¸Šå›¾ä¸­ï¼ŒP2 å°±æ»¡è¶³è¿™æ ·çš„æ¡ä»¶ã€‚æ ¹æ®ä¸Šé¢çš„æ–¹æ³•è¿›è¡Œä¸€ç³»åˆ—ç®€åŒ–åï¼Œè‹¥èƒ½æ¶ˆå»é€”ä¸­æ‰€æœ‰çš„è¾¹ï¼Œåˆ™ç§°è¯¥å›¾æ˜¯å¯å®Œå…¨ç®€åŒ–çš„ã€‚ ä¸€æ—¦æ£€æµ‹å‡ºæ­»é”ï¼Œå°±åº”ç«‹å³é‡†å–ç›¸åº”çš„æªæ–½ã€‚æ­»é”è§£é™¤ç®—æ³•æœ‰ï¼š èµ„æºå‰¥å¤ºæ³•ã€‚æŒ‚èµ·æŸäº›æ­»é”è¿›ç¨‹ï¼Œå¹¶æŠ¢å å®ƒçš„èµ„æºï¼Œå°†è¿™äº›èµ„æºåˆ†é…ç»™å…¶ä»–çš„æ­»é”è¿›ç¨‹ã€‚ä½†åº”é˜²æ­¢è¢«æŒ‚èµ·çš„è¿›ç¨‹é•¿æ—¶é—´å¾—ä¸åˆ°èµ„æºï¼Œè€Œå¤„äºèµ„æºåŒ®ä¹çš„çŠ¶æ€ã€‚ æ’¤é”€è¿›ç¨‹æ³•ã€‚å¼ºåˆ¶æ’¤é”€éƒ¨åˆ†ã€ç”šè‡³å…¨éƒ¨æ­»é”è¿›ç¨‹å¹¶å‰¥å¤ºè¿™äº›è¿›ç¨‹çš„èµ„æºã€‚æ’¤é”€çš„åŸåˆ™å¯ä»¥æŒ‰è¿›ç¨‹ä¼˜å…ˆçº§å’Œæ’¤é”€è¿›ç¨‹ä»£ä»·çš„é«˜ä½è¿›è¡Œã€‚ è¿›ç¨‹å›é€€æ³•ã€‚è®©ä¸€ï¼ˆå¤šï¼‰ä¸ªè¿›ç¨‹å›é€€åˆ°è¶³ä»¥å›é¿æ­»é”çš„åœ°æ­¥ï¼Œè¿›ç¨‹å›é€€æ—¶è‡ªæ„¿é‡Šæ”¾èµ„æºè€Œä¸æ˜¯è¢«å‰¥å¤ºã€‚è¦æ±‚ç³»ç»Ÿä¿æŒè¿›ç¨‹çš„å†å²ä¿¡æ¯ï¼Œè®¾ç½®è¿˜åŸç‚¹ã€‚","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://www.codetool.top/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"}]},{"title":"leetcode239-æ»‘åŠ¨çª—å£æœ€å¤§å€¼","slug":"leetcode239-æ»‘åŠ¨çª—å£æœ€å¤§å€¼","date":"2020-04-21T06:42:49.000Z","updated":"2020-04-21T14:17:27.323Z","comments":true,"path":"article/leetcode239-æ»‘åŠ¨çª—å£æœ€å¤§å€¼/","link":"","permalink":"https://www.codetool.top/article/leetcode239-%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E6%9C%80%E5%A4%A7%E5%80%BC/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ•°ç»„ numsï¼Œæœ‰ä¸€ä¸ªå¤§å°ä¸º k çš„æ»‘åŠ¨çª—å£ä»æ•°ç»„çš„æœ€å·¦ä¾§ç§»åŠ¨åˆ°æ•°ç»„çš„æœ€å³ä¾§ã€‚ä½ åªå¯ä»¥çœ‹åˆ°åœ¨æ»‘åŠ¨çª—å£å†…çš„ k ä¸ªæ•°å­—ã€‚æ»‘åŠ¨çª—å£æ¯æ¬¡åªå‘å³ç§»åŠ¨ä¸€ä½ã€‚ è¿”å›æ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼ã€‚ è¿›é˜¶ï¼š ä½ èƒ½åœ¨çº¿æ€§æ—¶é—´å¤æ‚åº¦å†…è§£å†³æ­¤é¢˜å—ï¼Ÿ ç¤ºä¾‹ 1ï¼š è¾“å…¥: nums = [1,3,-1,-3,5,3,6,7], å’Œ k = 3 è¾“å‡º: [3,3,5,5,6,7] è§£é‡Š: æ»‘åŠ¨çª—å£çš„ä½ç½® æœ€å¤§å€¼ --------------- ----- [1 3 -1] -3 5 3 6 7 3 1 [3 -1 -3] 5 3 6 7 3 1 3 [-1 -3 5] 3 6 7 5 1 3 -1 [-3 5 3] 6 7 5 1 3 -1 -3 [5 3 6] 7 6 1 3 -1 -3 5 [3 6 7] 7 pre > *,pre,code > *{ color: #e8eaf6 } æç¤ºï¼š 1 &lt;= nums.length &lt;= 10^5 -10^4 &lt;= nums[i] &lt;= 10^4 1 &lt;= k &lt;= nums.length 2 è§£æ³•2.1 æ€æƒ³ä½¿ç”¨ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ç»´æŠ¤ä¸€ä¸ªå•è°ƒé€’å‡é˜Ÿåˆ—ï¼ˆä½†å®é™…ä¸Šå­˜æ”¾çš„æ˜¯æ•°ç»„çš„ä¸‹æ ‡ï¼‰ï¼Œæ¯æ»‘åŠ¨ä¸€æ¬¡çª—å£ï¼Œå¦‚æœè¿›æ¥çš„å…ƒç´ æ¯”é˜Ÿå°¾ä¸‹æ ‡å¯¹åº”çš„å…ƒç´ å°ï¼Œåˆ™è¿›å…¥é˜Ÿå°¾ï¼Œå¦åˆ™å°†é˜Ÿåˆ—å°¾æ¯”è¯¥å…ƒç´ å°çš„å…ƒç´ éƒ½å¼¹å‡ºï¼ˆç±»ä¼¼å•è°ƒæ ˆçš„æ€æƒ³ï¼‰ï¼Œå†è¿›å…¥é˜Ÿå°¾ï¼Œé‚£ä¹ˆä»»æ„æ—¶åˆ»é˜Ÿé¦–å…ƒç´ å³ä¸ºå½“å‰æœ€å¤§å…ƒç´ çš„ä¸‹æ ‡ï¼Œè€Œå¦‚æœæ»‘åŠ¨çª—å£åé˜Ÿé¦–å…ƒç´ çš„ä¸‹æ ‡ç­‰äºå½“å‰ä¸‹æ ‡-kï¼Œè¯´æ˜é˜Ÿé¦–å…ƒç´ è¿‡æœŸï¼Œåº”è¯¥ä»é˜Ÿåˆ—é¦–éƒ¨å¼¹å‡ºã€‚ 2.2 ä»£ç class Solution { public int[] maxSlidingWindow(int[] nums, int k) { Deque&lt;Integer> qmax = new LinkedList&lt;>(); int[] ans = new int[nums.length-k+1]; int index = 0; for(int i = 0;i&lt;nums.length;i++){ while(!qmax.isEmpty()&amp;&amp;nums[qmax.peekLast()]&lt;=nums[i]){ qmax.pollLast(); } qmax.addLast(i); if(qmax.peekFirst()==i-k){ qmax.pollFirst(); } if(i>=k-1){ ans[index++] = nums[qmax.peekFirst()]; } } return ans; } } ä¸‹é¢è¿™ç§æ–¹æ³•çš„æ€æƒ³æ˜¯è®°å½•å½“å‰çª—å£å†…æœ€å¤§å…ƒç´ çš„ä¸‹æ ‡ï¼Œå¦‚æœæ»‘å‡ºå»äº†é‡æ–°é€‰ä¸¾æœ€å¤§å€¼ï¼Œå¦‚æœæ²¡æ»‘å‡ºå»å°†è¿›æ¥çš„å…ƒç´ ä¸å½“å‰æœ€å¤§å…ƒç´ æ¯”è¾ƒã€‚å®ƒå’Œæš´åŠ›åˆä¸å¤ªä¸€æ ·ï¼Œå› ä¸ºå…¶å®é‡æ–°é€‰ä¸¾çš„æ¬¡æ•°è¾ƒå°‘ï¼Œå®é™…leetcodeä¸­è¿™ç§æ–¹æ³•åè€Œæ›´å¿«ï¼Œå¯èƒ½æ˜¯å› ä¸ºæ•°æ®é‡çš„åŸå› ï¼š class Solution { public int[] maxSlidingWindow(int[] nums, int k) { if(nums == null || nums.length == 0 || k &lt; 1)return new int[0]; if(k == 1)return nums; int[] maxes = new int[nums.length - k + 1]; int maxIdx = 0; //æ±‚å‡ºå‰kä¸ªå…ƒç´ çš„æœ€å¤§å€¼ç´¢å¼• for(int i = 1; i &lt; k; i++){ if(nums[i] > nums[maxIdx])maxIdx = i; } //liæ˜¯æ»‘åŠ¨çª—å£çš„æœ€å·¦ç«¯ for(int li = 0; li &lt; maxes.length; li++){ //riæ˜¯æ»‘åŠ¨çª—å£çš„æœ€å³ç«¯çš„ç´¢å¼• int ri = li + k- 1; if(maxIdx &lt; li){//æœ€å¤§å€¼çš„ç´¢å¼•ä¸åœ¨æ»‘åŠ¨çª—å£èŒƒå›´å†… maxIdx = li; //æ±‚å‡º[li, ri]èŒƒå›´å†…æœ€å¤§å€¼çš„ç´¢å¼• for(int i = li + 1; i &lt;= ri; i++){ if(nums[i] > nums[maxIdx])maxIdx = i; } }else if(nums[ri] >= nums[maxIdx]){//æœ€å¤§å€¼çš„ç´¢å¼•åœ¨æ»‘åŠ¨çª—å£çš„èŒƒå›´å†…ï¼Œå¹¶ä¸”å¤§äºæœ€å¤§å€¼ maxIdx = ri; } maxes[li] = nums[maxIdx]; } return maxes; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode1248-ç»Ÿè®¡ã€Œä¼˜ç¾å­æ•°ç»„ã€","slug":"leetcode1248-ç»Ÿè®¡ã€Œä¼˜ç¾å­æ•°ç»„ã€","date":"2020-04-21T05:58:06.000Z","updated":"2020-04-21T06:22:30.312Z","comments":true,"path":"article/leetcode1248-ç»Ÿè®¡ã€Œä¼˜ç¾å­æ•°ç»„ã€/","link":"","permalink":"https://www.codetool.top/article/leetcode1248-%E7%BB%9F%E8%AE%A1%E3%80%8C%E4%BC%98%E7%BE%8E%E5%AD%90%E6%95%B0%E7%BB%84%E3%80%8D/","excerpt":"","text":"1 åŸé¢˜ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•° kã€‚ å¦‚æœæŸä¸ª è¿ç»­ å­æ•°ç»„ä¸­æ°å¥½æœ‰ k ä¸ªå¥‡æ•°æ•°å­—ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºè¿™ä¸ªå­æ•°ç»„æ˜¯ã€Œä¼˜ç¾å­æ•°ç»„ã€ã€‚ è¯·è¿”å›è¿™ä¸ªæ•°ç»„ä¸­ã€Œä¼˜ç¾å­æ•°ç»„ã€çš„æ•°ç›®ã€‚ ç¤ºä¾‹ 1: è¾“å…¥ï¼š nums = [1,1,2,1,1], k = 3è¾“å‡ºï¼š 2è§£é‡Šï¼š åŒ…å« 3 ä¸ªå¥‡æ•°çš„å­æ•°ç»„æ˜¯ [1,1,2,1] å’Œ [1,2,1,1] ã€‚ ç¤ºä¾‹ 2: è¾“å…¥ï¼š nums = [2,4,6], k = 1è¾“å‡ºï¼š 0è§£é‡Šï¼š æ•°åˆ—ä¸­ä¸åŒ…å«ä»»ä½•å¥‡æ•°ï¼Œæ‰€ä»¥ä¸å­˜åœ¨ä¼˜ç¾å­æ•°ç»„ã€‚ ç¤ºä¾‹ 3ï¼š è¾“å…¥ï¼š nums = [2,2,2,1,2,2,1,2,2,2], k = 2è¾“å‡ºï¼š 16 æç¤ºï¼š 1 &lt;= nums.length &lt;= 50000 1 &lt;= nums[i] &lt;= 10^5 1 &lt;= k &lt;= nums.length 2 è§£æ³•2.1 æ€æƒ³å¯¹äºä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„æœ€å°å­æ•°ç»„ï¼Œå®ƒçš„å·¦ç•Œå’Œå³ç•Œéƒ½åº”æ°å¥½æ˜¯1ï¼Œå¹¶ä¸”åŒ…å«kä¸ªå¥‡æ•°ã€‚é‚£ä¹ˆä»è¿™ä¸ªæœ€å°å­æ•°ç»„å»¶å±•å¼€ï¼Œåªè¦æ˜¯å¶æ•°å°±å¯ä»¥å®¹çº³è¿›æ¥ï¼Œå¯ä»¥ç»„æˆçš„å­æ•°ç»„ä¸ªæ•°ä¸º å·¦è¾¹è¿ç»­å¶æ•°çš„ä¸ªæ•°+1 ä¹˜ä»¥ å³è¾¹è¿ç»­å¶æ•°çš„ä¸ªæ•°+1 ã€‚ 2.2 ä»£ç ç»Ÿè®¡å¶æ•°é—´éš”ï¼Œè¿™é‡Œæˆ‘ä»¬ç»Ÿè®¡æ¯ä¸¤ä¸ªå¥‡æ•°ä¹‹é—´ï¼ˆä¹Ÿå¯èƒ½æ˜¯ç¬¬ä¸€ä¸ªå¥‡æ•°å‰é¢æˆ–æœ€åä¸€ä¸ªå¥‡æ•°åé¢ï¼‰å¶æ•°æœ‰å¤šå°‘ä¸ªï¼Œå¹¶å°†å®ƒ+1å­˜æ”¾åˆ°listä¸­ï¼Œè¿™æ ·è¿ç»­kä¸ªå¥‡æ•°èƒ½ç»„æˆçš„å­æ•°ç»„ä¸ªæ•°ä¸ºæ•°ç»„ä¸­ç›¸éš”kçš„ä¸¤ä¸ªå…ƒç´ çš„ä¹˜ç§¯ï¼š public class Solution { public int numberOfSubarrays(int[] nums, int k) { int preEven=0; List&lt;Integer> list=new ArrayList&lt;>(); for(int i:nums){ if ((i&amp;1)==0){ preEven++; }else{ list.add(preEven+1); preEven=0; } } list.add(preEven+1); int count=0; for (int i=0;i&lt;list.size()-k;i++){ count+=(list.get(i)*list.get(i+k)); } return count; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"ç”¨ä¸€ä¸ªæ ˆå®ç°å¦ä¸€ä¸ªæ ˆçš„æ’åº","slug":"ç”¨ä¸€ä¸ªæ ˆå®ç°å¦ä¸€ä¸ªæ ˆçš„æ’åº","date":"2020-04-20T07:43:51.000Z","updated":"2020-04-20T07:53:28.822Z","comments":true,"path":"article/ç”¨ä¸€ä¸ªæ ˆå®ç°å¦ä¸€ä¸ªæ ˆçš„æ’åº/","link":"","permalink":"https://www.codetool.top/article/%E7%94%A8%E4%B8%80%E4%B8%AA%E6%A0%88%E5%AE%9E%E7%8E%B0%E5%8F%A6%E4%B8%80%E4%B8%AA%E6%A0%88%E7%9A%84%E6%8E%92%E5%BA%8F/","excerpt":"","text":"1 åŸé¢˜ï¼ˆæ¥æºç‰›å®¢ç½‘ï¼‰ä¸€ä¸ªæ ˆä¸­å…ƒç´ çš„ç±»å‹ä¸ºæ•´å‹ï¼Œç°åœ¨æƒ³å°†è¯¥æ ˆä»é¡¶åˆ°åº•æŒ‰ä»å¤§åˆ°å°çš„é¡ºåºæ’åºï¼Œåªè®¸ç”³è¯·ä¸€ä¸ªæ ˆã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¯ä»¥ç”³è¯·æ–°çš„å˜é‡ï¼Œä½†ä¸èƒ½ç”³è¯·é¢å¤–çš„æ•°æ®ç»“æ„ã€‚å¦‚ä½•å®Œæˆæ’åºï¼Ÿ 2 è§£æ³•2.1 æ€æƒ³ç”³è¯·ä¸€ä¸ªè¾…åŠ©æ ˆï¼Œåº”è®©è¯¥è¾…åŠ©æ ˆæˆä¸ºä¸€ä¸ªå•è°ƒæ ˆï¼Œå¯ä»¥è¿™æ ·åšï¼š åŸæ ˆæ¯æ¬¡å¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœæ¯”è¾…åŠ©æ ˆé¡¶å…ƒç´ å°ï¼ˆæˆ–è¾…åŠ©æ ˆå†…ä¸ºç©ºï¼‰å°±ç›´æ¥å‹å…¥è¾…åŠ©æ ˆï¼Œå¦‚æœæ¯”è¾…åŠ©æ ˆé¡¶å…ƒç´ å¤§ï¼Œåˆ™å…ˆä¿ç•™è¯¥å…ƒç´ ï¼Œå°†è¾…åŠ©æ ˆå†…çš„æ¯”è¯¥å…ƒç´ å°çš„å…ƒç´ å‹å›åŸæ ˆï¼Œå†å°†è¯¥å…ƒç´ å‹å…¥è¾…åŠ©æ ˆï¼Œå¦‚æ­¤å¾€å¤ï¼Œç›´åˆ°è¾…åŠ©æ ˆæˆä¸ºä¸€ä¸ªæ ˆé¡¶åˆ°æ ˆåº•é€’å¢çš„æ ˆï¼Œå†å°†è¾…åŠ©æ ˆå†…çš„å…ƒç´ å‹å›åŸæ ˆã€‚ 2.2 ä»£ç class Solution { public void sortStackByStack(Stack&lt;Integer> stack) { Stack&lt;Integer> help = new Stack&lt;>(); while(!stack.isEmpty()){ int cur = stack.pop(); while(!help.isEmpty()&amp;&amp;help.peek()&lt;cur){ stack.push(help.pop()); } help.push(cur); } while(!help.isEmpty()){ stack.push(help.pop()); } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode648-å•è¯æ›¿æ¢","slug":"leetcode648-å•è¯æ›¿æ¢","date":"2020-04-20T07:03:52.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode648-å•è¯æ›¿æ¢/","link":"","permalink":"https://www.codetool.top/article/leetcode648-%E5%8D%95%E8%AF%8D%E6%9B%BF%E6%8D%A2/","excerpt":"","text":"1 åŸé¢˜åœ¨è‹±è¯­ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå«åš è¯æ ¹(root)çš„æ¦‚å¿µï¼Œå®ƒå¯ä»¥è·Ÿç€å…¶ä»–ä¸€äº›è¯ç»„æˆå¦ä¸€ä¸ªè¾ƒé•¿çš„å•è¯â€”â€”æˆ‘ä»¬ç§°è¿™ä¸ªè¯ä¸º ç»§æ‰¿è¯(successor)ã€‚ä¾‹å¦‚ï¼Œè¯æ ¹anï¼Œè·Ÿéšç€å•è¯ other(å…¶ä»–)ï¼Œå¯ä»¥å½¢æˆæ–°çš„å•è¯ another(å¦ä¸€ä¸ª)ã€‚ ç°åœ¨ï¼Œç»™å®šä¸€ä¸ªç”±è®¸å¤šè¯æ ¹ç»„æˆçš„è¯å…¸å’Œä¸€ä¸ªå¥å­ã€‚ä½ éœ€è¦å°†å¥å­ä¸­çš„æ‰€æœ‰ç»§æ‰¿è¯ç”¨è¯æ ¹æ›¿æ¢æ‰ã€‚å¦‚æœç»§æ‰¿è¯æœ‰è®¸å¤šå¯ä»¥å½¢æˆå®ƒçš„è¯æ ¹ï¼Œåˆ™ç”¨æœ€çŸ­çš„è¯æ ¹æ›¿æ¢å®ƒã€‚ ä½ éœ€è¦è¾“å‡ºæ›¿æ¢ä¹‹åçš„å¥å­ã€‚ ç¤ºä¾‹1: è¾“å…¥: dict(è¯å…¸) = [â€œcatâ€, â€œbatâ€, â€œratâ€]sentence(å¥å­) = â€œthe cattle was rattled by the batteryâ€è¾“å‡º: â€œthe cat was rat by the batâ€ æ³¨: è¾“å…¥åªåŒ…å«å°å†™å­—æ¯ã€‚ 1 &lt;= å­—å…¸å•è¯æ•° &lt;=1000 1 &lt;= å¥ä¸­è¯è¯­æ•° &lt;= 1000 1 &lt;= è¯æ ¹é•¿åº¦ &lt;= 100 1 &lt;= å¥ä¸­è¯è¯­é•¿åº¦ &lt;= 1000 2 è§£æ³•2.1 æ€æƒ³è¿™é‡Œçš„è¯æ ¹å…¶å®å°±æ˜¯å­—ç¬¦ä¸²çš„å‰ç¼€ï¼Œä¸€å¼€å§‹æˆ‘ä»¥ä¸ºå‡ºç°åœ¨å“ªéƒ½å¯ä»¥ã€‚å‰ç¼€å¯ä»¥ä½¿ç”¨å­—å…¸æ ‘æœç´¢ã€‚ 2.2 ä»£ç class Solution { class TrieNode{ TrieNode[] children = new TrieNode[26]; String word; } public String replaceWords(List&lt;String> dict, String sentence) { StringBuilder sb = new StringBuilder(); TrieNode root = new TrieNode(); for(String word:dict) insertToTrie(root,word); String[] words = sentence.split(\" \"); for(int i = 0;i&lt;words.length;i++){ String prefix = hasPrefix(root,words[i]); if(!prefix.equals(\"\")) words[i] = prefix; } for(int i = 0;i&lt;words.length;i++){ sb.append(words[i]); if(i!=words.length-1) sb.append(\" \"); } return sb.toString(); } /*å°†å‰ç¼€æ’å…¥å­—å…¸æ ‘*/ public void insertToTrie(TrieNode root,String word){ TrieNode cur = root; for(char i:word.toCharArray()){ if(cur.children[i-'a']==null){ cur.children[i-'a'] = new TrieNode(); } cur = cur.children[i-'a']; } cur.word = word; } /*ä»å­—å…¸æ ‘ä¸­è·å–å‰ç¼€*/ public String hasPrefix(TrieNode root,String word){ TrieNode cur = root; for(char i:word.toCharArray()){ if(cur.children[i-'a']==null){ return \"\"; } cur = cur.children[i-'a']; if(cur.word!=null){; return cur.word; } } return \"\"; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"ä½¿ç”¨é€’å½’å‡½æ•°é€†åºä¸€ä¸ªæ ˆ","slug":"ä½¿ç”¨é€’å½’å‡½æ•°é€†åºä¸€ä¸ªæ ˆ","date":"2020-04-19T06:43:06.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/ä½¿ç”¨é€’å½’å‡½æ•°é€†åºä¸€ä¸ªæ ˆ/","link":"","permalink":"https://www.codetool.top/article/%E4%BD%BF%E7%94%A8%E9%80%92%E5%BD%92%E5%87%BD%E6%95%B0%E9%80%86%E5%BA%8F%E4%B8%80%E4%B8%AA%E6%A0%88/","excerpt":"","text":"1 åŸé¢˜ï¼ˆæ¥æºï¼šç‰›å®¢ç½‘ï¼‰ä¸€ä¸ªæ ˆä¾æ¬¡å‹å…¥1,2,3,4,5é‚£ä¹ˆä»æ ˆé¡¶åˆ°æ ˆåº•åˆ†åˆ«ä¸º5,4,3,2,1ã€‚å°†è¿™ä¸ªæ ˆè½¬ç½®åï¼Œä»æ ˆé¡¶åˆ°æ ˆåº•ä¸º1,2,3,4,5ï¼Œä¹Ÿå°±æ˜¯å®ç°äº†æ ˆä¸­å…ƒç´ çš„é€†åºï¼Œè¯·è®¾è®¡ä¸€ä¸ªç®—æ³•å®ç°é€†åºæ ˆçš„æ“ä½œï¼Œä½†æ˜¯åªèƒ½ç”¨é€’å½’å‡½æ•°æ¥å®ç°ï¼Œè€Œä¸èƒ½ç”¨å¦å¤–çš„æ•°æ®ç»“æ„ã€‚ 2 è§£æ³•2.1 æ€æƒ³è®¾è®¡ä¸€ä¸ªå‡½æ•°getAndRemoveLastElementç”¨äºè·å–å¹¶ç§»é™¤æ ˆåº•å…ƒç´ ï¼Œå½“æ ˆç©ºçš„æ—¶å€™è¿›è¡Œå›æº¯ï¼Œå¹¶å°†è·å–çš„å…ƒç´ å‹å…¥æ ˆï¼Œå°±èƒ½è¾¾åˆ°é€†åºçš„æ•ˆæœã€‚ è¿™æ ·åšçš„æ—¶é—´å¤æ‚åº¦è‚¯å®šæ˜¯æ²¡ä¸€ä¸ªè¾…åŠ©é˜Ÿåˆ—æ¥çš„å¿«çš„ï¼Œå¥½å¤„æ˜¯æ²¡æœ‰ä½¿ç”¨é¢å¤–çš„ç©ºé—´ï¼ˆé™¤äº†é€’å½’æ ˆç©ºé—´ï¼‰ æ—¶é—´å¤æ‚åº¦è®¡ç®—ï¼šè®¾æ ˆçš„å¤§å°ä¸ºnï¼Œæ¯ä¸€æ¬¡è·å–æ ˆåº•å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n)ï¼Œæ ˆçš„å¤§å°è¦ä»n-&gt;0ï¼Œå°±æ˜¯O(n)+O(n-1)+O(n-2)+...+O(1)=O(n^2) 2.2 ä»£ç class Solution { public void reverse(Stack&lt;Integer> stack){ if(stack.isEmpty()){ return; } //æ¯æ¬¡è·å–æ ˆåº•å…ƒç´ ï¼Œæœ€åä¸€æ¬¡è·å–çš„å³æ˜¯æ ˆé¡¶å…ƒç´  int i = getAndRemoveLastElement(stack); reverse(stack); //å›æº¯çš„æ—¶å€™å°†è·å–çš„å…ƒç´ å‹å…¥ stack.push(i); } public int getAndRemoveLastElement(Stack&lt;Integer> stack){ //è·å–å¹¶ç§»é™¤æ ˆé¡¶å…ƒç´  int result = stack.pop(); //è·å–æ ˆåº•å…ƒç´  if(stack.isEmpty()){ return result; }else{ int last = getAndRemoveLastElement(stack); //å›æº¯çš„æ—¶å€™å°†è·å–çš„å…ƒç´ å‹å…¥ stack.push(result); return last; } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode75-é¢œè‰²åˆ†ç±»","slug":"leetcode75-é¢œè‰²åˆ†ç±»","date":"2020-04-19T06:09:49.000Z","updated":"2020-04-19T06:21:07.081Z","comments":true,"path":"article/leetcode75-é¢œè‰²åˆ†ç±»/","link":"","permalink":"https://www.codetool.top/article/leetcode75-%E9%A2%9C%E8%89%B2%E5%88%86%E7%B1%BB/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªåŒ…å«çº¢è‰²ã€ç™½è‰²å’Œè“è‰²ï¼Œä¸€å…± n ä¸ªå…ƒç´ çš„æ•°ç»„ï¼ŒåŸåœ°å¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼Œä½¿å¾—ç›¸åŒé¢œè‰²çš„å…ƒç´ ç›¸é‚»ï¼Œå¹¶æŒ‰ç…§çº¢è‰²ã€ç™½è‰²ã€è“è‰²é¡ºåºæ’åˆ—ã€‚ æ­¤é¢˜ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° 0ã€ 1 å’Œ 2 åˆ†åˆ«è¡¨ç¤ºçº¢è‰²ã€ç™½è‰²å’Œè“è‰²ã€‚ æ³¨æ„:ä¸èƒ½ä½¿ç”¨ä»£ç åº“ä¸­çš„æ’åºå‡½æ•°æ¥è§£å†³è¿™é“é¢˜ã€‚ ç¤ºä¾‹: è¾“å…¥: [2,0,2,1,1,0]è¾“å‡º: [0,0,1,1,2,2] è¿›é˜¶ï¼š ä¸€ä¸ªç›´è§‚çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨è®¡æ•°æ’åºçš„ä¸¤è¶Ÿæ‰«æç®—æ³•ã€‚é¦–å…ˆï¼Œè¿­ä»£è®¡ç®—å‡º0ã€1 å’Œ 2 å…ƒç´ çš„ä¸ªæ•°ï¼Œç„¶åæŒ‰ç…§0ã€1ã€2çš„æ’åºï¼Œé‡å†™å½“å‰æ•°ç»„ã€‚ ä½ èƒ½æƒ³å‡ºä¸€ä¸ªä»…ä½¿ç”¨å¸¸æ•°ç©ºé—´çš„ä¸€è¶Ÿæ‰«æç®—æ³•å—ï¼Ÿ 2 è§£æ³•2.1 æ€æƒ³è®¡æ•°æ’åºç®—æ˜¯è¿™ç±»é—®é¢˜çš„é€šè§£å§ã€‚ã€‚ä¸è¿‡å¯¹äºä»…æœ‰ä¸¤ç§æˆ–ä¸‰ç§å…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨äº¤æ¢æ–¹æ³•æ¥è§£ã€‚ 2.2 ä»£ç è®¡æ•°ï¼š class Solution { public void sortColors(int[] nums) { int count0 = 0,count1 = 0,count2 = 0; for(int i:nums){ if(i == 0) count0++; else if(i == 1) count1++; else count2++; } for(int i = 0;i&lt;nums.length;i++){ if(i&lt;count0) nums[i] = 0; else if(i&lt;count0+count1) nums[i] = 1; else nums[i] = 2; } } } ä¸‰æŒ‡é’ˆäº¤æ¢ï¼š class Solution { public void sortColors(int[] nums) { int p0 = 0, cur = 0; int p2 = nums.length - 1; int tmp; while (cur &lt;= p2) { if (nums[cur] == 0) { tmp = nums[p0]; nums[p0++] = nums[cur]; nums[cur++] = tmp; } else if (nums[cur] == 2) { tmp = nums[cur]; nums[cur] = nums[p2]; nums[p2--] = tmp; } else cur++; } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"åŠ›æ‰£æ¯æ˜¥å­£ä¸ªäººèµ›-å‰§æƒ…è§¦å‘æ—¶é—´","slug":"leetcodeä¸ªäººèµ›-å‰§æƒ…è§¦å‘æ—¶é—´","date":"2020-04-18T09:50:32.000Z","updated":"2020-04-22T09:27:27.142Z","comments":true,"path":"article/leetcodeä¸ªäººèµ›-å‰§æƒ…è§¦å‘æ—¶é—´/","link":"","permalink":"https://www.codetool.top/article/leetcode%E4%B8%AA%E4%BA%BA%E8%B5%9B-%E5%89%A7%E6%83%85%E8%A7%A6%E5%8F%91%E6%97%B6%E9%97%B4/","excerpt":"","text":"è¿™æ¬¡çš„ä¸ªäººèµ›çœŸæ˜¯è®©æˆ‘è®¤æ¸…äº†è‡ªå·±çš„å®åŠ›ã€‚ã€‚ä¸¤é“å›°éš¾é¢˜éƒ½æ²¡åšå‡ºğŸ˜­ï¼Œè™½ç„¶å¤§å®¶çš„é€šè¿‡ç‡ä¹Ÿä¸å’‹åœ°ã€‚ã€‚ æœ€åæ’å æˆ‘è®°å½•ä¸€é“åšå‡ºæ¥çš„é¢˜å§ï¼Œè¿™é“é¢˜æ˜¯ä¸€é“ä¸­ç­‰é¢˜ï¼Œé€šè¿‡ç‡å¦‚ä¸‹ï¼Œè™½ç„¶é¢˜ç›®ä¸éš¾ï¼Œä½†ç”±äºæ—¶é—´é™åˆ¶çš„é—®é¢˜ï¼Œä¸ä½¿ç”¨æŠ€å·§å¾ˆå®¹æ˜“è¶…å‡ºæ—¶é—´é™åˆ¶ 1 åŸé¢˜åœ¨æˆ˜ç•¥æ¸¸æˆä¸­ï¼Œç©å®¶å¾€å¾€éœ€è¦å‘å±•è‡ªå·±çš„åŠ¿åŠ›æ¥è§¦å‘å„ç§æ–°çš„å‰§æƒ…ã€‚ä¸€ä¸ªåŠ¿åŠ›çš„ä¸»è¦å±æ€§æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯æ–‡æ˜ç­‰çº§ï¼ˆCï¼‰ï¼Œèµ„æºå‚¨å¤‡ï¼ˆRï¼‰ä»¥åŠäººå£æ•°é‡ï¼ˆHï¼‰ã€‚åœ¨æ¸¸æˆå¼€å§‹æ—¶ï¼ˆç¬¬ 0 å¤©ï¼‰ï¼Œä¸‰ç§å±æ€§çš„å€¼å‡ä¸º 0ã€‚ éšç€æ¸¸æˆè¿›ç¨‹çš„è¿›è¡Œï¼Œæ¯ä¸€å¤©ç©å®¶çš„ä¸‰ç§å±æ€§éƒ½ä¼šå¯¹åº”å¢åŠ ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªäºŒç»´æ•°ç»„ increase æ¥è¡¨ç¤ºæ¯å¤©çš„å¢åŠ æƒ…å†µã€‚è¿™ä¸ªäºŒç»´æ•°ç»„çš„æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º 3 çš„ä¸€ç»´æ•°ç»„ï¼Œä¾‹å¦‚ [[1,2,1],[3,4,2]] è¡¨ç¤ºç¬¬ä¸€å¤©ä¸‰ç§å±æ€§åˆ†åˆ«å¢åŠ  1,2,1 è€Œç¬¬äºŒå¤©åˆ†åˆ«å¢åŠ  3,4,2ã€‚ æ‰€æœ‰å‰§æƒ…çš„è§¦å‘æ¡ä»¶ä¹Ÿç”¨ä¸€ä¸ªäºŒç»´æ•°ç»„ requirements è¡¨ç¤ºã€‚è¿™ä¸ªäºŒç»´æ•°ç»„çš„æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º 3 çš„ä¸€ç»´æ•°ç»„ï¼Œå¯¹äºæŸä¸ªå‰§æƒ…çš„è§¦å‘æ¡ä»¶ c[i], r[i], h[i]ï¼Œå¦‚æœå½“å‰ C &gt;= c[i] ä¸” R &gt;= r[i] ä¸” H &gt;= h[i] ï¼Œåˆ™å‰§æƒ…ä¼šè¢«è§¦å‘ã€‚ æ ¹æ®æ‰€ç»™ä¿¡æ¯ï¼Œè¯·è®¡ç®—æ¯ä¸ªå‰§æƒ…çš„è§¦å‘æ—¶é—´ï¼Œå¹¶ä»¥ä¸€ä¸ªæ•°ç»„è¿”å›ã€‚å¦‚æœæŸä¸ªå‰§æƒ…ä¸ä¼šè¢«è§¦å‘ï¼Œåˆ™è¯¥å‰§æƒ…å¯¹åº”çš„è§¦å‘æ—¶é—´ä¸º -1 ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥ï¼š increase = [[2,8,4],[2,5,0],[10,9,8]] requirements = [[2,11,3],[15,10,&gt;7],[9,17,12],[8,1,14]] è¾“å‡º: [2,-1,3,-1] è§£é‡Šï¼š åˆå§‹æ—¶ï¼ŒC = 0ï¼ŒR = 0ï¼ŒH = 0 ç¬¬ 1 å¤©ï¼ŒC = 2ï¼ŒR = 8ï¼ŒH = 4 ç¬¬ 2 å¤©ï¼ŒC = 4ï¼ŒR = 13ï¼ŒH = 4ï¼Œæ­¤æ—¶è§¦å‘å‰§æƒ… 0 ç¬¬ 3 å¤©ï¼ŒC = 14ï¼ŒR = 22ï¼ŒH = 12ï¼Œæ­¤æ—¶è§¦å‘å‰§æƒ… 2 å‰§æƒ… 1 å’Œ 3 æ— æ³•è§¦å‘ã€‚ ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼š increase = [[0,4,5],[4,8,8],[8,6,1],[10,10,0]] requirements = [[12,11,16],[20,2,6],[9,2,6],[10,18,3],[8,14,9]] è¾“å‡º: [-1,4,3,3,3] ç¤ºä¾‹ 3ï¼š è¾“å…¥ï¼š increase = [[1,1,1]] requirements = [[0,0,0]] è¾“å‡º: [0] é™åˆ¶ï¼š 1 &lt;= increase.length &lt;= 10000 1 &lt;= requirements.length &lt;= 100000 0 &lt;= increase[i] &lt;= 10 0 &lt;= requirements[i] &lt;= 100000 2 è§£æ³•2.1 æ€æƒ³è§ä»£ç éƒ¨åˆ† 2.2 ä»£ç æˆ‘ä¸€å¼€å§‹æƒ³çš„æ˜¯ç”¨requirementé‡Œé¢çš„ä¸‰å…ƒç»„æ¯éš”ä¸€å¤©å‡å»increaseé‡Œé¢å¯¹åº”çš„ä¸‰å…ƒç»„ï¼Œç„¶åè®°å½•ç­”æ¡ˆï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•æ— è®ºæ€ä¹ˆå‰ªæä¼˜åŒ–éƒ½ä¼šè¶…æ—¶ï¼Œè¿™æ ·åšçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(mn)(m,nä¸ºä¸¤ä¸ªæ•°ç»„çš„å¤§å°ï¼Œæˆ‘è¿˜çœå»äº†åé¢æ•°ç»„èµ‹å€¼çš„æ—¶é—´å¤æ‚åº¦)ï¼š class Solution { public int[] getTriggerTime(int[][] increase, int[][] requirements) { Integer[] ans = new Integer[requirements.length]; for(int day = 0;day&lt;=increase.length;day++){ boolean hasRemain = false; for(int i = 0;i&lt;requirements.length;i++){ if(day == 0){ if(requirements[i][0]==0&amp;&amp;requirements[i][1]==0&amp;&amp;requirements[i][2]==0) ans[i] = 0; else continue; } if(ans[i]!=null) continue; hasRemain = true; requirements[i][0] -= increase[day-1][0]; requirements[i][1] -= increase[day-1][1]; requirements[i][2] -= increase[day-1][2]; if(requirements[i][0]&lt;=0&amp;&amp;requirements[i][1]&lt;=0&amp;&amp;requirements[i][2]&lt;=0){ ans[i] = day; } } if(day!=0&amp;&amp;!hasRemain) break; } int[] realAns = new int[requirements.length]; for(int i = 0;i&lt;ans.length;i++){ if(ans[i] == null){ realAns[i] = -1; }else{ realAns[i] = ans[i]; } } return realAns; } } åæ¥æƒ³åˆ°å¯ä»¥è®¡ç®—æ¯ä¸€å¤©çš„å±æ€§å€¼ï¼Œç„¶åäºŒåˆ†æŸ¥æ‰¾ï¼Œè¿™æ ·åšçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(m+nlogm)ï¼š class Solution { public int[] getTriggerTime(int[][] increase, int[][] requirements) { int day = 0; int[] ans = new int[requirements.length]; //å°†increaseä¸­çš„ä¸‰å…ƒç»„çš„å«ä¹‰å˜ä¸ºæ¯ä¸€å¤©çš„å±æ€§å€¼ for(int i = 1;i&lt;increase.length;i++){ increase[i][0] += increase[i-1][0]; increase[i][1] += increase[i-1][1]; increase[i][2] += increase[i-1][2]; } for(int i = 0;i&lt;requirements.length;i++){ if(requirements[i][0]==0&amp;&amp;requirements[i][1]==0&amp;&amp;requirements[i][2]==0) ans[i] = 0; else{ int left = 0; int right = increase.length-1; //å¦‚æœæœ€åä¸€å¤©ä»ä¸æ»¡è¶³ï¼Œè®¾ä¸º-1 if(!(increase[right][0]>=requirements[i][0]&amp;&amp;increase[right][1]>=requirements[i][1]&amp;&amp;increase[right][2]>=requirements[i][2])){ ans[i] = -1; continue; } //äºŒåˆ†æŸ¥æ‰¾ while(left &lt;right){ int mid = (left+right)/2; if(!(increase[mid][0]>=requirements[i][0]&amp;&amp;increase[mid][1]>=requirements[i][1]&amp;&amp;increase[mid][2]>=requirements[i][2])){ left = mid+1; }else{ right = mid; } } ans[i] = left+1; } } return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥URLï¼ŒæŒ‰ä¸‹å›è½¦ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ","slug":"åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥URLï¼ŒæŒ‰ä¸‹å›è½¦ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ","date":"2020-04-17T18:05:08.000Z","updated":"2020-04-17T18:48:52.213Z","comments":true,"path":"article/åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥URLï¼ŒæŒ‰ä¸‹å›è½¦ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ/","link":"","permalink":"https://www.codetool.top/article/%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E5%9C%B0%E5%9D%80%E6%A0%8F%E8%BE%93%E5%85%A5URL%EF%BC%8C%E6%8C%89%E4%B8%8B%E5%9B%9E%E8%BD%A6%E4%B9%8B%E5%90%8E%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F/","excerpt":"","text":"ä¸€é“ç»å…¸çš„é¢è¯•é¢˜~ è¿™ç¯‡æ–‡ç« ä¸ä¼šç”¨æ¥è®²çŸ¥è¯†ç‚¹ï¼Œå¦‚æœæŒ‰ä¸€ä¸ªé—®é¢˜å»è®²é‡Œé¢çš„çŸ¥è¯†ç‚¹å®Œå…¨å½¢æˆä¸äº†ä½“ç³»ï¼Œè¿™ç¯‡æ–‡ç« åªæ˜¯åšä¸€ä¸ªçŸ¥è¯†ç‚¹çš„ä¸²è”ã€å›é¡¾ï¼Œå¸®åŠ©ç¼•æ¸…çŸ¥è¯†ç‚¹ä¹‹é—´çš„å…³ç³»ï¼Œå½¢æˆçŸ¥è¯†è„‰ç»œã€‚ ä¸‹é¢çš„å›ç­”ä»…é’ˆå¯¹HTTP/HTTPSåè®®ï¼šï¼ˆæ¯•ç«Ÿæµè§ˆå™¨è¿˜å¯ä»¥ftpã€websocketä»€ä¹ˆçš„ï¼Œå¦‚æœå„ç§åè®®éƒ½è°ˆçœŸæ²¡å®Œäº†ï¼‰ æµè§ˆå™¨æ£€æŸ¥ç¼“å­˜ï¼Œç¼“å­˜æœªè¿‡æœŸä¸€èˆ¬ä¼šä½¿ç”¨å¼ºç¼“å­˜ï¼Œç¼“å­˜è¿‡æœŸä¸€èˆ¬ä¼šä½¿ç”¨åå•†ç¼“å­˜ï¼Œå¦‚æœåå•†ç¼“å­˜æœªå‘½ä¸­æˆ–æ²¡æœ‰ç¼“å­˜ï¼Œç»§ç»­ä¸‹ä¸€æ­¥ã€‚ å…·ä½“è¯·å‚è€ƒHTTPæµè§ˆå™¨ç¼“å­˜ç­–ç•¥å’ŒæœåŠ¡å™¨çš„ç¼“å­˜æ§åˆ¶ å¯¹åŸŸåè¿›è¡ŒDNSè§£æï¼Œå¦‚æœå®¢æˆ·æœºæœ‰DNSç¼“å­˜ï¼Œç›´æ¥è·å¾—å¯¹åº”çš„IPï¼Œå¦åˆ™å‘DNSæœåŠ¡å™¨å‘å‡ºè¯·æ±‚è§£æåŸŸåï¼Œå¦‚æœç½‘ç«™é…ç½®äº†CDNï¼Œä¼šè¿”å›ä¸€ä¸ªcnameï¼ŒæŒ‡å‘CDNçš„å…¨å±€è´Ÿè½½å‡è¡¡å™¨ï¼Œç”±æ™ºèƒ½ç®—æ³•ä¸ºç”¨æˆ·åˆ†é…ä¸ºå…¶æœåŠ¡çš„æœåŠ¡å™¨ipã€‚å¦‚æœæ²¡æœ‰é…ç½®CDNï¼Œæ ¹æ®ç½‘ç«™çš„DNSé…ç½®è¿”å›ä¸€ä¸ªIPã€‚ DNSç›¸å…³è¯·å‚è€ƒè®¡ç½‘å¤ä¹ 06-åº”ç”¨å±‚ä¹‹åŸŸåç³»ç»ŸDNSï¼ŒCDNç›¸å…³çš„ä¸œè¥¿æˆ‘ç›®å‰å€’æ˜¯æ²¡æœ‰å†™åšå®¢è®²è¿‡ï¼Œè¿™é‡Œå¯ä»¥æä¸€ä¸‹ï¼Œå…¶å®CDNçš„æ ¸å¿ƒæŠ€æœ¯å°±æ˜¯å…¨å±€è´Ÿè½½å‡è¡¡å’Œç¼“å­˜ç®¡ç†ï¼Œé€šå¸¸ç”¨äºé™æ€èµ„æºçš„åˆ†å‘ï¼ˆç¼“å­˜ä»£ç†ï¼‰ï¼Œå®¢æˆ·ä»è¾¹ç¼˜èŠ‚ç‚¹ä¸Šå–æ•°æ®ã€‚å’ŒCDNæ€§èƒ½ç›¸å…³çš„åè¯æœ‰å‘½ä¸­ç‡å’Œå›æºç‡ã€‚æœ€è¿‘è¿˜æµè¡Œä¸€ç§è¾¹ç¼˜è®¡ç®—çš„æŠ€æœ¯ï¼ŒæŠŠè®¡ç®—åŠ¨æ€èµ„æºçš„ä»£ç å’Œæ•°æ®ä¹Ÿæ”¾åœ¨cdnçš„èŠ‚ç‚¹ä¸Šï¼Œå°±å¯ä»¥å®ç°åœ¨cdné‡Œè·å–åŠ¨æ€èµ„æºè€Œä¸ç”¨å›æºç«™ã€‚ å®¢æˆ·æœºä½¿ç”¨IPä¸æœåŠ¡å™¨å»ºç«‹TCPè¿æ¥ï¼Œé€šè¿‡TCPä¸‰æ¬¡æ¡æ‰‹ï¼Œå»ºç«‹è¿æ¥ä¹‹åå¦‚æœæ˜¯HTTPSåè®®è¿˜éœ€è¦TLSæ¡æ‰‹ï¼Œäº¤æ¢å¯†ç å¥—ä»¶ï¼Œé€šè¿‡æ¤­åœ†æ›²çº¿ç®—æ³•å®ç°å¯†é’¥äº¤æ¢ã€‚ TCPå»ºç«‹è¿æ¥ä¸‰æ¬¡æ¡æ‰‹ç›¸å…³å†…å®¹è§è®¡ç½‘å¤ä¹ 05-ä¼ è¾“å±‚ TLSæ¡æ‰‹çš„è¯¦ç»†è¿‡ç¨‹æˆ‘ä¹Ÿæ²¡æœ‰å†™è¿‡åšå®¢ï¼Œå› ä¸ºæ¯”è¾ƒç†è®ºï¼Œæˆ‘ä¹Ÿæ²¡æœ‰é‚£ä¹ˆæƒå¨ï¼Œè‡ªå·±å†™ä¸æ•¢ä¿è¯æ­£ç¡®ï¼Œå¤åˆ¶ç²˜è´´ä¹Ÿæ²¡æœ‰æ„æ€ï¼Œä¸è¿‡HTTPSåŸç†å¯ä»¥å‚è€ƒHTTPSçš„åŸç†â€”â€”æ··åˆåŠ å¯†ã€æ•°å­—ç­¾åã€CAã€‚æˆ‘è¿™é‡Œç®€å•æä¸€ä¸‹TLSçš„æ¡æ‰‹ï¼šTLSæ¡æ‰‹ä¸»è¦ç›®çš„å°±æ˜¯è·å–CAè¯ä¹¦éªŒè¯æœåŠ¡ç«¯èº«ä»½å’Œå¯†é’¥äº¤æ¢ï¼Œå³è·å–åé¢ç”¨äºå¯¹ç§°åŠ å¯†çš„å¯†é’¥ã€‚ï¼ˆä¹Ÿæˆä¸ºä¼šè¯å¯†é’¥ï¼‰å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¼šå…ˆåå•†ä½¿ç”¨åŒä¸€ä¸ªå¯†ç å¥—ä»¶ã€‚å¯†ç å¥—ä»¶çš„å‘½åæ˜¯å¯†é’¥äº¤æ¢ç®—æ³•-ç­¾åç®—æ³•-å¯¹ç§°åŠ å¯†ç®—æ³•-åˆ†ç»„æ¨¡å¼-æ‘˜è¦ç®—æ³•ï¼Œå¦‚ECDHE-RSA-AES256-GCM-SHA384ã€‚TLS1.2è¿˜æœ‰ç”¨RSAè¿›è¡Œå¯†é’¥äº¤æ¢ï¼Œä½†ç”±äºå‰å‘å®‰å…¨çš„é—®é¢˜ï¼ˆRSAä½¿ç”¨çš„å…¬ç§é’¥æ˜¯å›ºå®šçš„ï¼Œå¦‚æœé»‘å®¢åšæŒä¸æ‡ˆçš„æ”¶é›†æ‰€æœ‰ç›‘å¬åˆ°çš„HTTPSæŠ¥æ–‡ï¼Œä¸€æ—¦æœ‰ä¸€å¤©ç§é’¥æ³„éœ²ï¼Œæ‰€æœ‰ä¹‹å‰æ”¶é›†çš„æŠ¥æ–‡éƒ½èƒ½è¢«ç ´è§£ï¼‰ï¼ŒTLS1.3å°±å®Œå…¨åºŸå¼ƒäº†ä½¿ç”¨RSAå¯†é’¥äº¤æ¢ï¼Œå¹¶æ¨èä½¿ç”¨ECDHEå¯†é’¥äº¤æ¢ï¼ˆå³ECC+DHï¼ŒåŸºäºæ¤­åœ†æ›²çº¿çš„ç¦»æ•£å¯¹æ•°é—®é¢˜ï¼Œæ¯æ¬¡æ¡æ‰‹æ—¶éƒ½ä¼šç”Ÿæˆä¸€å¯¹ä¸´æ—¶çš„å…¬é’¥å’Œç§é’¥ï¼Œä¿è¯äº†å‰å‘å®‰å…¨ï¼‰ã€‚ ä¼ è¾“å±‚å†å¾€ä¸‹çš„åè®®æˆ‘è§‰å¾—å°±æ²¡å¿…è¦è®²äº†å§ï¼Ÿç½‘ç»œå±‚æ‰¾IPï¼Œæ•°æ®é“¾è·¯å±‚æ‰¾MACï¼Œç‰©ç†å±‚ä¼ è¾“ã€‚ æ¡æ‰‹å®Œæˆä¹‹åå¯ä»¥å‘é€HTTP/HTTPSæŠ¥æ–‡ï¼ˆå¯¹äºä¸€ä¸ªå¤ç”¨çš„TCPè¿æ¥æˆ‘ä»¬ä¼šé‡åˆ°é˜Ÿå¤´é˜»å¡ç­‰å¾…ï¼Œä¸è¿‡è¿™é‡Œæ—¢ç„¶æ˜¯åœ¨åœ°å€æ è¾“å…¥URLç„¶åå›è½¦ï¼Œè‚¯å®šæ˜¯ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œæ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼‰ï¼ŒæœåŠ¡å™¨æ”¶åˆ°åè¿›è¡Œå¤„ç†ã€‚ï¼ˆå¤„ç†è¿‡ç¨‹ä¸å®šï¼Œå¦‚æœæ˜¯åŠ¨æ€èµ„æºå¯èƒ½ä¼šè°ƒç”¨åç«¯ç¨‹åºï¼‰ï¼Œå¤„ç†å®Œæˆä¹‹åç»„æˆHTTPå“åº”æŠ¥æ–‡å‘é€ç»™å®¢æˆ·ç«¯ã€‚ ç½‘ä¸Šæœ‰çš„åšå®¢è¯´è¿™é‡Œä¼šæœåŠ¡å™¨å°±ä¼šæ–­å¼€è¿æ¥äº†ï¼Ÿï¼Ÿæœªå…çŸ¥è¯†ç‚¹å¤ªä¹…è¿œäº†ä¸€ç‚¹äº†å§ï¼ŒHTTPS1.1å°±é»˜è®¤é•¿è¿æ¥äº†ã€‚å…³äºHTTPçš„ç‰ˆæœ¬ç›¸å…³å¯ä»¥å‚è€ƒHTTPç‰ˆæœ¬å‘å±•ä¸Googleçš„æš—ä¸­åŠ©åŠ› æµè§ˆå™¨ä¸‹è½½å¯¹åº”çš„å“åº”æ•°æ®ï¼Œå¹¶å¯¹HTMLï¼ˆå¦‚æœæ˜¯ï¼‰è¿›è¡Œæ¸²æŸ“ã€‚æ¸²æŸ“ç›¸å…³çš„çŸ¥è¯†æˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œåº”è¯¥æ˜¯å‰ç«¯æ¯”è¾ƒéœ€è¦æŒæ¡çš„éƒ¨åˆ†ã€‚","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","permalink":"https://www.codetool.top/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"}]},{"title":"å‰‘æŒ‡offer17-æ‰“å°ä»1åˆ°æœ€å¤§çš„nä½æ•°","slug":"å‰‘æŒ‡offer17-æ‰“å°ä»1åˆ°æœ€å¤§çš„nä½æ•°","date":"2020-04-17T06:49:50.000Z","updated":"2020-04-17T06:51:21.905Z","comments":true,"path":"article/å‰‘æŒ‡offer17-æ‰“å°ä»1åˆ°æœ€å¤§çš„nä½æ•°/","link":"","permalink":"https://www.codetool.top/article/%E5%89%91%E6%8C%87offer17-%E6%89%93%E5%8D%B0%E4%BB%8E1%E5%88%B0%E6%9C%80%E5%A4%A7%E7%9A%84n%E4%BD%8D%E6%95%B0/","excerpt":"","text":"1 åŸé¢˜ï¼ˆæ¥æºLeetcodeï¼‰è¾“å…¥æ•°å­— nï¼ŒæŒ‰é¡ºåºæ‰“å°å‡ºä» 1 åˆ°æœ€å¤§çš„ n ä½åè¿›åˆ¶æ•°ã€‚æ¯”å¦‚è¾“å…¥ 3ï¼Œåˆ™æ‰“å°å‡º 1ã€2ã€3 ä¸€ç›´åˆ°æœ€å¤§çš„ 3 ä½æ•° 999ã€‚ ç¤ºä¾‹ 1: è¾“å…¥ï¼š n = 1è¾“å‡ºï¼š [1,2,3,4,5,6,7,8,9] è¯´æ˜ï¼š ç”¨è¿”å›ä¸€ä¸ªæ•´æ•°åˆ—è¡¨æ¥ä»£æ›¿æ‰“å° n ä¸ºæ­£æ•´æ•° 2 è§£æ³•2.1 æ€æƒ³å¹‚å‡½æ•° 2.2 ä»£ç class Solution { public int[] printNumbers(int n) { int size = (int)(Math.pow(10,n))-1; int[] ans = new int[size]; for(int i=1;i&lt;=size;i++){ ans[i-1] = i; } return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"å‰‘æŒ‡offer","slug":"å‰‘æŒ‡offer","permalink":"https://www.codetool.top/tags/%E5%89%91%E6%8C%87offer/"}]},{"title":"HTTPSçš„åŸç†â€”â€”æ··åˆåŠ å¯†ã€æ•°å­—ç­¾åã€CA","slug":"HTTPSçš„åŸç†â€”â€”æ··åˆåŠ å¯†ã€æ•°å­—ç­¾åã€CA","date":"2020-04-16T17:51:52.000Z","updated":"2020-04-17T17:04:25.742Z","comments":true,"path":"article/HTTPSçš„åŸç†â€”â€”æ··åˆåŠ å¯†ã€æ•°å­—ç­¾åã€CA/","link":"","permalink":"https://www.codetool.top/article/HTTPS%E7%9A%84%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E6%B7%B7%E5%90%88%E5%8A%A0%E5%AF%86%E3%80%81%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E3%80%81CA/","excerpt":"","text":"å‰ç½®çŸ¥è¯†ï¼šè°ˆè°ˆå¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€æ¶ˆæ¯æ‘˜è¦ä»¥åŠæ•°å­—ç­¾å æœ¬æ–‡å‚è€ƒèµ„æºï¼š å…¨ç½‘æœ€é€å½»HTTPSï¼ˆé¢è¯•å¸¸é—®ï¼‰ ç½‘ç»œç¯‡ - httpsåè®®ä¸­çš„æ•°æ®æ˜¯å¦éœ€è¦äºŒæ¬¡åŠ å¯†_ç½‘ç»œ_u014294681çš„åšå®¢-CSDNåšå®¢ 1 HTTPSæ¦‚è¿°1.1 HTTPSä»‹ç»HTTPSæ˜¯ä»¥å®‰å…¨ä¸ºç›®æ ‡çš„ HTTP é€šé“ï¼Œåœ¨HTTPçš„åŸºç¡€ä¸Šé€šè¿‡ä¼ è¾“åŠ å¯†å’Œèº«ä»½è®¤è¯ä¿è¯äº†ä¼ è¾“è¿‡ç¨‹çš„å®‰å…¨æ€§ã€‚ HTTPS æŠŠ HTTP ä¸‹å±‚çš„ä¼ è¾“åè®®ç”± TCP/IP æ¢æˆäº† SSL/TLSï¼Œç”±HTTP over TCP/IPå˜æˆäº†HTTP over SSL/TLSï¼Œè®© HTTP è¿è¡Œåœ¨äº†å®‰å…¨çš„ SSL/TLS åè®®ä¸Šï¼Œæ”¶å‘æŠ¥æ–‡ä¸å†ä½¿ç”¨ Socket APIï¼Œè€Œæ˜¯è°ƒç”¨ä¸“é—¨çš„å®‰å…¨æ¥å£ã€‚ 1.2 ä»€ä¹ˆæ˜¯SSL/TLSSSL å³å®‰å…¨å¥—æ¥å±‚ï¼ˆSecure Sockets Layerï¼‰ï¼Œåœ¨ OSI æ¨¡å‹ä¸­å¤„äºç¬¬ 5 å±‚ï¼ˆä¼šè¯å±‚ï¼‰ï¼Œç”±ç½‘æ™¯å…¬å¸äº 1994 å¹´å‘æ˜ï¼Œæœ‰ v2 å’Œ v3 ä¸¤ä¸ªç‰ˆæœ¬ï¼Œè€Œ v1 å› ä¸ºæœ‰ä¸¥é‡çš„ç¼ºé™·ä»æœªå…¬å¼€è¿‡ã€‚ SSL å‘å±•åˆ° v3 æ—¶å·²ç»è¯æ˜äº†å®ƒè‡ªèº«æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„å®‰å…¨é€šä¿¡åè®®ï¼Œäºæ˜¯äº’è”ç½‘å·¥ç¨‹ç»„ IETF åœ¨ 1999 å¹´æŠŠå®ƒæ”¹åä¸º TLSï¼ˆä¼ è¾“å±‚å®‰å…¨ï¼ŒTransport Layer Securityï¼‰ï¼Œæ­£å¼æ ‡å‡†åŒ–ï¼Œç‰ˆæœ¬å·ä» 1.0 é‡æ–°ç®—èµ·ï¼Œæ‰€ä»¥ TLS1.0 å®é™…ä¸Šå°±æ˜¯ SSLv3.1ã€‚ åˆ°ä»Šå¤© TLS å·²ç»å‘å±•å‡ºäº†ä¸‰ä¸ªç‰ˆæœ¬ï¼Œåˆ†åˆ«æ˜¯ 2006 å¹´çš„ 1.1ã€2008 å¹´çš„ 1.2 å’Œ 2018 å¹´çš„ 1.3ã€‚ è¯´åˆ° TLSï¼Œå°±ä¸èƒ½ä¸è°ˆåˆ° OpenSSLï¼Œå®ƒæ˜¯ä¸€ä¸ªè‘—åçš„å¼€æºå¯†ç å­¦ç¨‹åºåº“å’Œå·¥å…·åŒ…ï¼Œå‡ ä¹æ”¯æŒæ‰€æœ‰å…¬å¼€çš„åŠ å¯†ç®—æ³•å’Œåè®®ï¼Œå·²ç»æˆä¸ºäº†äº‹å®ä¸Šçš„æ ‡å‡†ï¼Œè®¸å¤šåº”ç”¨è½¯ä»¶éƒ½ä¼šä½¿ç”¨å®ƒä½œä¸ºåº•å±‚åº“æ¥å®ç° TLS åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¸¸ç”¨çš„ Web æœåŠ¡å™¨ Apacheã€Nginx ç­‰ã€‚ 2 TLSçš„å…³é”®æŠ€æœ¯å¯¹äºç½‘ç»œä¼ è¾“ï¼Œè¦ä¿è¯å®‰å…¨ï¼Œå¿…é¡»ä¿è¯ï¼š æœºå¯†æ€§ï¼šå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œé€šè¿‡å¯†æ–‡å®ç° å®Œæ•´æ€§ï¼šæŒ‡æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«çªœæ”¹ï¼ŒæœåŠ¡å™¨å‘çš„æ˜¯ä»€ä¹ˆï¼Œå®¢æˆ·ç«¯æ¥æ”¶çš„å°±æ˜¯ä»€ä¹ˆæ ·çš„ èº«ä»½è®¤è¯ï¼šç¡®è®¤å¯¹æ–¹çš„çœŸå®èº«ä»½ï¼Œå¦åˆ™å®¹æ˜“è¢«ä¸­é—´äººæ”»å‡» ä¸å¯å¦è®¤ï¼šä¹Ÿå«ä¸å¯æŠµèµ–ï¼Œæ„æ€æ˜¯ä¸èƒ½å¦è®¤å·²ç»å‘ç”Ÿè¿‡çš„è¡Œä¸ºï¼Œå¦‚æœç¼ºäº†ä¸å¯å¦è®¤ï¼Œé‚£é€šä¿¡çš„äº‹åŠ¡çœŸå®æ€§å°±å¾—ä¸åˆ°ä¿è¯ã€‚ å¯ä»¥çœ‹åˆ°ï¼ŒTLSä¸ºä¿è¯å®‰å…¨ï¼ŒåŒæ—¶ä½¿ç”¨äº†å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†å’Œæ¶ˆæ¯æ‘˜è¦ã€‚ä¸äº†è§£çš„å¯ä»¥ç‚¹å‡»å‰ç½®çŸ¥è¯†é“¾æ¥å»çœ‹ä¸€ä¸‹ã€‚ 2.1 ä¼ è¾“åŠ å¯†TLSä¿è¯ä¼ è¾“åŠ å¯†æ˜¯ä½¿ç”¨äº†æ··åˆåŠ å¯†ï¼Œå®ƒåŒæ—¶ä½¿ç”¨äº†å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ã€‚ ä¸ºä»€ä¹ˆè¦æ··åˆåŠ å¯†å‘¢ï¼Ÿæˆ‘ä»¬åœ¨è°ˆè°ˆå¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€æ¶ˆæ¯æ‘˜è¦ä»¥åŠæ•°å­—ç­¾åä¸­æåˆ°ï¼Œéå¯¹ç§°åŠ å¯†è™½ç„¶å®‰å…¨ï¼Œä½†åŠ å¯†è§£å¯†é€Ÿåº¦è¾ƒæ…¢ï¼Œæ•ˆç‡è¾ƒä½ï¼Œè€Œå¯¹ç§°åŠ å¯†åˆéœ€è¦è§£å†³å¯†é’¥çš„ä¼ è¾“å®‰å…¨æ€§é—®é¢˜ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º â€œå¯†é’¥äº¤æ¢â€ é—®é¢˜ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ç»“åˆè¿™äºŒè€…ï¼Œä½¿ç”¨éå¯¹ç§°åŠ å¯†è§£å†³å¯¹ç§°åŠ å¯†çš„â€œå¯†é’¥äº¤æ¢â€é—®é¢˜ã€‚ å®¢æˆ·ç«¯ç”¨éšæœºæ•°äº§ç”Ÿå¯¹ç§°ç®—æ³•ä½¿ç”¨çš„â€œä¼šè¯å¯†é’¥â€ï¼ˆsession keyï¼‰ï¼Œå†ç”¨å…¬é’¥åŠ å¯†ã€‚å› ä¸ºä¼šè¯å¯†é’¥å¾ˆçŸ­ï¼Œé€šå¸¸åªæœ‰ 16 å­—èŠ‚æˆ– 32 å­—èŠ‚ï¼Œæ‰€ä»¥æ…¢ä¸€ç‚¹ä¹Ÿæ— æ‰€è°“ã€‚ æœåŠ¡ç«¯æ‹¿åˆ°å¯†æ–‡ä¹‹åå†ç”¨ç§é’¥è§£å¯†ï¼Œæ‹¿åˆ°â€œä¼šè¯å¯†é’¥â€ï¼Œä½œä¸ºåç»­å¯¹ç§°åŠ å¯†ä½¿ç”¨çš„å¯†é’¥ã€‚ 2.2 æ¶ˆæ¯æ‘˜è¦TLSä¿è¯æ¶ˆæ¯çš„å®Œæ•´æ€§åˆ™æ˜¯ä½¿ç”¨äº†æ¶ˆæ¯æ‘˜è¦ï¼Œåªè¦åŒæ–¹åœ¨æ¶ˆæ¯åé™„ä¸Šå®ƒçš„æ‘˜è¦ï¼Œå°±èƒ½å¤Ÿä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚å½“ç„¶æ‘˜è¦ä¹Ÿå¾—ä½¿ç”¨æ··åˆåŠ å¯†ï¼Œå¦åˆ™ä¼šè¢«é»‘å®¢ä¿®æ”¹ã€‚ ç›®å‰ TLS æ¨èä½¿ç”¨æ‘˜è¦ç®—æ³•çš„æ˜¯SHA-2ç³»åˆ—ï¼ˆåŒ…å«SHA224ã€SHA256ã€SHA384ï¼Œåˆ†åˆ«èƒ½å¤Ÿç”Ÿæˆ 28 å­—èŠ‚ã€32 å­—èŠ‚ã€48 å­—èŠ‚çš„æ‘˜è¦ï¼‰ã€‚ 2.3 æ•°å­—ç­¾å&amp;CAæ•°å­—ç­¾åå®ç°äº†èº«ä»½è®¤è¯å’Œä¸å¯å¦è®¤ï¼Œæ•°å­—ç­¾ååˆä½¿ç”¨äº†éå¯¹ç§°åŠ å¯†å’Œæ¶ˆæ¯æ‘˜è¦æŠ€æœ¯ã€‚æˆ‘ä»¬åœ¨è°ˆè°ˆå¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€æ¶ˆæ¯æ‘˜è¦ä»¥åŠæ•°å­—ç­¾åä¸­ä»‹ç»è¿‡ã€‚æ•°å­—ç­¾åå°±æ˜¯å°†æ¶ˆæ¯æ‘˜è¦åçš„æ•°æ®å†ä½¿ç”¨ç§é’¥åŠ å¯†ã€‚ ç„¶è€Œè€ƒè™‘ä¸­é—´äººæ”»å‡»çš„æƒ…å†µï¼Œéå¯¹ç§°åŠ å¯†çš„ç®—æ³•éƒ½æ˜¯å…¬å¼€çš„ï¼Œæ‰€æœ‰äººéƒ½å¯ä»¥è‡ªå·±ç”Ÿæˆä¸€å¯¹å…¬é’¥ç§é’¥ã€‚ å½“æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯è¿”å›å…¬é’¥A1çš„æ—¶å€™ï¼Œä¸­é—´äººå°†å…¶æ›¿æ¢æˆè‡ªå·±çš„å…¬é’¥B1ä¼ é€ç»™æµè§ˆå™¨ã€‚ è€Œæµè§ˆå™¨æ­¤æ—¶ä¸€æ— æ‰€çŸ¥ï¼Œå‚»ä¹ä¹åœ°ä½¿ç”¨å…¬é’¥B1åŠ å¯†äº†å¯†é’¥Kå‘é€å‡ºå»ï¼Œåˆè¢«ä¸­é—´äººæˆªè·ï¼Œä¸­é—´äººåˆ©ç”¨è‡ªå·±çš„ç§é’¥B2è§£å¯†ï¼Œå¾—åˆ°å¯†é’¥Kï¼Œå†ä½¿ç”¨æœåŠ¡ç«¯çš„å…¬é’¥A1åŠ å¯†ä¼ é€ç»™æœåŠ¡ç«¯ï¼Œå®Œæˆäº†é€šä¿¡é“¾è·¯ï¼Œè€ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ¯«æ— æ„ŸçŸ¥ã€‚ è¿™ä¸ªæ—¶å€™å°±éœ€è¦CAè¯ä¹¦äº†ï¼ŒCAè¯ä¹¦è¯æ˜è¯¥å…¬é’¥ç¡®å®æ˜¯æ¥è‡ªæœåŠ¡ç«¯ã€‚æœåŠ¡ç«¯åœ¨ä½¿ç”¨HTTPSå‰ï¼Œå»ç»è¿‡è®¤è¯çš„CAæœºæ„ç”³è¯·é¢å‘ä¸€ä»½æ•°å­—è¯ä¹¦ï¼Œæ•°å­—è¯ä¹¦é‡ŒåŒ…å«æœ‰è¯ä¹¦æŒæœ‰è€…ã€è¯ä¹¦æœ‰æ•ˆæœŸã€æœåŠ¡ç«¯çš„å…¬é’¥ã€CAä½¿ç”¨çš„æ¶ˆæ¯æ‘˜è¦ç®—æ³•ç­‰ä¿¡æ¯ï¼Œç§°ä¸ºæ˜æ–‡æ•°æ®ï¼ŒCAè¿˜ä¼šå°†è¯ä¹¦çš„æ˜æ–‡æ•°æ®è¿›è¡Œæ¶ˆæ¯æ‘˜è¦ï¼Œå¹¶ä½¿ç”¨ç§é’¥ç”Ÿæˆæ•°å­—ç­¾åï¼Œé™„åœ¨è¯ä¹¦å†…ã€‚æœåŠ¡ç«¯å°†è¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ ¡éªŒè¯ä¹¦èº«ä»½å’Œè¦è®¿é—®çš„ç½‘ç«™èº«ä»½ç¡®å®ä¸€è‡´åå†è¿›è¡Œåç»­çš„åŠ å¯†æ“ä½œã€‚ï¼ˆè¯ä¹¦çš„æ„æˆï¼šè¯ä¹¦çš„æ˜æ–‡ä¿¡æ¯+ç”±è¯ä¹¦çš„æ˜æ–‡ä¿¡æ¯å’ŒCAçš„ç§é’¥ç”Ÿæˆçš„æ•°å­—ç­¾åï¼‰ çŸ¥åçš„ CA å…¨ä¸–ç•Œå°±é‚£ä¹ˆå‡ å®¶ï¼Œæ¯”å¦‚ DigiCertã€VeriSignã€Entrustã€Letâ€™s Encrypt ç­‰ï¼Œå®ƒä»¬ç­¾å‘çš„è¯ä¹¦åˆ† DVã€OVã€EV ä¸‰ç§ï¼ŒåŒºåˆ«åœ¨äºå¯ä¿¡ç¨‹åº¦ã€‚å°ä¸€ç‚¹çš„ CA å¯ä»¥è®©å¤§ CA ç­¾åè®¤è¯ï¼Œä½†é“¾æ¡çš„æœ€åï¼Œä¹Ÿå°±æ˜¯Root CAï¼Œå°±åªèƒ½è‡ªå·±è¯æ˜è‡ªå·±äº†ï¼Œè¿™ä¸ªå°±å«â€œè‡ªç­¾åè¯ä¹¦â€ï¼ˆSelf-Signed Certificateï¼‰æˆ–è€…â€œæ ¹è¯ä¹¦â€ï¼ˆRoot Certificateï¼‰ã€‚ä½ å¿…é¡»ç›¸ä¿¡ï¼Œå¦åˆ™æ•´ä¸ªè¯ä¹¦ä¿¡ä»»é“¾å°±èµ°ä¸ä¸‹å»äº†ã€‚ æœ‰äº†è¿™ä¸ªè¯ä¹¦ä½“ç³»ï¼Œæ“ä½œç³»ç»Ÿå’Œæµè§ˆå™¨éƒ½å†…ç½®äº†å„å¤§ CA çš„æ ¹è¯ä¹¦ï¼ˆåŒ…å«CAçš„å…¬é’¥ï¼‰ï¼Œä¸Šç½‘çš„æ—¶å€™åªè¦æœåŠ¡å™¨å‘è¿‡æ¥å®ƒçš„è¯ä¹¦ï¼Œå°±å¯ä»¥éªŒè¯è¯ä¹¦é‡Œçš„ç­¾åï¼Œé¡ºç€è¯ä¹¦é“¾ï¼ˆCertificate Chainï¼‰ä¸€å±‚å±‚åœ°éªŒè¯ï¼Œç›´åˆ°æ‰¾åˆ°æ ¹è¯ä¹¦ï¼Œå°±èƒ½å¤Ÿç¡®å®šè¯ä¹¦æ˜¯å¯ä¿¡çš„ï¼Œä»è€Œç¡®å®šé‡Œé¢çš„å…¬é’¥ä¹Ÿæ˜¯å¯ä¿¡çš„ã€‚ CAæœºæ„é¢å‘è¯ä¹¦çš„è¿‡ç¨‹ï¼š CAæœºæ„æ‹¥æœ‰è‡ªå·±çš„ä¸€å¯¹å…¬é’¥å’Œç§é’¥ CAæœºæ„åœ¨é¢å‘è¯ä¹¦æ—¶å¯¹è¯ä¹¦æ˜æ–‡ä¿¡æ¯è¿›è¡Œå“ˆå¸Œ å°†å“ˆå¸Œå€¼ç”¨ç§é’¥è¿›è¡ŒåŠ ç­¾ï¼Œå¾—åˆ°æ•°å­—ç­¾å æœåŠ¡ç«¯å°†è¯ä¹¦æ˜æ–‡æ•°æ®å’Œæ•°å­—ç­¾åç»„æˆè¯ä¹¦ï¼Œä¼ é€’ç»™å®¢æˆ·ç«¯ã€‚ è€Œå®¢æˆ·ç«¯éœ€è¦éªŒè¯è¯ä¹¦ä¸­çš„å…¬é’¥æ²¡æœ‰è¢«ç¯¡æ”¹ï¼š å®¢æˆ·ç«¯å¾—åˆ°è¯ä¹¦ï¼Œåˆ†è§£æˆæ˜æ–‡éƒ¨åˆ†Textå’Œæ•°å­—ç­¾åSig1 ç”¨CAæœºæ„çš„å…¬é’¥è¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°Sig2ï¼ˆç”±äºCAæœºæ„æ˜¯ä¸€ç§å…¬ä¿¡èº«ä»½ï¼Œå› æ­¤åœ¨ç³»ç»Ÿæˆ–æµè§ˆå™¨ä¸­ä¼šå†…ç½®CAæœºæ„çš„è¯ä¹¦å’Œå…¬é’¥ä¿¡æ¯ï¼‰ ç”¨è¯ä¹¦é‡Œå£°æ˜çš„å“ˆå¸Œç®—æ³•å¯¹æ˜æ–‡Textéƒ¨åˆ†è¿›è¡Œå“ˆå¸Œå¾—åˆ°H å½“è‡ªå·±è®¡ç®—å¾—åˆ°çš„å“ˆå¸Œå€¼Hä¸Sig2ç›¸ç­‰ï¼Œè¡¨ç¤ºè¯ä¹¦å¯ä¿¡ï¼Œæ²¡æœ‰è¢«ç¯¡æ”¹ ç„¶åå®¢æˆ·ç«¯å°±å¯ä»¥ä¿¡ä»»æ˜æ–‡æ•°æ®ä¸­çš„æœåŠ¡ç«¯å…¬é’¥äº†ã€‚ 3 HTTPé€šä¿¡è¿‡ç¨‹ä¸€è§ˆ ç”¨æˆ·åœ¨æµè§ˆå™¨å‘èµ·HTTPSè¯·æ±‚ï¼ˆå¦‚ https://www.mogu.com/ï¼‰ï¼Œé»˜è®¤ä½¿ç”¨æœåŠ¡ç«¯çš„443ç«¯å£è¿›è¡Œè¿æ¥ HTTPSéœ€è¦ä½¿ç”¨ä¸€å¥—CAæ•°å­—è¯ä¹¦ï¼Œè¯ä¹¦å†…ä¼šé™„å¸¦ä¸€ä¸ªå…¬é’¥Pubï¼Œè€Œä¸ä¹‹å¯¹åº”çš„ç§é’¥Privateä¿ç•™åœ¨æœåŠ¡ç«¯ä¸å…¬å¼€ æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚ï¼Œè¿”å›é…ç½®å¥½çš„åŒ…å«å…¬é’¥Pubçš„è¯ä¹¦ç»™å®¢æˆ·ç«¯ å®¢æˆ·ç«¯æ”¶åˆ°è¯ä¹¦ï¼Œæ ¡éªŒåˆæ³•æ€§ï¼Œä¸»è¦åŒ…æ‹¬æ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†…ã€è¯ä¹¦çš„åŸŸåä¸è¯·æ±‚çš„åŸŸåæ˜¯å¦åŒ¹é…ï¼Œä¸Šä¸€çº§è¯ä¹¦æ˜¯å¦æœ‰æ•ˆï¼ˆé€’å½’åˆ¤æ–­ï¼Œç›´åˆ°åˆ¤æ–­åˆ°ç³»ç»Ÿå†…ç½®æˆ–æµè§ˆå™¨é…ç½®å¥½çš„æ ¹è¯ä¹¦ï¼‰ï¼Œå¦‚æœä¸é€šè¿‡ï¼Œåˆ™æ˜¾ç¤ºHTTPSè­¦å‘Šä¿¡æ¯ï¼Œå¦‚æœé€šè¿‡åˆ™ç»§ç»­ å®¢æˆ·ç«¯ç”Ÿæˆä¸€ä¸ªç”¨äºå¯¹ç§°åŠ å¯†çš„éšæœºKeyï¼Œå¹¶ç”¨è¯ä¹¦å†…çš„å…¬é’¥Pubè¿›è¡ŒåŠ å¯†ï¼Œå‘é€ç»™æœåŠ¡ç«¯ æœåŠ¡ç«¯æ”¶åˆ°éšæœºKeyçš„å¯†æ–‡ï¼Œä½¿ç”¨ä¸å…¬é’¥Pubé…å¯¹çš„ç§é’¥Privateè¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°å®¢æˆ·ç«¯çœŸæ­£æƒ³å‘é€çš„éšæœºKey æœåŠ¡ç«¯ä½¿ç”¨å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„éšæœºKeyå¯¹è¦ä¼ è¾“çš„HTTPæ•°æ®è¿›è¡Œå¯¹ç§°åŠ å¯†ï¼Œå°†å¯†æ–‡è¿”å›å®¢æˆ·ç«¯ï¼› å®¢æˆ·ç«¯ä½¿ç”¨éšæœºKeyå¯¹ç§°è§£å¯†å¯†æ–‡ï¼Œå¾—åˆ°HTTPæ•°æ®æ˜æ–‡ åç»­HTTPSè¯·æ±‚ä½¿ç”¨ä¹‹å‰äº¤æ¢å¥½çš„éšæœºKeyè¿›è¡Œå¯¹ç§°åŠ è§£å¯† å…¶ä¸­ç”¨äº†ä¸¤æ¬¡éå¯¹ç§°åŠ å¯†ï¼Œè¿™ä¸¤æ¬¡éå¯¹ç§°åŠ å¯†æ˜¯å®¹æ˜“æŠŠäººææ‡µçš„ï¼š ç¬¬ä¸€æ¬¡æ˜¯å®¢æˆ·ç«¯è·å–è¯ä¹¦åï¼Œä½¿ç”¨CAçš„å…¬é’¥è§£å¯†è¯ä¹¦ä¸­çš„æ•°å­—ç­¾åï¼Œç„¶ååˆ¤æ–­è¯ä¹¦ä¸­çš„æœåŠ¡ç«¯å…¬é’¥æ˜¯å¦å¯ä¿¡ ç¬¬äºŒæ¬¡æ˜¯å®¢æˆ·ç«¯ä½¿ç”¨æœåŠ¡ç«¯å…¬é’¥å¯¹ä½¿ç”¨éšæœºæ•°ç”Ÿæˆçš„å¯¹ç§°åŠ å¯†å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œç„¶åå‘ç»™æœåŠ¡ç«¯ã€‚","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","permalink":"https://www.codetool.top/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"},{"name":"HTTP","slug":"HTTP","permalink":"https://www.codetool.top/tags/HTTP/"}]},{"title":"æ“ä½œç³»ç»Ÿå¤ä¹ 02-å¤„ç†å™¨ç®¡ç†ï¼ˆè¿›ç¨‹ç®¡ç†ï¼‰","slug":"æ“ä½œç³»ç»Ÿå¤ä¹ 02-å¤„ç†å™¨ç®¡ç†ï¼ˆè¿›ç¨‹ç®¡ç†ï¼‰","date":"2020-04-16T09:54:01.000Z","updated":"2020-04-21T16:52:51.182Z","comments":true,"path":"article/æ“ä½œç³»ç»Ÿå¤ä¹ 02-å¤„ç†å™¨ç®¡ç†ï¼ˆè¿›ç¨‹ç®¡ç†ï¼‰/","link":"","permalink":"https://www.codetool.top/article/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A002-%E5%A4%84%E7%90%86%E5%99%A8%E7%AE%A1%E7%90%86%EF%BC%88%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%EF%BC%89/","excerpt":"","text":"1 å¤„ç†å™¨æ¦‚å¿µ ç‰¹æƒæŒ‡ä»¤å’Œéç‰¹æƒæŒ‡ä»¤ã€ç®¡æ€å’Œç›®æ€å·²åœ¨ä¸Šä¸€ç¯‡æåŠã€‚ Intelçš„X86å¤„ç†å™¨å…·æœ‰å››ä¸ªç‰¹æƒçº§åˆ«ï¼Œåˆ†åˆ«æ˜¯RING0ã€RING1ã€RING2ã€RING3ï¼ŒRING0å±‚æ‹¥æœ‰æœ€é«˜æƒé™ï¼Œä¾æ­¤å‘ä¸‹RING3å±‚å³æ‹¥æœ‰æœ€ä½çš„æƒé™ã€‚ ç”¨æˆ·æ€åˆ‡æ¢ä¸ºæ ¸å¿ƒæ€æ˜¯é€šè¿‡ä¸­æ–­å®ç°çš„ã€‚å¹¶ä¸”ä¸­æ–­æ˜¯å”¯ä¸€é€”å¾„ï¼Œç”¨æˆ·æ‰‹åŠ¨è§¦å‘ä¸­æ–­çš„æŒ‡ä»¤ç§°ä¸ºé™·é˜±æŒ‡ä»¤ï¼Œä¹Ÿç§°ä¸ºè®¿ç®¡æŒ‡ä»¤ã€‚ æ ¸å¿ƒæ€åˆ‡æ¢ä¸ºç”¨æˆ·æ€æ˜¯é€šè¿‡æ‰§è¡Œä¸€ä¸ªç‰¹æƒæŒ‡ä»¤ï¼Œå°†ç¨‹åºçŠ¶æ€å­—(PSW)çš„æ ‡å¿—ä½è®¾ç½®ä¸ºç”¨æˆ·æ€ã€‚ 1.1 ç”¨æˆ·æ ˆå’Œæ ¸å¿ƒæ ˆç”¨æˆ·æ ˆï¼šæ˜¯ç”¨æˆ·è¿›ç¨‹ç©ºé—´ä¸­å¼€è¾Ÿçš„å†…å­˜åŒºåŸŸï¼Œç”¨äºä¿å­˜åº”ç”¨ç¨‹åºçš„å­ç¨‹åº(å‡½æ•°)é—´ç›¸äº’è°ƒç”¨çš„å‚æ•°ã€è¿”å›å€¼ã€è¿”å›ç‚¹ä»¥åŠå­ç¨‹åºçš„å±€éƒ¨å˜é‡ã€‚ æ ¸å¿ƒæ ˆï¼šæ¯ä¸ªè¿›ç¨‹è¢«åˆ›å»ºæ—¶æ†ç»‘ä¸€ä¸ªæ ¸å¿ƒæ ˆï¼Œæ˜¯å†…å­˜ä¸­å±äºOSç©ºé—´çš„åŒºåŸŸï¼Œç”¨é€”åŒ…æ‹¬ï¼šç”¨äºä¿å­˜ä¸­æ–­ç°åœºï¼›æˆ–ä¿å­˜OSç¨‹åºé—´ç›¸äº’è°ƒç”¨çš„å‚æ•°ã€è¿”å›å€¼ã€è¿”å›ç‚¹ä»¥åŠç¨‹åºå±€éƒ¨å˜é‡ã€‚ 1.2 ç¨‹åºçŠ¶æ€å­—PSWè®¡ç®—æœºå¦‚ä½•çŸ¥é“å½“å‰å¤„äºç®¡æ€è¿˜æ˜¯ç›®æ€ï¼Ÿé€šå¸¸OSéƒ½å¼•å…¥ç¨‹åºçŠ¶æ€å­—PSWï¼ˆProgram Status Wordï¼‰æ¥åŒºåˆ«ä¸åŒçš„å¤„ç†å™¨å·¥ä½œçŠ¶æ€ã€‚ PSWç”¨æ¥æ§åˆ¶æŒ‡ä»¤æ‰§è¡Œé¡ºåºå¹¶ä¿ç•™å’ŒæŒ‡ç¤ºä¸ç¨‹åºæœ‰å…³çš„ç³»ç»ŸçŠ¶æ€ï¼Œä¸»è¦ä½œç”¨æ˜¯å®ç°ç¨‹åºçŠ¶æ€çš„ä¿æŠ¤å’Œæ¢å¤ã€‚æ¯ä¸ªç¨‹åºéƒ½æœ‰ä¸€ä¸ªä¸å…¶æ‰§è¡Œç›¸å…³çš„PSWï¼Œæ¯ä¸ªå¤„ç†å™¨éƒ½è®¾ç½®ä¸€ä¸ªPSWå¯„å­˜å™¨ã€‚ç¨‹åºå æœ‰å¤„ç†å™¨æ‰§è¡Œï¼Œå®ƒçš„PSWå°†å æœ‰PSWå¯„å­˜å™¨ã€‚ PSWå¯„å­˜å™¨åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š ç¨‹åºåŸºæœ¬çŠ¶æ€ï¼š ç¨‹åºè®¡æ•°å™¨ï¼› æ¡ä»¶ç ï¼› å¤„ç†å™¨çŠ¶æ€ä½ã€‚ ä¸­æ–­ç ï¼šä¿å­˜ç¨‹åºæ‰§è¡Œæ—¶å½“å‰å‘ç”Ÿçš„ä¸­æ–­äº‹ä»¶ã€‚ ä¸­æ–­å±è”½ä½ï¼šæŒ‡æ˜ç¨‹åºæ‰§è¡Œä¸­å‘ç”Ÿä¸­æ–­äº‹ä»¶æ—¶ï¼Œæ˜¯å¦å“åº”å‡ºç°çš„ä¸­æ–­äº‹ä»¶ã€‚ Intel x86ä¸­ï¼ŒPSWç”±æ ‡å¿—å¯„å­˜å™¨EFLAGSå’ŒæŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨EIPç»„æˆï¼Œå‡ä¸º32ä½ã€‚ EFLAGSçš„ä½16ä½ç§°FLAGSï¼Œæ ‡å¿—å¯åˆ’åˆ†ä¸ºä¸‰ç»„ï¼šçŠ¶æ€æ ‡å¿—ã€æ§åˆ¶æ ‡å¿—ã€ç³»ç»Ÿæ ‡å¿—ã€‚ 2 ä¸­æ–­æŠ€æœ¯ ä¸­æ–­æ˜¯æŒ‡ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œé‡åˆ°æ€¥éœ€å¤„ç†çš„äº‹ä»¶æ—¶ï¼Œæš‚æ—¶ä¸­æ­¢CPUä¸Šç°è¡Œç¨‹åºçš„è¿è¡Œï¼Œè½¬å»æ‰§è¡Œç›¸åº”çš„äº‹ä»¶å¤„ç†ç¨‹åºï¼Œå¾…å¤„ç†å®Œæˆåå†è¿”å›åŸç¨‹åºè¢«ä¸­æ–­å¤„æˆ–è°ƒåº¦å…¶ä»–ç¨‹åºæ‰§è¡Œçš„è¿‡ç¨‹ã€‚ 2.1 ä¸­æ–­æºåˆ†ç±» å†…ä¸­æ–­ï¼šä¿¡å·çš„æ¥æºæ˜¯CPUå†…éƒ¨ï¼Œä¸å½“å‰æ‰§è¡Œçš„æŒ‡ä»¤æœ‰å…³ I/Oä¸­æ–­ è®¿ç®¡ä¸­æ–­ï¼šè°ƒç”¨è®¿ç®¡æŒ‡ä»¤ï¼Œæ˜¯ç¨‹åºè‡ªæ„¿çš„ ç¡¬ä»¶æ•…éšœ ç¨‹åºæ€§ä¸­æ–­ï¼ˆå’Œç¼–ç¨‹æ—¶çš„é—®é¢˜æœ‰å…³ï¼‰ å¤–ä¸­æ–­ï¼šä¿¡å·çš„æ¥æºæ˜¯CPUå¤–éƒ¨ï¼Œä¸å½“å‰æ‰§è¡Œçš„æŒ‡ä»¤æ— å…³ å¤–éƒ¨è®¾å¤‡è¯·æ±‚ æ—¶é’Ÿä¸­æ–­ å¤–ä¸­æ–­åˆåˆ†å¯å±è”½ä¸­æ–­å’Œä¸å¯å±è”½ä¸­æ–­ï¼Œå†…ä¸­æ–­å®Œå…¨ä¸å¯å±è”½ã€‚ æ—¶é’Ÿæ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œè°ƒåº¦å·¥ä½œçš„é‡è¦å·¥å…·ï¼Œå¦‚è®©åˆ†æ—¶è¿›ç¨‹ä½œæ—¶é—´ç‰‡è½®è½¬ã€è®©å®æ—¶è¿›ç¨‹å®šæ—¶å‘å‡ºæˆ–æ¥æ”¶æ§åˆ¶ä¿¡å·ã€ç³»ç»Ÿå®šæ—¶å”¤é†’æˆ–é˜»å¡ä¸€ä¸ªè¿›ç¨‹ã€å¯¹ç”¨æˆ·è¿›ç¨‹è¿›è¡Œè®°è´¦ã€‚ 2.2 ä¸­æ–­ä¼˜å…ˆçº§æ¯ä¸ªä¸åŒä¸­æ–­å…·æœ‰ä¸åŒçš„ä¸­æ–­ä¼˜å…ˆçº§ï¼Œè¡¨ç¤ºäº‹ä»¶çš„ç´§æ€¥ç¨‹åº¦ï¼Œåœ¨å¤„ç†é«˜ä¸€çº§ä¸­æ–­æ—¶ï¼Œå¾€å¾€ä¼šå±è”½éƒ¨åˆ†æˆ–å…¨éƒ¨ä½çº§ä¸­æ–­ã€‚çº§åˆ«é«˜çš„æœ‰ä¼˜å…ˆè·å¾—å“åº”çš„æƒåŠ›ï¼Œä¸­æ–­è£…ç½®é¢„å®šçš„è¿™ä¸ªå“åº”é¡ºåºç§°ä¸ºä¸­æ–­ä¼˜å…ˆçº§ã€‚ 2.3 å¤šé‡ä¸­æ–­äº‹ä»¶çš„å¤„ç†ä¸­æ–­æ­£åœ¨è¿›è¡Œå¤„ç†æœŸé—´ï¼ŒCPUåˆå“åº”æ–°çš„ä¸­æ–­äº‹ä»¶ï¼Œäºæ˜¯æš‚æ—¶åœæ­¢æ­£åœ¨è¿è¡Œçš„ä¸­æ–­å¤„ç†ç¨‹åºï¼Œè½¬å»æ‰§è¡Œæ–°çš„ä¸­æ–­å¤„ç†ç¨‹åºï¼Œå°±å«å¤šé‡ä¸­æ–­ï¼ˆåˆç§°ä¸­æ–­åµŒå¥—ï¼‰ã€‚å¤„ç†æ–¹æ³•ï¼š ä¸²è¡Œå¤„ç†ï¼Œ åµŒå¥—å¤„ç†ï¼Œ å³æ—¶å¤„ç†ã€‚ 3 è¿›ç¨‹åŠå…¶å®ç° 3.1 è¿›ç¨‹æ¦‚å¿µ è¿›ç¨‹æ˜¯å¯å¹¶å‘æ‰§è¡Œçš„ç¨‹åºåœ¨æŸä¸ªæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è®¡ç®—æ´»åŠ¨ï¼Œä¹Ÿæ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œä¿æŠ¤çš„åŸºæœ¬å•ä½ã€‚ è¿›ç¨‹æ˜¯ä¸€ä¸ªæ—¢èƒ½ç”¨æ¥å…±äº«èµ„æºï¼Œåˆèƒ½æè¿°ç¨‹åºå¹¶å‘æ‰§è¡Œè¿‡ç¨‹çš„ç³»ç»ŸåŸºæœ¬å•ä½ã€‚ è¿›ç¨‹æ˜¯ä¸€ç§æ”¯æŒç¨‹åºæ‰§è¡Œçš„ç³»ç»Ÿæœºåˆ¶ã€‚ è¿›ç¨‹çš„å±æ€§ï¼š åŠ¨æ€æ€§ å…±äº«æ€§ ç‹¬ç«‹æ€§ï¼šç‹¬ç«‹æ€§ä¼šä½“ç°åœ¨è™šå­˜ã€ç¨‹åºè®¡æ•°å™¨ã€å†…éƒ¨çŠ¶æ€ä¸Š åˆ¶çº¦æ€§ å¹¶å‘æ€§ 3.2 è¿›ç¨‹çŠ¶æ€å’Œè½¬æ¢æœ¬èŠ‚å‚è€ƒå’Œå›¾ç‰‡æ¥æºï¼šè¿›ç¨‹çš„çŠ¶æ€è½¬æ¢ - LRHå‘€ - åšå®¢å›­ 3.2.1 ä¸‰æ€æ¨¡å‹ä¸‰æ€æ¨¡å‹ï¼Œä¹Ÿæ˜¯æœ€åŸºæœ¬çš„å‡ ä¸ªçŠ¶æ€ï¼š å°±ç»ªæ€æ„å‘³ç€è¿è¡Œæ¡ä»¶æ»¡è¶³ï¼Œç­‰å¾…ç³»ç»Ÿåˆ†é…å¤„ç†å™¨ä»¥ä¾¿è¿è¡Œ è¿è¡Œæ€æ˜¯å·²åˆ†é…å¤„ç†å™¨ï¼Œæ­£åœ¨è¿è¡Œçš„çŠ¶æ€ ç­‰å¾…æ€ï¼ˆä¹Ÿç§°ä¸ºé˜»å¡æ€ï¼‰æ˜¯ä¸å…·å¤‡è¿è¡Œæ¡ä»¶ï¼Œç­‰å¾…æŸä¸ªäº‹ä»¶å®Œæˆï¼Œå¦‚IOè¾“å…¥ã€‚ 3.2.2 äº”æ€æ¨¡å‹ äº”æ€æ¨¡å‹åœ¨ä¸‰æ€æ¨¡å‹çš„åŸºç¡€ä¸ŠåŠ äº†æ–°å»ºæ€å’Œç»ˆæ­¢æ€ã€‚ æ–°å»ºæ€ï¼šå¯¹åº”äºè¿›ç¨‹è¢«åˆ›å»ºæ—¶çš„çŠ¶æ€ï¼Œå°šæœªè¿›å…¥å°±ç»ªé˜Ÿåˆ—ã€‚ åˆ›å»ºä¸€ä¸ªè¿›ç¨‹éœ€è¦é€šè¿‡ä¸¤ä¸ªæ­¥éª¤ï¼š 1.ä¸ºæ–°è¿›ç¨‹åˆ†é…æ‰€éœ€è¦èµ„æºå’Œå»ºç«‹å¿…è¦çš„ç®¡ç†ä¿¡æ¯ã€‚2.è®¾ç½®è¯¥è¿›ç¨‹ä¸ºå°±ç»ªæ€ï¼Œå¹¶ç­‰å¾…è¢«è°ƒåº¦æ‰§è¡Œã€‚ ç»ˆæ­¢æ€ï¼šæŒ‡è¿›ç¨‹å®Œæˆä»»åŠ¡åˆ°è¾¾æ­£å¸¸ç»“æŸç‚¹ï¼Œæˆ–å‡ºç°æ— æ³•å…‹æœçš„é”™è¯¯è€Œå¼‚å¸¸ç»ˆæ­¢ï¼Œæˆ–è¢«æ“ä½œç³»ç»ŸåŠæœ‰ç»ˆæ­¢æƒçš„è¿›ç¨‹æ‰€ç»ˆæ­¢æ—¶æ‰€å¤„çš„çŠ¶æ€ã€‚ å¤„äºç»ˆæ­¢æ€çš„è¿›ç¨‹ä¸å†è¢«è°ƒåº¦æ‰§è¡Œï¼Œä¸‹ä¸€æ­¥å°†è¢«ç³»ç»Ÿæ’¤é”€ï¼Œæœ€ç»ˆä»ç³»ç»Ÿä¸­æ¶ˆå¤±ã€‚ç»ˆæ­¢ä¸€ä¸ªè¿›ç¨‹éœ€è¦ä¸¤ä¸ªæ­¥éª¤ï¼š 1.å…ˆç­‰å¾…æ“ä½œç³»ç»Ÿæˆ–ç›¸å…³çš„è¿›ç¨‹è¿›è¡Œå–„åå¤„ç†ï¼ˆå¦‚æŠ½å–ä¿¡æ¯ï¼‰ã€‚2.ç„¶åå›æ”¶å ç”¨çš„èµ„æºå¹¶è¢«ç³»ç»Ÿåˆ é™¤ã€‚ 3.2.3 ä¸ƒæ€æ¨¡å‹ä¸‰æ€æ¨¡å‹å’Œäº”æ€æ¨¡å‹éƒ½æ˜¯å‡è®¾æ‰€æœ‰è¿›ç¨‹éƒ½åœ¨å†…å­˜ä¸­çš„äº‹å®ä¸Šæœ‰åºä¸æ–­çš„åˆ›å»ºè¿›ç¨‹ï¼Œå½“ç³»ç»Ÿèµ„æºå°¤å…¶æ˜¯å†…å­˜èµ„æºå·²ç»ä¸èƒ½æ»¡è¶³è¿›ç¨‹è¿è¡Œçš„è¦æ±‚æ—¶ï¼Œå¿…é¡»æŠŠæŸäº›è¿›ç¨‹æŒ‚èµ·ï¼ˆsuspendï¼‰ï¼Œå¯¹æ¢åˆ°ç£ç›˜å¯¹æ¢åŒºä¸­ï¼Œé‡Šæ”¾å®ƒå æœ‰çš„æŸäº›èµ„æºï¼Œæš‚æ—¶ä¸å‚ä¸ä½çº§è°ƒåº¦ã€‚ èµ·åˆ°å¹³æ»‘ç³»ç»Ÿæ“ä½œè´Ÿè·çš„ç›®çš„ã€‚ ä¸ƒæ€æ¨¡å‹åœ¨äº”æ€æ¨¡å‹çš„åŸºç¡€ä¸Šå¢åŠ äº†æŒ‚èµ·å°±ç»ªæ€ï¼ˆready suspendï¼‰å’ŒæŒ‚èµ·ç­‰å¾…æ€ï¼ˆblocked suspendï¼‰ã€‚ æŒ‚èµ·å°±ç»ªæ€ï¼šè¿›ç¨‹å…·å¤‡è¿è¡Œæ¡ä»¶ï¼Œä½†ç›®å‰åœ¨å¤–å­˜ä¸­ï¼Œåªæœ‰å®ƒè¢«å¯¹æ¢åˆ°å†…å­˜æ‰èƒ½è¢«è°ƒåº¦æ‰§è¡Œã€‚ æŒ‚èµ·ç­‰å¾…æ€ï¼šè¡¨æ˜è¿›ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸€ä¸ªäº‹ä»¶å‘ç”Ÿä¸”åœ¨å¤–å­˜ä¸­ã€‚ 3.3 è¿›ç¨‹çš„æè¿°å’Œç»„æˆ3.3.1 è¿›ç¨‹æ˜ åƒè¿›ç¨‹å®ä½“(è¿›ç¨‹æ˜ åƒ)çš„ç»„æˆï¼š è¿›ç¨‹æ§åˆ¶å—ï¼ˆPCBï¼‰ è¿›ç¨‹ç¨‹åºå— è¿›ç¨‹æ ¸å¿ƒæ ˆ è¿›ç¨‹æ•°æ®å— è¿›ç¨‹æ§åˆ¶å—PCBï¼Œæ˜¯OSç”¨äºè®°å½•å’Œåˆ»åˆ’è¿›ç¨‹çŠ¶æ€åŠæœ‰å…³ä¿¡æ¯çš„æ•°æ®ç»“æ„ã€‚ä¹Ÿæ˜¯OSæŒæ¡è¿›ç¨‹çš„å”¯ä¸€èµ„æ–™ç»“æ„ï¼Œå®ƒåŒ…æ‹¬è¿›ç¨‹æ‰§è¡Œæ—¶çš„æƒ…å†µï¼Œä»¥åŠè¿›ç¨‹è®©å‡ºå¤„ç†å™¨åæ‰€å¤„çš„çŠ¶æ€ã€æ–­ç‚¹ç­‰ä¿¡æ¯ã€‚ PCBæ˜¯è¿›ç¨‹å­˜åœ¨çš„å”¯ä¸€æ ‡å¿—ã€‚ è¿›ç¨‹æ§åˆ¶å—åŒ…å«ä¸‰ç±»ä¿¡æ¯ï¼š æ ‡è¯†ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿›ç¨‹å·ï¼ˆpidï¼‰ï¼Œè¿›ç¨‹ç»„ï¼Œç”¨æˆ·æ ‡è¯†ç¬¦ï¼ˆuidï¼‰ ç°åœºä¿¡æ¯ï¼ŒåŒ…å«ä¸­æ–­æ—¶å¤„ç†å™¨çš„ä¿¡æ¯ æ§åˆ¶ä¿¡æ¯ è¿›ç¨‹è°ƒåº¦çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚è¿›ç¨‹ä¼˜å…ˆçº§ è¿›ç¨‹ç»„æˆä¿¡æ¯ è¿›ç¨‹é—´çš„æ—ç³»ä¿¡æ¯ è¿›ç¨‹é—´é€šä¿¡ä¿¡æ¯ 3.3.2 è¿›ç¨‹é˜Ÿåˆ—åŠå…¶ç®¡ç†å¤„äºåŒä¸€çŠ¶æ€çš„æ‰€æœ‰PCBé“¾æ¥åœ¨ä¸€èµ·çš„æ•°æ®ç»“æ„ç§°ä¸ºè¿›ç¨‹é˜Ÿåˆ—ã€‚ å¯æŒ‰å…ˆæ¥å…ˆåˆ°çš„åŸåˆ™æ’æˆé˜Ÿåˆ—ï¼Œä¹Ÿå¯æŒ‰ä¼˜å…ˆæ•°æˆ–å…¶å®ƒåŸåˆ™æ’é˜Ÿã€‚ ç»„ç»‡æ–¹å¼ï¼š çº¿æ€§æ–¹å¼ é“¾æ¥æ–¹å¼ï¼šæ“ä½œç³»ç»ŸæŒæœ‰æŒ‡å‘å„ä¸ªé˜Ÿåˆ—çš„æŒ‡é’ˆ ç´¢å¼•æ–¹å¼ï¼šæ ¹æ®è¿›ç¨‹çŠ¶æ€çš„ä¸åŒï¼Œå»ºç«‹å‡ å¼ ç´¢å¼•è¡¨ï¼Œæ“ä½œç³»ç»ŸæŒæœ‰æŒ‡å‘å„ä¸ªç´¢å¼•è¡¨çš„æŒ‡é’ˆ 3.3.3 è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢è¿›ç¨‹åˆ‡æ¢æ˜¯è®©å¤„äºè¿è¡Œæ€çš„è¿›ç¨‹ä¸­æ–­è¿è¡Œï¼Œè®©å‡ºå¤„ç†å™¨ï¼Œè¿™æ—¶è¦åšä¸€æ¬¡è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ã€å³ä¿å­˜è€è¿›ç¨‹çš„ä¸Šä¸‹æ–‡è€Œè£…å…¥è¢«ä¿æŠ¤äº†çš„æ–°è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œä»¥ä¾¿æ–°è¿›ç¨‹è¿è¡Œã€‚ ä¸­æ–­è¿è¡Œçš„ä¸‰ç§æƒ…å†µï¼š è¢«é˜»å¡çš„é«˜ä¼˜å…ˆçº§è¿›ç¨‹å˜ä¸ºå°±ç»ªæ€ è¿è¡Œè¿›ç¨‹çš„æ—¶é—´ç‰‡è€—å°½ è¿è¡Œè¿›ç¨‹æ‰§è¡Œé˜»å¡å‹I/OæŒ‡ä»¤ï¼ˆå˜ä¸ºå‡†å¤‡æ€ï¼‰ å½“ç„¶ï¼Œè¿™äº›æƒ…å†µè§¦å‘ä¹Ÿä¸ä¸€å®šå°±ä¼šç«‹å³è¿›è¡Œè¿›ç¨‹è°ƒåº¦å’Œåˆ‡æ¢ï¼Œä¾‹å¤–æƒ…å†µï¼š å†…æ ¸æ­£åœ¨å¤„ç†ä¸­æ–­çš„è¿‡ç¨‹ä¸­ è¿›ç¨‹è¿è¡Œåœ¨å†…æ ¸ä¸´ç•ŒåŒºä¸­ å†…æ ¸å¤„åœ¨éœ€è¦å±è”½ä¸­æ–­çš„åŸå­æ“ä½œè¿‡ç¨‹ä¸­ è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ­¥éª¤ï¼š ä¿å­˜è¢«ä¸­æ–­è¿›ç¨‹çš„å¤„ç†å™¨ç°åœºä¿¡æ¯ ä¿®æ”¹è¢«ä¸­æ–­è¿›ç¨‹çš„PCBæœ‰å…³ä¿¡æ¯ï¼Œå¦‚è¿›ç¨‹çŠ¶æ€ç­‰ æŠŠè¢«ä¸­æ–­è¿›ç¨‹çš„PSBåŠ å…¥æœ‰å…³é˜Ÿåˆ— é€‰æ‹©ä¸‹ä¸€ä¸ªå æœ‰å¤„ç†å™¨è¿è¡Œçš„è¿›ç¨‹ ä¿®æ”¹è¢«é€‰ä¸­è¿›ç¨‹çš„PSBçš„æœ‰å…³ä¿¡æ¯ æ ¹æ®è¢«é€‰ä¸­è¿›ç¨‹è®¾ç½®æ“ä½œç³»ç»Ÿç”¨åˆ°çš„åœ°å€è½¬æ¢å’Œå­˜å‚¨ä¿æŠ¤ä¿¡æ¯ æ ¹æ®è¢«é€‰ä¸­è¿›ç¨‹æ¢å¤å¤„ç†å™¨ç°åœº å½“ä¸­æ–­/ç³»ç»Ÿè°ƒç”¨å‘ç”Ÿæ—¶ï¼Œæš‚æ—¶ä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ç”¨æˆ·è¿›ç¨‹ï¼ŒæŠŠè¿›ç¨‹ä»ç”¨æˆ·çŠ¶æ€è½¬æ¢åˆ°å†…æ ¸çŠ¶æ€ï¼Œå»æ‰§è¡Œæ“ä½œç³»ç»ŸæœåŠ¡ç¨‹åºä»¥è·å¾—æœåŠ¡ï¼Œè¿™å°±æ˜¯ä¸€æ¬¡å¤„ç†å™¨çŠ¶æ€è½¬æ¢ã€‚ å¤„ç†å™¨çŠ¶æ€è½¬æ¢çš„æ­¥éª¤ï¼š ä¿å­˜è¢«ä¸­æ–­è¿›ç¨‹çš„å¤„ç†å™¨ç°åœºä¿¡æ¯ï¼› å¤„ç†å™¨ä»ç”¨æˆ·æ€è½¬æ¢åˆ°æ ¸å¿ƒæ€ï¼Œä»¥ä¾¿æ‰§è¡ŒæœåŠ¡ç¨‹åºæˆ–ä¸­æ–­å¤„ç†ç¨‹åºï¼› å¦‚æœå¤„ç†ä¸­æ–­ï¼Œå¯æ ¹æ®è§„å®šçš„ä¸­æ–­çº§è®¾ç½®ä¸­æ–­å±è”½ä½ï¼› æ ¹æ®ç³»ç»Ÿè°ƒç”¨å·æˆ–ä¸­æ–­å·ï¼Œä»ç³»ç»Ÿè°ƒç”¨è¡¨æˆ–ä¸­æ–­å…¥å£è¡¨æ‰¾åˆ°æœåŠ¡ç¨‹åºæˆ–ä¸­æ–­å¤„ç†ç¨‹åºåœ°å€ã€‚ 3.4 è¿›ç¨‹ç®¡ç†åŸè¯­è¿™ä¸ªä¸å±äºè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸­çš„å†…å®¹ï¼Œæ€ç»´å¯¼å›¾é‡Œé¢æ˜¯æˆ‘å¼„é”™äº†ã€‚ è¿›ç¨‹ç®¡ç†åŸè¯­ç”¨äºè¿›ç¨‹æ§åˆ¶ï¼Œæœ‰ï¼š è¿›ç¨‹åˆ›å»º è¿›ç¨‹æ’¤é”€ è¿›ç¨‹é˜»å¡ è¿›ç¨‹å”¤é†’ è¿›ç¨‹æŒ‚èµ· è¿›ç¨‹æ¿€æ´» è¿›ç¨‹åˆ›å»ºçš„è¯¦ç»†æ­¥éª¤ï¼š åœ¨è¿›ç¨‹åˆ—è¡¨ä¸­å¢åŠ ä¸€é¡¹ï¼Œä»PCBæ± ä¸­ç”³è¯·ä¸€ä¸ªç©ºé—²PCBï¼Œä¸ºæ–°è¿›ç¨‹åˆ†é…æƒŸä¸€çš„è¿›ç¨‹æ ‡è¯†ç¬¦ ä¸ºæ–°è¿›ç¨‹çš„è¿›ç¨‹æ˜ åƒåˆ†é…åœ°å€ç©ºé—´ï¼Œä»¥ä¾¿å®¹çº³è¿›ç¨‹å®ä½“ã€‚è¿›ç¨‹ç®¡ç†ç¨‹åºç¡®å®šåŠ è½½åˆ°è¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„ç¨‹åº ä¸ºæ–°è¿›ç¨‹åˆ†é…é™¤ä¸»å­˜ç©ºé—´å¤–çš„å…¶ä»–å„ç§æ‰€éœ€èµ„æºï¼› åˆå§‹åŒ–PCBï¼Œå¦‚è¿›ç¨‹æ ‡è¯†ç¬¦ã€å¤„ç†å™¨åˆå§‹çŠ¶æ€ã€è¿›ç¨‹ä¼˜å…ˆçº§ç­‰ï¼› æŠŠæ–°è¿›ç¨‹çŠ¶æ€ç½®ä¸ºå°±ç»ªæ€ï¼Œå¹¶ç§»å…¥å°±ç»ªè¿›ç¨‹é˜Ÿåˆ—ï¼› é€šçŸ¥æ“ä½œç³»ç»Ÿçš„æŸäº›æ¨¡å—ï¼Œå¦‚è®°è´¦ç¨‹åºã€æ€§èƒ½ç›‘æ§ç¨‹åºã€‚ linuxåˆ›å»ºè¿›ç¨‹/çº¿ç¨‹å¯ä»¥ä½¿ç”¨ï¼š fork()ï¼šçˆ¶å­è¿›ç¨‹æ˜¯ç‹¬ç«‹çš„è¿›ç¨‹ clone()ï¼šçˆ¶å­è¿›ç¨‹å…è®¸å…±äº«èµ„æº vfork()ï¼šå­è¿›ç¨‹ç§Ÿç”¨çˆ¶è¿›ç¨‹åœ°å€ç©ºé—´ è¿›ç¨‹æ’¤é”€çš„è¯¦ç»†æ­¥éª¤ï¼š æ ¹æ®æ’¤é”€è¿›ç¨‹æ ‡è¯†å·ï¼Œä»ç›¸åº”é˜Ÿåˆ—ä¸­æ‰¾åˆ°å¹¶ç§»å‡ºå®ƒ å°†è¯¥è¿›ç¨‹æ‹¥æœ‰çš„èµ„æºå½’è¿˜ç»™çˆ¶è¿›ç¨‹æˆ–æ“ä½œç³»ç»Ÿ è‹¥è¯¥è¿›ç¨‹æ‹¥æœ‰å­è¿›ç¨‹ï¼Œå…ˆæ’¤é”€å®ƒçš„æ‰€æœ‰å­è¿›ç¨‹ï¼Œä»¥é˜²å®ƒä»¬è„±ç¦»æ§åˆ¶ å›æ”¶PCBï¼Œå¹¶å½’è¿˜åˆ°PCBæ±  è¿›ç¨‹é˜»å¡æ­¥éª¤ï¼š åœæ­¢è¿›ç¨‹æ‰§è¡Œï¼Œä¿å­˜ç°åœºä¿¡æ¯åˆ°PCB ä¿®æ”¹è¿›ç¨‹PCBæœ‰å…³å†…å®¹ï¼Œå¦‚è¿›ç¨‹çŠ¶æ€ç”±è¿è¡Œæ€æ”¹ä¸ºç­‰å¾…æ€ç­‰ï¼Œå¹¶æŠŠä¿®æ”¹çŠ¶æ€åçš„è¿›ç¨‹ç§»å…¥ç›¸åº”äº‹ä»¶çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ è½¬å…¥è¿›ç¨‹è°ƒåº¦ç¨‹åºå»è°ƒåº¦å…¶ä»–è¿›ç¨‹è¿è¡Œ è¿›ç¨‹å”¤é†’æ­¥éª¤ï¼š ä»ç›¸åº”çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»å‡ºè¿›ç¨‹ ä¿®æ”¹è¿›ç¨‹PCBçš„æœ‰å…³ä¿¡æ¯ï¼Œå¦‚è¿›ç¨‹çŠ¶æ€æ”¹ä¸ºå°±ç»ªæ€ï¼Œå¹¶ç§»å…¥å°±ç»ªé˜Ÿåˆ— è‹¥è¢«å”¤é†’è¿›ç¨‹æ¯”å½“å‰è¿è¡Œè¿›ç¨‹ä¼˜å…ˆçº§é«˜ï¼Œé‡æ–°è®¾ç½®è°ƒåº¦æ ‡å¿— 4 çº¿ç¨‹åŠå…¶å®ç° 4.1 çº¿ç¨‹æ¦‚å¿µOSä¸­å¼•å…¥è¿›ç¨‹çš„ç›®çš„æ˜¯ä¸ºäº†ä½¿å¤šä¸ªç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œä»¥æ”¹å–„èµ„æºä½¿ç”¨ç‡å’Œæé«˜ç³»ç»Ÿæ•ˆç‡ï¼ŒOSä¸­å†å¼•å…¥çº¿ç¨‹ï¼Œåˆ™æ˜¯ä¸ºäº†å‡å°‘ç¨‹åºå¹¶å‘æ‰§è¡Œæ—¶æ‰€ä»˜å‡ºçš„æ—¶ç©ºå¼€é”€ï¼Œä½¿å¾—å¹¶å‘ç²’åº¦æ›´ç»†ã€å¹¶å‘æ€§æ›´å¥½ã€‚ çº¿ç¨‹æ˜¯OSè¿›ç¨‹ä¸­èƒ½å¤Ÿç‹¬ç«‹æ‰§è¡Œçš„å®ä½“ï¼ˆæ§åˆ¶æµï¼‰ï¼Œæ˜¯å¤„ç†å™¨è°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ã€‚çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ç»„æˆéƒ¨åˆ†ï¼Œæ¯ä¸ªè¿›ç¨‹å†…å…è®¸åŒ…å«å¤šä¸ªå¹¶å‘æ‰§è¡Œçš„å®ä½“ï¼ˆæ§åˆ¶æµï¼‰ï¼Œè¿™å°±æ˜¯å¤šçº¿ç¨‹ã€‚ 4.2 çº¿ç¨‹ä¼˜ç‚¹ å¿«é€Ÿçº¿ç¨‹åˆ‡æ¢ é€šä¿¡æ˜“äºå®ç° å‡å°‘ç®¡ç†å¼€é”€ å¹¶å‘ç¨‹åº¦æé«˜ è¿›ç¨‹ä½œä¸ºç³»ç»Ÿèµ„æºåˆ†é…å’Œä¿æŠ¤çš„ç‹¬ç«‹å•ä½ï¼Œä¸éœ€è¦é¢‘ç¹åœ°åˆ‡æ¢ï¼Œè€Œçº¿ç¨‹å…±äº«è¿›ç¨‹ä¸­çš„æ•°æ®ï¼Œåˆ©äºé€šä¿¡ã€‚ 4.3 å¤šçº¿ç¨‹ç¯å¢ƒ4.3.1 çº¿ç¨‹ç»„æˆ çº¿ç¨‹æ§åˆ¶å—ï¼šçº¿ç¨‹å”¯ä¸€æ ‡è¯†ç¬¦åŠçº¿ç¨‹çŠ¶æ€ä¿¡æ¯(è¿è¡Œæ€ã€å°±ç»ªæ€ã€é˜»å¡æ€å’Œç»ˆæ­¢æ€) çº¿ç¨‹æ˜¯ä¸€æ¡æ‰§è¡Œè·¯å¾„ï¼Œæœ‰ç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼›æœªè¿è¡Œæ—¶ä¿æŠ¤çº¿ç¨‹ä¸Šä¸‹æ–‡ çº¿ç¨‹æœ‰æ‰§è¡Œæ ˆå’Œå­˜æ”¾å±€éƒ¨å˜é‡çš„ç§ç”¨å­˜å‚¨ç©ºé—´ å¯è®¿é—®æ‰€å±è¿›ç¨‹çš„å†…å­˜å’Œèµ„æºï¼Œå¹¶ä¸è¯¥è¿›ç¨‹ä¸­çš„å…¶ä»–çº¿ç¨‹å…±äº«è¿™äº›èµ„æº çº¿ç¨‹åˆç§°è½»é‡è¿›ç¨‹ï¼Œçº¿ç¨‹è¿è¡Œåœ¨è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­,å¹¶ä½¿ç”¨è¿›ç¨‹çš„èµ„æºå’Œç¯å¢ƒã€‚ç³»ç»Ÿè°ƒåº¦çš„åŸºæœ¬å•ä½æ˜¯çº¿ç¨‹è€Œä¸æ˜¯è¿›ç¨‹,æ¯å½“åˆ›å»ºä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œè‡³å°‘è¦åŒæ—¶ä¸ºè¯¥è¿›ç¨‹åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ã€‚ 4.3.2 çº¿ç¨‹çŠ¶æ€çº¿ç¨‹çŠ¶æ€æœ‰ï¼šè¿è¡Œã€å°±ç»ªã€ç­‰å¾…å’Œç»ˆæ­¢ï¼ŒçŠ¶æ€è½¬æ¢ä¹Ÿç±»ä¼¼äºè¿›ç¨‹ã€‚ æŒ‚èµ·çŠ¶æ€å¯¹çº¿ç¨‹æ˜¯æ²¡æœ‰æ„ä¹‰ï¼Œå¦‚æœè¿›ç¨‹æŒ‚èµ·åè¢«å¯¹æ¢å‡ºä¸»å­˜ï¼Œåˆ™å®ƒçš„æ‰€æœ‰çº¿ç¨‹å› å…±äº«è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œä¹Ÿå¿…é¡»å…¨éƒ¨å¯¹æ¢å‡ºå»ã€‚ 4.3.3 çº¿ç¨‹ç»„ç»‡è¿›ç¨‹ä¸­çº¿ç¨‹å¤šç§ç»„ç»‡æ–¹å¼ï¼š è°ƒåº¦å‘˜ï¼å·¥ä½œè€…æ¨¡å¼ï¼šä¸€ä¸ªçº¿ç¨‹æ‹…ä»»è°ƒåº¦å‘˜ï¼Œç”¨äºåˆ†é…ä»»åŠ¡å¹¶å”¤é†’å·¥ä½œè€…ï¼Œå…¶ä»–çº¿ç¨‹ä¸ºå·¥ä½œè€…ã€‚ ç»„æ¨¡å¼ï¼šå„ä¸ªçº¿ç¨‹éƒ½å¯ä»¥å–å¾—å¹¶å¤„ç†å·¥ä½œè¯·æ±‚ï¼Œå¯¹ç‰¹å®šä»»åŠ¡å»ºç«‹ç›¸åº”çº¿ç¨‹é˜Ÿåˆ—ï¼ˆæ‰§è¡Œä¸åŒä»»åŠ¡ï¼‰ æµæ°´çº¿æ¨¡å¼ï¼šçº¿ç¨‹æ’æˆæŸä¸ªæ¬¡åºï¼Œå‰ä¸€ä¸ªçº¿ç¨‹äº§ç”Ÿçš„æ•°æ®äº¤ç»™ä¸‹ä¸€ä¸ªçº¿ç¨‹å¤„ç† 4.4 çº¿ç¨‹çš„å®ç°æœ¬èŠ‚å‚è€ƒï¼šæ“ä½œç³»ç»Ÿå­¦ä¹ è®°å½•ä¹‹äº”ï¼šå¤šçº¿ç¨‹å®ç°çš„æ··åˆç­–ç•¥_å°å°æŸ´çš„åšå®¢-CSDNåšå®¢ ä»å®ç°è§’åº¦çœ‹ï¼Œçº¿ç¨‹åˆ†æˆ: ç”¨æˆ·çº§çº¿ç¨‹ULT(å¦‚Java ,Informix)ã€‚ å†…æ ¸çº§çº¿ç¨‹KLT(å¦‚OS/2)ã€‚ æ··åˆå¼çº¿ç¨‹(å¦‚Solaris)ã€‚ å†…æ ¸çº§çº¿ç¨‹æ˜¯å†…æ ¸æ”¯æŒçš„çº¿ç¨‹ï¼Œçº¿ç¨‹ç®¡ç†å·¥ä½œç”±å†…æ ¸å®Œæˆã€‚ä¼˜ç‚¹æ˜¯çº¿ç¨‹åˆ‡æ¢é€Ÿåº¦å¿«ã€æ‰§è¡Œæ•ˆç‡é«˜ã€‚ç¼ºç‚¹æ˜¯ç”¨æˆ·æ€è¿è¡Œã€å†…æ ¸æ€ç®¡ç†å¯¼è‡´ç³»ç»Ÿå¼€é”€å¤§ã€‚ ç”¨æˆ·çº§çº¿ç¨‹æ˜¯ç”±åº”ç”¨ç¨‹åºæ‰€æ”¯æŒçš„çº¿ç¨‹å®ç°, å†…æ ¸æ„è¯†ä¸åˆ°ç”¨æˆ·çº§çº¿ç¨‹çš„å®ç°ã€‚çº¿ç¨‹ç®¡ç†ç”±åº”ç”¨ç¨‹åºå®Œæˆã€‚ä¼˜ç‚¹ï¼š èŠ‚çœç³»ç»Ÿæ¨¡å¼è½¬æ¢å¼€é”€å’Œå†…æ ¸çš„å®è´µèµ„æº å…è®¸è¿›ç¨‹æŒ‰ç…§åº”ç”¨çš„ç‰¹å®šéœ€è¦é€‰æ‹©è°ƒåº¦ç®—æ³• èƒ½å¤Ÿè¿è¡Œåœ¨ä»»ä½•æ“ä½œç³»ç»Ÿä¸Š å†…æ ¸æ— é¡»åšä»»ä½•æ”¹å˜ ç¼ºç‚¹ï¼š çº¿ç¨‹çš„é˜»å¡å°†å¼•èµ·æ•´ä¸ªè¿›ç¨‹çš„é˜»å¡ ä¸å¯èƒ½å¾—ç›Šäºå¤šçº¿ç¨‹çš„å¹¶å‘æ‰§è¡Œ æ··åˆå¼çº¿ç¨‹ï¼šçº¿ç¨‹åˆ›å»ºå®Œå…¨åœ¨ç”¨æˆ·ç©ºé—´ä¸­å®Œæˆï¼Œçº¿ç¨‹çš„è°ƒåº¦å’ŒåŒæ­¥ä¹Ÿåœ¨åº”ç”¨ç¨‹åºä¸­è¿›è¡Œã€‚ä¸€ä¸ªåº”ç”¨ä¸­çš„å¤šä¸ªç”¨æˆ·çº§çº¿ç¨‹è¢«æ˜ å°„åˆ°ä¸€äº›(å°äºç­‰äºç”¨æˆ·çº§çº¿ç¨‹æ•°ç›®)å†…æ ¸çº§çº¿ç¨‹ä¸Šã€‚è¯¥æ–¹æ³•å°†ä¼šç»“åˆçº¯ç²¹ç”¨æˆ·çº§çº¿ç¨‹æ–¹æ³•å’Œå†…æ ¸çº§çº¿ç¨‹æ–¹æ³•çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶å‡å°‘å®ƒä»¬çš„ç¼ºç‚¹ã€‚ 5 å¤„ç†å™¨è°ƒåº¦ 5.1 è°ƒåº¦å±‚æ¬¡ä½œä¸šä»è¿›å…¥ç³»ç»Ÿæˆä¸ºåå¤‡ä½œä¸šå¼€å§‹ï¼Œç›´åˆ°è¿è¡Œç»“æŸé€€å‡ºç³»ç»Ÿä¸ºæ­¢ï¼Œéœ€ç»å†ä¸åŒçº§åˆ«çš„è°ƒåº¦ï¼š é«˜çº§è°ƒåº¦ï¼Œåˆç§°ä½œä¸šè°ƒåº¦ã€é•¿ç¨‹è°ƒåº¦ã€‚ä»»åŠ¡æ˜¯é€‰æ‹©ä½œä¸šè¿›å…¥å†…å­˜ï¼Œæ§åˆ¶å¤šé“ç¨‹åºçš„é“æ•°ã€‚ ä¸­çº§è°ƒåº¦ï¼Œåˆç§°å¹³è¡¡è°ƒåº¦ã€ä¸­ç¨‹è°ƒåº¦ã€‚ä»»åŠ¡æ˜¯å®Œæˆå¤–å­˜å’Œå†…å­˜ä¸­çš„è¿›ç¨‹å¯¹æ¢å·¥ä½œã€è½¬æ¢å°±ç»ªæ€å’Œç­‰å¾…æ€,æé«˜å†…å­˜åˆ©ç”¨ç‡å’Œç³»ç»Ÿååç‡ã€‚ ä½çº§è°ƒåº¦ï¼Œåˆç§°è¿›ç¨‹è°ƒåº¦/çº¿ç¨‹è°ƒåº¦ã€çŸ­ç¨‹è°ƒåº¦ã€‚ä»»åŠ¡æ˜¯å†³å®šå°±ç»ªé˜Ÿåˆ—ä¸­çš„æŸä¸ªè¿›ç¨‹/çº¿ç¨‹è·å¾—å¤„ç†å™¨ã€‚ 5.2 é€‰æ‹©è°ƒåº¦ç®—æ³•åŸåˆ™åŸåˆ™å°±æ˜¯æ€§èƒ½æŒ‡æ ‡ï¼ŒåŒ…å«ï¼š èµ„æºåˆ©ç”¨ç‡ï¼šCPUåˆ©ç”¨ç‡=CPUæœ‰æ•ˆå·¥ä½œæ—¶é—´/CPUæ€»çš„è¿è¡Œæ—¶é—´ã€‚CPUæ€»çš„è¿è¡Œæ—¶é—´=CPUæœ‰æ•ˆå·¥ä½œæ—¶é—´+CPUç©ºé—²ç­‰å¾…æ—¶é—´ã€‚ ååç‡ï¼šå•ä½æ—¶é—´å†…CPUå¤„ç†ä½œä¸šçš„ä¸ªæ•°ã€‚ å…¬å¹³æ€§ï¼šç¡®ä¿æ¯ä¸ªè¿›ç¨‹éƒ½èƒ½è·å¾—åˆç†çš„èµ„æºä»½é¢ï¼Œä¸ä¼šå‡ºç°é¥¥é¥¿ç°è±¡ã€‚ å“åº”æ—¶é—´ï¼šäº¤äº’å¼è¿›ç¨‹ä»æäº¤ä¸€ä¸ªè¯·æ±‚(å‘½ä»¤)åˆ°æ¥æ”¶åˆ°å“åº”ä¹‹é—´çš„æ—¶é—´é—´éš”ç§°å“åº”æ—¶é—´ã€‚ å‘¨è½¬æ—¶é—´ï¼šä»æäº¤ä½œä¸šå¼€å§‹åˆ°ä½œä¸šå®Œæˆçš„æ—¶é—´ã€‚ 5.3 ä½œä¸šçš„ç®¡ç†ä¸è°ƒåº¦5.3.1 ä½œä¸šå’Œè¿›ç¨‹çš„å…³ç³»ä½œä¸šæ˜¯ä»»åŠ¡å®ä½“ï¼Œè¿›ç¨‹æ˜¯å®Œæˆä»»åŠ¡çš„æ‰§è¡Œå®ä½“;æ²¡æœ‰ä½œä¸šä»»åŠ¡ï¼Œè¿›ç¨‹æ— äº‹å¯å¹²ï¼Œæ²¡æœ‰è¿›ç¨‹ï¼Œä½œä¸šä»»åŠ¡æ²¡æ³•å®Œæˆã€‚ ä½œä¸šæ¦‚å¿µæ›´å¤šåœ°ç”¨åœ¨æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿï¼Œè€Œè¿›ç¨‹åˆ™å¯ä»¥ç”¨åœ¨å„ç§å¤šé“ç¨‹åºè®¾è®¡ç³»ç»Ÿã€‚ 5.3.2 ä½œä¸šæ§åˆ¶å—å¤šé“æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿå…·æœ‰ç‹¬ç«‹çš„ä½œä¸šç®¡ç†æ¨¡å—ï¼Œå¿…é¡»åƒè¿›ç¨‹ç®¡ç†ä¸€æ ·ä¸ºæ¯ä¸€ä¸ªä½œä¸šå»ºç«‹ä½œä¸šæ§åˆ¶å—ï¼ˆJCBï¼‰ã€‚ JCBé€šå¸¸æ˜¯åœ¨æ‰¹ä½œä¸šè¿›å…¥ç³»ç»Ÿæ—¶ï¼Œç”±Spoolingç³»ç»Ÿå»ºç«‹çš„ï¼Œå®ƒæ˜¯ä½œä¸šå­˜åœ¨äºç³»ç»Ÿçš„æ ‡å¿—ï¼Œä½œä¸šæ’¤ç¦»æ—¶ï¼ŒJCBä¹Ÿè¢«æ’¤é”€ã€‚ JCBçš„ä¸»è¦å†…å®¹åŒ…æ‹¬ï¼š ä½œä¸šæƒ…å†µ èµ„æºéœ€æ±‚ èµ„æºä½¿ç”¨æƒ…å†µ 5.3.3 æ‰¹å¤„ç†ä½œä¸šçš„è°ƒåº¦ é€‰æ‹©ä½œä¸šï¼šæŒ‰ç…§è°ƒåº¦ç®—æ³•é€‰æ‹© åˆ†é…èµ„æº åˆ›å»ºè¿›ç¨‹ï¼šè¢«è°ƒåº¦æ—¶ï¼Œç³»ç»Ÿä¸ºä½œä¸šåˆ›å»ºè¿›ç¨‹ï¼Œå¹¶ç”ŸæˆPCBåŠå„ç§è¿›ç¨‹å®ä½“ ä½œä¸šæ§åˆ¶ï¼šæŒ‰è¯´æ˜ä¹¦è¿è¡Œ åç»­å¤„ç†ï¼šè°ƒåº¦ç¨‹åºåšå¥½ä½œä¸šæ’¤ç¦»å’Œå–„åå·¥ä½œ 5.3.4 ä½çº§è°ƒåº¦åŠŸèƒ½å’Œç±»å‹è°ƒåº¦ç¨‹åºä¸¤é¡¹ä»»åŠ¡ï¼š è°ƒåº¦å’Œåˆ†æ´¾ã€‚è°ƒåº¦å†³å®šå°±ç»ªæ€çº¿ç¨‹ç«äº‰ä½¿ç”¨å¤„ç†å™¨çš„æ¬¡åºï¼Œåˆ†æ´¾å†³å®šå¦‚ä½•æ—¶åˆ†å¤ç”¨CPUï¼Œå¤„ç†ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ ä½çº§è°ƒåº¦çš„åŸºæœ¬ç±»å‹ï¼šç¬¬ä¸€ç±»ç§°å‰¥å¤ºå¼ï¼Œæœ‰ä¸¤ç§å¤„ç†å™¨å‰¥å¤ºåŸåˆ™ï¼Œå…¶ä¸€æ˜¯é«˜ä¼˜å…ˆçº§è¿›ç¨‹/çº¿ç¨‹å¯å‰¥å¤ºä½ä¼˜å…ˆçº§è¿›ç¨‹/çº¿ç¨‹ï¼Œå¦ä¸€ç§æ˜¯å½“è¿è¡Œè¿›ç¨‹/çº¿ç¨‹æ—¶é—´ç‰‡ç”¨å®Œåè¢«å‰¥å¤ºã€‚ç¬¬äºŒç±»ç§°éå‰¥å¤ºå¼ï¼Œè¿›ç¨‹/çº¿ç¨‹å¼€å§‹è¿è¡Œåä¸å†è®©å‡ºå¤„ç†å™¨ ä½œä¸šè°ƒåº¦å’Œä½çº§è°ƒåº¦ç®—æ³•ï¼š å…ˆæ¥å…ˆæœåŠ¡ç®—æ³•FCFS å…ˆæ¥å…ˆæœåŠ¡æ˜¯æŒ‰ç…§ä½œä¸šè¿›å…¥ç³»ç»Ÿåå¤‡é˜Ÿåˆ—çš„å…ˆåæ¬¡åºæ¥æŒ‘é€‰ä½œä¸šï¼Œå…ˆè¿›å…¥ç³»ç»Ÿçš„ä½œä¸šä¼˜å…ˆè¢«æŒ‘é€‰è¿›å…¥å†…å­˜ã€‚ å®ƒæ˜¯éå‰¥å¤ºå¼ç®—æ³•ï¼Œä¸åˆ©äºçŸ­ä½œä¸šï¼ˆçŸ­ä½œä¸šçš„å¹³å‡å‘¨è½¬æ—¶é—´ä¼šè¾ƒé•¿ï¼Œå› ä¸ºéœ€è¦ç­‰å¾…å‰é¢çš„ä½œä¸šå®Œæˆï¼‰ æœ€çŸ­ä½œä¸šä¼˜å…ˆç®—æ³•SJF SJFç®—æ³•ä»¥è¿›å…¥ç³»ç»Ÿçš„ä½œä¸šæ‰€è¦æ±‚çš„CPUæ—¶é—´ä¸ºæ ‡å‡†ï¼Œæ€»é€‰å–ä¼°è®¡è®¡ç®—æ—¶é—´æœ€çŸ­çš„ä½œä¸šæŠ•å…¥è¿è¡Œã€‚ï¼ˆä½†æ˜¯ç”±äºè¿™ä¸ªæ—¶é—´åªæ˜¯ä¼°ç®—çš„ï¼Œå¹¶ä¸èƒ½ä¿è¯å®é™…ä¸Šä¸€å®šæ˜¯æœ€çŸ­ä½œä¸šï¼‰ã€‚å®ƒä¹Ÿæ˜¯éå‰¥å¤ºå¼ç®—æ³•ï¼Œç¼ºç‚¹æ˜¯é•¿ä½œä¸šå¯èƒ½å‡ºç°é¥¥é¥¿ç°è±¡ï¼ˆä¸€ç›´å¾—ä¸åˆ°è°ƒåº¦ï¼‰ï¼Œç¼ºå°‘å‰¥å¤ºæœºåˆ¶ï¼Œå¯¹åˆ†æ—¶å®æ—¶å¤„ç†ä¸ç†æƒ³ã€‚ æœ€é«˜å“åº”æ¯”ä¼˜å…ˆç®—æ³•HRRF FCFSåªè€ƒè™‘ç­‰å¾…æ—¶é—´è€Œå¿½è§†äº†ä½œä¸šçš„è®¡ç®—æ—¶é—´ï¼ŒSJFåªè€ƒè™‘ç”¨æˆ·ä¼°è®¡çš„ä½œä¸šè®¡ç®—æ—¶é—´è€Œå¿½è§†äº†ä½œä¸šç­‰å¾…æ—¶é—´ï¼Œå› è€Œæ¯”è¾ƒç‰‡é¢ã€‚HRRFæ˜¯ä»‹äºFCFSä¸SJFä¹‹é—´çš„æŠ˜ä¸­ç®—æ³•ï¼Œæ—¢è€ƒè™‘ä½œä¸šç­‰å¾…æ—¶é—´ï¼Œåˆè€ƒè™‘ä½œä¸šçš„è¿è¡Œæ—¶é—´ï¼Œæ—¢ç…§é¡¾çŸ­ä½œä¸šåˆä¸ä½¿é•¿ä½œä¸šçš„ç­‰å¾…æ—¶é—´è¿‡é•¿ï¼Œæ”¹è¿›äº†è°ƒåº¦æ€§èƒ½ã€‚ å“åº”æ¯” = å‘¨è½¬æ—¶é—´/å¤„ç†æ—¶é—´ = 1+å·²ç­‰å¾…æ—¶é—´/ä¼°è®¡è¿è¡Œæ—¶é—´ å› è€Œè¿™ç§ç®—æ³•ä¼šæ ¹æ®ä½œä¸šå·²ç­‰å¾…çš„æ—¶é—´å’Œä¼°è®¡è¿è¡Œæ—¶é—´åŠ¨æ€è°ƒæ•´è°ƒåº¦çš„ä¼˜å…ˆçº§ï¼ŒçŸ­ä½œä¸šå®¹æ˜“å¾—åˆ°è¾ƒé«˜å“åº”æ¯”ï¼Œé•¿ä½œä¸šç­‰å¾…æ—¶é—´è¶³å¤Ÿé•¿åï¼Œä¹Ÿå°†è·å¾—è¶³å¤Ÿé«˜çš„å“åº”æ¯”ï¼Œé¥¥é¥¿ç°è±¡ä¸ä¼šå‘ç”Ÿã€‚ ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³• æ°¸è¿œå…ˆé€‰å–ä¼˜å…ˆçº§é«˜çš„ï¼Œè¿™ä¸ªä¼˜å…ˆçº§å¯èƒ½æ˜¯ç”¨æˆ·æŒ‡å®šçš„ï¼Œä¹Ÿå¯èƒ½æ˜¯ç³»ç»Ÿæ ¹æ®ä½œä¸šçš„é‡è¦æ€§ç­‰ä¿¡æ¯è°ƒæ•´çš„ã€‚ æœ€çŸ­å‰©ä½™æ—¶é—´ä¼˜å…ˆç®—æ³•SRTF è¿™æ˜¯ä¸€ç§å‰¥å¤ºå¼ç®—æ³•ï¼Œå½“ä¸€ä¸ªæ–°ä½œä¸šè¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œå¦‚æœæ–°ä½œä¸šéœ€è¦çš„CPUæ—¶é—´æ¯”å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä½œä¸šå‰©ä½™ä¸‹æ¥è¿˜éœ€çš„CPUæ—¶é—´çŸ­ï¼ŒSRTFå¼ºè¡Œèµ¶èµ°å½“å‰æ­£åœ¨æ‰§è¡Œä½œä¸šã€‚ è½®è½¬è°ƒåº¦ç®—æ³•RR è½®æµä½¿ç”¨æ—¶é—´ç‰‡ï¼Œå‰¥å¤ºå¼è°ƒåº¦ã€‚åˆé€‚é€‰å–æ—¶é—´ç‰‡çš„é•¿åº¦å¾ˆé‡è¦ï¼Œå¦‚æœæ—¶é—´ç‰‡å¤ªé•¿äº†å°±ä¼šå˜æˆFCFSï¼Œå¦‚æœå¤ªçŸ­äº†å°±ä¼šä½¿ç³»ç»Ÿè°ƒåº¦å¼€é”€å¾ˆå¤§ã€‚ å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•MLFQ åˆç§°åé¦ˆå¾ªç¯é˜Ÿåˆ—æˆ–å¤šé˜Ÿåˆ—ç­–ç•¥ã€‚ä¸»è¦æ€æƒ³æ˜¯å°†å°±ç»ªè¿›ç¨‹åˆ†ä¸ºä¸¤çº§æˆ–å¤šçº§ï¼Œç³»ç»Ÿç›¸åº”å»ºç«‹ä¸¤ä¸ªæˆ–å¤šä¸ªå°±ç»ªè¿›ç¨‹é˜Ÿåˆ—ï¼Œè¾ƒé«˜ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ä¸€èˆ¬åˆ†é…ç»™è¾ƒçŸ­çš„æ—¶é—´ç‰‡ã€‚ å¤„ç†å™¨è°ƒåº¦å…ˆä»é«˜çº§å°±ç»ªè¿›ç¨‹é˜Ÿåˆ—ä¸­é€‰å–å¯å æœ‰å¤„ç†å™¨çš„è¿›ç¨‹ï¼Œåªæœ‰åœ¨é€‰ä¸åˆ°æ—¶ï¼Œæ‰ä»è¾ƒä½çº§çš„å°±ç»ªè¿›ç¨‹é˜Ÿåˆ—ä¸­é€‰å–ã€‚","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://www.codetool.top/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"}]},{"title":"leetcode56-åˆå¹¶åŒºé—´","slug":"leetcode56-åˆå¹¶åŒºé—´","date":"2020-04-16T06:29:48.000Z","updated":"2020-04-16T06:34:17.942Z","comments":true,"path":"article/leetcode56-åˆå¹¶åŒºé—´/","link":"","permalink":"https://www.codetool.top/article/leetcode56-%E5%90%88%E5%B9%B6%E5%8C%BA%E9%97%B4/","excerpt":"","text":"1 åŸé¢˜ç»™å‡ºä¸€ä¸ªåŒºé—´çš„é›†åˆï¼Œè¯·åˆå¹¶æ‰€æœ‰é‡å çš„åŒºé—´ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: [[1,3],[2,6],[8,10],[15,18]]è¾“å‡º: [[1,6],[8,10],[15,18]]è§£é‡Š: åŒºé—´ [1,3] å’Œ [2,6] é‡å , å°†å®ƒä»¬åˆå¹¶ä¸º [1,6]. ç¤ºä¾‹ 2: è¾“å…¥: [[1,4],[4,5]]è¾“å‡º: [[1,5]]è§£é‡Š: åŒºé—´ [1,4] å’Œ [4,5] å¯è¢«è§†ä¸ºé‡å åŒºé—´ã€‚ 2 è§£æ³•2.1 æ€æƒ³è¿™é“é¢˜å’Œleetcode435-æ— é‡å åŒºé—´æ–¹æ³•æœ‰ä¸€ç‚¹ç±»ä¼¼ï¼Œå…ˆæ’åºï¼Œå†å¤„ç†åŒºé—´ã€‚ 2.2 ä»£ç class Solution { public int[][] merge(int[][] intervals) { if(intervals.length&lt;2) return intervals; Arrays.sort(intervals, (array1,array2)->{ return array1[0]-array2[0]; }); int lastIndex = 0; int cur = 1; List&lt;int[]> list = new ArrayList&lt;>(); while(cur &lt; intervals.length){ //å¦‚æœä¸¤ä¸ªåŒºé—´æ²¡æœ‰é‡å éƒ¨åˆ†ï¼Œéƒ½ä¿ç•™ if(intervals[lastIndex][1]&lt;intervals[cur][0]){ list.add(intervals[lastIndex]); lastIndex = cur; cur++; //å¦‚æœä¸¤ä¸ªåŒºé—´é‡å ï¼Œåˆå¹¶ä¸¤ä¸ªåŒºé—´ }else{ intervals[lastIndex][1] = Math.max(intervals[lastIndex][1],intervals[cur][1]); cur++; } } list.add(intervals[lastIndex]); int[][] ans = new int[list.size()][2]; for(int i = 0;i&lt;list.size();i++){ ans[i] = list.get(i); } return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode191-ä½1çš„ä¸ªæ•°","slug":"leetcode191-ä½1çš„ä¸ªæ•°","date":"2020-04-15T06:23:54.000Z","updated":"2020-04-15T06:59:12.213Z","comments":true,"path":"article/leetcode191-ä½1çš„ä¸ªæ•°/","link":"","permalink":"https://www.codetool.top/article/leetcode191-%E4%BD%8D1%E7%9A%84%E4%B8%AA%E6%95%B0/","excerpt":"","text":"1 åŸé¢˜ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥æ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ï¼Œè¿”å›å…¶äºŒè¿›åˆ¶è¡¨è¾¾å¼ä¸­æ•°å­—ä½æ•°ä¸º â€˜1â€™ çš„ä¸ªæ•°ï¼ˆä¹Ÿè¢«ç§°ä¸ºæ±‰æ˜é‡é‡ï¼‰ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥ï¼š 00000000000000000000000000001011è¾“å‡ºï¼š 3è§£é‡Šï¼š è¾“å…¥çš„äºŒè¿›åˆ¶ä¸² 00000000000000000000000000001011 ä¸­ï¼Œå…±æœ‰ä¸‰ä½ä¸º â€˜1â€™ã€‚ ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼š 00000000000000000000000010000000è¾“å‡ºï¼š 1è§£é‡Šï¼š è¾“å…¥çš„äºŒè¿›åˆ¶ä¸² 00000000000000000000000010000000 ä¸­ï¼Œå…±æœ‰ä¸€ä½ä¸º â€˜1â€™ã€‚ ç¤ºä¾‹ 3ï¼š è¾“å…¥ï¼š 00000000000000000000000000001011è¾“å‡ºï¼š 31è§£é‡Šï¼š è¾“å…¥çš„äºŒè¿›åˆ¶ä¸² 11111111111111111111111111111101 ä¸­ï¼Œå…±æœ‰ 31 ä½ä¸º â€˜1â€™ã€‚ æç¤ºï¼š è¯·æ³¨æ„ï¼Œåœ¨æŸäº›è¯­è¨€ï¼ˆå¦‚ Javaï¼‰ä¸­ï¼Œæ²¡æœ‰æ— ç¬¦å·æ•´æ•°ç±»å‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¾“å…¥å’Œè¾“å‡ºéƒ½å°†è¢«æŒ‡å®šä¸ºæœ‰ç¬¦å·æ•´æ•°ç±»å‹ï¼Œå¹¶ä¸”ä¸åº”å½±å“æ‚¨çš„å®ç°ï¼Œå› ä¸ºæ— è®ºæ•´æ•°æ˜¯æœ‰ç¬¦å·çš„è¿˜æ˜¯æ— ç¬¦å·çš„ï¼Œå…¶å†…éƒ¨çš„äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼éƒ½æ˜¯ç›¸åŒçš„ã€‚ åœ¨ Java ä¸­ï¼Œç¼–è¯‘å™¨ä½¿ç”¨äºŒè¿›åˆ¶è¡¥ç è®°æ³•æ¥è¡¨ç¤ºæœ‰ç¬¦å·æ•´æ•°ã€‚å› æ­¤ï¼Œåœ¨ä¸Šé¢çš„ ç¤ºä¾‹ 3 ä¸­ï¼Œè¾“å…¥è¡¨ç¤ºæœ‰ç¬¦å·æ•´æ•° -3ã€‚ è¿›é˜¶:å¦‚æœå¤šæ¬¡è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œä½ å°†å¦‚ä½•ä¼˜åŒ–ä½ çš„ç®—æ³•ï¼Ÿ 2 è§£æ³•2.1 æ€æƒ³å¯ä»¥ç”¨ä½è¿ç®— 2.2 ä»£ç å†·é…·æ— æƒ…çš„APIé€‰æ‰‹åšæ³•ï¼š public class Solution { public int hammingWeight(int n) { char[] chars = Integer.toBinaryString(n).toCharArray(); int sum = 0; for (char num :chars){ if(num == '1') sum ++; } return sum; } } æŒ‰ä½ä¸ç®—æ³•ï¼š public int hammingWeight(int n) { int num = 0; int mask = 1; for (int i = 0; i &lt; 32; i++) { if ((n &amp; mask) != 0) { num++; } mask &lt;&lt;= 1; } return num; }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"HTTPæµè§ˆå™¨ç¼“å­˜ç­–ç•¥å’Œç›¸å…³é¦–éƒ¨å­—æ®µ","slug":"HTTPæµè§ˆå™¨ç¼“å­˜ç­–ç•¥å’ŒæœåŠ¡å™¨çš„ç¼“å­˜æ§åˆ¶","date":"2020-04-14T16:11:19.000Z","updated":"2020-04-14T17:58:07.305Z","comments":true,"path":"article/HTTPæµè§ˆå™¨ç¼“å­˜ç­–ç•¥å’ŒæœåŠ¡å™¨çš„ç¼“å­˜æ§åˆ¶/","link":"","permalink":"https://www.codetool.top/article/HTTP%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5%E5%92%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E7%BC%93%E5%AD%98%E6%8E%A7%E5%88%B6/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š HTTPå¼ºç¼“å­˜å’Œåå•†ç¼“å­˜ - JavaScriptå­¦ä¹ ç¬”è®° - SegmentFault æ€å¦ ï¼ˆä¸ƒï¼‰æ¡ä»¶è¯·æ±‚If-Matchã€If-Modified-Sinceã€If-None-Matchã€If-Rangeã€If-Unmodified-Since_Python_FixedStar çš„åšå®¢-CSDNåšå®¢ å¼ºåˆ¶ç¼“å­˜ï¼ˆ200ï¼‰å’Œåå•†ç¼“å­˜ï¼ˆ304ï¼‰æ•´ç†_ç½‘ç»œ_zlongçš„åšå®¢-CSDNåšå®¢ åœ¨ä¸€æ¬¡HTTPé€šä¿¡ä¸­ï¼Œæœ€æ¥è¿‘ç”¨æˆ·çš„ç¼“å­˜åº”è¯¥å°±æ˜¯æµè§ˆå™¨çš„ç¼“å­˜äº†ï¼Œè€Œæµè§ˆå™¨åˆ°åº•ä»€ä¹ˆæ—¶å€™èµ°ç¼“å­˜ï¼Œä»€ä¹ˆæ—¶å€™è¯·æ±‚æœåŠ¡å™¨å‘¢ï¼Ÿå’ŒæœåŠ¡å™¨æœ‰å…³å—ï¼Ÿè¿™ç¯‡æ–‡ç« é‡Œï¼Œå°±æ¥è°ˆä¸€è°ˆæµè§ˆå™¨çš„ç¼“å­˜ç­–ç•¥ã€‚ 1 æµè§ˆå™¨ç¼“å­˜æ¦‚è¿°æµè§ˆå™¨ç¼“å­˜æ˜¯æŒ‡æµè§ˆå™¨åœ¨æœ¬åœ°ç£ç›˜å¯¹ç”¨æˆ·æœ€è¿‘è¯·æ±‚è¿‡çš„æ–‡æ¡£è¿›è¡Œå­˜å‚¨ï¼Œå½“è®¿é—®è€…å†æ¬¡è®¿é—®åŒä¸€é¡µé¢æ—¶ï¼Œæµè§ˆå™¨å°±å¯ä»¥ç›´æ¥ä»æœ¬åœ°ç£ç›˜åŠ è½½æ–‡æ¡£ã€‚ æµè§ˆå™¨ç¼“å­˜æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š å‡å°‘å†—ä½™æ•°æ®ä¼ è¾“ å‡å°‘æœåŠ¡å™¨è´Ÿæ‹… åŠ è½½å®¢æˆ·ç«¯åŠ è½½ç½‘é¡µçš„é€Ÿåº¦ 2 æµè§ˆå™¨è¯·æ±‚èµ„æºæµç¨‹å›¾ è¿™å¼ å›¾é‡Œæ¶‰åŠåˆ°ä¸¤ä¸ªæ¦‚å¿µï¼šå¼ºç¼“å­˜å’Œåå•†ç¼“å­˜ï¼Œæµè§ˆå™¨HTTPç¼“å­˜å¯ä»¥åˆ†ä¸ºå¼ºç¼“å­˜å’Œåå•†ç¼“å­˜ã€‚å¼ºç¼“å­˜å’Œåå•†ç¼“å­˜æœ€å¤§ä¹Ÿæ˜¯æœ€æ ¹æœ¬çš„åŒºåˆ«æ˜¯ï¼šå¼ºç¼“å­˜å‘½ä¸­çš„è¯ä¸ä¼šå‘è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ˆæ¯”å¦‚ chrome ä¸­çš„ 200 from memory cacheï¼‰ï¼Œåå•†ç¼“å­˜ä¸€å®šä¼šå‘è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œé€šè¿‡èµ„æºçš„è¯·æ±‚é¦–éƒ¨å­—æ®µéªŒè¯èµ„æºæ˜¯å¦å‘½ä¸­åå•†ç¼“å­˜ï¼Œå¦‚æœåå•†ç¼“å­˜å‘½ä¸­ï¼ŒæœåŠ¡å™¨ä¼šå°†è¿™ä¸ªè¯·æ±‚è¿”å›ï¼Œä½†æ˜¯ä¸ä¼šè¿”å›è¿™ä¸ªèµ„æºçš„å®ä½“ï¼Œè€Œæ˜¯é€šçŸ¥å®¢æˆ·ç«¯å¯ä»¥ä»ç¼“å­˜ä¸­åŠ è½½è¿™ä¸ªèµ„æºï¼ˆ304 not modifiedï¼‰ã€‚ 3 å¼ºç¼“å­˜ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨å¼ºç¼“å­˜ï¼Ÿæ‰“å¼€é¡µé¢è¯·æ±‚èµ„æºï¼ˆæˆ–å‰è¿›ã€åé€€ã€é‡å®šå‘ï¼‰çš„æ—¶å€™ä¼šå…ˆè·å–è¯¥èµ„æºç¼“å­˜çš„headerä¿¡æ¯ï¼Œç„¶åæ ¹æ®headerä¸­çš„Cache-Controlå’ŒExpiresæ¥åˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœå‘ç°æœ¬åœ°ç¼“å­˜è¿˜æ²¡è¿‡æœŸï¼Œåˆ™ä½¿ç”¨å¼ºç¼“å­˜ã€‚ å¼ºç¼“å­˜åˆ©ç”¨httpå¤´ä¸­çš„Expireså’ŒCache-Controlä¸¤ä¸ªå­—æ®µæ¥æ§åˆ¶ï¼Œç”¨æ¥è¡¨ç¤ºèµ„æºç¼“å­˜æ—¶é—´ã€‚ä½†åªè¦åˆ·æ–°å°±ä¸ä¼šä½¿ç”¨å¼ºç¼“å­˜ï¼Œæ™®é€šåˆ·æ–°ï¼ˆF5æˆ–ç‚¹å‡»åˆ·æ–°æŒ‰é’®ï¼‰ä¼šå¿½ç•¥å®ƒï¼Œä½†æ˜¯ä¸ä¼šæ¸…é™¤å®ƒï¼Œå¹¶ä¸”è¯·æ±‚ä¼šå¸¦ä¸ŠCache-Control: max-age=0ã€‚å¼ºåˆ¶åˆ·æ–°ï¼ˆCtrl+F5ï¼‰åˆ™ä¼šæ¸…é™¤ç¼“å­˜ã€‚å¹¶ä¸”è¯·æ±‚ä¼šå¸¦ä¸ŠCache-Control:no-cacheï¼Œä»£è¡¨è¯¥è¯·æ±‚ä¸ä¼šä½¿ç”¨ç¼“å­˜ï¼Œä¸”ä¸ä¼šè®°å½•ç¼“å­˜ã€‚ æ§åˆ¶å¼ºç¼“å­˜çš„å­—æ®µï¼ˆé€‰å…¶ä¸€ä½¿ç”¨å³å¯ï¼‰ï¼š 3.1 ExpiresExpiresæ˜¯HTTP/1.0çš„è§„èŒƒï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªç»å¯¹æ—¶é—´çš„GMTæ ¼å¼çš„æ—¶é—´å­—ç¬¦ä¸²ï¼Œä»£è¡¨èµ„æºçš„å¤±æ•ˆæ—¶é—´ï¼Œåªè¦å‘é€çš„è¯·æ±‚åœ¨Expiresä¹‹å‰ï¼Œé‚£ä¹ˆæœ¬åœ°ç¼“å­˜å§‹ç»ˆæœ‰æ•ˆï¼Œåˆ™åœ¨ç¼“å­˜ä¸­è¯»å–æ•°æ®ã€‚æ‰€ä»¥è¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ï¼Œç”±äºå¤±æ•ˆæ—¶é—´æ˜¯ä¸€ä¸ªç»å¯¹æ—¶é—´ï¼Œæ‰€ä»¥å½“æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯æ—¶é—´åå·®è¾ƒå¤§æ—¶ï¼Œå°±ä¼šå¯¼è‡´ç¼“å­˜æ··ä¹±ã€‚å¦‚æœåŒæ—¶å‡ºç°Cache-Control:max-ageå’ŒExpiresï¼Œé‚£ä¹ˆmax-ageçš„ä¼˜å…ˆçº§æ›´é«˜ã€‚ 3.2 Cache-ControlCache-Control æ˜¯ä¸€ä¸ªé€šç”¨é¦–éƒ¨å­—æ®µï¼ˆè¯·æ±‚å¤´å’Œå“åº”å¤´éƒ½å¯ä»¥ç”¨ï¼‰ï¼Œä¹Ÿæ˜¯ HTTP/1.1 æ§åˆ¶æµè§ˆå™¨ç¼“å­˜çš„ä¸»æµå­—æ®µã€‚å’Œæµè§ˆå™¨ç¼“å­˜ç›¸å…³çš„æ˜¯å¦‚ä¸‹å‡ ä¸ªå“åº”æŒ‡ä»¤ï¼š max-ageï¼ˆå•ä½ä¸º sï¼‰ï¼šè®¾ç½®ç¼“å­˜çš„å­˜åœ¨æ—¶é—´ï¼Œç›¸å¯¹äºå‘é€è¯·æ±‚çš„æ—¶é—´ï¼ˆå³å“åº”å¤´ä¸­çš„Dateå­—æ®µï¼‰ã€‚åªæœ‰å“åº”æŠ¥æ–‡é¦–éƒ¨è®¾ç½®Cache-Controlä¸ºé0çš„max-ageæˆ–è€…è®¾ç½®äº†å¤§äºè¯·æ±‚æ—¥æœŸçš„ Expiresæ‰æœ‰å¯èƒ½å‘½ä¸­å¼ºç¼“å­˜ã€‚ no-cache è¡¨ç¤ºè¯·æ±‚å¿…é¡»å…ˆä¸æœåŠ¡å™¨ç¡®è®¤ç¼“å­˜çš„æœ‰æ•ˆæ€§ï¼Œå¦‚æœæœ‰æ•ˆæ‰èƒ½ä½¿ç”¨ç¼“å­˜ï¼ˆåå•†ç¼“å­˜ï¼‰ï¼Œæ— è®ºæ˜¯å“åº”æŠ¥æ–‡é¦–éƒ¨è¿˜æ˜¯è¯·æ±‚æŠ¥æ–‡é¦–éƒ¨å‡ºç°è¿™ä¸ªå­—æ®µå‡ä¸€å®šä¸ä¼šå‘½ä¸­å¼ºç¼“å­˜ã€‚æµè§ˆå™¨å¼ºåˆ¶åˆ·æ–°å°±ä¼šå¸¦ä¸ŠCache-Control:no-cacheã€‚ no-storeï¼šä¸å…è®¸ç¼“å­˜ï¼Œç”¨äºæŸäº›å˜åŒ–éå¸¸é¢‘ç¹çš„æ•°æ®ï¼Œä¾‹å¦‚ç§’æ€é¡µé¢ï¼Œä¸€å®šä¸ä¼šå‡ºç°å¼ºç¼“å­˜å’Œåå•†ç¼“å­˜ã€‚ must-revalidateï¼šå¦‚æœç¼“å­˜ä¸è¿‡æœŸå°±å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œä½†è¿‡æœŸäº†å¦‚æœè¿˜æƒ³ç”¨å°±å¿…é¡»å»æœåŠ¡å™¨éªŒè¯ã€‚è¿™ä¸ªå€¼é€šå¸¸é…åˆmax-ageä½¿ç”¨ã€‚ publicï¼šè¡¨æ˜å“åº”å¯ä»¥è¢«æµè§ˆå™¨ã€CDN ç­‰ç­‰ç¼“å­˜ã€‚ privateï¼šå“åº”åªä½œä¸ºç§æœ‰çš„ç¼“å­˜ï¼Œä¸èƒ½è¢« CDN ç­‰ç¼“å­˜ã€‚å¦‚æœè¦æ±‚ HTTP è®¤è¯ï¼Œå“åº”ä¼šè‡ªåŠ¨è®¾ç½®ä¸º privateã€‚ 4 åå•†ç¼“å­˜åå•†ç¼“å­˜å°±æ˜¯ç”±æœåŠ¡å™¨æ¥ç¡®å®šç¼“å­˜çš„èµ„æºæ˜¯å¦å¯ç”¨ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨è¦é€šè¿‡æŸç§æ ‡è¯†æ¥è¿›è¡Œé€šä¿¡ï¼Œä»è€Œè®©æœåŠ¡å™¨åˆ¤æ–­è¯·æ±‚èµ„æºæ˜¯å¦å¯ä»¥ç¼“å­˜è®¿é—®ã€‚ å½“ç¼“å­˜çš„max-ageè¿‡æœŸæˆ–æµè§ˆå™¨æ™®é€šåˆ·æ–°ï¼Œå°±ä¼šå¯ç”¨åå•†ç¼“å­˜ã€‚æµè§ˆå™¨ä¼šå‘æœåŠ¡å™¨ç«¯å‘é€è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šæºå¸¦ç¬¬ä¸€æ¬¡è¯·æ±‚è¿”å›çš„æœ‰å…³ç¼“å­˜çš„headerå­—æ®µä¿¡æ¯ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯ä¼šé€šè¿‡If-None-Matchå¤´å°†å…ˆå‰æœåŠ¡å™¨ç«¯å‘é€è¿‡æ¥çš„Etagå‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡ä¼šå¯¹æ¯”è¿™ä¸ªå®¢æˆ·ç«¯å‘è¿‡æ¥çš„Etagæ˜¯å¦ä¸æœåŠ¡å™¨çš„ç›¸åŒï¼Œè‹¥ç›¸åŒï¼Œå°±å°†If-None-Matchçš„å€¼è®¾ä¸ºfalseï¼Œè¿”å›çŠ¶æ€304ï¼Œå®¢æˆ·ç«¯ç»§ç»­ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œä¸è§£ææœåŠ¡å™¨ç«¯å‘å›æ¥çš„æ•°æ®ï¼Œè‹¥ä¸ç›¸åŒå°±å°†If-None-Matchçš„å€¼è®¾ä¸ºtrueï¼Œè¿”å›çŠ¶æ€ä¸º200ï¼Œå®¢æˆ·ç«¯é‡æ–°è§£ææœåŠ¡å™¨ç«¯è¿”å›çš„æ•°æ®ï¼›å®¢æˆ·ç«¯è¿˜ä¼šé€šè¿‡If-Modified-Sinceå¤´å°†å…ˆå‰æœåŠ¡å™¨ç«¯å‘è¿‡æ¥çš„æœ€åä¿®æ”¹æ—¶é—´æˆ³ï¼ˆLast-Modifiedï¼‰å‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ç«¯é€šè¿‡è¿™ä¸ªæ—¶é—´æˆ³åˆ¤æ–­å®¢æˆ·ç«¯çš„é¡µé¢æ˜¯å¦æ˜¯æœ€æ–°çš„ï¼Œå¦‚æœä¸æ˜¯æœ€æ–°çš„ï¼Œåˆ™è¿”å›æœ€æ–°çš„å†…å®¹ï¼Œå¦‚æœæ˜¯æœ€æ–°çš„ï¼Œåˆ™è¿”å›304ï¼Œå®¢æˆ·ç«¯ç»§ç»­ä½¿ç”¨æœ¬åœ°ç¼“å­˜ã€‚ æ§åˆ¶åå•†ç¼“å­˜çš„å­—æ®µï¼ˆé€‰å…¶ä¸€ä½¿ç”¨å³å¯ï¼‰ï¼š 4.1 Last-Modified/If-Modified-SinceIf-Modified-Since æ˜¯ä¸€ä¸ªè¯·æ±‚é¦–éƒ¨å­—æ®µï¼Œå¹¶ä¸”åªèƒ½ç”¨åœ¨ GET æˆ–è€… HEAD è¯·æ±‚ä¸­ã€‚Last-Modified æ˜¯ä¸€ä¸ªå“åº”é¦–éƒ¨å­—æ®µï¼ŒåŒ…å«æœåŠ¡å™¨è®¤å®šçš„èµ„æºä½œå‡ºä¿®æ”¹çš„æ—¥æœŸåŠæ—¶é—´ã€‚å½“å¸¦ç€ If-Modified-Since å¤´è®¿é—®æœåŠ¡å™¨è¯·æ±‚èµ„æºæ—¶ï¼ŒæœåŠ¡å™¨ä¼šæ£€æŸ¥ Last-Modifiedï¼Œå¦‚æœ Last-Modified çš„æ—¶é—´æ—©äºæˆ–ç­‰äºIf-Modified-Since åˆ™ä¼šè¿”å›ä¸€ä¸ªä¸å¸¦ä¸»ä½“çš„ 304 å“åº”ï¼Œå¦åˆ™å°†é‡æ–°è¿”å›èµ„æºã€‚ 4.2 ETag/If-None-MatchETag æ˜¯ä¸€ä¸ªå“åº”é¦–éƒ¨å­—æ®µï¼Œå®ƒæ˜¯æ ¹æ®å®ä½“å†…å®¹ç”Ÿæˆçš„ä¸€æ®µ hash å­—ç¬¦ä¸²ï¼Œæ ‡è¯†èµ„æºçš„çŠ¶æ€ï¼Œç”±æœåŠ¡ç«¯äº§ç”Ÿã€‚If-None-Match æ˜¯ä¸€ä¸ªæ¡ä»¶å¼çš„è¯·æ±‚é¦–éƒ¨ã€‚å¦‚æœè¯·æ±‚èµ„æºæ—¶åœ¨è¯·æ±‚é¦–éƒ¨åŠ ä¸Šè¿™ä¸ªå­—æ®µï¼Œå€¼ä¸ºä¹‹å‰æœåŠ¡å™¨ç«¯è¿”å›çš„èµ„æºä¸Šçš„ ETagï¼Œåˆ™å½“ä¸”ä»…å½“æœåŠ¡å™¨ä¸Šæ²¡æœ‰ä»»ä½•èµ„æºçš„ ETag å±æ€§å€¼ä¸è¿™ä¸ªé¦–éƒ¨ä¸­åˆ—å‡ºçš„æ—¶å€™ï¼ŒæœåŠ¡å™¨æ‰ä¼šè¿”å›å¸¦æœ‰æ‰€è¯·æ±‚èµ„æºå®ä½“çš„ 200 å“åº”ï¼Œå¦åˆ™æœåŠ¡å™¨ä¼šè¿”å›ä¸å¸¦å®ä½“çš„ 304 å“åº”ã€‚ ETag ä¼˜å…ˆçº§æ¯” Last-Modified é«˜ï¼ŒåŒæ—¶å­˜åœ¨æ—¶ä¼šä»¥ ETag ä¸ºå‡†ã€‚ ETag è¿˜æœ‰â€œå¼ºâ€â€œå¼±â€ä¹‹åˆ†ï¼šå¼º ETag è¦æ±‚èµ„æºåœ¨å­—èŠ‚çº§åˆ«å¿…é¡»å®Œå…¨ç›¸ç¬¦ï¼Œå¼± ETag åœ¨å€¼å‰æœ‰ä¸ªâ€œW/â€æ ‡è®°ï¼Œåªè¦æ±‚èµ„æºåœ¨è¯­ä¹‰ä¸Šæ²¡æœ‰å˜åŒ–ï¼Œä½†å†…éƒ¨å¯èƒ½ä¼šæœ‰éƒ¨åˆ†å‘ç”Ÿäº†æ”¹å˜ï¼ˆä¾‹å¦‚ HTML é‡Œçš„æ ‡ç­¾é¡ºåºè°ƒæ•´ï¼Œæˆ–è€…å¤šäº†å‡ ä¸ªç©ºæ ¼ï¼‰ã€‚ ä¸‹é¢æ˜¯ä¸€æ¬¡etagå‘½ä¸­ï¼ˆä½ å¯ä»¥æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œå°è¯•åˆ·æ–°æˆ‘çš„åšå®¢ï¼Œè§‚å¯Ÿç»“æœï¼‰ï¼š å› ä¸º ETag çš„ç‰¹æ€§ï¼Œæ‰€ä»¥ç›¸è¾ƒäº Last-Modified æœ‰ä¸€äº›ä¼˜åŠ¿ï¼š æŸäº›æƒ…å†µä¸‹æœåŠ¡å™¨æ— æ³•è·å–èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´ èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´å˜äº†ä½†æ˜¯å†…å®¹æ²¡å˜ï¼Œä½¿ç”¨ ETagå¯ä»¥æ­£ç¡®ç¼“å­˜ å¦‚æœèµ„æºä¿®æ”¹éå¸¸é¢‘ç¹ï¼Œåœ¨ç§’ä»¥ä¸‹çš„æ—¶é—´è¿›è¡Œä¿®æ”¹ï¼ŒLast-Modified åªèƒ½ç²¾ç¡®åˆ°ç§’ åå•†ç¼“å­˜å±äºHTTPæ¡ä»¶è¯·æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œæ¡ä»¶è¯·æ±‚è¿˜æœ‰If-Unmodified-Sinceï¼ŒIf-Matchï¼ŒIf-Rangeç­‰å­—æ®µï¼ˆç”¨äºæ–­ç‚¹ç»­ä¼ ï¼Œå’Œ412çŠ¶æ€ç æœ‰å…³ï¼‰ 5 è¯¦ç»†æ€»ç»“æµç¨‹å›¾ æ³¨æ„ï¼šPragmaå·²è¢«åºŸå¼ƒã€‚ ä¸‹è¡¨æ˜¯ç”¨æˆ·æ“ä½œå¯¹å¼ºç¼“å­˜/åå•†ç¼“å­˜çš„å½±å“ï¼š ç”¨æˆ·æ“ä½œ Expires/Cache-Control Last-Modified/Etag åœ°å€æ å›è½¦ æœ‰æ•ˆ æœ‰æ•ˆ é¡µé¢é“¾æ¥è·³è½¬ æœ‰æ•ˆ æœ‰æ•ˆ æ–°å¼€çª—å£ æœ‰æ•ˆ æœ‰æ•ˆ å‰è¿›åé€€ æœ‰æ•ˆ æœ‰æ•ˆ F5åˆ·æ–° æ— æ•ˆ æœ‰æ•ˆ Ctrl+F5å¼ºåˆ¶åˆ·æ–° æ— æ•ˆ æ— æ•ˆ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘åœ¨chromeä¸­å®éªŒå‘ç°ï¼Œå½“æœåŠ¡å™¨æ²¡æœ‰å“åº”Cache-Controlã€Expireç›¸å…³å­—æ®µçš„æ—¶å€™ï¼Œä¸€å®šæ—¶é—´å†…å†æ¬¡è®¿é—®ç½‘ç«™ä¾ç„¶ä¼šèµ°200(from disk cache)å¼ºç¼“å­˜ï¼Œå¯èƒ½æ˜¯å’Œæµè§ˆå™¨æœ¬èº«çš„ç­–ç•¥æœ‰å…³ï¼Œæˆ–æ˜¯Cache-Controlæœ‰é»˜è®¤å€¼ï¼Ÿæˆ‘åœ¨ç½‘ç»œä¸Šæ²¡æœ‰æŸ¥è¯¢åˆ°èµ„æ–™æ˜ç¡®æŒ‡å‡ºCache-Controlæ˜¯å¦æœ‰é»˜è®¤å€¼ï¼Œæˆ–è€…max-ageçš„é»˜è®¤å€¼ä¸ºå¤šå°‘ã€‚","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","permalink":"https://www.codetool.top/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"},{"name":"HTTP","slug":"HTTP","permalink":"https://www.codetool.top/tags/HTTP/"}]},{"title":"è®¡ç½‘å¤ä¹ 07-åº”ç”¨å±‚ä¹‹HTTPæŠ¥æ–‡æ ¼å¼","slug":"è®¡ç½‘å¤ä¹ 07-åº”ç”¨å±‚ä¹‹HTTPæŠ¥æ–‡æ ¼å¼","date":"2020-04-14T14:18:50.000Z","updated":"2020-04-14T15:49:30.715Z","comments":true,"path":"article/è®¡ç½‘å¤ä¹ 07-åº”ç”¨å±‚ä¹‹HTTPæŠ¥æ–‡æ ¼å¼/","link":"","permalink":"https://www.codetool.top/article/%E8%AE%A1%E7%BD%91%E5%A4%8D%E4%B9%A007-%E5%BA%94%E7%94%A8%E5%B1%82%E4%B9%8BHTTP%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F/","excerpt":"","text":"1 HTTPæŠ¥æ–‡æ¦‚è¿°HTTPæ¦‚è¿°åœ¨HTTPç‰ˆæœ¬å‘å±•ä¸Googleçš„æš—ä¸­åŠ©åŠ› ä¸­å·²ç»è¯´å¾—å·®ä¸å¤šäº†ï¼Œè¿™ç¯‡æ–‡ç« æ¥ä¸“é—¨è®²ä¸€ä¸‹HTTPçš„æŠ¥æ–‡æ ¼å¼ HTTP åè®®çš„è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡çš„ç»“æ„åŸºæœ¬ç›¸åŒï¼Œç”±ä¸‰å¤§éƒ¨åˆ†ç»„æˆï¼š èµ·å§‹è¡Œï¼ˆstart lineï¼‰ï¼šæè¿°è¯·æ±‚æˆ–å“åº”çš„åŸºæœ¬ä¿¡æ¯ï¼› å¤´éƒ¨å­—æ®µé›†åˆï¼ˆheaderï¼‰ï¼šä½¿ç”¨ key-value å½¢å¼æ›´è¯¦ç»†åœ°è¯´æ˜æŠ¥æ–‡ï¼› æ¶ˆæ¯æ­£æ–‡ï¼ˆentityï¼‰ï¼šå®é™…ä¼ è¾“çš„æ•°æ®ï¼Œå®ƒä¸ä¸€å®šæ˜¯çº¯æ–‡æœ¬ï¼Œå¯ä»¥æ˜¯å›¾ç‰‡ã€è§†é¢‘ç­‰äºŒè¿›åˆ¶æ•°æ®ã€‚ è¿™å…¶ä¸­å‰ä¸¤éƒ¨åˆ†èµ·å§‹è¡Œå’Œå¤´éƒ¨å­—æ®µç»å¸¸åˆåˆç§°ä¸ºâ€œè¯·æ±‚å¤´â€æˆ–â€œå“åº”å¤´â€ï¼Œæ¶ˆæ¯æ­£æ–‡åˆç§°ä¸ºâ€œå®ä½“â€ï¼Œä½†ä¸â€œheaderâ€å¯¹åº”ï¼Œå¾ˆå¤šæ—¶å€™å°±ç›´æ¥ç§°ä¸ºâ€œbodyâ€ã€‚ HTTPæŠ¥æ–‡æ˜¯é¢å‘æ–‡æœ¬çš„ï¼Œå› æ­¤headeréƒ½æ˜¯ä¸€äº›ASCIIç ä¸²ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°ç”¨è‚‰çœ¼é˜…è¯»ï¼Œä¸ç”¨å€ŸåŠ©ç¨‹åºè§£æä¹Ÿèƒ½å¤Ÿçœ‹æ‡‚ã€‚ï¼ˆæ‰€ä»¥ä¸­æ–‡é€šå¸¸è¦ç»è¿‡urlencodeï¼‰ HTTP åè®®è§„å®šæŠ¥æ–‡å¿…é¡»æœ‰ headerï¼Œä½†å¯ä»¥æ²¡æœ‰ bodyï¼Œè€Œä¸”åœ¨ header ä¹‹åå¿…é¡»è¦æœ‰ä¸€ä¸ªâ€œç©ºè¡Œâ€ï¼Œä¹Ÿå°±æ˜¯â€œCRLFâ€ï¼Œåå…­è¿›åˆ¶çš„â€œ0D0Aâ€ã€‚ 2 è¯·æ±‚è¡Œ&amp;çŠ¶æ€è¡Œ2.1 è¯·æ±‚è¡Œ è¯·æ±‚è¡Œæ˜¯è¯·æ±‚æŠ¥æ–‡ä¸­çš„ç¬¬ä¸€è¡Œï¼Œè¯·æ±‚è¡Œç”±ä¸‰éƒ¨åˆ†æ„æˆï¼š è¯·æ±‚æ–¹æ³•ï¼šæ˜¯ä¸€ä¸ªåŠ¨è¯ï¼Œå¦‚ GET/POSTï¼Œè¡¨ç¤ºå¯¹èµ„æºçš„æ“ä½œã€‚äº‹å®ä¸Šï¼Œè¯·æ±‚æ–¹æ³•çš„è¯­ä¹‰å¹¶æ²¡æœ‰è¢«ä¸¥æ ¼éµå®ˆï¼Œç›´åˆ°RESTful APIçš„å¹¿æ³›åº”ç”¨ï¼Œæ‰ä½¿å¾—è¯·æ±‚æ–¹æ³•çš„è¯­ä¹‰å˜å¾—é‡è¦äº†èµ·æ¥ã€‚ æ–¹æ³•ï¼ˆæ“ä½œï¼‰ æ„ä¹‰ OPTION è¯·æ±‚ä¸€äº›é€‰é¡¹çš„ä¿¡æ¯ GET è¯·æ±‚è¯»å–ç”± URLæ‰€æ ‡å¿—çš„ä¿¡æ¯ HEAD è¯·æ±‚è¯»å–ç”± URLæ‰€æ ‡å¿—çš„ä¿¡æ¯çš„é¦–éƒ¨ POST ç»™æœåŠ¡å™¨æ·»åŠ ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œæ³¨é‡Šï¼‰ PUT åœ¨æŒ‡æ˜çš„ URLä¸‹å­˜å‚¨ä¸€ä¸ªæ–‡æ¡£ DELETE åˆ é™¤æŒ‡æ˜çš„ URLæ‰€æ ‡å¿—çš„èµ„æº TRACE ç”¨æ¥è¿›è¡Œç¯å›æµ‹è¯•çš„è¯·æ±‚æŠ¥æ–‡ CONNECT ç”¨äºä»£ç†æœåŠ¡å™¨ å…³äºè¯·æ±‚æ–¹æ³•ï¼Œæˆ‘ä»¬é€šå¸¸è°ˆåˆ°å¹‚ç­‰æ€§ï¼Œç›¸å…³å†…å®¹å¯ä»¥å‚è€ƒHttpè¯·æ±‚çš„å¹‚ç­‰æ€§ è¯·æ±‚ç›®æ ‡ï¼šé€šå¸¸æ˜¯ä¸€ä¸ª URIï¼Œæ ‡è®°äº†è¯·æ±‚æ–¹æ³•è¦æ“ä½œçš„èµ„æºã€‚ ç‰ˆæœ¬å·ï¼šè¡¨ç¤ºæŠ¥æ–‡ä½¿ç”¨çš„ HTTP åè®®ç‰ˆæœ¬ã€‚ è¿™ä¸‰ä¸ªéƒ¨åˆ†é€šå¸¸ä½¿ç”¨ç©ºæ ¼ï¼ˆspaceï¼‰æ¥åˆ†éš”ï¼Œæœ€åè¦ç”¨ CRLF æ¢è¡Œè¡¨ç¤ºç»“æŸã€‚ 2.2 çŠ¶æ€è¡ŒçŠ¶æ€è¡Œæ˜¯å“åº”æŠ¥æ–‡ä¸­çš„ç¬¬ä¸€è¡Œï¼Œä¸è¯·æ±‚è¡Œçš„ç»“æ„ç±»ä¼¼ã€‚ çŠ¶æ€è¡ŒåŒ…æ‹¬ä¸‰é¡¹å†…å®¹: ç‰ˆæœ¬å·ï¼šè¡¨ç¤ºæŠ¥æ–‡ä½¿ç”¨çš„ HTTP åè®®ç‰ˆæœ¬ã€‚ çŠ¶æ€ç ï¼šä¸€ä¸ªä¸‰ä½æ•°ï¼Œç”¨ä»£ç çš„å½¢å¼è¡¨ç¤ºå¤„ç†çš„ç»“æœã€‚æˆ‘åœ¨SpringBootå¼€å‘RESTful APIä¸­åˆ—ä¸¾äº†å¸¸ç”¨çš„HTTPçŠ¶æ€ç ã€‚ çŸ­è¯­ï¼šè§£é‡ŠçŠ¶æ€ç çš„ç®€å•çŸ­è¯­ï¼Œå¸®åŠ©äººç†è§£åŸå› ã€‚å¯¹äºå¸¸è§çš„çŠ¶æ€ç 200ï¼Œåé¢è·Ÿçš„çŸ­è¯­å¯èƒ½å°±æ˜¯OKã€‚ 3 å¤´éƒ¨å­—æ®µï¼ˆé¦–éƒ¨è¡Œï¼‰è¯·æ±‚è¡Œæˆ–çŠ¶æ€è¡Œå†åŠ ä¸Šå¤´éƒ¨å­—æ®µé›†åˆå°±æ„æˆäº† HTTP æŠ¥æ–‡é‡Œå®Œæ•´çš„è¯·æ±‚å¤´æˆ–å“åº”å¤´ã€‚è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡ä¸­çš„å¤´éƒ¨å­—æ®µçš„æ ¼å¼éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å­—æ®µå¯èƒ½æœ‰æ‰€åŒºåˆ«ã€‚ å¤´éƒ¨å­—æ®µæ˜¯ key-value çš„å½¢å¼ï¼Œkey å’Œ value ä¹‹é—´ç”¨â€œ: â€åˆ†éš”ï¼Œæœ€åç”¨ CRLF æ¢è¡Œè¡¨ç¤ºå­—æ®µç»“æŸã€‚æ¯”å¦‚åœ¨â€œHost: 127.0.0.1â€è¿™ä¸€è¡Œé‡Œ key å°±æ˜¯â€œHostâ€ï¼Œvalue å°±æ˜¯â€œ127.0.0.1â€ã€‚ ä½¿ç”¨å¤´å­—æ®µéœ€è¦æ³¨æ„ä¸‹é¢å‡ ç‚¹ï¼š å­—æ®µåä¸åŒºåˆ†å¤§å°å†™ï¼Œä¾‹å¦‚â€œHostâ€ä¹Ÿå¯ä»¥å†™æˆâ€œhostâ€ï¼Œä½†é¦–å­—æ¯å¤§å†™çš„å¯è¯»æ€§æ›´å¥½ï¼› å­—æ®µåé‡Œä¸å…è®¸å‡ºç°ç©ºæ ¼ï¼Œå¯ä»¥ä½¿ç”¨è¿å­—ç¬¦â€œ-â€ï¼Œä½†ä¸èƒ½ä½¿ç”¨ä¸‹åˆ’çº¿â€œ_â€ã€‚ä¾‹å¦‚ï¼Œâ€œtest-nameâ€æ˜¯åˆæ³•çš„å­—æ®µåï¼Œè€Œâ€œtest nameâ€``â€œtest_nameâ€æ˜¯ä¸æ­£ç¡®çš„å­—æ®µåï¼› å­—æ®µååé¢å¿…é¡»ç´§æ¥ç€â€œ:â€ï¼Œä¸èƒ½æœ‰ç©ºæ ¼ï¼Œè€Œâ€œ:â€åçš„å­—æ®µå€¼å‰å¯ä»¥æœ‰å¤šä¸ªç©ºæ ¼ï¼› å­—æ®µçš„é¡ºåºæ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå¯ä»¥ä»»æ„æ’åˆ—ä¸å½±å“è¯­ä¹‰ï¼› å­—æ®µåŸåˆ™ä¸Šä¸èƒ½é‡å¤ï¼Œé™¤éè¿™ä¸ªå­—æ®µæœ¬èº«çš„è¯­ä¹‰å…è®¸ï¼Œä¾‹å¦‚ Set-Cookieã€‚ 3.1 Content-Type&amp;Content-EncodingContent-Typeï¼šæ ‡è¯†bodyçš„å†…å®¹ç±»å‹ï¼Œå–å€¼é€šè¿‡â€œMIME typeâ€æ ‡å‡†ç¡®å®šï¼ŒMIME æŠŠæ•°æ®åˆ†æˆäº†å…«å¤§ç±»ï¼Œæ¯ä¸ªå¤§ç±»ä¸‹å†ç»†åˆ†å‡ºå¤šä¸ªå­ç±»ï¼Œå½¢å¼æ˜¯â€œtype/subtypeâ€çš„å­—ç¬¦ä¸²ï¼Œå·§å¾—å¾ˆï¼Œåˆšå¥½ä¹Ÿç¬¦åˆäº† HTTP æ˜æ–‡çš„ç‰¹ç‚¹ï¼Œæ‰€ä»¥èƒ½å¤Ÿå¾ˆå®¹æ˜“åœ°çº³å…¥ HTTP å¤´å­—æ®µé‡Œã€‚ è¿™é‡Œç®€å•åˆ—ä¸¾ä¸€ä¸‹åœ¨ HTTP é‡Œç»å¸¸é‡åˆ°çš„å‡ ä¸ªç±»åˆ«ï¼š textï¼šå³æ–‡æœ¬æ ¼å¼çš„å¯è¯»æ•°æ®ï¼Œæˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„åº”è¯¥å°±æ˜¯ text/html äº†ï¼Œè¡¨ç¤ºè¶…æ–‡æœ¬æ–‡æ¡£ï¼Œæ­¤å¤–è¿˜æœ‰çº¯æ–‡æœ¬ text/plainã€æ ·å¼è¡¨ text/css ç­‰ã€‚ imageï¼šå³å›¾åƒæ–‡ä»¶ï¼Œæœ‰ image/gifã€image/jpegã€image/png ç­‰ã€‚ audio/videoï¼šéŸ³é¢‘å’Œè§†é¢‘æ•°æ®ï¼Œä¾‹å¦‚ audio/mpegã€video/mp4 ç­‰ã€‚ applicationï¼šæ•°æ®æ ¼å¼ä¸å›ºå®šï¼Œå¯èƒ½æ˜¯æ–‡æœ¬ä¹Ÿå¯èƒ½æ˜¯äºŒè¿›åˆ¶ï¼Œå¿…é¡»ç”±ä¸Šå±‚åº”ç”¨ç¨‹åºæ¥è§£é‡Šã€‚å¸¸è§çš„æœ‰ application/jsonï¼Œapplication/javascriptã€application/pdf ç­‰ï¼Œå¦å¤–ï¼Œå¦‚æœå®åœ¨æ˜¯ä¸çŸ¥é“æ•°æ®æ˜¯ä»€ä¹ˆç±»å‹ï¼Œåƒåˆšæ‰è¯´çš„â€œé»‘ç›’â€ï¼Œå°±ä¼šæ˜¯ application/octet-streamï¼Œå³ä¸é€æ˜çš„äºŒè¿›åˆ¶æ•°æ®ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ä»¥x-å¼€å¤´çš„ç±»å‹æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»å‹ã€‚ä½¿ç”¨*ä»£è¡¨ä»»æ„ç±»å‹ã€‚ Content-Encodingï¼šå‘Šè¯‰æ•°æ®æ˜¯ç”¨çš„ä»€ä¹ˆç¼–ç æ ¼å¼ï¼Œè¿™æ ·å¯¹æ–¹æ‰èƒ½æ­£ç¡®è§£å‹ç¼©ï¼Œè¿˜åŸå‡ºåŸå§‹çš„æ•°æ®ã€‚å¦‚æœå“åº”æŠ¥æ–‡é‡Œæ²¡æœ‰ Content-Encoding å­—æ®µï¼Œå°±è¡¨ç¤ºå“åº”æ•°æ®æ²¡æœ‰è¢«å‹ç¼©ã€‚å¸¸è§çš„Content-Encodingï¼š gzipï¼šGNU zip å‹ç¼©æ ¼å¼ï¼Œä¹Ÿæ˜¯äº’è”ç½‘ä¸Šæœ€æµè¡Œçš„å‹ç¼©æ ¼å¼ï¼› deflateï¼šzlibï¼ˆdeflateï¼‰å‹ç¼©æ ¼å¼ï¼Œæµè¡Œç¨‹åº¦ä»…æ¬¡äº gzipï¼› brï¼šä¸€ç§ä¸“é—¨ä¸º HTTP ä¼˜åŒ–çš„æ–°å‹ç¼©ç®—æ³•ï¼ˆBrotliï¼‰ã€‚ 3.2 Accept&amp;Accept-Encodingå¦‚æœæœåŠ¡å™¨ä¸€å¢æƒ…æ„¿å‘é€ç‰¹å®šçš„æ•°æ®ç±»å‹è€Œå®¢æˆ·ç«¯è§£æä¸äº†ä¹Ÿä¸è¡Œï¼Œæ‰€ä»¥è¯·æ±‚é¦–éƒ¨å­—æ®µä¸­é€šå¸¸ä¼šæœ‰Acceptå­—æ®µï¼Œä»£è¡¨å®¢æˆ·ç«¯å¯ç†è§£çš„ MIME typeï¼Œç”¨,åšåˆ†éš”ç¬¦åˆ—å‡ºå¤šä¸ªç±»å‹ã€‚å¯¹åº”çš„ï¼Œä¹Ÿå­˜åœ¨Accept-Encodingå­—æ®µï¼Œä»£è¡¨å®¢æˆ·ç«¯æ”¯æŒçš„å‹ç¼©æ ¼å¼ã€‚æœåŠ¡å™¨é€šå¸¸è¦é€šè¿‡è¿™ä¸¤ä¸ªå­—æ®µå†³å®šå“åº”çš„æ•°æ®ç±»å‹ã€‚ 3.3 å…¶ä»–Accept-å’ŒContent-å­—æ®µAccept-Languageä»£è¡¨å®¢æˆ·ç«¯å¯ç†è§£çš„è‡ªç„¶è¯­è¨€ï¼ŒContent-Languageå‘Šè¯‰å®¢æˆ·ç«¯å®ä½“æ•°æ®ä½¿ç”¨çš„å®é™…è¯­è¨€ç±»å‹ã€‚ Accept-Charsetä»£è¡¨å®¢æˆ·ç«¯å¯è§£æçš„å­—ç¬¦é›†ï¼Œå“åº”æŠ¥æ–‡å¹¶ä¸ä¼šæœ‰Content-Charsetï¼Œè€Œæ˜¯åœ¨Content-Typeå­—æ®µçš„æ•°æ®ç±»å‹åé¢ç”¨â€œcharset=xxxâ€æ¥è¡¨ç¤ºã€‚ ä¸è¿‡ç°åœ¨çš„æµè§ˆå™¨éƒ½æ”¯æŒå¤šç§å­—ç¬¦é›†ï¼Œé€šå¸¸ä¸ä¼šå‘é€ Accept-Charsetï¼Œè€ŒæœåŠ¡å™¨ä¹Ÿä¸ä¼šå‘é€ Content-Languageï¼Œå› ä¸ºä½¿ç”¨çš„è¯­è¨€å®Œå…¨å¯ä»¥ç”±å­—ç¬¦é›†æ¨æ–­å‡ºæ¥ï¼Œæ‰€ä»¥åœ¨è¯·æ±‚å¤´é‡Œä¸€èˆ¬åªä¼šæœ‰ Accept-Language å­—æ®µï¼Œå“åº”å¤´é‡Œåªä¼šæœ‰ Content-Type å­—æ®µã€‚ 3.4 å†…å®¹åå•†çš„è´¨é‡å€¼æˆ‘ä»¬ç§°ä»¥ä¸ŠAccept-*å’ŒContent-*å­—æ®µä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯¹ä¼ è¾“çš„å†…å®¹è¿›è¡Œå†…å®¹åå•†ï¼Œåœ¨ HTTP åè®®é‡Œç”¨ Acceptã€Accept-Encodingã€Accept-Language ç­‰è¯·æ±‚å¤´å­—æ®µè¿›è¡Œå†…å®¹åå•†çš„æ—¶å€™ï¼Œè¿˜å¯ä»¥ç”¨ä¸€ç§ç‰¹æ®Šçš„â€œqâ€å‚æ•°è¡¨ç¤ºæƒé‡æ¥è®¾å®šä¼˜å…ˆçº§ï¼Œè¿™é‡Œçš„â€œqâ€æ˜¯â€œquality factorâ€çš„æ„æ€ã€‚ æƒé‡çš„æœ€å¤§å€¼æ˜¯ 1ï¼Œæœ€å°å€¼æ˜¯ 0.01ï¼Œé»˜è®¤å€¼æ˜¯ 1ï¼Œå¦‚æœå€¼æ˜¯ 0 å°±è¡¨ç¤ºæ‹’ç»ã€‚å…·ä½“çš„å½¢å¼æ˜¯åœ¨æ•°æ®ç±»å‹æˆ–è¯­è¨€ä»£ç åé¢åŠ ä¸€ä¸ª;ï¼Œç„¶åæ˜¯q=valueã€‚ ä¾‹å¦‚ï¼š Accept: text/html,application/xml;q=0.9,*/*;q=0.8å®ƒè¡¨ç¤ºæµè§ˆå™¨æœ€å¸Œæœ›ä½¿ç”¨çš„æ˜¯ HTML æ–‡ä»¶ï¼Œæƒé‡æ˜¯ 1ï¼Œå…¶æ¬¡æ˜¯ XML æ–‡ä»¶ï¼Œæƒé‡æ˜¯ 0.9ï¼Œæœ€åæ˜¯ä»»æ„æ•°æ®ç±»å‹ï¼Œæƒé‡æ˜¯ 0.8ã€‚æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚å¤´åï¼Œå°±ä¼šè®¡ç®—æƒé‡ï¼Œå†æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µä¼˜å…ˆè¾“å‡º HTML æˆ–è€… XMLã€‚ 3.5 å†…å®¹åå•†çš„ç»“æœå†…å®¹åå•†çš„è¿‡ç¨‹æ˜¯ä¸é€æ˜çš„ï¼Œæ¯ä¸ª Web æœåŠ¡å™¨ä½¿ç”¨çš„ç®—æ³•éƒ½ä¸ä¸€æ ·ã€‚ä½†æœ‰çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ä¼šåœ¨å“åº”å¤´é‡Œå¤šåŠ ä¸€ä¸ªVaryå­—æ®µï¼Œè®°å½•æœåŠ¡å™¨åœ¨å†…å®¹åå•†æ—¶å‚è€ƒçš„è¯·æ±‚å¤´å­—æ®µï¼Œç»™å‡ºä¸€ç‚¹ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š Vary: Accept-Encoding,User-Agent,Acceptè¿™ä¸ª Vary å­—æ®µè¡¨ç¤ºæœåŠ¡å™¨ä¾æ®äº† Accept-Encodingã€User-Agent å’Œ Accept è¿™ä¸‰ä¸ªå¤´å­—æ®µï¼Œç„¶åå†³å®šäº†å‘å›çš„å“åº”æŠ¥æ–‡ã€‚ 3.6 å…¶ä»–å¸¸è§çš„å¤´éƒ¨å­—æ®µHostå­—æ®µï¼Œå®ƒå±äºè¯·æ±‚å­—æ®µï¼Œåªèƒ½å‡ºç°åœ¨è¯·æ±‚å¤´é‡Œï¼Œå®ƒåŒæ—¶ä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ª HTTP/1.1 è§„èŒƒé‡Œè¦æ±‚å¿…é¡»å‡ºç°çš„å­—æ®µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè¯·æ±‚å¤´é‡Œæ²¡æœ‰ Hostï¼Œé‚£è¿™å°±æ˜¯ä¸€ä¸ªé”™è¯¯çš„æŠ¥æ–‡ã€‚Host å­—æ®µå‘Šè¯‰æœåŠ¡å™¨è¿™ä¸ªè¯·æ±‚åº”è¯¥ç”±å“ªä¸ªä¸»æœºæ¥å¤„ç†ï¼Œå½“ä¸€å°è®¡ç®—æœºä¸Šæ‰˜ç®¡äº†å¤šä¸ªè™šæ‹Ÿä¸»æœºçš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ç«¯å°±éœ€è¦ç”¨ Host å­—æ®µæ¥é€‰æ‹©ï¼Œæœ‰ç‚¹åƒæ˜¯ä¸€ä¸ªç®€å•çš„â€œè·¯ç”±é‡å®šå‘â€ã€‚ User-Agentæ˜¯è¯·æ±‚å­—æ®µï¼Œåªå‡ºç°åœ¨è¯·æ±‚å¤´é‡Œã€‚å®ƒä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²æ¥æè¿°å‘èµ· HTTP è¯·æ±‚çš„å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨å¯ä»¥ä¾æ®å®ƒæ¥è¿”å›æœ€åˆé€‚æ­¤æµè§ˆå™¨æ˜¾ç¤ºçš„é¡µé¢ã€‚ä½†ç”±äºå†å²çš„åŸå› ï¼ŒUser-Agent éå¸¸æ··ä¹±ï¼Œæ¯ä¸ªæµè§ˆå™¨éƒ½è‡ªç§°æ˜¯â€œMozillaâ€``â€œChromeâ€``â€œSafariâ€ï¼Œä¼å›¾ä½¿ç”¨è¿™ä¸ªå­—æ®µæ¥äº’ç›¸â€œä¼ªè£…â€ï¼Œå¯¼è‡´ User-Agent å˜å¾—è¶Šæ¥è¶Šé•¿ï¼Œæœ€ç»ˆå˜å¾—æ¯«æ— æ„ä¹‰ã€‚ Dateå­—æ®µæ˜¯ä¸€ä¸ªé€šç”¨å­—æ®µï¼Œä½†é€šå¸¸å‡ºç°åœ¨å“åº”å¤´é‡Œï¼Œè¡¨ç¤º HTTP æŠ¥æ–‡åˆ›å»ºçš„æ—¶é—´ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ—¶é—´å†æ­é…å…¶ä»–å­—æ®µå†³å®šç¼“å­˜ç­–ç•¥ã€‚ Serverå­—æ®µæ˜¯å“åº”å­—æ®µï¼Œåªèƒ½å‡ºç°åœ¨å“åº”å¤´é‡Œã€‚å®ƒå‘Šè¯‰å®¢æˆ·ç«¯å½“å‰æ­£åœ¨æä¾› Web æœåŠ¡çš„è½¯ä»¶åç§°å’Œç‰ˆæœ¬å·ï¼Œä¾‹å¦‚nginx/1.**ã€‚Server å­—æ®µä¹Ÿä¸æ˜¯å¿…é¡»è¦å‡ºç°çš„ï¼Œå› ä¸ºè¿™ä¼šæŠŠæœåŠ¡å™¨çš„ä¸€éƒ¨åˆ†ä¿¡æ¯æš´éœ²ç»™å¤–ç•Œï¼Œå¦‚æœè¿™ä¸ªç‰ˆæœ¬æ°å¥½å­˜åœ¨ bugï¼Œé‚£ä¹ˆé»‘å®¢å°±æœ‰å¯èƒ½åˆ©ç”¨ bug æ”»é™·æœåŠ¡å™¨ã€‚æ‰€ä»¥ï¼Œæœ‰çš„ç½‘ç«™å“åº”å¤´é‡Œè¦ä¹ˆæ²¡æœ‰è¿™ä¸ªå­—æ®µï¼Œè¦ä¹ˆå°±ç»™å‡ºä¸€ä¸ªå®Œå…¨æ— å…³çš„æè¿°ä¿¡æ¯ã€‚ Content-Lengthï¼Œå®ƒè¡¨ç¤ºæŠ¥æ–‡é‡Œ body çš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯è¯·æ±‚å¤´æˆ–å“åº”å¤´ç©ºè¡Œåé¢æ•°æ®çš„é•¿åº¦ã€‚æœåŠ¡å™¨çœ‹åˆ°è¿™ä¸ªå­—æ®µï¼Œå°±çŸ¥é“äº†åç»­æœ‰å¤šå°‘æ•°æ®ï¼Œå¯ä»¥ç›´æ¥æ¥æ”¶ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªå­—æ®µï¼Œé‚£ä¹ˆ body å°±æ˜¯ä¸å®šé•¿çš„ï¼Œéœ€è¦ä½¿ç”¨ chunked æ–¹å¼åˆ†æ®µä¼ è¾“ã€‚","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","permalink":"https://www.codetool.top/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"},{"name":"HTTP","slug":"HTTP","permalink":"https://www.codetool.top/tags/HTTP/"}]},{"title":"è®¡ç½‘å¤ä¹ 06-åº”ç”¨å±‚ä¹‹åŸŸåç³»ç»ŸDNS","slug":"è®¡ç½‘å¤ä¹ 06-åº”ç”¨å±‚ä¹‹åŸŸåç³»ç»ŸDNS","date":"2020-04-14T04:11:10.000Z","updated":"2020-04-25T14:56:25.246Z","comments":true,"path":"article/è®¡ç½‘å¤ä¹ 06-åº”ç”¨å±‚ä¹‹åŸŸåç³»ç»ŸDNS/","link":"","permalink":"https://www.codetool.top/article/%E8%AE%A1%E7%BD%91%E5%A4%8D%E4%B9%A006-%E5%BA%94%E7%94%A8%E5%B1%82%E4%B9%8B%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9FDNS/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š å…¨å±€è´Ÿè½½å‡è¡¡ï¼ˆGSLBï¼‰çš„å®ç°æ–¹æ¡ˆ_è¿ç»´_å¥”å‘äº‘è®¡ç®—çš„ç¬¨é¸Ÿçš„ä¸“æ -CSDNåšå®¢ æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹â€”â€”è´Ÿè½½å‡è¡¡ä¹‹DNSåŸŸåè§£æ_è¿ç»´_Cynric çš„åšå®¢-CSDNåšå®¢ å‡ ç§åŸŸåè§£æç±»å‹å’Œä½¿ç”¨æ–¹å¼ - èœé¸Ÿçš„ä¸€å¤© - åšå®¢å›­ ç°åœ¨ç½‘ç«™çš„æ•°ç›®éå¸¸å¤šï¼Œå¦‚æœå…¨éƒ¨ç”¨ IP åœ°å€è¿›è¡Œè®¿é—®ï¼Œææ€•å¾ˆéš¾è®°ä½ã€‚è®¸å¤šåº”ç”¨å±‚è½¯ä»¶ç»å¸¸ç›´æ¥ä½¿ç”¨åŸŸåç³»ç»Ÿ(DNS, Domain Name System)ï¼Œä½†è®¡ç®—æœºçš„ç”¨æˆ·åªæ˜¯é—´æ¥è€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨åŸŸåç³»ç»Ÿã€‚ 1 åŸŸåç³»ç»ŸDNSä»»ä½•ä¸€ä¸ªè¿æ¥åœ¨äº’è”ç½‘ä¸Šçš„ä¸»æœºæˆ–è·¯ç”±å™¨ï¼Œéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„å±‚æ¬¡ç»“æ„çš„åå­—ï¼Œå³åŸŸåã€‚äº’è”ç½‘é‡‡ç”¨äº†å±‚æ¬¡æ ‘çŠ¶ç»“æ„çš„å‘½åæ–¹æ³•ï¼ŒåŸŸåçš„ç»“æ„ç”±æ ‡å·åºåˆ—ç»„æˆï¼Œå„æ ‡å·ä¹‹é—´ç”¨ç‚¹éš”å¼€ï¼š â€¦.ä¸‰çº§åŸŸå.äºŒçº§åŸŸå.é¡¶çº§åŸŸåå¯¹äºæˆ‘çš„åšå®¢ http://www.codetool.top ï¼Œtopå°±æ˜¯é¡¶çº§åŸŸåï¼Œcodetoolæ˜¯äºŒçº§åŸŸåã€‚ æœ€å·¦è¾¹çš„æ˜¯ä¸»æœºåï¼Œé€šå¸¸ç”¨æ¥è¡¨æ˜ä¸»æœºçš„ç”¨é€”ï¼Œæ¯”å¦‚â€œwwwâ€è¡¨ç¤ºæä¾›ä¸‡ç»´ç½‘æœåŠ¡ã€â€œmailâ€è¡¨ç¤ºæä¾›é‚®ä»¶æœåŠ¡ï¼Œä¸è¿‡è¿™ä¹Ÿä¸æ˜¯ç»å¯¹çš„ï¼Œåå­—çš„å…³é”®æ˜¯è¦è®©æˆ‘ä»¬å®¹æ˜“è®°å¿†ã€‚ åŸŸååªæ˜¯ä¸ªé€»è¾‘æ¦‚å¿µï¼Œå¹¶ä¸ä»£è¡¨è®¡ç®—æœºæ‰€åœ¨çš„ç‰©ç†åœ°ç‚¹ã€‚ 1.1 å¸¸è§é¡¶çº§åŸŸå å›½å®¶é¡¶çº§åŸŸå nTLD .cn è¡¨ç¤ºä¸­å›½ï¼Œ .us è¡¨ç¤ºç¾å›½ï¼Œ .uk è¡¨ç¤ºè‹±å›½ï¼Œç­‰ç­‰ã€‚ é€šç”¨é¡¶çº§åŸŸå gTLD æœ€æ—©çš„é¡¶çº§åŸŸåæ˜¯ï¼š .com ï¼ˆå…¬å¸å’Œä¼ä¸šï¼‰ .net ï¼ˆç½‘ç»œæœåŠ¡æœºæ„ .org ï¼ˆéèµ¢åˆ©æ€§ç»„ç»‡ï¼‰ .edu ï¼ˆç¾å›½ä¸“ç”¨çš„æ•™è‚²æœºæ„ï¼‰ .gov ï¼ˆç¾å›½ä¸“ç”¨çš„æ”¿åºœéƒ¨é—¨ï¼‰ .mil ï¼ˆç¾å›½ä¸“ç”¨çš„å†›äº‹éƒ¨é—¨ï¼‰ .int ï¼ˆå›½é™…ç»„ç»‡ï¼‰ åŸºç¡€ç»“æ„åŸŸå (infrastructure domain)ï¼šè¿™ç§é¡¶çº§åŸŸååªæœ‰ä¸€ä¸ªï¼Œå³ arpaï¼Œç”¨äºåå‘åŸŸåè§£æï¼Œå› æ­¤åˆç§°ä¸ºåå‘åŸŸåã€‚ éšç€äº’è”ç½‘çš„å‘å±•ï¼Œå‡ºç°äº†å¾ˆå¤šæ–°å¢çš„é¡¶çº§åŸŸåï¼Œè¿™é‡Œä¸è°ˆã€‚ 1.2 æ³¨æ„äº‹é¡¹ åŸŸåå·²ç»æ”¯æŒä¸­æ–‡ï¼Œä¸è¿‡ä¸è¢«å¹¿æ³›ä½¿ç”¨ åŸŸåçš„æ€»é•¿åº¦é™åˆ¶åœ¨253ä¸ªå­—ç¬¦ä»¥å†…ï¼Œè€Œæ¯ä¸€çº§åŸŸåé•¿åº¦ä¸èƒ½è¶…è¿‡63ä¸ªå­—ç¬¦ã€‚ åŸŸåæ˜¯å¤§å°å†™æ— å…³çš„ï¼Œä½†é€šå¸¸éƒ½ä½¿ç”¨å°å†™çš„å½¢å¼ã€‚ è¿‡é•¿çš„åŸŸåæˆ–è€…è¿‡å¤šçš„å±‚æ¬¡å…³ç³»ä¹Ÿä¼šå¯¼è‡´ä¸IP åœ°å€åŒæ ·éš¾äºè®°å¿†çš„é—®é¢˜ï¼Œæ‰€ä»¥å¸¸è§çš„åŸŸåå¤§å¤šæ˜¯ä¸¤çº§æˆ–ä¸‰çº§ï¼Œå››çº§ä»¥ä¸Šçš„å¾ˆå°‘è§ã€‚ 2 DNSæœåŠ¡å™¨åŸŸååˆ° IP åœ°å€çš„è§£ææ˜¯ç”±è‹¥å¹²ä¸ªåŸŸåæœåŠ¡å™¨ç¨‹åºå®Œæˆçš„ã€‚åŸŸåæœåŠ¡å™¨ç¨‹åºåœ¨ä¸“è®¾çš„ç»“ç‚¹ä¸Šè¿è¡Œï¼Œè¿è¡Œè¯¥ç¨‹åºçš„æœºå™¨ç§°ä¸ºåŸŸåæœåŠ¡å™¨ã€‚ ä¸€ä¸ªæœåŠ¡å™¨æ‰€è´Ÿè´£ç®¡è¾–çš„ï¼ˆæˆ–æœ‰æƒé™çš„ï¼‰èŒƒå›´å«åšåŒº (zone)ã€‚å„å•ä½æ ¹æ®å…·ä½“æƒ…å†µæ¥åˆ’åˆ†è‡ªå·±ç®¡è¾–èŒƒå›´çš„åŒºã€‚ä½†åœ¨ä¸€ä¸ªåŒºä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å¿…é¡»æ˜¯èƒ½å¤Ÿè¿é€šçš„ã€‚æ¯ä¸€ä¸ªåŒºè®¾ç½®ç›¸åº”çš„æƒé™åŸŸåæœåŠ¡å™¨ï¼Œç”¨æ¥ä¿å­˜è¯¥åŒºä¸­çš„æ‰€æœ‰ä¸»æœºçš„åŸŸååˆ° IP åœ°å€çš„æ˜ å°„ã€‚DNS æœåŠ¡å™¨çš„ç®¡è¾–èŒƒå›´ä¸æ˜¯ä»¥â€œåŸŸâ€ä¸ºå•ä½ï¼Œè€Œæ˜¯ä»¥â€œåŒºâ€ä¸ºå•ä½ã€‚ åŸŸåæœåŠ¡å™¨æœ‰ä»¥ä¸‹å››ç§ç±»å‹ï¼š æ ¹åŸŸåæœåŠ¡å™¨ï¼šè¿”å›é¡¶çº§åŸŸ DNS æœåŠ¡å™¨çš„ IP åœ°å€ é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼šè¿”å›æƒå¨ DNS æœåŠ¡å™¨çš„ IP åœ°å€ æƒé™ï¼ˆæƒå¨ï¼‰åŸŸåæœåŠ¡å™¨ï¼šè¿”å›ç›¸åº”ä¸»æœºçš„ IP åœ°å€ æœ¬åœ°åŸŸåæœåŠ¡å™¨ 2.1 æ ¹åŸŸåæœåŠ¡å™¨æ ¹åŸŸåæœåŠ¡å™¨æ˜¯æœ€é«˜å±‚æ¬¡çš„åŸŸåæœåŠ¡å™¨ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„åŸŸåæœåŠ¡å™¨ã€‚æ‰€æœ‰çš„æ ¹åŸŸåæœåŠ¡å™¨éƒ½çŸ¥é“æ‰€æœ‰çš„é¡¶çº§åŸŸåæœåŠ¡å™¨çš„åŸŸåå’Œ IP åœ°å€ã€‚ ä¸ç®¡æ˜¯å“ªä¸€ä¸ªæœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œè‹¥è¦å¯¹äº’è”ç½‘ä¸Šä»»ä½•ä¸€ä¸ªåŸŸåè¿›è¡Œè§£æï¼Œåªè¦è‡ªå·±æ— æ³•è§£æï¼Œå°±é¦–å…ˆæ±‚åŠ©äºæ ¹åŸŸåæœåŠ¡å™¨ã€‚ åœ¨äº’è”ç½‘ä¸Šå…±æœ‰ 13 ä¸ªä¸åŒ IP åœ°å€çš„æ ¹åŸŸåæœåŠ¡å™¨ï¼Œå®ƒä»¬çš„åå­—æ˜¯ç”¨ä¸€ä¸ªè‹±æ–‡å­—æ¯å‘½åï¼Œä»aä¸€ç›´åˆ°mï¼ˆå‰ 13 ä¸ªå­—æ¯ï¼‰ï¼Œå®ƒä»¬åˆæœ‰æ•°ç™¾å°çš„é•œåƒï¼Œä¿è¯ä¸€å®šèƒ½å¤Ÿè¢«è®¿é—®åˆ°ã€‚ æ ¹åŸŸåæœåŠ¡å™¨å…±æœ‰ 13 å¥—è£…ç½®ï¼Œä¸æ˜¯ 13 ä¸ªæœºå™¨ã€‚è¿™äº›æ ¹åŸŸåæœåŠ¡å™¨ç›¸åº”çš„åŸŸååˆ†åˆ«æ˜¯ï¼š a.rootservers.net b.rootservers.net â€¦ m.rootservers.netåˆ°2016å¹´2æœˆï¼Œå…¨ä¸–ç•Œå·²ç»åœ¨ 588 ä¸ªåœ°ç‚¹å®‰è£…äº†æ ¹åŸŸåæœåŠ¡å™¨ï¼Œä½¿ä¸–ç•Œä¸Šå¤§éƒ¨åˆ† DNS åŸŸåæœåŠ¡å™¨éƒ½èƒ½å°±è¿‘æ‰¾åˆ°ä¸€ä¸ªæ ¹åŸŸåæœåŠ¡å™¨ã€‚ 2.2 é¡¶çº§åŸŸåæœåŠ¡å™¨é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼ˆå³ TLD æœåŠ¡å™¨ï¼‰è´Ÿè´£ç®¡ç†åœ¨è¯¥é¡¶çº§åŸŸåæœåŠ¡å™¨æ³¨å†Œçš„æ‰€æœ‰äºŒçº§åŸŸåã€‚ å½“æ”¶åˆ° DNS æŸ¥è¯¢è¯·æ±‚æ—¶ï¼Œå°±ç»™å‡ºç›¸åº”çš„å›ç­”ï¼ˆå¯èƒ½æ˜¯æœ€åçš„ç»“æœï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸‹ä¸€æ­¥åº”å½“æ‰¾çš„åŸŸåæœåŠ¡å™¨çš„ IP åœ°å€ï¼‰ã€‚ 2.3 æƒé™åŸŸåæœåŠ¡å™¨è´Ÿè´£ä¸€ä¸ªåŒºçš„åŸŸåæœåŠ¡å™¨ã€‚ å½“ä¸€ä¸ªæƒé™åŸŸåæœåŠ¡å™¨è¿˜ä¸èƒ½ç»™å‡ºæœ€åçš„æŸ¥è¯¢å›ç­”æ—¶ï¼Œå°±ä¼šå‘Šè¯‰å‘å‡ºæŸ¥è¯¢è¯·æ±‚çš„ DNS å®¢æˆ·ï¼Œä¸‹ä¸€æ­¥åº”å½“æ‰¾å“ªä¸€ä¸ªæƒé™åŸŸåæœåŠ¡å™¨ã€‚ 2.4 æœ¬åœ°åŸŸåæœåŠ¡å™¨æœ¬åœ°åŸŸåæœåŠ¡å™¨å¯¹åŸŸåç³»ç»Ÿéå¸¸é‡è¦ã€‚ å½“ä¸€ä¸ªä¸»æœºå‘å‡º DNS æŸ¥è¯¢è¯·æ±‚æ—¶ï¼Œè¿™ä¸ªæŸ¥è¯¢è¯·æ±‚æŠ¥æ–‡å°±å‘é€ç»™æœ¬åœ°åŸŸåæœåŠ¡å™¨ã€‚ æ¯ä¸€ä¸ªäº’è”ç½‘æœåŠ¡æä¾›è€… ISPï¼Œæˆ–ä¸€ä¸ªå¤§å­¦ï¼Œç”šè‡³ä¸€ä¸ªå¤§å­¦é‡Œçš„ç³»ï¼Œéƒ½å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªæœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œè¿™ç§åŸŸåæœåŠ¡å™¨æœ‰æ—¶ä¹Ÿç§°ä¸ºé»˜è®¤åŸŸåæœåŠ¡å™¨ã€‚ 3 åŸŸåçš„è§£æè¿‡ç¨‹ä¸»æœºå‘æœ¬åœ°åŸŸåæœåŠ¡å™¨çš„æŸ¥è¯¢ä¸€èˆ¬éƒ½æ˜¯é‡‡ç”¨é€’å½’æŸ¥è¯¢ã€‚å¦‚æœä¸»æœºæ‰€è¯¢é—®çš„æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸çŸ¥é“è¢«æŸ¥è¯¢åŸŸåçš„ IP åœ°å€ï¼Œé‚£ä¹ˆæœ¬åœ°åŸŸåæœåŠ¡å™¨å°±ä»¥ DNS å®¢æˆ·çš„èº«ä»½ï¼Œå‘å…¶ä»–æ ¹åŸŸåæœåŠ¡å™¨ç»§ç»­å‘å‡ºæŸ¥è¯¢è¯·æ±‚æŠ¥æ–‡ã€‚ æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘æ ¹åŸŸåæœåŠ¡å™¨çš„æŸ¥è¯¢é€šå¸¸æ˜¯é‡‡ç”¨è¿­ä»£æŸ¥è¯¢ã€‚å½“æ ¹åŸŸåæœåŠ¡å™¨æ”¶åˆ°æœ¬åœ°åŸŸåæœåŠ¡å™¨çš„è¿­ä»£æŸ¥è¯¢è¯·æ±‚æŠ¥æ–‡æ—¶ï¼Œè¦ä¹ˆç»™å‡ºæ‰€è¦æŸ¥è¯¢çš„ IP åœ°å€ï¼Œè¦ä¹ˆå‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼šâ€œä½ ä¸‹ä¸€æ­¥åº”å½“å‘å“ªä¸€ä¸ªåŸŸåæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢â€ã€‚ç„¶åè®©æœ¬åœ°åŸŸåæœåŠ¡å™¨è¿›è¡Œåç»­çš„æŸ¥è¯¢ã€‚ 4 åŸŸåçš„é«˜é€Ÿç¼“å­˜æ¯ä¸ªåŸŸåæœåŠ¡å™¨éƒ½ç»´æŠ¤ä¸€ä¸ªé«˜é€Ÿç¼“å­˜ï¼Œå­˜æ”¾æœ€è¿‘ç”¨è¿‡çš„åå­—ä»¥åŠä»ä½•å¤„è·å¾—åå­—æ˜ å°„ä¿¡æ¯çš„è®°å½•ã€‚å¯å¤§å¤§å‡è½»æ ¹åŸŸåæœåŠ¡å™¨çš„è´Ÿè·ï¼Œä½¿äº’è”ç½‘ä¸Šçš„ DNS æŸ¥è¯¢è¯·æ±‚å’Œå›ç­”æŠ¥æ–‡çš„æ•°é‡å¤§ä¸ºå‡å°‘ã€‚ ä¸ºä¿æŒé«˜é€Ÿç¼“å­˜ä¸­çš„å†…å®¹æ­£ç¡®ï¼ŒåŸŸåæœåŠ¡å™¨åº”ä¸ºæ¯é¡¹å†…å®¹è®¾ç½®è®¡æ—¶å™¨ï¼Œå¹¶å¤„ç†è¶…è¿‡åˆç†æ—¶é—´çš„é¡¹ï¼ˆä¾‹å¦‚ï¼Œæ¯ä¸ªé¡¹ç›®åªå­˜æ”¾ä¸¤å¤©ï¼‰ã€‚ å½“æƒé™åŸŸåæœåŠ¡å™¨å›ç­”ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚æ—¶ï¼Œåœ¨å“åº”ä¸­éƒ½æŒ‡æ˜ç»‘å®šæœ‰æ•ˆå­˜åœ¨çš„æ—¶é—´å€¼ã€‚å¢åŠ æ­¤æ—¶é—´å€¼å¯å‡å°‘ç½‘ç»œå¼€é”€ï¼Œè€Œå‡å°‘æ­¤æ—¶é—´å€¼å¯æé«˜åŸŸåè½¬æ¢çš„å‡†ç¡®æ€§ã€‚ å¦å¤–ï¼Œæ“ä½œç³»ç»Ÿé‡Œä¹Ÿä¼šå¯¹ DNS è§£æç»“æœåšç¼“å­˜ï¼Œå¦‚æœä½ ä¹‹å‰è®¿é—®è¿‡â€œwww.apple.comâ€ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡åœ¨æµè§ˆå™¨é‡Œå†è¾“å…¥è¿™ä¸ªç½‘å€çš„æ—¶å€™å°±ä¸ä¼šå†è·‘åˆ° DNS é‚£é‡Œå»é—®äº†ï¼Œç›´æ¥åœ¨æ“ä½œç³»ç»Ÿé‡Œå°±å¯ä»¥æ‹¿åˆ° IP åœ°å€ã€‚ åœ¨Windowsä¸‹å¯ä»¥åœ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸‹æ‰§è¡Œipconfig /flushdnså‘½ä»¤æ¥åˆ·æ–°ç¼“å­˜ï¼Œåœ¨Linuxä¸‹å¯ä»¥é€šè¿‡/etc/init.d/nscd restartæ¥æ¸…é™¤ç¼“å­˜ï¼Œ 5 hostsæ–‡ä»¶æ“ä½œç³»ç»Ÿé‡Œè¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„â€œä¸»æœºæ˜ å°„â€æ–‡ä»¶ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå¯ç¼–è¾‘çš„æ–‡æœ¬ï¼Œåœ¨ Linux é‡Œæ˜¯â€œ/etc/hostsâ€ï¼Œåœ¨ Windows é‡Œæ˜¯â€œC:\\WINDOWS\\system32\\drivers\\etc\\hostsâ€ï¼Œå¦‚æœæ“ä½œç³»ç»Ÿåœ¨ç¼“å­˜é‡Œæ‰¾ä¸åˆ° DNS è®°å½•ï¼Œå°±ä¼šæ‰¾è¿™ä¸ªæ–‡ä»¶ã€‚ 6 å‡ ç§åŸŸåè§£æç±»å‹6.1 Aè®°å½•æœ€ç®€å•æœ€å¸¸ç”¨ï¼Œæ·»åŠ è®°å½•æ—¶å€™å¡«å†™IPåœ°å€å³å¯ã€‚Aè®°å½•(Address)æ˜¯ç”¨æ¥æŒ‡å®šä¸»æœºåï¼ˆæˆ–åŸŸåï¼‰å¯¹åº”çš„IPåœ°å€è®°å½•ã€‚é€šè¿‡Aè®°å½•æ‚¨å¯ä»¥å°†è¯¥åŸŸåæŒ‡å‘åˆ°è‡ªå·±çš„ç½‘ç«™æœåŠ¡å™¨IPåœ°å€ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è®¾ç½®æ‚¨åŸŸåçš„äºŒçº§åŸŸåã€‚ 6.2 MXè®°å½•æ˜¯Mail Exchangerçš„ç¼©å†™ï¼Œæ„æ€æ˜¯é‚®ä»¶äº¤æ¢è®°å½•ã€‚å®ƒæŒ‡å‘ä¸€ä¸ªé‚®ä»¶æœåŠ¡å™¨ï¼Œç”¨äºç”µå­é‚®ä»¶ç³»ç»Ÿå‘é‚®ä»¶æ—¶æ ¹æ®æ”¶ä¿¡äººçš„åœ°å€åç¼€æ¥å®šä½é‚®ä»¶æœåŠ¡å™¨ã€‚ä¾‹å¦‚ï¼Œå½“Internetä¸Šçš„æŸç”¨æˆ·è¦å‘ä¸€å°ä¿¡ç»™ user@vipiis.comæ—¶ï¼Œè¯¥ç”¨æˆ·çš„é‚®ä»¶ç³»ç»Ÿé€šè¿‡DNSæŸ¥æ‰¾vipiis.comè¿™ä¸ªåŸŸåçš„MXè®°å½•ï¼Œå¦‚æœMXè®°å½•å­˜åœ¨ï¼Œ ç”¨æˆ·è®¡ç®—æœºå°±å°†é‚®ä»¶å‘é€åˆ°MXè®°å½•æ‰€æŒ‡å®šçš„é‚®ä»¶æœåŠ¡å™¨ä¸Šã€‚ 6.3 CNAMEè®°å½•ä¹Ÿè¢«ç§°ä¸ºåˆ«åè®°å½•ï¼Œæ˜¯åŒçº¿æ™ºèƒ½è§£æå’Œä½¿ç”¨CDNåŠ é€Ÿå¿…é¡»ç”¨åˆ°çš„è§£ææ–¹æ³•ã€‚CNAMEè§£æé€šå¸¸æ˜¯ä¸€ä¸ªä¸‰çº§åŸŸååœ°å€ï¼Œæ‚¨å¯ä»¥åœ¨ä¸»æœºç®¡ç†åå°â€ç»‘å®šåŸŸåâ€ä½ç½®çœ‹åˆ°cnameè§£æåœ°å€çš„ä¿¡æ¯æç¤ºï¼Œä¸åŒæœåŠ¡å™¨ä¼šä½¿ç”¨ä¸åŒçš„cnameè§£æåœ°å€ã€‚é€šè¿‡cnameè§£æï¼Œå¯ä»¥è®©åŸŸåæ†ç»‘åˆ°å¤šä¸ªæœåŠ¡å™¨IPåœ°å€ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯cnameè§£æåœ°å€åé¢æœ‰ä¸ªè‹±æ–‡â€œ.â€ç¬¦å·ã€‚ é€šå¸¸æ¥è¯´ï¼Œåˆ«åè§£æå¯ä»¥æä¾›æ›´å¤§çš„çµæ´»æ€§ï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†ã€‚ä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œå½“ä¸»æœºå› å„ç§å› ç´ çš„å½±å“éœ€è¦æ›´æ¢IPæ—¶ï¼Œå¦‚æœåŸŸååšäº†CNAMEè®°å½•ï¼Œå°±å¯ä»¥åŒæ—¶æ›´æ–°åˆ«åçš„è§£ææŒ‡å‘ï¼Œä¸ç”¨éœ€è¦è¿›è¡Œæ–°çš„è§£ææ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥åšåˆ°æ— ç¼æ›´æ¢IPï¼Œè¿™å¯¹å®é™…ä¸­IPçš„ç»´æŠ¤æ˜¯å¾ˆå®ç”¨çš„ã€‚è€Œä¸”å¯¹äºåŒçº¿ä¸»æœºæ¥è¯´ï¼Œç”µä¿¡å’Œè”é€šæœ‰ä¸åŒçš„æ¥å£å¯¹åº”ä¸åŒçš„IP,ç”±äºAè®°å½•åªèƒ½æŒ‡å‘ä¸€ä¸ªIP,è¿™æ—¶é‡‡ç”¨åˆ«åè§£æå°±å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å½“ç„¶äº†CNAMEè®°å½•ä¹Ÿå­˜åœ¨ä¸€å®šçš„ä¸è¶³ï¼Œå¾ˆå¤šäººè®¤ä¸ºä¸åŒçš„IPä¼šå¯¹ç½‘ç«™ä¼˜åŒ–äº§ç”Ÿä¸€å®šçš„å½±å“ï¼Œå½“æœç´¢å¼•æ“çˆ¬è™«æ¯æ¬¡çˆ¬è¡Œçš„æ—¶å€™ï¼ŒIPå˜åŒ–å®¹æ˜“è®©çˆ¬è™«äº§ç”Ÿç½‘ç«™ä¸ç¨³å®šçš„è¯¯è§£ã€‚ä¸è¿‡è§ä»è§æ™ºï¼Œåˆ°åº•å¥½ä¸å¥½è¿˜éœ€è¦è‡ªå·±å»åˆ¤æ–­ã€‚ 6.4 NSè®°å½•æ˜¯åŸŸåDNSæœåŠ¡å™¨è®°å½•ï¼Œå…¨ç§°Name Serverè®°å½•ï¼Œç”¨æ¥æŒ‡å®šè¯¥åŸŸåç”±å“ªä¸ªDNSæœåŠ¡å™¨æ¥å¯¹æ‚¨çš„åŸŸåè¿›è¡Œè§£æã€‚æ‚¨æ³¨å†ŒåŸŸåæ—¶ï¼Œæ€»æœ‰é»˜è®¤çš„DNSæœåŠ¡å™¨ï¼Œæ¯ä¸ªæ³¨å†Œçš„åŸŸåéƒ½æ˜¯ç”±ä¸€ç»„DNSåŸŸåæœåŠ¡å™¨æ¥è§£æçš„ã€‚ 6.5 TXTè®°å½•ä¸€ç§æ–‡æœ¬è®°å½•ï¼Œä»…ç”¨äºå¯¹ä¸»æœºåæˆ–è€…åŸŸåçš„è®°å½•ä¿¡æ¯ï¼Œå¯¹è§£ææ— å®è´¨å½±å“ã€‚ 6.6 TTLå€¼å…¨ç§°æ˜¯â€œç”Ÿå­˜æ—¶é—´ï¼ˆTime To Live)â€ï¼Œç®€å•çš„è¯´å®ƒè¡¨ç¤ºDNSè®°å½•åœ¨DNSæœåŠ¡å™¨ä¸Šç¼“å­˜æ—¶é—´ã€‚é»˜è®¤å³å¯ã€‚ 7 åŸºäºDNSçš„è´Ÿè½½å‡è¡¡è¿™é‡Œå…ˆè°ˆè°ˆä»€ä¹ˆæ˜¯å†…éƒ¨è´Ÿè½½å‡è¡¡ï¼ˆSLBï¼‰å’Œå…¨å±€è´Ÿè½½å‡è¡¡ï¼ˆGSLBï¼‰ï¼Ÿ SLB(Server load balancing)æ˜¯å¯¹é›†ç¾¤å†…ç‰©ç†ä¸»æœºçš„è´Ÿè½½å‡è¡¡ï¼Œè€ŒGSLBæ˜¯å¯¹ç‰©ç†é›†ç¾¤çš„è´Ÿè½½å‡è¡¡ã€‚è¿™é‡Œçš„è´Ÿè½½å‡è¡¡å¯èƒ½ä¸åªæ˜¯ç®€å•çš„æµé‡å‡åŒ€åˆ†é…,è€Œæ˜¯ä¼šæ ¹æ®ç­–ç•¥çš„ä¸åŒå®ç°ä¸åŒåœºæ™¯çš„åº”ç”¨äº¤ä»˜ã€‚ GSLBæ˜¯ä¾èµ–äºç”¨æˆ·å’Œå®é™…éƒ¨ç½²ç¯å¢ƒçš„äº’è”ç½‘èµ„æºåˆ†å‘æŠ€æœ¯ï¼Œä¸åŒçš„ç›®çš„å¯¹åº”ç€ä¸€ç³»åˆ—ä¸åŒçš„æŠ€æœ¯å®ç°ã€‚ 7.1 å†…éƒ¨è´Ÿè½½å‡è¡¡ä½¿ç”¨DNSå®ç°å†…éƒ¨è´Ÿè½½å‡è¡¡è¾ƒç®€å•ï¼Œç›´æ¥å°†åŸŸåè§£æåˆ°å¤šä¸ªIPåœ°å€ï¼Œä¸‹é¢æ˜¯åˆ©ç”¨DNSå·¥ä½œåŸç†å¤„ç†è´Ÿè½½å‡è¡¡çš„å·¥ä½œåŸç†å›¾ï¼š ç”±ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œåœ¨DNSæœåŠ¡å™¨ä¸­åº”è¯¥é…ç½®äº†å¤šä¸ªAè®°å½•ï¼Œå¦‚ï¼š www.apusapp.com IN A 114.100.20.201; www.apusapp.com IN A 114.100.20.202; www.apusapp.com IN A 114.100.20.203;7.2 å…¨å±€è´Ÿè½½å‡è¡¡ä¸ºäº†ä¿è¯æˆ‘ä»¬çš„åº”ç”¨é«˜å¯ç”¨ï¼Œå¾€å¾€ä¼šéƒ¨ç½²åœ¨å¤šä¸ªæœºæˆ¿ï¼Œæ¯ä¸ªåœ°æ–¹éƒ½ä¼šæœ‰è‡ªå·±çš„ IP åœ°å€ã€‚å½“ç”¨æˆ·è®¿é—®æŸä¸ªåŸŸåçš„æ—¶å€™ï¼Œè¿™ä¸ª IP åœ°å€å¯ä»¥è½®è¯¢è®¿é—®å¤šä¸ªæ•°æ®ä¸­å¿ƒã€‚å¦‚æœä¸€ä¸ªæ•°æ®ä¸­å¿ƒå› ä¸ºæŸç§åŸå› æŒ‚äº†ï¼Œåªè¦åœ¨ DNS æœåŠ¡å™¨é‡Œé¢ï¼Œå°†è¿™ä¸ªæ•°æ®ä¸­å¿ƒå¯¹åº”çš„ IP åœ°å€åˆ é™¤ï¼Œå°±å¯ä»¥å®ç°ä¸€å®šçš„é«˜å¯ç”¨ã€‚ å¦å¤–ï¼Œæˆ‘ä»¬è‚¯å®šå¸Œæœ›åŒ—äº¬çš„ç”¨æˆ·è®¿é—®åŒ—äº¬çš„æ•°æ®ä¸­å¿ƒï¼Œä¸Šæµ·çš„ç”¨æˆ·è®¿é—®ä¸Šæµ·çš„æ•°æ®ä¸­å¿ƒï¼ˆå°±è¿‘è®¿é—®ï¼‰ï¼Œè¿™æ ·ï¼Œå®¢æˆ·ä½“éªŒå°±ä¼šéå¸¸å¥½ï¼Œè®¿é—®é€Ÿåº¦å°±ä¼šè¶…å¿«ã€‚ ä½¿ç”¨DNSå®ç°å…¨å±€è´Ÿè½½å‡è¡¡æ˜¯åœ¨DNSæœåŠ¡å™¨å…³è”GSLBè®¾å¤‡ï¼Œå®ƒé€šè¿‡è‡ªå®šä¹‰çš„ç­–ç•¥æ ¹æ®å®¢æˆ·IPåœ°ç†ä½ç½®ã€è¿è¥å•†ã€å¯ç”¨é›†ç¾¤ç­‰ä¿¡æ¯ä¸ºå®¢æˆ·åˆ†é…åˆé€‚çš„ä¸»æœºã€‚ 8 DNSåŠ«æŒåŸŸååŠ«æŒæ˜¯äº’è”ç½‘æ”»å‡»çš„ä¸€ç§æ–¹å¼ï¼Œé€šè¿‡æ”»å‡»åŸŸåè§£ææœåŠ¡å™¨ï¼ˆDNSï¼‰ï¼Œæˆ–ä¼ªé€ åŸŸåè§£ææœåŠ¡å™¨ï¼ˆDNSï¼‰çš„æ–¹æ³•ï¼ŒæŠŠç›®æ ‡ç½‘ç«™åŸŸåè§£æåˆ°é”™è¯¯çš„IPåœ°å€ä»è€Œå®ç°ç”¨æˆ·æ— æ³•è®¿é—®ç›®æ ‡ç½‘ç«™çš„ç›®çš„æˆ–è€…è“„æ„æˆ–æ¶æ„è¦æ±‚ç”¨æˆ·è®¿é—®æŒ‡å®šIPåœ°å€ï¼ˆç½‘ç«™ï¼‰çš„ç›®çš„ã€‚ å¦‚ä½•è§£å†³ï¼Ÿä½¿ç”¨å¯é çš„DNSæœåŠ¡ã€‚","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","permalink":"https://www.codetool.top/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"}]},{"title":"leetcode445-ä¸¤æ•°ç›¸åŠ II","slug":"leetcode445-ä¸¤æ•°ç›¸åŠ II","date":"2020-04-14T02:42:43.000Z","updated":"2020-04-14T05:24:08.122Z","comments":true,"path":"article/leetcode445-ä¸¤æ•°ç›¸åŠ II/","link":"","permalink":"https://www.codetool.top/article/leetcode445-%E4%B8%A4%E6%95%B0%E7%9B%B8%E5%8A%A0II/","excerpt":"","text":"1 åŸé¢˜ç»™ä½ ä¸¤ä¸ª éç©º é“¾è¡¨æ¥ä»£è¡¨ä¸¤ä¸ªéè´Ÿæ•´æ•°ã€‚æ•°å­—æœ€é«˜ä½ä½äºé“¾è¡¨å¼€å§‹ä½ç½®ã€‚å®ƒä»¬çš„æ¯ä¸ªèŠ‚ç‚¹åªå­˜å‚¨ä¸€ä½æ•°å­—ã€‚å°†è¿™ä¸¤æ•°ç›¸åŠ ä¼šè¿”å›ä¸€ä¸ªæ–°çš„é“¾è¡¨ã€‚ ä½ å¯ä»¥å‡è®¾é™¤äº†æ•°å­— 0 ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªæ•°å­—éƒ½ä¸ä¼šä»¥é›¶å¼€å¤´ã€‚ è¿›é˜¶ï¼š å¦‚æœè¾“å…¥é“¾è¡¨ä¸èƒ½ä¿®æ”¹è¯¥å¦‚ä½•å¤„ç†ï¼Ÿæ¢å¥è¯è¯´ï¼Œä½ ä¸èƒ½å¯¹åˆ—è¡¨ä¸­çš„èŠ‚ç‚¹è¿›è¡Œç¿»è½¬ã€‚ ç¤ºä¾‹: è¾“å…¥: (7 -&gt; 2 -&gt; 4 -&gt; 3) + (5 -&gt; 6 -&gt; 4)è¾“å‡º: 7 -&gt; 8 -&gt; 0 -&gt; 7 2 è§£æ³•2.1 æ€æƒ³æ ˆ 2.2 ä»£ç class Solution { public ListNode addTwoNumbers(ListNode l1, ListNode l2) { ListNode head = null; Stack&lt;Integer> stack1 = new Stack&lt;>(); Stack&lt;Integer> stack2 = new Stack&lt;>(); while(l1!=null){ stack1.push(l1.val); l1 = l1.next; } while(l2!=null){ stack2.push(l2.val); l2 = l2.next; } int val1,val2,sum = 0; int carry = 0; while(!stack1.isEmpty() || !stack2.isEmpty() || carry != 0){ val1 = stack1.isEmpty()?0:stack1.pop(); val2 = stack2.isEmpty()?0:stack2.pop(); sum = val1+val2+carry; if(sum>=10) { carry = 1; sum -= 10; }else carry = 0; ListNode node = new ListNode(sum); node.next = head; head = node; } return head; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"HTTPç‰ˆæœ¬å‘å±•ä¸Googleçš„æš—ä¸­åŠ©åŠ›","slug":"HTTPç‰ˆæœ¬å‘å±•ä¸Googleçš„æš—ä¸­åŠ©åŠ›","date":"2020-04-13T06:57:58.000Z","updated":"2020-04-16T15:27:47.266Z","comments":true,"path":"article/HTTPç‰ˆæœ¬å‘å±•ä¸Googleçš„æš—ä¸­åŠ©åŠ›/","link":"","permalink":"https://www.codetool.top/article/HTTP%E7%89%88%E6%9C%AC%E5%8F%91%E5%B1%95%E4%B8%8EGoogle%E7%9A%84%E6%9A%97%E4%B8%AD%E5%8A%A9%E5%8A%9B/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š httpåè®®å†å² - æ‰¿è½½æ¢¦æƒ³-éŸ©æ—­æ˜ - åšå®¢å›­ HTTP 0.9 HTTP 1.0 HTTP 1.1 HTTP 2.0åŒºåˆ« - æ­¦åŸ¹è½© - åšå®¢å›­ HTTP1.0 HTTP1.1 HTTP2.0 ä¸»è¦ç‰¹æ€§å¯¹æ¯” - å‰ç«¯ç¢ç¢å¿µ - SegmentFault æ€å¦ æŠ€æœ¯æ‰«ç›²ï¼šæ–°ä¸€ä»£åŸºäºUDPçš„ä½å»¶æ—¶ç½‘ç»œä¼ è¾“å±‚åè®®â€”â€”QUICè¯¦è§£-ç½‘ç»œç¼–ç¨‹/ä¸“é¡¹æŠ€æœ¯åŒº - å³æ—¶é€šè®¯å¼€å‘è€…ç¤¾åŒº! æå®¢æ—¶é—´ã€Šé€è§†HTTPåè®®ã€‹è¯¾ç¨‹ 1 HTTPåè®®æ¦‚è¿°HTTPï¼ˆHyperText Transfer Protocolï¼‰æ˜¯ä¸€ä¸ªç®€å•çš„è¯·æ±‚-å“åº”åè®®ï¼Œå®ƒé€šå¸¸è¿è¡Œåœ¨TCPä¹‹ä¸Šã€‚æœ€åˆè®¾æƒ³çš„åŸºæœ¬ç†å¿µæ˜¯ï¼šå€ŸåŠ©å¤šæ–‡æ¡£ä¹‹é—´ç›¸äº’å…³è”å½¢æˆçš„è¶…æ–‡æœ¬ï¼ˆHyperTextï¼‰ï¼Œè¿æˆå¯ç›¸äº’å‚é˜…çš„ WWWï¼ˆWorld Wide Webï¼Œ ä¸‡ç»´ç½‘ï¼‰ HTTPçš„å‘å±•æ˜¯ç”±è’‚å§†Â·ä¼¯çº³æ–¯-æäº1989å¹´åœ¨æ¬§æ´²æ ¸å­ç ”ç©¶ç»„ç»‡ï¼ˆCERNï¼‰æ‰€å‘èµ·ã€‚ä»–æå‡ºä¸‡ç»´ç½‘çš„æ ¸å¿ƒæ¦‚å¿µæœ‰ï¼š URIï¼šå³ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼Œä½œä¸ºäº’è”ç½‘ä¸Šèµ„æºçš„å”¯ä¸€èº«ä»½ HTMLï¼šå³è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼Œæè¿°è¶…æ–‡æœ¬æ–‡æ¡£ HTTPï¼šå³è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œç”¨æ¥ä¼ è¾“è¶…æ–‡æœ¬ã€‚ 2 HTTPç‰ˆæœ¬å®¡è§†2.1 HTTP/0.920 ä¸–çºª 90 å¹´ä»£åˆæœŸçš„äº’è”ç½‘ä¸–ç•Œéå¸¸ç®€é™‹ï¼Œè®¡ç®—æœºå¤„ç†èƒ½åŠ›ä½ï¼Œå­˜å‚¨å®¹é‡å°ï¼Œç½‘é€Ÿå¾ˆæ…¢ï¼Œè¿˜æ˜¯ä¸€ç‰‡â€œä¿¡æ¯è’æ¼ â€ã€‚ç½‘ç»œä¸Šç»å¤§å¤šæ•°çš„èµ„æºéƒ½æ˜¯çº¯æ–‡æœ¬ï¼Œå¾ˆå¤šé€šä¿¡åè®®ä¹Ÿéƒ½ä½¿ç”¨çº¯æ–‡æœ¬ï¼Œæ‰€ä»¥ HTTP çš„è®¾è®¡ä¹Ÿä¸å¯é¿å…åœ°å—åˆ°äº†æ—¶ä»£çš„é™åˆ¶ã€‚ è¿™ä¸€æ—¶æœŸçš„ HTTP è¢«å®šä¹‰ä¸º 0.9 ç‰ˆï¼Œç»“æ„æ¯”è¾ƒç®€å•ï¼Œä¸ºäº†ä¾¿äºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¤„ç†ï¼Œå®ƒä¹Ÿé‡‡ç”¨äº†çº¯æ–‡æœ¬æ ¼å¼ã€‚è’‚å§†Â·ä¼¯çº³æ–¯-ææœ€åˆè®¾æƒ³çš„ç³»ç»Ÿé‡Œçš„æ–‡æ¡£éƒ½æ˜¯åªè¯»çš„ï¼Œæ‰€ä»¥åªå…è®¸ç”¨â€œGETâ€åŠ¨ä½œä»æœåŠ¡å™¨ä¸Šè·å– HTML æ–‡æ¡£ï¼ˆä¸èƒ½æ˜¯å…¶ä»–æ ¼å¼ï¼‰ï¼Œå¹¶ä¸”åœ¨å“åº”è¯·æ±‚ä¹‹åç«‹å³å…³é—­è¿æ¥ï¼ŒåŠŸèƒ½éå¸¸æœ‰é™ã€‚ è¿™ä¸ªæ—¶æœŸçš„HTTPå¹¶æ²¡æœ‰ä½œä¸ºæ­£å¼çš„æ ‡å‡†è¢«å»ºç«‹ã€‚HTTP/0.9å…·æœ‰å…¸å‹çš„æ— çŠ¶æ€æ€§ï¼Œæ¯ä¸ªäº‹åŠ¡ç‹¬ç«‹è¿›è¡Œå¤„ç†ï¼Œäº‹åŠ¡ç»“æŸæ—¶å°±é‡Šæ”¾è¿™ä¸ªè¿æ¥ã€‚ç”±æ­¤å¯è§ï¼ŒHTTPåè®®çš„æ— çŠ¶æ€ç‰¹ç‚¹åœ¨å…¶ç¬¬ä¸€ä¸ªç‰ˆæœ¬0.9ä¸­å·²ç»æˆå‹ã€‚ä¸€æ¬¡HTTP/0.9çš„ä¼ è¾“é¦–å…ˆè¦å»ºç«‹ä¸€ä¸ªç”±å®¢æˆ·ç«¯åˆ°WebæœåŠ¡å™¨çš„TCPè¿æ¥ï¼Œç”±å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œç„¶åç”±WebæœåŠ¡å™¨è¿”å›é¡µé¢å†…å®¹ï¼Œç„¶åè¿æ¥ä¼šå…³é—­ã€‚å¦‚æœè¯·æ±‚çš„é¡µé¢ä¸å­˜åœ¨ï¼Œä¹Ÿä¸ä¼šè¿”å›ä»»ä½•é”™è¯¯ç ã€‚ 2.2 HTTP/1.01993 å¹´ï¼ŒNCSAï¼ˆç¾å›½å›½å®¶è¶…çº§è®¡ç®—åº”ç”¨ä¸­å¿ƒï¼‰å¼€å‘å‡ºäº† Mosaicï¼Œæ˜¯ç¬¬ä¸€ä¸ªå¯ä»¥å›¾æ–‡æ··æ’çš„æµè§ˆå™¨ï¼Œéšååˆåœ¨ 1995 å¹´å¼€å‘å‡ºäº†æœåŠ¡å™¨è½¯ä»¶ Apacheï¼Œç®€åŒ–äº† HTTP æœåŠ¡å™¨çš„æ­å»ºå·¥ä½œã€‚åŒä¸€æ—¶æœŸï¼Œè®¡ç®—æœºå¤šåª’ä½“æŠ€æœ¯ä¹Ÿæœ‰äº†æ–°çš„å‘å±•ã€‚è¿™äº›æ–°è½¯ä»¶æ–°æŠ€æœ¯ä¸€ç»æ¨å‡ºç«‹åˆ»å°±å¸å¼•äº†å¹¿å¤§ç½‘æ°‘çš„çƒ­æƒ…ï¼Œæ›´å¤šçš„äººå¼€å§‹ä½¿ç”¨äº’è”ç½‘ï¼Œç ”ç©¶ HTTP å¹¶æå‡ºæ”¹è¿›æ„è§ï¼Œç”šè‡³å®éªŒæ€§åœ°å¾€åè®®é‡Œæ·»åŠ å„ç§ç‰¹æ€§ï¼Œä»ç”¨æˆ·éœ€æ±‚çš„è§’åº¦ä¿ƒè¿›äº† HTTP çš„å‘å±•ã€‚ äºæ˜¯åœ¨è¿™äº›å·²æœ‰å®è·µçš„åŸºç¡€ä¸Šï¼Œç»è¿‡ä¸€ç³»åˆ—çš„è‰æ¡ˆï¼ŒHTTP/1.0 ç‰ˆæœ¬åœ¨1996å¹´çš„5æœˆæ­£å¼å‘å¸ƒï¼Œå¹¶è®°è½½äºRFC1945ã€‚è™½ç„¶è¯´æ˜¯åˆæœŸæ ‡å‡†ï¼Œä½†è¯¥åè®®æ ‡å‡†è‡³ä»Šä»è¢«ä½¿ç”¨åœ¨æœåŠ¡å™¨ç«¯ã€‚å®ƒåœ¨å¤šæ–¹é¢å¢å¼ºäº† 0.9 ç‰ˆï¼Œå½¢å¼ä¸Šå·²ç»å’Œæˆ‘ä»¬ç°åœ¨çš„ HTTP å·®åˆ«ä¸å¤§äº†ï¼Œç‰¹ç‚¹æœ‰ï¼š ä»»ä½•æ ¼å¼çš„å†…å®¹éƒ½å¯ä»¥å‘é€ã€‚è¿™ä½¿å¾—äº’è”ç½‘ä¸ä»…å¯ä»¥ä¼ è¾“æ–‡å­—ï¼Œè¿˜èƒ½ä¼ è¾“å›¾åƒã€è§†é¢‘ã€äºŒè¿›åˆ¶æ–‡ä»¶ã€‚è¿™ä¸ºäº’è”ç½‘çš„å¤§å‘å±•å¥ å®šäº†åŸºç¡€ã€‚ é™¤äº†GETå‘½ä»¤ï¼Œè¿˜å¼•å…¥äº†POSTå‘½ä»¤å’ŒHEADå‘½ä»¤ï¼Œä¸°å¯Œäº†æµè§ˆå™¨ä¸æœåŠ¡å™¨çš„äº’åŠ¨æ‰‹æ®µ å¢åŠ äº†å“åº”çŠ¶æ€ç ï¼Œæ ‡è®°å¯èƒ½çš„é”™è¯¯åŸå›  å¼•å…¥äº†åè®®ç‰ˆæœ¬å·æ¦‚å¿µ å¼•å…¥äº† HTTP Headerï¼ˆå¤´éƒ¨ï¼‰çš„æ¦‚å¿µï¼Œè®© HTTP å¤„ç†è¯·æ±‚å’Œå“åº”æ›´åŠ çµæ´» å…¶ä»–è¿˜æœ‰æ”¯æŒé•¿è¿æ¥ï¼ˆä½¿ç”¨Connection: keep-aliveï¼Œä½†é»˜è®¤è¿˜æ˜¯ä½¿ç”¨çŸ­è¿æ¥ï¼‰ï¼Œç¼“å­˜æœºåˆ¶ï¼Œä»¥åŠèº«ä»½è®¤è¯ç­‰ HTTP/1.0çš„ä¸è¶³ï¼š HTTP1.0è§„å®šæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¿æŒçŸ­æš‚çš„è¿æ¥ï¼Œæµè§ˆå™¨çš„æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦ä¸æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼ŒæœåŠ¡å™¨å¤„ç†å®Œæˆåç«‹å³æ–­å¼€TCPè¿æ¥ï¼ˆæ— è¿æ¥ï¼‰ï¼Œæ— æ³•å¤ç”¨è¿æ¥ï¼ŒæœåŠ¡å™¨ä¸è·Ÿè¸ªæ¯ä¸ªå®¢æˆ·ç«¯ä¹Ÿä¸è®°å½•è¿‡å»çš„è¯·æ±‚ï¼ˆæ— çŠ¶æ€ï¼‰ã€‚ç„¶è€ŒTCPè¿æ¥çš„æ–°å»ºæˆæœ¬å¾ˆé«˜ï¼Œå› ä¸ºéœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸‰æ¬¡æ¡æ‰‹ï¼Œå¹¶ä¸”å¼€å§‹æ—¶å‘é€é€Ÿç‡è¾ƒæ…¢ï¼ˆslow startï¼‰ã€‚æ‰€ä»¥ï¼ŒHTTP 1.0ç‰ˆæœ¬çš„æ€§èƒ½æ¯”è¾ƒå·®ã€‚éšç€ç½‘é¡µåŠ è½½çš„å¤–éƒ¨èµ„æºè¶Šæ¥è¶Šå¤šï¼Œè¿™ä¸ªé—®é¢˜å°±æ„ˆå‘çªå‡ºäº†ã€‚ å…¶æ¬¡å°±æ˜¯é˜Ÿå¤´é˜»å¡ï¼ˆhead of line blockingï¼‰ã€‚ç”±äºHTTP1.0è§„å®šä¸‹ä¸€ä¸ªè¯·æ±‚å¿…é¡»åœ¨å‰ä¸€ä¸ªè¯·æ±‚å“åº”åˆ°è¾¾ä¹‹å‰æ‰èƒ½å‘é€ã€‚å‡è®¾å‰ä¸€ä¸ªè¯·æ±‚å“åº”ä¸€ç›´ä¸åˆ°è¾¾ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªè¯·æ±‚å°±ä¸å‘é€ï¼ŒåŒæ ·çš„åé¢çš„è¯·æ±‚ä¹Ÿç»™é˜»å¡äº†ã€‚ ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒHTTP1.1å‡ºç°äº†ã€‚ 2.3 HTTP/1.11997å¹´å…¬å¸ƒçš„HTTP/1.1æ˜¯ç›®å‰ä¸»æµçš„HTTPåè®®ç‰ˆæœ¬ã€‚ä¹‹å‰çš„æ ‡å‡†æ˜¯RFC2068ï¼Œä¹‹ååˆå‘å¸ƒäº†ä¿®è®¢ç‰ˆRFC2616ã€‚ è¿™ä¸ªæ—¶æœŸå¼€å§‹ï¼ŒHTTPåè®®å·²ç»æˆä¸ºäº†ä¸€ä»½æ­£å¼çš„æ ‡å‡†â€ï¼Œè€Œä¸æ˜¯ä¸€ä»½å¯æœ‰å¯æ— çš„â€œå‚è€ƒæ–‡æ¡£â€ã€‚è¿™æ„å‘³ç€ä»Šåäº’è”ç½‘ä¸Šæ‰€æœ‰çš„æµè§ˆå™¨ã€æœåŠ¡å™¨ã€ç½‘å…³ã€ä»£ç†ç­‰ç­‰ï¼Œåªè¦ç”¨åˆ° HTTP åè®®ï¼Œå°±å¿…é¡»ä¸¥æ ¼éµå®ˆè¿™ä¸ªæ ‡å‡†ï¼Œç›¸å½“äºæ˜¯äº’è”ç½‘ä¸–ç•Œçš„ä¸€ä¸ªâ€œç«‹æ³•â€ã€‚ HTTP/1.1çš„ç‰¹ç‚¹æœ‰ï¼š å¼•å…¥äº†æŒä¹…è¿æ¥ï¼ˆpersistent connectionï¼‰ï¼Œå³TCPè¿æ¥é»˜è®¤ä¸å…³é—­ï¼Œå¯ä»¥è¢«å¤šä¸ªè¯·æ±‚å¤ç”¨ï¼Œé»˜è®¤ä½¿ç”¨Connection: keep-aliveã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å‘ç°å¯¹æ–¹ä¸€æ®µæ—¶é—´æ²¡æœ‰æ´»åŠ¨ï¼Œå°±å¯ä»¥ä¸»åŠ¨å…³é—­è¿æ¥ã€‚ä¸è¿‡ï¼Œè§„èŒƒçš„åšæ³•æ˜¯ï¼Œå®¢æˆ·ç«¯åœ¨æœ€åä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå‘é€Connection: closeï¼Œæ˜ç¡®è¦æ±‚æœåŠ¡å™¨å…³é—­TCPè¿æ¥ å¼•å…¥äº†ç®¡é“æœºåˆ¶ï¼ˆpipeliningï¼‰ï¼Œå³åœ¨åŒä¸€ä¸ªTCPè¿æ¥é‡Œé¢ï¼Œå®¢æˆ·ç«¯å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚ã€‚è¿™æ ·å°±è¿›ä¸€æ­¥æ”¹è¿›äº†HTTPåè®®çš„æ•ˆç‡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæœåŠ¡å™¨å¿…é¡»æŒ‰ç…§å®¢æˆ·ç«¯è¯·æ±‚çš„å…ˆåé¡ºåºä¾æ¬¡å›é€ç›¸åº”çš„ç»“æœï¼Œä»¥ä¿è¯å®¢æˆ·ç«¯èƒ½å¤ŸåŒºåˆ†å‡ºæ¯æ¬¡è¯·æ±‚çš„å“åº”å†…å®¹ã€‚è€Œè¿™ä¸ªå“åº”è¿‡ç¨‹æ˜¯ä¸²è¡Œçš„ã€‚ æ–°å¢äº†è®¸å¤šåŠ¨è¯æ–¹æ³•ï¼šPUTã€PATCHã€HEADã€ OPTIONSã€DELETEã€‚å¦å¤–ï¼Œå®¢æˆ·ç«¯è¯·æ±‚çš„å¤´ä¿¡æ¯æ–°å¢äº†Hostå­—æ®µï¼Œç”¨æ¥æŒ‡å®šæœåŠ¡å™¨çš„åŸŸå å¢åŠ äº†ç¼“å­˜ç®¡ç†å’Œæ§åˆ¶ï¼› å…è®¸å“åº”æ•°æ®åˆ†å—ï¼ˆchunkedï¼‰ï¼Œåˆ©äºä¼ è¾“å¤§æ–‡ä»¶ã€‚å¯¹äºä¸€äº›å¾ˆè€—æ—¶çš„åŠ¨æ€æ“ä½œï¼ŒæœåŠ¡å™¨éœ€è¦ç­‰åˆ°æ‰€æœ‰æ“ä½œå®Œæˆï¼Œæ‰èƒ½å‘é€æ•°æ®ï¼Œæ˜¾ç„¶è¿™æ ·çš„æ•ˆç‡ä¸é«˜ã€‚æ›´å¥½çš„å¤„ç†æ–¹æ³•æ˜¯ï¼Œäº§ç”Ÿä¸€å—æ•°æ®ï¼Œå°±å‘é€ä¸€å—ï¼Œé‡‡ç”¨â€æµæ¨¡å¼â€ï¼ˆstreamï¼‰å–ä»£â€ç¼“å­˜æ¨¡å¼â€ï¼ˆbufferï¼‰ å¼ºåˆ¶è¦æ±‚ Host å¤´ï¼Œè®©äº’è”ç½‘ä¸»æœºæ‰˜ç®¡æˆä¸ºå¯èƒ½ã€‚ æä¾›äº†èŒƒå›´è¯·æ±‚åŠŸèƒ½(å®½å¸¦ä¼˜åŒ–)ï¼šHTTP1.0ä¸­ï¼Œå­˜åœ¨ä¸€äº›æµªè´¹å¸¦å®½çš„ç°è±¡ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯åªæ˜¯éœ€è¦æŸä¸ªå¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œè€ŒæœåŠ¡å™¨å´å°†æ•´ä¸ªå¯¹è±¡é€è¿‡æ¥äº†ï¼Œå¹¶ä¸”ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ åŠŸèƒ½ï¼ŒHTTP1.1åˆ™åœ¨è¯·æ±‚å¤´å¼•å…¥äº†rangeå¤´åŸŸï¼Œå®ƒå…è®¸åªè¯·æ±‚èµ„æºçš„æŸä¸ªéƒ¨åˆ†ï¼Œå³è¿”å›ç æ˜¯206ï¼ˆPartial Contentï¼‰ï¼Œè¿™æ ·å°±æ–¹ä¾¿äº†å¼€å‘è€…è‡ªç”±çš„é€‰æ‹©ä»¥ä¾¿äºå……åˆ†åˆ©ç”¨å¸¦å®½å’Œè¿æ¥ã€‚è¿™æ˜¯æ”¯æŒæ–‡ä»¶æ–­ç‚¹ç»­ä¼ çš„åŸºç¡€ã€‚ HTTP/1.1çš„ä¸è¶³ï¼š è™½ç„¶1.1ç‰ˆå…è®¸å¤ç”¨TCPè¿æ¥ï¼Œä½†é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ä»å­˜åœ¨ï¼ŒæœåŠ¡å™¨åªæœ‰å¤„ç†å®Œä¸€ä¸ªå›åº”ï¼Œæ‰ä¼šè¿›è¡Œä¸‹ä¸€ä¸ªå›åº”ã€‚è¦æ˜¯å‰é¢çš„å›åº”ç‰¹åˆ«æ…¢ï¼Œåé¢å°±ä¼šæœ‰è®¸å¤šè¯·æ±‚æ’é˜Ÿç­‰ç€ã€‚ ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œåªæœ‰ä¸¤ç§æ–¹æ³•ï¼šä¸€æ˜¯å‡å°‘è¯·æ±‚æ•°ï¼ŒäºŒæ˜¯åŒæ—¶å¤šå¼€æŒä¹…è¿æ¥ï¼ˆå¹¶å‘è¿æ¥ï¼‰ã€‚è¿™å¯¼è‡´äº†å¾ˆå¤šçš„ç½‘é¡µä¼˜åŒ–æŠ€å·§ï¼Œæ¯”å¦‚åˆå¹¶è„šæœ¬å’Œæ ·å¼è¡¨ã€å°†å›¾ç‰‡åµŒå…¥CSSä»£ç ã€åŸŸååˆ†ç‰‡ï¼ˆdomain shardingï¼‰ç­‰ç­‰ã€‚å¦‚æœHTTPåè®®è®¾è®¡å¾—æ›´å¥½ä¸€äº›ï¼Œè¿™äº›é¢å¤–çš„å·¥ä½œæ˜¯å¯ä»¥é¿å…çš„ã€‚ 2.4 SPDYåè®®ä¸HTTP/2HTTP/1.1æ ‡å‡†æ•°åå¹´æ²¡æœ‰æ›´æ–°ï¼Œè€Œä¸ºäº†è§£å†³å¯¹é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ï¼Œåªèƒ½ä½¿ç”¨åˆ‡å›¾ã€JS åˆå¹¶ç­‰ç½‘é¡µä¼˜åŒ–æ‰‹æ®µã€‚ Google å¯¹æ­¤è¡¨ç¤ºä¸æ»¡ï¼Œå¹¶ç€æ‰‹è‡´åŠ›æ”¹è¿›HTTP/1.1åè®®ã€‚é¦–å…ˆå¼€å‘äº†è‡ªå·±çš„æµè§ˆå™¨ Chromeï¼Œç„¶åæ¨å‡ºäº†æ–°çš„ SPDY ï¼ˆè¯»ä½œSPeeDYï¼‰åè®®ï¼Œå¹¶åœ¨ Chrome é‡Œåº”ç”¨äºè‡ªå®¶çš„æœåŠ¡å™¨ã€‚SPDY æ²¡æœ‰å®Œå…¨æ”¹å†™ HTTP åè®®ï¼Œè€Œæ˜¯åœ¨ TCP/IP çš„åº”ç”¨å±‚ä¸è¿è¾“å±‚ä¹‹é—´é€šè¿‡æ–°åŠ ä¼šè¯å±‚çš„å½¢å¼è¿ä½œã€‚åŒæ—¶ï¼Œè€ƒè™‘åˆ°å®‰å…¨æ€§é—®é¢˜ï¼ŒSPDY è§„å®šé€šä¿¡ä¸­ä½¿ç”¨ SSLã€‚ åæ¥éšç€Chromeåæ¥æ—¥è¶‹å¢é«˜çš„ç”¨æˆ·å æœ‰ç‡ï¼ŒSPDYä¹Ÿæˆä¸ºäº†ä¸»æµçš„åè®®ï¼Œç»ˆäºï¼Œäº’è”ç½‘æ ‡å‡†åŒ–ç»„ç»‡å¿ä¸ä½äº†ï¼Œå¼€å§‹ä»¥ SPDY ä¸ºåŸºç¡€åˆ¶å®šæ–°ç‰ˆæœ¬çš„ HTTP åè®®ï¼Œæœ€ç»ˆåœ¨ 2015 å¹´å‘å¸ƒäº† HTTP/2ï¼ŒRFC ç¼–å· 7540ã€‚å®ƒä¸å« HTTP/2.0ï¼Œæ˜¯å› ä¸ºæ ‡å‡†å§”å‘˜ä¼šä¸æ‰“ç®—å†å‘å¸ƒå­ç‰ˆæœ¬äº†ï¼Œä¸‹ä¸€ä¸ªæ–°ç‰ˆæœ¬å°†æ˜¯ HTTP/3ã€‚ æˆ‘æŸ¥é˜…è¿™éƒ¨åˆ†èµ„æ–™çš„æ—¶å€™ï¼Œç¿»åˆ°äº†æ•°åå¹´å‰çš„ä¸€æ¡æ–°é—»ï¼Œç°åœ¨çœ‹è¿˜æŒºæœ‰æ„æ€çš„ï¼š Googleæ­£åˆ¶è®¢ä¸€é¡¹æ–°åè®®ï¼Œæ—¨åœ¨æ›¿æ¢æ‰HTTP - InfoQ SPDYçš„åŸºæœ¬ç‰¹å¾ï¼š å¤šè·¯å¤ç”¨æµï¼šSPDYå…è®¸åœ¨ä¸€ä¸ªè¿æ¥ä¸Šæ— é™åˆ¶å¹¶å‘æµã€‚å› ä¸ºè¯·æ±‚åœ¨ä¸€ä¸ªé€šé“ä¸Šï¼ŒTCPæ•ˆç‡æ›´é«˜ï¼šæ›´å°‘çš„ç½‘ç»œè¿æ¥ï¼Œå‘å‡ºæ›´å°‘æ›´å¯†é›†çš„æ•°æ®åŒ…ã€‚ è¯·æ±‚ä¼˜å…ˆçº§ï¼šè™½ç„¶æ— é™çš„å¹¶å‘æµè§£å†³äº†åºåˆ—åŒ–çš„é—®é¢˜ï¼Œä½†ä»–ä»¬å¼•å…¥äº†å¦ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœå¸¦å®½é€šé“å—é™åˆ¶ï¼Œ å®¢æˆ·ç«¯å¯èƒ½ä¼šå› é˜²æ­¢å µå¡é€šé“è€Œé˜»æ­¢è¯·æ±‚ã€‚ä¸ºäº†å…‹æœè¿™ä¸ªé—®é¢˜ï¼ŒSPDYå®è¡Œè¯·æ±‚ä¼˜å…ˆçº§ï¼šå®¢æˆ·ç«¯ä»æœåŠ¡å™¨ç«¯è¯·æ±‚å®ƒå¸Œæœ›çš„é¡¹ç›®æ•°é‡ï¼Œå¹¶ä¸ºæ¯ä¸ªè¯·æ±‚åˆ†é…ä¸€ä¸ªä¼˜å…ˆçº§ã€‚è¿™å¯ä»¥é˜²æ­¢åœ¨ç½‘ç»œé€šé“è¢«éå…³é”®èµ„æºå µå¡æ—¶ï¼Œé«˜ä¼˜å…ˆçº§çš„è¯·æ±‚è¢«æŒ‚èµ·ã€‚ HTTPæŠ¥å¤´å‹ç¼©ï¼šSPDYå‹ç¼©è¯·æ±‚å’Œå“åº”HTTPæŠ¥å¤´ï¼Œä»è€Œå‡å°‘ä¼ è¾“çš„æ•°æ®åŒ…æ•°é‡å’Œå­—èŠ‚æ•°ã€‚ æ¨é€åŠŸèƒ½ï¼šæ”¯æŒæœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®çš„åŠŸèƒ½ã€‚è¿™æ ·ï¼ŒæœåŠ¡å™¨å¯ç›´æ¥å‘é€æ•°æ®ï¼Œè€Œä¸å¿…ç­‰å¾…å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚ åŸºäºSPDYçš„HTTP2.0çš„ç‰¹ç‚¹ï¼š äºŒè¿›åˆ¶åè®®ï¼Œä¸å†æ˜¯çº¯æ–‡æœ¬ å¯å‘èµ·å¤šä¸ªè¯·æ±‚ï¼ŒåºŸå¼ƒäº† 1.1 é‡Œçš„ç®¡é“ï¼ˆå¤šè·¯å¤ç”¨ï¼‰ ä½¿ç”¨ä¸“ç”¨ç®—æ³•å‹ç¼©å¤´éƒ¨ï¼Œå‡å°‘æ•°æ®ä¼ è¾“é‡ å…è®¸æœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ï¼ˆå’Œwebsocketæœ‰ç‚¹ä¸ä¸€æ ·ï¼Œå®ƒç±»ä¼¼äºé¢„æµ‹ç”¨æˆ·è¦ç”¨åˆ°ä»€ä¹ˆæ•°æ®ï¼Œæå‰æ¨é€ç»™å®¢æˆ·ç«¯ï¼‰ å¢å¼ºäº†å®‰å…¨æ€§ï¼Œâ€œäº‹å®ä¸Šâ€è¦æ±‚åŠ å¯†é€šä¿¡ å› ä¸º HTTP/2 çš„æ•°æ®åŒ…æ˜¯ä¸æŒ‰é¡ºåºå‘é€çš„ï¼ŒåŒä¸€ä¸ªè¿æ¥é‡Œé¢è¿ç»­çš„æ•°æ®åŒ…ï¼Œå¯èƒ½å±äºä¸åŒçš„å›åº”ã€‚å› æ­¤ï¼Œå¿…é¡»è¦å¯¹æ•°æ®åŒ…åšæ ‡è®°ï¼ŒæŒ‡å‡ºå®ƒå±äºå“ªä¸ªå›åº”ã€‚ 2.5 QUICåè®®ä¸HTTP/3HTTP 2.0 è™½ç„¶å¤§å¤§å¢åŠ äº†å¹¶å‘æ€§ï¼Œä½†è¿˜æ˜¯æœ‰é—®é¢˜çš„ã€‚å› ä¸º HTTP 2.0 ä¹Ÿæ˜¯åŸºäº TCP åè®®çš„ï¼ŒTCP åè®®åœ¨å¤„ç†åŒ…æ—¶æ˜¯æœ‰ä¸¥æ ¼é¡ºåºçš„ã€‚å½“å…¶ä¸­ä¸€ä¸ªæ•°æ®åŒ…é‡åˆ°é—®é¢˜ï¼ŒTCP è¿æ¥éœ€è¦ç­‰å¾…è¿™ä¸ªåŒ…å®Œæˆé‡ä¼ ä¹‹åæ‰èƒ½ç»§ç»­è¿›è¡Œã€‚è™½ç„¶ HTTP 2.0 é€šè¿‡å¤šä¸ª streamï¼Œä½¿å¾—é€»è¾‘ä¸Šä¸€ä¸ª TCP è¿æ¥ä¸Šçš„å¹¶è¡Œå†…å®¹ï¼Œè¿›è¡Œå¤šè·¯æ•°æ®çš„ä¼ è¾“ï¼Œç„¶è€Œè¿™ä¸­é—´å¹¶æ²¡æœ‰å…³è”çš„æ•°æ®ã€‚ä¸€å‰ä¸€åï¼Œå‰é¢ stream 2 çš„å¸§æ²¡æœ‰æ”¶åˆ°ï¼Œåé¢ stream 1 çš„å¸§ä¹Ÿä¼šå› æ­¤é˜»å¡ï¼Œè¯´åˆ°åº•è¿™æ˜¯TCPçš„å›ºæœ‰é—®é¢˜ã€‚ äºæ˜¯Googleåˆä½œå¦–äº†ï¼Œç€æ‰‹ç ”å‘QUICåè®®ã€‚QUIC æ˜¯ Quick UDP Internet Connections çš„ç¼©å†™ï¼Œåœ¨å¤§æ¦‚2014å¹´çš„æ—¶å€™é¢ä¸–ï¼Œå®ƒæ”¹é€ äº†UDPåè®®ï¼Œé€šè¿‡UDPæ— è¿æ¥çš„ç‰¹æ€§å‡å°ä¼ è¾“å»¶è¿Ÿï¼Œä½†æ”¹è¿›å’Œå®ç°äº†éƒ¨åˆ†TCPçš„åŠŸèƒ½ï¼Œä¾‹å¦‚å¯é ä¼ è¾“ã€‚å®ƒå’ŒUDPä¸€æ ·æ˜¯ä¸€ä¸ªä¼ è¾“å±‚çš„åè®®ï¼Œåœ¨è¿™ç§åè®®ä¹‹ä¸Šå»ºç«‹çš„HTTPåè®®ç§°ä¸ºHTTP over QUIC HTTP over QUIC ç›¸æ¯”ç°åœ¨å¹¿æ³›åº”ç”¨çš„ http2+tcp+tls åè®®æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š å‡å°‘äº† TCP ä¸‰æ¬¡æ¡æ‰‹åŠ TLS æ¡æ‰‹æ—¶é—´ æ”¹è¿›çš„æ‹¥å¡æ§åˆ¶ é¿å…é˜Ÿå¤´é˜»å¡çš„å¤šè·¯å¤ç”¨ è¿æ¥è¿ç§» å‰å‘å†—ä½™çº é”™ è¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»Quicäº†ï¼Œå®é™…ä¸Šè‡ªå®šä¹‰UDPå®ç°TCPçš„åŠŸèƒ½çš„åœºæ™¯å¹¶ä¸å°‘è§ï¼Œè¿™é‡Œé¢ç‰µæ‰¯åˆ°è‡ªå®šä¹‰è¿æ¥æœºåˆ¶ã€è‡ªå®šä¹‰é‡ä¼ æœºåˆ¶ã€è‡ªå®šä¹‰æµé‡æ§åˆ¶ã€è‡ªå®šä¹‰æ‹¥å¡æ§åˆ¶ç­‰å®ç°ã€‚ 2018 å¹´ï¼Œäº’è”ç½‘æ ‡å‡†åŒ–ç»„ç»‡ IETF æè®®å°†â€œHTTP over QUICâ€æ›´åä¸ºâ€œHTTP/3â€å¹¶è·å¾—æ‰¹å‡†ï¼ŒHTTP/3 æ­£å¼è¿›å…¥äº†æ ‡å‡†åŒ–åˆ¶è®¢é˜¶æ®µï¼Œä¹Ÿè®¸ä¸¤ä¸‰å¹´åå°±ä¼šæ­£å¼å‘å¸ƒï¼Œåˆ°æ—¶å€™æˆ‘ä»¬å¾ˆå¯èƒ½ä¼šè·³è¿‡ HTTP/2 ç›´æ¥è¿›å…¥ HTTP/3ã€‚ï¼ˆæŒæ€€ç–‘æ€åº¦ï¼‰","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","permalink":"https://www.codetool.top/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"},{"name":"HTTP","slug":"HTTP","permalink":"https://www.codetool.top/tags/HTTP/"}]},{"title":"leetcode343-æ•´æ•°æ‹†åˆ†","slug":"leetcode343-æ•´æ•°æ‹†åˆ†","date":"2020-04-13T05:22:56.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode343-æ•´æ•°æ‹†åˆ†/","link":"","permalink":"https://www.codetool.top/article/leetcode343-%E6%95%B4%E6%95%B0%E6%8B%86%E5%88%86/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ­£æ•´æ•° nï¼Œå°†å…¶æ‹†åˆ†ä¸ºè‡³å°‘ä¸¤ä¸ªæ­£æ•´æ•°çš„å’Œï¼Œå¹¶ä½¿è¿™äº›æ•´æ•°çš„ä¹˜ç§¯æœ€å¤§åŒ–ã€‚ è¿”å›ä½ å¯ä»¥è·å¾—çš„æœ€å¤§ä¹˜ç§¯ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: 2è¾“å‡º: 1è§£é‡Š: 2 = 1 + 1, 1 Ã— 1 = 1ã€‚ ç¤ºä¾‹ 2: è¾“å…¥: 10è¾“å‡º: 36è§£é‡Š: 10 = 3 + 3 + 4, 3 Ã— 3 Ã— 4 = 36ã€‚ è¯´æ˜: ä½ å¯ä»¥å‡è®¾ n ä¸å°äº 2 ä¸”ä¸å¤§äº 58ã€‚ 2 è§£æ³•2.1 æ€æƒ³æˆ‘æ„Ÿè§‰æˆ‘å†™çš„åŠ¨æ€è§„åˆ’è¿˜æŒºæš´åŠ›çš„ã€‚ã€‚ã€‚æ²¡çœ‹æ‡‚åˆ«äººçš„åŠ¨æ€è§„åˆ’ï¼Œæˆ‘çœ‹åˆ«äººå°±ä¸¤ä¸‰è¡Œå†™å®Œäº†QAQæˆ‘ç¡®å®8å¤ªè¡Œ 2.2 ä»£ç class Solution { Integer[][] matrix; public int integerBreak(int n) { int max = 0; matrix = new Integer[n+1][n+1]; int cache; for(int i = 2;i&lt;=n;i++){ if((cache = maxMult(n,i)) > max) max = cache; } return max; } public int maxMult(int num,int n){ if(n == 1) return num; if(n == 2){ return (num/2)*((num+1)/2); }else{ if(matrix[num][n]!=null) return matrix[num][n]; int max = 0; for(int i = n-1;i&lt;num;i++){ int cache; if((cache = maxMult(i,n-1)*(num-i)) > max) max = cache; } matrix[num][n] = max; return max; } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"è®¡ç½‘å¤ä¹ 05-ä¼ è¾“å±‚","slug":"è®¡ç½‘å¤ä¹ 05-ä¼ è¾“å±‚","date":"2020-04-12T08:20:25.000Z","updated":"2020-04-13T08:38:19.942Z","comments":true,"path":"article/è®¡ç½‘å¤ä¹ 05-ä¼ è¾“å±‚/","link":"","permalink":"https://www.codetool.top/article/%E8%AE%A1%E7%BD%91%E5%A4%8D%E4%B9%A005-%E4%BC%A0%E8%BE%93%E5%B1%82/","excerpt":"","text":"è¿™é‡Œçš„ä¼ è¾“å±‚æŒ‡çš„æ˜¯åŸç†ä½“ç³»ç»“æ„çš„ä¼ è¾“å±‚ï¼Œå¯¹åº”OSIä¸ƒå±‚ä½“ç³»ç»“æ„ä¸­çš„ä¼ è¾“å±‚ï¼Œå¯¹åº”TCP/IPå››å±‚ä½“ç³»ç»“æ„ä¸­çš„ä¼ è¾“å±‚ã€‚å®ƒä¸ºåº”ç”¨å±‚æä¾›æœåŠ¡ã€‚ 1 ä¼ è¾“å±‚åè®®æ¦‚è¿° 1.1 å¤ç”¨å’Œåˆ†ç”¨å› ä¸ºåœ¨ä¸€å°ä¸»æœºä¸­ç»å¸¸æœ‰å¤šä¸ªåº”ç”¨è¿›ç¨‹åŒæ—¶åˆ†åˆ«å’Œå¦ä¸€å°ä¸»æœºä¸­çš„å¤šä¸ªåº”ç”¨è¿›ç¨‹é€šä¿¡ã€‚è¿™è¡¨æ˜è¿è¾“å±‚æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½â€”â€”å¤ç”¨ (multiplexing)å’Œåˆ†ç”¨ (demultiplexing)ã€‚ åº”ç”¨å±‚-&gt;ä¼ è¾“å±‚åŸºäºç«¯å£çš„TCP/UDPå¤ç”¨ï¼Œæ•´åˆä¸ºTCPæŠ¥æ–‡æ®µ/UDPç”¨æˆ·æ•°æ®æŠ¥ã€‚ä¼ è¾“å±‚-&gt;ç½‘ç»œå±‚æ˜¯IPå¤ç”¨ï¼Œæ•´åˆä¸ºIPæ•°æ®æŠ¥ã€‚åœ¨æ¥æ”¶ç«¯è¿›è¡Œåˆ†ç”¨å¤„ç†ã€‚ 2 ç”¨æˆ·æ•°æ®æŠ¥åè®®UDP UDPåªåœ¨IPæ•°æ®æŠ¥æœåŠ¡ä¹‹ä¸Šå¢åŠ äº†å¾ˆå°‘åŠŸèƒ½ï¼Œå³å¤ç”¨åˆ†ç”¨å’Œå·®é”™æ£€æµ‹åŠŸèƒ½ã€‚ 2.1 UDPçš„ä¸»è¦ç‰¹ç‚¹ UDPæ˜¯æ— è¿æ¥çš„ï¼Œå‡å°‘å¼€é”€å’Œå‘é€æ•°æ®ä¹‹å‰çš„æ—¶å»¶ã€‚ UDPä½¿ç”¨æœ€å¤§åŠªåŠ›äº¤ä»˜ï¼Œå³ä¸ä¿è¯å¯é äº¤ä»˜ã€‚ UDPæ˜¯é¢å‘æŠ¥æ–‡çš„ï¼Œé€‚åˆä¸€æ¬¡æ€§ä¼ è¾“å°‘é‡æ•°æ®çš„ç½‘ç»œåº”ç”¨ã€‚ UDPæ— æ‹¥å¡æ§åˆ¶ï¼Œé€‚åˆå¾ˆå¤šå®æ—¶åº”ç”¨ã€‚ UDPçš„é¦–éƒ¨å¼€é”€å°ï¼Œåªæœ‰å…«å­—èŠ‚ 2.2 UDPçš„æŠ¥æ–‡æ ¼å¼ æºç«¯å£å·æ˜¯å¯æœ‰å¯æ— çš„ï¼ˆå¦‚æœæ²¡æœ‰æƒ³æ”¶åˆ°å›å¤çš„éœ€æ±‚ï¼‰ï¼Œå¯ä»¥å¡«å†™å…¨0ã€‚ åˆ†ç”¨æ—¶ï¼Œæ‰¾ä¸åˆ°å¯¹åº”çš„ç›®çš„ç«¯å£å·ï¼Œå°±ä¸¢å¼ƒæŠ¥æ–‡ï¼Œå¹¶ç»™å‘é€æ–¹å‘é€ICMPâ€œç«¯å£ä¸å¯è¾¾â€å·®é”™æŠ¥å‘ŠæŠ¥æ–‡ã€‚ 2.2.1 æ ¡éªŒå’Œçš„è®¡ç®— è®¡ç®—æ ¡éªŒå’Œæ—¶ï¼Œä¼šå…ˆæŠ½è±¡å‡ºä¸€ä¸ªâ€œä¼ªé¦–éƒ¨â€ï¼Œä»IPæ•°æ®æŠ¥çš„é¦–éƒ¨è·å–ä¿¡æ¯ã€‚ ä¼ªé¦–éƒ¨åªæœ‰åœ¨è®¡ç®—æ£€éªŒå’Œæ—¶æ‰å‡ºç°ï¼Œä¸å‘ä¸‹ä¼ é€ä¹Ÿä¸å‘ä¸Šé€’äº¤ã€‚ åœ¨è®¡ç®—æ ¡éªŒå’Œæ—¶ï¼Œå°†æ¯ç»„å¯¹é½çš„2å­—èŠ‚å¯¹åº”çš„16ä½ç›¸åŠ ï¼Œå¾—åˆ°çš„ç»“æœæ±‚åç ã€‚è¿™æ ·å°±äº§ç”Ÿäº†æ ¡éªŒç ï¼Œå‘é€ç«¯å°†å®ƒå¡«å…¥ã€‚ æ¥æ”¶ç«¯çš„éªŒè¯ä¹Ÿæ˜¯å°†å°†æ¯ç»„å¯¹é½çš„2å­—èŠ‚å¯¹åº”çš„16ä½ç›¸åŠ ï¼Œå¾—åˆ°çš„ç»“æœæ±‚åç ï¼Œè‹¥å…¨ä¸º1è¯´æ˜æ ¡éªŒé€šè¿‡ï¼Œå¦åˆ™è¯´æ˜å‡ºé”™ã€‚ 3 ä¼ è¾“æ§åˆ¶åè®®TCP å‘é€ç¼“å­˜ï¼šå‡†å¤‡å‘é€çš„æ•°å’Œå·²å‘é€ä½†å°šæœªæ”¶åˆ°ç¡®è®¤çš„æ•°æ® æ¥æ”¶ç¼“å­˜ï¼šæŒ‰åºåˆ°è¾¾ä½†å°šæœªè¢«æ¥å—åº”ç”¨ç¨‹åºè¯»å–çš„æ•°æ®å’Œä¸æŒ‰åºåˆ°è¾¾çš„æ•°æ® 4 å¯é ä¼ è¾“çš„å·¥ä½œåŸç† è¿™éƒ¨åˆ†çš„åè®®æˆ‘ç”¨åˆ°çš„æ•°æ®å•ä½æ˜¯â€œå¸§â€ï¼Œæ˜¯å› ä¸ºè¿™éƒ¨åˆ†ä¹Ÿå¯ä»¥ç”±æ•°æ®é“¾è·¯å±‚æ¥æ§åˆ¶ï¼Œä¼ è¾“å±‚çš„æ€æƒ³ä¸å…¶ä¸€è‡´ã€‚ 4.1 åœæ­¢-ç­‰å¾…åè®®ä¸ºä»€ä¹ˆè¦æœ‰åœæ­¢ç­‰å¾…åè®®? é™¤äº†æ¯”ç‰¹å‡ºå·®é”™ï¼Œåº•å±‚ä¿¡é“è¿˜ä¼šå‡ºç°ä¸¢åŒ…é—®é¢˜ã€‚ ä¸ºäº†å®ç°æµé‡æ§åˆ¶ã€‚ æ¯å‘é€å®Œä¸€ä¸ªå¸§å°±åœæ­¢å‘é€ï¼Œç­‰å¾…å¯¹æ–¹çš„ç¡®è®¤ï¼Œåœ¨æ”¶åˆ°ç¡®è®¤åå†å‘é€ä¸‹ä¸€ä¸ªå¸§ã€‚åœæ­¢ç­‰å¾…åè®®æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ»‘åŠ¨çª—å£åè®®ã€‚ å¦‚æœæœªæ”¶åˆ°ç¡®è®¤ï¼Œå°±è¦æœ‰è¶…æ—¶é‡ä¼ æœºåˆ¶ï¼Œé€šå¸¸è¿™ä¸ªè¶…æ—¶æ—¶é—´æ¯”å¹³å‡RTTæ›´é•¿ä¸€äº›ï¼Œå¦‚æœè¶…æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°æ¥æ”¶æ–¹å‘æ¥çš„ç¡®è®¤å¸§ï¼Œå°±é‡æ–°å‘é€ä¸€æ¬¡ä¸Šä¸€å¸§ã€‚ å‘é€å¸§å’Œç¡®è®¤å¸§éƒ½æœ‰ç¼–å·ï¼Œè¿™æ ·å³ä½¿å¸§é‡å¤ï¼Œæ¥æ”¶æ–¹ä¹Ÿèƒ½çŸ¥é“æ˜¯æ”¶åˆ°äº†é‡å¤å¸§ã€‚ åœæ­¢ç­‰å¾…åè®®ï¼šå‘é€çª—å£å¤§å°=1ï¼Œæ¥æ”¶çª—å£å¤§å°=1; åé€€Nå¸§åè®®(GBN)ï¼šå‘é€çª—å£å¤§å°&gt;1ï¼Œ æ¥æ”¶çª—å£å¤§å°=1: é€‰æ‹©é‡ä¼ åè®®(SR)ï¼šå‘é€çª—å£å¤§å°&gt;1ï¼Œæ¥æ”¶çª—å£å¤§å°&gt;1; 4.2 æ»‘åŠ¨çª—å£åè®®4.2.1 åé€€Nå¸§åè®®ï¼ˆGBNï¼‰ å‘é€æ–¹æœ‰ä¸€ä¸ªå‘é€çª—å£ï¼Œæ¥æ”¶æ–¹æœ‰ä¸€ä¸ªæ¥æ”¶çª—å£ï¼ˆå¤§å°ä¸º1ï¼‰ï¼Œå‘é€æ–¹å¯ä»¥å‘å‡ºå‘é€çª—å£èŒƒå›´å†…å…è®¸çš„å‘å‡ºçš„å¸§ï¼Œå½“æ¥æ”¶æ–¹æ”¶åˆ°ä¸€å¸§ä¹‹åï¼Œæ¥æ”¶çª—å£å‘åæ»‘åŠ¨ä¸€æ ¼ï¼Œå“åº”ä¸€ä¸ªç¡®è®¤å¸§ï¼Œå‘é€æ–¹æ”¶åˆ°ç¡®è®¤å¸§ä¹‹åå°†å‘é€çª—å£ä¹Ÿå‘åæ»‘åŠ¨ä¸€æ ¼ã€‚ å¯¹äºå‘é€çª—å£å†…çš„å‘é€å¸§éƒ½è¦æœ‰å¤‡ä»½ï¼Œä¸ºäº†è¶…æ—¶é‡ä¼ ã€‚å‘é€å¸§å’Œç¡®è®¤å¸§éƒ½è¦æœ‰ç¼–å·ï¼Œä¸ºäº†åŒºåˆ«ä¼ é€ä¸­å‘ç”Ÿçš„é”™è¯¯ã€‚ å¦‚æœæ¥æ”¶æ–¹æ”¶åˆ°äº†ç¼–å·ä¸è¿ç»­çš„å¸§ï¼Œè¯´æ˜ä¸­é€”å‘ç”Ÿäº†å¸§ä¸¢å¤±ï¼Œé‚£ä¹ˆä»æ­¤åˆ»å¼€å§‹ï¼Œå°†æ‰€æœ‰æ¥æ”¶åˆ°çš„çš„å¸§ä¸¢å¼ƒï¼Œåªå“åº”ä¸Šä¸€ä¸ªè¿ç»­å¸§åºåˆ—ä¸­æœ€åä¸€ä¸ªå¸§çš„ç¼–å·å¯¹åº”çš„ç¡®è®¤å¸§ï¼Œç›´åˆ°å†æ¬¡æ”¶åˆ°èƒ½å½¢æˆè¿ç»­ç¼–å·çš„å¸§ã€‚ è‹¥é‡‡ç”¨nä¸ªæ¯”ç‰¹å¯¹å¸§ç¼–å·ï¼Œé‚£ä¹ˆå‘é€çª—å£çš„å°ºå¯¸WTåº”æ»¡è¶³: 1â‰¤WTâ‰¤2n-1ã€‚å› ä¸ºå‘é€çª—å£å°ºå¯¸è¿‡å¤§ï¼Œå°±ä¼šä½¿å¾—æ¥æ”¶æ–¹æ— æ³•åŒºåˆ«æ–°å¸§å’Œæ—§å¸§ã€‚ 4.2.2 é€‰æ‹©é‡ä¼ åè®®ï¼ˆSRï¼‰é€‰æ‹©é‡ä¼ åè®®çš„å‘é€çª—å£å¤§å°å’Œæ¥æ”¶çª—å£å¤§å°å‡å¤§äº1ã€‚ å‘é€çª—å£å†…æŸä¸ªå¸§çš„è¶…æ—¶æ—¶é—´ä¸€è¿‡è¿˜æ²¡æ”¶åˆ°ç¡®è®¤çš„ï¼Œå°±è¿›è¡Œé‡ä¼ ã€‚ä¸€æ—¦å‘é€çª—å£å·¦ä¾§æœ‰è¿ç»­è¢«ç¡®è®¤çš„å‘é€å¸§ï¼Œå°±è¿›è¡Œæ»‘åŠ¨ï¼Œæ»‘åŠ¨åˆ°å…·æœ‰æœ€å°åºå·çš„æœªç¡®è®¤å¸§å¤„ã€‚ æ¥æ”¶æ–¹å¹¶ä¸è¦æ±‚æ¥æ”¶çš„å¸§æ˜¯é¡ºåºçš„ï¼Œåªè¦æ˜¯åœ¨æ¥æ”¶çª—å£å†…çš„å¸§åºå·å°±æ¥æ”¶ã€‚ å‘é€çª—å£æœ€å¥½ç­‰äºæ¥æ”¶çª—å£ï¼Œä¸å¤§äº2n-1ã€‚ 4.3 TCPæŠ¥æ–‡æ ¼å¼ åºå·ï¼šåœ¨ä¸€ä¸ªTCPè¿æ¥ä¸­ä¼ é€çš„å­—èŠ‚æµä¸­çš„æ¯ä¸€ä¸ªå­—èŠ‚éƒ½æŒ‰é¡ºåºç¼–å·ï¼Œæœ¬å­—æ®µè¡¨ç¤ºæœ¬æŠ¥æ–‡æ®µæ‰€å‘é€æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚ ç¡®è®¤å·ï¼šæœŸæœ›æ”¶åˆ°å¯¹æ–¹ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„ç¬¬ä¸€ä¸ªæ•°æ®å­—èŠ‚çš„åºå·ã€‚è‹¥ç¡®è®¤å·ä¸ºN,åˆ™è¯æ˜åˆ°åºå·N-1ä¸ºæ­¢çš„æ‰€æœ‰æ•°æ®éƒ½å·²æ­£ç¡®æ”¶åˆ°ã€‚ æ•°æ®åç§»(é¦–éƒ¨é•¿åº¦) : TCPæŠ¥æ–‡æ®µçš„æ•°æ®èµ·å§‹å¤„è·ç¦»TCPæŠ¥æ–‡æ®µçš„èµ·å§‹å¤„æœ‰å¤šè¿œï¼Œä»¥4Bä¸ºå•ä½ï¼Œå³1ä¸ªæ•°å€¼æ˜¯4Bã€‚ å…­ä¸ªæ§åˆ¶ä½ï¼š ç´§æ€¥ä½URG: URG=1æ—¶ï¼Œ æ ‡æ˜æ­¤æŠ¥æ–‡æ®µä¸­æœ‰ç´§æ€¥æ•°æ®ï¼Œæ˜¯é«˜ä¼˜å…ˆçº§çš„æ•°æ®ï¼Œåº”å°½å¿«ä¼ é€ï¼Œä¸ç”¨åœ¨ç¼“å­˜é‡Œæ’é˜Ÿï¼Œé…åˆç´§æ€¥æŒ‡é’ˆå­—æ®µä½¿ç”¨ã€‚ ç¡®è®¤ä½ACK: ACK=1æ—¶ç¡®è®¤å·æœ‰æ•ˆï¼Œ åœ¨è¿æ¥å»ºç«‹åæ‰€æœ‰ä¼ é€çš„æŠ¥æ–‡æ®µéƒ½å¿…é¡»æŠŠACKç½®ä¸º1ã€‚ æ¨é€ä½PSH: PSH=1æ—¶ï¼Œæ¥æ”¶æ–¹å°½å¿«äº¤ä»˜æ¥æ”¶åº”ç”¨è¿›ç¨‹ï¼Œä¸å†ç­‰åˆ°ç¼“å­˜å¡«æ»¡å†å‘ä¸Šäº¤ä»˜ã€‚ å¤ä½RST: RST=1æ—¶ï¼Œ è¡¨æ˜TCPè¿æ¥ä¸­å‡ºç°ä¸¥é‡å·®é”™ï¼Œå¿…é¡»é‡Šæ”¾è¿æ¥ï¼Œç„¶åå†é‡æ–°å»ºç«‹ä¼ è¾“é“¾æ¥ã€‚ åŒæ­¥ä½SYN: SYN=1æ—¶ï¼Œ è¡¨æ˜æ˜¯ä¸€ä¸ªè¿æ¥è¯·æ±‚/è¿æ¥æ¥å—æŠ¥æ–‡ã€‚ ç»ˆæ­¢ä½FIN: FIN=1æ—¶ï¼Œ è¡¨æ˜æ­¤æŠ¥æ–‡æ®µå‘é€æ–¹æ•°æ®å·²å‘å®Œï¼Œè¦æ±‚é‡Šæ”¾è¿æ¥ã€‚ çª—å£ï¼šæŒ‡çš„æ˜¯å‘é€æœ¬æŠ¥æ–‡æ®µçš„ä¸€æ–¹çš„æ¥æ”¶çª—å£ï¼Œå³ç°åœ¨å…è®¸å¯¹æ–¹å‘é€çš„æ•°æ®é‡ã€‚ æ£€éªŒå’Œï¼šå’ŒUDPä¸­çš„æ£€éªŒå’Œç±»ä¼¼ï¼Œæ£€éªŒé¦–éƒ¨+æ•°æ®ï¼Œæ£€éªŒæ—¶è¦åŠ ä¸Š12Bä¼ªé¦–éƒ¨ï¼Œç¬¬å››ä¸ªå­—æ®µä¸º6ã€‚ ç´§æ€¥æŒ‡é’ˆ: URG=1æ—¶æ‰æœ‰æ„ä¹‰ï¼ŒæŒ‡å‡ºæœ¬æŠ¥æ–‡æ®µä¸­ç´§æ€¥æ•°æ®çš„å­—èŠ‚æ•°ã€‚ é€‰é¡¹:æœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦MSSã€çª—å£æ‰©å¤§ã€æ—¶é—´æˆ³ã€é€‰æ‹©ç¡®è®¤â€¦ 4.4 TCPå®ç°å¯é ä¼ è¾“çš„æœºåˆ¶ ç´¯è®¡ç¡®è®¤â€”â€”å’Œé¦–éƒ¨ä¸­çš„ç¡®è®¤å·ç›¸å…³ï¼Œæ¥æ”¶æ–¹å¯ä»¥åœ¨åˆé€‚çš„æ—¶å€™å‘é€ç¡®è®¤ï¼Œä¹Ÿå¯ä»¥åœ¨è‡ªå·±æœ‰æ•°æ®è¦å‘é€æ—¶æŠŠç¡®è®¤ä¿¡æ¯é¡ºä¾¿æå¸¦ä¸Šã€‚ è¶…æ—¶é‡ä¼ â€”â€”TCPé‡‡ç”¨è‡ªé€‚åº”ç®—æ³•ï¼ŒåŠ¨æ€æ”¹å˜é‡ä¼ æ—¶é—´RTTs (åŠ æƒå¹³å‡å¾€è¿”æ—¶é—´) é€‰æ‹©ç¡®è®¤ï¼ˆç´¯è®¡ç¡®è®¤çš„æ”¹è¿›ï¼Œæ˜ç¡®æŒ‡å‡ºè‡ªå·±åªæ”¶åˆ°äº†å“ªäº›æ•°æ®ï¼‰â€”â€”æ¥æ”¶æ–¹å¯ä»¥åœ¨åˆé€‚çš„æ—¶å€™å‘é€ç¡®è®¤ï¼Œä¹Ÿå¯ä»¥åœ¨è‡ªå·±æœ‰æ•°æ®è¦å‘é€æ—¶æŠŠç¡®è®¤ä¿¡æ¯é¡ºä¾¿æå¸¦ä¸Šã€‚æ¥æ”¶æ–¹æ”¶åˆ°äº†å’Œå‰é¢çš„å­—èŠ‚æµä¸è¿ç»­çš„ä¸¤ä¸ªå­—èŠ‚å—ã€‚å¦‚æœè¿™äº›å­—èŠ‚çš„åºå·éƒ½åœ¨æ¥æ”¶çª—å£ä¹‹å†…ï¼Œé‚£ä¹ˆæ¥æ”¶æ–¹å°±å…ˆæ”¶ä¸‹è¿™äº›æ•°æ®ï¼Œä½†è¦æŠŠè¿™äº›ä¿¡æ¯å‡†ç¡®åœ°å‘Šè¯‰å‘é€æ–¹ï¼Œä½¿å‘é€æ–¹ä¸è¦å†é‡å¤å‘é€è¿™äº›å·²æ”¶åˆ°çš„æ•°æ®ã€‚å¦‚æœè¦ä½¿ç”¨é€‰æ‹©ç¡®è®¤ï¼Œé‚£ä¹ˆåœ¨å»ºç«‹ TCP è¿æ¥æ—¶ï¼Œå°±è¦åœ¨ TCP é¦–éƒ¨çš„é€‰é¡¹ä¸­åŠ ä¸Šâ€œå…è®¸ SACKâ€çš„é€‰é¡¹ï¼Œè€ŒåŒæ–¹å¿…é¡»éƒ½äº‹å…ˆå•†å®šå¥½ã€‚ 5 TCPçš„æµé‡æ§åˆ¶ TCPåˆ©ç”¨æ»‘åŠ¨çª—å£æœºåˆ¶å®ç°æµé‡æ§åˆ¶ã€‚ åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œæ¥æ”¶æ–¹æ ¹æ®è‡ªå·±æ¥æ”¶ç¼“å­˜çš„å¤§å°ï¼ŒåŠ¨æ€åœ°è°ƒæ•´å‘é€æ–¹çš„å‘é€çª—å£å¤§å°ï¼Œå³æ¥æ”¶çª—å£rwnd(æ¥æ”¶æ–¹è®¾ç½®ç¡®è®¤æŠ¥æ–‡æ®µçš„çª—å£å­—æ®µæ¥å°†rwndé€šçŸ¥ç»™å‘é€æ–¹)ï¼Œå‘é€æ–¹çš„å‘é€çª—å£å–æ¥æ”¶çª—å£rwndå’Œæ‹¥å¡çª—å£cwndçš„æœ€å°å€¼ã€‚å‘é€çª—å£=Min{æ¥æ”¶çª—å£rwnd,æ‹¥å¡çª—å£cwnd} å‡è®¾Bå‘Aå‘é€äº†é›¶çª—å£çš„æŠ¥æ–‡æ®µåä¸ä¹…ï¼ŒBçš„æ¥æ”¶ç¼“å­˜åˆæœ‰äº†ä¸€äº›å­˜å‚¨ç©ºé—´ã€‚äºæ˜¯Bå‘Aå‘é€äº†rwnd = 400çš„æŠ¥æ–‡æ®µã€‚ ä½†è¿™ä¸ªæŠ¥æ–‡æ®µåœ¨ä¼ é€è¿‡ç¨‹ä¸­ä¸¢å¤±äº†ã€‚Aä¸€ç›´ç­‰å¾…æ”¶åˆ°Bå‘é€çš„éé›¶çª—å£çš„é€šçŸ¥ï¼Œè€ŒBä¹Ÿä¸€ç›´ç­‰å¾… A å‘é€çš„æ•°æ®ã€‚ å¦‚æœæ²¡æœ‰å…¶ä»–æªæ–½ï¼Œè¿™ç§äº’ç›¸ç­‰å¾…çš„æ­»é”å±€é¢å°†ä¸€ç›´å»¶ç»­ä¸‹å»ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒTCP ä¸ºæ¯ä¸€ä¸ªè¿æ¥è®¾æœ‰ä¸€ä¸ªæŒç»­è®¡æ—¶å™¨ (persistence timer)ã€‚ åªè¦TCPè¿æ¥çš„ä¸€æ–¹æ”¶åˆ°å¯¹æ–¹çš„é›¶çª—å£é€šçŸ¥ï¼Œå°±å¯åŠ¨æŒç»­è®¡æ—¶å™¨ã€‚è‹¥æŒç»­è®¡æ—¶å™¨è®¾ç½®çš„æ—¶é—´åˆ°æœŸï¼Œå°±å‘é€ä¸€ä¸ªé›¶çª—å£æ¢æµ‹æŠ¥æ–‡æ®µã€‚æ¥æ”¶æ–¹æ”¶åˆ°æ¢æµ‹æŠ¥æ–‡æ®µæ—¶ç»™å‡ºç°åœ¨çš„çª—å£å€¼ã€‚è‹¥çª—å£ä»ç„¶æ˜¯0ï¼Œé‚£ä¹ˆå‘é€æ–¹å°±é‡æ–°è®¾ç½®æŒç»­è®¡æ—¶å™¨ã€‚ 6 TCPçš„æ‹¥å¡æ§åˆ¶ å‡å®š:1.æ•°æ®å•æ–¹å‘ä¼ é€ï¼Œè€Œå¦ä¸€ä¸ªæ–¹å‘åªä¼ é€ç¡®è®¤2.æ¥æ”¶æ–¹æ€»æ˜¯æœ‰è¶³å¤Ÿå¤§çš„ç¼“å­˜ç©ºé—´ï¼Œå› è€Œå‘é€çª—å£å¤§å°å–å†³äºæ‹¥å¡ç¨‹åº¦ 6.1 æ‹¥å¡æ§åˆ¶çš„ä¸€èˆ¬åŸç†åœ¨æŸæ®µæ—¶é—´ï¼Œè‹¥å¯¹ç½‘ç»œä¸­æŸèµ„æºçš„éœ€æ±‚è¶…è¿‡äº†è¯¥èµ„æºæ‰€èƒ½æä¾›çš„å¯ç”¨éƒ¨åˆ†ï¼Œç½‘ç»œçš„æ€§èƒ½å°±è¦å˜åã€‚è¿™ç§ç°è±¡ç§°ä¸ºæ‹¥å¡ (congestion)ã€‚ è‹¥ç½‘ç»œä¸­æœ‰è®¸å¤šèµ„æºåŒæ—¶äº§ç”Ÿæ‹¥å¡ï¼Œç½‘ç»œçš„æ€§èƒ½å°±è¦æ˜æ˜¾å˜åï¼Œæ•´ä¸ªç½‘ç»œçš„ååé‡å°†éšè¾“å…¥è´Ÿè·çš„å¢å¤§è€Œä¸‹é™ã€‚ å¼€ç¯æ§åˆ¶æ–¹æ³•å°±æ˜¯åœ¨è®¾è®¡ç½‘ç»œæ—¶äº‹å…ˆå°†æœ‰å…³å‘ç”Ÿæ‹¥å¡çš„å› ç´ è€ƒè™‘å‘¨åˆ°ï¼ŒåŠ›æ±‚ç½‘ç»œåœ¨å·¥ä½œæ—¶ä¸äº§ç”Ÿæ‹¥å¡ã€‚ é—­ç¯æ§åˆ¶æ–¹æ³•æ˜¯åŸºäºåé¦ˆç¯è·¯çš„æ¦‚å¿µã€‚å±äºé—­ç¯æ§åˆ¶çš„æœ‰ä»¥ä¸‹å‡ ç§æªæ–½ï¼š ç›‘æµ‹ç½‘ç»œç³»ç»Ÿä»¥ä¾¿æ£€æµ‹åˆ°æ‹¥å¡åœ¨ä½•æ—¶ã€ä½•å¤„å‘ç”Ÿã€‚ å°†æ‹¥å¡å‘ç”Ÿçš„ä¿¡æ¯ä¼ é€åˆ°å¯é‡‡å–è¡ŒåŠ¨çš„åœ°æ–¹ã€‚ è°ƒæ•´ç½‘ç»œç³»ç»Ÿçš„è¿è¡Œä»¥è§£å†³å‡ºç°çš„é—®é¢˜ã€‚ TCPåªèƒ½ä½¿ç”¨é—­ç¯æ§åˆ¶ï¼Œå‘é€æ–¹ç»´æŠ¤ä¸€ä¸ªæ‹¥å¡çª—å£ï¼Œæ˜¯æ ¹æ®è‡ªå·±ä¼°ç®—çš„ç½‘ç»œæ‹¥å¡ç¨‹åº¦è€Œè®¾ç½®çš„çª—å£å€¼ï¼Œåæ˜ ç½‘ç»œå½“å‰å®¹é‡ã€‚åªè¦ç½‘ç»œæ²¡æœ‰å‡ºç°æ‹¥å¡ï¼Œæ‹¥å¡çª—å£å°±å¯ä»¥å†å¢å¤§ä¸€äº›ï¼Œä»¥ä¾¿æŠŠæ›´å¤šçš„åˆ†ç»„å‘é€å‡ºå»ï¼Œè¿™æ ·å°±å¯ä»¥æé«˜ç½‘ç»œçš„åˆ©ç”¨ç‡ã€‚ä½†åªè¦ç½‘ç»œå‡ºç°æ‹¥å¡æˆ–æœ‰å¯èƒ½å‡ºç°æ‹¥å¡ï¼Œå°±å¿…é¡»æŠŠæ‹¥å¡çª—å£å‡å°ä¸€äº›ï¼Œä»¥å‡å°‘æ³¨å…¥åˆ°ç½‘ç»œä¸­çš„åˆ†ç»„æ•°ï¼Œä»¥ä¾¿ç¼“è§£ç½‘ç»œå‡ºç°çš„æ‹¥å¡ã€‚ å¦‚ä½•åˆ¤æ–­ç½‘ç»œæ‹¥å¡ï¼Ÿ é‡ä¼ å®šæ—¶å™¨è¶…æ—¶ æ”¶åˆ°ä¸‰ä¸ªç›¸åŒï¼ˆé‡å¤ï¼‰çš„ ACK 6.2 æ…¢å¼€å§‹&amp;æ‹¥å¡é¿å… ç”±å°åˆ°å¤§é€æ¸å¢å¤§æ‹¥å¡çª—å£æ•°å€¼ã€‚ç”¨æ¥ç¡®å®šç½‘ç»œçš„è´Ÿè½½èƒ½åŠ›ã€‚åœ¨æ¯æ”¶åˆ°ä¸€ä¸ªå¯¹æ–°çš„æŠ¥æ–‡æ®µçš„ç¡®è®¤åï¼Œå¯ä»¥æŠŠæ‹¥å¡çª—å£å¢åŠ æœ€å¤šä¸€ä¸ª SMSS çš„æ•°å€¼ï¼Œæ­¤æ—¶cwndå°±æ˜¯ç¿»å€å¢é•¿çš„ã€‚ æ–°çš„ RFC 5681 æŠŠåˆå§‹æ‹¥å¡çª—å£ cwnd è®¾ç½®ä¸ºä¸è¶…è¿‡2è‡³4ä¸ªSMSSçš„æ•°å€¼ã€‚ æ…¢å¼€å§‹é—¨é™ ssthreshï¼ˆçŠ¶æ€å˜é‡ï¼‰ï¼šé˜²æ­¢æ‹¥å¡çª—å£cwnd å¢é•¿è¿‡å¤§å¼•èµ·ç½‘ç»œæ‹¥å¡ã€‚åˆ°è¾¾è¿™ä¸ªä¸Šé™ä½¿ç”¨æ‹¥å¡é¿å…ç®—æ³•å¢å¤§cwndï¼Œä½¿ç”¨â€œåŠ æ³•å¢å¤§â€ã€‚ä¸€æ—¦å‘ç”Ÿç½‘ç»œæ‹¥å¡ï¼Œæ­¤æ—¶çš„swnd/2å¾—åˆ°æ–°çš„ssthreshï¼Œå†é‡æ–°å¼€å§‹æ…¢å¼€å§‹ã€‚ â€œæ‹¥å¡é¿å…â€å¹¶éæŒ‡å®Œå…¨èƒ½å¤Ÿé¿å…äº†æ‹¥å¡ã€‚åˆ©ç”¨ä»¥ä¸Šçš„æªæ–½è¦å®Œå…¨é¿å…ç½‘ç»œæ‹¥å¡è¿˜æ˜¯ä¸å¯èƒ½çš„ã€‚ â€œæ‹¥å¡é¿å…â€æ˜¯è¯´åœ¨æ‹¥å¡é¿å…é˜¶æ®µæŠŠæ‹¥å¡çª—å£æ§åˆ¶ä¸ºæŒ‰çº¿æ€§è§„å¾‹å¢é•¿ï¼Œä½¿ç½‘ç»œæ¯”è¾ƒä¸å®¹æ˜“å‡ºç°æ‹¥å¡ã€‚ 6.3 å¿«é‡ä¼ &amp;å¿«æ¢å¤ é‡‡ç”¨å¿«é‡ä¼  FR (Fast Retransmission) ç®—æ³•å¯ä»¥è®©å‘é€æ–¹å°½æ—©çŸ¥é“å‘ç”Ÿäº†ä¸ªåˆ«æŠ¥æ–‡æ®µçš„ä¸¢å¤±ã€‚å¿«é‡ä¼ ç®—æ³•é¦–å…ˆè¦æ±‚æ¥æ”¶æ–¹ä¸è¦ç­‰å¾…è‡ªå·±å‘é€æ•°æ®æ—¶æ‰è¿›è¡Œæå¸¦ç¡®è®¤ï¼Œè€Œæ˜¯è¦ç«‹å³å‘é€ç¡®è®¤ï¼Œå³ä½¿æ”¶åˆ°äº†å¤±åºçš„æŠ¥æ–‡æ®µä¹Ÿè¦ç«‹å³å‘å‡ºå¯¹å·²æ”¶åˆ°çš„æŠ¥æ–‡æ®µçš„é‡å¤ç¡®è®¤ã€‚ å‘é€æ–¹åªè¦ä¸€è¿æ”¶åˆ°ä¸‰ä¸ªé‡å¤ç¡®è®¤ï¼Œå°±çŸ¥é“æ¥æ”¶æ–¹ç¡®å®æ²¡æœ‰æ”¶åˆ°æŠ¥æ–‡æ®µï¼Œå› è€Œåº”å½“ç«‹å³è¿›è¡Œé‡ä¼ ï¼ˆå³â€œå¿«é‡ä¼ â€ï¼‰ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°è¶…æ—¶ï¼Œå‘é€æ–¹ä¹Ÿä¸å°±ä¼šè¯¯è®¤ä¸ºå‡ºç°äº†ç½‘ç»œæ‹¥å¡ã€‚æ­¤æ—¶å‘é€æ–¹è®¤ä¸ºç½‘ç»œå¾ˆå¯èƒ½æ²¡æœ‰å‘ç”Ÿæ‹¥å¡ï¼Œå› æ­¤ç°åœ¨ä¸æ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ï¼Œè€Œæ˜¯æ‰§è¡Œå¿«æ¢å¤ç®—æ³• FR (Fast Recovery) ç®—æ³•ï¼š ç›´æ¥å°†å½“å‰cwnd/2ä½œä¸ºæ–°çš„ssthreshå€¼ï¼Œå¹¶ç›´æ¥ä»è¿™ä¸ªå€¼å¼€å§‹æ‹¥å¡é¿å…çš„â€œåŠ æ³•å¢å¤§â€ã€‚ 7 TCPçš„ä¼ è¾“è¿æ¥ç®¡ç† 7.1 è¿æ¥å»ºç«‹TCPè¿æ¥çš„å»ºç«‹é‡‡ç”¨å®¢æˆ·æœåŠ¡å™¨æ–¹å¼ï¼Œä¸»åŠ¨å‘èµ·è¿æ¥å»ºç«‹çš„åº”ç”¨è¿›ç¨‹å«åšå®¢æˆ·ï¼Œè€Œè¢«åŠ¨ç­‰å¾…è¿æ¥å»ºç«‹çš„åº”ç”¨è¿›ç¨‹å«æœåŠ¡å™¨ã€‚ å‡è®¾è¿è¡Œåœ¨ä¸€å°ä¸»æœº(å®¢æˆ·)ä¸Šçš„ä¸€ä¸ªè¿›ç¨‹æƒ³ä¸å¦ä¸€å°ä¸»æœº(æœåŠ¡å™¨)ä¸Šçš„ä¸€ä¸ªè¿›ç¨‹å»ºç«‹ä¸€æ¡è¿æ¥ï¼Œå®¢æˆ·åº”ç”¨è¿›ç¨‹é¦–å…ˆé€šçŸ¥å®¢æˆ·TCPï¼Œä»–æƒ³å»ºç«‹ä¸€ä¸ªä¸æœåŠ¡å™¨ä¸ŠæŸä¸ªè¿›ç¨‹ä¹‹é—´çš„è¿æ¥ï¼Œå®¢æˆ·ä¸­çš„TCPä¼šç”¨ä»¥ä¸‹æ­¥éª¤ä¸æœåŠ¡å™¨ä¸­çš„TCPå»ºç«‹ä¸€æ¡TCPè¿æ¥: å®¢æˆ·ç«¯å‘é€è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µï¼Œæ— åº”ç”¨å±‚æ•°æ®ã€‚SYN=1ï¼Œseqï¼ˆé¦–éƒ¨ä¸­çš„åºå·ï¼‰=x(éšæœº) æœåŠ¡å™¨ç«¯ä¸ºè¯¥TCPè¿æ¥åˆ†é…ç¼“å­˜å’Œå˜é‡ï¼Œå¹¶å‘å®¢æˆ·ç«¯è¿”å›ç¡®è®¤æŠ¥æ–‡æ®µï¼Œå…è®¸è¿æ¥ï¼Œæ— åº”ç”¨å±‚æ•°æ®ã€‚SYN=1ï¼ŒACK=1ï¼Œseq=y(éšæœº)ï¼Œ ack=x+1 å®¢æˆ·ç«¯ä¸ºè¯¥TCPè¿æ¥åˆ†é…ç¼“å­˜å’Œå˜é‡ï¼Œå¹¶å‘æœåŠ¡å™¨ç«¯è¿”å›ç¡®è®¤çš„ç¡®è®¤ï¼Œå¯ä»¥æºå¸¦æ•°æ®ã€‚SYN=0ï¼ŒACK=1ï¼Œseq=x+1ï¼Œack=y+1 7.1.1 ç¬¬ä¸‰æ¬¡æ¡æ‰‹å¤±è´¥&amp;SYNæ´ªæ³›æ”»å‡»å½“å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„ SYN+ACK åº”ç­”åï¼Œå…¶çŠ¶æ€å˜ä¸º ESTABLISHEDï¼Œå¹¶ä¼šå‘é€ ACK åŒ…ç»™æœåŠ¡ç«¯ï¼Œå‡†å¤‡å‘é€æ•°æ®äº†ã€‚å¦‚æœæ­¤æ—¶ ACK åœ¨ç½‘ç»œä¸­ä¸¢å¤±ï¼Œè¿‡äº†è¶…æ—¶è®¡æ—¶å™¨åï¼Œé‚£ä¹ˆ Serverç«¯ä¼šé‡æ–°å‘é€ SYN+ACK åŒ…ï¼Œé‡ä¼ æ¬¡æ•°æ ¹æ®/proc/sys/net/ipv4/tcp_synack_retries æ¥æŒ‡å®šï¼Œé»˜è®¤æ˜¯ 5 æ¬¡ã€‚å¦‚æœé‡ä¼ æŒ‡å®šæ¬¡æ•°åˆ°äº†åï¼Œä»ç„¶æœªæ”¶åˆ° ACK åº”ç­”ï¼Œé‚£ä¹ˆä¸€æ®µæ—¶é—´åï¼ŒServer è‡ªåŠ¨å…³é—­è¿™ä¸ªè¿æ¥ã€‚ä½†æ˜¯ Client è®¤ä¸ºè¿™ä¸ªè¿æ¥å·²ç»å»ºç«‹ï¼Œå¦‚æœ Client ç«¯å‘ Server å†™æ•°æ®ï¼ŒServerç«¯å°†ä»¥ RST åŒ…å“åº”ï¼Œæ–¹èƒ½æ„ŸçŸ¥åˆ° Server çš„é”™è¯¯ã€‚ SYNæ´ªæ³›æ”»å‡»å‘ç”Ÿåœ¨OSIç¬¬å››å±‚ï¼Œè¿™ç§æ–¹å¼åˆ©ç”¨TCPåè®®çš„ç‰¹æ€§ï¼Œå°±æ˜¯ä¸‰æ¬¡æ¡æ‰‹ã€‚æ”»å‡»è€…å‘é€TCP SYNï¼ŒSYNæ˜¯TCPä¸‰æ¬¡æ¡æ‰‹ä¸­çš„ç¬¬ä¸€ä¸ªæ•°æ®åŒ…ï¼Œè€Œå½“æœåŠ¡å™¨è¿”å›ACKåï¼Œè¯¥æ”»å‡»è€…å°±ä¸å¯¹å…¶è¿›è¡Œå†ç¡®è®¤ï¼Œé‚£è¿™ä¸ªTCPè¿æ¥å°±å¤„äºæŒ‚èµ·çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„åŠè¿æ¥çŠ¶æ€ï¼ŒæœåŠ¡å™¨æ”¶ä¸åˆ°å†ç¡®è®¤çš„è¯ï¼Œè¿˜ä¼šé‡å¤å‘é€ACKç»™æ”»å‡»è€…ã€‚è¿™æ ·æ›´åŠ ä¼šæµªè´¹æœåŠ¡å™¨çš„èµ„æºã€‚æ”»å‡»è€…å°±å¯¹æœåŠ¡å™¨å‘é€éå¸¸å¤§é‡çš„è¿™ç§TCPè¿æ¥ï¼Œç”±äºæ¯ä¸€ä¸ªéƒ½æ²¡æ³•å®Œæˆä¸‰æ¬¡æ¡æ‰‹ï¼Œæ‰€ä»¥åœ¨æœåŠ¡å™¨ä¸Šï¼Œè¿™äº›TCPè¿æ¥ä¼šå› ä¸ºæŒ‚èµ·çŠ¶æ€è€Œæ¶ˆè€—CPUå’Œå†…å­˜ï¼Œæœ€åæœåŠ¡å™¨å¯èƒ½æ­»æœºï¼Œå°±æ— æ³•ä¸ºæ­£å¸¸ç”¨æˆ·æä¾›æœåŠ¡äº†ã€‚ å¦‚ä½•åº”å¯¹SYNæ´ªæ³›æ”»å‡»ï¼Ÿè¿™é‡Œå¯ä»¥ä½¿ç”¨linuxçš„ä¸¤ä¸ªå‚æ•°ï¼š ç¬¬ä¸€ä¸ªå‚æ•° tcp_synack_retries = 0 æ˜¯å…³é”®ï¼Œè¡¨ç¤ºå›åº”ç¬¬äºŒä¸ªæ¡æ‰‹åŒ…ï¼ˆSYN+ACK åŒ…ï¼‰ç»™å®¢æˆ·ç«¯ IP åï¼Œå¦‚æœæ”¶ä¸åˆ°ç¬¬ä¸‰æ¬¡æ¡æ‰‹åŒ…ï¼ˆACK åŒ…ï¼‰åï¼Œä¸è¿›è¡Œé‡è¯•ï¼ŒåŠ å¿«å›æ”¶â€œåŠè¿æ¥â€ï¼Œä¸è¦è€—å…‰èµ„æºã€‚ ä¿®æ”¹è¿™ä¸ªå‚æ•°ä¸º 0 çš„å‰¯ä½œç”¨ï¼šç½‘ç»œçŠ¶å†µå¾ˆå·®æ—¶ï¼Œå¦‚æœå¯¹æ–¹æ²¡æ”¶åˆ°ç¬¬äºŒä¸ªæ¡æ‰‹åŒ…ï¼Œå¯èƒ½è¿æ¥æœåŠ¡å™¨å¤±è´¥ï¼Œä½†å¯¹äºä¸€èˆ¬ç½‘ç«™ï¼Œç”¨æˆ·åˆ·æ–°ä¸€æ¬¡é¡µé¢å³å¯ã€‚è¿™äº›å¯ä»¥åœ¨é«˜å³°æœŸæˆ–ç½‘ç»œçŠ¶å†µä¸å¥½æ—¶tcpdump æŠ“åŒ…éªŒè¯ä¸‹ã€‚ ä¹‹æ‰€ä»¥å¯ä»¥æŠŠ tcp_synack_retries æ”¹ä¸º 0ï¼Œå› ä¸ºå®¢æˆ·ç«¯è¿˜æœ‰ tcp_syn_retries å‚æ•°ï¼Œé»˜è®¤æ˜¯ 5ï¼Œå³ä½¿æœåŠ¡å™¨ç«¯æ²¡æœ‰é‡å‘ SYN+ACK åŒ…ï¼Œå®¢æˆ·ç«¯ä¹Ÿä¼šé‡å‘ SYN æ¡æ‰‹åŒ…ã€‚ ç¬¬äºŒä¸ªå‚æ•°tcp_max_syn_backlogï¼Œä»å­—é¢ä¸Šå°±å¯ä»¥æ¨æ–­å‡ºæ˜¯ä»€ä¹ˆæ„æ€ã€‚åœ¨å†…æ ¸é‡Œæœ‰ä¸ªé˜Ÿåˆ—ç”¨æ¥å­˜æ”¾è¿˜æ²¡æœ‰ç¡®è®¤ ACK çš„å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå½“ç­‰å¾…çš„è¯·æ±‚æ•°å¤§äº tcp_max_syn_backlog æ—¶ï¼Œåé¢çš„ä¼šè¢«ä¸¢å¼ƒã€‚ æ‰€ä»¥ï¼Œé€‚å½“å¢å¤§è¿™ä¸ªå€¼ï¼Œå¯ä»¥åœ¨å‹åŠ›å¤§çš„æ—¶å€™æé«˜æ¡æ‰‹çš„æˆåŠŸç‡ã€‚æ‰‹å†Œé‡Œæ¨èå¤§äº 1024ã€‚ä½¿ç”¨æœåŠ¡å™¨çš„å†…å­˜èµ„æºï¼Œæ¢å–æ›´å¤§çš„ç­‰å¾…é˜Ÿåˆ—é•¿åº¦ï¼Œè®©æ”»å‡»æ•°æ®åŒ…ä¸è‡³äºå æ»¡æ‰€æœ‰è¿æ¥è€Œå¯¼è‡´æ­£å¸¸ç”¨æˆ·æ— æ³•å®Œæˆæ¡æ‰‹ã€‚ å½“åŠè¿æ¥çš„è¯·æ±‚æ•°é‡è¶…è¿‡äº† tcp_max_syn_backlog æ—¶ï¼Œå†…æ ¸å°±ä¼šå¯ç”¨ SYN cookie æœºåˆ¶ï¼Œä¸å†æŠŠåŠè¿æ¥è¯·æ±‚æ”¾åˆ°é˜Ÿåˆ—é‡Œï¼Œè€Œæ˜¯ç”¨ SYN cookie æ¥æ£€éªŒã€‚ å¯ç”¨ä¹‹å‰ï¼ŒæœåŠ¡å™¨åœ¨æ¥åˆ° SYN æ•°æ®åŒ…åï¼Œç«‹å³åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œå¹¶éšæœºåŒ–ä¸€ä¸ªæ•°å­—ä½œä¸º SYNå·å‘é€ SYN+ACK æ•°æ®åŒ…ã€‚ç„¶åä¿å­˜è¿æ¥çš„çŠ¶æ€ä¿¡æ¯ç­‰å¾…å®¢æˆ·ç«¯ç¡®è®¤ã€‚å¯ç”¨ SYN Cookie ä¹‹åï¼ŒæœåŠ¡å™¨ä¸å†åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œè€Œä¸”é€šè¿‡åŸºäºæ—¶é—´ç§å­çš„éšæœºæ•°ç®—æ³•è®¾ç½®ä¸€ä¸ª SYN å·ï¼Œæ›¿ä»£å®Œå…¨éšæœºçš„ SYN å·ã€‚å‘é€å®Œ SYN+ACK ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œæ¸…ç©ºèµ„æºä¸ä¿å­˜ä»»ä½•çŠ¶æ€ä¿¡æ¯ã€‚ç›´åˆ°æœåŠ¡å™¨æ¥åˆ°å®¢æˆ·ç«¯çš„æœ€ç»ˆ ACK åŒ…ï¼Œé€šè¿‡ Cookie æ£€éªŒç®—æ³•é‰´å®šæ˜¯å¦ä¸å‘å‡ºå»çš„ SYN+ACKæŠ¥æ–‡åºåˆ—å·åŒ¹é…ï¼ŒåŒ¹é…åˆ™é€šè¿‡å®Œæˆæ¡æ‰‹ï¼Œå¤±è´¥åˆ™ä¸¢å¼ƒã€‚å½“ç„¶ï¼Œå‰æ–‡çš„é«˜çº§æ”»å‡»ä¸­æœ‰ SYN æ··åˆ ACK çš„æ”»å‡»æ–¹æ³•ï¼Œåˆ™æ˜¯å¯¹æ­¤ç§é˜²å¾¡æ–¹æ³•çš„åå‡»ï¼Œå…¶ä¸­ä¼˜åŠ£ç”±åŒæ–¹çš„ç¡¬ä»¶é…ç½®å†³å®šã€‚ 7.2 è¿æ¥é‡Šæ”¾å‚ä¸ä¸€æ¡TCPè¿æ¥çš„ä¸¤ä¸ªè¿›ç¨‹ä¸­çš„ä»»ä½•-ä¸€ä¸ªéƒ½èƒ½ç»ˆæ­¢è¯¥è¿æ¥ï¼Œè¿æ¥ç»“æŸåï¼Œä¸»æœºä¸­çš„â€œèµ„æºâ€(ç¼“å­˜å’Œå˜é‡) å°†è¢«é‡Šæ”¾ã€‚ å®¢æˆ·ç«¯å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µï¼Œåœæ­¢å‘é€æ•°æ®ï¼Œä¸»åŠ¨å…³é—­TCPè¿æ¥ã€‚FIN=1ï¼Œseq=u æœåŠ¡å™¨ç«¯å›é€ä¸€ä¸ªç¡®è®¤æŠ¥æ–‡æ®µï¼Œå®¢æˆ·åˆ°æœåŠ¡å™¨è¿™ä¸ªæ–¹å‘çš„è¿æ¥å°±é‡Šæ”¾äº†â€”â€”åŠå…³é—­çŠ¶æ€ã€‚ACK=1ï¼Œseq=vï¼Œack=u+1 æœåŠ¡å™¨ç«¯å‘å®Œæ•°æ®ï¼Œå°±å‘å‡ºè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µï¼Œä¸»åŠ¨å…³é—­TCPè¿æ¥ã€‚FIN=1ï¼ŒACK=1ï¼Œseq=wï¼Œack=u+1 å®¢æˆ·ç«¯å›é€ä¸€ä¸€ä¸ªç¡®è®¤æŠ¥æ–‡æ®µï¼Œå†ç­‰åˆ°æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨è®¾ç½®çš„2MSL (æœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½)åï¼Œè¿æ¥å½»åº•å…³é—­ã€‚ è¿™ä¸ªè¿‡ç¨‹ä¹Ÿè¢«ç§°ä¸ºâ€œå››æ¬¡æŒ¥æ‰‹â€ ä¸ºä»€ä¹ˆè¦æœ‰time_waitï¼Ÿ å¯é çš„ç»ˆæ­¢ TCP è¿æ¥ï¼Œè‹¥å¤„äº time_wait çš„ client å‘é€ç»™ server ç¡®è®¤æŠ¥æ–‡æ®µä¸¢å¤±çš„è¯ï¼Œserverå°†åœ¨æ­¤åˆä¸€æ¬¡å‘é€ FIN æŠ¥æ–‡æ®µï¼Œé‚£ä¹ˆ client å¿…é¡»å¤„äºä¸€ä¸ªå¯æ¥æ”¶çš„çŠ¶æ€å°±æ˜¯ time_wait è€Œä¸æ˜¯ close çŠ¶æ€ã€‚ ä¿è¯è¿Ÿæ¥çš„ TCP æŠ¥æ–‡æ®µæœ‰è¶³å¤Ÿçš„æ—¶é—´è¢«è¯†åˆ«å¹¶ä¸¢å¼ƒï¼Œlinux ä¸­ä¸€ä¸ª TCPport ä¸èƒ½æ‰“å¼€ä¸¤æ¬¡æˆ–ä¸¤æ¬¡ä»¥ä¸Šã€‚å½“ client å¤„äº time_wait çŠ¶æ€æ—¶æˆ‘ä»¬å°†æ— æ³•ä½¿ç”¨æ­¤ port å»ºç«‹æ–°è¿æ¥ï¼Œå‡è®¾ä¸å­˜åœ¨ time_wait çŠ¶æ€ï¼Œæ–°è¿æ¥å¯èƒ½ä¼šæ”¶åˆ°æ—§è¿æ¥çš„æ•°æ®ã€‚ 7.3 ä¸ºä»€ä¹ˆå»ºç«‹è¿æ¥åè®®æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œå…³é—­è¿æ¥å´æ˜¯å››æ¬¡æ¡æ‰‹å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºæœåŠ¡ç«¯çš„ LISTEN çŠ¶æ€ä¸‹çš„ SOCKET å½“æ”¶åˆ° SYN æŠ¥æ–‡çš„å»ºè¿è¯·æ±‚åï¼Œå®ƒå¯ä»¥æŠŠ ACKå’Œ SYNï¼ˆACK èµ·åº”ç­”ä½œç”¨ï¼Œè€Œ SYN èµ·åŒæ­¥ä½œç”¨ï¼‰æ”¾åœ¨ä¸€ä¸ªæŠ¥æ–‡é‡Œæ¥å‘é€ã€‚ä½†å…³é—­è¿æ¥æ—¶ï¼Œå½“æ”¶åˆ°å¯¹æ–¹çš„ FIN æŠ¥æ–‡é€šçŸ¥æ—¶ï¼Œå®ƒä»…ä»…è¡¨ç¤ºå¯¹æ–¹æ²¡æœ‰æ•°æ®å‘é€ç»™ä½ äº†ï¼›ä½†æœªå¿…ä½ æ‰€æœ‰çš„æ•°æ®éƒ½å…¨éƒ¨å‘é€ç»™å¯¹æ–¹äº†ï¼Œæ‰€ä»¥ä½ å¯ä»¥æœªå¿…ä¼šé©¬ä¸Šä¼šå…³é—­ SOCKET,ä¹Ÿå³ä½ å¯èƒ½è¿˜éœ€è¦å‘é€ä¸€äº›æ•°æ®ç»™å¯¹æ–¹ä¹‹åï¼Œå†å‘é€ FIN æŠ¥æ–‡ç»™å¯¹æ–¹æ¥è¡¨ç¤ºä½ åŒæ„ç°åœ¨å¯ä»¥å…³é—­è¿æ¥äº†ï¼Œæ‰€ä»¥å®ƒè¿™é‡Œçš„ ACK æŠ¥æ–‡å’Œ FIN æŠ¥æ–‡å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯åˆ†å¼€å‘é€çš„ã€‚ 7.4 TCPçŠ¶æ€æœº","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","permalink":"https://www.codetool.top/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"}]},{"title":"leetcode79-å•è¯æœç´¢","slug":"leetcode79-å•è¯æœç´¢","date":"2020-04-12T06:54:58.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode79-å•è¯æœç´¢/","link":"","permalink":"https://www.codetool.top/article/leetcode79-%E5%8D%95%E8%AF%8D%E6%90%9C%E7%B4%A2/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªäºŒç»´ç½‘æ ¼å’Œä¸€ä¸ªå•è¯ï¼Œæ‰¾å‡ºè¯¥å•è¯æ˜¯å¦å­˜åœ¨äºç½‘æ ¼ä¸­ã€‚ å•è¯å¿…é¡»æŒ‰ç…§å­—æ¯é¡ºåºï¼Œé€šè¿‡ç›¸é‚»çš„å•å…ƒæ ¼å†…çš„å­—æ¯æ„æˆï¼Œå…¶ä¸­â€œç›¸é‚»â€å•å…ƒæ ¼æ˜¯é‚£äº›æ°´å¹³ç›¸é‚»æˆ–å‚ç›´ç›¸é‚»çš„å•å…ƒæ ¼ã€‚åŒä¸€ä¸ªå•å…ƒæ ¼å†…çš„å­—æ¯ä¸å…è®¸è¢«é‡å¤ä½¿ç”¨ã€‚ ç¤ºä¾‹: board = [ ['A','B','C','E'], ['S','F','C','S'], ['A','D','E','E'] ] ç»™å®š word = \"ABCCED\", è¿”å› true ç»™å®š word = \"SEE\", è¿”å› true ç»™å®š word = \"ABCB\", è¿”å› false æç¤ºï¼š board å’Œ word ä¸­åªåŒ…å«å¤§å†™å’Œå°å†™è‹±æ–‡å­—æ¯ã€‚ 1 &lt;= board.length &lt;= 200 1 &lt;= board[i].length &lt;= 200 1 &lt;= word.length &lt;= 10^3 2 è§£æ³•2.1 æ€æƒ³å› ä¸ºåŒä¸€ä¸ªä½ç½®çš„å­—ç¬¦ä¸èƒ½ç”¨ä¸¤æ¬¡ï¼Œå¾—æ ‡è®°ï¼Œdfså›æº¯çš„æ—¶å€™å¿…é¡»æŠŠæ ‡è®°æ¸…é™¤ã€‚ 2.2 ä»£ç class Solution { char[][] board; boolean[][] visited; public boolean exist(char[][] board, String word) { this.board = board; for(int i = 0;i&lt;board.length;i++){ for(int j = 0;j&lt;board[0].length;j++){ visited = new boolean[board.length][board[0].length]; if(dfs(i,j,word)) return true; } } return false; } public boolean dfs(int x,int y,String word){ if(word.length()==1){ if(word.charAt(0)==board[x][y]) return true; } if(word.charAt(0)!=board[x][y]) return false; visited[x][y] = true; boolean ans = false; //å‘ä¸Š if(x-1>=0 &amp;&amp; !visited[x-1][y]) ans = ans||dfs(x-1,y,word.substring(1)); //å‘ä¸‹ if(x+1&lt;board.length &amp;&amp; !visited[x+1][y]) ans = ans||dfs(x+1,y,word.substring(1)); //å‘å·¦ if(y-1>=0 &amp;&amp; !visited[x][y-1]) ans = ans||dfs(x,y-1,word.substring(1)); //å‘å³ if(y+1&lt;board[0].length &amp;&amp; !visited[x][y+1]) ans = ans||dfs(x,y+1,word.substring(1)); //æ¸…é™¤æ ‡è®° if(ans == false) visited[x][y] = false; return ans; } } ä¸‹é¢æ˜¯åˆ©ç”¨çŸ­è·¯æˆ–å‰ªæåçš„ç‰ˆæœ¬ï¼ŒæŒ‰ç†è¯´æ›´å¿«ï¼Œleetcodeæµ‹è¯•ä¹Ÿå·®ä¸å¤šï¼š class Solution { char[][] board; boolean[][] visited; public boolean exist(char[][] board, String word) { this.board = board; for(int i = 0;i&lt;board.length;i++){ for(int j = 0;j&lt;board[0].length;j++){ visited = new boolean[board.length][board[0].length]; if(dfs(i,j,word)) return true; } } return false; } public boolean dfs(int x,int y,String word){ if(word.length()==1){ if(word.charAt(0)==board[x][y]) return true; } if(word.charAt(0)!=board[x][y]) return false; visited[x][y] = true; //å‘ä¸Š if(x-1>=0 &amp;&amp; !visited[x-1][y]) if(dfs(x-1,y,word.substring(1))) return true; //å‘ä¸‹ if(x+1&lt;board.length &amp;&amp; !visited[x+1][y]) if(dfs(x+1,y,word.substring(1))) return true; //å‘å·¦ if(y-1>=0 &amp;&amp; !visited[x][y-1]) if(dfs(x,y-1,word.substring(1))) return true; //å‘å³ if(y+1&lt;board[0].length &amp;&amp; !visited[x][y+1]) if(dfs(x,y+1,word.substring(1))) return true; //æ¸…é™¤æ ‡è®° visited[x][y] = false; return false; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"ç¼“å­˜ä¸€è‡´æ€§åè®®MESI","slug":"ç¼“å­˜ä¸€è‡´æ€§åè®®MESI","date":"2020-04-11T11:46:48.000Z","updated":"2020-04-11T14:20:20.591Z","comments":true,"path":"article/ç¼“å­˜ä¸€è‡´æ€§åè®®MESI/","link":"","permalink":"https://www.codetool.top/article/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E5%8D%8F%E8%AE%AEMESI/","excerpt":"","text":"æ˜æ˜è®°å¾—åœ¨å“ªé‡Œå­¦è¿‡è¿™éƒ¨åˆ†å†…å®¹ï¼Œè¿˜çœ‹åˆ°è¿‡ä¸€ä¸ªè´¼å¥½çš„å›¾ã€‚ã€‚ä»Šå¤©æ‰¾äº†å¾ˆä¹…åˆæ²¡æ‰¾ç€ï¼Œè¿™å°±æ˜¯å­¦äº†ä¸è®°ç¬”è®°çš„åæœã€‚ã€‚ æœ¬æ–‡å‚è€ƒèµ„æºï¼š CPUä½“ç³»ç»“æ„ä¹‹cacheå°ç»“_è¿ç»´_Hober-CSDNåšå®¢ 001-CPUå¤šçº§ç¼“å­˜æ¶æ„ - bjlhx15 - åšå®¢å›­ volatileä¸å†…å­˜å±éšœ_Java_weiqingçš„åšå®¢-CSDNåšå®¢ æå®¢æ—¶é—´ã€Šæ·±å…¥æµ…å‡ºè®¡ç®—æœºç»„æˆåŸç†ã€‹ 1 ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜åœ¨ç°ä»£çš„CPUï¼ˆå¤§å¤šæ•°ï¼‰ä¸Šï¼Œæ‰€æœ‰çš„å†…å­˜è®¿é—®éƒ½éœ€è¦é€šè¿‡å±‚å±‚çš„ç¼“å­˜æ¥è¿›è¡Œã€‚ä¹Ÿæœ‰äº›ä¾‹å¤–ï¼Œæ¯”å¦‚ï¼Œå¯¹æ˜ å°„æˆå†…å­˜åœ°å€çš„I/Oå£ã€å†™åˆå¹¶ï¼ˆWrite-combinedï¼‰å†…å­˜ï¼Œè¿™äº›è®¿é—®è‡³å°‘ä¼šç»•å¼€è¿™ä¸ªæµç¨‹çš„ä¸€éƒ¨åˆ†ã€‚ä½†è¿™ä¸¤è€…éƒ½æ˜¯ç½•è§çš„åœºæ™¯ï¼ˆæ„å‘³ç€ç»å¤§å¤šæ•°çš„ç”¨æˆ·æ€ä»£ç éƒ½ä¸ä¼šé‡åˆ°è¿™ä¸¤ç§æƒ…å†µï¼‰ã€‚å¹¶ä¸”ç”±äºç¨‹åºé€šå¸¸å…·æœ‰è‰¯å¥½çš„æ—¶é—´å±€éƒ¨æ€§å’Œç©ºé—´å±€éƒ¨æ€§ï¼Œç¼“å­˜å¯¹æé«˜ç¨‹åºè¿è¡Œçš„æ•ˆç‡èµ·åˆ°å¾ˆå¤§å¸®åŠ©ã€‚ ç„¶è€Œä¸Šé¢è¿™å¼ å›¾æ²¡æœ‰è¡¨ç¤ºæ¸…æ¥šçš„æ˜¯ï¼Œä¸‰çº§ç¼“å­˜å’ŒCPUæ ¸å¿ƒä¹‹é—´çš„å…³ç³»ï¼šï¼ˆç”±äºæ²¡æœ‰æ‰¾åˆ°ä¹‹å‰çœ‹è¿‡çš„é‚£å¼ å›¾ç‰¹æ„æ‰¾äº†ä¸‰å¼ å›¾å¥½è¡¨ç¤ºæ¸…æ¥šï¼‰ L1æ˜¯æœ€æ¥è¿‘CPUçš„ï¼Œå®ƒå®¹é‡æœ€å°ï¼Œé€Ÿåº¦æœ€å¿«ï¼Œæ¯ä¸ªæ ¸ä¸Šéƒ½æœ‰ä¸€ä¸ªL1 Cacheï¼ˆå‡†ç¡®åœ°è¯´æ¯ä¸ªæ ¸ä¸Šæœ‰ä¸¤ä¸ªL1 Cacheï¼Œä¸€ä¸ªå­˜æ•°æ® L1d Cacheï¼Œä¸€ä¸ªå­˜æŒ‡ä»¤ L1i Cacheï¼‰ L2 Cache æ›´å¤§ä¸€äº›ï¼Œä¾‹å¦‚256Kï¼Œé€Ÿåº¦è¦æ…¢ä¸€äº›ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ¯ä¸ªæ ¸ä¸Šéƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„L2 Cacheï¼›äºŒçº§ç¼“å­˜å°±æ˜¯ä¸€çº§ç¼“å­˜çš„ç¼“å†²å™¨ï¼šä¸€çº§ç¼“å­˜åˆ¶é€ æˆæœ¬å¾ˆé«˜å› æ­¤å®ƒçš„å®¹é‡æœ‰é™ï¼ŒäºŒçº§ç¼“å­˜çš„ä½œç”¨å°±æ˜¯å­˜å‚¨é‚£äº›CPUå¤„ç†æ—¶éœ€è¦ç”¨åˆ°ã€ä¸€çº§ç¼“å­˜åˆæ— æ³•å­˜å‚¨çš„æ•°æ®ã€‚ L3 Cacheæ˜¯ä¸‰çº§ç¼“å­˜ä¸­æœ€å¤§çš„ä¸€çº§ï¼Œä¾‹å¦‚12MBï¼ŒåŒæ—¶ä¹Ÿæ˜¯æœ€æ…¢çš„ä¸€çº§ï¼Œåœ¨åŒä¸€ä¸ªCPUæ’æ§½ä¹‹é—´çš„æ ¸å…±äº«ä¸€ä¸ªL3 Cacheã€‚ä¸‰çº§ç¼“å­˜å’Œå†…å­˜å¯ä»¥çœ‹ä½œæ˜¯äºŒçº§ç¼“å­˜çš„ç¼“å†²å™¨ï¼Œå®ƒä»¬çš„å®¹é‡é€’å¢ï¼Œä½†å•ä½åˆ¶é€ æˆæœ¬å´é€’å‡ã€‚ é«˜é€Ÿç¼“å­˜è¡Œçš„ç»“æ„è¿™é‡Œä¸æï¼Œæœ‰æ—¶é—´æŠŠCSAPPé‡Œé¢çš„ç¬”è®°æ”¾ä¸Šæ¥ã€‚ é‚£ä¹ˆè¿™æ ·è®¾è®¡çš„é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå› ä¸º CPU çš„æ¯ä¸ªæ ¸å„æœ‰å„çš„ç¼“å­˜ï¼Œäº’ç›¸ä¹‹é—´çš„æ“ä½œåˆæ˜¯å„è‡ªç‹¬ç«‹çš„ï¼Œå°±ä¼šå¸¦æ¥ç¼“å­˜ä¸€è‡´æ€§ï¼ˆCache Coherenceï¼‰çš„é—®é¢˜ã€‚ è¿™é‡Œéœ€è¦å…ˆæåˆ°cacheå†™æœºåˆ¶ 1.1 cacheå†™æœºåˆ¶Write-throughï¼ˆç›´å†™æ¨¡å¼ï¼‰åœ¨æ•°æ®æ›´æ–°æ—¶ï¼ŒåŒæ—¶å†™å…¥ç¼“å­˜Cacheå’Œåç«¯å­˜å‚¨ã€‚æ­¤æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯æ“ä½œç®€å•ï¼›ç¼ºç‚¹æ˜¯å› ä¸ºæ•°æ®ä¿®æ”¹éœ€è¦åŒæ—¶å†™å…¥å­˜å‚¨ï¼Œæ•°æ®å†™å…¥é€Ÿåº¦è¾ƒæ…¢ã€‚ Write-backï¼ˆå›å†™æ¨¡å¼ï¼‰åœ¨æ•°æ®æ›´æ–°æ—¶åªå†™å…¥ç¼“å­˜Cacheã€‚åªåœ¨æ•°æ®è¢«æ›¿æ¢å‡ºç¼“å­˜æ—¶ï¼Œè¢«ä¿®æ”¹çš„ç¼“å­˜æ•°æ®æ‰ä¼šè¢«å†™åˆ°åç«¯å­˜å‚¨ã€‚æ­¤æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯æ•°æ®å†™å…¥é€Ÿåº¦å¿«ï¼Œå› ä¸ºä¸éœ€è¦å†™å­˜å‚¨ï¼›ç¼ºç‚¹æ˜¯ä¸€æ—¦æ›´æ–°åçš„æ•°æ®æœªè¢«å†™å…¥å­˜å‚¨æ—¶å‡ºç°ç³»ç»Ÿæ‰ç”µçš„æƒ…å†µï¼Œæ•°æ®å°†æ— æ³•æ‰¾å›ã€‚ 1.2 ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜è¯•æƒ³ä¸‹é¢è¿™æ ·ä¸€ä¸ªæƒ…å†µã€‚ CPU1 è¯»å–äº†ä¸€ä¸ªå­—èŠ‚ï¼Œä»¥åŠå®ƒå’Œå®ƒç›¸é‚»çš„å­—èŠ‚è¢«è¯»å…¥CPU1çš„é«˜é€Ÿç¼“å­˜ã€‚ CPU2 åšäº†ä¸Šé¢åŒæ ·çš„å·¥ä½œã€‚è¿™æ ·CPU1ï¼ŒCPU2çš„é«˜é€Ÿç¼“å­˜æ‹¥æœ‰åŒæ ·çš„æ•°æ®ã€‚ CPU1 ä¿®æ”¹äº†é‚£ä¸ªå­—èŠ‚ï¼Œè¢«ä¿®æ”¹åï¼Œé‚£ä¸ªå­—èŠ‚è¢«æ”¾å›CPU1çš„é«˜é€Ÿç¼“å­˜è¡Œã€‚ä½†æ˜¯è¯¥ä¿¡æ¯å¹¶æ²¡æœ‰è¢«å†™å…¥RAMã€‚ CPU2 è®¿é—®è¯¥å­—èŠ‚ï¼Œä½†ç”±äºCPU1å¹¶æœªå°†æ•°æ®å†™å…¥RAMï¼ˆå›å†™æ¨¡å¼ï¼‰ï¼Œå¯¼è‡´äº†æ•°æ®ä¸åŒæ­¥ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªç¼“å­˜ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦æœ‰ä¸€ç§æœºåˆ¶ï¼Œæ¥åŒæ­¥ä¸¤ä¸ªä¸åŒæ ¸å¿ƒé‡Œé¢çš„ç¼“å­˜æ•°æ®ã€‚é‚£è¿™æ ·çš„æœºåˆ¶éœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶å‘¢ï¼Ÿæˆ‘è§‰å¾—èƒ½å¤Ÿåšåˆ°ä¸‹é¢ä¸¤ç‚¹å°±æ˜¯åˆç†çš„ã€‚ ç¬¬ä¸€ç‚¹å«å†™ä¼ æ’­ï¼ˆWrite Propagationï¼‰ã€‚å†™ä¼ æ’­æ˜¯è¯´ï¼Œåœ¨ä¸€ä¸ªCPU æ ¸å¿ƒé‡Œï¼Œæˆ‘ä»¬çš„ Cache æ•°æ®æ›´æ–°ï¼Œå¿…é¡»èƒ½å¤Ÿä¼ æ’­åˆ°å…¶ä»–çš„å¯¹åº”èŠ‚ç‚¹çš„ Cache Line é‡Œã€‚ ç¬¬äºŒç‚¹å«äº‹åŠ¡çš„ä¸²è¡ŒåŒ–ï¼ˆTransaction Serializationï¼‰ï¼Œäº‹åŠ¡ä¸²è¡ŒåŒ–æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ª CPU æ ¸å¿ƒé‡Œé¢çš„è¯»å–å’Œå†™å…¥ï¼Œåœ¨å…¶ä»–çš„èŠ‚ç‚¹çœ‹èµ·æ¥ï¼Œé¡ºåºæ˜¯ä¸€æ ·çš„ã€‚ å†™ä¼ æ’­å¾ˆå®¹æ˜“ç†è§£ã€‚æ—¢ç„¶æˆ‘ä»¬æ•°æ®å†™å®Œäº†ï¼Œè‡ªç„¶è¦åŒæ­¥åˆ°å…¶ä»– CPU æ ¸çš„ Cache é‡Œã€‚è€Œäº‹åŠ¡çš„ä¸²è¡ŒåŒ–ï¼Œåˆ™æ˜¯æŒ‡å‡è®¾å¾ˆçŸ­æ—¶é—´å†…ï¼Œä¸€ä¸ªæ•°æ®è¢«ä¸¤æ¬¡ä¿®æ”¹ï¼Œå¹¶ä¸”åˆ†åˆ«æ˜¯ç”±ä¸¤ä¸ªCPUæ ¸å¿ƒå¤„ç†çš„ï¼Œå½“å®ƒä»¬åŒæ­¥æ•°æ®æ›´æ”¹åˆ°å…¶ä»–æ ¸å¿ƒçš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°é¡ºåºä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå³å¯¹ä¸åŒçš„æ ¸å¿ƒè¡¨ç°ä¸ºä¿®æ”¹çš„é¡ºåºä¸ä¸€è‡´ï¼Œé€ æˆæœ€ç»ˆç»“æœä¸ä¸€è‡´ã€‚ è€Œåœ¨ CPU Cache é‡Œåšåˆ°äº‹åŠ¡ä¸²è¡ŒåŒ–ï¼Œéœ€è¦åšåˆ°ä¸¤ç‚¹ï¼Œç¬¬ä¸€ç‚¹æ˜¯ä¸€ä¸ª CPU æ ¸å¿ƒå¯¹äºæ•°æ®çš„æ“ä½œï¼Œéœ€è¦åŒæ­¥é€šä¿¡ç»™åˆ°å…¶ä»– CPU æ ¸å¿ƒã€‚ç¬¬äºŒç‚¹æ˜¯ï¼Œå¦‚æœä¸¤ä¸ª CPU æ ¸å¿ƒé‡Œæœ‰åŒä¸€ä¸ªæ•°æ®çš„ Cacheï¼Œé‚£ä¹ˆå¯¹äºè¿™ä¸ª Cache æ•°æ®çš„æ›´æ–°ï¼Œéœ€è¦æœ‰ä¸€ä¸ªâ€œé”â€çš„æ¦‚å¿µã€‚åªæœ‰æ‹¿åˆ°äº†å¯¹åº” Cache Block çš„â€œé”â€ä¹‹åï¼Œæ‰èƒ½è¿›è¡Œå¯¹åº”çš„æ•°æ®æ›´æ–°ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±çœ‹çœ‹å®ç°äº†è¿™ä¸¤ä¸ªæœºåˆ¶çš„ MESI åè®®ã€‚ 2 æ€»çº¿å—…æ¢ä¸MESIåè®®2.1 æ€»çº¿å—…æ¢è¦è§£å†³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼Œé¦–å…ˆè¦è§£å†³çš„æ˜¯å¤šä¸ª CPU æ ¸å¿ƒä¹‹é—´çš„æ•°æ®ä¼ æ’­é—®é¢˜ã€‚æœ€å¸¸è§çš„ä¸€ç§è§£å†³æ–¹æ¡ˆå‘¢ï¼Œå«ä½œæ€»çº¿å—…æ¢ã€‚ è¿™ä¸ªç­–ç•¥ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯æŠŠæ‰€æœ‰çš„è¯»å†™è¯·æ±‚éƒ½é€šè¿‡æ€»çº¿ï¼ˆBusï¼‰å¹¿æ’­ç»™æ‰€æœ‰çš„ CPU æ ¸å¿ƒï¼Œç„¶åè®©å„ä¸ªæ ¸å¿ƒå»â€œå—…æ¢â€è¿™äº›è¯·æ±‚ï¼Œå†æ ¹æ®æœ¬åœ°çš„æƒ…å†µè¿›è¡Œå“åº”ã€‚ åŸºäºæ€»çº¿å—…æ¢æœºåˆ¶ï¼Œå…¶å®è¿˜å¯ä»¥åˆ†æˆå¾ˆå¤šç§ä¸åŒçš„ç¼“å­˜ä¸€è‡´æ€§åè®®ã€‚ä¸è¿‡å…¶ä¸­æœ€å¸¸ç”¨çš„ï¼Œå°±æ˜¯ä»Šå¤©æˆ‘ä»¬è¦è®²çš„ MESI åè®®ã€‚å’Œå¾ˆå¤šç°ä»£çš„ CPU æŠ€æœ¯ä¸€æ ·ï¼ŒMESI åè®®ä¹Ÿæ˜¯åœ¨ Pentium æ—¶ä»£ï¼Œè¢«å¼•å…¥åˆ° Intel CPU ä¸­çš„ã€‚ 2.2 MESIåè®®MESI åè®®ï¼Œæ˜¯ä¸€ç§å«ä½œå†™å¤±æ•ˆï¼ˆWrite Invalidateï¼‰çš„åè®®ã€‚åœ¨å†™å¤±æ•ˆåè®®é‡Œï¼Œåªæœ‰ä¸€ä¸ª CPU æ ¸å¿ƒè´Ÿè´£å†™å…¥æ•°æ®ï¼Œå…¶ä»–çš„æ ¸å¿ƒï¼Œåªæ˜¯åŒæ­¥è¯»å–åˆ°è¿™ä¸ªå†™å…¥ã€‚åœ¨è¿™ä¸ª CPU æ ¸å¿ƒå†™å…¥ Cache ä¹‹åï¼Œå®ƒä¼šå»å¹¿æ’­ä¸€ä¸ªâ€œå¤±æ•ˆâ€è¯·æ±‚å‘Šè¯‰æ‰€æœ‰å…¶ä»–çš„ CPU æ ¸å¿ƒã€‚å…¶ä»–çš„ CPU æ ¸å¿ƒï¼Œåªæ˜¯å»åˆ¤æ–­è‡ªå·±æ˜¯å¦ä¹Ÿæœ‰ä¸€ä¸ªâ€œå¤±æ•ˆâ€ç‰ˆæœ¬çš„ Cache Blockï¼Œç„¶åæŠŠè¿™ä¸ªä¹Ÿæ ‡è®°æˆå¤±æ•ˆçš„å°±å¥½äº†ã€‚ ç›¸å¯¹äºå†™å¤±æ•ˆåè®®ï¼Œè¿˜æœ‰ä¸€ç§å«ä½œå†™å¹¿æ’­ï¼ˆWrite Broadcastï¼‰çš„åè®®ã€‚åœ¨é‚£ä¸ªåè®®é‡Œï¼Œä¸€ä¸ªå†™å…¥è¯·æ±‚å¹¿æ’­åˆ°æ‰€æœ‰çš„ CPU æ ¸å¿ƒï¼ŒåŒæ—¶æ›´æ–°å„ä¸ªæ ¸å¿ƒé‡Œçš„ Cacheã€‚ å†™å¹¿æ’­åœ¨å®ç°ä¸Šè‡ªç„¶å¾ˆç®€å•ï¼Œä½†æ˜¯å†™å¹¿æ’­éœ€è¦å ç”¨æ›´å¤šçš„æ€»çº¿å¸¦å®½ã€‚å†™å¤±æ•ˆåªéœ€è¦å‘Šè¯‰å…¶ä»–çš„ CPU æ ¸å¿ƒï¼Œå“ªä¸€ä¸ªå†…å­˜åœ°å€çš„ç¼“å­˜å¤±æ•ˆäº†ï¼Œä½†æ˜¯å†™å¹¿æ’­è¿˜éœ€è¦æŠŠå¯¹åº”çš„æ•°æ®ä¼ è¾“ç»™å…¶ä»– CPU æ ¸å¿ƒã€‚ MESI åè®®çš„ç”±æ¥å‘¢ï¼Œæ¥è‡ªäºæˆ‘ä»¬å¯¹ Cache Line çš„å››ä¸ªä¸åŒçš„æ ‡è®°ï¼Œåˆ†åˆ«æ˜¯ï¼š Mï¼šä»£è¡¨å·²ä¿®æ”¹ï¼ˆModifiedï¼‰ Eï¼šä»£è¡¨ç‹¬å ï¼ˆExclusiveï¼‰ Sï¼šä»£è¡¨å…±äº«ï¼ˆSharedï¼‰ Iï¼šä»£è¡¨å·²å¤±æ•ˆï¼ˆInvalidatedï¼‰ æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹â€œå·²ä¿®æ”¹â€å’Œâ€œå·²å¤±æ•ˆâ€ï¼Œè¿™ä¸¤ä¸ªçŠ¶æ€æ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚æ‰€è°“çš„â€œå·²ä¿®æ”¹â€ï¼Œå°±æ˜¯â€œè„â€çš„ Cache Blockã€‚Cache Block é‡Œé¢çš„å†…å®¹æˆ‘ä»¬å·²ç»æ›´æ–°è¿‡äº†ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å†™å›åˆ°ä¸»å†…å­˜é‡Œé¢ã€‚è€Œæ‰€è°“çš„â€œå·²å¤±æ•ˆâ€ï¼Œè‡ªç„¶æ˜¯è¿™ä¸ª Cache Block é‡Œé¢çš„æ•°æ®å·²ç»å¤±æ•ˆäº†ï¼Œæˆ‘ä»¬ä¸å¯ä»¥ç›¸ä¿¡è¿™ä¸ª Cache Block é‡Œé¢çš„æ•°æ®ã€‚ ç„¶åï¼Œæˆ‘ä»¬å†æ¥çœ‹â€œç‹¬å â€å’Œâ€œå…±äº«â€è¿™ä¸¤ä¸ªçŠ¶æ€ã€‚è¿™å°±æ˜¯ MESI åè®®çš„ç²¾åæ‰€åœ¨äº†ã€‚æ— è®ºæ˜¯ç‹¬å çŠ¶æ€è¿˜æ˜¯å…±äº«çŠ¶æ€ï¼Œç¼“å­˜é‡Œé¢çš„æ•°æ®éƒ½æ˜¯â€œå¹²å‡€â€çš„ã€‚è¿™ä¸ªâ€œå¹²å‡€â€ï¼Œè‡ªç„¶å¯¹åº”çš„æ˜¯å‰é¢æ‰€è¯´çš„â€œè„â€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒCache Block é‡Œé¢çš„æ•°æ®å’Œä¸»å†…å­˜é‡Œé¢çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚ é‚£ä¹ˆâ€œç‹¬å â€å’Œâ€œå…±äº«â€è¿™ä¸¤ä¸ªçŠ¶æ€çš„å·®åˆ«åœ¨å“ªé‡Œå‘¢ï¼Ÿè¿™ä¸ªå·®åˆ«å°±åœ¨äºï¼Œåœ¨ç‹¬å çŠ¶æ€ä¸‹ï¼Œå¯¹åº”çš„ Cache Line åªåŠ è½½åˆ°äº†å½“å‰ CPU æ ¸æ‰€æ‹¥æœ‰çš„ Cache é‡Œã€‚å…¶ä»–çš„ CPU æ ¸ï¼Œå¹¶æ²¡æœ‰åŠ è½½å¯¹åº”çš„æ•°æ®åˆ°è‡ªå·±çš„ Cache é‡Œã€‚è¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœè¦å‘ç‹¬å çš„ Cache Block å†™å…¥æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç”±åœ°å†™å…¥æ•°æ®ï¼Œè€Œä¸éœ€è¦å‘ŠçŸ¥å…¶ä»– CPU æ ¸ã€‚ åœ¨ç‹¬å çŠ¶æ€ä¸‹çš„æ•°æ®ï¼Œå¦‚æœæ”¶åˆ°äº†ä¸€ä¸ªæ¥è‡ªäºæ€»çº¿çš„è¯»å–å¯¹åº”ç¼“å­˜çš„è¯·æ±‚ï¼Œå®ƒå°±ä¼šå˜æˆå…±äº«çŠ¶æ€ã€‚è¿™ä¸ªå…±äº«çŠ¶æ€æ˜¯å› ä¸ºï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ª CPU æ ¸å¿ƒï¼Œä¹ŸæŠŠå¯¹åº”çš„ Cache Blockï¼Œä»å†…å­˜é‡Œé¢åŠ è½½åˆ°äº†è‡ªå·±çš„ Cache é‡Œæ¥ã€‚ è€Œåœ¨å…±äº«çŠ¶æ€ä¸‹ï¼Œå› ä¸ºåŒæ ·çš„æ•°æ®åœ¨å¤šä¸ª CPU æ ¸å¿ƒçš„ Cache é‡Œéƒ½æœ‰ã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬æƒ³è¦æ›´æ–° Cache é‡Œé¢çš„æ•°æ®çš„æ—¶å€™ï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œè€Œæ˜¯è¦å…ˆå‘æ‰€æœ‰çš„å…¶ä»– CPU æ ¸å¿ƒå¹¿æ’­ä¸€ä¸ªè¯·æ±‚ï¼Œè¦æ±‚å…ˆæŠŠå…¶ä»– CPU æ ¸å¿ƒé‡Œé¢çš„ Cacheï¼Œéƒ½å˜æˆæ— æ•ˆçš„çŠ¶æ€ï¼Œç„¶åå†æ›´æ–°å½“å‰ Cache é‡Œé¢çš„æ•°æ®ã€‚è¿™ä¸ªå¹¿æ’­æ“ä½œï¼Œä¸€èˆ¬å«ä½œ RFOï¼ˆRequest For Ownershipï¼‰ï¼Œä¹Ÿå°±æ˜¯è·å–å½“å‰å¯¹åº” Cache Block æ•°æ®çš„æ‰€æœ‰æƒã€‚ å½“å‰çŠ¶æ€ äº‹ä»¶ è¡Œä¸º ä¸‹ä¸€ä¸ªçŠ¶æ€ I(Invalid) Local Read å¦‚æœå…¶å®ƒCacheæ²¡æœ‰è¿™ä»½æ•°æ®ï¼Œæœ¬Cacheä»å†…å­˜ä¸­å–æ•°æ®ï¼ŒCache lineçŠ¶æ€å˜æˆEï¼› å¦‚æœå…¶å®ƒCacheæœ‰è¿™ä»½æ•°æ®ï¼Œä¸”çŠ¶æ€ä¸ºMï¼Œåˆ™å°†æ•°æ®æ›´æ–°åˆ°å†…å­˜ï¼Œæœ¬Cacheå†ä»å†…å­˜ä¸­å–æ•°æ®ï¼Œ2ä¸ªCache çš„Cache lineçŠ¶æ€éƒ½å˜æˆSï¼› å¦‚æœå…¶å®ƒCacheæœ‰è¿™ä»½æ•°æ®ï¼Œä¸”çŠ¶æ€ä¸ºSæˆ–è€…Eï¼Œæœ¬Cacheä»å†…å­˜ä¸­å–æ•°æ®ï¼Œè¿™äº›Cache çš„Cache lineçŠ¶æ€éƒ½å˜æˆS E/S Local Write ä»å†…å­˜ä¸­å–æ•°æ®ï¼Œåœ¨Cacheä¸­ä¿®æ”¹ï¼ŒçŠ¶æ€å˜æˆMï¼› å¦‚æœå…¶å®ƒCacheæœ‰è¿™ä»½æ•°æ®ï¼Œä¸”çŠ¶æ€ä¸ºMï¼Œåˆ™è¦å…ˆå°†æ•°æ®æ›´æ–°åˆ°å†…å­˜ï¼› å¦‚æœå…¶å®ƒCacheæœ‰è¿™ä»½æ•°æ®ï¼Œåˆ™å…¶å®ƒCacheçš„Cache lineçŠ¶æ€å˜æˆI M Remote Read æ—¢ç„¶æ˜¯Invalidï¼Œåˆ«çš„æ ¸çš„æ“ä½œä¸å®ƒæ— å…³ I Remote Write æ—¢ç„¶æ˜¯Invalidï¼Œåˆ«çš„æ ¸çš„æ“ä½œä¸å®ƒæ— å…³ I E(Exclusive) Local Read ä»Cacheä¸­å–æ•°æ®ï¼ŒçŠ¶æ€ä¸å˜ E Local Write ä¿®æ”¹Cacheä¸­çš„æ•°æ®ï¼ŒçŠ¶æ€å˜æˆM M Remote Read æ•°æ®å’Œå…¶å®ƒæ ¸å…±ç”¨ï¼ŒçŠ¶æ€å˜æˆäº†S S Remote Write æ•°æ®è¢«ä¿®æ”¹ï¼Œæœ¬Cache lineä¸èƒ½å†ä½¿ç”¨ï¼ŒçŠ¶æ€å˜æˆI I S(Shared) Local Read ä»Cacheä¸­å–æ•°æ®ï¼ŒçŠ¶æ€ä¸å˜ S Local Write ä¿®æ”¹Cacheä¸­çš„æ•°æ®ï¼ŒçŠ¶æ€å˜æˆMï¼Œ å…¶å®ƒæ ¸å…±äº«çš„Cache lineçŠ¶æ€å˜æˆI M Remote Read çŠ¶æ€ä¸å˜ S Remote Write æ•°æ®è¢«ä¿®æ”¹ï¼Œæœ¬Cache lineä¸èƒ½å†ä½¿ç”¨ï¼ŒçŠ¶æ€å˜æˆI I M(Modified) Local Read ä»Cacheä¸­å–æ•°æ®ï¼ŒçŠ¶æ€ä¸å˜ M Local Write ä¿®æ”¹Cacheä¸­çš„æ•°æ®ï¼ŒçŠ¶æ€ä¸å˜ M Remote Read è¿™è¡Œæ•°æ®è¢«å†™åˆ°å†…å­˜ä¸­ï¼Œä½¿å…¶å®ƒæ ¸èƒ½ä½¿ç”¨åˆ°æœ€æ–°çš„æ•°æ®ï¼ŒçŠ¶æ€å˜æˆS S Remote Write è¿™è¡Œæ•°æ®è¢«å†™åˆ°å†…å­˜ä¸­ï¼Œä½¿å…¶å®ƒæ ¸èƒ½ä½¿ç”¨åˆ°æœ€æ–°çš„æ•°æ®ï¼Œç”±äºå…¶å®ƒæ ¸ä¼šä¿®æ”¹è¿™è¡Œæ•°æ®ï¼Œ çŠ¶æ€å˜æˆI I 3 MESIåè®®ä¸java volatileå…³é”®å­—çš„å…³ç³»æ—¢ç„¶CPUæœ‰ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼ˆMESIï¼‰ï¼Œä¸ºä»€ä¹ˆJMMè¿˜éœ€è¦volatileå…³é”®å­—ï¼Ÿ - çŸ¥ä¹ volatileçš„è¯­ä¹‰æœ‰ï¼š ä¿è¯äº†ä¸åŒçº¿ç¨‹å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œæ“ä½œæ—¶çš„å¯è§æ€§ï¼Œå³ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå˜é‡çš„å€¼ï¼Œè¿™æ–°å€¼å¯¹å…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯ç«‹å³å¯è§çš„ã€‚ ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åº å¯¹äºx86çš„ä½“ç³»ç»“æ„ï¼Œvoltileå˜é‡çš„è®¿é—®ä»£ç ä¼šè¢«javaç¼–è¯‘å™¨ç”Ÿæˆä¸ä¹±åºçš„ï¼Œå¸¦æœ‰lockæŒ‡ä»¤å‰ç¼€çš„æœºå™¨ç ã€‚è€Œlockçš„å®ç°è¿˜è¦åŒºåˆ†ï¼Œè¿™ä¸ªæ•°æ®åœ¨ä¸åœ¨CPUæ ¸å¿ƒçš„ä¸“æœ‰ç¼“å­˜ä¸­ï¼ˆä¸€èˆ¬æ˜¯æŒ‡L1/L2ï¼‰ã€‚å¦‚æœåœ¨ï¼ŒMESIæ‰æœ‰ç”¨æ­¦ä¹‹åœ°ã€‚å¦‚æœä¸æ»¡è¶³å°±ä¼šè¦ç”¨å…¶ä»–æ‰‹æ®µï¼Œæ¶‰åŠåˆ°å†…å­˜å±éšœã€‚ é€šè¿‡åæ±‡ç¼–å¯ä»¥å‘ç°ï¼ŒJavaä¸­volatileå˜é‡ä¿®é¥°çš„å…±äº«å˜é‡åœ¨è¿›è¡Œå†™æ“ä½œæ—¶å€™ä¼šå¤šå‡ºä¸€è¡Œæ±‡ç¼–ï¼š lock addl $0Ã—0,(%esp);åœ¨x86æ¶æ„ä¸­ï¼ŒLockå‰ç¼€æŒ‡ä»¤å¯ä»¥ç”¨ä½œstoreLoad barrierï¼Œåœ¨æ”¯æŒSSE2æ‹“å±•æŒ‡ä»¤é›†çš„cpuä¸Šè¿˜å¯ä»¥ä½¿ç”¨mfenceæŒ‡ä»¤ã€‚åœ¨å¤šæ ¸å¤„ç†å™¨ç¯å¢ƒä¸­ï¼Œlockå‰ç¼€æŒ‡ä»¤ä¿è¯äº†æŸä¸ªå¤„ç†å™¨å¯¹å…±äº«å†…å­˜çš„ç‹¬å ä½¿ç”¨ã€‚å†…å­˜å±éšœä¸ä»…ä»…æ˜¯MESIè¿™ä¹ˆç®€å•ã€‚ å¤šå¤„ç†å™¨æ€»çº¿å—…æ¢: ä¸ºäº†æé«˜å¤„ç†é€Ÿåº¦,å¤„ç†å™¨ä¸ç›´æ¥å’Œå†…å­˜è¿›è¡Œé€šä¿¡,è€Œæ˜¯å…ˆå°†ç³»ç»Ÿå†…å­˜çš„æ•°æ®è¯»åˆ°å†…éƒ¨ç¼“å­˜ååœ¨è¿›è¡Œæ“ä½œ,ä½†å†™å›æ“ä½œä¸çŸ¥é“è¿™ä¸ªæ›´æ”¹ä½•æ—¶å›å†™åˆ°å†…å­˜ã€‚ ä½†æ˜¯å¯¹å˜é‡ä½¿ç”¨volatileè¿›è¡Œå†™æ“ä½œæ—¶ï¼ŒJVMå°±ä¼šå‘å¤„ç†å™¨å‘é€ä¸€æ¡lockå‰ç¼€çš„æŒ‡ä»¤,å°†è¿™ä¸ªå˜é‡æ‰€åœ¨çš„ç¼“å­˜è¡Œçš„æ•°æ®å†™å›åˆ°ç³»ç»Ÿå†…å­˜ã€‚ åœ¨å¤šå¤„ç†å™¨ä¸­,ä¸ºäº†ä¿è¯å„ä¸ªå¤„ç†å™¨çš„ç¼“å­˜ä¸€è‡´æ€§ï¼Œæ¯ä¸ªå¤„ç†å™¨é€šè¿‡å—…æ¢åœ¨æ€»çº¿ä¸Šä¼ æ’­çš„æ•°æ®æ¥æ£€æŸ¥è‡ªå·±çš„ç¼“å­˜å€¼æ˜¯ä¸æ˜¯è¿‡æœŸäº†ï¼Œå¦‚æœå¤„ç†å™¨å‘ç°è‡ªå·±ç¼“å­˜è¡Œå¯¹åº”çš„å†…å­˜åœ°å€è¢«ä¿®æ”¹,å°±ä¼šå°†å½“å‰å¤„ç†å™¨çš„ç¼“å­˜è¡Œè®¾ç½®ä¸ºæ— æ•ˆçŠ¶æ€ï¼Œå°±ç›¸å½“äºå†™å›æ—¶å‘ç°çŠ¶æ€æ ‡è¯†ä¸º0å¤±æ•ˆï¼Œå½“è¿™ä¸ªå¤„ç†å™¨å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹æ“ä½œæ—¶,ä¼šé‡æ–°ä»ç³»ç»Ÿå†…å­˜ä¸­è¯»å–æ•°æ®åˆ°CPUç¼“å­˜ä¸­ã€‚","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://www.codetool.top/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"}]},{"title":"leetcode887-é¸¡è›‹æ‰è½","slug":"leetcode887-é¸¡è›‹æ‰è½","date":"2020-04-11T02:20:33.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode887-é¸¡è›‹æ‰è½/","link":"","permalink":"https://www.codetool.top/article/leetcode887-%E9%B8%A1%E8%9B%8B%E6%8E%89%E8%90%BD/","excerpt":"","text":"1 åŸé¢˜ä½ å°†è·å¾— K ä¸ªé¸¡è›‹ï¼Œå¹¶å¯ä»¥ä½¿ç”¨ä¸€æ ‹ä» 1 åˆ° N å…±æœ‰ N å±‚æ¥¼çš„å»ºç­‘ã€‚ æ¯ä¸ªè›‹çš„åŠŸèƒ½éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœä¸€ä¸ªè›‹ç¢äº†ï¼Œä½ å°±ä¸èƒ½å†æŠŠå®ƒæ‰ä¸‹å»ã€‚ ä½ çŸ¥é“å­˜åœ¨æ¥¼å±‚ F ï¼Œæ»¡è¶³ 0 &lt;= F &lt;= N ä»»ä½•ä»é«˜äº F çš„æ¥¼å±‚è½ä¸‹çš„é¸¡è›‹éƒ½ä¼šç¢ï¼Œä» F æ¥¼å±‚æˆ–æ¯”å®ƒä½çš„æ¥¼å±‚è½ä¸‹çš„é¸¡è›‹éƒ½ä¸ä¼šç ´ã€‚ æ¯æ¬¡ç§»åŠ¨ï¼Œä½ å¯ä»¥å–ä¸€ä¸ªé¸¡è›‹ï¼ˆå¦‚æœä½ æœ‰å®Œæ•´çš„é¸¡è›‹ï¼‰å¹¶æŠŠå®ƒä»ä»»ä¸€æ¥¼å±‚ X æ‰”ä¸‹ï¼ˆæ»¡è¶³ 1 &lt;= X &lt;= Nï¼‰ã€‚ ä½ çš„ç›®æ ‡æ˜¯ç¡®åˆ‡åœ°çŸ¥é“ F çš„å€¼æ˜¯å¤šå°‘ã€‚ æ— è®º F çš„åˆå§‹å€¼å¦‚ä½•ï¼Œä½ ç¡®å®š F çš„å€¼çš„æœ€å°ç§»åŠ¨æ¬¡æ•°æ˜¯å¤šå°‘ï¼Ÿ ç¤ºä¾‹ 1: è¾“å…¥ï¼š K = 1, N = 2è¾“å‡ºï¼š 2è§£é‡Šï¼šé¸¡è›‹ä» 1 æ¥¼æ‰è½ã€‚å¦‚æœå®ƒç¢äº†ï¼Œæˆ‘ä»¬è‚¯å®šçŸ¥é“ F = 0 ã€‚å¦åˆ™ï¼Œé¸¡è›‹ä» 2 æ¥¼æ‰è½ã€‚å¦‚æœå®ƒç¢äº†ï¼Œæˆ‘ä»¬è‚¯å®šçŸ¥é“ F = 1 ã€‚å¦‚æœå®ƒæ²¡ç¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬è‚¯å®šçŸ¥é“ F = 2 ã€‚å› æ­¤ï¼Œåœ¨æœ€åçš„æƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦ç§»åŠ¨ 2 æ¬¡ä»¥ç¡®å®š F æ˜¯å¤šå°‘ã€‚ ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼š K = 2, N = 6è¾“å‡ºï¼š 3 ç¤ºä¾‹ 3ï¼š è¾“å…¥ï¼š K = 3, N = 14è¾“å‡ºï¼š 4 æç¤ºï¼š 1 &lt;= K &lt;= 100 1 &lt;= N &lt;= 10000 2 è§£æ³•2.1 æ€æƒ³è¿™é“é¢˜æ˜¯ä¸€é“ç»å…¸çš„è°·æ­Œé¢è¯•é¢˜ï¼Œæ€è·¯ææ°¸ä¹è€å¸ˆè®²è¿‡ï¼šå¤å·¥å¤äº§æ‰¾å·¥ä½œï¼Ÿå…ˆæ¥çœ‹çœ‹è¿™é“é¢è¯•é¢˜ï¼šåŒè›‹é—®é¢˜_å“”å“©å“”å“© (ã‚œ-ã‚œ)ã¤ãƒ­ å¹²æ¯~-bilibili æ€»è€Œè¨€ä¹‹å°±æ˜¯åŠ¨æ€è§„åˆ’ï¼Œå®šä¹‰dp(k,n)ä¸ºæœ€å°ç§»åŠ¨æ¬¡æ•°ï¼Œå‡è®¾ç¬¬ä¸€æ¬¡åœ¨xå±‚æ¥¼å¤„æ‰”ä¸‹é¸¡è›‹ï¼Œå¦‚æœé¸¡è›‹ç¢äº†ï¼Œä»£è¡¨F&lt;xï¼Œå³è¿˜éœ€è¦dp(k-1,x-1)æ¬¡ç§»åŠ¨æ‰èƒ½æ±‚å‡ºï¼Œå¦‚æœé¸¡è›‹æ²¡ç¢ï¼Œè¿˜éœ€è¦dp(k,n-x)æ¬¡ç§»åŠ¨æ‰èƒ½æ±‚å‡ºï¼Œå–ä»–ä»¬ä¿©çš„æœ€å¤§å€¼åŠ ä¸€ï¼Œç„¶è€Œå…‰ç”¨è¿™ä¸ªæ€è·¯åœ¨leetcodeä¸­ä¼šè¶…æ—¶ï¼Œå› ä¸ºxéœ€è¦ä»1~kæšä¸¾ï¼Œè¿˜å¯ä»¥ä½¿ç”¨äºŒåˆ†æ³•è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚ 2.2 ä»£ç åŠ¨æ€è§„åˆ’ï¼šï¼ˆè¶…æ—¶ï¼‰ class Solution { public int superEggDrop(int K, int N) { int[][] dp = new int[K+1][N+1]; for(int k = 1;k&lt;K+1;k++) dp[k][1] = 1; for(int n = 1;n&lt;N+1;n++) dp[1][n] = n; for(int k = 2;k&lt;K+1;k++){ for(int n = 2;n&lt;N+1;n++){ Integer min = null; for(int div = 1;div&lt;=n;div++){ int count = Math.max(dp[k-1][div-1],dp[k][n-div])+1; if(min==null||count&lt;min) min = count; } dp[k][n] = min; } } return dp[K][N]; } } åŠ¨æ€è§„åˆ’+äºŒåˆ†ï¼š class Solution { public int superEggDrop(int K, int N) { int[][] dp = new int[K+1][N+1]; for(int k = 1;k&lt;K+1;k++) dp[k][1] = 1; for(int n = 1;n&lt;N+1;n++) dp[1][n] = n; for(int k = 2;k&lt;K+1;k++){ for(int n = 2;n&lt;N+1;n++){ //dp[k-1][div-1]ä»å°é€’å¢ï¼Œdp[k][n-div]ä»å¤§é€’å‡ï¼Œåªéœ€æ‰¾åˆ°ä¸€å¤„åˆšå¥½ä½¿å¾—dp[k-1][div-1]>=dp[k][n-div] int low = 1; int high = n; while(low&lt;high){ int div = low+(high-low+1)/2; if(dp[k-1][div-1]==dp[k][n-div]){ low = div; break; } else if(dp[k-1][div-1]>dp[k][n-div]) high = div-1; else low = div; } dp[k][n] = Math.max(dp[k-1][low-1],dp[k][n-low])+1; } } return dp[K][N]; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"è®¡ç½‘å¤ä¹ 04-ç½‘ç»œå±‚","slug":"è®¡ç½‘å¤ä¹ 04-ç½‘ç»œå±‚","date":"2020-04-10T03:55:29.000Z","updated":"2020-04-14T05:26:46.593Z","comments":true,"path":"article/è®¡ç½‘å¤ä¹ 04-ç½‘ç»œå±‚/","link":"","permalink":"https://www.codetool.top/article/%E8%AE%A1%E7%BD%91%E5%A4%8D%E4%B9%A004-%E7%BD%91%E7%BB%9C%E5%B1%82/","excerpt":"","text":"è¿™é‡Œçš„ç½‘ç»œå±‚æŒ‡çš„æ˜¯åŸç†ä½“ç³»ç»“æ„çš„ç½‘ç»œå±‚ï¼Œå¯¹åº”OSIä¸ƒå±‚ä½“ç³»ç»“æ„ä¸­çš„ç½‘ç»œå±‚ï¼Œå¯¹åº”TCP/IPå››å±‚ä½“ç³»ç»“æ„ä¸­çš„ç½‘é™…å±‚ã€‚å®ƒä¸ºä¼ è¾“å±‚æä¾›æœåŠ¡ï¼Œä¸»è¦åŠŸèƒ½ï¼š è·¯ç”±é€‰æ‹©ä¸åˆ†ç»„è½¬å‘ å¼‚æ„ç½‘ç»œäº’è” æ‹¥å¡æ§åˆ¶ è‹¥æ‰€æœ‰ç»“ç‚¹éƒ½æ¥ä¸åŠæ¥å—åˆ†ç»„ï¼Œè€Œè¦ä¸¢å¼ƒå¤§é‡åˆ†ç»„çš„è¯ï¼Œç½‘ç»œå°±å¤„äºæ‹¥å¡çŠ¶æ€ã€‚å› æ­¤è¦é‡‡å–ä¸€å®šæªæ–½ï¼Œç¼“è§£è¿™ç§æ‹¥å¡ã€‚ è§£å†³æ–¹æ¡ˆï¼šå¼€ç¯æ§åˆ¶ã€é—­ç¯æ§åˆ¶ 1 æä¾›çš„ä¸¤ç§æœåŠ¡ æ•°æ®æŠ¥æ–¹å¼ä¸ºç½‘ç»œå±‚æä¾›æ— è¿æ¥æœåŠ¡ï¼Œè™šç”µè·¯æ–¹å¼ä¸ºç½‘ç»œå±‚æä¾›è¿æ¥æœåŠ¡ã€‚ æ— è¿æ¥æœåŠ¡:ä¸äº‹å…ˆä¸ºåˆ†ç»„çš„ä¼ è¾“ç¡®å®šä¼ è¾“è·¯å¾„ï¼Œæ¯ä¸ªåˆ†ç»„ç‹¬ç«‹ç¡®å®šä¼ è¾“è·¯å¾„ï¼Œä¸åŒåˆ†ç»„ä¼ è¾“è·¯å¾„å¯èƒ½ä¸åŒã€‚ è¿æ¥æœåŠ¡:é¦–å…ˆä¸ºåˆ†ç»„çš„ä¼ è¾“ç¡®å®šä¼ è¾“è·¯å¾„(å»ºç«‹è¿æ¥)ï¼Œç„¶åæ²¿è¯¥è·¯å¾„(è¿æ¥)ä¼ è¾“ç³»åˆ—åˆ†ç»„ï¼Œç³»åˆ—åˆ†ç»„ä¼ è¾“è·¯å¾„ç›¸åŒï¼Œä¼ è¾“ç»“æŸåæ‹†é™¤è¿æ¥ã€‚ ç½‘ç»œå±‚çš„æœ€å°æ•°æ®å•å…ƒæ˜¯æ•°æ®åŒ…ï¼ˆåœ¨TCP/IPä½“ç³»ç»“æ„é‡Œç§°ä¸ºIPæ•°æ®æŠ¥ï¼‰æˆ–åˆ†ç»„ã€‚ 1.1 æ•°æ®æŠ¥æ¯ä¸ªåˆ†ç»„æºå¸¦æºå’Œç›®çš„åœ°å€ã€‚ è·¯ç”±å™¨æ ¹æ®åˆ†ç»„çš„ç›®çš„åœ°å€è½¬å‘åˆ†ç»„: åŸºäºè·¯ç”±åè®®/ç®—æ³•æ„å»ºè½¬å‘è¡¨ æ£€ç´¢è½¬å‘è¡¨ æ¯ä¸ªåˆ†ç»„ç‹¬ç«‹é€‰è·¯ã€‚ 1.2 è™šç”µè·¯è™šç”µè·¯å°†æ•°æ®æŠ¥æ–¹å¼å’Œç”µè·¯äº¤æ¢æ–¹å¼ç»“åˆï¼Œä»¥å‘æŒ¥ä¸¤è€…ä¼˜ç‚¹ã€‚ è™šç”µè·¯:ä¸€æ¡æºä¸»æœºåˆ°ç›®çš„ä¸»æœºç±»ä¼¼äºç”µè·¯çš„è·¯å¾„(é€»è¾‘è¿æ¥)ï¼Œè·¯å¾„ä¸Šæ‰€æœ‰ç»“ç‚¹éƒ½è¦ç»´æŒè¿™æ¡è™šç”µè·¯çš„å»ºç«‹ï¼Œéƒ½ç»´æŒä¸€å¼ è™šç”µè·¯è¡¨ï¼Œæ¯ä¸€é¡¹è®°å½•äº†ä¸€ä¸ªæ‰“å¼€çš„è™šç”µè·¯çš„ä¿¡æ¯ã€‚ è™šç”µè·¯çš„é€šä¿¡è¿‡ç¨‹ å»ºç«‹è¿æ¥ æ•°æ®ä¼ è¾“ é‡Šæ”¾è¿æ¥ å»ºç«‹è¿æ¥æ—¶æºå¸¦ç›®çš„åœ°å€ï¼Œé€šä¿¡æ—¶æ¯ä¸ªåˆ†ç»„æºå¸¦è™šç”µè·¯å·ï¼Œè€Œéç›®çš„åœ°å€ã€‚ 2 ç½‘é™…åè®®IP 2.1 IPæ•°æ®æŠ¥æ ¼å¼IPæ•°æ®æŠ¥åˆ†ä¸ºé¦–éƒ¨å’Œæ•°æ®éƒ¨åˆ†ï¼Œæ•°æ®éƒ¨åˆ†æ˜¯ä¼ è¾“å±‚ä¸‹å‘çš„å†…å®¹ã€‚ é¦–éƒ¨æ ¼å¼ï¼š 20å­—èŠ‚å›ºå®šéƒ¨åˆ† å¯å˜éƒ¨åˆ† ç‰ˆæœ¬ï¼šåŒºåˆ†IPv4/IPv6ã€‚IPåè®®æ›¾æœ‰v1ã€v2ã€v3ç­‰æ—©æœŸç‰ˆæœ¬ï¼Œä½†å› ä¸ºä¸å¤Ÿå®Œå–„è€Œæ²¡æœ‰å¯¹å¤–å‘å¸ƒï¼Œè€Œv5åˆ™æ˜¯ä»…ç”¨äºå®éªŒå®¤å†…éƒ¨ç ”ç©¶ï¼Œä¹Ÿä»æœªå…¬å¼€ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°çš„åªæœ‰v4å’Œv6ä¸¤ä¸ªç‰ˆæœ¬ã€‚ é¦–éƒ¨é•¿åº¦ï¼šå•ä½ä¸º4Bï¼Œæœ€å°ä¸º5ã€‚ åŒºåˆ†æœåŠ¡ï¼šæŒ‡ç¤ºæœŸæœ›è·å¾—å“ªç§ç±»å‹çš„æœåŠ¡ã€‚ æ€»é•¿åº¦ï¼šé¦–éƒ¨+æ•°æ®ï¼Œå•ä½æ˜¯1Bã€‚ ç”Ÿå­˜æ—¶é—´(TTL)ï¼šIPåˆ†ç»„çš„ä¿è´¨æœŸã€‚ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨-1ï¼Œå˜æˆ0åˆ™ä¸¢å¼ƒã€‚ åè®®ï¼šæ•°æ®éƒ¨åˆ†çš„åè®® é¦–éƒ¨æ£€éªŒå’Œï¼šåªæ£€éªŒé¦–éƒ¨ å¯å˜éƒ¨åˆ†çš„å¡«å……å¿…é¡»æŠŠé¦–éƒ¨å¡«å……ä¸º4å­—èŠ‚çš„æ•´æ•°å€ã€‚ 2.2 IPæ•°æ®æŠ¥çš„åˆ†ç‰‡å› ä¸ºIPæ•°æ®æŠ¥ç»è¿‡é“¾è·¯å±‚éœ€è¦ä½œä¸ºæ•°æ®éƒ¨åˆ†è£…é…ä¸ºæ•°æ®å¸§ï¼Œæ•°æ®å¸§çš„æ•°æ®éƒ¨åˆ†å…·æœ‰æœ€å¤§é•¿åº¦ï¼Œå³MTUï¼Œé€šå¸¸æ˜¯1500å­—èŠ‚ã€‚å¦‚æœIPæ•°æ®æŠ¥å¤§äºè¿™ä¸ªé•¿åº¦ï¼Œéœ€è¦åˆ†ç‰‡ã€‚ é¦–éƒ¨ä¸­ï¼Œæœ‰ä¸‰ä¸ªå­—æ®µå’Œåˆ†ç‰‡æœ‰è”ç³»ï¼š æ ‡è¯†ï¼šåŒä¸€æ•°æ®æŠ¥çš„åˆ†ç‰‡ä½¿ç”¨åŒä¸€æ ‡è¯†ã€‚ æ ‡å¿—ï¼šä¸‰ä½ï¼Œåªæœ‰æœ€åä¸¤ä½æœ‰æ„ä¹‰ ä¸­é—´ä½DF=1ä»£è¡¨ç¦æ­¢åˆ†ç‰‡ï¼ŒDF=0ä»£è¡¨å…è®¸åˆ†ç‰‡ã€‚ æœ€ä½ä½MF=1ä»£è¡¨åé¢è¿˜æœ‰åˆ†ç‰‡ï¼ŒMF=0ä»£è¡¨æœ€åä¸€ç‰‡/æ²¡æœ‰åˆ†ç‰‡ ç‰‡åç§»ï¼šæŒ‡å‡ºè¾ƒé•¿åˆ†ç»„åˆ†ç‰‡å,æŸç‰‡åœ¨åŸåˆ†ç»„ä¸­çš„ç›¸å¯¹ä½ç½®ï¼Œä»¥8Bä¸ºå•ä½ã€‚ 2.3 IPåœ°å€32ä½ï¼Œåˆ†ä¸ºç½‘ç»œå·å’Œä¸»æœºå·ï¼Œé€šå¸¸è¡¨ç¤ºä¸ºç‚¹åˆ†åè¿›åˆ¶ã€‚ 2.3.1 åˆ†ç±»çš„IPåœ°å€ ç‰¹æ®Šçš„IPåœ°å€ï¼š NetIDç½‘ç»œå· HostIDä¸»æœºå· ä½œä¸ºIPåˆ†ç»„æºåœ°å€ ä½œä¸ºIPåˆ†ç»„ç›®çš„åœ°å€ ç”¨é€” å…¨0 å…¨0 å¯ä»¥ ä¸å¯ä»¥ æœ¬ç½‘èŒƒå›´å†…è¡¨ç¤ºä¸»æœºï¼Œè·¯ç”±è¡¨ä¸­ç”¨äºè¡¨ç¤ºé»˜è®¤è·¯ç”±(è¡¨ç¤ºæ•´ä¸ªInternetç½‘ç»œ) å…¨0 ç‰¹å®šå€¼ ä¸å¯ä»¥ å¯ä»¥ è¡¨ç¤ºæœ¬ç½‘å†…æŸä¸ªç‰¹å®šä¸»æœº å…¨1 å…¨1 ä¸å¯ä»¥ å¯ä»¥ æœ¬ç½‘å¹¿æ’­åœ°å€(è·¯ç”±å™¨ä¸è½¬å‘) ç‰¹å®šå€¼ å…¨0 ä¸å¯ä»¥ ä¸å¯ä»¥ ç½‘ç»œåœ°å€ï¼Œè¡¨ç¤ºä¸€ä¸ªç½‘ç»œ ç‰¹å®šå€¼ å…¨1 ä¸å¯ä»¥ å¯ä»¥ ç›´æ¥å¹¿æ’­åœ°å€ï¼Œå¯¹ç‰¹å®šç½‘ç»œä¸Šçš„æ‰€æœ‰ä¸»æœºè¿›è¡Œå¹¿æ’­ 127 ä»»ä½•æ•°(éå…¨0/1) å¯ä»¥ å¯ä»¥ ç”¨äºæœ¬åœ°è½¯ä»¶æ¢å›æµ‹è¯•ï¼Œç§°ä¸ºç¯å›åœ°å€ ç§æœ‰IPåœ°å€ï¼š åœ°å€ç±»åˆ« åœ°å€èŒƒå›´ ç½‘æ®µä¸ªæ•° Aç±» 10.0.0.0~10.255.255.255 1 Bç±» 172.16.0.0~172.31.255.255 16 Cç±» 192.168.0.0~192.168.255.255 256 Aã€Bã€Cä¸‰ç±»åœ°å€èŒƒå›´ï¼š ç½‘ç»œç±»åˆ« æœ€å¤§å¯ç”¨ç½‘ç»œæ•° ç¬¬ä¸€ä¸ªå¯ç”¨çš„ç½‘ç»œå· æœ€åä¸€ä¸ªå¯ç”¨çš„ç½‘ç»œå· æ¯ä¸ªç½‘ç»œä¸­çš„æœ€å¤§ä¸»æœºæ•° A 27-2 1 126 224-2 B 214-1 128.1 191.255 216-2 C 221-1 192.0.1 223.255.255 28-2 è·¯ç”±å™¨å¯¹ç›®çš„åœ°å€æ˜¯ç§æœ‰IPåœ°å€çš„æ•°æ®æŠ¥ä¸€å¾‹ä¸è¿›è¡Œè½¬å‘ã€‚ 2.4 ç½‘ç»œåœ°å€è½¬æ¢NATç½‘ç»œåœ°å€è½¬æ¢NAT(Network Address Translation) :åœ¨ä¸“ç”¨ç½‘è¿æ¥åˆ°å› ç‰¹ç½‘çš„è·¯ç”±å™¨ä¸Šå®‰è£…NATè½¯ä»¶ï¼Œå®‰è£…äº†NATè½¯ä»¶çš„è·¯ç”±å™¨å«NATè·¯ç”±å™¨ï¼Œå®ƒè‡³å°‘æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„å¤–éƒ¨å…¨çƒIPåœ°å€ã€‚ NATè·¯ç”±å™¨æœ‰ä¸€ä¸ªNATè½¬æ¢è¡¨ã€‚ 2.5 IPç»„æ’­/å¤šæ’­å½“ç½‘ç»œä¸­çš„æŸäº›ç”¨æˆ·éœ€è¦ç‰¹å®šæ•°æ®æ—¶ï¼Œç»„æ’­æ•°æ®å‘é€è€…ä»…å‘é€ä¸€æ¬¡æ•°æ®ï¼Œå€ŸåŠ©ç»„æ’­è·¯ç”±åè®®ä¸ºç»„æ’­æ•°æ®åŒ…å»ºç«‹ç»„æ’­åˆ†å‘æ ‘ï¼Œè¢«ä¼ é€’çš„æ•°æ®åˆ°è¾¾è·ç¦»ç”¨æˆ·ç«¯å°½å¯èƒ½è¿‘çš„èŠ‚ç‚¹åæ‰å¼€å§‹å¤åˆ¶å’Œåˆ†å‘ï¼Œæ˜¯ä¸€ç§ç‚¹å¯¹å¤šç‚¹ä¼ è¾“æ–¹å¼ã€‚ ç»„æ’­æé«˜äº†æ•°æ®ä¼ é€æ•ˆç‡ã€‚å‡å°‘äº†ä¸»å¹²ç½‘å‡ºç°æ‹¥å¡çš„å¯èƒ½æ€§ã€‚ç»„æ’­ç»„ä¸­çš„ä¸»æœºå¯ä»¥æ˜¯åœ¨åŒä¸€ä¸ªç‰©ç†ç½‘ç»œï¼Œä¹Ÿå¯ä»¥æ¥è‡ªä¸åŒçš„ç‰©ç†ç½‘ç»œ(å¦‚æœæœ‰ç»„æ’­è·¯ç”±å™¨çš„æ”¯æŒ)ã€‚ IPç»„æ’­åœ°å€è®©æºè®¾å¤‡èƒ½å¤Ÿå°†åˆ†ç»„å‘é€ç»™ä¸€ç»„è®¾å¤‡ã€‚ å±äºå¤šæ’­ç»„çš„è®¾å¤‡å°†è¢«åˆ†é…ä¸€ä¸ªç»„æ’­ç»„IPåœ°å€ï¼ˆä¸€ç¾¤å…±åŒéœ€æ±‚ä¸»æœºçš„ç›¸åŒæ ‡è¯†ï¼‰ ç»„æ’­åœ°å€èŒƒå›´ä¸º224.0.0.0~239.255.255.255 (Dç±»åœ°å€)ï¼Œä¸€ä¸ªDç±»åœ°å€è¡¨ç¤ºä¸€ä¸ªç»„æ’­ç»„ã€‚åªèƒ½ç”¨ä½œåˆ†ç»„çš„ç›®æ ‡åœ°å€ã€‚æºåœ°å€æ€»æ˜¯ä¸ºå•æ’­åœ°å€ã€‚ ç‰¹ç‚¹ï¼š ç»„æ’­æ•°æ®æŠ¥ä¹Ÿæ˜¯â€œå°½æœ€å¤§åŠªåŠ›äº¤ä»˜â€ï¼Œä¸æä¾›å¯é äº¤ä»˜ï¼Œåº”ç”¨äºUDP å¯¹ç»„æ’­æ•°æ®æŠ¥ä¸äº§ç”ŸICMPå·®é”™æŠ¥æ–‡ã€‚ å¹¶éæ‰€æœ‰Dç±»åœ°å€éƒ½å¯ä»¥ä½œä¸ºç»„æ’­åœ°å€ã€‚ åŒå•æ’­åœ°å€ä¸€æ ·ï¼Œç»„æ’­IPåœ°å€ä¹Ÿéœ€è¦ç›¸åº”çš„ç»„æ’­MACåœ°å€åœ¨æœ¬åœ°ç½‘ç»œä¸­å®é™…ä¼ é€å¸§ã€‚ç»„æ’­MACåœ°å€ä»¥åå…­è¿›åˆ¶å€¼01-00-5Eæ‰“å¤´ï¼Œä½™ä¸‹çš„6ä¸ªåå…­è¿›åˆ¶ä½æ˜¯æ ¹æ®IPç»„æ’­ç»„åœ°å€çš„æœ€å23ä½è½¬æ¢å¾—åˆ°çš„ã€‚ 2.6 ARPåè®®ARPåè®®å°†IPåœ°å€è§£æä¸ºç¡¬ä»¶ï¼ˆmacï¼‰åœ°å€ï¼Œå±äºæ•°æ®é“¾è·¯å±‚åè®®ã€‚ å¯¹äºæ¯ä¸ªä¸»æœºï¼Œéƒ½æœ‰ä¸€ä»½ARPé«˜é€Ÿç¼“å­˜ï¼Œé‡Œé¢å­˜çš„æ˜¯å·²çŸ¥ä¸»æœºIPåœ°å€åˆ°ç¡¬ä»¶åœ°å€çš„æ˜ å°„è¡¨ã€‚ARPç¼“å­˜æ˜¯æœ‰ä¸€å®šè¿‡æœŸæ—¶é—´çš„ã€‚ å¦‚ä½•è·å–è¿™ä¸ªæ˜ å°„è¡¨çš„æ•°æ®ï¼Ÿå‡è®¾å½“å‰ä¸»æœºç¼ºå°‘ä¸€ä¸ªIPåœ°å€å¯¹macåœ°å€çš„æ˜ å°„æ•°æ®ï¼Œå®ƒé¦–å…ˆä¼šæ£€æŸ¥è¿™ä¸ªIPæ˜¯å¦æ˜¯åŒä¸€ä¸ªç½‘æ®µå†…çš„ï¼Œå¦‚æœæ˜¯åˆ™å®ƒä¼šå‘å½“å‰å±€åŸŸç½‘å¹¿æ’­ä¸€ä¸ªARPè¯·æ±‚åˆ†ç»„ï¼Œç›®çš„macåœ°å€å¯ä»¥å¡«å†™FF-FF-FF-FF-FF-FFã€‚ç›®æ ‡ä¸»æœºï¼ˆå‘ç°è‡ªå·±çš„IPå»åˆï¼‰æ”¶åˆ°è¯¥åˆ†ç»„ä¹‹åï¼Œä¼šå“åº”ä¸€ä¸ªå•æ’­ARPå“åº”åˆ†ç»„ï¼Œé™„å¸¦è‡ªå·±çš„macåœ°å€ã€‚ å¦‚æœç›®çš„ä¸»æœºä¸åœ¨å½“å‰å±€åŸŸç½‘ï¼Œé¦–å…ˆæŸ¥è¯¢é»˜è®¤ç½‘å…³çš„IPåœ°å€ï¼Œå°†è¯¥åˆ†ç»„å‘å¾€é»˜è®¤ç½‘å…³ï¼Œç›®çš„macåœ°å€å¡«å†™é»˜è®¤ç½‘å…³çš„macåœ°å€ï¼Œè·¯ç”±å™¨å†å¸®å¿™è½¬å‘è¯¥åˆ†ç»„ã€‚ ARPåè®®4ç§å…¸å‹æƒ…å†µ: ä¸»æœºAå‘ç»™æœ¬ç½‘ç»œä¸Šçš„ä¸»æœºBï¼šç”¨ARPæ‰¾åˆ°ä¸»æœºBçš„ç¡¬ä»¶åœ°å€ ä¸»æœºAå‘ç»™å¦ä¸€ç½‘ç»œä¸Šçš„ä¸»æœºBï¼šç”¨ARPæ‰¾åˆ°æœ¬ç½‘ç»œä¸Šä¸€ä¸ªè·¯ç”±å™¨(ç½‘å…³)çš„ç¡¬ä»¶åœ°å€ è·¯ç”±å™¨å‘ç»™æœ¬ç½‘ç»œçš„ä¸»æœºAï¼šç”¨ARPæ‰¾åˆ°ä¸»æœºAçš„ç¡¬ä»¶åœ°å€ è·¯ç”±å™¨å‘ç»™å¦ä¸€ç½‘ç»œçš„ä¸»æœºBï¼šç”¨ARPæ‰¾åˆ°æœ¬ç½‘ç»œä¸Šçš„ä¸€ä¸ªè·¯ç”±å™¨çš„ç¡¬ä»¶åœ°å€ 2.7 DHCPåè®®ä¸»æœºå¦‚ä½•è·å¾—IPåœ°å€ï¼Ÿ é™æ€é…ç½® åŠ¨æ€é…ç½® åŠ¨æ€ä¸»æœºé…ç½®åè®®DHCPæ˜¯åº”ç”¨å±‚åè®®ï¼Œä½¿ç”¨å®¢æˆ·/æœåŠ¡å™¨æ–¹å¼ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é€šè¿‡å¹¿æ’­æ–¹å¼è¿›è¡Œäº¤äº’ï¼ŒåŸºäºUDPã€‚ DHCPæä¾›å³æ’å³ç”¨è”ç½‘çš„æœºåˆ¶ï¼Œä¸»æœºå¯ä»¥ä»æœåŠ¡å™¨åŠ¨æ€è·å–IPåœ°å€ã€å­ç½‘æ©ç ã€é»˜è®¤ç½‘å…³ã€DNSæœåŠ¡å™¨åç§°ä¸IPåœ°å€ï¼Œå…è®¸åœ°å€é‡ç”¨ï¼Œæ”¯æŒç§»åŠ¨ç”¨æˆ·åŠ å…¥ç½‘ç»œï¼Œæ”¯æŒåœ¨ç”¨åœ°å€ç»­ç§Ÿã€‚ ä¸»æœºä»DHCPæœåŠ¡å™¨è·å–IPæµç¨‹ï¼š ä¸»æœºå¹¿æ’­DHCPå‘ç°æŠ¥æ–‡ DHCPæœåŠ¡å™¨å¹¿æ’­DHCPæä¾›æŠ¥æ–‡ ä¸»æœºå¹¿æ’­DHCPè¯·æ±‚æŠ¥æ–‡ DHCPæœåŠ¡å™¨å¹¿æ’­DHCPç¡®è®¤æŠ¥æ–‡ ä¸ºä»€ä¹ˆç¬¬äºŒæ­¥ã€ç¬¬ä¸‰æ­¥ã€ç¬¬å››æ­¥è¿˜æ˜¯å¹¿æ’­ï¼Ÿå› ä¸ºç¬¬ä¸€æ­¥ä¸­å¯èƒ½æœ‰å¤šå°DHCPæœåŠ¡å™¨æ”¶åˆ°å‘ç°æŠ¥æ–‡å¹¶æå‰å‡†å¤‡å¥½ä¸€ä¸ªå¯ç”¨çš„IPã€‚ç¬¬äºŒæ­¥ä¸­å‘é€æä¾›æŠ¥æ–‡ç»™ç›®æ ‡ä¸»æœºï¼Œç„¶è€Œç›®æ ‡ä¸»æœºæ­¤æ—¶è¿˜æ²¡æœ‰IPåœ°å€ï¼Œäºæ˜¯ä»ä½¿ç”¨å¹¿æ’­åœ°å€ï¼Œç¬¬ä¸‰æ­¥ä¸­ä¸»æœºé€šå¸¸ä¼šé€‰æ‹©ç¬¬ä¸€ä¸ªæ”¶åˆ°çš„æä¾›æŠ¥æ–‡å¯¹åº”çš„DHCPæœåŠ¡å™¨ï¼Œå¹¶å¹¿æ’­ä¸€ä¸ªè¯·æ±‚æŠ¥æ–‡ï¼Œå¹¿æ’­è¯¥è¯·æ±‚æŠ¥æ–‡çš„æ„ä¹‰åœ¨äºï¼Œå…¶ä»–DHCPæœåŠ¡å™¨æ¥æ”¶åˆ°è¯¥æŠ¥æ–‡åï¼Œä¾¿çŸ¥é“å¯¹åº”çš„ä¸»æœºå·²ç»æœ‰äº†IPæä¾›è€…ï¼Œå¯ä»¥æ”¶å›è‡ªå·±å‡†å¤‡çš„IPåœ°å€äº†ã€‚ç¬¬å››æ­¥åŸå› åŒç¬¬äºŒæ­¥ã€‚ 2.8 ICMPåè®®ICMPåè®®æ”¯æŒä¸»æœºæˆ–è·¯ç”±å™¨ï¼ŒåŠŸèƒ½ï¼š å·®é”™(æˆ–å¼‚å¸¸)æŠ¥å‘Šï¼Œå¯¹åº”ICMPå·®é”™æŠ¥å‘ŠæŠ¥æ–‡ ç½‘ç»œæ¢è¯¢ï¼Œå¯¹åº”ICMPè¯¢é—®æŠ¥æ–‡ï¼Œé‡è¦çš„åº”ç”¨æ˜¯ping ICMPæŠ¥æ–‡æ ¼å¼ï¼š ç±»å‹åˆåˆ†ä¸¤å¤§ç±»ï¼š ICMPå·®é”™æŠ¥å‘ŠæŠ¥æ–‡ï¼š ç»ˆç‚¹ä¸å¯è¾¾ï¼šå½“è·¯ç”±å™¨æˆ–ä¸»æœºä¸èƒ½äº¤ä»˜æ•°æ®æŠ¥æ—¶å°±å‘æºç‚¹å‘é€ç»ˆç‚¹ä¸å¯è¾¾æŠ¥æ–‡ã€‚ æºç‚¹æŠ‘åˆ¶ï¼šå½“è·¯ç”±å™¨æˆ–ä¸»æœºç”±äºæ‹¥å¡è€Œä¸¢å¼ƒæ•°æ®æŠ¥æ—¶ï¼Œå°±å‘æºç‚¹å‘é€æºç‚¹æŠ‘åˆ¶æŠ¥æ–‡ï¼Œä½¿æºç‚¹çŸ¥é“åº”å½“æŠŠæ•°æ®æŠ¥çš„å‘é€é€Ÿç‡æ”¾æ…¢ã€‚ï¼ˆè¯¥ç±»å‹ä¸å†ä½¿ç”¨ï¼‰ æ—¶é—´è¶…è¿‡ï¼šå½“è·¯ç”±å™¨æ”¶åˆ°ç”Ÿå­˜æ—¶é—´TTL=0çš„æ•°æ®æŠ¥æ—¶ï¼Œé™¤ä¸¢å¼ƒè¯¥æ•°æ®æŠ¥å¤–ï¼Œè¿˜è¦å‘æºç‚¹å‘é€æ—¶é—´è¶…è¿‡æŠ¥æ–‡ã€‚å½“ç»ˆç‚¹åœ¨é¢„å…ˆè§„å®šçš„æ—¶é—´å†…ä¸èƒ½æ”¶åˆ°ä¸€ä¸ªæ•°æ®æŠ¥çš„å…¨éƒ¨æ•°æ®æŠ¥ç‰‡æ—¶ï¼Œå°±æŠŠå·²æ”¶åˆ°çš„æ•°æ®æŠ¥ç‰‡éƒ½ä¸¢å¼ƒï¼Œå¹¶å‘æºç‚¹å‘é€æ—¶é—´è¶…è¿‡æŠ¥æ–‡ã€‚ å‚æ•°é—®é¢˜ï¼šå½“è·¯ç”±å™¨æˆ–ç›®çš„ä¸»æœºæ”¶åˆ°çš„æ•°æ®æŠ¥çš„é¦–éƒ¨ä¸­æœ‰çš„å­—æ®µçš„å€¼ä¸æ­£ç¡®æ—¶ï¼Œå°±ä¸¢å¼ƒè¯¥æ•°æ®æŠ¥ï¼Œå¹¶å‘æºç‚¹å‘é€å‚æ•°é—®é¢˜æŠ¥æ–‡ã€‚ æ”¹å˜è·¯ç”±ï¼ˆé‡å®šå‘ï¼‰ï¼šè·¯ç”±å™¨æŠŠæ”¹å˜è·¯ç”±æŠ¥æ–‡å‘é€ç»™ä¸»æœºï¼Œè®©ä¸»æœºçŸ¥é“ä¸‹æ¬¡åº”å°†æ•°æ®æŠ¥å‘é€ç»™å¦å¤–çš„è·¯ç”±å™¨(å¯é€šè¿‡æ›´å¥½çš„è·¯ç”±)ã€‚ ICMPè¯¢é—®æŠ¥æ–‡ï¼š å›é€è¯·æ±‚å’Œå›ç­”æŠ¥æ–‡ï¼šä¸»æœºæˆ–è·¯ç”±å™¨å‘ç‰¹å®šç›®çš„ä¸»æœºå‘å‡ºçš„è¯¢é—®ï¼Œæ”¶åˆ°æ­¤æŠ¥æ–‡çš„ä¸»æœºå¿…é¡»ç»™æºä¸»æœºæˆ–è·¯ç”±å™¨å‘é€ICMPå›é€å›ç­”æŠ¥æ–‡ã€‚ï¼ˆPINGçš„åŸç†ï¼‰ æ—¶é—´æˆ³è¯·æ±‚å’Œå›ç­”æŠ¥æ–‡ï¼šè¯·æŸä¸ªä¸»æœºæˆ–è·¯ç”±å™¨å›ç­”å½“å‰çš„æ—¥æœŸå’Œæ—¶é—´ã€‚ç”¨æ¥è¿›è¡Œæ—¶é’ŸåŒæ­¥å’Œæµ‹é‡æ—¶é—´ã€‚ ä¸åº”å‘é€ICMPå·®é”™æŠ¥æ–‡çš„æƒ…å†µï¼š å¯¹ICMPå·®é”™æŠ¥å‘ŠæŠ¥æ–‡ä¸å†å‘é€ICMPå·®é”™æŠ¥å‘ŠæŠ¥æ–‡ã€‚ å¯¹ç¬¬ä¸€ä¸ªåˆ†ç‰‡çš„æ•°æ®æŠ¥ç‰‡çš„æ‰€æœ‰åç»­æ•°æ®æŠ¥ç‰‡éƒ½ä¸å‘é€ICMPå·®é”™æŠ¥å‘ŠæŠ¥æ–‡ã€‚ å¯¹å…·æœ‰ç»„æ’­åœ°å€çš„æ•°æ®æŠ¥éƒ½ä¸å‘é€ICMPå·®é”™æŠ¥å‘ŠæŠ¥æ–‡ã€‚ å¯¹å…·æœ‰ç‰¹æ®Šåœ°å€(å¦‚127.0.0.0æˆ–0.0.0.0)çš„æ•°æ®æŠ¥ä¸å‘é€ICMPå·®é”™æŠ¥å‘ŠæŠ¥æ–‡ã€‚ 2.9 IGMPåè®®äº’è”ç½‘ç»„ç®¡ç†åè®®ï¼ˆIGMPï¼‰æ˜¯å› ç‰¹ç½‘åè®®å®¶æ—ä¸­çš„ä¸€ä¸ªç»„æ’­åè®®ï¼ŒTCP/IPåè®®æ—çš„ä¸€ä¸ªå­åè®®ï¼Œç”¨äºIPä¸»æœºå‘ä»»ä¸€ä¸ªç›´æ¥ç›¸é‚»çš„è·¯ç”±å™¨æŠ¥å‘Šä»–ä»¬çš„ç»„æˆå‘˜æƒ…å†µã€‚å…è®¸Internetä¸»æœºå‚åŠ å¤šæ’­ï¼Œä¹Ÿæ˜¯IPä¸»æœºç”¨ä½œå‘ç›¸é‚»å¤šç›®è·¯ç”±å™¨æŠ¥å‘Šå¤šç›®ç»„æˆå‘˜çš„åè®®ã€‚å¤šç›®è·¯ç”±å™¨æ˜¯æ”¯æŒç»„æ’­çš„è·¯ç”±å™¨ï¼Œå‘æœ¬åœ°ç½‘ç»œå‘é€IGMPæŸ¥è¯¢ã€‚ä¸»æœºé€šè¿‡å‘é€IGMPæŠ¥å‘Šæ¥åº”ç­”æŸ¥è¯¢ã€‚ç»„æ’­è·¯ç”±å™¨è´Ÿè´£å°†ç»„æ’­åŒ…è½¬å‘åˆ°æ‰€æœ‰ç½‘ç»œä¸­ç»„æ’­æˆå‘˜ã€‚ IGMPåè®®è®©è·¯ç”±å™¨çŸ¥é“æœ¬å±€åŸŸç½‘ä¸Šæ˜¯å¦æœ‰ä¸»æœº(çš„è¿›ç¨‹)å‚åŠ æˆ–é€€å‡ºäº†æŸä¸ªç»„æ’­ç»„ã€‚ IGMPå·¥ä½œçš„ä¸¤ä¸ªé˜¶æ®µ æŸä¸»æœºè¦åŠ å…¥ç»„æ’­ç»„æ—¶ï¼Œè¯¥ä¸»æœºå‘ç»„æ’­ç»„çš„ç»„æ’­åœ°å€å‘é€ä¸€- ä¸ªIGMPæŠ¥æ–‡ï¼Œå£°æ˜è‡ªå·±è¦ç§°ä¸ºè¯¥ç»„çš„æˆå‘˜ã€‚æœ¬åœ°ç»„æ’­è·¯ç”±å™¨æ”¶åˆ°IGMPæŠ¥æ–‡åï¼Œè¦åˆ©ç”¨ç»„æ’­è·¯ç”±é€‰æ‹©åè®®æŠŠè¿™ç»„æˆå‘˜å…³ç³»å‘ç»™å› ç‰¹ç½‘ä¸Šçš„å…¶ä»–ç»„æ’­è·¯ç”±å™¨ã€‚ æœ¬åœ°ç»„æ’­è·¯ç”±å™¨å‘¨æœŸæ€§æ¢è¯¢æœ¬åœ°å±€åŸŸç½‘ä¸Šçš„ä¸»æœºï¼Œä»¥ä¾¿çŸ¥é“è¿™äº›ä¸»æœºæ˜¯å¦è¿˜æ˜¯ç»„æ’­ç»„çš„æˆå‘˜ã€‚åªè¦æœ‰ä¸€ä¸ªä¸»æœºå¯¹æŸä¸ªç»„å“åº”ï¼Œé‚£ä¹ˆç»„æ’­è·¯ç”±å™¨å°±è®¤ä¸ºè¿™ä¸ªç»„æ˜¯æ´»è·ƒçš„:å¦‚æœç»è¿‡å‡ æ¬¡æ¢è¯¢åæ²¡æœ‰ä¸€ä¸ªä¸»æœºå“åº”ï¼Œç»„æ’­è·¯ç”±å™¨å°±è®¤ä¸ºæœ¬ç½‘ç»œä¸Šçš„æ²¡æœ‰æ­¤ç»„æ’­ç»„çš„ä¸»æœºï¼Œå› æ­¤å°±ä¸å†æŠŠè¿™ç»„çš„æˆå‘˜å…³ç³»å‘ç»™å…¶ä»–çš„ç»„æ’­è·¯ç”±å™¨ã€‚ 2.10 IPv6IPv6ä½¿ç”¨128ä½äºŒè¿›åˆ¶æ•°è¡¨ç¤ºï¼Œé€šå¸¸ä½¿ç”¨å†’å·åå…­è¿›åˆ¶è®°æ³•: 4BF5:AA12:0216:FEBC:BA5F:039A:BE9A:2170ï¼Œå¯ä»¥å°†è¿ç»­çš„0å‹ç¼©çœç•¥ã€‚ 2.10.1 IPv6æ•°æ®æŠ¥IPv6æ•°æ®æŠ¥æ ¼å¼ï¼š 40å­—èŠ‚åŸºæœ¬é¦–éƒ¨ æœ‰æ•ˆè½½è·ï¼Œå…¶ä¸­åŒ…æ‹¬æ‹“å±•é¦–éƒ¨ 2.10.2 Ipv6çš„æ”¹è¿› IPv6å°†åœ°å€ä»32ä½(4B) æ‰©å¤§åˆ°128ä½(16B) ï¼Œæ›´å¤§çš„åœ°å€ç©ºé—´ã€‚ IPv6å°†IPv4çš„æ ¡éªŒå’Œå­—æ®µå½»åº•ç§»é™¤ï¼Œä»¥å‡å°‘æ¯è·³çš„å¤„ç†æ—¶é—´ã€‚ IPv6å°†IPv4çš„å¯é€‰å­—æ®µç§»å‡ºé¦–éƒ¨ï¼Œå˜æˆäº†æ‰©å±•é¦–éƒ¨ï¼Œæˆä¸ºçµæ´»çš„é¦–éƒ¨æ ¼å¼ï¼Œè·¯ç”±å™¨é€šå¸¸ä¸å¯¹æ‰©å±•é¦–éƒ¨è¿›è¡Œæ£€æŸ¥ï¼Œå¤§å¤§æé«˜äº†è·¯ç”±å™¨çš„å¤„ç†æ•ˆç‡ã€‚ IPv6æ”¯æŒå³æ’å³ç”¨(å³è‡ªåŠ¨é…ç½®)ï¼Œä¸éœ€è¦DHCPåè®®ã€‚ IPv6é¦–éƒ¨é•¿åº¦å¿…é¡»æ˜¯8Bçš„æ•´æ•°å€ï¼ŒIPv4é¦–éƒ¨æ˜¯4Bçš„æ•´æ•°å€ã€‚ IPv6åªèƒ½åœ¨ä¸»æœºå¤„åˆ†ç‰‡ï¼ŒIPv4å¯ä»¥åœ¨è·¯ç”±å™¨å’Œä¸»æœºå¤„åˆ†ç‰‡ã€‚ ICMPv6ï¼šé™„åŠ æŠ¥æ–‡ç±»å‹â€œåˆ†ç»„è¿‡å¤§â€ã€‚ IPv6æ”¯æŒèµ„æºçš„é¢„åˆ†é…ï¼Œæ”¯æŒå®æ—¶è§†åƒç­‰è¦æ±‚ï¼Œä¿è¯ä¸€å®šçš„å¸¦å®½å’Œæ—¶å»¶çš„åº”ç”¨ã€‚ IPv6å–æ¶ˆäº†åè®®å­—æ®µï¼Œæ”¹æˆä¸‹ä¸€ä¸ªé¦–éƒ¨å­—æ®µã€‚ IPv6å–æ¶ˆäº†æ€»é•¿åº¦å­—æ®µï¼Œæ”¹ç”¨æœ‰æ•ˆè½½è·é•¿åº¦å­—æ®µã€‚ IPv6å–æ¶ˆäº†æœåŠ¡ç±»å‹å­—æ®µã€‚ IPv6åŸºæœ¬åœ°å€ç±»å‹ï¼š å•æ’­ï¼šä¸€å¯¹ä¸€é€šä¿¡ï¼Œå¯åšæºåœ°å€+ç›®çš„åœ°å€ å¤šæ’­ï¼šä¸€å¯¹å¤šé€šä¿¡ï¼Œå¯åšç›®çš„åœ°å€ ä»»æ’­ï¼šä¸€å¯¹å¤šä¸­çš„ä¸€ä¸ªé€šä¿¡ï¼Œå¯åšç›®çš„åœ°å€ 2.10.3 IPv6å‘IPv4è¿‡æ¸¡çš„ç­–ç•¥åŒæ ˆåè®®ï¼š åŒåè®®æ ˆæŠ€æœ¯å°±æ˜¯æŒ‡åœ¨ä¸€å°è®¾å¤‡ä¸ŠåŒæ—¶å¯ç”¨IPv4åè®®æ ˆå’ŒIPv6åè®®æ ˆã€‚è¿™æ ·çš„è¯ï¼Œè¿™å°è®¾å¤‡æ—¢èƒ½å’ŒIPv4ç½‘ç»œé€šä¿¡ï¼Œåˆèƒ½å’ŒIPv6ç½‘ç»œé€šä¿¡ã€‚å¦‚æœè¿™å°è®¾å¤‡æ˜¯ä¸€ä¸ªè·¯ç”±å™¨ï¼Œé‚£ä¹ˆè¿™å°è·¯ç”±å™¨çš„ä¸åŒæ¥å£ä¸Šï¼Œåˆ†åˆ«é…ç½®äº†IPv4åœ°å€å’ŒIPv6åœ°å€ï¼Œå¹¶å¾ˆå¯èƒ½åˆ†åˆ«è¿æ¥äº†IPv4ç½‘ç»œå’ŒIPv6ç½‘ç»œã€‚å¦‚æœè¿™å°è®¾å¤‡æ˜¯ä¸€ä¸ªè®¡ç®—æœºï¼Œé‚£ä¹ˆå®ƒå°†åŒæ—¶æ‹¥æœ‰IPv4åœ°å€å’ŒIPv6åœ°å€ï¼Œå¹¶å…·å¤‡åŒæ—¶å¤„ç†è¿™ä¸¤ä¸ªåè®®åœ°å€çš„åŠŸèƒ½ã€‚ éš§é“æŠ€æœ¯ï¼š é€šè¿‡ä½¿ç”¨äº’è”ç½‘ç»œçš„åŸºç¡€è®¾æ–½åœ¨ç½‘ç»œä¹‹é—´ä¼ é€’æ•°æ®çš„æ–¹å¼ã€‚ä½¿ç”¨éš§é“ä¼ é€’çš„æ•°æ®(æˆ–è´Ÿè½½)å¯ä»¥æ˜¯ä¸åŒåè®®çš„æ•°æ®å¸§æˆ–åŒ…ã€‚éš§é“åè®®å°†å…¶å®ƒåè®®çš„æ•°æ®å¸§æˆ–åŒ…é‡æ–°å°è£…ç„¶åé€šè¿‡éš§é“å‘é€ã€‚ 3 è½¬å‘åˆ†ç»„çš„æµç¨‹ 4 åˆ’åˆ†å­ç½‘å’Œæ„é€ è¶…ç½‘ 4.1 å­ç½‘åˆ’åˆ†å­ç½‘åˆ’åˆ†åˆå°†IPåœ°å€ä¸­çš„ä¸»æœºå·åˆ’åˆ†ä¸ºå­ç½‘å·å’Œä¸»æœºå·ï¼Œè¿™é‡Œçš„ä¸»æœºå·ä»ä¸èƒ½æ˜¯å…¨0æˆ–å…¨1ã€‚æŸå•ä½åˆ’åˆ†å­ç½‘åï¼Œå¯¹å¤–ä»è¡¨ç°ä¸ºä¸€ä¸ªç½‘ç»œï¼Œå³æœ¬å•ä½å¤–çš„ç½‘ç»œçœ‹ä¸è§æœ¬å•ä½å†…å­ç½‘çš„åˆ’åˆ†ã€‚ å¦‚ä½•ç¡®å®šå­ç½‘å·å’Œä¸»æœºå·çš„ä½æ•°å°±éœ€è¦é€šè¿‡å­ç½‘æ©ç ã€‚å®ƒæ˜¯ä¸ªç±»IPåœ°å€çš„å½¢å¼ï¼Œç½‘ç»œå·å’Œå­ç½‘å·å¯¹åº”çš„ä½å…¨ä¸º1ï¼Œä¸»æœºå·å¯¹åº”çš„ä½å…¨ä¸º0ã€‚ 4.2 æ„é€ è¶…ç½‘4.2.1 æ— åˆ†ç±»ç¼–å€CIDRCIDRæ¶ˆé™¤äº†ä¼ ç»Ÿçš„Aç±»ï¼ŒBç±»å’ŒCç±»åœ°å€ä»¥åŠåˆ’åˆ†å­ç½‘çš„æ¦‚å¿µï¼Œå°†IPåœ°å€åˆ’åˆ†ä¸ºç½‘ç»œå‰ç¼€å’Œä¸»æœºå·ï¼Œç½‘ç»œå‰ç¼€çš„ä½æ•°æ˜¯ä»»æ„çš„ï¼Œåœ¨IPåœ°å€ååŠ ä¸Š/ï¼Œç„¶åå†™ä¸Šç½‘ç»œå‰ç¼€çš„ä½æ•°ã€‚ CIDRæŠŠç½‘ç»œå‰ç¼€éƒ½ç›¸åŒçš„è¿ç»­çš„IPåœ°å€ç»„æˆä¸€ä¸ªâ€œCIDRåœ°å€å—â€ã€‚ CIDRä¹Ÿå¯ä»¥æœ‰å­ç½‘æ©ç çš„æ¦‚å¿µï¼Œç½‘ç»œå‰ç¼€æœ‰å¤šå°‘ä½ï¼Œå­ç½‘æ©ç ä¸­å°±æœ‰å¤šå°‘ä½è¿ç»­çš„1ã€‚ 4.2.2 æ„æˆè¶…ç½‘å°†å¤šä¸ªå­ç½‘èšåˆæˆä¸€ä¸ªè¾ƒå¤§çš„å­ç½‘ï¼Œå«åšæ„æˆè¶…ç½‘ï¼Œæˆ–è·¯ç”±èšåˆã€‚ æ–¹æ³•:å°†ç½‘ç»œå‰ç¼€ç¼©çŸ­ã€‚ ä½¿ç”¨CIDRæ—¶ï¼ŒæŸ¥æ‰¾è·¯ç”±è¡¨å¯èƒ½å¾—åˆ°å‡ ä¸ªåŒ¹é…ç»“æœï¼Œåº”é€‰æ‹©å…·æœ‰æœ€é•¿ç½‘ç»œå‰ç¼€çš„è·¯ç”±ã€‚å‰ç¼€è¶Šé•¿ï¼Œåœ°å€å—è¶Šå°ï¼Œè·¯ç”±è¶Šå…·ä½“ã€‚ 5 è·¯ç”±é€‰æ‹©åè®® 5.1 RIPåè®®RIPæ˜¯ä¸€ç§åˆ†å¸ƒå¼çš„åŸºäºè·ç¦»å‘é‡çš„è·¯ç”±é€‰æ‹©åè®®ï¼Œæ˜¯å› ç‰¹ç½‘çš„åè®®æ ‡å‡†ï¼Œæœ€å¤§ä¼˜ç‚¹æ˜¯ç®€å•ã€‚ RIPåè®®è¦æ±‚ç½‘ç»œä¸­æ¯ä¸€ä¸ªè·¯ç”±å™¨éƒ½ç»´æŠ¤ä»å®ƒè‡ªå·±åˆ°å…¶ä»–æ¯ä¸€ä¸ªç›®çš„ç½‘ç»œçš„å”¯ä¸€æœ€ä½³è·ç¦»è®°å½•(å³ä¸€ç»„è·ç¦»)ã€‚ è·ç¦»ï¼šé€šå¸¸ä¸ºâ€œè·³æ•°â€ï¼Œå³ä»æºç«¯å£åˆ°ç›®çš„ç«¯å£æ‰€ç»è¿‡çš„è·¯ç”±å™¨ä¸ªæ•°ï¼Œç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨è·³æ•°+1ã€‚ç‰¹åˆ«çš„ï¼Œä»ä¸€è·¯ç”±å™¨åˆ°ç›´æ¥è¿æ¥çš„ç½‘ç»œè·ç¦»ä¸º1ã€‚RIPå…è®¸ä¸€æ¡è·¯ç”±æœ€å¤šåªèƒ½åŒ…å«15ä¸ªè·¯ç”±å™¨ï¼Œå› æ­¤è·ç¦»ä¸º16è¡¨ç¤ºç½‘ç»œä¸å¯è¾¾ã€‚ RIPåè®®è®©ç›¸é‚»è·¯ç”±å™¨ä¹‹é—´äº¤æ¢è‡ªå·±çš„è·¯ç”±è¡¨ï¼Œæ¯30ç§’äº¤æ¢ä¸€æ¬¡è·¯ç”±ä¿¡æ¯ï¼Œç„¶åè·¯ç”±å™¨æ ¹æ®æ–°ä¿¡æ¯æ›´æ–°è·¯ç”±è¡¨ã€‚è‹¥è¶…è¿‡180sæ²¡æ”¶åˆ°é‚»å±…è·¯ç”±å™¨çš„é€šå‘Šï¼Œåˆ™åˆ¤å®šé‚»å±…æ²¡äº†ï¼Œå¹¶æ›´æ–°è‡ªå·±è·¯ç”±è¡¨ã€‚ è·¯ç”±å™¨åˆšå¼€å§‹å·¥ä½œæ—¶ï¼ŒåªçŸ¥é“ç›´æ¥è¿æ¥çš„ç½‘ç»œçš„è·ç¦»(è·ç¦»ä¸º1)ï¼Œæ¥ç€æ¯ä¸€ä¸ªè·¯ç”±å™¨ä¹Ÿåªå’Œæ•°ç›®éå¸¸æœ‰é™çš„ç›¸é‚»è·¯ç”±å™¨äº¤æ¢å¹¶æ›´æ–°è·¯ç”±ä¿¡æ¯ã€‚ ç»è¿‡è‹¥å¹²æ¬¡æ›´æ–°åï¼Œæ‰€æœ‰è·¯ç”±å™¨æœ€ç»ˆéƒ½ä¼šçŸ¥é“åˆ°è¾¾æœ¬è‡ªæ²»ç³»ç»Ÿä»»ä½•ä¸€ä¸ªç½‘ç»œçš„æœ€çŸ­è·ç¦»å’Œä¸‹ä¸€è·³è·¯ç”±å™¨çš„åœ°å€ï¼Œå³ â€œæ”¶æ•›â€ã€‚ RIPåè®®ä¹Ÿæ˜¯åº”ç”¨å±‚åè®®ï¼Œä½¿ç”¨UDPä¼ è¾“æ•°æ®ï¼ŒRIPåè®®åªé€‚ç”¨äºå°äº’è”ç½‘ã€‚ RIPåè®®å¥½æ¶ˆæ¯ä¼ å¾—å¿«ï¼Œåæ¶ˆæ¯ä¼ å¾—æ…¢ï¼šå½“ç½‘ç»œå‡ºç°æ•…éšœæ—¶ï¼Œè¦ç»è¿‡æ¯”è¾ƒé•¿çš„æ—¶é—´(ä¾‹å¦‚æ•°åˆ†é’Ÿ)æ‰èƒ½å°†æ­¤ä¿¡æ¯ä¼ é€åˆ°æ‰€æœ‰çš„è·¯ç”±å™¨ï¼Œè¿™ç§ç‰¹ç‚¹ç§°ä¸º â€œæ…¢æ”¶æ•›â€ã€‚ 5.2 OSPFåè®®ï¼ˆç®€ä»‹ï¼‰å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆOSPFåè®®ï¼šâ€œå¼€æ”¾â€æ ‡æ˜OSPFåè®®ä¸æ˜¯å—æŸä¸€å®¶å‚å•†æ§åˆ¶ï¼Œè€Œæ˜¯å…¬å¼€å‘è¡¨çš„ã€‚â€œæœ€çŸ­è·¯å¾„ä¼˜å…ˆâ€æ˜¯å› ä¸ºä½¿ç”¨äº†Djkstraæå‡ºçš„æœ€çŸ­è·¯å¾„ç®—æ³•SPFã€‚ ç‰¹ç‚¹ï¼š ä½¿ç”¨æ´ªæ³›æ³•å‘è‡ªæ²»ç³»ç»Ÿå†…æ‰€æœ‰è·¯ç”±å™¨å‘é€ä¿¡æ¯ï¼Œå³è·¯ç”±å™¨é€šè¿‡è¾“å‡ºç«¯å£å‘æ‰€æœ‰ç›¸é‚»çš„è·¯ç”±å™¨å‘é€ä¿¡æ¯ï¼Œè€Œæ¯ä¸€ä¸ªç›¸é‚»è·¯ç”±å™¨åˆå†æ¬¡å°†æ­¤ä¿¡æ¯å‘å¾€å…¶æ‰€æœ‰çš„ç›¸é‚»è·¯ç”±å™¨ï¼ˆç›¸å½“äºå¹¿æ’­ï¼‰ã€‚æœ€ç»ˆæ•´ä¸ªåŒºåŸŸå†…æ‰€æœ‰è·¯ç”±å™¨éƒ½å¾—åˆ°äº†è¿™ä¸ªä¿¡æ¯çš„ä¸€ä¸ªå‰¯æœ¬ã€‚ å‘é€çš„ä¿¡æ¯å°±æ˜¯ä¸æœ¬è·¯ç”±å™¨ç›¸é‚»çš„æ‰€æœ‰è·¯ç”±å™¨çš„é“¾è·¯çŠ¶æ€ï¼ˆæœ¬è·¯ç”±å™¨å’Œå“ªäº›è·¯ç”±å™¨ç›¸é‚»ï¼Œä»¥åŠè¯¥é“¾è·¯çš„åº¦é‡/ä»£ä»·â€”â€”è´¹ç”¨ã€è·ç¦»ã€æ—¶å»¶ã€å¸¦å®½ç­‰ï¼‰ã€‚ åªæœ‰å½“é“¾è·¯çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè·¯ç”±å™¨æ‰å‘æ‰€æœ‰è·¯ç”±å™¨æ´ªæ³›å‘é€æ­¤ä¿¡æ¯ã€‚ æœ€åï¼Œæ‰€æœ‰è·¯ç”±å™¨éƒ½èƒ½å»ºç«‹ä¸€ä¸ªé“¾è·¯çŠ¶æ€æ•°æ®åº“ï¼Œå³å…¨ç½‘æ‹“æ‰‘å›¾ã€‚ç„¶åä½¿ç”¨Djkstraç®—æ³•ç¡®å®šæœ€çŸ­è·¯å¾„ã€‚ å…¶ä»–ç‰¹ç‚¹ï¼š æ¯éš”30min,è¦åˆ·æ–°ä¸€æ¬¡æ•°æ®åº“ä¸­çš„é“¾è·¯çŠ¶æ€ã€‚ ç”±äºä¸€ä¸ªè·¯ç”±å™¨çš„é“¾è·¯çŠ¶æ€åªæ¶‰åŠåˆ°ä¸ç›¸é‚»è·¯ç”±å™¨çš„è¿é€šçŠ¶æ€ï¼Œå› è€Œä¸æ•´ä¸ªäº’è”ç½‘çš„è§„æ¨¡å¹¶æ— ç›´æ¥å…³ç³»ã€‚å› æ­¤å½“äº’è”ç½‘è§„æ¨¡å¾ˆå¤§æ—¶ï¼ŒOSPFåè®®è¦æ¯”è·ç¦»å‘é‡åè®®RIPå¥½å¾—å¤šã€‚ OSPFä¸å­˜åœ¨åæ¶ˆæ¯ä¼ çš„æ…¢çš„é—®é¢˜ï¼Œå®ƒçš„æ”¶æ•›é€Ÿåº¦å¾ˆå¿«ã€‚ OSPFåŸºäºIPåè®®ï¼Œå½’ä¸ºä¼ è¾“å±‚åè®®ã€‚ 5.3 BGPåè®®ï¼ˆç®€ä»‹ï¼‰BGPå±äºå¤–éƒ¨ç½‘å…³åè®®ï¼Œåœ¨ä¸åŒçš„è‡ªæ²»ç³»ç»Ÿï¼ˆASï¼‰é—´è¿›è¡Œè·¯ç”±ï¼Œç›¸é‚»çš„è‡ªæ²»ç³»ç»Ÿé€šè¿‡BGPå‘è¨€äººï¼ˆä¸€å°è¾¹ç•Œè·¯ç”±å™¨ï¼‰äº¤æ¢ç½‘ç»œå¯è¾¾æ€§çš„ä¿¡æ¯ï¼Œå³è¦åˆ°è¾¾æŸä¸ªç½‘ç»œæ‰€è¦ç»è¿‡çš„ä¸€ç³»åˆ—ASã€‚ BGPæ‰€äº¤æ¢çš„ç½‘ç»œå¯è¾¾æ€§çš„ä¿¡æ¯å°±æ˜¯è¦åˆ°è¾¾æŸä¸ªç½‘ç»œæ‰€è¦ç»è¿‡çš„ä¸€ç³»åˆ—ASã€‚å½“BGPå‘è¨€äººäº’ç›¸äº¤æ¢äº†ç½‘ç»œå¯è¾¾æ€§çš„ä¿¡æ¯åï¼Œå„BGPå‘è¨€äººå°±æ ¹æ®æ‰€é‡‡ç”¨çš„ç­–ç•¥ä»æ”¶åˆ°çš„è·¯ç”±ä¿¡æ¯ä¸­æ‰¾å‡ºåˆ°è¾¾å„ASçš„è¾ƒå¥½è·¯ç”±ã€‚é¦–æ¬¡äº¤æ¢çš„æ˜¯æ•´ä¸ªè·¯ç”±è¡¨ï¼Œå…¶ä»–æ—¶å€™äº¤æ¢çš„æ˜¯æœ‰å˜æ¢çš„éƒ¨åˆ†ã€‚ BGPæ˜¯åº”ç”¨å±‚åè®®ï¼Œé€šè¿‡TCPä¼ é€ã€‚","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","permalink":"https://www.codetool.top/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"}]},{"title":"å‰‘æŒ‡offer06-ä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨","slug":"å‰‘æŒ‡offer06-ä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨","date":"2020-04-10T03:47:37.000Z","updated":"2020-04-10T16:42:31.104Z","comments":true,"path":"article/å‰‘æŒ‡offer06-ä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨/","link":"","permalink":"https://www.codetool.top/article/%E5%89%91%E6%8C%87offer06-%E4%BB%8E%E5%B0%BE%E5%88%B0%E5%A4%B4%E6%89%93%E5%8D%B0%E9%93%BE%E8%A1%A8/","excerpt":"","text":"1 åŸé¢˜ï¼ˆæ¥æºLeetcodeï¼‰è¾“å…¥ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼Œä»å°¾åˆ°å¤´åè¿‡æ¥è¿”å›æ¯ä¸ªèŠ‚ç‚¹çš„å€¼ï¼ˆç”¨æ•°ç»„è¿”å›ï¼‰ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š head = [1,3,2]è¾“å‡ºï¼š [2,3,1] é™åˆ¶ï¼š 0 &lt;= é“¾è¡¨é•¿åº¦ &lt;= 10000 2 è§£æ³•2.1 æ€æƒ³æ ˆ 2.2 ä»£ç class Solution { public int[] reversePrint(ListNode head) { Stack&lt;Integer> stack = new Stack&lt;>(); int size = 0; while(head!=null){ stack.push(head.val); head = head.next; size++; } int[] ans = new int[size]; for(int i = 0;i&lt;size;i++){ ans[i] = stack.pop(); } return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"å‰‘æŒ‡offer","slug":"å‰‘æŒ‡offer","permalink":"https://www.codetool.top/tags/%E5%89%91%E6%8C%87offer/"}]},{"title":"è°ˆä¸€è°ˆStringBufferã€StringBuilderåŠStringåœ¨JDK9ä¸­çš„å˜åŒ–","slug":"è°ˆä¸€è°ˆStringBufferã€StringBuilderåŠStringåœ¨JDK9ä¸­çš„å˜åŒ–","date":"2020-04-09T05:49:25.000Z","updated":"2020-04-09T06:53:36.498Z","comments":true,"path":"article/è°ˆä¸€è°ˆStringBufferã€StringBuilderåŠStringåœ¨JDK9ä¸­çš„å˜åŒ–/","link":"","permalink":"https://www.codetool.top/article/%E8%B0%88%E4%B8%80%E8%B0%88StringBuffer%E3%80%81StringBuilder%E5%8F%8AString%E5%9C%A8JDK9%E4%B8%AD%E7%9A%84%E5%8F%98%E5%8C%96/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š JAVA9 Stringæ–°ç‰¹æ€§ï¼Œè¯´è¯´ä½ ä¸çŸ¥é“çš„ä¸œè¥¿_Java_äººåœ¨æ±Ÿæ¹–-CSDNåšå®¢ 1 StringBufferå’ŒStringBuilderçš„åŒºåˆ«è¿™é‡Œè°ˆçš„æ˜¯JDK8ä¸­StringBufferå’ŒStringBuilderçš„å®ç°ï¼ŒJDK9åéšç€Stringçš„å˜åŒ–ï¼Œè¿™ä¸¤ä¸ªç±»çš„å®ç°ä¹Ÿæœ‰äº†äº›è®¸å˜åŒ–ã€‚ Stringæ˜¯ä¸å¯å˜çš„ï¼ŒStringç±»å’Œå®ƒçš„å†…éƒ¨valueæ•°ç»„éƒ½è¢«å£°æ˜ä¸ºfinalã€‚å› æ­¤é€šå¸¸å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥æ“ä½œæ€»æ˜¯ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ï¼Œæ•ˆç‡è¾ƒä½ã€‚ ä¸ºäº†æ”¹è¿›å­—ç¬¦ä¸²æ‹¼æ¥çš„æ•ˆç‡ï¼Œå‡ºç°äº†StringBufferå’ŒStringBuilderï¼ŒStringBufferæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒåœ¨ä¸»è¦æ–¹æ³•ä¸ŠåŠ äº†synchronizedå…³é”®å­—ï¼Œä¸è¿‡ä¹Ÿå› æ­¤ä¼šæœ‰åŠ é”è§£é”çš„å¼€é”€ï¼Œæ€§èƒ½ä¼šæ”¶åˆ°å½±å“ï¼Œè€ŒStringBuilderå°±æ˜¯StringBufferçš„çº¿ç¨‹ä¸å®‰å…¨ç‰ˆæœ¬ï¼Œå®ƒæ²¡æœ‰ä½¿ç”¨synchronizedå…³é”®å­—ï¼Œæ€§èƒ½æœ€å¥½ã€‚ StringBufferå’ŒStringBuilderéƒ½ç»§æ‰¿è‡ªAbstractStringBuilderï¼Œä¸»è¦æ–¹æ³•ä¹Ÿéƒ½ç”±è¿™ä¸ªçˆ¶ç±»å®ç°äº†ï¼ŒåŸºæœ¬çš„åŸç†æ˜¯å®ƒå†…éƒ¨æœ‰ä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼Œappendçš„æ—¶å€™é€šè¿‡System.arraycopyå°†Stringä¸­çš„å­—ç¬¦æ•°ç»„æ‹·è´è‡³è¯¥builderçš„æ•°ç»„æœ«å°¾ï¼Œå¦‚æœæ•°ç»„ç©ºé—´ä¸è¶³ï¼Œåˆ™æ‰©å®¹ä¸ºä¸¤å€å¤§å°ï¼ŒtoStringçš„æ—¶å€™é€šè¿‡è¿™ä¸ªå­—ç¬¦æ•°ç»„æ¥æ„é€ å­—ç¬¦ä¸²ã€‚ StringBufferå’ŒStringBuideréƒ½å¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­è‡ªå®šä¹‰åˆå§‹åŒ–æ—¶å†…éƒ¨å­—ç¬¦æ•°ç»„çš„å¤§å°ï¼Œå¦‚æœçŸ¥é“è¦æ‹¼æ¥å­—ç¬¦ä¸²æœ€åçš„å¤§è‡´å¤§å°ï¼Œå»ºè®®ç»™å®ƒä¸€ä¸ªåˆå§‹å®¹é‡ï¼Œé¿å…æ•°ç»„æ‰©å®¹å¸¦æ¥çš„å¼€é”€ï¼Œè¿™ç‚¹å°±å’ŒArrayListå·®ä¸å¤šã€‚ AbstractStringBuilderä¸­appendçš„å®ç°ï¼š public AbstractStringBuilder append(String str) { if (str == null) return appendNull(); int len = str.length(); ensureCapacityInternal(count + len); str.getChars(0, len, value, count); count += len; return this; } Stringä¸­getCharsçš„å®ç°ï¼šï¼ˆç”±Stringè´Ÿè´£å°†è‡ªå·±å†…éƒ¨æ•°ç»„å†…å®¹é™„åŠ åˆ°builderä¸­çš„æ•°ç»„æœ«å°¾ï¼‰ public void getChars(int srcBegin, int srcEnd, char dst[], int dstBegin) { if (srcBegin &lt; 0) { throw new StringIndexOutOfBoundsException(srcBegin); } if (srcEnd > value.length) { throw new StringIndexOutOfBoundsException(srcEnd); } if (srcBegin > srcEnd) { throw new StringIndexOutOfBoundsException(srcEnd - srcBegin); } System.arraycopy(value, srcBegin, dst, dstBegin, srcEnd - srcBegin); } 2 JDK9 Stringè§£è¯»å¾ˆä¹…ä¹‹å‰ï¼Œæˆ‘åœ¨è¯¦è§£javaä¸­çš„unicodeç¼–ç ï¼ˆç ç‚¹ï¼‰ä¸­æåˆ°ï¼Œjavaä½¿ç”¨çš„charç¼–ç å°±æ˜¯UTF-16ï¼Œå¹¶ä¸”Stringçš„åº•å±‚ä¹Ÿæ˜¯ä¸€ä¸ªcharæ•°ç»„ã€‚ UTF-16çš„ç¼–ç è§„åˆ™æ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œå¤ä¹ ä¸€ä¸‹ï¼š BMPï¼ˆåŸºæœ¬å¤šè¯­è¨€å¹³é¢ï¼‰å†…çš„å­—ç¬¦ï¼Œç»Ÿä¸€ä½¿ç”¨2ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œæˆ‘ä»¬ç§°å…¶ä¸ºä¸€ä¸ªç ç‚¹ï¼Œå®ƒå·²ç»å¯ä»¥è¡¨ç¤ºå¤§å¤šæ•°å¸¸è§æ–‡å­—ã€‚ è¾…åŠ©å¹³é¢å†…çš„å­—ç¬¦ï¼Œä½¿ç”¨é«˜ä»£ç†ç ç‚¹å’Œä½ä»£ç†ç ç‚¹è”åˆè¡¨ç¤ºï¼Œå…±å››ä¸ªå­—èŠ‚ï¼Œå¯ä»¥è¡¨ç¤ºå®Œæ‰€æœ‰unicodeä¸­çš„å­—ç¬¦ã€‚ ä½†æ˜¯ï¼ŒUTF-16å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼Œå¯¹äºå¤§å¤šæ•°æ‹‰ä¸è¯­ç³»ä¸­çš„å­—ç¬¦ï¼ˆä¾‹å¦‚ASCIIç ä¸­çš„å­—ç¬¦ï¼‰ï¼Œéƒ½å¯ä»¥ä½¿ç”¨1ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œç„¶è€ŒUTF-16å¿…é¡»ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºå®ƒï¼Œå°±ä¼šå¯¼è‡´ç©ºé—´æµªè´¹ã€‚ äºæ˜¯JDK9ä¸­ï¼Œå¤§åˆ€é˜”æ–§åœ°å¯¹StringåŠç›¸å…³æ–¹æ³•è¿›è¡Œäº†é‡æ„ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒJDK9ä¸­çš„valueæ•°ç»„å˜ä¸ºäº†byteæ•°ç»„ï¼Œæ„å‘³ç€æœ€å°å…è®¸å•å­—èŠ‚çš„å­˜åœ¨ã€‚å¹¶ä¸”å¤šäº†ä¸€ä¸ªcoderå­—æ®µï¼Œjavadocä¸­æ˜¯è¿™æ ·æè¿°çš„ï¼š The identifier of the encoding used to encode the bytes in value. The supported values in this implementation are LATIN1 UTF16 è¯´æ˜coderç”¨äºæ ‡è¯†è¿™ä¸ªbytesæ•°ç»„çš„ç¼–ç æ˜¯utf-16è¿˜æ˜¯latin1ã€‚ï¼ˆæ ¹æ®æµ‹è¯•1ä»£è¡¨UTF16ï¼Œ0ä»£è¡¨latin1ï¼‰ å¯ä»¥çœ‹åˆ°å ç”¨ç©ºé—´ç›´æ¥å‡å°‘äº†1/2ã€‚ ç”±äºbyteæ•°ç»„çš„ä½¿ç”¨æ–¹å¼ï¼Œå¼•ç”³å‡ºäº†ä¸¤ä¸ªç±»StringLatin1å’ŒStringUTF16ä¸¤ä¸ªç±»ï¼Œåˆ†æ‹…Stringç±»çš„æ“ä½œã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹JDK9ä¸­Stringå‡ ä¸ªæ–¹æ³•çš„æºç ï¼š public int codePointCount(int beginIndex, int endIndex) { if (beginIndex &lt; 0 || beginIndex > endIndex || endIndex > length()) { throw new IndexOutOfBoundsException(); } if (isLatin1()) { return endIndex - beginIndex; } return StringUTF16.codePointCount(value, beginIndex, endIndex); } è¿™ä¸ªæ–¹æ³•ç”¨äºè®¡ç®—ç ç‚¹æ•°ï¼Œå¯¹äºlatin1ç¼–ç ï¼Œè‡ªç„¶å°±æ˜¯byteæ•°ç»„çš„é•¿åº¦ã€‚å¯¹äºUTF16ï¼Œå’ŒJDK8ä¸­çš„æ€æƒ³ç±»ä¼¼ï¼š private static int codePointCount(byte[] value, int beginIndex, int endIndex, boolean checked) { assert beginIndex &lt;= endIndex; int count = endIndex - beginIndex; int i = beginIndex; if (checked &amp;&amp; i &lt; endIndex) { checkBoundsBeginEnd(i, endIndex, value); } for (; i &lt; endIndex - 1; ) { if (Character.isHighSurrogate(getChar(value, i++)) &amp;&amp; Character.isLowSurrogate(getChar(value, i))) { count--; i++; } } return count; } å†æ¥çœ‹length(): public int length() { return value.length >> coder(); } static final boolean COMPACT_STRINGS; static { COMPACT_STRINGS = true; } byte coder() { return COMPACT_STRINGS ? coder : UTF16; } javadocå¯¹COMPACT_STRINGSçš„è§£é‡Šæ˜¯ï¼š If String compaction is disabled, the bytes in value are always encoded in UTF16 å³COMPACT_STRINGSé»˜è®¤æ˜¯å¼€å¯çš„ï¼Œå³åŒæ—¶æ”¯æŒUTF16å’ŒLATIN1ï¼Œä½†å…·ä½“çš„ç¼–è¯‘å™¨å¯ä»¥å°†å…¶å…³é—­ï¼Œä½¿å…¶åªæ”¯æŒUTF16ã€‚ è¿™é‡Œè®¡ç®—é•¿åº¦çš„æ–¹æ³•ä¾ç„¶å¾ˆç®€å•ï¼Œå¯¹äºLATIN1å°±æ˜¯byteæ•°ç»„çš„é•¿åº¦ï¼Œå¯¹äºUTF16åˆ™æ˜¯byteæ•°ç»„é•¿åº¦é™¤ä»¥2ã€‚ JDK9ä¸­å¯¹å­—ç¬¦ä¸²çš„æ”¹åŠ¨å¸¦æ¥çš„é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¯èƒ½æœ‰äººçŸ¥é“ï¼Œjavaä¸­æ•°ç»„çš„å¤§å°æ˜¯æœ‰ä¸Šé™çš„ï¼Œè®¸å¤šé›†åˆç±»éƒ½æœ‰ä¸‹é¢è¿™ä¸ªå­—æ®µï¼š /** * The maximum size of array to allocate. * Some VMs reserve some header words in an array. * Attempts to allocate larger arrays may result in * OutOfMemoryError: Requested array size exceeds VM limit */ private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8; å³æ•°ç»„çš„å¤§å°ä¸Šé™ä¸åº”è¯¥è¶…è¿‡Integer.MAX_VALUE - 8ï¼Œé‚£ä¹ˆå¤§å°ç›¸ç­‰çš„æƒ…å†µä¸‹ï¼ŒJDK9ä¸­byteæ•°ç»„è‡ªç„¶ä¹Ÿå°±æ¯”JDK8ä¸­çš„charæ•°ç»„èƒ½å­˜å‚¨çš„ä¿¡æ¯å°‘äº†1/2ã€‚ 3 JDK9å¸¦æ¥çš„StringBuffer/StringBuilderå˜åŒ–JDK9ä¸­Stringçš„æ”¹ç‰ˆï¼Œä½¿å¾—StringBuffer/StringBuilderçš„å®ç°ä¹Ÿæœ‰äº†å°å˜åŒ–ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š abstract class AbstractStringBuilder implements Appendable, CharSequence { /** * The value is used for character storage. */ byte[] value; /** * The id of the encoding used to encode the bytes in {@code value}. */ byte coder; //... } AbstractStringBuilderä¸­çš„å†…éƒ¨æ•°ç»„ä¹Ÿå˜ä¸ºäº†byteæ•°ç»„ï¼Œå¹¶ä¸”å¢åŠ äº†coderå­—æ®µã€‚ public AbstractStringBuilder append(String str) { if (str == null) { return appendNull(); } int len = str.length(); ensureCapacityInternal(count + len); putStringAt(count, str); count += len; return this; } private final void putStringAt(int index, String str) { if (getCoder() != str.coder()) { inflate(); } str.getBytes(value, index, coder); } void getBytes(byte dst[], int dstBegin, byte coder) { if (coder() == coder) { System.arraycopy(value, 0, dst, dstBegin &lt;&lt; coder, value.length); } else { // this.coder == LATIN &amp;&amp; coder == UTF16 StringLatin1.inflate(value, 0, dst, dstBegin, value.length); } } å¯ä»¥çœ‹åˆ°åŠ å…¥äº†ä¸€äº›å¯¹coderçš„åˆ¤æ–­ï¼ŒBuilderå’ŒStringå¿…é¡»ç»´æŒç›¸åŒçš„coderã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jdk","slug":"jdk","permalink":"https://www.codetool.top/tags/jdk/"},{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://www.codetool.top/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://www.codetool.top/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}]},{"title":"leetcode22-æ‹¬å·ç”Ÿæˆ","slug":"leetcode22-æ‹¬å·ç”Ÿæˆ","date":"2020-04-09T04:46:43.000Z","updated":"2020-04-30T05:46:58.416Z","comments":true,"path":"article/leetcode22-æ‹¬å·ç”Ÿæˆ/","link":"","permalink":"https://www.codetool.top/article/leetcode22-%E6%8B%AC%E5%8F%B7%E7%94%9F%E6%88%90/","excerpt":"","text":"1 åŸé¢˜æ•°å­— n ä»£è¡¨ç”Ÿæˆæ‹¬å·çš„å¯¹æ•°ï¼Œè¯·ä½ è®¾è®¡ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºèƒ½å¤Ÿç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å¹¶ä¸” æœ‰æ•ˆçš„ æ‹¬å·ç»„åˆã€‚ ç¤ºä¾‹: è¾“å…¥ï¼šn = 3 è¾“å‡ºï¼š[ \"((()))\", \"(()())\", \"(())()\", \"()(())\", \"()()()\" ] 2 è§£æ³•2.1 æ€æƒ³æˆ‘æ˜¯ä½¿ç”¨çš„dfsï¼Œé€’å½’å¤ªçˆ½äº†ã€‚å…¶ä»–çš„æ€è·¯å¦‚åŠ¨æ€è§„åˆ’ä¹Ÿå¯ä»¥ã€‚ 2.2 ä»£ç class Solution { List&lt;String> ans; public List&lt;String> generateParenthesis(int n) { ans = new ArrayList&lt;>(); addToAns(0,0,\"\",n); return ans; } //leftï¼šå½“å‰å·¦æ‹¬å·æ•°ï¼Œrightï¼šå½“å‰å³æ‹¬å·æ•°ã€‚ public void addToAns(int left,int right,String s,int n){ if(left == n&amp;&amp;right == n) { ans.add(s); return; } if(left&lt;n) addToAns(left+1,right,s+\"(\",n); //ä»…å½“å³æ‹¬å·æ•°å°äºå·¦æ‹¬å·æ•°æ‰èƒ½æ·»åŠ å³æ‹¬å· if(right&lt;left) addToAns(left,right+1,s+\")\",n); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"try-catch-finallyå­—èŠ‚ç å®ä¾‹æ¢ç©¶","slug":"try-catch-finallyå­—èŠ‚ç å®ä¾‹æ¢ç©¶","date":"2020-04-08T15:20:32.000Z","updated":"2020-04-08T17:34:00.389Z","comments":true,"path":"article/try-catch-finallyå­—èŠ‚ç å®ä¾‹æ¢ç©¶/","link":"","permalink":"https://www.codetool.top/article/try-catch-finally%E5%AD%97%E8%8A%82%E7%A0%81%E5%AE%9E%E4%BE%8B%E6%8E%A2%E7%A9%B6/","excerpt":"","text":"æœ¬æ–‡ä½¿ç”¨Ideaçš„jclasslibæ’ä»¶æŸ¥çœ‹å­—èŠ‚ç ã€‚æœ¬æ–‡å…¨ç¨‹è‡ªè¨€è‡ªè¯­ï¼Œè¯·å‹¿è‡ªè¡Œä»£å…¥ã€‚ 1 æ¦‚è¿°javaæ˜¯æ€ä¹ˆå¤„ç†try-catch-finallyçš„ï¼Ÿ æˆ‘ä»¬åœ¨æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°06å­¦ä¹ è¿‡ï¼Œåœ¨classå­—èŠ‚ç ä¸­çš„å±æ€§è¡¨ä¸­ï¼Œå­˜åœ¨codeå±æ€§ï¼Œå®ƒç”¨äºå­˜æ”¾å„æ–¹æ³•çš„å­—èŠ‚ç ã€å±æ€§ç­‰ã€‚å…¶ä¸­å°±åŒ…æ‹¬exception_infoï¼Œå³å¼‚å¸¸è¡¨ï¼Œå®ƒè®°å½•äº†å½“ä¸€ä¸ªå¼‚å¸¸å‘ç”Ÿåï¼Œåº”è·³è½¬åˆ°å“ªä¸€è¡Œç»§ç»­æ‰§è¡Œï¼Œè€Œfinallyé‡Œé¢çš„ä»£ç å—ç¼–è¯‘æˆå­—èŠ‚ç ååˆ™æ˜¯è¢«å¤åˆ¶æˆè®¸å¤šä»½åˆ†åˆ«é™„åœ¨tryå’Œå„catchå—çš„åé¢ã€‚è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°±é€šè¿‡ä¸€äº›å®ä¾‹æ¥çœ‹çœ‹ï¼Œjavaä¸­çš„try-catch-finallyå¼•ç”³å‡ºçš„ä¸€äº›é—®é¢˜ã€‚ 2 æ™®é€šçš„ä¾‹å­2.1 æ™®é€šä¸­çš„æ™®é€šä¾‹å­æˆ‘ä»¬å…ˆæ¥ä¸€ä¸ªæ™®é€šçš„ä¾‹å­ public static void normal(){ try { System.out.print(\"try-\"); }catch (Exception e){ System.out.print(\"catch\"); }finally { System.out.print(\"finally\"); } } è¿™ä¸ªç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“æ˜¯è¾“å‡ºtry-finallyï¼Œå› ä¸ºæ²¡æœ‰å¼‚å¸¸å‡ºç°ï¼Œé‚£ä¹ˆå®ƒçš„å­—èŠ‚ç æ˜¯ï¼š 0 getstatic #4 &lt;java/lang/System.out&gt; 3 ldc #5 &lt;try-&gt; 5 invokevirtual #6 &lt;java/io/PrintStream.print&gt; ---------------- ä¸Šé¢è¿™éƒ¨åˆ†è¾“å‡º&quot;try-&quot;----------------- 8 getstatic #4 &lt;java/lang/System.out&gt; 11 ldc #7 &lt;finally&gt; 13 invokevirtual #6 &lt;java/io/PrintStream.print&gt; ---------------- ä¸Šé¢è¿™éƒ¨åˆ†è¾“å‡º&quot;finally&quot;-------------- 16 goto 50 (+34) -----------æ­£å¸¸æµç¨‹ï¼Œè·³è½¬åˆ°50è¡Œç›´æ¥return-------------- 19 astore_0 20 getstatic #4 &lt;java/lang/System.out&gt; 23 ldc #8 &lt;catch&gt; 25 invokevirtual #6 &lt;java/io/PrintStream.print&gt; -----ä¸Šé¢è¿™éƒ¨åˆ†è¾“å‡º&quot;catch&quot;,astore_0å­˜å…¥çš„æ˜¯å¼‚å¸¸ä¿¡æ¯----- 28 getstatic #4 &lt;java/lang/System.out&gt; 31 ldc #7 &lt;finally&gt; 33 invokevirtual #6 &lt;java/io/PrintStream.print&gt; 36 goto 50 (+14) -----æ³¨æ„ä¸Šé¢è¿™éƒ¨åˆ†ä¹Ÿæ˜¯è¾“å‡º&quot;finally&quot;ï¼Œå’Œä¹‹å‰æŸéƒ¨åˆ†ä¸€æ ·---- 39 astore_1 40 getstatic #4 &lt;java/lang/System.out&gt; 43 ldc #7 &lt;finally&gt; 45 invokevirtual #6 &lt;java/io/PrintStream.print&gt; 48 aload_1 49 athrow -----æ³¨æ„ä¸Šé¢è¿™éƒ¨åˆ†ä¹Ÿæ˜¯è¾“å‡º&quot;finally&quot;ï¼Œä½†æŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸---- 50 returnæˆ‘ä»¬çœ‹çœ‹å¼‚å¸¸è¡¨ï¼š å¦‚ä½•è§£è¯»ï¼š 0-8è¡Œï¼ˆä¸åŒ…æ‹¬8ï¼‰çš„è¯­å¥å‡ºç°å¼‚å¸¸ï¼ˆç±»å‹ä¸ºExceptionï¼Œæ˜¯æˆ‘ä»¬catchçš„å¼‚å¸¸ç±»å‹ï¼‰ï¼Œäº¤ç”±19è¡Œå¤„ç†ï¼ˆcatchä»£ç å—ï¼‰ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°28è¡Œæ‰§è¡Œå®Œcatchä»£ç å—åï¼Œå°±æ‰§è¡Œfinallyä»£ç å—ã€‚ 0-8è¡Œçš„è¯­å¥å‡ºç°å¼‚å¸¸ï¼ˆç±»å‹ä¸ºanyï¼Œä»£è¡¨ä»»ä½•å¼‚å¸¸ï¼‰ï¼Œäº¤ç”±39è¡Œå¤„ç†ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œä¼šæœ‰è¿™ä¸€é¡¹å‘¢ï¼Ÿæ˜¯å› ä¸ºæˆ‘ä»¬å®šä¹‰äº†finallyï¼Œå¦‚æœåœ¨tryä¸­å‡ºç°äº†æˆ‘ä»¬æ²¡æœ‰catchçš„å¼‚å¸¸ç±»å‹ï¼Œå°±å¯èƒ½ä¼šå‡ºç°finallyä¸­çš„ä»£ç æ²¡æœ‰æ‰§è¡Œçš„æƒ…å†µï¼Œæ‰€ä»¥ä¸ºäº†é˜²æ­¢finallyä¸­çš„ä»£ç ä¸æ‰§è¡Œï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬æš‚æ—¶storeè¿™ä¸ªå¼‚å¸¸ä¿¡æ¯ï¼ˆå¯¹åº”39è¡Œï¼‰ï¼Œæ‰§è¡Œå®Œfinallyè¯­å¥å—åå†æŠ›å‡ºï¼ˆå¯¹åº”49è¡Œï¼‰ 19-28è¡Œçš„è¯­å¥å‡ºç°å¼‚å¸¸ï¼ˆç±»å‹ä¸ºanyï¼Œä»£è¡¨ä»»ä½•å¼‚å¸¸ï¼‰ï¼Œäº¤ç”±39è¡Œå¤„ç†ã€‚ä¸ºä»€ä¹ˆè¿™é‡Œä¼šæœ‰è¿™ä¸€é¡¹å‘¢ï¼ŸåŸå› å’Œä¸Šé¢ä¸€æ ·ï¼Œå¦‚æœæ‰§è¡Œcatchä»£ç å—åˆå‡ºç°äº†å¼‚å¸¸ï¼Œä¹Ÿè¦ä¿è¯finallyä»£ç å—çš„æ‰§è¡Œã€‚ 2.2 æ™®é€šä¾‹å­ä¸¾ä¸€åä¸‰æœ‰äº†ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°±æ¥æ€è€ƒä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰finallyä»£ç å—ï¼Œå­—èŠ‚ç ä¼šæ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢ï¼Ÿ public static void normal(){ try { System.out.print(\"try-\"); }catch (Exception e){ System.out.print(\"catch\"); } } é¦–å…ˆèƒ½æƒ³åˆ°çš„æ˜¯ï¼Œæ­£å¸¸æµç¨‹æ‰§è¡Œå®Œtryä¸­çš„å†…å®¹å°±åº”è¯¥ç›´æ¥è¿”å›ã€‚è€Œå‡ºç°å¼‚å¸¸å°±åº”è¯¥è·³è½¬è‡³ä¸­é—´ä¸€æ®µç”¨äºå¤„ç†å¼‚å¸¸çš„ä»£ç å—ã€‚å› ä¸ºæ²¡æœ‰finallyä»£ç å—ï¼Œåº”è¯¥ä¹Ÿä¸ä¼šæœ‰é‚£ä¹ˆå¤šå†—ä½™ä»£ç å—è¢«å¤åˆ¶ã€‚ éªŒè¯ï¼š 0 getstatic #4 &lt;java/lang/System.out&gt; 3 ldc #5 &lt;try-&gt; 5 invokevirtual #6 &lt;java/io/PrintStream.print&gt; ----------ä¸Šé¢è¾“å‡º&quot;try-&quot;------------------------- 8 goto 20 (+12) ----------æ­£å¸¸æµç¨‹è·³è½¬è‡³20è¡Œä¹‹é—´è¿”å›-------------- 11 astore_0 12 getstatic #4 &lt;java/lang/System.out&gt; 15 ldc #7 &lt;catch&gt; 17 invokevirtual #6 &lt;java/io/PrintStream.print&gt; ------ä¸Šé¢è¾“å‡º&quot;catch&quot;ï¼Œæ˜¯catchä»£ç å—çš„å†…å®¹--------- 20 returnè¿™ä¹ˆä¸€çœ‹ç¡®å®æ¸…çˆ½å¤šäº†ï¼Œå†çœ‹çœ‹å¼‚å¸¸è¡¨ï¼š ç¡®å®å¼‚å¸¸è¡¨ä¹Ÿæ¸…çˆ½å¤šäº†ï¼Œå› ä¸ºä¸å¿…ä¿è¯finallyä»£ç å—çš„æ‰§è¡Œï¼Œè¿™é‡Œåªæœ‰æˆ‘ä»¬æ˜¾å¼catchçš„ä¸€ç§å¼‚å¸¸ã€‚ 3 æ²¡äº‹è‡ªå·±æŠ›å‡ºå¼‚å¸¸ç©ç©ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ3.1 tryæŠ›å‡ºå¼‚å¸¸public static void throwAndCatch(){ try { throw new Exception(); System.out.println(\"éªšä¸€ä¸‹\"); }catch (Exception e){ System.out.println(\"æŠ“ä½äº†\"); } System.out.println(\"æˆ‘åœ¨å¤–é¢\"); } è¿™æ®µä»£ç çš„åŸå‹æ¥è‡ªç‰›å®¢ç½‘ä¸€é“é¢˜ï¼Œè¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ ç­”æ¡ˆåº”è¯¥æ˜¯æŠ“ä½äº†å’Œæˆ‘åœ¨å¤–é¢ï¼Œcatchæ˜¯å¯ä»¥æ•è·åœ¨tryä¸­æ‰‹åŠ¨æŠ›å‡ºçš„å¼‚å¸¸çš„ï¼Œä½†å› ä¸ºéƒ¨åˆ†ç¼–è¯‘å™¨ä¼˜åŒ–ç¨‹åº¦è¿‡é«˜çŸ¥é“System.out.println(&quot;éªšä¸€ä¸‹&quot;);æ˜¯ä¸å¯è¾¾è¯­å¥ï¼Œä¼šæŠ¥ç¼–è¯‘é”™è¯¯ã€‚æˆ‘æ²¡æ‰¾åˆ°æ€ä¹ˆå…³é—­è¿™ä¸ªå¼‚å¸¸æ£€æŸ¥ TT_TT 3.2 catchæŠ›å‡ºå¼‚å¸¸catchä¸­æŠ›å‡ºå¼‚å¸¸çš„æƒ…å†µï¼Œæˆ‘ä»¬æŠŠä¸Šé¢é‚£æ®µä»£ç æ”¹æˆï¼š public static void throwAndCatch(){ try { int i = 1/0; System.out.println(\"å‡ºç°å¼‚å¸¸äº†\"); }catch (Exception e){ System.out.println(\"æŠ“ä½äº†\"); throw new RuntimeException(); } System.out.println(\"æˆ‘åœ¨å¤–é¢\"); } ä¸ºä»€ä¹ˆè¦æŠ›RuntimeExceptionï¼Ÿå› ä¸ºRuntimeExceptionæ˜¯éå—æŸ¥å¼‚å¸¸ï¼Œå¯ä»¥ä¸ç”¨catchï¼Œå¦åˆ™å³ä½¿æ˜¯åœ¨catchä¸­æŠ›å‡ºå¼‚å¸¸è¿˜æ˜¯éœ€è¦å†åµŒå¥—ä¸€å±‚catchã€‚ é‚£ä¹ˆè¿™æ®µä»£ç ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿæˆ‘ç›¸ä¿¡è¿™é‡Œå¯èƒ½å°±æœ‰äººçŒœä¸å‡†äº†ï¼Œæ­£ç¡®ç­”æ¡ˆåº”è¯¥æ˜¯æŠ“ä½äº†ï¼Œå¹¶æ¥ç€æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ã€‚ æ¥çœ‹ä¸€ä¸‹å­—èŠ‚ç ï¼š 0 iconst_1 1 iconst_0 2 idiv 3 istore_0 ---------ä¸Šé¢è¿™æ®µä»£ç åš1/0çš„é™¤æ³•-------------------- 4 getstatic #4 &lt;java/lang/System.out&gt; 7 ldc #8 &lt;å‡ºç°å¼‚å¸¸äº†&gt; 9 invokevirtual #9 &lt;java/io/PrintStream.println&gt; ----------ä¸Šé¢è¾“å‡º&quot;å‡ºç°å¼‚å¸¸äº†&quot;---------------------- 12 goto 32 (+20) -------æ­£å¸¸æµç¨‹è·³è½¬32è¡Œï¼Œæ‰§è¡Œå¤–é¢çš„ä»£ç -------------- 15 astore_0 16 getstatic #4 &lt;java/lang/System.out&gt; 19 ldc #10 &lt;æŠ“ä½äº†&gt; 21 invokevirtual #9 &lt;java/io/PrintStream.println&gt; ----------ä¸Šé¢è¾“å‡º&quot;æŠ“ä½äº†&quot;---------------------- 24 new #11 &lt;java/lang/RuntimeException&gt; 27 dup 28 invokespecial #12 &lt;java/lang/RuntimeException.&lt;init&gt;&gt; 31 athrow ----------ä¸Šé¢æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸---------------------- 32 getstatic #4 &lt;java/lang/System.out&gt; 35 ldc #13 &lt;æˆ‘åœ¨å¤–é¢&gt; 37 invokevirtual #9 &lt;java/io/PrintStream.println&gt; ----------ä¸Šé¢è¾“å‡º&quot;æˆ‘åœ¨å¤–é¢&quot;---------------------- 40 returnæ¥çœ‹çœ‹å¼‚å¸¸è¡¨ï¼š æ˜¾ç„¶è¿™é‡Œä¹Ÿåªæœ‰æˆ‘ä»¬æ˜¾å¼catchçš„Exceptionå¤„ç†ã€‚é‚£æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹æ‰§è¡Œæµç¨‹ï¼š 0-3è¡Œï¼Œæ‰§è¡Œ1/0çš„é™¤æ³•ï¼Œå‡ºç°äº†é™¤ä»¥é›¶çš„å¼‚å¸¸ï¼Œå› ä¸ºæ­¤æ—¶è¡Œå·å¤„äº0-12ä¹‹é—´ï¼Œå°±äº¤ç»™15è¡Œç»§ç»­å¤„ç†ï¼Œæ‰€ä»¥â€å‡ºç°å¼‚å¸¸äº†â€æ²¡æœ‰è¾“å‡ºã€‚ 15-21è¡Œï¼Œè¾“å‡ºâ€æŠ“ä½äº†â€ï¼Œç»§ç»­æ‰§è¡Œã€‚ 24-31è¡Œï¼Œnewäº†ä¸€ä¸ªRuntimeExceptionï¼Œå¹¶æŠ›å‡ºï¼Œå› ä¸ºæ²¡æœ‰è¯¥å¼‚å¸¸æ²¡æœ‰å¯¹åº”çš„å¤„ç†ï¼Œç¨‹åºç»ˆæ­¢ï¼Œåé¢çš„â€æˆ‘åœ¨å¤–é¢â€ä¹Ÿä¸ä¼šè¾“å‡ºã€‚ 3.3 ä¸¾ä¸€åä¸‰public static void throwAndCatch(){ try { int i = 1/0; System.out.println(\"å‡ºç°å¼‚å¸¸äº†\"); }catch (Exception e){ System.out.println(\"æŠ“ä½äº†\"); throw new RuntimeException(); }finally { System.out.println(\"å¿…é¡»æ‰§è¡Œ\"); } System.out.println(\"æˆ‘åœ¨å¤–é¢\"); } æ¥çœ‹çœ‹è¿™æ®µä»£ç ï¼Œå¢åŠ äº†ä¸€ä¸ªfinallyè¯­å¥å—ä¼šè¾“å‡ºä»€ä¹ˆå‘¢ï¼Ÿè¿™é‡Œå°±ä¸ç ”ç©¶å­—èŠ‚ç äº†ï¼Œå› ä¸ºåŸå› ä¹‹å‰åœ¨æ™®é€šä¾‹å­çš„æ—¶å€™å°±æåˆ°è¿‡äº†ï¼Œå¦‚æœcatchä»£ç å—ä¸­å‡ºç°å¼‚å¸¸ï¼Œå¹¶ä¸”å­˜åœ¨finallyä»£ç å—ï¼Œä¼šå…ˆæŠŠå¼‚å¸¸ä¿¡æ¯å­˜èµ·æ¥ï¼Œæ‰§è¡Œå®Œfinallyä¹‹åå†æŠ›å‡ºå¼‚å¸¸ã€‚ é‚£ä¹ˆç›¸ä¿¡ä½ ä¹ŸçŸ¥é“äº†ï¼Œè¿™é‡Œçš„è¾“å‡ºåº”è¯¥æ˜¯ï¼šæŠ“ä½äº†å’Œå¿…é¡»æ‰§è¡Œã€‚ 4 æˆ‘éƒ½è¦returnäº†ï¼Œfinallyè¿˜ä¼šæ‰§è¡Œå—ï¼Ÿ4.1 æ™®é€šä¾‹å­public static int var(){ int i; try { i = 10; System.out.println(\"ä¿®æ”¹æˆ10äº†å“¦\"); return i; }catch (Exception e){ i = 20; System.out.println(\"ä¿®æ”¹æˆ20äº†å“¦\"); }finally { i = 30; System.out.println(\"ä¿®æ”¹æˆ30äº†å“¦\"); } return i; } public static void main(String[] args) { System.out.println(var()); } è¿™ä¸ªä¾‹å­å¼€å§‹æœ‰ä¸€ç‚¹éš¾åº¦äº†ï¼Œä½ èƒ½å‘Šè¯‰æˆ‘å®ƒä¼šè¾“å‡ºä»€ä¹ˆå—ï¼Ÿ é¦–å…ˆcatchå†…çš„ä»£ç æ˜¯ä¸ä¼šæ‰§è¡Œçš„ï¼Œå› ä¸ºæ²¡æœ‰å¼‚å¸¸æŠ›å‡ºï¼Œä½ è§‰å¾—finallyä¸­çš„ä»£ç ä¼šæ‰§è¡Œå—ï¼Ÿ ç­”æ¡ˆæ˜¯ä¼šçš„ï¼Œçœ‹çœ‹è¾“å‡ºï¼š ä¿®æ”¹æˆ10äº†å“¦ ä¿®æ”¹æˆ30äº†å“¦ 10æ˜¯å¦ä¼šå¤§åƒä¸€æƒŠï¼Ÿfinallyä¸­çš„ä»£ç æ‰§è¡Œäº†ï¼Œåº”è¯¥ä¹Ÿå°†iä¿®æ”¹ä¸º30äº†ï¼Œæ€ä¹ˆè¾“å‡ºçš„è¿˜æ˜¯10ï¼Ÿ çœ‹çœ‹å­—èŠ‚ç ï¼š 0 bipush 10 2 istore_0 ----------ä¸Šé¢å°†10å­˜å‚¨åˆ°å±€éƒ¨å˜é‡è¡¨---------------- 3 getstatic #2 &lt;java/lang/System.out&gt; 6 ldc #16 &lt;ä¿®æ”¹æˆ10äº†å“¦&gt; 8 invokevirtual #10 &lt;java/io/PrintStream.println&gt; ----------ä¸Šé¢è¾“å‡º&quot;ä¿®æ”¹æˆ10äº†å“¦&quot;------------------ 11 iload_0 12 istore_1 -----ä¸Šé¢å°†10å…ˆè¯»å‡ºï¼Œåˆå­˜å‚¨åˆ°å±€éƒ¨å˜é‡è¡¨çš„1å·æ§½ä½----- 13 bipush 30 15 istore_0 ------ä¸Šé¢å°†30å­˜å‚¨åˆ°å±€éƒ¨å˜é‡è¡¨çš„0å·æ§½ä½------------ 16 getstatic #2 &lt;java/lang/System.out&gt; 19 ldc #17 &lt;ä¿®æ”¹æˆ30äº†å“¦&gt; 21 invokevirtual #10 &lt;java/io/PrintStream.println&gt; ----------ä¸Šé¢è¾“å‡º&quot;ä¿®æ”¹æˆ30äº†å“¦&quot;------------------ 24 iload_1 25 ireturn ----------ä»ä¸€å·æ§½ä½è¯»å‡ºæ•°æ®ï¼Œå¹¶è¿”å›--------------- 26 astore_1 27 bipush 20 29 istore_0 ------ä¸Šé¢å°†20å­˜å‚¨åˆ°å±€éƒ¨å˜é‡è¡¨çš„0å·æ§½ä½------------ 30 getstatic #2 &lt;java/lang/System.out&gt; 33 ldc #18 &lt;ä¿®æ”¹æˆ20äº†å“¦&gt; 35 invokevirtual #10 &lt;java/io/PrintStream.println&gt; ----------ä¸Šé¢è¾“å‡º&quot;ä¿®æ”¹æˆ20äº†å“¦&quot;------------------ 38 bipush 30 40 istore_0 41 getstatic #2 &lt;java/lang/System.out&gt; 44 ldc #17 &lt;ä¿®æ”¹æˆ30äº†å“¦&gt; 46 invokevirtual #10 &lt;java/io/PrintStream.println&gt; ----è¿™æ®µå’Œä¹‹å‰çœ‹è¿‡çš„ä¸€æ®µä¸€æ ·ï¼Œæ˜¯finallyå—ä¼šå¹²çš„äº‹----- 49 goto 66 (+17) 52 astore_2 53 bipush 30 55 istore_0 56 getstatic #2 &lt;java/lang/System.out&gt; 59 ldc #17 &lt;ä¿®æ”¹æˆ30äº†å“¦&gt; 61 invokevirtual #10 &lt;java/io/PrintStream.println&gt; 64 aload_2 65 athrow ----è¿™æ®µå’Œä¹‹å‰çœ‹è¿‡çš„ä¸€æ®µä¸€æ ·ï¼Œæ˜¯finallyå—ä¼šå¹²çš„äº‹----- 66 iload_0 67 ireturn ----------ä»é›¶å·æ§½ä½è¯»å‡ºæ•°æ®ï¼Œå¹¶è¿”å›---------------è¿™æ®µå­—èŠ‚ç æ˜¯ä¸æ˜¯çœ‹ç€å¤´ç–¼ï¼Œå…¶å®åªéœ€è¦æ³¨æ„åˆ°å®ƒåœ¨é¢‘ç¹åœ°æ“ä½œå±€éƒ¨å˜é‡è¡¨å°±è¡Œäº†ã€‚å…¶ä»–æµç¨‹å’Œæˆ‘ä»¬åœ¨æ™®é€šä¾‹å­é‡Œä»‹ç»çš„å·®ä¸å¤šã€‚ çœ‹çœ‹å¼‚å¸¸è¡¨ï¼š å—¯ã€‚ã€‚ç¡®å®è·Ÿæˆ‘ä»¬ä¹‹å‰ä»‹ç»çš„æ™®é€šä¾‹å­å·®ä¸å¤šï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§å¥‡å¼‚è¾“å‡ºå‘¢ï¼Ÿæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹æ‰§è¡Œæµç¨‹ï¼š 0-2è¡Œï¼Œå°†10å­˜å‚¨äºå±€éƒ¨å˜é‡è¡¨0å·æ§½ã€‚ 3-8è¡Œè¾“å‡ºâ€ä¿®æ”¹æˆ10äº†å“¦â€ 11-15è¡Œï¼Œå°†10è½¬ç§»åˆ°å±€éƒ¨å˜é‡è¡¨1å·æ§½ï¼Œå°†30å­˜å…¥0å·æ§½ 19-21è¡Œï¼Œè¾“å‡ºâ€ä¿®æ”¹æˆ30äº†å“¦â€ 24-25è¡Œï¼Œä»1å·æ§½ä¸­è¯»å‡º10ï¼Œå¹¶è¿”å›ã€‚ ç‰›çš„ï¼å…¶å®æ‰§è¡Œçš„æµç¨‹å°±è¿™ä¹ˆç‚¹ï¼Œæ³¨æ„åˆ°finallyæ‰§è¡Œå‰åï¼Œç¨‹åºåˆ†åˆ«å°†10å­˜å…¥å±€éƒ¨å˜é‡è¡¨å’Œä»å±€éƒ¨å˜é‡è¡¨ä¸­å–å‡ºï¼Œå®ç°äº†finallyä¸­å¯¹å˜é‡çš„ä¿®æ”¹ä¸å½±å“å³å°†returnçš„ç»“æœã€‚ ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œå› ä¸ºç¼–è¯‘å™¨çŸ¥é“tryä¸­å³å°†returnæ•°æ®ï¼Œä½†æ˜¯finallyè¿˜æ˜¯å¾—æ‰§è¡Œï¼Œæ‰€ä»¥ä¸ºäº†ä¿æŠ¤å³å°†è¿”å›çš„æ•°æ®ï¼Œä¼šå…ˆå°†è¯¥æ•°æ®å­˜èµ·æ¥ï¼Œç­‰finallyæ‰§è¡Œå®Œå†å–å‡ºå¹¶è¿”å›ã€‚ 4.2 ä¸¾ä¸€åä¸‰public static int var(){ int i; try { i = 10; System.out.println(\"ä¿®æ”¹æˆ10äº†å“¦\"); int a = 1/0; return i; }catch (Exception e){ i = 20; System.out.println(\"ä¿®æ”¹æˆ20äº†å“¦\"); return i; }finally { i = 30; System.out.println(\"ä¿®æ”¹æˆ30äº†å“¦\"); } } public static void main(String[] args) { System.out.println(var()); } è¿™ä¸ªä¾‹å­ç¨å¾®æ›´å¤æ‚ç‚¹äº†ï¼Œæ‰§è¡Œåˆ°catchä¸­å»äº†ï¼Œé‚£ä¹ˆè¾“å‡ºæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ å¦‚æœä½ æœ‰å¥½å¥½å¾—è·Ÿç€æˆ‘çœ‹ä¸‹æ¥ï¼Œåº”è¯¥ä¸éš¾çŒœåˆ°ï¼Œtryä¸­å¼‚å¸¸å‰çš„è¯­å¥ã€catchå’Œfinallyä¸­å¾—è¯­å¥éƒ½ä¼šæ‰§è¡Œï¼Œå®é™…ä¸Šï¼Œfinallyä¹Ÿä¸ä¼šå½±å“catchè¿”å›çš„ç»“æœï¼š ä¿®æ”¹æˆ10äº†å“¦ ä¿®æ”¹æˆ20äº†å“¦ ä¿®æ”¹æˆ30äº†å“¦ 205 æŠ¢ç€returnï¼Œè°ä¼˜å…ˆï¼Ÿ5.1 æ™®é€šä¾‹å­public static int num(){ try { return 10; }catch (Exception e){ return 20; }finally { return 30; } } public static void main(String[] args) { System.out.println(num()); } è¿™ä¸ªä¾‹å­ä¸å¤æ‚å§ï¼Œç»è¿‡äº†è¿™ä¹ˆå¤šå†ç»ƒï¼Œä½ èƒ½çŒœåˆ°ç»“æœå—ï¼Ÿ ç­”æ¡ˆå…¶å®æ˜¯30ï¼Œæ³¨æ„finallyä¸­å¦‚æœå‡ºç°äº†returnè¯­å¥ï¼Œç”±äºfinallyå¿…ä¼šæ‰§è¡Œï¼Œæ€»æ˜¯finallyä¸­çš„returnè¯­å¥ç”Ÿæ•ˆã€‚ å­—èŠ‚ç ä¹Ÿä¸éš¾ï¼š 0 bipush 10 2 istore_0 3 bipush 30 5 ireturn -----åœ¨æ­¤å¤„å°±æ‰§è¡Œäº†finallyå¹¶è¿”å›----- 6 astore_0 7 bipush 20 9 istore_1 10 bipush 30 12 ireturn 13 astore_2 14 bipush 30 16 ireturn5.2 ä¸¾ä¸€åä¸‰ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ä¸Šé¢çš„ä¾‹å­ï¼š public static int num(){ try { int i = 1/0; return 10; }catch (Exception e){ return 20; }finally { return 30; } } public static void main(String[] args) { System.out.println(num()); } è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœä½ èƒ½å¾ˆå¿«ç»™å‡ºç­”æ¡ˆï¼Œæˆ‘è§‰å¾—ä½ å¯¹try-catch-finallyçš„ç†è§£å·²ç»å·®ä¸å¤šäº† ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ è¿™é“é¢˜çš„ç­”æ¡ˆä¾ç„¶æ˜¯30ï¼Œå› ä¸ºç¼–è¯‘å™¨çŸ¥é“catchä¸­å³å°†è¦returnäº†ï¼Œå†ä¸æ‰§è¡Œfinallyæ¥ä¸åŠäº†ï¼Œäºæ˜¯ä¿å­˜ç°åœºå»æ‰§è¡Œfinallyï¼Œç»“æœåœ¨finallyä¸­å°±returnæ‰äº†ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬æ¨èä¸è¦åœ¨finallyä»£ç å—ä¸­ä½¿ç”¨returnè¯­å¥ï¼Œå› ä¸ºå®ƒä¼šè¦†ç›–æ‰å…¶ä»–åœ°æ–¹çš„returnè¯­å¥ï¼Œç¨‹åºçš„å¯è¯»æ€§ä¸å¥½ï¼Œå¦‚æœä½ ä¸æ˜¯çœ‹äº†æˆ‘è¿™ç¯‡æ–‡ç« ï¼Œä¹Ÿæƒ³ä¸åˆ°è¿™æ®µä»£ç è¿”å›30å§ï¼Ÿ æœ‰äººå¯èƒ½è¦é—®äº†ï¼Œå­¦ä¹ è¿™äº›æ˜¯ä¸ºäº†ä»€ä¹ˆå‘¢ï¼Ÿè°å†™ä»£ç ä¼šè¿™ä¹ˆå†™å‘¢ï¼Ÿé‚£ä¸éƒ½æ˜¯ä¸ºäº†åº”ä»˜é¢è¯•å—ğŸ˜€ 6 finallyä¸ä¼šæ‰§è¡Œçš„ä¾‹å¤–æƒ…å†µæœ‰äººçœ‹äº†å…¨æ–‡å°±è¦è¯´äº†ï¼Œæ‡‚äº†ï¼åæ­£finallyå¿…æ‰§è¡Œï¼Œè®°ä½è¿™ä¸ªå°±ä¸‡æ— ä¸€å¤±äº†ï¼ å…¶å®finallyä¹Ÿä¸æ˜¯é‚£ä¹ˆçš„ä¿é™©ï¼Œæ¯”å¦‚æˆ‘ç»™ä½ ä¸¾ä¸ªä¾‹å­ï¼š try{ System.exit(1); }finally{ System.out.println(\"finallyæ‰§è¡Œäº†\"); } è¿™æ®µä»£ç ä¸­ï¼Œfinallyå°±ä¸ä¼šæ‰§è¡Œäº†ï¼Œé‡åˆ°System.exitï¼Œç¨‹åºä¼šç›´æ¥é€€å‡ºï¼Œç›¸å½“äºæ€è¿›ç¨‹äº†ã€‚ å…¶ä»–æƒ…å†µä¾‹å¦‚ä½ å¤–éƒ¨æ€è¿›ç¨‹ï¼Œæ–­ç”µè„‘ç”µæºï¼ˆæ‰‹åŠ¨æ»‘ç¨½ï¼‰ï¼Œfinallyä¹Ÿæ˜¯ä¸ä¼šæ‰§è¡Œçš„ã€‚ OKï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« å°±å†™åˆ°è¿™äº†ï¼Œé•¿ç¯‡åŸåˆ›å¥½æ–‡å¸Œæœ›å¤§å®¶æ”¯æŒ(^_^)","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://www.codetool.top/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"},{"name":"jvm","slug":"jvm","permalink":"https://www.codetool.top/tags/jvm/"}]},{"title":"å‰‘æŒ‡offer13-æœºå™¨äººçš„è¿åŠ¨èŒƒå›´","slug":"å‰‘æŒ‡offer13-æœºå™¨äººçš„è¿åŠ¨èŒƒå›´","date":"2020-04-08T03:31:45.000Z","updated":"2020-04-08T04:15:09.791Z","comments":true,"path":"article/å‰‘æŒ‡offer13-æœºå™¨äººçš„è¿åŠ¨èŒƒå›´/","link":"","permalink":"https://www.codetool.top/article/%E5%89%91%E6%8C%87offer13-%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%9A%84%E8%BF%90%E5%8A%A8%E8%8C%83%E5%9B%B4/","excerpt":"","text":"1 åŸé¢˜ï¼ˆæ¥æºLeetcodeï¼‰åœ°ä¸Šæœ‰ä¸€ä¸ªmè¡Œnåˆ—çš„æ–¹æ ¼ï¼Œä»åæ ‡ [0,0] åˆ°åæ ‡ [m-1,n-1] ã€‚ä¸€ä¸ªæœºå™¨äººä»åæ ‡ [0, 0] çš„æ ¼å­å¼€å§‹ç§»åŠ¨ï¼Œå®ƒæ¯æ¬¡å¯ä»¥å‘å·¦ã€å³ã€ä¸Šã€ä¸‹ç§»åŠ¨ä¸€æ ¼ï¼ˆä¸èƒ½ç§»åŠ¨åˆ°æ–¹æ ¼å¤–ï¼‰ï¼Œä¹Ÿä¸èƒ½è¿›å…¥è¡Œåæ ‡å’Œåˆ—åæ ‡çš„æ•°ä½ä¹‹å’Œå¤§äºkçš„æ ¼å­ã€‚ä¾‹å¦‚ï¼Œå½“kä¸º18æ—¶ï¼Œæœºå™¨äººèƒ½å¤Ÿè¿›å…¥æ–¹æ ¼ [35, 37] ï¼Œå› ä¸º3+5+3+7=18ã€‚ä½†å®ƒä¸èƒ½è¿›å…¥æ–¹æ ¼ [35, 38]ï¼Œå› ä¸º3+5+3+8=19ã€‚è¯·é—®è¯¥æœºå™¨äººèƒ½å¤Ÿåˆ°è¾¾å¤šå°‘ä¸ªæ ¼å­ï¼Ÿ ç¤ºä¾‹ 1: è¾“å…¥ï¼š m = 2, n = 3, k = 1è¾“å‡ºï¼š 3 ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼š m = 3, n = 1, k = 0è¾“å‡ºï¼š 1 æç¤ºï¼š 1 &lt;= n,m &lt;= 100 0 &lt;= k &lt;= 20 2 è§£æ³•2.1 æ€æƒ³dfsï¼Œæ•°ç»„ä¸­ä¼šå‡ºç°ä¸€äº›ç¬¦åˆæ¡ä»¶ä½†ä¸å¯è¾¾çš„æ ¼å­ã€‚ 2.2 ä»£ç class Solution { int count; boolean[][] visited; public int movingCount(int m, int n, int k) { visited = new boolean[m][n]; dfs(0,0,k); return count; } public void dfs(int x,int y,int k){ if(numSum(x)+numSum(y)>k || x>=visited.length||y>=visited[0].length || visited[x][y] == true ) return; count ++; visited[x][y] = true; dfs(x+1,y,k); dfs(x,y+1,k); } public int numSum(int num){ int sum = 0; while(num>=1){ sum += num % 10; num /= 10; } return sum; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"å‰‘æŒ‡offer","slug":"å‰‘æŒ‡offer","permalink":"https://www.codetool.top/tags/%E5%89%91%E6%8C%87offer/"}]},{"title":"è®¡ç½‘å¤ä¹ 03-æ•°æ®é“¾è·¯å±‚","slug":"è®¡ç½‘å¤ä¹ 03-æ•°æ®é“¾è·¯å±‚","date":"2020-04-07T13:11:13.000Z","updated":"2020-04-11T14:20:16.544Z","comments":true,"path":"article/è®¡ç½‘å¤ä¹ 03-æ•°æ®é“¾è·¯å±‚/","link":"","permalink":"https://www.codetool.top/article/%E8%AE%A1%E7%BD%91%E5%A4%8D%E4%B9%A003-%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/","excerpt":"","text":"è¿™é‡Œçš„æ•°æ®é“¾è·¯å±‚æŒ‡çš„æ˜¯åŸç†ä½“ç³»ç»“æ„çš„æ•°æ®é“¾è·¯å±‚ï¼Œå¯¹åº”OSIä¸ƒå±‚ä½“ç³»ç»“æ„ä¸­çš„æ•°æ®é“¾è·¯å±‚ï¼Œå¯¹åº”TCP/IPå››å±‚ä½“ç³»ç»“æ„ä¸­çš„ç½‘ç»œæ¥å£å±‚çš„ä¸€éƒ¨åˆ†ã€‚å®ƒæä¾›ä»‹è´¨è®¿é—®å’Œé“¾è·¯ç®¡ç†ï¼Œä¸ºç½‘ç»œå±‚æä¾›æœåŠ¡ã€‚å…¶æœ€åŸºæœ¬çš„æœåŠ¡æ˜¯å°†æºè‡ªç½‘ç»œå±‚æ¥çš„æ•°æ®å¯é åœ°ä¼ è¾“åˆ°ç›¸é‚»èŠ‚ç‚¹çš„ç›®æ ‡æœºç½‘ç»œå±‚ã€‚å…¶ä¸»è¦ä½œç”¨æ˜¯åŠ å¼ºç‰©ç†å±‚ä¼ è¾“åŸå§‹æ¯”ç‰¹æµçš„åŠŸèƒ½ï¼Œå°†ç‰©ç†å±‚æä¾›çš„å¯èƒ½å‡ºé”™çš„ç‰©ç†è¿æ¥æ”¹é€ æˆä¸ºé€»è¾‘ä¸Šæ— å·®é”™çš„æ•°æ®é“¾è·¯ï¼Œä½¿ä¹‹å¯¹ç½‘ç»œå±‚è¡¨ç°ä¸ºä¸€æ¡æ— å·®é”™çš„é“¾è·¯ã€‚ åŠŸèƒ½ï¼š ä¸ºç½‘ç»œå±‚æä¾›æœåŠ¡ï¼š æ— ç¡®è®¤æ— è¿æ¥æœåŠ¡ æœ‰ç¡®è®¤æ— è¿æ¥æœåŠ¡ æœ‰ç¡®è®¤é¢å‘è¿æ¥æœåŠ¡ é“¾è·¯ç®¡ç†ï¼Œå³è¿æ¥çš„å»ºç«‹ã€ç»´æŒã€é‡Šæ”¾(ç”¨äºé¢å‘è¿æ¥çš„æœåŠ¡)ã€‚ ç»„å¸§ã€‚ æµé‡æ§åˆ¶ã€‚ å·®é”™æ§åˆ¶(å¸§é”™/ä½é”™)ã€‚ 1 ä¸¤ç§ä¿¡é“ å¹¿æ’­ä¿¡é“éœ€è¦ä»‹è´¨è®¿é—®æ§åˆ¶ï¼šé‡‡å–ä¸€å®šçš„æªæ–½ï¼Œä½¿å¾—ä¸¤å¯¹èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ä¸ä¼šäº’ç›¸å¹²æ‰°ã€‚ æœ‰é™æ€åˆ’åˆ†ä¿¡é“å’ŒåŠ¨æ€åˆ†é…ä¿¡é“ä¸¤ç§æ–¹æ³•ï¼š 1.1 é™æ€åˆ’åˆ†ä¿¡é“æŠŠä¸€æ¡å¹¿æ’­ä¿¡é“ï¼Œé€»è¾‘ä¸Šåˆ†æˆå‡ æ¡ç”¨äºä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´é€šä¿¡çš„äº’ä¸å¹²æ‰°çš„å­ä¿¡é“ï¼Œå®é™…å°±æ˜¯æŠŠå¹¿æ’­ä¿¡é“è½¬å˜ä¸ºç‚¹å¯¹ç‚¹ä¿¡é“ã€‚ é¢‘åˆ†å¤ç”¨ FDM ç”¨æˆ·åœ¨åˆ†é…åˆ°ä¸€å®šçš„é¢‘å¸¦åï¼Œåœ¨é€šä¿¡è¿‡ç¨‹ä¸­è‡ªå§‹è‡³ç»ˆéƒ½å ç”¨è¿™ä¸ªé¢‘å¸¦ã€‚é¢‘åˆ†å¤ç”¨çš„æ‰€æœ‰ç”¨æˆ·åœ¨åŒæ ·çš„æ—¶é—´å ç”¨ä¸åŒçš„å¸¦å®½(é¢‘ç‡å¸¦å®½)èµ„æº æ—¶åˆ†å¤ç”¨ TDM å°†æ—¶é—´åˆ’åˆ†ä¸ºä¸€æ®µæ®µç­‰é•¿çš„æ—¶åˆ†å¤ç”¨å¸§(TDMå¸§)ã€‚æ¯ä¸€ä¸ªæ—¶åˆ†å¤ç”¨çš„ç”¨æˆ·åœ¨æ¯ä¸€ä¸ªTDMå¸§ä¸­å ç”¨å›ºå®šåºå·çš„æ—¶éš™ï¼Œæ‰€æœ‰ç”¨æˆ·è½®æµå ç”¨ä¿¡é“ã€‚ é¢‘åˆ†å¤ç”¨â€”â€”â€œå¹¶è¡Œâ€ï¼Œæ—¶åˆ†å¤ç”¨â€”â€”â€œå¹¶å‘â€ æ”¹è¿›ç‰ˆæœ¬çš„ç»Ÿè®¡æ—¶åˆ†å¤ç”¨ï¼šå…ˆæ”¶é›†å„ç”¨æˆ·çš„ä½¿ç”¨æƒ…å†µï¼ŒåŠ¨æ€åˆ†é…æ—¶éš™ æ³¢åˆ†å¤ç”¨ WDM æ³¢åˆ†å¤šè·¯å¤ç”¨å°±æ˜¯å…‰çš„é¢‘åˆ†å¤šè·¯å¤ç”¨ï¼Œåœ¨ä¸€æ ¹å…‰çº¤ä¸­ä¼ è¾“å¤šç§ä¸åŒæ³¢é•¿(é¢‘ç‡)çš„å…‰ä¿¡å·ï¼Œç”±äºæ³¢é•¿(é¢‘ç‡)ä¸åŒï¼Œæ‰€ä»¥å„è·¯å…‰ä¿¡å·äº’ä¸å¹²æ‰°ï¼Œæœ€åå†ç”¨æ³¢é•¿åˆ†è§£å¤ç”¨å™¨å°†å„è·¯æ³¢é•¿åˆ†è§£å‡ºæ¥ã€‚ ç åˆ†å¤ç”¨ CDM ç åˆ†å¤šå€(CDMA)æ˜¯ç åˆ†å¤ç”¨çš„ä¸€ç§æ–¹å¼ã€‚1ä¸ªæ¯”ç‰¹åˆ†ä¸ºå¤šä¸ªç ç‰‡/èŠ¯ç‰‡(chip)ï¼Œæ¯ä¸€ä¸ªç«™ç‚¹è¢«æŒ‡å®šä¸€ä¸ªå”¯ä¸€çš„mä½çš„èŠ¯ç‰‡åºåˆ—ã€‚å‘é€1æ—¶ç«™ç‚¹å‘é€èŠ¯ç‰‡åºåˆ—ï¼Œå‘é€0æ—¶å‘é€èŠ¯ç‰‡åºåˆ—åç (é€šå¸¸æŠŠ0å†™æˆ-1)ã€‚ å¦‚ä½•ä¸æ‰“æ¶:å¤šä¸ªç«™ç‚¹åŒæ—¶å‘é€æ•°æ®çš„æ—¶å€™ï¼Œè¦æ±‚å„ä¸ªç«™ç‚¹èŠ¯ç‰‡åºåˆ—ç›¸äº’æ­£äº¤ã€‚ å¦‚ä½•åˆå¹¶:å„è·¯æ•°æ®åœ¨ä¿¡é“ä¸­è¢«çº¿æ€§ç›¸åŠ ã€‚ å¦‚ä½•åˆ†ç¦»:åˆå¹¶çš„æ•°æ®å’Œæºç«™è§„æ ¼åŒ–å†…ç§¯ã€‚ 1.2 åŠ¨æ€åˆ†é…ä¿¡é“1.2.1 éšæœºæ¥å…¥1.2.1.1 ALOHAåè®®æƒ³å‘å°±å‘ï¼Œå†²çªé‡å‘ã€‚ å¦‚ä½•æ£€æµ‹å†²çªï¼Ÿè¶…æ—¶ä¹‹åæ²¡æœ‰æ”¶åˆ°ç¡®è®¤å¸§å°±è®¤ä¸ºå†²çªäº†ã€‚ è¶…æ—¶ä¹‹åç­‰å¾…ä¸€éšæœºæ—¶é—´åé‡ä¼ ã€‚ å¦‚æœé‡ä¼ ä¹Ÿå†²çªäº†ï¼Œç»§ç»­ç­‰å¾…ä¸€éšæœºæ—¶é—´åé‡ä¼ ï¼Œç›´åˆ°æ”¶åˆ°äº†ç¡®è®¤ã€‚ æ”¹è¿›åçš„æ—¶éš™ALOHAåè®®ï¼šæŠŠæ—¶é—´åˆ†æˆè‹¥å¹²ä¸ªç›¸åŒçš„æ—¶é—´ç‰‡ï¼Œæ‰€æœ‰ç”¨æˆ·åœ¨æ—¶é—´ç‰‡å¼€å§‹æ—¶åˆ»åŒæ­¥æ¥å…¥ç½‘ç»œä¿¡é“ï¼Œè‹¥å‘ç”Ÿå†²çªï¼Œåˆ™å¿…é¡»ç­‰åˆ°ä¸‹ä¸€ä¸ªæ—¶é—´ç‰‡å¼€å§‹æ—¶åˆ»å†å‘é€ã€‚ 1.2.1.2 CSMAåè®®è½½æ³¢ç›‘å¬å¤šè·¯è®¿é—®åè®®CSMAï¼š CSï¼šè½½æ³¢ä¾¦å¬/ç›‘å¬ï¼Œæ¯ä¸€ä¸ªç«™åœ¨å‘é€æ•°æ®ä¹‹å‰è¦æ£€æµ‹ä¸€ä¸‹æ€»çº¿ä¸Šæ˜¯å¦æœ‰å…¶ä»–è®¡ç®—æœºåœ¨å‘é€æ•°æ®ã€‚ MAï¼šå¤šç‚¹æ¥å…¥ï¼Œè¡¨ç¤ºè®¸å¤šè®¡ç®—æœºä»¥å¤šç‚¹æ¥å…¥çš„æ–¹å¼è¿æ¥åœ¨ä¸€æ ¹æ€»çº¿ä¸Šã€‚ å¦‚ä½•æ£€æµ‹ï¼šå½“å‡ ä¸ªç«™åŒæ—¶åœ¨æ€»çº¿ä¸Šå‘é€æ•°æ®æ—¶ï¼Œæ€»çº¿ä¸Šçš„ä¿¡å·ç”µå‹æ‘†åŠ¨å€¼å°†ä¼šå¢å¤§( äº’ç›¸å åŠ )ã€‚å½“ä¸€ä¸ªç«™æ£€æµ‹åˆ°çš„ä¿¡å·ç”µå‹æ‘†åŠ¨å€¼è¶…è¿‡ä¸€å®šé—¨é™å€¼æ—¶ï¼Œå°±è®¤ä¸ºæ€»çº¿ä¸Šè‡³å°‘æœ‰ä¸¤ä¸ªç«™åŒæ—¶åœ¨å‘é€æ•°æ®ï¼Œè¡¨æ˜äº§ç”Ÿäº†ç¢°æ’ï¼Œå³å‘ç”Ÿäº†å†²çªã€‚ 1-åšæŒCSMAæ€æƒ³: å¦‚æœä¸€ä¸ªä¸»æœºè¦å‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆå®ƒå…ˆç›‘å¬ä¿¡é“ã€‚ç©ºé—²åˆ™ç›´æ¥ä¼ è¾“ï¼Œä¸å¿…ç­‰å¾…ã€‚å¿™åˆ™ä¸€ç›´ç›‘å¬ï¼Œç›´åˆ°ç©ºé—²é©¬ä¸Šä¼ è¾“ã€‚å¦‚æœæœ‰å†²çª(ä¸€æ®µæ—¶é—´å†…æœªæ”¶åˆ°è‚¯å®šå›å¤)ï¼Œåˆ™ç­‰å¾…ä¸€ä¸ªéšæœºé•¿çš„æ—¶é—´å†ç›‘å¬ï¼Œé‡å¤ä¸Šè¿°è¿‡ç¨‹ã€‚ éåšæŒCSMAæ€æƒ³: å¦‚æœä¸€ä¸ªä¸»æœºè¦å‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆå®ƒå…ˆç›‘å¬ä¿¡é“ã€‚ç©ºé—²åˆ™ç›´æ¥ä¼ è¾“ï¼Œä¸å¿…ç­‰å¾…ã€‚å¿™åˆ™ç­‰å¾…ä¸€ä¸ªéšæœºçš„æ—¶é—´ä¹‹åå†è¿›è¡Œç›‘å¬ã€‚ p-åšæŒCSMAæ€æƒ³: å¦‚æœä¸€ä¸ªä¸»æœºè¦å‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆå®ƒå…ˆç›‘å¬ä¿¡é“ã€‚ç©ºé—²åˆ™ä»¥pæ¦‚ç‡ç›´æ¥ä¼ è¾“ï¼Œä¸å¿…ç­‰å¾…;æ¦‚ç‡1-pç­‰å¾…åˆ°ä¸‹ä¸€ä¸€ä¸ªæ—¶é—´æ§½å†ä¼ è¾“ã€‚å¿™åˆ™ç­‰å¾…ä¸€ä¸ªéšæœºæ—¶é—´ä¹‹åå†è¿›è¡Œç›‘å¬ã€‚ 1.2.2 å—æ§æ¥å…¥1.2.2.1 ä»¤ç‰Œç¯å±€åŸŸç½‘ä»¤ç‰Œï¼šä¸€ä¸ªç‰¹æ®Šæ ¼å¼çš„MACæ§åˆ¶å¸§ï¼Œä¸å«ä»»ä½•ä¿¡æ¯ã€‚æ§åˆ¶ä¿¡é“çš„ä½¿ç”¨ï¼Œç¡®ä¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªç»“ç‚¹ç‹¬å ä¿¡é“ã€‚ æ¯ä¸ªç»“ç‚¹éƒ½å¯ä»¥åœ¨ä¸€å®šçš„æ—¶é—´å†…(ä»¤ç‰ŒæŒæœ‰æ—¶é—´)è·å¾—å‘é€æ•°æ®çš„æƒåˆ©ï¼Œå¹¶ä¸æ˜¯æ— é™åˆ¶åœ°æŒæœ‰ä»¤ç‰Œã€‚ ä»¤ç‰Œç¯ç½‘ç‰©ç†æ˜Ÿå‹æ‹“æ‰‘ï¼Œé€»è¾‘ç¯å½¢æ‹“æ‰‘ã€‚ é—®é¢˜: ä»¤ç‰Œå¼€é”€ ç­‰å¾…å»¶è¿Ÿ å•ç‚¹æ•…éšœ 1.2.2.2 å¤šç‚¹çº¿è·¯æ¢è¯¢ä¸»ç»“ç‚¹è½®æµâ€œé‚€è¯·â€ä»å±ç»“ç‚¹å‘é€æ•°æ®ã€‚ é—®é¢˜: è½®è¯¢å¼€é”€ ç­‰å¾…å»¶è¿Ÿ å•ç‚¹æ•…éšœ 2 é“¾è·¯å’Œæ•°æ®é“¾è·¯ 3 åè®®çš„ä¸‰ä¸ªåŸºæœ¬é—®é¢˜ 3.1 å°è£…æˆå¸§å°è£…æˆå¸§å°±æ˜¯åœ¨ä¸€æ®µæ•°æ®çš„å‰åéƒ¨åˆ†æ·»åŠ é¦–éƒ¨å’Œå°¾éƒ¨ï¼Œè¿™æ ·å°±æ„æˆäº†ä¸€ä¸ªå¸§ã€‚æ¥æ”¶ç«¯åœ¨æ”¶åˆ°ç‰©ç†å±‚ä¸Šäº¤çš„æ¯”ç‰¹æµåï¼Œå°±èƒ½æ ¹æ®é¦–éƒ¨å’Œå°¾éƒ¨çš„æ ‡è®°ï¼Œä»æ”¶åˆ°çš„æ¯”ç‰¹æµä¸­è¯†åˆ«å¸§çš„å¼€å§‹å’Œç»“æŸã€‚ é¦–éƒ¨å’Œå°¾éƒ¨åŒ…å«è®¸å¤šçš„æ§åˆ¶ä¿¡æ¯ï¼Œä»–ä»¬çš„ä¸€ä¸ªé‡è¦ä½œç”¨æ˜¯å¸§å®šç•Œ(ç¡®å®šå¸§çš„ç•Œé™)ã€‚ ä¸€ä¸ªå¸§åˆ†ä¸ºé¦–éƒ¨ã€æ•°æ®éƒ¨åˆ†ã€å°¾éƒ¨ï¼Œä¸ºäº†ä¼ è¾“æ•ˆç‡ä¸€èˆ¬æ˜¯æ•°æ®éƒ¨åˆ†å æ¯”è¶Šå¤§è¶Šå¥½ã€‚ä½†å¦‚æœå¸§è¿‡é•¿å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›ä¼ è¾“é—®é¢˜ï¼ˆæŠ¥æ–‡ä¼ è¾“æ²¡æœ‰å¾ˆå¥½çš„æ•ˆæœï¼‰ã€‚æ‰€ä»¥è§„å®šäº†æœ€å¤§ä¼ è¾“å•å…ƒMTUï¼Œå³æ•°æ®éƒ¨åˆ†ä¸èƒ½è¶…è¿‡è¿™ä¸ªé•¿åº¦ã€‚ ç»„å¸§çš„å››ç§æ–¹æ³•: å­—ç¬¦è®¡æ•°æ³•ï¼šå¸§é¦–éƒ¨ä½¿ç”¨ä¸€ä¸ªè®¡æ•°å­—æ®µ(ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå…«ä½)æ¥æ ‡æ˜å¸§å†…å­—ç¬¦æ•°ã€‚å®¹æ˜“å‡ºé”™ã€‚ å­—ç¬¦(èŠ‚)å¡«å……æ³•ï¼šä½¿ç”¨SOHå’ŒEOTã€‚ é›¶æ¯”ç‰¹å¡«å……æ³•ï¼šSOHå’ŒEOTéƒ½ä½¿ç”¨01111110ï¼Œä¿¡æ¯å­—æ®µåªè¦æœ‰è¿ç»­5ä¸ª1ï¼Œå°±ç«‹å³å¡«å…¥ä¸€ä¸ª0ã€‚ è¿è§„ç¼–ç æ³•ã€‚ä½¿ç”¨è¿è§„è¡¨ç¤ºçš„ç å…ƒæ¥è¡¨ç¤ºSOHå’ŒEOTã€‚ 3.2 é€æ˜ä¼ è¾“é€æ˜ä¼ è¾“æ˜¯æŒ‡ä¸ç®¡æ‰€ä¼ æ•°æ®æ˜¯ä»€ä¹ˆæ ·çš„æ¯”ç‰¹ç»„åˆï¼Œéƒ½åº”å½“èƒ½å¤Ÿåœ¨é“¾è·¯ä¸Šä¼ é€ã€‚å› æ­¤ï¼Œé“¾è·¯å±‚å°±â€œçœ‹ä¸è§â€æœ‰ä»€ä¹ˆå¦¨ç¢æ•°æ®ä¼ è¾“çš„ä¸œè¥¿ã€‚ å½“æ‰€ä¼ æ•°æ®ä¸­çš„æ¯”ç‰¹ç»„åˆæ°å·§ä¸æŸä¸€ä¸ªæ§åˆ¶ä¿¡æ¯å®Œå…¨ä¸€æ ·æ—¶ï¼Œå°±å¿…é¡»é‡‡å–é€‚å½“çš„æªæ–½ï¼Œä½¿æ”¶æ–¹ä¸ä¼šå°†è¿™æ ·çš„æ•°æ®è¯¯è®¤ä¸ºæ˜¯æŸç§æ§åˆ¶ä¿¡æ¯ã€‚ è¿™æ ·æ‰èƒ½ä¿è¯æ•°æ®é“¾è·¯å±‚çš„ä¼ è¾“æ˜¯é€æ˜çš„ã€‚ 3.3 å·®é”™æ§åˆ¶æ¦‚æ‹¬æ¥è¯´ï¼Œä¼ è¾“ä¸­çš„å·®é”™éƒ½æ˜¯ç”±äºå™ªå£°å¼•èµ·çš„ã€‚ å…¨å±€æ€§: 1. ç”±äºçº¿è·¯æœ¬èº«ç”µæ°”ç‰¹æ€§æ‰€äº§ç”Ÿçš„éšæœºå™ªå£°(çƒ­å™ªå£°)ï¼Œæ˜¯ä¿¡é“å›ºæœ‰çš„ï¼Œéšæœºå­˜åœ¨çš„ã€‚è§£å†³åŠæ³•:æé«˜ä¿¡å™ªæ¯”æ¥å‡å°‘æˆ–é¿å…å¹²æ‰°ã€‚(å¯¹ä¼ æ„Ÿå™¨ä¸‹æ‰‹) å±€éƒ¨æ€§: 2. å¤–ç•Œç‰¹å®šçš„çŸ­æš‚åŸå› æ‰€é€ æˆçš„å†²å‡»å™ªå£°ï¼Œæ˜¯äº§ç”Ÿå·®é”™çš„ä¸»è¦åŸå› ã€‚è§£å†³åŠæ³•ï¼šé€šå¸¸åˆ©ç”¨ç¼–ç æŠ€æœ¯æ¥è§£å†³ã€‚ å·®é”™é€šå¸¸åˆ†ä¸ºä½é”™å’Œå¸§é”™ï¼Œå‡è®¾å‘æ¥ä¸€ä¸ª[#1]-[#2]-[#3]çš„å¸§ï¼Œå¸§é”™åˆåˆ†ä¸ºï¼š å¸§ä¸¢å¤±ï¼š[#1]-[#3] å¸§é‡å¤ï¼š[#1]-[#2]-[#2]-[#3] å¸§å¤±åºï¼š[#1]-[#3]-[#2] å·®é”™æ§åˆ¶æŠ€æœ¯åˆ†ä¸ºå·®é”™æ£€æµ‹å’Œå·®é”™çº æ­£ã€‚ 3.3.1 å·®é”™æ£€æµ‹ å¥‡å¶æ ¡éªŒç ï¼Œå‡è®¾ä¸€ä¸ªä¿¡æ¯å…ƒå…±nä½ï¼Œç”¨n-1ä½æ¥è¡¨ç¤ºæ•°æ®ï¼Œå‰©ä¸‹ä¸€ä½ç”¨äºæ»¡è¶³æ•´ä¸ªä½ä¸²ä¸­1ä¸ªæ•°çš„å¥‡å¶æ€§ï¼Œå¥‡æ ¡éªŒç è¦æ±‚1çš„ä¸ªæ•°ä¸ºå¥‡æ•°ï¼Œå¶æ ¡éªŒç è¦æ±‚1çš„ä¸ªæ•°ä¸ºå¶æ•°ã€‚å¥‡å¶æ ¡éªŒç çš„æ£€é”™èƒ½åŠ›åªèƒ½è¯´ä¸€èˆ¬ï¼Œå¦‚æœå¶æ•°ä¸ªæ¯”ç‰¹åŒæ—¶å‡ºç°é”™è¯¯ï¼Œå°±ä¸èƒ½æ£€æµ‹å‡ºã€‚ å¾ªç¯å†—ä½™ç CRCï¼Œå‘é€ç«¯å°†æ•°æ®åˆ’åˆ†ä¸ºç»„ï¼Œæ¯ç»„nï¼ˆçº¦å®šå¥½çš„ï¼‰ä½å†—ä½™ç é™„åœ¨æ•°æ®çš„æœ€åï¼Œå’Œæ¥æ”¶ç«¯çº¦å®šä¸€ä¸ªç”Ÿæˆå¤šé¡¹å¼Pï¼Œè¿™ä¸ªPå¿…é¡»ä¸ºn+1ä½ã€‚å†—ä½™ç çš„è®¡ç®—æ–¹æ³•ä¸ºM*n/På¾—åˆ°çš„ä½™æ•°ã€‚æ¥æ”¶ç«¯å°†å¾—åˆ°çš„ç»„é™¤ä»¥Rï¼Œå¦‚æœä½™æ•°ä¸º0ï¼ˆé™¤å°½ï¼‰ï¼Œåˆ™è¯´æ˜æ— è¯¯ï¼Œå¦åˆ™æœ‰è¯¯ã€‚ å·®é”™æ£€æµ‹æ£€æµ‹å‡ºå·®é”™å¸§å°±ä¼šå°†å…¶ä¸¢å¼ƒï¼Œä¿è¯æ¥æ”¶ç«¯æ•°æ®é“¾è·¯å±‚æ¥æ”¶çš„å¸§å‡æ— å·®é”™ï¼Œä½†è¿™è¿˜ä¸æ˜¯å¯é ä¼ è¾“ã€‚ 3.3.2 å·®é”™çº æ­£æµ·æ˜ç ï¼šèƒ½å‘ç°åŒæ¯”ç‰¹é”™ï¼Œåªèƒ½çº æ­£å•æ¯”ç‰¹é”™ã€‚ å·¥ä½œæµç¨‹ï¼š ç¡®å®šæ ¡éªŒç çš„ä½æ•°r å¦‚ä½•ç¡®å®šrï¼Ÿ æµ·æ˜ä¸ç­‰å¼ï¼š 2râ‰¥k+r+1ï¼Œkä¸ºä¿¡æ¯ä½ã€‚ä¾‹å¦‚è¦å‘é€çš„æ•°æ®çš„ä½æ•°ä¸º6ï¼Œåˆ™æ»¡è¶³ä¸ç­‰å¼çš„æœ€å°rä¸º4ï¼Œä¹Ÿå°±æ˜¯æ ¡éªŒç åº”æœ‰4ä½ã€‚ ç¡®å®šæ ¡éªŒç å’Œæ•°æ®çš„ä½ç½® æ ¡éªŒç åªèƒ½å¡«åœ¨2çš„å‡ æ¬¡æ–¹çš„ä½ç½®ï¼Œä¾‹å¦‚è¿™4ä½æ ¡éªŒç åªèƒ½åˆ†åˆ«å¡«åœ¨ç¬¬1ã€2ã€4ã€8ä½ã€‚å…¶ä»–ä½ç½®ç”¨äºå¡«å†™æ•°æ®ä½ã€‚ æ±‚å‡ºæ ¡éªŒç çš„å€¼ å¯¹äºä»»ä¸€æ ¡éªŒç ä½ï¼Œå®ƒçš„ä½ç½®çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­æœ‰æŸä¸€ä½ä¸º1ï¼Œå®ƒè´Ÿè´£æ ¡éªŒçš„æ˜¯æ•°æ®ä½ä¸­ä½ç½®çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­è¯¥ä½ä¹Ÿä¸º1çš„æ•°æ®ä½ã€‚å®ƒçš„ä»»åŠ¡æ˜¯ä»¤æ‰€æœ‰è¦æ ¡éªŒçš„ä½ï¼ˆåŒ…æ‹¬å®ƒæœ¬èº«ï¼‰å¼‚æˆ–ç­‰äº0ã€‚ ä¾‹å¦‚å¯¹äºæ ¡éªŒä½P1ï¼Œå®ƒè´Ÿè´£æ ¡éªŒD1,D2,D4,D5ã€‚å…¶ä¸­1âŠ•0âŠ•1âŠ•0=1ï¼Œåˆ™å®ƒéœ€è¦ä¸º0æ‰èƒ½æ»¡è¶³åŠ ä¸Šå®ƒåå¼‚æˆ–çš„ç»“æœç­‰äº0ã€‚ æ£€é”™å¹¶çº é”™ 4 å±€åŸŸç½‘ 4.1 å±€åŸŸç½‘æ‹“æ‰‘ç»“æ„ æ˜Ÿå‹æ‹“æ‰‘ æ€»çº¿å‹æ‹“æ‰‘ ç¯å½¢æ‹“æ‰‘ æ ‘å½¢æ‹“æ‰‘ å…¶ä¸­æ€»çº¿å‹æ‹“æ‰‘ä¸å®¹æ˜“å‡ºç°å•ç‚¹æ•…éšœé—®é¢˜ï¼Œæ¯”è¾ƒå¸¸ç”¨ã€‚ 4.2 å±€åŸŸç½‘ä»‹è´¨è®¿é—®æ§åˆ¶æ–¹æ³• CSMA/CDï¼šå¸¸ç”¨äºæ€»çº¿å‹å±€åŸŸç½‘ï¼Œä¹Ÿç”¨äºæ ‘å‹ç½‘ç»œã€‚ ä»¤ç‰Œæ€»çº¿ï¼šå¸¸ç”¨äºæ€»çº¿å‹å±€åŸŸç½‘ï¼Œä¹Ÿç”¨äºæ ‘å‹ç½‘ç»œã€‚å®ƒæ˜¯æŠŠæ€»çº¿å‹æˆ–æ ‘å‹ç½‘ç»œä¸­çš„å„ä¸ªå·¥ä½œç«™æŒ‰ä¸€å®šé¡ºåºå¦‚æŒ‰æ¥å£åœ°å€å¤§å°æ’åˆ—å½¢æˆä¸€ä¸ªé€»è¾‘ç¯ã€‚åªæœ‰ä»¤ç‰ŒæŒæœ‰è€…æ‰èƒ½æ§åˆ¶æ€»çº¿ï¼Œæ‰æœ‰å‘é€ä¿¡æ¯çš„æƒåŠ›ã€‚ ä»¤ç‰Œç¯ï¼šç”¨äºç¯å½¢å±€åŸŸç½‘ï¼Œå¦‚ä»¤ç‰Œç¯ç½‘ã€‚ 4.3 å±€åŸŸç½‘çš„åˆ†ç±» ä»¥å¤ªç½‘ï¼šä»¥å¤ªç½‘æ˜¯åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„å±€åŸŸç½‘ï¼ŒåŒ…æ‹¬æ ‡å‡†ä»¥å¤ªç½‘(10Mbps) ã€å¿«é€Ÿä»¥å¤ªç½‘(100Mbps) ã€åƒå…†ä»¥å¤ªç½‘(1000 Mbps)å’Œ10Gä»¥å¤ªç½‘ï¼Œå®ƒä»¬éƒ½ç¬¦åˆIEEE802.3ç³»åˆ—æ ‡å‡†è§„èŒƒã€‚é€»è¾‘æ‹“æ‰‘æ€»çº¿å‹ï¼Œç‰©ç†æ‹“æ‰‘æ˜¯æ˜Ÿå‹æˆ–æ‹“å±•æ˜Ÿå‹ã€‚ä½¿ç”¨CSMA/CDåè®®ã€‚ ä»¤ç‰Œç¯ç½‘ï¼šç‰©ç†ä¸Šé‡‡ç”¨äº†æ˜Ÿå½¢æ‹“æ‰‘ç»“æ„ï¼Œé€»è¾‘ä¸Šæ˜¯ç¯å½¢æ‹“æ‰‘ç»“æ„ã€‚å·²æ˜¯â€œæ˜æ—¥é»„èŠ±â€ã€‚IEEE802.5 FDDIç½‘ï¼šç‰©ç†ä¸Šé‡‡ç”¨äº†åŒç¯æ‹“æ‰‘ç»“æ„ï¼Œé€»è¾‘ä¸Šæ˜¯ç¯å½¢æ‹“æ‰‘ç»“æ„ã€‚ ATMç½‘ï¼šè¾ƒæ–°å‹çš„å•å…ƒäº¤æ¢æŠ€æœ¯ï¼Œä½¿ç”¨53å­—èŠ‚å›ºå®šé•¿åº¦çš„å•å…ƒè¿›è¡Œäº¤æ¢ã€‚ æ— çº¿å±€åŸŸç½‘(WLAN)ï¼šé‡‡ç”¨IEEE802.11æ ‡å‡†ã€‚ 4.4 MACå­å±‚å’ŒLLCå­å±‚IEEE802æ ‡å‡†æ‰€æè¿°çš„å±€åŸŸç½‘å‚è€ƒæ¨¡å‹åªå¯¹åº”OSIå‚è€ƒæ¨¡å‹çš„æ•°æ®é“¾è·¯å±‚ä¸ç‰©ç†å±‚ï¼Œå®ƒå°†æ•°æ®é“¾è·¯å±‚åˆ’åˆ†ä¸ºé€»è¾‘é“¾è·¯å±‚LLCå­å±‚å’Œä»‹è´¨è®¿é—®æ§åˆ¶MACå­å±‚ã€‚ LLCï¼šLLCè´Ÿè´£è¯†åˆ«ç½‘ç»œå±‚åè®®ï¼Œç„¶åå¯¹å®ƒä»¬è¿›è¡Œå°è£…ã€‚LLCæŠ¥å¤´å‘Šè¯‰æ•°æ®é“¾è·¯å±‚ä¸€æ—¦å¸§è¢«æ¥æ”¶åˆ°æ—¶ï¼Œåº”å½“å¯¹æ•°æ®åŒ…åšä½•å¤„ç†ã€‚ä¸ºç½‘ç»œå±‚æä¾›æœåŠ¡:æ— ç¡®è®¤æ— è¿æ¥ã€é¢å‘è¿æ¥ã€å¸¦ç¡®è®¤æ— è¿æ¥ã€é«˜é€Ÿä¼ é€ã€‚ MACå­å±‚çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬æ•°æ®å¸§çš„å°è£…/å¸è£…ï¼Œå¸§çš„å¯»å€å’Œè¯†åˆ«ï¼Œå¸§çš„æ¥æ”¶ä¸å‘é€ï¼Œé“¾è·¯çš„ç®¡ç†ï¼Œå¸§çš„å·®é”™æ§åˆ¶ç­‰ã€‚MACå­å±‚çš„å­˜åœ¨å±è”½äº†ä¸åŒç‰©ç†é“¾è·¯ç§ç±»çš„å·®å¼‚æ€§ã€‚ 4.4.1 MACåœ°å€å‰ä¸‰ä¸ªå­—èŠ‚ä¸ºç»„ç»‡å”¯ä¸€æ ‡è¯†ç¬¦OUIï¼Œåä¸‰ä¸ªå­—èŠ‚ä¸ºæ‹“å±•æ ‡è¯†ç¬¦ï¼Œç”±å‚å®¶è‡ªè¡ŒæŒ‡æ´¾ã€‚ 4.4.2 MACå¸§ 6å­—èŠ‚é•¿ç›®çš„åœ°å€ 6å­—èŠ‚é•¿æºåœ°å€ 2å­—èŠ‚é•¿ç±»å‹å­—æ®µ 46åˆ°1500å­—èŠ‚ä¹‹é—´çš„æ•°æ®å­—æ®µ 4å­—èŠ‚é•¿å¸§æ£€éªŒåºåˆ—FCSï¼Œæ˜¯å‘é€å’Œæ¥æ”¶éƒ½è¦ä½¿ç”¨å¾ªç¯å†—ä½™æ ¡éªŒç ï¼ˆCRCï¼‰ç®—æ³•æ‰€äº§ç”Ÿçš„FCSå­—æ®µçš„CRCç ã€‚ MACå¸§è¢«ç‰©ç†å±‚åŒ…è£…ä¹‹åé€šå¸¸è¿˜ä¼šåœ¨å‰é¢æ’å…¥ä¸€ä¸ªå…«å­—èŠ‚çš„å‰å¯¼ç ã€‚ 4.5 ä»¥å¤ªç½‘ä½¿ç”¨DIX Ethernet V2æˆ–IEEE 802.3å°±ç§°ä¸ºä»¥å¤ªç½‘ï¼Œä»¥å¤ªç½‘æä¾›æ— è¿æ¥ã€ä¸å¯é çš„æœåŠ¡ æ— è¿æ¥ï¼šå‘é€æ–¹å’Œæ¥æ”¶æ–¹ä¹‹é—´æ— â€œæ¡æ‰‹è¿‡ç¨‹â€ã€‚ ä¸å¯é ï¼šä¸å¯¹å‘é€æ–¹çš„æ•°æ®å¸§ç¼–å·ï¼Œæ¥æ”¶æ–¹ä¸å‘å‘é€æ–¹è¿›è¡Œç¡®è®¤ï¼Œå·®é”™å¸§ç›´æ¥ä¸¢å¼ƒï¼Œå·®é”™çº æ­£ç”±é«˜å±‚è´Ÿè´£ã€‚ 4.6 CSMA/CDåè®®CDï¼šç¢°æ’æ£€æµ‹(å†²çªæ£€æµ‹)ï¼Œâ€œè¾¹å‘é€è¾¹ç›‘å¬â€ ï¼Œé€‚é…å™¨è¾¹å‘é€æ•°æ®è¾¹æ£€æµ‹ä¿¡é“ä¸Šä¿¡å·ç”µå‹çš„å˜åŒ–æƒ…å†µï¼Œä»¥ä¾¿åˆ¤æ–­è‡ªå·±åœ¨å‘é€æ•°æ®æ—¶å…¶ä»–ç«™æ˜¯å¦ä¹Ÿåœ¨å‘é€æ•°æ®ã€‚ ä»¥å¤ªç½‘ç«¯åˆ°ç«¯çš„å¾€è¿”æ—¶é—´2tç§°ä¸ºäº‰ç”¨æœŸï¼ˆç¢°æ’çª—å£ï¼‰ï¼Œæœ€å¤§ä¸ä¼šè¶…è¿‡è¿™ä¸ªæ—¶é—´å°±èƒ½ç›‘å¬åˆ°ç¢°æ’ã€‚ äº†è§£ï¼šæˆªæ–­äºŒè¿›åˆ¶æŒ‡æ•°é€€é¿ç®—æ³• 4.7 æ‹“å±•çš„ä»¥å¤ªç½‘4.7.1 ç‰©ç†å±‚æ‹“å±•ä»¥å¤ªç½‘å…‰çº¤ä»£æ›¿é“œçº¿ï¼Œä½¿ç”¨é›†çº¿å™¨ 4.7.2 é“¾è·¯å±‚æ‹“å±•ä»¥å¤ªç½‘é€šè¿‡ç½‘æ¡¥ã€äº¤æ¢å¼é›†çº¿å™¨æˆ–æ˜¯ç¬¬äºŒå±‚äº¤æ¢æœº ç½‘æ¡¥æ˜¯äº¤æ¢æœºçš„å‰èº«ï¼Œäº¤æ¢æœºåˆç§°ä¸ºå¤šç«¯å£ç½‘æ¡¥ã€‚ äº¤æ¢æœºæ ¹æ®MACå¸§çš„ç›®çš„åœ°å€å¯¹å¸§è¿›è¡Œè½¬å‘å’Œè¿‡æ»¤ã€‚å½“äº¤æ¢æœºæ”¶åˆ°ä¸€ä¸ªå¸§æ—¶ï¼Œå¹¶ä¸å‘æ‰€æœ‰æ¥å£è½¬å‘æ­¤å¸§ï¼Œè€Œæ˜¯å…ˆæ£€æŸ¥æ­¤å¸§çš„ç›®çš„MACåœ°å€ï¼Œç„¶åå†ç¡®å®šå°†è¯¥å¸§è½¬å‘åˆ°å“ªä¸€ä¸ªæ¥å£ï¼Œæˆ–è€…æ˜¯æŠŠå®ƒä¸¢å¼ƒ(å³è¿‡æ»¤)ã€‚ è‡ªå­¦ä¹ ï¼šåŠ¨æ€å¡«å……è½¬å‘è¡¨ã€‚äº¤æ¢æœºåœ¨æ”¶åˆ°ä¸€ä¸ªMACå¸§çš„æ—¶å€™ï¼Œå°±çŸ¥é“å¯¹åº”çš„è®¾å¤‡ä¸å“ªä¸ªç«¯å£ç›¸è¿ï¼Œä»è€ŒåŠ¨æ€æ‰©å……è½¬å‘è¡¨ã€‚ äº¤æ¢æœºã€ç½‘æ¡¥çš„æ¯ä¸€ä¸ªç«¯å£éš”ç¦»ä¸€ä¸ªå†²çªåŸŸï¼Œä½†ä¸èƒ½éš”ç¦»å¹¿æ’­åŸŸã€‚ é›†çº¿å™¨ä¸­çš„è®¾å¤‡æ˜¯å…±äº«å¸¦å®½çš„ï¼Œäº¤æ¢æœºä¸­çš„è®¾å¤‡æ˜¯ç‹¬å å¸¦å®½çš„ã€‚ äº¤æ¢æœºç±»å‹ï¼š ç›´é€šå¼äº¤æ¢æœºï¼šæŸ¥å®Œç›®çš„åœ°å€å°±ç«‹åˆ»è½¬å‘ã€‚å»¶è¿Ÿå°ï¼Œå¯é æ€§ä½ï¼Œæ— æ³•æ”¯æŒå…·æœ‰ä¸åŒé€Ÿç‡çš„ç«¯å£çš„äº¤æ¢ã€‚ å­˜å‚¨è½¬å‘å¼äº¤æ¢æœºï¼šå°†å¸§æ”¾å…¥é«˜é€Ÿç¼“å­˜ï¼Œå¹¶æ£€æŸ¥å¦æ­£ç¡®ï¼Œæ­£ç¡®åˆ™è½¬å‘ï¼Œé”™è¯¯åˆ™ä¸¢å¼ƒã€‚å»¶è¿Ÿå¤§ï¼Œå¯é æ€§é«˜ï¼Œå¯ä»¥æ”¯æŒå…·æœ‰ä¸åŒé€Ÿç‡çš„ç«¯å£çš„äº¤æ¢ã€‚","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","permalink":"https://www.codetool.top/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"}]},{"title":"ç¨‹åºå‘˜é¢è¯•é‡‘å…¸01.07-æ—‹è½¬çŸ©é˜µ","slug":"ç¨‹åºå‘˜é¢è¯•é‡‘å…¸01-07-æ—‹è½¬çŸ©é˜µ","date":"2020-04-07T06:12:39.000Z","updated":"2020-04-07T06:18:02.387Z","comments":true,"path":"article/ç¨‹åºå‘˜é¢è¯•é‡‘å…¸01-07-æ—‹è½¬çŸ©é˜µ/","link":"","permalink":"https://www.codetool.top/article/%E7%A8%8B%E5%BA%8F%E5%91%98%E9%9D%A2%E8%AF%95%E9%87%91%E5%85%B801-07-%E6%97%8B%E8%BD%AC%E7%9F%A9%E9%98%B5/","excerpt":"","text":"1 åŸé¢˜ï¼ˆæ¥æºLeetcodeï¼‰ç»™ä½ ä¸€å¹…ç”± N Ã— N çŸ©é˜µè¡¨ç¤ºçš„å›¾åƒï¼Œå…¶ä¸­æ¯ä¸ªåƒç´ çš„å¤§å°ä¸º 4 å­—èŠ‚ã€‚è¯·ä½ è®¾è®¡ä¸€ç§ç®—æ³•ï¼Œå°†å›¾åƒæ—‹è½¬ 90 åº¦ã€‚ ä¸å ç”¨é¢å¤–å†…å­˜ç©ºé—´èƒ½å¦åšåˆ°ï¼Ÿ ç¤ºä¾‹ 1: ç»™å®š matrix = [ [1,2,3], [4,5,6], [7,8,9] ], åŸåœ°æ—‹è½¬è¾“å…¥çŸ©é˜µï¼Œä½¿å…¶å˜ä¸º: [ [7,4,1], [8,5,2], [9,6,3] ]ç¤ºä¾‹ 2: ç»™å®š matrix = [ [ 5, 1, 9,11], [ 2, 4, 8,10], [13, 3, 6, 7], [15,14,12,16] ], åŸåœ°æ—‹è½¬è¾“å…¥çŸ©é˜µï¼Œä½¿å…¶å˜ä¸º: [ [15,13, 2, 5], [14, 3, 4, 1], [12, 6, 8, 9], [16, 7,10,11] ]2 è§£æ³•2.1 æ€æƒ³ç”¨ç¿»è½¬ä»£æ›¿æ—‹è½¬ï¼ˆå…ˆå¯¹è§’çº¿ç¿»è½¬ï¼Œå†æ°´å¹³ç¿»è½¬ï¼‰ 2.2 ä»£ç public class Solution { public void rotate(int[][] matrix) { int n = matrix.length; for (int i = 0; i &lt; n; i++) { for (int j = i; j &lt; n; j++) { int tmp = matrix[i][j]; matrix[i][j] = matrix[j][i]; matrix[j][i] = tmp; } for (int j = 0; j &lt; n / 2; j++) { int tmp = matrix[i][j]; matrix[i][j] = matrix[i][n - j - 1]; matrix[i][n - j - 1] = tmp; } } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"gitä¸Šä¼ åˆ°ä»“åº“ä¹‹åå¤§å†™å˜å°å†™çš„é—®é¢˜","slug":"gitä¸Šä¼ åˆ°ä»“åº“ä¹‹åå¤§å†™å˜å°å†™çš„é—®é¢˜","date":"2020-04-07T05:46:14.000Z","updated":"2020-04-08T04:15:09.791Z","comments":true,"path":"article/gitä¸Šä¼ åˆ°ä»“åº“ä¹‹åå¤§å†™å˜å°å†™çš„é—®é¢˜/","link":"","permalink":"https://www.codetool.top/article/git%E4%B8%8A%E4%BC%A0%E5%88%B0%E4%BB%93%E5%BA%93%E4%B9%8B%E5%90%8E%E5%A4%A7%E5%86%99%E5%8F%98%E5%B0%8F%E5%86%99%E7%9A%84%E9%97%AE%E9%A2%98/","excerpt":"","text":"æœ€è¿‘åœ¨ç¿»ä¹‹å‰çš„åšå®¢çš„æ—¶å€™å‘ç°æœ‰å‡ ç¯‡åšå®¢æ‰“å¼€æ˜¯404çŠ¶æ€ï¼Œä¸çŸ¥é“æ€ä¹ˆå›äº‹ï¼Œä»¥ä¸ºhexoå‡ºbugäº†ã€‚å°±ä»”ç»†ç ”ç©¶äº†ä¸€ä¸‹ï¼Œé¦–å…ˆåœ¨æœ¬åœ°ç”Ÿæˆçš„é™æ€æ–‡ä»¶ä¸­æ˜¯å­˜åœ¨çš„ï¼Œç„¶åå°±åˆ°è¿œç¨‹gitä»“åº“é‡Œçœ‹äº†ä¸€çœ¼ï¼Œå‘ç°å¯¹åº”çš„æ–‡ä»¶å¤¹çš„åå­—é¦–å­—æ¯æ˜¯å°å†™ï¼Œè€Œæœ¬åœ°æ–‡ä»¶æ˜¯å¤§å†™ï¼Œå¯¼è‡´ç½‘é¡µæ–‡ä»¶æ— æ³•å®šä½ã€‚ å…·ä½“çš„åŸå› æ˜¯æˆ‘ä¹‹å‰å°†è¯¥æ–‡ä»¶ä»å°å†™æ”¹ä¸ºäº†å¤§å†™ï¼Œè€Œgité»˜è®¤æ˜¯ä¸åŒºåˆ†æ–‡ä»¶åæˆ–æ–‡ä»¶å¤¹åçš„å¤§å°å†™çš„ï¼Œä¹Ÿå°±æ²¡æœ‰åŒæ­¥æˆå¤§å†™ã€‚ è§£å†³æ–¹æ¡ˆï¼š æŸ¥çœ‹æ˜¯å¦å¿½ç•¥å¤§å°å†™ï¼š git config core.ignorecaseï¼Œé»˜è®¤æ˜¯true é€šè¿‡ git config core.ignorecase false è®¾ç½®ä¸ºåŒºåˆ†å¤§å°å†™ æ³¨æ„åœ¨hexoçš„/.deploy_gitä¸‹è¿›è¡Œè¯¥è®¾ç½®ã€‚","categories":[{"name":"æ—¥å¸¸/éšç¬”","slug":"æ—¥å¸¸-éšç¬”","permalink":"https://www.codetool.top/categories/%E6%97%A5%E5%B8%B8-%E9%9A%8F%E7%AC%94/"}],"tags":[{"name":"ç½‘ç«™æ—¥å¿—","slug":"ç½‘ç«™æ—¥å¿—","permalink":"https://www.codetool.top/tags/%E7%BD%91%E7%AB%99%E6%97%A5%E5%BF%97/"}]},{"title":"è®¡ç½‘å¤ä¹ 02-ç‰©ç†å±‚","slug":"è®¡ç½‘å¤ä¹ 02-ç‰©ç†å±‚","date":"2020-04-06T14:23:21.000Z","updated":"2020-04-14T04:00:38.414Z","comments":true,"path":"article/è®¡ç½‘å¤ä¹ 02-ç‰©ç†å±‚/","link":"","permalink":"https://www.codetool.top/article/%E8%AE%A1%E7%BD%91%E5%A4%8D%E4%B9%A002-%E7%89%A9%E7%90%86%E5%B1%82/","excerpt":"","text":"è¿™é‡Œçš„ç‰©ç†å±‚æŒ‡çš„æ˜¯åŸç†ä½“ç³»ç»“æ„çš„ç‰©ç†å±‚ï¼Œå¯¹åº”OSIä¸ƒå±‚æ¨¡å‹çš„ç‰©ç†å±‚ï¼Œåœ¨TCP/IPå››å±‚æ¨¡å‹ä¸­æ— å¯¹åº”ã€‚å®ƒä¸ºæ•°æ®é“¾è·¯å±‚æä¾›æœåŠ¡ï¼Œä¸ºæ•°æ®ä¼ è¾“æä¾›å¯é ç¯å¢ƒã€‚ 1 åŸºæœ¬æ¦‚å¿µ ç‰©ç†å±‚è§£å†³å¦‚ä½•åœ¨è¿æ¥å„ç§è®¡ç®—æœºçš„ä¼ è¾“åª’ä½“ä¸Šä¼ è¾“æ•°æ®æ¯”ç‰¹æµï¼Œè€Œä¸æ˜¯æŒ‡å…·ä½“çš„ä¼ è¾“åª’ä½“ã€‚ ç‰©ç†å±‚çš„åè®®æ˜¯éå¸¸å¤šçš„ï¼Œå› ä¸ºè¿™ä¸€å±‚æ˜¯ä¸€äº›ç¡¬ä»¶è®¾å¤‡ï¼Œä¸åŒçš„ç¡¬ä»¶è®¾å¤‡ã€ä¸åŒçš„å“ç‰Œä¹‹é—´å¯èƒ½å­˜åœ¨ç€ä¸åŒçš„åè®®ã€‚ ç‰©ç†å±‚çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯ç¡®å®šä¸ä¼ è¾“åª’ä½“æ¥å£æœ‰å…³çš„ä¸€äº›ç‰¹æ€§ï¼š æœºæ¢°ç‰¹æ€§ï¼šå®šä¹‰ç‰©ç†è¿æ¥çš„ç‰¹æ€§ï¼Œè§„å®šç‰©ç†è¿æ¥æ—¶æ‰€é‡‡ç”¨çš„è§„æ ¼ã€æ¥å£å½¢çŠ¶ã€å¼•çº¿æ•°ç›®ã€å¼•è„šæ•°é‡å’Œæ’åˆ—æƒ…å†µã€‚ ç”µæ°”ç‰¹æ€§ï¼šè§„å®šä¼ è¾“äºŒè¿›åˆ¶ä½æ—¶ï¼Œçº¿è·¯ä¸Šä¿¡å·çš„ç”µå‹èŒƒå›´ã€é˜»æŠ—åŒ¹é…ã€ä¼ è¾“é€Ÿç‡å’Œè·ç¦»é™åˆ¶ç­‰ã€‚ å·¥ç¨‹ç‰¹æ€§ï¼šæŒ‡æ˜æŸæ¡çº¿ä¸Šå‡ºç°çš„æŸä¸€ç”µå¹³è¡¨ç¤ºä½•ç§æ„ä¹‰ï¼Œæ¥å£éƒ¨ä»¶çš„ä¿¡å·çº¿çš„ç”¨é€”ã€‚ è§„ç¨‹ç‰¹æ€§(è¿‡ç¨‹ç‰¹æ€§)ï¼šå®šä¹‰å„æ¡ç‰©ç†çº¿è·¯çš„å·¥ä½œè§„ç¨‹å’Œæ—¶åºå…³ç³»ã€‚ 2 æ•°æ®é€šä¿¡çš„åŸºç¡€çŸ¥è¯† 2.1 æ•°æ®é€šä¿¡ç³»ç»Ÿæ¨¡å‹åœ¨ä¼ ç»Ÿçš„ç”µè¯çº¿ï¼ˆASDLï¼‰ä¸Šç½‘ä¸­ï¼Œæ•°æ®éœ€è¦è¿›è¡Œè°ƒåˆ¶è§£è°ƒï¼Œæ•°æ®é€šä¿¡ç³»ç»Ÿæ¨¡å‹ï¼š æºç³»ç»Ÿ æºç‚¹ï¼ˆä¿¡æºï¼‰ï¼šäº§ç”Ÿè¦ä¼ è¾“çš„æ•°æ® å‘é€å™¨ï¼šè°ƒåˆ¶ä¼ è¾“çš„æ•°æ®ä»æ•°å­—ä¿¡å·è½¬æ¢ä¸ºæ¨¡æ‹Ÿä¿¡å· ä¼ è¾“ç³»ç»Ÿï¼šä¼ é€æ¨¡æ‹Ÿä¿¡å· ç›®çš„ç³»ç»Ÿ æ¥æ”¶å™¨ï¼šæ¥æ”¶æ¨¡æ‹Ÿä¿¡å·ï¼Œå¹¶è§£è°ƒä¸ºæ•°å­—ä¿¡å· ç»ˆç‚¹ï¼ˆä¿¡å®¿ï¼‰ï¼šä»æ¥æ”¶å™¨è·å–æ¯”ç‰¹æµ 2.1.1 åŸºå¸¦ä¿¡å·ä¸å®½å¸¦ä¿¡å·åŸºå¸¦ä¿¡å·ï¼šå°†æ•°å­—ä¿¡å·1å’Œ0ç›´æ¥ç”¨ä¸¤ç§ä¸åŒçš„ç”µå‹è¡¨ç¤ºï¼Œå†é€åˆ°æ•°å­—ä¿¡é“ä¸Šå»ä¼ è¾“(åŸºå¸¦ä¼ è¾“)ã€‚æ¥è‡ªä¿¡æºçš„ä¿¡å·ï¼Œåƒè®¡ç®—æœºè¾“å‡ºçš„ä»£è¡¨å„ç§æ–‡å­—æˆ–å›¾åƒæ–‡ä»¶çš„æ•°æ®ä¿¡å·éƒ½å±äºåŸºå¸¦ä¿¡å·ã€‚åŸºå¸¦ä¿¡å·å°±æ˜¯å‘å‡ºçš„ç›´æ¥è¡¨è¾¾äº†è¦ä¼ è¾“çš„ä¿¡æ¯çš„ä¿¡å·ï¼Œæ¯”å¦‚æˆ‘ä»¬è¯´è¯çš„å£°æ³¢å°±æ˜¯åŸºå¸¦ä¿¡å·ã€‚ å®½å¸¦ä¿¡å·ï¼šå°†åŸºå¸¦ä¿¡å·è¿›è¡Œè°ƒåˆ¶åå½¢æˆçš„é¢‘åˆ†å¤ç”¨æ¨¡æ‹Ÿä¿¡å·ï¼Œå†ä¼ é€åˆ°æ¨¡æ‹Ÿä¿¡é“ä¸Šå»ä¼ è¾“(å®½å¸¦ä¼ è¾“)ã€‚æŠŠåŸºå¸¦ä¿¡å·ç»è¿‡è½½æ³¢è°ƒåˆ¶åï¼ŒæŠŠä¿¡å·çš„é¢‘ç‡èŒƒå›´æ¬ç§»åˆ°è¾ƒé«˜çš„é¢‘æ®µä»¥ä¾¿åœ¨ä¿¡é“ä¸­ä¼ è¾“(å³ä»…åœ¨ä¸€æ®µé¢‘ç‡èŒƒå›´å†…èƒ½å¤Ÿé€šè¿‡ä¿¡é“)ã€‚ 2.1.2 è°ƒåˆ¶åŸºå¸¦è°ƒåˆ¶ï¼šï¼ˆä¿¡æ¯-&gt;æ•°å­—ä¿¡å·ï¼‰ ä¸å½’é›¶åˆ¶ï¼šé«˜1ä½0ï¼Œç¼–ç å®¹æ˜“å®ç°ï¼Œä½†æ²¡æœ‰æ£€é”™åŠŸèƒ½ï¼Œä¸”æ— æ³•åˆ¤æ–­ä¸€ä¸ªç å…ƒçš„å¼€å§‹å’Œç»“æŸï¼Œä»¥è‡³äºæ”¶å‘åŒæ–¹éš¾ä»¥ä¿æŒåŒæ­¥ã€‚ å½’é›¶åˆ¶ï¼šä¿¡å·ç”µå¹³åœ¨ä¸€ä¸ªç å…ƒä¹‹å†…éƒ½è¦æ¢å¤åˆ°é›¶çš„è¿™ç§ç¼–ç æˆç¼–ç æ–¹å¼ã€‚ æ›¼å½»æ–¯ç‰¹ç¼–ç ï¼šä¿¡å·å‘¨æœŸå†…ä¼šå‘ç”Ÿè·³å˜ï¼Œå‘ä¸Šè·³ä¸º0ï¼Œå‘ä¸‹è·³ä¸º1ã€‚ä¹Ÿå¯ä»¥é‡‡ç”¨ç›¸åçš„è§„å®šã€‚ å·®åˆ†æ›¼å½»æ–¯ç‰¹ç¼–ç ï¼šé¦–å…ˆä½ä¸­å¿ƒå¿…è·³å˜ï¼Œå¦‚æœè¯¥ä½çš„å‰åŠæ®µï¼ˆå’Œä¸Šä¸€ä¸ªä½çš„ååŠæ®µï¼‰ç›¸åï¼Œåˆ™ä¸º0ï¼Œç›¸åŒåˆ™ä¸º1ã€‚ å¸¦é€šè°ƒåˆ¶ï¼šï¼ˆæ•°å­—ä¿¡å·-&gt;æ¨¡æ‹Ÿä¿¡å·ï¼‰ åˆ†åˆ«å¯¹åº”è°ƒå¹…ã€è°ƒé¢‘ã€è°ƒç›¸ã€‚ æ­£äº¤æŒ¯å¹…è°ƒåˆ¶QAMï¼šè°ƒå¹…+è°ƒç›¸ã€‚ 2.2 ç›¸å…³æ¦‚å¿µ2.2.1 ä¿¡é“ä¿¡é“: ä¿¡å·çš„ä¼ è¾“åª’ä»‹ã€‚ä¸€èˆ¬ç”¨æ¥è¡¨ç¤ºå‘æŸä¸€ä¸ªæ–¹å‘ä¼ é€ä¿¡æ¯çš„ä»‹è´¨ï¼Œå› æ­¤ä¸€æ¡é€šä¿¡çº¿è·¯å¾€å¾€åŒ…å«ä¸€æ¡å‘é€ä¿¡é“å’Œä¸€æ¡æ¥æ”¶ä¿¡é“ã€‚ 2.2.2 ä¸‰ç§é€šä¿¡æ–¹å¼ å•å·¥é€šä¿¡ï¼ˆå•å‘é€šä¿¡ï¼‰åªæœ‰ä¸€ä¸ªæ–¹å‘çš„é€šä¿¡è€Œæ²¡æœ‰åæ–¹å‘çš„äº¤äº’ï¼Œä»…éœ€è¦ä¸€æ¡ä¿¡é“ã€‚ åŠåŒå·¥é€šä¿¡ï¼ˆåŒå‘äº¤æ›¿é€šä¿¡ï¼‰é€šä¿¡çš„åŒæ–¹éƒ½å¯ä»¥å‘é€æˆ–æ¥æ”¶ä¿¡æ¯ï¼Œä½†ä»»ä½•ä¸€æ–¹éƒ½ä¸èƒ½åŒæ—¶å‘é€å’Œæ¥æ”¶ï¼Œéœ€è¦ä¸¤æ¡ä¿¡é“ã€‚ å…¨åŒå·¥é€šä¿¡ï¼ˆåŒå‘åŒæ—¶é€šä¿¡ï¼‰ï¼šé€šä¿¡åŒæ–¹å¯ä»¥åŒæ—¶å‘é€å’Œæ¥å—ä¿¡æ¯ï¼Œä¹Ÿéœ€è¦ä¸¤æ¡ä¿¡é“ã€‚ 2.2.3 ç å…ƒç å…ƒæ˜¯æŒ‡ç”¨ä¸€ä¸ªå›ºå®šæ—¶é•¿çš„ä¿¡å·æ³¢å½¢(æ•°å­—è„‰å†²)ï¼Œä»£è¡¨ä¸åŒç¦»æ•£æ•°å€¼çš„åŸºæœ¬æ³¢å½¢ï¼Œæ˜¯æ•°å­—é€šä¿¡ä¸­æ•°å­—ä¿¡å·çš„è®¡é‡å•ä½ï¼Œè¿™ä¸ªæ—¶é•¿å†…çš„ä¿¡å·ç§°ä¸ºkè¿›åˆ¶ç å…ƒï¼Œè€Œè¯¥æ—¶é•¿ç§°ä¸ºç å…ƒå®½åº¦ã€‚å½“ç å…ƒçš„ç¦»æ•£çŠ¶æ€æœ‰Mä¸ªæ—¶(Må¤§äº2)ï¼Œæ­¤æ—¶ç å…ƒä¸ºMè¿›åˆ¶ç å…ƒã€‚ 1ç å…ƒå¯ä»¥æºå¸¦å¤šä¸ªæ¯”ç‰¹çš„ä¿¡æ¯é‡ã€‚ä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨äºŒè¿›åˆ¶ç¼–ç æ—¶ï¼Œåªæœ‰ä¸¤ç§ä¸åŒçš„ç å…ƒï¼Œä¸€ç§ä»£è¡¨0çŠ¶æ€ï¼Œå¦ä¸€ç§ä»£è¡¨1çŠ¶æ€ã€‚ 2.2.4 ä¸¤ç§é€Ÿç‡è¡¨ç¤ºæ–¹å¼é€Ÿç‡ä¹Ÿå«æ•°æ®ç‡ï¼Œæ˜¯æŒ‡æ•°æ®çš„ä¼ è¾“é€Ÿç‡ï¼Œè¡¨ç¤ºå•ä½æ—¶é—´å†…ä¼ è¾“çš„æ•°æ®é‡ã€‚å¯ä»¥ç”¨ç å…ƒä¼ è¾“é€Ÿç‡å’Œä¿¡æ¯ä¼ è¾“é€Ÿç‡è¡¨ç¤ºã€‚ ç å…ƒä¼ è¾“é€Ÿç‡: åˆ«åç å…ƒé€Ÿç‡ã€æ³¢å½¢é€Ÿç‡ã€è°ƒåˆ¶é€Ÿç‡ã€ç¬¦å·é€Ÿç‡ç­‰ï¼Œå®ƒè¡¨ç¤ºå•ä½æ—¶é—´å†…æ•°å­—é€šä¿¡ç³»ç»Ÿæ‰€ä¼ è¾“çš„ç å…ƒä¸ªæ•°(ä¹Ÿå¯ç§°ä¸ºè„‰å†²ä¸ªæ•°æˆ–ä¿¡å·å˜åŒ–çš„æ¬¡æ•°)ï¼Œå•ä½æ˜¯æ³¢ç‰¹(Baud) ã€‚1æ³¢ç‰¹è¡¨ç¤ºæ•°å­—é€šä¿¡ç³»ç»Ÿæ¯ç§’ä¼ è¾“ä¸€ä¸ªç å…ƒã€‚è¿™é‡Œçš„ç å…ƒå¯ä»¥æ˜¯å¤šè¿›åˆ¶çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯äºŒè¿›åˆ¶çš„ï¼Œä½†ç å…ƒé€Ÿç‡ä¸è¿›åˆ¶æ•°æ— å…³ã€‚ ä¿¡æ¯ä¼ è¾“é€Ÿç‡: åˆ«åä¿¡æ¯é€Ÿç‡ã€æ¯”ç‰¹ç‡ç­‰ï¼Œè¡¨ç¤ºå•ä½æ—¶é—´å†…æ•°å­—é€šä¿¡ç³»ç»Ÿä¼ è¾“çš„äºŒè¿›åˆ¶ç å…ƒä¸ªæ•°(å³æ¯”ç‰¹æ•°)ï¼Œå•ä½æ˜¯æ¯”ç‰¹/ç§’(b/s) ã€‚ å¯¹äºäºŒè¿›åˆ¶ç å…ƒï¼Œæ³¢ç‰¹å’Œæ¯”ç‰¹/ç§’çš„å«ä¹‰æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºäºŒè¿›åˆ¶ç å…ƒæºå¸¦çš„æ¯”ç‰¹é‡å°±æ˜¯1æ¯”ç‰¹ 2.2.5 å¤±çœŸä¿¡å·åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œç”±äºå®é™…ä¿¡é“æœ‰å™ªå£°ã€å¹²æ‰°ã€å¸¦å®½çš„é™åˆ¶ï¼Œå¯¼è‡´æ¥æ”¶ç«¯æ¥æ”¶çš„ä¿¡å·å’Œå‘é€ç«¯å‘é€çš„ä¿¡å·ä¸ä¸€è‡´ï¼Œè¿™å°±æ˜¯å¤±çœŸç°è±¡ã€‚æ‰€è°“å¤±çœŸå°±æ˜¯å¤±å»äº†çœŸå®æ€§ã€‚ å½±å“å¤±çœŸç¨‹åº¦çš„å› ç´ ï¼šç å…ƒä¼ è¾“é€Ÿç‡ã€ä¿¡å·çš„ä¼ è¾“è·ç¦»ã€å™ªå£°å¹²æ‰°ã€ä¼ è¾“åª’ä½“çš„è´¨é‡ã€‚ ç å…ƒä¼ è¾“é€Ÿç‡è¶Šå¤§ã€ä¿¡å·ä¼ è¾“è·ç¦»è¶Šè¿œã€å™ªå£°å¹²æ‰°è¶Šå¤§ã€æˆ–ä¼ è¾“åª’ä½“è´¨é‡è¶Šå·®ï¼Œæ³¢å½¢å¤±çœŸè¶Šä¸¥é‡ã€‚ 2.2.6 ç é—´ä¸²æ‰°å…·ä½“çš„ä¿¡é“æ‰€èƒ½é€šè¿‡çš„é¢‘ç‡èŒƒå›´æ˜¯æœ‰é™çš„ã€‚å¯¹äºä¿¡å·å¸¦å®½å°çš„ä¿¡å·ï¼Œç”±äºå®é™…ä¿¡é“çš„å¹²æ‰°ç­‰ï¼Œä¼šä½¿ä¿¡å·è¡°å‡å¯¼è‡´å¤±çœŸä¸¥é‡ã€‚è€Œå¯¹äºä¿¡å·å¸¦å®½è¿‡å¤§çš„ä¿¡å·ï¼Œå¦‚æœä¿¡å·ä¸­çš„é«˜é¢‘åˆ†é‡åœ¨ä¼ è¾“è¿‡ç¨‹å—åˆ°è¡°å‡ï¼Œé‚£ä¹ˆåœ¨æ¥æ”¶ç«¯æ”¶åˆ°çš„æ³¢å½¢å‰æ²¿å’Œåæ²¿å˜å¾—ä¸é‚£ä¹ˆé™¡å³­äº†ï¼Œæ¯ä¸€ä¸ªç å…ƒæ‰€å çš„æ—¶é—´ç•Œé™ä¹Ÿä¸å†æ˜¯å¾ˆæ˜ç¡®çš„ã€‚è¿™æ ·ï¼Œåœ¨æ¥æ”¶ç«¯æ¥æ”¶åˆ°çš„ä¿¡å·æ³¢å½¢å°±å¤±å»äº†ç å…ƒä¹‹é—´æ¸…æ™°çš„ç•Œé™ï¼ˆå¯ä»¥ç±»æ¯”ä¸€æ’å¯†é›†çš„ç‚¹å¿«é€Ÿçš„ç§»åŠ¨ï¼Œç‚¹ä¸ç‚¹ä¹‹é—´çš„ç•Œé™å°±ä¼šå˜å¾—å¾ˆæ¨¡ç³Šï¼Œå°±å¾ˆéš¾åˆ†è¾¨æœ‰å¤šå°‘ä¸ªç‚¹äº†ï¼Œå¦‚æœç‚¹åˆ†å¸ƒçš„ç–ï¼Œç§»åŠ¨æ…¢é€Ÿï¼Œå°±å¯ä»¥å¾ˆæ¸…æ™°çš„åˆ†è¾¨æ¯ä¸€ä¸ªç‚¹ï¼‰ã€‚ 2.2.7 å¥ˆæ°å‡†åˆ™å¥ˆæ°å‡†åˆ™ï¼šåœ¨ç†æƒ³ä½é€šï¼ˆæ— å™ªå£°ã€å¸¦å®½å—é™ï¼‰æ¡ä»¶ä¸‹ï¼Œä¸ºäº†é¿å…ç é—´ä¸²æ‰°ï¼Œæé™ç å…ƒä¼ è¾“é€Ÿç‡ä¸º2W Baudï¼ŒWæ˜¯ä¿¡é“å¸¦å®½ï¼Œå•ä½æ˜¯HZã€‚ é€šè¿‡å¥ˆæ°å‡†åˆ™å¯çŸ¥ï¼Œå¦‚æœä¿¡é“çš„é¢‘å¸¦è¶Šå®½ï¼Œèƒ½å¤Ÿé€šè¿‡çš„ä¿¡å·é«˜é¢‘åˆ†é‡è¶Šå¤šï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨æ›´é«˜é€Ÿç‡ä¼ é€ç å…ƒè€Œä¸å‡ºç°ç é—´ä¸²æ‰°ã€‚ç”±äºç å…ƒçš„ä¼ è¾“é€Ÿç‡å—å¥ˆæ°å‡†åˆ™çš„åˆ¶çº¦ï¼Œæ‰€ä»¥è¦æé«˜æ•°æ®çš„ä¼ è¾“é€Ÿç‡ï¼Œå°±å¿…é¡»è®¾æ³•ä½¿æ¯ä¸ªç å…ƒèƒ½æºå¸¦æ›´å¤šçš„ä¸ªæ¯”ç‰¹é‡çš„ä¿¡æ¯ï¼Œè¿™å°±éœ€è¦å¤šå…ƒåˆ¶çš„è°ƒåˆ¶æ–¹æ³•ã€‚ 2.2.8 ä¿¡å™ªæ¯”ä¿¡å™ªæ¯”å°±æ˜¯ä¿¡å·çš„å¹³å‡åŠŸç‡å’Œå™ªå£°çš„å¹³å‡åŠŸç‡ä¹‹æ¯”ï¼Œå¸¸è®°äºS/Nï¼Œå¹¶ç”¨åˆ†è´ï¼ˆdBï¼‰ä½œä¸ºåº¦é‡å•ä½ã€‚å³ ä¿¡å™ªæ¯”ï¼ˆdBï¼‰ = 10 lg(S/N) (dB) 2.2.9 é¦™å†œå…¬å¼åœ¨å¸¦å®½å—é™ä¸”æœ‰å™ªå£°çš„ä¿¡é“ä¸­ï¼Œä¸ºäº†ä¸äº§ç”Ÿè¯¯å·®ï¼Œä¿¡æ¯çš„æ•°æ®ä¼ è¾“ç‡æœ‰ä¸Šé™å€¼ã€‚ ä¿¡é“çš„æé™æ•°æ®ä¼ è¾“é€Ÿç‡ = W log2(1+S/N) (b/s) æ€»ç»“ï¼š ä¿¡é“çš„å¸¦å®½è¶Šå¤§æˆ–ä¿¡é“çš„ä¿¡å™ªæ¯”è¶Šå¤§ï¼Œåˆ™ä¿¡æ¯çš„æé™ä¼ è¾“é€Ÿç‡å°±è¶Šé«˜ã€‚ å¯¹ä¸€å®šçš„ä¼ è¾“å¸¦å®½å’Œä¸€å®šçš„ä¿¡å™ªæ¯”ï¼Œä¿¡æ¯ä¼ è¾“é€Ÿç‡çš„ä¸Šé™å°±ç¡®å®šäº†ã€‚ åªè¦ä¿¡æ¯çš„ä¼ è¾“é€Ÿç‡ä½äºä¿¡é“çš„æé™ä¼ è¾“é€Ÿç‡ï¼Œå°±ä¸€å®šèƒ½æ‰¾åˆ°æŸç§æ–¹æ³•æ¥å®ç°æ— å·®é”™ä¼ è¾“ã€‚ é¦™å†œå®šç†å¾—å‡ºçš„æ˜¯æé™ä¿¡æ¯ä¼ è¾“é€Ÿç‡ï¼Œå®é™…ä¿¡é“èƒ½è¾¾åˆ°çš„ä¼ è¾“é€Ÿç‡è¦æ¯”å®ƒä½å¾ˆå¤šã€‚ 3 ä¼ è¾“åª’ä½“ 4 ä¿¡é“å¤ç”¨æŠ€æœ¯ 5 æ•°å­—ä¼ è¾“ç³»ç»Ÿ 6 å®½å¸¦æ¥å…¥æŠ€æœ¯ 7 ç‰©ç†å±‚å¸¸è§è®¾å¤‡7.1 ä¸­ç»§å™¨è¯ç”ŸåŸå› : ç”±äºå­˜åœ¨æŸè€—ï¼Œåœ¨çº¿è·¯ä¸Šä¼ è¾“çš„ä¿¡å·åŠŸç‡ä¼šé€æ¸è¡°å‡ï¼Œè¡°å‡åˆ°ä¸€å®šç¨‹åº¦æ—¶å°†é€ æˆä¿¡å·å¤±çœŸï¼Œå› æ­¤ä¼šå¯¼è‡´æ¥æ”¶é”™è¯¯ã€‚ ä¸­ç»§å™¨çš„åŠŸèƒ½: å¯¹ä¿¡å·è¿›è¡Œå†ç”Ÿå’Œè¿˜åŸï¼Œå¯¹è¡°å‡çš„ä¿¡å·è¿›è¡Œæ”¾å¤§ï¼Œä¿æŒä¸åŸæ•°æ®ç›¸åŒï¼Œä»¥å¢åŠ ä¿¡å·ä¼ è¾“çš„è·ç¦»ï¼Œå»¶é•¿ç½‘ç»œçš„é•¿åº¦ã€‚ ä¸­ç»§å™¨çš„ä¸¤ç«¯: ä¸¤ç«¯çš„ç½‘ç»œéƒ¨åˆ†æ˜¯ç½‘æ®µï¼Œè€Œä¸æ˜¯å­ç½‘ï¼Œé€‚ç”¨äºå®Œå…¨ç›¸åŒçš„ä¸¤ç±»ç½‘ç»œçš„äº’è¿ï¼Œä¸”ä¸¤ä¸ªç½‘æ®µé€Ÿç‡è¦ç›¸åŒã€‚ ä¸­ç»§å™¨åªå°†ä»»ä½•ç”µç¼†æ®µä¸Šçš„æ•°æ®å‘é€åˆ°å¦ä¸€æ®µç”µç¼†ä¸Šï¼Œå®ƒä»…ä½œç”¨äºä¿¡å·çš„ç”µæ°”éƒ¨åˆ†ï¼Œå¹¶ä¸ç®¡æ•°æ®ä¸­æ˜¯å¦æœ‰é”™è¯¯æ•°æ®æˆ–ä¸é€‚äºç½‘æ®µçš„æ•°æ®ã€‚ä¸¤ç«¯å¯è¿ç›¸åŒåª’ä½“ï¼Œä¹Ÿå¯è¿ä¸åŒåª’ä½“ã€‚ä½†æ˜¯ä¸¤ç«¯çš„ç½‘æ®µä¸€å®šè¦æ˜¯åŒä¸€ä¸ªåè®®ã€‚ 7.2 é›†çº¿å™¨é›†çº¿å™¨æ˜¯ä¸€ç§å¤šå£ä¸­ç»§å™¨ã€‚å®ƒä¹Ÿå¯ä»¥å¯¹ä¿¡å·è¿›è¡Œå†ç”Ÿå’Œè¿˜åŸï¼Œå¯¹è¡°å‡çš„ä¿¡å·è¿›è¡Œæ”¾å¤§ã€‚æ¥ç€è½¬å‘åˆ°å…¶ä»–æ‰€æœ‰(é™¤è¾“å…¥ç«¯å£å¤–)å¤„äºå·¥ä½œçŠ¶æ€çš„ç«¯å£ä¸Šï¼Œä»¥å¢åŠ ä¿¡å·ä¼ è¾“çš„è·ç¦»ï¼Œå»¶é•¿ç½‘ç»œçš„é•¿åº¦ã€‚ä¸å…·å¤‡ä¿¡å·çš„å®šå‘ä¼ é€èƒ½åŠ›ï¼Œæ˜¯ä¸€ä¸ªå…±äº«å¼è®¾å¤‡ã€‚ é›†çº¿å™¨ä¸éš”ç¦»å†²çªåŸŸï¼ŒåŒä¸€é›†çº¿å™¨ä¸‹çš„ä¸»æœºå±äºåŒä¸€ä¸ªå†²çªåŸŸï¼Œæ‰€ä»¥é€šè¿‡é›†çº¿å™¨äº’è”çš„å±€åŸŸç½‘å†…çš„ä¸»æœºæ•°åˆ°è¾¾ä¸€å®šæ•°é‡ä¹‹åé€šä¿¡æ•ˆç‡ä¼šæ€¥å‰§é™ä½ã€‚","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","permalink":"https://www.codetool.top/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"}]},{"title":"Rediså¸¸ç”¨æ•°æ®ç±»å‹ä½¿ç”¨çš„æ•°æ®ç»“æ„","slug":"Rediså¸¸ç”¨æ•°æ®ç±»å‹ä½¿ç”¨çš„æ•°æ®ç»“æ„","date":"2020-04-06T11:00:07.000Z","updated":"2020-04-06T12:20:32.018Z","comments":true,"path":"article/Rediså¸¸ç”¨æ•°æ®ç±»å‹ä½¿ç”¨çš„æ•°æ®ç»“æ„/","link":"","permalink":"https://www.codetool.top/article/Redis%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%BD%BF%E7%94%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š [Redisæ•°æ®ç»“æ„â€”â€”å‹ç¼©åˆ—è¡¨ - è€æ–¼` - åšå®¢å›­](https://www.cnblogs.com/hunternet/p/11306690.html) æå®¢æ—¶é—´ã€Šæ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ã€‹ æ€»ä½“æ¥è¯´ï¼ŒRedisçš„key-valueæ•°æ®å­˜å‚¨æ˜¯é€šè¿‡å“ˆå¸Œè¡¨å®ç°çš„ï¼Œé‚£ä¹ˆå…·ä½“åˆ°æŸä¸€æ•°æ®ç±»å‹ï¼Œåˆæ˜¯ä½¿ç”¨äº†ä»€ä¹ˆæ•°æ®ç»“æ„å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬ç€é‡çœ‹Redisä¸­çš„äº”å¤§æ•°æ®ç±»å‹ï¼šStringã€Hashã€Listã€Setã€Sorted_setã€‚å…¶ä¸­Stringç±»å‹éå¸¸ç®€å•ï¼Œå°±æ˜¯å­—ç¬¦ä¸²ã€‚ 1 Listæˆ‘ä»¬å…ˆæ¥çœ‹åˆ—è¡¨ã€‚åˆ—è¡¨è¿™ç§æ•°æ®ç±»å‹æ”¯æŒå­˜å‚¨ä¸€ç»„æ•°æ®ã€‚è¿™ç§æ•°æ®ç±»å‹å¯¹åº”ä¸¤ç§å®ç°æ–¹æ³•ï¼Œä¸€ç§æ˜¯å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰ï¼Œå¦ä¸€ç§æ˜¯åŒå‘å¾ªç¯é“¾è¡¨ã€‚ 1.1 å‹ç¼©åˆ—è¡¨ï¼ˆZipListï¼‰å½“åˆ—è¡¨ä¸­å­˜å‚¨çš„æ•°æ®é‡æ¯”è¾ƒå°çš„æ—¶å€™ï¼Œåˆ—è¡¨å°±å¯ä»¥é‡‡ç”¨å‹ç¼©åˆ—è¡¨çš„æ–¹å¼å®ç°ã€‚å…·ä½“éœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ï¼š åˆ—è¡¨ä¸­ä¿å­˜çš„å•ä¸ªæ•°æ®ï¼ˆæœ‰å¯èƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„ï¼‰å°äº 64 å­—èŠ‚ã€‚ åˆ—è¡¨ä¸­æ•°æ®ä¸ªæ•°å°‘äº 512 ä¸ªã€‚ å®ƒä¸æ˜¯åŸºç¡€æ•°æ®ç»“æ„ï¼Œè€Œæ˜¯ Redis è‡ªå·±è®¾è®¡çš„ä¸€ç§æ•°æ®å­˜å‚¨ç»“æ„ã€‚å®ƒæœ‰ç‚¹å„¿ç±»ä¼¼æ•°ç»„ï¼Œé€šè¿‡ä¸€ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œæ¥å­˜å‚¨æ•°æ®ã€‚ä¸è¿‡ï¼Œå®ƒè·Ÿæ•°ç»„ä¸åŒçš„ä¸€ç‚¹æ˜¯ï¼Œå®ƒå…è®¸å­˜å‚¨çš„æ•°æ®å¤§å°ä¸åŒï¼ˆå¯ä»¥æ··åˆå­˜å‚¨ä¸åŒç±»å‹ï¼Œä¸åŒå¤§å°çš„æ•°æ®ï¼‰ã€‚ å¬åˆ°â€œå‹ç¼©â€ä¸¤ä¸ªå­—ï¼Œç›´è§‚çš„ååº”å°±æ˜¯èŠ‚çœå†…å­˜ã€‚ä¹‹æ‰€ä»¥è¯´è¿™ç§å­˜å‚¨ç»“æ„èŠ‚çœå†…å­˜,æ˜¯ç›¸è¾ƒäºæ•°ç»„çš„å­˜å‚¨æ€è·¯è€Œè¨€çš„ã€‚æˆ‘ä»¬çŸ¥é“,æ•°ç»„è¦æ±‚æ¯ä¸ªå…ƒç´ çš„å¤§å°ç›¸åŒ,å¦‚æœæˆ‘ä»¬è¦å­˜å‚¨ä¸åŒé•¿åº¦çš„å­—ç¬¦ä¸²,é‚£æˆ‘ä»¬å°±éœ€è¦ç”¨æœ€å¤§é•¿åº¦çš„å­—ç¬¦ä¸²å¤§å°ä½œä¸ºå…ƒç´ çš„å¤§å°(å‡è®¾æ˜¯20ä¸ªå­—èŠ‚)ã€‚å­˜å‚¨å°äº 20 ä¸ªå­—èŠ‚é•¿åº¦çš„å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œä¾¿ä¼šæµªè´¹éƒ¨åˆ†å­˜å‚¨ç©ºé—´ã€‚ æ•°ç»„çš„ä¼˜åŠ¿æ˜¯å ç”¨ä¸€ç‰‡è¿ç»­çš„ç©ºé—´å¯ä»¥å¾ˆå¥½çš„åˆ©ç”¨CPUç¼“å­˜è®¿é—®æ•°æ®ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦ä¿ç•™è¿™ç§ä¼˜åŠ¿ï¼Œåˆæƒ³èŠ‚çœå­˜å‚¨ç©ºé—´æˆ‘ä»¬å¯ä»¥å¯¹æ•°ç»„è¿›è¡Œå‹ç¼©ã€‚ ä½†æ˜¯è¿™æ ·æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åœ¨éå†å®ƒçš„æ—¶å€™ç”±äºä¸çŸ¥é“æ¯ä¸ªå…ƒç´ çš„å¤§å°æ˜¯å¤šå°‘ï¼Œå› æ­¤ä¹Ÿå°±æ— æ³•è®¡ç®—å‡ºä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å…·ä½“ä½ç½®ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ç»™æ¯ä¸ªèŠ‚ç‚¹å¢åŠ ä¸€ä¸ªlengthçš„å±æ€§ã€‚ è¿™ç§è®¾è®¡æ€æƒ³å¹¶ä¸å°‘è§ï¼Œjavaçš„classæ–‡ä»¶å­—èŠ‚ç ä¸­æ¶‰åŠåˆ°å­—æ®µè¡¨ã€æ–¹æ³•è¡¨ã€å±æ€§è¡¨ï¼Œéƒ½ä¼šå…ˆç»™ä¸€ä¸ªæ•°æ®é¡¹æ•°ï¼Œç„¶åç´§è·Ÿçš„æ˜¯æ•°æ®é¡¹çš„åˆ—è¡¨ï¼Œæ¯ä¸€ä¸ªæ•°æ®é¡¹å¼€å¤´éƒ½ä¼šè®°å½•æ•°æ®é¡¹çš„é•¿åº¦ã€‚è¿™éƒ¨åˆ†ç›¸å…³å†…å®¹è§Javaå­—èŠ‚ç å®ä¾‹æ¢ç©¶ Redisä¸­çš„å‹ç¼©åˆ—è¡¨ï¼Œæ„æˆå¦‚ä¸‹å›¾ï¼š ä¸€ä¸ªå‹ç¼©åˆ—è¡¨å¯ä»¥åŒ…å«ä»»æ„å¤šä¸ªèŠ‚ç‚¹(entry),æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥ä¿å­˜ä¸€ä¸ªå­—èŠ‚æ•°ç»„æˆ–è€…ä¸€ä¸ªæ•´æ•°å€¼ã€‚é™¤äº†å­˜å‚¨èŠ‚ç‚¹å¤–ï¼Œå¤´éƒ¨è¿˜å­˜å‚¨äº†é¢å¤–çš„ä¿¡æ¯ï¼š zlbytesï¼šåˆ—è¡¨æ€»é•¿åº¦ zltailï¼šæœ€åä¸€ä¸ªèŠ‚ç‚¹åœ°å€æ®åˆ—è¡¨èµ·å§‹åœ°å€çš„åç§»é‡ zllenï¼šèŠ‚ç‚¹ä¸ªæ•° å°¾éƒ¨é™„åŠ äº†ä¸€ä¸ªzlendä½œä¸ºç»“æŸçš„æ ‡è¯†ã€‚ å‹ç¼©åˆ—è¡¨ç›¸è¾ƒäºæ•°ç»„ï¼Œè™½ç„¶èŠ‚çœäº†ç©ºé—´ï¼Œä½†å¤±å»äº†æ•°ç»„çš„éšæœºè®¿é—®æ€§ï¼Œç”±äºæ¯ä¸ªæ•°æ®é¡¹çš„å¤§å°éƒ½å¯èƒ½ä¸åŒï¼Œä¸èƒ½é€šè¿‡è®¡ç®—åç§»é‡æ¥è·å–æŸä¸€ä¸­é—´å…ƒç´ çš„åœ°å€ï¼Œåªèƒ½é¡ºåºè®¿é—®ï¼Œè¿™ä¸€ç‚¹å°±è·Ÿé“¾è¡¨ä¸€æ ·ï¼Œæ¯”é“¾è¡¨å¥½çš„æ˜¯ç‰©ç†ä¸Šçš„å­˜å‚¨è¿˜æ˜¯è¿ç»­çš„ï¼Œä¸å¿…å¤šæ¬¡å¯»å€ã€‚æ‰€ä»¥æ•°æ®é¡¹è¾ƒå¤šæ—¶å‹ç¼©åˆ—è¡¨å°±ä¸é€‚ç”¨äº†ï¼Œè¿›è€Œä½¿ç”¨åŒå‘å¾ªç¯é“¾è¡¨ã€‚ 1.2 åŒå‘å¾ªç¯é“¾è¡¨å½“ä¸æ»¡è¶³å‹ç¼©åˆ—è¡¨çš„ä½¿ç”¨æ¡ä»¶æ—¶ï¼Œå°±ä½¿ç”¨åŒå‘å¾ªç¯é“¾è¡¨ï¼Œè¿™éƒ¨åˆ†è¾ƒç®€å•ã€‚ 2 HashHashç±»å‹åˆç§°å­—å…¸ç±»å‹ï¼Œä¹Ÿæœ‰ä¸¤ç§å®ç°æ–¹å¼ã€‚ä¸€ç§æ˜¯æˆ‘ä»¬åˆšåˆšè®²åˆ°çš„å‹ç¼©åˆ—è¡¨ï¼Œå¦ä¸€ç§æ˜¯æ•£åˆ—è¡¨ã€‚ åŒæ ·ï¼Œåªæœ‰å½“å­˜å‚¨çš„æ•°æ®é‡æ¯”è¾ƒå°çš„æƒ…å†µä¸‹ï¼ŒRedis æ‰ä½¿ç”¨å‹ç¼©åˆ—è¡¨æ¥å®ç°å­—å…¸ç±»å‹ã€‚å…·ä½“éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š å­—å…¸ä¸­ä¿å­˜çš„é”®å’Œå€¼çš„å¤§å°éƒ½è¦å°äº 64 å­—èŠ‚ï¼› å­—å…¸ä¸­é”®å€¼å¯¹çš„ä¸ªæ•°è¦å°äº 512 ä¸ªã€‚ å½“ä¸èƒ½åŒæ—¶æ»¡è¶³ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶çš„æ—¶å€™ï¼ŒRedis å°±ä½¿ç”¨æ•£åˆ—è¡¨æ¥å®ç°å­—å…¸ç±»å‹ã€‚Redis ä½¿ç”¨MurmurHash2 è¿™ç§è¿è¡Œé€Ÿåº¦å¿«ã€éšæœºæ€§å¥½çš„å“ˆå¸Œç®—æ³•ä½œä¸ºå“ˆå¸Œå‡½æ•°ã€‚å¯¹äºå“ˆå¸Œå†²çªé—®é¢˜ï¼ŒRedis ä½¿ç”¨é“¾è¡¨æ³•ï¼ˆæ‹‰é“¾æ³•ï¼‰æ¥è§£å†³ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒRedis è¿˜æ”¯æŒæ•£åˆ—è¡¨çš„åŠ¨æ€æ‰©å®¹ã€ç¼©å®¹ã€‚ å½“æ•°æ®åŠ¨æ€å¢åŠ ä¹‹åï¼Œæ•£åˆ—è¡¨çš„è£…è½½å› å­ä¼šä¸åœåœ°å˜å¤§ã€‚ä¸ºäº†é¿å…æ•£åˆ—è¡¨æ€§èƒ½çš„ä¸‹é™ï¼Œå½“è£…è½½å› å­å¤§äº 1 çš„æ—¶å€™ï¼ˆå¯¹äºä½¿ç”¨æ‹‰é“¾æ³•è§£å†³å“ˆå¸Œå†²çªçš„å“ˆå¸Œè¡¨è£…è½½å› å­æ˜¯æœ‰å¯èƒ½å¤§äº1çš„ï¼‰ï¼ŒRedis ä¼šè§¦å‘æ‰©å®¹ï¼Œå°†æ•£åˆ—è¡¨æ‰©å¤§ä¸ºåŸæ¥å¤§å°çš„ 2 å€å·¦å³ã€‚ å½“æ•°æ®åŠ¨æ€å‡å°‘ä¹‹åï¼Œä¸ºäº†èŠ‚çœå†…å­˜ï¼Œå½“è£…è½½å› å­å°äº 0.1 çš„æ—¶å€™ï¼ŒRedis å°±ä¼šè§¦å‘ç¼©å®¹ï¼Œç¼©å°ä¸ºå­—å…¸ä¸­æ•°æ®ä¸ªæ•°çš„å¤§çº¦ 2 å€å¤§å°ã€‚ ç”±äºæ‰©å®¹ç¼©å®¹è¦åšå¤§é‡çš„æ•°æ®æ¬ç§»å’Œå“ˆå¸Œå€¼çš„é‡æ–°è®¡ç®—ï¼Œæ¯”è¾ƒè€—æ—¶ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼ŒRedis ä½¿ç”¨äº†æ¸è¿›å¼æ‰©å®¹ç¼©å®¹ç­–ç•¥ï¼Œå°†æ•°æ®çš„æ¬ç§»åˆ†æ‰¹è¿›è¡Œï¼Œé¿å…äº†å¤§é‡æ•°æ®ä¸€æ¬¡æ€§æ¬ç§»å¯¼è‡´çš„æœåŠ¡åœé¡¿ã€‚ 3 Seté›†åˆè¿™ç§æ•°æ®ç±»å‹ç”¨æ¥å­˜å‚¨ä¸€ç»„ä¸é‡å¤çš„æ•°æ®ã€‚è¿™ç§æ•°æ®ç±»å‹ä¹Ÿæœ‰ä¸¤ç§å®ç°æ–¹æ³•ï¼Œä¸€ç§æ˜¯åŸºäºæœ‰åºæ•°ç»„ï¼Œå¦ä¸€ç§æ˜¯åŸºäºæ•£åˆ—è¡¨ã€‚ å½“è¦å­˜å‚¨çš„æ•°æ®ï¼ŒåŒæ—¶æ»¡è¶³ä¸‹é¢è¿™æ ·ä¸¤ä¸ªæ¡ä»¶çš„æ—¶å€™ï¼ŒRedis å°±é‡‡ç”¨æœ‰åºæ•°ç»„ï¼Œæ¥å®ç°é›†åˆè¿™ç§æ•°æ®ç±»å‹ã€‚ å­˜å‚¨çš„æ•°æ®éƒ½æ˜¯æ•´æ•°ã€‚ å­˜å‚¨çš„æ•°æ®å…ƒç´ ä¸ªæ•°ä¸è¶…è¿‡ 512 ä¸ªã€‚ å½“ä¸èƒ½åŒæ—¶æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶çš„æ—¶å€™ï¼ŒRedis å°±ä½¿ç”¨æ•£åˆ—è¡¨æ¥å­˜å‚¨é›†åˆä¸­çš„æ•°æ®ã€‚ 4 Sorted_setSorted_setåˆç§°æœ‰åºé›†åˆï¼Œå®ƒç”¨æ¥å­˜å‚¨ä¸€ç»„æ•°æ®ï¼Œå¹¶ä¸”æ¯ä¸ªæ•°æ®ä¼šé™„å¸¦ä¸€ä¸ªå¾—åˆ†ï¼ˆæƒé‡ï¼‰ã€‚æ ¹æ®å¾—åˆ†å®ç°å¯¹ä¸ªæ•°æ®è¿›è¡Œæ’åºã€‚ å®ƒçš„åº•å±‚é€šè¿‡è·³è¡¨å®ç°ï¼Œç›¸å…³å†…å®¹å‚è€ƒè·³è¡¨-æŠ«ç€é“¾è¡¨å¤–è¡£çš„ä¼ªæœç´¢æ ‘ã€‚é€šè¿‡å¾—åˆ†çš„å¤§å°ï¼Œæˆ‘ä»¬å°†æ•°æ®ç»„ç»‡æˆè·³è¡¨è¿™æ ·çš„æ•°æ®ç»“æ„ï¼Œä»¥æ”¯æŒå¿«é€Ÿåœ°æŒ‰ç…§å¾—åˆ†å€¼ã€å¾—åˆ†åŒºé—´è·å–æ•°æ®ã€‚ å®é™…ä¸Šï¼Œè·Ÿ Redis çš„å…¶ä»–æ•°æ®ç±»å‹ä¸€æ ·ï¼Œæœ‰åºé›†åˆä¹Ÿå¹¶ä¸ä»…ä»…åªæœ‰è·³è¡¨è¿™ä¸€ç§å®ç°æ–¹å¼ã€‚å½“æ•°æ®é‡æ¯”è¾ƒå°çš„æ—¶å€™ï¼ŒRedis ä¼šç”¨å‹ç¼©åˆ—è¡¨æ¥å®ç°æœ‰åºé›†åˆã€‚å…·ä½“ç‚¹è¯´å°±æ˜¯ï¼Œä½¿ç”¨å‹ç¼©åˆ—è¡¨æ¥å®ç°æœ‰åºé›†åˆçš„å‰æï¼Œæœ‰è¿™æ ·ä¸¤ä¸ªï¼š æ‰€æœ‰æ•°æ®çš„å¤§å°éƒ½è¦å°äº 64 å­—èŠ‚ã€‚ å…ƒç´ ä¸ªæ•°è¦å°äº 128 ä¸ªã€‚","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"Redis","slug":"Redis","permalink":"https://www.codetool.top/tags/Redis/"}]},{"title":"leetcode72-ç¼–è¾‘è·ç¦»","slug":"leetcode72-ç¼–è¾‘è·ç¦»","date":"2020-04-06T05:23:46.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode72-ç¼–è¾‘è·ç¦»/","link":"","permalink":"https://www.codetool.top/article/leetcode72-%E7%BC%96%E8%BE%91%E8%B7%9D%E7%A6%BB/","excerpt":"","text":"1 åŸé¢˜ç»™ä½ ä¸¤ä¸ªå•è¯ word1 å’Œ word2*ï¼Œè¯·ä½ è®¡ç®—å‡ºå°† *word1 è½¬æ¢æˆ word2 æ‰€ä½¿ç”¨çš„æœ€å°‘æ“ä½œæ•° ã€‚ ä½ å¯ä»¥å¯¹ä¸€ä¸ªå•è¯è¿›è¡Œå¦‚ä¸‹ä¸‰ç§æ“ä½œï¼š æ’å…¥ä¸€ä¸ªå­—ç¬¦ åˆ é™¤ä¸€ä¸ªå­—ç¬¦ æ›¿æ¢ä¸€ä¸ªå­—ç¬¦ ç¤ºä¾‹1: è¾“å…¥ï¼š word1 = â€œhorseâ€, word2 = â€œrosâ€è¾“å‡ºï¼š 3è§£é‡Šï¼šhorse -&gt; rorse (å°† â€˜hâ€™ æ›¿æ¢ä¸º â€˜râ€™)rorse -&gt; rose (åˆ é™¤ â€˜râ€™)rose -&gt; ros (åˆ é™¤ â€˜eâ€™) ç¤ºä¾‹2: è¾“å…¥ï¼š word1 = â€œintentionâ€, word2 = â€œexecutionâ€è¾“å‡ºï¼š 5è§£é‡Š:intention -&gt; inention (åˆ é™¤ â€˜tâ€™)inention -&gt; enention (å°† â€˜iâ€™ æ›¿æ¢ä¸º â€˜eâ€™)enention -&gt; exention (å°† â€˜nâ€™ æ›¿æ¢ä¸º â€˜xâ€™)exention -&gt; exection (å°† â€˜nâ€™ æ›¿æ¢ä¸º â€˜câ€™)exection -&gt; execution (æ’å…¥ â€˜uâ€™) 2 è§£æ³•2.1 æ€æƒ³ç¼–è¾‘è·ç¦»ç®—æ³•ï¼Œå’ŒKMPç®—æ³•ä¸€æ ·ï¼Œå±äºå­—ç¬¦ä¸²å¤„ç†é‡Œé¢çš„ç»å…¸ç®—æ³•äº†ï¼ŒKMPç®—æ³•å±äºç²¾å‡†æ¨¡å¼åŒ¹é…ï¼Œè€Œç¼–è¾‘è·ç¦»ç®—æ³•ç”¨äºå¤„ç†ä¸¤ä¸ªå­—ç¬¦ä¸²ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œä¹Ÿå±äºä¸€ç§åŒ¹é…æ–¹å¼ã€‚ ä¸€èˆ¬æ¥è¯´,ç¼–è¾‘è·ç¦»è¶Šå°,ä¸¤ä¸ªå­—ç¬¦ä¸²çš„ç›¸ä¼¼åº¦è¶Šå¤§ã€‚ å¹¶ä¸”ç¼–è¾‘è·ç¦»ç®—æ³•å¹¿æ³›è¿ç”¨äºç”Ÿäº§ä¸­ï¼Œä¾‹å¦‚æœç´¢å¼•æ“é€šè¿‡ç¼–è¾‘è·ç¦»ç®—æ³•æ¥æ™ºèƒ½è¯†é”™ï¼Œwordè½¯ä»¶é€šè¿‡ç¼–è¾‘è·ç¦»ç®—æ³•åšæ‹¼å†™æ£€æŸ¥ã€‚ æ€æƒ³å°±æ˜¯åŠ¨æ€è§„åˆ’ï¼š ç”»ä¸€ä¸ªçŸ©é˜µï¼Œä¸­é—´çš„æ ¼å­ä»£è¡¨ä»ä¸€ä¸ªå­—ç¬¦ä¸²åˆ°å¦ä¸€ä¸ªå­—ç¬¦ä¸²çš„ç¼–è¾‘è·ç¦»ã€‚ å¯¹äºç¬¬ä¸€è¡Œã€ç¬¬ä¸€åˆ—ï¼Œæˆ‘ä»¬æå‰èµ‹å€¼1~nï¼Œä»£è¡¨ä»…é€šè¿‡æ’å…¥çš„æ–¹å¼è®¡ç®—çš„ç¼–è¾‘è·ç¦»ã€‚ ç„¶åï¼Œå¯¹äºä»»æ„ä¸€ä¸ªæ ¼å­ï¼Œä¾‹å¦‚å›¾ä¸­çš„çº¢è‰²æ ¼å­dp[m][n]ï¼Œå®ƒå¯èƒ½ç”±å­—ç¬¦ä¸²Aæ’å…¥ä¸€ä¸ªå­—ç¬¦ã€å­—ç¬¦ä¸²Bæ’å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œå­—ç¬¦ä¸²Aä¿®æ”¹ä¸€ä¸ªå­—ç¬¦å¾—åˆ°ï¼Œå¯¹äºä¿®æ”¹å­—ç¬¦ï¼Œå¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²åœ¨è¯¥ä½ç½®ä¸Šçš„å­—ç¬¦ç›¸åŒï¼Œåˆ™ä¸ç”¨ä¿®æ”¹ï¼Œå¯¹åº”çš„æœ€å°ç¼–è¾‘è·ç¦»å°±æ˜¯min(dp[m][n-1],dp[m-1][n],dp[m-1][n-1]-1)+1ï¼Œå®é™…ä¸Šæœ€å°çš„å¿…æ˜¯dp[m-1][n-1]-1ï¼Œå³æ­¤æ—¶ç¼–è¾‘è·ç¦»ä¸ºdp[m-1][n-1]ï¼Œå¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²åœ¨è¯¥ä½ç½®ä¸Šçš„å­—ç¬¦ä¸åŒï¼Œåˆ™éœ€è¦ä¿®æ”¹æœ€åä¸€ä¸ªå­—ç¬¦ï¼Œæ­¤æ—¶æœ€å°ç¼–è¾‘è·ç¦»ä¸ºmin(dp[m][n-1],dp[m-1][n],dp[m-1][n-1])+1 2.2 ä»£ç class Solution { public int minDistance(String word1, String word2) { int n1 = word1.length(); int n2 = word2.length(); int[][] dp = new int[n1 + 1][n2 + 1]; // ç¬¬ä¸€è¡Œ for (int j = 1; j &lt;= n2; j++) dp[0][j] = dp[0][j - 1] + 1; // ç¬¬ä¸€åˆ— for (int i = 1; i &lt;= n1; i++) dp[i][0] = dp[i - 1][0] + 1; for (int i = 1; i &lt;= n1; i++) { for (int j = 1; j &lt;= n2; j++) { if (word1.charAt(i - 1) == word2.charAt(j - 1)) dp[i][j] = dp[i - 1][j - 1]; else dp[i][j] = Math.min(Math.min(dp[i - 1][j - 1], dp[i][j - 1]), dp[i - 1][j]) + 1; } } return dp[n1][n2]; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"SpringBootæ•´åˆæ¨¡æ¿å¼•æ“Thymeleaf","slug":"SpringBootæ•´åˆæ¨¡æ¿å¼•æ“Thymeleaf","date":"2020-04-05T14:48:21.000Z","updated":"2020-04-22T10:13:27.524Z","comments":true,"path":"article/SpringBootæ•´åˆæ¨¡æ¿å¼•æ“Thymeleaf/","link":"","permalink":"https://www.codetool.top/article/SpringBoot%E6%95%B4%E5%90%88%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8EThymeleaf/","excerpt":"","text":"1 SpringBoot å¯¹é™æ€èµ„æºçš„æ˜ å°„è§„åˆ™æ‰€æœ‰ /webjars/**çš„è¯·æ±‚ ï¼Œéƒ½å» classpath:/META-INF/resources/webjars/ æ‰¾èµ„æºï¼› resources-&gt;webjarså¼•å…¥é™æ€èµ„æº http://www.webjars.org/ &lt;!--å¼•å…¥jquery-webjar-->åœ¨è®¿é—®çš„æ—¶å€™åªéœ€è¦å†™webjarsä¸‹é¢èµ„æºçš„åç§°å³å¯ &lt;dependency> &lt;groupId>org.webjars&lt;/groupId> &lt;artifactId>jquery&lt;/artifactId> &lt;version>3.3.1&lt;/version> &lt;/dependency> æ‰€æœ‰â€/**â€ è¯·æ±‚ï¼Œä¼šå»ä»¥ä¸‹æ–‡ä»¶å¤¹æŸ¥æ‰¾ï¼š &quot;classpath:/META-INF/resources/&quot; &quot;classpath:/resources/&quot; &quot;classpath:/static/&quot; &quot;classpath:/public/&quot; &quot;/&quot;ï¼šå½“å‰é¡¹ç›®çš„æ ¹è·¯å¾„ 2 ThymeleafThymeleafæ˜¯ä¸€ä¸ªXML/XHTML/HTML5æ¨¡æ¿å¼•æ“ï¼Œå¯ç”¨äºWebä¸éWebç¯å¢ƒä¸­çš„åº”ç”¨å¼€å‘ã€‚å®ƒæ˜¯ä¸€ä¸ªå¼€æºçš„Javaåº“ï¼ŒåŸºäºApache License 2.0è®¸å¯ï¼Œç”±Daniel FernÃ¡ndezåˆ›å»ºï¼Œè¯¥ä½œè€…è¿˜æ˜¯JavaåŠ å¯†åº“Jasyptçš„ä½œè€…ã€‚ Thymeleafæ˜¯SpringBootå®˜æ–¹æ¨èä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ã€‚ &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-thymeleaf&lt;/artifactId> &lt;/dependency> 2.1 springbootç›¸å…³é…ç½®#thymeleaf start spring: thymeleaf: mode: HTML5 encoding: UTF-8 # å¼€å‘æ—¶å…³é—­ç¼“å­˜,ä¸ç„¶æ²¡åŠæ³•å®ç°çƒ­åˆ·æ–° cache: false # prefixå’Œsuffixéƒ½æ˜¯é»˜è®¤çš„ï¼Œå¯ä¸ç”¨é…ç½® prefix: classpath:/templates/ # æ¨¡ç‰ˆå­˜æ”¾è·¯å¾„ suffix: .html # æ¨¡ç‰ˆåç¼€ servlet: content-type: text/html #thymeleaf end 2.2 ç®€å•æ¡ˆä¾‹åˆ›å»ºspringbootå·¥ç¨‹ï¼Œé…ç½®å¦‚ä¸Šæ‰€ç¤º åœ¨/templateä¸‹æ–°å»ºdemo1.html: &lt;!DOCTYPE html> &lt;html xmlns:th=\"http://www.thymeleaf.org\"> &lt;head> &lt;meta charset=\"UTF-8\" /> &lt;title>thymeleafå…¥é—¨æ¡ˆä¾‹&lt;/title> &lt;/head> &lt;body> &lt;div th:text=\"${message}\">&lt;/div> &lt;/body> &lt;/html> æ–°å»ºcontrollerç±»com.rhett.controller.TestController @Controller public class TestController { @GetMapping(\"/hello\") public String hello(Model model){ model.addAttribute(\"message\",\"hello thymeleaf!\"); return \"demo1\"; } } å¯åŠ¨ç¨‹åºï¼Œè®¿é—®/helloèµ„æºï¼Œçœ‹åˆ°é¡µé¢æ­£ç¡®è¾“å‡ºã€‚ 2.3 åŸºæœ¬è¯­æ³•Thymeleafè¯­æ³•å¯ä»¥å‚è€ƒ https://www.cnblogs.com/itdragon/archive/2018/04/13/8724291.html åŸºæœ¬è¯­æ³•å°±æ˜¯åœ¨htmlæ ‡ç­¾ä¸­ä½¿ç”¨th:**å±æ€§ï¼Œé‡Œé¢ä½¿ç”¨è¡¨è¾¾å¼ã€‚ 2.3.1 è¡¨è¾¾å¼Variable Expressions: ${...} Selection Variable Expressions: *{...} Message Expressions: #{...} Link URL Expressions: @{...} Fragment Expressions: ~{...} 2.3.2 th:actionå®šä¹‰åå°æ§åˆ¶å™¨è·¯å¾„ï¼Œç±»ä¼¼æ ‡ç­¾çš„actionå±æ€§ã€‚ &lt;form id=\"login-form\" th:action=\"@{/test/hello}\"> &lt;button>æäº¤&lt;/button> &lt;/form> è¡¨ç¤ºæäº¤çš„è¯·æ±‚åœ°å€ä¸º/test/hello 2.3.3 th:eachå¯¹è±¡éå†ï¼ŒåŠŸèƒ½ç±»ä¼¼jstlä¸­çš„&lt;c:forEach&gt;æ ‡ç­¾ã€‚ å®ä½“ç±»ï¼š public class User { private Integer id; private String name; private String address; //..get..set } Controlleræ·»åŠ æ•°æ® /*** * è®¿é—®/test/hello è·³è½¬åˆ°demo1é¡µé¢ * @param model * @return */ @RequestMapping(\"/hello\") public String hello(Model model){ model.addAttribute(\"hello\",\"hello welcome\"); //é›†åˆæ•°æ® List&lt;User> users = new ArrayList&lt;User>(); users.add(new User(1,\"å¼ ä¸‰\",\"æ·±åœ³\")); users.add(new User(2,\"æå››\",\"åŒ—äº¬\")); users.add(new User(3,\"ç‹äº”\",\"æ­¦æ±‰\")); model.addAttribute(\"users\",users); return \"demo1\"; } thymeleafé¡µé¢ï¼š &lt;table> &lt;tr> &lt;td>ä¸‹æ ‡&lt;/td> &lt;td>ç¼–å·&lt;/td> &lt;td>å§“å&lt;/td> &lt;td>ä½å€&lt;/td> &lt;/tr> &lt;tr th:each=\"user,userStat:${users}\"> &lt;td> ä¸‹æ ‡:&lt;span th:text=\"${userStat.index}\">&lt;/span>, &lt;/td> &lt;td th:text=\"${user.id}\">&lt;/td> &lt;td th:text=\"${user.name}\">&lt;/td> &lt;td th:text=\"${user.address}\">&lt;/td> &lt;/tr> &lt;/table> å…¶ä¸­userä»£è¡¨å½“å‰éå†åˆ°çš„å¯¹è±¡ï¼ŒuserStatå­˜å‚¨äº†ä¸€äº›éå†çš„ç›¸å…³ä¿¡æ¯ï¼Œä¾‹å¦‚å½“å‰ä¸‹æ ‡ã€‚ th:eachè¿˜å¯ç”¨äºéå†Mapã€æ•°ç»„ã€‚ 2.3.4 th:ifåå°æ·»åŠ å¹´é¾„ //ifæ¡ä»¶ model.addAttribute(\"age\",22); é¡µé¢è¾“å‡º &lt;div> &lt;span th:if=\"${(age>=18)}\">ç»ˆäºé•¿å¤§äº†ï¼&lt;/span> &lt;/div> 2.3.5 Dateè¾“å‡ºåå°æ·»åŠ æ—¥æœŸ //æ—¥æœŸ model.addAttribute(\"now\",new Date()); é¡µé¢è¾“å‡º &lt;div> &lt;span th:text=\"${#dates.format(now,'yyyy-MM-dd hh:ss:mm')}\">&lt;/span> &lt;/div>","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.codetool.top/tags/SpringBoot/"}]},{"title":"å‰‘æŒ‡offer05-æ›¿æ¢ç©ºæ ¼","slug":"å‰‘æŒ‡offer05-æ›¿æ¢ç©ºæ ¼","date":"2020-04-05T04:32:06.000Z","updated":"2020-04-05T04:33:43.991Z","comments":true,"path":"article/å‰‘æŒ‡offer05-æ›¿æ¢ç©ºæ ¼/","link":"","permalink":"https://www.codetool.top/article/%E5%89%91%E6%8C%87offer05-%E6%9B%BF%E6%8D%A2%E7%A9%BA%E6%A0%BC/","excerpt":"","text":"1 åŸé¢˜ï¼ˆæ¥æºLeetcodeï¼‰è¯·å®ç°ä¸€ä¸ªå‡½æ•°ï¼ŒæŠŠå­—ç¬¦ä¸² s ä¸­çš„æ¯ä¸ªç©ºæ ¼æ›¿æ¢æˆâ€%20â€ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š s = â€œWe are happy.â€è¾“å‡ºï¼š â€œWe%20are%20happy.â€ é™åˆ¶ï¼š 0 &lt;= s çš„é•¿åº¦ &lt;= 10000 2 è§£æ³•2.1 æ€æƒ³ç®€å•é¢˜æ‰“å¡ï¼Œæ²¡æœ‰æ€æƒ³ 2.2 ä»£ç class Solution { public String replaceSpace(String s) { StringBuilder sb = new StringBuilder(); for(char i:s.toCharArray()){ if(i==' ') sb.append(\"%20\"); else sb.append(i); } return sb.toString(); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"å‰‘æŒ‡offer","slug":"å‰‘æŒ‡offer","permalink":"https://www.codetool.top/tags/%E5%89%91%E6%8C%87offer/"}]},{"title":"ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„ä»‹ç»","slug":"ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„ä»‹ç»","date":"2020-04-04T15:13:19.000Z","updated":"2020-04-04T15:41:18.002Z","comments":true,"path":"article/ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„ä»‹ç»/","link":"","permalink":"https://www.codetool.top/article/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95%E7%9A%84%E4%BB%8B%E7%BB%8D/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š ä¸€è‡´æ€§Hashç®—æ³•è¯¦è§£ - çŸ¥ä¹ 1 ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ¦‚è¿°åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¸¸å¸¸å¬åˆ°ä¸€ç§ç®—æ³•å«ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œè€Œæœ€å¸¸ç”¨çš„é¢†åŸŸç›¸ä¿¡å¤§å®¶ä¹Ÿæœ‰æ‰€è€³é—»â€”â€”è´Ÿè½½å‡è¡¡ã€‚è´Ÿè½½å‡è¡¡æœ‰è®¸å¤šç®—æ³•ï¼Œä¾‹å¦‚è½®è¯¢ã€éšæœºã€åŠ æƒè½®è¯¢/éšæœºã€æœ€å°è¿æ¥æ•°ã€‚ä½†æ˜¯å‡å¦‚æˆ‘ä»¬éœ€è¦ä¼šè¯ç²˜æ»ï¼ˆsession stickyï¼‰å‘¢ï¼Ÿ ä»€ä¹ˆæ˜¯ä¼šè¯ç²˜æ»ï¼šç»™åŒä¸€ä¸ªå®¢æˆ·æä¾›æœåŠ¡çš„æœåŠ¡å™¨æ°¸è¿œæ˜¯åŒä¸€å°ï¼Œå°±èƒ½å®ç°æ¯æ¬¡è¿æ¥éƒ½æ˜¯ä¸Šæ¬¡çš„sessionã€‚ä¾‹å¦‚æˆ‘å»é“¶è¡ŒåŠæ‰‹ç»­ï¼Œè°ˆåˆ°ä¸€åŠå‘ç°è‡ªå·±èº«ä»½è¯å¿˜å¸¦äº†ï¼Œéœ€è¦å›å®¶æ‹¿èº«ä»½è¯ï¼Œé‚£ä¹ˆæˆ‘æ‹¿å®Œèº«ä»½è¯å›æ¥ä¹‹åå¸Œæœ›è¿˜æ˜¯åŒä¸€ä¸ªä¸šåŠ¡å‘˜æ¥æ¥å¾…æˆ‘ã€‚ ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å°±ä¿è¯äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ¯æ¬¡ç»™åŒä¸€å°å®¢æˆ·æœºæœåŠ¡çš„ä¸»æœºéƒ½æ˜¯åŒä¸€å°ï¼Œè€Œåˆ†è¾¨æ˜¯å¦æ˜¯åŒä¸€å°å®¢æˆ·æœºçš„ä¾æ®å°±æ˜¯å®¢æˆ·æœºçš„IPã€‚é‚£ä¹ˆå¦‚ä½•æ ¹æ®è¿™ä¸ªIPæ¥é€‰å–åŒä¸€å°æœåŠ¡å™¨æ¥æœåŠ¡å‘¢ï¼Œå¦‚æœä½¿ç”¨å“ˆå¸Œç®—æ³•è·å–åŒä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œåˆ™è¿™ä¸ªå“ˆå¸Œå€¼çš„ç”Ÿæˆå¿…é¡»ä¸èƒ½å’ŒæœåŠ¡å™¨çš„ä¸ªæ•°ç›¸å…³ï¼Œå¦åˆ™ä¸€æ—¦æœåŠ¡å™¨å¢åŠ æˆ–è€…å‡å°‘ï¼Œæœ€ç»ˆç”Ÿæˆçš„å“ˆå¸Œå€¼éƒ½ä¼šå˜åŒ–ã€‚ 2 ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åŸç†2.1 ç¯å½¢hashç©ºé—´æŒ‰ç…§å¸¸ç”¨çš„hashç®—æ³•æ¥å°†å¯¹åº”çš„keyå“ˆå¸Œåˆ°ä¸€ä¸ªå…·æœ‰2^32æ¬¡æ–¹ä¸ªèŠ‚ç‚¹çš„ç©ºé—´ä¸­ï¼Œå³0 ~ (2^32)-1çš„æ•°å­—ç©ºé—´ä¸­ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥å°†è¿™äº›æ•°å­—å¤´å°¾ç›¸è¿ï¼Œæƒ³è±¡æˆä¸€ä¸ªé—­åˆçš„ç¯å½¢ã€‚ 2.2 æ˜ å°„æœåŠ¡å™¨èŠ‚ç‚¹å°†å„ä¸ªæœåŠ¡å™¨è¿›è¡Œä¸€ä¸ªå“ˆå¸Œï¼Œå…·ä½“å¯ä»¥é€‰æ‹©æœåŠ¡å™¨çš„ipæˆ–å”¯ä¸€ä¸»æœºåä½œä¸ºå…³é”®å­—è¿›è¡Œå“ˆå¸Œï¼Œè¿™æ ·æ¯å°æœºå™¨å°±èƒ½ç¡®å®šå…¶åœ¨å“ˆå¸Œç¯ä¸Šçš„ä½ç½®ã€‚å‡è®¾æˆ‘ä»¬å°†å››å°æœåŠ¡å™¨ä½¿ç”¨ipåœ°å€å“ˆå¸Œååœ¨ç¯ç©ºé—´çš„ä½ç½®å¦‚ä¸‹ï¼š 2.3 æ˜ å°„æ•°æ®ç°åœ¨æˆ‘ä»¬å°†objectAã€objectBã€objectCã€objectDå››ä¸ªå¯¹è±¡ï¼ˆä»£è¡¨å®¢æˆ·æœºçš„IPï¼‰é€šè¿‡ç‰¹å®šçš„Hashå‡½æ•°è®¡ç®—å‡ºå¯¹åº”çš„keyå€¼ï¼Œç„¶åæ•£åˆ—åˆ°Hashç¯ä¸Š,ç„¶åä»æ•°æ®æ‰€åœ¨ä½ç½®æ²¿ç¯é¡ºæ—¶é’ˆâ€œè¡Œèµ°â€ï¼Œç¬¬ä¸€å°é‡åˆ°çš„æœåŠ¡å™¨å°±æ˜¯å…¶åº”è¯¥å®šä½åˆ°çš„æœåŠ¡å™¨ã€‚ 2.4 æœåŠ¡å™¨çš„åˆ é™¤ä¸æ·»åŠ å¦‚æœæ­¤æ—¶NodeCå®•æœºäº†ï¼Œæ­¤æ—¶Object Aã€Bã€Dä¸ä¼šå—åˆ°å½±å“ï¼Œåªæœ‰Object Cä¼šé‡æ–°åˆ†é…åˆ°Node Dä¸Šé¢å»ï¼Œè€Œå…¶ä»–æ•°æ®å¯¹è±¡ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚ è¿™æ—¶å¯èƒ½å°±æœ‰é—®é¢˜äº†ï¼Œä¸æ˜¯è¯´èƒ½ä¿è¯æ¯æ¬¡ç»™åŒä¸€ä¸ªå®¢æˆ·æœåŠ¡çš„éƒ½æ˜¯åŒä¸€å°æœåŠ¡å™¨å—ï¼Ÿé‚£ç°åœ¨æŠŠCé‡æ–°åˆ†é…ç»™Node Dæ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ æˆ‘ä»¬åªèƒ½å°½å¯èƒ½åœ°ä¿è¯æ¯æ¬¡ç»™åŒä¸€ä¸ªå®¢æˆ·æœåŠ¡çš„éƒ½æ˜¯åŒä¸€å°æœåŠ¡å™¨ï¼Œä½†æ˜¯Node Cå®•æœºäº†ä¹Ÿæ²¡åŠæ³•å•ŠğŸ˜‚è€Œä¸”å½±å“åˆ°çš„åªæœ‰ä¹‹å‰åˆ†é…ç»™Node Cçš„å®¢æˆ·æœºï¼Œå¯¹äºAã€Bã€Déƒ½æ²¡æœ‰å½±å“åˆ°ã€‚ å¦‚æœåœ¨ç¯å¢ƒä¸­æ–°å¢ä¸€å°æœåŠ¡å™¨Node Xï¼Œé€šè¿‡hashç®—æ³•å°†Node Xæ˜ å°„åˆ°ç¯ä¸­ï¼Œé€šè¿‡æŒ‰é¡ºæ—¶é’ˆè¿ç§»çš„è§„åˆ™ï¼Œé‚£ä¹ˆObject Cè¢«è¿ç§»åˆ°äº†Node Xä¸­ï¼Œå…¶å®ƒå¯¹è±¡è¿˜ä¿æŒè¿™åŸæœ‰çš„å­˜å‚¨ä½ç½®ã€‚ 2.5 è™šæ‹ŸèŠ‚ç‚¹å‰é¢éƒ¨åˆ†è®²è¿°åˆ°çš„éƒ½æ˜¯èŠ‚ç‚¹è¾ƒå¤šå’ŒèŠ‚ç‚¹åˆ†å¸ƒè¾ƒä¸ºå‡è¡¡çš„æƒ…å†µï¼Œå½“æœåŠ¡å™¨èŠ‚ç‚¹æ¯”è¾ƒå°‘çš„æ—¶å€™ï¼Œä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ­¤æ—¶å¿…ç„¶é€ æˆå¤§é‡æ•°æ®é›†ä¸­åˆ°ä¸€ä¸ªèŠ‚ç‚¹ä¸Šé¢ï¼Œæå°‘æ•°æ•°æ®é›†ä¸­åˆ°å¦å¤–çš„èŠ‚ç‚¹ä¸Šé¢ã€‚ ä¸ºäº†è§£å†³è¿™ç§æ•°æ®å€¾æ–œé—®é¢˜ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å¼•å…¥äº†è™šæ‹ŸèŠ‚ç‚¹æœºåˆ¶ï¼Œå³å¯¹æ¯ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹è®¡ç®—å¤šä¸ªå“ˆå¸Œï¼Œæ¯ä¸ªè®¡ç®—ç»“æœä½ç½®éƒ½æ”¾ç½®ä¸€ä¸ªæ­¤æœåŠ¡èŠ‚ç‚¹ï¼Œç§°ä¸ºè™šæ‹ŸèŠ‚ç‚¹ã€‚å…·ä½“åšæ³•å¯ä»¥å…ˆç¡®å®šæ¯ä¸ªç‰©ç†èŠ‚ç‚¹å…³è”çš„è™šæ‹ŸèŠ‚ç‚¹æ•°é‡ï¼Œç„¶ååœ¨ipæˆ–è€…ä¸»æœºååé¢å¢åŠ ç¼–å·ã€‚ä¾‹å¦‚ä¸Šé¢çš„æƒ…å†µï¼Œå¯ä»¥ä¸ºæ¯å°æœåŠ¡å™¨è®¡ç®—ä¸‰ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œäºæ˜¯å¯ä»¥åˆ†åˆ«è®¡ç®— â€œNode A#1â€ã€â€œNode A#2â€ã€â€œNode A#3â€ã€â€œNode B#1â€ã€â€œNode B#2â€ã€â€œNode B#3â€çš„å“ˆå¸Œå€¼ï¼Œäºæ˜¯å½¢æˆå…­ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼š åŒæ—¶æ•°æ®å®šä½ç®—æ³•ä¸å˜ï¼Œåªæ˜¯å¤šäº†ä¸€æ­¥è™šæ‹ŸèŠ‚ç‚¹åˆ°å®é™…èŠ‚ç‚¹çš„æ˜ å°„ï¼Œä¾‹å¦‚å®šä½åˆ°â€œNode A#1â€ã€â€œNode A#2â€ã€â€œNode A#3â€ä¸‰ä¸ªè™šæ‹ŸèŠ‚ç‚¹çš„æ•°æ®å‡å®šä½åˆ°Node Aä¸Šã€‚è¿™æ ·å°±è§£å†³äº†æœåŠ¡èŠ‚ç‚¹å°‘æ—¶æ•°æ®å€¾æ–œçš„é—®é¢˜ã€‚æ¯ä¸ªç‰©ç†èŠ‚ç‚¹å…³è”çš„è™šæ‹ŸèŠ‚ç‚¹æ•°é‡å°±æ ¹æ®å…·ä½“çš„ç”Ÿäº§ç¯å¢ƒæƒ…å†µåœ¨ç¡®å®šã€‚","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"https://www.codetool.top/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"}]},{"title":"æµ·é‡æ•°æ®-ä¸¤ç§æ–¹æ³•è§£å†³top ké—®é¢˜","slug":"æµ·é‡æ•°æ®-ä¸¤ç§æ–¹æ³•è§£å†³top ké—®é¢˜","date":"2020-04-04T11:55:19.000Z","updated":"2020-04-04T14:33:09.376Z","comments":true,"path":"article/æµ·é‡æ•°æ®-ä¸¤ç§æ–¹æ³•è§£å†³top ké—®é¢˜/","link":"","permalink":"https://www.codetool.top/article/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE-%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95%E8%A7%A3%E5%86%B3top%20k%E9%97%AE%E9%A2%98/","excerpt":"","text":"å‡å¦‚æä¾›ä¸€ç™¾ä¸‡ä¸ªæ•°æ®ï¼ˆç”šè‡³æ›´å¤§ï¼‰çš„æ— åºæ•°ç»„ï¼Œå¦‚ä½•ä»ä¸­è·å–æœ€å¤§çš„kä¸ªå…ƒç´ ï¼Ÿ æœ€å®¹æ˜“æƒ³åˆ°çš„æ˜¯å…ˆé™åºæ’åºç„¶åè·å–å‰kä¸ªå…ƒç´ ï¼Œé‚£å‡è®¾æˆ‘ä»¬ç”¨æœ€å¸¸ç”¨çš„O(nlogn)çº§åˆ«çš„æ’åºç®—æ³•ï¼Œè¦è·å–top kï¼Œæ—¶é—´æˆæœ¬ä¹Ÿå°±æ˜¯æ’åºæˆæœ¬äº†ï¼Œä¸ºO(nlogn)ï¼Œè€Œè¿™é‡Œçš„næ˜¯ç™¾ä¸‡çº§åˆ«çš„ï¼Œé‚£èƒ½ä¸èƒ½æ›´å¿«ä¸€ç‚¹å‘¢ï¼Ÿ 1 æœ€å°å †å‡è®¾æˆ‘ä»¬è®¾å®šä¸€ä¸ªæœ€å°å †ï¼Œå¹¶å›ºå®šè¿™ä¸ªæœ€å°å †çš„æœ€å¤§å¤§å°ä¸ºkï¼Œé‚£ä¹ˆä»»ä½•ä¸€æ—¶åˆ»å †é¡¶å…ƒç´ éƒ½æ˜¯è¿™ä¸ªå †ä¸­çš„ç¬¬kå¤§çš„æ•°æ®ï¼ˆä¹Ÿæ˜¯æœ€å°çš„æ•°æ®ï¼‰ã€‚æ¥ä¸€ä¸ªæ•°æ®å°±å’Œå †é¡¶å…ƒç´ æ¯”è¾ƒï¼Œå¦‚æœæ¯”å †é¡¶å…ƒç´ å¤§å°±æ›¿æ¢å †é¡¶å…ƒç´ ï¼Œå¹¶å †åŒ–ã€‚æœ€åå½“æ‰€æœ‰æ•°æ®éƒ½èµ°ä¸€éåï¼Œå †å†…çš„å…ƒç´ å°±æ˜¯æ‰€æœ‰æ•°æ®ä¸­æœ€å¤§çš„kä¸ªå…ƒç´ ï¼Œè€Œå †é¡¶å…ƒç´ å°±æ˜¯ç¬¬kå¤§çš„å…ƒç´ ã€‚ é‚£ä¹ˆæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹å®ƒåœ¨æ—¶é—´å¤æ‚åº¦ä¸Šä¼˜åŒ–äº†å¤šå°‘å§ã€‚é¦–å…ˆæ‰€æœ‰æ•°æ®éƒ½è¦èµ°ä¸€éæ¯”è¾ƒï¼Œå°±æ˜¯nï¼Œå…¶æ¬¡ç»´æŠ¤äº†ä¸€ä¸ªå¤§å°ä¸ºkçš„å †ï¼Œä¹Ÿå°±æ˜¯è¯´å †åŒ–çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(log k)ï¼Œé‚£ä¹ˆæ€»çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(nlogk) ï¼Œä¹ä¸€çœ‹å’Œå…ˆæ’åºçš„æ—¶é—´å¤æ‚åº¦O(nlogn)ä¹Ÿæ²¡å·®å¤šå°‘ï¼Œç”šè‡³è¯´æ˜¯ä¸€ä¸ªè¡¡é‡çº§åˆ«çš„ï¼Œä½†æ¯•ç«Ÿè¿™é‡Œè¯´çš„æ˜¯æµ·é‡æ•°æ®ï¼Œnå¯èƒ½å¾ˆå¤§ï¼Œkå¯èƒ½æ¯”è¾ƒå°ï¼Œé‚£ä¹ˆæ—¶é—´ä¸Šå°±å¿«å¾ˆå¤šäº†ã€‚ å®ƒçš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ç©ºé—´å¤æ‚åº¦ä¹Ÿä»…ä¸ºO(k)ï¼Œä¸éœ€è¦é¢å¤–ç»´æŠ¤ä¸€ä¸ªO(n)çº§åˆ«çš„æµ·é‡æ•°æ®å­˜å‚¨ã€‚ ä»£ç å®ç°ï¼š public static List&lt;Integer> topKByHeap(int[] arr, int k) { if (arr == null || arr.length == 0 || k &lt;= 0 || k > arr.length) { return new ArrayList&lt;>(); } PriorityQueue&lt;Integer> minHeap = new PriorityQueue&lt;>(); for (int i = 0; i &lt; k; i++) { minHeap.add(arr[i]); } for (int i = k; i &lt; arr.length; i++) { if (arr[i] > minHeap.peek()) { minHeap.poll(); minHeap.add(arr[i]); } } return new ArrayList&lt;>(minHeap); } 2 å¿«æ’æ€æƒ³ O(nlogk)å¥½åƒè¿˜æ˜¯æœ‰ç‚¹ä¸å¤Ÿçœ‹ï¼Œèƒ½ä¸èƒ½ç›´æ¥ä¼˜åŒ–æˆO(n)å‘¢ï¼Ÿ æˆ‘ä»¬çŸ¥é“å¿«æ’çš„æ€æƒ³æ˜¯æ¯æ¬¡éšæœºé€‰å–ä¸€ä¸ªpivotæŠŠæ•°ç»„åˆ’åˆ†æˆç›¸å¯¹æœ‰åºçš„ä¸¤éƒ¨åˆ†ï¼Œé‚£å‡è®¾ç¬¬ä¸€æ¬¡éšæœºé€‰å–pivotå¹¶åˆ†åŒºä¹‹åï¼Œåé¢è¿™éƒ¨åˆ†çš„å…ƒç´ æ•°é‡å°±æ­£å¥½ä¸ºkï¼Œä¸å°±è¯´æ˜åé¢è¿™éƒ¨åˆ†æ•°æ®å°±æ˜¯æœ€å¤§çš„kä¸ªå…ƒç´ ï¼Œé‚£æœ€å¥½æ—¶é—´å¤æ‚åº¦å²‚ä¸æ˜¯O(logn)ï¼Ÿ é‚£ä¹ˆé—®é¢˜å°±æˆä¸ºäº†é€‰ä¸­ä¸€ä¸ªpivotï¼Œå°†æ•°ç»„åˆ†ä¸ºå‰åä¸¤éƒ¨åˆ†ï¼Œåé¢éƒ¨åˆ†å…ƒç´ çš„æ•°é‡ä¸ºkçš„é—®é¢˜ã€‚ è™½ç„¶å¾ˆéš¾ä¸€æ¬¡å°±ä¸­ï¼Œä½†æˆ‘ä»¬åœ¨ä¸€æ¬¡åˆ†åŒºåï¼Œé€šè¿‡æ¯”è¾ƒkå’Œåé¢éƒ¨åˆ†å…ƒç´ çš„æ•°é‡å°±çŸ¥é“äº†ï¼Œåé¢éƒ¨åˆ†çš„å…ƒç´ æ˜¯åˆ†å¤šäº†è¿˜æ˜¯åˆ†å°‘äº†ã€‚ å¦‚æœåé¢çš„å…ƒç´ æ•°é‡åˆ†å¤šäº†ï¼Œå°±ç»§ç»­åœ¨åé¢è¿™éƒ¨åˆ†æ•°æ®ä¸­éšæœºé€‰å–pivotï¼Œé‡å¤æ­¥éª¤ã€‚å¦‚æœåé¢çš„å…ƒç´ åˆ†å°‘äº†ï¼Œåˆ™å¾€å‰é€‰å–pivotï¼Œå°±å½¢æˆäº†ä¸€ç§ç±»ä¼¼äºŒåˆ†æŸ¥æ‰¾çš„æ­¥éª¤ã€‚ é‚£ä¹ˆæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹å®ƒçš„æ—¶é—´å¤æ‚åº¦ï¼Œæˆ‘ä»¬çŸ¥é“å¿«é€Ÿæ’åºæ¯æ¬¡åˆ†åŒºçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯log(n)ï¼Œé‚£ä¹ˆæˆ‘ä»¬å‡è®¾æ¯æ¬¡åˆ†åŒºå‰åä¸¤éƒ¨åˆ†çš„æ•°é‡ç›¸è¿‘ï¼Œé‚£ä¹ˆæ—¶é—´å¤æ‚åº¦å°±æ˜¯log(n)+log(n/2)+log(n/4)+...ï¼Œå–æé™ä¸ºlog(2n)ï¼Œå³log(n)çº§åˆ«ï¼Œæ˜¯ä¸æ˜¯æ¯”ä¸€å¼€å§‹çš„log(nlogn)å¿«å¾ˆå¤šï¼Ÿç‰¹åˆ«æ˜¯åœ¨æµ·é‡æ•°æ®çš„æƒ…å†µä¸‹ã€‚ ä»£ç å®ç°ï¼š public static List&lt;Integer> topK(int[] arr, int k) { if (arr == null || arr.length == 0 || k &lt;= 0 || k > arr.length) { return new ArrayList&lt;>(); } // å¦‚æœæ˜¯ BottomK çš„è¯å°±ä¸éœ€è¦å•ç‹¬å¤„ç† k==n æƒ…å†µäº†ï¼Œå› ä¸ºåˆ’åˆ†æ˜¯å°äºç­‰äºæ”¾åœ¨å·¦ // topK çš„è¯å¦‚æœæ˜¯å°†å¤§äºçš„ k ä¸ªæ”¾åœ¨å³è¾¹ï¼Œé‚£ä¹ˆ pivot å°±å˜æˆäº†-1ï¼Œä¼šå½¢æˆæ­»å¾ªç¯ã€‚ if (k == arr.length) { return IntStream.of(arr).boxed().collect(Collectors.toList()); } int low = 0; int high = arr.length - 1; int index = QuickSort.partition(arr, low, high); while (index != arr.length - k - 1) { if (index > arr.length - k - 1) { index = QuickSort.partition(arr, low, index - 1); } else { index = QuickSort.partition(arr, index + 1, high); } } List&lt;Integer> list = new ArrayList&lt;>(k); for (int i = index + 1; i &lt; arr.length; i++) { list.add(arr[i]); } System.out.println(Arrays.toString(arr)); return list; } è¿™é‡Œçš„Quicksortå¾—è‡ªå·±å®ç°äº†ï¼Œè¿™é‡Œä¸ä½œä¸ºé‡ç‚¹ï¼Œå¯ä»¥å‚è€ƒåå¤§æ’åºç®—æ³•ä¸Javaå®ç° 3 å¦‚æœæ˜¯æ‰¾ç¬¬Kå¤§çš„å…ƒç´ å‘¢ï¼Ÿä½œä¸ºæ‹“å±•ï¼Œè®¨è®ºä¸€ä¸‹å¦‚æœè¦æ‰¾ç¬¬Kå¤§çš„æ•°æ®ï¼Œä»ç„¶å¯ä»¥ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ï¼š å¯¹äºæœ€å°å †åˆ™æ˜¯æ“ä½œä¸€éä¹‹åç›´æ¥å–å †é¡¶å…ƒç´ ã€‚ å¯¹äºå¿«æ’æ€æƒ³ï¼Œåˆ™æ˜¯æ‰¾ä¸€ä¸ªpivotï¼Œä½¿å¾—åˆ†åŒºä¹‹åå®ƒæ­£å¥½å¤„äºç¬¬arr.length-k+1çš„ä½ç½®ä¸Šã€‚","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"æµ·é‡æ•°æ®","slug":"æµ·é‡æ•°æ®","permalink":"https://www.codetool.top/tags/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE/"}]},{"title":"å‰‘æŒ‡offer04-äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾","slug":"å‰‘æŒ‡offer04-äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾","date":"2020-04-04T06:53:21.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/å‰‘æŒ‡offer04-äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾/","link":"","permalink":"https://www.codetool.top/article/%E5%89%91%E6%8C%87offer04-%E4%BA%8C%E7%BB%B4%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E6%9F%A5%E6%89%BE/","excerpt":"","text":"1 åŸé¢˜ï¼ˆæ¥æºLeetcodeï¼‰åœ¨ä¸€ä¸ª n * m çš„äºŒç»´æ•°ç»„ä¸­ï¼Œæ¯ä¸€è¡Œéƒ½æŒ‰ç…§ä»å·¦åˆ°å³é€’å¢çš„é¡ºåºæ’åºï¼Œæ¯ä¸€åˆ—éƒ½æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹é€’å¢çš„é¡ºåºæ’åºã€‚è¯·å®Œæˆä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥è¿™æ ·çš„ä¸€ä¸ªäºŒç»´æ•°ç»„å’Œä¸€ä¸ªæ•´æ•°ï¼Œåˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å«æœ‰è¯¥æ•´æ•°ã€‚ ç¤ºä¾‹: ç°æœ‰çŸ©é˜µ matrix å¦‚ä¸‹ï¼š [&nbsp;&nbsp;[1,&nbsp;&nbsp;&nbsp;4,&nbsp;&nbsp;7,&nbsp;11,&nbsp;15],&nbsp;&nbsp;[2,&nbsp;&nbsp;&nbsp;5,&nbsp;&nbsp;8,&nbsp;12,&nbsp;19],&nbsp;&nbsp;[3,&nbsp;&nbsp;&nbsp;6,&nbsp;&nbsp;9,&nbsp;16,&nbsp;22],&nbsp;&nbsp;[10,&nbsp;13,&nbsp;14,&nbsp;17,&nbsp;24],&nbsp;&nbsp;[18,&nbsp;21,&nbsp;23,&nbsp;26,&nbsp;30]] ç»™å®š target = 5ï¼Œè¿”å› trueã€‚ ç»™å®š target = 20ï¼Œè¿”å› falseã€‚ é™åˆ¶ï¼š 0 &lt;= n &lt;= 1000 0 &lt;= m &lt;= 1000 æ³¨æ„ï¼š æœ¬é¢˜ä¸ä¸»ç«™ 240 é¢˜ç›¸åŒï¼šhttps://leetcode-cn.com/problems/search-a-2d-matrix-ii/ 2 è§£æ³•2.1 æ€æƒ³æˆ‘ç”¨çš„dfs..æ€è·¯æ¯”è¾ƒæ¸…æ™°ç‚¹ã€‚ï¼ˆä¸æ¨èï¼‰ å®˜æ–¹ç»™çš„é¢˜è§£æ€æƒ³ï¼ˆå‡è€Œæ²»ä¹‹ï¼Œæ ‡è¯†æ•°æ³•ï¼‰éå¸¸å·§å¦™ï¼šå¯ä»¥ä»å³ä¸Šè§’æˆ–å·¦ä¸‹è§’å¼€å§‹çº¿æ€§æœç´¢ï¼Œå› ä¸ºå³ä¸Šè§’çš„å…ƒç´ ä¸ºåˆ—å¼€å§‹çš„æœ€å¤§å€¼ï¼Œè€Œå·¦ä¸‹è§’çš„å…ƒç´ ä¸ºè¡Œå¼€å§‹çš„æœ€å¤§å€¼ã€‚ä¸€æ—¦è¿™ä¸ªæ•°æ¯”è¦æŸ¥æ‰¾çš„æ•°å¤§ï¼Œå°±å¯ä»¥æ’é™¤è¿™ä¸€è¡Œ/è¿™ä¸€åˆ—ã€‚ 2.2 ä»£ç dfsï¼š class Solution { int[][] matrixGlo; Boolean[][] dfs; public boolean findNumberIn2DArray(int[][] matrix, int target) { if(matrix.length==0) return false; dfs = new Boolean[matrix.length][matrix[0].length]; matrixGlo = matrix; return dfs(0,0,target); } public boolean dfs(int x,int y,int target){ if(x>=matrixGlo.length||y>=matrixGlo[0].length) return false; if(dfs[x][y]!=null) return dfs[x][y]; if(matrixGlo[x][y]>target) return false; if(matrixGlo[x][y]==target) return true; boolean result = dfs(x+1,y,target)||dfs(x,y+1,target); dfs[x][y] = result; return result; } } æ ‡è¯†æ•°æ³•:ï¼ˆä½œè€…ï¼šliweiwei1419ï¼‰ public class Solution { public boolean findNumberIn2DArray(int[][] matrix, int target) { int rows = matrix.length; if (rows == 0) { return false; } int cols = matrix[0].length; if (cols == 0) { return false; } // ä»å·¦ä¸‹è§’å¼€å§‹æŸ¥æ‰¾ int x = rows - 1; int y = 0; while (x >= 0) { while (y &lt; cols &amp;&amp; matrix[x][y] &lt; target) { y++; } if (y &lt; cols &amp;&amp; matrix[x][y] == target) { return true; } x--; } return false; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"å‰‘æŒ‡offer","slug":"å‰‘æŒ‡offer","permalink":"https://www.codetool.top/tags/%E5%89%91%E6%8C%87offer/"}]},{"title":"æ“ä½œç³»ç»Ÿå¤ä¹ 01æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿå¤ä¹ 01æ“ä½œç³»ç»Ÿ","date":"2020-04-03T14:32:21.000Z","updated":"2020-04-16T11:41:16.549Z","comments":true,"path":"article/æ“ä½œç³»ç»Ÿå¤ä¹ 01æ“ä½œç³»ç»Ÿ/","link":"","permalink":"https://www.codetool.top/article/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A001%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/","excerpt":"","text":"1 ç°ä»£è®¡ç®—æœºç³»ç»Ÿ 1.1 è½¯ä»¶åˆ†å±‚åº”ç”¨è½¯ä»¶ã€æ”¯æ’‘è½¯ä»¶ã€ç³»ç»Ÿè½¯ä»¶ 1.2 æ“ä½œç³»ç»Ÿçš„å®šä¹‰ç®¡ç†ç³»ç»Ÿèµ„æºã€æ§åˆ¶ç¨‹åºæ‰§è¡Œã€æ”¹å–„äººæœºç•Œé¢ã€æä¾›å„ç§æœåŠ¡ï¼Œå¹¶åˆç†ç»„ç»‡è®¡ç®—æœºå·¥ä½œæµç¨‹å’Œä¸ºç”¨æˆ·æ–¹ä¾¿æœ‰æ•ˆåœ°ä½¿ç”¨è®¡ç®—æœºæä¾›è‰¯å¥½è¿è¡Œç¯å¢ƒçš„ä¸€ç§ç³»ç»Ÿè½¯ä»¶ã€‚ æ“ä½œç³»ç»Ÿæ˜¯æœ€é è¿‘ç¡¬ä»¶çš„ä¸€å±‚è½¯ä»¶ï¼Œå®ƒæŠŠç¡¬ä»¶è£¸æœºæ”¹é€ æˆä¸ºå®Œå–„çš„è™šæ‹Ÿæœºï¼Œä½¿å¾—æœºå™¨åŠŸèƒ½å¾—åˆ°æ‰©å±•ï¼Œè¿è¡Œç¯å¢ƒå¾—åˆ°æ”¹å–„ï¼Œç³»ç»Ÿæ•ˆç‡å¾—åˆ°æé«˜ï¼Œå®‰å…¨æ€§èƒ½å¾—åˆ°ä¿è¯ã€‚ æ“ä½œç³»ç»Ÿéš”ç¦»å…¶ä»–ä¸Šå±‚è½¯ä»¶ï¼Œå¹¶ä¸ºå®ƒä»¬æä¾›æ¥å£å’ŒæœåŠ¡ï¼Œä½¿å¾—ä¸Šå±‚è½¯ä»¶å¯ä»¥è·å¾—è¿œè¾ƒç¡¬ä»¶æ‰€èƒ½æä¾›çš„æ›´å¤šæ›´å¼ºçš„åŠŸèƒ½ä¸Šçš„æ”¯æŒã€‚æ“ä½œç³»ç»Ÿæ˜¯è½¯ä»¶ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œå®ƒä¸ç¡¬ä»¶ä¸€èµ·æ„æˆäº†å„ç§è½¯ä»¶çš„åŸºç¡€è¿è¡Œå¹³å°ã€‚ 1.3 æ“ä½œç³»ç»Ÿçš„ä¸»è¦ç›®æ ‡ æ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ æ‰©å¤§æœºå™¨åŠŸèƒ½ ç®¡ç†ç³»ç»Ÿèµ„æº æé«˜ç³»ç»Ÿæ•ˆç‡ æ„ç­‘å¼€æ”¾ç¯å¢ƒ 1.4 è§‚å¯Ÿå’Œç ”ç©¶æ“ä½œç³»ç»Ÿ4ç§è§‚ç‚¹ æœåŠ¡ç”¨æˆ·è§‚ç‚¹ï¼šæ“ä½œç³»ç»Ÿä½œä¸ºç”¨æˆ·æ¥å£å’Œå…¬å…±æœåŠ¡ç¨‹åº è¿›ç¨‹äº¤äº’è§‚ç‚¹ï¼šæ“ä½œç³»ç»Ÿä½œä¸ºè¿›ç¨‹æ‰§è¡Œçš„æ§åˆ¶è€…å’Œåè°ƒè€… ç³»ç»Ÿå®ç°è§‚ç‚¹ï¼šæ“ä½œç³»ç»Ÿä½œä¸ºæ‰©å±•æœºæˆ–è™šæ‹Ÿæœº èµ„æºç®¡ç†è§‚ç‚¹ï¼šæ“ä½œç³»ç»Ÿä½œä¸ºèµ„æºçš„ç®¡ç†è€…å’Œæ§åˆ¶è€… 1.5 æ“ä½œç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½ å¤„ç†æœºç®¡ç† å­˜å‚¨ç®¡ç† è®¾å¤‡ç®¡ç† æ–‡ä»¶ç®¡ç† ç½‘ç»œä¸é€šä¿¡ç®¡ç† å¯¹äºlinuxï¼Œå…¶å†…æ ¸å°±å¯åˆ†ä¸ºè¿›ç¨‹ç®¡ç†å­ç³»ç»Ÿã€å†…å­˜ç®¡ç†å­ç³»ç»Ÿã€æ–‡ä»¶å­ç³»ç»Ÿã€ç½‘ç»œå­ç³»ç»Ÿã€è®¾å¤‡å­ç³»ç»Ÿã€‚ è¿™äº›åŠŸèƒ½åé¢æˆ‘ä»¬ä¼šåˆ†å‡ ä¸ªç« èŠ‚å»ä»‹ç»ã€‚ 1.6 æ“ä½œç³»ç»Ÿçš„ä¸»è¦ç‰¹æ€§ å¹¶å‘æ€§ï¼šä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„äº‹ä»¶æˆ–æ´»åŠ¨åœ¨åŒä¸€æ—¶é—´é—´éš”å†…å‘ç”Ÿã€‚ å…±äº«æ€§ï¼šæ“ä½œç³»ç»Ÿä¸­çš„èµ„æºå¯è¢«å¤šä¸ªå¹¶å‘æ‰§è¡Œçš„è¿›ç¨‹æ‰€ä½¿ç”¨ å¼‚æ­¥æ€§ 2 èµ„æºç®¡ç†æŠ€æœ¯ 2.1 èµ„æºå¤ç”¨èµ„æºå¤ç”¨è§£å†³ç‰©ç†èµ„æºæ•°é‡ä¸è¶³ï¼Œåˆ†ä¸ºï¼š ç©ºåˆ†å¤ç”¨å…±äº«ï¼šè¯¥èµ„æºå¯è¿›ä¸€æ­¥åˆ†å‰²æˆæ›´å¤šå’Œæ›´å°çš„å•ä½ä¾›è¿›ç¨‹ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼šè¿›ç¨‹ç©ºåˆ†å¤ç”¨å†…å­˜èµ„æºï¼Œå…¶æ˜ è±¡è£…å…¥ä¸åŒå†…å­˜åŒºåŸŸï¼Œå„æœ‰è‡ªå·±çš„åœ°å€ç©ºé—´ä¸”é€šè¿‡ç¡¬ä»¶å­˜å‚¨ä¿æŠ¤æœºåˆ¶éš”ç¦»ã€‚ æ—¶åˆ†å¤ç”¨å…±äº«ï¼šå¹¶ä¸æŠŠèµ„æºè¿›ä¸€æ­¥åˆ†å‰²æˆæ›´å°çš„å•ä½ï¼Œè¿›ç¨‹å¯åœ¨ä¸€ä¸ªæ—¶é—´æ®µå†…ç‹¬å ä½¿ç”¨æ•´ä¸ªç‰©ç†èµ„æºã€‚ åˆåˆ†ä¸ºï¼š æ—¶åˆ†ç‹¬å å¼ï¼šè¿›ç¨‹è·å¾—æ—¶åˆ†ç‹¬å å¼èµ„æºåï¼Œå¯¹èµ„æºæ‰§è¡Œå¤šä¸ªæ“ä½œï¼Œé€šå¸¸ä½¿ç”¨ä¸€ä¸ªå®Œæ•´çš„å‘¨æœŸåæ‰ä¼šé‡Šæ”¾(å¦‚ç£å¸¦)ã€‚ æ—¶åˆ†å…±äº«å¼ï¼šæ—¶åˆ†å…±äº«å¼èµ„æºæŒ‡è¿›ç¨‹å ç”¨è¯¥ç±»èµ„æºä½¿ç”¨åï¼Œå¾ˆå¯èƒ½éšæ—¶è¢«å‰¥å¤ºï¼Œè¢«å¦ä¸€ä¸ªè¿›ç¨‹æŠ¡å ä½¿ç”¨(å¦‚å¤„ç†å™¨ã€ç£ç›˜æœº)ã€‚ 2.2 èµ„æºè™šæ‹Ÿèµ„æºè™šæ‹Ÿè§£å†³ç‰©ç†èµ„æºæ•°é‡ä¸è¶³ï¼Œæé«˜æœåŠ¡çš„èƒ½åŠ›å’Œæ°´å¹³ã€‚æ˜¯å¯¹èµ„æºè¿›è¡Œè½¬åŒ–ã€æ¨¡æ‹Ÿæˆ–æ•´åˆï¼ŒæŠŠç‰©ç†ä¸Šçš„ä¸€ä¸ªèµ„æºå˜æˆé€»è¾‘ä¸Šçš„å¤šä¸ªå¯¹åº”èµ„æº(æˆ–ç‰©ç†ä¸Šå¤šä¸ªèµ„æºå˜æˆé€»è¾‘ä¸Šä¸€ä¸ªå¯¹åº”èµ„æº)çš„ä¸€ç±»æŠ€æœ¯ã€‚ å’Œç©ºåˆ†å¤ç”¨çš„åŒºåˆ«ï¼šç©ºåˆ†å¤ç”¨åˆ†å‰²å®é™…å­˜åœ¨çš„ç‰©ç†èµ„æºï¼Œè™šæ‹Ÿå®ç°è™šæ„å‡æƒ³çš„è™šæ‹ŸåŒç±»èµ„æºã€‚ èµ„æºè™šæ‹Ÿçš„ä¾‹å­ï¼šè™šæ‹Ÿè®¾å¤‡ã€è™šæ‹Ÿå†…å­˜ã€è™šæ‹Ÿæ–‡ä»¶ã€è™šæ‹Ÿå±å¹•(ç»ˆç«¯)ã€è™šæ‹Ÿä¿¡é“ã€‚ è™šæ‹ŸæŠ€æœ¯å¯ç”¨äºå¤–éƒ¨è®¾å¤‡â€”â€”è™šæ‹Ÿè®¾å¤‡ã€‚ SPOOLingï¼Œå°†ç‰©ç†ä¸Šçš„ä¸€å°ç‹¬å è®¾å¤‡è½¬åŒ–æˆé€»è¾‘ä¸Šçš„å¤šå°è™šæ‹Ÿç‹¬å è®¾å¤‡ã€‚ 2.3 èµ„æºæŠ½è±¡èµ„æºæŠ½è±¡å¤„ç†ç³»ç»Ÿçš„å¤æ‚æ€§ï¼Œè§£å†³èµ„æºçš„æ˜“ç”¨æ€§ï¼Œé€šè¿‡åˆ›å»ºè½¯ä»¶æ¥å±è”½ç¡¬ä»¶èµ„æºç‰©ç†ç‰¹æ€§å’Œæ¥å£ç»†èŠ‚ï¼Œç®€åŒ–å¯¹ç¡¬ä»¶èµ„æºçš„æ“ä½œã€æ§åˆ¶å’Œä½¿ç”¨çš„ä¸€ç±»æŠ€æœ¯ã€‚ ä¾‹å¦‚å°†è®¾å¤‡æ“ä½œæœºå™¨æŒ‡ä»¤æŠ½è±¡ä¸ºè°ƒç”¨ç³»ç»ŸIOæ¥å£(éšè”½I/Oæ“ä½œå®ç°ç»†èŠ‚) æ“ä½œç³»ç»Ÿä¸­ä¸‰ä¸ªåŸºç¡€æŠ½è±¡ï¼š è¿›ç¨‹ï¼šè¿›ç¨‹æ˜¯å¯¹äºè¿›å…¥å†…å­˜çš„æ‰§è¡Œç¨‹åºåœ¨å¤„ç†å™¨ä¸Šæ“ä½œçš„çŠ¶æ€é›†çš„ä¸€ä¸ªæŠ½è±¡ã€‚è¿›ç¨‹æŠ½è±¡çš„æ•ˆæœæ˜¯è®©ç”¨æˆ·æ„Ÿè§‰åˆ°æœ‰è‡ªå·±ç‹¬äº«çš„å¤„ç†å™¨ï¼Œä»è€Œï¼Œå¯ä¸ºç”¨æˆ·æä¾›å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿå’Œåˆ†æ—¶æ“ä½œç³»ç»Ÿã€‚ è™šå­˜ï¼šè™šå­˜æ˜¯å†…å­˜çš„ä¸€ç§æŠ½è±¡ï¼Œè™šå­˜æŠ½è±¡çš„æ•ˆæœæ˜¯ç»™ç”¨æˆ·é€ æˆå‡è±¡ï¼Œæ„Ÿè§‰ç‹¬å äº†ä¸€ä¸ªè¿ç»­åœ°å€ç©ºé—´ï¼Œç¼–å†™åº”ç”¨ç¨‹åºçš„é•¿åº¦ä¸å—ç‰©ç†å†…å­˜å¤§å°é™åˆ¶ã€‚è™šå­˜æ˜¯é€šè¿‡ç»“åˆå¯¹å†…å­˜å’Œå¤–å­˜çš„ç®¡ç†æ¥å®ç°çš„ï¼ŒæŠŠä¸€ä¸ªè¿›ç¨‹çš„è™šå­˜ä¸­çš„å†…å®¹å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œç”¨å†…å­˜ä½œä¸ºç£ç›˜çš„é«˜é€Ÿç¼“å­˜ï¼Œä»¥æ­¤ä¸ºç”¨æˆ·æä¾›æ¯”ç‰©ç†å†…å­˜ç©ºé—´å¤§å¾—å¤šçš„è™šæ‹Ÿå†…å­˜ç©ºé—´ã€‚ æ–‡ä»¶ï¼šæ–‡ä»¶æ˜¯å¯¹IOè®¾å¤‡çš„ä¸€ä¸ªæŠ½è±¡ï¼Œæ–‡ä»¶æ˜¯é€šè¿‡å°†æ–‡ä»¶ä¸­çš„å­—èŠ‚æ˜ å°„åˆ°å­˜å‚¨è®¾å¤‡çš„ç‰©ç†å—ä¸­æ¥å®ç°æ–‡ä»¶æŠ½è±¡ã€‚æ–‡ä»¶æŠ½è±¡çš„æ•ˆæœæ˜¯è®©ç”¨æˆ·æ„Ÿè§‰åˆ°æ€»èƒ½æ»¡è¶³è‡ªå·±å¯¹è®¾å¤‡ä¸Šä¿¡æ¯çš„å­˜å–éœ€æ±‚ï¼Œè€Œä¸”ä½¿ç”¨ååˆ†æ–¹ä¾¿ã€‚ è¿™ä¸‰ä¸ªæŠ½è±¡ä¸ºåŒ…å«çš„å…³ç³»ã€‚ 3 å½¢æˆä¸å‘å±• 4 åŸºæœ¬æœåŠ¡å’Œç”¨æˆ·æ¥å£ 4.1 ä¸¤æ€ä¸ä¸¤ç§æŒ‡ä»¤ ç”¨æˆ·æ€ï¼ˆç›®æ€ï¼‰ï¼šæ­¤æ—¶CPUåªèƒ½æ‰§è¡Œéç‰¹æƒæŒ‡ä»¤ æ ¸å¿ƒæ€ï¼ˆç®¡æ€ï¼‰ï¼šç‰¹æƒæŒ‡ä»¤ã€éç‰¹æƒæŒ‡ä»¤éƒ½å¯æ‰§è¡Œ åº”ç”¨ç¨‹åºè¿è¡Œåœ¨ç”¨æˆ·æ€ï¼Œä¸å…è®¸ä½¿ç”¨ç‰¹æƒæŒ‡ä»¤ã€‚ 4.2 åŸºæœ¬æœåŠ¡ åˆ›å»ºç¨‹åº æ‰§è¡Œç¨‹åº æ•°æ®I/O ä¿¡æ¯å­˜å– é€šä¿¡æœåŠ¡ é”™è¯¯æ£€æµ‹å’Œå¤„ç† è¿˜å…·æœ‰å…¶ä»–åŠŸèƒ½:èµ„æºåˆ†é…,ç»Ÿè®¡,ä¿æŠ¤ã€‚ 4.3 ç”¨æˆ·æ¥å£å’Œç³»ç»Ÿè°ƒç”¨OSçš„åŠŸèƒ½é€šè¿‡ä¸€ç»„ç§°ä¸ºç³»ç»Ÿè°ƒç”¨(system call)çš„æ¥å£å‘ˆç°ç»™ç”¨æˆ·ï¼Œå†…æ ¸æä¾›ä¸€ç³»åˆ—å®ç°é¢„å®šåŠŸèƒ½çš„å†…æ ¸å‡½æ•°ï¼Œç³»ç»Ÿè°ƒç”¨æŠŠåº”ç”¨ç¨‹åºçš„è¯·æ±‚ä¼ è¾¾ç»™å†…æ ¸ï¼Œå†…æ ¸è°ƒç”¨å¯¹åº”çš„å†…æ ¸å‡½æ•°å®Œæˆè¯·æ±‚æ‰€éœ€å¤„ç†åï¼Œå†å°†å¤„ç†ç»“æœè¿”å›ç»™åº”ç”¨ç¨‹åºã€‚åº”ç”¨ç¨‹åºé€šè¿‡ç³»ç»Ÿè°ƒç”¨æ‰èƒ½è¯·æ±‚ç³»ç»ŸæœåŠ¡å’Œä½¿ç”¨ç³»ç»Ÿèµ„æºã€‚ ç³»ç»Ÿè°ƒç”¨çš„ä½œç”¨ï¼š ä½¿å†…æ ¸å¯åŸºäºæƒé™å’Œè§„åˆ™å¯¹èµ„æºè®¿é—®è¿›è¡Œè£å†³ï¼Œä¿è¯ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼› æ˜¯ç³»ç»Ÿè°ƒç”¨å°è£…èµ„æºæŠ½è±¡ï¼Œæä¾›ä¸€è‡´æ€§æ¥å£ï¼Œé¿å…ç”¨æˆ·ä½¿ç”¨èµ„æºæ—¶å¯èƒ½å‘ç”Ÿçš„é”™è¯¯ï¼Œä¸”ä½¿ç¼–ç¨‹æ–¹ä¾¿æ•ˆç‡é«˜ã€‚ POSIX(Portable Operating System Interface)æ ‡å‡†ï¼Œè§„å®šäº†çº¦100ä¸ªAPI(å³OSåº”æä¾›çš„æœåŠ¡åŠŸèƒ½) Cè¯­è¨€å¯ä»¥é€šè¿‡Linuxç³»ç»Ÿæ ‡å‡†Cåº“(glibc)è¿›è¡Œç³»ç»Ÿè°ƒç”¨ã€‚è¿™ä¸ªåº“å‡½æ•°åˆæ˜¯å¯¹ç³»ç»Ÿè°ƒç”¨çš„ä¸€å±‚å°è£…ã€‚ 4.4 ä¸­æ–­ä¸é™·é˜±æŒ‡ä»¤å†…æ ¸çš„åŠŸèƒ½åŒ…å«ä¸­æ–­å¤„ç†ï¼Œå‘ç”Ÿä¸­æ–­å°±æ„å‘³ç€éœ€è¦æ“ä½œç³»ç»Ÿä»‹å…¥ï¼Œå¼€å±•ç®¡ç†å·¥ä½œã€‚ ç”¨æˆ·æ€åˆ‡æ¢ä¸ºæ ¸å¿ƒæ€æ˜¯é€šè¿‡ä¸­æ–­å®ç°çš„ã€‚å¹¶ä¸”ä¸­æ–­æ˜¯å”¯ä¸€é€”å¾„ï¼Œç”¨æˆ·æ‰‹åŠ¨è§¦å‘ä¸­æ–­çš„æŒ‡ä»¤ç§°ä¸ºé™·é˜±æŒ‡ä»¤ï¼Œä¹Ÿç§°ä¸ºè®¿ç®¡æŒ‡ä»¤ã€‚ æ ¸å¿ƒæ€åˆ‡æ¢ä¸ºç”¨æˆ·æ€æ˜¯é€šè¿‡æ‰§è¡Œä¸€ä¸ªç‰¹æƒæŒ‡ä»¤ï¼Œå°†ç¨‹åºçŠ¶æ€å­—(PSW)çš„æ ‡å¿—ä½è®¾ç½®ä¸ºç”¨æˆ·æ€ã€‚ 5 ç»“æ„å’Œè¿è¡Œæ¨¡å‹ 5.1 å†…æ ¸å†…æ ¸æ˜¯è®¡ç®—æœºä¸Šé…ç½®çš„åº•å±‚è½¯ä»¶ï¼Œæ˜¯æ“ä½œç³»ç»Ÿæœ€åŸºæœ¬ã€æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ã€‚å®ç°æ“ä½œç³»ç»Ÿå†…æ ¸åŠŸèƒ½çš„é‚£äº›ç¨‹åºå°±æ˜¯å†…æ ¸ç¨‹åºã€‚ å†…æ ¸çš„åŠŸèƒ½ï¼šï¼ˆæœ€åŸºæœ¬çš„åŠŸèƒ½ï¼Œå¾®å†…æ ¸ï¼‰ æ—¶é’Ÿç®¡ç† ä¸­æ–­å¤„ç† çŸ­ç¨‹è°ƒåº¦ åŸè¯­ç®¡ç†ï¼ŒåŸè¯­ï¼š æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç¨‹åº å¤„äºæ“ä½œç³»ç»Ÿæœ€åº•å±‚ï¼Œæ˜¯æœ€æ¥è¿‘ç¡¬ä»¶çš„éƒ¨åˆ† è¿™ç§ç¨‹åºçš„è¿è¡Œå…·æœ‰åŸå­æ€§ å…¶è¿è¡Œåªèƒ½ä¸€æ°”å‘µæˆï¼Œä¸å¯ä¸­æ–­ è¿è¡Œæ—¶é—´è¾ƒçŸ­ã€è°ƒç”¨é¢‘ç¹ åŸè¯­é€šè¿‡å¼€ä¸­æ–­æŒ‡ä»¤å’Œå…³ä¸­æ–­æŒ‡ä»¤å®ç°ï¼Œæ‰§è¡ŒåŸè¯­æœŸé—´ä¸å¯è¢«ä¸­æ–­ã€‚ å¦‚æœåŒ…å«æ“ä½œç³»ç»Ÿçš„åŠŸèƒ½å¦‚è¿›ç¨‹ç®¡ç†ã€‚","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://www.codetool.top/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"}]},{"title":"leetcode8-å­—ç¬¦ä¸²è½¬æ¢æ•´æ•° (atoi)","slug":"leetcode8-å­—ç¬¦ä¸²è½¬æ¢æ•´æ•°atoi","date":"2020-04-03T03:30:46.000Z","updated":"2020-04-25T04:21:38.458Z","comments":true,"path":"article/leetcode8-å­—ç¬¦ä¸²è½¬æ¢æ•´æ•°atoi/","link":"","permalink":"https://www.codetool.top/article/leetcode8-%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%8D%A2%E6%95%B4%E6%95%B0atoi/","excerpt":"","text":"1 åŸé¢˜è¯·ä½ æ¥å®ç°ä¸€ä¸ª atoi å‡½æ•°ï¼Œä½¿å…¶èƒ½å°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•°ã€‚ é¦–å…ˆï¼Œè¯¥å‡½æ•°ä¼šæ ¹æ®éœ€è¦ä¸¢å¼ƒæ— ç”¨çš„å¼€å¤´ç©ºæ ¼å­—ç¬¦ï¼Œç›´åˆ°å¯»æ‰¾åˆ°ç¬¬ä¸€ä¸ªéç©ºæ ¼çš„å­—ç¬¦ä¸ºæ­¢ã€‚æ¥ä¸‹æ¥çš„è½¬åŒ–è§„åˆ™å¦‚ä¸‹ï¼š å¦‚æœç¬¬ä¸€ä¸ªéç©ºå­—ç¬¦ä¸ºæ­£æˆ–è€…è´Ÿå·æ—¶ï¼Œåˆ™å°†è¯¥ç¬¦å·ä¸ä¹‹åé¢å°½å¯èƒ½å¤šçš„è¿ç»­æ•°å­—å­—ç¬¦ç»„åˆèµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªæœ‰ç¬¦å·æ•´æ•°ã€‚ å‡å¦‚ç¬¬ä¸€ä¸ªéç©ºå­—ç¬¦æ˜¯æ•°å­—ï¼Œåˆ™ç›´æ¥å°†å…¶ä¸ä¹‹åè¿ç»­çš„æ•°å­—å­—ç¬¦ç»„åˆèµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªæ•´æ•°ã€‚ è¯¥å­—ç¬¦ä¸²åœ¨æœ‰æ•ˆçš„æ•´æ•°éƒ¨åˆ†ä¹‹åä¹Ÿå¯èƒ½ä¼šå­˜åœ¨å¤šä½™çš„å­—ç¬¦ï¼Œé‚£ä¹ˆè¿™äº›å­—ç¬¦å¯ä»¥è¢«å¿½ç•¥ï¼Œå®ƒä»¬å¯¹å‡½æ•°ä¸åº”è¯¥é€ æˆå½±å“ã€‚æ³¨æ„ï¼šå‡å¦‚è¯¥å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€ä¸ªéç©ºæ ¼å­—ç¬¦ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆæ•´æ•°å­—ç¬¦ã€å­—ç¬¦ä¸²ä¸ºç©ºæˆ–å­—ç¬¦ä¸²ä»…åŒ…å«ç©ºç™½å­—ç¬¦æ—¶ï¼Œåˆ™ä½ çš„å‡½æ•°ä¸éœ€è¦è¿›è¡Œè½¬æ¢ï¼Œå³æ— æ³•è¿›è¡Œæœ‰æ•ˆè½¬æ¢ã€‚ åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œè‹¥å‡½æ•°ä¸èƒ½è¿›è¡Œæœ‰æ•ˆçš„è½¬æ¢æ—¶ï¼Œè¯·è¿”å› 0 ã€‚ æç¤ºï¼š æœ¬é¢˜ä¸­çš„ç©ºç™½å­—ç¬¦åªåŒ…æ‹¬ç©ºæ ¼å­—ç¬¦ &#39; &#39; ã€‚ å‡è®¾æˆ‘ä»¬çš„ç¯å¢ƒåªèƒ½å­˜å‚¨ 32 ä½å¤§å°çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œé‚£ä¹ˆå…¶æ•°å€¼èŒƒå›´ä¸º [âˆ’231, 231 âˆ’ 1]ã€‚å¦‚æœæ•°å€¼è¶…è¿‡è¿™ä¸ªèŒƒå›´ï¼Œè¯·è¿”å› INT_MAX (231 âˆ’ 1) æˆ– INT_MIN (âˆ’231) ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š â€œ42â€è¾“å‡ºï¼š 42 ç¤ºä¾‹2: è¾“å…¥ï¼š â€œ&nbsp;&nbsp;&nbsp;-42â€è¾“å‡ºï¼š -42è§£é‡Š: ç¬¬ä¸€ä¸ªéç©ºç™½å­—ç¬¦ä¸º â€˜-â€˜, å®ƒæ˜¯ä¸€ä¸ªè´Ÿå·ã€‚ æˆ‘ä»¬å°½å¯èƒ½å°†è´Ÿå·ä¸åé¢æ‰€æœ‰è¿ç»­å‡ºç°çš„æ•°å­—ç»„åˆèµ·æ¥ï¼Œæœ€åå¾—åˆ° -42 ã€‚ ç¤ºä¾‹3: è¾“å…¥ï¼š â€œ4193 with wordsâ€è¾“å‡ºï¼š 4193è§£é‡Š: è½¬æ¢æˆªæ­¢äºæ•°å­— â€˜3â€™ ï¼Œå› ä¸ºå®ƒçš„ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸ä¸ºæ•°å­—ã€‚ ç¤ºä¾‹4: è¾“å…¥ï¼š â€œwords and 987â€è¾“å‡ºï¼š 0è§£é‡Š: ç¬¬ä¸€ä¸ªéç©ºå­—ç¬¦æ˜¯ â€˜wâ€™, ä½†å®ƒä¸æ˜¯æ•°å­—æˆ–æ­£ã€è´Ÿå·ã€‚ å› æ­¤æ— æ³•æ‰§è¡Œæœ‰æ•ˆçš„è½¬æ¢ã€‚ ç¤ºä¾‹5: è¾“å…¥ï¼š â€œ-91283472332â€è¾“å‡ºï¼š -2147483648è§£é‡Š: æ•°å­— â€œ-91283472332â€ è¶…è¿‡ 32 ä½æœ‰ç¬¦å·æ•´æ•°èŒƒå›´ã€‚ å› æ­¤è¿”å› INT_MIN (âˆ’231) ã€‚ è¿›é˜¶ï¼š ä½ å¯ä»¥ä½¿ç”¨åŸåœ°ç®—æ³•è§£å†³æœ¬é¢˜å—ï¼Ÿè¯·æ³¨æ„ï¼Œé¢æ¿ä¸Šæ‰€æœ‰æ ¼å­éœ€è¦åŒæ—¶è¢«æ›´æ–°ï¼šä½ ä¸èƒ½å…ˆæ›´æ–°æŸäº›æ ¼å­ï¼Œç„¶åä½¿ç”¨å®ƒä»¬çš„æ›´æ–°åçš„å€¼å†æ›´æ–°å…¶ä»–æ ¼å­ã€‚ æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äºŒç»´æ•°ç»„æ¥è¡¨ç¤ºé¢æ¿ã€‚åŸåˆ™ä¸Šï¼Œé¢æ¿æ˜¯æ— é™çš„ï¼Œä½†å½“æ´»ç»†èƒä¾µå äº†é¢æ¿è¾¹ç•Œæ—¶ä¼šé€ æˆé—®é¢˜ã€‚ä½ å°†å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ï¼Ÿ 2 è§£æ³•2.1 æ€æƒ³å…¶ä»–é€»è¾‘éƒ½è¿˜ç®€å•ï¼Œå°±æ˜¯å¦‚ä½•åˆ¤æ–­æ˜¯å¦æº¢å‡ºã€‚å¯ä»¥ä½¿ç”¨è¿ç®—åçš„å€¼è¿›è¡Œé€†è¿ç®—çœ‹æ˜¯å¦èƒ½å›æ¨åˆ¤æ–­æ˜¯å¦æº¢å‡ºã€‚ 2.2 ä»£ç class Solution { public int myAtoi(String str) { char[] chars = str.trim().toCharArray(); int index = 0; int ans = 0; boolean positive = true; if(chars.length == 0) return 0; if(chars[0] =='+'||chars[0] == '-'){ index = 1; if(chars[0] == '-') positive = false; } while(index&lt;chars.length){ if(chars[index]>='0'&amp;&amp;chars[index]&lt;='9'){ int bias = chars[index] - '0'; if(!positive) bias = -bias; int cache = ans*10+bias; //åˆ¤æ–­æ˜¯å¦æº¢å‡º if(cache/10!=ans){ if(positive) return Integer.MAX_VALUE; else return Integer.MIN_VALUE; } ans = cache; index++; }else break; } return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"IEEE754æµ®ç‚¹æ•°æ ‡å‡†å’Œèˆå…¥è§„åˆ™","slug":"IEEE754æµ®ç‚¹æ•°æ ‡å‡†å’Œèˆå…¥è§„åˆ™","date":"2020-04-02T13:30:19.000Z","updated":"2020-04-02T15:15:19.473Z","comments":true,"path":"article/IEEE754æµ®ç‚¹æ•°æ ‡å‡†å’Œèˆå…¥è§„åˆ™/","link":"","permalink":"https://www.codetool.top/article/IEEE754%E6%B5%AE%E7%82%B9%E6%95%B0%E6%A0%87%E5%87%86%E5%92%8C%E8%88%8D%E5%85%A5%E8%A7%84%E5%88%99/","excerpt":"","text":"æ•´ç†ä¸€ä¸‹ä¹‹å‰çš„ç¬”è®° 1 æµ®ç‚¹æ•°ä¸å®šç‚¹æ•°1.1 å®šç‚¹æ•°å°æ•°ç‚¹åœ¨è®¡ç®—æœºä¸­é€šå¸¸æœ‰ä¸¤ç§è¡¨ç¤ºæ–¹æ³•ï¼Œä¸€ç§æ˜¯çº¦å®šæ‰€æœ‰æ•°å€¼æ•°æ®çš„å°æ•°ç‚¹éšå«åœ¨æŸä¸€ä¸ªå›ºå®šä½ç½®ä¸Šï¼Œç§°ä¸ºå®šç‚¹è¡¨ç¤ºæ³•ï¼Œç®€ç§°å®šç‚¹æ•°ã€‚ å…¶å®æ•´æ•°ä¹Ÿç®—æ˜¯ä¸€ç§ç‰¹æ®Šçš„å®šç‚¹æ•°ï¼Œåªæ˜¯å°æ•°ç‚¹é»˜è®¤å¤„äºæœ«å°¾ã€‚ å¦‚ä½•è¡¨ç¤ºä¸€ä¸ªæœ‰ç¬¦å·å®šç‚¹æ•°ï¼Ÿä¾‹å¦‚ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå…«ä½å®šç‚¹æ•°è¡¨ç¤ºæ–¹æ³•ï¼Œç¬¬ä¸€ä½ä¸ºç¬¦å·ä½ï¼Œå°æ•°ç‚¹ä½äºç¬¬ä¸‰ä½åé¢ï¼Œåˆ™å¯¹äºå°æ•°1.375ï¼Œå®šç‚¹æ•°åŸç è¡¨ç¤ºä¸º00101100ï¼Œå³å°æ•°ç‚¹å‰ååˆ†åˆ«ç”±åè¿›åˆ¶è½¬äºŒè¿›åˆ¶ï¼š+ 01.011ï¼Œè¡¥ç è¡¨ç¤ºåˆ™è¿›è¡Œå¯¹åº”çš„å¤„ç†ã€‚ å®šç‚¹æ•°çš„ç¼ºé™·æœ‰ï¼š ç”±äºå›ºå®šçš„å°æ•°ç‚¹ä½ç½®å†³å®šäº†æ•´æ•°éƒ¨åˆ†ä½æ•°å’Œå°æ•°éƒ¨åˆ†çš„ä½æ•°ï¼Œå¯¼è‡´å…¶èƒ½è¡¨ç¤ºçš„æ•°çš„èŒƒå›´åå°ã€‚ å°æ•°ç‚¹ä½ç½®éš¾ç»Ÿä¸€ï¼Œç°ä»£è®¡ç®—æœºä¸­å‡ºç°çš„å®šç‚¹æ•°å·²ç»å…¨éƒ¨è§„å®šä¸ºçº¯å°æ•°äº†ï¼Œå³é»˜è®¤æ•´æ•°éƒ¨åˆ†æ˜¯0ï¼Œå°æ•°ç‚¹ä½ç½®ä½äºç¬¦å·ä½ä¹‹åã€‚ 1.2 æµ®ç‚¹æ•°æµ®ç‚¹æ•°ä¸å®šç‚¹æ•°å¯¹åº”ï¼Œå®ƒä¸å›ºå®šå°æ•°ç‚¹ä½ç½®ï¼Œè¿™æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ å¯¹åº”çš„åŸç†å…¶å®å°±æ˜¯ï¼Œä¸€ä¸ªå°æ•°ï¼Œé€šè¿‡å°æ•°ç‚¹ç§»ä½ï¼Œæ€»èƒ½å°†å°æ•°ç‚¹ç§»åˆ°ä¸€ä¸ªç»Ÿä¸€çš„ä½ç½®ä¸Šã€‚ä¾‹å¦‚å¯¹äºåè¿›åˆ¶å°æ•°0.035 = 3.5 * 10^-2ï¼Œå¯¹äº0.000059 = 5.9 * 10^-5ã€‚ é‚£ä¹ˆäºŒè¿›åˆ¶å°æ•°ä¹Ÿæ˜¯è¿™æ ·ï¼Œä¾‹å¦‚ï¼Œ0.0101 = 1.01 * 2^-2ã€‚æµ®ç‚¹æ•°é€šè¿‡ç»Ÿä¸€å°†å°æ•°è¡¨ç¤ºæˆè¿™ç§æ–¹å¼ï¼Œåšåˆ°ä¸é™åˆ¶å°æ•°ç‚¹çš„ä½ç½®ã€‚ å…·ä½“æ¥è¯´ï¼Œæµ®ç‚¹æ•°æŠŠä¸€ä¸ªäºŒè¿›åˆ¶æ•°è¡¨ç¤ºæˆå¦‚ä¸‹å›¾ï¼š é‚£ä¹ˆæ ¹æ®Sã€Mã€Eå°±èƒ½å”¯ä¸€ç¡®å®šä¸€ä¸ªå°æ•°ã€‚è¦å°†Sã€Mã€Eè¡¨ç¤ºåˆ°ä¸€èµ·ï¼Œå°±å‡ºç°äº†IEEE754æ ‡å‡†ã€‚ IEEEäºŒè¿›åˆ¶æµ®ç‚¹æ•°ç®—æœ¯æ ‡å‡†ï¼ˆIEEE 754ï¼‰æ˜¯20ä¸–çºª80å¹´ä»£ä»¥æ¥æœ€å¹¿æ³›ä½¿ç”¨çš„æµ®ç‚¹æ•°è¿ç®—æ ‡å‡†ï¼Œä¸ºè®¸å¤šCPUä¸æµ®ç‚¹è¿ç®—å™¨æ‰€é‡‡ç”¨ã€‚è¿™ä¸ªæ ‡å‡†å®šä¹‰äº†è¡¨ç¤ºæµ®ç‚¹æ•°çš„æ ¼å¼ï¼ˆåŒ…æ‹¬è´Ÿé›¶-0ï¼‰ä¸åå¸¸å€¼ï¼ˆdenormal numberï¼‰ï¼‰ï¼Œä¸€äº›ç‰¹æ®Šæ•°å€¼ï¼ˆæ— ç©·ï¼ˆInfï¼‰ä¸éæ•°å€¼ï¼ˆNaNï¼‰ï¼‰ï¼Œä»¥åŠè¿™äº›æ•°å€¼çš„â€œæµ®ç‚¹æ•°è¿ç®—ç¬¦â€ï¼›å®ƒä¹ŸæŒ‡æ˜äº†å››ç§æ•°å€¼èˆå…¥è§„åˆ™å’Œäº”ç§ä¾‹å¤–çŠ¶å†µï¼ˆåŒ…æ‹¬ä¾‹å¤–å‘ç”Ÿçš„æ—¶æœºä¸å¤„ç†æ–¹å¼ï¼‰ã€‚ IEEE754å°†ä¸€ä¸ªäºŒè¿›åˆ¶ä¸²è¡¨ç¤ºä¸ºä¸Šå›¾æœ«å°¾çš„é‚£ä¸€æ¡ï¼Œå…¶ä¸­Så°±æ˜¯ç¬¦å·ä½ï¼Œexpå¯¹åº”çš„æ˜¯é˜¶ç Eï¼Œè€Œfracå¯¹åº”çš„æ˜¯å°¾æ•°Mã€‚ expå’Œfracåœ¨å•ç²¾åº¦æµ®ç‚¹æ•°å’ŒåŒç²¾åº¦æµ®ç‚¹æ•°ä¸­çš„é•¿åº¦å¦‚ä¸‹æ‰€ç¤ºï¼š 2 è§„æ ¼åŒ–æµ®ç‚¹æ•°é‚£ä¹ˆå¦‚ä½•ç¡®å®šexpå’Œfracï¼Ÿ é¦–å…ˆè¦äº†è§£çš„æ˜¯ï¼Œè™½ç„¶é˜¶ç Eæ˜¯æœ‰ç¬¦å·çš„ï¼Œä¾‹å¦‚ 1.01 * 2^-2ä¸­ï¼Œå°¾æ•°ä¸º1.01ï¼Œé˜¶ç ä¸º-2ï¼Œä½†IEEE754ä¸­ä¼šæŠŠexpçš„èŒƒå›´è½¬ç§»åˆ°éè´Ÿæ•°åŒºåŸŸï¼Œå³å®ƒæ˜¯ä¸€ä¸ªæ— ç¬¦å·è¡¨ç¤ºã€‚ï¼ˆä¸èƒ½å…¨ä¸º0æˆ–è€…å…¨ä¸º1ï¼Œå› ä¸ºè¢«éè§„æ ¼åŒ–æµ®ç‚¹æ•°å’Œç‰¹æ®Šå€¼å ç”¨äº†ï¼‰ è€Œå°¾æ•°fracï¼Œåˆ™æ˜¯Mçš„å°æ•°éƒ¨åˆ†ï¼Œä¾‹å¦‚1.01 * 2^-2ä¸­ï¼ŒMä¸º1.01ï¼Œfracä¸º01ã€‚ ä¸¾ä¾‹å¦‚ä½•å°†åè¿›åˆ¶æ•°è½¬æµ®ç‚¹æ•°ï¼š 3 éè§„æ ¼åŒ–æµ®ç‚¹æ•°è™½ç„¶è§„æ ¼åŒ–æµ®ç‚¹æ•°èƒ½è¡¨ç¤ºçš„èŒƒå›´å·²ç»å¾ˆç‰›Xäº†ï¼Œä½†å¯¹äºå¾ˆå°çš„æ•°è¿˜æ˜¯éš¾ä»¥è¡¨ç¤ºï¼Œæ¯”å¦‚ï¼Œå•ç²¾åº¦æ•°çš„é˜¶ç ä¸Šé™ä¸æ˜¯127å—ï¼Œå‡è®¾æˆ‘æœ‰ä¸€ä¸ªå°æ•°0.00...(çœç•¥127ä¸ª0)...111ï¼Œåœ¨å°æ•°ç‚¹åé¢è¿ç»­0çš„ä¸ªæ•°è¾¾åˆ°äº†é˜¶ç ä¸Šé™ï¼Œåˆ™é€šè¿‡å°æ•°ç‚¹ç§»ä½åï¼Œé˜¶ç ä¼šè¶…è¿‡127ï¼Œæ­¤æ—¶è§„æ ¼åŒ–æµ®ç‚¹æ•°å°±æ— æ³•è¡¨ç¤ºäº†ã€‚ æœ‰æ²¡æœ‰æ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ IEEEå®šä¹‰äº†éè§„æ ¼åŒ–æµ®ç‚¹æ•°ï¼Œæ­¤æ—¶å°±ä¸è¦æ±‚å°¾æ•°éƒ¨åˆ†ä»¥1.*å¼€å¤´äº†ï¼Œè€Œæ˜¯ç”¨0.*è¡¨ç¤ºã€‚ç„¶åé˜¶ç åŸŸå¿…é¡»æœ€å°ï¼Œå³expå…¨ä¸º0ï¼Œå› ä¸ºå°¾æ•°åŸŸçš„è§„åˆ™æ”¹äº†ï¼Œè¦å¹³æ»‘è¿‡æ¸¡åˆ°è§„æ ¼åŒ–æµ®ç‚¹æ•°ï¼Œæ­¤æ—¶E=-Bias+1ï¼Œå’Œè§„æ ¼åŒ–æµ®ç‚¹æ•°çš„è®¡ç®—æœ‰ä¸åŒã€‚ è¿™ç§æ€æƒ³å…¶å®å°±æ˜¯ç”¨ç²¾åº¦æ¢èŒƒå›´ï¼Œå› ä¸ºfracçš„é•¿åº¦æœ¬èº«æœ‰é™ï¼Œéè§„æ ¼åŒ–æµ®ç‚¹æ•°çš„å°¾æ•°éƒ¨åˆ†å‰é¢ç”¨0å¡«å……ï¼Œä½¿å¾—å°¾æ•°éƒ¨åˆ†æœ‰æ•ˆä½ä¸ªæ•°å‡å°‘ï¼Œç²¾åº¦ä¹Ÿå°±å¯¹åº”å‡å°‘ã€‚ éè§„æ ¼åŒ–æµ®ç‚¹æ•°å¯ä»¥è¡¨ç¤º0ï¼Œå¹¶ä¸”åŒºåˆ†+0å’Œ-0ï¼ˆå³ç¬¦å·ä½ä¸åŒï¼‰ã€‚ 4 ç‰¹æ®Šå€¼IEEE754è¿˜å®šä¹‰äº†æ— ç©·ã€NaNï¼Œå®ƒä»¬çš„expå…¨ä¸º1ã€‚ æœ‰æ„æ€çš„æ˜¯ï¼Œæµ®ç‚¹æ•°è¿ç®—ä¸­ï¼Œä»»ä½•æ•°é™¤ä»¥0éƒ½ä¼šç­‰äºæ— ç©·ã€‚ 5 èˆå…¥ï¼ˆRoundingï¼‰è§„åˆ™å› ä¸ºéƒ¨åˆ†å°æ•°åœ¨è®¡ç®—æœºä¸­ä¸èƒ½ç²¾ç¡®è¡¨ç¤ºæˆæµ®ç‚¹æ•°ï¼ŒIEEE754å®šä¹‰äº†å››ç§èˆå…¥è§„åˆ™ã€‚å®ƒä»¬æ˜¯ï¼š å‘å¶æ•°èˆå…¥ï¼Œä¹Ÿç§°ä¸ºå‘æœ€æ¥è¿‘çš„å€¼èˆå…¥ã€‚å®ƒå’Œå››èˆäº”å…¥ç±»ä¼¼ï¼Œä½†æ˜¯å››èˆäº”å…¥ä¼šé‡åˆ°é—®é¢˜ï¼Œæ¯”å¦‚2.5å’Œ2ã€3ä¹‹é—´çš„å·®å€¼éƒ½ä¸º0.5ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥å¾€2èˆå…¥è¿˜æ˜¯å¾€3èˆå…¥å‘¢ï¼Ÿå››èˆäº”å…¥æ˜¯å¾€3èˆå…¥ï¼Œè€Œå‘å¶æ•°èˆå…¥ç¡®ä¿èˆå…¥åçš„æœ€ä½æœ‰æ•ˆæ•°å­—æ˜¯å¶æ•°ã€‚ åˆ™åº”è¯¥å¾€2èˆå…¥ã€‚ å¯¹äºäºŒè¿›åˆ¶è€Œè¨€ï¼Œå°±ä»£è¡¨èˆå…¥åæœ€ä½æœ‰æ•ˆæ•°å­—å¿…é¡»ä¸º0ã€‚ å‘å¶æ•°èˆå…¥æ˜¯è®¡ç®—æœºçš„é»˜è®¤èˆå…¥æ–¹å¼ã€‚ å‘0èˆå…¥ï¼Œå¯¹åº”C/C++çš„ç±»å‹è½¬æ¢ã€‚(int) 1.324 = 1ï¼Œ(int) -1.324 = -1 å‘ä¸‹èˆå…¥ï¼ŒC/C++å‡½æ•°floor()ã€‚ä¾‹å¦‚ï¼šfloor(1.324) = 1ï¼Œfloor(-1.324) = -2 å‘ä¸Šèˆå…¥ï¼šC/C++å‡½æ•°ceil()ã€‚ä¾‹å¦‚ï¼šceil(1.324) = 2ï¼ŒCeil(-1.324) = -1","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://www.codetool.top/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}]},{"title":"leetcode289-ç”Ÿå‘½æ¸¸æˆ","slug":"leetcode289-ç”Ÿå‘½æ¸¸æˆ","date":"2020-04-02T01:38:11.000Z","updated":"2020-04-02T01:45:02.149Z","comments":true,"path":"article/leetcode289-ç”Ÿå‘½æ¸¸æˆ/","link":"","permalink":"https://www.codetool.top/article/leetcode289-%E7%94%9F%E5%91%BD%E6%B8%B8%E6%88%8F/","excerpt":"","text":"1 åŸé¢˜æ ¹æ® ç™¾åº¦ç™¾ç§‘ ï¼Œç”Ÿå‘½æ¸¸æˆï¼Œç®€ç§°ä¸ºç”Ÿå‘½ï¼Œæ˜¯è‹±å›½æ•°å­¦å®¶çº¦ç¿°Â·ä½•é¡¿Â·åº·å¨åœ¨ 1970 å¹´å‘æ˜çš„ç»†èƒè‡ªåŠ¨æœºã€‚ ç»™å®šä¸€ä¸ªåŒ…å« m Ã— n ä¸ªæ ¼å­çš„é¢æ¿ï¼Œæ¯ä¸€ä¸ªæ ¼å­éƒ½å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªç»†èƒã€‚æ¯ä¸ªç»†èƒéƒ½å…·æœ‰ä¸€ä¸ªåˆå§‹çŠ¶æ€ï¼š1 å³ä¸ºæ´»ç»†èƒï¼ˆliveï¼‰ï¼Œæˆ– 0 å³ä¸ºæ­»ç»†èƒï¼ˆdeadï¼‰ã€‚æ¯ä¸ªç»†èƒä¸å…¶å…«ä¸ªç›¸é‚»ä½ç½®ï¼ˆæ°´å¹³ï¼Œå‚ç›´ï¼Œå¯¹è§’çº¿ï¼‰çš„ç»†èƒéƒ½éµå¾ªä»¥ä¸‹å››æ¡ç”Ÿå­˜å®šå¾‹ï¼š å¦‚æœæ´»ç»†èƒå‘¨å›´å…«ä¸ªä½ç½®çš„æ´»ç»†èƒæ•°å°‘äºä¸¤ä¸ªï¼Œåˆ™è¯¥ä½ç½®æ´»ç»†èƒæ­»äº¡ï¼›å¦‚æœæ´»ç»†èƒå‘¨å›´å…«ä¸ªä½ç½®æœ‰ä¸¤ä¸ªæˆ–ä¸‰ä¸ªæ´»ç»†èƒï¼Œåˆ™è¯¥ä½ç½®æ´»ç»†èƒä»ç„¶å­˜æ´»ï¼›å¦‚æœæ´»ç»†èƒå‘¨å›´å…«ä¸ªä½ç½®æœ‰è¶…è¿‡ä¸‰ä¸ªæ´»ç»†èƒï¼Œåˆ™è¯¥ä½ç½®æ´»ç»†èƒæ­»äº¡ï¼›å¦‚æœæ­»ç»†èƒå‘¨å›´æ­£å¥½æœ‰ä¸‰ä¸ªæ´»ç»†èƒï¼Œåˆ™è¯¥ä½ç½®æ­»ç»†èƒå¤æ´»ï¼›æ ¹æ®å½“å‰çŠ¶æ€ï¼Œå†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—é¢æ¿ä¸Šæ‰€æœ‰ç»†èƒçš„ä¸‹ä¸€ä¸ªï¼ˆä¸€æ¬¡æ›´æ–°åçš„ï¼‰çŠ¶æ€ã€‚ä¸‹ä¸€ä¸ªçŠ¶æ€æ˜¯é€šè¿‡å°†ä¸Šè¿°è§„åˆ™åŒæ—¶åº”ç”¨äºå½“å‰çŠ¶æ€ä¸‹çš„æ¯ä¸ªç»†èƒæ‰€å½¢æˆçš„ï¼Œå…¶ä¸­ç»†èƒçš„å‡ºç”Ÿå’Œæ­»äº¡æ˜¯åŒæ—¶å‘ç”Ÿçš„ã€‚ ç¤ºä¾‹: è¾“å…¥ï¼š[&nbsp;&nbsp;[0,1,0],&nbsp;&nbsp;[0,0,1],&nbsp;&nbsp;[1,1,1],&nbsp;&nbsp;[0,0,0]]è¾“å‡ºï¼š[&nbsp;&nbsp;[0,0,0],&nbsp;&nbsp;[1,0,1],&nbsp;&nbsp;[0,1,1],&nbsp;&nbsp;[0,1,0]] è¿›é˜¶ï¼š ä½ å¯ä»¥ä½¿ç”¨åŸåœ°ç®—æ³•è§£å†³æœ¬é¢˜å—ï¼Ÿè¯·æ³¨æ„ï¼Œé¢æ¿ä¸Šæ‰€æœ‰æ ¼å­éœ€è¦åŒæ—¶è¢«æ›´æ–°ï¼šä½ ä¸èƒ½å…ˆæ›´æ–°æŸäº›æ ¼å­ï¼Œç„¶åä½¿ç”¨å®ƒä»¬çš„æ›´æ–°åçš„å€¼å†æ›´æ–°å…¶ä»–æ ¼å­ã€‚ æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äºŒç»´æ•°ç»„æ¥è¡¨ç¤ºé¢æ¿ã€‚åŸåˆ™ä¸Šï¼Œé¢æ¿æ˜¯æ— é™çš„ï¼Œä½†å½“æ´»ç»†èƒä¾µå äº†é¢æ¿è¾¹ç•Œæ—¶ä¼šé€ æˆé—®é¢˜ã€‚ä½ å°†å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ï¼Ÿ 2 è§£æ³•2.1 æ€æƒ³å¯ä»¥å¯¹æ¯ä¸€ä¸ªå…ƒç´ æ‰«æå…¶å‘¨å›´å…«ä¸ªå…ƒç´ ä¸­1çš„ä¸ªæ•°ï¼Œç„¶åä¿å­˜ä¸‹æ¥ï¼Œè¿™ä¸ªçŠ¶æ€çš„ä¿å­˜æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯æ–°å»ºä¸€ä¸ªäºŒç»´æ•°ç»„ä¿å­˜ï¼ˆç©ºé—´å¤æ‚åº¦O(mn)ï¼‰ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯æ‹“å±•åŸæ•°ç»„æ¯ä¸ªå…ƒç´ å€¼çš„å«ä¹‰ï¼ˆåŸåœ°ç®—æ³•ï¼‰ æ—¶é—´å¤æ‚åº¦ï¼šæ‰«æm*nä¸ªå…ƒç´ ï¼Œæ¯æ¬¡æ‰«ææ£€æŸ¥å‘¨å›´8ä¸ªæ ¼å­ã€‚å³æ—¶é—´å¤æ‚åº¦ä¸ºO(8mn)=O(mn) 2.2 ä»£ç class Solution { public int[] maxDepthAfterSplit(String seq) { List&lt;Integer> stack = new ArrayList&lt;>(); char[] chars = seq.toCharArray(); int[] ans = new int[chars.length]; for(int i = 0;i&lt;chars.length;i++){ if(chars[i]=='('){ stack.add(i); }else{ ans[stack.get(stack.size()-1)] = stack.size()%2; ans[i] = stack.size()%2; stack.remove(stack.size()-1); } } return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"ä½¿ç”¨OpenRestyå®ç°Nginxå±‚é¢çš„å¤šçº§ç¼“å­˜æŸ¥è¯¢å“åº”","slug":"ä½¿ç”¨OpenRestyå®ç°Nginxå±‚é¢çš„å¤šçº§ç¼“å­˜æŸ¥è¯¢å“åº”","date":"2020-04-01T13:44:35.000Z","updated":"2020-04-01T17:24:19.891Z","comments":true,"path":"article/ä½¿ç”¨OpenRestyå®ç°Nginxå±‚é¢çš„å¤šçº§ç¼“å­˜æŸ¥è¯¢å“åº”/","link":"","permalink":"https://www.codetool.top/article/%E4%BD%BF%E7%94%A8OpenResty%E5%AE%9E%E7%8E%B0Nginx%E5%B1%82%E9%9D%A2%E7%9A%84%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98%E6%9F%A5%E8%AF%A2%E5%93%8D%E5%BA%94/","excerpt":"","text":"1 OpenRestyæ¦‚è¿°OpenRestyÂ® æ˜¯ä¸€ä¸ªåŸºäº Nginx ä¸ Lua çš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œå…¶å†…éƒ¨é›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—ä»¥åŠå¤§å¤šæ•°çš„ä¾èµ–é¡¹ã€‚ç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†è¶…é«˜å¹¶å‘ã€æ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ã€Web æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚ OpenRestyÂ® é€šè¿‡æ±‡èšå„ç§è®¾è®¡ç²¾è‰¯çš„ Nginx æ¨¡å—ï¼ˆä¸»è¦ç”± OpenResty å›¢é˜Ÿè‡ªä¸»å¼€å‘ï¼‰ï¼Œä»è€Œå°† Nginx æœ‰æ•ˆåœ°å˜æˆä¸€ä¸ªå¼ºå¤§çš„é€šç”¨ Web åº”ç”¨å¹³å°ã€‚è¿™æ ·ï¼ŒWeb å¼€å‘äººå‘˜å’Œç³»ç»Ÿå·¥ç¨‹å¸ˆå¯ä»¥ä½¿ç”¨ Lua è„šæœ¬è¯­è¨€è°ƒåŠ¨ Nginx æ”¯æŒçš„å„ç§ C ä»¥åŠ Lua æ¨¡å—ï¼Œå¿«é€Ÿæ„é€ å‡ºè¶³ä»¥èƒœä»» 10K ä¹ƒè‡³ 1000K ä»¥ä¸Šå•æœºå¹¶å‘è¿æ¥çš„é«˜æ€§èƒ½ Web åº”ç”¨ç³»ç»Ÿã€‚ OpenRestyÂ® çš„ç›®æ ‡æ˜¯è®©ä½ çš„WebæœåŠ¡ç›´æ¥è·‘åœ¨ Nginx æœåŠ¡å†…éƒ¨ï¼Œå……åˆ†åˆ©ç”¨ Nginx çš„éé˜»å¡ I/O æ¨¡å‹ï¼Œä¸ä»…ä»…å¯¹ HTTP å®¢æˆ·ç«¯è¯·æ±‚,ç”šè‡³äºå¯¹è¿œç¨‹åç«¯è¯¸å¦‚ MySQLã€PostgreSQLã€Memcached ä»¥åŠ Redis ç­‰éƒ½è¿›è¡Œä¸€è‡´çš„é«˜æ€§èƒ½å“åº”ã€‚ ä»¥ä¸Šä»‹ç»æ¥è‡ªå®˜ç½‘ï¼šhttp://openresty.org/cn/ ç”±Lua ç²˜åˆçš„Nginxç”Ÿæ€ç¯å¢ƒ - å¤©æ¶¯é€æ¢¦ - åšå®¢å›­ æ˜¯OpenRestyä½œè€…ç« äº¦æ˜¥åœ¨2012å¹´å¦é—¨TechClubæ²™é¾™ä¸Šå‘è¡¨çš„ä¸€æ¬¡å…³äºOpenRestyæŠ€æœ¯ä»‹ç»çš„æ¼”è®²å¬å½•ã€‚ ä¸‹é¢è¿™ä¸ªç½‘å€åˆ™æ˜¯ç« äº¦æ˜¥ç”¨ Perl ç”Ÿæˆçš„ä¸€ä¸ªç®€å• git åŠ¨ç”»ï¼Œå¯èƒ½å°±æ˜¯åœ¨è¿™æ¬¡å¤§ä¼šä¸Šå½“ä½œå¹»ç¯ç‰‡ä½¿ç”¨ï¼š http://agentzh.org/misc/slides/ngx-openresty-ecosystem 2 å®‰è£…æ·»åŠ ä»“åº“æ‰§è¡Œå‘½ä»¤ yum install yum-utils yum-config-manager --add-repo https://openresty.org/package/centos/openresty.repoæ‰§è¡Œå®‰è£… yum install openrestyå®‰è£…æˆåŠŸå ä¼šåœ¨é»˜è®¤çš„ç›®å½•å¦‚ä¸‹ï¼š /usr/local/openrestyOpenRestyé»˜è®¤å·²ç»é›†æˆäº†nginx,åœ¨ç›®å½•ï¼š/usr/local/openresty/nginx ä¸‹ã€‚ 3 åœ¨nginxå±‚é¢å®ç°å¤šçº§ç¼“å­˜æŸ¥è¯¢ ä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼š åœ¨Nginxå±‚é¢å“åº”è¯·æ±‚ï¼Œä¸ç”¨å†è½¬å‘ç»™åç«¯æœåŠ¡å™¨ï¼Œå‡å°‘åç«¯æœåŠ¡å™¨çš„å‹åŠ› 3.1 æ­¥éª¤åœ¨nginx.confä¸­å®šä¹‰luaç¼“å­˜å‘½åç©ºé—´åŠå…¶å¤§å°ï¼š user root root; worker_processes 1; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; #å®šä¹‰Nginxç¼“å­˜æ¨¡å—ï¼Œæ¨¡å—åå­—å«dis_cache,å®¹é‡å¤§å°128M lua_shared_dict dis_cache 128m; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; server { listen 80; #ç›‘å¬çš„åŸŸå server_name localhost; #è¡¨ç¤ºæ‰€æœ‰ä»¥ localhost/read_contentçš„è¯·æ±‚éƒ½ç”±è¯¥é…ç½®å¤„ç† location /read_content { #content_by_lua_file:æ‰€æœ‰è¯·æ±‚éƒ½äº¤ç»™æŒ‡å®šçš„luaè„šæœ¬å¤„ç†(/root/lua/read_content.lua) content_by_lua_file /root/lua/read_content.lua; } } } luaè„šæœ¬ï¼š ngx.header.content_type=\"application/json;charset=utf8\" local uri_args = ngx.req.get_uri_args() local id = uri_args[\"id\"] --è·å–æœ¬åœ°ç¼“å­˜ local cache_ngx = ngx.shared.dis_cache --æ ¹æ®ID è·å–æœ¬åœ°ç¼“å­˜æ•°æ® local contentCache = cache_ngx:get('content_cache_'..id) -- å¦‚æœnginxç¼“å­˜ä¸­æ²¡æœ‰ï¼Œè¯»å–redisç¼“å­˜ if contentCache == \"\" or contentCache == nil then local redis = require(\"resty.redis\"); local red = redis:new() red:set_timeout(2000) red:connect(\"192.168.176.129\", 6379) local rescontent=red:get(\"content_\"..id) -- å¦‚æœredisç¼“å­˜ä¸­æ²¡æœ‰ï¼Œè¯»å–mysqlæ•°æ®åº“ if ngx.null == rescontent then local cjson = require(\"cjson\") local mysql = require(\"resty.mysql\") local db = mysql:new() db:set_timeout(2000) local props = { host = \"192.168.176.129\", port = 3306, database = \"changgou_content\", user = \"root\", password = \"123456\" } local res = db:connect(props) local select_sql = \"select url,pic from tb_content where status ='1' and category_id=\"..id..\" order by sort_order\"; res = db:query(select_sql) local responsejson = cjson.encode(res) -- å†™å…¥redisç¼“å­˜ red:set(\"content_\"..id,responsejson) ngx.say(responsejson); db:close() -- å¦‚æœredisç¼“å­˜ä¸­å­˜åœ¨æ•°æ®ï¼Œå“åº”æ•°æ®å¹¶å†™å…¥nginxç¼“å­˜ else cache_ngx:set('content_cache_'..id, rescontent, 10*60); ngx.say(rescontent) end red:close() -- å¦‚æœnginxç¼“å­˜ä¸­å­˜åœ¨ç›´æ¥å“åº” else ngx.say(contentCache) end","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"OpenResty","slug":"OpenResty","permalink":"https://www.codetool.top/tags/OpenResty/"}]},{"title":"Luaè„šæœ¬è¯­è¨€æ¦‚è¿°å’ŒåŸºæœ¬è¯­æ³•","slug":"Luaè„šæœ¬è¯­è¨€æ¦‚è¿°å’ŒåŸºæœ¬è¯­æ³•","date":"2020-04-01T10:06:12.000Z","updated":"2020-04-01T17:26:04.949Z","comments":true,"path":"article/Luaè„šæœ¬è¯­è¨€æ¦‚è¿°å’ŒåŸºæœ¬è¯­æ³•/","link":"","permalink":"https://www.codetool.top/article/Lua%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80%E6%A6%82%E8%BF%B0%E5%92%8C%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/","excerpt":"","text":"1 Luaæ¦‚è¿°1.1 ä»‹ç»Lua æ˜¯ä¸€ä¸ªå°å·§çš„è„šæœ¬è¯­è¨€ã€‚å®ƒæ˜¯å·´è¥¿é‡Œçº¦çƒ­å†…å¢å¤©ä¸»æ•™å¤§å­¦ï¼ˆPontifical Catholic University of Rio de Janeiroï¼‰é‡Œçš„ä¸€ä¸ªç”±Roberto Ierusalimschyã€Waldemar Celes å’Œ Luiz Henrique de Figueiredoä¸‰äººæ‰€ç»„æˆçš„ç ”ç©¶å°ç»„äº1993å¹´å¼€å‘çš„ã€‚ å…¶è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†é€šè¿‡çµæ´»åµŒå…¥åº”ç”¨ç¨‹åºä¸­ä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½ã€‚Luaç”±æ ‡å‡†Cç¼–å†™è€Œæˆï¼Œå‡ ä¹åœ¨æ‰€æœ‰æ“ä½œç³»ç»Ÿå’Œå¹³å°ä¸Šéƒ½å¯ä»¥ç¼–è¯‘ï¼Œè¿è¡Œã€‚Luaå¹¶æ²¡æœ‰æä¾›å¼ºå¤§çš„åº“ï¼Œè¿™æ˜¯ç”±å®ƒçš„å®šä½å†³å®šçš„ã€‚æ‰€ä»¥Luaä¸é€‚åˆä½œä¸ºå¼€å‘ç‹¬ç«‹åº”ç”¨ç¨‹åºçš„è¯­è¨€ã€‚Lua æœ‰ä¸€ä¸ªåŒæ—¶è¿›è¡Œçš„JITé¡¹ç›®ï¼Œæä¾›åœ¨ç‰¹å®šå¹³å°ä¸Šçš„å³æ—¶ç¼–è¯‘åŠŸèƒ½ã€‚ ç®€å•æ¥è¯´ï¼š Lua æ˜¯ä¸€ç§è½»é‡å°å·§çš„è„šæœ¬è¯­è¨€ï¼Œç”¨æ ‡å‡†Cè¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€æ”¾ï¼Œå…¶è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†åµŒå…¥åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½ã€‚ 1.2 ç‰¹æ€§ æ”¯æŒé¢å‘è¿‡ç¨‹(procedure-oriented)ç¼–ç¨‹å’Œå‡½æ•°å¼ç¼–ç¨‹(functional programming)ï¼› è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼›åªæä¾›äº†ä¸€ç§é€šç”¨ç±»å‹çš„è¡¨ï¼ˆtableï¼‰ï¼Œç”¨å®ƒå¯ä»¥å®ç°æ•°ç»„ï¼Œå“ˆå¸Œè¡¨ï¼Œé›†åˆï¼Œå¯¹è±¡ï¼› è¯­è¨€å†…ç½®æ¨¡å¼åŒ¹é…ï¼›é—­åŒ…(closure)ï¼›å‡½æ•°ä¹Ÿå¯ä»¥çœ‹åšä¸€ä¸ªå€¼ï¼›æä¾›å¤šçº¿ç¨‹ï¼ˆååŒè¿›ç¨‹ï¼Œå¹¶éæ“ä½œç³»ç»Ÿæ‰€æ”¯æŒçš„çº¿ç¨‹ï¼‰æ”¯æŒï¼› é€šè¿‡é—­åŒ…å’Œtableå¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ”¯æŒé¢å‘å¯¹è±¡ç¼–ç¨‹æ‰€éœ€è¦çš„ä¸€äº›å…³é”®æœºåˆ¶ï¼Œæ¯”å¦‚æ•°æ®æŠ½è±¡ï¼Œè™šå‡½æ•°ï¼Œç»§æ‰¿å’Œé‡è½½ç­‰ã€‚ 1.3 åº”ç”¨åœºæ™¯ æ¸¸æˆå¼€å‘ ç‹¬ç«‹åº”ç”¨è„šæœ¬ Web åº”ç”¨è„šæœ¬ æ‰©å±•å’Œæ•°æ®åº“æ’ä»¶å¦‚ï¼šMySQL Proxy å’Œ MySQL WorkBench å®‰å…¨ç³»ç»Ÿï¼Œå¦‚å…¥ä¾µæ£€æµ‹ç³»ç»Ÿ redisä¸­åµŒå¥—è°ƒç”¨å®ç°ç±»ä¼¼äº‹åŠ¡çš„åŠŸèƒ½ webå®¹å™¨ä¸­åº”ç”¨å¤„ç†ä¸€äº›è¿‡æ»¤ã€ç¼“å­˜ç­‰ç­‰çš„é€»è¾‘ï¼Œä¾‹å¦‚nginxã€‚ 2 å®‰è£…å…ˆå®‰è£…ä¸€äº›ä¾èµ– yum install libtermcap-devel ncurses-devel libevent-devel readline-develä¸‹è½½å¹¶ç¼–è¯‘ wget http://www.lua.org/ftp/lua-5.3.5.tar.gz tar zxf lua-5.3.5.tar.gz cd lua-5.3.5 make linux testæ­¤æ—¶å†æ‰§è¡Œluaæµ‹è¯•çœ‹luaæ˜¯å¦å®‰è£…æˆåŠŸ [root@localhost ~]# lua Lua 5.3.5 Copyright (C) 1994-2008 Lua.org, PUC-Rio3 HelloWorldå…¥é—¨ç¨‹åºåˆ›å»ºhello.luaæ–‡ä»¶ï¼Œå†…å®¹ä¸º print(\"hello\"); ä¿å­˜å¹¶é€€å‡ºã€‚ æ‰§è¡Œå‘½ä»¤ lua hello.luaæŸ¥çœ‹è¾“å‡ºï¼š Hello4 åŸºæœ¬è¯­æ³•4.1 æ³¨é‡Šä¸€è¡Œæ³¨é‡Šï¼šä¸¤ä¸ªå‡å·æ˜¯å•è¡Œæ³¨é‡Š: -- å•è¡Œæ³¨é‡Š å¤šè¡Œæ³¨é‡Šï¼š --[[ å¤šè¡Œæ³¨é‡Š å¤šè¡Œæ³¨é‡Š --]] 4.2 å®šä¹‰å˜é‡å…¨å±€å˜é‡ï¼Œé»˜è®¤çš„æƒ…å†µä¸‹ï¼Œå®šä¹‰ä¸€ä¸ªå˜é‡éƒ½æ˜¯å…¨å±€å˜é‡ï¼Œ å¦‚æœè¦ç”¨å±€éƒ¨å˜é‡ éœ€è¦å£°æ˜ä¸ºlocal.ä¾‹å¦‚ï¼š -- å…¨å±€å˜é‡èµ‹å€¼ a=1 -- å±€éƒ¨å˜é‡èµ‹å€¼ local b=2 å¦‚æœå˜é‡æ²¡æœ‰åˆå§‹åŒ–ï¼Œåˆ™å®ƒçš„å€¼ä¸ºnil 4.3 æ•°æ®ç±»å‹Lua æ˜¯å¼±ç±»å‹è¯­è¨€ï¼Œå˜é‡ä¸è¦ç±»å‹å®šä¹‰,åªéœ€è¦ä¸ºå˜é‡èµ‹å€¼ã€‚ å€¼å¯ä»¥å­˜å‚¨åœ¨å˜é‡ä¸­ï¼Œä½œä¸ºå‚æ•°ä¼ é€’æˆ–ç»“æœè¿”å›ã€‚ Lua ä¸­æœ‰ 8 ä¸ªåŸºæœ¬ç±»å‹åˆ†åˆ«ä¸ºï¼šnilã€booleanã€numberã€stringã€userdataã€functionã€thread å’Œ tableã€‚ æ•°æ®ç±»å‹ æè¿° nil è¿™ä¸ªæœ€ç®€å•ï¼Œåªæœ‰å€¼nilå±äºè¯¥ç±»ï¼Œè¡¨ç¤ºä¸€ä¸ªæ— æ•ˆå€¼ï¼ˆåœ¨æ¡ä»¶è¡¨è¾¾å¼ä¸­ç›¸å½“äºfalseï¼‰ã€‚ boolean åŒ…å«ä¸¤ä¸ªå€¼ï¼šfalseå’Œtrueã€‚ number è¡¨ç¤ºåŒç²¾åº¦ç±»å‹çš„å®æµ®ç‚¹æ•° string å­—ç¬¦ä¸²ç”±ä¸€å¯¹åŒå¼•å·æˆ–å•å¼•å·æ¥è¡¨ç¤º function ç”± C æˆ– Lua ç¼–å†™çš„å‡½æ•° userdata è¡¨ç¤ºä»»æ„å­˜å‚¨åœ¨å˜é‡ä¸­çš„Cæ•°æ®ç»“æ„ thread è¡¨ç¤ºæ‰§è¡Œçš„ç‹¬ç«‹çº¿è·¯ï¼Œç”¨äºæ‰§è¡ŒååŒç¨‹åº table Lua ä¸­çš„è¡¨ï¼ˆtableï¼‰å…¶å®æ˜¯ä¸€ä¸ªâ€œå…³è”æ•°ç»„â€ï¼ˆassociative arraysï¼‰ï¼Œæ•°ç»„çš„ç´¢å¼•å¯ä»¥æ˜¯æ•°å­—ã€å­—ç¬¦ä¸²æˆ–è¡¨ç±»å‹ã€‚åœ¨ Lua é‡Œï¼Œtable çš„åˆ›å»ºæ˜¯é€šè¿‡â€œæ„é€ è¡¨è¾¾å¼â€æ¥å®Œæˆï¼Œæœ€ç®€å•æ„é€ è¡¨è¾¾å¼æ˜¯{}ï¼Œç”¨æ¥åˆ›å»ºä¸€ä¸ªç©ºè¡¨ã€‚ å®ä¾‹ï¼š print(type(\"Hello world\")) --> string print(type(10.4*3)) --> number print(type(print)) --> function print(type(type)) --> function print(type(true)) --> boolean print(type(nil)) --> nil 4.4 æµç¨‹æ§åˆ¶4.4.1 ifLua if è¯­å¥ ç”±ä¸€ä¸ªå¸ƒå°”è¡¨è¾¾å¼ä½œä¸ºæ¡ä»¶åˆ¤æ–­ï¼Œå…¶åç´§è·Ÿå…¶ä»–è¯­å¥ç»„æˆã€‚ if(condition) then --[ åœ¨conditionä¸º true æ—¶æ‰§è¡Œçš„è¯­å¥ --] end 4.4.2 if..elseè¯­å¥Lua if è¯­å¥å¯ä»¥ä¸ else è¯­å¥æ­é…ä½¿ç”¨, åœ¨ if æ¡ä»¶è¡¨è¾¾å¼ä¸º false æ—¶æ‰§è¡Œ else è¯­å¥ä»£ç å—ã€‚ if(condition) then --[ conditionä¸º true æ—¶æ‰§è¡Œè¯¥è¯­å¥å— --] else --[ conditionä¸º false æ—¶æ‰§è¡Œè¯¥è¯­å¥å— --] end 4.4.3 whileLua ç¼–ç¨‹è¯­è¨€ä¸­ while å¾ªç¯è¯­å¥åœ¨åˆ¤æ–­æ¡ä»¶ä¸º true æ—¶ä¼šé‡å¤æ‰§è¡Œå¾ªç¯ä½“è¯­å¥ã€‚ while(condition) do statements end 4.4.4 forfor var=exp1,exp2,exp3 do &lt;æ‰§è¡Œä½“> end var ä» exp1 å˜åŒ–åˆ° exp2ï¼Œæ¯æ¬¡å˜åŒ–ä»¥ exp3 ä¸ºæ­¥é•¿é€’å¢ varï¼Œå¹¶æ‰§è¡Œä¸€æ¬¡ â€œæ‰§è¡Œä½“â€ã€‚exp3 æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¸º1ã€‚ ä¾‹ï¼š for i=1,9,2 do print(i) end ä»£è¡¨ä»1å¼€å§‹å¾ªç¯ï¼Œå¾ªç¯æ•°æ®åˆ°9ç»“æŸï¼Œæ¯æ¬¡é€’å¢2 å…¶ä»–è¯­è¨€çš„é€»è¾‘åº”è¯¥æ˜¯for(int i = 0;i &lt;= 9;i ++) 4.4.5 repeatâ€¦untilrepeat statements until( condition ) è¿™ä¸ªæœ‰ç‚¹åƒå…¶ä»–è¯­è¨€çš„doâ€¦whileï¼Œä½†æ¡ä»¶åˆ¤æ–­æ˜¯åè¿‡æ¥çš„ï¼Œå³doâ€¦while not 4.5 å‡½æ•°luaä¸­ä¹Ÿå¯ä»¥å®šä¹‰å‡½æ•°ï¼Œç±»ä¼¼äºjavaä¸­çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š --[[ å‡½æ•°è¿”å›ä¸¤ä¸ªå€¼çš„æœ€å¤§å€¼ --]] function max(num1, num2) if (num1 > num2) then result = num1; else result = num2; end return result; end -- è°ƒç”¨å‡½æ•° print(\"ä¸¤å€¼æ¯”è¾ƒæœ€å¤§å€¼ä¸º \",max(10,4)) print(\"ä¸¤å€¼æ¯”è¾ƒæœ€å¤§å€¼ä¸º \",max(5,6)) 4.6 è¡¨table æ˜¯ Lua çš„ä¸€ç§æ•°æ®ç»“æ„ç”¨æ¥å¸®åŠ©æˆ‘ä»¬åˆ›å»ºä¸åŒçš„æ•°æ®ç±»å‹ï¼Œå¦‚ï¼šæ•°ç»„ã€å­—å…¸ç­‰ã€‚å°±åƒPHPå…·æœ‰å…³è”æ•°ç»„å’Œç´¢å¼•æ•°ç»„ä¸€æ ·ï¼ˆä¸ºPHPä¸Šä¸€æŸ±é¦™ï¼‰ Luaä¹Ÿæ˜¯é€šè¿‡tableæ¥è§£å†³æ¨¡å—ï¼ˆmoduleï¼‰ã€åŒ…ï¼ˆpackageï¼‰å’Œå¯¹è±¡ï¼ˆObjectï¼‰çš„ã€‚ä¾‹å¦‚string.formatè¡¨ç¤ºä½¿ç”¨â€formatâ€æ¥ç´¢å¼•table stringã€‚ -- åˆå§‹åŒ–è¡¨ mytable = {} -- æŒ‡å®šå€¼ mytable[1]= \"Lua\" mytable[\"Lua\"]= 1 -- ç§»é™¤å¼•ç”¨ mytable = nil -- lua åƒåœ¾å›æ”¶ä¼šé‡Šæ”¾å†…å­˜ 4.7 æ¨¡å—4.7.1 å®šä¹‰æ¨¡å—æ¨¡å—ç±»ä¼¼äºä¸€ä¸ªå°è£…åº“ï¼Œä» Lua 5.1 å¼€å§‹ï¼ŒLua åŠ å…¥äº†æ ‡å‡†çš„æ¨¡å—ç®¡ç†æœºåˆ¶ï¼Œå¯ä»¥æŠŠä¸€äº›å…¬ç”¨çš„ä»£ç æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œä»¥ API æ¥å£çš„å½¢å¼åœ¨å…¶ä»–åœ°æ–¹è°ƒç”¨ï¼Œæœ‰åˆ©äºä»£ç çš„é‡ç”¨å’Œé™ä½ä»£ç è€¦åˆåº¦ã€‚ åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å«module.luaï¼Œåœ¨module.luaä¸­åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ï¼Œä»£ç å¦‚ä¸‹ï¼š -- æ–‡ä»¶åä¸º module.lua -- å®šä¹‰ä¸€ä¸ªåä¸º module çš„æ¨¡å— module = {} -- å®šä¹‰ä¸€ä¸ªå¸¸é‡ module.constant = \"è¿™æ˜¯ä¸€ä¸ªå¸¸é‡\" -- å®šä¹‰ä¸€ä¸ªå‡½æ•° function module.func1() print(\"è¿™æ˜¯ä¸€ä¸ªå…¬æœ‰å‡½æ•°\") end local function func2() print(\"è¿™æ˜¯ä¸€ä¸ªç§æœ‰å‡½æ•°ï¼\") end function module.func3() func2() end return module ï¼ˆè¿™ç†Ÿæ‚‰æ„Ÿï¼Œä»¿ä½›çœ‹åˆ°äº†ES6çš„æ¨¡å—ï¼‰ ä¸Šé¢çš„ func2 å£°æ˜ä¸ºç¨‹åºå—çš„å±€éƒ¨å˜é‡ï¼Œå³è¡¨ç¤ºä¸€ä¸ªç§æœ‰å‡½æ•°ï¼Œå› æ­¤æ˜¯ä¸èƒ½ä»å¤–éƒ¨è®¿é—®æ¨¡å—é‡Œçš„è¿™ä¸ªç§æœ‰å‡½æ•°ï¼Œå¿…é¡»é€šè¿‡æ¨¡å—é‡Œçš„å…¬æœ‰å‡½æ•°æ¥è°ƒç”¨ã€‚ 4.7.2 å¼•ç”¨æ¨¡å—require ç”¨äº å¼•å…¥å…¶ä»–çš„æ¨¡å—ï¼Œç±»ä¼¼äºjavaä¸­çš„ç±»è¦å¼•ç”¨åˆ«çš„ç±»çš„æ•ˆæœã€‚ require(\"&lt;æ¨¡å—å>\") -- æˆ–è€… require \"&lt;æ¨¡å—å>\" æˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢å®šä¹‰çš„moduleæ¨¡å—å¼•å…¥ä½¿ç”¨,åˆ›å»ºä¸€ä¸ªtest_module.luaæ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š -- test_module.lua æ–‡ä»¶ -- module æ¨¡å—ä¸ºä¸Šæ–‡æåˆ°åˆ° module.lua require(\"module\") print(module.constant) module.func3()","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Lua","slug":"Lua","permalink":"https://www.codetool.top/tags/Lua/"}]},{"title":"leetcode1111-æœ‰æ•ˆæ‹¬å·çš„åµŒå¥—æ·±åº¦","slug":"leetcode1111-æœ‰æ•ˆæ‹¬å·çš„åµŒå¥—æ·±åº¦","date":"2020-04-01T02:12:53.000Z","updated":"2020-04-02T01:53:17.015Z","comments":true,"path":"article/leetcode1111-æœ‰æ•ˆæ‹¬å·çš„åµŒå¥—æ·±åº¦/","link":"","permalink":"https://www.codetool.top/article/leetcode1111-%E6%9C%89%E6%95%88%E6%8B%AC%E5%8F%B7%E7%9A%84%E5%B5%8C%E5%A5%97%E6%B7%B1%E5%BA%A6/","excerpt":"","text":"1 åŸé¢˜æœ‰æ•ˆæ‹¬å·å­—ç¬¦ä¸² ä»…ç”± &quot;(&quot; å’Œ &quot;)&quot; æ„æˆï¼Œå¹¶ç¬¦åˆä¸‹è¿°å‡ ä¸ªæ¡ä»¶ä¹‹ä¸€ï¼š ç©ºå­—ç¬¦ä¸² è¿æ¥ï¼Œå¯ä»¥è®°ä½œ ABï¼ˆA ä¸ B è¿æ¥ï¼‰ï¼Œå…¶ä¸­ A å’Œ B éƒ½æ˜¯æœ‰æ•ˆæ‹¬å·å­—ç¬¦ä¸² åµŒå¥—ï¼Œå¯ä»¥è®°ä½œ (A)ï¼Œå…¶ä¸­ A æ˜¯æœ‰æ•ˆæ‹¬å·å­—ç¬¦ä¸² ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä»»æ„æœ‰æ•ˆæ‹¬å·å­—ç¬¦ä¸² s çš„ åµŒå¥—æ·±åº¦ depth(S)ï¼š s ä¸ºç©ºæ—¶ï¼Œdepth(&quot;&quot;) = 0 s ä¸º A ä¸ B è¿æ¥æ—¶ï¼Œdepth(A + B) = max(depth(A), depth(B))ï¼Œå…¶ä¸­ A å’Œ B éƒ½æ˜¯æœ‰æ•ˆæ‹¬å·å­—ç¬¦ä¸² s ä¸ºåµŒå¥—æƒ…å†µï¼Œdepth(&quot;(&quot; + A + &quot;)&quot;) = 1 + depth(A)ï¼Œå…¶ä¸­ A æ˜¯æœ‰æ•ˆæ‹¬å·å­—ç¬¦ä¸²ä¾‹å¦‚ï¼š&quot;&quot;ï¼Œ&quot;()()&quot;ï¼Œå’Œ &quot;()(()())&quot; éƒ½æ˜¯æœ‰æ•ˆæ‹¬å·å­—ç¬¦ä¸²ï¼ŒåµŒå¥—æ·±åº¦åˆ†åˆ«ä¸º 0ï¼Œ1ï¼Œ2ï¼Œè€Œ &quot;)(&quot; å’Œ &quot;(()&quot; éƒ½ä¸æ˜¯æœ‰æ•ˆæ‹¬å·å­—ç¬¦ä¸²ã€‚ ç»™ä½ ä¸€ä¸ªæœ‰æ•ˆæ‹¬å·å­—ç¬¦ä¸² seqï¼Œå°†å…¶åˆ†æˆä¸¤ä¸ªä¸ç›¸äº¤çš„å­åºåˆ— A å’Œ Bï¼Œä¸” A å’Œ B æ»¡è¶³æœ‰æ•ˆæ‹¬å·å­—ç¬¦ä¸²çš„å®šä¹‰ï¼ˆæ³¨æ„ï¼šA.length + B.length = seq.lengthï¼‰ã€‚ ç°åœ¨ï¼Œä½ éœ€è¦ä»ä¸­é€‰å‡º ä»»æ„ ä¸€ç»„æœ‰æ•ˆæ‹¬å·å­—ç¬¦ä¸² A å’Œ Bï¼Œä½¿ max(depth(A), depth(B)) çš„å¯èƒ½å–å€¼æœ€å°ã€‚ è¿”å›é•¿åº¦ä¸º seq.length ç­”æ¡ˆæ•°ç»„ answer ï¼Œé€‰æ‹© A è¿˜æ˜¯ B çš„ç¼–ç è§„åˆ™æ˜¯ï¼šå¦‚æœ seq[i] æ˜¯ A çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆ answer[i] = 0ã€‚å¦åˆ™ï¼Œanswer[i] = 1ã€‚å³ä¾¿æœ‰å¤šä¸ªæ»¡è¶³è¦æ±‚çš„ç­”æ¡ˆå­˜åœ¨ï¼Œä½ ä¹Ÿåªéœ€è¿”å› ä¸€ä¸ªã€‚ ç¤ºä¾‹ 1: è¾“å…¥ï¼š seq = â€œ(()())â€è¾“å‡ºï¼š [0,1,1,1,1,0] ç¤ºä¾‹ 2: è¾“å…¥ï¼š seq = â€œ()(())()â€è¾“å‡ºï¼š [0,0,0,1,1,0,1,1] æç¤ºï¼š 1 &lt;= text.size &lt;= 10000 2 è§£æ³•2.1 æ€æƒ³å¦‚æœç”¨æ ˆæ¨¡æ‹Ÿæ‹¬å·åŒ¹é…ï¼Œåœ¨æ ˆä¸­åªå­˜æ”¾å·¦æ‹¬å·ï¼Œå½“å‡ºç°å³æ‹¬å·çš„æ—¶å€™ï¼Œå·¦æ‹¬å·åœ¨æ ˆä¸­çš„ä¸‹æ ‡ï¼ˆç”¨ArrayListæ¨¡æ‹Ÿæ ˆï¼‰å³ä»£è¡¨äº†å…¶åœ¨åŸå­—ç¬¦ä¸²ä¸­çš„åµŒå¥—æ·±åº¦ï¼Œé‚£ä¹ˆè¦å°†æ·±åº¦å‡åˆ†ï¼Œåªéœ€è¦æ¯æ¬¡å‡ºæ ˆçš„æ—¶å€™å°†ä¸‹æ ‡ä¸ºå¥‡å¶çš„æ‹¬å·å‡åˆ†ç»™Aå’ŒBã€‚ æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œnä¸ºå­—ç¬¦ä¸²é•¿åº¦ã€‚ 2.2 ä»£ç class Solution { public int[] maxDepthAfterSplit(String seq) { List&lt;Integer> stack = new ArrayList&lt;>(); char[] chars = seq.toCharArray(); int[] ans = new int[chars.length]; for(int i = 0;i&lt;chars.length;i++){ if(chars[i]=='('){ stack.add(i); }else{ ans[stack.get(stack.size()-1)] = stack.size()%2; ans[i] = stack.size()%2; stack.remove(stack.size()-1); } } return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"å†™ä¸€ä¸‹è¿‘å†µ","slug":"å†™ä¸€ä¸‹è¿‘å†µ","date":"2020-03-31T14:27:35.000Z","updated":"2020-04-01T16:20:15.825Z","comments":true,"path":"article/å†™ä¸€ä¸‹è¿‘å†µ/","link":"","permalink":"https://www.codetool.top/article/%E5%86%99%E4%B8%80%E4%B8%8B%E8%BF%91%E5%86%B5/","excerpt":"","text":"ä»Šå¤©å·²ç»æ˜¯ä¸‰æœˆä»½çš„æœ€åä¸€å¤©äº†ï¼Œç»Ÿè®¡æ˜¾ç¤ºæˆ‘è¿™ä¸ªæœˆå·²ç»å‘äº†136ç¯‡åšå®¢ï¼Œå¹³å‡æ¯å¤©å‘è¡¨äº†4ç¯‡ä»¥ä¸Šï¼Œæ€»ä½“æ¥è¯´è¿˜æŒºæ»¡æ„çš„ã€‚ è¿™ä¸ªæœˆçš„åšå®¢åŸºæœ¬ä¸Šæ˜¯åœ¨å†™ä¸€äº›javaé«˜çº§æŠ€æœ¯çš„ä½¿ç”¨ï¼ŒåŸºç¡€çŸ¥è¯†å†™çš„å°‘ä¸€ç‚¹ï¼Œä¸‹é¢æ˜¯æŒ‰ç…§æ—¶é—´çº¿åˆ’åˆ†çš„è¿™ä¸ªæœˆå†™è¿‡çš„åšå®¢ä¸»é¢˜çš„ä¸€ä¸ªåˆ—è¡¨ï¼š Redis SQLè°ƒä¼˜ æ—¥å¿—æ¡†æ¶ SpringBoot RabbitMQ Netty Zookeeper+Dubbo SpringCloud SpringCloud Alibaba Lucene docker æœ€è¿‘å¿™ç€åœ¨åšé¡¹ç›®ï¼Œå¯èƒ½æ¯æ—¥çš„æ›´æ–°æ›´æ–°æ•°è¾¾ä¸åˆ°ä¹‹å‰äº†ï¼Œä¸è¿‡è¿˜æ˜¯èƒ½ä¿è¯æ¯å¤©è‡³å°‘ä¸¤ç¯‡ï¼Œä¸€ç¯‡leetcodeé¢˜è§£ï¼Œå¦ä¸€ç¯‡çš„ä¸»é¢˜å…¶å®æŒºéš¾æƒ³çš„ï¼Œæœ€è¿‘å·²ç»æœ‰ç‚¹ä¸çŸ¥é“å†™ä»€ä¹ˆäº†ï¼Œä¸è¿‡åšé¡¹ç›®è¿™æ®µæ—¶é—´å¯èƒ½å†™çš„å¤šçš„è¿˜æ˜¯Javaé«˜çº§æŠ€æœ¯çš„ä¸€äº›ä½¿ç”¨ã€‚å†å¾€åå¯èƒ½å°±ä¼šå°½é‡å¤šå†™ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œæ¯”å¦‚è®¡ç®—æœºç›¸å…³çš„ï¼Œè¿˜æœ‰æºç ç ”ç©¶å•¥çš„ï¼Œä¹Ÿå¾ˆä¹…æ²¡æ›´æ–°è¿‡äº†ï¼Œæˆ‘è¿˜å¾—è¾¹å¤ä¹ ï¼Œå¥½å¤šä¸œè¥¿å­¦äº†åˆå¿˜ï¼Œå¤ä¹ çš„ä¸œè¥¿ä¹Ÿä¸å¯èƒ½å†™æˆåšå®¢å†å‘è¡¨ä¸€æ¬¡ã€‚ ç„¶åï¼Œè°ˆè°ˆæ–°å† ç—…æ¯’ç–«æƒ…å§ï¼Œè¿™ä¸œè¥¿çœŸçš„è§è¯å†å²ï¼Œä»Šå¤©å…¨çƒç—…ä¾‹æ•°è¾¾åˆ°80ä¸‡äº†ï¼Œè¿™æ•°å­—çœŸæŒºå¯æ€•çš„ã€‚ä¸ä¹…å‰å®£å¸ƒä¸œäº¬å¥¥è¿ä¼šå»¶æœŸåˆ°2021ï¼Œç„¶åä»Šå¤©æ•™è‚²éƒ¨å®£å¸ƒé«˜è€ƒå»¶æœŸä¸€ä¸ªæœˆï¼ŒçœŸçš„æ˜¯å‡ºç”Ÿä»¥æ¥ç¬¬ä¸€æ¬¡è§é«˜è€ƒå»¶æœŸï¼Œè¦æ˜¯ç§‹æ‹›èƒ½å»¶æœŸä¸€ä¸ªæœˆè¯¥å¤šå¥½å•ŠğŸ˜‚ã€‚ ç§‹æ‹›è¶Šæ¥è¶Šè¿‘äº†ï¼Œå¸Œæœ›è‡ªå·±èƒ½æ‰›ä½å‹ï¼Œä¸è¦è¾œè´Ÿè¿™æ®µæ—¶é—´çš„åŠªåŠ›ã€‚ åŠ æ²¹(à¸‡ â€¢_â€¢)à¸‡","categories":[{"name":"æ—¥å¸¸/éšç¬”","slug":"æ—¥å¸¸-éšç¬”","permalink":"https://www.codetool.top/categories/%E6%97%A5%E5%B8%B8-%E9%9A%8F%E7%AC%94/"}],"tags":[{"name":"æ—¥å¸¸","slug":"æ—¥å¸¸","permalink":"https://www.codetool.top/tags/%E6%97%A5%E5%B8%B8/"}]},{"title":"åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFSçš„äº†è§£åŠJavaå®¢æˆ·ç«¯ä½¿ç”¨","slug":"åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFSçš„äº†è§£åŠJavaå®¢æˆ·ç«¯ä½¿ç”¨","date":"2020-03-31T07:38:50.000Z","updated":"2020-03-31T08:16:27.457Z","comments":true,"path":"article/åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFSçš„äº†è§£åŠJavaå®¢æˆ·ç«¯ä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9FFastDFS%E7%9A%84%E4%BA%86%E8%A7%A3%E5%8F%8AJava%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BD%BF%E7%94%A8/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒäºï¼š https://github.com/tobato/FastDFS_Client 1 FastDFSæ¦‚è¿°FastDFSæ˜¯ä¸€ä¸ªå¼€æºçš„è½»é‡çº§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒå¯¹æ–‡ä»¶è¿›è¡Œç®¡ç†ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼šæ–‡ä»¶å­˜å‚¨ã€æ–‡ä»¶åŒæ­¥ã€æ–‡ä»¶è®¿é—®ï¼ˆæ–‡ä»¶ä¸Šä¼ ã€æ–‡ä»¶ä¸‹è½½ï¼‰ç­‰ï¼Œè§£å†³äº†å¤§å®¹é‡å­˜å‚¨å’Œè´Ÿè½½å‡è¡¡çš„é—®é¢˜ã€‚ç‰¹åˆ«é€‚åˆä»¥æ–‡ä»¶ä¸ºè½½ä½“çš„åœ¨çº¿æœåŠ¡ï¼Œå¦‚ç›¸å†Œç½‘ç«™ã€è§†é¢‘ç½‘ç«™ç­‰ç­‰ã€‚ FastDFSä¸ºäº’è”ç½‘é‡èº«å®šåˆ¶ï¼Œå……åˆ†è€ƒè™‘äº†å†—ä½™å¤‡ä»½ã€è´Ÿè½½å‡è¡¡ã€çº¿æ€§æ‰©å®¹ç­‰æœºåˆ¶ï¼Œå¹¶æ³¨é‡é«˜å¯ç”¨ã€é«˜æ€§èƒ½ç­‰æŒ‡æ ‡ï¼Œä½¿ç”¨FastDFSå¾ˆå®¹æ˜“æ­å»ºä¸€å¥—é«˜æ€§èƒ½çš„æ–‡ä»¶æœåŠ¡å™¨é›†ç¾¤æä¾›æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ç­‰æœåŠ¡ã€‚ FastDFSæ˜¯ä¸€ä¸ªè½»é‡çº§çš„å¼€æºåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ FastDFSä¸»è¦è§£å†³äº†å¤§å®¹é‡çš„æ–‡ä»¶å­˜å‚¨å’Œé«˜å¹¶å‘è®¿é—®çš„é—®é¢˜ï¼Œæ–‡ä»¶å­˜å–æ—¶å®ç°äº†è´Ÿè½½å‡è¡¡ FastDFSå®ç°äº†è½¯ä»¶æ–¹å¼çš„RAIDï¼Œå¯ä»¥ä½¿ç”¨å»‰ä»·çš„IDEç¡¬ç›˜è¿›è¡Œå­˜å‚¨ æ”¯æŒå­˜å‚¨æœåŠ¡å™¨åœ¨çº¿æ‰©å®¹ æ”¯æŒç›¸åŒå†…å®¹çš„æ–‡ä»¶åªä¿å­˜ä¸€ä»½ï¼ŒèŠ‚çº¦ç£ç›˜ç©ºé—´ FastDFSåªèƒ½é€šè¿‡Client APIè®¿é—®ï¼Œä¸æ”¯æŒPOSIXè®¿é—®æ–¹å¼ FastDFSç‰¹åˆ«é€‚åˆå¤§ä¸­å‹ç½‘ç«™ä½¿ç”¨ï¼Œç”¨æ¥å­˜å‚¨èµ„æºæ–‡ä»¶ï¼ˆå¦‚ï¼šå›¾ç‰‡ã€æ–‡æ¡£ã€éŸ³é¢‘ã€è§†é¢‘ç­‰ç­‰ï¼‰ 1.1 FastDFSæ¶æ„FastDFS æœåŠ¡ç«¯æ¶æ„åŒ…æ‹¬ Tracker server å’Œ Storage serverã€‚å®¢æˆ·ç«¯è¯·æ±‚ Tracker server è¿›è¡Œæ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ï¼Œé€šè¿‡Tracker server è°ƒåº¦æœ€ç»ˆç”± Storage server å®Œæˆæ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ã€‚ Tracker server ä½œç”¨æ˜¯è´Ÿè½½å‡è¡¡å’Œè°ƒåº¦ï¼Œé€šè¿‡ Tracker server åœ¨æ–‡ä»¶ä¸Šä¼ æ—¶å¯ä»¥æ ¹æ®ä¸€äº›ç­–ç•¥æ‰¾åˆ°Storage server æä¾›æ–‡ä»¶ä¸Šä¼ æœåŠ¡ã€‚å¯ä»¥å°† tracker ç§°ä¸ºè¿½è¸ªæœåŠ¡å™¨æˆ–è°ƒåº¦æœåŠ¡å™¨ã€‚ Storage server ä½œç”¨æ˜¯æ–‡ä»¶å­˜å‚¨ï¼Œå®¢æˆ·ç«¯ä¸Šä¼ çš„æ–‡ä»¶æœ€ç»ˆå­˜å‚¨åœ¨ Storage æœåŠ¡å™¨ä¸Šï¼ŒStorageserver æ²¡æœ‰å®ç°è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿè€Œæ˜¯åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿæ¥ç®¡ç†æ–‡ä»¶ã€‚å¯ä»¥å°†storageç§°ä¸ºå­˜å‚¨æœåŠ¡å™¨ã€‚åŒä¸€ä¸ªç»„çš„storage serverä¹‹é—´ä¼šè¿›è¡Œæ–‡ä»¶çš„åŒæ­¥ï¼Œé€šè¿‡æ•°æ®å†—ä½™ä»¥åšåˆ°é«˜å¯ç”¨ã€‚ 2 ä¸Šä¼ æµç¨‹ clientè¯¢é—®trackerå¯ä»¥ä¸Šä¼ åˆ°å“ªä¸€ä¸ªstorage,æˆ–è€…æŒ‡å®šè·å–æŸä¸ªç»„çš„storage trackerè¿”å›ä¸€å°å¯ç”¨çš„storage clientç›´æ¥å’Œstorageé€šè®¯å®Œæˆæ–‡ä»¶ä¸Šä¼  storageä¿å­˜æ–‡ä»¶ä»¥åç»™clientè¿”å›ç»„å(volume)å’Œæ–‡ä»¶åç§° å®¢æˆ·ç«¯ä¸Šä¼ æ–‡ä»¶åå­˜å‚¨æœåŠ¡å™¨å°†æ–‡ä»¶ ID è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æ–‡ä»¶ ID ç”¨äºä»¥åè®¿é—®è¯¥æ–‡ä»¶çš„ç´¢å¼•ä¿¡æ¯ã€‚æ–‡ä»¶ç´¢å¼•ä¿¡æ¯åŒ…æ‹¬ï¼šç»„åï¼Œè™šæ‹Ÿç£ç›˜è·¯å¾„ï¼Œæ•°æ®ä¸¤çº§ç›®å½•ï¼Œæ–‡ä»¶åã€‚ ä¾‹ï¼š group1/M00/02/44/wKgDrE34E8wAAAAAAAAGkEIYJK42378.shç»„åï¼šgroup1ï¼Œæ–‡ä»¶ä¸Šä¼ åæ‰€åœ¨çš„ storage ç»„åç§°ï¼Œåœ¨æ–‡ä»¶ä¸Šä¼ æˆåŠŸåç”± storage æœåŠ¡å™¨è¿”å›ï¼Œéœ€è¦å®¢æˆ·ç«¯è‡ªè¡Œä¿å­˜ã€‚ è™šæ‹Ÿç£ç›˜è·¯å¾„ï¼šM00ï¼Œstorage é…ç½®çš„è™šæ‹Ÿè·¯å¾„ï¼Œä¸ç£ç›˜é€‰é¡¹store_path*å¯¹åº”ã€‚å¦‚æœé…ç½®äº†store_path0 åˆ™æ˜¯ M00ï¼Œå¦‚æœé…ç½®äº† store_path1 åˆ™æ˜¯ M01ï¼Œä»¥æ­¤ç±»æ¨ã€‚ é…ç½®æ–‡ä»¶ä½ç½®ï¼š/etc/fdfs/storage.conf æ•°æ®ä¸¤çº§ç›®å½•ï¼š/02/44ï¼Œstorage æœåŠ¡å™¨åœ¨æ¯ä¸ªè™šæ‹Ÿç£ç›˜è·¯å¾„ä¸‹åˆ›å»ºçš„ä¸¤çº§ç›®å½•ï¼Œç”¨äºå­˜å‚¨æ•°æ®æ–‡ä»¶ã€‚ æ–‡ä»¶åï¼šwKgDrE34E8wAAAAAAAAGkEIYJK42378.shï¼Œä¸æ–‡ä»¶ä¸Šä¼ æ—¶ä¸åŒã€‚æ˜¯ç”±å­˜å‚¨æœåŠ¡å™¨æ ¹æ®ç‰¹å®šä¿¡æ¯ç”Ÿæˆï¼Œæ–‡ä»¶ååŒ…å«ï¼šæºå­˜å‚¨æœåŠ¡å™¨ IP åœ°å€ã€æ–‡ä»¶åˆ›å»ºæ—¶é—´æˆ³ã€æ–‡ä»¶å¤§å°ã€éšæœºæ•°å’Œæ–‡ä»¶æ‹“å±•åç­‰ä¿¡æ¯ã€‚ è¿™ä¸ªä¾‹å­ä¸­å°±ä»£è¡¨äº†æ–‡ä»¶å­˜å‚¨äºgroup1çš„storage serverä¸­/data/fast_data/data/00/00/ç›®å½•ä¸‹ 3 dockerè¿è¡ŒfastDFSæ‹‰å–é•œåƒ docker pull morunchang/fastdfsè¿è¡Œtracker docker run -d --name fastdfs-tracker --net=host morunchang/fastdfs sh tracker.shè¿è¡Œstorage docker run -d --name fastdfs-storage --net=host -e TRACKER_IP=192.168.176.129:22122 -e GROUP_NAME=group1 morunchang/fastdfs sh storage.sh ä½¿ç”¨çš„ç½‘ç»œæ¨¡å¼æ˜¯â€“net=host, 192.168.176.129æ˜¯å®¿ä¸»æœºçš„IP group1æ˜¯ç»„åï¼Œå³storageçš„ç»„ å¦‚æœæƒ³è¦å¢åŠ æ–°çš„storageæœåŠ¡å™¨ï¼Œå†æ¬¡è¿è¡Œè¯¥å‘½ä»¤ï¼Œæ³¨æ„æ›´æ¢æ–°ç»„å è®¾ç½®å¼€æœºå¯åŠ¨ docker update --restart=always fastdfs-tracker docker update --restart=always fastdfs-storage4 fastDFS-clientä½¿ç”¨æˆ‘ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªæœ€è¿‘è¿˜åœ¨ç»´æŠ¤çš„ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ï¼Œä¸ªäººè§‰å¾—å°è£…å¾—æŒºå¥½çš„ï¼Œå¾ˆå¤šæ“ä½œéƒ½ç®€åŒ–äº†ã€‚ï¼ˆæœ€å¥½æ­é…SpringBootä½¿ç”¨ï¼‰ githubåœ°å€ï¼š https://github.com/tobato/FastDFS_Client &lt;!-- https://mvnrepository.com/artifact/com.github.tobato/fastdfs-client --> &lt;dependency> &lt;groupId>com.github.tobato&lt;/groupId> &lt;artifactId>fastdfs-client&lt;/artifactId> &lt;version>1.27.2&lt;/version> &lt;/dependency> ç„¶åç›´æ¥å¼•å…¥é…ç½®ï¼š fdfs: so-timeout: 1500 # è¯»å–è¶…æ—¶æ—¶é—´ connect-timeout: 600 # è¿æ¥è¶…æ—¶æ—¶é—´ thumb-image: # ç¼©ç•¥å›¾ç”Ÿæˆå‚æ•° width: 150 height: 150 tracker-list: #TrackerListå‚æ•°,æ”¯æŒå¤šä¸ª - 192.168.176.129:22122 # è¿™ä¸ªæ˜¯è‡ªå®šä¹‰é…ç½®é¡¹ nginx-url: http://192.168.176.129:8080 å°±å¯ä»¥ä½¿ç”¨äº† ä¾‹ï¼Œæ–‡ä»¶ä¸Šä¼ ï¼š @Service public class FileService { @Resource private FastFileStorageClient storageClient; @Value(\"${fdfs.nginx-url}\") private String trackerUrl; /** * ä¸Šä¼ æ–‡ä»¶ï¼Œè¿”å›èµ„æºurl * @param file * @return */ public String upload(FastFile file){ StorePath storePath = storageClient.uploadFile(file); return trackerUrl+\"/\"+storePath.getFullPath(); } public String getTrackerUrl(){ return trackerUrl; } } @RestController public class FileController { @Resource FileService fileService; /** * æ–‡ä»¶ä¸Šä¼  * @param file * @return èµ„æºurl * @throws Exception */ @PostMapping(value = \"/upload\") public Result&lt;String> upload(@RequestParam(\"file\") MultipartFile file) throws Exception { //è·å–åç¼€å String suffix = file.getOriginalFilename().substring(file.getOriginalFilename().lastIndexOf(\".\") + 1); Set&lt;MetaData> metaDataSet = new HashSet&lt;>(); //é™„å¸¦æ–‡ä»¶åå…ƒä¿¡æ¯ä¸Šä¼  metaDataSet.add(new MetaData(\"originName\",file.getName())); FastFile fastFile = new FastFile(file.getInputStream(),file.getSize(),suffix,null); //æ–‡ä»¶ä¸Šä¼  String path = fileService.upload(fastFile); return new Result&lt;String>(true, StatusCode.OK,\"æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼\",path); } }","categories":[{"name":"é¡¹ç›®/ç¼–ç¨‹ç†è®º","slug":"é¡¹ç›®-ç¼–ç¨‹ç†è®º","permalink":"https://www.codetool.top/categories/%E9%A1%B9%E7%9B%AE-%E7%BC%96%E7%A8%8B%E7%90%86%E8%AE%BA/"}],"tags":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"https://www.codetool.top/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"},{"name":"FastDFS","slug":"FastDFS","permalink":"https://www.codetool.top/tags/FastDFS/"}]},{"title":"leetcode912-æ’åºæ•°ç»„","slug":"leetcode912-æ’åºæ•°ç»„","date":"2020-03-31T01:24:36.000Z","updated":"2020-03-31T01:35:03.065Z","comments":true,"path":"article/leetcode912-æ’åºæ•°ç»„/","link":"","permalink":"https://www.codetool.top/article/leetcode912-%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼Œå°†è¯¥æ•°ç»„å‡åºæ’åˆ—ã€‚ ç¤ºä¾‹ 1: è¾“å…¥ï¼š [5,2,3,1]è¾“å‡ºï¼š [1,2,3,5] ç¤ºä¾‹ 2: è¾“å…¥ï¼š [5,1,1,2,0,0]è¾“å‡ºï¼š [0,0,1,1,2,5] æç¤ºï¼š 1 &lt;= A.length &lt;= 10000 -50000 &lt;= A[i] &lt;= 50000 2 è§£æ³•2.1 æ€æƒ³ç»å…¸æ’åºé—®é¢˜ï¼Œè§£æ³•è§åå¤§æ’åºç®—æ³•ä¸Javaå®ç° 2.2 ä»£ç è®¡æ•°æ’åºï¼š class Solution { public int[] sortArray(int[] nums) { int[] occur = new int[100001]; for(int num:nums){ occur[num+50000]++; } int index = 0; for(int i = 0;i&lt;100001;i++){ if(occur[i]!=0){ for(int n = 0 ; n &lt; occur[i];n++){ nums[index] = i-50000; index++; } } } return nums; } } å¿«é€Ÿæ’åºï¼Œè¿™é‡Œæ¯æ¬¡é€‰å–ä¸­è½´å…ƒç´ éƒ½æ˜¯é€‰å–çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼š class Solution { public int[] sortArray(int[] nums) { return quickSort(nums,0,nums.length-1); } private int[] quickSort(int[] arr, int left, int right) { if (left &lt; right) { //è·å–ä¸­è½´å…ƒç´ æ‰€å¤„çš„ä½ç½® int mid = partition(arr, left, right); //è¿›è¡Œåˆ†å‰² arr = quickSort(arr, left, mid - 1); arr = quickSort(arr, mid + 1, right); } return arr; } private int partition(int[] arr, int left, int right) { //é€‰å–ä¸­è½´å…ƒç´  int pivot = arr[left]; int i = left + 1; int j = right; while (true) { // å‘å³æ‰¾åˆ°ç¬¬ä¸€ä¸ªå°äºç­‰äº pivot çš„å…ƒç´ ä½ç½® while (i &lt;= j &amp;&amp; arr[i] &lt;= pivot) i++; // å‘å·¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºç­‰äº pivot çš„å…ƒç´ ä½ç½® while(i &lt;= j &amp;&amp; arr[j] >= pivot ) j--; if(i >= j) break; //äº¤æ¢ä¸¤ä¸ªå…ƒç´ çš„ä½ç½®ï¼Œä½¿å¾—å·¦è¾¹çš„å…ƒç´ ä¸å¤§äºpivot,å³è¾¹çš„ä¸å°äºpivot int temp = arr[i]; arr[i] = arr[j]; arr[j] = temp; } arr[left] = arr[j]; // ä½¿ä¸­è½´å…ƒç´ å¤„äºæœ‰åºçš„ä½ç½® arr[j] = pivot; return j; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"å›½äººå¼€å‘çš„Mybatiså°å·¥å…·-é€šç”¨Mapperå’ŒPageHelper","slug":"å›½äººå¼€å‘çš„Mybatiså°å·¥å…·-é€šç”¨Mapperå’ŒPageHelper","date":"2020-03-30T11:07:39.000Z","updated":"2020-03-30T11:16:34.607Z","comments":true,"path":"article/å›½äººå¼€å‘çš„Mybatiså°å·¥å…·-é€šç”¨Mapperå’ŒPageHelper/","link":"","permalink":"https://www.codetool.top/article/%E5%9B%BD%E4%BA%BA%E5%BC%80%E5%8F%91%E7%9A%84Mybatis%E5%B0%8F%E5%B7%A5%E5%85%B7-%E9%80%9A%E7%94%A8Mapper%E5%92%8CPageHelper/","excerpt":"","text":"1 é€šç”¨Mapperé€šç”¨Mapperä¸Pagehelperæ˜¯ä¸€ä½å›½å†…å¤§ç¥å†™çš„ç®€åŒ–Mybatiså¼€å‘çš„ä¸¤é¡¹æŠ€æœ¯ï¼Œé€šç”¨Mapperé…åˆORMæ˜ å°„æ³¨è§£å¯ä»¥åšåˆ°ä¸å†™sqlè¯­å¥å’Œmapperæ–¹æ³•ï¼Œè€ŒPagehelperå¯ä»¥ç®€åŒ–åˆ†é¡µæ“ä½œã€‚ ä½œè€…çš„githubï¼š https://github.com/abel533 ä½œè€…çš„åšå®¢ï¼š https://blog.csdn.net/isea533 æœ¬æ–‡å‚è€ƒäºä½œè€…æä¾›çš„ä½¿ç”¨æ–‡æ¡£ã€‚ 1.1 ä½¿ç”¨ä¾èµ–ï¼š &lt;!-- é€šç”¨mapper --> &lt;dependency> &lt;groupId>tk.mybatis&lt;/groupId> &lt;artifactId>mapper-spring-boot-starter&lt;/artifactId> &lt;version>2.1.5&lt;/version> &lt;/dependency> &lt;!-- Mybatis-starter --> &lt;dependency> &lt;groupId>org.mybatis.spring.boot&lt;/groupId> &lt;artifactId>mybatis-spring-boot-starter&lt;/artifactId> &lt;/dependency> &lt;!-- JPAæ³¨è§£ --> &lt;dependency> &lt;groupId>javax.persistence&lt;/groupId> &lt;artifactId>persistence-api&lt;/artifactId> &lt;version>1.0&lt;/version> &lt;scope>compile&lt;/scope> &lt;/dependency> ä¸ºæ‰€æœ‰çš„mapperæ¥å£æ·»åŠ @Mapperæ³¨è§£ é…ç½®ç±»æ·»åŠ @MapperScanæ³¨è§£ ä¾‹å¦‚ï¼šç›´æ¥åœ¨å¯åŠ¨ç±»ä¸Šæ ‡æ³¨Mapperæ‰«æåŒ… @MapperScan(basePackages = {\"com.rhett.dao\"}) public class GoodsApplication { public static void main(String[] args) { SpringApplication.run(GoodsApplication.class, args); } } 1.2 ORMæ˜ å°„æ³¨è§£é€šç”¨ Mapper ä½¿ç”¨ä¸€éƒ¨åˆ† JPA æ³¨è§£å’Œè‡ªå·±æä¾›çš„æ³¨è§£æ¥å®ç°å¯¹è±¡å…³ç³»æ˜ å°„ 1.2.1 Idæœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œåªéœ€è¦ä¸€ä¸ª @Id æ ‡è®°å­—æ®µä¸ºä¸»é”®å³å¯ã€‚æ•°æ®åº“ä¸­çš„å­—æ®µåå’Œå®ä½“ç±»çš„å­—æ®µåæ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œè¿™ä¸­æƒ…å†µä¸‹å®ä½“å’Œè¡¨å¯ä»¥ç›´æ¥æ˜ å°„ã€‚ å‡è®¾æœ‰ä¸€æ•°æ®åº“è¡¨ï¼š CREATE TABLE `country` ( `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®', `countryname` varchar(255) DEFAULT NULL COMMENT 'åç§°', `countrycode` varchar(255) DEFAULT NULL COMMENT 'ä»£ç ', PRIMARY KEY (`Id`) ) ENGINE=InnoDB AUTO_INCREMENT=10011 DEFAULT CHARSET=utf8 COMMENT='å›½å®¶ä¿¡æ¯'; å¯¹åº”javaå®ä½“ç±»ï¼š public class Country { @Id private Integer id; private String countryname; private String countrycode; //çœç•¥ getter å’Œ setter } 1.2.2 NameStyle@NameStyleåœ¨ç±»ä¸Šè¿›è¡Œé…ç½®ï¼Œè¡¨ç¤ºå­—æ®µåçš„æ˜ å°„é£æ ¼ï¼Œå®ƒçš„å–å€¼åœ¨Styleä¸­æšä¸¾ï¼Œå…±æœ‰ï¼š normal åŸå€¼ camelhump é©¼å³°è½¬ä¸‹åˆ’çº¿ uppercase è½¬æ¢ä¸ºå¤§å†™ lowercase è½¬æ¢ä¸ºå°å†™ camelhumpAndUppercase é©¼å³°è½¬ä¸‹åˆ’çº¿å¤§å†™å½¢å¼ camelhumpAndLowercase é©¼å³°è½¬ä¸‹åˆ’çº¿å°å†™å½¢å¼ ä¾‹ï¼š @NameStyle(Style.camelhumpAndUppercase) public class Country 1.2.3 TableæŒ‡å®šå¯¹åº”çš„è¡¨åï¼Œæ²¡é…ç½®æ—¶æŒ‰ç±»åè‡ªåŠ¨è½¬æ¢ ä¾‹ï¼š @Table(name = \"sys_user\") public class User 1.2.4 ColumnæŒ‡å®šå¯¹åº”çš„å­—æ®µæ˜ å°„åï¼Œæ²¡é…ç½®æ—¶é»˜è®¤å’Œå­—æ®µåç›¸åŒ ä¾‹ï¼š @Column(name = \"user_name\") private String name; 1.2.5 Transientä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå®ä½“ä¸­çš„å­—æ®µå’Œæ•°æ®åº“è¡¨ä¸­çš„å­—æ®µæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¾ˆå¤šæƒ…å†µæˆ‘ä»¬ä¼šåœ¨å®ä½“ä¸­å¢åŠ ä¸€äº›é¢å¤–çš„å±æ€§ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå°±éœ€è¦ä½¿ç”¨ @Transient æ³¨è§£æ¥å‘Šè¯‰é€šç”¨ Mapper è¿™ä¸æ˜¯è¡¨ä¸­çš„å­—æ®µã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰ç®€å•ç±»å‹ä¼šè¢«è‡ªåŠ¨è®¤ä¸ºæ˜¯è¡¨ä¸­çš„å­—æ®µã€‚ è¿™é‡Œçš„ç®€å•ç±»å‹ä¸åŒ…å« Java ä¸­çš„8ç§åŸºæœ¬ç±»å‹ï¼š byte,short,int,long,float,double,char,boolean è¿™æ˜¯å› ä¸ºåœ¨ç±»ä¸­ï¼ŒåŸºæœ¬ç±»å‹ä¼šæœ‰é»˜è®¤å€¼ï¼Œè€Œ MyBatis ä¸­ç»å¸¸ä¼šéœ€è¦åˆ¤æ–­å±æ€§å€¼æ˜¯å¦ä¸ºç©ºï¼Œæ‰€ä»¥ä¸è¦åœ¨ç±»ä¸­ä½¿ç”¨åŸºæœ¬ç±»å‹ï¼Œå¦åˆ™ä¼šé‡åˆ°è«åå…¶å¦™çš„é”™è¯¯ã€‚ å¯¹äºç±»ä¸­çš„å¤æ‚å¯¹è±¡ï¼Œä»¥åŠ Map,List ç­‰å±æ€§ä¸éœ€è¦é…ç½®è¿™ä¸ªæ³¨è§£ã€‚ 1.3 ä½¿ç”¨Mapperåˆ™å…ˆå†™ä¸€ä¸ªMapperæ¥å£ï¼Œè¦ç»§æ‰¿tk.mybatis.mapper.common.Mapperï¼Œè¯¥ç±»æœ‰å¾ˆå¤šä»£è¡¨æ•°æ®åº“æ“ä½œçš„æ–¹æ³•ï¼š import tk.mybatis.mapper.common.Mapper; public interface CountryMapper extends Mapper&lt;Country> { } ä» MyBatis ä¸­è·å–è¯¥æ¥å£åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š //ä» MyBatis æˆ–è€… Spring ä¸­è·å– countryMapperï¼Œç„¶åè°ƒç”¨ selectAll æ–¹æ³• List&lt;Country> countries = countryMapper.selectAll(); //æ ¹æ®ä¸»é”®æŸ¥è¯¢ Country country = countryMapper.selectByPrimaryKey(1); //æˆ–è€…ä½¿ç”¨å¯¹è±¡ä¼ å‚ï¼Œé€‚ç”¨äº1ä¸ªå­—æ®µæˆ–è€…å¤šä¸ªå­—æ®µè”åˆä¸»é”®ä½¿ç”¨ Country query = new Country(); query.setId(1); country = countryMapper.selectByPrimaryKey(query); 1.4 è‡ªå®šä¹‰æ–¹æ³•å®ç°å¦‚æœæƒ³è¦å¢åŠ è‡ªå·±å†™çš„æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥åœ¨ CountryMapper ä¸­å¢åŠ ã€‚ 1.4.1 çº¯æ¥å£æ³¨è§£æ–¹å¼import org.apache.ibatis.annotations.Select; import tk.mybatis.mapper.common.Mapper; public interface CountryMapper extends Mapper&lt;Country> { @Select(\"select * from country where countryname = #{countryname}\") Country selectByCountryName(String countryname); } 1.4.2 å¦‚æœä½¿ç”¨ XML æ–¹å¼ï¼Œéœ€è¦æä¾›æ¥å£å¯¹åº”çš„ XML æ–‡ä»¶ä¾‹å¦‚æä¾›äº† CountryMapper.xml æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š &lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"> &lt;mapper namespace=\"tk.mybatis.sample.mapper.CountryMapper\"> &lt;select id=\"selectByCountryName\" resultType=\"tk.mybatis.model.Country\"> select * from country where countryname = #{countryname} &lt;/select> &lt;/mapper> åœ¨æ¥å£ä¸­æ·»åŠ å¯¹åº”çš„æ–¹æ³•ï¼š import tk.mybatis.mapper.common.Mapper; public interface CountryMapper extends Mapper&lt;Country> { Country selectByCountryName(String countryname); } åœ¨æ¥å£ä¸­æ·»åŠ å…¶ä»–æ–¹æ³•çš„æ—¶å€™å’Œåªç”¨ MyBatis æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œåœ¨å¯¹åº”çš„ XML ä¸­ï¼Œä¸èƒ½å‡ºç°å’Œç»§æ‰¿æ¥å£ä¸­åŒåçš„æ–¹æ³•ï¼ 2 PageHelper2.1 ä»‹ç»PageHelperæ˜¯åŸºäºMybatisçš„æ’ä»¶æœºåˆ¶å¼€å‘çš„ï¼ŒMybatisæ”¯æŒç¼–å†™æ‹¦æˆªå™¨ï¼Œåœ¨Mybatisçš„åº•å±‚æ–¹æ³•ä¸­è¿›è¡Œæ‹¦æˆªï¼Œå¦‚æ‰“å°æ‰§è¡Œçš„SQLè¯­å¥æ—¥å¿—ï¼Œåšä¸€äº›æƒé™æ§åˆ¶ï¼Œåˆ†é¡µç­‰åŠŸèƒ½ã€‚ PageHelperå°±æ˜¯é€šè¿‡æ‹¦æˆªäº†Mybatisä¸­Executorçš„queryæ–¹æ³•çš„æ‰§è¡Œï¼Œæ¥å®ç°æŸ¥è¯¢æ—¶åˆ†é¡µé€»è¾‘çš„æ·»åŠ ã€‚ æ‹¦æˆªå™¨éƒ¨åˆ†æºç ï¼š @Intercepts( { @Signature(type = Executor.class, method = \"query\", args = {MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class}), @Signature(type = Executor.class, method = \"query\", args = {MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class, CacheKey.class, BoundSql.class}), } ) public class PageInterceptor implements Interceptor { private volatile Dialect dialect; private String countSuffix = \"_COUNT\"; protected Cache&lt;String, MappedStatement> msCountMap = null; private String default_dialect_class = \"com.github.pagehelper.PageHelper\"; @Override public Object intercept(Invocation invocation) throws Throwable { //... } 2.2 PageHelperçš„ä½¿ç”¨å¼•å…¥ä¾èµ–ï¼š &lt;dependency> &lt;groupId>com.github.pagehelper&lt;/groupId> &lt;artifactId>pagehelper-spring-boot-starter&lt;/artifactId> &lt;version>1.2.13&lt;/version> &lt;/dependency> ä½¿ç”¨ï¼š //ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºé¡µæ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå•é¡µçš„æ¡æ•° //ç¬¬ä¸‰ä¸ªå‚æ•°è¿™é‡Œæ˜¯æ ¹æ®stu_idé™åºæ’åº PageHelper.startPage(1,5,\"stu_id desc\"); //åœ¨startPageåé¢ç´§è·Ÿä¸€ä¸ªæŸ¥è¯¢é›†åˆæ–¹æ³• List&lt;Student> list = studentMapper.selectAll();","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Mybatis","slug":"Mybatis","permalink":"https://www.codetool.top/tags/Mybatis/"}]},{"title":"å‰‘æŒ‡offer62-åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—","slug":"å‰‘æŒ‡offer62-åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—","date":"2020-03-30T01:54:24.000Z","updated":"2020-03-30T01:58:59.322Z","comments":true,"path":"article/å‰‘æŒ‡offer62-åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—/","link":"","permalink":"https://www.codetool.top/article/%E5%89%91%E6%8C%87offer62-%E5%9C%86%E5%9C%88%E4%B8%AD%E6%9C%80%E5%90%8E%E5%89%A9%E4%B8%8B%E7%9A%84%E6%95%B0%E5%AD%97/","excerpt":"","text":"1 åŸé¢˜ï¼ˆæ¥æºLeetcodeï¼‰0,1,,n-1è¿™nä¸ªæ•°å­—æ’æˆä¸€ä¸ªåœ†åœˆï¼Œä»æ•°å­—0å¼€å§‹ï¼Œæ¯æ¬¡ä»è¿™ä¸ªåœ†åœˆé‡Œåˆ é™¤ç¬¬mä¸ªæ•°å­—ã€‚æ±‚å‡ºè¿™ä¸ªåœ†åœˆé‡Œå‰©ä¸‹çš„æœ€åä¸€ä¸ªæ•°å­—ã€‚ ä¾‹å¦‚ï¼Œ0ã€1ã€2ã€3ã€4è¿™5ä¸ªæ•°å­—ç»„æˆä¸€ä¸ªåœ†åœˆï¼Œä»æ•°å­—0å¼€å§‹æ¯æ¬¡åˆ é™¤ç¬¬3ä¸ªæ•°å­—ï¼Œåˆ™åˆ é™¤çš„å‰4ä¸ªæ•°å­—ä¾æ¬¡æ˜¯2ã€0ã€4ã€1ï¼Œå› æ­¤æœ€åå‰©ä¸‹çš„æ•°å­—æ˜¯3ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: n = 5, m = 3è¾“å‡º: 3 ç¤ºä¾‹ 2: è¾“å…¥: n = 10, m = 17è¾“å‡º: 2 é™åˆ¶ï¼š 1 &lt;= n &lt;= 10^5 1 &lt;= m &lt;= 10^6 2 è§£æ³•2.1 æ€æƒ³çº¦ç‘Ÿå¤«é—®é¢˜ï¼Œleetcodeä¸Šé¢åªèƒ½ç”¨æ•°å­¦è§£æ³•ï¼Œå¦åˆ™ä¼šè¶…æ—¶ã€‚ è§£æ³•å‚è€ƒï¼š å›¾è§£çº¦ç‘Ÿå¤«ç¯ï¼Œè¿˜é€ã€Šå…·ä½“æ•°å­¦ã€‹PDF ğŸ³åƒé²¸ Î£(ã£ Â°Ğ” Â°;)ã£ - åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­— - åŠ›æ‰£ï¼ˆLeetCodeï¼‰ 2.2 ä»£ç class Solution { int f(int n, int m) { if (n == 1) return 0; int x = f(n - 1, m); return (m + x) % n; } public int lastRemaining(int n, int m) { return f(n, m); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"å‰‘æŒ‡offer","slug":"å‰‘æŒ‡offer","permalink":"https://www.codetool.top/tags/%E5%89%91%E6%8C%87offer/"}]},{"title":"docker-composeä½¿ç”¨å’Œdockerç§æœ‰ä»“åº“æ­å»º","slug":"docker-composeä½¿ç”¨å’Œdockerç§æœ‰ä»“åº“æ­å»º","date":"2020-03-29T14:11:31.000Z","updated":"2020-03-29T14:12:22.252Z","comments":true,"path":"article/docker-composeä½¿ç”¨å’Œdockerç§æœ‰ä»“åº“æ­å»º/","link":"","permalink":"https://www.codetool.top/article/docker-compose%E4%BD%BF%E7%94%A8%E5%92%8Cdocker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93%E6%90%AD%E5%BB%BA/","excerpt":"","text":"1 docker-compose1.1 ä»‹ç»ä¸å®‰è£…å¾®æœåŠ¡æ¶æ„çš„åº”ç”¨ç³»ç»Ÿä¸­ä¸€èˆ¬åŒ…å«è‹¥å¹²ä¸ªå¾®æœåŠ¡ï¼Œæ¯ä¸ªå¾®æœåŠ¡ä¸€èˆ¬éƒ½ä¼šéƒ¨ç½²å¤šä¸ªå®ä¾‹ï¼Œå¦‚æœæ¯ä¸ªå¾®æœåŠ¡éƒ½è¦æ‰‹åŠ¨å¯åœï¼Œç»´æŠ¤çš„å·¥ä½œé‡ä¼šå¾ˆå¤§ã€‚ Docker Composeæ˜¯ä¸€ä¸ªç¼–æ’å¤šå®¹å™¨åˆ†å¸ƒå¼éƒ¨ç½²çš„å·¥å…·ï¼Œæä¾›å‘½ä»¤é›†ç®¡ç†å®¹å™¨åŒ–åº”ç”¨çš„å®Œæ•´å¼€å‘å‘¨æœŸï¼ŒåŒ…æ‹¬æœåŠ¡æ„å»ºï¼Œå¯åŠ¨å’Œåœæ­¢ã€‚ä½¿ç”¨æ­¥éª¤ï¼š åˆ©ç”¨ Dockerfile å®šä¹‰è¿è¡Œç¯å¢ƒé•œåƒ ä½¿ç”¨ docker-compose.yml å®šä¹‰ç»„æˆåº”ç”¨çš„å„æœåŠ¡ è¿è¡Œ docker-compose up å¯åŠ¨åº”ç”¨ ä¸‹è½½ï¼š https://github.com/docker/compose/releases/ è¿™é‡Œé€‰æ‹©1.25.4ç‰ˆæœ¬ä¸‹è½½ï¼Œä¸‹è½½ä¸‹æ¥çš„å°±æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œèµ‹äºˆæ‰§è¡Œæƒé™ï¼Œå¯ä»¥å°†å…¶ç§»åŠ¨åˆ°/usr/binç›®å½•ä¸‹ï¼š wget https://github.com/docker/compose/releases/download/1.25.4/docker-compose-Linux-x86_64 chmod +x docker-compose-Linux-x86_64 mv docker-compose-Linux-x86_64 /usr/bin/docker-composeæŸ¥çœ‹ç‰ˆæœ¬ docker-compose -version1.2 ä½¿ç”¨åˆ›å»ºä¸€ä¸ªdocker-composeç›®å½•ç”¨äºæµ‹è¯• mkdir ~/docker-compose cd ~/docker-composeç¼–å†™ docker-compose.yml æ–‡ä»¶ï¼š version: '3' services: # ä»£è¡¨è¦å¯åŠ¨çš„å®¹å™¨ nginx: image: nginx ports: - 80:80 links: - app volumes: - ./nginx/conf.d:/etc/nginx/conf.d app: image: app expose: - \"8080\" æ‰§è¡Œå‘½ä»¤ docker-compose upå³å¯è¿è¡Œã€‚ 2 dockerç§æœ‰ä»“åº“Dockerå®˜æ–¹çš„Docker hubï¼ˆhttps://hub.docker.comï¼‰æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†å…¬å…±é•œåƒçš„ä»“åº“ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸Šé¢æ‹‰å–é•œåƒ åˆ°æœ¬åœ°ï¼Œä¹Ÿå¯ä»¥æŠŠæˆ‘ä»¬è‡ªå·±çš„é•œåƒæ¨é€ä¸Šå»ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬çš„æœåŠ¡å™¨æ— æ³•è®¿é—®äº’è”ç½‘ï¼Œæˆ–è€…ä½ ä¸å¸Œæœ›å°†è‡ªå·±çš„é•œåƒæ”¾åˆ°å…¬ç½‘å½“ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦æ­å»ºè‡ªå·±çš„ç§æœ‰ä»“åº“æ¥å­˜å‚¨å’Œç®¡ç†è‡ªå·±çš„é•œåƒã€‚ 2.1 ç§æœ‰ä»“åº“æ­å»º# 1ã€æ‹‰å–ç§æœ‰ä»“åº“é•œåƒ docker pull registry # 2ã€å¯åŠ¨ç§æœ‰ä»“åº“å®¹å™¨ docker run -id --name=registry -p 5000:5000 registry æ‰“å¼€æµè§ˆå™¨ è¾“å…¥åœ°å€ http://ç§æœ‰ä»“åº“æœåŠ¡å™¨ip:5000/v2/_catalog ï¼Œçœ‹åˆ°{&quot;repositories&quot;:[]} è¡¨ç¤ºç§æœ‰ä»“åº“ æ­å»ºæˆåŠŸ 3ã€ä¿®æ”¹daemon.json vim /etc/docker/daemon.json åœ¨ä¸Šè¿°æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªkeyï¼Œä¿å­˜é€€å‡ºã€‚æ­¤æ­¥ç”¨äºè®© docker ä¿¡ä»»ç§æœ‰ä»“åº“åœ°å€ï¼›æ³¨æ„å°†ç§æœ‰ä»“åº“æœåŠ¡å™¨ipä¿®æ”¹ä¸ºè‡ªå·±ç§æœ‰ä»“åº“æœåŠ¡å™¨çœŸå®ip {&quot;insecure-registries&quot;:[&quot;ç§æœ‰ä»“åº“æœåŠ¡å™¨ip:5000&quot;]} 4ã€é‡å¯docker æœåŠ¡ systemctl restart docker docker start registry2.2 å°†é•œåƒä¸Šä¼ è‡³ç§æœ‰ä»“åº“# 1ã€æ ‡è®°é•œåƒä¸ºç§æœ‰ä»“åº“çš„é•œåƒ docker tag centos:7 ç§æœ‰ä»“åº“æœåŠ¡å™¨IP:5000/centos:7 # 2ã€ä¸Šä¼ æ ‡è®°çš„é•œåƒ docker push ç§æœ‰ä»“åº“æœåŠ¡å™¨IP:5000/centos:7 2.3 ä»ç§æœ‰ä»“åº“æ‹‰å–é•œåƒ# æ‹‰å–é•œåƒ docker pull ç§æœ‰ä»“åº“æœåŠ¡å™¨ip:5000/centos:7","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"docker","slug":"docker","permalink":"https://www.codetool.top/tags/docker/"}]},{"title":"dockeré•œåƒåŸç†ä¸dockerfile","slug":"dockeré•œåƒåŸç†ä¸dockerfile","date":"2020-03-29T10:20:24.000Z","updated":"2020-03-29T14:12:24.869Z","comments":true,"path":"article/dockeré•œåƒåŸç†ä¸dockerfile/","link":"","permalink":"https://www.codetool.top/article/docker%E9%95%9C%E5%83%8F%E5%8E%9F%E7%90%86%E4%B8%8Edockerfile/","excerpt":"","text":"1 Docker é•œåƒæœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯ä¸€ä¸ªåˆ†å±‚æ–‡ä»¶ç³»ç»Ÿ ç»Ÿä¸€æ–‡ä»¶ç³»ç»Ÿï¼ˆUnion File Systemï¼‰æŠ€æœ¯èƒ½å¤Ÿå°†ä¸åŒçš„å±‚æ•´åˆæˆä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä¸ºè¿™äº›å±‚æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„è§†è§’ï¼Œè¿™æ ·å°±éšè—äº†å¤šå±‚çš„å­˜åœ¨ï¼Œåœ¨ç”¨æˆ·çš„è§’åº¦çœ‹æ¥ï¼Œåªå­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿã€‚ ä¸€ä¸ªé•œåƒå¯ä»¥æ”¾åœ¨å¦ä¸€ä¸ªé•œåƒçš„ä¸Šé¢ã€‚ä½äºä¸‹é¢çš„é•œåƒç§°ä¸ºçˆ¶é•œåƒï¼Œæœ€åº•éƒ¨çš„é•œåƒæˆä¸ºåŸºç¡€é•œåƒã€‚ å½“ä»ä¸€ä¸ªé•œåƒå¯åŠ¨å®¹å™¨æ—¶ï¼ŒDockerä¼šåœ¨æœ€é¡¶å±‚åŠ è½½ä¸€ä¸ªè¯»å†™æ–‡ä»¶ç³»ç»Ÿä½œä¸ºå®¹å™¨ 2 Docker ä¸­ä¸€ä¸ªcentosé•œåƒä¸ºä»€ä¹ˆåªæœ‰200MBï¼Œè€Œä¸€ä¸ªcentosæ“ä½œç³»ç»Ÿçš„isoæ–‡ä»¶è¦å‡ ä¸ªä¸ªGï¼ŸDockeré•œåƒæ˜¯ç”±ç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿå åŠ è€Œæˆï¼Œæœ€åº•ç«¯æ˜¯ bootfsï¼Œå¹¶ä½¿ç”¨å®¿ä¸»æœºçš„ bootfsã€‚ ç¬¬äºŒå±‚æ˜¯rootæ–‡ä»¶ç³»ç»Ÿrootfs,ç§°ä¸ºbase imageç„¶åå†å¾€ä¸Šå¯ä»¥å åŠ å…¶ä»–çš„é•œåƒæ–‡ä»¶ Centosçš„isoé•œåƒæ–‡ä»¶åŒ…å«bootfså’Œrootfsï¼Œè€Œdockerçš„centosé•œåƒå¤ç”¨æ“ä½œç³»ç»Ÿçš„bootfsï¼Œåªæœ‰rootfså’Œå…¶ä»–é•œåƒå±‚ Docker ä¸­ä¸€ä¸ªtomcaté•œåƒä¸ºä»€ä¹ˆæœ‰500MBï¼Œè€Œä¸€ä¸ªtomcatå®‰è£…åŒ…åªæœ‰70å¤šMBï¼Ÿ ç”±äºdockerä¸­é•œåƒæ˜¯åˆ†å±‚çš„ï¼Œtomcatè™½ç„¶åªæœ‰70å¤šMBï¼Œä½†ä»–éœ€è¦ä¾èµ–äºçˆ¶é•œåƒå’ŒåŸºç¡€é•œåƒï¼Œæ‰€æœ‰æ•´ä¸ªå¯¹å¤–æš´éœ²çš„tomcaté•œåƒå¤§å°500å¤šMB ä½¿ç”¨docker inspect é•œåƒåä¹Ÿå¯ä»¥çœ‹åˆ°layersï¼Œå³åˆ†å±‚é•œåƒã€‚ 3 dockerfileå®¹å™¨è½¬æˆé•œåƒï¼š docker commit å®¹å™¨id é•œåƒåç§°:ç‰ˆæœ¬å·å‹ç¼©å’Œè§£å‹ï¼š docker save -o å‹ç¼©æ–‡ä»¶åç§° é•œåƒåç§°:ç‰ˆæœ¬å· docker load -i å‹ç¼©æ–‡ä»¶åç§°é™¤æ­¤ä¹‹å¤–ï¼Œå¯ä»¥ç”¨dockerfileæ¥åˆ¶ä½œé•œåƒã€‚ 3.1 è¯­æ³•3.1.1 FROM &amp; RUN &amp; USERFrom debian:wheezy USER cowsay Run apt-get update && apt-get install -y cowsay fortune FROMæŒ‡ä»¤æŒ‡å®šåˆå§‹é•œåƒï¼Œè¿™é‡Œä½¿ç”¨debianï¼Œå¹¶ä¸”æŒ‡å®šäº†wheezyç‰ˆæœ¬ USERæŒ‡å®šbuildæˆ–å¯åŠ¨çš„æ—¶å€™ï¼Œrun cmd entrypointæ‰§è¡Œæ—¶ä½¿ç”¨çš„ç”¨æˆ·ã€‚ RUNç”¨äºæ‰§è¡ŒæŒ‡ä»¤ 3.1.2 ENTRYPOINTENTRYPOINT [\"/usr/games/cowsay\"] ENTRYPOINTæŒ‡å®šä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¼ ç»™docker runä½œå‚æ•°ï¼Œä¸€èˆ¬åœ¨åˆ¶ä½œä¸€äº›æ‰§è¡Œå°±å…³é—­çš„å®¹å™¨ä¸­ä¼šä½¿ç”¨ã€‚ 3.1.3 COPY &amp; ADDCOPY entrypoint.sh / ADD entrypoint.sh / æŠŠä¸€ä¸ªæ–‡ä»¶ä»ä¸»æœºï¼ˆå¯ä½¿ç”¨dockerfileæ‰€åœ¨è·¯å¾„çš„ç›¸å¯¹è·¯å¾„ï¼‰å¤åˆ¶åˆ°é•œåƒçš„æ–‡ä»¶ç³»ç»Ÿã€‚COPYæŒ‡ä»¤å’ŒADDæŒ‡ä»¤çš„å”¯ä¸€åŒºåˆ«åœ¨äºæ˜¯å¦æ”¯æŒä»è¿œç¨‹URLè·å–èµ„æºã€‚COPYæŒ‡ä»¤åªèƒ½ä»æ‰§è¡Œdocker buildæ‰€åœ¨çš„ä¸»æœºä¸Šè¯»å–èµ„æºå¹¶å¤åˆ¶åˆ°é•œåƒä¸­ã€‚è€ŒADDæŒ‡ä»¤è¿˜æ”¯æŒé€šè¿‡URLä»è¿œç¨‹æœåŠ¡å™¨è¯»å–èµ„æºå¹¶å¤åˆ¶åˆ°é•œåƒä¸­ã€‚ 3.1.4 ENV &amp; ARGENV NGINX_VERSION 1.17.9 æŒ‡å®šç¯å¢ƒå˜é‡ ARG some_variable_name=default_value RUN echo \"Oh dang look at that $some_variable_name\" å¯ä»¥ç”¨æ¥ä½œä¸ºæ„å»ºçš„å‚æ•°ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰ã€‚ 3.1.5 MAINTAINER &amp; LABELMAINTAINER John Smith LABEL maintainer=\"John Smith \" MAINTAINERè®¾å®šä½œè€…çš„è”ç³»ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨LABELä»£æ›¿ï¼ŒLABELè®¾ç½®çš„å±æ€§æœ€ç»ˆå¯ä»¥åœ¨docker imageçš„åŸºæœ¬å±æ€§ä¸­æŸ¥çœ‹ 3.1.6 EXPOSEEXPOSE 80 æš´éœ²ç«¯å£ 3.1.7 VOLUME &amp; WORKDIRVOLUME /data WORKDIR /data VOLUMEå®šä¹‰å¤–éƒ¨å¯ä»¥æŒ‚è½½çš„æ•°æ®å·ï¼ŒWORKDIRæŒ‡å®šå·¥ä½œç›®å½•ï¼Œå¦‚æœæ²¡æœ‰è‡ªåŠ¨åˆ›å»º 3.1.8 CMDç¬¬ä¸€ç§ç”¨æ³•ï¼š CMD java -jar app.jar è¿è¡Œä¸€ä¸ªå¯æ‰§è¡Œçš„æ–‡ä»¶å¹¶æä¾›å‚æ•°ã€‚ ç¬¬äºŒç§ç”¨æ³•ï¼šä¸ºENTRYPOINTæŒ‡å®šå‚æ•°ã€‚ ç¬¬ä¸‰ç§ç”¨æ³•ï¼š CMD[\"/bin/bash\"] è®¾ç½®å¯åŠ¨å®¹å™¨é»˜è®¤æ‰“å¼€çš„ç»ˆç«¯ 3.2 ä½¿ç”¨Dockerfileåˆ›å»ºé•œåƒdocker build -f ./centos_dockerfile -t vim_centos:1 .-f DockerfileæŒ‡å®šdockerfileçš„ä½ç½® -t image_name:tagæŒ‡å®šé•œåƒçš„åå­—åŠæ ‡ç­¾","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"docker","slug":"docker","permalink":"https://www.codetool.top/tags/docker/"}]},{"title":"å¸¸ç”¨è½¯ä»¶çš„dockeréƒ¨ç½²","slug":"å¸¸ç”¨è½¯ä»¶çš„dockeréƒ¨ç½²","date":"2020-03-29T06:07:45.000Z","updated":"2020-03-29T06:15:44.152Z","comments":true,"path":"article/å¸¸ç”¨è½¯ä»¶çš„dockeréƒ¨ç½²/","link":"","permalink":"https://www.codetool.top/article/%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6%E7%9A%84docker%E9%83%A8%E7%BD%B2/","excerpt":"","text":"1 dockerç«¯å£æ˜ å°„ å®¹å™¨å†…çš„ç½‘ç»œæœåŠ¡å’Œå¤–éƒ¨æœºå™¨ä¸èƒ½ç›´æ¥é€šä¿¡ å¤–éƒ¨æœºå™¨å’Œå®¿ä¸»æœºå¯ä»¥ç›´æ¥é€šä¿¡ å®¿ä¸»æœºå’Œå®¹å™¨å¯ä»¥ç›´æ¥é€šä¿¡ å½“å®¹å™¨ä¸­çš„ç½‘ç»œæœåŠ¡éœ€è¦è¢«å¤–éƒ¨æœºå™¨è®¿é—®æ—¶ï¼Œå¯ä»¥å°†å®¹å™¨ä¸­æä¾›æœåŠ¡çš„ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„ç«¯å£ä¸Šã€‚å¤–éƒ¨æœºå™¨è®¿é—®å®¿ä¸»æœºçš„è¯¥ç«¯å£ï¼Œä»è€Œé—´æ¥è®¿é—®å®¹å™¨çš„æœåŠ¡ã€‚è¿™ç§æ“ä½œç§°ä¸ºï¼šç«¯å£æ˜ å°„ 2 Mysqléƒ¨ç½² æœç´¢mysqlé•œåƒ docker search mysql æ‹‰å–mysqlé•œåƒ docker pull mysql:5.7 åˆ›å»ºå®¹å™¨ï¼Œè®¾ç½®ç«¯å£æ˜ å°„ã€ç›®å½•æ˜ å°„ # åœ¨/rootç›®å½•ä¸‹åˆ›å»ºmysqlç›®å½•ç”¨äºå­˜å‚¨mysqlæ•°æ®ä¿¡æ¯ mkdir ~/mysql cd ~/mysql docker run -id \\ -p 3306:3306 \\ --name=c_mysql \\ -v $PWD/conf:/etc/mysql/conf.d \\ -v $PWD/logs:/logs \\ -v $PWD/data:/var/lib/mysql \\ -e MYSQL_ROOT_PASSWORD=123456 \\ mysql:5.7 å‚æ•°è¯´æ˜ï¼š -p 3306:3306ï¼šå°†å®¹å™¨çš„ 3306 ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„ 3306 ç«¯å£ã€‚å‰ä¸€ä¸ª3306æ˜¯å®¿ä¸»æœºçš„ç«¯å£ã€‚ -v $PWD/conf:/etc/mysql/conf.dï¼šå°†ä¸»æœºå½“å‰ç›®å½•ä¸‹çš„ conf/my.cnf æŒ‚è½½åˆ°å®¹å™¨çš„ /etc/mysql/my.cnfã€‚é…ç½®ç›®å½• -v $PWD/logs:/logsï¼šå°†ä¸»æœºå½“å‰ç›®å½•ä¸‹çš„ logs ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„ /logsã€‚æ—¥å¿—ç›®å½• -v $PWD/data:/var/lib/mysqlï¼šå°†ä¸»æœºå½“å‰ç›®å½•ä¸‹çš„dataç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„ /var/lib/mysql ã€‚æ•°æ®ç›®å½• -e MYSQL_ROOT_PASSWORD=123456ï¼šåˆå§‹åŒ– root ç”¨æˆ·çš„å¯†ç ã€‚ ã€æ³¨ã€‘å¦‚æœæç¤º[Warning] IPv4 forwarding is disabled. Networking will not work.ï¼š åœ¨dockerçš„å®¿ä¸»æœºä¸­æ›´æ”¹æ–‡ä»¶ï¼š vim /usr/lib/sysctl.d/00-system.confåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ net.ipv4.ip_forward=1 é‡æ–°å¯åŠ¨networkæœåŠ¡ï¼šsystemctl restart network è¿›å…¥å®¹å™¨ç¯å¢ƒ docker exec -it c_mysql /bin/bash3 Nginxéƒ¨ç½²docker pull nginxä¸‹é¢è¿™ä¸ªæ­¥éª¤æ˜¯æŠŠnginx.confæ–‡ä»¶å¤åˆ¶å‡ºæ¥ï¼š mkdir ~/nginx cd ~/nginx mkdir conf docker run -id --name=c_nginx -p 80:80 nginx docker cp c_nginx:/etc/nginx/nginx.conf ~/nginx/conf docker stop c_nginx docker rm c_nginxé‡æ–°ç”Ÿæˆå®¹å™¨ï¼Œå¹¶ç»‘å®šæ•°æ®å·ï¼š docker run -id --name=c_nginx \\ -p 80:80 \\ -v $PWD/conf/nginx.conf:/etc/nginx/nginx.conf \\ -v $PWD/logs:/var/log/nginx \\ -v $PWD/html:/usr/share/nginx/html \\ nginxåœ¨html/ä¸‹æ–°å»ºindex.htmlï¼š &lt;!DOCTYPE html> &lt;html lang=\"en\"> &lt;head> &lt;meta charset=\"UTF-8\"> &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"> &lt;title>Document&lt;/title> &lt;/head> &lt;body> &lt;h1>hello docker nginxï¼&lt;/h1> &lt;/body> &lt;/html> ä¿å­˜å¹¶é€€å‡ºï¼Œè®¿é—®å®¿ä¸»æœºçš„80ç«¯å£ï¼Œå¯ä»¥çœ‹è§ç½‘ç«™æˆåŠŸå“åº” 4 rediséƒ¨ç½²docker pull redis:5.0 docker run -id --name=c_redis -p 6379:6379 redis:5.0","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"docker","slug":"docker","permalink":"https://www.codetool.top/tags/docker/"}]},{"title":"dockeræ•°æ®æŒ‚è½½-æ•°æ®å·ä»‹ç»","slug":"dockeræ•°æ®æŒ‚è½½-æ•°æ®å·ä»‹ç»","date":"2020-03-29T04:37:34.000Z","updated":"2020-03-29T04:37:47.123Z","comments":true,"path":"article/dockeræ•°æ®æŒ‚è½½-æ•°æ®å·ä»‹ç»/","link":"","permalink":"https://www.codetool.top/article/docker%E6%95%B0%E6%8D%AE%E6%8C%82%E8%BD%BD-%E6%95%B0%E6%8D%AE%E5%8D%B7%E4%BB%8B%E7%BB%8D/","excerpt":"","text":"åœ¨Dockerä¸­ï¼Œè¦æƒ³å®ç°æ•°æ®çš„æŒä¹…åŒ–ï¼ˆæ‰€è°“Dockerçš„æ•°æ®æŒä¹…åŒ–å³æ•°æ®ä¸éšç€Containerçš„ç»“æŸè€Œç»“æŸï¼‰ï¼Œéœ€è¦å°†æ•°æ®ä»å®¿ä¸»æœºæŒ‚è½½åˆ°å®¹å™¨ä¸­ã€‚ç›®å‰Dockeræä¾›äº†ä¸‰ç§ä¸åŒçš„æ–¹å¼å°†æ•°æ®ä»å®¿ä¸»æœºæŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼š volumesï¼šDockerç®¡ç†å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œé»˜è®¤ä½äº /var/lib/docker/volumes ç›®å½•ä¸­ï¼›ï¼ˆæœ€å¸¸ç”¨çš„æ–¹å¼ï¼‰ bind mountsï¼šæ„ä¸ºç€å¯ä»¥å­˜å‚¨åœ¨å®¿ä¸»æœºç³»ç»Ÿçš„ä»»æ„ä½ç½®ï¼›ï¼ˆæ¯”è¾ƒå¸¸ç”¨çš„æ–¹å¼ï¼‰ä½†æ˜¯ï¼Œbind mountåœ¨ä¸åŒçš„å®¿ä¸»æœºç³»ç»Ÿæ—¶ä¸å¯ç§»æ¤çš„ï¼Œæ¯”å¦‚Windowså’ŒLinuxçš„ç›®å½•ç»“æ„æ˜¯ä¸ä¸€æ ·çš„ï¼Œbind mountæ‰€æŒ‡å‘çš„hostç›®å½•ä¹Ÿä¸èƒ½ä¸€æ ·ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆbind mountä¸èƒ½å‡ºç°åœ¨Dockerfileä¸­çš„åŸå› ï¼Œå› ä¸ºè¿™æ ·Dockerfileå°±ä¸å¯ç§»æ¤äº†ã€‚ tmpfsï¼šæŒ‚è½½å­˜å‚¨åœ¨å®¿ä¸»æœºç³»ç»Ÿçš„å†…å­˜ä¸­ï¼Œè€Œä¸ä¼šå†™å…¥å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼›ï¼ˆä¸€èˆ¬éƒ½ä¸ä¼šç”¨çš„æ–¹å¼ï¼‰ 1 Volumes1.1 åˆ›å»ºæ•°æ®å·docker volume create edc-nginx-vol # åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰å®¹å™¨å· docker volume ls # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨å· docker volume inspect edc-nginx-vol # æŸ¥çœ‹æŒ‡å®šå®¹å™¨å·è¯¦æƒ…ä¿¡æ¯1.2 å¯åŠ¨å®¹å™¨æ—¶æŒ‚è½½æ•°æ®å·docker run -d -it --name=edc-nginx -p 8800:80 -v edc-nginx-vol:/usr/share/nginx/html nginxå…¶ä¸­ï¼Œedc-nginx-volæŒ‡çš„æ˜¯åˆ›å»ºæ•°æ®å·çš„åç§°ï¼Œ/usr/share/nginx/htmlæŒ‡çš„æ˜¯è¦æŒ‚è½½åˆ°çš„å®¹å™¨ä¸­çš„è·¯å¾„åï¼Œå¦‚æœä¸å¡«å†™edc-nginx-vol:å³çœç•¥æ•°æ®å·åç§°ï¼Œåˆ™ä¼šåˆ†é…ä¸€ä¸ªåŒ¿åçš„æ•°æ®å·ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼š æ•°æ®å·æ˜¯å®¿ä¸»æœºä¸­çš„ä¸€ä¸ªç›®å½•æˆ–æ–‡ä»¶ å½“å®¹å™¨ç›®å½•å’Œæ•°æ®å·ç›®å½•ç»‘å®šåï¼Œå¯¹æ–¹çš„ä¿®æ”¹ä¼šç«‹å³åŒæ­¥ ä¸€ä¸ªæ•°æ®å·å¯ä»¥è¢«å¤šä¸ªå®¹å™¨åŒæ—¶æŒ‚è½½ ä¸€ä¸ªå®¹å™¨ä¹Ÿå¯ä»¥è¢«æŒ‚è½½å¤šä¸ªæ•°æ®å· å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»º 1.3 æ¸…ç†å·docker stop edc-nginx # æš‚åœå®¹å™¨å®ä¾‹ docker rm edc-nginx # ç§»é™¤å®¹å™¨å®ä¾‹ docker volume rm edc-nginx-vol # åˆ é™¤è‡ªå®šä¹‰æ•°æ®å·2 bind mountsbind mountså¯ä»¥æŒ‚è½½å®¿ä¸»æœºçš„ä»»æ„ä½ç½®ï¼Œè¯­æ³•ï¼š docker run -d -it --name=edc-nginx -v /app/wwwroot:/usr/share/nginx/html nginxå…¶ä¸­/app/wwwrootæŒ‡çš„æ˜¯å®¿ä¸»æœºä¸­çš„è·¯å¾„ï¼Œ/usr/share/nginx/htmlæŒ‡çš„æ˜¯è¦æŒ‚è½½åˆ°å®¹å™¨ä¸­çš„è·¯å¾„ã€‚ æ³¨æ„ï¼š å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ é€šè¿‡docker inspect edc-nginxå¯ä»¥çœ‹åˆ°å®¹å™¨ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬bindsä¿¡æ¯ã€‚ æ•°æ®å·æŒ‚è½½çš„å¦ä¸€ä¸ªåº”ç”¨æ˜¯å¯ä»¥å¤šä¸ªå®¹å™¨æŒ‚è½½åŒä¸€ä¸ªæ•°æ®å·ä»è€Œå®ç°å®¹å™¨é—´çš„æ•°æ®äº¤æ¢ã€‚ 3 æ•°æ®å·å®¹å™¨ä¸ºäº†æœ‰æ•ˆåœ°ç»´æŠ¤å¤šå®¹å™¨çš„æ•°æ®å…±äº«ï¼Œå¯ä»¥ç»´æŠ¤ä¸€ä¸ªæ•°æ®å·å®¹å™¨ï¼ŒæŒ‚è½½æ•°æ®å·ï¼Œå…¶ä»–å®¹å™¨é€šè¿‡--volumes-fromä»è¯¥å®¹å™¨è·å–æ•°æ®å·é…ç½®ã€‚ ä¾‹ï¼š docker run â€“it --name=c3 â€“v /volume centos:7 /bin/bash docker run â€“it --name=c1 --volumes-from c3 centos:7 /bin/bash docker run â€“it --name=c2 --volumes-from c3 centos:7 /bin/bash æœ‰ç‚¹åƒç»§æ‰¿c3çš„æ•°æ®å·é…ç½®ï¼Œå½“c3çš„æ•°æ®å·é…ç½®ä¿®æ”¹æ—¶c1å’Œc2ä¹Ÿä¼šä¿®æ”¹ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"docker","slug":"docker","permalink":"https://www.codetool.top/tags/docker/"}]},{"title":"leetcode1162-åœ°å›¾åˆ†æ","slug":"leetcode1162-åœ°å›¾åˆ†æ","date":"2020-03-29T02:56:33.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode1162-åœ°å›¾åˆ†æ/","link":"","permalink":"https://www.codetool.top/article/leetcode1162-%E5%9C%B0%E5%9B%BE%E5%88%86%E6%9E%90/","excerpt":"","text":"1 åŸé¢˜ä½ ç°åœ¨æ‰‹é‡Œæœ‰ä¸€ä»½å¤§å°ä¸º N x N çš„ã€åœ°å›¾ã€ï¼ˆç½‘æ ¼ï¼‰ gridï¼Œä¸Šé¢çš„æ¯ä¸ªã€åŒºåŸŸã€ï¼ˆå•å…ƒæ ¼ï¼‰éƒ½ç”¨ 0 å’Œ 1 æ ‡è®°å¥½äº†ã€‚å…¶ä¸­ 0 ä»£è¡¨æµ·æ´‹ï¼Œ1 ä»£è¡¨é™†åœ°ï¼Œä½ çŸ¥é“è·ç¦»é™†åœ°åŒºåŸŸæœ€è¿œçš„æµ·æ´‹åŒºåŸŸæ˜¯æ˜¯å“ªä¸€ä¸ªå—ï¼Ÿè¯·è¿”å›è¯¥æµ·æ´‹åŒºåŸŸåˆ°ç¦»å®ƒæœ€è¿‘çš„é™†åœ°åŒºåŸŸçš„è·ç¦»ã€‚ æˆ‘ä»¬è¿™é‡Œè¯´çš„è·ç¦»æ˜¯ã€æ›¼å“ˆé¡¿è·ç¦»ã€ï¼ˆ Manhattan Distanceï¼‰ï¼š(x0, y0) å’Œ (x1, y1) è¿™ä¸¤ä¸ªåŒºåŸŸä¹‹é—´çš„è·ç¦»æ˜¯ |x0 - x1| + |y0 - y1| ã€‚ å¦‚æœæˆ‘ä»¬çš„åœ°å›¾ä¸Šåªæœ‰é™†åœ°æˆ–è€…æµ·æ´‹ï¼Œè¯·è¿”å› -1ã€‚ ç¤ºä¾‹ 1: è¾“å…¥ï¼š [[1,0,1],[0,0,0],[1,0,1]]è¾“å‡ºï¼š 2è§£é‡Šï¼šæµ·æ´‹åŒºåŸŸ (1, 1) å’Œæ‰€æœ‰é™†åœ°åŒºåŸŸä¹‹é—´çš„è·ç¦»éƒ½è¾¾åˆ°æœ€å¤§ï¼Œæœ€å¤§è·ç¦»ä¸º 2ã€‚ ç¤ºä¾‹ 2: è¾“å…¥ï¼š [[1,0,0],[0,0,0],[0,0,0]]è¾“å‡ºï¼š 4è§£é‡Šï¼šæµ·æ´‹åŒºåŸŸ (2, 2) å’Œæ‰€æœ‰é™†åœ°åŒºåŸŸä¹‹é—´çš„è·ç¦»éƒ½è¾¾åˆ°æœ€å¤§ï¼Œæœ€å¤§è·ç¦»ä¸º 4ã€‚ æç¤ºï¼š 1 &lt;= grid.length == grid[0].length &lt;= 100 grid[i][j] ä¸æ˜¯ 0 å°±æ˜¯ 1 2 è§£æ³•2.1 æ€æƒ³å·¦ä¸Šï¼Œå³ä¸‹ä¸¤éåŠ¨æ€è§„åˆ’ã€‚ æ—¶é—´å¤æ‚åº¦ï¼šO(4*N^2) = O(N^2) 2.2 ä»£ç class Solution { public int maxDistance(int[][] grid) { int [][]dp=new int [grid.length][grid[0].length]; int i,j; int ans=0; for(i=0;i&lt;grid.length;i++) for(j=0;j&lt;grid.length;j++) dp[i][j]=200; for(i=0;i&lt;grid.length;i++) for(j=0;j&lt;grid[0].length;j++) { if(grid[i][j]==1) dp[i][j]=0; if(i&lt;grid.length-1) dp[i+1][j]=Math.min(dp[i][j]+1,dp[i+1][j]); if(j&lt;grid[0].length-1) dp[i][j+1]=Math.min(dp[i][j]+1,dp[i][j+1]); } for(i=grid.length-1;i>=0;i--) for(j=grid[0].length-1;j>=0;j--) { if(i>=1) dp[i-1][j]=Math.min(dp[i-1][j],dp[i][j]+1); if(j>=1) dp[i][j-1]=Math.min(dp[i][j]+1,dp[i][j-1]); } for(i=0;i&lt;grid.length;i++) for(j=0;j&lt;grid[0].length;j++) ans=Math.max(ans,dp[i][j]); if(ans==0||ans==200) return -1; return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"dockeræ¦‚è¿°å’Œç›¸å…³å‘½ä»¤","slug":"dockeræ¦‚è¿°å’Œç›¸å…³å‘½ä»¤","date":"2020-03-28T16:13:11.000Z","updated":"2020-03-28T16:13:36.859Z","comments":true,"path":"article/dockeræ¦‚è¿°å’Œç›¸å…³å‘½ä»¤/","link":"","permalink":"https://www.codetool.top/article/docker%E6%A6%82%E8%BF%B0%E5%92%8C%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/","excerpt":"","text":"1 Dockeræ¦‚è¿° Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œè¯ç”Ÿäº 2013 å¹´åˆï¼ŒåŸºäº Go è¯­è¨€å®ç°ï¼ŒdotCloud å…¬å¸å‡ºå“ï¼ˆåæ”¹åä¸ºDocker Incï¼‰ã€‚ Docker å¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœºå™¨ä¸Šã€‚ å®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’éš”ç¦» å®¹å™¨æ€§èƒ½å¼€é”€æä½ã€‚ Docker ä» 17.03 ç‰ˆæœ¬ä¹‹ååˆ†ä¸º CEï¼ˆCommunity Edition: ç¤¾åŒºç‰ˆï¼‰ å’Œ EEï¼ˆEnterprise Edition: ä¼ä¸šç‰ˆï¼‰ 2 å®‰è£…docker# 1ã€yum åŒ…æ›´æ–°åˆ°æœ€æ–° yum update # 2ã€å®‰è£…éœ€è¦çš„è½¯ä»¶åŒ…ï¼Œ yum-util æä¾›yum-config-manageråŠŸèƒ½ï¼Œå¦å¤–ä¸¤ä¸ªæ˜¯devicemapperé©±åŠ¨ä¾èµ–çš„ yum install -y yum-utils device-mapper-persistent-data lvm2 # 3ã€ è®¾ç½®yumæº yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo # 4ã€ å®‰è£…docker yum install -y docker-ce # 5ã€ æŸ¥çœ‹dockerç‰ˆæœ¬ï¼ŒéªŒè¯æ˜¯å¦éªŒè¯æˆåŠŸ docker -v 2.1 é…ç½®dockeré•œåƒåŠ é€Ÿé»˜è®¤æƒ…å†µä¸‹ï¼Œå°†æ¥ä»docker hubï¼ˆhttps://hub.docker.com/ï¼‰ä¸Šä¸‹è½½dockeré•œåƒï¼Œå¤ªæ…¢ã€‚ä¸€èˆ¬éƒ½ä¼šé…ç½®é•œåƒåŠ é€Ÿå™¨ï¼š USTCï¼šä¸­ç§‘å¤§é•œåƒåŠ é€Ÿå™¨ï¼ˆhttps://docker.mirrors.ustc.edu.cnï¼‰ é˜¿é‡Œäº‘ ç½‘æ˜“äº‘ è…¾è®¯äº‘ é˜¿é‡Œäº‘ï¼š https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors 2.2 è®¾ç½®å¼€æœºå¯åŠ¨systemctl enable docker3 dockeræ¶æ„ é•œåƒï¼ˆImageï¼‰ï¼šDocker é•œåƒï¼ˆImageï¼‰ï¼Œå°±ç›¸å½“äºæ˜¯ä¸€ä¸ª root æ–‡ä»¶ç³»ç»Ÿã€‚æ¯”å¦‚å®˜æ–¹é•œåƒ ubuntu:16.04 å°±åŒ…å«äº†å®Œæ•´çš„ä¸€å¥— Ubuntu16.04 æœ€å°ç³»ç»Ÿçš„ root æ–‡ä»¶ç³»ç»Ÿã€‚ å®¹å™¨ï¼ˆContainerï¼‰ï¼šé•œåƒï¼ˆImageï¼‰å’Œå®¹å™¨ï¼ˆContainerï¼‰çš„å…³ç³»ï¼Œå°±åƒæ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­çš„ç±»å’Œå¯¹è±¡ä¸€æ ·ï¼Œé•œåƒæ˜¯é™æ€çš„å®šä¹‰ï¼Œå®¹å™¨æ˜¯é•œåƒè¿è¡Œæ—¶çš„å®ä½“ã€‚å®¹å™¨å¯ä»¥è¢«åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤ã€æš‚åœç­‰ã€‚ ä»“åº“ï¼ˆRepositoryï¼‰ï¼šä»“åº“å¯çœ‹æˆä¸€ä¸ªä»£ç æ§åˆ¶ä¸­å¿ƒï¼Œç”¨æ¥ä¿å­˜é•œåƒã€‚ 4 dockeré•œåƒç›¸å…³å‘½ä»¤æŸ¥çœ‹é•œåƒ æŸ¥çœ‹æœ¬åœ°æ‰€æœ‰çš„é•œåƒ docker images docker images â€“q # æŸ¥çœ‹æ‰€ç”¨é•œåƒçš„idæœç´¢é•œåƒ docker search **ä¹Ÿå¯ä»¥åœ¨ https://hub.docker.com/ æœç´¢ æ‹‰å–é•œåƒ docker pull **å¯ä»¥å¸¦ä¸ŠtagæŒ‡å®šç‰ˆæœ¬ï¼Œä¾‹å¦‚ï¼š docker pull mysql:5.7ç§»é™¤é•œåƒ docker rmi é•œåƒid5 dockerå®¹å™¨ç›¸å…³å‘½ä»¤è¿è¡Œå®¹å™¨å¹¶åœ¨å®¹å™¨ä¸­æ‰“å¼€å‘½ä»¤è¡Œ docker run -it --name=c1 debian /bin/bashä½¿ç”¨--name=**å¯ä»¥æŒ‡å®šå®¹å™¨çš„åç§° ä½¿ç”¨exité€€å‡º -i:ä¿æŒå®¹å™¨è¿è¡Œ -t:ä¸ºå®¹å™¨åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸å’Œ-ié…åˆä½¿ç”¨ åˆ›å»ºåå°è¿è¡Œçš„å®¹å™¨ docker run -id --name=c2 debianè¿è¡Œå‘½ä»¤åä¼šæ˜¾ç¤ºå®¹å™¨çš„id å¦‚æœè¦è¿›å…¥åå°è¿è¡Œçš„å®¹å™¨ç¯å¢ƒï¼Œä½¿ç”¨ docker exec -it c2 /bin/bashåå°è¿è¡Œçš„å®¹å™¨ä½¿ç”¨exité€€å‡ºä¸ä¼šè‡ªåŠ¨å…³é—­ã€‚ -dï¼šä»¥å®ˆæŠ¤æ¨¡å¼è¿è¡Œå®¹å™¨ -itåˆ›å»ºçš„å®¹å™¨ä¸€èˆ¬ç§°ä¸ºäº¤äº’å¼å®¹å™¨ï¼Œ-dåˆ›å»ºçš„å®¹å™¨ä¸€èˆ¬ç§°ä¸ºå®ˆæŠ¤å¼å®¹å™¨ æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨ docker ps è¿è¡Œç»“æœ CONTAINER ID IMAGE COMMAND ... NAMES 00723499fdbf debian &quot;/bin/bash&quot; ... stupefied_turingnameå¯ä»¥æ ‡è¯†è¿™ä¸ªå®¹å™¨ ä½¿ç”¨docker ps -aå¯ä»¥çœ‹åˆ°æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬ä¸åœ¨è¿è¡Œçš„ï¼‰ åœæ­¢è¿è¡Œå®¹å™¨ docker stop c2å¯åŠ¨å®¹å™¨ docker start c2å’Œdocker runçš„åŒºåˆ«æ˜¯docker startæ˜¯é‡å¯å·²å­˜åœ¨çš„å®¹å™¨ï¼Œè€Œdocker runæ˜¯ä»é•œåƒåˆ›å»ºå®¹å™¨ã€‚ æŸ¥çœ‹å®¹å™¨ä¿¡æ¯ docker inspect æŸ¥çœ‹å®¹å™¨è¢«æ”¹åŠ¨çš„æ–‡ä»¶ docker diffæŸ¥çœ‹å®¹å™¨å†å²è®°å½• docker logsåˆ é™¤å®¹å™¨ åˆ é™¤æŒ‡å®šå®¹å™¨ docker rm dockernameè·å–æ‰€æœ‰å·²åœæ­¢çš„å®¹å™¨ docker ps -aq -f status=exited åˆ é™¤æ‰€æœ‰å·²åœæ­¢çš„å®¹å™¨ docker rm -v $(docker ps -aq -f status=exited)å°†å®¹å™¨æäº¤ä¸ºé•œåƒ docker commit container_name repo/image_namerepoæ˜¯å­˜æ”¾é•œåƒçš„ä»“åº“åç§°ï¼Œè¿™ä¸ªå‘½ä»¤å°†ä¼šè¿”å›ä¸€ä¸ªé•œåƒçš„å”¯ä¸€è¯†åˆ«ç ","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"docker","slug":"docker","permalink":"https://www.codetool.top/tags/docker/"}]},{"title":"ElasticSearchæ¦‚è¿°å’Œå¸¸ç”¨Rest APIä½¿ç”¨","slug":"ElasticSearchæ¦‚è¿°å’Œå¸¸ç”¨Rest-APIä½¿ç”¨","date":"2020-03-28T11:13:30.000Z","updated":"2020-03-29T01:30:38.885Z","comments":true,"path":"article/ElasticSearchæ¦‚è¿°å’Œå¸¸ç”¨Rest-APIä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/ElasticSearch%E6%A6%82%E8%BF%B0%E5%92%8C%E5%B8%B8%E7%94%A8Rest-API%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 Elastic Stackæ¦‚è¿°å¦‚æœä½ æ²¡æœ‰å¬è¯´è¿‡Elastic Stackï¼Œé‚£ä½ ä¸€å®šå¬è¯´è¿‡ELKï¼Œå®é™…ä¸ŠELKæ˜¯ä¸‰æ¬¾è½¯ä»¶çš„ç®€ç§°ï¼Œåˆ†åˆ«æ˜¯Elasticsearchã€ Logstashã€Kibanaç»„æˆï¼Œåœ¨å‘å±•çš„è¿‡ç¨‹ä¸­ï¼Œåˆæœ‰æ–°æˆå‘˜Beatsçš„åŠ å…¥ï¼Œæ‰€ä»¥å°±å½¢æˆäº†Elastic Stackã€‚æ‰€ä»¥è¯´ï¼ŒELKæ˜¯æ—§çš„ç§°å‘¼ï¼ŒElastic Stackæ˜¯æ–°çš„åå­—ã€‚ å…¨ç³»çš„Elastic StackæŠ€æœ¯æ ˆåŒ…æ‹¬ï¼š ElasticsearchElasticsearch åŸºäºjavaï¼Œæ˜¯ä¸ªå¼€æºåˆ†å¸ƒå¼æœç´¢å¼•æ“ï¼Œå®ƒçš„ç‰¹ç‚¹æœ‰ï¼šåˆ†å¸ƒå¼ï¼Œé›¶é…ç½®ï¼Œè‡ªåŠ¨å‘ç°ï¼Œç´¢å¼•è‡ªåŠ¨åˆ†ç‰‡ï¼Œç´¢å¼•å‰¯æœ¬æœºåˆ¶ï¼Œrestfulé£æ ¼æ¥å£ï¼Œå¤šæ•°æ®æºï¼Œè‡ªåŠ¨æœç´¢è´Ÿè½½ç­‰ã€‚ LogstashLogstash åŸºäºjavaï¼Œæ˜¯ä¸€ä¸ªå¼€æºçš„ç”¨äºæ”¶é›†,åˆ†æå’Œå­˜å‚¨æ—¥å¿—çš„å·¥å…·ã€‚ KibanaKibana åŸºäºnodejsï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¼€æºå’Œå…è´¹çš„å·¥å…·ï¼ŒKibanaå¯ä»¥ä¸º Logstash å’ŒElasticSearch æä¾›çš„æ—¥å¿—åˆ†æå‹å¥½çš„Web ç•Œé¢ï¼Œå¯ä»¥æ±‡æ€»ã€åˆ†æå’Œæœç´¢é‡è¦æ•°æ®æ—¥å¿—ã€‚ BeatsBeatsæ˜¯elasticå…¬å¸å¼€æºçš„ä¸€æ¬¾é‡‡é›†ç³»ç»Ÿç›‘æ§æ•°æ®çš„ä»£ç†agentï¼Œæ˜¯åœ¨è¢«ç›‘æ§æœåŠ¡å™¨ä¸Šä»¥å®¢æˆ·ç«¯å½¢å¼è¿è¡Œçš„æ•°æ®æ”¶é›†å™¨çš„ç»Ÿç§°ï¼Œå¯ä»¥ç›´æ¥æŠŠæ•°æ®å‘é€ç»™Elasticsearchæˆ–è€…é€šè¿‡Logstashå‘é€ç»™Elasticsearchï¼Œç„¶åè¿›è¡Œåç»­çš„æ•°æ®åˆ†ææ´»åŠ¨ã€‚ Beatsç”±å¦‚ä¸‹ç»„æˆ: Packetbeatï¼šæ˜¯ä¸€ä¸ªç½‘ç»œæ•°æ®åŒ…åˆ†æå™¨ï¼Œç”¨äºç›‘æ§ã€æ”¶é›†ç½‘ç»œæµé‡ä¿¡æ¯ï¼ŒPacketbeatå—…æ¢æœåŠ¡å™¨ä¹‹é—´çš„æµé‡ï¼Œè§£æåº”ç”¨å±‚åè®®ï¼Œå¹¶å…³è”åˆ°æ¶ˆæ¯çš„å¤„ç†ï¼Œå…¶æ”¯ æŒICMP (v4 and v6)ã€DNSã€HTTPã€Mysqlã€PostgreSQLã€Redisã€MongoDBã€Memcacheç­‰åè®®ã€‚ Filebeatï¼šç”¨äºç›‘æ§ã€æ”¶é›†æœåŠ¡å™¨æ—¥å¿—æ–‡ä»¶ï¼Œå…¶å·²å–ä»£ logstash forwarderã€‚ Metricbeatï¼šå¯å®šæœŸè·å–å¤–éƒ¨ç³»ç»Ÿçš„ç›‘æ§æŒ‡æ ‡ä¿¡æ¯ï¼Œå…¶å¯ä»¥ç›‘æ§ã€æ”¶é›† Apacheã€HAProxyã€MongoDBã€MySQLã€Nginxã€PostgreSQLã€Redisã€Systemã€Zookeeperç­‰æœåŠ¡ã€‚ Winlogbeatï¼šç”¨äºç›‘æ§ã€æ”¶é›†Windowsç³»ç»Ÿçš„æ—¥å¿—ä¿¡æ¯ã€‚ 2 ElasticSearchæ¦‚è¿°ElasticSearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„æœç´¢æœåŠ¡å™¨ã€‚å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäºRESTful webæ¥å£ã€‚Elasticsearchæ˜¯ç”¨Javaè¯­è¨€å¼€å‘çš„ï¼Œå¹¶ä½œä¸ºApacheè®¸å¯æ¡æ¬¾ä¸‹çš„å¼€æ”¾æºç å‘å¸ƒï¼Œæ˜¯ä¸€ç§æµè¡Œçš„ä¼ä¸šçº§æœç´¢å¼•æ“ã€‚ElasticSearchç”¨äºäº‘è®¡ç®—ä¸­ï¼Œèƒ½å¤Ÿè¾¾åˆ°å®æ—¶æœç´¢ï¼Œç¨³å®šï¼Œå¯é ï¼Œå¿«é€Ÿï¼Œå®‰è£…ä½¿ç”¨æ–¹ä¾¿ã€‚å®˜æ–¹å®¢æˆ·ç«¯åœ¨Javaã€.NETï¼ˆC#ï¼‰ã€PHPã€Pythonã€Apache Groovyã€Rubyå’Œè®¸å¤šå…¶ä»–è¯­è¨€ä¸­éƒ½æ˜¯å¯ç”¨çš„ã€‚ 2.1 å®‰è£…Elasticsearchçš„å‘å±•æ˜¯éå¸¸å¿«é€Ÿçš„ï¼Œæ‰€ä»¥åœ¨ES5.0ä¹‹å‰ï¼ŒELKçš„å„ä¸ªç‰ˆæœ¬éƒ½ä¸ç»Ÿä¸€ï¼Œå‡ºç°äº†ç‰ˆæœ¬å·æ··ä¹±çš„çŠ¶æ€ï¼Œæ‰€ä»¥ä»5.0å¼€å§‹ï¼Œæ‰€æœ‰Elastic Stackä¸­çš„é¡¹ç›®å…¨éƒ¨ç»Ÿä¸€ç‰ˆæœ¬å·ã€‚ ä¸‹è½½åœ°å€ï¼š https://www.elastic.co/cn/downloads/elasticsearch å› ä¸ºå¯åŠ¨Elasticsearch5.0ç‰ˆæœ¬åŠä»¥ä¸Šéœ€è¦ä½¿ç”¨érootç”¨æˆ·ï¼Œéœ€è¦æ–°å»ºä¸€ä¸ªç”¨æˆ·æ¥å¯åŠ¨Elasticsearch useradd elk mkdir -pv /opt/elk/{data,logs} chown -R elk:elk /opt/elk/å°†ä¸‹è½½åçš„å‹ç¼©åŒ…è§£å‹ mv elasticsearch-7.6.1-linux-x86_64.tar.gz /opt/ tar -xvf elasticsearch-7.6.1-linux-x86_64.tar.gz mv elasticsearch-7.6.1 elasticsearch chown -R elk:elk /opt/elasticsearch/ä¿®æ”¹å®‰è£…ç›®å½•ä¸‹çš„/conf/elasticsearch.yml network.host: 0.0.0.0 path.data: /opt/elk/data path.logs: /opt/elk/logs discovery.seed_hosts: [\"127.0.0.1\",\"[::1]\"] cluster.initial_master_nodes: [\"node-1\"] åœ¨Elasticsearchä¸­å¦‚æœï¼Œnetwork.hostä¸æ˜¯localhostæˆ–è€…127.0.0.1çš„è¯ï¼Œå°±ä¼šè®¤ä¸ºæ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œä¼šå¯¹ç¯å¢ƒçš„è¦æ±‚æ¯”è¾ƒé«˜ï¼Œæˆ‘ä»¬çš„æµ‹è¯•ç¯å¢ƒä¸ä¸€å®šèƒ½å¤Ÿæ»¡è¶³ï¼Œä¸€èˆ¬æƒ…å†µä¸‹éœ€è¦ä¿®æ”¹å‡ å¤„é…ç½®ï¼š ä¿®æ”¹jvm.options # -Xms1g # -Xmx1g -Xms128m -Xmx128mä¿®æ”¹/etc/sysctl.confï¼Œæ·»åŠ ä¸€è¡Œï¼Œç›®çš„æ˜¯ç¡®ä¿ç³»ç»Ÿæœ‰è¶³å¤Ÿçš„èµ„æºå¯åŠ¨Elasticsearchï¼š vm.max_map_count=655360 æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç¡®ä¿é…ç½®ç”Ÿæ•ˆï¼š sysctl -pä¿®æ”¹/etc/security/limits.confï¼Œåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä¸‹é¢å†…å®¹ï¼š * soft nofile 65536 * hard nofile 131072 * soft nproc 65536 * hard nproc 131072ä¿®æ”¹/etc/security/limits.d/20-nproc.confï¼Œåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä¸‹é¢å†…å®¹ï¼š elk soft nproc 65536ä½¿ç”¨elkç”¨æˆ·èº«ä»½å¯åŠ¨elastic search su elk cd ../bin ./elasticsearch æˆ– ./elasticsearch -d #åå°å¯åŠ¨è¿è¡ŒæˆåŠŸåï¼Œè®¿é—®9200ç«¯å£å³å¯çœ‹åˆ°ä¸€æ®µjsonè¾“å‡º 2.2 elasticsearch headä½¿ç”¨elasticsearch headæ˜¯ç¬¬ä¸‰æ–¹å¼€å‘çš„ElasticSearchç•Œé¢ç®¡ç†å·¥å…·ï¼Œå¯ä»¥é€šè¿‡chromeæ’ä»¶å®‰è£…ï¼š https://chrome.google.com/webstore/detail/elasticsearch-head/ffmkiejjmecolpfloofpjologoblkegm/ 2.3 ElasticsearchåŸºæœ¬æ¦‚å¿µ2.3.1 ç´¢å¼• ç´¢å¼•ï¼ˆindexï¼‰æ˜¯Elasticsearchå¯¹é€»è¾‘æ•°æ®çš„é€»è¾‘å­˜å‚¨ï¼Œæ‰€ä»¥å®ƒå¯ä»¥åˆ†ä¸ºæ›´å°çš„éƒ¨åˆ†ã€‚ å¯ä»¥æŠŠç´¢å¼•çœ‹æˆå…³ç³»å‹æ•°æ®åº“çš„è¡¨ï¼Œç´¢å¼•çš„ç»“æ„æ˜¯ä¸ºå¿«é€Ÿæœ‰æ•ˆçš„å…¨æ–‡ç´¢å¼•å‡†å¤‡çš„ï¼Œç‰¹åˆ«æ˜¯å®ƒä¸å­˜å‚¨åŸå§‹å€¼ã€‚ Elasticsearchå¯ä»¥æŠŠç´¢å¼•å­˜æ”¾åœ¨ä¸€å°æœºå™¨æˆ–è€…åˆ†æ•£åœ¨å¤šå°æœåŠ¡å™¨ä¸Šï¼Œæ¯ä¸ªç´¢å¼•æœ‰ä¸€æˆ–å¤šä¸ªåˆ†ç‰‡ï¼ˆshardï¼‰ï¼Œæ¯ä¸ªåˆ†ç‰‡å¯ä»¥æœ‰å¤šä¸ªå‰¯æœ¬ï¼ˆreplicaï¼‰ã€‚ 2.3.2 æ–‡æ¡£å°±æ˜¯luceneçš„åº•å±‚å­˜å‚¨å§ã€‚ å­˜å‚¨åœ¨Elasticsearchä¸­çš„ä¸»è¦å®ä½“å«æ–‡æ¡£ï¼ˆdocumentï¼‰ã€‚ç”¨å…³ç³»å‹æ•°æ®åº“æ¥ç±»æ¯”çš„è¯ï¼Œä¸€ä¸ªæ–‡æ¡£ç›¸å½“äºæ•°æ®åº“è¡¨ä¸­çš„ä¸€è¡Œè®°å½•ã€‚ Elasticsearchå’ŒMongoDBä¸­çš„æ–‡æ¡£ç±»ä¼¼ï¼Œéƒ½å¯ä»¥æœ‰ä¸åŒçš„ç»“æ„ï¼Œä½†Elasticsearchçš„æ–‡æ¡£ä¸­ï¼Œç›¸åŒå­—æ®µå¿…é¡»æœ‰ç›¸åŒç±»å‹ã€‚ æ–‡æ¡£ç”±å¤šä¸ªå­—æ®µç»„æˆï¼Œæ¯ä¸ªå­—æ®µå¯èƒ½å¤šæ¬¡å‡ºç°åœ¨ä¸€ä¸ªæ–‡æ¡£é‡Œï¼Œè¿™æ ·çš„å­—æ®µå«å¤šå€¼å­—æ®µï¼ˆmultivaluedï¼‰ã€‚ æ¯ä¸ªå­—æ®µçš„ç±»å‹ï¼Œå¯ä»¥æ˜¯æ–‡æœ¬ã€æ•°å€¼ã€æ—¥æœŸç­‰ã€‚å­—æ®µç±»å‹ä¹Ÿå¯ä»¥æ˜¯å¤æ‚ç±»å‹ï¼Œä¸€ä¸ªå­—æ®µåŒ…å«å…¶ä»–å­æ–‡æ¡£æˆ–è€…æ•°ç»„ã€‚ 2.3.3 æ˜ å°„ æ‰€æœ‰æ–‡æ¡£å†™è¿›ç´¢å¼•ä¹‹å‰éƒ½ä¼šå…ˆè¿›è¡Œåˆ†æï¼Œå¦‚ä½•å°†è¾“å…¥çš„æ–‡æœ¬åˆ†å‰²ä¸ºè¯æ¡ã€å“ªäº›è¯æ¡åˆä¼šè¢«è¿‡æ»¤ï¼Œè¿™ç§è¡Œä¸ºå«åšæ˜ å°„ï¼ˆmappingï¼‰ã€‚ä¸€èˆ¬ç”±ç”¨æˆ·è‡ªå·±å®šä¹‰è§„åˆ™ã€‚ 2.3.4 æ–‡æ¡£ç±»å‹ åœ¨Elasticsearchä¸­ï¼Œä¸€ä¸ªç´¢å¼•å¯¹è±¡å¯ä»¥å­˜å‚¨å¾ˆå¤šä¸åŒç”¨é€”çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåšå®¢åº”ç”¨ç¨‹åºå¯ä»¥ä¿å­˜æ–‡ç« å’Œè¯„è®ºã€‚ æ¯ä¸ªæ–‡æ¡£å¯ä»¥æœ‰ä¸åŒçš„ç»“æ„ã€‚ ä¸åŒçš„æ–‡æ¡£ç±»å‹ä¸èƒ½ä¸ºç›¸åŒçš„å±æ€§è®¾ç½®ä¸åŒçš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œåœ¨åŒä¸€ç´¢å¼•ä¸­çš„æ‰€æœ‰æ–‡æ¡£ç±»å‹ä¸­ï¼Œä¸€ä¸ªå«titleçš„å­—æ®µå¿…é¡»å…·æœ‰ç›¸åŒçš„ç±»å‹ã€‚ 3 RESTful APIä½¿ç”¨åœ¨Elasticsearchä¸­ï¼Œæä¾›äº†åŠŸèƒ½ä¸°å¯Œçš„RESTful APIçš„æ“ä½œï¼ŒåŒ…æ‹¬åŸºæœ¬çš„CRUDã€åˆ›å»ºç´¢å¼•ã€åˆ é™¤ç´¢å¼•ç­‰æ“ä½œã€‚ 3.1 åˆ›å»ºç´¢å¼•åº“åˆ›å»ºç©ºç´¢å¼•åº“ï¼š PUT /haoke { \"settings\": { \"index\": { \"number_of_shards\": \"2\", #åˆ†ç‰‡æ•° \"number_of_replicas\": \"0\" #å‰¯æœ¬æ•° } } } #åˆ é™¤ç´¢å¼• DELETE /haoke { \"acknowledged\": true } 3.2 æ’å…¥æ–‡æ¡£åœ¨Luceneä¸­ï¼Œåˆ›å»ºç´¢å¼•æ˜¯éœ€è¦å®šä¹‰å­—æ®µåç§°ä»¥åŠå­—æ®µçš„ç±»å‹çš„ï¼Œåœ¨Elasticsearchä¸­æä¾›äº†éç»“æ„åŒ–çš„ç´¢å¼•ï¼Œå°±æ˜¯ä¸éœ€è¦åˆ›å»ºç´¢å¼•ç»“æ„ï¼Œå³å¯å†™å…¥æ•°æ®åˆ°ç´¢å¼•ä¸­ï¼Œå®é™…ä¸Šåœ¨Elasticsearchåº•å±‚ä¼šè¿›è¡Œç»“æ„åŒ–æ“ä½œï¼Œæ­¤æ“ä½œå¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ã€‚ POST /{ç´¢å¼•åº“}/{ç±»å‹}/{id} è¿™é‡Œçš„idæ˜¯æ‰‹åŠ¨æŒ‡å®šæ–‡æ¡£çš„idï¼Œå¦‚æœä¸å†™ä¼šåˆ†é…ä¸€ä¸ªéšæœºçš„æ–‡æ¡£idã€‚ POST /haoke/user/1001 #æ•°æ® { \"id\":1001, \"name\":\"å¼ ä¸‰\", \"age\":20, \"sex\":\"ç”·\" } #å“åº” { \"_index\": \"haoke\", \"_type\": \"user\", \"_id\": \"1\", \"_version\": 1, \"result\": \"created\", \"_shards\": { \"total\": 1, \"successful\": 1, \"failed\": 0 }, \"_seq_no\": 0, \"_primary_term\": 1 } 3.3 æ›´æ–°æ•°æ®ä¹Ÿå°±æ˜¯luceneçš„å…ˆåˆ é™¤å†åˆ›å»º PUT /haoke/user/1001 { \"id\":1001, \"name\":\"å¼ ä¸‰\", \"age\":21, \"sex\":\"å¥³\" } å¯ä»¥é€šè¿‡åœ¨urlåé¢é™„ä¸Š/_updateæ¥å±€éƒ¨æ›´æ–° #æ³¨æ„ï¼šè¿™é‡Œå¤šäº†_updateæ ‡è¯† POST /haoke/user/1001/_update { \"doc\":{ \"age\":23 } } å“åº”çš„_versionä¼šåŠ ä¸€ã€‚ 3.4 åˆ é™¤æ–‡æ¡£åœ¨Elasticsearchä¸­ï¼Œåˆ é™¤æ–‡æ¡£æ•°æ®ï¼Œåªéœ€è¦å‘èµ·DELETEè¯·æ±‚å³å¯ã€‚ DELETE /haoke/user/1001åˆ é™¤ä¸€ä¸ªæ–‡æ¡£ä¹Ÿä¸ä¼šç«‹å³ä»ç£ç›˜ä¸Šç§»é™¤ï¼Œå®ƒåªæ˜¯è¢«æ ‡è®°æˆå·²åˆ é™¤ã€‚Elasticsearchå°†ä¼šåœ¨ä½ ä¹‹åæ·»åŠ æ›´å¤šç´¢å¼•çš„æ—¶å€™æ‰ä¼šåœ¨åå°è¿›è¡Œåˆ é™¤å†…å®¹çš„æ¸…ç†ã€‚ å“åº”çš„_versionä¼šåŠ ä¸€ã€‚ 3.5 æ™®é€šæœç´¢3.5.1 æ ¹æ®æ–‡æ¡£idæŸ¥è¯¢GET /_index/_type/{id} GET /haoke/user/BbPe_WcB9cFOnF3uebvr #è¿”å›çš„æ•°æ®å¦‚ä¸‹ { \"_index\": \"haoke\", \"_type\": \"user\", \"_id\": \"BbPe_WcB9cFOnF3uebvr\", \"_version\": 8, \"found\": true, \"_source\": { #åŸå§‹æ•°æ®åœ¨è¿™é‡Œ \"id\": 1002, \"name\": \"æå››\", \"age\": 40, \"sex\": \"ç”·\" } } 3.5.2 è·å–å…¨éƒ¨æ•°æ®é»˜è®¤è¿”å›10æ¡æ•°æ® GET /haoke/user/_search3.5.3 å…³é”®è¯æœç´¢#æŸ¥è¯¢å¹´é¾„ç­‰äº20çš„ç”¨æˆ· GET /haoke/user/_search?q=age:203.6 é«˜çº§æœç´¢DSLElasticsearchæä¾›ä¸°å¯Œä¸”çµæ´»çš„æŸ¥è¯¢è¯­è¨€å«åšDSLæŸ¥è¯¢(Query DSL),å®ƒå…è®¸ä½ æ„å»ºæ›´åŠ å¤æ‚ã€å¼ºå¤§çš„æŸ¥è¯¢ã€‚ DSL(Domain Specific Languageç‰¹å®šé¢†åŸŸè¯­è¨€)ä»¥JSONè¯·æ±‚ä½“çš„å½¢å¼å‡ºç°ã€‚ 3.6.1 æ ‡å‡†æŸ¥è¯¢POST /haoke/user/_search #è¯·æ±‚ä½“ { \"query\" : { \"match\" : { #matchåªæ˜¯æŸ¥è¯¢çš„ä¸€ç§ \"age\" : 20 } } } 3.6.2 èŒƒå›´æŸ¥è¯¢POST /haoke/user/_search #è¯·æ±‚æ•°æ® { \"query\": { \"bool\": { \"must\": { \"range\": { \"age\": { \"gt\": 30 } } }, \"must\": { \"match\": { \"sex\": \"ç”·\" } } } } } boolåˆæ˜¯ä¸€ä¸ªç»„åˆæŸ¥è¯¢ï¼Œå¯¹åº”luceneé‡Œé¢çš„BooleanQuery 3.6.3 ç²¾ç¡®åŒ¹é…ä½¿ç”¨termæˆ–terms 3.6.4 é«˜äº®æ˜¾ç¤ºfieldæŒ‡å®šè¦åŒ¹é…çš„åŸŸï¼Œå¯ä»¥å¡«å†™è¦é«˜äº®çš„è¯ã€‚ POST /haoke/user/_search { \"query\": { \"match\": { \"name\": \"å¼ ä¸‰ æå››\" } }, \"highlight\": { \"fields\": { \"name\": {} } } } 3.6.5 èšåˆåœ¨Elasticsearchä¸­ï¼Œæ”¯æŒèšåˆæ“ä½œï¼Œç±»ä¼¼SQLä¸­çš„group byæ“ä½œã€‚ POST /haoke/user/_search { \"aggs\": { \"all_interests\": { \"terms\": { \"field\": \"age\" } } } } è¿™è¡¨ç¤ºä½¿ç”¨â€ageâ€åŸŸè¿›è¡Œèšåˆã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://www.codetool.top/tags/ElasticSearch/"}]},{"title":"Luceneé«˜çº§æŸ¥è¯¢","slug":"Luceneé«˜çº§æŸ¥è¯¢","date":"2020-03-28T10:48:35.000Z","updated":"2020-03-28T10:49:05.681Z","comments":true,"path":"article/Luceneé«˜çº§æŸ¥è¯¢/","link":"","permalink":"https://www.codetool.top/article/Lucene%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2/","excerpt":"","text":"1 æ–‡æœ¬æœç´¢QueryParserå¯ä»¥æŒ‡å®šé»˜è®¤åŸŸï¼ŒqueryParser.parseä¸­åˆå¯ä»¥ç”¨åŸŸå:å…³é”®è¯æ¥è¦†ç›–å®ƒã€‚å¦‚æœparseä¸­æ²¡æœ‰æŒ‡å®šæœç´¢åŸŸå°±ä½¿ç”¨é»˜è®¤åŸŸã€‚ @Test public void testIndexSearch() throws Exception { // 1. åˆ›å»ºQueryæœç´¢å¯¹è±¡ // åˆ›å»ºåˆ†è¯å™¨ Analyzer analyzer = new IKAnalyzer(); // åˆ›å»ºæœç´¢è§£æå™¨ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼šé»˜è®¤FieldåŸŸï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼šåˆ†è¯å™¨ QueryParser queryParser = new QueryParser(\"brandName\", analyzer); // åˆ›å»ºæœç´¢å¯¹è±¡ Query query = queryParser.parse(\"name:åä¸ºæ‰‹æœº\"); // 2. åˆ›å»ºDirectoryæµå¯¹è±¡,å£°æ˜ç´¢å¼•åº“ä½ç½® Directory directory = FSDirectory.open(Paths.get(\"E:\\\\dir\")); // 3. åˆ›å»ºç´¢å¼•è¯»å–å¯¹è±¡IndexReader IndexReader reader = DirectoryReader.open(directory); // 4. åˆ›å»ºç´¢å¼•æœç´¢å¯¹è±¡ IndexSearcher searcher = new IndexSearcher(reader); // 5. ä½¿ç”¨ç´¢å¼•æœç´¢å¯¹è±¡ï¼Œæ‰§è¡Œæœç´¢ï¼Œè¿”å›ç»“æœé›†TopDocs // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šæœç´¢å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼šè¿”å›çš„æ•°æ®æ¡æ•°ï¼ŒæŒ‡å®šæŸ¥è¯¢ç»“æœæœ€é¡¶éƒ¨çš„næ¡æ•°æ®è¿”å› TopDocs topDocs = searcher.search(query, 50); System.out.println(\"æŸ¥è¯¢åˆ°çš„æ•°æ®æ€»æ¡æ•°æ˜¯ï¼š\" + topDocs.totalHits); // è·å–æŸ¥è¯¢ç»“æœé›† ScoreDoc[] docs = topDocs.scoreDocs; // 6. è§£æç»“æœé›† for (ScoreDoc scoreDoc : docs) { // è·å–æ–‡æ¡£ int docID = scoreDoc.doc; Document doc = searcher.doc(docID); System.out.println(\"=============================\"); System.out.println(\"docID:\" + docID); System.out.println(\"id:\" + doc.get(\"id\")); System.out.println(\"name:\" + doc.get(\"name\")); System.out.println(\"price:\" + doc.get(\"price\")); System.out.println(\"brandName:\" + doc.get(\"brandName\")); System.out.println(\"image:\" + doc.get(\"image\")); } // 7. é‡Šæ”¾èµ„æº reader.close(); } queryParser.parseæ›´å¤šç”¨æ³•ï¼š ä½¿ç”¨ANDæ±‚å¹¶é›†ï¼Œä½¿ç”¨ORæ±‚äº¤é›†ï¼Œæ³¨æ„å¿…é¡»å¤§å†™ queryParser.parse(\"åä¸º AND æ‰‹æœº\") queryParser.parse(\"åä¸º OR æ‰‹æœº\") 2 æ•°å€¼èŒƒå›´æŸ¥è¯¢ä¾‹å¦‚ï¼š æŸ¥è¯¢ä»·æ ¼å¤§äºç­‰äº100, å°äºç­‰äº1000çš„å•†å“ @Test public void testRangeQuery() throws Exception { // 1. åˆ›å»ºQueryæœç´¢å¯¹è±¡ Query query = FloatPoint.newRangeQuery(\"price\", 100, 1000); // 2. åˆ›å»ºDirectoryæµå¯¹è±¡,å£°æ˜ç´¢å¼•åº“ä½ç½® Directory directory = FSDirectory.open(Paths.get(\"E:\\\\dir\")); // 3. åˆ›å»ºç´¢å¼•è¯»å–å¯¹è±¡IndexReader IndexReader reader = DirectoryReader.open(directory); // 4. åˆ›å»ºç´¢å¼•æœç´¢å¯¹è±¡ IndexSearcher searcher = new IndexSearcher(reader); // 5. ä½¿ç”¨ç´¢å¼•æœç´¢å¯¹è±¡ï¼Œæ‰§è¡Œæœç´¢ï¼Œè¿”å›ç»“æœé›†TopDocs // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šæœç´¢å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼šè¿”å›çš„æ•°æ®æ¡æ•°ï¼ŒæŒ‡å®šæŸ¥è¯¢ç»“æœæœ€é¡¶éƒ¨çš„næ¡æ•°æ®è¿”å› TopDocs topDocs = searcher.search(query, 10); System.out.println(\"æŸ¥è¯¢åˆ°çš„æ•°æ®æ€»æ¡æ•°æ˜¯ï¼š\" + topDocs.totalHits); // è·å–æŸ¥è¯¢ç»“æœé›† ScoreDoc[] docs = topDocs.scoreDocs; // 6. è§£æç»“æœé›† for (ScoreDoc scoreDoc : docs) { // è·å–æ–‡æ¡£ int docID = scoreDoc.doc; Document doc = searcher.doc(docID); System.out.println(\"=============================\"); System.out.println(\"docID:\" + docID); System.out.println(\"id:\" + doc.get(\"id\")); System.out.println(\"name:\" + doc.get(\"name\")); System.out.println(\"price:\" + doc.get(\"price\")); System.out.println(\"brandName:\" + doc.get(\"brandName\")); System.out.println(\"image:\" + doc.get(\"image\")); } // 7. é‡Šæ”¾èµ„æº reader.close(); } 3 ç»„åˆæŸ¥è¯¢ç»„åˆæŸ¥è¯¢å¯ä»¥ç»„åˆå¤šä¸ªæŸ¥è¯¢å¯¹è±¡ï¼Œå³å¤šä¸ªæ¡ä»¶ï¼Œä½¿ç”¨BooleanQuery.Builderæ„é€ ã€‚ æ¯è”ç³»ä¸€ä¸ªQueryå¯¹è±¡ï¼Œå¯ä»¥æŒ‡å®šï¼š BooleanClause.Occur.MUST å¿…é¡» ç›¸å½“äºand, å¹¶ä¸” BooleanClause.Occur.MUST_NOT ä¸å¿…é¡» ç›¸å½“äºnot, é BooleanClause.Occur.SHOULD åº”è¯¥ ç›¸å½“äºor, æˆ–è€… æ³¨æ„: å¦‚æœé€»è¾‘æ¡ä»¶ä¸­, åªæœ‰MUST_NOT, æˆ–è€…å¤šä¸ªé€»è¾‘æ¡ä»¶éƒ½æ˜¯MUST_NOT, æ— æ•ˆ, æŸ¥è¯¢ä¸å‡ºä»»ä½•æ•°æ®ã€‚ @Test public void testBooleanSearch() throws Exception { // åˆ›å»ºåˆ†è¯å™¨ Analyzer analyzer = new IKAnalyzer(); // åˆ›å»ºæ•°å€¼èŒƒå›´æœç´¢å¯¹è±¡ Query query1 = FloatPoint.newRangeQuery(\"price\", 100, 1000); QueryParser queryParser = new QueryParser(\"name\", analyzer); // åˆ›å»ºæœç´¢å¯¹è±¡ Query query2 = queryParser.parse(\"åä¸ºæ‰‹æœº\"); // åˆ›å»ºç»„åˆæœç´¢å¯¹è±¡ BooleanQuery.Builder builder = new BooleanQuery.Builder(); builder.add(new BooleanClause(query1, BooleanClause.Occur.MUST)); builder.add(new BooleanClause(query2, BooleanClause.Occur.MUST_NOT)); // 2. åˆ›å»ºDirectoryæµå¯¹è±¡,å£°æ˜ç´¢å¼•åº“ä½ç½® Directory directory = FSDirectory.open(Paths.get(\"E:\\\\dir\")); // 3. åˆ›å»ºç´¢å¼•è¯»å–å¯¹è±¡IndexReader IndexReader reader = DirectoryReader.open(directory); // 4. åˆ›å»ºç´¢å¼•æœç´¢å¯¹è±¡ IndexSearcher searcher = new IndexSearcher(reader); // 5. ä½¿ç”¨ç´¢å¼•æœç´¢å¯¹è±¡ï¼Œæ‰§è¡Œæœç´¢ï¼Œè¿”å›ç»“æœé›†TopDocs // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šæœç´¢å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼šè¿”å›çš„æ•°æ®æ¡æ•°ï¼ŒæŒ‡å®šæŸ¥è¯¢ç»“æœæœ€é¡¶éƒ¨çš„næ¡æ•°æ®è¿”å› TopDocs topDocs = searcher.search(builder.build(), 10); System.out.println(\"æŸ¥è¯¢åˆ°çš„æ•°æ®æ€»æ¡æ•°æ˜¯ï¼š\" + topDocs.totalHits); // è·å–æŸ¥è¯¢ç»“æœé›† ScoreDoc[] docs = topDocs.scoreDocs; // 6. è§£æç»“æœé›† for (ScoreDoc scoreDoc : docs) { // è·å–æ–‡æ¡£ int docID = scoreDoc.doc; Document doc = searcher.doc(docID); System.out.println(\"=============================\"); System.out.println(\"docID:\" + docID); System.out.println(\"id:\" + doc.get(\"id\")); System.out.println(\"name:\" + doc.get(\"name\")); System.out.println(\"price:\" + doc.get(\"price\")); System.out.println(\"brandName:\" + doc.get(\"brandName\")); System.out.println(\"image:\" + doc.get(\"image\")); } // 7. é‡Šæ”¾èµ„æº reader.close(); }","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Lucene","slug":"Lucene","permalink":"https://www.codetool.top/tags/Lucene/"}]},{"title":"leetcode820-å•è¯çš„å‹ç¼©ç¼–ç ","slug":"leetcode820-å•è¯çš„å‹ç¼©ç¼–ç ","date":"2020-03-28T02:25:49.000Z","updated":"2020-03-28T02:30:58.133Z","comments":true,"path":"article/leetcode820-å•è¯çš„å‹ç¼©ç¼–ç /","link":"","permalink":"https://www.codetool.top/article/leetcode820-%E5%8D%95%E8%AF%8D%E7%9A%84%E5%8E%8B%E7%BC%A9%E7%BC%96%E7%A0%81/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªå•è¯åˆ—è¡¨ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªåˆ—è¡¨ç¼–ç æˆä¸€ä¸ªç´¢å¼•å­—ç¬¦ä¸² S ä¸ä¸€ä¸ªç´¢å¼•åˆ—è¡¨ Aã€‚ ä¾‹å¦‚ï¼Œå¦‚æœè¿™ä¸ªåˆ—è¡¨æ˜¯ [&quot;time&quot;, &quot;me&quot;, &quot;bell&quot;]ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å…¶è¡¨ç¤ºä¸º S = &quot;time#bell#&quot; å’Œ indexes = [0, 2, 5]ã€‚ å¯¹äºæ¯ä¸€ä¸ªç´¢å¼•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»å­—ç¬¦ä¸² S ä¸­ç´¢å¼•çš„ä½ç½®å¼€å§‹è¯»å–å­—ç¬¦ä¸²ï¼Œç›´åˆ° â€œ#â€ ç»“æŸï¼Œæ¥æ¢å¤æˆ‘ä»¬ä¹‹å‰çš„å•è¯åˆ—è¡¨ã€‚ é‚£ä¹ˆæˆåŠŸå¯¹ç»™å®šå•è¯åˆ—è¡¨è¿›è¡Œç¼–ç çš„æœ€å°å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿ ç¤ºä¾‹: è¾“å…¥: words = [â€œtimeâ€, â€œmeâ€, â€œbellâ€]è¾“å‡º: 10è¯´æ˜: S = â€œtime#bell#â€ ï¼Œ indexes = [0, 2, 5] ã€‚ æç¤º: 1 &lt;= words.length &lt;= 2000 1 &lt;= words[i].length &lt;= 7 æ¯ä¸ªå•è¯éƒ½æ˜¯å°å†™å­—æ¯ ã€‚ 2 è§£æ³•2.1 æ€æƒ³ æš´åŠ›æœç´¢åç¼€ã€‚ ä½¿ç”¨å­—å…¸æ ‘å€’åºå­˜å‚¨å­—ç¬¦ä¸²ã€‚ 2.2 ä»£ç æš´åŠ›æ£€æŸ¥åç¼€ï¼š class Solution { public int minimumLengthEncoding(String[] words) { List&lt;String> list = new ArrayList&lt;>(); for(String word:words){ boolean noNeedToAdd = false; for(int i = 0;i&lt;list.size();i++){ if(word.lastIndexOf(list.get(i))!=-1&amp;&amp;word.lastIndexOf(list.get(i))==word.length()-list.get(i).length()){ list.set(i,word); noNeedToAdd = true; }else if(list.get(i).lastIndexOf(word)!=-1&amp;&amp;list.get(i).lastIndexOf(word)==list.get(i).length()-word.length()){ noNeedToAdd = true; } } if(!noNeedToAdd) list.add(word); } int sum = 0; for(String word:list){ sum += word.length()+1; } return sum; } } ä½¿ç”¨å­—å…¸æ ‘å€’åºå­˜å‚¨å­—ç¬¦ä¸²ï¼š class Solution { public int minimumLengthEncoding(String[] words) { TrieNode trie = new TrieNode(); Map&lt;TrieNode, Integer> nodes = new HashMap(); for (int i = 0; i &lt; words.length; ++i) { String word = words[i]; TrieNode cur = trie; for (int j = word.length() - 1; j >= 0; --j) cur = cur.get(word.charAt(j)); nodes.put(cur, i); } int ans = 0; for (TrieNode node: nodes.keySet()) { if (node.count == 0) ans += words[nodes.get(node)].length() + 1; } return ans; } } class TrieNode { TrieNode[] children; int count; TrieNode() { children = new TrieNode[26]; count = 0; } public TrieNode get(char c) { if (children[c - 'a'] == null) { children[c - 'a'] = new TrieNode(); count++; } return children[c - 'a']; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"è·³è¡¨-æŠ«ç€é“¾è¡¨å¤–è¡£çš„ä¼ªæœç´¢æ ‘","slug":"è·³è¡¨-æŠ«ç€é“¾è¡¨å¤–è¡£çš„ä¼ªæœç´¢æ ‘","date":"2020-03-27T16:06:37.000Z","updated":"2020-03-27T16:32:41.439Z","comments":true,"path":"article/è·³è¡¨-æŠ«ç€é“¾è¡¨å¤–è¡£çš„ä¼ªæœç´¢æ ‘/","link":"","permalink":"https://www.codetool.top/article/%E8%B7%B3%E8%A1%A8-%E6%8A%AB%E7%9D%80%E9%93%BE%E8%A1%A8%E5%A4%96%E8%A1%A3%E7%9A%84%E4%BC%AA%E6%90%9C%E7%B4%A2%E6%A0%91/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š ã€æ•°æ®ç»“æ„ä¸ç®—æ³•ã€‘ä¹‹è·³è¡¨ï¼ˆJavaå®ç°ï¼‰â€”ç¬¬ä¹ç¯‡_Java_éœ‡å“¥èŠæ ¡æ‹›-CSDNåšå®¢ è·³è¡¨çš„åŸç†åŠå®ä¾‹ - Rogn - åšå®¢å›­ è·³è¡¨Javaå®ç°_Java_åç¦»çš„å®šå¼¦-CSDNåšå®¢ 1 è·³è¡¨æ¦‚è¿°å¦‚æœè¯´æŸä¸€ç§æ•°æ®ç»“æ„èƒ½è¾¾åˆ°ä»¥lognçš„é€Ÿåº¦æŸ¥æ‰¾æ•°æ®ï¼Œç›¸ä¿¡å¤§å¤šæ•°äººç¬¬ä¸€ååº”éƒ½æ˜¯äºŒåˆ†æŸ¥æ‰¾æˆ–æ˜¯æœç´¢æ ‘ã€‚ å¯¹äºäºŒåˆ†æŸ¥æ‰¾æ¥è¯´ï¼Œå®ƒé€šå¸¸æ˜¯ä¸€ä¸ªæœ‰åºæ•°ç»„ï¼Œè™½ç„¶æŸ¥æ‰¾æ•ˆç‡è¾¾åˆ°äº†lognï¼Œä½†æ’å…¥æ•ˆç‡è¦ä¹ˆå°±æ˜¯æ•°ç»„ä¸å…è®¸æ’å…¥ï¼Œè¦ä¹ˆå°±æ˜¯arraylistä¸ºlognã€‚ å¯¹äºæœç´¢æ ‘ï¼Œåˆ™å¿…é¡»è¦æ˜¯è‡ªå¹³è¡¡çš„æœç´¢æ ‘æ‰èƒ½åœ¨æ’å…¥äº†å¾ˆå¤šæ•°æ®ä¹‹åä¾ç„¶ä¿æŒlognçš„æŸ¥æ‰¾æ•ˆç‡ï¼Œè¿™å°±è¦æ±‚æ’å…¥æ¶‰åŠåˆ°æ—‹è½¬å¹³è¡¡æ“ä½œï¼Œå®ç°è¾ƒå¤æ‚ã€‚ è€Œæˆ‘ä»¬ä»Šå¤©è¦ä»‹ç»çš„ä¸»è§’â€”â€”è·³è¡¨ï¼Œç›¸è¾ƒäºçº¢é»‘æ ‘ã€AVLç­‰è‡ªå¹³è¡¡æœç´¢æ ‘çš„å®ç°ä¼šæ›´ç®€å•äº›ï¼ŒæŸ¥æ‰¾æ•ˆç‡å’Œæ’å…¥æ•ˆç‡ä¹Ÿéƒ½è¾¾åˆ°äº†lognã€‚ 1.1 è·³è¡¨çš„æ€§è´¨ ç”±å¾ˆå¤šå±‚ç»“æ„ç»„æˆï¼Œlevelæ˜¯é€šè¿‡ä¸€å®šçš„æ¦‚ç‡éšæœºäº§ç”Ÿçš„ æ¯ä¸€å±‚éƒ½æ˜¯ä¸€ä¸ªæœ‰åºçš„é“¾è¡¨ï¼Œé»˜è®¤æ˜¯å‡åº æœ€åº•å±‚(Level 1)çš„é“¾è¡¨åŒ…å«æ‰€æœ‰å…ƒç´ ï¼› å¦‚æœä¸€ä¸ªå…ƒç´ å‡ºç°åœ¨Level i çš„é“¾è¡¨ä¸­ï¼Œåˆ™å®ƒåœ¨Level i ä¹‹ä¸‹çš„é“¾è¡¨ä¹Ÿéƒ½ä¼šå‡ºç°ï¼› æ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘åŒä¸€é“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œä¸€ä¸ªæŒ‡å‘ä¸‹é¢ä¸€å±‚çš„å…ƒç´ ã€‚ 2 è·³è¡¨åŸç†ç”¨å›¾ç‰‡å½¢å¼æ¥ç†è§£è·³è¡¨: å¦‚ä¸‹å›¾ï¼Œå¯¹åˆå§‹é“¾è¡¨åšä¸€å±‚â€œç´¢å¼•â€ï¼Œæ¯ä¸¤ä¸ªèŠ‚ç‚¹æå–ä¸€ä¸ªèŠ‚ç‚¹åˆ°ä¸Šä¸€å±‚ï¼Œç„¶åç”¨downæŒ‡é’ˆè¿æ¥åˆ°ä¸‹ä¸€å±‚ã€‚ ç°åœ¨æˆ‘ä»¬æŸ¥è¯¢16è¿™ä¸ªèŠ‚ç‚¹ã€‚ä»ç¬¬ä¸€çº§ç´¢å¼•å¼€å§‹ï¼Œæ‰¾åˆ°13ï¼Œå¹¶ä¸”ä¸‹ä¸€ä¸ªä¸º17ï¼Œæ˜¾ç„¶16åœ¨è¿™ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´ï¼Œåˆ©ç”¨downæŒ‡é’ˆä¸‹é™ä¸€å±‚ï¼Œè¿™æ¬¡æˆ‘ä»¬éå†2æ¬¡å³å¯ã€‚åˆ©ç”¨ç´¢å¼•åï¼Œéå†äº†5+2=7æ¬¡ï¼Œè€ŒåŸå§‹é“¾è¡¨éœ€è¦10æ¬¡ï¼Œè¿™é‡ŒåŠ ä¸€å±‚ç´¢å¼•éå†æ¬¡æ•°å‡å°‘äº†ï¼Œæ•ˆç‡æé«˜äº†ä¸€ç‚¹ï¼Œä½†è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸Šæ·»åŠ ç´¢å¼•å±‚ã€‚ è¿™é‡Œæˆ‘ä¸å†ç®—äº†ï¼Œç»“æœæ˜¯6æ¬¡ï¼Œæ•ˆç‡åˆæé«˜äº†ï¼ é‚£ä¹ˆè¿™ç§é“¾è¡¨åŠ å¤šçº§ç´¢å¼•å°±æ˜¯è·³è¡¨çš„ç»“æ„äº†ã€‚å¯ä»¥çœ‹å‡ºæ¥æœ€åå½¢æˆçš„å°±æ˜¯ä¸€ä¸ªç±»ä¼¼äºæœç´¢æ ‘çš„ç»“æ„ã€‚ 3 è·³è¡¨çš„æ“ä½œJavaä¸­å·²ç»æœ‰äº†è·³è¡¨æ€æƒ³çš„å®ç°ï¼šconcurrentåŒ…ä¸‹çš„ConcurrentSkipListMap(åœ¨åŠŸèƒ½ä¸Šå¯¹åº”HashTableã€HashMapã€TreeMap)å’Œ ConcurrentSkipListSet(åœ¨åŠŸèƒ½ä¸Šå¯¹åº”HashSet)ã€‚ 3.1 è·³è¡¨çš„æ’å…¥è·³è¡¨æ’å…¥çš„æ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(logn)ï¼Œæ”¯æŒé«˜æ•ˆçš„åŠ¨æ€æ’å…¥ã€‚ åœ¨å•é“¾è¡¨ä¸­ï¼Œä¸€æ—¦å®šä½å¥½è¦æ’å…¥çš„ä½ç½®ï¼Œæ’å…¥ç»“ç‚¹çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¾ˆä½çš„ï¼Œå°±æ˜¯O(1)ã€‚ä½†æ˜¯ä¸ºäº†ä¿è¯åŸå§‹é“¾è¡¨ä¸­æ•°æ®çš„æœ‰åºæ€§ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ‰¾åˆ°è¦æ’å…¥çš„ä½ç½®ï¼Œè¿™ä¸ªæŸ¥æ‰¾çš„æ“ä½œå°±ä¼šæ¯”è¾ƒè€—æ—¶ã€‚ å¯¹äºçº¯ç²¹çš„å•é“¾è¡¨ï¼Œéœ€è¦éå†æ¯ä¸ªç»“ç‚¹ï¼Œæ¥æ‰¾åˆ°æ’å…¥çš„ä½ç½®ã€‚ä½†æ˜¯å¯¹äºè·³è¡¨æ¥è¯´ï¼ŒæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(logn)ï¼Œæ‰€ä»¥è¿™é‡ŒæŸ¥æ‰¾æŸä¸ªæ•°æ®åº”è¯¥æ’å…¥çš„ä½ç½®çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯O(logn)ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 3.2 è·³è¡¨çš„åˆ é™¤è·³è¡¨çš„åˆ é™¤æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(logn)ï¼Œæ”¯æŒåŠ¨æ€çš„åˆ é™¤ã€‚ åœ¨è·³è¡¨ä¸­åˆ é™¤æŸä¸ªç»“ç‚¹æ—¶ï¼Œå¦‚æœè¿™ä¸ªç»“ç‚¹åœ¨ç´¢å¼•ä¸­ä¹Ÿå‡ºç°äº†ï¼Œæˆ‘ä»¬é™¤äº†è¦åˆ é™¤åŸå§‹é“¾è¡¨ä¸­çš„ç»“ç‚¹ï¼Œè¿˜è¦åˆ é™¤ç´¢å¼•ä¸­çš„ã€‚å› ä¸ºå•é“¾è¡¨ä¸­çš„åˆ é™¤æ“ä½œéœ€è¦æ‹¿åˆ°åˆ é™¤ç»“ç‚¹çš„å‰é©±ç»“ç‚¹ï¼Œç„¶åå†é€šè¿‡æŒ‡é’ˆæ“ä½œå®Œæˆåˆ é™¤ã€‚æ‰€ä»¥åœ¨æŸ¥æ‰¾è¦åˆ é™¤çš„ç»“ç‚¹çš„æ—¶å€™ï¼Œä¸€å®šè¦è·å–å‰é©±ç»“ç‚¹ï¼ˆåŒå‘é“¾è¡¨é™¤å¤–ï¼‰ã€‚å› æ­¤è·³è¡¨çš„åˆ é™¤æ“ä½œæ—¶é—´å¤æ‚åº¦å³ä¸ºO(logn)ã€‚ 3.3 è·³è¡¨ç´¢å¼•åŠ¨æ€æ›´æ–°å½“æˆ‘ä»¬ä¸æ–­åœ°å¾€è·³è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å¦‚æœä¸æ›´æ–°ç´¢å¼•ï¼Œå°±æœ‰å¯èƒ½å‡ºç°æŸ2ä¸ªç´¢å¼•èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®éå¸¸å¤šçš„æƒ…å†µï¼Œåœ¨æç«¯æƒ…å†µä¸‹ï¼Œè·³è¡¨è¿˜ä¼šé€€åŒ–æˆå•é“¾è¡¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä½œä¸ºä¸€ç§åŠ¨æ€æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬éœ€è¦æŸç§æ‰‹æ®µæ¥ç»´æŠ¤ç´¢å¼•ä¸åŸå§‹é“¾è¡¨å¤§å°ä¹‹é—´çš„å¹³è¡¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœé“¾è¡¨ä¸­çš„ç»“ç‚¹å¤šäº†ï¼Œç´¢å¼•ç»“ç‚¹å°±ç›¸åº”åœ°å¢åŠ ä¸€äº›ï¼Œé¿å…å¤æ‚åº¦é€€åŒ–ï¼Œä»¥åŠæŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œæ€§èƒ½çš„ä¸‹é™ã€‚ å¦‚æœä½ äº†è§£çº¢é»‘æ ‘ã€AVLæ ‘è¿™æ ·çš„å¹³è¡¡äºŒå‰æ ‘ï¼Œä½ å°±ä¼šçŸ¥é“å®ƒä»¬æ˜¯é€šè¿‡å·¦å³æ—‹çš„æ–¹å¼ä¿æŒå·¦å³å­æ ‘çš„å¤§å°å¹³è¡¡ï¼Œè€Œè·³è¡¨æ˜¯é€šè¿‡éšæœºå‡½æ•°æ¥ç»´æŠ¤â€œå¹³è¡¡æ€§â€ã€‚ å½“æˆ‘ä»¬å¾€è·³è¡¨ä¸­æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªéšæœºå‡½æ•°ï¼Œæ¥å†³å®šè¿™ä¸ªç»“ç‚¹æ’å…¥åˆ°å“ªå‡ çº§ç´¢å¼•å±‚ä¸­ï¼Œæ¯”å¦‚éšæœºå‡½æ•°ç”Ÿæˆäº†å€¼Kï¼Œé‚£æˆ‘ä»¬å°±å°†è¿™ä¸ªç»“ç‚¹æ·»åŠ åˆ°ç¬¬ä¸€çº§åˆ°ç¬¬Kçº§è¿™ä¸ªKçº§ç´¢å¼•ä¸­ã€‚å¦‚ä¸‹å›¾ä¸­è¦æ’å…¥æ•°æ®ä¸º6ï¼ŒK=2çš„ä¾‹å­ï¼š éšæœºå‡½æ•°çš„é€‰æ‹©æ˜¯éå¸¸æœ‰è®²ç©¶çš„ï¼Œä»æ¦‚ç‡ä¸Šè®²ï¼Œèƒ½å¤Ÿä¿è¯è·³è¡¨çš„ç´¢å¼•å¤§å°å’Œæ•°æ®å¤§å°å¹³è¡¡æ€§ï¼Œä¸è‡³äºæ€§èƒ½çš„è¿‡åº¦é€€åŒ–ã€‚è‡³äºéšæœºå‡½æ•°çš„é€‰æ‹©ï¼Œè§ä¸‹é¢çš„ä»£ç å®ç°è¿‡ç¨‹ï¼Œè€Œä¸”å®ç°è¿‡ç¨‹å¹¶ä¸æ˜¯é‡ç‚¹ï¼ŒæŒæ¡æ€æƒ³å³å¯ã€‚ 4 è·³è¡¨çš„Javaå®ç°// è·³è¡¨ä¸­å­˜å‚¨çš„æ˜¯æ­£æ•´æ•°ï¼Œå¹¶ä¸”å­˜å‚¨çš„æ•°æ®æ˜¯ä¸é‡å¤çš„ public class SkipList { private static final int MAX_LEVEL = 16; // ç»“ç‚¹çš„ä¸ªæ•° private int levelCount = 1; // ç´¢å¼•çš„å±‚çº§æ•° private Node head = new Node(); // å¤´ç»“ç‚¹ private Random random = new Random(); // Nodeå†…éƒ¨ç±» public class Node{ private int data = -1; private Node next[] = new Node[MAX_LEVEL]; private int maxLevel = 0; // é‡å†™toStringæ–¹æ³• @Override public String toString(){ StringBuilder builder = new StringBuilder(); builder.append(\"{data:\"); builder.append(data); builder.append(\"; leves: \"); builder.append(maxLevel); builder.append(\" }\"); return builder.toString(); } } // æŸ¥æ‰¾æ“ä½œ public Node find(int value){ Node p = head; for(int i = levelCount - 1; i >= 0; --i){ while(p.next[i] != null &amp;&amp; p.next[i].data &lt; value){ p = p.next[i]; } } if(p.next[0] != null &amp;&amp; p.next[0].data == value){ return p.next[0]; // æ‰¾åˆ°ï¼Œåˆ™è¿”å›åŸå§‹é“¾è¡¨ä¸­çš„ç»“ç‚¹ }else{ return null; } } // æ’å…¥æ“ä½œ public void insert(int value){ int level = randomLevel(); Node newNode = new Node(); newNode.data = value; newNode.maxLevel = level; // é€šè¿‡éšæœºå‡½æ•°æ”¹å˜ç´¢å¼•å±‚çš„ç»“ç‚¹å¸ƒç½® Node update[] = new Node[level]; for(int i = 0; i &lt; level; ++i){ update[i] = head; } Node p = head; for(int i = level - 1; i >= 0; --i){ while(p.next[i] != null &amp;&amp; p.next[i].data &lt; value){ p = p.next[i]; } update[i] = p; } for(int i = 0; i &lt; level; ++i){ newNode.next[i] = update[i].next[i]; update[i].next[i] = newNode; } if(levelCount &lt; level){ levelCount = level; } } // åˆ é™¤æ“ä½œ public void delete(int value){ Node[] update = new Node[levelCount]; Node p = head; for(int i = levelCount - 1; i >= 0; --i){ while(p.next[i] != null &amp;&amp; p.next[i].data &lt; value){ p = p.next[i]; } update[i] = p; } if(p.next[0] != null &amp;&amp; p.next[0].data == value){ for(int i = levelCount - 1; i >= 0; --i){ if(update[i].next[i] != null &amp;&amp; update[i].next[i].data == value){ update[i].next[i] = update[i].next[i].next[i]; } } } } // éšæœºå‡½æ•° private int randomLevel(){ int level = 1; for(int i = 1; i &lt; MAX_LEVEL; ++i){ if(random.nextInt() % 2 == 1){ level++; } } return level; } // æ˜¾ç¤ºè·³è¡¨ä¸­çš„ç»“ç‚¹ public void display(){ Node p = head; while(p.next[0] != null){ System.out.println(p.next[0] + \" \"); p = p.next[0]; } System.out.println(); } } 5 è·³è¡¨çš„åº”ç”¨ Lucene3.0ç‰ˆæœ¬ä¹‹å‰ä½¿ç”¨è·³è¡¨ç»“æ„å­˜å‚¨è¯å…¸ï¼Œåæ¥æ¢æˆäº†FSTï¼ˆæœ‰é™çŠ¶æ€è½¬ç§»æœºï¼‰ Redisåœ¨ä¸¤ä¸ªåœ°æ–¹ç”¨åˆ°äº†è·³è·ƒè¡¨ï¼Œä¸€ä¸ªæ˜¯å®ç°æœ‰åºé›†åˆé”®ï¼Œå¦ä¸€ä¸ªæ˜¯åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸­ç”¨ä½œå†…éƒ¨æ•°æ®ç»“æ„ã€‚ â€¦â€¦","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"Luceneä¸­çš„åˆ†è¯å™¨æ¦‚è¿°","slug":"Luceneä¸­çš„åˆ†è¯å™¨æ¦‚è¿°","date":"2020-03-27T12:46:35.000Z","updated":"2020-03-27T12:46:53.507Z","comments":true,"path":"article/Luceneä¸­çš„åˆ†è¯å™¨æ¦‚è¿°/","link":"","permalink":"https://www.codetool.top/article/Lucene%E4%B8%AD%E7%9A%84%E5%88%86%E8%AF%8D%E5%99%A8%E6%A6%82%E8%BF%B0/","excerpt":"","text":"1 åˆ†è¯å™¨æ¦‚è¿°åœ¨å¯¹Documentä¸­çš„å†…å®¹è¿›è¡Œç´¢å¼•ä¹‹å‰ï¼Œéœ€è¦ä½¿ç”¨åˆ†è¯å™¨ï¼ˆAnalyzerï¼‰è¿›è¡Œåˆ†è¯ï¼Œåˆ†è¯çš„ç›®çš„æ˜¯ä¸ºäº†æœç´¢ã€‚åˆ†è¯çš„ä¸»è¦è¿‡ç¨‹å°±æ˜¯å…ˆåˆ†è¯åè¿‡æ»¤ã€‚ åˆ†è¯ï¼šé‡‡é›†åˆ°çš„æ•°æ®ä¼šå­˜å‚¨åˆ°documentå¯¹è±¡çš„FieldåŸŸä¸­ï¼Œåˆ†è¯å°±æ˜¯å°†Documentä¸­Fieldçš„valueå€¼åˆ‡åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„è¯ã€‚ è¿‡æ»¤ï¼šåŒ…æ‹¬å»é™¤æ ‡ç‚¹ç¬¦å·è¿‡æ»¤ã€å»é™¤åœç”¨è¯è¿‡æ»¤(çš„ã€æ˜¯ã€aã€an. theç­‰)ã€å¤§å†™è½¬å°å†™ã€è¯çš„å½¢è¿˜åŸ(å¤æ•°å½¢å¼è½¬æˆå•æ•°å½¢å‚ã€è¿‡å»å¼è½¬æˆç°åœ¨å¼ã€‚ã€‚ã€‚)ç­‰ã€‚ åœç”¨è¯ï¼š åœç”¨è¯æ˜¯ä¸ºèŠ‚çœå­˜å‚¨ç©ºé—´å’Œæé«˜æœç´¢æ•ˆç‡ï¼Œæœç´¢å¼•æ“åœ¨ç´¢å¼•é¡µé¢æˆ–å¤„ç†æœç´¢è¯·æ±‚æ—¶ä¼šè‡ªåŠ¨å¿½ç•¥æŸäº›å­—æˆ–è¯ï¼Œè¿™äº›å­—æˆ–è¯å³è¢«ç§°ä¸ºStop Words(åœç”¨è¯)ã€‚æ¯”å¦‚è¯­æ°”åŠ©è¯ã€å‰¯è¯ã€ä»‹è¯ã€è¿æ¥è¯ç­‰ï¼Œé€šå¸¸è‡ªèº«å¹¶æ— æ˜ç¡®çš„æ„ä¹‰ï¼Œåªæœ‰å°†å…¶æ”¾å…¥ä¸€ä¸ªå®Œæ•´çš„å¥å­ä¸­æ‰æœ‰ä¸€å®šä½œç”¨ï¼Œå¦‚å¸¸è§çš„â€œçš„â€ã€â€œåœ¨â€ã€â€œæ˜¯â€ã€â€œå•Šâ€ç­‰ã€‚ å¯¹äºåˆ†è¯æ¥è¯´ï¼Œä¸åŒçš„è¯­è¨€ï¼Œåˆ†è¯è§„åˆ™ä¸åŒã€‚Luceneä½œä¸ºä¸€ä¸ªå·¥å…·åŒ…æä¾›ä¸åŒè¯­è¨€çš„åˆ†è¯å™¨ã€‚ ä¸è®ºæ˜¯å»ºç«‹ç´¢å¼•è¿˜æ˜¯æŸ¥è¯¢çš„æ—¶å€™éƒ½è¦ä½¿ç”¨åˆ†è¯å™¨ï¼Œè€Œä¸”æœ€å¥½æ˜¯ä½¿ç”¨åŒä¸€ä¸ªåˆ†è¯å™¨ã€‚ 2 LuceneåŸç”Ÿåˆ†è¯å™¨2.1 StandardAnalyzerç‰¹ç‚¹: Luceneæä¾›çš„æ ‡å‡†åˆ†è¯å™¨, å¯ä»¥å¯¹ç”¨è‹±æ–‡è¿›è¡Œåˆ†è¯, å¯¹ä¸­æ–‡æ˜¯å•å­—åˆ†è¯, ä¹Ÿå°±æ˜¯ä¸€ä¸ªå­—å°±è®¤ä¸ºæ˜¯ä¸€ä¸ªè¯ã€‚ @Override protected TokenStreamComponents createComponents(final String fieldName) { final StandardTokenizer src = new StandardTokenizer(); src.setMaxTokenLength(maxTokenLength); TokenStream tok = new LowerCaseFilter(src); tok = new StopFilter(tok, stopwords); return new TokenStreamComponents(src, tok) { @Override protected void setReader(final Reader reader) { // So that if maxTokenLength was changed, the change takes // effect next time tokenStream is called: src.setMaxTokenLength(StandardAnalyzer.this.maxTokenLength); super.setReader(reader); } }; } Tokenizer å°±æ˜¯åˆ†è¯å™¨ï¼Œè´Ÿè´£å°†readerè½¬æ¢ä¸ºè¯­æ±‡å•å…ƒå³è¿›è¡Œåˆ†è¯å¤„ç†ï¼ŒLuceneæä¾›äº†å¾ˆå¤šçš„åˆ†è¯å™¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„åˆ†è¯ï¼Œæ¯”å¦‚IKAnalyzerä¸€ä¸ªä¸­æ–‡åˆ†è¯å™¨ã€‚ TokenFilteræ˜¯åˆ†è¯è¿‡æ»¤å™¨ï¼Œè´Ÿè´£å¯¹è¯­æ±‡å•å…ƒè¿›è¡Œè¿‡æ»¤ï¼ŒTokenFilterå¯ä»¥æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼ŒLuceneæä¾›äº†å¾ˆå¤šçš„åˆ†è¯å™¨è¿‡æ»¤å™¨ï¼Œæ¯”å¦‚å¤§å°å†™è½¬æ¢ã€å»é™¤åœç”¨è¯ç­‰ã€‚ å¦‚ä¸‹å›¾æ˜¯è¯­æ±‡å•å…ƒçš„ç”Ÿæˆè¿‡ç¨‹ï¼š ä»ä¸€ä¸ª Readerå­—ç¬¦æµå¼€å§‹ï¼Œåˆ›å»ºä¸€ä¸ªåŸºäºReaderçš„Tokenizeråˆ†è¯å™¨ï¼Œç»è¿‡ä¸‰ä¸ªTokenFilterç”Ÿæˆè¯­æ±‡å•å…ƒTokenã€‚ 2.2 WhitespaceAnalyzerç‰¹ç‚¹: ä»…ä»…æ˜¯å»æ‰äº†ç©ºæ ¼ï¼Œæ²¡æœ‰å…¶ä»–ä»»ä½•æ“ä½œï¼Œä¸æ”¯æŒä¸­æ–‡ã€‚ 2.3 SimpleAnalyzerç‰¹ç‚¹: å°†é™¤äº†å­—æ¯ä»¥å¤–çš„ç¬¦å·å…¨éƒ¨å»é™¤ï¼Œå¹¶ä¸”å°†æ‰€æœ‰å­—æ¯å˜ä¸ºå°å†™ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªåˆ†è¯å™¨åŒæ ·æŠŠæ•°å­—ä¹Ÿå»é™¤äº†ï¼ŒåŒæ ·ä¸æ”¯æŒä¸­æ–‡ã€‚ 2.4 CJKAnalyzerç‰¹ç‚¹: è¿™ä¸ªæ”¯æŒä¸­æ—¥éŸ©æ–‡å­—ï¼Œå‰ä¸‰ä¸ªå­—æ¯ä¹Ÿå°±æ˜¯è¿™ä¸‰ä¸ªå›½å®¶çš„ç¼©å†™ã€‚å¯¹ä¸­æ–‡æ˜¯äºŒåˆ†æ³•åˆ†è¯, å»æ‰ç©ºæ ¼, å»æ‰æ ‡ç‚¹ç¬¦å·ã€‚ä¸ªäººæ„Ÿè§‰å¯¹ä¸­æ–‡æ”¯æŒä¾æ—§å¾ˆçƒ‚ã€‚ 3 ç¬¬ä¸‰æ–¹åˆ†è¯å™¨ç®€ä»‹ paoding ï¼š åº–ä¸è§£ç‰›æœ€æ–°ç‰ˆåœ¨ https://code.google.com/p/paoding/ ä¸­æœ€å¤šæ”¯æŒLucene 3.0ï¼Œä¸”æœ€æ–°æäº¤çš„ä»£ç åœ¨ 2008-06-03ï¼Œåœ¨svnä¸­æœ€æ–°ä¹Ÿæ˜¯2010å¹´æäº¤ï¼Œå·²ç»è¿‡æ—¶ï¼Œä¸äºˆè€ƒè™‘ã€‚ mmseg4j ï¼šæœ€æ–°ç‰ˆå·²ä» https://code.google.com/p/mmseg4j/ ç§»è‡³ https://github.com/chenlb/mmseg4j-solrï¼Œæ”¯æŒLucene 4.10ï¼Œä¸”åœ¨githubä¸­æœ€æ–°æäº¤ä»£ç æ˜¯2017å¹´1æœˆï¼Œä»09å¹´~14å¹´ä¸€å…±æœ‰18ä¸ªç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ä¸€å¹´å‡ ä¹æœ‰3ä¸ªå¤§å°ç‰ˆæœ¬ï¼Œæœ‰è¾ƒå¤§çš„æ´»è·ƒåº¦ï¼Œç”¨äº†mmsegç®—æ³•ã€‚ IK-analyzer ï¼š æœ€æ–°ç‰ˆåœ¨ https://code.google.com/p/ik-analyzer/ä¸Šï¼Œæ”¯æŒLucene 4.10ä»2006å¹´12æœˆæ¨å‡º1.0ç‰ˆå¼€å§‹ï¼Œ IKAnalyzerå·²ç»æ¨å‡ºäº†4ä¸ªå¤§ç‰ˆæœ¬ã€‚æœ€åˆï¼Œå®ƒæ˜¯ä»¥å¼€æºé¡¹ç›®Luenceä¸ºåº”ç”¨ä¸»ä½“çš„ï¼Œç»“åˆè¯å…¸åˆ†è¯å’Œæ–‡æ³•åˆ†æç®—æ³•çš„ä¸­æ–‡åˆ†è¯ç»„ä»¶ã€‚ä»3.0ç‰ˆæœ¬å¼€å§‹ï¼ŒIKå‘å±•ä¸ºé¢å‘Javaçš„å…¬ç”¨åˆ†è¯ç»„ä»¶ï¼Œç‹¬ç«‹äºLuceneé¡¹ç›®ï¼ŒåŒæ—¶æä¾›äº†å¯¹Luceneçš„é»˜è®¤ä¼˜åŒ–å®ç°ã€‚åœ¨2012ç‰ˆæœ¬ä¸­ï¼ŒIKå®ç°äº†ç®€å•çš„åˆ†è¯æ­§ä¹‰æ’é™¤ç®—æ³•ï¼Œæ ‡å¿—ç€IKåˆ†è¯å™¨ä»å•çº¯çš„è¯å…¸åˆ†è¯å‘æ¨¡æ‹Ÿè¯­ä¹‰åˆ†è¯è¡åŒ–ã€‚ ä½†æ˜¯ä¹Ÿå°±æ˜¯2012å¹´12æœˆåæ²¡æœ‰å†æ›´æ–°ã€‚ ansj_seg ï¼šæœ€æ–°ç‰ˆæœ¬åœ¨ https://github.com/NLPchina/ansj_seg tagsä»…æœ‰1.1ç‰ˆæœ¬ï¼Œä»2012å¹´åˆ°2014å¹´æ›´æ–°äº†å¤§å°6æ¬¡ï¼Œä½†æ˜¯ä½œè€…æœ¬äººåœ¨2014å¹´10æœˆ10æ—¥è¯´æ˜ï¼šâ€œå¯èƒ½æˆ‘ä»¥åæ²¡æœ‰ç²¾åŠ›æ¥ç»´æŠ¤ansj_segäº†â€ï¼Œç°åœ¨ç”±â€nlp_chinaâ€ç®¡ç†ã€‚2014å¹´11æœˆæœ‰æ›´æ–°ã€‚å¹¶æœªè¯´æ˜æ˜¯å¦æ”¯æŒLuceneï¼Œæ˜¯ä¸€ä¸ªç”±CRFï¼ˆæ¡ä»¶éšæœºåœºï¼‰ç®—æ³•æ‰€åšçš„åˆ†è¯ç®—æ³•ã€‚ imdict-chinese-analyzer ï¼šæœ€æ–°ç‰ˆåœ¨ https://code.google.com/p/imdict-chinese-analyzer/ ï¼Œ æœ€æ–°æ›´æ–°ä¹Ÿåœ¨2009å¹´5æœˆï¼Œä¸‹è½½æºç ï¼Œä¸æ”¯æŒLucene 4.10 ã€‚æ˜¯åˆ©ç”¨HMMï¼ˆéšé©¬å°”ç§‘å¤«é“¾ï¼‰ç®—æ³•ã€‚ Jcseg ï¼šæœ€æ–°ç‰ˆæœ¬åœ¨git.oschina.net/lionsoul/jcsegï¼Œæ”¯æŒLucene 4.10ï¼Œä½œè€…æœ‰è¾ƒé«˜çš„æ´»è·ƒåº¦ã€‚åˆ©ç”¨mmsegç®—æ³•ã€‚ ikåˆ†è¯å™¨ç”¨æˆ·å¯è‡ªå®šä¹‰æ‹“å±•ï¼š æ‰©å±•è¯å…¸:æ”¾ä¸“æœ‰åè¯ï¼Œæˆ–è€…æ˜¯æˆ‘ä»¬è®¤ä¸ºéœ€è¦å¼ºåˆ¶å°†æŸä¸€äº›å­—åˆ†æˆä¸€ä¸ªè¯ã€‚å‡¡æ˜¯å‡ºç°åœ¨æ‰©å±•è¯å…¸ä¸­çš„è¯ï¼Œå°±ä¼šè¢«å¼ºåˆ¶åˆ†æˆä¸€ä¸ªè¯ã€‚ åœç”¨è¯å…¸:å‡¡æ˜¯å‡ºç°åœ¨åœç”¨è¯å…¸ä¸­çš„è¯ï¼Œéƒ½ä¼šè¢«è¿‡æ»¤æ‰. å…ˆå»ºç«‹é…ç½®æ–‡ä»¶IKAnalyzer.cfg.xmlï¼š &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;!DOCTYPE properties SYSTEM \"http://java.sun.com/dtd/properties.dtd\"> &lt;properties> &lt;comment>IK Analyzer æ‰©å±•é…ç½®&lt;/comment> &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ --> &lt;entry key=\"ext_dict\">ext.dic;&lt;/entry> &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•åœæ­¢è¯å­—å…¸--> &lt;entry key=\"ext_stopwords\">stopword.dic;&lt;/entry> &lt;/properties> ext.dicä¸ºæ‹“å±•è¯å…¸ï¼Œæ¯ä¸ªè¯å•ç‹¬å ä¸€è¡Œï¼š åä¸º æ‰‹æœº åä¸ºæ‰‹æœº æ£®é©¬ å—æäºº ä¸‰æ˜Ÿ è‹¹æœstopword.dicä¸ºæ‹“å±•è¯å…¸ï¼Œæ¯ä¸ªè¯å•ç‹¬å ä¸€è¡Œï¼š a an and are as at be but by for if in into is it no not of on ...æµ‹è¯•ï¼š @Test public void TestIKAnalyzer() throws Exception{ // 1. åˆ›å»ºåˆ†è¯å™¨,åˆ†ææ–‡æ¡£ï¼Œå¯¹æ–‡æ¡£è¿›è¡Œåˆ†è¯ Analyzer analyzer = new IKAnalyzer(); // 2. åˆ›å»ºDirectoryå¯¹è±¡,å£°æ˜ç´¢å¼•åº“çš„ä½ç½® Directory directory = FSDirectory.open(Paths.get(\"E:\\\\dir\")); // 3. åˆ›å»ºIndexWriteConfigå¯¹è±¡ï¼Œå†™å…¥ç´¢å¼•éœ€è¦çš„é…ç½® IndexWriterConfig config = new IndexWriterConfig(analyzer); // 4.åˆ›å»ºIndexWriterå†™å…¥å¯¹è±¡ IndexWriter indexWriter = new IndexWriter(directory, config); // 5.å†™å…¥åˆ°ç´¢å¼•åº“ï¼Œé€šè¿‡IndexWriteræ·»åŠ æ–‡æ¡£å¯¹è±¡document Document doc = new Document(); doc.add(new TextField(\"name\", \"vivo X23 8GB+128GB å¹»å¤œè“,æ°´æ»´å±å…¨é¢å±,æ¸¸æˆæ‰‹æœº.ç§» åŠ¨è”é€šç”µä¿¡å…¨ç½‘é€š4Gæ‰‹æœº\", Field.Store.YES)); indexWriter.addDocument(doc); // 6.é‡Šæ”¾èµ„æº indexWriter.close(); }","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Lucene","slug":"Lucene","permalink":"https://www.codetool.top/tags/Lucene/"}]},{"title":"Luceneä¸­çš„åŸŸç±»å‹åŠæ–‡æ¡£çš„æ›´æ–°/åˆ é™¤","slug":"Luceneä¸­çš„åŸŸç±»å‹åŠæ–‡æ¡£çš„æ›´æ–°-åˆ é™¤","date":"2020-03-27T11:13:31.000Z","updated":"2020-03-27T16:27:13.501Z","comments":true,"path":"article/Luceneä¸­çš„åŸŸç±»å‹åŠæ–‡æ¡£çš„æ›´æ–°-åˆ é™¤/","link":"","permalink":"https://www.codetool.top/article/Lucene%E4%B8%AD%E7%9A%84%E5%9F%9F%E7%B1%BB%E5%9E%8B%E5%8F%8A%E6%96%87%E6%A1%A3%E7%9A%84%E6%9B%B4%E6%96%B0-%E5%88%A0%E9%99%A4/","excerpt":"","text":"1 FieldåŸŸFieldæ˜¯æ–‡æ¡£ä¸­çš„åŸŸï¼ŒåŒ…æ‹¬Fieldåå’ŒFieldå€¼ä¸¤éƒ¨åˆ†ï¼Œä¸€ä¸ªæ–‡æ¡£å¯ä»¥åŒ…æ‹¬å¤šä¸ªFieldï¼ŒDocumentåªæ˜¯Fieldçš„ä¸€ä¸ªæ‰¿è½½ä½“ï¼ŒFieldå€¼å³ä¸ºè¦ç´¢å¼•çš„å†…å®¹ï¼Œä¹Ÿæ˜¯è¦æœç´¢çš„å†…å®¹ã€‚ 1.1 Fieldå±æ€§1.1.1 æ˜¯å¦åˆ†è¯ (tokenized) æ˜¯ï¼šä½œåˆ†è¯å¤„ç†ï¼Œå³å°†Fieldå€¼è¿›è¡Œåˆ†è¯ï¼Œåˆ†è¯çš„ç›®çš„æ˜¯ä¸ºäº†ç´¢å¼•ã€‚ æ¯”å¦‚ï¼šå•†å“åç§°ã€å•†å“æè¿°ç­‰ï¼Œè¿™äº›å†…å®¹ç”¨æˆ·è¦è¾“å…¥å…³é”®å­—æœç´¢ï¼Œç”±äºæœç´¢çš„å†…å®¹æ ¼å¼å¤§ã€å†…å®¹å¤šéœ€è¦åˆ†è¯åå°†è¯­æ±‡å•å…ƒå»ºç«‹ç´¢å¼• å¦ï¼šä¸ä½œåˆ†è¯å¤„ç† æ¯”å¦‚ï¼šå•†å“idã€è®¢å•å·ã€èº«ä»½è¯å·ç­‰ 1.1.2 æ˜¯å¦ç´¢å¼• (indexed) æ˜¯ï¼šè¿›è¡Œç´¢å¼•ã€‚å°†Fieldåˆ†è¯åçš„è¯æˆ–æ•´ä¸ªFieldå€¼è¿›è¡Œç´¢å¼•ï¼Œå­˜å‚¨åˆ°ç´¢å¼•åŸŸï¼Œç´¢å¼•çš„ç›®çš„æ˜¯ä¸ºäº†æœç´¢ã€‚ æ¯”å¦‚ï¼šå•†å“åç§°ã€å•†å“æè¿°åˆ†æåè¿›è¡Œç´¢å¼•ï¼Œè®¢å•å·ã€èº«ä»½è¯å·ä¸ç”¨åˆ†è¯ä½†ä¹Ÿè¦ç´¢å¼•ï¼Œè¿™äº›å°†æ¥éƒ½è¦ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ã€‚ å¦ï¼šä¸ç´¢å¼•ã€‚å¦‚æœä¸éœ€è¦ç´¢å¼•å°±ä¸éœ€è¦åˆ†è¯ã€‚ æ¯”å¦‚ï¼šå›¾ç‰‡è·¯å¾„ã€æ–‡ä»¶è·¯å¾„ç­‰ï¼Œä¸ç”¨ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„ä¸ç”¨ç´¢å¼•ã€‚ 1.1.3 æ˜¯å¦å­˜å‚¨ (stored) æ˜¯ï¼šå°†Fieldå€¼å­˜å‚¨åœ¨æ–‡æ¡£åŸŸä¸­ï¼Œå­˜å‚¨åœ¨æ–‡æ¡£åŸŸä¸­çš„Fieldæ‰å¯ä»¥ä»Documentä¸­è·å–ã€‚ æ¯”å¦‚ï¼šå•†å“åç§°ã€è®¢å•å·ï¼Œå‡¡æ˜¯å°†æ¥è¦ä»Documentä¸­è·å–çš„Fieldéƒ½è¦å­˜å‚¨ã€‚ å¦ï¼šä¸å­˜å‚¨Fieldå€¼ æ¯”å¦‚ï¼šå•†å“æè¿°ï¼Œå†…å®¹è¾ƒå¤§ä¸ç”¨å­˜å‚¨ã€‚å¦‚æœè¦å‘ç”¨æˆ·å±•ç¤ºå•†å“æè¿°å¯ä»¥ä»ç³»ç»Ÿçš„å…³ç³»æ•°æ®åº“ä¸­è·å– 1.2 Fieldç±»å‹ä¸‹è¾¹åˆ—å‡ºäº†å¼€å‘ä¸­å¸¸ç”¨ çš„Filedç±»å‹ï¼Œæ³¨æ„Fieldçš„å±æ€§ï¼Œæ ¹æ®éœ€æ±‚é€‰æ‹©ï¼š Fieldç±» æ•°æ®ç±»å‹ Analyzedæ˜¯å¦åˆ†è¯ Indexedæ˜¯å¦ç´¢å¼• Storedæ˜¯å¦å­˜å‚¨ è¯´æ˜ StringField(FieldName,FieldValue,Store.YES)) å­—ç¬¦ä¸² N Y Yæˆ–N è¿™ä¸ªFieldç”¨æ¥æ„å»ºä¸€ä¸ªå­—ç¬¦ä¸²Fieldï¼Œä½†æ˜¯ä¸ä¼šè¿›è¡Œåˆ†è¯ï¼Œä¼šå°†æ•´ä¸ªä¸²å­˜å‚¨åœ¨ç´¢å¼•ä¸­ï¼Œæ¯”å¦‚(è®¢å•å·,èº«ä»½è¯å·ç­‰)æ˜¯å¦å­˜å‚¨åœ¨æ–‡æ¡£ä¸­ç”¨Store.YESæˆ–Store.NOå†³å®š FloatPoint(FieldName, FieldValue) Floatå‹ Y Y N è¿™ä¸ªFieldç”¨æ¥æ„å»ºä¸€ä¸ªFloatæ•°å­—å‹Fieldï¼Œè¿›è¡Œåˆ†è¯å’Œç´¢å¼•ï¼Œä¸å­˜å‚¨, æ¯”å¦‚(ä»·æ ¼) å­˜å‚¨åœ¨æ–‡æ¡£ä¸­ DoublePoint(FieldName,FieldValue) Doubleå‹ Y Y N è¿™ä¸ªFieldç”¨æ¥æ„å»ºä¸€ä¸ªDoubleæ•°å­—å‹Fieldï¼Œè¿›è¡Œåˆ†è¯å’Œç´¢å¼•ï¼Œä¸å­˜å‚¨ LongPoint(FieldName, FieldValue) Longå‹ Y Y N è¿™ä¸ªFieldç”¨æ¥æ„å»ºä¸€ä¸ªLongæ•°å­—å‹Fieldï¼Œè¿›è¡Œåˆ†è¯å’Œç´¢å¼•ï¼Œä¸å­˜å‚¨ IntPoint(FieldName, FieldValue) Integerå‹ Y Y N è¿™ä¸ªFieldç”¨æ¥æ„å»ºä¸€ä¸ªIntegeræ•°å­—å‹Fieldï¼Œè¿›è¡Œåˆ†è¯å’Œç´¢å¼•ï¼Œä¸å­˜å‚¨ StoredField(FieldName, FieldValue) é‡è½½æ–¹æ³•ï¼Œæ”¯æŒå¤šç§ç±»å‹ N N Y è¿™ä¸ªFieldç”¨æ¥æ„å»ºä¸åŒç±»å‹Fieldä¸åˆ†æï¼Œä¸ç´¢å¼•ï¼Œä½†è¦Fieldå­˜å‚¨åœ¨æ–‡æ¡£ä¸­ TextField(FieldName, FieldValue, Store.NO) æˆ– TextField(FieldName,reader) å­—ç¬¦ä¸²æˆ–æµ Y Y Yæˆ–N å¦‚æœæ˜¯ä¸€ä¸ªReader, luceneçŒœæµ‹å†…å®¹æ¯”è¾ƒå¤š,ä¼šé‡‡ç”¨Unstoredçš„ç­–ç•¥. NumericDocValuesField(FieldName,FieldValue) æ•°å€¼ - - - é…åˆå…¶ä»–åŸŸæ’åºä½¿ç”¨ å¯¹äºæ•°å€¼ç±»å‹çš„æ•°æ®ï¼Œåˆ†è¯å¯ä»¥å®ç°èŒƒå›´æŸ¥è¯¢ã€‚ 2 ç´¢å¼•ç»´æŠ¤2.1 æ›´æ–°ç®¡ç†äººå‘˜é€šè¿‡ç”µå•†ç³»ç»Ÿæ›´æ”¹å›¾ä¹¦ä¿¡æ¯ï¼Œè¿™æ—¶æ›´æ–°çš„æ˜¯å…³ç³»æ•°æ®åº“ï¼Œå¦‚æœä½¿ç”¨luceneæœç´¢å›¾ä¹¦ä¿¡æ¯ï¼Œéœ€è¦åœ¨æ•°æ®åº“è¡¨bookä¿¡æ¯å˜åŒ–æ—¶åŠæ—¶æ›´æ–°luceneç´¢å¼•åº“ã€‚ ç¤ºä¾‹ï¼š @Test public void updateIndexTest() throws Exception{ // åˆ›å»ºæ›´æ”¹ç›®æ ‡å¯¹è±¡ Document document = new Document(); document.add(new StringField(\"id\",\"100000003145\", Field.Store.YES)); document.add(new TextField(\"name\", \"xxx\",Field.Store.YES)); document.add(new IntPoint(\"price\", 123)); document.add(new StoredField(\"price\", 123)); document.add(new StoredField(\"image\", \"xxx.jpg\")); document.add(new StringField(\"categoryName\", \"æ‰‹æœº\",Field.Store.YES)); document.add(new StringField(\"brandName\", \"åä¸º\",Field.Store.YES)); // åˆ›å»ºåˆ†è¯å™¨ Analyzer analyzer = new StandardAnalyzer(); // åˆ›å»ºDirectoryç›®å½•å¯¹è±¡ï¼Œè¡¨ç¤ºç´¢å¼•åº“çš„ä½ç½® Directory dir = FSDirectory.open(Paths.get(\"D:\\\\dir\")); // åˆ›å»ºIndexWriterConfigå¯¹è±¡ï¼ŒæŒ‡å®šåˆ‡åˆ†è¯ä½¿ç”¨çš„åˆ†è¯å™¨ IndexWriterConfig config = new IndexWriterConfig(analyzer); // åˆ›å»ºIndexWriterè¾“å‡ºæµå¯¹è±¡ï¼ŒæŒ‡å®šè¾“å‡ºçš„ä½ç½®å’Œä½¿ç”¨çš„configåˆå§‹åŒ–å¯¹è±¡ IndexWriter indexWriter = new IndexWriter(dir,config); // ä¿®æ”¹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼šä¿®æ”¹æ¡ä»¶ï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼šä¿®æ”¹æˆçš„å†…å®¹ indexWriter.updateDocument(new Term(\"id\",\"100000003145\"),document); // é‡Šæ”¾èµ„æº indexWriter.close(); } Luceneçš„ä¿®æ”¹å®é™…æ˜¯å°†å¯¹åº”çš„æ–‡æ¡£åˆ é™¤ç„¶åæ–°å»ºæ–‡æ¡£ã€‚ æ³¨æ„ï¼Œä¸èƒ½æ·»åŠ ä¸€ä¸ªåŸŸç±»å‹å’Œå…¶ä»–æ–‡æ¡£çš„åŸŸä¸ä¸€æ ·çš„æ–‡æ¡£ï¼Œå¦åˆ™æ‰“å¼€ç´¢å¼•åº“ä¼šæŠ¥é”™ï¼š java.lang.IllegalArgumentException: cannot change field &quot;brandName&quot; from index options=DOCS to inconsistent index options=DOCS_AND_FREQS_AND_POSITIONS at org.apache.lucene.index.FieldInfo.update(FieldInfo.java:154) ~[luke-swing-with-deps.jar:?] at org.apache.lucene.index.FieldInfos$Builder.addOrUpdateInternal(FieldInfos.java:534) ~[luke-swing-with-deps.jar:?] at org.apache.lucene.index.FieldInfos$Builder.add(FieldInfos.java:559) ~[luke-swing-with-deps.jar:?] at org.apache.lucene.index.FieldInfos$Builder.add(FieldInfos.java:554) ~[luke-swing-with-deps.jar:?] at org.apache.lucene.index.FieldInfos$Builder.add(FieldInfos.java:480) ~[luke-swing-with-deps.jar:?] at org.apache.lucene.index.FieldInfos.getMergedFieldInfos(FieldInfos.java:154) ~[luke-swing-with-deps.jar:?] at org.apache.lucene.luke.models.util.IndexUtils.getFieldInfos(IndexUtils.java:379) ~[luke-swing-with-deps.jar:?] ......2.2 åˆ é™¤ @Test public void deleteIndexTest() throws Exception{ // åˆ›å»ºåˆ†è¯å™¨ï¼ŒStandardAnalyzerå¯¹è‹±æ–‡åˆ†è¯æ•ˆæœå¥½ï¼Œå¯¹ä¸­æ–‡æ˜¯å•å­—åˆ†è¯ Analyzer analyzer = new StandardAnalyzer(); // åˆ›å»ºDirectoryç›®å½•å¯¹è±¡ï¼Œè¡¨ç¤ºç´¢å¼•åº“çš„ä½ç½® Directory dir = FSDirectory.open(Paths.get(\"D:\\\\dir\")); // åˆ›å»ºIndexWriterConfigå¯¹è±¡ï¼ŒæŒ‡å®šåˆ‡åˆ†è¯ä½¿ç”¨çš„åˆ†è¯å™¨ IndexWriterConfig config = new IndexWriterConfig(analyzer); // åˆ›å»ºIndexWriterè¾“å‡ºæµå¯¹è±¡ï¼ŒæŒ‡å®šè¾“å‡ºçš„ä½ç½®å’Œä½¿ç”¨çš„configåˆå§‹åŒ–å¯¹è±¡ IndexWriter indexWriter = new IndexWriter(dir,config); // åˆ é™¤ indexWriter.deleteDocuments(new Term(\"id\",\"100000003145\")); // é‡Šæ”¾èµ„æº indexWriter.close(); }","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Lucene","slug":"Lucene","permalink":"https://www.codetool.top/tags/Lucene/"}]},{"title":"åˆ†å¸ƒå¼ç³»ç»Ÿè®¤è¯æ–¹å¼ä¸OAuth2.0æ¦‚è¿°","slug":"åˆ†å¸ƒå¼ç³»ç»Ÿè®¤è¯æ–¹å¼ä¸OAuth2-0æ¦‚è¿°","date":"2020-03-27T09:09:38.000Z","updated":"2020-03-27T09:11:11.752Z","comments":true,"path":"article/åˆ†å¸ƒå¼ç³»ç»Ÿè®¤è¯æ–¹å¼ä¸OAuth2-0æ¦‚è¿°/","link":"","permalink":"https://www.codetool.top/article/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E8%AE%A4%E8%AF%81%E6%96%B9%E5%BC%8F%E4%B8%8EOAuth2-0%E6%A6%82%E8%BF%B0/","excerpt":"","text":"1 Sessionåˆ†å¸ƒå¼session è¿™ä¸ªæ—¶å€™ï¼Œé€šå¸¸çš„åšæ³•æœ‰ä¸‹é¢å‡ ç§ï¼š Sessionå¤åˆ¶ï¼šå¤šå°åº”ç”¨æœåŠ¡å™¨ä¹‹é—´åŒæ­¥sessionï¼Œä½¿sessionä¿æŒä¸€è‡´ï¼Œå¯¹å¤–é€æ˜ã€‚ Sessioné»è´´ï¼šå½“ç”¨æˆ·è®¿é—®é›†ç¾¤ä¸­æŸå°æœåŠ¡å™¨åï¼Œå¼ºåˆ¶æŒ‡å®šåç»­æ‰€æœ‰è¯·æ±‚å‡è½åˆ°æ­¤æœºå™¨ä¸Šã€‚ Sessioné›†ä¸­å­˜å‚¨ï¼šå°†Sessionå­˜å…¥åˆ†å¸ƒå¼ç¼“å­˜ä¸­ï¼Œæ‰€æœ‰æœåŠ¡å™¨åº”ç”¨å®ä¾‹ç»Ÿä¸€ä»åˆ†å¸ƒå¼ç¼“å­˜ä¸­å­˜å–Sessionã€‚ æ€»ä½“æ¥è®²ï¼ŒåŸºäºsessionè®¤è¯çš„è®¤è¯æ–¹å¼ï¼Œå¯ä»¥æ›´å¥½çš„åœ¨æœåŠ¡ç«¯å¯¹ä¼šè¯è¿›è¡Œæ§åˆ¶ï¼Œä¸”å®‰å…¨æ€§è¾ƒé«˜ã€‚ä½†æ˜¯ï¼Œsessionæœºåˆ¶æ–¹å¼åŸºäºcookieï¼Œåœ¨å¤æ‚å¤šæ ·çš„ç§»åŠ¨å®¢æˆ·ç«¯ä¸Šä¸èƒ½æœ‰æ•ˆçš„ä½¿ç”¨ï¼Œå¹¶ä¸”æ— æ³•è·¨åŸŸï¼Œå¦å¤–éšç€ç³»ç»Ÿçš„æ‰©å±•éœ€æé«˜sessionçš„å¤åˆ¶ã€é»è´´åŠå­˜å‚¨çš„å®¹é”™æ€§ã€‚ 2 åŸºäºtokençš„è®¤è¯æ–¹å¼åŸºäºtokençš„è®¤è¯æ–¹å¼ï¼ŒæœåŠ¡ç«¯ä¸ç”¨å­˜å‚¨è®¤è¯æ•°æ®ï¼Œæ˜“ç»´æŠ¤æ‰©å±•æ€§å¼ºï¼Œ å®¢æˆ·ç«¯å¯ä»¥æŠŠtoken å­˜åœ¨ä»»æ„åœ°æ–¹ï¼Œå¹¶ä¸”å¯ä»¥å®ç°webå’Œappç»Ÿä¸€è®¤è¯æœºåˆ¶ã€‚å…¶ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œtokenç”±äºè‡ªåŒ…å«ä¿¡æ¯ï¼Œå› æ­¤ä¸€èˆ¬æ•°æ®é‡è¾ƒå¤§ï¼Œè€Œä¸”æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦ä¼ é€’ï¼Œå› æ­¤æ¯”è¾ƒå å¸¦å®½ã€‚å¦å¤–ï¼Œtokençš„ç­¾åéªŒç­¾æ“ä½œä¹Ÿä¼šç»™cpuå¸¦æ¥é¢å¤–çš„å¤„ç†è´Ÿæ‹…ã€‚ ä¼˜ç‚¹ï¼š é€‚åˆç»Ÿä¸€è®¤è¯çš„æœºåˆ¶ï¼Œå®¢æˆ·ç«¯ã€ä¸€æ–¹åº”ç”¨ã€ä¸‰æ–¹åº”ç”¨éƒ½éµå¾ªä¸€è‡´çš„è®¤è¯æœºåˆ¶ã€‚ tokenè®¤è¯æ–¹å¼å¯¹ç¬¬ä¸‰æ–¹åº”ç”¨æ¥å…¥æ›´é€‚åˆï¼Œå› ä¸ºå®ƒæ›´å¼€æ”¾ï¼Œå¯ä½¿ç”¨å½“å‰æœ‰æµè¡Œçš„å¼€æ”¾åè®®OAuth2.0ã€JWTç­‰ã€‚ ä¸€èˆ¬æƒ…å†µæœåŠ¡ç«¯æ— éœ€å­˜å‚¨ä¼šè¯ä¿¡æ¯ï¼Œå‡è½»äº†æœåŠ¡ç«¯çš„å‹åŠ› 3 OAuth2.0ä»‹ç»OAuthï¼ˆå¼€æ”¾æˆæƒï¼‰æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼Œå…è®¸ç”¨æˆ·æˆæƒç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®ä»–ä»¬å­˜å‚¨åœ¨å¦å¤–çš„æœåŠ¡æä¾›è€…ä¸Šçš„ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦å°†ç”¨æˆ·åå’Œå¯†ç æä¾›ç»™ç¬¬ä¸‰æ–¹åº”ç”¨æˆ–åˆ†äº«ä»–ä»¬æ•°æ®çš„æ‰€æœ‰å†…å®¹ã€‚OAuth2.0æ˜¯OAuthåè®®çš„å»¶ç»­ç‰ˆæœ¬ï¼Œä½†ä¸å‘åå…¼å®¹OAuth 1.0å³å®Œå…¨åºŸæ­¢äº†OAuth1.0ã€‚å¾ˆå¤šå¤§å…¬å¸å¦‚Googleï¼ŒYahooï¼ŒMicrosoftç­‰éƒ½æä¾›äº†OAUTHè®¤è¯æœåŠ¡ï¼Œè¿™äº›éƒ½è¶³ä»¥è¯´æ˜OAUTHæ ‡å‡†é€æ¸æˆä¸ºå¼€æ”¾èµ„æºæˆæƒçš„æ ‡å‡†ã€‚ Oauthåè®®ç›®å‰å‘å±•åˆ°2.0ç‰ˆæœ¬ï¼Œ1.0ç‰ˆæœ¬è¿‡äºå¤æ‚ï¼Œ2.0ç‰ˆæœ¬å·²å¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚ OAauth2.0åŒ…æ‹¬ä»¥ä¸‹è§’è‰²ï¼š å®¢æˆ·ç«¯æœ¬èº«ä¸å­˜å‚¨èµ„æºï¼Œéœ€è¦é€šè¿‡èµ„æºæ‹¥æœ‰è€…çš„æˆæƒå»è¯·æ±‚èµ„æºæœåŠ¡å™¨çš„èµ„æºï¼Œæ¯”å¦‚ï¼šAndroidå®¢æˆ·ç«¯ã€Webå®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ç«¯ï¼‰ã€å¾®ä¿¡å®¢æˆ·ç«¯ç­‰ã€‚ èµ„æºæ‹¥æœ‰è€…é€šå¸¸ä¸ºç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥æ˜¯åº”ç”¨ç¨‹åºï¼Œå³è¯¥èµ„æºçš„æ‹¥æœ‰è€…ã€‚ æˆæƒæœåŠ¡å™¨ï¼ˆä¹Ÿç§°è®¤è¯æœåŠ¡å™¨ï¼‰ç”¨äºæœåŠ¡æä¾›å•†å¯¹èµ„æºæ‹¥æœ‰çš„èº«ä»½è¿›è¡Œè®¤è¯ã€å¯¹è®¿é—®èµ„æºè¿›è¡Œæˆæƒï¼Œè®¤è¯æˆåŠŸåä¼šç»™å®¢æˆ·ç«¯å‘æ”¾ä»¤ç‰Œï¼ˆaccess_tokenï¼‰ï¼Œä½œä¸ºå®¢æˆ·ç«¯è®¿é—®èµ„æºæœåŠ¡å™¨çš„å‡­æ®ã€‚ èµ„æºæœåŠ¡å™¨å­˜å‚¨èµ„æºçš„æœåŠ¡å™¨ã€‚ ç°åœ¨è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒæœåŠ¡æä¾›å•†èƒ½å…è®¸éšä¾¿ä¸€ä¸ªå®¢æˆ·ç«¯å°±æ¥å…¥åˆ°å®ƒçš„æˆæƒæœåŠ¡å™¨å—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ï¼ŒæœåŠ¡æä¾›å•†ä¼šç»™å‡†å…¥çš„æ¥å…¥æ–¹ä¸€ä¸ªèº«ä»½ï¼Œç”¨äºæ¥å…¥æ—¶çš„å‡­æ®: client_idï¼šå®¢æˆ·ç«¯æ ‡è¯† client_secretï¼šå®¢æˆ·ç«¯ç§˜é’¥ å› æ­¤ï¼Œå‡†ç¡®æ¥è¯´ï¼ŒæˆæƒæœåŠ¡å™¨å¯¹ä¸¤ç§OAuth2.0ä¸­çš„ä¸¤ä¸ªè§’è‰²è¿›è¡Œè®¤è¯æˆæƒï¼Œåˆ†åˆ«æ˜¯èµ„æºæ‹¥æœ‰è€…ã€å®¢æˆ·ç«¯ã€‚ å®¢æˆ·ç«¯è¯·æ±‚ç¬¬ä¸‰æ–¹æˆæƒ èµ„æºæ‹¥æœ‰è€…åŒæ„ç»™å®¢æˆ·ç«¯æˆæƒ å®¢æˆ·ç«¯è·å–åˆ°æˆæƒç ï¼Œè¯·æ±‚è®¤è¯æœåŠ¡å™¨ç”³è¯·ä»¤ç‰Œ è®¤è¯æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å“åº”ä»¤ç‰Œ å®¢æˆ·ç«¯æºå¸¦ä»¤ç‰Œè¯·æ±‚èµ„æºæœåŠ¡å™¨çš„èµ„æº èµ„æºæœåŠ¡å™¨è¿”å›å—ä¿æŠ¤èµ„æº","categories":[{"name":"é¡¹ç›®/ç¼–ç¨‹ç†è®º","slug":"é¡¹ç›®-ç¼–ç¨‹ç†è®º","permalink":"https://www.codetool.top/categories/%E9%A1%B9%E7%9B%AE-%E7%BC%96%E7%A8%8B%E7%90%86%E8%AE%BA/"}],"tags":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"https://www.codetool.top/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"},{"name":"å®‰å…¨","slug":"å®‰å…¨","permalink":"https://www.codetool.top/tags/%E5%AE%89%E5%85%A8/"}]},{"title":"Spring Securityæ ¸å¿ƒç»„ä»¶","slug":"Spring Securityæ ¸å¿ƒç»„ä»¶","date":"2020-03-27T07:53:54.000Z","updated":"2020-03-27T07:54:48.178Z","comments":true,"path":"article/Spring Securityæ ¸å¿ƒç»„ä»¶/","link":"","permalink":"https://www.codetool.top/article/Spring%20Security%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6/","excerpt":"","text":"1 Authenticationè®¤è¯ä¿¡æ¯ï¼Œåœ¨Spring Securityç”¨æˆ·è®¤è¯æµç¨‹ä¸­ï¼Œç”¨æˆ·æäº¤çš„ä¿¡æ¯è¢«Spring Securityå°è£…æˆä¸€ä¸ªAuthenticationå¯¹è±¡ï¼Œä¸åŒçš„è®¤è¯æ–¹å¼éœ€è¦çš„Authenticationå®ç°å¯èƒ½æ˜¯ä¸åŒçš„ï¼Œé€šå¸¸è¡¨å•ç™»å½•ä½¿ç”¨çš„æ˜¯å®ç°ç±»UsernamePasswordAuthenticationTokenï¼Œå®ƒåŒ…å«ç”¨æˆ·çš„ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯ã€‚ public interface Authentication extends Principal, Serializable { Collection&lt;? extends GrantedAuthority> getAuthorities(); Object getCredentials(); Object getDetails(); Object getPrincipal(); boolean isAuthenticated(); void setAuthenticated(boolean isAuthenticated) throws IllegalArgumentException; } Authenticationæ˜¯spring securityåŒ…ä¸­çš„æ¥å£ï¼Œç›´æ¥ç»§æ‰¿è‡ªPrincipalç±»ï¼Œè€ŒPrincipalæ˜¯ä½äº java.security åŒ…ä¸­çš„ã€‚å®ƒæ˜¯è¡¨ç¤ºç€ä¸€ä¸ªæŠ½è±¡ä¸»ä½“èº«ä»½ï¼Œä»»ä½•ä¸»ä½“éƒ½æœ‰ä¸€ä¸ªåç§°ï¼Œå› æ­¤åŒ…å«ä¸€ä¸ªgetName()æ–¹æ³•ã€‚ getAuthorities()ï¼Œæƒé™ä¿¡æ¯åˆ—è¡¨ï¼Œé»˜è®¤æ˜¯GrantedAuthorityæ¥å£çš„ä¸€äº›å®ç°ç±»ï¼Œé€šå¸¸æ˜¯ä»£è¡¨æƒé™ä¿¡æ¯çš„ä¸€ç³»åˆ—å­—ç¬¦ä¸²ã€‚ getCredentials()ï¼Œå‡­è¯ä¿¡æ¯ï¼Œç”¨æˆ·è¾“å…¥çš„å¯†ç å­—ç¬¦ä¸²ï¼Œåœ¨è®¤è¯è¿‡åé€šå¸¸ä¼šè¢«ç§»é™¤ï¼Œç”¨äºä¿éšœå®‰å…¨ã€‚ getDetails()ï¼Œç»†èŠ‚ä¿¡æ¯ï¼Œwebåº”ç”¨ä¸­çš„å®ç°æ¥å£é€šå¸¸ä¸º WebAuthenticationDetailsï¼Œå®ƒè®°å½•äº†è®¿é—®è€…çš„ipåœ°å€å’ŒsessionIdçš„å€¼ã€‚ getPrincipal()ï¼Œèº«ä»½ä¿¡æ¯ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿”å›çš„æ˜¯UserDetailsæ¥å£çš„å®ç°ç±»ï¼ŒUserDetailsä»£è¡¨ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼Œé‚£ä»Authenticationä¸­å–å‡ºæ¥çš„UserDetailså°±æ˜¯å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œå®ƒä¹Ÿæ˜¯æ¡†æ¶ä¸­çš„å¸¸ç”¨æ¥å£ä¹‹ä¸€ã€‚ 2 UserDetailServiceUserDetailServiceæ˜¯Spring Securityä¸­è¾ƒä¸ºæ ¸å¿ƒçš„ä¸€ä¸ªç»„ä»¶ï¼Œåœ¨è®¤è¯æµç¨‹ä¸­ï¼ŒSpring Securityé€šè¿‡å®ƒæ ¹æ®ç”¨æˆ·åè·å–ç”¨æˆ·å¯†ç ï¼Œç„¶åè¿›è¡Œå¯†ç æ¯”å¯¹ã€‚ public interface UserDetailsService { UserDetails loadUserByUsername(String username) throws UsernameNotFoundException; } public interface UserDetails extends Serializable { Collection&lt;? extends GrantedAuthority> getAuthorities(); String getPassword(); String getUsername(); boolean isAccountNonExpired(); boolean isAccountNonLocked(); boolean isCredentialsNonExpired(); boolean isEnabled(); } å¯ä»¥é€šè¿‡Userç±»çš„é“¾å¼buildæ¥è·å–ä¸€ä¸ªUserDetailsçš„å®ä¾‹å¯¹è±¡ã€‚ UserDetails userDetails = User.withUsername(&quot;zhangsan&quot;).password(&quot;123&quot;).authorities(&quot;p1&quot;).build() Spring Securityæä¾›çš„InMemoryUserDetailsManager(å†…å­˜è®¤è¯)ï¼ŒJdbcUserDetailsManager(jdbcè®¤è¯)å°±æ˜¯UserDetailsServiceçš„å®ç°ç±»ï¼Œä¸»è¦åŒºåˆ«æ— éå°±æ˜¯ä»å†…å­˜è¿˜æ˜¯ä»æ•°æ®åº“åŠ è½½ç”¨æˆ·ã€‚æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªUserDetailsServiceå¹¶æ³¨å…¥æ¥å®ç°è‡ªå®šä¹‰ç”¨æˆ·æ•°æ®æ¥æºçš„åŠŸèƒ½ã€‚ ä¾‹ï¼šä½¿ç”¨æ•°æ®åº“åŠ è½½ç”¨æˆ·ä¿¡æ¯ï¼š @Data public class UserDto { private Long id; private String username; private String password; private String fullname; private String mobile; } @Repository public class UserDao { JdbcTemplate jdbcTemplate; public UserDto getUserByUsername(String username){ String sql = \"select id,username,password,fullname,mobile from t_user where username=?\"; List&lt;UserDto> list = jdbcTemplate.query(sql,new Object[]{username},new BeanPropertyRowMapper&lt;>(UserDto.class)); if(list.size()&lt;=0){ return null; } return list.get(0); } } @Component public class SpringDataUserDetailsService implements UserDetailsService { @Autowired UserDao userDao; @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException { UserDto userDto = userDao.getUserByUsername(username); if(userDto == null) return null; return User.withUsername(userDto.getUsername()).password(userDto.getPassword()).authorities(\"p1\").build(); } } 3 PasswordEncoderDaoAuthenticationProviderè®¤è¯å¤„ç†å™¨é€šè¿‡UserDetailsServiceè·å–åˆ°UserDetailsåï¼Œé€šè¿‡PasswordEncoderä¸è¯·æ±‚Authenticationä¸­çš„å¯†ç è¿›è¡Œæ¯”å¯¹ï¼Œå› ä¸ºæ•°æ®åº“ä¸­è·å–çš„å¯†ç é€šå¸¸æ˜¯åŠ å¯†è¿‡çš„ã€‚ å¸¸ç”¨çš„æ˜¯BCryptç®—æ³•ï¼Œå¦‚æœä½¿ç”¨BCryptPasswordEncoderï¼Œåœ¨æ·»åŠ è¿›æ•°æ®åº“ä¹‹å‰ä¹Ÿå¾—ä½¿ç”¨BCryptåŠ å¯†ã€‚ 4 è‡ªå®šä¹‰è®¤è¯å¦‚æœspringbootéœ€è¦ä½¿ç”¨jspï¼Œéœ€è¦å¼•å…¥ &lt;!-- spring boot å†…ç½®tomcat jspæ”¯æŒ --> &lt;dependency> &lt;groupId>org.apache.tomcat.embed&lt;/groupId> &lt;artifactId>tomcat-embed-jasper&lt;/artifactId> &lt;/dependency> &lt;!--jspé¡µé¢ä½¿ç”¨jstlæ ‡ç­¾--> &lt;dependency> &lt;groupId>javax.servlet&lt;/groupId> &lt;artifactId>jstl&lt;/artifactId> &lt;/dependency> é…ç½®èµ„æºç›®å½•ï¼š &lt;build> &lt;resources> &lt;resource> &lt;directory>src/main/webapp&lt;/directory> &lt;targetPath>META-INF/resources&lt;/targetPath> &lt;includes> &lt;include>**/*.*&lt;/include> &lt;/includes> &lt;/resource> &lt;/resources> &lt;/build> å°†login.jspæ”¾åœ¨webapp/WEB-INF/viewä¸‹ï¼Œé…ç½®è§†å›¾è§£æå™¨ï¼š spring.mvc.view.prefix= /WEB-INF/view/ spring.mvc.view.suffix= .jsp é…ç½®è·¯å¾„æ˜ å°„ï¼š @Configuration public class WebConfig implements WebMvcConfigurer { @Override public void addViewControllers(ViewControllerRegistry registry) { registry.addViewController(\"/\").setViewName(\"redirect:/login-view\"); registry.addViewController(\"/login-view\").setViewName(\"login\"); } } é…ç½®SpringSecurityçš„ç™»å½•é¡µï¼Œå’Œå¤„ç†è·¯å¾„ï¼š @Configuration public class WebSecurityConfig extends WebSecurityConfigurerAdapter { //å®šä¹‰ç”¨æˆ·ä¿¡æ¯æœåŠ¡ï¼ˆæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼‰ @Bean public UserDetailsService userDetailsService(){ InMemoryUserDetailsManager manager = new InMemoryUserDetailsManager(); manager.createUser(User.withUsername(\"zhangsan\").password(\"123\").authorities(\"p1\").build()); manager.createUser(User.withUsername(\"lisi\").password(\"456\").authorities(\"p2\").build()); return manager; } //å¯†ç ç¼–ç å™¨ @Bean public PasswordEncoder passwordEncoder(){ return NoOpPasswordEncoder.getInstance(); } //å®‰å…¨æ‹¦æˆªæœºåˆ¶ @Override protected void configure(HttpSecurity http) throws Exception { http.authorizeRequests() .antMatchers(\"/r/r1\").hasAuthority(\"p1\") .antMatchers(\"/r/r2\").hasAuthority(\"p2\") .antMatchers(\"/r/**\").authenticated()//æ‰€æœ‰\"/r/**\"è¯·æ±‚å¿…é¡»è®¤è¯é€šè¿‡ .anyRequest().permitAll()//é™¤äº†\"/r/**\"æ‰€æœ‰è¯·æ±‚å¯ä»¥è®¿é—® .and() .formLogin()//å…è®¸è¡¨å•ç™»å½• .loginPage(\"/login-view\")//é…ç½®ç™»å½•é¡µ .loginProcessingUrl(\"/login\")//é…ç½®å¤„ç†è·¯å¾„ .successForwardUrl(\"/login-success\");//è‡ªå®šä¹‰ç™»é™†æˆåŠŸçš„é¡µé¢åœ°å€ } } ä¸ºäº†é˜²æ­¢spring securityçš„csrfæ‹¦æˆªæœºåˆ¶ï¼Œå¯ä»¥å°†å…¶å…³é—­ï¼š @Override protected void configure(HttpSecurity http) throws Exception { http.csrf().disable() .authorizeRequests() .antMatchers(\"/r/r1\").hasAuthority(\"p1\") .antMatchers(\"/r/r2\").hasAuthority(\"p2\") .antMatchers(\"/r/**\").authenticated()//æ‰€æœ‰\"/r/**\"è¯·æ±‚å¿…é¡»è®¤è¯é€šè¿‡ .anyRequest().permitAll()//é™¤äº†\"/r/**\"æ‰€æœ‰è¯·æ±‚å¯ä»¥è®¿é—® .and() .formLogin()//å…è®¸è¡¨å•ç™»å½• .loginPage(\"/login-view\") .loginProcessingUrl(\"/login\") .successForwardUrl(\"/login-success\");//è‡ªå®šä¹‰ç™»é™†æˆåŠŸçš„é¡µé¢åœ°å€ } æˆ–è€…åœ¨login.jspé¡µé¢æ·»åŠ ä¸€ä¸ªtokenï¼š ç”¨æˆ·ï¼š å¯†ç ï¼š","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"å®‰å…¨","slug":"å®‰å…¨","permalink":"https://www.codetool.top/tags/%E5%AE%89%E5%85%A8/"},{"name":"Spring Security","slug":"Spring-Security","permalink":"https://www.codetool.top/tags/Spring-Security/"}]},{"title":"leetcode914-å¡ç‰Œåˆ†ç»„","slug":"leetcode914-å¡ç‰Œåˆ†ç»„","date":"2020-03-27T01:55:40.000Z","updated":"2020-03-27T02:00:50.394Z","comments":true,"path":"article/leetcode914-å¡ç‰Œåˆ†ç»„/","link":"","permalink":"https://www.codetool.top/article/leetcode914-%E5%8D%A1%E7%89%8C%E5%88%86%E7%BB%84/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€å‰¯ç‰Œï¼Œæ¯å¼ ç‰Œä¸Šéƒ½å†™ç€ä¸€ä¸ªæ•´æ•°ã€‚ æ­¤æ—¶ï¼Œä½ éœ€è¦é€‰å®šä¸€ä¸ªæ•°å­— Xï¼Œä½¿æˆ‘ä»¬å¯ä»¥å°†æ•´å‰¯ç‰ŒæŒ‰ä¸‹è¿°è§„åˆ™åˆ†æˆ 1 ç»„æˆ–æ›´å¤šç»„ï¼š æ¯ç»„éƒ½æœ‰ X å¼ ç‰Œã€‚ ç»„å†…æ‰€æœ‰çš„ç‰Œä¸Šéƒ½å†™ç€ç›¸åŒçš„æ•´æ•°ã€‚ä»…å½“ä½ å¯é€‰çš„ X &gt;= 2 æ—¶è¿”å› trueã€‚ ç¤ºä¾‹ 1: è¾“å…¥ï¼š [1,2,3,4,4,3,2,1]è¾“å‡ºï¼š trueè§£é‡Šï¼š å¯è¡Œçš„åˆ†ç»„æ˜¯ [1,1]ï¼Œ[2,2]ï¼Œ[3,3]ï¼Œ[4,4] ç¤ºä¾‹ 2: è¾“å…¥ï¼š [1,1,1,2,2,2,3,3]è¾“å‡ºï¼š falseè§£é‡Šï¼š æ²¡æœ‰æ»¡è¶³è¦æ±‚çš„åˆ†ç»„ã€‚ ç¤ºä¾‹ 3: è¾“å…¥ï¼š [1]è¾“å‡ºï¼š falseè§£é‡Šï¼š æ²¡æœ‰æ»¡è¶³è¦æ±‚çš„åˆ†ç»„ã€‚ ç¤ºä¾‹ 4: è¾“å…¥ï¼š [1,1]è¾“å‡ºï¼š trueè§£é‡Šï¼š å¯è¡Œçš„åˆ†ç»„æ˜¯ [1,1] ç¤ºä¾‹ 5: è¾“å…¥ï¼š [1,1,2,2,2,2]è¾“å‡ºï¼š trueè§£é‡Šï¼š å¯è¡Œçš„åˆ†ç»„æ˜¯ [1,1]ï¼Œ[2,2]ï¼Œ[2,2] æç¤ºï¼š 1 &lt;= deck.length &lt;= 10000 0 &lt;= deck[i] &lt; 10000 2 è§£æ³•2.1 æ€æƒ³å“ˆå¸Œè¡¨è·å–æ‰€æœ‰æ•°çš„å‡ºç°æ¬¡æ•°ï¼Œè¿™äº›æ•°å­—çš„æœ€å¤§å…¬çº¦æ•°ä¸å°äº2 2.2 ä»£ç class Solution { public boolean hasGroupsSizeX(int[] deck) { Map&lt;Integer,Integer> map = new HashMap&lt;>(); for(int i:deck){ map.put(i,map.getOrDefault(i,0)+1); } Integer count = null; for(Map.Entry&lt;Integer,Integer> entry:map.entrySet()){ if(count == null){ if(entry.getValue()==1){ return false; }else{ count = entry.getValue(); } }else{ count = gcd(count,entry.getValue()); if(count&lt;2) return false; } } return true; } public int gcd(int a, int b) { return a % b == 0 ? b : gcd(b, a % b); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"ä½¿ç”¨Spring Securityè¿›è¡Œèº«ä»½è®¤è¯","slug":"ä½¿ç”¨Spring Securityè¿›è¡Œèº«ä»½è®¤è¯","date":"2020-03-26T14:31:43.000Z","updated":"2020-03-27T16:27:13.501Z","comments":true,"path":"article/ä½¿ç”¨Spring Securityè¿›è¡Œèº«ä»½è®¤è¯/","link":"","permalink":"https://www.codetool.top/article/%E4%BD%BF%E7%94%A8Spring%20Security%E8%BF%9B%E8%A1%8C%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81/","excerpt":"","text":"1 Spring Securityæ¦‚è¿°Spring Securityæ˜¯ä¸€ä¸ªèƒ½å¤Ÿä¸ºåŸºäºSpringçš„ä¼ä¸šåº”ç”¨ç³»ç»Ÿæä¾›å£°æ˜å¼çš„å®‰å…¨è®¿é—®æ§åˆ¶è§£å†³æ–¹æ¡ˆçš„å®‰å…¨æ¡†æ¶ã€‚ç”±äºå®ƒæ˜¯Springç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€å‘˜ï¼Œå› æ­¤å®ƒä¼´éšç€æ•´ä¸ªSpringç”Ÿæ€ç³»ç»Ÿä¸æ–­ä¿®æ­£ã€å‡çº§ï¼Œåœ¨spring booté¡¹ç›®ä¸­åŠ å…¥spring securityæ›´æ˜¯ååˆ†ç®€å•ï¼Œä½¿ç”¨Spring Security å‡å°‘äº†ä¸ºä¼ä¸šç³»ç»Ÿå®‰å…¨æ§åˆ¶ç¼–å†™å¤§é‡é‡å¤ä»£ç çš„å·¥ä½œã€‚ Spring Securityæä¾›äº†ä¸€ä¸ªç™»å½•é¡µæ¨¡æ¿/loginå’Œç™»å‡ºé¡µ/logoutï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ 2 SpringMVC æ•´åˆ2.1 pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"> &lt;parent> &lt;artifactId>testProject&lt;/artifactId> &lt;groupId>org.rhett&lt;/groupId> &lt;version>1.0-SNAPSHOT&lt;/version> &lt;/parent> &lt;modelVersion>4.0.0&lt;/modelVersion> &lt;artifactId>spring-security&lt;/artifactId> &lt;properties> &lt;project.build.sourceEncoding>UTF-8&lt;/project.build.sourceEncoding> &lt;maven.compiler.source>8&lt;/maven.compiler.source> &lt;maven.compiler.target>8&lt;/maven.compiler.target> &lt;spring.version>5.1.4.RELEASE&lt;/spring.version> &lt;/properties> &lt;packaging>war&lt;/packaging> &lt;dependencies> &lt;dependency> &lt;groupId>org.springframework.security&lt;/groupId> &lt;artifactId>spring-security-web&lt;/artifactId> &lt;version>${spring.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.security&lt;/groupId> &lt;artifactId>spring-security-config&lt;/artifactId> &lt;version>${spring.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework&lt;/groupId> &lt;artifactId>spring-context&lt;/artifactId> &lt;version>${spring.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework&lt;/groupId> &lt;artifactId>spring-web&lt;/artifactId> &lt;version>${spring.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework&lt;/groupId> &lt;artifactId>spring-webmvc&lt;/artifactId> &lt;version>${spring.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>javax.servlet&lt;/groupId> &lt;artifactId>javax.servlet-api&lt;/artifactId> &lt;version>3.1.0&lt;/version> &lt;scope>provided&lt;/scope> &lt;/dependency> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;version>1.18.12&lt;/version> &lt;/dependency> &lt;/dependencies> &lt;build> &lt;finalName>securityâ€springmvc&lt;/finalName> &lt;pluginManagement> &lt;plugins> &lt;plugin> &lt;groupId>org.apache.tomcat.maven&lt;/groupId> &lt;artifactId>tomcat7-maven-plugin&lt;/artifactId> &lt;version>2.2&lt;/version> &lt;/plugin> &lt;plugin> &lt;artifactId>mavenâ€resourcesâ€plugin&lt;/artifactId> &lt;configuration> &lt;encoding>utfâ€8&lt;/encoding> &lt;useDefaultDelimiters>true&lt;/useDefaultDelimiters> &lt;resources> &lt;resource> &lt;directory>src/main/resources&lt;/directory> &lt;filtering>true&lt;/filtering> &lt;includes> &lt;include>**/*&lt;/include> &lt;/includes> &lt;/resource> &lt;resource> &lt;directory>src/main/java&lt;/directory> &lt;includes> &lt;include>**/*.xml&lt;/include> &lt;/includes> &lt;/resource> &lt;/resources> &lt;/configuration> &lt;version>3.1.0&lt;/version> &lt;/plugin> &lt;/plugins> &lt;/pluginManagement> &lt;/build> &lt;/project> 2.2 é…ç½®ç±»@Configuration @ComponentScan(basePackages = \"com.rhett.security\", excludeFilters = {@ComponentScan.Filter(type = FilterType.ANNOTATION,value = Controller.class)}) //ç›¸å½“äºapplication.xml public class ApplicationConfig { } @Configuration @EnableWebMvc @ComponentScan(basePackages = \"com.rhett.security\", includeFilters = {@ComponentScan.Filter(type = FilterType.ANNOTATION,value = Controller.class)}) public class WebConfig implements WebMvcConfigurer { //è§†å›¾è§£æå™¨ @Bean public InternalResourceViewResolver viewResolver(){ InternalResourceViewResolver viewResolver = new InternalResourceViewResolver(); viewResolver.setPrefix(\"/WEB-INF/view/\"); viewResolver.setSuffix(\".jsp\"); return viewResolver; } @Override public void addViewControllers(ViewControllerRegistry registry) { registry.addViewController(\"/\").setViewName(\"redirect:/login\"); } } è¿™ä¸ªç±»æ˜¯å…³é”®çš„Spring-Securityçš„é…ç½®ç±» @EnableWebSecurity public class WebSecurityConfig extends WebSecurityConfigurerAdapter { //å®šä¹‰ç”¨æˆ·ä¿¡æ¯æœåŠ¡ï¼ˆæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™é‡Œä½¿ç”¨InMemoryUserDetailsManageræµ‹è¯•ï¼‰ @Bean public UserDetailsService userDetailsService(){ InMemoryUserDetailsManager manager = new InMemoryUserDetailsManager(); manager.createUser(User.withUsername(\"zhangsan\").password(\"123\").authorities(\"p1\").build()); manager.createUser(User.withUsername(\"lisi\").password(\"456\").authorities(\"p2\").build()); return manager; } //å¯†ç ç¼–ç å™¨ @Bean public PasswordEncoder passwordEncoder(){ return NoOpPasswordEncoder.getInstance(); } //å®‰å…¨æ‹¦æˆªæœºåˆ¶ @Override protected void configure(HttpSecurity http) throws Exception { http.authorizeRequests() .antMatchers(\"/r/r1\").hasAuthority(\"p1\")//è·å–r/r1å¿…é¡»å…·æœ‰p1æƒé™ .antMatchers(\"/r/r2\").hasAuthority(\"p2\")//è·å–r/r2å¿…é¡»å…·æœ‰p2æƒé™ .antMatchers(\"/r/**\").authenticated()//æ‰€æœ‰\"/r/**\"è¯·æ±‚å¿…é¡»è®¤è¯é€šè¿‡ .anyRequest().permitAll()//é™¤äº†\"/r/**\"æ‰€æœ‰è¯·æ±‚å¯ä»¥è®¿é—® .and() .formLogin()//å…è®¸è¡¨å•ç™»å½• .successForwardUrl(\"/login-success\");//è‡ªå®šä¹‰ç™»é™†æˆåŠŸçš„é¡µé¢åœ°å€ } } Springå®¹å™¨åˆå§‹åŒ–ï¼š public class SpringApplicationInitializer extends AbstractAnnotationConfigDispatcherServletInitializer { //springå®¹å™¨ï¼Œç›¸å½“äºåŠ è½½application.xml @Override protected Class&lt;?>[] getRootConfigClasses() { //è¿™é‡Œè¦åŠ è½½spring securityçš„é…ç½®ç±» return new Class[]{ApplicationConfig.class, WebSecurityConfig.class}; } //servletContextï¼Œç›¸å½“äºåŠ è½½web.xml @Override protected Class&lt;?>[] getServletConfigClasses() { return new Class[]{WebConfig.class}; } //url-mapping @Override protected String[] getServletMappings() { return new String[]{\"/\"}; } } Spring Securityçš„åˆå§‹åŒ–ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æƒ…å†µï¼š è‹¥å½“å‰ç¯å¢ƒæ²¡æœ‰ä½¿ç”¨ Springæˆ–Spring MVCï¼Œåˆ™éœ€è¦å°† WebSecurityConfig(Spring Securityé…ç½®ç±») ä¼ å…¥è¶…ç±»ï¼Œä»¥ç¡®ä¿è·å–é…ç½®ï¼Œå¹¶åˆ›å»ºspring contextã€‚ ç›¸åï¼Œè‹¥å½“å‰ç¯å¢ƒå·²ç»ä½¿ç”¨ springï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ç°æœ‰çš„springContextä¸­æ³¨å†ŒSpring Security(ä¸Šä¸€æ­¥å·²ç»åšå°†WebSecurityConfigåŠ è½½è‡³rootcontext)ï¼Œæ­¤æ–¹æ³•å¯ä»¥ä»€ä¹ˆéƒ½ä¸åšã€‚ public class SpringSecurityApplicationInitializer extends AbstractSecurityWebApplicationInitializer { public SpringSecurityApplicationInitializer(){ //super(WebSecurityConfig.class); } } 2.3 Controller@RestController public class LoginController { //ç™»å½•æˆåŠŸåè·³è½¬ @RequestMapping(value = \"/login-success\",produces = \"text/plain; charset=utf-8\") public String loginSuccess(){ return \"ç™»å½•æˆåŠŸ\"; } //ä¸¤ä¸ªèµ„æº @GetMapping(value = \"/r/r1\",produces = {\"text/plain;charset=utf-8\"}) public String r1(){ return \"è®¿é—®èµ„æºr1\"; } @GetMapping(value = \"/r/r2\",produces = {\"text/plain;charset=utf-8\"}) public String r2(){ return \"è®¿é—®èµ„æºr2\"; } } 2.4 æµ‹è¯•è¿è¡Œé¡¹ç›®ï¼Œè®¿é—®/loginè·¯å¾„ï¼Œå¯ä»¥çœ‹åˆ°spring securityæä¾›çš„ç™»é™†é¡µé¢ï¼Œè¿™ä¸ªç½‘é¡µåŠ è½½çš„cdné™æ€èµ„æºé€Ÿåº¦å¯¹å›½å†…ä¸æ˜¯å¾ˆå‹å¥½ï¼š å¦‚æœç™»å½•æˆåŠŸè·³è½¬åˆ°è‡ªå®šä¹‰çš„é¡µé¢ å¦‚æœå¤±è´¥ç»™å‡ºæç¤ºï¼š å¦‚æœå­˜åœ¨èµ„æºè®¿é—®æƒé™ï¼Œæ­£å¸¸è®¿é—®ï¼š å¦‚æœä¸å­˜åœ¨èµ„æºè®¿é—®æƒé™ï¼ŒæŠ¥403é”™è¯¯ï¼š 3 SpringBootæ•´åˆSpringBooté¡¹ç›®å¯¼å…¥ä¾èµ–ï¼š &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-security&lt;/artifactId> &lt;/dependency> SpringBootæ²¡æœ‰å¤ªå¤§å·®åˆ«ï¼Œé¦–å…ˆSpringå®¹å™¨ä¸éœ€è¦æ‰‹åŠ¨é…ç½®äº†ï¼Œç›´æ¥åªç•™ä¸€ä¸ªSecurityé…ç½®ç±»ï¼š //åŸæ¥çš„@EnableWebSecurityä¹Ÿä¸ç”¨å†™äº† @Configuration public class WebSecurityConfig extends WebSecurityConfigurerAdapter { //å®šä¹‰ç”¨æˆ·ä¿¡æ¯æœåŠ¡ï¼ˆæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼‰ @Bean public UserDetailsService userDetailsService(){ InMemoryUserDetailsManager manager = new InMemoryUserDetailsManager(); manager.createUser(User.withUsername(\"zhangsan\").password(\"123\").authorities(\"p1\").build()); manager.createUser(User.withUsername(\"lisi\").password(\"456\").authorities(\"p2\").build()); return manager; } //å¯†ç ç¼–ç å™¨ @Bean public PasswordEncoder passwordEncoder(){ return NoOpPasswordEncoder.getInstance(); } //å®‰å…¨æ‹¦æˆªæœºåˆ¶ @Override protected void configure(HttpSecurity http) throws Exception { http.authorizeRequests() .antMatchers(\"/r/r1\").hasAuthority(\"p1\") .antMatchers(\"/r/r2\").hasAuthority(\"p2\") .antMatchers(\"/r/**\").authenticated()//æ‰€æœ‰\"/r/**\"è¯·æ±‚å¿…é¡»è®¤è¯é€šè¿‡ .anyRequest().permitAll()//é™¤äº†\"/r/**\"æ‰€æœ‰è¯·æ±‚å¯ä»¥è®¿é—® .and() .formLogin()//å…è®¸è¡¨å•ç™»å½• .successForwardUrl(\"/login-success\");//è‡ªå®šä¹‰ç™»é™†æˆåŠŸçš„é¡µé¢åœ°å€ } }","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"å®‰å…¨","slug":"å®‰å…¨","permalink":"https://www.codetool.top/tags/%E5%AE%89%E5%85%A8/"},{"name":"Spring Security","slug":"Spring-Security","permalink":"https://www.codetool.top/tags/Spring-Security/"}]},{"title":"SpringMVCåŸºäºsessionå®ç°ç”¨æˆ·è®¤è¯ã€ä¼šè¯ã€æˆæƒ","slug":"SpringMVCåŸºäºsessionå®ç°ç”¨æˆ·è®¤è¯ã€ä¼šè¯ã€æˆæƒ","date":"2020-03-26T11:29:29.000Z","updated":"2020-04-11T16:26:16.064Z","comments":true,"path":"article/SpringMVCåŸºäºsessionå®ç°ç”¨æˆ·è®¤è¯ã€ä¼šè¯ã€æˆæƒ/","link":"","permalink":"https://www.codetool.top/article/SpringMVC%E5%9F%BA%E4%BA%8Esession%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E3%80%81%E4%BC%9A%E8%AF%9D%E3%80%81%E6%8E%88%E6%9D%83/","excerpt":"","text":"1 è®¤è¯å…ˆæ­å»ºåŸºæœ¬çš„é¡¹ç›®æ¡†æ¶ï¼Œæœ¬é¡¹ç›®ä¸ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œå…¨éƒ¨ä½¿ç”¨é…ç½®ç±»é…ç½®springmvcï¼Œä¹‹å‰è¿˜æ²¡æœ‰æ¥è§¦è¿‡ï¼Œè¿™ä¸ªé¡¹ç›®ä¹Ÿç®—æ˜¯è¡¥å……äº†ï¼š 1.1 pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"> &lt;parent> &lt;artifactId>testProject&lt;/artifactId> &lt;groupId>org.rhett&lt;/groupId> &lt;version>1.0-SNAPSHOT&lt;/version> &lt;/parent> &lt;modelVersion>4.0.0&lt;/modelVersion> &lt;properties> &lt;project.build.sourceEncoding>UTF-8&lt;/project.build.sourceEncoding> &lt;maven.compiler.source>8&lt;/maven.compiler.source> &lt;maven.compiler.target>8&lt;/maven.compiler.target> &lt;spring.version>5.2.3.RELEASE&lt;/spring.version> &lt;/properties> &lt;packaging>war&lt;/packaging> &lt;artifactId>security-sprimgmvc&lt;/artifactId> &lt;dependencies> &lt;!-- spring &amp; spring mvc--> &lt;dependency> &lt;groupId>org.springframework&lt;/groupId> &lt;artifactId>spring-context&lt;/artifactId> &lt;version>${spring.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework&lt;/groupId> &lt;artifactId>spring-web&lt;/artifactId> &lt;version>${spring.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework&lt;/groupId> &lt;artifactId>spring-webmvc&lt;/artifactId> &lt;version>${spring.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>javax.servlet&lt;/groupId> &lt;artifactId>javax.servlet-api&lt;/artifactId> &lt;version>3.0.1&lt;/version> &lt;scope>provided&lt;/scope> &lt;/dependency> &lt;!-- å·¥å…· --> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;version>1.18.12&lt;/version> &lt;/dependency> &lt;/dependencies> &lt;build> &lt;finalName>securityâ€springmvc&lt;/finalName> &lt;pluginManagement> &lt;plugins> &lt;!-- tomcatæ’ä»¶å¯åŠ¨ --> &lt;plugin> &lt;groupId>org.apache.tomcat.maven&lt;/groupId> &lt;artifactId>tomcat7-maven-plugin&lt;/artifactId> &lt;version>2.2&lt;/version> &lt;/plugin> &lt;plugin> &lt;artifactId>mavenâ€resourcesâ€plugin&lt;/artifactId> &lt;configuration> &lt;encoding>utfâ€8&lt;/encoding> &lt;useDefaultDelimiters>true&lt;/useDefaultDelimiters> &lt;resources> &lt;resource> &lt;directory>src/main/resources&lt;/directory> &lt;filtering>true&lt;/filtering> &lt;includes> &lt;include>**/*&lt;/include> &lt;/includes> &lt;/resource> &lt;resource> &lt;directory>src/main/java&lt;/directory> &lt;includes> &lt;include>**/*.xml&lt;/include> &lt;/includes> &lt;/resource> &lt;/resources> &lt;/configuration> &lt;version>3.1.0&lt;/version> &lt;/plugin> &lt;/plugins> &lt;/pluginManagement> &lt;/build> &lt;/project> 1.2 é…ç½®ç±»@Configuration @ComponentScan(basePackages = \"com.rhett.security\", excludeFilters = {@ComponentScan.Filter(type = FilterType.ANNOTATION,value = Controller.class)}) //ç›¸å½“äºapplication.xml public class ApplicationConfig { } @Configuration @EnableWebMvc @ComponentScan(basePackages = \"com.rhett.security\", includeFilters = {@ComponentScan.Filter(type = FilterType.ANNOTATION,value = Controller.class)}) //ç›¸å½“äºweb.xmlï¼Œå®ç°WebMvcConfigurer public class WebConfig implements WebMvcConfigurer { //è§†å›¾è§£æå™¨ @Bean public InternalResourceViewResolver viewResolver(){ InternalResourceViewResolver viewResolver = new InternalResourceViewResolver(); viewResolver.setPrefix(\"/WEB-INF/view/\"); viewResolver.setSuffix(\".jsp\"); return viewResolver; } @Override public void addViewControllers(ViewControllerRegistry registry) { registry.addViewController(\"/\").setViewName(\"login\"); } } Springå®¹å™¨åˆå§‹åŒ–ï¼šè¿™ä¸ªç±»å®ç°è‡ªWebApplicationInitializerï¼Œspringå®¹å™¨å¯åŠ¨çš„æ—¶å€™ä¼šåŠ è½½WebApplicationInitializeræ¥å£çš„æ‰€æœ‰å®ç°ç±»ã€‚ public class SpringApplicationInitializer extends AbstractAnnotationConfigDispatcherServletInitializer { //springå®¹å™¨ï¼Œç›¸å½“äºåŠ è½½application.xml @Override protected Class&lt;?>[] getRootConfigClasses() { return new Class[]{ApplicationConfig.class}; } //servletContextï¼Œç›¸å½“äºåŠ è½½web.xml @Override protected Class&lt;?>[] getServletConfigClasses() { return new Class[]{WebConfig.class}; } //url-mapping @Override protected String[] getServletMappings() { return new String[]{\"/\"}; } } 1.3 å®ä½“ç±»ç”¨æˆ·ä¿¡æ¯ï¼š @Data @AllArgsConstructor public class UserDto { private String id; private String username; private String password; private String fullname; private String mobile; } å°è£…ç”¨æˆ·æäº¤çš„ç™»å½•å‚æ•°ï¼š @Data public class AuthenticationRequest { private String username; private String password; } 1.4 è®¤è¯servicepublic interface AuthenticationService { UserDto authentication(AuthenticationRequest request); } å®ç°ï¼š @Service public class AuthenticationServiceImpl implements AuthenticationService{ private Map&lt;String,UserDto> userMap = new HashMap&lt;>(); //æ¨¡æ‹Ÿæ•°æ®åº“æ•°æ® { userMap.put(\"zhangsan\",new UserDto(\"1010\",\"zhangsan\",\"123\",\"å¼ ä¸‰\")); userMap.put(\"lisi\",new UserDto(\"1011\",\"lisi\",\"456\",\"æå››\",\"144553\")); } @Override public UserDto authentication(AuthenticationRequest request) { //æ ¡éªŒå‚æ•°æ˜¯å¦ä¸ºç©º if(request == null || StringUtils.isEmpty(request.getUsername()) || StringUtils.isEmpty(request.getPassword())){ throw new RuntimeException(\"è´¦å·å’Œå¯†ç ä¸ºç©º\"); } //æ ¹æ®è´¦å·å»æŸ¥è¯¢æ•°æ®åº“ UserDto user = getUserDto(request.getUsername()); if(user==null){ throw new RuntimeException(\"æŸ¥è¯¢ä¸åˆ°è¯¥ç”¨æˆ·\"); } if(!request.getPassword().equals(user.getPassword())){ throw new RuntimeException(\"è´¦å·æˆ–å¯†ç é”™è¯¯\"); } return user; } //å‡è£…è¿™æ˜¯ä¸€ä¸ªæŸ¥è¯¢æ•°æ®åº“çš„æ–¹æ³• private UserDto getUserDto(String userName){ return userMap.get(userName); } } 1.5 controller@RestController public class LoginController { @Autowired private AuthenticationService authenticationService; @PostMapping(value = \"/login\",produces = \"text/plain;charset=utf-8\") public String login(AuthenticationRequest request){ UserDto userDto = authenticationService.authentication(request); return userDto.getUsername()+\"ç™»å½•æˆåŠŸ\"; } } 1.6 è§†å›¾éƒ¨ç½²åœ¨webapp/WEB-INF/view/ä¸‹ &lt;%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %> &lt;html> &lt;head> &lt;title>ç”¨æˆ·ç™»å½•&lt;/title> &lt;/head> &lt;body> &lt;form action=\"login\" method=\"post\"> ç”¨æˆ·ï¼š&lt;input type=\"text\" name=\"username\">&lt;br/> å¯†ç ï¼š&lt;input type=\"password\" name=\"password\">&lt;br/> &lt;input type=\"submit\" value=\"ç™»å½•\"/> &lt;/form> &lt;/body> &lt;/html> ç°åœ¨å°±å¯ä»¥è¿›è¡Œç™»å½•äº†ã€‚ 2 ä¼šè¯è¦å®ç°ä¼šè¯ï¼Œå°±æ˜¯å°†ç™»å½•ä¿¡æ¯å†™å…¥sessionä¸­ï¼Œé¦–å…ˆå–ä¸€ä¸ªsessionåï¼Œå¯ä»¥å†™åœ¨UserDtoä¸­ï¼š @Data @AllArgsConstructor public class UserDto { //sessionå public static final String SESSION_USER_KEY = \"_user\"; private String id; private String username; private String password; private String fullname; private String mobile; } åœ¨ç™»å½•çš„controllerè·å–sessionï¼Œå¹¶å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥sessionï¼š @PostMapping(value = \"/login\",produces = \"text/plain;charset=utf-8\") public String login(AuthenticationRequest request, HttpSession session){ UserDto userDto = authenticationService.authentication(request); //å­˜å…¥session session.setAttribute(UserDto.SESSION_USER_KEY,userDto); return userDto.getUsername()+\"ç™»å½•æˆåŠŸ\"; } å†™ä¸€ä¸ªèµ„æºéªŒè¯ä¸€ä¸‹ï¼š @GetMapping(value = \"/r/r1\",produces = {\"text/plain;charset=utf-8\"}) public String r1(HttpSession session){ String fullname = null; Object object = session.getAttribute(UserDto.SESSION_USER_KEY); if(object == null){ fullname = \"åŒ¿å\"; }else { UserDto userDto = (UserDto) object; fullname = userDto.getFullname(); } return fullname+\"è®¿é—®èµ„æºr1\"; } å…ˆç™»å½•ï¼Œå†è®¿é—®ï¼Œå¯ä»¥çœ‹åˆ°ç”¨æˆ·ä¿¡æ¯è¢«è¯†åˆ«äº†ï¼š 3 æˆæƒæ›´æ”¹controllerï¼Œæ–°å¢ä¸€ä¸ªèµ„æºr2: @GetMapping(value = \"/r/r2\",produces = {\"text/plain;charset=utf-8\"}) public String r2(HttpSession session){ String fullname = null; Object object = session.getAttribute(UserDto.SESSION_USER_KEY); if(object == null){ fullname = \"åŒ¿å\"; }else { UserDto userDto = (UserDto) object; fullname = userDto.getFullname(); } return fullname+\"è®¿é—®èµ„æºr2\"; } ç»™ç”¨æˆ·å¢åŠ ä¸€ä¸ªè¡¨ç¤ºæƒé™çš„å­—æ®µï¼š @Data @AllArgsConstructor public class UserDto { public static final String SESSION_USER_KEY = \"_user\"; private String id; private String username; private String password; private String fullname; private String mobile; //ç”¨æˆ·æƒé™ private Set&lt;String> authorities; } æ›´æ”¹serviceçš„åˆå§‹åŒ–ä»£ç å—ï¼š { Set&lt;String> authorities1 = new HashSet&lt;>(); authorities1.add(\"p1\");//p1å’Œ/r/r1å¯¹åº” Set&lt;String> authorities2 = new HashSet&lt;>(); authorities2.add(\"p2\");//p2å’Œ/r/r2å¯¹åº” userMap.put(\"zhangsan\",new UserDto(\"1010\",\"zhangsan\",\"123\",\"å¼ ä¸‰\",\"133443\",authorities1)); userMap.put(\"lisi\",new UserDto(\"1011\",\"lisi\",\"456\",\"æå››\",\"144553\",authorities2)); } å†™ä¸€ä¸ªæ‹¦æˆªå™¨ç”¨äºæƒé™éªŒè¯ï¼š @Component public class SimpleAuthenticationInterceptor implements HandlerInterceptor { @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response,Object handler) throws Exception{ //å–å‡ºç”¨æˆ·èº«ä»½ä¿¡æ¯ Object object = request.getSession().getAttribute(UserDto.SESSION_USER_KEY); if(object == null){ writeContent(response,\"è¯·ç™»å½•\"); } UserDto userDto = (UserDto) object; //è¯·æ±‚çš„uri String requestURI = request.getRequestURI(); if(userDto.getAuthorities().contains(\"p1\")&amp;&amp;requestURI.contains(\"r/r1\")){ return true; } if(userDto.getAuthorities().contains(\"p2\")&amp;&amp;requestURI.contains(\"r/r2\")){ return true; } writeContent(response,\"æ²¡æœ‰æƒé™ï¼Œæ‹’ç»è®¿é—®\"); return false; } private void writeContent(HttpServletResponse response, String msg) throws IOException { response.setContentType(\"text/html;charset=utf-8\"); PrintWriter writer = response.getWriter(); writer.write(msg); writer.close(); } } åœ¨WebConfigä¸­é…ç½®æ‹¦æˆªå™¨ï¼š @Configuration @EnableWebMvc @ComponentScan(basePackages = \"com.rhett.security\", includeFilters = {@ComponentScan.Filter(type = FilterType.ANNOTATION,value = Controller.class)}) public class WebConfig implements WebMvcConfigurer { @Autowired SimpleAuthenticationInterceptor simpleAuthenticationInterceptor; //è§†å›¾è§£æå™¨ @Bean public InternalResourceViewResolver viewResolver(){ InternalResourceViewResolver viewResolver = new InternalResourceViewResolver(); viewResolver.setPrefix(\"/WEB-INF/view/\"); viewResolver.setSuffix(\".jsp\"); return viewResolver; } @Override public void addViewControllers(ViewControllerRegistry registry) { registry.addViewController(\"/\").setViewName(\"login\"); } //é…ç½®æ‹¦æˆªå™¨ @Override public void addInterceptors(InterceptorRegistry registry) { registry.addInterceptor(simpleAuthenticationInterceptor).addPathPatterns(\"/r/**\"); } } éªŒè¯ï¼šç™»å½•zhangsanï¼Œè®¿é—®r1æ­£å¸¸ï¼Œè®¿é—®r2æç¤ºæƒé™ä¸å¤Ÿ","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"SpringMVC","slug":"SpringMVC","permalink":"https://www.codetool.top/tags/SpringMVC/"},{"name":"å®‰å…¨","slug":"å®‰å…¨","permalink":"https://www.codetool.top/tags/%E5%AE%89%E5%85%A8/"}]},{"title":"Javawebè®¤è¯ã€ä¼šè¯ã€æˆæƒæ¦‚è¿°","slug":"Javawebè®¤è¯ã€ä¼šè¯ã€æˆæƒæ¦‚è¿°","date":"2020-03-26T09:29:00.000Z","updated":"2020-04-01T17:25:16.917Z","comments":true,"path":"article/Javawebè®¤è¯ã€ä¼šè¯ã€æˆæƒæ¦‚è¿°/","link":"","permalink":"https://www.codetool.top/article/Javaweb%E8%AE%A4%E8%AF%81%E3%80%81%E4%BC%9A%E8%AF%9D%E3%80%81%E6%8E%88%E6%9D%83%E6%A6%82%E8%BF%B0/","excerpt":"","text":"1 è®¤è¯ç³»ç»Ÿä¸ºä»€ä¹ˆè¦è®¤è¯ï¼Ÿ è®¤è¯æ˜¯ä¸ºäº†ä¿æŠ¤ç³»ç»Ÿçš„éšç§æ•°æ®ä¸èµ„æºï¼Œç”¨æˆ·çš„èº«ä»½åˆæ³•æ–¹å¯è®¿é—®è¯¥ç³»ç»Ÿçš„èµ„æºã€‚ è®¤è¯ï¼š ç”¨æˆ·è®¤è¯å°±æ˜¯åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·çš„èº«ä»½æ˜¯å¦åˆæ³•çš„è¿‡ç¨‹ï¼Œç”¨æˆ·å»è®¿é—®ç³»ç»Ÿèµ„æºæ—¶ç³»ç»Ÿè¦æ±‚éªŒè¯ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼Œèº«ä»½åˆæ³•æ–¹å¯ç»§ç»­è®¿é—®ï¼Œä¸åˆæ³•åˆ™æ‹’ç»è®¿é—®ã€‚å¸¸è§çš„ç”¨æˆ·èº«ä»½è®¤è¯æ–¹å¼æœ‰ï¼šç”¨æˆ·åå¯†ç ç™»å½•ï¼ŒäºŒç»´ç ç™»å½•ï¼Œæ‰‹æœºçŸ­ä¿¡ç™»å½•ï¼ŒæŒ‡çº¹è®¤è¯ç­‰æ–¹å¼ã€‚ 2 ä¼šè¯ç”¨æˆ·è®¤è¯é€šè¿‡åï¼Œä¸ºäº†é¿å…ç”¨æˆ·çš„æ¯æ¬¡æ“ä½œéƒ½è¿›è¡Œè®¤è¯å¯å°†ç”¨æˆ·çš„ä¿¡æ¯ä¿è¯åœ¨ä¼šè¯ä¸­ã€‚ä¼šè¯å°±æ˜¯ç³»ç»Ÿä¸ºäº†ä¿æŒå½“å‰ç”¨æˆ·çš„ç™»å½•çŠ¶æ€æ‰€æä¾›çš„æœºåˆ¶ï¼Œå¸¸è§çš„æœ‰åŸºäºsessionæ–¹å¼ã€åŸºäºtokenæ–¹å¼ç­‰ã€‚ åŸºäºsessionçš„è®¤è¯æ–¹å¼å¦‚ä¸‹å›¾ï¼š å®ƒçš„äº¤äº’æµç¨‹æ˜¯ï¼Œç”¨æˆ·è®¤è¯æˆåŠŸåï¼Œåœ¨æœåŠ¡ç«¯ç”Ÿæˆç”¨æˆ·ç›¸å…³çš„æ•°æ®ä¿å­˜åœ¨session(å½“å‰ä¼šè¯)ä¸­ï¼Œå‘ç»™å®¢æˆ·ç«¯çš„sesssion_id å­˜æ”¾åˆ° cookie ä¸­ï¼Œè¿™æ ·ç”¨æˆ·å®¢æˆ·ç«¯è¯·æ±‚æ—¶å¸¦ä¸Š session_id å°±å¯ä»¥éªŒè¯æœåŠ¡å™¨ç«¯æ˜¯å¦å­˜åœ¨ session æ•°æ®ï¼Œä»¥æ­¤å®Œæˆç”¨æˆ·çš„åˆæ³•æ ¡éªŒï¼Œå½“ç”¨æˆ·é€€å‡ºç³»ç»Ÿæˆ–sessionè¿‡æœŸé”€æ¯æ—¶,å®¢æˆ·ç«¯çš„session_idä¹Ÿå°±æ— æ•ˆäº†ã€‚ åŸºäºtokenæ–¹å¼å¦‚ä¸‹å›¾ï¼š å®ƒçš„äº¤äº’æµç¨‹æ˜¯ï¼Œç”¨æˆ·è®¤è¯æˆåŠŸåï¼ŒæœåŠ¡ç«¯ç”Ÿæˆä¸€ä¸ªtokenå‘ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ”¾åˆ° cookie æˆ– localStorage ç­‰å­˜å‚¨ä¸­ï¼Œæ¯æ¬¡è¯·æ±‚æ—¶å¸¦ä¸Š tokenï¼ŒæœåŠ¡ç«¯æ”¶åˆ°tokené€šè¿‡éªŒè¯åå³å¯ç¡®è®¤ç”¨æˆ·èº«ä»½ã€‚ åŸºäºsessionçš„è®¤è¯æ–¹å¼ç”±Servletè§„èŒƒå®šåˆ¶ï¼ŒæœåŠ¡ç«¯è¦å­˜å‚¨sessionä¿¡æ¯éœ€è¦å ç”¨å†…å­˜èµ„æºï¼Œå®¢æˆ·ç«¯éœ€è¦æ”¯æŒcookieï¼›åŸºäºtokençš„æ–¹å¼åˆ™ä¸€èˆ¬ä¸éœ€è¦æœåŠ¡ç«¯å­˜å‚¨tokenï¼Œå¹¶ä¸”ä¸é™åˆ¶å®¢æˆ·ç«¯çš„å­˜å‚¨æ–¹å¼ã€‚å¦‚ä»Šç§»åŠ¨äº’è”ç½‘æ—¶ä»£æ›´å¤šç±»å‹çš„å®¢æˆ·ç«¯éœ€è¦æ¥å…¥ç³»ç»Ÿï¼Œç³»ç»Ÿå¤šæ˜¯é‡‡ç”¨å‰åç«¯åˆ†ç¦»çš„æ¶æ„è¿›è¡Œå®ç°ï¼Œæ‰€ä»¥åŸºäºtokençš„æ–¹å¼æ›´é€‚åˆã€‚ 3 æˆæƒè®¤è¯æ˜¯ä¸ºäº†ä¿è¯ç”¨æˆ·èº«ä»½çš„åˆæ³•æ€§ï¼Œæˆæƒåˆ™æ˜¯ä¸ºäº†æ›´ç»†ç²’åº¦çš„å¯¹éšç§æ•°æ®è¿›è¡Œåˆ’åˆ†ï¼Œæˆæƒæ˜¯åœ¨è®¤è¯é€šè¿‡åå‘ç”Ÿçš„ï¼Œæ§åˆ¶ä¸åŒçš„ç”¨æˆ·èƒ½å¤Ÿè®¿é—®ä¸åŒçš„èµ„æºã€‚ æˆæƒï¼š æˆæƒæ˜¯ç”¨æˆ·è®¤è¯é€šè¿‡æ ¹æ®ç”¨æˆ·çš„æƒé™æ¥æ§åˆ¶ç”¨æˆ·è®¿é—®èµ„æºçš„è¿‡ç¨‹ï¼Œæ‹¥æœ‰èµ„æºçš„è®¿é—®æƒé™åˆ™æ­£å¸¸è®¿é—®ï¼Œæ²¡æœ‰æƒé™åˆ™æ‹’ç»è®¿é—®ã€‚ æˆæƒçš„æ•°æ®æ¨¡å‹ ç”¨æˆ·-&gt;è§’è‰²-&gt;æƒé™-&gt;èµ„æº 3.1 RBAC3.1.1 åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶RBACçš„ä¸€ç§è§£é‡Šæ˜¯åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRole-Based Access Controlï¼‰ï¼Œæ˜¯æŒ‰è§’è‰²è¿›è¡Œæˆæƒï¼Œæ¯”å¦‚ï¼šä¸»ä½“çš„è§’è‰²ä¸ºæ€»ç»ç†å¯ä»¥æŸ¥è¯¢ä¼ä¸šè¿è¥æŠ¥è¡¨ï¼ŒæŸ¥è¯¢å‘˜å·¥å·¥èµ„ä¿¡æ¯ç­‰ï¼Œè®¿é—®æ§åˆ¶æµç¨‹å¦‚ä¸‹ æ ¹æ®ä¸Šå›¾ä¸­çš„åˆ¤æ–­é€»è¾‘ï¼Œæˆæƒä¼ªä»£ç å¯è¡¨ç¤ºå¦‚ä¸‹ï¼š if(ä¸»ä½“.hasRole(&quot;æ€»ç»ç†è§’è‰²id&quot;)){ æŸ¥è¯¢å·¥èµ„ }å¦‚æœä¸Šå›¾ä¸­æŸ¥è¯¢å·¥èµ„æ‰€éœ€è¦çš„è§’è‰²å˜åŒ–ä¸ºæ€»ç»ç†å’Œéƒ¨é—¨ç»ç†ï¼Œæ­¤æ—¶å°±éœ€è¦ä¿®æ”¹åˆ¤æ–­é€»è¾‘ä¸ºâ€œåˆ¤æ–­ç”¨æˆ·çš„è§’è‰²æ˜¯å¦æ˜¯æ€»ç»ç†æˆ–éƒ¨é—¨ç»ç†â€ï¼Œä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š if(ä¸»ä½“.hasRole(&quot;æ€»ç»ç†è§’è‰²id&quot;) || ä¸»ä½“.hasRole(&quot;éƒ¨é—¨ç»ç†è§’è‰²id&quot;)){ æŸ¥è¯¢å·¥èµ„ }æ ¹æ®ä¸Šè¾¹çš„ä¾‹å­å‘ç°ï¼Œå½“éœ€è¦ä¿®æ”¹è§’è‰²çš„æƒé™æ—¶å°±éœ€è¦ä¿®æ”¹æˆæƒçš„ç›¸å…³ä»£ç ï¼Œç³»ç»Ÿå¯æ‰©å±•æ€§å·®ã€‚ 3.1.2 åŸºäºèµ„æºçš„è®¿é—®æ§åˆ¶RBACå¦ä¸€ç§è§£é‡Šæ˜¯åŸºäºèµ„æºçš„è®¿é—®æ§åˆ¶ï¼ˆResource-Based Access Controlï¼‰ï¼Œæ˜¯æŒ‰èµ„æºï¼ˆæˆ–æƒé™ï¼‰è¿›è¡Œæˆæƒï¼Œæ¯”å¦‚ï¼šç”¨æˆ·å¿…é¡»å…·æœ‰æŸ¥è¯¢å·¥èµ„æƒé™æ‰å¯ä»¥æŸ¥è¯¢å‘˜å·¥å·¥èµ„ä¿¡æ¯ç­‰ï¼Œè®¿é—®æ§åˆ¶æµç¨‹å¦‚ä¸‹ï¼š æ ¹æ®ä¸Šå›¾ä¸­çš„åˆ¤æ–­ï¼Œæˆæƒä»£ç å¯ä»¥è¡¨ç¤ºä¸ºï¼š if(ä¸»ä½“.hasPermission(&quot;æŸ¥è¯¢å·¥èµ„æƒé™æ ‡è¯†&quot;)){ æŸ¥è¯¢å·¥èµ„ }ä¼˜ç‚¹ï¼šç³»ç»Ÿè®¾è®¡æ—¶å®šä¹‰å¥½æŸ¥è¯¢å·¥èµ„çš„æƒé™æ ‡è¯†ï¼Œå³ä½¿æŸ¥è¯¢å·¥èµ„æ‰€éœ€è¦çš„è§’è‰²å˜åŒ–ä¸ºæ€»ç»ç†å’Œéƒ¨é—¨ç»ç†ä¹Ÿä¸éœ€è¦ä¿®æ”¹æˆæƒä»£ç ï¼Œç³»ç»Ÿå¯æ‰©å±•æ€§å¼ºã€‚","categories":[{"name":"é¡¹ç›®/ç¼–ç¨‹ç†è®º","slug":"é¡¹ç›®-ç¼–ç¨‹ç†è®º","permalink":"https://www.codetool.top/categories/%E9%A1%B9%E7%9B%AE-%E7%BC%96%E7%A8%8B%E7%90%86%E8%AE%BA/"}],"tags":[{"name":"javaweb","slug":"javaweb","permalink":"https://www.codetool.top/tags/javaweb/"},{"name":"å®‰å…¨","slug":"å®‰å…¨","permalink":"https://www.codetool.top/tags/%E5%AE%89%E5%85%A8/"}]},{"title":"Luceneçš„javaåº“ä½¿ç”¨","slug":"Luceneçš„javaåº“ä½¿ç”¨","date":"2020-03-26T04:38:41.000Z","updated":"2020-03-26T04:38:53.959Z","comments":true,"path":"article/Luceneçš„javaåº“ä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/Lucene%E7%9A%84java%E5%BA%93%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 javaå®ç°å»ºç«‹ç´¢å¼•åœ¨æ•°æ®åº“ä¸­å»ºä¸€ä¸ªluceneåº“ï¼Œæ’å…¥ä¸€ä¸ªtb_skuè¡¨ï¼Œå†…å«ç™¾ä¸‡æ¡ç›®çº§åˆ«çš„æ•°æ®ã€‚ é™„å»ºè¡¨sqlä¸‹è½½ï¼š é“¾æ¥ï¼šhttps://pan.baidu.com/s/13FbFc5YmzaTcj0Rxh-O2Bgæå–ç ï¼šue7x æ–°å»ºå·¥ç¨‹ï¼Œ pomï¼š &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"> &lt;parent> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-parent&lt;/artifactId> &lt;version>2.2.4.RELEASE&lt;/version> &lt;/parent> &lt;modelVersion>4.0.0&lt;/modelVersion> &lt;artifactId>luceneDemo&lt;/artifactId> &lt;properties> &lt;maven.compiler.source>1.8&lt;/maven.compiler.source> &lt;maven.compiler.target>1.8&lt;/maven.compiler.target> &lt;project.build.sourceEncoding>UTF-8&lt;/project.build.sourceEncoding> &lt;project.reporting.outputEncoding>UTF-8&lt;/project.reporting.outputEncoding> &lt;skipTests>true&lt;/skipTests> &lt;/properties> &lt;dependencies> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;version>1.18.12&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>commons-io&lt;/groupId> &lt;artifactId>commons-io&lt;/artifactId> &lt;version>2.6&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.apache.lucene&lt;/groupId> &lt;artifactId>lucene-core&lt;/artifactId> &lt;version>7.7.2&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.apache.lucene&lt;/groupId> &lt;artifactId>lucene-analyzers-common&lt;/artifactId> &lt;version>7.7.2&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.apache.lucene&lt;/groupId> &lt;artifactId>lucene-queryparser&lt;/artifactId> &lt;version>7.7.2&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>junit&lt;/groupId> &lt;artifactId>junit&lt;/artifactId> &lt;version>4.12&lt;/version> &lt;scope>test&lt;/scope> &lt;/dependency> &lt;!-- mysqlæ•°æ®åº“é©±åŠ¨ --> &lt;dependency> &lt;groupId>mysql&lt;/groupId> &lt;artifactId>mysql-connector-java&lt;/artifactId> &lt;version>5.1.48&lt;/version> &lt;/dependency> &lt;!-- IKä¸­æ–‡åˆ†è¯å™¨ --> &lt;dependency> &lt;groupId>org.wltea.ik-analyzer&lt;/groupId> &lt;artifactId>ik-analyzer&lt;/artifactId> &lt;version>8.1.0&lt;/version> &lt;/dependency> &lt;!--webèµ·æ­¥ä¾èµ–--> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-web&lt;/artifactId> &lt;/dependency> &lt;!-- å¼•å…¥thymeleaf --> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-thymeleaf&lt;/artifactId> &lt;/dependency> &lt;!-- Jsonè½¬æ¢å·¥å…· --> &lt;dependency> &lt;groupId>com.alibaba&lt;/groupId> &lt;artifactId>fastjson&lt;/artifactId> &lt;version>1.2.51&lt;/version> &lt;/dependency> &lt;/dependencies> &lt;/project> å®ä½“ç±»ï¼š @Data public class Sku { //å•†å“ä¸»é”®id private String id; //å•†å“åç§° private String name; //ä»·æ ¼ private Integer price; //åº“å­˜æ•°é‡ private Integer num; //å›¾ç‰‡ private String image; //åˆ†ç±»åç§° private String categoryName; //å“ç‰Œåç§° private String brandName; //è§„æ ¼ private String spec; //é”€é‡ private Integer saleNum; } æ–°å»ºä¸€ä¸ªDaoæ¥å£åŠå…¶å®ç°ï¼Œè¿™é‡Œä¸å±•ç¤ºä»£ç  å†™ä¸€ä¸ªæµ‹è¯•ç±»ï¼Œé€šè¿‡æµ‹è¯•æ–¹æ³•å»ºç«‹ç´¢å¼•: @Test public void createIndexTest() throws IOException { //1. é‡‡é›†æ•°æ® SkuDao skuDao = new SkuDaoImpl(); List&lt;Sku> skuList = skuDao.querySkuList(); List&lt;Document> docList = new ArrayList&lt;>(); //2. åˆ›å»ºæ–‡æ¡£å¯¹è±¡ for (Sku sku : skuList) { Document document = new Document(); //åˆ›å»ºåŸŸå¯¹è±¡ document.add(new TextField(\"id\", sku.getId(), Field.Store.YES)); document.add(new TextField(\"name\", sku.getName(), Field.Store.YES)); document.add(new TextField(\"price\", String.valueOf(sku.getPrice()), Field.Store.YES)); document.add(new TextField(\"image\", sku.getImage(), Field.Store.YES)); document.add(new TextField(\"categoryName\", sku.getCategoryName(), Field.Store.YES)); document.add(new TextField(\"brandName\", sku.getBrandName(), Field.Store.YES)); //å°†æ–‡æ¡£å¯¹è±¡æ”¾å…¥æ–‡æ¡£é›†åˆä¸­ docList.add(document); } //3. åˆ›å»ºåˆ†è¯å™¨ï¼ŒStandardAnalyzerå¯¹è‹±æ–‡åˆ†è¯æ•ˆæœå¥½ï¼Œå¯¹ä¸­æ–‡æ˜¯å•å­—åˆ†è¯ Analyzer analyzer = new StandardAnalyzer(); //4. åˆ›å»ºDirectoryç›®å½•å¯¹è±¡ï¼Œè¡¨ç¤ºç´¢å¼•åº“çš„ä½ç½® Directory dir = FSDirectory.open(Paths.get(\"D:\\\\dir\")); //5. åˆ›å»ºIndexWriterConfigå¯¹è±¡ï¼ŒæŒ‡å®šåˆ‡åˆ†è¯ä½¿ç”¨çš„åˆ†è¯å™¨ IndexWriterConfig config = new IndexWriterConfig(analyzer); //6. åˆ›å»ºIndexWriterè¾“å‡ºæµå¯¹è±¡ï¼ŒæŒ‡å®šè¾“å‡ºçš„ä½ç½®å’Œä½¿ç”¨çš„configåˆå§‹åŒ–å¯¹è±¡ IndexWriter indexWriter = new IndexWriter(dir,config); //7. å†™å…¥æ–‡æ¡£åˆ°ç´¢å¼•åº“ for (Document document : docList) { indexWriter.addDocument(document); } //8. é‡Šæ”¾èµ„æº indexWriter.close(); } è¿è¡Œå‰å…ˆå»ºç«‹å¯¹åº”çš„ç›®å½•D:\\dirï¼Œè¿è¡Œåå³å¯åœ¨ç›®å½•ä¸‹çœ‹åˆ°è®¸å¤šluceneå»ºç«‹ç´¢å¼•åç”Ÿæˆçš„å­˜å‚¨æ–‡ä»¶ 2 ä½¿ç”¨Lukeå·¥å…·æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶å†…å®¹æ‰“å¼€å·¥å…·ï¼Œé€‰æ‹©æ•°æ®æ–‡ä»¶æ‰€åœ¨çš„ç›®å½• åœ¨overviewæ ‡ç­¾é¡µå¯ä»¥çœ‹åˆ°æ¦‚è§ˆä¿¡æ¯ï¼ŒåŒ…æ‹¬åŸŸæ•°ã€æ–‡æ¡£æ•°ã€è¯æ•°ã€è¯çš„é¢‘æ•°ç»Ÿè®¡ åœ¨documentæ ‡ç­¾é¡µå¯ä»¥çœ‹åˆ°å•ä¸ªçš„æ–‡æ¡£ä¿¡æ¯ åœ¨searchæ ‡ç­¾é¡µå¯ä»¥è¿›è¡Œæœç´¢ 3 ä½¿ç”¨javaæŸ¥è¯¢æ•°æ®@Test public void testSearch() throws ParseException, IOException { //1. åˆ›å»ºåˆ†è¯å™¨ï¼ˆå¯¹æœç´¢çš„æ–‡æœ¬è¿›è¡Œåˆ†è¯ï¼‰ //æ³¨æ„ï¼›åˆ†è¯å™¨è¦å’Œåˆ›å»ºç´¢å¼•æ—¶ç”¨çš„åˆ†è¯å™¨ä¸€æ · Analyzer analyzer = new StandardAnalyzer(); //2. åˆ›å»ºæŸ¥è¯¢å¯¹è±¡ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼šé»˜è®¤æŸ¥è¯¢åŸŸ //ç¬¬äºŒä¸ªå‚æ•°ï¼šä½¿ç”¨çš„åˆ†è¯å™¨ QueryParser queryParser = new QueryParser(\"name\",analyzer); //3. è®¾ç½®æœç´¢å…³é”®è¯ Query query = queryParser.parse(\"åä¸ºæ‰‹æœº\"); //å†™æˆqueryParser.parse(\"brandName: åä¸ºæ‰‹æœº\");åˆå¯ä»¥æŒ‡å®šæŸ¥è¯¢åŸŸ //4. åˆ›å»ºDirectoryç›®å½•å¯¹è±¡ï¼ŒæŒ‡å®šç´¢å¼•åº“çš„ä½ç½® Directory dir = FSDirectory.open(Paths.get(\"D:\\\\dir\")); //5. åˆ›å»ºè¾“å…¥æµå¯¹è±¡ IndexReader indexReader = DirectoryReader.open(dir); //6. åˆ›å»ºæœç´¢å¯¹è±¡ IndexSearcher indexSearcher = new IndexSearcher(indexReader); //7. æœç´¢ï¼Œå¹¶è¿”å›ç»“æœ //ç¬¬äºŒä¸ªå‚æ•°ï¼šè¿”å›å¤šå°‘æ¡æ¶ˆæ¯ï¼Œåˆ†é¡µä½¿ç”¨ TopDocs topDocs = indexSearcher.search(query, 10); System.out.println(\"count: \"+topDocs.totalHits); //8. è·å–ç»“æœé›† ScoreDoc[] scoreDocs = topDocs.scoreDocs; //9. éå†ç»“æœé›† if(scoreDocs != null){ for (ScoreDoc scoreDoc : scoreDocs) { //è·å–æŸ¥è¯¢åˆ°çš„æ–‡æ¡£å”¯ä¸€æ ‡è¯†IDï¼Œè¿™ä¸ªIDæ˜¯ç”±luceneåˆ›å»ºæ–‡æ¡£çš„æ—¶å€™åˆ†é…çš„ int docID = scoreDoc.doc; //é€šè¿‡IDè¯»å–æ–‡æ¡£ Document doc = indexSearcher.doc(docID); System.out.println(\"============================\"); //é€šè¿‡åŸŸåï¼Œä»æ–‡æ¡£ä¸­è·å–åŸŸå€¼ System.out.println(\"id: \"+doc.get(\"id\")); System.out.println(\"name: \"+doc.get(\"name\")); System.out.println(\"price: \"+doc.get(\"price\")); System.out.println(\"image: \"+doc.get(\"image\")); System.out.println(\"brandName: \"+doc.get(\"brandName\")); System.out.println(\"categoryName: \"+doc.get(\"categoryName\")); } } //10. å…³é—­æµ indexReader.close(); } æŸ¥çœ‹è¾“å‡º:","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Lucene","slug":"Lucene","permalink":"https://www.codetool.top/tags/Lucene/"}]},{"title":"leetcode999-è½¦çš„å¯ç”¨æ•è·é‡","slug":"leetcode999-è½¦çš„å¯ç”¨æ•è·é‡","date":"2020-03-26T01:57:18.000Z","updated":"2020-03-26T01:59:16.990Z","comments":true,"path":"article/leetcode999-è½¦çš„å¯ç”¨æ•è·é‡/","link":"","permalink":"https://www.codetool.top/article/leetcode999-%E8%BD%A6%E7%9A%84%E5%8F%AF%E7%94%A8%E6%8D%95%E8%8E%B7%E9%87%8F/","excerpt":"","text":"1 åŸé¢˜999. è½¦çš„å¯ç”¨æ•è·é‡ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰ 2 è§£æ³•2.1 æ€æƒ³è¿™é“é¢˜é¢˜ç›®æœ‰ç‚¹éš¾ç†è§£ï¼Œå…¶å®å°±æ˜¯ä¸Šä¸‹å·¦å³æœç´¢ï¼Œè´¨é‡æœ‰ç‚¹ä½äº†ã€‚ 2.2 ä»£ç class Solution { char[][] boardGlobal; public int numRookCaptures(char[][] board) { boardGlobal = board; int originX,originY; originX = originY = 0; for(int i = 0;i&lt;8;i++){ for(int j = 0;j&lt;8;j++){ if(board[i][j]=='R'){ originX = i; originY = j; } } } return search(originX,originY,1,1)+search(originX,originY,1,-1)+search(originX,originY,0,1)+search(originX,originY,0,-1); } //horizalæ˜¯å¦æ°´å¹³ï¼Œspeedæ­£å‘è¿˜æ˜¯åå‘ public int search(int originX,int originY,int horizal,int speed){ while(true){ originX += (horizal*speed); originY += ((horizal==1?0:1)*speed); if(originX==-1||originX==8||originY==-1||originY==8||boardGlobal[originX][originY]=='B'){ return 0; } if(boardGlobal[originX][originY]=='p'){ return 1; } } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"Luceneä¸å€’æ’ç´¢å¼•æ¦‚è¿°","slug":"Luceneä¸å€’æ’ç´¢å¼•æ¦‚è¿°","date":"2020-03-25T16:00:36.000Z","updated":"2020-03-26T02:32:19.625Z","comments":true,"path":"article/Luceneä¸å€’æ’ç´¢å¼•æ¦‚è¿°/","link":"","permalink":"https://www.codetool.top/article/Lucene%E4%B8%8E%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95%E6%A6%82%E8%BF%B0/","excerpt":"","text":"1 æ•°æ®æŸ¥è¯¢æ³• ä¸Šå›¾å°±æ˜¯åŸå§‹æœç´¢å¼•æ“æŠ€æœ¯ï¼Œå¦‚æœç”¨æˆ·æ¯”è¾ƒå°‘è€Œä¸”æ•°æ®åº“çš„æ•°æ®é‡æ¯”è¾ƒå°ï¼Œé‚£ä¹ˆè¿™ç§æ–¹å¼å®ç°æœç´¢åŠŸèƒ½åœ¨ä¼ä¸šä¸­æ˜¯æ¯”è¾ƒå¸¸è§çš„ã€‚ ä½†æ˜¯æ•°æ®é‡è¿‡å¤šæ—¶ï¼Œæ•°æ®åº“çš„å‹åŠ›å°±ä¼šå˜å¾—å¾ˆå¤§ï¼ŒæŸ¥è¯¢é€Ÿåº¦ä¼šå˜å¾—éå¸¸æ…¢ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨æ›´å¥½çš„è§£å†³æ–¹æ¡ˆæ¥åˆ†æ‹…æ•°æ®åº“çš„å‹åŠ›ã€‚ ä¸ºäº†è§£å†³æ•°æ®åº“å‹åŠ›å’Œé€Ÿåº¦çš„é—®é¢˜ï¼Œæˆ‘ä»¬çš„æ•°æ®åº“å°±å˜æˆäº†ç´¢å¼•åº“ï¼Œæˆ‘ä»¬ä½¿ç”¨Luceneçš„APIçš„æ¥æ“ä½œæœåŠ¡å™¨ä¸Šçš„ç´¢å¼•åº“ã€‚è¿™æ ·å®Œå…¨å’Œæ•°æ®åº“è¿›è¡Œäº†éš”ç¦»ã€‚ 1.1 é¡ºåºæ‰«ææ³•æ‰€è°“é¡ºåºæ‰«æï¼Œä¾‹å¦‚è¦æ‰¾å†…å®¹åŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ–‡ä»¶ï¼Œå°±æ˜¯ä¸€ä¸ªæ–‡æ¡£ä¸€ä¸ªæ–‡æ¡£çš„çœ‹ï¼Œå¯¹äºæ¯ä¸€ä¸ªæ–‡æ¡£ï¼Œä»å¤´çœ‹åˆ°å°¾ï¼Œå¦‚æœæ­¤æ–‡æ¡£åŒ…å«æ­¤å­—ç¬¦ä¸²ï¼Œåˆ™æ­¤æ–‡æ¡£ä¸ºæˆ‘ä»¬è¦æ‰¾çš„æ–‡ä»¶ï¼Œæ¥ç€çœ‹ä¸‹ä¸€ä¸ªæ–‡ä»¶ï¼Œç›´åˆ°æ‰«æå®Œæ‰€æœ‰çš„æ–‡ä»¶ã€‚ ä¼˜ç‚¹ï¼šæŸ¥è¯¢å‡†ç¡®ç‡é«˜ ç¼ºç‚¹ï¼šæŸ¥è¯¢é€Ÿåº¦ä¼šéšç€æŸ¥è¯¢æ•°æ®é‡çš„å¢å¤§ï¼Œ è¶Šæ¥è¶Šæ…¢ ä½¿ç”¨åœºæ™¯ï¼š æ•°æ®åº“ä¸­çš„likeå…³é”®å­—æ¨¡ç³ŠæŸ¥è¯¢ æ–‡æœ¬ç¼–è¾‘å™¨çš„Ctrl + F æŸ¥è¯¢åŠŸèƒ½ 1.2 å€’æ’ç´¢å¼•å…ˆä¸¾ä¸€ä¸ªæ —å­ï¼š ä¾‹å¦‚æˆ‘ä»¬ä½¿ç”¨æ–°åå­—å…¸æŸ¥è¯¢æ±‰å­—ï¼Œæ–°åå­—å…¸æœ‰åæ—éƒ¨é¦–çš„ç›®å½•ï¼ˆç´¢å¼•ï¼‰ï¼Œæˆ‘ä»¬æŸ¥å­—é¦–å…ˆæŸ¥è¿™ä¸ªç›®å½•ï¼Œæ‰¾åˆ°è¿™ä¸ªç›®å½•ä¸­å¯¹åº”çš„åæ—éƒ¨é¦–ï¼Œå°±å¯ä»¥é€šè¿‡è¿™ä¸ªç›®å½•ä¸­çš„åæ—éƒ¨é¦–æ‰¾åˆ°è¿™ä¸ªå­—æ‰€åœ¨çš„ä½ç½®ï¼ˆæ–‡æ¡£ï¼‰ã€‚ å»ºç«‹å€’æ’ç´¢å¼•çš„æ­¥éª¤ï¼š æå–èµ„æºä¸­å…³é”®ä¿¡æ¯ï¼Œ å»ºç«‹ç´¢å¼• ï¼ˆç›®å½•ï¼‰ æœç´¢æ—¶ï¼Œæ ¹æ®å…³é”®å­—ï¼ˆç›®å½•ï¼‰ï¼Œæ‰¾åˆ°èµ„æºçš„ä½ç½®ç®—æ³•æè¿°ï¼š æŸ¥è¯¢å‰ä¼šå…ˆå°†æŸ¥è¯¢çš„å†…å®¹æå–å‡ºæ¥ç»„æˆæ–‡æ¡£(æ­£æ–‡), å¯¹æ–‡æ¡£è¿›è¡Œåˆ‡åˆ†è¯ç»„æˆç´¢å¼•(ç›®å½•), ç´¢å¼•å’Œæ–‡æ¡£æœ‰å…³è”å…³ç³», æŸ¥è¯¢çš„æ—¶å€™å…ˆæŸ¥è¯¢ç´¢å¼•, é€šè¿‡ç´¢å¼•æ‰¾æ–‡æ¡£çš„è¿™ä¸ªè¿‡ç¨‹å«åšå…¨æ–‡æ£€ç´¢ï¼ˆå€’æ’ç´¢å¼•ä¹Ÿç§°å…¨æ–‡ç´¢å¼•ï¼‰ã€‚ åˆ‡åˆ†è¯ : å°±æ˜¯å°†ä¸€å¥ä¸€å¥è¯åˆ‡åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„è¯, å»æ‰åœç”¨è¯(çš„, åœ°, å¾—, a, an, theç­‰)ã€‚å»æ‰ç©ºæ ¼, å»æ‰æ ‡ç‚¹ç¬¦å·, å¤§å†™å­—æ¯è½¬æˆå°å†™å­—æ¯, å»æ‰é‡å¤çš„è¯ã€‚ ç®€å•ä¸€å¥è¯ï¼Œä»¥å‰æ˜¯åœ¨æ–‡æ¡£ä¸­æ‰¾è¯ï¼Œå°†è¯å’Œæ–‡æ¡£è”ç³»èµ·æ¥ï¼Œå°±å¯ä»¥åœ¨è¯åº“ä¸­æ‰¾è¯ï¼Œä»è€Œæ‰¾åˆ°å¯¹åº”çš„æ–‡æ¡£ã€‚ ä¸ºä»€ä¹ˆå€’æ’ç´¢å¼•æ¯”é¡ºåºæ‰«æå¿«? ç†è§£: å› ä¸ºç´¢å¼•å¯ä»¥å»æ‰é‡å¤çš„è¯, æ±‰è¯­å¸¸ç”¨çš„å­—å’Œè¯å¤§æ¦‚ç­‰äºå­—å…¸åŠ è¯å…¸, å¸¸ç”¨çš„è‹±æ–‡åœ¨ç‰›æ´¥è¯å…¸ä¹Ÿæœ‰æ”¶å½•.å¦‚æœç”¨è®¡ç®—æœºçš„é€Ÿåº¦æŸ¥è¯¢å­—å…¸+è¯å…¸+ç‰›æ´¥è¯å…¸è¿™äº›å†…å®¹æ˜¯éå¸¸å¿«çš„ã€‚ ä½†æ˜¯ç”¨è¿™äº›å­—å…¸, è¯å…¸ç»„æˆçš„æ–‡ç« å´æ˜¯åƒåƒä¸‡ä¸‡ä¸è®¡å…¶æ•°. ç´¢å¼•çš„å¤§å°æœ€å¤šä¹Ÿå°±æ˜¯å­—å…¸+è¯å…¸. æ‰€ä»¥é€šè¿‡æŸ¥è¯¢ç´¢å¼•, å†é€šè¿‡ç´¢å¼•å’Œæ–‡æ¡£çš„å…³è”å…³ç³»æ‰¾åˆ°æ–‡æ¡£é€Ÿåº¦æ¯”è¾ƒå¿«. é¡ºåºæ‰«ææ³•åˆ™æ˜¯ç›´æ¥å»é€ä¸ªæŸ¥è¯¢é‚£äº›ä¸è®¡å…¶æ•°çš„æ–‡ç« ï¼Œå°±ç®—æ˜¯è®¡ç®—çš„é€Ÿåº¦ä¹Ÿä¼šå¾ˆæ…¢ã€‚ ä¼˜ç‚¹ï¼š æŸ¥è¯¢å‡†ç¡®ç‡é«˜ï¼ŒæŸ¥è¯¢é€Ÿåº¦å¿«ï¼Œå¹¶ä¸”ä¸ä¼šå› ä¸ºæŸ¥è¯¢å†…å®¹é‡çš„å¢åŠ è€Œä½¿æŸ¥è¯¢é€Ÿåº¦é€æ¸å˜æ…¢ ç¼ºç‚¹ï¼š ç´¢å¼•æ–‡ä»¶ä¼šå ç”¨é¢å¤–çš„ç£ç›˜ç©ºé—´ã€‚ ä½¿ç”¨åœºæ™¯ï¼š æµ·é‡æ•°æ®æŸ¥è¯¢ 2 Lucenceæ¦‚è¿°Luceneæ˜¯apacheè½¯ä»¶åŸºé‡‘ä¼šjakartaé¡¹ç›®ç»„çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„å…¨æ–‡æ£€ç´¢å¼•æ“å·¥å…·åŒ…ï¼Œä½†å®ƒä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„å…¨æ–‡æ£€ç´¢å¼•æ“ï¼Œè€Œæ˜¯ä¸€ä¸ªå…¨æ–‡æ£€ç´¢å¼•æ“çš„æ¶æ„ï¼Œæä¾›äº†å®Œæ•´çš„æŸ¥è¯¢å¼•æ“å’Œç´¢å¼•å¼•æ“ï¼Œéƒ¨åˆ†æ–‡æœ¬åˆ†æå¼•æ“ï¼ˆè‹±æ–‡ä¸å¾·æ–‡ä¸¤ç§è¥¿æ–¹è¯­è¨€ï¼‰ã€‚ Luceneçš„ç›®çš„æ˜¯ä¸ºè½¯ä»¶å¼€å‘äººå‘˜æä¾›ä¸€ä¸ªç®€å•æ˜“ç”¨çš„å·¥å…·åŒ…ï¼Œä»¥æ–¹ä¾¿çš„åœ¨ç›®æ ‡ç³»ç»Ÿä¸­å®ç°å…¨æ–‡æ£€ç´¢çš„åŠŸèƒ½ï¼Œæˆ–è€…æ˜¯ä»¥æ­¤ä¸ºåŸºç¡€å»ºç«‹èµ·å®Œæ•´çš„å…¨æ–‡æ£€ç´¢å¼•æ“ã€‚ ç›®å‰å·²ç»æœ‰å¾ˆå¤šåº”ç”¨ç¨‹åºçš„æœç´¢åŠŸèƒ½æ˜¯åŸºäº Lucene çš„ï¼Œæ¯”å¦‚ Eclipse çš„å¸®åŠ©ç³»ç»Ÿçš„æœç´¢åŠŸèƒ½ã€‚ Luceneæ˜¯ä¸€å¥—ç”¨äºå…¨æ–‡æ£€ç´¢å’Œæœå¯»çš„å¼€æºç¨‹å¼åº“ï¼Œç”±Apacheè½¯ä»¶åŸºé‡‘ä¼šæ”¯æŒå’Œæä¾› Luceneæä¾›äº†ä¸€ä¸ªç®€å•å´å¼ºå¤§çš„åº”ç”¨ç¨‹å¼æ¥å£ï¼Œèƒ½å¤Ÿåšå…¨æ–‡ç´¢å¼•å’Œæœå¯»ï¼Œ åœ¨Javaå¼€å‘ç¯å¢ƒé‡ŒLuceneæ˜¯ä¸€ä¸ªæˆç†Ÿçš„å…è´¹å¼€æ”¾æºä»£ç å·¥å…· Luceneå¹¶ä¸æ˜¯ç°æˆçš„æœç´¢å¼•æ“äº§å“ï¼Œä½†å¯ä»¥ç”¨æ¥åˆ¶ä½œæœç´¢å¼•æ“äº§å“ 2.1 å»ºç«‹ç´¢å¼•æµç¨‹å¯¹æ–‡æ¡£ç´¢å¼•çš„è¿‡ç¨‹ï¼Œå°†ç”¨æˆ·è¦æœç´¢çš„æ–‡æ¡£å†…å®¹è¿›è¡Œç´¢å¼•ï¼Œç´¢å¼•å­˜å‚¨åœ¨ç´¢å¼•åº“ï¼ˆindexï¼‰ä¸­ã€‚ 2.1.1 è·å¾—åŸå§‹å†…å®¹åŸå§‹å†…å®¹æ˜¯æŒ‡è¦ç´¢å¼•å’Œæœç´¢çš„å†…å®¹ã€‚ åŸå§‹å†…å®¹åŒ…æ‹¬äº’è”ç½‘ä¸Šçš„ç½‘é¡µã€æ•°æ®åº“ä¸­çš„æ•°æ®ã€ç£ç›˜ä¸Šçš„æ–‡ä»¶ç­‰ã€‚ 2.1.2 åˆ†ææ–‡æ¡£é¦–å…ˆå°†åŸå§‹å†…å®¹åˆ›å»ºæˆæ–‡æ¡£ï¼ˆdocumentï¼‰ï¼Œæ–‡æ¡£ä¸­åŒ…æ‹¬ä¸€ä¸ªä¸€ä¸ªçš„åŸŸï¼ˆFieldï¼‰ï¼ŒåŸŸä¸­å­˜å‚¨å†…å®¹ã€‚ æ³¨æ„ï¼šæ¯ä¸ªDocumentå¯ä»¥æœ‰å¤šä¸ªFieldï¼Œä¸åŒçš„Documentå¯ä»¥æœ‰ä¸åŒçš„Fieldï¼ŒåŒä¸€ä¸ªDocumentå¯ä»¥æœ‰ç›¸åŒçš„Fieldï¼ˆåŸŸåå’ŒåŸŸå€¼éƒ½ç›¸åŒï¼‰ å°†åŸå§‹å†…å®¹åˆ›å»ºä¸ºåŒ…å«åŸŸï¼ˆFieldï¼‰çš„æ–‡æ¡£ï¼ˆdocumentï¼‰ï¼Œéœ€è¦å†å¯¹åŸŸä¸­çš„å†…å®¹è¿›è¡Œåˆ†æï¼Œåˆ†ææˆä¸ºä¸€ä¸ªä¸€ä¸ªçš„å•è¯ã€‚ æ¯”å¦‚ä¸‹è¾¹çš„æ–‡æ¡£ç»è¿‡åˆ†æå¦‚ä¸‹ï¼šåŸæ–‡æ¡£å†…å®¹ï¼š vivo X23 8GB+128GB å¹»å¤œè“ å…¨ç½‘é€š4Gæ‰‹æœº åä¸º HUAWEI éº¦èŠ’7 6G+64G äº®é»‘è‰² å…¨ç½‘é€š4Gæ‰‹æœº åˆ†æåå¾—åˆ°çš„è¯ï¼š vivo, x23, 8GB, 128GB, å¹»å¤œ, å¹»å¤œè“, å…¨ç½‘, å…¨ç½‘é€š, ç½‘é€š, 4G, æ‰‹æœº, åä¸º, HUAWEI, éº¦èŠ’7â€¦â€¦ 2.1.3 ç´¢å¼•æ–‡æ¡£å¯¹æ‰€æœ‰æ–‡æ¡£åˆ†æå¾—å‡ºçš„è¯­æ±‡å•å…ƒè¿›è¡Œç´¢å¼•ï¼Œç´¢å¼•çš„ç›®çš„æ˜¯ä¸ºäº†æœç´¢ï¼Œ ç»ˆè¦å®ç°åªæœç´¢è¢«ç´¢å¼•çš„è¯­æ±‡å•å…ƒä»è€Œæ‰¾åˆ°Documentï¼ˆæ–‡æ¡£ï¼‰ã€‚ åˆ›å»ºç´¢å¼•æ˜¯å¯¹è¯­æ±‡å•å…ƒç´¢å¼•ï¼Œé€šè¿‡è¯è¯­æ‰¾æ–‡æ¡£ï¼Œè¿™ç§ç´¢å¼•çš„ç»“æ„å«å€’æ’ç´¢å¼•ç»“æ„ã€‚ å€’æ’ç´¢å¼•ç»“æ„æ˜¯æ ¹æ®å†…å®¹ï¼ˆè¯æ±‡ï¼‰æ‰¾æ–‡æ¡£ï¼Œå¦‚ä¸‹å›¾ï¼š å€’æ’ç´¢å¼•ç»“æ„ä¹Ÿå«åå‘ç´¢å¼•ç»“æ„ï¼ŒåŒ…æ‹¬ç´¢å¼•å’Œæ–‡æ¡£ä¸¤éƒ¨åˆ†ï¼Œç´¢å¼•å³è¯æ±‡è¡¨ï¼Œå®ƒçš„è§„æ¨¡è¾ƒå°ï¼Œè€Œæ–‡æ¡£é›†åˆè¾ƒå¤§ã€‚ æœ€åå½¢æˆçš„å­˜å‚¨ç»“æ„å³ä¸‹å›¾æ‰€ç¤ºï¼š æŸ¥è¯¢çš„æ—¶å€™ä¹Ÿä¼šå°†æŸ¥è¯¢çš„å­—ç¬¦ä¸²è¿›è¡Œåˆ‡åˆ†è¯ï¼Œç„¶åæŸ¥è¯¢ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Lucene","slug":"Lucene","permalink":"https://www.codetool.top/tags/Lucene/"}]},{"title":"åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å”¯ä¸€IDç”Ÿæˆç­–ç•¥","slug":"åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å”¯ä¸€IDç”Ÿæˆç­–ç•¥","date":"2020-03-25T11:58:21.000Z","updated":"2020-03-25T11:59:07.512Z","comments":true,"path":"article/åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å”¯ä¸€IDç”Ÿæˆç­–ç•¥/","link":"","permalink":"https://www.codetool.top/article/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E5%94%AF%E4%B8%80ID%E7%94%9F%E6%88%90%E7%AD%96%E7%95%A5/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š å¤§å‹äº’è”ç½‘å…¬å¸åˆ†å¸ƒå¼IDæ–¹æ¡ˆæ€»ç»“ - æ‚Ÿèƒ½ä¹‹èƒ½ - åšå®¢å›­ JavaæŠ€æœ¯ | ç»†è°ˆJavaä¸­UUIDçš„ç®€å•äº†è§£ä¸ä½¿ç”¨ - æ—æ·±æ—¶è§‰å¯’ - åšå®¢å›­ åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œç»å¸¸éœ€è¦å…¨å±€å”¯ä¸€çš„IDä½œä¸ºæ•°æ®åº“ä¸»é”®ã€‚åˆ†åº“åˆ†è¡¨åï¼Œæ¯ä¸ªè¡¨ä¸­çš„æ•°æ®éƒ½ä¼šæŒ‰è‡ªå·±çš„èŠ‚å¥è¿›è¡Œè‡ªå¢ï¼Œå¾ˆæœ‰å¯èƒ½å‡ºç°IDå†²çªã€‚è¿™æ—¶å°±éœ€è¦ä¸€ä¸ªå•ç‹¬çš„æœºåˆ¶æ¥è´Ÿè´£ç”Ÿæˆå”¯ä¸€IDï¼Œç”Ÿæˆå‡ºæ¥çš„IDä¹Ÿå¯ä»¥å«åšåˆ†å¸ƒå¼IDï¼Œæˆ–å…¨å±€IDã€‚ 1 UUIDUUID æ˜¯é€šç”¨å”¯ä¸€è¯†åˆ«ç ï¼ˆUniversally Unique Identifierï¼‰çš„ç¼©å†™ï¼Œå…¶ç›®çš„ï¼Œæ˜¯è®©åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œéƒ½èƒ½æœ‰å”¯ä¸€çš„è¾¨è¯†ä¿¡æ¯ï¼ŒUUIDçš„æ ‡å‡†æ ¼å¼ï¼š xxxxxxxx-xxxx-Axxx-Bxxx-xxxxxxxxxxxx å®ƒæ˜¯ç”±32ä¸ª16è¿›åˆ¶æ•°å­—æ‰€æ„æˆï¼Œç†è®ºä¸Šçš„æ€»æ•°ä¸º16^32 = 2^128ï¼Œè‹¥æ¯çº³ç§’äº§ç”Ÿ1å…†ä¸ªUUIDï¼Œè¦èŠ±100äº¿å¹´æ‰ä¼šå°†æ‰€æœ‰UUIDç”¨å®Œã€‚ Aé‚£ä¸ªä½ç½®ï¼Œä»£è¡¨ç‰ˆæœ¬å·ï¼Œç”±äºUUIDçš„æ ‡å‡†å®ç°æœ‰5ä¸ªç‰ˆæœ¬ï¼Œæ‰€ä»¥åªä¼šæ˜¯1,2,3,4,5 1: åŸºäºæ—¶é—´æˆ³ã€æœºå™¨MACåœ°å€ç”Ÿæˆã€‚ç”±äºä½¿ç”¨MACåœ°å€ï¼Œå¯ä»¥ä¿è¯å…¨çƒèŒƒå›´çš„å”¯ä¸€æ€§ã€‚ 2: åªåŸºäºæ—¶é—´æˆ³ï¼Œä¸å¸¸ç”¨ã€‚ 3: åŸºäºnamespaceå’Œä¸€ä¸ªè‡ªå®šä¹‰å­—ç¬¦ä¸²ï¼Œä¸å¸¸ç”¨ã€‚ 4: åªåŸºäºéšæœºæ•°ï¼Œæœ€å¸¸ç”¨ï¼Œä½†ä¸æ¨èï¼Œé‡å¤å‡ ç‡ä¸å¤ªèƒ½è®©äººæ¥å—ã€‚ 5: åªåŸºäºnamespaceï¼Œä¸å¸¸ç”¨ã€‚ Bé‚£ä¸ªä½ç½®ï¼Œåªä¼šæ˜¯8,9,a,b javaä¸­å¯ä»¥åœ¨java.utilåŒ…ä¸‹æ‰¾åˆ°UUIDç›¸å…³çš„å®ç°ï¼š UUID.randomUUID() å®ƒäº§ç”Ÿçš„UUIDå½¢å¼ç±»ä¼¼äºï¼š6edd24a3-a863-4f59-9231-fbe900ebbdcbã€‚å¯è§javaä½¿ç”¨çš„UUIDå®ç°æ˜¯ç‰ˆæœ¬4ï¼ŒåªåŸºäºéšæœºæ•°ï¼Œè™½ç„¶é‡å¤æ¦‚ç‡å¾ˆä½ï¼Œä½†æ²¡æœ‰å¯é çš„æªæ–½æ¥ä¿è¯ä¸é‡å¤ã€‚ UUIDé€šå¸¸ç”¨ä½œæ ‡è¯†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æŸä¸ªèµ„æºï¼Œå¦‚æœç”¨ä½œä¸»é”®ä¼šæœ‰ä»¥ä¸‹é—®é¢˜ï¼š ä¸æ˜¯æ•°å­—ç±»å‹ï¼Œå¹¶ä¸”æ•°æ®é•¿åº¦å¤§ï¼Œå ç”¨ç©ºé—´ å®Œå…¨éšæœºï¼Œæ²¡æœ‰é€’å¢è§„å¾‹ 2 æ•°æ®åº“å¤šä¸»è‡ªå¢idå¦‚æœæˆ‘ä»¬ä¸¤ä¸ªæ•°æ®åº“ç»„æˆä¸€ä¸ªä¸»ä»æ¨¡å¼é›†ç¾¤ï¼Œæ­£å¸¸æƒ…å†µä¸‹å¯ä»¥è§£å†³æ•°æ®åº“å¯é æ€§é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä¸»åº“æŒ‚æ‰åï¼Œæ•°æ®æ²¡æœ‰åŠæ—¶åŒæ­¥åˆ°ä»åº“ï¼Œè¿™ä¸ªæ—¶å€™ä¼šå‡ºç°IDé‡å¤çš„ç°è±¡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒä¸»æ¨¡å¼é›†ç¾¤ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªMysqlå®ä¾‹éƒ½èƒ½å•ç‹¬çš„ç”Ÿäº§è‡ªå¢IDï¼Œè¿™æ ·èƒ½å¤Ÿæé«˜æ•ˆç‡ï¼Œä½†æ˜¯å¦‚æœä¸ç»è¿‡å…¶ä»–æ”¹é€ çš„è¯ï¼Œè¿™ä¸¤ä¸ªMysqlå®ä¾‹å¾ˆå¯èƒ½ä¼šç”ŸæˆåŒæ ·çš„IDã€‚éœ€è¦å•ç‹¬ç»™æ¯ä¸ªMysqlå®ä¾‹é…ç½®ä¸åŒçš„èµ·å§‹å€¼å’Œè‡ªå¢æ­¥é•¿ã€‚ ç¬¬ä¸€å°Mysqlå®ä¾‹é…ç½®ï¼š set @@auto_increment_offset = 1; -- èµ·å§‹å€¼ set @@auto_increment_increment = 2; -- æ­¥é•¿ ç¬¬äºŒå°Mysqlå®ä¾‹é…ç½®ï¼š set @@auto_increment_offset = 2; -- èµ·å§‹å€¼ set @@auto_increment_increment = 2; -- æ­¥é•¿ ç»è¿‡ä¸Šé¢çš„é…ç½®åï¼Œè¿™ä¸¤ä¸ªMysqlå®ä¾‹ç”Ÿæˆçš„idåºåˆ—å¦‚ä¸‹ï¼š mysql1,èµ·å§‹å€¼ä¸º1,æ­¥é•¿ä¸º2,IDç”Ÿæˆçš„åºåˆ—ä¸ºï¼š1,3,5,7,9,... mysql2,èµ·å§‹å€¼ä¸º2,æ­¥é•¿ä¸º2,IDç”Ÿæˆçš„åºåˆ—ä¸ºï¼š2,4,6,8,10,... å¯¹äºè¿™ç§ç”Ÿæˆåˆ†å¸ƒå¼IDçš„æ–¹æ¡ˆï¼Œéœ€è¦å•ç‹¬æ–°å¢ä¸€ä¸ªç”Ÿæˆåˆ†å¸ƒå¼IDåº”ç”¨ï¼Œæ¯”å¦‚DistributIdServiceï¼Œè¯¥åº”ç”¨æä¾›ä¸€ä¸ªæ¥å£ä¾›ä¸šåŠ¡åº”ç”¨è·å–IDï¼Œä¸šåŠ¡åº”ç”¨éœ€è¦ä¸€ä¸ªIDæ—¶ï¼Œé€šè¿‡rpcçš„æ–¹å¼è¯·æ±‚DistributIdServiceï¼ŒDistributIdServiceéšæœºå»ä¸Šé¢çš„ä¸¤ä¸ªMysqlå®ä¾‹ä¸­å»è·å–IDã€‚ å®è¡Œè¿™ç§æ–¹æ¡ˆåï¼Œå°±ç®—å…¶ä¸­æŸä¸€å°Mysqlå®ä¾‹ä¸‹çº¿äº†ï¼Œä¹Ÿä¸ä¼šå½±å“DistributIdServiceï¼ŒDistributIdServiceä»ç„¶å¯ä»¥åˆ©ç”¨å¦å¤–ä¸€å°Mysqlæ¥ç”ŸæˆIDã€‚ ä½†æ˜¯è¿™ç§æ–¹æ¡ˆçš„æ‰©å±•æ€§ä¸å¤ªå¥½ï¼Œå¦‚æœä¸¤å°Mysqlå®ä¾‹ä¸å¤Ÿç”¨ï¼Œéœ€è¦æ–°å¢Mysqlå®ä¾‹æ¥æé«˜æ€§èƒ½æ—¶ï¼Œè¿™æ—¶å°±ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚ ç°åœ¨å¦‚æœè¦æ–°å¢ä¸€ä¸ªå®ä¾‹mysql3ï¼Œè¦æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿ ç¬¬ä¸€ï¼Œmysql1ã€mysql2çš„æ­¥é•¿è‚¯å®šéƒ½è¦ä¿®æ”¹ä¸º3ï¼Œè€Œä¸”åªèƒ½æ˜¯äººå·¥å»ä¿®æ”¹ï¼Œè¿™æ˜¯éœ€è¦æ—¶é—´çš„ã€‚ç¬¬äºŒï¼Œå› ä¸ºmysql1å’Œmysql2æ˜¯ä¸åœåœ¨è‡ªå¢çš„ï¼Œå¯¹äºmysql3çš„èµ·å§‹å€¼æˆ‘ä»¬å¯èƒ½è¦å®šå¾—å¤§ä¸€ç‚¹ï¼Œä»¥ç»™å……åˆ†çš„æ—¶é—´å»ä¿®æ”¹mysql1ï¼Œmysql2çš„æ­¥é•¿ã€‚ç¬¬ä¸‰ï¼Œåœ¨ä¿®æ”¹æ­¥é•¿çš„æ—¶å€™å¾ˆå¯èƒ½ä¼šå‡ºç°é‡å¤IDï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯èƒ½éœ€è¦åœæœºæ‰è¡Œã€‚ 3 Zookeeper/Redis3.1 Zookeeperä¹‹å‰åœ¨Zookeeperåº”ç”¨åœºæ™¯å’Œå„ç§åˆ†å¸ƒå¼é”çš„å®ç° ä¸­æåˆ°ï¼Œå¯ä»¥åˆ©ç”¨zookeeperæä¾›å‘½åæœåŠ¡ï¼Œå³å…¨å±€å”¯ä¸€çš„IDï¼Œå¹¶ä¸”å¯ä»¥ä¿è¯IDçš„é€’å¢æ€§ã€‚ æ— è®ºæ˜¯æ•°æ®åº“/Zookeeperï¼Œå®ç°å”¯ä¸€IDçš„åŸç†éƒ½æ˜¯æŠŠæ‰€æœ‰ ID é›†ä¸­æ”¾åœ¨ä¸€ä¸ªåœ°æ–¹è¿›è¡Œç®¡ç†ï¼Œå¯¹æ¯ä¸ª ID åºåˆ—ç‹¬ç«‹ç®¡ç†ï¼Œæ¯å°æœºå™¨ä¸Šä½¿ç”¨ ID æ—¶å°±ä»è¿™ä¸ª ID ç”Ÿæˆå™¨ä¸­å–ã€‚ä½†ä¹Ÿéƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼šæ¯æ¬¡éƒ½è¿œç¨‹å– ID ä¼šæœ‰èµ„æºæŸè€—ã€‚ä¸€ç§æ”¹è¿›æ–¹æ¡ˆæ˜¯ä¸€æ¬¡å–ä¸€æ®µ IDï¼Œç„¶åç¼“å­˜åœ¨æœ¬åœ°ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ¯æ¬¡éƒ½å»è¿œç¨‹çš„ç”Ÿæˆå™¨ä¸Šå– ID äº†ã€‚ä½†æ˜¯ä¹Ÿä¼šå¸¦æ¥é—®é¢˜ï¼Œå¦‚æœåº”ç”¨å–äº†ä¸€æ®µ IDï¼Œæ­£åœ¨ç”¨æ—¶å®Œå…¨å®•æœºäº†ï¼Œé‚£ä¹ˆä¸€äº› ID å·å°±æµªè´¹ä¸å¯ç”¨äº†ã€‚ 3.2 Redisredisäº§ç”Ÿè‡ªå¢IDå°±æ˜¯ä½¿ç”¨äº†incrå‘½ä»¤ï¼š 127.0.0.1:6379&gt; set seq_id 1 // åˆå§‹åŒ–è‡ªå¢IDä¸º1 OK 127.0.0.1:6379&gt; incr seq_id // å¢åŠ 1ï¼Œå¹¶è¿”å› (integer) 2 127.0.0.1:6379&gt; incr seq_id // å¢åŠ 1ï¼Œå¹¶è¿”å› (integer) 3ä»redisè·å–idçš„æ•ˆç‡è¾ƒé«˜ï¼Œä½†è¦è€ƒè™‘æŒä¹…åŒ–çš„é—®é¢˜ã€‚ 4 é›ªèŠ±ç®—æ³•æˆ‘ä»¬å¯ä»¥æ¢ä¸ªè§’åº¦æ¥å¯¹åˆ†å¸ƒå¼IDè¿›è¡Œæ€è€ƒï¼Œåªè¦èƒ½è®©è´Ÿè´£ç”Ÿæˆåˆ†å¸ƒå¼IDçš„æ¯å°æœºå™¨åœ¨æ¯æ¯«ç§’å†…ç”Ÿæˆä¸ä¸€æ ·çš„IDå°±è¡Œäº†ã€‚ snowflakeæ˜¯twitterå¼€æºçš„åˆ†å¸ƒå¼IDç”Ÿæˆç®—æ³•ï¼Œæ˜¯ä¸€ç§ç®—æ³•ï¼Œå¯ä»¥åœ¨æœºå™¨æœ¬åœ°ç”Ÿæˆï¼Œæ•ˆç‡å¾ˆé«˜ã€‚ æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåˆ†å¸ƒå¼IDå›ºå®šæ˜¯ä¸€ä¸ªlongå‹çš„æ•°å­—ï¼Œä¸€ä¸ªlongå‹å 8ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯64ä¸ªbitï¼ŒåŸå§‹snowflakeç®—æ³•ä¸­å¯¹äºbitçš„åˆ†é…å¦‚ä¸‹å›¾ï¼š ç¬¬ä¸€ä¸ªbitä½æ˜¯æ ‡è¯†éƒ¨åˆ†ï¼Œåœ¨javaä¸­ç”±äºlongçš„æœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œæ­£æ•°æ˜¯0ï¼Œè´Ÿæ•°æ˜¯1ï¼Œä¸€èˆ¬ç”Ÿæˆçš„IDä¸ºæ­£æ•°ï¼Œæ‰€ä»¥å›ºå®šä¸º0ã€‚ æ—¶é—´æˆ³éƒ¨åˆ†å 41bitï¼Œè¿™ä¸ªæ˜¯æ¯«ç§’çº§çš„æ—¶é—´ï¼Œä¸€èˆ¬å®ç°ä¸Šä¸ä¼šå­˜å‚¨å½“å‰çš„æ—¶é—´æˆ³ï¼Œè€Œæ˜¯æ—¶é—´æˆ³çš„å·®å€¼ï¼ˆå½“å‰æ—¶é—´-å›ºå®šçš„å¼€å§‹æ—¶é—´ï¼‰ï¼Œè¿™æ ·å¯ä»¥ä½¿äº§ç”Ÿçš„IDä»æ›´å°å€¼å¼€å§‹ï¼›41ä½çš„æ—¶é—´æˆ³å¯ä»¥ä½¿ç”¨69å¹´ï¼Œ(1L &lt;&lt; 41) / (1000L * 60 * 60 * 24 * 365) = 69å¹´ å·¥ä½œæœºå™¨idå 10bitï¼Œè¿™é‡Œæ¯”è¾ƒçµæ´»ï¼Œæ¯”å¦‚ï¼Œå¯ä»¥ä½¿ç”¨å‰5ä½ä½œä¸ºæ•°æ®ä¸­å¿ƒæœºæˆ¿æ ‡è¯†ï¼Œå5ä½ä½œä¸ºå•æœºæˆ¿æœºå™¨æ ‡è¯†ï¼Œå¯ä»¥éƒ¨ç½²1024ä¸ªèŠ‚ç‚¹ã€‚ åºåˆ—å·éƒ¨åˆ†å 12bitï¼Œæ”¯æŒåŒä¸€æ¯«ç§’å†…åŒä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥ç”Ÿæˆ4096ä¸ªID æ ¹æ®è¿™ä¸ªç®—æ³•çš„é€»è¾‘ï¼Œåªéœ€è¦å°†è¿™ä¸ªç®—æ³•ç”¨Javaè¯­è¨€å®ç°å‡ºæ¥ï¼Œå°è£…ä¸ºä¸€ä¸ªå·¥å…·æ–¹æ³•ï¼Œé‚£ä¹ˆå„ä¸ªä¸šåŠ¡åº”ç”¨å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥å·¥å…·æ–¹æ³•æ¥è·å–åˆ†å¸ƒå¼IDï¼Œåªéœ€ä¿è¯æ¯ä¸ªä¸šåŠ¡åº”ç”¨æœ‰è‡ªå·±çš„å·¥ä½œæœºå™¨idå³å¯ï¼Œè€Œä¸éœ€è¦å•ç‹¬å»æ­å»ºä¸€ä¸ªè·å–åˆ†å¸ƒå¼IDçš„åº”ç”¨ã€‚ ç”±äºå·¥ä½œæœºå™¨çš„idè¾ƒéš¾ç®¡ç†ï¼Œä¹Ÿéœ€è¦ä¸èƒ½é‡å¤ï¼Œåˆå¯ä»¥å˜æˆUUIDçš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨Zookeeper/Redisç­‰æŠ€æœ¯æ¥ç”Ÿæˆã€‚","categories":[{"name":"é¡¹ç›®/ç¼–ç¨‹ç†è®º","slug":"é¡¹ç›®-ç¼–ç¨‹ç†è®º","permalink":"https://www.codetool.top/categories/%E9%A1%B9%E7%9B%AE-%E7%BC%96%E7%A8%8B%E7%90%86%E8%AE%BA/"}],"tags":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"https://www.codetool.top/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"}]},{"title":"è§£å†³æµè§ˆå™¨çš„è·¨åŸŸé—®é¢˜-CORS","slug":"è§£å†³æµè§ˆå™¨çš„è·¨åŸŸé—®é¢˜-CORS","date":"2020-03-25T07:53:56.000Z","updated":"2020-03-25T07:56:15.720Z","comments":true,"path":"article/è§£å†³æµè§ˆå™¨çš„è·¨åŸŸé—®é¢˜-CORS/","link":"","permalink":"https://www.codetool.top/article/%E8%A7%A3%E5%86%B3%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98-CORS/","excerpt":"","text":"ä¸ºäº†é˜²æ­¢XSSæ”»å‡»ã€CSRFæ”»å‡»ç­‰è·¨åŸŸè„šæœ¬è°ƒç”¨é—®é¢˜ï¼Œæµè§ˆå™¨é€šå¸¸å…·æœ‰åŒæºç­–ç•¥ï¼ŒåŒæºæ„å‘³ç€ï¼š åè®®ç›¸åŒ åŸŸåç›¸åŒ ç«¯å£ç›¸åŒ è€ŒåŒæºç­–ç•¥é™åˆ¶äº†ï¼š ä¸èƒ½å‘å·¥ä½œåœ¨ä¸åŒæºçš„çš„æœåŠ¡è¯·æ±‚æ•°æ®ï¼ˆclient to serverï¼‰ã€‚ æ— æ³•è·å–ä¸åŒæºçš„ document/cookie ç­‰ BOM å’Œ DOMï¼Œå¯ä»¥è¯´ä»»ä½•æœ‰å…³å¦å¤–ä¸€ä¸ªæºçš„ä¿¡æ¯éƒ½æ— æ³•å¾—åˆ° ï¼ˆclient to clientï¼‰ã€‚ å­˜åœ¨ä¾‹å¤–æƒ…å†µï¼ˆscrpit,imgç­‰æ ‡ç­¾ï¼‰ 1 CORSæ¦‚è¿°è¾ƒæ—©è¾ƒä¸»æµè§£å†³è·¨åŸŸé—®é¢˜çš„æ–¹æ³•æ˜¯JSONPï¼Œå®ƒåˆ©ç”¨çš„å°±æ˜¯script-srcä¸ä¼šæœ‰è·¨åŸŸé—®é¢˜ï¼Œå°†å›è°ƒå‡½æ•°åä¼ ç»™åç«¯ï¼Œè®©åç«¯æŠŠåŒ…è£¹ç€å“åº”æ•°æ®çš„å›è°ƒå‡½æ•°ï¼ˆä¸€æ¡jsè¯­å¥ï¼‰ä¼ å›æ¥ï¼Œå®ç°åŠ¨æ€å›è°ƒçš„æ•ˆæœã€‚ JSONPçš„é™åˆ¶æ˜¯ï¼ŒæœåŠ¡ç«¯é¦–å…ˆè¦æ”¯æŒï¼Œå³èƒ½æ¥å—å®¢æˆ·ç«¯ä¼ æ¥çš„å›è°ƒå‡½æ•°åï¼Œå¹¶ä¸”JSONPåªèƒ½å‘èµ·GETè¯·æ±‚ã€‚ CORSæ˜¯ä¸€ç§è§„èŒƒåŒ–çš„è·¨åŸŸè¯·æ±‚è§£å†³æ–¹æ¡ˆï¼Œå®‰å…¨å¯é ï¼Œæ˜¯ç›®å‰çš„ä¸»æµè·¨åŸŸæ–¹æ¡ˆã€‚ åªè¦æµè§ˆå™¨æ£€æµ‹åˆ°å“åº”å¤´å¸¦ä¸Šäº† CORSï¼Œå¹¶ä¸”å…è®¸çš„æºåŒ…æ‹¬äº†æœ¬ç½‘ç«™ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæ‹¦æˆªè¯·æ±‚å“åº”ã€‚ CORS æŠŠè¯·æ±‚åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯ç®€å•è¯·æ±‚ï¼Œå¦ä¸€ç§æ˜¯éœ€è¦è§¦å‘é¢„æ£€è¯·æ±‚ï¼Œè¿™ä¸¤è€…æ˜¯ç›¸å¯¹çš„ï¼Œæ€æ ·æ‰ç®—â€œä¸ç®€å•â€ï¼Ÿåªè¦å±äºä¸‹é¢çš„å…¶ä¸­ä¸€ç§å°±ä¸æ˜¯ç®€å•è¯·æ±‚ï¼š ä½¿ç”¨äº†é™¤ GET/POST/HEAD ä¹‹å¤–çš„è¯·æ±‚æ–¹å¼ï¼Œå¦‚ PUT/DELETE ä½¿ç”¨äº†é™¤ Content-Type/Accept ç­‰å‡ ä¸ªå¸¸ç”¨çš„ http å¤´è¿™ä¸ªæ—¶å€™å°±è®¤ä¸ºéœ€è¦å…ˆå‘ä¸ªé¢„æ£€è¯·æ±‚ 2 ç®€å•è¯·æ±‚å¯¹äºç®€å•è¯·æ±‚ï¼Œæµè§ˆå™¨ç›´æ¥å‘å‡º CORS è¯·æ±‚ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åœ¨è¯·æ±‚å¤´ä¹‹ä¸­ï¼Œå¢åŠ ä¸€ä¸ª Originå­—æ®µã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œæµè§ˆå™¨å‘ç°è¿™æ¬¡è·¨æº AJAX è¯·æ±‚æ˜¯ç®€å•è¯·æ±‚ï¼Œå°±è‡ªåŠ¨åœ¨å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œæ·»åŠ ä¸€ä¸ª Origin å­—æ®µã€‚ GET /cors HTTP/1.1 Origin: http://api.bob.com Host: api.alice.com Accept-Language: en-US Connection: keep-alive User-Agent: Mozilla/5.0...ä¸Šé¢çš„å¤´ä¿¡æ¯ä¸­ï¼ŒOrigin å­—æ®µç”¨æ¥è¯´æ˜ï¼Œæœ¬æ¬¡è¯·æ±‚æ¥è‡ªå“ªä¸ªæºï¼ˆåè®® + åŸŸå + ç«¯å£ï¼‰ã€‚æœåŠ¡å™¨æ ¹æ®è¿™ä¸ªå€¼ï¼Œå†³å®šæ˜¯å¦åŒæ„è¿™æ¬¡è¯·æ±‚ã€‚ å¦‚æœ Origin æŒ‡å®šçš„æºï¼Œä¸åœ¨è®¸å¯èŒƒå›´å†…ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªæ­£å¸¸çš„ HTTP å›åº”ã€‚æµè§ˆå™¨å‘ç°ï¼Œè¿™ä¸ªå›åº”çš„å¤´ä¿¡æ¯æ²¡æœ‰åŒ…å« Access-Control-Allow-Origin å­—æ®µï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰ï¼Œå°±çŸ¥é“å‡ºé”™äº†ï¼Œä»è€ŒæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè¢« XMLHttpRequest çš„ onerror å›è°ƒå‡½æ•°æ•è·ã€‚æ³¨æ„ï¼Œè¿™ç§é”™è¯¯æ— æ³•é€šè¿‡çŠ¶æ€ç è¯†åˆ«ï¼Œå› ä¸º HTTP å›åº”çš„çŠ¶æ€ç æœ‰å¯èƒ½æ˜¯ 200ã€‚ å¦‚æœ Origin æŒ‡å®šçš„åŸŸååœ¨è®¸å¯èŒƒå›´å†…ï¼ŒæœåŠ¡å™¨è¿”å›çš„å“åº”ï¼Œä¼šå¤šå‡ºå‡ ä¸ªå¤´ä¿¡æ¯å­—æ®µã€‚ Access-Control-Allow-Origin: http://api.bob.com Access-Control-Allow-Credentials: true Access-Control-Expose-Headers: FooBar Content-Type: text/html; charset=utf-8ä¸Šé¢çš„å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œæœ‰ä¸‰ä¸ªä¸ CORS è¯·æ±‚ç›¸å…³çš„å­—æ®µï¼Œéƒ½ä»¥ Access-Control-å¼€å¤´ã€‚ Access-Control-Allow-Originè¯¥å­—æ®µæ˜¯å¿…é¡»çš„ã€‚å®ƒçš„å€¼è¦ä¹ˆæ˜¯è¯·æ±‚æ—¶ Origin å­—æ®µçš„å€¼ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ª*ï¼Œè¡¨ç¤ºæ¥å—ä»»æ„åŸŸåçš„è¯·æ±‚ã€‚ Access-Control-Allow-Credentialsè¯¥å­—æ®µå¯é€‰ã€‚å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å…è®¸å‘é€ Cookieã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCookie ä¸åŒ…æ‹¬åœ¨ CORS è¯·æ±‚ä¹‹ä¸­ã€‚è®¾ä¸º trueï¼Œå³è¡¨ç¤ºæœåŠ¡å™¨æ˜ç¡®è®¸å¯ï¼ŒCookie å¯ä»¥åŒ…å«åœ¨è¯·æ±‚ä¸­ï¼Œä¸€èµ·å‘ç»™æœåŠ¡å™¨ã€‚è¿™ä¸ªå€¼ä¹Ÿåªèƒ½è®¾ä¸º trueï¼Œå¦‚æœæœåŠ¡å™¨ä¸è¦æµè§ˆå™¨å‘é€ Cookieï¼Œåˆ é™¤è¯¥å­—æ®µå³å¯ã€‚ Access-Control-Expose-Headersè¯¥å­—æ®µå¯é€‰ã€‚CORS è¯·æ±‚æ—¶ï¼ŒXMLHttpRequest å¯¹è±¡çš„ getResponseHeader()æ–¹æ³•åªèƒ½æ‹¿åˆ° 6ä¸ªåŸºæœ¬å­—æ®µï¼šCache-Controlã€Content-Languageã€Content-Typeã€Expiresã€Last-Modifiedã€Pragmaã€‚å¦‚æœæƒ³æ‹¿åˆ°å…¶ä»–å­—æ®µï¼Œå°±å¿…é¡»åœ¨ Access-Control-Expose-Headers é‡Œé¢æŒ‡å®šã€‚ä¸Šé¢çš„ä¾‹å­æŒ‡å®šï¼ŒgetResponseHeader(â€˜FooBarâ€™) å¯ä»¥è¿”å› FooBar å­—æ®µçš„å€¼ã€‚ 3 éç®€å•è¯·æ±‚ç®€å•è¯·æ±‚æ˜¯é‚£ç§å¯¹æœåŠ¡å™¨æœ‰ç‰¹æ®Šè¦æ±‚çš„è¯·æ±‚ï¼Œæ¯”å¦‚è¯·æ±‚æ–¹æ³•æ˜¯ PUT æˆ– DELETEï¼Œæˆ–è€…Content-Type å­—æ®µçš„ç±»å‹æ˜¯ application/jsonã€‚ éç®€å•è¯·æ±‚çš„ CORS è¯·æ±‚ï¼Œä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢åŠ ä¸€æ¬¡ HTTP æŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¸ºâ€œé¢„æ£€â€è¯·æ±‚ï¼ˆpreflightï¼‰ã€‚ æµè§ˆå™¨å…ˆè¯¢é—®æœåŠ¡å™¨ï¼Œå½“å‰ç½‘é¡µæ‰€åœ¨çš„åŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•ä¹‹ä¸­ï¼Œä»¥åŠå¯ä»¥ä½¿ç”¨å“ªäº› HTTP åŠ¨è¯å’Œå¤´ä¿¡æ¯å­—æ®µã€‚åªæœ‰å¾—åˆ°è‚¯å®šç­”å¤ï¼Œæµè§ˆå™¨æ‰ä¼šå‘å‡ºæ­£å¼ XMLHttpRequest è¯·æ±‚ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚ â€œé¢„æ£€â€è¯·æ±‚ç”¨çš„è¯·æ±‚æ–¹æ³•æ˜¯ OPTIONSï¼Œè¡¨ç¤ºè¿™ä¸ªè¯·æ±‚æ˜¯ç”¨æ¥è¯¢é—®çš„ã€‚å¤´ä¿¡æ¯é‡Œé¢ï¼Œå…³é”®å­—æ®µæ˜¯ Originï¼Œè¡¨ç¤ºè¯·æ±‚æ¥è‡ªå“ªä¸ªæºã€‚ é™¤äº† Origin å­—æ®µï¼Œâ€é¢„æ£€â€è¯·æ±‚çš„å¤´ä¿¡æ¯åŒ…æ‹¬ä¸¤ä¸ªç‰¹æ®Šå­—æ®µã€‚ Access-Control-Request-Method è¯¥å­—æ®µæ˜¯å¿…é¡»çš„ï¼Œç”¨æ¥åˆ—å‡ºæµè§ˆå™¨çš„ CORS è¯·æ±‚ä¼šç”¨åˆ°å“ªäº› HTTP æ–¹æ³• Access-Control-Request-Headers è¯¥å­—æ®µæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šæµè§ˆå™¨ CORS è¯·æ±‚ä¼šé¢å¤–å‘é€çš„å¤´ä¿¡æ¯å­—æ®µ æœåŠ¡å™¨æ”¶åˆ°â€é¢„æ£€â€è¯·æ±‚ä»¥åï¼Œæ£€æŸ¥äº†Origin ã€Access-Control-Request-Method å’ŒAccess-Control-Request-Headers å­—æ®µä»¥åï¼Œç¡®è®¤å…è®¸è·¨æºè¯·æ±‚ï¼Œå°±å¯ä»¥åšå‡ºå›åº”ã€‚å¦‚æœæµè§ˆå™¨å¦å®šäº†â€é¢„æ£€â€è¯·æ±‚ï¼Œä¼šè¿”å›ä¸€ä¸ªæ­£å¸¸çš„ HTTP å›åº”ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½• CORS ç›¸å…³çš„å¤´ä¿¡æ¯å­—æ®µã€‚è¿™æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šè®¤å®šï¼ŒæœåŠ¡å™¨ä¸åŒæ„é¢„æ£€è¯·æ±‚ï¼Œå› æ­¤è§¦å‘ä¸€ä¸ªé”™è¯¯ï¼Œè¢«XMLHttpRequest å¯¹è±¡çš„ onerror å›è°ƒå‡½æ•°æ•è·ã€‚ ä¸€æ—¦æœåŠ¡å™¨é€šè¿‡äº†â€é¢„æ£€â€è¯·æ±‚ï¼Œä»¥åæ¯æ¬¡æµè§ˆå™¨æ­£å¸¸çš„ CORS è¯·æ±‚ï¼Œå°±éƒ½è·Ÿç®€å•è¯·æ±‚ä¸€æ ·ï¼Œä¼šæœ‰ä¸€ä¸ª Origin å¤´ä¿¡æ¯å­—æ®µã€‚æœåŠ¡å™¨çš„å›åº”ï¼Œä¹Ÿéƒ½ä¼šæœ‰ä¸€ä¸ª Access-Control-Allow-Origin å¤´ä¿¡æ¯å­—æ®µã€‚","categories":[{"name":"é¡¹ç›®/ç¼–ç¨‹ç†è®º","slug":"é¡¹ç›®-ç¼–ç¨‹ç†è®º","permalink":"https://www.codetool.top/categories/%E9%A1%B9%E7%9B%AE-%E7%BC%96%E7%A8%8B%E7%90%86%E8%AE%BA/"}],"tags":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://www.codetool.top/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}]},{"title":"Httpè¯·æ±‚çš„å¹‚ç­‰æ€§","slug":"Httpè¯·æ±‚çš„å¹‚ç­‰æ€§","date":"2020-03-25T04:50:46.000Z","updated":"2020-04-15T06:09:48.426Z","comments":true,"path":"article/Httpè¯·æ±‚çš„å¹‚ç­‰æ€§/","link":"","permalink":"https://www.codetool.top/article/Http%E8%AF%B7%E6%B1%82%E7%9A%84%E5%B9%82%E7%AD%89%E6%80%A7/","excerpt":"","text":"å¯¹ HTTP åè®®çš„ä½¿ç”¨å®é™…ä¸Šå­˜åœ¨ç€ä¸¤ç§ä¸åŒçš„æ–¹å¼ï¼šä¸€ç§æ˜¯ RESTful çš„ï¼Œå®ƒæŠŠ HTTP å½“æˆåº”ç”¨å±‚åè®®ï¼Œæ¯”è¾ƒå¿ å®åœ°éµå®ˆäº† HTTP åè®®çš„å„ç§è§„å®šï¼›å¦ä¸€ç§æ˜¯ SOA çš„ï¼Œå®ƒå¹¶æ²¡æœ‰å®Œå…¨æŠŠHTTP å½“æˆåº”ç”¨å±‚åè®®ï¼Œè€Œæ˜¯æŠŠ HTTP åè®®ä½œä¸ºäº†ä¼ è¾“å±‚åè®®ï¼Œç„¶ååœ¨ HTTP ä¹‹ä¸Šå»ºç«‹äº†è‡ªå·±çš„åº”ç”¨å±‚åè®®ã€‚è¿™é‡Œæ‰€è®¨è®ºçš„ HTTP å¹‚ç­‰æ€§ä¸»è¦é’ˆå¯¹ RESTful é£æ ¼çš„ï¼Œä½†å¹‚ç­‰æ€§å¹¶ä¸å±äºç‰¹å®šçš„åè®®ï¼Œå®ƒæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€ç§ç‰¹æ€§ï¼›æ‰€ä»¥ï¼Œä¸è®ºæ˜¯ SOA è¿˜æ˜¯ RESTful çš„ Web API è®¾è®¡éƒ½åº”è¯¥è€ƒè™‘å¹‚ç­‰æ€§ã€‚ä¸‹é¢å°†ä»‹ç» HTTP GETã€DELETEã€PUTã€POST å››ç§ä¸»è¦æ–¹æ³•çš„è¯­ä¹‰å’Œå¹‚ç­‰æ€§ã€‚ 1 GETHTTP GET æ–¹æ³•ç”¨äºè·å–èµ„æºï¼Œä¸åº”æœ‰å‰¯ä½œç”¨ï¼Œæ‰€ä»¥æ˜¯å¹‚ç­‰çš„ã€‚ æ¯”å¦‚ï¼šGET http://www.bank.com/account/123456ï¼Œä¸ä¼šæ”¹å˜èµ„æºçš„çŠ¶æ€ï¼Œä¸è®ºè°ƒç”¨ä¸€æ¬¡è¿˜æ˜¯ N æ¬¡éƒ½æ²¡æœ‰å‰¯ä½œç”¨ã€‚è¯·æ³¨æ„ï¼Œè¿™é‡Œå¼ºè°ƒçš„æ˜¯ä¸€æ¬¡å’Œ N æ¬¡å…·æœ‰ç›¸åŒçš„å‰¯ä½œç”¨ï¼Œè€Œä¸æ˜¯æ¯æ¬¡GET çš„ç»“æœç›¸åŒã€‚ GET http://www.news.com/latest-news è¿™ä¸ª HTTP è¯·æ±‚å¯èƒ½ä¼šæ¯æ¬¡å¾—åˆ°ä¸åŒçš„ç»“æœï¼Œä½†å®ƒæœ¬èº«å¹¶æ²¡æœ‰äº§ç”Ÿä»»ä½•å‰¯ä½œç”¨ï¼Œå› è€Œæ˜¯æ»¡è¶³å¹‚ç­‰æ€§çš„ã€‚ 2 DELETEHTTP DELETE æ–¹æ³•ç”¨äºåˆ é™¤èµ„æºï¼Œæœ‰å‰¯ä½œç”¨ï¼Œä½†å®ƒåº”è¯¥æ»¡è¶³å¹‚ç­‰æ€§ã€‚ æ¯”å¦‚ï¼šDELETE http://www.forum.com/article/4231 ï¼Œè°ƒç”¨ä¸€æ¬¡å’Œ N æ¬¡å¯¹ç³»ç»Ÿäº§ç”Ÿçš„å‰¯ä½œç”¨æ˜¯ç›¸åŒçš„ï¼ˆé‡å¤åˆ é™¤ä¹Ÿä¸ä¼šå¼•èµ·é”™è¯¯ï¼‰ï¼Œå³åˆ æ‰ id ä¸º 4231 çš„å¸–å­ï¼›å› æ­¤ï¼Œè°ƒç”¨è€…å¯ä»¥å¤šæ¬¡è°ƒç”¨æˆ–åˆ·æ–°é¡µé¢è€Œä¸å¿…æ‹…å¿ƒå¼•èµ·é”™è¯¯ã€‚ 3 POST &amp; PUTæ¯”è¾ƒå®¹æ˜“æ··æ·†çš„æ˜¯ HTTP POST å’Œ PUTã€‚POST å’Œ PUT çš„åŒºåˆ«å®¹æ˜“è¢«ç®€å•åœ°è¯¯è®¤ä¸ºâ€œPOST è¡¨ç¤ºåˆ›å»ºèµ„æºï¼ŒPUT è¡¨ç¤ºæ›´æ–°èµ„æºâ€ï¼›è€Œå®é™…ä¸Šï¼ŒäºŒè€…å‡å¯ç”¨äºåˆ›å»ºèµ„æºï¼Œæ›´ä¸ºæœ¬è´¨çš„å·®åˆ«æ˜¯åœ¨å¹‚ç­‰æ€§æ–¹é¢ã€‚åœ¨ HTTP è§„èŒƒä¸­å¯¹ POST å’Œ PUT æ˜¯è¿™æ ·å®šä¹‰çš„ï¼šPOST æ‰€å¯¹åº”çš„ URI å¹¶éåˆ›å»ºçš„èµ„æºæœ¬èº«ï¼Œè€Œæ˜¯èµ„æºçš„æ¥æ”¶è€…ã€‚æ¯”å¦‚ï¼šPOST http://www.forum.com/articles çš„è¯­ä¹‰æ˜¯åœ¨ http://www.forum.com/articles ä¸‹åˆ›å»ºä¸€ç¯‡å¸–å­ï¼ŒHTTP å“åº”ä¸­åº”åŒ…å«å¸–å­çš„åˆ›å»ºçŠ¶æ€ä»¥åŠå¸–å­çš„ URIã€‚ä¸¤æ¬¡ç›¸åŒçš„ POST è¯·æ±‚ä¼šåœ¨æœåŠ¡å™¨ç«¯åˆ›å»ºä¸¤ä»½èµ„æºï¼Œå®ƒä»¬å…·æœ‰ä¸åŒçš„ URIï¼›æ‰€ä»¥ï¼ŒPOST æ–¹æ³•ä¸å…·å¤‡å¹‚ç­‰æ€§ã€‚è€Œ PUT æ‰€å¯¹åº”çš„ URI æ˜¯è¦åˆ›å»ºæˆ–æ›´æ–°çš„èµ„æºæœ¬èº«ã€‚æ¯”å¦‚ï¼šPUT http://www.forum/articles/4231 çš„è¯­ä¹‰æ˜¯åˆ›å»ºæˆ–æ›´æ–° ID ä¸º 4231 çš„å¸–å­ã€‚å¯¹åŒä¸€ URI è¿›è¡Œå¤šæ¬¡ PUT çš„å‰¯ä½œç”¨å’Œä¸€æ¬¡ PUT æ˜¯ç›¸åŒçš„ï¼›å› æ­¤ï¼ŒPUT æ–¹æ³•å…·æœ‰å¹‚ç­‰æ€§ã€‚","categories":[{"name":"é¡¹ç›®/ç¼–ç¨‹ç†è®º","slug":"é¡¹ç›®-ç¼–ç¨‹ç†è®º","permalink":"https://www.codetool.top/categories/%E9%A1%B9%E7%9B%AE-%E7%BC%96%E7%A8%8B%E7%90%86%E8%AE%BA/"}],"tags":[{"name":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","permalink":"https://www.codetool.top/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"},{"name":"HTTP","slug":"HTTP","permalink":"https://www.codetool.top/tags/HTTP/"}]},{"title":"æ•°æ®åº“æŠ€æœ¯ä¹‹åˆ†åº“åˆ†è¡¨","slug":"æ•°æ®åº“æŠ€æœ¯ä¹‹åˆ†åº“åˆ†è¡¨","date":"2020-03-25T02:49:39.000Z","updated":"2020-03-25T02:52:55.129Z","comments":true,"path":"article/æ•°æ®åº“æŠ€æœ¯ä¹‹åˆ†åº“åˆ†è¡¨/","link":"","permalink":"https://www.codetool.top/article/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8A%80%E6%9C%AF%E4%B9%8B%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8/","excerpt":"","text":"æ¨èé˜…è¯»ï¼š MySQLä¹‹åˆ†åŒºè¡¨ä»‹ç» åŒºåˆ«äºåˆ†åŒºçš„æ˜¯ï¼Œåˆ†åŒºä¸€èˆ¬éƒ½æ˜¯æ”¾åœ¨å•æœºé‡Œçš„ï¼Œç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯æ—¶é—´èŒƒå›´åˆ†åŒºï¼Œæ–¹ä¾¿å½’æ¡£ã€‚åªä¸è¿‡åˆ†åº“åˆ†è¡¨éœ€è¦ä»£ç å®ç°ï¼Œåˆ†åŒºåˆ™æ˜¯mysqlå†…éƒ¨å®ç°ã€‚åˆ†åº“åˆ†è¡¨å’Œåˆ†åŒºå¹¶ä¸å†²çªï¼Œå¯ä»¥ç»“åˆä½¿ç”¨ã€‚ 1 åˆ†åº“éœ€è¦åˆ†åº“çš„æƒ…å½¢ï¼š éšç€å•åº“ä¸­çš„æ•°æ®é‡è¶Šæ¥è¶Šå¤§ï¼Œç›¸åº”çš„ï¼ŒæŸ¥è¯¢æ‰€éœ€è¦çš„æ—¶é—´ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæ•°æ®çš„å¤„ç†æ•ˆç‡é‡åˆ°äº†ç“¶é¢ˆ å•åº“å‘ç”Ÿæ„å¤–çš„æ—¶å€™ï¼Œéœ€è¦ä¿®å¤çš„æ˜¯æ‰€æœ‰çš„æ•°æ®ï¼Œè€Œå¤šåº“ä¸­çš„ä¸€ä¸ªåº“å‘ç”Ÿæ„å¤–çš„æ—¶å€™ï¼Œåªéœ€è¦ä¿®å¤ä¸€ä¸ªåº“ï¼ˆå½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç”¨ç‰©ç†åˆ†åŒºçš„æ–¹å¼å¤„ç†è¿™ç§é—®é¢˜ï¼‰ é€šå¸¸ï¼Œåœ¨è¯»å†™åˆ†ç¦»ä¹‹åï¼Œæ•°æ®åº“çš„æ€§èƒ½å†æ¬¡é‡åˆ°ç“¶é¢ˆï¼Œå°±è€ƒè™‘åˆ†åº“ã€‚ æˆ‘ä»¬é€šå¸¸ç§°åˆ†åº“ä¸ºå‚ç›´çš„ï¼Œå› ä¸ºå®ƒç›¸å¯¹æ°´å¹³åˆ†è¡¨ã€å‚ç›´åˆ†è¡¨çš„æ¦‚å¿µæ¥è¯´æ˜¯å‚ç›´çš„ï¼Œå³æŒ‰ä¸šåŠ¡åˆ’åˆ†ï¼Œé€šå¸¸æ˜¯å°†åº“ä¸­çš„è¡¨æŒ‰ç…§åŠŸèƒ½æ¨¡å—ã€å…³ç³»å¯†åˆ‡ç¨‹åº¦åˆ’åˆ†å‡ºæ¥ï¼Œéƒ¨ç½²åˆ°ä¸åŒåº“ä¸Šã€‚ æ¯”å¦‚ç”¨æˆ·ä¸€ä¸ªåº“,å•†å“ä¸€ä¸ªåº“,è®¢å•ä¸€ä¸ªåº“ã€‚ ä¸€ä¸ªè´­ç‰©ç½‘ç«™å¯¹å¤–æä¾›æœåŠ¡æ—¶,ä¼šåŒæ—¶å¯¹ç”¨æˆ·ã€å•†å“ã€è®¢å•è¡¨è¿›è¡Œæ“ä½œã€‚æ²¡æ‹†åˆ†ä¹‹å‰, å…¨éƒ¨éƒ½æ˜¯è½åˆ°å•ä¸€çš„åº“ä¸Šçš„,è¿™ä¼šè®©æ•°æ®åº“çš„å•åº“å¤„ç†èƒ½åŠ›æˆä¸ºç“¶é¢ˆã€‚å¦‚æœå‚ç›´åˆ†åº“åè¿˜æ˜¯å°†ç”¨æˆ·ã€å•†å“ã€è®¢å•æ”¾åˆ°åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Š,åªæ˜¯åˆ†åˆ°äº†ä¸åŒçš„åº“,è¿™æ ·è™½ç„¶ä¼šå‡å°‘å•åº“çš„å‹åŠ›,ä½†æ˜¯éšç€ç”¨æˆ·é‡å¢å¤§,è¿™ä¼šè®©æ•´ä¸ªæ•°æ®åº“çš„å¤„ç†èƒ½åŠ›æˆä¸ºç“¶é¢ˆ,è¿˜æœ‰å•ä¸ªæœåŠ¡å™¨çš„ç£ç›˜ç©ºé—´ã€å†…å­˜ä¹Ÿä¼šå—éå¸¸å¤§çš„å½±å“ã€‚ æ‰€ä»¥æˆ‘ä»¬è¦å°†å…¶æ‹†åˆ†åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·ä¸Šé¢çš„é—®é¢˜éƒ½è§£å†³äº†ï¼Œä»¥åä¹Ÿä¸ä¼šé¢å¯¹å•æœºèµ„æºé—®é¢˜ã€‚ 2 åˆ†è¡¨åˆ†è¡¨åˆ†ä¸ºæ°´å¹³åˆ†è¡¨å’Œå‚ç›´åˆ†è¡¨ï¼Œå’Œæˆ‘ä»¬ä¹‹å‰ä»‹ç»çš„æ°´å¹³åˆ†åŒºå’Œå‚ç›´åˆ†åŒºçš„æ¦‚å¿µç±»ä¼¼ï¼Œmysqlä¸æ”¯æŒå‚ç›´åˆ†åŒºï¼Œä½†æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å‚ç›´åˆ†è¡¨ï¼Œæ›´å¯èƒ½æ˜¯å€ŸåŠ©æ•°æ®åº“ä¸­é—´ä»¶è¿›è¡Œåˆ†åº“åˆ†è¡¨ã€‚ å‚ç›´åˆ†è¡¨è§£å†³çš„æ˜¯ä¸€äº›éçƒ­ç‚¹å­—æ®µå½±å“æŸ¥è¯¢æ€§èƒ½çš„é—®é¢˜ï¼Œé€šå¸¸å°†çƒ­ç‚¹å­—æ®µå’Œéçƒ­ç‚¹å­—æ®µåˆ’åˆ†å¼€ã€‚è€Œæ°´å¹³åˆ†è¡¨è§£å†³çš„æ˜¯å•è¡¨æ•°æ®é‡ï¼ˆè¡Œæ•°ï¼‰å¤§çš„é—®é¢˜ã€‚æ°´å¹³åˆ†è¡¨çš„æ–¹æ³•å’Œæˆ‘ä»¬ä¸Šæ¬¡ä»‹ç»çš„æ°´å¹³åˆ†åŒºçš„æ–¹æ³•å¾ˆç›¸ä¼¼ï¼Œå¯ä»¥é€šè¿‡rangeã€listã€hashç­‰æ–¹æ³•åˆ†è¡¨ã€‚ æ°´å¹³åˆ†è¡¨å’Œå‚ç›´åˆ†è¡¨å¯ä»¥ç»“åˆä½¿ç”¨ï¼Œåˆ†è¡¨é…åˆåˆ†åº“ä½¿ç”¨è¿˜å¯ä»¥å°†è¡¨åˆ†åˆ°ä¸åŒçš„æ•°æ®åº“ä¸­ã€‚ï¼ˆæˆ‘ä»¬ç§°ä½œåˆ†åº“åˆ†è¡¨ï¼‰ 3 å¸¸ç”¨çš„åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶ç®€å•æ˜“ç”¨çš„ç»„ä»¶ï¼š å½“å½“sharding-jdbc è˜‘è‡è¡—TSharding å¼ºæ‚é‡é‡çº§çš„ä¸­é—´ä»¶ï¼š sharding TDDL Smart Clientçš„æ–¹å¼ï¼ˆæ·˜å®ï¼‰ Atlas(Qihoo 360) alibaba.cobar(æ˜¯é˜¿é‡Œå·´å·´ï¼ˆB2Bï¼‰éƒ¨é—¨å¼€å‘) MyCATï¼ˆåŸºäºé˜¿é‡Œå¼€æºçš„Cobaräº§å“è€Œç ”å‘ï¼‰ Oceanus(58åŒåŸæ•°æ®åº“ä¸­é—´ä»¶) OneProxy(æ”¯ä»˜å®é¦–å¸­æ¶æ„å¸ˆæ¥¼æ–¹é‘«å¼€å‘) vitessï¼ˆè°·æ­Œå¼€å‘çš„æ•°æ®åº“ä¸­é—´ä»¶ï¼‰ 4 åˆ†åº“åˆ†è¡¨å¼•èµ·çš„é—®é¢˜ åˆ†å¸ƒå¼äº‹åŠ¡çš„é—®é¢˜ï¼Œæ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§é—®é¢˜ã€‚ æ•°æ®æ“ä½œç»´åº¦é—®é¢˜ï¼šç”¨æˆ·ã€äº¤æ˜“ã€è®¢å•å„ä¸ªä¸åŒçš„ç»´åº¦ï¼Œç”¨æˆ·æŸ¥è¯¢ç»´åº¦ã€äº§å“æ•°æ®åˆ†æç»´åº¦çš„ä¸åŒå¯¹æ¯”åˆ†æè§’åº¦ã€‚ è·¨åº“è”åˆæŸ¥è¯¢çš„é—®é¢˜ï¼Œå¯èƒ½éœ€è¦ä¸¤æ¬¡æŸ¥è¯¢ è·¨èŠ‚ç‚¹çš„ countã€order byã€group by ä»¥åŠèšåˆå‡½æ•°é—®é¢˜ï¼Œå¯èƒ½éœ€è¦åˆ†åˆ«åœ¨å„ä¸ªèŠ‚ç‚¹ä¸Šå¾—åˆ°ç»“æœååœ¨åº”ç”¨ç¨‹åºç«¯è¿›è¡Œåˆå¹¶ é¢å¤–çš„æ•°æ®ç®¡ç†è´Ÿæ‹…ï¼Œå¦‚ï¼šè®¿é—®æ•°æ®è¡¨çš„å¯¼èˆªå®šä½ é¢å¤–çš„æ•°æ®è¿ç®—å‹åŠ›ï¼Œå¦‚ï¼šéœ€è¦åœ¨å¤šä¸ªèŠ‚ç‚¹æ‰§è¡Œï¼Œç„¶åå†åˆå¹¶è®¡ç®— ç¨‹åºç¼–ç å¼€å‘éš¾åº¦æå‡ï¼Œæ²¡æœ‰å¤ªå¥½çš„æ¡†æ¶è§£å†³ï¼Œæ›´å¤šä¾èµ–ä¸šåŠ¡çœ‹å¦‚ä½•åˆ†ï¼Œå¦‚ä½•åˆï¼Œæ˜¯ä¸ªéš¾é¢˜ æ°´å¹³åˆ†è¡¨ä¼šå½±å“ç´¢å¼•æŸ¥è¯¢ï¼Œç‰¹åˆ«æ˜¯åˆ†åˆ°äº†ä¸åŒçš„åº“ä¸­ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¼šå˜å¾—è¾ƒä½ï¼Œæ‰€ä»¥ä¸è¦è½»æ˜“åœ°æ°´å¹³åˆ†è¡¨ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"ä¼˜åŒ–","slug":"ä¼˜åŒ–","permalink":"https://www.codetool.top/tags/%E4%BC%98%E5%8C%96/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"}]},{"title":"leetcode111-äºŒå‰æ ‘çš„æœ€å°æ·±åº¦","slug":"leetcode111-äºŒå‰æ ‘çš„æœ€å°æ·±åº¦","date":"2020-03-25T01:48:36.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode111-äºŒå‰æ ‘çš„æœ€å°æ·±åº¦/","link":"","permalink":"https://www.codetool.top/article/leetcode111-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E6%9C%80%E5%B0%8F%E6%B7%B1%E5%BA%A6/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å°æ·±åº¦ã€‚ æœ€å°æ·±åº¦æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°æœ€è¿‘å¶å­èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°é‡ã€‚ è¯´æ˜: å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚ ç¤ºä¾‹: ç»™å®šäºŒå‰æ ‘ [3,9,20,null,null,15,7], 3 / \\ 9 20 / \\ 15 7è¿”å›å®ƒçš„æœ€å°æ·±åº¦ 2. 2 è§£æ³•2.1 æ€æƒ³BFSè‚¯å®šæ˜¯æ¯”DFSå¿«çš„ï¼ˆæœ€å¥½æƒ…å†µï¼‰ï¼ŒDFSéœ€è¦æœç´¢æ‰€æœ‰èŠ‚ç‚¹ï¼ŒBFSåªè¦æœåˆ°å“ªä¸€å±‚æœ‰å¶å­èŠ‚ç‚¹å°±è¡Œäº†ï¼ˆè™½ç„¶æ—¶é—´å¤æ‚åº¦æ˜¯ä¸€ä¸ªé‡çº§çš„ï¼‰ 2.2 ä»£ç class Solution { public int minDepth(TreeNode root) { if(root == null) return 0; Queue&lt;TreeNode> queue = new LinkedList&lt;>(); queue.offer(root); queue.offer(null); int depth = 1; while(true){ TreeNode node = queue.poll(); if(node == null){ if(queue.isEmpty()) return depth; else { depth++; queue.offer(null); } continue; } if(node.left == null &amp;&amp; node.right == null) return depth; if(node.left!=null){ queue.offer(node.left); } if(node.right!=null) { queue.offer(node.right); } } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"è°ˆè°ˆå¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€æ¶ˆæ¯æ‘˜è¦ä»¥åŠæ•°å­—ç­¾å","slug":"è°ˆè°ˆå¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€æ¶ˆæ¯æ‘˜è¦ä»¥åŠæ•°å­—ç­¾å","date":"2020-03-24T16:46:22.000Z","updated":"2020-04-16T16:35:07.778Z","comments":true,"path":"article/è°ˆè°ˆå¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€æ¶ˆæ¯æ‘˜è¦ä»¥åŠæ•°å­—ç­¾å/","link":"","permalink":"https://www.codetool.top/article/%E8%B0%88%E8%B0%88%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E3%80%81%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E3%80%81%E6%B6%88%E6%81%AF%E6%91%98%E8%A6%81%E4%BB%A5%E5%8F%8A%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D/","excerpt":"","text":"1 å¯¹ç§°åŠ å¯†åŠ å¯†æ–¹å’Œè§£å¯†æ–¹é€šè¿‡ç›¸åŒçš„å¯†é’¥å’Œç®—æ³•è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼Œæ‰€ä»¥åŒæ–¹äº‹å…ˆçŸ¥é“å¯†é’¥ï¼Œå¹¶ä¸”å¯†é’¥å¿…é¡»ä¸¥æ ¼ä¿å¯†ã€‚ å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼š RC4ã€DESã€3DESã€AESã€ChaCha20 DES çš„ä¿å¯†æ€§ä»…å–å†³äºå¯¹å¯†é’¥çš„ä¿å¯†ï¼Œè€Œç®—æ³•æ˜¯å…¬å¼€çš„ã€‚å°½ç®¡äººä»¬åœ¨ç ´è¯‘ DES æ–¹é¢å–å¾—äº†è®¸å¤šè¿›å±•ï¼Œä½†è‡³ä»Šä»æœªèƒ½æ‰¾åˆ°æ¯”ç©·ä¸¾æœç´¢å¯†é’¥æ›´æœ‰æ•ˆçš„æ–¹æ³•ã€‚ DES æ˜¯ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªå…¬è®¤çš„å®ç”¨å¯†ç ç®—æ³•æ ‡å‡†ï¼Œå®ƒæ›¾å¯¹å¯†ç å­¦çš„å‘å±•åšå‡ºäº†é‡å¤§è´¡çŒ®ã€‚ç›®å‰è¾ƒä¸ºä¸¥é‡çš„é—®é¢˜æ˜¯ DES çš„å¯†é’¥çš„é•¿åº¦ã€‚ç°åœ¨å·²ç»è®¾è®¡å‡ºæ¥æœç´¢ DES å¯†é’¥çš„ä¸“ç”¨èŠ¯ç‰‡ã€‚ å‰ä¸‰ç§ç®—æ³•ç›®å‰éƒ½è¢«è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„ï¼Œç›®å‰åœ¨TLSï¼ˆHTTPSåŸºäºçš„ä¼ è¾“å±‚å®‰å…¨ï¼‰ä¸­å¸¸ç”¨çš„åªæœ‰ AES å’Œ ChaCha20 AES çš„æ„æ€æ˜¯â€œé«˜çº§åŠ å¯†æ ‡å‡†â€ï¼ˆAdvanced Encryption Standardï¼‰ï¼Œå¯†é’¥é•¿åº¦å¯ä»¥æ˜¯ 128ã€192 æˆ– 256ã€‚å®ƒæ˜¯ DES ç®—æ³•çš„æ›¿ä»£è€…ï¼Œå®‰å…¨å¼ºåº¦å¾ˆé«˜ï¼Œæ€§èƒ½ä¹Ÿå¾ˆå¥½ï¼Œè€Œä¸”æœ‰çš„ç¡¬ä»¶è¿˜ä¼šåšç‰¹æ®Šä¼˜åŒ–ï¼Œæ‰€ä»¥éå¸¸æµè¡Œï¼Œæ˜¯åº”ç”¨æœ€å¹¿æ³›çš„å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚ ChaCha20 æ˜¯ Google è®¾è®¡çš„å¦ä¸€ç§åŠ å¯†ç®—æ³•ï¼Œå¯†é’¥é•¿åº¦å›ºå®šä¸º 256 ä½ï¼Œçº¯è½¯ä»¶è¿è¡Œæ€§èƒ½è¦è¶…è¿‡ AESï¼Œæ›¾ç»åœ¨ç§»åŠ¨å®¢æˆ·ç«¯ä¸Šæ¯”è¾ƒæµè¡Œï¼Œä½† ARMv8 ä¹‹åä¹ŸåŠ å…¥äº† AES ç¡¬ä»¶ä¼˜åŒ–ï¼Œæ‰€ä»¥ç°åœ¨ä¸å†å…·æœ‰æ˜æ˜¾çš„ä¼˜åŠ¿ï¼Œä½†ä»ç„¶ç®—å¾—ä¸Šæ˜¯ä¸€ä¸ªä¸é”™ç®—æ³•ã€‚ å¯¹ç§°åŠ å¯†çš„åŠ å¯†å’Œè§£å¯†éœ€è¦ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ï¼Œæ‰€ä»¥éœ€è¦è§£å†³å¯†é’¥é…é€é—®é¢˜ï¼Œä¼ è¾“çš„è¿‡ç¨‹å¿…é¡»å®‰å…¨ã€‚å¯†é’¥ç®¡ç†ä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚ å¯¹ç§°ç®—æ³•è¿˜æœ‰ä¸€ä¸ªâ€œåˆ†ç»„æ¨¡å¼â€çš„æ¦‚å¿µï¼Œç›®å‰å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³•éƒ½æ˜¯å±äºåˆ†ç»„å¯†ç ï¼Œåˆ†ç»„å¯†ç æ˜¯æ¯æ¬¡åªèƒ½å¤„ç†ç‰¹å®šé•¿åº¦çš„ä¸€å—ï¼ˆblockï¼‰æ•°æ®çš„ä¸€ç±»åŠ è§£å¯†ç®—æ³•ã€‚ åˆ†ç»„æ¨¡å¼å¯ä»¥æ‰“ç ´è¿™ç§æŸç¼šï¼Œä½¿å›ºå®šé•¿åº¦çš„å¯†é’¥èƒ½å¤ŸåŠ å¯†ä»»æ„é•¿åº¦çš„æ˜æ–‡ã€‚ æœ€æ—©æœ‰ ECBã€CBCã€CFBã€OFB ç­‰å‡ ç§åˆ†ç»„æ¨¡å¼ï¼Œä½†éƒ½é™†ç»­è¢«å‘ç°æœ‰å®‰å…¨æ¼æ´ï¼Œæ‰€ä»¥ç°åœ¨åŸºæœ¬éƒ½ä¸æ€ä¹ˆç”¨äº†ã€‚æœ€æ–°çš„åˆ†ç»„æ¨¡å¼è¢«ç§°ä¸º AEADï¼ˆAuthenticated Encryption with Associated Dataï¼‰ï¼Œåœ¨åŠ å¯†çš„åŒæ—¶å¢åŠ äº†è®¤è¯çš„åŠŸèƒ½ï¼Œå¸¸ç”¨çš„æ˜¯ GCMã€CCM å’Œ Poly1305ã€‚ æŠŠä¸Šé¢è¿™äº›ç»„åˆèµ·æ¥ï¼Œå°±å¯ä»¥å¾—åˆ° TLS å¯†ç å¥—ä»¶ä¸­å®šä¹‰çš„å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚ æ¯”å¦‚ï¼ŒAES128-GCMï¼Œæ„æ€æ˜¯å¯†é’¥é•¿åº¦ä¸º 128 ä½çš„ AES ç®—æ³•ï¼Œä½¿ç”¨çš„åˆ†ç»„æ¨¡å¼æ˜¯ GCMã€‚ 2 éå¯¹ç§°åŠ å¯†éœ€è¦ä¸¤ä¸ªå¯†é’¥ï¼Œå…¬é’¥å’Œç§é’¥æ˜¯ä¸€å¯¹ï¼Œå…¬é’¥åŠ å¯†çš„åªèƒ½ç”¨ç§é’¥è§£ï¼Œç§é’¥åŠ å¯†çš„åªèƒ½ç”¨å…¬é’¥è§£ï¼Œä¿æŠ¤ç§é’¥ï¼Œå…¬å¼€å…¬é’¥ã€‚ å¸¸è§çš„éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼š DHã€DSAã€RSAã€ECC éå¯¹ç§°åŠ å¯†çš„ç‰¹ç‚¹ï¼š è‹¥å¯†é’¥èƒ½å¤Ÿå®ç°å®‰å…¨äº¤æ¢ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½ä¼šè€ƒè™‘ä»…ä½¿ç”¨éå¯¹ç§°åŠ å¯†æ¥é€šä¿¡ã€‚ä½†æ˜¯éå¯¹ç§°åŠ å¯†ä¸å¯¹ç§°åŠ å¯†ç›¸æ¯”ï¼Œå…¶å¤„ç†é€Ÿåº¦è¦æ…¢ã€‚ ä»»ä½•åŠ å¯†æ–¹æ³•çš„å®‰å…¨æ€§å–å†³äºå¯†é’¥çš„é•¿åº¦ï¼Œä»¥åŠæ”»ç ´å¯†æ–‡æ‰€éœ€çš„è®¡ç®—é‡ã€‚åœ¨è¿™æ–¹é¢ï¼Œéå¯¹ç§°åŠ å¯†å¹¶ä¸æ¯”ä¼ ç»ŸåŠ å¯†ä½“åˆ¶æ›´åŠ ä¼˜è¶Š ç”±äºç›®å‰éå¯¹ç§°åŠ å¯†çš„å¼€é”€è¾ƒå¤§ï¼Œåœ¨å¯è§çš„å°†æ¥è¿˜ä¸ä¼šæ”¾å¼ƒä¼ ç»Ÿçš„åŠ å¯†æ–¹æ³• å…¬é’¥éœ€è¦å¯†é’¥åˆ†é…åè®®ï¼Œå…·ä½“çš„åˆ†é…è¿‡ç¨‹å¹¶ä¸æ¯”é‡‡ç”¨ä¼ ç»ŸåŠ å¯†æ–¹æ³•æ—¶æ›´ç®€å• RSAçš„å®‰å…¨æ€§ä½¿åŸºäºâ€œæ•´æ•°åˆ†è§£â€çš„æ•°å­¦éš¾é¢˜ï¼Œä½¿ç”¨ä¸¤ä¸ªè¶…å¤§ç´ æ•°çš„ä¹˜ç§¯ä½œä¸ºç”Ÿæˆå¯†é’¥çš„ææ–™ï¼Œæƒ³è¦ä»å…¬é’¥æ¨ç®—å‡ºç§é’¥æ˜¯éå¸¸å›°éš¾çš„ã€‚ 10 å¹´å‰ RSA å¯†é’¥çš„æ¨èé•¿åº¦æ˜¯ 1024ï¼Œä½†éšç€è®¡ç®—æœºè¿ç®—èƒ½åŠ›çš„æé«˜ï¼Œç°åœ¨ 1024 å·²ç»ä¸å®‰å…¨ï¼Œæ™®éè®¤ä¸ºè‡³å°‘è¦ 2048 ä½ã€‚ ECCï¼ˆElliptic Curve Cryptographyï¼‰æ˜¯éå¯¹ç§°åŠ å¯†é‡Œçš„â€œåèµ·ä¹‹ç§€â€ï¼Œå®ƒåŸºäºæ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°çš„æ•°å­¦éš¾é¢˜ï¼Œä½¿ç”¨ç‰¹å®šçš„æ›²çº¿æ–¹ç¨‹å’ŒåŸºç‚¹ç”Ÿæˆå…¬é’¥å’Œç§é’¥ï¼Œå­ç®—æ³• ECDHE ç”¨äºå¯†é’¥äº¤æ¢ï¼ŒECDSA ç”¨äºæ•°å­—ç­¾åã€‚ æ¯”èµ· RSAï¼ŒECC åœ¨å®‰å…¨å¼ºåº¦å’Œæ€§èƒ½ä¸Šéƒ½æœ‰æ˜æ˜¾çš„ä¼˜åŠ¿ã€‚160 ä½çš„ ECC ç›¸å½“äº 1024 ä½çš„ RSAï¼Œè€Œ 224 ä½çš„ ECC åˆ™ç›¸å½“äº 2048 ä½çš„ RSAã€‚å› ä¸ºå¯†é’¥çŸ­ï¼Œæ‰€ä»¥ç›¸åº”çš„è®¡ç®—é‡ã€æ¶ˆè€—çš„å†…å­˜å’Œå¸¦å®½ä¹Ÿå°±å°‘ï¼ŒåŠ å¯†è§£å¯†çš„æ€§èƒ½å°±ä¸Šå»äº†ï¼Œå¯¹äºç°åœ¨çš„ç§»åŠ¨äº’è”ç½‘éå¸¸æœ‰å¸å¼•åŠ›ã€‚ 3 æ¶ˆæ¯æ‘˜è¦å°†ä¿¡æ¯ä»¥æŸç§ç®—æ³•åŠ å¯†åå°±ä¸å¯ä»¥è§£å¯†ï¼Œåªæœ‰ç›¸åŒçš„æ–‡æœ¬ä»¥åŒæ ·çš„æ–¹æ³•åŠ å¯†å¯ä»¥å¾—åˆ°åŒæ ·çš„å¯†æ–‡ã€‚ å¸¸è§çš„æ‘˜è¦ç®—æ³•ï¼š MD5ã€SHA-1ã€SHA-256 æ¶ˆæ¯æ‘˜è¦ç®—æ³•ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªå•å‘æ•£åˆ—å‡½æ•°ï¼Œä¹Ÿç§°ä¸ºæ¶ˆæ¯æ‘˜è¦å‡½æ•°ï¼ˆmessage digest function)ã€å“ˆå¸Œå‡½æ•°ï¼Œé€‚ç”¨äºæ£€æŸ¥æ¶ˆæ¯å®Œæ•´æ€§çš„åŠ å¯†æŠ€æœ¯ã€‚ å•å‘æ•£åˆ—å‡½æ•°æœ‰ä¸€ä¸ªè¾“å…¥å’Œä¸€ä¸ªè¾“å‡ºï¼Œå…¶ä¸­è¾“å…¥ç§°ä¸ºä¿¡æ¯ï¼Œè¾“å‡ºç§°ä¸ºæ•£åˆ—å€¼ã€‚å•å‘æ•£åˆ—å‡½æ•°å¯ä»¥æ ¹æ®æ¶ˆæ¯çš„å†…å®¹è®¡ç®—å‡ºæ•£åˆ—å€¼ï¼Œç¯¡æ”¹åçš„ä¿¡æ¯çš„æ•£åˆ—å€¼è®¡ç®—ç»“æœä¼šä¸ä¸€æ ·ï¼Œæ‰€ä»¥æ•£åˆ—å€¼å¯ä»¥è¢«ç”¨æ¥æ£€æŸ¥æ¶ˆæ¯çš„å®Œæ•´æ€§ã€‚ æ¶ˆæ¯æ‘˜è¦ç®—æ³•å­˜åœ¨å“ˆå¸Œå†²çªï¼Œå³ä¸åŒçš„æ¶ˆæ¯ç»æ¶ˆæ¯æ‘˜è¦ç®—æ³•åŠ å¯†åï¼Œå¯èƒ½æ˜¯ç›¸åŒçš„å¯†æ–‡ï¼Œæ‰€ä»¥ä¸èƒ½è¯´å¯†æ–‡ä¸€è‡´æºæ•°æ®å°±ä¸€è‡´ã€‚ å°½ç®¡æ¶ˆæ¯æ‘˜è¦ä¸èƒ½è§£å¯†ï¼Œä½†åªè¦çŸ¥é“è¯¥æ¶ˆæ¯æ‘˜è¦çš„ç®—æ³•ï¼Œä½¿ç”¨è¶³é‡çš„æ•°æ®è¿›è¡ŒåŠ å¯†æ“ä½œï¼Œå¯ä»¥å¾—åˆ°å­—å…¸ï¼ˆæˆ–å½©è™¹è¡¨ï¼‰ï¼Œå³èƒ½çŸ¥é“ç”±å“ªäº›ä¿¡æ¯å¯ä»¥é€šè¿‡æ¶ˆæ¯æ‘˜è¦è·å–è¯¥å¯†æ–‡ã€‚ä½†æ˜¯å¥½çš„æ¶ˆæ¯æ‘˜è¦ç®—æ³•ä¼šå°½å¯èƒ½é¿å…ç¢°æ’ï¼Œå¹¶ä¸”éš¾ä»¥è®©æ”»å‡»è€…æ ¹æ®å¯†æ–‡æ‰¾åˆ°èƒ½å‘ç”Ÿå“ˆå¸Œå†²çªçš„ä¿¡æ¯ã€‚ï¼ˆæ¶ˆæ¯æ‘˜è¦ç®—æ³•è¶Šå¤æ‚è¶Šéš¾ä½¿ç”¨è¿™ç§æ–¹æ³•è§£å¯†ï¼‰ sha æ¯” md5 æ›´å®‰å…¨ä¸€äº›ï¼Œsha æ¯” md5 å“ˆå¸Œç¢°æ’çš„æ¦‚ç‡æ›´å°ä¸€äº›ã€‚ æ¶ˆæ¯æ‘˜è¦ç®—æ³•çš„åº”ç”¨ï¼š 3.1 å¯†ç åˆ©ç”¨å•å‘æ•£åˆ—åŠ å¯†çš„ç‰¹æ€§ï¼Œå¯ä»¥è¿›è¡Œå¯†ç åŠ å¯†ä¿å­˜ï¼Œå³ç”¨æˆ·æ³¨å†Œæ—¶è¾“å…¥çš„å¯†ç ä¸ç›´æ¥ä¿å­˜åˆ°æ•°æ®åº“ï¼Œè€Œæ˜¯å¯¹å¯†ç è¿›è¡Œå•å‘æ•£åˆ—åŠ å¯†ï¼Œå°†å¯†æ–‡å­˜å…¥æ•°æ®åº“ï¼Œç”¨æˆ·ç™»å½•æ—¶ï¼Œè¿›è¡Œå¯†ç éªŒè¯ï¼ŒåŒæ ·è®¡ç®—å¾—åˆ°è¾“å…¥å¯†ç çš„å¯†æ–‡ï¼Œå¹¶å’Œæ•°æ®åº“ä¸­çš„å¯†æ–‡æ¯”è¾ƒï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™å¯†ç éªŒè¯æˆåŠŸã€‚ è¿™æ ·ä¿å­˜åœ¨æ•°æ®åº“ä¸­çš„æ˜¯ç”¨æˆ·è¾“å…¥çš„å¯†ç çš„å¯†æ–‡ï¼Œè€Œä¸”ä¸å¯é€†åœ°è®¡ç®—å¾—åˆ°å¯†ç çš„æ˜æ–‡ï¼Œå› æ­¤å³ä½¿æ•°æ®åº“è¢«æ‹–åº“ï¼ˆæŒ‡ç½‘ç«™é­åˆ°å…¥ä¾µåï¼Œé»‘å®¢çªƒå–å…¶æ•°æ®åº“ï¼‰ï¼Œä¹Ÿä¸ä¼šæ³„éœ²ç”¨æˆ·çš„å¯†ç ä¿¡æ¯ã€‚ ä¸ºäº†åŠ å¼ºå•å‘æ•£åˆ—è®¡ç®—çš„å®‰å…¨æ€§ï¼Œè¿˜ä¼šç»™æ•£åˆ—ç®—æ³•åŠ ç‚¹ç›ï¼Œsalt ç›¸å½“äºåŠ å¯†çš„å¯†é’¥ï¼Œå¢åŠ ç ´è§£çš„éš¾åº¦ã€‚ç›ä¸€èˆ¬éƒ½æ˜¯è·Ÿ hash ä¸€èµ·ä¿å­˜åœ¨æ•°æ®åº“é‡Œï¼Œæˆ–è€…ä½œä¸º hash å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ã€‚saltæ˜¯ç”±ç³»ç»Ÿéšæœºç”Ÿæˆçš„ï¼Œå¹¶ä¸”åªæœ‰ç³»ç»ŸçŸ¥é“ã€‚ è¿™æ ·ï¼Œå³ä¾¿ä¸¤ä¸ªç”¨æˆ·ä½¿ç”¨äº†åŒä¸€ä¸ªå¯†ç ï¼Œç”±äºç³»ç»Ÿä¸ºå®ƒä»¬ç”Ÿæˆçš„ salt å€¼ä¸åŒï¼Œä»–ä»¬çš„æ•£åˆ—å€¼ä¹Ÿæ˜¯ä¸åŒçš„ã€‚ 3.2 æ•°å­—ç­¾åå‚è€ƒé“¾æ¥ï¼š æ•°å­—ç­¾åæ˜¯ä»€ä¹ˆï¼Ÿ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿— æ•°å­—ç­¾åçš„ç‰¹æ€§æ˜¯ï¼š åˆ«äººä¸èƒ½å†’å……æˆ‘çš„ç­¾åï¼ˆä¸å¯ä¼ªé€ ï¼‰ æˆ‘ä¹Ÿä¸èƒ½å¦è®¤ä¸Šé¢çš„ç­¾åæ˜¯æˆ‘çš„ï¼ˆä¸å¯æŠµèµ–ï¼‰ æ•°å­—ç­¾ååˆæ˜¯é ä»€ä¹ˆä¿è¯ä¸å¯ä¼ªé€ å’Œä¸å¯æŠµèµ–ä¸¤ä¸ªç‰¹æ€§å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯åˆ©ç”¨éå¯¹ç§°åŠ å¯†ã€‚ è¿™æ ·ï¼Œå¦‚æœä½ ç”Ÿæˆäº†ä¸€å¯¹ RSA å¯†é’¥ï¼Œä½ æŠŠå…¬é’¥å…¬å¸ƒå‡ºå»ï¼Œå¹¶å‘Šè¯‰å…¨ä¸–ç•Œäººè¿™ä¸ªå…¬é’¥æ˜¯ä½ çš„ã€‚ä¹‹åä½ åªè¦åœ¨å‘é€çš„æ¶ˆæ¯ï¼Œæ¯”å¦‚â€œ123456â€ï¼Œåé¢åŠ ä¸Šç”¨ç§é’¥åŠ å¯†è¿‡çš„å¯†æ–‡ï¼Œå…¶ä»–äººæ‹¿å…¬é’¥è§£å¯†ï¼Œçœ‹è§£å¯†å¾—åˆ°çš„å†…å®¹æ˜¯ä¸æ˜¯â€œ123456â€å°±å¯ä»¥çŸ¥é“è¿™ä¸ªâ€œ123456â€æ˜¯ä¸æ˜¯ä½ å‘çš„ã€‚ å…¶ä»–äººå› ä¸ºæ²¡æœ‰å¯¹åº”çš„ç§é’¥ï¼Œæ‰€ä»¥æ²¡æ³•ç”Ÿæˆå…¬é’¥å¯ä»¥è§£å¯†çš„å¯†æ–‡ï¼Œæ‰€ä»¥æ˜¯ä¸å¯ä¼ªé€ çš„ã€‚ åˆå› ä¸ºå…¬é’¥å¯¹åº”çš„ç§é’¥åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥åªè¦èƒ½æˆåŠŸè§£å¯†ï¼Œé‚£ä¹ˆå‘æ¶ˆæ¯çš„ä¸€å®šæ˜¯ä½ ï¼Œä¸ä¼šæ˜¯å…¶ä»–äººï¼Œæ‰€ä»¥æ˜¯ä¸å¯æŠµèµ–çš„ã€‚ ç”±äºç›´æ¥å¯¹åŸæ¶ˆæ¯è¿›è¡Œç­¾åæœ‰å®‰å…¨æ€§é—®é¢˜ï¼Œè€Œä¸”åŸæ¶ˆæ¯å¾€å¾€æ¯”è¾ƒå¤§ï¼Œç›´æ¥ä½¿ç”¨ RSA ç®—æ³•è¿›è¡Œç­¾åé€Ÿåº¦ä¼šæ¯”è¾ƒæ…¢ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬å¯¹æ¶ˆæ¯è®¡ç®—å…¶æ‘˜è¦ï¼ˆä½¿ç”¨ SHA-256 ç­‰å®‰å…¨çš„æ‘˜è¦ç®—æ³•ï¼‰ï¼Œç„¶åå¯¹æ‘˜è¦è¿›è¡Œç­¾åã€‚åªè¦ä½¿ç”¨çš„æ‘˜è¦ç®—æ³•æ˜¯å®‰å…¨çš„ï¼ˆMD5ã€SHA-1 å·²ç»ä¸å®‰å…¨äº†ï¼‰ï¼Œé‚£ä¹ˆè¿™ç§æ–¹å¼çš„æ•°å­—ç­¾åå°±æ˜¯å®‰å…¨çš„ã€‚","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"å®‰å…¨","slug":"å®‰å…¨","permalink":"https://www.codetool.top/tags/%E5%AE%89%E5%85%A8/"}]},{"title":"Webå®‰å…¨ä¹‹CSRFæ”»å‡»","slug":"Webå®‰å…¨ä¹‹CSRFæ”»å‡»","date":"2020-03-24T15:49:03.000Z","updated":"2020-03-24T15:49:14.950Z","comments":true,"path":"article/Webå®‰å…¨ä¹‹CSRFæ”»å‡»/","link":"","permalink":"https://www.codetool.top/article/Web%E5%AE%89%E5%85%A8%E4%B9%8BCSRF%E6%94%BB%E5%87%BB/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š æµ…è°ˆCSRFæ”»å‡»æ–¹å¼ - hyddd - åšå®¢å›­ é¢è¯•é—®é¢˜å¦‚ä½•é¢„é˜²csrfæ”»å‡»_ç½‘ç»œ_markâ€™s technic world-CSDNåšå®¢ Webå®‰å…¨ä¹‹CSRFæ”»å‡» - çŸ¥ä¹ 1 æ¦‚è¿°CSRFï¼ˆCross-site request forgeryï¼‰è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œåˆ©ç”¨è·¨ç«™è¯·æ±‚ï¼Œåœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ï¼Œä»¥ç”¨æˆ·çš„èº«ä»½ä¼ªé€ è¯·æ±‚ï¼Œå…¶æ ¸å¿ƒæ˜¯åˆ©ç”¨äº†æµè§ˆå™¨ Cookie æˆ–è€… Sessionï¼Œç›—å–ç”¨æˆ·èº«ä»½ã€‚ ä¸‹é¢æ˜¯ CSRF çš„å¸¸è§ç‰¹æ€§ï¼š ä¾é ç”¨æˆ·æ ‡è¯†å±å®³ç½‘ç«™ åˆ©ç”¨ç½‘ç«™å¯¹ç”¨æˆ·æ ‡è¯†çš„ä¿¡ä»»ï¼Œæ¬ºéª—ç”¨æˆ·çš„æµè§ˆå™¨å‘é€ HTTP è¯·æ±‚ç»™ç›®æ ‡ç«™ç‚¹ 2 åŸç†è¦å®Œæˆä¸€æ¬¡CSRFæ”»å‡»ï¼Œå—å®³è€…å¿…é¡»ä¾æ¬¡å®Œæˆä¸¤ä¸ªæ­¥éª¤ï¼š ç™»å½•å—ä¿¡ä»»ç½‘ç«™Aï¼Œå¹¶åœ¨æœ¬åœ°ç”ŸæˆCookieã€‚ åœ¨ä¸ç™»å‡ºAçš„æƒ…å†µä¸‹ï¼Œè®¿é—®å±é™©ç½‘ç«™Bã€‚ å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®ç½‘ç«™Aæ—¶ï¼Œç½‘ç«™Aä¸ºç”¨æˆ·è®¾ç½®äº†å«æœ‰ç”¨æˆ·èº«ä»½ä¿¡æ¯çš„Cookieï¼Œè€Œç”¨æˆ·åœ¨ç½‘ç«™Açš„cookieæœªè¿‡æœŸçš„æ—¶é—´å†…ï¼Œè®¿é—®äº†ç½‘ç«™Bï¼Œè€Œç½‘ç«™Bå¯èƒ½æœ‰å¤šç§æ–¹å¼ä»¤ç”¨æˆ·åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹å‘ç½‘ç«™Aå‘èµ·è¯·æ±‚ï¼Œä¾‹å¦‚ ä½¿ç”¨&lt;script&gt;ä»¥ç±»ä¼¼jsonpçš„æ–¹å¼å‘é€getè¯·æ±‚ ä½¿ç”¨&lt;img&gt;çš„srcå±æ€§å‘èµ·getè¯·æ±‚ jsè„šæœ¬é™é»˜å‘èµ·è¯·æ±‚ï¼ˆè¦è§£å†³è·¨åŸŸé—®é¢˜ï¼‰ åœ¨ç½‘ç«™Bä¸Šå«æœ‰é€šå¾€ç½‘ç«™Açš„è¶…é“¾æ¥ï¼Œè¯±éª—ç”¨æˆ·ç‚¹å‡»å‘èµ·è¯·æ±‚ã€‚(æœ‰äº›è¿˜ä¼ªè£…æˆçŸ­åŸŸåï¼Œç”¨æˆ·æ— æ³•åˆ†è¾¨) æ”»å‡»è€…å¯ä»¥ç›—ç”¨ä½ çš„ç™»é™†ä¿¡æ¯ï¼Œä»¥ä½ çš„èº«ä»½æ¨¡æ‹Ÿå‘é€å„ç§è¯·æ±‚ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·ç™»å½•ç½‘ç»œé“¶è¡Œå»æŸ¥çœ‹å…¶å­˜æ¬¾ä½™é¢ï¼Œåœ¨ä»–æ²¡æœ‰é€€å‡ºæ—¶ï¼Œå°±ç‚¹å‡»äº†ä¸€ä¸ª QQ å¥½å‹å‘æ¥çš„é“¾æ¥ï¼Œé‚£ä¹ˆè¯¥ç”¨æˆ·é“¶è¡Œå¸æˆ·ä¸­çš„èµ„é‡‘å°±æœ‰å¯èƒ½è¢«è½¬ç§»åˆ°æ”»å‡»è€…æŒ‡å®šçš„å¸æˆ·ä¸­ã€‚ æ‰€ä»¥é‡åˆ° CSRF æ”»å‡»æ—¶ï¼Œå°†å¯¹ç»ˆç«¯ç”¨æˆ·çš„æ•°æ®å’Œæ“ä½œæŒ‡ä»¤æ„æˆä¸¥é‡çš„å¨èƒã€‚å½“å—æ”»å‡»çš„ç»ˆç«¯ç”¨æˆ·å…·æœ‰ç®¡ç†å‘˜å¸æˆ·çš„æ—¶å€™ï¼ŒCSRF æ”»å‡»å°†å±åŠæ•´ä¸ª Web åº”ç”¨ç¨‹åºã€‚ 3 é¢„é˜²é˜²å¾¡æ‰‹æ®µä¸»è¦æ˜¯è¯†åˆ«è¯·æ±‚è€…èº«ä»½ã€‚ é‡è¦æ•°æ®äº¤äº’é‡‡ç”¨ POST è¿›è¡Œæ¥æ”¶ï¼Œå½“ç„¶æ˜¯ç”¨ POST ä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„ï¼Œä¼ªé€ ä¸€ä¸ª form è¡¨å•å³å¯ç ´è§£ã€‚ ä½¿ç”¨éªŒè¯ç ï¼Œåªè¦æ˜¯æ¶‰åŠåˆ°æ•°æ®äº¤äº’å°±å…ˆè¿›è¡ŒéªŒè¯ç éªŒè¯ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥å®Œå…¨è§£å†³ CSRFã€‚ä½†æ˜¯å‡ºäºç”¨æˆ·ä½“éªŒè€ƒè™‘ï¼Œç½‘ç«™ä¸èƒ½ç»™æ‰€æœ‰çš„æ“ä½œéƒ½åŠ ä¸ŠéªŒè¯ç ã€‚å› æ­¤éªŒè¯ç åªèƒ½ä½œä¸ºä¸€ç§è¾…åŠ©æ‰‹æ®µï¼Œä¸èƒ½ä½œä¸ºä¸»è¦è§£å†³æ–¹æ¡ˆã€‚ éªŒè¯è¯·æ±‚å¤´ä¸­çš„ Referer å­—æ®µï¼Œè¯¥å­—æ®µè®°å½•äº†æ­¤æ¬¡ HTTP è¯·æ±‚çš„æ¥æºåœ°å€ï¼Œæœ€å¸¸è§çš„åº”ç”¨æ˜¯å›¾ç‰‡é˜²ç›—é“¾ã€‚ä½†æœ‰äº›åœºæ™¯ä¸é€‚åˆå°†æ¥æºURLæš´éœ²ç»™æœåŠ¡å™¨ï¼Œæ‰€ä»¥å¯ä»¥è®¾ç½®ä¸ç”¨ä¸Šä¼ ï¼Œå¹¶ä¸”refererå±æ€§æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œæ‰€ä»¥åœ¨æœåŠ¡å™¨ç«¯æ ¡éªŒrefererå±æ€§å¹¶æ²¡æœ‰é‚£ä¹ˆå¯é ã€‚ éªŒè¯è¯·æ±‚å¤´ä¸­çš„ origin å­—æ®µï¼Œé€šè¿‡XMLHttpRequestã€Fetchå‘èµ·çš„è·¨ç«™è¯·æ±‚æˆ–è€…Postæ–¹æ³•å‘é€è¯·æ±‚æ—¶ï¼Œéƒ½ä¼šå¸¦ä¸Šorigin,æ‰€ä»¥æœåŠ¡å™¨å¯ä»¥ä¼˜å…ˆåˆ¤æ–­Originå±æ€§ï¼Œå†æ ¹æ®å®é™…æƒ…å†µåˆ¤æ–­æ˜¯å¦ä½¿ç”¨refereråˆ¤æ–­ã€‚ è¿˜æœ‰ä¸€ç§éå¸¸å¯é çš„æ–¹æ³•æ˜¯ä½¿ç”¨tokenéªŒè¯ç”¨æˆ·èº«ä»½ï¼š åœ¨æµè§ˆå™¨å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªCSRF Tokenï¼ˆå­—ç¬¦ä¸²ï¼‰å‘é€ç»™æµè§ˆå™¨ï¼Œç„¶åå°†è¯¥å­—ç¬¦ä¸²æ”¾å…¥é¡µé¢ä¸­ æµè§ˆå™¨è¯·æ±‚æ—¶ï¼ˆå¦‚è¡¨å•æäº¤ï¼‰éœ€è¦å¸¦ä¸Šè¿™ä¸ªCSRF Tokenã€‚(å¯ä»¥å­˜æ”¾åœ¨headersä¸­)æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼ŒéªŒè¯CSRFæ˜¯å¦åˆæ³•ï¼Œå¦‚æœä¸åˆæ³•æ‹’ç»å³å¯ã€‚","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"å®‰å…¨","slug":"å®‰å…¨","permalink":"https://www.codetool.top/tags/%E5%AE%89%E5%85%A8/"}]},{"title":"Webå®‰å…¨ä¹‹XSSæ”»å‡»","slug":"Webå®‰å…¨ä¹‹XSSæ”»å‡»","date":"2020-03-24T15:16:34.000Z","updated":"2020-03-24T15:21:52.358Z","comments":true,"path":"article/Webå®‰å…¨ä¹‹XSSæ”»å‡»/","link":"","permalink":"https://www.codetool.top/article/Web%E5%AE%89%E5%85%A8%E4%B9%8BXSS%E6%94%BB%E5%87%BB/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š XSSæ”»å‡»å¸¸è¯†åŠå¸¸è§çš„XSSæ”»å‡»è„šæœ¬æ±‡æ€» - ç®€ä¹¦XSSæ”»å‡»_ç™¾åº¦ç™¾ç§‘ 1 XSSæ¦‚è¿°è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆCross Site Scriptingï¼‰,å› ä¸ºé¿å…å’ŒCSSæ··æ·†ï¼Œé€šå¸¸ç§°ä¹‹ä¸ºXSSã€‚ XSSæ”»å‡»é€šå¸¸æŒ‡çš„æ˜¯é€šè¿‡åˆ©ç”¨ç½‘é¡µå¼€å‘æ—¶ç•™ä¸‹çš„æ¼æ´ï¼Œé€šè¿‡å·§å¦™çš„æ–¹æ³•æ³¨å…¥æ¶æ„æŒ‡ä»¤ä»£ç åˆ°ç½‘é¡µï¼Œä½¿ç”¨æˆ·åŠ è½½å¹¶æ‰§è¡Œæ”»å‡»è€…æ¶æ„åˆ¶é€ çš„ç½‘é¡µç¨‹åºã€‚æ¯”å¦‚è¿è¡Œåœ¨ç”¨æˆ·æµè§ˆå™¨ä¸Šçš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨è„šæœ¬ï¼Œå¦‚æœä¸è¿‡æ»¤ç”¨æˆ·è¾“å…¥çš„æ•°æ®ç›´æ¥æ˜¾ç¤ºç”¨æˆ·è¾“å…¥çš„ HTML å†…å®¹çš„è¯ï¼Œå°±ä¼šæœ‰å¯èƒ½è¿è¡Œæ¶æ„çš„ JavaScript è„šæœ¬ï¼Œå¯¼è‡´é¡µé¢ç»“æ„é”™ä¹±ï¼ŒCookies ä¿¡æ¯è¢«çªƒå–ç­‰é—®é¢˜ã€‚ XSSçš„åŸç†æ˜¯æ¶æ„æ”»å‡»è€…å¾€ Web é¡µé¢é‡Œæ’å…¥æ¶æ„å¯æ‰§è¡Œç½‘é¡µè„šæœ¬ä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µä¹‹æ—¶ï¼ŒåµŒå…¥å…¶ä¸­ Web é‡Œé¢çš„è„šæœ¬ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œå¯ä»¥è¾¾åˆ°æ”»å‡»è€…ç›—å–ç”¨æˆ·ä¿¡æ¯æˆ–å…¶ä»–ä¾µçŠ¯ç”¨æˆ·å®‰å…¨éšç§çš„ç›®çš„ã€‚ 2 ç±»å‹å¸¸è§çš„ XSS æ”»å‡»ç±»å‹æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯åå°„å‹ï¼Œä¸€ç§æ˜¯æŒä¹…å‹ã€‚ 2.1 åå°„å‹å‘å‡ºè¯·æ±‚æ—¶ï¼ŒXSSä»£ç å‡ºç°åœ¨URLä¸­ï¼Œä½œä¸ºè¾“å…¥æäº¤åˆ°æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨ç«¯è§£æåå“åº”ï¼ŒXSSä»£ç éšå“åº”å†…å®¹ä¸€èµ·ä¼ å›ç»™æµè§ˆå™¨ï¼Œæœ€åæµè§ˆå™¨è§£ææ‰§è¡ŒXSSä»£ç ã€‚è¿™ä¸ªè¿‡ç¨‹åƒä¸€æ¬¡åå°„ï¼Œæ•…å«åå°„å‹XSSã€‚ æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªåµŒå…¥æ¶æ„è„šæœ¬çš„é“¾æ¥ï¼Œè¾¾åˆ°æ”»å‡»çš„ç›®çš„ã€‚ æ¯”å¦‚æ–°æµªå¾®åšä¸­ï¼Œæ”»å‡»è€…å‘å¸ƒçš„å¾®åšä¸­å«æœ‰ä¸€ä¸ªæ¶æ„è„šæœ¬çš„ URLï¼ˆURL ä¸­åŒ…å«è„šæœ¬çš„é“¾æ¥ï¼‰ï¼Œç”¨æˆ·ç‚¹å‡»è¯¥ URLï¼Œè„šæœ¬ä¼šè‡ªåŠ¨å…³æ³¨æ”»å‡»è€…çš„æ–°æµªå¾®åš IDï¼Œå‘å¸ƒå«æœ‰æ¶æ„è„šæœ¬ URL çš„å¾®åšï¼Œæ”»å‡»å°±è¢«æ‰©æ•£äº†ã€‚ ç°å®ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥é‡‡ç”¨ XSS æ”»å‡»ï¼Œå·å–ç”¨æˆ· Cookieã€å¯†ç ç­‰é‡è¦æ•°æ®ï¼Œè¿›è€Œä¼ªé€ äº¤æ˜“ã€ç›—çªƒç”¨æˆ·è´¢äº§ã€çªƒå–æƒ…æŠ¥ã€‚ 2.2 æŒä¹…å‹(å­˜å‚¨å‹)å­˜å‚¨å‹XSSå’Œåå°„å‹XSSçš„å·®åˆ«ä»…åœ¨äºï¼Œæäº¤çš„ä»£ç ä¼šå­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼ˆæ•°æ®åº“ï¼Œå†…å­˜ï¼Œæ–‡ä»¶ç³»ç»Ÿç­‰ï¼‰ï¼Œä¸‹æ¬¡è¯·æ±‚ç›®æ ‡é¡µé¢æ—¶ä¸ç”¨å†æäº¤XSSä»£ç  æœ€å…¸å‹çš„ä¾‹å­æ˜¯ç•™è¨€æ¿XSSï¼Œç”¨æˆ·æäº¤ä¸€æ¡åŒ…å«XSSä»£ç çš„ç•™è¨€å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œç›®æ ‡ç”¨æˆ·æŸ¥çœ‹ç•™è¨€æ¿æ—¶ï¼Œé‚£äº›ç•™è¨€çš„å†…å®¹ä¼šä»æ•°æ®åº“æŸ¥è¯¢å‡ºæ¥å¹¶æ˜¾ç¤ºï¼Œæµè§ˆå™¨å‘ç°æœ‰XSSä»£ç ï¼Œå°±å½“åšæ­£å¸¸çš„HTMLä¸Jsè§£ææ‰§è¡Œï¼Œäºæ˜¯è§¦å‘äº†XSSæ”»å‡»ã€‚ 3 é¢„é˜²Web é¡µé¢æ¸²æŸ“çš„æ‰€æœ‰å†…å®¹æˆ–è€…æ¸²æŸ“çš„æ•°æ®éƒ½å¿…é¡»æ¥è‡ªäºæœåŠ¡ç«¯ã€‚ åç«¯åœ¨å…¥åº“å‰åº”è¯¥é€‰æ‹©ä¸ç›¸ä¿¡ä»»ä½•å‰ç«¯æ•°æ®ï¼Œå°†æ‰€æœ‰çš„å­—æ®µç»Ÿä¸€è¿›è¡Œè½¬ä¹‰å¤„ç†ã€‚ åç«¯åœ¨è¾“å‡ºç»™å‰ç«¯æ•°æ®ç»Ÿä¸€è¿›è¡Œè½¬ä¹‰å¤„ç†ã€‚ å‰ç«¯åœ¨æ¸²æŸ“é¡µé¢ DOM çš„æ—¶å€™åº”è¯¥é€‰æ‹©ä¸ç›¸ä¿¡ä»»ä½•åç«¯æ•°æ®ï¼Œä»»ä½•å­—æ®µéƒ½éœ€è¦åšè½¬ä¹‰å¤„ç†ã€‚ 3.1 æ¶ˆæ¯’(è½¬ä¹‰)XSS æ”»å‡»è€…ä¸€èˆ¬éƒ½æ˜¯åœ¨è¯·æ±‚ä¸­åµŒå…¥æ¶æ„è„šæœ¬è¾¾åˆ°æ”»å‡»çš„ç›®çš„ï¼Œè¿™äº›è„šæœ¬æ˜¯ä¸€èˆ¬åœ¨ç”¨æˆ·è¾“å…¥ä¸­ä¸å¸¸ç”¨çš„ï¼Œå¦‚æœè¿›è¡Œè¿‡æ»¤å’Œæ¶ˆæ¯’å¤„ç†ï¼Œå³å¯¹æŸäº› HTML å±é™©å­—ç¬¦è½¬ä¹‰ï¼Œå¦‚â€&gt;â€è½¬ä¹‰ä¸ºâ€&gt;â€ï¼Œå°±å¯ä»¥é˜²æ­¢å¤§éƒ¨åˆ†çš„æ”»å‡»ã€‚ä¸ºäº†é¿å…å¯¹ä¸å¿…è¦çš„å†…å®¹é”™è¯¯è½¬ä¹‰ï¼Œå¦‚â€3&lt;5â€ä¸­çš„â€&lt;â€éœ€è¦è¿›è¡Œæ–‡æœ¬åŒ¹é…åå†è½¬ä¹‰ï¼Œå¦‚â€&lt;img src=â€è¿™æ ·ä¸Šä¸‹æ–‡ä¸­çš„â€&lt;â€æ‰è½¬ä¹‰ã€‚ 3.2 HttpOnlyå¦‚æœcookieä¸­è®¾ç½®äº†HttpOnlyå±æ€§ï¼Œé‚£ä¹ˆé€šè¿‡jsè„šæœ¬å°†æ— æ³•è¯»å–åˆ°cookieä¿¡æ¯ï¼Œè¿™æ ·èƒ½æœ‰æ•ˆçš„é˜²æ­¢XSSæ”»å‡»ï¼Œçªƒå–cookieå†…å®¹ï¼Œè¿™æ ·å°±å¢åŠ äº†cookieçš„å®‰å…¨æ€§ï¼Œå³ä¾¿æ˜¯è¿™æ ·ï¼Œä¹Ÿä¸è¦å°†é‡è¦ä¿¡æ¯å­˜å…¥cookieã€‚ æµè§ˆå™¨ç¦æ­¢é¡µé¢ JavaScript è®¿é—®å¸¦æœ‰ HttpOnly å±æ€§çš„ Cookieã€‚","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"å®‰å…¨","slug":"å®‰å…¨","permalink":"https://www.codetool.top/tags/%E5%AE%89%E5%85%A8/"}]},{"title":"Sentinelä¸­çš„blockHandlerå’Œfallbackä»¥åŠè§„åˆ™æŒä¹…åŒ–é…ç½®","slug":"Sentinelä¸­çš„blockHandlerå’Œfallbackä»¥åŠè§„åˆ™æŒä¹…åŒ–é…ç½®","date":"2020-03-24T12:13:38.000Z","updated":"2020-03-24T12:13:56.561Z","comments":true,"path":"article/Sentinelä¸­çš„blockHandlerå’Œfallbackä»¥åŠè§„åˆ™æŒä¹…åŒ–é…ç½®/","link":"","permalink":"https://www.codetool.top/article/Sentinel%E4%B8%AD%E7%9A%84blockHandler%E5%92%8Cfallback%E4%BB%A5%E5%8F%8A%E8%A7%84%E5%88%99%E6%8C%81%E4%B9%85%E5%8C%96%E9%85%8D%E7%BD%AE/","excerpt":"","text":"1 çƒ­ç‚¹è§„åˆ™ä½•ä¸ºçƒ­ç‚¹ï¼Ÿçƒ­ç‚¹å³ç»å¸¸è®¿é—®çš„æ•°æ®ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡æŸä¸ªçƒ­ç‚¹æ•°æ®ä¸­è®¿é—®é¢‘æ¬¡æœ€é«˜çš„ Top K æ•°æ®ï¼Œå¹¶å¯¹å…¶è®¿é—®è¿›è¡Œé™åˆ¶ã€‚æ¯”å¦‚ï¼š å•†å“ ID ä¸ºå‚æ•°ï¼Œç»Ÿè®¡ä¸€æ®µæ—¶é—´å†…æœ€å¸¸è´­ä¹°çš„å•†å“ ID å¹¶è¿›è¡Œé™åˆ¶ ç”¨æˆ· ID ä¸ºå‚æ•°ï¼Œé’ˆå¯¹ä¸€æ®µæ—¶é—´å†…é¢‘ç¹è®¿é—®çš„ç”¨æˆ· ID è¿›è¡Œé™åˆ¶ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµã€‚çƒ­ç‚¹å‚æ•°é™æµå¯ä»¥çœ‹åšæ˜¯ä¸€ç§ç‰¹æ®Šçš„æµé‡æ§åˆ¶ï¼Œä»…å¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨ç”Ÿæ•ˆã€‚ Sentinel åˆ©ç”¨ LRU ç­–ç•¥ç»Ÿè®¡æœ€è¿‘æœ€å¸¸è®¿é—®çš„çƒ­ç‚¹å‚æ•°ï¼Œç»“åˆä»¤ç‰Œæ¡¶ç®—æ³•æ¥è¿›è¡Œå‚æ•°çº§åˆ«çš„æµæ§ã€‚çƒ­ç‚¹å‚æ•°é™æµæ”¯æŒé›†ç¾¤æ¨¡å¼ã€‚ 1.1 å®ä¾‹æˆ‘ä»¬åœ¨æ¨¡å—cloudalibaba-sentinel-service8401çš„controllerä¸­æ–°å»ºæ–¹æ³•ï¼š @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"dealTestHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false) String p1, @RequestParam(value = \"p2\", required = false) String p2){ return \"testHotKey -----\"; } public String dealTestHotKey(String p1, String p2, BlockException blockException){ return \"dealTestHotKey---------\"; } å®ƒçš„å«ä¹‰æ˜¯/testHotKeyåœ¨sentinelä¸­çš„èµ„æºåä¸ºtestHotKeyï¼Œå¦‚æœè¢«é™æµï¼Œåˆ™ä½¿ç”¨dealTestHotKeyæ–¹æ³•è¿›è¡Œå¤„ç†ã€‚ ä¸‹é¢æ–°å»ºçƒ­ç‚¹è§„åˆ™ï¼š è¿™é‡Œçš„å‚æ•°ç´¢å¼•å¯¹åº”çš„æ˜¯æ–¹æ³•ä¸­çš„å‚æ•°ç´¢å¼•ï¼Œå³p1ï¼Œè¯¥é…ç½®çš„å«ä¹‰ä¸ºï¼Œå¸¦p1å‚æ•°çš„è¯·æ±‚QPSä¸èƒ½è¶…è¿‡1ã€‚å¦åˆ™ä¼šä½¿ç”¨è‡ªå·±å®šä¹‰çš„dealTestHotKeyæ–¹æ³•è¿›è¡Œå¤„ç†ã€‚ 1.1.1 å‚æ•°ä¾‹å¤–é¡¹å¦‚æœçƒ­ç‚¹keyçš„å–å€¼ä¸ºæŸä¸ªæŒ‡å®šçš„å–å€¼ï¼Œå¯ä»¥ç‰¹æ®Šåœ°è¿›è¡Œæ”¾è¡Œï¼Œå°†ä¸Šé¢é…ç½®çš„çƒ­ç‚¹è§„åˆ™è¿›è¡Œç¼–è¾‘ï¼Œé€‰æ‹©é«˜çº§é€‰é¡¹ï¼Œé…ç½®å¦‚ä¸‹å‚æ•°ä¾‹å¤–é¡¹ï¼š è¯¥é…ç½®çš„å«ä¹‰ä¸ºï¼Œå¦‚æœp1çš„å–å€¼ä¸º5ï¼Œåˆ™QPSçš„é˜ˆå€¼å¯ä»¥æé«˜è‡³200ã€‚ 2 ç³»ç»Ÿè‡ªé€‚åº”é™æµSentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä»æ•´ä½“ç»´åº¦å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ ç³»ç»Ÿè§„åˆ™æ”¯æŒä»¥ä¸‹çš„æ¨¡å¼ï¼š Load è‡ªé€‚åº”ï¼ˆä»…å¯¹ Linux/Unix-like æœºå™¨ç”Ÿæ•ˆï¼‰ï¼šç³»ç»Ÿçš„ load1 ä½œä¸ºå¯å‘æŒ‡æ ‡ï¼Œè¿›è¡Œè‡ªé€‚åº”ç³»ç»Ÿä¿æŠ¤ã€‚å½“ç³»ç»Ÿ load1 è¶…è¿‡è®¾å®šçš„å¯å‘å€¼ï¼Œä¸”ç³»ç»Ÿå½“å‰çš„å¹¶å‘çº¿ç¨‹æ•°è¶…è¿‡ä¼°ç®—çš„ç³»ç»Ÿå®¹é‡æ—¶æ‰ä¼šè§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆBBR é˜¶æ®µï¼‰ã€‚ç³»ç»Ÿå®¹é‡ç”±ç³»ç»Ÿçš„ maxQps * minRt ä¼°ç®—å¾—å‡ºã€‚è®¾å®šå‚è€ƒå€¼ä¸€èˆ¬æ˜¯ CPU cores * 2.5ã€‚ å¹³å‡ RT(å“åº”æ—¶é—´)ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹³å‡ RT è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚ å¹¶å‘çº¿ç¨‹æ•°ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹¶å‘çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚ å…¥å£ QPSï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„ QPS è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚ CPU ä½¿ç”¨ç‡ï¼ˆ1.5.0+ ç‰ˆæœ¬ï¼‰ï¼šå½“ç³»ç»Ÿ CPU ä½¿ç”¨ç‡è¶…è¿‡é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆå–å€¼èŒƒå›´ 0.0-1.0ï¼‰ï¼Œæ¯”è¾ƒçµæ•ã€‚ è¯¥åŠŸèƒ½çš„é™æµç²’åº¦ä¸ºæ•´ä¸ªç³»ç»Ÿï¼Œéœ€è¦è°¨æ…é…ç½®ã€‚ 3 SentinelResourceæ³¨è§£å…³äº@SentinelResourceï¼Œæœ€åŸºæœ¬çš„ä½¿ç”¨å°±æ˜¯ï¼š @RestController public class RateLimitController { @GetMapping(\"/byResource\") @SentinelResource(value = \"byResource\", blockHandler = \"handleException\") public CommonResult byResource(){ return new CommonResult(200, \"æŒ‰èµ„æºåç§°é™æµæµ‹è¯•OK\", new Payment(2020L, IdUtil.simpleUUID())); } public CommonResult handleException(BlockException blockException){ return new CommonResult(444, blockException.getClass().getCanonicalName()+\"\\tæœåŠ¡ä¸å¯ç”¨\" ); } } å®ƒå®šä¹‰äº†èµ„æºåå’ŒBlockExceptionçš„å¤„ç†å™¨ï¼Œè¿™ä¸ªè‡ªå®šä¹‰çš„å¤„ç†å™¨å‚æ•°ç±»å‹éœ€è¦å’ŒåŸæ–¹æ³•ç›¸åŒ¹é…å¹¶ä¸”æœ€ååŠ ä¸€ä¸ªé¢å¤–çš„å‚æ•°ï¼Œç±»å‹ä¸º BlockExceptionã€‚ ç„¶è€Œè¿™æ ·çš„ä½¿ç”¨å­˜åœ¨ç€é—®é¢˜ï¼Œä¾‹å¦‚æ²¡æœ‰é»˜è®¤çš„å¤„ç†å™¨ï¼Œå¯¹æ¯ä¸ªæ–¹æ³•éƒ½å¾—é…ç½®ï¼Œå¦å¤–æ˜¯æŠŠé™çº§æ–¹æ³•å†™è¿›äº†controllerï¼Œé€ æˆè€¦åˆã€‚ 3.1 è‡ªå®šä¹‰é™æµå¤„ç†ç±»å°†é™æµå¤„ç†çš„æ–¹æ³•æå‡ºæ¥å¯ä»¥è§£è€¦ã€‚ public class CustomerBlockHandler { public static CommonResult handlerException1(BlockException exception) { return new CommonResult(400, \"å®¢æˆ·è‡ªå®šä¹‰ï¼Œglobal handlerException---1\"); } public static CommonResult handlerException2(BlockException exception) { return new CommonResult(444, \"å®¢æˆ·è‡ªå®šä¹‰ï¼Œglobal handlerException---2\"); } } æ³¨æ„å†…éƒ¨çš„å¤„ç†æ–¹æ³•å¿…é¡»æ˜¯staticçš„ã€‚ é‚£ä¹ˆåœ¨controllerä¸­å¯ä»¥å†™ï¼š @RestController public class RateLimitController { @GetMapping(\"/byResource\") @SentinelResource(value = \"byResource\", blockHandlerClass = CustomerBlockHandler.class, blockHandler = \"handlerException1\") public CommonResult byResource(){ return new CommonResult(200, \"æŒ‰èµ„æºåç§°é™æµæµ‹è¯•OK\", new Payment(2020L, IdUtil.simpleUUID())); } } 3.2 fallbackå’ŒdefaultFallbackblockHandleråªèƒ½å¤„ç†BlockExceptionå¼‚å¸¸ï¼Œå³é€šè¿‡é™æµã€ç†”æ–­ã€é™çº§é…ç½®çš„è¯·æ±‚æ‹¦æˆªæŠ›å‡ºçš„å¼‚å¸¸ï¼Œè€Œå¯¹äºæœåŠ¡æœ¬èº«æŠ›å‡ºçš„å¼‚å¸¸ä¸ä¼šå¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨fallbackå‡½æ•°æ¥å¤„ç†æŸä¸ªæ–¹æ³•æŠ›å‡ºçš„æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸ï¼ˆåŒ…æ‹¬BlockExceptionï¼‰ ç›¸å…³çš„@SentinelResourceçš„ä¸‰ä¸ªå±æ€§ï¼š fallbackï¼šfallback å‡½æ•°åç§°ï¼Œå¯é€‰é¡¹ï¼Œç”¨äºåœ¨æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™æä¾› fallback å¤„ç†é€»è¾‘ã€‚fallback å‡½æ•°å¯ä»¥é’ˆå¯¹æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸ï¼ˆé™¤äº† exceptionsToIgnore é‡Œé¢æ’é™¤æ‰çš„å¼‚å¸¸ç±»å‹ï¼‰è¿›è¡Œå¤„ç†ã€‚fallback å‡½æ•°ç­¾åå’Œä½ç½®è¦æ±‚ï¼š è¿”å›å€¼ç±»å‹å¿…é¡»ä¸åŸå‡½æ•°è¿”å›å€¼ç±»å‹ä¸€è‡´ï¼› æ–¹æ³•å‚æ•°åˆ—è¡¨éœ€è¦å’ŒåŸå‡½æ•°ä¸€è‡´ï¼Œæˆ–è€…å¯ä»¥é¢å¤–å¤šä¸€ä¸ª Throwable ç±»å‹çš„å‚æ•°ç”¨äºæ¥æ”¶å¯¹åº”çš„å¼‚å¸¸ã€‚ fallback å‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®š fallbackClass ä¸ºå¯¹åº”çš„ç±»çš„ Class å¯¹è±¡ï¼Œæ³¨æ„å¯¹åº”çš„å‡½æ•°å¿…éœ€ä¸º static å‡½æ•°ï¼Œå¦åˆ™æ— æ³•è§£æã€‚ defaultFallbackï¼šé»˜è®¤çš„ fallback å‡½æ•°åç§°ï¼Œå¯é€‰é¡¹ï¼Œé€šå¸¸ç”¨äºé€šç”¨çš„ fallback é€»è¾‘ï¼ˆå³å¯ä»¥ç”¨äºå¾ˆå¤šæœåŠ¡æˆ–æ–¹æ³•ï¼‰ã€‚é»˜è®¤ fallback å‡½æ•°å¯ä»¥é’ˆå¯¹æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸ï¼ˆé™¤äº† exceptionsToIgnore é‡Œé¢æ’é™¤æ‰çš„å¼‚å¸¸ç±»å‹ï¼‰è¿›è¡Œå¤„ç†ã€‚è‹¥åŒæ—¶é…ç½®äº† fallback å’Œ defaultFallbackï¼Œåˆ™åªæœ‰ fallback ä¼šç”Ÿæ•ˆã€‚ exceptionsToIgnoreï¼šç”¨äºæŒ‡å®šå“ªäº›å¼‚å¸¸è¢«æ’é™¤æ‰ï¼Œä¸ä¼šè®¡å…¥å¼‚å¸¸ç»Ÿè®¡ä¸­ï¼Œä¹Ÿä¸ä¼šè¿›å…¥ fallback é€»è¾‘ä¸­ï¼Œè€Œæ˜¯ä¼šåŸæ ·æŠ›å‡ºã€‚è¿™ä¸ªå±æ€§çš„å€¼æ˜¯ä¸€ä¸ªclasså¯¹è±¡çš„é›†åˆï¼šexceptionsToIgnore={xxx.class,xxx.class} 4 è§„åˆ™æŒä¹…åŒ–sentinelä¸­çš„æœåŠ¡å¦‚æœä¸€ä¸‹çº¿ï¼Œé…ç½®è¿‡çš„è§„åˆ™éƒ½ä¼šæ¶ˆå¤±ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦å°†é…ç½®è§„åˆ™è¿›è¡ŒæŒä¹…åŒ–ã€‚ å¦‚ä½•æŒä¹…åŒ–ï¼Ÿ ä¸å¾—ä¸è¯´è¿™éƒ¨åˆ†ç¡®å®æœ‰ç‚¹è¿·ï¼Œå®˜æ–¹å¯¹è¿™éƒ¨åˆ†çš„æè¿°æ„Ÿè§‰è¿™ä¸ªåŠŸèƒ½ä¸æ˜¯å¾ˆæˆç†ŸğŸ˜”ã€‚ æˆ‘æ˜¯è¿™æ ·åšçš„ï¼š é¦–å…ˆä¿è¯å¼•å…¥ä¾èµ–ï¼ˆä¹‹å‰å·²ç»å¼•å…¥ï¼‰ï¼š &lt;dependency> &lt;groupId>com.alibaba.csp&lt;/groupId> &lt;artifactId>sentinel-datasource-nacos&lt;/artifactId> &lt;/dependency> ä¿®æ”¹é…ç½®ï¼šï¼ˆå¾…ä¼šä»nacosæ‹‰å–é…ç½®ï¼‰ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: server-addr: localhost:8848 sentinel: transport: dashboard: localhost:8080 port: 8719 datasource: ds1: nacos: server-addr: localhost:8848 dataId: ${spring.application.name}-flow-rules groupId: SENTINEL_GROUP data-type: json rule-type: flow management: endpoints: web: exposure: include: '*' å› ä¸ºè¦ç”¨pushæ¨¡å¼ï¼Œå¤§æ¦‚åŸç†æ˜¯sentinel-dashboardç›´æ¥æŠŠé…ç½®æ¨åˆ°nacosä¸Šé¢ï¼Œè€Œsentinelå®¢æˆ·ç«¯ç›‘å¬è¯¥é…ç½®çš„ä¿®æ”¹ï¼ŒåŠ¨æ€è·å–è¯¥é…ç½®ã€‚ æ‰€ä»¥è¿˜å¾—ä¿®æ”¹sentinel-dashboardï¼Œå…ˆå»githubä¸ŠæŠŠsentinelçš„æºç ä¸‹ä¸‹æ¥ï¼Œç„¶åå°†sentinel-dashboard\\src\\test\\java\\com\\alibaba\\csp\\sentinel\\dashboard\\rule\\nacoså¤åˆ¶åˆ°sentinel-dashboard\\src\\main\\java\\com\\alibaba\\csp\\sentinel\\dashboard\\ruleä¸‹é¢ã€‚ ä¿®æ”¹sentinel-dashboard\\ä¸‹é¢çš„pom.xmlæ–‡ä»¶ï¼Œå°† &lt;dependency> &lt;groupId>com.alibaba.csp&lt;/groupId> &lt;artifactId>sentinel-datasource-nacos&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;/dependency> ä¸­çš„&lt;scope&gt;test&lt;/scope&gt;å»æ‰ã€‚ ç„¶åä¿®æ”¹entinel-dashboard\\src\\main\\java\\com\\alibaba\\csp\\sentinel\\dashboard\\controller\\v2ä¸‹é¢çš„FlowControllerV2.javaï¼š @Autowired // @Qualifier(\"flowRuleDefaultProvider\")ä¿®æ”¹ä¸º @Qualifier(\"flowRuleNacosProvider\") private DynamicRuleProvider&lt;List&lt;FlowRuleEntity>> ruleProvider; @Autowired // @Qualifier(\"flowRuleDefaultPublisher\")ä¿®æ”¹ä¸º @Qualifier(\"flowRuleNacosPublisher\") private DynamicRulePublisher&lt;List&lt;FlowRuleEntity>> rulePublisher; ç„¶åä¿®æ”¹sentinel-dashboard\\src\\main\\webapp\\resources\\app\\scripts\\directives\\sidebarä¸‹é¢çš„sidebar.htmlæ–‡ä»¶ï¼š &lt;li ui-sref-active=\"active\" ng-if=\"!entry.isGateway\"> &lt;!-- &lt;a ui-sref=\"dashboard.flowV1({app: entry.app})\"> ä¿®æ”¹ä¸º--> &lt;a ui-sref=\"dashboard.flow({app: entry.app})\"> &lt;i class=\"glyphicon glyphicon-filter\">&lt;/i>&amp;nbsp;&amp;nbsp;æµæ§è§„åˆ™V2&lt;/a> &lt;/li> ä¹‹åï¼Œè¿›å…¥sentinel-dashbordç›®å½•ï¼Œé‡æ–°æ‰“åŒ…ï¼š mvn clean packageç„¶ååœ¨target/ç›®å½•ä¸‹è¿è¡Œé‡æ–°ç”Ÿæˆçš„åŒ…ï¼Œè¯•è¯•çœ‹é…ç½®èƒ½ä¸èƒ½æŒä¹…åŒ–ã€‚ é™„ä¸Šå®˜æ–¹æ–‡æ¡£ï¼š https://github.com/alibaba/Sentinel/wiki/Sentinel-%E6%8E%A7%E5%88%B6%E5%8F%B0%EF%BC%88%E9%9B%86%E7%BE%A4%E6%B5%81%E6%8E%A7%E7%AE%A1%E7%90%86%EF%BC%89#%E8%A7%84%E5%88%99%E9%85%8D%E7%BD%AE","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"},{"name":"Sentinel","slug":"Sentinel","permalink":"https://www.codetool.top/tags/Sentinel/"}]},{"title":"Sentinelæµæ§è§„åˆ™ä¸é™çº§è§„åˆ™","slug":"Sentinelæµæ§è§„åˆ™ä¸é™çº§è§„åˆ™","date":"2020-03-24T02:40:47.000Z","updated":"2020-03-24T05:10:42.792Z","comments":true,"path":"article/Sentinelæµæ§è§„åˆ™ä¸é™çº§è§„åˆ™/","link":"","permalink":"https://www.codetool.top/article/Sentinel%E6%B5%81%E6%8E%A7%E8%A7%84%E5%88%99%E4%B8%8E%E9%99%8D%E7%BA%A7%E8%A7%84%E5%88%99/","excerpt":"","text":"1 Sentinelæ¦‚è¿°1.1 Sentinel æ˜¯ä»€ä¹ˆï¼Ÿ éšç€å¾®æœåŠ¡çš„æµè¡Œï¼ŒæœåŠ¡å’ŒæœåŠ¡ä¹‹é—´çš„ç¨³å®šæ€§å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚Sentinel ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§ã€‚ Sentinelå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š ä¸°å¯Œçš„åº”ç”¨åœºæ™¯ï¼š Sentinel æ‰¿æ¥äº†é˜¿é‡Œå·´å·´è¿‘ 10 å¹´çš„åŒåä¸€å¤§ä¿ƒæµé‡çš„æ ¸å¿ƒåœºæ™¯ï¼Œä¾‹å¦‚ç§’æ€ï¼ˆå³çªå‘æµé‡æ§åˆ¶åœ¨ç³»ç»Ÿå®¹é‡å¯ä»¥æ‰¿å—çš„èŒƒå›´ï¼‰ã€æ¶ˆæ¯å‰Šå³°å¡«è°·ã€é›†ç¾¤æµé‡æ§åˆ¶ã€å®æ—¶ç†”æ–­ä¸‹æ¸¸ä¸å¯ç”¨åº”ç”¨ç­‰ã€‚ å®Œå¤‡çš„å®æ—¶ç›‘æ§ï¼š Sentinel åŒæ—¶æä¾›å®æ—¶çš„ç›‘æ§åŠŸèƒ½ã€‚æ‚¨å¯ä»¥åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°æ¥å…¥åº”ç”¨çš„å•å°æœºå™¨ç§’çº§æ•°æ®ï¼Œç”šè‡³ 500 å°ä»¥ä¸‹è§„æ¨¡çš„é›†ç¾¤çš„æ±‡æ€»è¿è¡Œæƒ…å†µã€‚ å¹¿æ³›çš„å¼€æºç”Ÿæ€ï¼š Sentinel æä¾›å¼€ç®±å³ç”¨çš„ä¸å…¶å®ƒå¼€æºæ¡†æ¶/åº“çš„æ•´åˆæ¨¡å—ï¼Œä¾‹å¦‚ä¸ Spring Cloudã€Dubboã€gRPC çš„æ•´åˆã€‚æ‚¨åªéœ€è¦å¼•å…¥ç›¸åº”çš„ä¾èµ–å¹¶è¿›è¡Œç®€å•çš„é…ç½®å³å¯å¿«é€Ÿåœ°æ¥å…¥ Sentinelã€‚ å®Œå–„çš„ SPI æ‰©å±•ç‚¹ï¼š Sentinel æä¾›ç®€å•æ˜“ç”¨ã€å®Œå–„çš„ SPI æ‰©å±•æ¥å£ã€‚æ‚¨å¯ä»¥é€šè¿‡å®ç°æ‰©å±•æ¥å£æ¥å¿«é€Ÿåœ°å®šåˆ¶é€»è¾‘ã€‚ä¾‹å¦‚å®šåˆ¶è§„åˆ™ç®¡ç†ã€é€‚é…åŠ¨æ€æ•°æ®æºç­‰ã€‚ å¯ä»¥ä»£æ›¿Hystrixã€Sleuth 2 ä¸‹è½½å’Œè¿è¡Œä¸‹è½½åœ°å€ï¼šhttps://github.com/alibaba/Sentinel/releases è¿™é‡Œé€‰æ‹© sentinel-dashboard-1.7.1.jar ä¸‹è½½ ä¸‹è½½æˆåŠŸåç›´æ¥è¿è¡Œï¼š java -jar .\\sentinel-dashboard-1.7.1.jar å¯åŠ¨æˆåŠŸåç›´æ¥è®¿é—® http://localhost:8080 å³å¯çœ‹åˆ°ç®¡ç†ç•Œé¢ï¼Œé»˜è®¤ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯sentinelã€‚ 3 æ„å»ºæµ‹è¯•æ¨¡å—æ–°å»ºæ¨¡å—cloudalibaba-sentinel-service8401ï¼Œä¾èµ–å¦‚ä¸‹ï¼š &lt;dependency> &lt;groupId>com.alibaba.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId> &lt;/dependency> &lt;!-- sentinel-datasource-nacos åç»­æŒä¹…åŒ–ç”¨ --> &lt;dependency> &lt;groupId>com.alibaba.csp&lt;/groupId> &lt;artifactId>sentinel-datasource-nacos&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>com.alibaba.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-alibaba-sentinel&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-openfeign&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-web&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-actuator&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-test&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;/dependency> &lt;dependency> &lt;groupId>com.rhett&lt;/groupId> &lt;artifactId>cloud-api-commons&lt;/artifactId> &lt;version>${project.version}&lt;/version> &lt;/dependency> yamlé…ç½®ï¼š server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: server-addr: localhost:1111 sentinel: transport: dashboard: localhost:8080 # é»˜è®¤8719ç«¯å£ï¼Œå¦‚æœè¢«å ç”¨ä¼šä»8719å¼€å§‹ä¾æ¬¡+1æ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ port: 8719 management: endpoints: web: exposure: include: '*' å¯åŠ¨ç±»ï¼š @SpringBootApplication @EnableDiscoveryClient public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } controller: @RestController @Slf4j public class FlowLimitController { @GetMapping(\"/testA\") public String testA(){ return \"testA-----\"; } @GetMapping(\"/testB\") public String testB(){ log.info(Thread.currentThread().getName() + \"...testB \"); return \"testB -----\"; } } è‡³æ­¤è¯¥æ¨¡å—æ„å»ºå®Œæˆï¼Œè®¿é—®ä¸€æ¬¡ http://localhost:8401/testA ï¼Œå³è‡³å°‘è°ƒç”¨ä¸€æ¬¡è¯¥æœåŠ¡ï¼Œå°±å¯ä»¥åœ¨sentinelçš„æ§åˆ¶ç•Œé¢ä¸Šçœ‹åˆ°è¯¥æœåŠ¡äº†ã€‚ 4 å®æ—¶ç›‘æ§ 5 æµæ§è§„åˆ™ èµ„æºåï¼šå”¯ä¸€åç§°,é»˜è®¤è¯·æ±‚è·¯å¾„ é’ˆå¯¹æ¥æº: Sentineå¯ä»¥é’ˆå¯¹è°ƒç”¨è€…è¿›è¡Œé™æµï¼Œå¡«å†™å¾®æœåŠ¡å,é»˜è®¤default (ä¸åŒºåˆ†æ¥æº) é˜ˆå€¼ç±»å‹/å•æœºé˜ˆå€¼: QPS (æ¯ç§’é’Ÿçš„è¯·æ±‚æ•°é‡) :å½“è°ƒç”¨è¯¥apiçš„QPSè¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™,è¿›è¡Œé™æµ çº¿ç¨‹æ•°:å½“è°ƒç”¨è¯¥apiçš„çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™ï¼Œè¿›è¡Œé™æµ æ˜¯å¦é›†ç¾¤ï¼šä¸éœ€è¦é›†ç¾¤ æµæ§æ¨¡å¼ ç›´æ¥: apiè¾¾åˆ°é™æµæ¡ä»¶æ—¶ï¼Œç›´æ¥é™æµ å…³è”: å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·± é“¾è·¯: åªè®°å½•æŒ‡å®šé“¾è·¯ä¸Šçš„æµé‡(æŒ‡å®šèµ„æºä»å…¥å£èµ„æºè¿›æ¥çš„æµé‡,å¦‚æœè¾¾åˆ°é˜ˆå€¼,å°±è¿›è¡Œé™æµ) ã€apiçº§åˆ«çš„é’ˆå¯¹æ¥æºã€‘ æµæ§æ•ˆæœ: å¿«é€Ÿå¤±è´¥ï¼šç›´æ¥å¤±è´¥,æŠ›å¼‚å¸¸ Warm Upï¼šæ ¹æ®codeFactor(å†·åŠ è½½å› å­ï¼Œé»˜è®¤3)çš„å€¼ï¼Œä»é˜ˆå€¼/codeFactor, ç»è¿‡é¢„çƒ­æ—¶é•¿ï¼Œæ‰è¾¾åˆ°è®¾ç½®çš„QPSé˜ˆå€¼ æ’é˜Ÿç­‰å¾…ï¼šåŒ€é€Ÿæ’é˜Ÿ,è®©è¯·æ±‚ä»¥åŒ€é€Ÿçš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼ç±»å‹å¿…é¡»è®¾ç½®ä¸ºQPSï¼Œå¦åˆ™æ— æ•ˆ 5.1 æµæ§æ¨¡å¼5.1.1 ç›´æ¥æˆ‘ä»¬æ–°å»ºå¦‚ä¸‹æµæ§è§„åˆ™ï¼š å³QPSæœ€é«˜ä¸º1ã€‚ è®¾ç½®å®Œæˆä¹‹åé¢‘ç¹è®¿é—® http://localhost:8401/testA å¯è§è¶…è¿‡QPSçš„è¯·æ±‚ç½‘é¡µå“åº”ï¼š Blocked by Sentinel (flow limiting)è€Œå¦‚æœè®¾ç½®é˜ˆå€¼ä¸ºçº¿ç¨‹æ•°æœ€é«˜ä¸º1ï¼Œå› ä¸ºè¯·æ±‚å¤„ç†çš„å¾ˆå¿«çœ‹ä¸å‡ºæ•ˆæœï¼Œå¯ä»¥åšå¦‚ä¸‹ä¿®æ”¹ï¼š @GetMapping(\"/testA\") public String testA() throws InterruptedException { //ç­‰å¾…0.8ç§’ TimeUnit.MILLISECONDS.sleep(800); return \"testA-----\"; } å†æ¬¡é¢‘ç¹è®¿é—®ç½‘é¡µï¼Œå°±å¯ä»¥çœ‹åˆ°éƒ¨åˆ†è¯·æ±‚è¢«é˜»æ‹¦ã€‚ 5.1.2 å…³è”å½“ä¸¤ä¸ªèµ„æºä¹‹é—´å…·æœ‰èµ„æºäº‰æŠ¢æˆ–è€…ä¾èµ–å…³ç³»çš„æ—¶å€™ï¼Œè¿™ä¸¤ä¸ªèµ„æºä¾¿å…·æœ‰äº†å…³è”ã€‚æ¯”å¦‚å¯¹æ•°æ®åº“åŒä¸€ä¸ªå­—æ®µçš„è¯»æ“ä½œå’Œå†™æ“ä½œå­˜åœ¨äº‰æŠ¢ï¼Œè¯»çš„é€Ÿåº¦è¿‡é«˜ä¼šå½±å“å†™å¾—é€Ÿåº¦ï¼Œå†™çš„é€Ÿåº¦è¿‡é«˜ä¼šå½±å“è¯»çš„é€Ÿåº¦ã€‚å¦‚æœæ”¾ä»»è¯»å†™æ“ä½œäº‰æŠ¢èµ„æºï¼Œåˆ™äº‰æŠ¢æœ¬èº«å¸¦æ¥çš„å¼€é”€ä¼šé™ä½æ•´ä½“çš„ååé‡ã€‚å¯ä½¿ç”¨å…³è”é™æµæ¥é¿å…å…·æœ‰å…³è”å…³ç³»çš„èµ„æºä¹‹é—´è¿‡åº¦çš„äº‰æŠ¢ã€‚ æ–°å»ºå¦‚ä¸‹æµæ§è§„åˆ™ï¼š è¯¥æµæ§è§„åˆ™çš„æ„æ€æ˜¯ï¼Œå¦‚æœå¯¹/testBçš„QPSå¤§äº1ï¼Œåˆ™å¯¹/testAè¿›è¡Œé™æµ è¯¥æµæ§è§„åˆ™é€šå¸¸ç”¨äºä¸¤ä¸ªèµ„æºå­˜åœ¨ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§ä½çš„ç»™ä¼˜å…ˆçº§é«˜çš„è®©èµ„æºã€‚ 5.1.3 é“¾è·¯èµ„æºä¸­æ˜¯å­˜åœ¨ç€è°ƒç”¨å…³ç³»çš„ï¼ŒSentinel å…è®¸åªæ ¹æ®æŸä¸ªå…¥å£çš„ç»Ÿè®¡ä¿¡æ¯å¯¹èµ„æºé™æµã€‚æ¯”å¦‚ä¸‹é¢è¿™æ£µè°ƒç”¨æ ‘ï¼š machine-root / \\ / \\ Entrance1 Entrance2 / \\ / \\ DefaultNode(nodeA) DefaultNode(nodeA)nodeAèµ„æºå¯ä»¥é€šè¿‡Entrance1æˆ–è€…Entrance2èµ„æºå¾—åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹nodeAè¿›è¡Œé™æµï¼ŒæŒ‡å®šæµæ§è§„åˆ™ä¸ºé“¾è·¯ï¼Œå¹¶æŒ‡å®šå…¥å£èµ„æºä¸º/Entrance1ï¼Œå°±å¯ä»¥åªå¯¹æ¥è‡ª/Entrance1çš„è°ƒç”¨é™æµï¼Œè€Œä¸å¯¹æ¥è‡ª/Entrance2çš„è°ƒç”¨é™æµ 5.2 æµæ§æ•ˆæœ5.2.1 warm upä¸Šé¢çš„æ¡ˆä¾‹ä¸­æˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨çš„æµæ§æ•ˆæœä¸­çš„å¿«é€Ÿå¤±è´¥ï¼Œè€Œæµæ§æ•ˆæœä¸­çš„warm upï¼Œå³é¢„çƒ­/å†·å¯åŠ¨æ–¹å¼ã€‚å½“ç³»ç»Ÿé•¿æœŸå¤„äºä½æ°´ä½çš„æƒ…å†µä¸‹ï¼Œå½“æµé‡çªç„¶å¢åŠ æ—¶ï¼Œç›´æ¥æŠŠç³»ç»Ÿæ‹‰å‡åˆ°é«˜æ°´ä½å¯èƒ½ç¬é—´æŠŠç³»ç»Ÿå‹å®ã€‚é€šè¿‡â€å†·å¯åŠ¨â€ï¼Œè®©é€šè¿‡çš„æµé‡ç¼“æ…¢å¢åŠ ï¼Œåœ¨ä¸€å®šæ—¶é—´å†…é€æ¸å¢åŠ åˆ°é˜ˆå€¼ä¸Šé™ï¼Œç»™å†·ç³»ç»Ÿä¸€ä¸ªé¢„çƒ­çš„æ—¶é—´ï¼Œé¿å…å†·ç³»ç»Ÿè¢«å‹å®ã€‚ï¼ˆé€šå¸¸å’Œæ­¤æ—¶ç³»ç»Ÿä¸­æ²¡æœ‰è¶³é‡çš„ç¼“å­˜æ•°æœ‰å…³ï¼‰ æ ¹æ®codeFactor(å†·åŠ è½½å› å­ï¼Œé»˜è®¤3)çš„å€¼ï¼Œè¯·æ±‚QPSä»é˜ˆå€¼/codeFactorå¼€å§‹, ç»è¿‡é¢„çƒ­æ—¶é•¿ï¼Œé€æ¸å‡è‡³è®¾ç½®çš„QPSé˜ˆå€¼ã€‚ æˆ‘ä»¬å»ºç«‹å¦‚ä¸‹é…ç½®ï¼š å®ƒçš„æ„æ€åˆ™æ˜¯QPSä»300/3=100å¼€å§‹ï¼Œåœ¨10ç§’å†…é€æ¸å‡è‡³300 5.2.2 æ’é˜Ÿç­‰å¾…åŒ€é€Ÿæ’é˜Ÿæ–¹å¼ä¼šä¸¥æ ¼æ§åˆ¶è¯·æ±‚é€šè¿‡çš„é—´éš”æ—¶é—´ï¼Œä¹Ÿå³æ˜¯è®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œå¯¹åº”çš„æ˜¯æ¼æ¡¶ç®—æ³•ã€‚ è¯¥æ–¹å¼çš„ä½œç”¨å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ’é˜Ÿç­‰å¾…å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼š è¯¥è§„åˆ™çš„æ•ˆæœæ˜¯ï¼ŒQPSä¸Šé™ä¸º2ï¼Œè¶…è¿‡QPSçš„è¯·æ±‚æ’é˜Ÿç­‰å¾…ï¼Œæ’é˜Ÿæ—¶é—´è¶…è¿‡10ç§’åˆ™å¿«é€Ÿå¤±è´¥ã€‚ 6 é™çº§è§„åˆ™é€‰æ‹©æ–°å»ºé™çº§è§„åˆ™ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹é…ç½®çª— å®ƒæ”¯æŒä¸‰ç§é™çº§ç­–ç•¥ï¼Œè€ŒHystrixä¼¼ä¹åªæœ‰å¼‚å¸¸æ¯”ä¾‹ã€‚ Sentinelæ–­è·¯å™¨æ²¡æœ‰åŠå¼€çŠ¶æ€ï¼Œæ—¶é—´çª—å£è¿‡äº†å°±ç›´æ¥æ‰“å¼€ã€‚ï¼ˆè€Œhystrixä¸­çš„æ—¶é—´çª—å£æ¦‚å¿µæ˜¯ä¸€ä¸ªç»Ÿè®¡å¤±è´¥ç‡çš„æ—¶é—´èŒƒå›´ï¼‰ 6.1 RTRTï¼ˆå¹³å‡å“åº”æ—¶é—´ï¼‰ï¼šå½“ 1s å†…æŒç»­è¿›å…¥ 5 ä¸ªè¯·æ±‚ï¼Œå¯¹åº”æ—¶åˆ»çš„å¹³å‡å“åº”æ—¶é—´ï¼ˆç§’çº§ï¼‰å‡è¶…è¿‡é˜ˆå€¼ï¼ˆcountï¼Œä»¥ ms ä¸ºå•ä½ï¼‰ï¼Œé‚£ä¹ˆåœ¨æ¥ä¸‹çš„æ—¶é—´çª—å£ä¹‹å†…ï¼Œå¯¹è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šè‡ªåŠ¨åœ°ç†”æ–­ï¼ˆæŠ›å‡º DegradeExceptionï¼‰ã€‚æ³¨æ„ Sentinel é»˜è®¤ç»Ÿè®¡çš„ RT ä¸Šé™æ˜¯ 4900 msï¼Œè¶…å‡ºæ­¤é˜ˆå€¼çš„éƒ½ä¼šç®—ä½œ 4900 msï¼Œè‹¥éœ€è¦å˜æ›´æ­¤ä¸Šé™å¯ä»¥é€šè¿‡å¯åŠ¨é…ç½®é¡¹ -Dcsp.sentinel.statistic.max.rt=xxx æ¥é…ç½®ã€‚ 6.2 å¼‚å¸¸æ¯”ä¾‹å¼‚å¸¸æ¯”ä¾‹ï¼šå½“èµ„æºçš„æ¯ç§’è¯·æ±‚é‡ &gt;= 5ï¼Œå¹¶ä¸”æ¯ç§’å¼‚å¸¸æ€»æ•°å é€šè¿‡é‡çš„æ¯”å€¼è¶…è¿‡é˜ˆå€¼ï¼ˆDegradeRule ä¸­çš„ countï¼‰ä¹‹åï¼Œèµ„æºè¿›å…¥é™çº§çŠ¶æ€ï¼Œå³åœ¨æ¥ä¸‹çš„æ—¶é—´çª—å£ä¹‹å†…ï¼Œå¯¹è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šè‡ªåŠ¨åœ°è¿”å›ã€‚å¼‚å¸¸æ¯”ç‡çš„é˜ˆå€¼èŒƒå›´æ˜¯ [0.0, 1.0]ï¼Œä»£è¡¨ 0% - 100%ã€‚ 6.3 å¼‚å¸¸æ•°å¼‚å¸¸æ•°ï¼šå½“èµ„æºè¿‘ 1 åˆ†é’Ÿçš„å¼‚å¸¸æ•°ç›®è¶…è¿‡é˜ˆå€¼ä¹‹åä¼šè¿›è¡Œç†”æ–­ã€‚ æ³¨æ„ç”±äºç»Ÿè®¡æ—¶é—´çª—å£æ˜¯åˆ†é’Ÿçº§åˆ«çš„ï¼Œè‹¥ timeWindow å°äº 60sï¼Œåˆ™ç»“æŸç†”æ–­çŠ¶æ€åä»å¯èƒ½å†è¿›å…¥ç†”æ–­çŠ¶æ€ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"},{"name":"Sentinel","slug":"Sentinel","permalink":"https://www.codetool.top/tags/Sentinel/"}]},{"title":"ç¨‹åºå‘˜é¢è¯•é‡‘å…¸17.16-æŒ‰æ‘©å¸ˆ","slug":"ç¨‹åºå‘˜é¢è¯•é‡‘å…¸17.16-æŒ‰æ‘©å¸ˆ","date":"2020-03-24T01:53:36.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/ç¨‹åºå‘˜é¢è¯•é‡‘å…¸17.16-æŒ‰æ‘©å¸ˆ/","link":"","permalink":"https://www.codetool.top/article/%E7%A8%8B%E5%BA%8F%E5%91%98%E9%9D%A2%E8%AF%95%E9%87%91%E5%85%B817.16-%E6%8C%89%E6%91%A9%E5%B8%88/","excerpt":"","text":"1 åŸé¢˜ï¼ˆæ¥æºLeetcodeï¼‰ä¸€ä¸ªæœ‰åçš„æŒ‰æ‘©å¸ˆä¼šæ”¶åˆ°æºæºä¸æ–­çš„é¢„çº¦è¯·æ±‚ï¼Œæ¯ä¸ªé¢„çº¦éƒ½å¯ä»¥é€‰æ‹©æ¥æˆ–ä¸æ¥ã€‚åœ¨æ¯æ¬¡é¢„çº¦æœåŠ¡ä¹‹é—´è¦æœ‰ä¼‘æ¯æ—¶é—´ï¼Œå› æ­¤å¥¹ä¸èƒ½æ¥å—ç›¸é‚»çš„é¢„çº¦ã€‚ç»™å®šä¸€ä¸ªé¢„çº¦è¯·æ±‚åºåˆ—ï¼Œæ›¿æŒ‰æ‘©å¸ˆæ‰¾åˆ°æœ€ä¼˜çš„é¢„çº¦é›†åˆï¼ˆæ€»é¢„çº¦æ—¶é—´æœ€é•¿ï¼‰ï¼Œè¿”å›æ€»çš„åˆ†é’Ÿæ•°ã€‚ æ³¨æ„ï¼š æœ¬é¢˜ç›¸å¯¹åŸé¢˜ç¨ä½œæ”¹åŠ¨ ç¤ºä¾‹ 1: è¾“å…¥ï¼š [1,2,3,1]è¾“å‡ºï¼š 4è§£é‡Šï¼š é€‰æ‹© 1 å·é¢„çº¦å’Œ 3 å·é¢„çº¦ï¼Œæ€»æ—¶é•¿ = 1 + 3 = 4ã€‚ ç¤ºä¾‹ 2: è¾“å…¥: [2,7,9,3,1]è¾“å‡º: 12è§£é‡Š: é€‰æ‹© 1 å·é¢„çº¦ã€ 3 å·é¢„çº¦å’Œ 5 å·é¢„çº¦ï¼Œæ€»æ—¶é•¿ = 2 + 9 + 1 = 12ã€‚ ç¤ºä¾‹ 3: è¾“å…¥: [2,1,4,5,3,1,1,3]è¾“å‡º: 12è§£é‡Š: é€‰æ‹© 1 å·é¢„çº¦ã€ 3 å·é¢„çº¦ã€ 5 å·é¢„çº¦å’Œ 8 å·é¢„çº¦ï¼Œæ€»æ—¶é•¿ = 2 + 4 + 3 + 3 = 12ã€‚ 2 è§£æ³•2.1 æ€æƒ³åŠ¨æ€è§„åˆ’ï¼Œä¸ºäº†é¿å…é‡å¤è®¡ç®—ï¼Œå¯ä»¥ä½¿ç”¨è‡ªé¡¶å‘ä¸‹+è®°å¿†ï¼Œæˆ–è€…æ˜¯è‡ªåº•å‘ä¸Šã€‚ 2.2 ä»£ç è‡ªé¡¶å‘ä¸‹+è®°å¿†ï¼š class Solution { int[] numsGlo; Integer[] dp; public int massage(int[] nums) { numsGlo = nums; dp = new Integer[nums.length]; return dp(nums.length-1); } public int dp(int index){ if(index &lt; 0) return 0; if(index == 0) return numsGlo[index]; if(dp[index]!=null) return dp[index]; int result = Math.max(dp(index-2)+numsGlo[index],dp(index-1)); dp[index] = result; return result; } } è‡ªåº•å‘ä¸Šï¼šï¼ˆä½œè€…ï¼šsweetieeï¼‰ class Solution { public int massage(int[] nums) { int n = nums.length; if (n == 0) { return 0; } if (n == 1) { return nums[0]; } int[] dp = new int[n]; dp[0] = nums[0]; dp[1] = Math.max(nums[0], nums[1]); for (int i = 2; i &lt; n; i++) { dp[i] = Math.max(dp[i - 1], dp[i - 2] + nums[i]); } return dp[n - 1]; } } è‡ªåº•å‘ä¸Šï¼Œä¸éœ€è¦å­˜å‚¨ï¼šï¼ˆä½œè€…ï¼šsweetieeï¼‰ class Solution { public int massage(int[] nums) { int a = 0, b = 0; for (int i = 0; i &lt; nums.length; i++) { int c = Math.max(b, a + nums[i]); a = b; b = c; } return b; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"Nacosé›†ç¾¤æ­å»ºå®æ“","slug":"Nacosé›†ç¾¤æ­å»ºå®æ“","date":"2020-03-23T13:57:00.000Z","updated":"2020-03-23T14:39:53.681Z","comments":true,"path":"article/Nacosé›†ç¾¤æ­å»ºå®æ“/","link":"","permalink":"https://www.codetool.top/article/Nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E5%AE%9E%E6%93%8D/","excerpt":"","text":"1 å°†æ•°æ®å­˜å‚¨åˆ‡æ¢ä¸ºmysqlé»˜è®¤Nacosä½¿ç”¨åµŒå…¥å¼æ•°æ®åº“derbyå®ç°æ•°æ®çš„å­˜å‚¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœå¯åŠ¨å¤šä¸ªé»˜è®¤é…ç½®ä¸‹çš„NacosèŠ‚ç‚¹ï¼Œæ•°æ®å­˜å‚¨æ˜¯å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒNacosé‡‡ç”¨äº†é›†ä¸­å¼å­˜å‚¨çš„æ–¹å¼æ¥æ”¯æŒé›†ç¾¤åŒ–éƒ¨ç½²,ç›®å‰åªæ”¯æŒMySQLçš„å­˜å‚¨ã€‚ åœ¨nacoså®‰è£…ç›®å½•ä¸‹çš„conf/æ–‡ä»¶å¤¹ä¸‹æœ‰ä¸€ä¸ªnacos-mysql.sqlæ–‡ä»¶ï¼Œä½¿ç”¨mysqlæ‰§è¡Œè¯¥sqlæ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰å»ºdatabaseå¯ä»¥å…ˆæ–°å»ºdatabaseï¼š create database nacos_config; use nacos_config; æ‰§è¡ŒæˆåŠŸä¹‹åå¯ä»¥çœ‹åˆ°ä¸‹é¢è¿™äº›è¡¨ï¼š ç„¶åä¿®æ”¹conf/application.propertiesï¼Œæ·»åŠ mysqlç›¸å…³é…ç½®ï¼š spring.datasource.platform=mysql db.num=1 db.url.0=jdbc:mysql://localhost:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true db.user=root db.password=123456 é‡å¯nacosï¼Œè¿›å…¥æ§åˆ¶é¡µé¢å¯ä»¥çœ‹åˆ°æ•°æ®å…¨éƒ¨æ²¡äº†ã€‚ã€‚ 2 é›†ç¾¤éƒ¨ç½²å¦‚æœæ›´æ”¹å®Œäº†æ•°æ®å­˜å‚¨åˆ°mysqlå°±å¯ä»¥å¼€å§‹éƒ¨ç½²é›†ç¾¤äº†ï¼Œè¿™é‡Œè¿˜æ˜¯æ­å»ºä¼ªé›†ç¾¤ï¼Œä½†æ˜¯ä¼šå¾ˆéº»çƒ¦ï¼Œæœ‰æœºå™¨æ¡ä»¶çš„å¯ä»¥ç›´æ¥å°è¯•çœŸåˆ€å®æªä¸Šé›†ç¾¤â€¦â€¦ 2.1 é¦–å…ˆè®©nacosèƒ½æŒ‡å®šç«¯å£å¯åŠ¨ä¿®æ”¹bin/startup.shä¸­çš„ä¸‹é¢ä¸¤ä¸ªåœ°æ–¹ï¼š #################æ·»åŠ p:ï¼ˆå³å¯ä»¥å¸¦-på‚æ•°ï¼‰ 57 while getopts \":m:f:s:p:\" opt 58 do 59 case $opt in 60 m) 61 MODE=$OPTARG;; 62 f) 63 FUNCTION_MODE=$OPTARG;; 64 s) 65 SERVER=$OPTARG;; ################æ·»åŠ ä¸‹é¢ä¸¤è¡Œ 66 p) 67 PORT=$OPTARG;; 83 if [[ \"${MODE}\" == \"standalone\" ]]; then 84 JAVA_OPT=\"${JAVA_OPT} -Xms512m -Xmx512m -Xmn256m\" 85 JAVA_OPT=\"${JAVA_OPT} -Dnacos.standalone=true\" ### é›†ç¾¤æ¨¡å¼æ·»åŠ jvmå¯åŠ¨å‚æ•° 86 else 87 JAVA_OPT=\"${JAVA_OPT} -server -Xms2g -Xmx2g -Xmn1g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m\" 88 JAVA_OPT=\"${JAVA_OPT} -XX:-OmitStackTraceInFastThrow -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=${BASE_DIR }/logs/java_heapdump.hprof\" 89 JAVA_OPT=\"${JAVA_OPT} -XX:-UseLargePages\" ### æ·»åŠ è¿™ä¸€è¡Œ 90 JAVA_OPT=\"${JAVA_OPT} -DServer.port=${PORT}\" 91 fi 2.2 ä¿®æ”¹é›†ç¾¤é…ç½®æ–‡ä»¶å°†conf/cluster.conf.exampleå¤åˆ¶å‡ºæ¥ï¼š cp cluster.conf.example cluster.conf ç„¶åä¿®æ”¹cluster.confæ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢è¿™å‡ è¡Œï¼Œæ³¨æ„ipä¸èƒ½å¡«å†™127.0.0.1ï¼Œå¿…é¡»æ˜¯hostname -iæ˜¾ç¤ºçš„ipï¼ˆå› ä¸ºå†…éƒ¨raftæ˜¯é€šè¿‡ç½‘å¡ipè¿›è¡Œé€šä¿¡çš„ï¼‰ 192.168.91.1:3333 192.168.91.1:4444 192.168.91.1:55552.3 ä½¿ç”¨nginxåšè´Ÿè½½å‡è¡¡nginx.confæ·»åŠ ä»¥ä¸‹é…ç½®ï¼š upstream cluster{ server 127.0.0.1:3333; server 127.0.0.1:4444; server 127.0.0.1:5555; } server{ listen 1111; server_name localhost; location / { proxy_pass http://cluster; } }2.4 å¯åŠ¨é›†ç¾¤ï¼šå¯åŠ¨ä¸‰ä¸ªnacoså®ä¾‹å’Œnginxï¼š root@DESKTOP-TTLFG6F:~/nacos/bin# bash startup.sh -p 3333 root@DESKTOP-TTLFG6F:~/nacos/bin# bash startup.sh -p 4444 root@DESKTOP-TTLFG6F:~/nacos/bin# bash startup.sh -p 5555 root@DESKTOP-TTLFG6F:/usr/sbin# ./nginx -c /etc/nginx/nginx.confè®¿é—® http://192.168.91.1:1111/nacos å³å¯çœ‹åˆ°ç†Ÿæ‚‰çš„nacosç•Œé¢äº†â€¦â€¦ 3 å¾®æœåŠ¡æ³¨å†Œè¿›nacosé›†ç¾¤æˆ‘ä»¬ä»¥æ¨¡å—cloudalibaba-provider-payment9001ä¸ºä¾‹ï¼Œç›´æ¥å°†é…ç½®æ–‡ä»¶ä¸­çš„spring.cloud.nacos.discovery.addr ä¿®æ”¹ä¸ºnginxä»£ç†çš„vip server: port: 9001 spring: application: name: nacos-payment-provider cloud: nacos: discovery: server-addr: localhost:1111 management: endpoints: web: exposure: include: '*' ç„¶åå¯åŠ¨æœåŠ¡å°±å¯ä»¥æ­£å¸¸æ³¨å†Œäº†ã€‚ 4 ä¼ªé›†ç¾¤å¯èƒ½ä¼šè¸©çš„å‘å› ä¸ºä¼ªé›†ç¾¤çš„åŸå› ï¼Œå¯èƒ½é€ æˆå®ä¾‹ä¹‹é—´æ— æ³•é€šä¿¡ï¼Œæ³¨å†ŒæœåŠ¡çš„æ—¶å€™å°±ä¼šçœ‹åˆ°è¿™ç§æƒ…å†µï¼š java.lang.IllegalStateException: failed to req API:/nacos/v1/ns/instance after all servers([192.168.91.1:1111]) tried at com.alibaba.nacos.client.naming.net.NamingProxy.reqAPI(NamingProxy.java:335) at com.alibaba.nacos.client.naming.net.NamingProxy.reqAPI(NamingProxy.java:267) at com.alibaba.nacos.client.naming.net.NamingProxy.registerService(NamingProxy.java:167) at com.alibaba.nacos.client.naming.NacosNamingService.registerInstance(NacosNamingService.java:170) at org.springframework.cloud.alibaba.nacos.registry.NacosServiceRegistry.register(NacosServiceRegistry.java:56) at org.springframework.cloud.alibaba.nacos.registry.NacosServiceRegistry.register(NacosServiceRegistry.java:29)ä½†nacosæœåŠ¡åå°ä¸‰å°æœºå™¨å‡å¯åŠ¨æˆåŠŸï¼Œä¸”åå°èƒ½æ­£å¸¸è¿›å…¥ï¼Œé€šè¿‡URLè®¿é—®/nacos/v1/ns/instanceï¼Œä¹Ÿæ˜¯èƒ½æ­£å¸¸è®¿é—®ã€‚ å®é™…ä¸Šæ˜¯è·Ÿé€šè¿‡ä¸»æœºåè·å–æœ¬æœºipåœ°å€çš„åŸå› æœ‰å…³ï¼ˆå› ä¸ºæˆ‘æ˜¯ç”¨çš„WSLå¯èƒ½ä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼‰ï¼Œè¿™ç§æƒ…å†µè¿˜æ˜¯ä¿®æ”¹bin/startup.shï¼ŒåŠ ä¸€ä¸ªè™šæ‹Ÿæœºå‚æ•°ï¼š 83 if [[ \"${MODE}\" == \"standalone\" ]]; then 84 JAVA_OPT=\"${JAVA_OPT} -Xms512m -Xmx512m -Xmn256m\" 85 JAVA_OPT=\"${JAVA_OPT} -Dnacos.standalone=true\" 86 else 87 JAVA_OPT=\"${JAVA_OPT} -server -Xms2g -Xmx2g -Xmn1g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m\" 88 JAVA_OPT=\"${JAVA_OPT} -XX:-OmitStackTraceInFastThrow -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=${BASE_DIR }/logs/java_heapdump.hprof\" 89 JAVA_OPT=\"${JAVA_OPT} -XX:-UseLargePages\" 90 JAVA_OPT=\"${JAVA_OPT} -DServer.port=${PORT}\" ### å°†cluster.confä¸­é…ç½®çš„ipåœ°å€åŠ ä¸Š 91 JAVA_OPT=\"${JAVA_OPT} -Dnacos.server.ip=192.168.91.1\" 92 fi","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"},{"name":"Nacos","slug":"Nacos","permalink":"https://www.codetool.top/tags/Nacos/"}]},{"title":"Nacosä½œä¸ºé…ç½®ä¸­å¿ƒçš„ç®€å•ä½¿ç”¨","slug":"Nacosä½œä¸ºé…ç½®ä¸­å¿ƒçš„ç®€å•ä½¿ç”¨","date":"2020-03-23T11:33:25.000Z","updated":"2020-03-23T11:33:51.498Z","comments":true,"path":"article/Nacosä½œä¸ºé…ç½®ä¸­å¿ƒçš„ç®€å•ä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/Nacos%E4%BD%9C%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 ç®€å•å®ä¾‹æ–°å»ºæ¨¡å—cloudalibaba-config-nacos-client3377 1.1 ä¾èµ–&lt;!-- nacos --> &lt;dependency> &lt;groupId>com.alibaba.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-alibaba-nacos-config&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>com.alibaba.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-web&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-actuator&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-test&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;/dependency> 1.2 yamlé…ç½®NacosåŒspringcloud-configä¸€æ ·,åœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶ï¼Œè¦ä¿è¯å…ˆä»é…ç½®ä¸­å¿ƒè¿›è¡Œé…ç½®æ‹‰å–,æ‹‰å–é…ç½®ä¹‹åï¼Œæ‰èƒ½ä¿è¯é¡¹ç›®çš„æ­£å¸¸å¯åŠ¨ï¼Œæ‰€ä»¥è¿™é‡Œæœ¬åœ°çš„é…ç½®æ–‡ä»¶åè¿˜æ˜¯ä½¿ç”¨bootstrap.ymlï¼š server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # æ³¨å†Œä¸­å¿ƒ config: server-addr: localhost:8848 # é…ç½®ä¸­å¿ƒ file-extension: yaml # è¿™é‡ŒæŒ‡å®šçš„æ–‡ä»¶æ ¼å¼éœ€è¦å’Œnacosä¸Šæ–°å»ºçš„é…ç½®æ–‡ä»¶åç¼€ç›¸åŒï¼Œå¦åˆ™è¯»ä¸åˆ° 1.2.1 dataIdçš„å‘½åè§„åˆ™spring.application.nameæ˜¯æ„æˆ Nacos é…ç½®ç®¡ç† dataId å­—æ®µçš„ä¸€éƒ¨åˆ†ã€‚ åœ¨ Nacos Spring Cloud ä¸­ï¼ŒdataId çš„å®Œæ•´æ ¼å¼å¦‚ä¸‹ï¼š ${prefix}-${spring.profile.active}.${file-extension} prefix é»˜è®¤ä¸º spring.application.name çš„å€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é…ç½®é¡¹ spring.cloud.nacos.config.prefix æ¥é…ç½®ã€‚ spring.profile.active å³ä¸ºå½“å‰ç¯å¢ƒå¯¹åº”çš„ profileï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒ Spring Bootæ–‡æ¡£ã€‚ æ³¨æ„ï¼šå½“ spring.profile.active ä¸ºç©ºæ—¶ï¼Œå¯¹åº”çš„è¿æ¥ç¬¦ - ä¹Ÿå°†ä¸å­˜åœ¨ï¼ŒdataId çš„æ‹¼æ¥æ ¼å¼å˜æˆ ${prefix}.${file-extension} file-exetension ä¸ºé…ç½®å†…å®¹çš„æ•°æ®æ ¼å¼ï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹ spring.cloud.nacos.config.file-extension æ¥é…ç½®ã€‚ç›®å‰åªæ”¯æŒ properties å’Œ yaml ç±»å‹ã€‚ ä¸ºäº†æŒ‡å®šé»˜è®¤profileï¼Œæˆ‘ä»¬è¿™é‡Œå†æ–°å»ºä¸€ä¸ªapplication.ymlï¼Œå†…å®¹ä¸ºï¼š spring: profiles: active: dev # å¼€å‘ç¯å¢ƒ æˆ‘ä»¬åœ¨nacosç•Œé¢ä¸Šé¢é€‰æ‹©æ–°å»ºé…ç½®ï¼ŒæŒ‰ä¸‹å›¾æ“ä½œ config: info: \"config info for dev, from nacos config center\" æ˜¯æˆ‘ä»¬ç”¨äºæµ‹è¯•çš„è¿œç¨‹é…ç½® 1.3 å¯åŠ¨ç±»@SpringBootApplication @EnableDiscoveryClient public class NacosConfigClientMain3377 { public static void main(String[] args) { SpringApplication.run(NacosConfigClientMain3377.class, args); } } 1.4 controller@RestController @RefreshScope // æ”¯æŒnacosçš„åŠ¨æ€åˆ·æ–° public class ConfigClientController { @Value(\"${config.info}\") private String configInfo; @GetMapping(\"/config/info\") public String getConfigInfo(){ return configInfo; } } è¿è¡Œæ¨¡å—ï¼Œè®¿é—® http://localhost:3377/config/info å¯ä»¥çœ‹åˆ°é…ç½®è¢«æ­£å¸¸è¯»å–ã€‚ 2 åˆ†ç±»ç®¡ç†Nacosä¸Šé¢çš„é…ç½®æ–‡ä»¶ç”±namespaceï¼ˆå‘½åç©ºé—´ï¼‰+groupï¼ˆåˆ†ç»„ï¼‰+dataIdå”¯ä¸€ç¡®å®šã€‚ æœ€å¤–å±‚çš„namespaceæ˜¯å¯ä»¥ç”¨äºåŒºåˆ†éƒ¨ç½²ç¯å¢ƒçš„ï¼ŒGroupå’ŒDataIdé€»è¾‘ä¸ŠåŒºåˆ†ä¸¤ä¸ªç›®æ ‡å¯¹è±¡ã€‚ namespaceé»˜è®¤ä¸ºpublicï¼Œgroupé»˜è®¤ä¸ºDEFAULT_GROUP æ¯”æ–¹è¯´æˆ‘ä»¬ç°åœ¨æœ‰ä¸‰ä¸ªç¯å¢ƒï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸‰ä¸ªNamespaceï¼Œä¸åŒçš„Namespaceä¹‹é—´æ˜¯éš”ç¦»çš„ã€‚ 2.1 dataIdæ–¹æ¡ˆæˆ‘ä»¬å†åœ¨nacosä¸Šé»˜è®¤å‘½åç©ºé—´é»˜è®¤åˆ†ç»„æ–°å»ºä¸€ä¸ªé…ç½®nacos-config-client-test.yamlï¼Œå†…å®¹ä¸º config: info: \"config info for test, from nacos config center\" ç„¶åå°†application.ymlæ”¹ä¸º spring: profiles: active: test # æµ‹è¯•ç¯å¢ƒ æ¨¡å—é‡å¯ï¼Œå†æ¬¡è®¿é—® http://localhost:3377/config/info ï¼Œå¯ä»¥çœ‹åˆ°å·²æ­£ç¡®è¯»å–nacos-config-client-test.yamlçš„é…ç½®ï¼Œå¹¶ä¸”å¯ä»¥å°è¯•ä¿®æ”¹nacos-config-client-test.yamlçš„å†…å®¹ï¼Œå¯ä»¥éªŒè¯nacosèƒ½åŠ¨æ€åˆ·æ–°è¯»å–é…ç½®ã€‚ 2.2 groupæ–¹æ¡ˆæ–°å»ºé…ç½®æ–‡ä»¶ï¼ŒdataIdä¸ºnacos-config-client-info.yamlï¼Œgroupå¡«å†™DEV_GROUPï¼Œå†…å®¹ä¸ºï¼š config: info: \"nacos-config-client-info.yaml, DEV_GROUP\" å†æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼ŒdataIdä¹Ÿä¸ºnacos-config-client-info.yamlï¼Œgroupå¡«å†™TEST_GROUPï¼Œå†…å®¹ä¸ºï¼š config: info: \"nacos-config-client-info.yaml, TEST_GROUP\" ä¹‹åå¯ä»¥åœ¨bootstrap.ymlä¸­æŒ‡å®šgroupï¼š server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # æ³¨å†Œä¸­å¿ƒ config: server-addr: localhost:8848 # é…ç½®ä¸­å¿ƒ file-extension: yaml # è¿™é‡ŒæŒ‡å®šçš„æ–‡ä»¶æ ¼å¼éœ€è¦å’Œnacosä¸Šæ–°å»ºçš„é…ç½®æ–‡ä»¶åç¼€ç›¸åŒï¼Œå¦åˆ™è¯»ä¸åˆ° group: TEST_GROUP # æŒ‡å®šgroup 2.3 å‘½åç©ºé—´æ–¹æ¡ˆnacosç•Œé¢-&gt;å‘½åç©ºé—´-&gt;æ–°å»ºå‘½åç©ºé—´ã€‚æ–°å»ºä¸¤ä¸ªåä¸ºdevå’Œtestçš„å‘½åç©ºé—´ã€‚ç„¶åå¯ä»¥çœ‹åˆ°å®ƒä»¬çš„å‘½åç©ºé—´ID ç„¶åå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®å‘½åç©ºé—´ï¼š server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # æ³¨å†Œä¸­å¿ƒ config: server-addr: localhost:8848 # é…ç½®ä¸­å¿ƒ file-extension: yaml # è¿™é‡ŒæŒ‡å®šçš„æ–‡ä»¶æ ¼å¼éœ€è¦å’Œnacosä¸Šæ–°å»ºçš„é…ç½®æ–‡ä»¶åç¼€ç›¸åŒï¼Œå¦åˆ™è¯»ä¸åˆ° group: TEST_GROUP # æŒ‡å®šgroup namespace: 4ccc4c4c-51ec-4bd1-8280-9e70942c0d0c # æŒ‡å®šå‘½åç©ºé—´ID","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"},{"name":"Nacos","slug":"Nacos","permalink":"https://www.codetool.top/tags/Nacos/"}]},{"title":"Nacosä½œä¸ºæ³¨å†Œä¸­å¿ƒçš„ç®€å•ä½¿ç”¨","slug":"Nacosä½œä¸ºæ³¨å†Œä¸­å¿ƒçš„ç®€å•ä½¿ç”¨","date":"2020-03-23T09:38:58.000Z","updated":"2020-03-30T11:16:34.647Z","comments":true,"path":"article/Nacosä½œä¸ºæ³¨å†Œä¸­å¿ƒçš„ç®€å•ä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/Nacos%E4%BD%9C%E4%B8%BA%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 Spring Cloud Alibabaæ¦‚è¿°2018.10.31, Spring Cloud Alibaba æ­£å¼å…¥é©»äº†Spring Cloudå®˜æ–¹å­µåŒ–å™¨ï¼Œå¹¶åœ¨Mavenä¸­å¤®ä»“åº“å‘å¸ƒäº†ç¬¬ä¸€ä¸ªç‰ˆæœ¬ã€‚ Spring Cloud Alibabaæ”¯æŒï¼š æœåŠ¡é™æµé™çº§ï¼šé»˜è®¤æ”¯æŒServletã€Feign. RestTemplateã€ Dubbo å’ŒRocketMQé™æµé™çº§åŠŸèƒ½çš„æ¥å…¥ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡æ§åˆ¶å°å®æ—¶ä¿®æ”¹é™æµé™çº§è§„åˆ™,è¿˜æ”¯æŒæŸ¥çœ‹é™æµé™çº§Metricsç›‘æ§ã€‚ æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼šé€‚é…Spring CloudæœåŠ¡æ³¨å†Œä¸å‘ç°æ ‡å‡†ï¼Œé»˜è®¤é›†æˆäº†Ribbonçš„æ”¯æŒã€‚ åˆ†å¸ƒå¼é…ç½®ç®¡ç†ï¼šæ”¯æŒåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤–éƒ¨åŒ–é…ç½®,é…ç½®æ›´æ”¹æ—¶è‡ªåŠ¨åˆ·æ–°ã€‚ æ¶ˆæ¯é©±åŠ¨èƒ½åŠ›ï¼šåŸºäºSpring Cloud Streamä¸ºå¾®æœåŠ¡åº”ç”¨æ„å»ºæ¶ˆæ¯é©±åŠ¨èƒ½åŠ›. é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨ï¼šé˜¿é‡Œäº‘æä¾›çš„æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€å¯é çš„äº‘å­˜å‚¨æœåŠ¡ã€‚æ”¯æŒåœ¨ä»»ä½•åº”ç”¨ã€ä»»ä½•æ—¶é—´ã€ä»»ä½•åœ°ç‚¹å­˜å‚¨å’Œè®¿é—®ä»»æ„ç±»å‹çš„æ•°æ®ã€‚ åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ï¼šæä¾›ç§’çº§ã€ç²¾å‡†ã€å¯é é«˜å¯ç”¨çš„å®šæ—¶(åŸºäºCronè¡¨è¾¾å¼)ä»»åŠ¡è°ƒåº¦æœåŠ¡ã€‚åŒæ—¶æä¾›åˆ†å¸ƒå¼çš„ä»»åŠ¡æ‰§è¡Œæ¨¡å‹ï¼Œå¦‚ç½‘æ ¼ä»»åŠ¡ã€‚ç½‘æ ¼ä»»åŠ¡æ”¯æŒæµ·é‡å­ä»»åŠ¡å‡åŒ€åˆ†é…åˆ°æ‰€æœ‰Worker (schedulerx-client). ä¸Šæ‰§è¡Œã€‚ 2 Nacosæ¦‚è¿°ä¸ºä»€ä¹ˆå«Nacosï¼šå‰å››ä¸ªå­—æ¯åˆ†åˆ«ä¸ºNamingå’ŒConfigurationçš„å‰ä¸¤ä¸ªå­—æ¯ï¼Œæœ€åçš„sä¸ºServiceã€‚ æ˜¯ä¸€ä¸ªæœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å°ã€‚å¯ä»¥æ›¿ä»£eureka+config+bus 2.1 å„æ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ - Nacos Eureka Consul CoreDNS ZooKeeper ä¸€è‡´æ€§åè®® CP+AP AP CP / CP å¥åº·æ£€æŸ¥ TCP/HTTP/MySQL/Client Beat Client Beat TCP/HTTP/gRPC/Cmd / Client Beat è´Ÿè½½å‡è¡¡ æƒé‡/DSL/metadata/CMDB Ribbon Fabio RR / é›ªå´©ä¿æŠ¤ æ”¯æŒ æ”¯æŒ ä¸æ”¯æŒ ä¸æ”¯æŒ ä¸æ”¯æŒ è‡ªåŠ¨æ³¨é”€å®ä¾‹ æ”¯æŒ æ”¯æŒ ä¸æ”¯æŒ ä¸æ”¯æŒ æ”¯æŒ è®¿é—®åè®® HTTP/DNS/UDP HTTP HTTP/DNS DNS TCP ç›‘å¬æ”¯æŒ æ”¯æŒ æ”¯æŒ æ”¯æŒ ä¸æ”¯æŒ æ”¯æŒ å¤šæ•°æ®ä¸­å¿ƒ æ”¯æŒ æ”¯æŒ æ”¯æŒ ä¸æ”¯æŒ ä¸æ”¯æŒ è·¨æ³¨å†Œä¸­å¿ƒ æ”¯æŒ ä¸æ”¯æŒ æ”¯æŒ ä¸æ”¯æŒ ä¸æ”¯æŒ SpringCloudé›†æˆ æ”¯æŒ æ”¯æŒ æ”¯æŒ ä¸æ”¯æŒ ä¸æ”¯æŒ Dubboé›†æˆ æ”¯æŒ ä¸æ”¯æŒ ä¸æ”¯æŒ ä¸æ”¯æŒ æ”¯æŒ K8sé›†æˆ æ”¯æŒ ä¸æ”¯æŒ æ”¯æŒ æ”¯æŒ ä¸æ”¯æŒ 3 ä½¿ç”¨3.1 Nacos serverä¸‹è½½å’Œè¿è¡ŒNacos-serverä¸‹è½½ï¼š https://github.com/alibaba/nacos/releases è¿™é‡Œé€‰æ‹©nacos-server-1.1.4.tar.gzä¸‹è½½å¹¶è§£å‹ï¼š wget https://github.com/alibaba/nacos/releases/download/1.1.4/nacos-server-1.1.4.zip tar -xvf nacos-server-1.1.4.tar.gz å¯åŠ¨æœåŠ¡å™¨ï¼ˆéé›†ç¾¤æ¨¡å¼ï¼‰ï¼š cd nacos/bin sh startup.sh -m standalone ubuntuå¯ä»¥ä½¿ç”¨ï¼š bash startup.sh -m standalone å¯åŠ¨æˆåŠŸåï¼Œè®¿é—® http://localhost:8848/nacos å³å¯çœ‹åˆ°å›¾å½¢ç•Œé¢ï¼Œé»˜è®¤è´¦å·å’Œå¯†ç éƒ½æ˜¯nacos 3.2 nacos çš„dockerè¿è¡Œnacos-dockerçš„githubä¸»é¡µï¼š https://github.com/nacos-group/nacos-docker docker run --name nacos-standalone -e MODE=standalone -p 8848:8848 -d nacos/nacos-server:latest3.3 æ„å»ºæœåŠ¡æä¾›è€…æ¨¡å—æ–°å»ºæ¨¡å—cloudalibaba-provider-payment9001ï¼Œä¾èµ–ï¼š &lt;!-- nacos-discovery --> &lt;dependency> &lt;groupId>com.alibaba.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-web&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-actuator&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-test&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;/dependency> å› ä¸ºçˆ¶å·¥ç¨‹å·²ç»å¼•å…¥ &lt;!--Spring cloud alibaba 2.1.0.RELEASE--> &lt;dependency> &lt;groupId>com.alibaba.cloud&lt;/groupId> &lt;artifactId>spring-cloud-alibaba-dependencies&lt;/artifactId> &lt;version>${spring.cloud.alibaba.version}&lt;/version> &lt;type>pom&lt;/type> &lt;scope>import&lt;/scope> &lt;/dependency> è¿™é‡Œä¸å†å¼•å…¥ yamlé…ç½®ï¼š server: port: 9002 spring: application: name: nacos-payment-provider cloud: nacos: discovery: server-addr: localhost:8848 management: endpoints: web: exposure: include: '*' å¯åŠ¨ç±»: @SpringBootApplication @EnableDiscoveryClient public class PaymentMain9002 { public static void main(String[] args) { SpringApplication.run(PaymentMain9002.class, args); } } controller: @Controller public class PaymentController { @Value(\"${server.port}\") private String serverPort; @GetMapping(\"/payment/nacos/{id}\") public String getPayment(@PathVariable(\"id\") Integer id){ return \"nacos registry, serverPort: \" + serverPort+\"\\t id:\" +id; } } è¿è¡Œè¯¥æ¨¡å—ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°è¯¥æœåŠ¡è¢«æ³¨å†Œåˆ°nacosä¸Šé¢äº†ï¼Œå†å»ºç«‹ä¸€ä¸ªå†…å®¹ç›¸åŒçš„9002æ¨¡å—å¹¶å¯åŠ¨ï¼Œå¯ä»¥çœ‹åˆ°è¯¥æœåŠ¡å­˜åœ¨ä¸¤ä¸ªå®ä¾‹ï¼š 3.4 æœåŠ¡è°ƒç”¨è€…æ¨¡å—æ­å»ºæ–°å»ºæ¨¡å—cloudalibaba-consumer-nacos-order83ï¼Œä¾èµ–ï¼š &lt;dependency> &lt;groupId>com.alibaba.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>com.rhett&lt;/groupId> &lt;artifactId>cloud-api-commons&lt;/artifactId> &lt;version>${project.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-web&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-actuator&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-test&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;/dependency> yamlé…ç½®ï¼š server: port: 83 spring: application: name: nacos-order-consumer cloud: nacos: discovery: server-addr: localhost:8848 # æ¶ˆè´¹è€…å°†è¦å»è®¿é—®çš„å¾®æœåŠ¡åç§°ï¼Œè¿™æ˜¯è‡ªå®šä¹‰é…ç½®é¡¹ service-url: nacos-user-service: http://nacos-payment-provider å¯åŠ¨ç±»ï¼š @SpringBootApplication @EnableDiscoveryClient public class OrderNacosMain83 { public static void main(String[] args) { SpringApplication.run(OrderNacosMain83.class, args); } } é…ç½®RestTemplateï¼š @Configuration public class ApplicationContextConfig { @Bean @LoadBalanced public RestTemplate getRestTemplate(){ return new RestTemplate(); } } controller: @RestController @Slf4j public class OrderNacosController { @Resource private RestTemplate restTemplate; @Value(\"${service-url.nacos-user-service}\") private String serverUrl; @GetMapping(\"/consumer/payment/nacos/{id}\") public String paymentInfo(@PathVariable(\"id\") Integer id){ return restTemplate.getForObject(serverUrl + \"/payment/nacos/\" + id, String.class); } } è®¿é—® http://localhost:83/consumer/payment/nacos/13 å³å¯çœ‹åˆ°9001ã€9002äº¤æ›¿æä¾›æœåŠ¡ï¼Œæ˜¯å› ä¸ºnacoså·²ç»ç»§æ‰¿äº†ribbonè´Ÿè½½å‡è¡¡ï¼š 4 Nacos APå’ŒCPçš„åˆ‡æ¢ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸éœ€è¦å­˜å‚¨æœåŠ¡çº§åˆ«çš„ä¿¡æ¯ä¸”æœåŠ¡å®ä¾‹æ˜¯é€šè¿‡nacos-clientæ³¨å†Œï¼Œå¹¶èƒ½å¤Ÿä¿æŒå¿ƒè·³ä¸ŠæŠ¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€‰æ‹©APæ¨¡å¼ã€‚å½“å‰ä¸»æµçš„æœåŠ¡å¦‚Spring cloudå’ŒDubboæœåŠ¡,éƒ½é€‚ç”¨äºAPæ¨¡å¼ï¼ŒAPæ¨¡å¼ä¸ºäº†æœåŠ¡çš„å¯èƒ½æ€§è€Œå‡å¼±äº†ä¸€è‡´æ€§ï¼Œ å› æ­¤APæ¨¡å¼ä¸‹åªæ”¯æŒæ³¨å†Œä¸´æ—¶å®ä¾‹ã€‚ å¦‚æœéœ€è¦åœ¨æœåŠ¡çº§åˆ«ç¼–è¾‘æˆ–è€…å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆCPæ˜¯å¿…é¡»ï¼ŒK8SæœåŠ¡å’ŒDNSæœåŠ¡åˆ™é€‚ç”¨äºCPæ¨¡å¼ã€‚CPæ¨¡å¼ä¸‹åˆ™æ”¯æŒæ³¨å†ŒæŒä¹…åŒ–å®ä¾‹ï¼Œæ­¤æ—¶åˆ™æ˜¯ä»¥Raftåè®®ä¸ºé›†ç¾¤è¿è¡Œæ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸‹æ³¨å†Œå®ä¾‹ä¹‹å‰å¿…é¡»å…ˆæ³¨å†ŒæœåŠ¡,å¦‚æœæœåŠ¡ä¸å­˜åœ¨,åˆ™ä¼šè¿”å›é”™è¯¯ã€‚ åˆ‡æ¢æ–¹æ³•ï¼šå‘ $NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode&amp;value=CP å‘é€POSTè¯·æ±‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"},{"name":"Nacos","slug":"Nacos","permalink":"https://www.codetool.top/tags/Nacos/"}]},{"title":"åˆ†å¸ƒå¼é“¾è·¯è·Ÿè¸ªè§£å†³æ–¹æ¡ˆ-SpringCloud Sleuth","slug":"åˆ†å¸ƒå¼é“¾è·¯è·Ÿè¸ªè§£å†³æ–¹æ¡ˆ-SpringCloud Sleuth","date":"2020-03-23T03:12:13.000Z","updated":"2020-03-23T03:14:04.699Z","comments":true,"path":"article/åˆ†å¸ƒå¼é“¾è·¯è·Ÿè¸ªè§£å†³æ–¹æ¡ˆ-SpringCloud Sleuth/","link":"","permalink":"https://www.codetool.top/article/%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-SpringCloud%20Sleuth/","excerpt":"","text":"1 Sleuthæ¦‚è¿°åœ¨å¾®æœåŠ¡æ¡†æ¶ä¸­ï¼Œä¸€ä¸ªç”±å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚åœ¨åç«¯ç³»ç»Ÿä¸­ä¼šç»è¿‡å¤šä¸ªä¸åŒçš„çš„æœåŠ¡èŠ‚ç‚¹è°ƒç”¨æ¥ååŒäº§ç”Ÿæœ€åçš„è¯·æ±‚ç»“æœï¼Œæ¯ä¸€ä¸ªå‰æ®µè¯·æ±‚éƒ½ä¼šå½¢æˆä¸€æ¡å¤æ‚çš„åˆ†å¸ƒå¼æœåŠ¡è°ƒç”¨é“¾è·¯ï¼Œ é“¾è·¯ä¸­çš„ä»»ä½•ä¸€ç¯å‡ºç°é«˜å»¶æ—¶æˆ–é”™è¯¯éƒ½ä¼šå¼•èµ·æ•´ä¸ªè¯·æ±‚æœ€åçš„å¤±è´¥ã€‚ Spring Cloud Sleuthæä¾›äº†ä¸€å¥—å®Œæ•´çš„æœåŠ¡è·Ÿè¸ªçš„è§£å†³æ–¹æ¡ˆï¼Œå¹¶ä¸”å…¼å®¹æ”¯æŒäº†zipkin 2 å®Œæ•´çš„è°ƒç”¨é“¾è·¯ä¸€æ¡é“¾è·¯é€šè¿‡Trace Idå”¯ä¸€æ ‡è¯†ï¼ŒSpanæ ‡è¯†å‘èµ·çš„è¯·æ±‚ä¿¡æ¯ Trace:ç±»ä¼¼äºæ ‘ç»“æ„çš„Spané›†åˆ,è¡¨ç¤ºä¸€æ¡è°ƒç”¨é“¾è·¯,å­˜åœ¨å”¯ä¸€æ ‡è¯† span:è¡¨ç¤ºè°ƒç”¨é“¾è·¯æ¥æº,é€šä¿—çš„ç†è§£spanå°±æ˜¯ä¸€æ¬¡è¯·æ±‚ä¿¡æ¯ å„spané€šè¿‡parent idå…³è”èµ·æ¥ï¼Œä¸‹å›¾å±•ç¤ºäº†spançš„çˆ¶å­å…³ç³»ï¼š 3 ä½¿ç”¨ç¤ºä¾‹3.1 zipkinçš„ä¸‹è½½å’Œè¿è¡ŒSpringCloudä»Fç‰ˆèµ·å·²ä¸éœ€è¦è‡ªå·±æ„å»ºZipkin Serveräº†ï¼Œåªéœ€è°ƒç”¨jaråŒ…å³å¯ ä¸‹è½½åœ°å€ï¼š https://dl.bintray.com/openzipkin/maven/io/zipkin/java/zipkin-server/ è¿™é‡Œé€‰æ‹©2.12.9/zipkin-server-2.12.9-exec.jarä¸‹è½½ã€‚ ä¸‹è½½å®Œæˆä¹‹åç›´æ¥è¿è¡Œï¼š è¿è¡ŒæˆåŠŸä¹‹åï¼Œæµè§ˆå™¨è®¿é—® http://localhost:9411/ å°±èƒ½çœ‹åˆ°ç®¡ç†ç•Œé¢äº† 3.2 åˆ›å»ºé¡¹ç›®åœ¨ä¹‹å‰çš„cloud-provider-payment8001å’Œcloud-consumer-order80ä¸­æ·»åŠ ä¾èµ–ï¼š &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-zipkin&lt;/artifactId> &lt;/dependency> ä¸¤ä¸ªæ¨¡å—é…ç½®æ·»åŠ ï¼š spring: zipkin: base-url: http://localhost:9411 sleuth: sampler: # é‡‡æ ·ç‡ï¼Œ1ä»£è¡¨å…¨éƒ¨é‡‡é›† probability: 1 8001æ·»åŠ ä¸€ä¸ªcontrolleræ–¹æ³•ï¼š @GetMapping(\"/payment/zipkin\") public String paymentZipkin(){ return \"payment zipkin invoke\"; } 80æ·»åŠ ä¸€ä¸ªcontrolleræ–¹æ³•ï¼š @GetMapping(\"/consumer/payment/zipkin\") public String paymentZipkin(){ return restTemplate.getForObject(PAYMENT_URL+\"/payment/zipkin\",String.class); } è®¿é—® http://localhost/consumer/payment/zipkin ï¼ŒæŸ¥çœ‹zipkinç•Œé¢æ˜¾ç¤º å¯ä»¥æŸ¥çœ‹åˆ°ç›¸å…³çš„è°ƒç”¨ï¼Œå‘ç”Ÿé”™è¯¯çš„æƒ…å†µä¹Ÿèƒ½çœ‹åˆ° æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼š","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"},{"name":"SpringCloud Sleuth","slug":"SpringCloud-Sleuth","permalink":"https://www.codetool.top/tags/SpringCloud-Sleuth/"}]},{"title":"SpringCloud Streamçš„äº†è§£åŠä½¿ç”¨","slug":"SpringCloud Streamçš„äº†è§£åŠä½¿ç”¨","date":"2020-03-23T01:42:31.000Z","updated":"2020-03-23T01:43:40.910Z","comments":true,"path":"article/SpringCloud Streamçš„äº†è§£åŠä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/SpringCloud%20Stream%E7%9A%84%E4%BA%86%E8%A7%A3%E5%8F%8A%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 ä»€ä¹ˆæ˜¯SpringCloud Streamå®˜æ–¹å®šä¹‰Spring Cloud Streamæ˜¯ä¸€ä¸ªæ„å»ºæ¶ˆæ¯é©±åŠ¨å¾®æœåŠ¡çš„æ¡†æ¶ï¼Œå®ƒçš„ç›®æ ‡æ˜¯å±è”½åº•å±‚æ¶ˆæ¯ä¸­é—´ä»¶çš„å·®å¼‚,é™ä½åˆ‡æ¢æˆæœ¬ï¼Œç»Ÿä¸€æ¶ˆæ¯çš„ç¼–ç¨‹æ¨¡å‹ã€‚ åº”ç”¨ç¨‹åºé€šè¿‡inputsæˆ–è€…outputsä¸Spring Cloud Streamä¸­binderå¯¹è±¡äº¤äº’ã€‚ é€šè¿‡æˆ‘ä»¬é…ç½®æ¥binding(ç»‘å®š)ï¼Œè€ŒSpring Cloud Streamçš„binderå¯¹è±¡è´Ÿè´£ä¸æ¶ˆæ¯ä¸­é—´ä»¶äº¤äº’ã€‚ç›®å‰ä»…æ”¯æŒRabbitMQã€Kafkaã€‚ æ‰€ä»¥,æˆ‘ä»¬åªéœ€è¦ææ¸…æ¥šå¦‚ä½•ä¸Spring Cloud Streamäº¤äº’å°±å¯ä»¥æ–¹ä¾¿ä½¿ç”¨æ¶ˆæ¯é©±åŠ¨çš„æ–¹å¼ã€‚é€šè¿‡ä½¿ç”¨Spring Integrationæ¥è¿æ¥æ¶ˆæ¯ä»£ç†ä¸­é—´ä»¶ä»¥å®ç°æ¶ˆæ¯äº‹ä»¶é©±åŠ¨ã€‚ Spring Cloud Streamä¸ºä¸€äº›ä¾›åº”å•†çš„æ¶ˆæ¯ä¸­é—´ä»¶äº§å“æä¾›äº†ä¸ªæ€§åŒ–çš„è‡ªåŠ¨åŒ–é…ç½®å®ç°ï¼Œå¼•ç”¨äº†å‘å¸ƒ-è®¢é˜…ã€æ¶ˆè´¹ç»„ã€åˆ†åŒºçš„ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚ ç›®å‰ä»…æ”¯æŒRabbitMQã€Kafka 2 ç¼–ç API ç»„æˆ è¯´æ˜ Middleware ä¸­é—´ä»¶ï¼Œç›®å‰åªæ”¯æŒRabbitMQå’ŒKafka Binder æ˜¯åº”ç”¨ä¸æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹é—´çš„å°è£…ï¼Œç›®å‰å®è¡Œäº†Kafkaå’ŒRabitMQçš„Binder,é€šè¿‡Binderå¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿æ¥ä¸­é—´ä»¶,å¯ä»¥åŠ¨æ€çš„æ”¹å˜æ¶ˆæ¯ç±»å‹(å¯¹åº”äºKafkaçš„topicï¼ŒRabitMQçš„exchange)ï¼Œè¿™äº›éƒ½å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥å®ç° Channel é€šé“,æ˜¯é˜Ÿåˆ—Queueçš„ä¸€ç§æŠ½è±¡,åœ¨æ¶ˆæ¯é€šè®¯ç³»ç»Ÿä¸­å°±æ˜¯å®ç°å­˜å‚¨å’Œè½¬å‘çš„åª’ä»‹,é€šè¿‡Channelå¯¹é˜Ÿåˆ—è¿›è¡Œé…ç½® Sourceå’ŒSink ç®€å•çš„å¯ç†è§£ä¸ºå‚è€ƒå¯¹è±¡æ˜¯Spring Cloud Streamçš„è‡ªèº«,ä»Streamå‘å¸ƒä¿¡æ¯å°±æ˜¯è¾“å‡º,æ¥å—æ¶ˆæ¯å°±æ˜¯è¾“å…¥ @Input æ³¨è§£æ ‡è¯†è¾“å…¥é€šé“ï¼Œé€šè¿‡è¯¥è¾“å…¥é€šé“æ¥æ”¶åˆ°çš„æ¶ˆæ¯è¿›å…¥åº”ç”¨ç¨‹åº @Output æ³¨è§£æ ‡è¯†è¾“å‡ºé€šé“ï¼Œå‘å¸ƒçš„æ¶ˆæ¯å°†é€šè¿‡è¯¥é€šé“ç¦»å¼€åº”ç”¨ç¨‹åº @StreamListener ç›‘å¬é˜Ÿåˆ—ï¼Œç”¨äºæ¶ˆè´¹è€…çš„é˜Ÿåˆ—çš„æ¶ˆæ¯æ¥æ”¶ @EnableBinding æŒ‡ä¿¡é“channelå’Œexchangeç»‘å®šåœ¨ä¸€èµ· 3 ç®€å•ä½¿ç”¨å®ä¾‹3.1 æ¶ˆæ¯ç”Ÿäº§è€…æ–°å»ºæ¨¡å—cloud-stream-rabbitmq-provider8801ï¼Œä¾èµ–ï¼š &lt;!-- spring-cloud-starter-stream-rabbit --> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-stream-rabbit&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-web&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-actuator&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-netflix-eureka-client&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-test&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;/dependency> yamlé…ç½®ï¼š server: port: 8801 spring: application: name: cloud-stream-provider rabbitmq: host: localhost port: 5672 username: guest password: guest cloud: stream: binders: #åœ¨æ­¤é…ç½®è¦ç»‘å®šçš„rabbitmqçš„æœåŠ¡ä¿¡æ¯ defaultRabbit: type: rabbit # æ¶ˆæ¯ç»„ä»¶ç±»å‹ environment: # å¯å®ç°å¤šç¯å¢ƒé…ç½® spring: rabbitmq: host: localhost port: 5672 username: guest password: guest bindings: #æœåŠ¡çš„æ•´åˆå¤„ç† output: #è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§° destination: studyExchange # è¡¨ç¤ºè¦ä½¿ç”¨çš„exchangeåç§°å®šä¹‰ content-type: application/json # è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸ºjsonï¼Œæ–‡æœ¬åˆ™è®¾ç½®â€œtext/plainâ€ binder: defaultRabbit eureka: client: service-url: defaultZone: http://eureka7001.com:7001/eureka instance: lease-renewal-interval-in-seconds: 2 #è®¾ç½®å¿ƒè·³çš„æ—¶é—´é—´éš” lease-expiration-duration-in-seconds: 5 # å¦‚æœç°åœ¨è¶…è¿‡äº†5ç§’çš„é—´éš” instance-id: send-8801.com prefer-ip-address: true #è®¿é—®çš„è·¯å¾„å˜ä¸ºipåœ°å€ å¯åŠ¨ç±»ï¼š @SpringBootApplication public class StreamMQMain8801 { public static void main(String[] args) { SpringApplication.run(StreamMQMain8801.class, args); } } å‘é€æ¶ˆæ¯æ¥å£ï¼š public interface IMessageProvider { public void send(); } å®ç°ï¼š import com.rhett.springcloud.service.IMessageProvider; import org.springframework.cloud.stream.annotation.EnableBinding; import org.springframework.cloud.stream.messaging.Source; import org.springframework.integration.support.MessageBuilder; import org.springframework.messaging.MessageChannel; import javax.annotation.Resource; import java.util.UUID; @EnableBinding(Source.class) //å®šä¹‰æ¶ˆæ¯çš„æ¨é€ç®¡é“ public class MessageProviderImpl implements IMessageProvider { @Resource private MessageChannel output; //æ¶ˆæ¯å‘é€ç®¡é“ @Override public void send() { String serial = UUID.randomUUID().toString(); output.send(MessageBuilder.withPayload(serial).build()); System.out.println(\"*******serial:\"+serial); } } controller: @RestController public class SendMessageController { @Resource private IMessageProvider messageProvider; @GetMapping(\"/sendMessage\") public String sendMessage(){ return messageProvider.send(); } } 3.2 æ¶ˆæ¯æ¶ˆè´¹è€…æ–°å»ºcloud-stream-rabbitmq-consumer8802æ¨¡å—ï¼Œä¾èµ–å’Œcloud-stream-rabbitmq-provider8801ä¸€æ ·ã€‚ yamlé…ç½®ä¹Ÿå¾ˆç±»ä¼¼ï¼š server: port: 8802 spring: application: name: cloud-stream-consumer rabbitmq: host: localhost port: 5672 username: guest password: guest cloud: stream: binders: # åœ¨æ­¤å¤„é…ç½®è¦ç»‘å®šçš„rabbitMQçš„æœåŠ¡ä¿¡æ¯ defaultRabbit: # è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äºbindingçš„æ•´åˆ type: rabbit # æ¶ˆæ¯ä¸­é—´ä»¶ç±»å‹ environment: # è®¾ç½®rabbitMQçš„ç›¸å…³ç¯å¢ƒé…ç½® spring: rabbitmq: host: localhost port: 5672 username: guest password: guest bindings: # æœåŠ¡çš„æ•´åˆå¤„ç† input: # è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§° destination: studyExchange # è¡¨ç¤ºè¦ä½¿ç”¨çš„exchangeåç§°å®šä¹‰ content-type: application/json # è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸ºjsonï¼Œæ–‡æœ¬åˆ™è®¾ä¸ºtext/plain binder: defaultRabbit # è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½® eureka: client: service-url: defaultZone: http://eureka7001.com:7001/eureka instance: lease-renewal-interval-in-seconds: 2 # è®¾ç½®å¿ƒè·³çš„é—´éš”æ—¶é—´ï¼Œé»˜è®¤30 lease-expiration-duration-in-seconds: 5 # è¶…è¿‡5ç§’é—´éš”ï¼Œé»˜è®¤90 instance-id: receive-8802.com prefer-ip-address: true å¯åŠ¨ç±»ï¼š @SpringBootApplication public class StreamMQMain8802 { public static void main(String[] args) { SpringApplication.run(StreamMQMain8802.class, args); } } æ¶ˆè´¹æ¶ˆæ¯ä¸šåŠ¡ç±»ï¼š @Component @EnableBinding(Sink.class) public class ReceiveMessageListenerController { @Value(\"${server.port}\") private String serverPort; @StreamListener(Sink.INPUT) public void input(Message&lt;String> message){ System.out.println(\"æ¶ˆè´¹è€…1å·ï¼Œ----->æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š\"+message.getPayload()+\"\\t port:\"+serverPort); } } 4 åˆ†ç»„æ¶ˆè´¹ä¸Šé¢æ­å»ºçš„ç®€å•ä½¿ç”¨å®ä¾‹ä»ç„¶å­˜åœ¨ç€é—®é¢˜ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªå†…å®¹å’Œcloud-stream-rabbitmq-consumer8802ä¸€æ ·çš„æ¨¡å—cloud-stream-rabbitmq-consumer8803ï¼Œä½œä¸ºæ¶ˆæ¯çš„ç¬¬äºŒä¸ªæ¶ˆæ¯æ¶ˆè´¹è€…ã€‚è¿è¡Œ8801ã€8802ã€8803åå‘ç°ï¼Œ8801å‘é€ä¸€æ¡æ¶ˆæ¯åï¼Œ8802å’Œ8803éƒ½å¤„ç†äº†è¯¥æ¶ˆæ¯ï¼Œè¿™å°±æ˜¯é‡å¤æ¶ˆè´¹çš„é—®é¢˜ï¼ˆå®é™…ä¸Šå¹¶ä¸æ˜¯é‡å¤æ¶ˆè´¹ï¼Œè€Œæ˜¯å¯¹æ¯ä¸ªåˆ†ç»„éƒ½å­˜åœ¨ä¸€ä¸ªç»‘å®šåˆ°exchangeçš„é˜Ÿåˆ—ï¼Œæ¶ˆæ¯ä¼šè¢«å‘é€åˆ°æ¯æ¡é˜Ÿåˆ—ï¼‰ã€‚å¯ä»¥åˆ©ç”¨åˆ†ç»„çš„ç‰¹æ€§æ¥è§£å†³ã€‚åœ¨cloud streamä¸­å¤„äºåŒä¸€ä¸ªgroupä¸­çš„å¤šä¸ªæ¶ˆè´¹è€…æ˜¯ç«äº‰å…³ç³»ï¼ˆå³ç›‘å¬åŒä¸€æ¡é˜Ÿåˆ—ï¼‰ï¼Œå°±èƒ½å¤Ÿä¿è¯æ¶ˆæ¯åªä¼šè¢«å…¶ä¸­ä¸€ä¸ªåº”ç”¨æ¶ˆè´¹ä¸€æ¬¡ã€‚ å¹¶ä¸”æ³¨æ„åˆ°é»˜è®¤é…ç½®çš„é˜Ÿåˆ—å…·æœ‰AutoDeleteå±æ€§ï¼Œåœ¨æ¶ˆè´¹è€…åº”ç”¨åœæ­¢è¿è¡Œåå°±ä¼šè‡ªåŠ¨åˆ é™¤é˜Ÿåˆ—ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µã€‚ åœ¨8802ä¸­é…ç½®spring.cloud.stream.bindings.input.group=spectrumrpcA,8803é…ç½®spring.cloud.stream.bindings.input.group=spectrumrpcBï¼Œå†æ¬¡æŸ¥çœ‹rabbitmqæ§åˆ¶ç•Œé¢ï¼Œå¯è§é˜Ÿåˆ—åå‘ç”Ÿå˜åŒ– å¹¶ä¸”è‡ªå®šä¹‰groupåç”Ÿæˆçš„é˜Ÿåˆ—å…·æœ‰durableå±æ€§ï¼Œå³é˜Ÿåˆ—æ˜¯æŒä¹…åŒ–çš„ï¼Œå³ä½¿æ¶ˆè´¹è€…åº”ç”¨é‡å¯ï¼Œä¹Ÿä¸ä¼šä¸¢å¤±æ¶ˆæ¯ã€‚ æˆ‘ä»¬æŠŠ8802å’Œ8803çš„groupéƒ½é…ç½®æˆspectrumrpcAï¼Œå†æ¬¡è¿è¡Œåº”ç”¨ï¼Œæ¶ˆæ¯å°±ä¸ä¼šè¢«å¤šå¤„æ¶ˆè´¹äº†ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"},{"name":"SpringCloud Stream","slug":"SpringCloud-Stream","permalink":"https://www.codetool.top/tags/SpringCloud-Stream/"}]},{"title":"leetcode876-é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹","slug":"leetcode876-é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹","date":"2020-03-23T00:51:39.000Z","updated":"2020-03-23T00:54:58.558Z","comments":true,"path":"article/leetcode876-é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹/","link":"","permalink":"https://www.codetool.top/article/leetcode876-%E9%93%BE%E8%A1%A8%E7%9A%84%E4%B8%AD%E9%97%B4%E7%BB%93%E7%82%B9/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªå¸¦æœ‰å¤´ç»“ç‚¹ head çš„éç©ºå•é“¾è¡¨ï¼Œè¿”å›é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹ã€‚ å¦‚æœæœ‰ä¸¤ä¸ªä¸­é—´ç»“ç‚¹ï¼Œåˆ™è¿”å›ç¬¬äºŒä¸ªä¸­é—´ç»“ç‚¹ã€‚ ç¤ºä¾‹ 1: è¾“å…¥ï¼š [1,2,3,4,5]è¾“å‡ºï¼š æ­¤åˆ—è¡¨ä¸­çš„ç»“ç‚¹ 3 (åºåˆ—åŒ–å½¢å¼ï¼š[3,4,5])è¿”å›çš„ç»“ç‚¹å€¼ä¸º 3 ã€‚ (æµ‹è¯„ç³»ç»Ÿå¯¹è¯¥ç»“ç‚¹åºåˆ—åŒ–è¡¨è¿°æ˜¯ [3,4,5])ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬è¿”å›äº†ä¸€ä¸ª ListNode ç±»å‹çš„å¯¹è±¡ ansï¼Œè¿™æ ·ï¼šans.val = 3, ans.next.val = 4, ans.next.next.val = 5, ä»¥åŠ ans.next.next.next = NULL. ç¤ºä¾‹ 2: è¾“å…¥ï¼š [1,2,3,4,5,6]è¾“å‡ºï¼š æ­¤åˆ—è¡¨ä¸­çš„ç»“ç‚¹ 4 (åºåˆ—åŒ–å½¢å¼ï¼š[4,5,6])ç”±äºè¯¥åˆ—è¡¨æœ‰ä¸¤ä¸ªä¸­é—´ç»“ç‚¹ï¼Œå€¼åˆ†åˆ«ä¸º 3 å’Œ 4ï¼Œæˆ‘ä»¬è¿”å›ç¬¬äºŒä¸ªç»“ç‚¹ã€‚ æç¤ºï¼š ç»™å®šé“¾è¡¨çš„ç»“ç‚¹æ•°ä»‹äº 1 å’Œ 100 ä¹‹é—´ã€‚ 2 è§£æ³•2.1 æ€æƒ³å¿«æ…¢æŒ‡é’ˆ 2.2 ä»£ç class Solution { public ListNode middleNode(ListNode head) { ListNode fast,slow; fast = slow = head; while(fast!=null &amp;&amp; fast.next!=null){ fast = fast.next.next; slow = slow.next; } return slow; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"ä½¿ç”¨SpringCloud Buså®Œå–„Configçš„åŠ¨æ€åˆ·æ–°","slug":"ä½¿ç”¨SpringCloud Buså®Œå–„Configçš„åŠ¨æ€åˆ·æ–°","date":"2020-03-22T13:49:10.000Z","updated":"2020-03-22T13:50:17.880Z","comments":true,"path":"article/ä½¿ç”¨SpringCloud Buså®Œå–„Configçš„åŠ¨æ€åˆ·æ–°/","link":"","permalink":"https://www.codetool.top/article/%E4%BD%BF%E7%94%A8SpringCloud%20Bus%E5%AE%8C%E5%96%84Config%E7%9A%84%E5%8A%A8%E6%80%81%E5%88%B7%E6%96%B0/","excerpt":"","text":"1 SpringCloud Busæ¦‚è¿°Spring Cloud Busæ˜¯å°†åˆ†å¸ƒå¼ç³»ç»Ÿçš„èŠ‚ç‚¹ä¸è½»é‡çº§æ¶ˆæ¯ç³»ç»Ÿé“¾æ¥èµ·æ¥çš„æ¡†æ¶ï¼Œå®ƒæ•´åˆäº†Javaçš„äº‹ä»¶å¤„ç†æœºåˆ¶å’Œæ¶ˆæ¯ä¸­é—´ä»¶çš„åŠŸèƒ½ã€‚ Bus ç›®å‰åªæ”¯æŒRabbitMQå’ŒKafka 1.1 ä»€ä¹ˆæ˜¯æ€»çº¿åœ¨å¾®æœåŠ¡æ¶æ„çš„ç³»ç»Ÿä¸­ï¼Œé€šå¸¸ä¼šä½¿ç”¨è½»é‡çº§çš„æ¶ˆæ¯ä»£ç†æ¥æ„å»ºä¸€ä¸ªå…±ç”¨çš„æ¶ˆæ¯ä¸»é¢˜, å¹¶è®©ç³»ç»Ÿä¸­æ‰€æœ‰å¾®æœåŠ¡å®ä¾‹éƒ½è¿æ¥ä¸Šæ¥ã€‚ç”±äºè¯¥ä¸»é¢˜ä¸­äº§ç”Ÿçš„æ¶ˆæ¯ä¼šè¢«æ‰€æœ‰å®ä¾‹ç›‘å¬å’Œæ¶ˆè´¹ï¼Œæ‰€ä»¥ç§°å®ƒä¸ºæ¶ˆæ¯æ€»çº¿ã€‚åœ¨æ€»çº¿ä¸Šçš„å„ä¸ªå®ä¾‹ï¼Œéƒ½å¯ä»¥æ–¹ä¾¿åœ°å¹¿æ’­ä¸€äº›éœ€è¦è®©å…¶ä»–è¿æ¥åœ¨è¯¥ä¸»é¢˜ä¸Šçš„å®ä¾‹éƒ½çŸ¥é“çš„æ¶ˆæ¯ã€‚ 1.2 åŸºæœ¬åŸç†ConfigClientå®ä¾‹éƒ½ç›‘å¬MQä¸­åŒä¸€ä¸ªtopic(é»˜è®¤æ˜¯springCloudBus)ã€‚ å½“-ä¸ªæœåŠ¡åˆ·æ–°æ•°æ®çš„æ—¶å€™,å®ƒä¼šæŠŠè¿™ä¸ªä¿¡æ¯æ”¾å…¥åˆ°Topicä¸­,è¿™æ ·å…¶å®ƒç›‘å¬åŒä¸€Topicçš„æœåŠ¡å°±èƒ½å¾—åˆ°é€šçŸ¥ï¼Œç„¶åå»æ›´æ–°è‡ªèº«çš„é…ç½®ã€‚ 2 ä½¿ç”¨SpringCloud Busè§£å†³Configçš„åŠ¨æ€åˆ·æ–°é—®é¢˜åœ¨ä¸Šç¯‡æ–‡ç« SpringCloud Configé…ç½®ä¸­å¿ƒçš„ä½¿ç”¨ä¸­ç•™ä¸‹äº†ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæœ‰å¤šä¸ªconfigçš„ä½¿ç”¨è€…ï¼Œå¦‚ä½•åœ¨é…ç½®ä¿®æ”¹çš„æ—¶å€™é€šçŸ¥å®ƒä»¬ï¼Ÿ è®¾è®¡æ€è·¯ï¼š åˆ©ç”¨æ¶ˆæ¯æ€»çº¿è§¦å‘ä¸€ä¸ªå®¢æˆ·ç«¯/bus/refreshï¼Œè€Œåˆ·æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„é…ç½® åˆ©ç”¨æ¶ˆæ¯æ€»çº¿è§¦å‘ä¸€ä¸ªæœåŠ¡ç«¯ConfigServerçš„/bus/refreshç«¯ç‚¹ï¼Œè€Œåˆ·æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„é…ç½® æ˜¾ç„¶ç¬¬äºŒç§æ€æƒ³ä¼šæ›´å¥½ï¼ŒåŸå› æœ‰ï¼š æ‰“ç ´äº†å¾®æœåŠ¡çš„èŒè´£å•ä¸€æ€§ï¼Œå› ä¸ºå¾®æœåŠ¡æœ¬èº«æ˜¯ä¸šåŠ¡æ¨¡å—ï¼Œå®ƒæœ¬ä¸åº”è¯¥æ‰¿æ‹…é…ç½®åˆ·æ–°çš„èŒè´£ã€‚ ç ´åäº†å¾®æœåŠ¡å„èŠ‚ç‚¹çš„å¯¹ç­‰æ€§ã€‚ æœ‰ä¸€å®šçš„å±€é™æ€§ã€‚ä¾‹å¦‚ï¼Œå¾®æœåŠ¡åœ¨è¿ç§»æ—¶ï¼Œå®ƒçš„ç½‘ç»œåœ°å€å¸¸å¸¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ­¤æ—¶å¦‚æœæƒ³è¦åšåˆ°è‡ªåŠ¨åˆ·æ–°ï¼Œé‚£å°±ä¼šå¢åŠ æ›´å¤šçš„ä¿®æ”¹ æˆ‘ä»¬æ–°å»ºæ¨¡å—cloud-config-client3366ä½œä¸ºconfigçš„ç¬¬äºŒä¸ªä½¿ç”¨è€…ï¼Œå°†å®ƒå’Œcloud-config-client3355çš„pomä¾èµ–éƒ½ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼ˆä¸ºconfigæœåŠ¡å™¨ä¹Ÿæ·»åŠ spring-cloud-starter-bus-amqpä¾èµ–ï¼‰ï¼š &lt;!-- æ·»åŠ rabbitmq æ€»çº¿æ”¯æŒ --> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-bus-amqp&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-config&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-netflix-eureka-client&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-web&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-actuator&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-test&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;/dependency> yamlé…ç½®ï¼šï¼ˆæ–‡ä»¶åä¹Ÿè¦æ˜¯bootstrap.ymlï¼‰ server: port: 3366 spring: application: name: config-client cloud: config: label: master # åˆ†æ”¯åç§° name: config # é…ç½®æ–‡ä»¶åç§° profile: dev # è¯»å–çš„profile uri: http://localhost:3344 #é…ç½®ä¸­å¿ƒçš„åœ°å€ rabbitmq: #rabbitmqç›¸å…³é…ç½®ï¼Œè¯·ä¸º3355ä¹Ÿæ·»åŠ è¿™ä¸€éƒ¨åˆ† port: 5672 host: localhost username: guest password: guest eureka: client: service-url: defaultZone: http://eureka7001.com:7001/eureka å¯åŠ¨ç±»å’Œcontrollerçš„å†™æ³•å’Œ3355ä¸€æ ·ã€‚ cloud-config-center-3344çš„yamlé…ç½®ä¿®æ”¹ä¸ºï¼š server: port: 3344 spring: application: name: cloud-config-center cloud: config: server: git: uri: http://git.codetool.top/RhettPeng/springcloud-config.git # ä»“åº“åœ°å€ search-paths: - springcloud-config label: master # è¯»å–åˆ†æ”¯ # æ·»åŠ rabbitmqç›¸å…³ rabbitmq: host: localhost port: 5672 username: guest password: guest eureka: client: service-url: defaultZone: http://localhost:7001/eureka # æš´éœ²busåˆ·æ–°çš„ç«¯ç‚¹ management: endpoints: web: exposure: include: 'bus-refresh' åˆ°æ­¤é…ç½®æˆåŠŸï¼Œåªè¦gitä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶ä¿®æ”¹çš„æ—¶å€™å‘ http://localhost:3344/actuator/bus-refresh å‘å‡ºpostè¯·æ±‚ï¼ˆå¯ä»¥ä½¿ç”¨webhookï¼‰ï¼Œå°±èƒ½é€šçŸ¥æ‰€æœ‰çš„é…ç½®ä½¿ç”¨è€…åˆ·æ–°é…ç½®ã€‚ æŸ¥çœ‹rabbitmqçš„exchangeï¼š è¡¥å……ï¼šå®šç‚¹é€šçŸ¥ buså¯ä»¥æŒ‡å®šé€šçŸ¥å…·ä½“ä¸€ä¸ªå®ä¾‹è€Œä¸æ˜¯å…¨éƒ¨ã€‚åªéœ€è¦åœ¨ http://localhost:3344/actuator/bus-refresh åé¢åŠ ä¸Š /destinationï¼Œå…¶ä¸­destinationä¸ºæœåŠ¡IDã€‚ä¹‹å‰æœ‰ä»‹ç»å¯ä»¥é€šè¿‡eureka.instance.instance-idæŒ‡å®šã€‚ ä¾‹å¦‚post http://localhost:3344/actuator/bus-refresh/config-client:3355 å³å¯åªé€šçŸ¥3355ï¼Œè€Œä¸é€šçŸ¥å…¶ä»–ä½¿ç”¨è€…ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"},{"name":"SpringCloud Bus","slug":"SpringCloud-Bus","permalink":"https://www.codetool.top/tags/SpringCloud-Bus/"}]},{"title":"SpringCloud Configé…ç½®ä¸­å¿ƒçš„ä½¿ç”¨","slug":"SpringCloud Configé…ç½®ä¸­å¿ƒçš„ä½¿ç”¨","date":"2020-03-22T13:03:47.000Z","updated":"2020-03-22T13:04:36.360Z","comments":true,"path":"article/SpringCloud Configé…ç½®ä¸­å¿ƒçš„ä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/SpringCloud%20Config%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 æ¦‚è¿°SpringCloud Configä¸ºå¾®æœåŠ¡æ¶æ„ä¸­çš„å¾®æœåŠ¡æä¾›é›†ä¸­åŒ–çš„å¤–éƒ¨é…ç½®æ”¯æŒï¼Œé…ç½®æœåŠ¡å™¨ä¸ºå„ä¸ªä¸åŒå¾®æœåŠ¡åº”ç”¨çš„æ‰€æœ‰ç¯å¢ƒæä¾›äº†ä¸€ä¸ªä¸­å¿ƒåŒ–çš„å¤–éƒ¨é…ç½®ã€‚ SpringCloud Configé»˜è®¤ä½¿ç”¨Gitæ¥å­˜å‚¨é…ç½®æ–‡ä»¶(ä¹Ÿæœ‰å…¶å®ƒæ–¹å¼,æ¯”å¦‚æ”¯æŒSVNå’Œæœ¬åœ°æ–‡ä»¶)ï¼Œä½†æœ€æ¨èçš„è¿˜æ˜¯Gitï¼Œè€Œä¸”ä½¿ç”¨çš„æ˜¯http/httpsè®¿é—®çš„å½¢å¼ 1.1 ä½œç”¨ é›†ä¸­ç®¡ç†é…ç½®æ–‡ä»¶ ä¸åŒç¯å¢ƒä¸åŒé…ç½®,åŠ¨æ€åŒ–çš„é…ç½®æ›´æ–°,åˆ†ç¯å¢ƒéƒ¨ç½²æ¯”å¦‚dev/test/prod/beta/release è¿è¡ŒæœŸé—´åŠ¨æ€è°ƒæ•´é…ç½®ï¼Œä¸å†éœ€è¦åœ¨æ¯ä¸ªæœåŠ¡éƒ¨ç½²çš„æœºå™¨ä¸Šç¼–å†™é…ç½®æ–‡ä»¶ï¼ŒæœåŠ¡ä¼šå‘é…ç½®ä¸­å¿ƒç»Ÿä¸€æ‹‰å–é…ç½®è‡ªå·±çš„ä¿¡æ¯ å½“é…ç½®å‘ç”Ÿå˜åŠ¨æ—¶ï¼ŒæœåŠ¡ä¸éœ€è¦é‡å¯å³å¯æ„ŸçŸ¥åˆ°é…ç½®çš„å˜åŒ–å¹¶åº”ç”¨æ–°çš„é…ç½® å°†é…ç½®ä¿¡æ¯ä»¥RESTæ¥å£çš„å½¢å¼æš´éœ² 2 ä½¿ç”¨2.1 é…ç½®ä¸­å¿ƒæœåŠ¡å™¨æ­å»ºå…ˆå»ºä¸€ä¸ªgitä»“åº“ç”¨äºå­˜æ”¾é…ç½®ï¼Œå‚è€ƒä»“åº“åœ°å€ï¼š http://git.codetool.top/RhettPeng/springcloud-config æ–°å»ºæ¨¡å—cloud-config-center-3344 ä¾èµ–ï¼š &lt;!-- config server --> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-config-server&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-netflix-eureka-client&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-web&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-actuator&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-test&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;/dependency> yamlï¼š server: port: 3344 spring: application: name: cloud-config-center cloud: config: server: git: uri: http://git.codetool.top/RhettPeng/springcloud-config.git # ä»“åº“åœ°å€ search-paths: - springcloud-config label: master # è¯»å–åˆ†æ”¯ eureka: client: service-url: defaultZone: http://localhost:7001/eureka å¯åŠ¨ç±»ï¼šè¿™é‡Œè¦ä½¿ç”¨@EnableConfigServer @SpringBootApplication @EnableConfigServer public class MainAppConfigServer3344 { public static void main(String[] args) { SpringApplication.run(MainAppConfigServer3344.class, args); } } è¿™æ ·ä¸€ä¸ªé…ç½®ä¸­å¿ƒæœåŠ¡å™¨å°±æ­å»ºå®Œäº†ï¼Œå¯ä»¥è¿›è¡Œæµ‹è¯•ã€‚ 2.2 urlæ˜ å°„è§„åˆ™å¦‚ä½•é€šè¿‡é…ç½®ä¸­å¿ƒæœåŠ¡å™¨è®¿é—®gitä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶ï¼Ÿæ˜ å°„è§„åˆ™å¦‚ä¸‹æ‰€ç¤ºï¼š /{application}/{profile}[/{label}](å¯çœç•¥æ‹“å±•åï¼Œä½†å“åº”çš„é…ç½®æ ¼å¼å¯èƒ½æ˜¯jsonå½¢å¼çš„ï¼Œå’Œæºæ–‡ä»¶ä¸ç›¸åŒ) /{application}-{profile}.yml /{label}/{application}-{profile}.ymlï¼ˆlabelæŒ‡å®šåˆ†æ”¯ï¼Œspring.cloud.config.labelå¯é…ç½®é»˜è®¤åˆ†æ”¯ï¼‰ /{application}-{profile}.properties /{label}/{application}-{profile}.properties ä»¥ä¸Šé¢æ­å»ºçš„é…ç½®ä¸­å¿ƒæœåŠ¡å™¨ä¸ºä¾‹ï¼Œå¯ä»¥è®¿é—® http://localhost:3344/master/config-dev.yml æ¥è·å– config-dev.yml é…ç½®ã€‚è¿˜æœ‰å¦å¤–ä¸¤ç§å†™æ³•ï¼š http://localhost:3344/config-dev.ymlï¼ˆå·²é…ç½®é»˜è®¤åˆ†æ”¯ï¼‰ http://localhost:3344/master/config-dev (çœç•¥æ‹“å±•å) 2.3 åŠ è½½é¡ºåºå’Œåˆ†æ­§ç®¡ç†applicaiton.ymlæ˜¯ç”¨æˆ·çº§çš„èµ„æºé…ç½®é¡¹ bootstrap.ymlæ˜¯ç³»ç»Ÿçº§çš„ï¼Œä¼˜å…ˆçº§æ›´åŠ é«˜ Spring Cloudä¼šåˆ›å»ºä¸€ä¸ª&quot;Bootstrap Context&quot;ï¼Œä½œä¸ºSpringåº”ç”¨çš„Application Contextçš„çˆ¶ä¸Šä¸‹æ–‡ã€‚åˆå§‹åŒ–çš„æ—¶å€™ï¼ŒBootstrap Contextè´Ÿè´£ä»å¤–éƒ¨æºåŠ è½½é…ç½®å±æ€§å¹¶è§£æé…ç½®ã€‚è¿™ä¸¤ä¸ªä¸Šä¸‹æ–‡å…±äº«ä¸€ä¸ªä»å¤–éƒ¨è·å–çš„Environmentã€‚ Bootstrapå±æ€§æœ‰é«˜ä¼˜å…ˆçº§ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬ä¸ä¼šè¢«æœ¬åœ°é…ç½®è¦†ç›–ã€‚Bootstrap contextå’ŒApplication Contextæœ‰ç€ä¸åŒçš„çº¦å®šï¼Œæ‰€ä»¥æ–°å¢äº†ä¸€ä¸ªbootstrap.ymlæ–‡ä»¶, ä¿è¯Bootstrap Contextå’ŒApplication Contexté…ç½®çš„åˆ†ç¦»ã€‚ è¦å°†Clientæ¨¡å—ä¸‹çš„application.ymlæ–‡ä»¶æ”¹ä¸ºbootstrap.yml,è¿™æ˜¯å¾ˆå…³é”®çš„ã€‚ å› ä¸ºbootstrap.ymlæ˜¯æ¯”application.ymlå…ˆåŠ è½½çš„ã€‚bootstrap.ymlä¼˜å…ˆçº§é«˜äºapplication.ymlï¼ˆè®©æœ¬åœ°é…ç½®çš„ä¼˜å…ˆçº§æ›´é«˜ï¼‰ 2.4 æ­å»ºé…ç½®ä½¿ç”¨ç«¯æ–°å»ºæ¨¡å—cloud-config-client3355ï¼Œä¾èµ–ï¼š &lt;!-- config client --> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-config&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-netflix-eureka-client&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-web&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-actuator&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-test&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;/dependency> yamlé…ç½®ï¼šæ–‡ä»¶åä¸ºbootstrap.ymlï¼Œè¿™é‡Œspring.cloud.configä¸‹é¢é…ç½®çš„æ˜¯è¯»å–å“ªä¸ªé…ç½®æ–‡ä»¶ï¼Œå¯¹åº”urlæ˜ å°„ä¸­çš„å‚æ•°ã€‚ server: port: 3355 spring: application: name: config-client cloud: config: label: master # åˆ†æ”¯åç§° name: config # é…ç½®æ–‡ä»¶åç§° profile: dev # è¯»å–çš„profile uri: http://localhost:3344 #é…ç½®ä¸­å¿ƒçš„åœ°å€ eureka: client: service-url: defaultZone: http://eureka7001.com:7001/eureka ç¼–å†™ä¸€ä¸ªå¯ä»¥è·å–é…ç½®çš„controlleræµ‹è¯•ï¼Œè¿™é‡Œçš„config.infoæ˜¯åœ¨é…ç½®ä¸­å¿ƒä¸­çš„é…ç½®é¡¹ï¼š @RestController public class ConfigClientController { @Value(\"${config.info}\") private String configInfo; @GetMapping(\"/configInfo\") public String getConfigInfo(){ return configInfo; } } å¯åŠ¨è¯¥æ¨¡å—ï¼Œè®¿é—® http://localhost:3355/configInfo ï¼Œå¯ä»¥çœ‹åˆ°æµè§ˆå™¨è¾“å‡ºï¼š master branch,springcloud-config/config-dev.yml version=1å¯¹åº”çš„å°±æ˜¯masterä¸‹çš„config-devé…ç½®æ–‡ä»¶ 2.5 å¦‚ä½•åŠ¨æ€è·å–é…ç½®ä¿®æ”¹å¦‚æœgitä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶å‘ç”Ÿä¿®æ”¹ï¼Œé…ç½®ä¸­å¿ƒèƒ½ç«‹å³è·å¾—ä¿®æ”¹ï¼Œä½†é…ç½®ä½¿ç”¨ç«¯ç¡®æ— æ³•å¯¹ä¿®æ”¹çš„é…ç½®ç«‹å³ç”Ÿæ•ˆï¼Œé™¤éé‡å¯ã€‚é‚£ä¹ˆå¦‚ä½•è®©é…ç½®ä½¿ç”¨ç«¯åŠ¨æ€è·å–é…ç½®çš„ä¿®æ”¹ï¼Ÿ é¦–å…ˆï¼Œä¿è¯é…ç½®ä½¿ç”¨ç«¯å¼•å…¥äº†actuatorä¾èµ–ï¼ˆä¸Šé¢å·²ç»å¼•å…¥ï¼‰ï¼š &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-actuator&lt;/artifactId> &lt;/dependency> ç„¶åï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­æš´éœ²ç›‘æ§ç«¯ç‚¹ï¼š management: endpoints: web: exposure: include: \"*\" ç„¶åï¼Œåœ¨ä¸šåŠ¡ç±»ä¸ŠåŠ ä¸Š@RefreshScopeæ³¨è§£ï¼š @RestController @RefreshScope public class ConfigClientController { @Value(\"${config.info}\") private String configInfo; @GetMapping(\"/configInfo\") public String getConfigInfo(){ return configInfo; } } æ­¤åï¼Œå½“é…ç½®ä¿®æ”¹åï¼Œå¯ä»¥å‘ http://localhost:3355/actuator/refresh å‘é€ä¸€ä¸ª POST è¯·æ±‚ï¼Œä½¿å¾—æ¨¡å—ä¸»åŠ¨åˆ·æ–°é…ç½®ï¼ˆè¿™ä¸ªè¯·æ±‚å¯ä»¥åˆ©ç”¨webhookå®ç°ï¼‰ ä½†æ˜¯ï¼Œå€˜è‹¥æœ‰å¤šä¸ªé…ç½®ä½¿ç”¨æ–¹ï¼Œéš¾é“éœ€è¦ç»™æ¯ä¸ªä¸»æœºå‘é€ä¸€ä¸ªPOSTè¯·æ±‚ï¼Ÿæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Ÿè¿™å°±éœ€è¦SpringCloud Busäº†ã€‚ã€‚ã€‚ï¼ˆè§ä¸‹ç¯‡ï¼‰","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"},{"name":"SpringCloud Config","slug":"SpringCloud-Config","permalink":"https://www.codetool.top/tags/SpringCloud-Config/"}]},{"title":"æ–°ä¸€ä»£ç½‘å…³SpringCloud Gatewayæ¦‚è¿°å’Œç®€å•ä½¿ç”¨","slug":"æ–°ä¸€ä»£ç½‘å…³Spring Cloud Gatewayæ¦‚è¿°å’Œç®€å•ä½¿ç”¨","date":"2020-03-22T02:40:36.000Z","updated":"2020-03-22T03:18:32.618Z","comments":true,"path":"article/æ–°ä¸€ä»£ç½‘å…³Spring Cloud Gatewayæ¦‚è¿°å’Œç®€å•ä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/%E6%96%B0%E4%B8%80%E4%BB%A3%E7%BD%91%E5%85%B3Spring%20Cloud%20Gateway%E6%A6%82%E8%BF%B0%E5%92%8C%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 Gatewayæ¦‚è¿°Gatewayæ˜¯åœ¨Springç”Ÿæ€ç³»ç»Ÿä¹‹ä¸Šæ„å»ºçš„APIç½‘å…³æœåŠ¡,åŸºäºSpring 5, Spring Boot 2å’ŒProject Reactorç­‰æŠ€æœ¯ã€‚ Gatewayæ—¨åœ¨æä¾›ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹å¼æ¥å¯¹APIè¿›è¡Œè·¯ç”±,ä»¥åŠåŸºäºFilteré“¾æä¾›ä¸€äº›å¼ºå¤§çš„è¿‡æ»¤å™¨åŠŸèƒ½ï¼Œä¾‹å¦‚ç†”æ–­ã€é™æµã€é‡è¯•ç­‰ã€‚ SpringCloud Gatewayä½œä¸ºSpring Cloudç”Ÿæ€ç³»ç»Ÿä¸­çš„ç½‘å…³ï¼Œç›®æ ‡æ˜¯æ›¿ä»£Zuulï¼Œåœ¨Spring Cloud 2.0ä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œæ²¡æœ‰å¯¹æ–°ç‰ˆæœ¬çš„Zuul 2.0ä»¥ä¸Šæœ€æ–°é«˜æ€§èƒ½ç‰ˆæœ¬è¿›è¡Œé›†æˆï¼Œä»ç„¶è¿˜æ˜¯ä½¿ç”¨çš„Zuul 1.xéReactoræ¨¡å¼çš„è€ç‰ˆæœ¬ã€‚è€Œä¸ºäº†æå‡ç½‘å…³çš„æ€§èƒ½ï¼ŒSpringCloud Gatewayæ˜¯åŸºäºWebFluxæ¡†æ¶å®ç°çš„ï¼Œè€ŒWebFluxæ¡†æ¶åº•å±‚åˆ™ä½¿ç”¨äº†é«˜æ€§èƒ½çš„Reactoræ¨¡å¼é€šä¿¡æ¡†æ¶Nettyã€‚ 1.1 ä¸ºä»€ä¹ˆé€‰ç”¨Gatewayè€Œä¸æ˜¯zuulä¸€æ–¹é¢å› ä¸ºZuul1.0å·²ç»è¿›å…¥äº†ç»´æŠ¤é˜¶æ®µï¼Œä¸”Gatewayæ˜¯SpringCloudå›¢é˜Ÿç ”å‘çš„ï¼Œæ˜¯äº²å„¿å­äº§å“ï¼Œå€¼å¾—ä¿¡èµ–ã€‚è€Œä¸”å¾ˆå¤šåŠŸèƒ½Zuuléƒ½æ²¡æœ‰ï¼Œç”¨èµ·æ¥ä¹Ÿéå¸¸çš„ç®€å•ä¾¿æ·ã€‚ Zuul 1.x, æ˜¯ä¸€ä¸ªåŸºäºé˜»å¡I/Oçš„API Gateway Zuul 1.x åŸºäºServlet 2.5ä½¿ç”¨é˜»å¡æ¶æ„ å®ƒä¸æ”¯æŒä»»ä½•é•¿è¿æ¥(å¦‚WebSocket) Zuulçš„è®¾è®¡æ¨¡å¼å’ŒNginxè¾ƒåƒï¼Œæ¯æ¬¡I/Oæ“ä½œéƒ½æ˜¯ä»å·¥ä½œçº¿ç¨‹ä¸­é€‰æ‹©ä¸€ä¸ªæ‰§è¡Œï¼Œè¯·æ±‚çº¿ç¨‹è¢«é˜»å¡åˆ°å·¥ä½œçº¿ç¨‹å®Œæˆï¼Œä½†æ˜¯å·®åˆ«æ˜¯Nginxç”¨C++å®ç°ï¼ŒZuulç”¨Javaå®ç°ï¼Œè€ŒJVMæœ¬èº«ä¼šæœ‰ç¬¬ä¸€æ¬¡åŠ è½½è¾ƒæ…¢çš„æƒ…å†µï¼Œä½¿å¾—Zuulçš„æ€§èƒ½ç›¸å¯¹è¾ƒå·®ã€‚ Zuul 2.x ç†å¿µæ›´å…ˆè¿›ï¼Œæƒ³åŸºäºNettyéé˜»å¡å’Œæ”¯æŒé•¿è¿æ¥ï¼Œä½†SpringCloudç›®å‰è¿˜æ²¡æœ‰æ•´åˆã€‚Zuul 2.xçš„æ€§èƒ½è¾ƒZuul 1.xåœ¨æ€§èƒ½æ–¹é¢æœ‰è¾ƒå¤§æå‡ï¼Œæ ¹æ®å®˜æ–¹æä¾›çš„åŸºå‡†æµ‹è¯•ï¼ŒSpring Cloud Gatewayçš„RPS (æ¯ç§’è¯·æ±‚æ•°)æ˜¯Zuulçš„1.6å€ã€‚ Gatewayæ˜¯åŸºäºå¼‚æ­¥éé˜»å¡æ¨¡å‹ä¸Šè¿›è¡Œå¼€å‘çš„ï¼Œæ€§èƒ½æ–¹é¢ä¸éœ€è¦æ‹…å¿ƒã€‚è™½ç„¶Netflixæ—©å°±å‘å¸ƒäº†æœ€æ–°çš„Zuul 2.xï¼Œä½†Spring Cloudè²Œä¼¼æ²¡æœ‰æ•´åˆè®¡åˆ’ã€‚è€Œä¸”Netflixç›¸å…³ç»„ä»¶éƒ½å®£å¸ƒè¿›å…¥ç»´æŠ¤æœŸ; ä¸çŸ¥å‰æ™¯å¦‚ä½•? Gatewayç‰¹æ€§ åŸºäºSpring Framework 5, Project Reactorå’ŒSpring Boot 2.0è¿›è¡Œæ„å»º; åŠ¨æ€è·¯ç”±ï¼šèƒ½å¤ŸåŒ¹é…ä»»ä½•è¯·æ±‚å±æ€§; å¯ä»¥å¯¹è·¯ç”±æŒ‡å®šPredicate (æ–­è¨€)å’ŒFilter (è¿‡æ»¤å™¨) ; é›†æˆHystrixçš„æ–­è·¯å™¨åŠŸèƒ½; é›†æˆSpring CloudæœåŠ¡å‘ç°åŠŸèƒ½; æ˜“äºç¼–å†™çš„Predicate (æ–­è¨€)å’ŒFilter (è¿‡æ»¤å™¨) ; è¯·æ±‚é™æµåŠŸèƒ½; æ”¯æŒè·¯å¾„é‡å†™ã€‚ å¤šæ–¹é¢ç»¼åˆè€ƒè™‘Gatewayæ˜¯å¾ˆç†æƒ³çš„ç½‘å…³é€‰æ‹©ã€‚ 1.2 ä»€ä¹ˆæ˜¯webfluxä¼ ç»Ÿçš„Webæ¡†æ¶,æ­¤å¦‚è¯´: struts2, springmvcç­‰éƒ½æ˜¯åŸºäºServlet APIä¸Servletå®¹å™¨åŸºç¡€ä¹‹ä¸Šè¿è¡Œçš„ã€‚ ä½†æ˜¯: åœ¨Servlet3.1ä¹‹åæœ‰äº†å¼‚æ­¥éé˜»å¡çš„æ”¯æŒã€‚è€ŒWebFluxæ˜¯ä¸€ä¸ªå…¸å‹éé˜»å¡å¼‚æ­¥çš„æ¡†æ¶ï¼Œå®ƒçš„æ ¸å¿ƒæ˜¯åŸºäºReactorçš„ç›¸å…³APIå®ç°çš„ã€‚ç›¸å¯¹äºä¼ ç»Ÿçš„webæ¡†æ¶æ¥è¯´ï¼Œå®ƒå¯ä»¥è¿è¡Œåœ¨è¯¸å¦‚Netty, UndertowåŠæ”¯æŒServlet3.1çš„å®¹å™¨ä¸Šã€‚éé˜»å¡å¼+å‡½æ•°å¼ç¼–ç¨‹ï¼ˆSpring5å¿…é¡»ä½¿ç”¨java8ï¼‰ Spring WebFluxæ˜¯Spring 5.0 å¼•å…¥çš„æ–°çš„å“åº”å¼æ¡†æ¶ï¼ŒåŒºåˆ«äºSpring MVC,å®ƒä¸éœ€è¦ä¾èµ–Servlet APIï¼Œå®ƒæ˜¯å®Œå…¨å¼‚æ­¥éé˜»å¡çš„ï¼Œå¹¶ä¸”åŸºäºReactoræ¥å®ç°å“åº”å¼æµè§„èŒƒã€‚ 1.3 ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ Route(è·¯ç”±)ï¼šè·¯ç”±æ˜¯æ„å»ºç½‘å…³çš„åŸºæœ¬æ¨¡å—ï¼Œå®ƒç”±IDã€ç›®æ ‡URIã€ä¸€ç³»åˆ—çš„æ–­è¨€å’Œè¿‡æ»¤å™¨ç»„æˆ,å¦‚æ–­è¨€ä¸ºtrueåˆ™åŒ¹é…è¯¥è·¯ç”± Predicate(æ–­è¨€)ï¼šå‚è€ƒçš„æ˜¯Java8çš„java.util.function.Predicateï¼Œå¼€å‘äººå‘˜å¯ä»¥åŒ¹é…HTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰å†…å®¹(ä¾‹å¦‚è¯·æ±‚å¤´æˆ–è¯·æ±‚å‚æ•°)ï¼Œå¦‚æœè¯·æ±‚ä¸æ–­è¨€ç›¸åŒ¹é…åˆ™è¿›è¡Œè·¯ç”± Filter(è¿‡æ»¤)ï¼šæŒ‡çš„æ˜¯Springæ¡†æ¶ä¸­GatewayFilterçš„å®ä¾‹,ä½¿ç”¨è¿‡æ»¤å™¨,å¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±å‰æˆ–è€…ä¹‹åå¯¹è¯·æ±‚è¿›è¡Œä¿®æ”¹ 1.4 Gatewayå·¥ä½œæµç¨‹ å®¢æˆ·ç«¯å‘Spring Cloud Gatewayå‘å‡ºè¯·æ±‚ã€‚ç„¶ååœ¨Gateway Handler Mappingä¸­æ‰¾åˆ°ä¸è¯·æ±‚ç›¸åŒ¹é…çš„è·¯ç”±ï¼Œå°†å…¶å‘é€åˆ°Gateway Web Handlerã€‚ Handlerå†é€šè¿‡æŒ‡å®šçš„è¿‡æ»¤å™¨é“¾æ¥å°†è¯·æ±‚å‘é€åˆ°æˆ‘ä»¬å®é™…çš„æœåŠ¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œç„¶åè¿”å›ã€‚è¿‡æ»¤å™¨ä¹‹é—´ç”¨è™šçº¿åˆ†å¼€æ˜¯å› ä¸ºè¿‡æ»¤å™¨å¯èƒ½ä¼šåœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰( â€œpreâ€ )æˆ–ä¹‹å( â€œpostâ€ )æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚ Filteråœ¨â€preâ€ ç±»å‹çš„è¿‡æ»¤å™¨å¯ä»¥åšå‚æ•°æ ¡éªŒã€æƒé™æ ¡éªŒã€æµé‡ç›‘æ§ã€æ—¥å¿—è¾“å‡ºã€åè®®è½¬æ¢ç­‰,åœ¨â€postâ€ç±»å‹çš„è¿‡æ»¤å™¨ä¸­å¯ä»¥åšå“åº”å†…å®¹ã€å“åº”å¤´çš„ä¿®æ”¹ï¼Œæ—¥å¿—çš„è¾“å‡ºï¼Œæµé‡ç›‘æ§ç­‰æœ‰ç€éå¸¸é‡è¦çš„ä½œç”¨ã€‚ 2 ä½¿ç”¨2.1 ä½¿ç”¨æ–‡ä»¶é…ç½®æ–°å»ºæ¨¡å—cloud-gateway-gateway9527ï¼Œä¾èµ–ï¼š &lt;dependencies> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-gateway&lt;/artifactId> &lt;/dependency> &lt;!--gatewayæ— éœ€webå’Œactuator--> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-netflix-eureka-client&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-test&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;/dependency> &lt;dependency> &lt;groupId>com.rhett&lt;/groupId> &lt;artifactId>cloud-api-commons&lt;/artifactId> &lt;version>${project.version}&lt;/version> &lt;/dependency> &lt;/dependencies> yamlé…ç½®ï¼š server: port: 9527 spring: application: name: cloud-gateway cloud: gateway: routes: - id: payment_routh # è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å uri: http://localhost:8001 # åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/** # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± - id: payment_routh2 uri: http://localhost:8001 predicates: - Path=/payment/lb/** eureka: instance: hostname: cloud-gateway-service client: register-with-eureka: true fetch-registry: true service-url: defaultZone: http://eureka7001.com:7001/eureka å¯åŠ¨ç±»ï¼š @SpringBootApplication @EnableEurekaClient public class GatewayMain9527 { public static void main(String[] args) { SpringApplication.run(GatewayMain9527.class, args); } } å¯åŠ¨æ¨¡å—cloud-eureka-server7001ã€cloud-provider-payment8001ï¼Œå†å¯åŠ¨ç½‘å…³ï¼Œå°±èƒ½é€šè¿‡ http://localhost:9527/payment/1 ã€ http://localhost:9527/payment/lb å»è®¿é—®8001ä¸Šçš„ payment serviceäº†ã€‚ 2.2 ç¼–ç é…ç½®@Configuration public class Gateway { @Bean public RouteLocator routes(RouteLocatorBuilder builder){ RouteLocatorBuilder.Builder routes = builder.routes(); routes.route(\"path_route_baidu\", r->r.path(\"/guonei\") .uri(\"http://news.baidu.com/guonei\")).build(); return routes.build(); } } 2.3 åŠ¨æ€è·¯ç”±æ›´æ”¹ä¸ºä»¥ä¸‹é…ç½®ï¼Œå³å¯å®ç°ä»æ³¨å†Œä¸­å¿ƒåˆ›å»ºè·¯ç”±ï¼š spring: application: name: cloud-gateway cloud: gateway: discovery: locator: enabled: true # å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”± routes: - id: payment_routh # è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å uri: lb://CLOUD-PAYMENT-SERVICE # åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/** # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± - id: payment_routh2 uri: lb://CLOUD-PAYMENT-SERVICE predicates: - Path=/payment/lb/** eureka: instance: hostname: cloud-gateway-service client: register-with-eureka: true fetch-registry: true service-url: defaultZone: http://eureka7001.com:7001/eureka 3 æ–­è¨€ã€è¿‡æ»¤å™¨3.1 å¸¸ç”¨Predicate å…·ä½“ä½¿ç”¨è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š https://cloud.spring.io/spring-cloud-gateway/reference/html/#gateway-request-predicates-factories å¯¹äºBeforeã€Afterã€Betweenæ–­è¨€ - After=2017-01-20T17:42:47.789-07:00[America/Denver] æ‰€ç”¨çš„æ—¶é—´å­—ç¬¦ä¸²æ˜¯Java8ä¸­ZonedDateTimeç”Ÿæˆçš„æ—¶é—´å­—ç¬¦ä¸² 3.2 Filterå¯é…ç½®çš„è¿‡æ»¤å™¨å‚è§å®˜æ–¹æ–‡æ¡£ï¼š https://cloud.spring.io/spring-cloud-gateway/reference/html/#gatewayfilter-factories è¿™é‡Œä¸»è¦æä¸€ä¸‹è‡ªå®šä¹‰è¿‡æ»¤å™¨çš„å†™æ³•ï¼š @Component @Slf4j public class MyLogGatewayFilter implements GlobalFilter, Ordered { @Override public Mono&lt;Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) { log.info(\"**********come in MyLogGatewayFilter:\" + new Date()); String uname = exchange.getRequest().getQueryParams().getFirst(\"uname\"); if(uname == null){ log.info(\"*********ç”¨æˆ·åä¸ºnullï¼Œéæ³•ç”¨æˆ·\"); exchange.getResponse().setStatusCode(HttpStatus.NOT_ACCEPTABLE); return exchange.getResponse().setComplete(); } return chain.filter(exchange); } @Override public int getOrder() { return 0; } }","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"},{"name":"Gateway","slug":"Gateway","permalink":"https://www.codetool.top/tags/Gateway/"}]},{"title":"leetcode945-ä½¿æ•°ç»„å”¯ä¸€çš„æœ€å°å¢é‡","slug":"leetcode945-ä½¿æ•°ç»„å”¯ä¸€çš„æœ€å°å¢é‡","date":"2020-03-22T00:41:07.000Z","updated":"2020-03-22T00:44:44.878Z","comments":true,"path":"article/leetcode945-ä½¿æ•°ç»„å”¯ä¸€çš„æœ€å°å¢é‡/","link":"","permalink":"https://www.codetool.top/article/leetcode945-%E4%BD%BF%E6%95%B0%E7%BB%84%E5%94%AF%E4%B8%80%E7%9A%84%E6%9C%80%E5%B0%8F%E5%A2%9E%E9%87%8F/","excerpt":"","text":"1 åŸé¢˜ç»™å®šæ•´æ•°æ•°ç»„ Aï¼Œæ¯æ¬¡ move æ“ä½œå°†ä¼šé€‰æ‹©ä»»æ„ A[i]ï¼Œå¹¶å°†å…¶é€’å¢ 1ã€‚ è¿”å›ä½¿ A ä¸­çš„æ¯ä¸ªå€¼éƒ½æ˜¯å”¯ä¸€çš„æœ€å°‘æ“ä½œæ¬¡æ•°ã€‚ ç¤ºä¾‹ 1: è¾“å…¥ï¼š [1,2,2]è¾“å‡ºï¼š 1è§£é‡Šï¼š ç»è¿‡ä¸€æ¬¡ move æ“ä½œï¼Œæ•°ç»„å°†å˜ä¸º [1, 2, 3]ã€‚ ç¤ºä¾‹ 2: è¾“å…¥ï¼š [3,2,1,2,1,7]è¾“å‡ºï¼š 6è§£é‡Šï¼š ç»è¿‡ 6 æ¬¡ move æ“ä½œï¼Œæ•°ç»„å°†å˜ä¸º [3, 4, 1, 2, 5, 7]ã€‚å¯ä»¥çœ‹å‡º 5 æ¬¡æˆ– 5 æ¬¡ä»¥ä¸‹çš„ move æ“ä½œæ˜¯ä¸èƒ½è®©æ•°ç»„çš„æ¯ä¸ªå€¼å”¯ä¸€çš„ã€‚ æç¤ºï¼š 0 &lt;= A.length &lt;= 40000 0 &lt;= A[i] &lt; 40000 2 è§£æ³•2.1 æ€æƒ³å…ˆæ’åºï¼Œç„¶åä¿è¯æ¯ä¸ªæ•°å­—éƒ½å¤§äºå‰é¢çš„æ•°å­—ã€‚ 2.2 ä»£ç class Solution { public int minIncrementForUnique(int[] A) { if(A.length == 0) return 0; Arrays.sort(A); int sum = 0; int last = A[0]; for(int i = 1; i&lt;A.length;i++){ if(A[i]&lt;=last){ sum += last+1-A[i]; last = last+1; }else{ last = A[i]; } } return sum; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"Hystrixå›¾å½¢åŒ–ç›‘æ§-dashboardç®€å•ä½¿ç”¨","slug":"Hystrixå›¾å½¢åŒ–ç›‘æ§-dashboardç®€å•ä½¿ç”¨","date":"2020-03-21T14:24:47.000Z","updated":"2020-03-21T14:30:49.321Z","comments":true,"path":"article/Hystrixå›¾å½¢åŒ–ç›‘æ§-dashboardç®€å•ä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/Hystrix%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%9B%91%E6%8E%A7-dashboard%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 Hystrix Dashboardæ¦‚è¿°é™¤äº†éš”ç¦»ä¾èµ–æœåŠ¡çš„è°ƒç”¨ä»¥å¤–ï¼ŒHystrixè¿˜æä¾›äº†å‡†å®æ—¶çš„è°ƒç”¨ç›‘æ§(Hystrix Dashboard)ï¼ŒHystrixä¼šæŒç»­åœ°è®°å½•æ‰€æœ‰é€šè¿‡Hystrixå‘èµ·çš„è¯·æ±‚çš„æ‰§è¡Œä¿¡æ¯ï¼Œå¹¶ä»¥ç»Ÿè®¡æŠ¥è¡¨å’Œå›¾å½¢çš„å½¢å¼å±•ç¤ºç»™ç”¨æˆ·ï¼ŒåŒ…æ‹¬æ¯ç§’æ‰§è¡Œå¤šå°‘è¯·æ±‚å¤šå°‘æˆåŠŸï¼Œå¤šå°‘å¤±è´¥ç­‰ã€‚Netflixé€šè¿‡hystrix-metrics-event-streamé¡¹ç›®å®ç°äº†å¯¹ä»¥ä¸ŠæŒ‡æ ‡çš„ç›‘æ§ã€‚Spring Cloudä¹Ÿæä¾›äº†Hystrix Dashboardçš„æ•´åˆï¼Œå¯¹ç›‘æ§å†…å®¹è½¬åŒ–æˆå¯è§†åŒ–ç•Œé¢ã€‚ 2 æ­å»ºdashboardæ¨¡å—ä¾èµ–ï¼š &lt;!--hystrix dashboard--> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-netflix-hystrix-dashboard&lt;/artifactId> &lt;/dependency> &lt;!--actuatorç›‘æ§ä¿¡æ¯å®Œå–„--> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-actuator&lt;/artifactId> &lt;/dependency> &lt;!--çƒ­éƒ¨ç½²--> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-devtools&lt;/artifactId> &lt;scope>runtime&lt;/scope> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-test&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;/dependency> yamlé…ç½®ï¼š server: port: 9001 å¯åŠ¨ç±»ï¼š @SpringBootApplication //å¼€å¯HystrixDashboard @EnableHystrixDashboard public class HystrixDashboardMain9001 { public static void main(String[] args) { SpringApplication.run(HystrixDashboardMain9001.class, args); } } åœ¨è¢«ç›‘æ§çš„hystrixæœåŠ¡æä¾›æ–¹åŠ ä¸Šé…ç½®ï¼š /** * æ­¤é…ç½®æ˜¯ä¸ºäº†æœåŠ¡ç›‘æ§è€Œé…ç½®ï¼Œä¸æœåŠ¡å®¹é”™æœ¬èº«æ— è§‚ï¼ŒspringCloud å‡çº§ä¹‹åçš„å‘ * ServletRegistrationBeanå› ä¸ºspringbootçš„é»˜è®¤è·¯å¾„ä¸æ˜¯/hystrix.stream * åªè¦åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­é…ç½®ä¸Šä¸‹é¢çš„servletå³å¯ * @return */ @Bean public ServletRegistrationBean getServlet(){ HystrixMetricsStreamServlet streamServlet = new HystrixMetricsStreamServlet(); ServletRegistrationBean&lt;HystrixMetricsStreamServlet> registrationBean = new ServletRegistrationBean&lt;>(streamServlet); registrationBean.setLoadOnStartup(1); registrationBean.addUrlMappings(\"/hystrix.stream\"); registrationBean.setName(\"HystrixMetricsStreamServlet\"); return registrationBean; } å¯åŠ¨ç›‘æ§æ–¹å’Œè¢«ç›‘æ§æ–¹ï¼Œè®¿é—®è¯¥åœ°å€å³å¯çœ‹åˆ°ç›‘æ§é¡µé¢ï¼š http://localhost:8001/hystrix.stream 3 å¦‚ä½•çœ‹å›¾3.1 ä¸ƒè‰²Success | Short-Circuited | Bad Request | Timeout | Rejected | Failure | Error 3.2 ä¸€åœˆå®å¿ƒåœ†:å…±æœ‰ä¸¤ç§å«ä¹‰ã€‚å®ƒé€šè¿‡é¢œè‰²çš„å˜åŒ–ä»£è¡¨äº†å®ä¾‹çš„å¥åº·ç¨‹åº¦ï¼Œå®ƒçš„å¥åº·åº¦ä»ç»¿è‰²&lt;é»„è‰²&lt;æ©™è‰²&lt;çº¢è‰²é€’å‡ã€‚ è¯¥å®å¿ƒåœ†é™¤äº†é¢œè‰²çš„å˜åŒ–ä¹‹å¤–,å®ƒçš„å¤§å°ä¹Ÿä¼šæ ¹æ®å®ä¾‹çš„è¯·æ±‚æµé‡å‘ç”Ÿå˜åŒ–,æµé‡è¶Šå¤§è¯¥å®å¿ƒåœ†å°±è¶Šå¤§ã€‚æ‰€ä»¥é€šè¿‡è¯¥å®å¿ƒåœ†çš„å±•ç¤ºï¼Œå°±å¯ä»¥åœ¨å¤§é‡çš„å®ä¾‹ä¸­å¿«é€Ÿçš„å‘ç°æ•…éšœå®ä¾‹å’Œé«˜å‹åŠ›å®ä¾‹ã€‚ 3.3 ä¸€çº¿æ›²çº¿:ç”¨æ¥è®°å½•2åˆ†é’Ÿå†…æµé‡çš„ç›¸å¯¹å˜åŒ–ï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥è§‚å¯Ÿåˆ°æµé‡çš„ä¸Šå‡å’Œä¸‹é™è¶‹åŠ¿ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Hystrix","slug":"Hystrix","permalink":"https://www.codetool.top/tags/Hystrix/"},{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"}]},{"title":"HystrixæœåŠ¡ç†”æ–­çš„ç”¨æ³•","slug":"HystrixæœåŠ¡ç†”æ–­çš„ç”¨æ³•","date":"2020-03-21T13:48:26.000Z","updated":"2020-03-21T13:48:39.758Z","comments":true,"path":"article/HystrixæœåŠ¡ç†”æ–­çš„ç”¨æ³•/","link":"","permalink":"https://www.codetool.top/article/Hystrix%E6%9C%8D%E5%8A%A1%E7%86%94%E6%96%AD%E7%9A%84%E7%94%A8%E6%B3%95/","excerpt":"","text":"1 æœåŠ¡ç†”æ–­æ˜¯ä»€ä¹ˆç†”æ–­æœºåˆ¶æ˜¯åº”å¯¹é›ªå´©æ•ˆåº”çš„ä¸€ç§å¾®æœåŠ¡é“¾è·¯ä¿æŠ¤æœºåˆ¶ã€‚å½“æ‰‡å‡ºé“¾è·¯çš„æŸä¸ªå¾®æœåŠ¡å‡ºé”™ä¸å¯ç”¨æˆ–è€…å“åº”æ—¶é—´å¤ªé•¿æ—¶,ä¼šè¿›è¡ŒæœåŠ¡çš„é™çº§,è¿›è€Œç†”æ–­è¯¥èŠ‚ç‚¹å¾®æœåŠ¡çš„è°ƒç”¨,å¿«é€Ÿè¿”å›é”™è¯¯çš„å“åº”ä¿¡æ¯ã€‚å½“æ£€æµ‹åˆ°è¯¥èŠ‚ç‚¹å¾®æœåŠ¡è°ƒç”¨å“åº”æ­£å¸¸åï¼Œæ¢å¤è°ƒç”¨é“¾è·¯ã€‚ åœ¨Spring Cloudæ¡†æ¶é‡Œ,ç†”æ–­æœºåˆ¶é€šè¿‡Hystrixå®ç°ã€‚Hystrixä¼šç›‘æ§å¾®æœåŠ¡é—´è°ƒç”¨çš„çŠ¶å†µï¼Œå½“å¤±è´¥çš„è°ƒç”¨åˆ°ä¸€å®šé˜ˆå€¼ï¼Œç¼ºçœæ˜¯5ç§’å†…20æ¬¡è°ƒç”¨å¤±è´¥ï¼Œå¹¶ä¸”è¶…è¿‡è¯·æ±‚æ€»æ•°çš„50%,å°±ä¼šå¯åŠ¨ç†”æ–­æœºåˆ¶ã€‚ç†”æ–­æœºåˆ¶çš„æ³¨è§£æ˜¯@HystrixCommand Closedï¼šç†”æ–­å™¨å…³é—­çŠ¶æ€ï¼ˆæ‰€æœ‰è¯·æ±‚è¿”å›æˆåŠŸï¼‰ Openï¼šç†”æ–­å™¨æ‰“å¼€çŠ¶æ€ï¼ˆè°ƒç”¨æ¬¡æ•°ç´¯è®¡åˆ°è¾¾é˜ˆå€¼æˆ–è€…æ¯”ä¾‹ï¼Œç†”æ–­å™¨æ‰“å¼€ï¼ŒæœåŠ¡ç›´æ¥è¿”å›é”™è¯¯ï¼‰ Half Openï¼šç†”æ–­å™¨åŠå¼€çŠ¶æ€ï¼ˆé»˜è®¤æ—¶é—´è¿‡åï¼Œè¿›å…¥åŠç†”æ–­çŠ¶æ€ï¼Œå…è®¸å®šé‡æœåŠ¡è¯·æ±‚ï¼Œå¦‚æœè°ƒç”¨éƒ½æˆåŠŸï¼Œåˆ™è®¤ä¸ºæ¢å¤äº†ï¼Œåˆ™å…³é—­æ–­è·¯å™¨ï¼Œåä¹‹æ‰“å¼€æ–­è·¯å™¨ï¼‰ 2 ä½¿ç”¨//è¿™é‡Œå³10ç§’å†…10æ¬¡è¯·æ±‚ä¸­å¤±è´¥6æ¬¡åˆ™ç†”æ–­ @HystrixCommand( //æŒ‡å®šé™çº§æ–¹æ³• fallbackMethod = \"paymentCircuitBreaker_fallback\", commandProperties = { @HystrixProperty(name = \"circuitBreaker.enabled\", value = \"true\"),// æ˜¯å¦å¼€å¯æ–­è·¯å™¨ @HystrixProperty(name = \"circuitBreaker.requestVolumeThreshold\", value = \"10\"),// è¯·æ±‚æ¬¡æ•° @HystrixProperty(name = \"circuitBreaker.sleepWindowInMilliseconds\", value = \"10000\"),// æ—¶é—´çª—å£æœŸ/æ—¶é—´èŒƒå›´ @HystrixProperty(name = \"circuitBreaker.errorThresholdPercentage\", value = \"60\")// å¤±è´¥ç‡è¾¾åˆ°å¤šå°‘åç†”æ–­ } ) public String paymentCircuitBreaker(@PathVariable(\"id\") Integer id) { if (id &lt; 0) { throw new RuntimeException(\"*****idä¸èƒ½æ˜¯è´Ÿæ•°\"); } String serialNumber = IdUtil.simpleUUID(); return Thread.currentThread().getName() + \"\\t\" + \"è°ƒç”¨æˆåŠŸ,æµæ°´å·:\" + serialNumber; } //é™çº§æ–¹æ³• public String paymentCircuitBreaker_fallback(@PathVariable(\"id\") Integer id) { return \"id ä¸èƒ½è´Ÿæ•°,è¯·ç¨åé‡è¯•,o(â•¥ï¹â•¥)o id:\" + id; } å…³äºæœåŠ¡ç†”æ–­ï¼Œé™¤äº†è¦å°†circuitBreaker.enabledè®¾ä¸ºtrueï¼Œè¿˜æœ‰ä¸‰ä¸ªé‡è¦çš„å‚æ•°ï¼š å‚æ•° å«ä¹‰ é»˜è®¤å€¼ sleepWindowInMilliseconds å¿«ç…§æ—¶é—´çª—:æ–­è·¯å™¨ç¡®å®šæ˜¯å¦æ‰“å¼€éœ€è¦ç»Ÿè®¡ä¸€äº›è¯·æ±‚å’Œé”™è¯¯æ•°æ®,è€Œç»Ÿè®¡çš„æ—¶é—´èŒƒå›´å°±æ˜¯å¿«ç…§æ—¶é—´çª— 5000 requestVolumeThreshold è¯·æ±‚æ€»æ•°é˜€å€¼:åœ¨å¿«ç…§æ—¶é—´çª—å†…ï¼Œå¿…é¡»æ»¡è¶³è¯·æ±‚æ€»æ•°é˜€å€¼æ‰æœ‰èµ„æ ¼ç†”æ–­ã€‚ 20 errorThresholdPercentage é”™è¯¯ç™¾åˆ†æ¯”é˜€å€¼:å½“è¯·æ±‚æ€»æ•°åœ¨å¿«ç…§æ—¶é—´çª—å†…è¶…è¿‡äº†é˜€å€¼,æ¯”å¦‚å¯¹äº50%ï¼Œå‘ç”Ÿäº†30æ¬¡è°ƒç”¨ï¼Œå¦‚æœåœ¨è¿™30æ¬¡è°ƒç”¨ä¸­,æœ‰15æ¬¡å‘ç”Ÿäº†è¶…æ—¶å¼‚å¸¸,å°±ä¼šå°†æ–­è·¯å™¨æ‰“å¼€ã€‚ 50 ç„¶åä¿®æ”¹controllerè°ƒç”¨å®ƒï¼š @GetMapping(\"/payment/circuit/{id}\") public String paymentInfo_Timeout(@PathVariable(\"id\") Integer id){ String result = paymentService.paymentCircuitBreaker(id); log.info(\"****result:\"+result); return result; } æ­¤æ—¶å¯åŠ¨æœåŠ¡ï¼Œè‹¥è®¿é—® http://localhost:8001/payment/circuit/-30 ï¼ˆåªè¦ä¼ å…¥idä¸ºè´Ÿæ•°ï¼‰åœ¨10ç§’é’Ÿä¹‹å†…è¶…è¿‡10æ¬¡ï¼ˆæ­¤æ—¶çš„å¤±è´¥ç‡æ˜¯100%ï¼‰ï¼Œå°±ä¼šè§¦å‘ç†”æ–­ï¼Œåœ¨ç†”æ–­æœŸé—´å†…ï¼Œå³ä½¿å‘å‡ºæ­£å¸¸çš„è¯·æ±‚å¦‚ http://localhost:8001/payment/circuit/10 ä¹Ÿä¸ä¼šå¾—åˆ°å›å¤","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Hystrix","slug":"Hystrix","permalink":"https://www.codetool.top/tags/Hystrix/"},{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"}]},{"title":"Hystrixæ¦‚è¿°ä¸æœåŠ¡é™çº§","slug":"Hystrixæ¦‚è¿°ä¸æœåŠ¡é™çº§","date":"2020-03-21T12:16:59.000Z","updated":"2020-03-21T14:32:16.811Z","comments":true,"path":"article/Hystrixæ¦‚è¿°ä¸æœåŠ¡é™çº§/","link":"","permalink":"https://www.codetool.top/article/Hystrix%E6%A6%82%E8%BF%B0%E4%B8%8E%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7/","excerpt":"","text":"1 Hystrixæ¦‚è¿°1.1 æœåŠ¡é›ªå´©å¤šä¸ªå¾®æœåŠ¡ä¹‹é—´è°ƒç”¨çš„æ—¶å€™ï¼Œå‡è®¾å¾®æœåŠ¡Aè°ƒç”¨å¾®æœåŠ¡Bå’Œå¾®æœåŠ¡C,å¾®æœåŠ¡Bå’Œå¾®æœåŠ¡Cåˆè°ƒç”¨å…¶å®ƒçš„å¾®æœåŠ¡ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€æ‰‡å‡ºâ€ã€‚ å¦‚æœæ‰‡å‡ºçš„é“¾è·¯ä¸ŠæŸä¸ªå¾®æœåŠ¡çš„è°ƒç”¨å“åº”æ—¶é—´è¿‡é•¿æˆ–è€…ä¸å¯ç”¨ï¼Œå¯¹å¾®æœåŠ¡Açš„è°ƒç”¨å°±ä¼šå ç”¨è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿèµ„æºï¼Œè¿›è€Œå¼•èµ·ç³»ç»Ÿå´©æºƒ,æ‰€è°“çš„â€œé›ªå´©æ•ˆåº”â€ï¼Œå¯¹äºé«˜æµé‡çš„åº”ç”¨æ¥è¯´ï¼Œå•ä¸€çš„åç«¯ä¾èµ–å¯èƒ½ä¼šå¯¼è‡´æ‰€æœ‰æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰èµ„æºéƒ½åœ¨å‡ ç§’é’Ÿå†…é¥±å’Œã€‚æ¯”å¤±è´¥æ›´ç³Ÿç³•çš„æ˜¯,è¿™äº›åº”ç”¨ç¨‹åºè¿˜å¯èƒ½å¯¼è‡´æœåŠ¡ä¹‹é—´çš„å»¶è¿Ÿå¢åŠ ï¼Œå¤‡ä»½é˜Ÿåˆ—ï¼Œçº¿ç¨‹å’Œå…¶ä»–ç³»ç»Ÿèµ„æºç´§å¼ ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå‘ç”Ÿæ›´å¤šçš„çº§è”æ•…éšœã€‚è¿™äº›éƒ½è¡¨ç¤ºéœ€è¦å¯¹æ•…éšœå’Œå»¶è¿Ÿè¿›è¡Œéš”ç¦»å’Œç®¡ç†ï¼Œä»¥ä¾¿å•ä¸ªä¾èµ–å…³ç³»çš„å¤±è´¥ï¼Œä¸èƒ½å–æ¶ˆæ•´ä¸ªåº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿã€‚ 1.2 Hystixçš„ä½œç”¨Hystrixæ˜¯ä¸€ä¸ªç”¨äºå¤„ç†åˆ†å¸ƒå¼ç³»ç»Ÿçš„å»¶è¿Ÿå’Œå®¹é”™çš„å¼€æºåº“ï¼Œ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œ,è®¸å¤šä¾èµ–ä¸å¯é¿å…çš„ä¼šè°ƒç”¨å¤±è´¥ï¼Œæ¯”å¦‚è¶…æ—¶ã€å¼‚å¸¸ç­‰, Hystrixèƒ½å¤Ÿä¿è¯åœ¨ä¸€ä¸ªä¾èµ–å‡ºé—®é¢˜çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šå¯¼è‡´æ•´ä½“æœåŠ¡å¤±è´¥,é¿å…çº§è”æ•…éšœ,ä»¥æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼¹æ€§ã€‚ æœåŠ¡é™çº§(fallback)ï¼š æœåŠ¡é™çº§æ˜¯ä»æ•´ä¸ªç³»ç»Ÿçš„è´Ÿè·æƒ…å†µå‡ºå‘å’Œè€ƒè™‘çš„ï¼Œå¯¹æŸäº›è´Ÿè·ä¼šæ¯”è¾ƒé«˜çš„æƒ…å†µï¼Œä¸ºäº†é¢„é˜²æŸäº›åŠŸèƒ½ï¼ˆä¸šåŠ¡åœºæ™¯ï¼‰å‡ºç°è´Ÿè·è¿‡è½½æˆ–è€…å“åº”æ…¢çš„æƒ…å†µï¼Œåœ¨å…¶å†…éƒ¨æš‚æ—¶èˆå¼ƒå¯¹ä¸€äº›éæ ¸å¿ƒçš„æ¥å£å’Œæ•°æ®çš„è¯·æ±‚ï¼Œè€Œç›´æ¥è¿”å›ä¸€ä¸ªæå‰å‡†å¤‡å¥½çš„fallbackï¼ˆé€€è·¯ï¼‰é”™è¯¯å¤„ç†ä¿¡æ¯ã€‚è¿™æ ·ï¼Œè™½ç„¶æä¾›çš„æ˜¯ä¸€ä¸ªæœ‰æŸçš„æœåŠ¡ï¼Œä½†å´ä¿è¯äº†æ•´ä¸ªç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚ æœåŠ¡ç†”æ–­ï¼šå½“ä¸‹æ¸¸çš„æœåŠ¡å› ä¸ºæŸç§åŸå› çªç„¶å˜å¾—ä¸å¯ç”¨æˆ–å“åº”è¿‡æ…¢ï¼Œä¸Šæ¸¸æœåŠ¡ä¸ºäº†ä¿è¯è‡ªå·±æ•´ä½“æœåŠ¡çš„å¯ç”¨æ€§ï¼Œé€šå¸¸å…ˆæœåŠ¡é™çº§ï¼Œå¹¶ä¸å†ç»§ç»­è°ƒç”¨ç›®æ ‡æœåŠ¡ï¼Œç›´æ¥è¿”å›ï¼Œå¿«é€Ÿé‡Šæ”¾èµ„æºã€‚å¦‚æœç›®æ ‡æœåŠ¡æƒ…å†µå¥½è½¬åˆ™æ¢å¤è°ƒç”¨ã€‚ æœåŠ¡é™æµï¼šé™æµçš„ç›®çš„æ˜¯é€šè¿‡å¯¹å¹¶å‘è®¿é—®/è¯·æ±‚è¿›è¡Œé™é€Ÿæˆ–è€…ä¸€ä¸ªæ—¶é—´çª—å£å†…çš„çš„è¯·æ±‚è¿›è¡Œé™é€Ÿæ¥ä¿æŠ¤ç³»ç»Ÿï¼Œä¸€æ—¦è¾¾åˆ°é™åˆ¶é€Ÿç‡åˆ™å¯ä»¥æ‹’ç»æœåŠ¡ã€æ’é˜Ÿæˆ–ç­‰å¾…ã€é™çº§ã€‚ å“ªäº›æƒ…å†µä¼šå‘ç”ŸæœåŠ¡é™çº§ï¼š ç¨‹åºè¿è¡Œå¼‚å¸¸ è¶…æ—¶ æœåŠ¡ç†”æ–­è§¦å‘æœåŠ¡é™çº§ çº¿ç¨‹æ± /ä¿¡å·é‡ä¹Ÿä¼šå¯¼è‡´æœåŠ¡é™çº§ 2 HystrixæœåŠ¡é™çº§2.1 æ¨¡æ‹Ÿä¸€ä¸ªé«˜å¹¶å‘è®¿é—®ç¼“æ…¢çš„æœåŠ¡ç»§ç»­æ–°å»ºæ¨¡å—cloud-provider-hystrix-payment8001ï¼Œåœ¨æ¨¡å—cloud-provider-payment8001çš„åŸºç¡€ä¸Šæ·»åŠ ä¾èµ–ï¼š &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-netflix-hystrix&lt;/artifactId> &lt;/dependency> yaml: server: port: 8001 spring: application: name: cloud-hystrix-payment-service eureka: client: service-url: defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka #é›†ç¾¤ç‰ˆ # å°†è‡ªå·±æ³¨å†Œè¿›eureka server register-with-eureka: true # æ˜¯å¦ä»eureka serveræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡ fetch-registry: true instance: instance-id: payment-hystrix-8001 å¯åŠ¨ç±»ï¼š @SpringBootApplication @EnableEurekaClient public class PaymentHystrixMain8001 { public static void main(String[] args) { SpringApplication.run(PaymentHystrixMain8001.class, args); } } service: @Service public class PaymentService { public String paymentInfo_OK(Integer id){ return \"çº¿ç¨‹æ± ï¼š\"+Thread.currentThread().getName()+\"\\t paymentInfo_OK,id:\"+id+\"\\t ok\"; } public String paymentInfo_Timeout(Integer id){ int timeNumber = 5; try { TimeUnit.SECONDS.sleep(timeNumber); }catch (Exception e){ e.printStackTrace(); } return \"çº¿ç¨‹æ± ï¼š\"+Thread.currentThread().getName()+\"\\t paymentInfo_Timeout,id:\"+id+\"\\t okï¼Œè€—æ—¶\"+timeNumber+\"ç§’é’Ÿ\"; } } controller: @Slf4j @RestController public class PaymentController { @Resource private PaymentService paymentService; @Value(\"${server.port}\") private String serverPort; @GetMapping(\"/payment/hystrix/ok/{id}\") public String paymentInfo_OK(@PathVariable(\"id\") Integer id){ String result = paymentService.paymentInfo_OK(id); log.info(\"****result:\"+result); return result; } @GetMapping(\"/payment/hystrix/timeout/{id}\") public String paymentInfo_Timeout(@PathVariable(\"id\") Integer id){ String result = paymentService.paymentInfo_Timeout(id); log.info(\"****result:\"+result); return result; } } æˆ‘ä»¬ä½¿ç”¨Jmeteré€šè¿‡200ä¸ªçº¿ç¨‹å¾ªç¯è®¿é—® http://localhost:8001/payment/hystrix/ok/30 ï¼Œå¹¶ä¸­é€”æ‰‹åŠ¨è®¿é—® http://localhost:8001/payment/hystrix/ok/2 ï¼Œä¼šå‘ç°è€—æ—¶çŸ­çš„æœåŠ¡çš„å“åº”æ—¶é—´ä¹Ÿè¢«æ‹–æ…¢äº†ï¼Œä¸»è¦åŸå› æ˜¯å¤§é‡çš„è¯·æ±‚è€—å°½äº†tomcatçš„çº¿ç¨‹æ± èµ„æºã€‚ 2.2 æä¾›æ–¹é…ç½®æœåŠ¡é™çº§hystrixå¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè¶…æ—¶æ—¶é—´å†…æ­£å¸¸æœåŠ¡ï¼Œè¶…è¿‡è¶…æ—¶æ—¶é—´åšæœåŠ¡é™çº§fallbackã€‚ ä¸»é…ç½®ç±»æ·»åŠ æ³¨è§£@EnableCircuitBreakerä½¿æ”¯æŒhystrixæ³¨è§£ï¼š @SpringBootApplication @EnableEurekaClient @EnableCircuitBreaker public class PaymentHystrixMain8001 { public static void main(String[] args) { SpringApplication.run(PaymentHystrixMain8001.class, args); } } ä¿®æ”¹serviceï¼Œåœ¨éœ€è¦åšæœåŠ¡é™çº§çš„æ–¹æ³•ä¸Šæ·»åŠ @HystrixCommandå¹¶é…ç½®ç›¸å…³å±æ€§ï¼Œå†æ·»åŠ ä¸€ä¸ªç”¨äºè¶…æ—¶å¤„ç†çš„æ–¹æ³•ï¼š @Service public class PaymentService { public String paymentInfo_OK(Integer id){ return \"çº¿ç¨‹æ± ï¼š\"+Thread.currentThread().getName()+\"\\t paymentInfo_OK,id:\"+id+\"\\t ok\"; } //fallbackMethodæŒ‡å®šè¶…æ—¶å¤„ç†çš„æ–¹æ³•ï¼Œåœ¨commandPropertiesä¸­é…ç½®è¶…æ—¶æ—¶é—´ @HystrixCommand(fallbackMethod = \"paymentInfo_TimeOutHandler\",commandProperties = { @HystrixProperty(name=\"execution.isolation.thread.timeoutInMilliseconds\",value = \"3000\") }) public String paymentInfo_Timeout(Integer id){ int timeNumber = 5; try { TimeUnit.SECONDS.sleep(timeNumber); }catch (Exception e){ e.printStackTrace(); } return \"çº¿ç¨‹æ± ï¼š\"+Thread.currentThread().getName()+\"\\t paymentInfo_Timeout,id:\"+id+\"\\t okï¼Œè€—æ—¶\"+timeNumber+\"ç§’é’Ÿ\"; } public String paymentInfo_TimeOutHandler(Integer id){ return \"çº¿ç¨‹æ± ï¼š\"+Thread.currentThread().getName()+\"\\t paymentInfo_TimeOutHandler,id:\"+id+\"\\t redirect\"; } } 2.3 æ¶ˆè´¹æ–¹é…ç½®æœåŠ¡é™çº§æœåŠ¡æä¾›æ–¹å¯ä»¥é…ç½®æœåŠ¡é™çº§ï¼Œæ¶ˆè´¹æ–¹ä¹Ÿå¯ä»¥ï¼Œå¹¶ä¸”é€šå¸¸Hystrixæ˜¯é…ç½®åœ¨æ¶ˆè´¹è€…æ–¹çš„ï¼Œè¿™é‡Œæ–°å»ºä¸€ä¸ªæ¶ˆè´¹ç«¯æ¨¡å—cloud-consumer-feign-hystrix-order80ï¼Œä¾èµ–ï¼š &lt;dependencies> &lt;!--hystrix--> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-netflix-hystrix&lt;/artifactId> &lt;/dependency> &lt;!--openfeign--> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-openfeign&lt;/artifactId> &lt;/dependency> &lt;!--eureka client--> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-netflix-eureka-client&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>com.atguigu.springcloud&lt;/groupId> &lt;artifactId>cloud-api-common&lt;/artifactId> &lt;version>${project.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-web&lt;/artifactId> &lt;/dependency> &lt;!--ç›‘æ§--> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-actuator&lt;/artifactId> &lt;/dependency> &lt;!--çƒ­éƒ¨ç½²--> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-devtools&lt;/artifactId> &lt;scope>runtime&lt;/scope> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-test&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;/dependency> &lt;/dependencies> å¯åŠ¨ç±»ï¼š @SpringBootApplication @EnableFeignClients @EnableHystrix public class OrderHystrixMain80 { public static void main(String[] args) { SpringApplication.run(OrderHystrixMain80.class,args); } } feign serviceæ¥å£: @Component @FeignClient(\"CLOUD-HYSTRIX-PAYMENT-SERVICE\") public interface PaymentHystrixService { @GetMapping(\"/payment/hystrix/ok/{id}\") public String paymentInfo_OK(@PathVariable(\"id\") Integer id); @GetMapping(\"/payment/hystrix/timeout/{id}\") public String paymentInfo_Timeout(@PathVariable(\"id\") Integer id); } controllerï¼š @RestController @Slf4j public class OrderHystrixController { @Resource private PaymentHystrixService paymentHystrixService; @GetMapping(\"/consumer/payment/hystrix/ok/{id}\") public String paymentInfo_OK(@PathVariable(\"id\") Integer id){ return paymentHystrixService.paymentInfo_OK(id); }; //è¶…æ—¶1.5såˆ™fallbackè‡³paymentTimeOutFallbackMethodæ–¹æ³• @GetMapping(\"/consumer/payment/hystrix/timeout/{id}\") @HystrixCommand(fallbackMethod = \"paymentTimeOutFallbackMethod\",commandProperties = { @HystrixProperty(name = \"execution.isolation.thread.timeoutInMilliseconds\",value = \"1500\") }) public String paymentInfo_Timeout(@PathVariable(\"id\") Integer id){ return paymentHystrixService.paymentInfo_Timeout(id); }; public String paymentTimeOutFallbackMethod(@PathVariable(\"id\") Integer id){ return \"æˆ‘æ˜¯æ¶ˆè´¹è€…80ï¼Œå¯¹æ–¹æ”¯ä»˜ç³»ç»Ÿç¹å¿™è¯·10ç§’é’Ÿåå†è¯•æˆ–è€…è‡ªå·±è¿è¡Œå‡ºé”™è¯·æ£€æŸ¥è‡ªå·±/(ã„’oã„’)/~~\"; } } 2.4 é»˜è®¤é™çº§æ–¹æ³•å¯ä»¥å°†ä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•é…ç½®ä¸€ä¸ªé»˜è®¤çš„é™çº§æ–¹æ³•ï¼Œé¿å…å¯¹æ¯ä¸ªæ–¹æ³•éƒ½é…ç½®ä¸€ä¸ªé™çº§æ–¹æ³•ï¼Œé€ æˆä»£ç è‡ƒè‚¿ï¼š @RestController @Slf4j //æŒ‡å®šé»˜è®¤é™çº§æ–¹æ³• @DefaultProperties(defaultFallback = \"paymentGlobalFallbackMethod\") public class OrderHystrixController { @Resource private PaymentHystrixService paymentHystrixService; @GetMapping(\"/consumer/payment/hystrix/ok/{id}\") public String paymentInfo_OK(@PathVariable(\"id\") Integer id){ return paymentHystrixService.paymentInfo_OK(id); }; @GetMapping(\"/consumer/payment/hystrix/timeout/{id}\") @HystrixCommand(fallbackMethod = \"paymentTimeOutFallbackMethod\",commandProperties = { @HystrixProperty(name = \"execution.isolation.thread.timeoutInMilliseconds\",value = \"1500\") }) public String paymentInfo_Timeout(@PathVariable(\"id\") Integer id){ return paymentHystrixService.paymentInfo_Timeout(id); }; public String paymentTimeOutFallbackMethod(@PathVariable(\"id\") Integer id){ return \"æˆ‘æ˜¯æ¶ˆè´¹è€…80ï¼Œå¯¹æ–¹æ”¯ä»˜ç³»ç»Ÿç¹å¿™è¯·10ç§’é’Ÿåå†è¯•æˆ–è€…è‡ªå·±è¿è¡Œå‡ºé”™è¯·æ£€æŸ¥è‡ªå·±/(ã„’oã„’)/~~\"; } //ä¸‹é¢æ˜¯å…¨å±€fallback public String paymentGlobalFallbackMethod(){ return \"Globalå¼‚å¸¸ä¿¡æ¯ï¼Œè¯·ç¨åå†è¯•â”­â”®ï¹â”­â”®\"; } } 2.5 é™çº§æ–¹æ³•è§£è€¦é™çº§æ–¹æ³•å±äºå¼‚å¸¸å¤„ç†æ–¹æ³•ï¼Œä¸åº”è¯¥æ”¾å…¥æ­£å¸¸ä¸šåŠ¡ç±»ä¸­ï¼Œå¯ä»¥ä¸ºFeign Clientä½¿ç”¨çš„æ¥å£æ³¨å†Œä¸€ä¸ªå¯¹åº”çš„æœåŠ¡é™çº§å¤„ç†ç±» åœ¨@FeignClientä¸­æŒ‡å®šfallbackä¸ºä¸€ä¸ªé™çº§å¤„ç†ç±» @Component @FeignClient(value = \"CLOUD-HYSTRIX-PAYMENT-SERVICE\",fallback = PaymentFallbackService.class) public interface PaymentHystrixService { @GetMapping(\"/payment/hystrix/ok/{id}\") public String paymentInfo_OK(@PathVariable(\"id\") Integer id); @GetMapping(\"/payment/hystrix/timeout/{id}\") public String paymentInfo_Timeout(@PathVariable(\"id\") Integer id); } ç¼–å†™è¿™ä¸ªç±»ï¼Œå®ƒä¸€å®šè¦å®ç°PaymentHystrixServiceæ¥å£ @Component public class PaymentFallbackService implements PaymentHystrixService { @Override public String paymentInfo_OK(Integer id) { return \"-----PaymentFallbackService fall back paymentInfo_OK\"; } @Override public String paymentInfo_Timeout(Integer id) { return \"-----PaymentFallbackService fall back paymentInfo_Timeout\"; } } 2.6 è‡ªå®šä¹‰é…ç½®å‚è€ƒï¼š Hystrix è¶…æ—¶é…ç½®çš„Nç§ç©æ³• - çŒ¿å¤©åœ° - åšå®¢å›­ Hystrix é…ç½®å‚æ•°å…¨è§£æ_æ…•è¯¾æ‰‹è®°","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Hystrix","slug":"Hystrix","permalink":"https://www.codetool.top/tags/Hystrix/"},{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"}]},{"title":"æ›´ä¼˜é›…çš„æœåŠ¡è°ƒç”¨-OpenFeignç®€å•ä½¿ç”¨","slug":"æ›´ä¼˜é›…çš„æœåŠ¡è°ƒç”¨-openFeignç®€å•ä½¿ç”¨","date":"2020-03-21T07:50:59.000Z","updated":"2020-03-21T07:51:59.299Z","comments":true,"path":"article/æ›´ä¼˜é›…çš„æœåŠ¡è°ƒç”¨-openFeignç®€å•ä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/%E6%9B%B4%E4%BC%98%E9%9B%85%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8-openFeign%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 OpenFeignæ¦‚è¿°Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼WebServiceå®¢æˆ·ç«¯ã€‚ ä½¿ç”¨Feignèƒ½è®©ç¼–å†™Web Serviceå®¢æˆ·ç«¯æ›´åŠ ç®€å•ã€‚å®ƒçš„ä½¿ç”¨æ–¹æ³•æ˜¯å®šä¹‰ä¸€ä¸ªæœåŠ¡æ¥å£ç„¶ååœ¨ä¸Šé¢æ·»åŠ æ³¨è§£ã€‚Feignä¹Ÿæ”¯æŒå¯æ‹”æ’å¼çš„ç¼–ç å™¨å’Œè§£ç å™¨ã€‚ Spring Cloudå¯¹Feignè¿›è¡Œäº†å°è£…ï¼Œä½¿å…¶æ”¯æŒäº†Spring MVCæ ‡å‡†æ³¨è§£å’ŒHttpMessageConvertersã€‚ Feignå¯ä»¥ä¸Eurekaå’ŒRibbonç»„åˆä½¿ç”¨ä»¥æ”¯æŒè´Ÿè½½å‡è¡¡ã€‚ 1.1 Feignèƒ½å¹²ä»€ä¹ˆFeignæ—¨åœ¨ä½¿ç¼–å†™Java Httpå®¢æˆ·ç«¯å˜å¾—æ›´å®¹æ˜“ã€‚ å‰é¢åœ¨ä½¿ç”¨Ribbon+RestTemplateæ—¶ï¼Œåˆ©ç”¨RestTemplateå¯¹httpè¯·æ±‚çš„å°è£…å¤„ç†ï¼Œå½¢æˆäº†ä¸€å¥—æ¨¡ç‰ˆåŒ–çš„è°ƒç”¨æ–¹æ³•ã€‚ä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­ï¼Œç”±äºå¯¹æœåŠ¡ä¾èµ–çš„è°ƒç”¨å¯èƒ½ä¸æ­¢ä¸€å¤„ï¼Œå¾€å¾€ä¸€ä¸ªæ¥å£ä¼šè¢«å¤šå¤„è°ƒç”¨ï¼Œ æ‰€ä»¥é€šå¸¸éƒ½ä¼šé’ˆå¯¹æ¯ä¸ªå¾®æœåŠ¡è‡ªè¡Œå°è£…ä¸€äº›å®¢æˆ·ç«¯ç±»æ¥åŒ…è£…è¿™äº›ä¾èµ–æœåŠ¡çš„è°ƒç”¨ã€‚æ‰€ä»¥ï¼ŒFeignåœ¨æ­¤åŸºç¡€ä¸Šåšäº†è¿›ä¸€æ­¥å°è£…ï¼Œ ç”±å®ƒæ¥å¸®åŠ©æˆ‘ä»¬å®šä¹‰å’Œå®ç°ä¾èµ–æœåŠ¡æ¥å£çš„å®šä¹‰ã€‚åœ¨Feignçš„å®ç°ä¸‹ï¼Œæˆ‘ä»¬åªéœ€åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶ä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ¥é…ç½®å®ƒ(ä»¥å‰æ˜¯Daoæ¥å£ä¸Šé¢æ ‡æ³¨Mapperæ³¨è§£,ç°åœ¨æ˜¯ä¸€ä¸ªå¾®æœåŠ¡æ¥å£ä¸Šé¢æ ‡æ³¨ä¸€ä¸ªFeignæ³¨è§£å³å¯ï¼Œå³å¯å®Œæˆå¯¹æœåŠ¡æä¾›æ–¹çš„æ¥å£ç»‘å®š,ç®€åŒ–äº†ä½¿ç”¨Spring cloud Ribbonæ—¶ï¼Œè‡ªåŠ¨å°è£…æœåŠ¡è°ƒç”¨å®¢æˆ·ç«¯çš„å¼€å‘é‡ã€‚ Feigné›†æˆäº†Ribbonï¼Œåˆ©ç”¨Ribbonç»´æŠ¤äº†Paymentçš„æœåŠ¡åˆ—è¡¨ä¿¡æ¯,å¹¶ä¸”é€šè¿‡è½®è¯¢å®ç°äº†å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡ã€‚è€Œä¸Ribbonä¸åŒçš„æ˜¯ï¼Œ é€šè¿‡feignåªéœ€è¦å®šä¹‰æœåŠ¡ç»‘å®šæ¥å£ä¸”ä»¥å£°æ˜å¼çš„æ–¹æ³•ï¼Œä¼˜é›…è€Œç®€å•çš„å®ç°äº†æœåŠ¡è°ƒç”¨ 1.2 Feignå’ŒOpenFeignçš„åŒºåˆ«Feign Feignæ˜¯Spring Cloudç»„ä»¶ä¸­çš„ä¸€ä¸ªè½»é‡çº§RESTfulçš„HTTPæœåŠ¡å®¢æˆ·ç«¯ã€‚Feignå†…ç½®äº†Ribbonï¼Œç”¨æ¥åšå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œå»è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ã€‚Feignçš„ä½¿ç”¨æ–¹å¼æ˜¯ï¼šä½¿ç”¨Feignçš„æ³¨è§£å®šä¹‰æ¥å£ï¼Œè°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå°±å¯ä»¥è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ OpenFeign OpenFeignæ˜¯Spring Cloudåœ¨Feignçš„åŸºç¡€ä¸Šæ”¯æŒäº†SpringMVCçš„æ³¨è§£ï¼Œå¦‚@RequesMappingç­‰ç­‰ã€‚OpenFeignçš„@FeignClientå¯ä»¥è§£æSpringMVCçš„@RequestMappingæ³¨è§£ä¸‹çš„æ¥å£ï¼Œå¹¶é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼äº§ç”Ÿå®ç°ç±»,å®ç°ç±»ä¸­åšè´Ÿè½½å‡è¡¡å¹¶è°ƒç”¨å…¶ä»–æœåŠ¡ã€‚ 2 OpenFeignçš„ä½¿ç”¨æ–°å»ºè°ƒç”¨æ–¹æ¨¡å—cloud-consumer-feign-order80ï¼Œä¾èµ–ï¼š &lt;!--openfeign--> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-openfeign&lt;/artifactId> &lt;/dependency> &lt;!--eureka client--> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-netflix-eureka-server&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>com.rhett&lt;/groupId> &lt;artifactId>cloud-api-commons&lt;/artifactId> &lt;version>${project.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-web&lt;/artifactId> &lt;/dependency> &lt;!--ç›‘æ§--> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-actuator&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-devtools&lt;/artifactId> &lt;scope>runtime&lt;/scope> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-test&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;/dependency> yamlé…ç½®ï¼šï¼ˆä¸éœ€è¦é¢å¤–é…ç½®openfeignï¼‰ server: port: 80 eureka: client: register-with-eureka: true fetch-registry: true service-url: defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka #é›†ç¾¤ç‰ˆ å¯åŠ¨ç±»ï¼šæ·»åŠ @EnableFeignClientsæ³¨è§£ @SpringBootApplication @EnableFeignClients public class OrderFeignMain80 { public static void main(String[] args) { SpringApplication.run(OrderFeignMain80.class, args); } } ç¼–å†™ä¸€ä¸ªæœåŠ¡æ¥å£ï¼Œå®ƒä»£è¡¨è°ƒç”¨ä¸€ä¸ªè¿œç¨‹å¾®æœåŠ¡çš„è·å–ç»“æœï¼Œ@FeignClient(&quot;CLOUD-PAYMENT-SERVICE&quot;)ä¸ºæœåŠ¡å @Component @FeignClient(\"CLOUD-PAYMENT-SERVICE\") public interface PaymentFeignService { @GetMapping(value = \"/payment/{id}\") public CommonResult&lt;Payment> getPaymentById(@PathVariable(\"id\") Long id); } ç¼–å†™controllerï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æ³¨å…¥çš„PaymentFeignServiceè°ƒç”¨æ¥å£æ–¹æ³•ã€‚ @Slf4j @RestController public class OrderFeignController { @Resource private PaymentFeignService paymentFeignService; @GetMapping(value=\"/consumer/payment/{id}\",produces = \"application/json\") public CommonResult&lt;Payment> getPaymentById(@PathVariable(\"id\") Long id){ return paymentFeignService.getPaymentById(id); } } 3 è¶…æ—¶æ§åˆ¶OpenFeign ribbonå¦‚æœåœ¨è°ƒç”¨è¿œç¨‹å¾®æœåŠ¡ç­‰å¾…è¶…è¿‡ä¸€å®šæ—¶é—´ä¼šæŠ¥Timeouté”™è¯¯è€Œä¸ä¼šç»§ç»­ç­‰å¾…æœåŠ¡è°ƒç”¨å®Œæˆï¼Œè¿™ä¸ªè¶…æ—¶æ—¶é—´é»˜è®¤ä¸º1sã€‚ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æµ‹è¯•ï¼š æœåŠ¡æä¾›æ–¹ @GetMapping(value = \"/payment/feign/timeout\") public String paymentFeignTimeout(){ try { TimeUnit.SECONDS.sleep(3); }catch (InterruptedException e){ e.printStackTrace(); } return serverPort; } feignClientæœåŠ¡æ¥å£ @Component @FeignClient(\"CLOUD-PAYMENT-SERVICE\") public interface PaymentFeignService { @GetMapping(value = \"/payment/{id}\") public CommonResult&lt;Payment> getPaymentById(@PathVariable(\"id\") Long id); @GetMapping(value = \"/payment/feign/timeout\") public String paymentFeignTimeout(); } controllerè°ƒç”¨ï¼š @Slf4j @RestController public class OrderFeignController { @Resource private PaymentFeignService paymentFeignService; @GetMapping(value=\"/consumer/payment/{id}\",produces = \"application/json\") public CommonResult&lt;Payment> getPaymentById(@PathVariable(\"id\") Long id){ return paymentFeignService.getPaymentById(id); } //openfeignå®¢æˆ·ç«¯ä¸€èˆ¬é»˜è®¤ç­‰å¾…ä¸€ç§’é’Ÿ,æ­¤å¤„è¶…æ—¶ @GetMapping(value = \"/consumer/payment/feign/timeout\") public String paymentFeignTimeout() { return paymentFeignService.paymentFeignTimeout(); } } åœ¨è®¿é—® http://localhost/consumer/payment/feign/timeout çš„æ—¶å€™å¯ä»¥çœ‹åˆ°è¶…æ—¶é”™è¯¯ï¼š There was an unexpected error (type=Internal Server Error, status=500). connect timed out executing GET http://CLOUD-PAYMENT-SERVICE/payment/feign/timeout feign.RetryableException: connect timed out executing GET http://CLOUD-PAYMENT-SERVICE/payment/feign/timeout ...å¦‚æœéœ€è¦ä¿®æ”¹é»˜è®¤çš„è¶…æ—¶æ—¶é—´ï¼Œåœ¨yamlé…ç½®ä¸­ä¿®æ”¹å¦‚ä¸‹ï¼š ribbon: # æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´ ReadTimeout: 5000 # æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´ ConnectTimeout: 5000 4 æ—¥å¿—å¢å¼ºæ—¥å¿—çº§åˆ« NONE: é»˜è®¤çš„ï¼Œä¸æ˜¾ç¤ºä»»ä½•æ—¥å¿— BASIC: ä»…è®°å½•è¯·æ±‚æ–¹æ³•ã€URLã€å“åº”çŠ¶æ€ç åŠæ‰§è¡Œæ—¶é—´ HEADERS: é™¤äº†BASICä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯ FULL: é™¤äº†HEADERSä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„æ­£æ–‡åŠå…ƒæ•°æ® 4.1 å¦‚ä½•é…ç½®@Configuration public class FeignConfig { @Bean Logger.Level feignLoggerLevel(){ return Logger.Level.FULL; } } è¿˜éœ€è¦åœ¨yamlä¸­é…ç½®ï¼ŒæŒ‡å®šfeignè°ƒç”¨çš„æ¥å£ï¼Œè¿™é‡Œçš„debugæ˜¯slf4jå±‚é¢çš„debugï¼š logging: level: com.rhett.springcloud.service.PaymentFeignService: debug","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"OpenFeign","slug":"OpenFeign","permalink":"https://www.codetool.top/tags/OpenFeign/"},{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"}]},{"title":"è´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨-Ribbonç®€å•ä½¿ç”¨","slug":"è´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨-Ribbonç®€å•ä½¿ç”¨","date":"2020-03-21T02:53:46.000Z","updated":"2020-03-21T02:56:03.653Z","comments":true,"path":"article/è´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨-Ribbonç®€å•ä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8-Ribbon%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 æ¦‚è¿°Spring Cloud Ribbonæ˜¯åŸºäºNetlix Ribbonå®ç°çš„ä¸€å¥—å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„å·¥å…·ã€‚ Ribbonæ˜¯Netflixå‘å¸ƒçš„å¼€æºé¡¹ç›®ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æä¾›å®¢æˆ·ç«¯çš„è½¯ä»¶è´Ÿè½½å‡è¡¡ç®—æ³•å’ŒæœåŠ¡è°ƒç”¨ã€‚Ribbonå®¢æˆ·ç«¯ç»„ä»¶æä¾›ä¸€ç³»åˆ—å®Œå–„çš„é…ç½®é¡¹å¦‚è¿æ¥è¶…æ—¶ï¼Œé‡è¯•ç­‰ã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­åˆ—å‡ºLoad Balancer (ç®€ç§°LB)åé¢æ‰€æœ‰çš„æœºå™¨ï¼ŒRibbonä¼šè‡ªåŠ¨çš„å¸®åŠ©ä½ åŸºäºæŸç§è§„åˆ™(å¦‚ç®€å•è½®è¯¢,éšæœºè¿æ¥ç­‰)å»è¿æ¥è¿™äº›æœºå™¨ã€‚æˆ‘ä»¬å¾ˆå®¹æ˜“ä½¿ç”¨Ribbonå®ç°è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚ 1.1 ribbonè´Ÿè½½å‡è¡¡å’ŒNginxè´Ÿè½½å‡è¡¡çš„åŒºåˆ«Nginxæ˜¯æœåŠ¡å™¨è´Ÿè½½å‡è¡¡;å®¢æˆ·ç«¯æ‰€æœ‰è¯·æ±‚éƒ½ä¼šäº¤ç»™nginx,ç„¶åç”±nginxå®ç°è½¬å‘è¯·æ±‚ã€‚å³è´Ÿè½½å‡è¡¡æ˜¯ç”±æœåŠ¡ç«¯å®ç°çš„ã€‚ Ribbonæœ¬åœ°è´Ÿè½½å‡è¡¡ï¼Œåœ¨è°ƒç”¨å¾®æœåŠ¡æ¥å£æ—¶å€™ï¼Œä¼šåœ¨æ³¨å†Œä¸­å¿ƒä¸Šè·å–æ³¨å†Œä¿¡æ¯æœåŠ¡åˆ—è¡¨ä¹‹åç¼“å­˜åˆ°JVMæœ¬åœ°,ä»è€Œåœ¨æœ¬åœ°å®ç°RPCè¿œç¨‹æœåŠ¡è°ƒç”¨æŠ€æœ¯ã€‚ 1.2 é›†ä¸­å¼è´Ÿè½½å‡è¡¡å’Œè¿›ç¨‹å†…è´Ÿè½½å‡è¡¡1.2.1 é›†ä¸­å¼LBå³åœ¨æœåŠ¡çš„æ¶ˆè´¹æ–¹å’Œæä¾›æ–¹ä¹‹é—´ä½¿ç”¨ç‹¬ç«‹çš„LBè®¾æ–½ï¼ˆå¯ä»¥æ˜¯ç¡¬ä»¶ï¼Œå¦‚F5, ä¹Ÿå¯ä»¥æ˜¯è½¯ä»¶ï¼Œå¦‚nginxï¼‰, ç”±è¯¥è®¾æ–½è´Ÿè´£æŠŠè®¿é—®è¯·æ±‚é€šè¿‡æŸç§ç­–ç•¥è½¬å‘è‡³æœåŠ¡çš„æä¾›æ–¹ã€‚ 1.2.2 è¿›ç¨‹å†…LBå°†LBé€»è¾‘é›†æˆåˆ°æ¶ˆè´¹æ–¹ï¼Œæ¶ˆè´¹æ–¹ä»æœåŠ¡æ³¨å†Œä¸­å¿ƒè·çŸ¥æœ‰å“ªäº›åœ°å€å¯ç”¨ï¼Œç„¶åè‡ªå·±å†ä»è¿™äº›åœ°å€ä¸­é€‰æ‹©å‡ºä¸€ä¸ªåˆé€‚çš„æœåŠ¡å™¨ã€‚ Ribbonå°±å±äºè¿›ç¨‹å†…LBï¼Œå®ƒåªæ˜¯ä¸€ä¸ªåº“ï¼Œé›†æˆäºæ¶ˆè´¹æ–¹è¿›ç¨‹ï¼Œæ¶ˆè´¹æ–¹é€šè¿‡å®ƒæ¥è·å–åˆ°æœåŠ¡æä¾›æ–¹çš„åœ°å€ã€‚ 2 ä½¿ç”¨Eureka Clientæœ¬èº«é›†æˆäº†Ribbonï¼Œä¹‹å‰åœ¨æœåŠ¡æ³¨å†Œä¸å‘ç°-Eurekaæ¦‚è¿°ä¸ç®€å•ä½¿ç”¨ä¸­çš„å®ä¾‹å°±ç”¨åˆ°äº†ribbonçš„èƒ½åŠ› Ribbonåœ¨å·¥ä½œæ—¶åˆ†æˆä¸¤æ­¥ ç¬¬ä¸€æ­¥å…ˆé€‰æ‹©Eureka Server ,å®ƒä¼˜å…ˆé€‰æ‹©åœ¨åŒä¸€ä¸ªåŒºåŸŸå†…è´Ÿè½½è¾ƒå°‘çš„server. ç¬¬äºŒæ­¥å†æ ¹æ®ç”¨æˆ·æŒ‡å®šçš„ç­–ç•¥ï¼Œåœ¨ä»serverå–åˆ°çš„æœåŠ¡æ³¨å†Œåˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªåœ°å€ã€‚ å…¶ä¸­Ribbonæä¾›äº†å¤šç§ç­–ç•¥:æ¯”å¦‚è½®è¯¢ã€éšæœºå’Œæ ¹æ®å“åº”æ—¶é—´åŠ æƒã€‚ ä¾èµ–ï¼š &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-netflix-ribbon&lt;/artifactId> &lt;/dependency> ä½¿ç”¨@LoadBalanceå¾—åˆ°RestTemplate 2.1 è´Ÿè½½å‡è¡¡ç®—æ³•æ¥å£IRule RoundRobinRule è½®è¯¢ï¼ˆé»˜è®¤ï¼‰ RandomRule éšæœº RetryRule å…ˆæŒ‰ç…§RoundRobinRuleçš„ç­–ç•¥è·å–æœåŠ¡ï¼Œå¦‚æœæœåŠ¡å¤±è´¥åˆ™åœ¨æŒ‡å®šæ—¶é—´å†…é‡è¯•ï¼Œè·å–å¯ç”¨çš„æœåŠ¡ WeightedResponseTimeRule å¯¹RoundRobinRuleçš„æ‹“å±•ï¼Œå“åº”é€Ÿåº¦è¶Šå¿«çš„å®ä¾‹é€‰æ‹©æƒé‡è¶Šå¤§ï¼Œè¶Šå®¹æ˜“è¢«é€‰æ‹© BestAvailableRule ä¼šå…ˆè¿‡æ»¤æ‰ç”±äºå¤šæ¬¡è®¿é—®æ•…éšœè€Œå¤„äºæ–­è·¯å™¨è·³é—¸çŠ¶æ€çš„æœåŠ¡ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªå¹¶å‘é‡æœ€å°çš„æœåŠ¡ AvailabilityFiltering ä¼šå…ˆè¿‡æ»¤æ‰æ•…éšœå®ä¾‹ï¼Œå†é€‰æ‹©å¹¶å‘é‡è¾ƒå°çš„å®ä¾‹ ZoneAvoidanceRule ç¬¦åˆåˆ¤æ–­serveræ‰€åœ¨åŒºåŸŸçš„æ€§èƒ½å’Œserverçš„å¯ç”¨æ€§é€‰æ‹©æœåŠ¡å™¨ ä½¿ç”¨ä¸åŒçš„ç®—æ³•ï¼šè‡ªå®šä¹‰IRuleæ³¨å…¥ @Configuration public class MyselfRule { @Bean public IRule myRule(){ return new RandomRule(); } } å¹¶ä½¿ç”¨@RibbonClientæŒ‡å®šé…ç½®ç±»ï¼Œè¿™ä¸ªè‡ªå®šä¹‰é…ç½®ç±»ä¸èƒ½æ”¾åœ¨@ComponentScanæ‰€æ‰«æçš„å½“å‰åŒ…ä¸‹ä»¥åŠå­åŒ…ä¸‹ï¼Œå¦åˆ™æˆ‘ä»¬è‡ªå®šä¹‰çš„è¿™ä¸ªé…ç½®ç±»å°±ä¼šè¢«æ‰€æœ‰çš„Ribbonå®¢æˆ·ç«¯æ‰€å…±äº«,è¾¾ä¸åˆ°ç‰¹æ®ŠåŒ–å®šåˆ¶çš„ç›®çš„äº†ã€‚ @SpringBootApplication @EnableEurekaClient @RibbonClient(name=\"CLOUD-PAYMENT-SERVICE\",configuration = MyselfRule.class) public class OrderMain80 { public static void main(String[] args) { SpringApplication.run(OrderMain80.class,args); } } 2.2 RoundRobinRuleæºç public class RoundRobinRule extends AbstractLoadBalancerRule { private AtomicInteger nextServerCyclicCounter; private static final boolean AVAILABLE_ONLY_SERVERS = true; private static final boolean ALL_SERVERS = false; private static Logger log = LoggerFactory.getLogger(RoundRobinRule.class); public RoundRobinRule() { nextServerCyclicCounter = new AtomicInteger(0); } public RoundRobinRule(ILoadBalancer lb) { this(); setLoadBalancer(lb); } public Server choose(ILoadBalancer lb, Object key) { if (lb == null) { log.warn(\"no load balancer\"); return null; } Server server = null; // int count = 0; while (server == null &amp;&amp; count++ &lt; 10) { //é€šè¿‡LoadBalancerè·å–å¯ç”¨çš„æœåŠ¡å™¨ List&lt;Server> reachableServers = lb.getReachableServers(); //é€šè¿‡LoadBalancerè·å–æ‰€æœ‰æœåŠ¡å™¨ List&lt;Server> allServers = lb.getAllServers(); int upCount = reachableServers.size(); int serverCount = allServers.size(); if ((upCount == 0) || (serverCount == 0)) { log.warn(\"No up servers available from load balancer: \" + lb); return null; } //è·å–ä¸‹ä¸€ä¸ªè¦å–çš„æœåŠ¡å™¨ä¸‹æ ‡ int nextServerIndex = incrementAndGetModulo(serverCount); server = allServers.get(nextServerIndex); if (server == null) { /* Transient. */ Thread.yield(); continue; } if (server.isAlive() &amp;&amp; (server.isReadyToServe())) { return (server); } // Next. server = null; } if (count >= 10) { log.warn(\"No available alive servers after 10 tries from load balancer: \" + lb); } return server; } //CASæ”¹å˜ä¸‹ä¸€æ¬¡çš„ä¸‹æ ‡ private int incrementAndGetModulo(int modulo) { for (;;) { int current = nextServerCyclicCounter.get(); int next = (current + 1) % modulo; if (nextServerCyclicCounter.compareAndSet(current, next)) return next; } } @Override public Server choose(Object key) { return choose(getLoadBalancer(), key); } @Override public void initWithNiwsConfig(IClientConfig clientConfig) { } } 3 ä¸ä½¿ç”¨ribbonå®ç°ä¸€ä¸ªè‡ªå®šä¹‰è´Ÿè½½å‡è¡¡public interface LoadBalancer { ServiceInstance chooseInstance(List&lt;ServiceInstance> serviceInstances); } @Component public class myLB implements LoadBalancer { private AtomicInteger atomicInteger = new AtomicInteger(0); public final int getAndIncrement(){ int current; int next; do{ current = atomicInteger.get(); next = current == Integer.MAX_VALUE?0:current+1; }while (!atomicInteger.compareAndSet(current, next)); System.out.println(\"*******next: \"+next); return next; } @Override public ServiceInstance chooseInstance(List&lt;ServiceInstance> serviceInstances) { int index = getAndIncrement()%serviceInstances.size(); return serviceInstances.get(index); } } controllerï¼š @RestController public class OrderController { @Resource private LoadBalancer loadBalancer; @Resource private RestTemplate restTemplate;//ç¦ç”¨æ‰@loadbalance @Resource private DiscoveryClient discoveryClient; @GetMapping(\"/consumer/payment/lb\") public String getPaymentLB(){ List&lt;ServiceInstance> instances = discoveryClient.getInstances(\"CLOUD-PAYMENT-SERVICE\"); if(instances == null || instances.size() == 0){ return null; } ServiceInstance serviceInstance = loadBalancer.chooseInstance(instances); URI uri = serviceInstance.getUri(); return restTemplate.getForObject(uri+\"/payment/lb\",String.class); } }","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"},{"name":"Ribbon","slug":"Ribbon","permalink":"https://www.codetool.top/tags/Ribbon/"}]},{"title":"leetcode365-æ°´å£¶é—®é¢˜","slug":"leetcode365-æ°´å£¶é—®é¢˜","date":"2020-03-21T00:57:47.000Z","updated":"2020-03-22T13:57:29.616Z","comments":true,"path":"article/leetcode365-æ°´å£¶é—®é¢˜/","link":"","permalink":"https://www.codetool.top/article/leetcode365-%E6%B0%B4%E5%A3%B6%E9%97%AE%E9%A2%98/","excerpt":"","text":"1 åŸé¢˜æœ‰ä¸¤ä¸ªå®¹é‡åˆ†åˆ«ä¸º xå‡ å’Œ yå‡ çš„æ°´å£¶ä»¥åŠæ— é™å¤šçš„æ°´ã€‚è¯·åˆ¤æ–­èƒ½å¦é€šè¿‡ä½¿ç”¨è¿™ä¸¤ä¸ªæ°´å£¶ï¼Œä»è€Œå¯ä»¥å¾—åˆ°æ°å¥½ zå‡ çš„æ°´ï¼Ÿ å¦‚æœå¯ä»¥ï¼Œæœ€åè¯·ç”¨ä»¥ä¸Šæ°´å£¶ä¸­çš„ä¸€æˆ–ä¸¤ä¸ªæ¥ç››æ”¾å–å¾—çš„ zå‡ æ°´ã€‚ ä½ å…è®¸ï¼š è£…æ»¡ä»»æ„ä¸€ä¸ªæ°´å£¶ æ¸…ç©ºä»»æ„ä¸€ä¸ªæ°´å£¶ ä»ä¸€ä¸ªæ°´å£¶å‘å¦å¤–ä¸€ä¸ªæ°´å£¶å€’æ°´ï¼Œç›´åˆ°è£…æ»¡æˆ–è€…å€’ç©º ç¤ºä¾‹ 1:(From the famous â€œDie Hardâ€ example) è¾“å…¥: x = 3, y = 5, z = 4è¾“å‡º: True ç¤ºä¾‹ 2: è¾“å…¥: x = 2, y = 6, z = 5è¾“å‡º: False 2 è§£æ³•2.1 æ€æƒ³2.1.1 DFS/BFSåœ¨ä»»æ„ä¸€ä¸ªæ—¶åˆ»ï¼Œæˆ‘ä»¬å¯ä»¥ä¸”ä»…å¯ä»¥é‡‡å–ä»¥ä¸‹å‡ ç§æ“ä½œï¼š æŠŠ X å£¶çš„æ°´çŒè¿› Y å£¶ï¼Œç›´è‡³çŒæ»¡æˆ–å€’ç©ºï¼› æŠŠ Y å£¶çš„æ°´çŒè¿› X å£¶ï¼Œç›´è‡³çŒæ»¡æˆ–å€’ç©ºï¼› æŠŠ X å£¶çŒæ»¡ï¼› æŠŠ Y å£¶çŒæ»¡ï¼› æŠŠ X å£¶å€’ç©ºï¼› æŠŠ Y å£¶å€’ç©ºã€‚ å¯ä»¥ä½¿ç”¨BFSæˆ–DFSï¼Œç„¶è€ŒJavaæ²¡æœ‰ç±»ä¼¼Pairçš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥è‡ªå·±å†™ä¸€ä¸ªç±»å‡ºæ¥ã€‚ 2.1.2 æ•°å­¦å¦ä¸€ä¸ªæ–¹æ³•æ˜¯æ•°å­¦å®šç† è£´èœ€å®šç†_ç™¾åº¦ç™¾ç§‘ è‹¥ aï¼Œb ä¸ºæ•´æ•°ï¼Œä¸” gcd(a,b) = dï¼Œåˆ™å¯¹äºä»»æ„çš„æ•´æ•°xï¼Œyï¼Œax + byéƒ½ä¸€å®šæ˜¯ d çš„å€æ•°ã€‚ ç‰¹åˆ«åœ°ï¼Œä¸€å®šå­˜åœ¨æ•´æ•° xï¼Œyï¼Œä½¿å¾— ax + by = d æˆç«‹ã€‚ 2.2 ä»£ç BFSï¼ˆæœ‰æ—¶é—´å›æ¥æ”¹å†™ï¼‰ class Solution { public boolean canMeasureWater(int x, int y, int z) { if (x + y &lt; z) { return false; } if (x == 0 || y == 0) { return x == z || y == z; } Queue&lt;List&lt;Integer>> queue = new LinkedList&lt;>(); Set&lt;List&lt;Integer>> set = new HashSet&lt;>(); List&lt;Integer> list = Arrays.asList(0, 0); queue.offer(list); set.add(list); while (!queue.isEmpty()) { List&lt;Integer> temp = queue.poll(); int cur_x = temp.get(0); int cur_y = temp.get(1); if (z == cur_x || z == cur_y || z == cur_x + cur_y) { return true; } //1ã€ç»™xåŠ æ»¡æ°´ List&lt;Integer> condition1 = Arrays.asList(x, cur_y); if (!set.contains(condition1)) { set.add(condition1); queue.offer(condition1); } //2ã€ç»™yåŠ æ»¡æ°´ List&lt;Integer> condition2 = Arrays.asList(cur_x, y); if (!set.contains(condition2)) { set.add(condition2); queue.offer(condition2); } //3ã€æ¸…ç©ºxçš„æ°´ List&lt;Integer> condition3 = Arrays.asList(0, cur_y); if (!set.contains(condition3)) { set.add(condition3); queue.offer(condition3); } //4ã€æ¸…ç©ºyçš„æ°´ List&lt;Integer> condition4 = Arrays.asList(cur_x, 0); if (!set.contains(condition4)) { set.add(condition4); queue.offer(condition4); } //5ã€xç»™yå€’æ°´ List&lt;Integer> condition5 = (cur_x + cur_y >= y) ? Arrays.asList(cur_x + cur_y - y, y) : Arrays.asList(0, cur_x + cur_y); if (!set.contains(condition5)) { set.add(condition5); queue.offer(condition5); } //6ã€yç»™xå€’æ°´ List&lt;Integer> condition6 = (cur_x + cur_y >= x) ? Arrays.asList(x, cur_x + cur_y - x) : Arrays.asList(cur_x + cur_y, 0); if (!set.contains(condition6)) { set.add(condition6); queue.offer(condition6); } } return false; } } è£´èœ€å®šç†ï¼š class Solution { public boolean canMeasureWater(int x, int y, int z) { if (x + y &lt; z) return false; if (x == z || y == z || x + y == z) return true; return (z % gcd(x, y) == 0); } public int gcd(int x,int y){ if(y == 0) return x; int r = x % y; return gcd(y,r); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ³¨å†Œä¸­å¿ƒConsulåŸºæœ¬ä½¿ç”¨","slug":"æ³¨å†Œä¸­å¿ƒConsulåŸºæœ¬ä½¿ç”¨","date":"2020-03-20T15:06:36.000Z","updated":"2020-03-20T15:07:14.491Z","comments":true,"path":"article/æ³¨å†Œä¸­å¿ƒConsulåŸºæœ¬ä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83Consul%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 Consulæ¦‚è¿°Consulæ˜¯ä¸€å¥—å¼€æºçš„åˆ†å¸ƒå¼æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†ç³»ç»Ÿï¼Œç”±HashiCorpå…¬å¸ç”¨Goè¯­è¨€å¼€å‘ã€‚ æä¾›äº†å¾®æœåŠ¡ç³»ç»Ÿä¸­çš„æœåŠ¡æ²»ç†ã€é…ç½®ä¸­å¿ƒã€æ§åˆ¶æ€»çº¿ç­‰åŠŸèƒ½ã€‚è¿™äº›åŠŸèƒ½ä¸­çš„æ¯ä¸€ä¸ªéƒ½å¯ä»¥æ ¹æ®éœ€è¦å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä¸€èµ·ä½¿ç”¨ä»¥æ„å»ºå…¨æ–¹ä½çš„æœåŠ¡ç½‘æ ¼,æ€»ä¹‹Consulæä¾›äº†ä¸€ç§å®Œæ•´çš„æœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆã€‚ å®ƒå…·æœ‰å¾ˆå¤šä¼˜ç‚¹ã€‚åŒ…æ‹¬:åŸºäºraftåè®®ï¼Œæ¯”è¾ƒç®€æ´ï¼›æ”¯æŒå¥åº·æ£€æŸ¥ï¼ŒåŒæ—¶æ”¯æŒHTTPå’ŒDNSåè®®ï¼Œæ”¯æŒè·¨æ•°æ®ä¸­å¿ƒçš„WANé›†ç¾¤ï¼Œæä¾›å›¾å½¢ç•Œé¢ï¼Œè·¨å¹³å°ï¼Œæ”¯æŒLinuxã€Macã€ Windows ä¸‹è½½åœ°å€ï¼š https://www.consul.io/downloads.html 2 ä½¿ç”¨ä½¿ç”¨consul agent -devå¼€å‘æ¨¡å¼å¯åŠ¨ï¼Œå¯åŠ¨æˆåŠŸè®¿é—® http://localhost:8500/ åˆ™æœ‰å›¾å½¢åŒ–ç®¡ç†ç•Œé¢ 2.1 æœåŠ¡æ³¨å†Œæ–°å»ºcloud-providerconsul-payment8006æ¨¡å—ï¼Œä¾èµ–ï¼š &lt;!--SpringCloud consul-server--> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-consul-discovery&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>com.rhett&lt;/groupId> &lt;artifactId>cloud-api-common&lt;/artifactId> &lt;version>${project.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-web&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-actuator&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-devtools&lt;/artifactId> &lt;scope>runtime&lt;/scope> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-test&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;/dependency> yamlé…ç½®ï¼š server: port: 8006 spring: application: name: consul-provider-payment # consul æ³¨å†Œä¸­å¿ƒåœ°å€ cloud: consul: host: localhost port: 8500 discovery: service-name: ${spring.application.name} å¯åŠ¨ç±»ï¼š @SpringBootApplication @EnableDiscoveryClient public class PaymentMain8006 { public static void main(String[] args) { SpringApplication.run(PaymentMain8006.class,args); } } controller: @RestController @Slf4j public class PaymentController { @Value(\"${server.port}\") private String serverPort; @RequestMapping(value = \"/payment/consul\") public String paymentConsul(){ return \"SpringCloud with Consul: \"+serverPort+\"\\t\"+ UUID.randomUUID().toString(); } } è¿è¡Œè¯¥æ¨¡å—ï¼Œå³å¯çœ‹åˆ°æœåŠ¡è¢«æ³¨å†Œåˆ°consulä¸Šäº† 2.2 æœåŠ¡æ¶ˆè´¹æ–°å»ºcloud-consumerconsul-order80æ¨¡å—ï¼Œä¾èµ–ï¼š &lt;!--SpringCloud consul-server--> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-consul-discovery&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>com.rhett&lt;/groupId> &lt;artifactId>cloud-api-common&lt;/artifactId> &lt;version>${project.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-web&lt;/artifactId> &lt;/dependency> &lt;!--ç›‘æ§--> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-actuator&lt;/artifactId> &lt;/dependency> &lt;!--çƒ­éƒ¨ç½²--> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-devtools&lt;/artifactId> &lt;scope>runtime&lt;/scope> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-test&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;/dependency> yamlé…ç½®ï¼Œä¹Ÿæ³¨å†Œåˆ°consulä¸Š server: port: 80 spring: application: name: cloud-consumer-order # consulæ³¨å†Œä¸­å¿ƒåœ°å€ cloud: consul: host: localhost port: 8500 discovery: service-name: ${spring.application.name} è·å–RestTemplateçš„é…ç½®ç±»ï¼š @Configuration public class ApplicationContextConfig { @Bean @LoadBalanced public RestTemplate getRestTemplate(){ return new RestTemplate(); } } å¯åŠ¨ç±»ï¼š @SpringBootApplication @EnableDiscoveryClient public class OrderConsulMain80 { public static void main(String[] args) { SpringApplication.run(OrderConsulMain80.class, args); } } controllerï¼š @RestController @Slf4j public class OrderConsulController { public static final String INVOKE_URL = \"http://consul-provider-payment\"; @Resource private RestTemplate restTemplate; @GetMapping(\"/consumer/payment/consul\") public String getPayment(){ return restTemplate.getForObject(INVOKE_URL+\"/payment/consul\",String.class); } } ä¿æŒconsulè¿è¡Œï¼Œå¯åŠ¨æœåŠ¡æä¾›æ–¹å’Œæ¶ˆè´¹æ–¹ï¼Œè®¿é—® http://localhost/consumer/payment/consul å°±èƒ½çœ‹åˆ°ç»“æœäº†ã€‚ 3 ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹ ç»„ä»¶å è¯­è¨€ CAP æœåŠ¡å¥åº·æ£€æŸ¥ å¯¹å¤–æš´éœ²æ¥å£ Spring Cloudé›†æˆ Eureka Java AP å¯é…æ”¯æŒ HTTP å·²é›†æˆ Consul Go CP æ”¯æŒ HTTP/DNS å·²é›†æˆ Zookeeper Java CP æ”¯æŒ å®¢æˆ·ç«¯ å·²é›†æˆ","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"},{"name":"Consul","slug":"Consul","permalink":"https://www.codetool.top/tags/Consul/"}]},{"title":"EurekaæœåŠ¡å‘ç°å’Œè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶","slug":"EurekaæœåŠ¡å‘ç°å’Œè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶","date":"2020-03-20T11:31:09.000Z","updated":"2020-03-20T15:07:17.255Z","comments":true,"path":"article/EurekaæœåŠ¡å‘ç°å’Œè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶/","link":"","permalink":"https://www.codetool.top/article/Eureka%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E5%92%8C%E8%87%AA%E6%88%91%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/","excerpt":"","text":"1 é…ç½®æœåŠ¡ä¿¡æ¯å®Œå–„é¦–å…ˆä¿è¯æœ‰ä¾èµ–ï¼š &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-actuator&lt;/artifactId> &lt;/dependency> åœ¨é…ç½®ä¸­æŒ‡å®šeureka.instance.instance-idæ˜¾ç¤ºæœåŠ¡æä¾›æ–¹çš„ä¸»æœºå é…ç½®eureka.instance.prefer-ip-address å¯æ˜¾ç¤ºæœåŠ¡æä¾›æ–¹çš„ipåœ°å€ eureka: client: service-url: defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka #é›†ç¾¤ç‰ˆ # å°†è‡ªå·±æ³¨å†Œè¿›eureka server register-with-eureka: true # æ˜¯å¦ä»eureka serveræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡ fetch-registry: true instance: instance-id: payment8002 # æ˜¾ç¤ºä¸»æœºå prefer-ip-address: true # è®¿é—®è·¯å¾„å¯ä»¥æ˜¾ç¤ºipåœ°å€ 2 æœåŠ¡å‘ç°å¯¹äºæ³¨å†Œè¿›Eurekaçš„å¾®æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡æœåŠ¡å‘ç°æ¥è·å¾—è¯¥æœåŠ¡çš„ä¿¡æ¯ åœ¨å¯åŠ¨ç±»ä¸Šé…ç½®@EnableDiscoveryClientæ³¨è§£ä»¥å¯ç”¨DiscoveryClient æ³¨å…¥DiscoveryClientï¼š(org.springframework.cloud.client.discovery.DiscoveryClient) @Resource private DiscoveryClient discoveryClient; ä½¿ç”¨ï¼š List&lt;String> services = discoveryClient.getServices(); for (String service : services) { log.info(\"****element: \"+service); } List&lt;ServiceInstance> instances = discoveryClient.getInstances(\"CLOUD-PAYMENT-SERVICE\"); for (ServiceInstance instance : instances) { log.info(instance.getInstanceId()+\"\\t\"+instance.getHost()+\"\\t\"+instance.getPort()+\"\\t\"+instance.getUri()); } 3 è‡ªæˆ‘ä¿æŠ¤ä¸ºäº†é˜²æ­¢Eureka Clientå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ä¸Eureka Serverç½‘ç»œä¸é€šæƒ…å†µä¸‹, Eureka Serverä¸ä¼šç«‹åˆ»å°†Eureka ClientæœåŠ¡ç§»é™¤ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœEureka Serveråœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªå¾®æœåŠ¡å®ä¾‹çš„å¿ƒè·³ï¼ŒEurekaServerå°†ä¼šæ³¨é”€è¯¥å®ä¾‹(é»˜è®¤90ç§’)ã€‚ä½†æ˜¯å½“ç½‘ç»œåˆ†åŒºæ•…éšœå‘ç”Ÿ(å»¶æ—¶ã€å¡é¡¿ã€æ‹¥æŒ¤)æ—¶ï¼Œå¾®æœåŠ¡ä¸EurekaServerä¹‹é—´æ— æ³•æ­£å¸¸é€šä¿¡ï¼Œä»¥ä¸Šè¡Œä¸ºå¯èƒ½å˜å¾—éå¸¸å±é™©äº†â€”â€”å› ä¸ºå¾®æœåŠ¡æœ¬èº«å…¶å®æ˜¯å¥åº·çš„ï¼Œæ­¤æ—¶æœ¬ä¸åº”è¯¥æ³¨é”€è¿™ä¸ªå¾®æœåŠ¡ã€‚Eurekaé€šè¿‡â€œè‡ªæˆ‘ä¿æŠ¤æ¨¡å¼â€æ¥è§£å†³è¿™ä¸ªé—®é¢˜â€”â€”å½“EurekaServerèŠ‚ ç‚¹åœ¨çŸ­æ—¶é—´å†…ä¸¢å¤±è¿‡å¤šå®¢æˆ·ç«¯æ—¶(å¯èƒ½å‘ç”Ÿäº†ç½‘ç»œåˆ†åŒºæ•…éšœ)ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å°±ä¼šè¿›å…¥è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ã€‚ åœ¨è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ä¸­ï¼ŒEureka Serverä¼šä¿æŠ¤æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯ï¼Œä¸å†æ³¨é”€ä»»ä½•æœåŠ¡å®ä¾‹ã€‚ æç¤ºï¼š EMERGENCY! EUREKA MAY BE INCORRECTLY CLAIMING INSTANCES ARE UP WHEN THEY&#39;RE NOT. RENEWALS ARE LESSER THAN THRESHOLD AND HENCE THE INSTANCES ARE NOT BEING EXPIRED JUST TO BE SAFE.è¿™ä¸ªæœºåˆ¶æ˜¯CAPä¸­APçš„ä½“ç°ã€‚ 3.1 ç¦æ­¢è‡ªæˆ‘ä¿æŠ¤åœ¨eureka serveré…ç½®ä¸­é…ç½®eureka.server.enable-self-perservation = false 3.2 å®¢æˆ·ç«¯å¿ƒè·³é…ç½® lease-renewal-interval-in-seconds:10 å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºç§’ï¼ˆé»˜è®¤ä¸º30ç§’ï¼‰ lease-expiration-duration-in-seconds:20 æœåŠ¡ç«¯åœ¨æ”¶åˆ°æœ€åä¸€æ¬¡å¿ƒè·³åç­‰å¾…æ—¶é—´ä¸Šé™ï¼Œå•ä½ä¸ºç§’ï¼ˆé»˜è®¤ä¸º90ç§’ï¼‰ï¼Œè¶…æ—¶å°†ç§»é™¤æœåŠ¡ 4 Eurekaåœæ›´è¯´æ˜ Eureka 2.0 (Discontinued) The existing open source work on eureka 2.0 is discontinued. The code base and artifacts that were released as part of the existing repository of work on the 2.x branch is considered use at your own risk. Eureka 1.x is a core part of Netflixâ€™s service discovery system and is still an active project. ç›®å‰å·²ç»ä¸å†æ¨èä½¿ç”¨Eurekaï¼Œå¯ä»¥ä½¿ç”¨Zookeeper/consul/nacosæ¥ä»£æ›¿å®ƒ","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"},{"name":"Eureka","slug":"Eureka","permalink":"https://www.codetool.top/tags/Eureka/"}]},{"title":"æœåŠ¡æ³¨å†Œä¸å‘ç°-Eurekaæ¦‚è¿°ä¸ç®€å•ä½¿ç”¨","slug":"æœåŠ¡æ³¨å†Œä¸å‘ç°-Eurekaæ¦‚è¿°ä¸ç®€å•ä½¿ç”¨","date":"2020-03-20T11:28:47.000Z","updated":"2020-03-22T15:05:33.882Z","comments":true,"path":"article/æœåŠ¡æ³¨å†Œä¸å‘ç°-Eurekaæ¦‚è¿°ä¸ç®€å•ä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0-Eureka%E6%A6%82%E8%BF%B0%E4%B8%8E%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/","excerpt":"","text":"æœ¬æ–‡å†…å®¹åŸºäºSpringCloudæ¦‚è¿°å’Œå­¦ä¹ é¡¹ç›®é¢„æ­å»ºä¸­æ­å»ºçš„å·¥ç¨‹ 1 ä½œç”¨Spring Cloudå°è£…äº†Netflixå…¬å¸å¼€å‘çš„Eurekaæ¨¡å—æ¥å®ç°æœåŠ¡æ²»ç† Eurekaæ˜¯ä¸ªåŸºäºRESTçš„æœåŠ¡ï¼ŒSpringCloudå°†å®ƒé›†æˆåœ¨å…¶å­é¡¹ç›®ä¸­ï¼Œä»¥å®ç°SpringCloudçš„æœåŠ¡å‘ç°åŠŸèƒ½ï¼ŒSpringCloudé‡è¦ç»„æˆç»„ä»¶ã€‚ åœ¨ä¼ ç»Ÿçš„rpcè¿œç¨‹è°ƒç”¨æ¡†æ¶ä¸­ï¼Œç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»æ¯”è¾ƒå¤æ‚,ç®¡ç†æ¯”è¾ƒå¤æ‚,æ‰€ä»¥éœ€è¦ä½¿ç”¨æœåŠ¡æ²»ç†,ç®¡ç†æœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå¯ä»¥å®ç°æœåŠ¡è°ƒç”¨ã€è´Ÿè½½å‡è¡¡ã€å®¹é”™ç­‰ï¼Œå®ç°æœåŠ¡å‘ç°ä¸æ³¨å†Œã€‚ 2 ç»„ä»¶EurekaåŒ…å«ä¸¤ä¸ªç»„ä»¶: Eureka Server å’Œ Eureka Client ï¼ˆå›¾ç‰‡æ¥æºï¼šhttps://blog.csdn.net/qwe86314/article/details/94552801ï¼‰ Eureka Serveræä¾›æœåŠ¡æ³¨å†ŒæœåŠ¡ï¼š å„ä¸ªå¾®æœåŠ¡èŠ‚ç‚¹é€šè¿‡é…ç½®å¯åŠ¨åï¼Œä¼šåœ¨Eureka Serverä¸­è¿›è¡Œæ³¨å†Œï¼Œ è¿™æ ·Eureka Serverä¸­çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­å°†ä¼šå­˜å‚¨æ‰€æœ‰å¯ç”¨æœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯,æœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯å¯ä»¥åœ¨ç•Œé¢ä¸­ç›´è§‚çœ‹åˆ°ã€‚ EurekaClienté€šè¿‡æ³¨å†Œä¸­å¿ƒè¿›è¡Œè®¿é—®ï¼š æ˜¯ä¸€ä¸ªJavaå®¢æˆ·ç«¯ï¼Œç”¨äºç®€åŒ–Eureka Serverçš„äº¤äº’ï¼Œå®¢æˆ·ç«¯åŒæ—¶ä¹Ÿå…·å¤‡ä¸€ä¸ªå†…ç½®çš„ã€ä½¿ç”¨è½®è¯¢(round-robin)è´Ÿè½½ç®—æ³•çš„è´Ÿè½½å‡è¡¡å™¨ã€‚åœ¨åº”ç”¨å¯åŠ¨åï¼Œå°†ä¼šå‘Eureka Serverå‘é€å¿ƒè·³ï¼ˆé»˜è®¤å‘¨æœŸä¸º30ç§’ï¼‰ã€‚å¦‚æœEureka Serveråœ¨å¤šä¸ªå¿ƒè·³å‘¨æœŸå†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªèŠ‚ç‚¹çš„å¿ƒè·³ï¼ŒEureka Serverå°†ä¼šä»æœåŠ¡æ³¨å†Œè¡¨ä¸­æŠŠè¿™ä¸ªæœåŠ¡èŠ‚ç‚¹ç§»é™¤(é»˜è®¤90ç§’) 3 ä½¿ç”¨3.1 Eureka Serveré›†ç¾¤æ­å»ºEurekaé›†ç¾¤å°±æ˜¯eureka serveräº’ç›¸æ³¨å†Œã€ç›¸äº’å®ˆæœ›ï¼Œå…ˆå°†ä¸‹é¢æ˜ å°„å†™å…¥hostsæ–‡ä»¶ï¼š 127.0.0.1 eureka7001.com 127.0.0.2 eureka7002.comåˆ›å»ºcloud-eureka-server7001å’Œcloud-eureka-server7002æ¨¡å—ï¼ˆç«¯å£å·åˆ†åˆ«ä¸º7001å’Œ7002ï¼‰ï¼Œæ·»åŠ ä¾èµ–ï¼š &lt;!--eureka-server--> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-netflix-eureka-server&lt;/artifactId> &lt;/dependency> &lt;!-- å…¶ä»– --> &lt;dependency> &lt;groupId>com.rhett&lt;/groupId> &lt;artifactId>cloud-api-commons&lt;/artifactId> &lt;version>${project.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-web&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-actuator&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-devtools&lt;/artifactId> &lt;scope>runtime&lt;/scope> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-test&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;/dependency> yamlé…ç½®ï¼š # ç«¯å£å·ï¼Œè¯·åŒºåˆ†ä¸¤å°æœºå™¨ server: port: 7002 eureka: instance: hostname: eureka7002.com client: # falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·± register-with-eureka: false # falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡ fetch-registry: false service-url: # è®¾ç½®ä¸eureka serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€ # 7001æœåŠ¡å™¨è¿™é‡Œå†™7002çš„service-url defaultZone: http://eureka7001.com:7001/eureka/ å¯åŠ¨ç±»ï¼š @SpringBootApplication @EnableEurekaServer public class EurekaMain7001 { public static void main(String[] args) { SpringApplication.run(EurekaMain7001.class, args); } } å¯åŠ¨å³å¯ 3.2 å¤šæœåŠ¡æä¾›è€…å¦å¤–åˆ›å»ºä¸€ä¸ªcloud-provider-payment8002æ¨¡å—ï¼Œå°†å®ƒå’Œcloud-provider-payment8001çš„ä¾èµ–éƒ½ä¿®æ”¹ä¸ºï¼š &lt;dependency> &lt;groupId>com.rhett&lt;/groupId> &lt;artifactId>cloud-api-commons&lt;/artifactId> &lt;version>${project.version}&lt;/version> &lt;/dependency> &lt;!-- æ·»åŠ eureka client --> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-netflix-eureka-client&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-web&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-actuator&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.mybatis.spring.boot&lt;/groupId> &lt;artifactId>mybatis-spring-boot-starter&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>com.alibaba&lt;/groupId> &lt;artifactId>druid-spring-boot-starter&lt;/artifactId> &lt;version>${druid.spring.boot.starter.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>mysql&lt;/groupId> &lt;artifactId>mysql-connector-java&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-jdbc&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-devtools&lt;/artifactId> &lt;scope>runtime&lt;/scope> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-test&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;/dependency> ä¸¤ä¸ªæ¨¡å—çš„é…ç½®ï¼š # ç«¯å£å·ï¼Œè¯·åŒºåˆ†8001å’Œ8002 server: port: 8002 spring: application: name: cloud-payment-service datasource: # å½“å‰æ•°æ®æºæ“ä½œç±»å‹ type: com.alibaba.druid.pool.DruidDataSource # mysqlé©±åŠ¨ç±» driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://localhost:3306/cloud2020?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false username: root password: 123456 mybatis: mapperLocations: classpath*:mapper/*.xml type-aliases-package: com.rhett.springcloud.entities eureka: client: service-url: defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka #é›†ç¾¤ç‰ˆ # å°†è‡ªå·±æ³¨å†Œè¿›eureka server register-with-eureka: true # æ˜¯å¦ä»eureka serveræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡ fetch-registry: true å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ï¼š @SpringBootApplication @EnableEurekaClient public class PaymentMain8001 { public static void main(String[] args) { SpringApplication.run(PaymentMain8001.class,args); } } å¯ä»¥ä¿®æ”¹controllerä»¥åŒºåˆ†ä¸¤ä¸ªæä¾›æœåŠ¡çš„providerï¼š @RestController @Slf4j public class PaymentController { @Resource private PaymentService paymentService; @Value(\"${server.port}\") private String serverPort; @PostMapping(value = \"/payment\") public CommonResult create(@RequestBody Payment payment){ int result = paymentService.create(payment); log.info(\"****æ’å…¥ç»“æœï¼š\"+result); if(result>0){ return new CommonResult(200,\"æ’å…¥æ•°æ®åº“æˆåŠŸ,serverPort: \"+serverPort,result); }else { return new CommonResult(500,\"æ’å…¥æ•°æ®åº“å¤±è´¥\"); } } @GetMapping(value = \"/payment/{id}\") public CommonResult&lt;Payment> getPaymentById(@PathVariable(\"id\") Long id){ Payment payment = paymentService.getPaymentById(id); log.info(\"****æ’å…¥ç»“æœï¼š\"+payment); if(payment!=null){ return new CommonResult(200,\"æŸ¥è¯¢æˆåŠŸ,serverPort: \"+serverPort,payment); }else { return new CommonResult(500,\"æ²¡æœ‰å¯¹åº”è®°å½•ï¼ŒæŸ¥è¯¢IDï¼š\"+id); } } } 3.3 è°ƒç”¨æœåŠ¡cloud-consumer-order80ä¹Ÿè¦æ·»åŠ ä¾èµ–ï¼š &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-netflix-eureka-client&lt;/artifactId> &lt;/dependency> ä¿®æ”¹è·å–RestTemplateçš„é…ç½®ç±»ï¼š @Configuration public class ApplicationContextConfig { @Bean //å¯ç”¨è´Ÿè½½å‡è¡¡ @LoadBalanced public RestTemplate getRestTemplate(){ return new RestTemplate(); } } ä¿®æ”¹controllerï¼Œæ›¿æ¢è¯·æ±‚çš„URLï¼š @RestController public class OrderController { //public static final String PAYMENT_URL = \"http://localhost:8001\"; //è¿™é‡Œçš„CLOUD-PAYMENT-SERVICEæ˜¯è¯·æ±‚çš„æœåŠ¡åœ¨eurekaä¸Šçš„åç§° public static final String PAYMENT_URL = \"http://CLOUD-PAYMENT-SERVICE\"; @Resource private RestTemplate restTemplate; @PostMapping(\"/consumer/payment\") public CommonResult&lt;Payment> create(Payment payment){ return restTemplate.postForObject(PAYMENT_URL+\"/payment\", payment,CommonResult.class); } @GetMapping(\"/consumer/payment/{id}\") public CommonResult&lt;Payment> getPayment(@PathVariable(\"id\") Long id){ return restTemplate.getForObject(PAYMENT_URL+\"/payment/\"+id,CommonResult.class); } } å¯ä»¥æµ‹è¯•è¯·æ±‚consumerçš„controllerï¼Œä¼šå‘ç°æ˜¯ç”±ä¸åŒçš„æœåŠ¡æä¾›æ–¹æœåŠ¡çš„ï¼Œå¹¶ä¸”æ˜¯äº¤æ›¿æœåŠ¡çš„ï¼ˆè½®è¯¢ï¼‰","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"},{"name":"Eureka","slug":"Eureka","permalink":"https://www.codetool.top/tags/Eureka/"}]},{"title":"SpringCloudæ¦‚è¿°å’Œå­¦ä¹ é¡¹ç›®é¢„æ­å»º","slug":"SpringCloudæ¦‚è¿°å’Œå­¦ä¹ é¡¹ç›®é¢„æ­å»º","date":"2020-03-20T05:02:43.000Z","updated":"2020-03-21T02:53:02.526Z","comments":true,"path":"article/SpringCloudæ¦‚è¿°å’Œå­¦ä¹ é¡¹ç›®é¢„æ­å»º/","link":"","permalink":"https://www.codetool.top/article/SpringCloud%E6%A6%82%E8%BF%B0%E5%92%8C%E5%AD%A6%E4%B9%A0%E9%A1%B9%E7%9B%AE%E9%A2%84%E6%90%AD%E5%BB%BA/","excerpt":"","text":"å‰è¨€ï¼šæœ‰å¹¸çœ‹åˆ°å°šç¡…è°·3æœˆåˆšå‘å¸ƒçš„ Spring Cloud æ•™å­¦è§†é¢‘ï¼Œä½¿ç”¨äº†spring cloudæœ€æ–°ç‰ˆæœ¬å’ŒæŠ€æœ¯ï¼Œè¯¥ç³»åˆ—ä¸ºçœ‹è¯¥æ•™å­¦è§†é¢‘è®°å½•çš„å­¦ä¹ ç¬”è®°ã€‚ è§†é¢‘åœ°å€ï¼šå°šç¡…è°·2020æœ€æ–°ç‰ˆSpringCloud(Hç‰ˆ&amp;alibaba)æ¡†æ¶å¼€å‘æ•™ç¨‹å…¨å¥—å®Œæ•´ç‰ˆä»å…¥é—¨åˆ°ç²¾é€š(å¤§ç‰›è®²æˆspring cloud)_å“”å“©å“”å“© (ã‚œ-ã‚œ)ã¤ãƒ­ å¹²æ¯~-bilibili 1 å¾®æœåŠ¡æ¦‚è¿°å¾®æœåŠ¡ä½“ç³»ç»“æ„çš„æ€æƒ³æå€¡å°†å¤§å‹è½¯ä»¶æ‹†åˆ†æˆä¸€ä¸ªä¸ªå¾®å°çš„æœåŠ¡,ç›¸å¯¹äºé¢å‘æœåŠ¡è½¯ä»¶æ¶æ„ï¼ˆSOAï¼‰æ‹†åˆ†ç²’åº¦æ›´å°,æœ€å¥½æ˜¯æ‹†åˆ†æˆåŸå­æ€§æœåŠ¡,å³ä¸å¯ä»¥å†ç»§ç»­æ‹†åˆ†,æœåŠ¡ä¹‹é—´çš„è€¦åˆåº¦æ›´ä½ã€‚ä¸åŒäºé¢å‘æœåŠ¡è½¯ä»¶æ¶æ„,å¾®æœåŠ¡æ¶æ„ä¸­æ²¡æœ‰ä¼ä¸šæœåŠ¡æ€»çº¿,æœåŠ¡çš„è°ƒç”¨æµç¨‹ä¸æ˜¯åœ¨æ€»çº¿ä¸­å›ºå®šé¡ºåº,å–è€Œä»£ä¹‹çš„æ˜¯ä¸€ç§ api ç½‘å…³çš„æ–¹å¼ç»Ÿä¸€ç¼–æ’å¾®æœåŠ¡,api ç½‘å…³ä¸è´Ÿè´£æœåŠ¡çš„è°ƒç”¨é¡ºåº,åªå¯¹å®¢æˆ·ç«¯ä¼ æ¥çš„è¯·æ±‚è¿›è¡Œè·¯ç”±,å¯¹ä¼—å¤šçš„å¾®æœåŠ¡æ¥å£è¿›è¡Œèšåˆã€‚ 2 Spring CloudSpring Cloud æ˜¯ä¸€ç³»åˆ—æ¡†æ¶çš„æœ‰åºé›†åˆã€‚å®ƒåˆ©ç”¨ Spring Boot çš„å¼€å‘ä¾¿åˆ©æ€§å·§å¦™åœ°ç®€åŒ–äº†åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€è®¾æ–½çš„å¼€å‘ï¼Œå¦‚æœåŠ¡å‘ç°æ³¨å†Œã€é…ç½®ä¸­å¿ƒã€æ¶ˆæ¯æ€»çº¿ã€è´Ÿè½½å‡è¡¡ã€æ–­è·¯å™¨ã€æ•°æ®ç›‘æ§ç­‰ï¼Œéƒ½å¯ä»¥ç”¨ Spring Boot çš„å¼€å‘é£æ ¼åšåˆ°ä¸€é”®å¯åŠ¨å’Œéƒ¨ç½²ã€‚Spring Cloud å¹¶æ²¡æœ‰é‡å¤åˆ¶é€ è½®å­ï¼Œå®ƒåªæ˜¯å°†å„å®¶å…¬å¸å¼€å‘çš„æ¯”è¾ƒæˆç†Ÿã€ç»å¾—èµ·å®é™…è€ƒéªŒçš„æœåŠ¡æ¡†æ¶ç»„åˆèµ·æ¥ï¼Œé€šè¿‡ Spring Boot é£æ ¼è¿›è¡Œå†å°è£…å±è”½æ‰äº†å¤æ‚çš„é…ç½®å’Œå®ç°åŸç†ï¼Œæœ€ç»ˆç»™å¼€å‘è€…ç•™å‡ºäº†ä¸€å¥—ç®€å•æ˜“æ‡‚ã€æ˜“éƒ¨ç½²å’Œæ˜“ç»´æŠ¤çš„åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘å·¥å…·åŒ…ã€‚ æœåŠ¡æ³¨å†Œä¸å‘ç° eureka-&gt;zookeeper/consul/nacos æœåŠ¡è°ƒç”¨ä¸è´Ÿè½½å‡è¡¡ ribbon/loadbalancer feign/openfeign æœåŠ¡ç†”æ–­&amp;&amp;é™çº§ hystrix -&gt; resilience4j/spring alibaba sentinel æœåŠ¡æ¶ˆæ¯é˜Ÿåˆ— é…ç½®ä¸­å¿ƒç®¡ç† spring cloud config/nacos æœåŠ¡ç½‘å…³ netflix oss zuul/spring cloud gateway æœåŠ¡ç›‘æ§ å…¨é“¾è·¯è¿½è¸ª è‡ªåŠ¨åŒ–æ„å»ºéƒ¨ç½² æœåŠ¡å®šæ—¶ä»»åŠ¡è°ƒåº¦æ“ä½œ 2.1 ç‰ˆæœ¬è¯´æ˜2.1.1 SpringBootSpringBootï¼šæˆªè‡³ 2020/03/19ï¼Œæœ€æ–°ç‰ˆæœ¬ 2.2.5 2.1.2 SpringCloudSpring Cloud é‡‡ç”¨äº†è‹±å›½ä¼¦æ•¦åœ°é“ç«™çš„åç§°æ¥å‘½åï¼Œå¹¶ç”±åœ°é“ç«™åç§°å­—æ¯ A-Z ä¾æ¬¡ç±»æ¨çš„å½¢å¼æ¥å‘å¸ƒè¿­ä»£ç‰ˆæœ¬ã€‚ SpringCloud æ˜¯ä¸€ä¸ªç”±è®¸å¤šå­é¡¹ç›®ç»„æˆçš„ç»¼åˆé¡¹ç›®ï¼Œå„å­é¡¹ç›®æœ‰ä¸åŒçš„å‘å¸ƒèŠ‚å¥ã€‚ä¸ºäº†ç®¡ SpringCloud ä¸å„å­é¡¹ç›®çš„ç‰ˆæœ¬ä¾èµ–å…³ç³»,å‘å¸ƒäº†ä¸€ä¸ªæ¸…å•ï¼Œå…¶ä¸­åŒ…æ‹¬äº†æŸä¸ª SpringCloud ç‰ˆæœ¬å¯¹åº”çš„å­é¡¹ç›®ç‰ˆæœ¬ã€‚ä¸ºäº†é¿å… SpringCloud ç‰ˆæœ¬å·ä¸å­é¡¹ç›®ç‰ˆæœ¬å·æ··æ·†ï¼ŒSpringCloud ç‰ˆæœ¬é‡‡ç”¨äº†åç§°è€Œéç‰ˆæœ¬å·çš„å‘½åï¼Œè¿™äº›ç‰ˆæœ¬çš„åå­—é‡‡ç”¨äº†ä¼¦æ•¦åœ°é“ç«™çš„åå­—,æ ¹æ®å­—æ¯è¡¨çš„é¡ºåºæ¥å¯¹åº”ç‰ˆæœ¬æ—¶é—´é¡ºåºã€‚ä¾‹å¦‚ Angel æ˜¯ç¬¬ä¸€ä¸ªç‰ˆæœ¬, Brixton æ˜¯ç¬¬äºŒä¸ªç‰ˆæœ¬ã€‚ æœ€æ–°ç‰ˆæœ¬æ˜¯ Hoxtonã€‚ SpringBoot å’Œ SpringCloud çš„ç‰ˆæœ¬å¯¹åº”å…³ç³»æŸ¥çœ‹ï¼š https://start.spring.io/actuator/info 2.1.3 é€‰ç”¨ç‰ˆæœ¬ æ¡†æ¶/è½¯ä»¶ ç‰ˆæœ¬ spring cloud Hoxton.SR1 spring boot 2.2.2. RELEASE spring cloud alibaba 2.1.0.RELEASE Java Java8 Maven 3.5 åŠä»¥ä¸Š Mysql 5.7 åŠä»¥ä¸Š 2.1.4 maven dependencyManagementçˆ¶ pom é€šå¸¸ä¼šä½¿ç”¨ dependencyManagement ç®¡ç†å­é¡¹ç›®çš„ç‰ˆæœ¬å· &lt;!--ç»Ÿä¸€ç®¡ç†jaråŒ…ç‰ˆæœ¬--> &lt;properties> &lt;project.build.sourceEncoding>UTF-8&lt;/project.build.sourceEncoding> &lt;maven.compiler.source>1.8&lt;/maven.compiler.source> &lt;maven.compiler.target>1.8&lt;/maven.compiler.target> &lt;junit.version>4.12&lt;/junit.version> &lt;log4j.version>1.2.17&lt;/log4j.version> &lt;lombok.version>1.16.18&lt;/lombok.version> &lt;mysql.version>8.0.19&lt;/mysql.version> &lt;druid.version>1.1.16&lt;/druid.version> &lt;druid.spring.boot.starter.version>1.1.10&lt;/druid.spring.boot.starter.version> &lt;spring.boot.version>2.2.2.RELEASE&lt;/spring.boot.version> &lt;spring.cloud.version>Hoxton.SR1&lt;/spring.cloud.version> &lt;spring.cloud.alibaba.version>2.1.0.RELEASE&lt;/spring.cloud.alibaba.version> &lt;mybatis.spring.boot.version>1.3.0&lt;/mybatis.spring.boot.version> &lt;/properties> &lt;!--å­æ¨¡å—ç»§æ‰¿å,æä¾›ä½œç”¨:é”å®šç‰ˆæœ¬+å­moduleä¸ç”¨groupIdå’Œversion--> &lt;dependencyManagement> &lt;dependencies> &lt;!--springboot 2.2.2--> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-dependencies&lt;/artifactId> &lt;version>${spring.boot.version}&lt;/version> &lt;type>pom&lt;/type> &lt;scope>import&lt;/scope> &lt;/dependency> &lt;!--Spring cloud Hoxton.SR1--> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-dependencies&lt;/artifactId> &lt;version>${spring.cloud.version}&lt;/version> &lt;type>pom&lt;/type> &lt;scope>import&lt;/scope> &lt;/dependency> &lt;!--Spring cloud alibaba 2.1.0.RELEASE--> &lt;dependency> &lt;groupId>com.alibaba.cloud&lt;/groupId> &lt;artifactId>spring-cloud-alibaba-dependencies&lt;/artifactId> &lt;version>${spring.cloud.alibaba.version}&lt;/version> &lt;type>pom&lt;/type> &lt;scope>import&lt;/scope> &lt;/dependency> &lt;dependency> &lt;groupId>mysql&lt;/groupId> &lt;artifactId>mysql-connector-java&lt;/artifactId> &lt;version>${mysql.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>com.alibaba&lt;/groupId> &lt;artifactId>druid&lt;/artifactId> &lt;version>${druid.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>com.alibaba&lt;/groupId> &lt;artifactId>druid-spring-boot-starter&lt;/artifactId> &lt;version>${druid.spring.boot.starter.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.mybatis.spring.boot&lt;/groupId> &lt;artifactId>mybatis-spring-boot-starter&lt;/artifactId> &lt;version>${mybatis.spring.boot.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;version>${lombok.version}&lt;/version> &lt;/dependency> &lt;/dependencies> &lt;/dependencyManagement> 3 ç¯å¢ƒé¢„æ­å»º-è®¢å•æ¨¡å—æ–°å»ºå­æ¨¡å—cloud-provider-payment8001 3.1 pom&lt;dependencies> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-web&lt;/artifactId> &lt;/dependency> &lt;!--ç›‘æ§--> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-actuator&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.mybatis.spring.boot&lt;/groupId> &lt;artifactId>mybatis-spring-boot-starter&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>com.alibaba&lt;/groupId> &lt;artifactId>druid-spring-boot-starter&lt;/artifactId> &lt;!--å¦‚æœæ²¡å†™ç‰ˆæœ¬,ä»çˆ¶å±‚é¢æ‰¾,æ‰¾åˆ°äº†å°±ç›´æ¥ç”¨,å…¨å±€ç»Ÿä¸€--> &lt;version>${druid.spring.boot.starter.version}&lt;/version> &lt;/dependency> &lt;!--mysql-connector-java--> &lt;dependency> &lt;groupId>mysql&lt;/groupId> &lt;artifactId>mysql-connector-java&lt;/artifactId> &lt;/dependency> &lt;!--jdbc--> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-jdbc&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-test&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;/dependency> &lt;/dependencies> å»ºè¡¨ï¼š create database cloud2020; use cloud2020; CREATE TABLE `payment` ( `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®', `serial` varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT 'æ”¯ä»˜æµæ°´å·', PRIMARY KEY (`id`) USING BTREE ) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT = 'æ”¯ä»˜è¡¨' ROW_FORMAT = Dynamic; 3.2 yamlé…ç½®server: port: 8001 spring: application: name: cloud-payment-service datasource: # å½“å‰æ•°æ®æºæ“ä½œç±»å‹ type: com.alibaba.druid.pool.DruidDataSource # mysqlé©±åŠ¨ç±» driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://localhost:3306/cloud2020?useUnicode=true&characterEncoding=UTF-8&useSSL=false username: root password: 123456 mybatis: mapperLocations: classpath*:mapper/*.xml type-aliases-package: com.rhett.springcloud.entities 3.3 ä¸šåŠ¡ç±»3.3.1 POJO@Data @AllArgsConstructor @NoArgsConstructor public class Payment implements Serializable { private Long id; private String serial; } ç»Ÿä¸€æ•°æ®å“åº”å®ä½“ç±»ï¼š /** * ä¸å‰ç«¯äº¤äº’çš„ç»Ÿä¸€æ•°æ®å“åº”æ¥å£ * @param &lt;T> */ @Data @AllArgsConstructor @NoArgsConstructor public class CommonResult&lt;T> { private Integer code; private String message; private T data; public CommonResult(Integer code,String message){ this(code,message,null); } } 3.3.2 Dao@Mapper public interface PaymentDao { public int create(Payment payment); public Payment getPaymentById(@Param(\"id\") Long id); } mapperæ–‡ä»¶ï¼š &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"> &lt;mapper namespace=\"com.rhett.springcloud.dao.PaymentDao\"> &lt;insert id=\"create\" parameterType=\"Payment\" useGeneratedKeys=\"true\" keyProperty=\"id\"> insert into payment(serial) values(#{serial}); &lt;/insert> &lt;resultMap id=\"BaseResultMap\" type=\"com.rhett.springcloud.entities.Payment\"> &lt;id column=\"id\" property=\"id\" jdbcType=\"BIGINT\"/> &lt;id column=\"serial\" property=\"serial\" jdbcType=\"VARCHAR\"/> &lt;/resultMap> &lt;select id=\"getPaymentById\" parameterType=\"Long\" resultMap=\"BaseResultMap\"> select * from payment where id=#{id}; &lt;/select> &lt;/mapper> 3.3.3 serviceæ¥å£ï¼š public interface PaymentService { public int create(Payment payment); public Payment getPaymentById(Long id); } å®ç°ï¼š @Service public class PaymentServiceImpl implements PaymentService { @Resource private PaymentDao paymentDao; @Override public int create(Payment payment) { return paymentDao.create(payment); } @Override public Payment getPaymentById(Long id) { return paymentDao.getPaymentById(id); } } 3.3.4 controller@RestController @Slf4j public class PaymentController { @Resource private PaymentService paymentService; @PostMapping(value = \"/payment\") public CommonResult create(Payment payment){ int result = paymentService.create(payment); log.info(\"****æ’å…¥ç»“æœï¼š\"+result); if(result>0){ return new CommonResult(200,\"æ’å…¥æ•°æ®åº“æˆåŠŸ\",result); }else { return new CommonResult(500,\"æ’å…¥æ•°æ®åº“å¤±è´¥\"); } } @GetMapping(value = \"/payment/{id}\") public CommonResult&lt;Payment> getPaymentById(@PathVariable(\"id\") Long id){ Payment payment = paymentService.getPaymentById(id); log.info(\"****æ’å…¥ç»“æœï¼š\"+payment); if(payment!=null){ return new CommonResult(200,\"æŸ¥è¯¢æˆåŠŸ\",payment); }else { return new CommonResult(500,\"æ²¡æœ‰å¯¹åº”è®°å½•ï¼ŒæŸ¥è¯¢IDï¼š\"+id); } } } 3.4 çƒ­éƒ¨ç½²é…ç½®æ·»åŠ ä¾èµ–ï¼š &lt;!--çƒ­éƒ¨ç½²--> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-devtools&lt;/artifactId> &lt;scope>runtime&lt;/scope> &lt;optional>true&lt;/optional> &lt;/dependency> åœ¨IDEAè®¾ç½®=&gt;Compilerï¼Œå‹¾ä¸Šå¦‚ä¸‹å›¾é…ç½® å¿«æ·é”®CTRL+SHIFT+ALT+/é€‰æ‹©registryï¼Œå‹¾ä¸Šå¦‚ä¸‹å›¾é…ç½® 4 ç¯å¢ƒé¢„æ­å»º-æ¶ˆè´¹è€…è®¢å•æ¨¡å—å°†å³å°†ç”¨åˆ°çš„æ¨¡å—ä¸­çš„å…¬å…±ä¸šåŠ¡ç±»æŠ½å–åˆ°ä¸€ä¸ªæ–°çš„æ¨¡å—cloud-api-commonsï¼Œä½¿ç”¨ä¾èµ–å¼•å…¥ï¼š æ–°å»ºæ¨¡å—cloud-consumer-order80 4.1 pom&lt;dependencies> &lt;dependency> &lt;groupId>com.rhett&lt;/groupId> &lt;artifactId>cloud-api-commons&lt;/artifactId> &lt;version>${project.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-web&lt;/artifactId> &lt;/dependency> &lt;!--ç›‘æ§--> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-actuator&lt;/artifactId> &lt;/dependency> &lt;!--çƒ­éƒ¨ç½²--> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-devtools&lt;/artifactId> &lt;scope>runtime&lt;/scope> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-test&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;/dependency> &lt;/dependencies> 4.2 yamlé…ç½®server: port: 80 4.3 é…ç½®ç±»@Configuration public class ApplicationContextConfig { @Bean public RestTemplate getRestTemplate(){ return new RestTemplate(); } } 4.4 controller@RestController public class OrderController { public static final String PAYMENT_URL = \"http://localhost:8001\"; @Resource private RestTemplate restTemplate; @PostMapping(\"/consumer/payment\") public CommonResult&lt;Payment> create(Payment payment){ return restTemplate.postForObject(PAYMENT_URL+\"/payment\", payment,CommonResult.class); } @GetMapping(\"/consumer/payment/{id}\") public CommonResult&lt;Payment> getPayment(@PathVariable(\"id\") Long id){ return restTemplate.getForObject(PAYMENT_URL+\"/payment/\"+id,CommonResult.class); } } æœ€åçš„é¡¹ç›®ç»“æ„ï¼š è¿™æ ·ä¸€ä¸ªç®€å•çš„å¾®æœåŠ¡æ¨¡å—å°±æ„å»ºå®Œæˆäº†ï¼Œåé¢è¦å­¦çš„eurekaä¼šåŸºäºè¯¥é¡¹ç›®ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"}]},{"title":"å‰‘æŒ‡offer40-æœ€å°çš„kä¸ªæ•°","slug":"å‰‘æŒ‡offer40-æœ€å°çš„kä¸ªæ•°","date":"2020-03-20T00:32:37.000Z","updated":"2020-03-20T00:34:31.746Z","comments":true,"path":"article/å‰‘æŒ‡offer40-æœ€å°çš„kä¸ªæ•°/","link":"","permalink":"https://www.codetool.top/article/%E5%89%91%E6%8C%87offer40-%E6%9C%80%E5%B0%8F%E7%9A%84k%E4%B8%AA%E6%95%B0/","excerpt":"","text":"1 åŸé¢˜ï¼ˆæ¥æºLeetcodeï¼‰è¾“å…¥æ•´æ•°æ•°ç»„ arr ï¼Œæ‰¾å‡ºå…¶ä¸­æœ€å°çš„ k ä¸ªæ•°ã€‚ä¾‹å¦‚ï¼Œè¾“å…¥4ã€5ã€1ã€6ã€2ã€7ã€3ã€8è¿™8ä¸ªæ•°å­—ï¼Œåˆ™æœ€å°çš„4ä¸ªæ•°å­—æ˜¯1ã€2ã€3ã€4ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥: arr = [3,2,1], k = 2è¾“å‡º: [1,2] æˆ–è€… [2,1] ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼š arr = [0,1,2,1], k = 1è¾“å‡ºï¼š [0] é™åˆ¶ï¼š 0 &lt;= k &lt;= arr.length &lt;= 10000 0 &lt;= arr[i] &lt;= 10000 2 è§£æ³•2.1 æ€æƒ³å †æˆ–è€…åŸºäºå¿«æ’çš„partitionæ€æƒ³ 2.2 ä»£ç class Solution { public int[] getLeastNumbers(int[] arr, int k) { Queue&lt;Integer> queue = new PriorityQueue&lt;>(); for(int i:arr) queue.offer(i); int[] ans = new int[k]; for(int i = 0;i&lt;k;i++) ans[i] = queue.poll(); return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"å‰‘æŒ‡offer","slug":"å‰‘æŒ‡offer","permalink":"https://www.codetool.top/tags/%E5%89%91%E6%8C%87offer/"}]},{"title":"Javaä¸­SPIæœºåˆ¶ä»‹ç»å’Œæºç åˆ†æ","slug":"Javaä¸­SPIæœºåˆ¶ä»‹ç»å’Œæºç åˆ†æ","date":"2020-03-19T13:56:47.000Z","updated":"2020-03-19T13:57:12.527Z","comments":true,"path":"article/Javaä¸­SPIæœºåˆ¶ä»‹ç»å’Œæºç åˆ†æ/","link":"","permalink":"https://www.codetool.top/article/Java%E4%B8%ADSPI%E6%9C%BA%E5%88%B6%E4%BB%8B%E7%BB%8D%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š é«˜çº§å¼€å‘å¿…é¡»ç†è§£çš„Javaä¸­SPIæœºåˆ¶ - ç®€ä¹¦ 1 ä»€ä¹ˆæ˜¯SPISPIå…¨ç§°ä¸ºService Provider Interfaceï¼Œæ˜¯ä¸€ç§æœåŠ¡å‘ç°æœºåˆ¶ã€‚SPI çš„æœ¬è´¨æ˜¯å°†æ¥å£å®ç°ç±»çš„å…¨é™å®šåé…ç½®åœ¨æ–‡ä»¶ä¸­ï¼Œå¹¶ç”±æœåŠ¡åŠ è½½å™¨è¯»å–é…ç½®æ–‡ä»¶,åŠ è½½å®ç°ç±»ã€‚è¿™æ ·å¯ä»¥åœ¨è¿è¡Œæ—¶ï¼ŒåŠ¨æ€ä¸ºæ¥å£æ›¿æ¢å®ç°ç±»ã€‚æ­£å› æ­¤ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„é€šè¿‡SPIæœºåˆ¶ä¸ºæˆ‘ä»¬çš„ç¨‹åºæä¾›æ‹“å±•åŠŸèƒ½ã€‚ åº”ç”¨åœºæ™¯ï¼š æ•°æ®åº“é©±åŠ¨åŠ è½½æ¥å£å®ç°ç±»çš„åŠ è½½JDBCåŠ è½½ä¸åŒç±»å‹æ•°æ®åº“çš„é©±åŠ¨ æ—¥å¿—é—¨é¢æ¥å£å®ç°ç±»åŠ è½½SLF4JåŠ è½½ä¸åŒæä¾›å•†çš„æ—¥å¿—å®ç°ç±» SpringSpringä¸­å¤§é‡ä½¿ç”¨äº†SPI,æ¯”å¦‚ï¼šå¯¹servlet3.0è§„èŒƒå¯¹ServletContainerInitializerçš„å®ç°ã€è‡ªåŠ¨ç±»å‹è½¬æ¢Type Conversion SPI(Converter SPIã€Formatter SPI)ç­‰ DubboDubboä¸­ä¹Ÿå¤§é‡ä½¿ç”¨SPIçš„æ–¹å¼å®ç°æ¡†æ¶çš„æ‰©å±•, ä¸è¿‡å®ƒå¯¹Javaæä¾›çš„åŸç”ŸSPIåšäº†å°è£…ï¼Œå…è®¸ç”¨æˆ·æ‰©å±•å®ç°Filteræ¥å£ 2 Javaä¸­çš„SPI2.1 ç”¨æ³•è¦ä½¿ç”¨Java SPIï¼Œéœ€è¦éµå¾ªå¦‚ä¸‹çº¦å®šï¼š å½“æœåŠ¡æä¾›è€…æä¾›äº†æ¥å£çš„ä¸€ç§å…·ä½“å®ç°åï¼Œåœ¨jaråŒ…çš„META-INF/servicesç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªä»¥â€œæ¥å£å…¨é™å®šåâ€ä¸ºå‘½åçš„æ–‡ä»¶ï¼Œå†…å®¹ä¸ºå®ç°ç±»çš„å…¨é™å®šå æ¥å£å®ç°ç±»æ‰€åœ¨çš„jaråŒ…æ”¾åœ¨ä¸»ç¨‹åºçš„classpathä¸­ ä¸»ç¨‹åºé€šè¿‡java.util.ServiceLoaderåŠ¨æ€è£…è½½å®ç°æ¨¡å—ï¼Œå®ƒé€šè¿‡æ‰«æMETA-INF/services ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶æ‰¾åˆ°å®ç°ç±»çš„å…¨é™å®šåï¼ŒæŠŠç±»åŠ è½½åˆ°JVM SPIçš„å®ç°ç±»å¿…é¡»æºå¸¦ä¸€ä¸ªä¸å¸¦å‚æ•°çš„æ„é€ æ–¹æ³• 2.2 ç¤ºä¾‹åˆ›å»ºæ¥å£Markableå’Œå®ç°ç±»RedMark,BlackMarkï¼Œç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š public interface Markable { void mark(); } public class RedMark implements Markable { public void mark() { System.out.println(\"çº¢è‰²æ ‡è®°\"); } } public class BlackMark implements Markable { public void mark() { System.out.println(\"é»‘è‰²æ ‡è®°\"); } } åœ¨resourcesä¸‹é¢å»ºç«‹æ–‡ä»¶å¤¹/META-INF/services/ï¼Œæ·»åŠ æ–‡ä»¶com.rhett.service.Markableï¼Œå†…å®¹ä¸º com.rhett.service.impl.BlackMark com.rhett.service.impl.RedMarkè¿›è¡Œæµ‹è¯•ï¼š public class SpiTest { public static void main(String[] args) { ServiceLoader&lt;Markable> serviceLoader = ServiceLoader.load(Markable.class); Iterator&lt;Markable> iterator = serviceLoader.iterator(); while (iterator.hasNext()){ Markable markable = iterator.next(); markable.mark(); } } } 2.3 æºç åˆ†æloadæµç¨‹ï¼š public static &lt;S> ServiceLoader&lt;S> load(Class&lt;S> service) { ClassLoader cl = Thread.currentThread().getContextClassLoader();//è·å¾—å½“å‰ç±»åŠ è½½å™¨ return ServiceLoader.load(service, cl); } public static &lt;S> ServiceLoader&lt;S> load(Class&lt;S> service, ClassLoader loader) { return new ServiceLoader&lt;>(service, loader); } ServiceLoaderç±»ï¼š public final class ServiceLoader&lt;S> implements Iterable&lt;S> { private static final String PREFIX = \"META-INF/services/\"; // ä»£è¡¨ä¼ å…¥çš„æ¥å£ private final Class&lt;S> service; // ç”¨äºå®šä½ã€åŠ è½½å’Œåˆå§‹åŒ–å®ç°ç±» private final ClassLoader loader; // è®¿é—®æƒé™ä¸Šä¸‹æ–‡ private final AccessControlContext acc; // ç¼“å­˜æä¾›å™¨ private LinkedHashMap&lt;String,S> providers = new LinkedHashMap&lt;>(); // å½“å‰çš„æ‡’æŸ¥è¯¢çš„è¿­ä»£å™¨ private LazyIterator lookupIterator; //... } private ServiceLoader(Class&lt;S> svc, ClassLoader cl) { //ä¼ å…¥çš„æ¥å£ä¸ä¸ºç©º service = Objects.requireNonNull(svc, \"Service interface cannot be null\"); //å¦‚æœç±»åŠ è½½å™¨ä¸ºnullé»˜è®¤ä½¿ç”¨åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ loader = (cl == null) ? ClassLoader.getSystemClassLoader() : cl; //accï¼šAccessControlContextï¼Œè®¿é—®æƒé™ç›¸å…³ acc = (System.getSecurityManager() != null) ? AccessController.getContext() : null; //è·Ÿè¿› reload(); } public void reload() { //æ¸…ç©ºç¼“å­˜è¡¨ providers.clear(); //å®ä¾‹åŒ–ä¸€ä¸ªLazyIterator lookupIterator = new LazyIterator(service, loader); } //å°†æ¥å£ã€loaderèµ‹å€¼ç»™è¿­ä»£å™¨ä¸­çš„æˆå‘˜å˜é‡ private LazyIterator(Class&lt;S> service, ClassLoader loader) { this.service = service; this.loader = loader; } LazyIteratorç±»ï¼š private class LazyIterator implements Iterator&lt;S> { Class&lt;S> service; ClassLoader loader; Enumeration&lt;URL> configs = null; Iterator&lt;String> pending = null; String nextName = null; //... } è·å–iteratoræ–¹æ³•ï¼š public Iterator&lt;S> iterator() { return new Iterator&lt;S>() { Iterator&lt;Map.Entry&lt;String,S>> knownProviders = providers.entrySet().iterator(); public boolean hasNext() {= if (knownProviders.hasNext()) return true; return lookupIterator.hasNext(); } public S next() { //å¦‚æœç¼“å­˜è¡¨ä¸­æœ‰ï¼Œä»ç¼“å­˜è¡¨ï¼ˆhashmapï¼‰ä¸­å– if (knownProviders.hasNext()) return knownProviders.next().getValue(); //å¦åˆ™ä½¿ç”¨æ‡’æŸ¥è¯¢è¿­ä»£å™¨çš„nextæ–¹æ³• return lookupIterator.next(); } public void remove() { throw new UnsupportedOperationException(); } }; } lookupIteratorçš„nextï¼š public S next() { //ä¹‹å‰èµ‹å€¼è¿‡çš„è®¿é—®æƒé™ä¸Šä¸‹æ–‡ if (acc == null) { return nextService(); } else { PrivilegedAction&lt;S> action = new PrivilegedAction&lt;S>() { public S run() { return nextService(); } }; return AccessController.doPrivileged(action, acc); } } private S nextService() { //æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªæœåŠ¡ï¼Œå¦‚æœæœ‰è¿™é‡Œå°±è·å–äº†nextName if (!hasNextService()) throw new NoSuchElementException(); //cnå¾—åˆ°äº†ä¸‹ä¸€ä¸ªè¦åŠ è½½çš„å®ç°ç±»å…¨é™å®šå String cn = nextName; nextName = null; Class&lt;?> c = null; try { //ä½¿ç”¨Class.forNameå³é€šè¿‡åå°„ä½¿ç”¨ç±»åŠ è½½å™¨åŠ è½½ç±»ï¼Œèµ‹å€¼ç»™äº†ç±»ä¸­çš„cå˜é‡ c = Class.forName(cn, false, loader); } catch (ClassNotFoundException x) { fail(service, \"Provider \" + cn + \" not found\"); } if (!service.isAssignableFrom(c)) { fail(service, \"Provider \" + cn + \" not a subtype\"); } try { //å°†Cè½¬æ¢ä¸ºæŒ‡å®šç±»å‹çš„å¯¹è±¡ S p = service.cast(c.newInstance()); //å¹¶æ”¾å…¥äº†ç¼“å­˜è¡¨ providers.put(cn, p); return p; } catch (Throwable x) { fail(service, \"Provider \" + cn + \" could not be instantiated\", x); } throw new Error(); // This cannot happen } è·å–ä¸‹ä¸€ä¸ªè¦åŠ è½½çš„å®ç°ç±»å…¨é™å®šåçš„æ–¹æ³•ï¼š private boolean hasNextService() { //å¦‚æœnextNameä¸ä¸ºç©º if (nextName != null) { return true; } //configsä¸ºç©ºï¼Œå³è¿˜æ²¡æœ‰è¯»å–è¿‡èµ„æº if (configs == null) { try { // PREFIXå°±æ˜¯/META-INF/resourcesï¼Œæ‹¼æ¥æ¥å£çš„å…¨é™å®šå String fullName = PREFIX + service.getName(); //åŠ è½½æ–‡ä»¶èµ„æºï¼Œä¼šè¿”å›ä¸€ä¸ªEnumeration&lt;URL>å¯¹è±¡ if (loader == null) configs = ClassLoader.getSystemResources(fullName); else configs = loader.getResources(fullName); } catch (IOException x) { fail(service, \"Error locating configuration files\", x); } } //ç»™pendingèµ‹å€¼ï¼Œpendingæ˜¯ä¸€ä¸ªIterator&lt;String>ï¼Œè¿™é‡Œå°±æ˜¯å®ç°ç±»å…¨é™å®šåçš„è¿­ä»£å™¨ while ((pending == null) || !pending.hasNext()) { if (!configs.hasMoreElements()) { return false; } pending = parse(service, configs.nextElement()); } // å°†nextNameè®¾ç½®ä¸ºè¿­ä»£å™¨ä¸­çš„ä¸‹ä¸€ä¸ªç±»å…¨é™å®šå nextName = pending.next(); return true; } 2.4 åŸç”ŸSPIçš„ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ï¼š ä½¿ç”¨Java SPIæœºåˆ¶çš„ä¼˜åŠ¿æ˜¯å®ç°è§£è€¦ï¼Œä½¿å¾—ç¬¬ä¸‰æ–¹æœåŠ¡æ¨¡å—çš„è£…é…æ§åˆ¶çš„é€»è¾‘ä¸è°ƒç”¨è€…çš„ä¸šåŠ¡ä»£ç åˆ†ç¦»ï¼Œè€Œä¸æ˜¯è€¦åˆåœ¨ä¸€èµ·ã€‚åº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®å®é™…ä¸šåŠ¡æƒ…å†µå¯ç”¨æ¡†æ¶æ‰©å±•æˆ–æ›¿æ¢æ¡†æ¶ç»„ä»¶ã€‚ å¹¶ä¸”å› ä¸ºå®ƒä¼šåŠ è½½jaråŒ…ä¸­èµ„æºçš„ç‰¹ç‚¹ï¼Œå¯ä»¥åŠ¨æ€æ‰©å……æ¥å£çš„å®ç°ç±»ï¼Œå¹¶ä½¿å¾—æºæ¡†æ¶ä¸å¿…å…³å¿ƒæ¥å£çš„å®ç°ç±»çš„è·¯å¾„ã€‚ ç¼ºç‚¹ï¼š è·å–æœºåˆ¶ä¸å¤Ÿçµæ´»ï¼š è™½ç„¶ServiceLoaderä¹Ÿç®—æ˜¯ä½¿ç”¨çš„å»¶è¿ŸåŠ è½½ï¼Œä½†æ˜¯åŸºæœ¬åªèƒ½é€šè¿‡Iteratorè·å–ï¼Œè€Œåœ¨è¿­ä»£å™¨ä¸­ï¼Œæ¯æ¬¡è°ƒç”¨nextæ–¹æ³•éƒ½ä¼šå¯¹å¾—åˆ°çš„å®ç°ç±»å…¨é™å®šåè¿›è¡ŒåŠ è½½ï¼Œä¹Ÿå°±æ˜¯æ¥å£çš„å®ç°ç±»ä¼šå…¨éƒ¨åŠ è½½å¹¶å®ä¾‹åŒ–ä¸€éã€‚å¦‚æœä½ å¹¶ä¸æƒ³ç”¨æŸäº›å®ç°ç±»ï¼Œå®ƒä¹Ÿä¼šè¢«åŠ è½½å¹¶å®ä¾‹åŒ–äº†ï¼Œè¿™å°±é€ æˆäº†æµªè´¹ã€‚ å¤šä¸ªå¹¶å‘å¤šçº¿ç¨‹ä½¿ç”¨ServiceLoaderç±»çš„å®ä¾‹æ˜¯ä¸å®‰å…¨çš„ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jdk","slug":"jdk","permalink":"https://www.codetool.top/tags/jdk/"},{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://www.codetool.top/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"}]},{"title":"Dubboé«˜å¯ç”¨ä¹‹é›†ç¾¤å®¹é”™","slug":"Dubboé›†ç¾¤å®¹é”™","date":"2020-03-19T12:55:49.000Z","updated":"2020-03-19T12:56:34.068Z","comments":true,"path":"article/Dubboé›†ç¾¤å®¹é”™/","link":"","permalink":"https://www.codetool.top/article/Dubbo%E9%9B%86%E7%BE%A4%E5%AE%B9%E9%94%99/","excerpt":"","text":"å„èŠ‚ç‚¹å…³ç³»ï¼š è¿™é‡Œçš„ Invoker æ˜¯ Provider çš„ä¸€ä¸ªå¯è°ƒç”¨ Service çš„æŠ½è±¡ï¼ŒInvoker å°è£…äº†Provider åœ°å€åŠ Service æ¥å£ä¿¡æ¯ Directory ä»£è¡¨å¤šä¸ª Invoker ï¼Œå¯ä»¥æŠŠå®ƒçœ‹æˆ List ï¼Œä½†ä¸ List ä¸åŒçš„æ˜¯ï¼Œå®ƒçš„å€¼å¯èƒ½æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œæ¯”å¦‚æ³¨å†Œä¸­å¿ƒæ¨é€å˜æ›´ Clusterï¼ˆé›†ç¾¤ï¼‰ å°† Directory ä¸­çš„å¤šä¸ª Invoker ä¼ªè£…æˆä¸€ä¸ª Invoker ï¼Œå¯¹ä¸Šå±‚é€æ˜ï¼Œä¼ªè£…è¿‡ç¨‹åŒ…å«äº†å®¹é”™é€»è¾‘ï¼Œè°ƒç”¨å¤±è´¥åï¼Œé‡è¯•å¦ä¸€ä¸ªï¼ˆé›†ç¾¤å®¹é”™ï¼‰ Router (æœåŠ¡è·¯ç”±) è´Ÿè´£ä»å¤šä¸ª Invoker ä¸­æŒ‰è·¯ç”±è§„åˆ™é€‰å‡ºå­é›†ï¼Œæ¯”å¦‚è¯»å†™åˆ†ç¦»ï¼Œåº”ç”¨éš”ç¦»ç­‰ LoadBalance ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰è´Ÿè´£ä»å¤šä¸ª Invoker ä¸­é€‰å‡ºå…·ä½“çš„ä¸€ä¸ªç”¨äºæœ¬æ¬¡è°ƒç”¨ï¼Œé€‰çš„è¿‡ç¨‹åŒ…å«äº†è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œè°ƒç”¨å¤±è´¥åï¼Œéœ€è¦é‡é€‰ 1 æœåŠ¡è·¯ç”±æœåŠ¡è·¯ç”±åŒ…å«ä¸€æ¡è·¯ç”±è§„åˆ™ï¼Œè·¯ç”±è§„åˆ™å†³å®šäº†æœåŠ¡æ¶ˆè´¹è€…çš„è°ƒç”¨ç›®æ ‡ï¼Œå³è§„å®šäº†æœåŠ¡æ¶ˆè´¹è€…å¯è°ƒç”¨å“ªäº›æœåŠ¡æä¾›è€…ï¼Œdubboæä¾›ä¸‰ç§æœåŠ¡è·¯ç”±å®ç°ï¼Œåˆ†åˆ«ä¸ºæ¡ä»¶è·¯ç”±ConditionRouterã€è„šæœ¬è·¯ç”±ScriptRouterã€æ ‡ç­¾è·¯ç”±TagRouterï¼Œè¿™é‡Œé‡ç‚¹åˆ†ææ¡ä»¶è·¯ç”± æ¡ä»¶è·¯ç”±è§„åˆ™çš„æ ¼å¼ï¼š [æœåŠ¡æ¶ˆè´¹è€…åŒ¹é…æ¡ä»¶] =&gt; [æœåŠ¡æä¾›è€…åŒ¹é…æ¡ä»¶] host = 10.20.153.10 =&gt; host = 10.20.153.11 è¯¥æ¡è§„åˆ™è¡¨ç¤º IP ä¸º 10.20.153.10 çš„æœåŠ¡æ¶ˆè´¹è€…åªå¯è°ƒç”¨ IP ä¸º 10.20.153.11 æœºå™¨ä¸Šçš„æœåŠ¡ï¼Œä¸å¯è°ƒç”¨å…¶ä»–æœºå™¨ä¸Šçš„æœåŠ¡ã€‚ å¦‚æœæœåŠ¡æ¶ˆè´¹è€…åŒ¹é…æ¡ä»¶ä¸ºç©ºï¼Œè¡¨ç¤ºä¸å¯¹æœåŠ¡æ¶ˆè´¹è€…è¿›è¡Œé™åˆ¶ã€‚å¦‚æœæœåŠ¡æä¾›è€…åŒ¹é…æ¡ä»¶ä¸ºç©ºï¼Œè¡¨ç¤ºå¯¹æŸäº›æœåŠ¡æ¶ˆè´¹è€…ç¦ç”¨æœåŠ¡ å¸¸è§è·¯ç”±é…ç½®ï¼š ç™½åå•ï¼š host!=10.20.153.10,10.20.153.11=&gt; é»‘åå• host=10.20.153.10,10.20.153.11=&gt; è¯»å†™åˆ†ç¦» method=find,list,get,is=&gt;host=172.22.3.94,172.22.3.95,172.22.3.96 method!=find,list,get,is=&gt;host=172.22.3.97,172.22.3.98 å‰åå°åˆ†ç¦» application=front=&gt;host=172.22.3.91,172.22.3.92,172.22.3.93 application!=front=&gt;host=172.22.3.94,172.22.3.95,172.22.3.96 2 é›†ç¾¤å®¹é”™ Failover Cluster å¤±è´¥è‡ªåŠ¨åˆ‡æ¢ï¼Œå½“å‡ºç°å¤±è´¥ï¼Œé‡è¯•å…¶å®ƒæœåŠ¡å™¨ã€‚(ç¼ºçœ) é€šå¸¸ç”¨äºè¯»æ“ä½œï¼Œä½†é‡è¯•ä¼šå¸¦æ¥æ›´é•¿å»¶è¿Ÿã€‚å¯é€šè¿‡ retries=â€2â€ æ¥è®¾ç½®é‡è¯•æ¬¡æ•°(ä¸å«ç¬¬ä¸€æ¬¡)ã€‚ é‡è¯•æ¬¡æ•°é…ç½®å¦‚ä¸‹ï¼š &lt;dubbo:service retries=&quot;2&quot; /&gt;æˆ–&lt;dubbo:reference retries=&quot;2&quot; /&gt; Failfast Cluster å¿«é€Ÿå¤±è´¥ï¼Œåªå‘èµ·ä¸€æ¬¡è°ƒç”¨ï¼Œå¤±è´¥ç«‹å³æŠ¥é”™ã€‚é€šå¸¸ç”¨äºéå¹‚ç­‰æ€§çš„å†™æ“ä½œï¼Œæ¯”å¦‚æ–°å¢è®°å½•ã€‚ Failsafe Cluster å¤±è´¥å®‰å…¨ï¼Œå‡ºç°å¼‚å¸¸æ—¶ï¼Œç›´æ¥å¿½ç•¥ã€‚é€šå¸¸ç”¨äºå†™å…¥æ—¥å¿—ç­‰æ“ä½œã€‚ Failback Cluster å¤±è´¥è‡ªåŠ¨æ¢å¤ï¼Œåå°è®°å½•å¤±è´¥è¯·æ±‚ï¼Œå®šæ—¶é‡å‘ã€‚ é€šå¸¸ç”¨äºæ¶ˆæ¯é€šçŸ¥æ“ä½œã€‚ Forking Cluster å¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡å™¨ï¼Œåªè¦ä¸€ä¸ªæˆåŠŸå³è¿”å›ã€‚é€šå¸¸ç”¨äºå®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„è¯»æ“ä½œï¼Œä½†éœ€è¦æµªè´¹æ›´å¤šæœåŠ¡èµ„æºã€‚å¯é€šè¿‡forks=&quot;2&quot;æ¥è®¾ç½®æœ€å¤§å¹¶è¡Œæ•°ã€‚ Broadcast Cluster å¹¿æ’­è°ƒç”¨æ‰€æœ‰æä¾›è€…,é€ä¸ªè°ƒç”¨ï¼Œä»»æ„ä¸€å°æŠ¥é”™åˆ™æŠ¥é”™ã€‚é€šå¸¸ç”¨äºé€šçŸ¥æ‰€æœ‰æä¾›è€…æ›´æ–°ç¼“å­˜æˆ–æ—¥å¿—ç­‰æœ¬åœ°èµ„æºä¿¡æ¯ã€‚ 3 è´Ÿè½½å‡è¡¡3.1 Random LoadBalanceéšæœºï¼ŒæŒ‰æƒé‡è®¾ç½®éšæœºæ¦‚ç‡ã€‚ åœ¨ä¸€ä¸ªæˆªé¢ä¸Šç¢°æ’çš„æ¦‚ç‡é«˜ï¼Œä½†è°ƒç”¨é‡è¶Šå¤§åˆ†å¸ƒè¶Šå‡åŒ€ï¼Œè€Œä¸”æŒ‰æ¦‚ç‡ä½¿ç”¨æƒé‡åä¹Ÿæ¯”è¾ƒå‡åŒ€ï¼Œæœ‰åˆ©äºåŠ¨æ€è°ƒæ•´æä¾›è€…æƒé‡ã€‚ 3.2 RoundRobin LoadBalanceè½®å¾ªï¼ŒæŒ‰å…¬çº¦åçš„æƒé‡è®¾ç½®è½®å¾ªæ¯”ç‡ã€‚ å­˜åœ¨æ…¢çš„æä¾›è€…ç´¯ç§¯è¯·æ±‚çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼šç¬¬äºŒå°æœºå™¨å¾ˆæ…¢ï¼Œä½†æ²¡æŒ‚ï¼Œå½“è¯·æ±‚è°ƒåˆ°ç¬¬äºŒå°æ—¶å°±å¡åœ¨é‚£ï¼Œä¹…è€Œä¹…ä¹‹ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å¡åœ¨è°ƒåˆ°ç¬¬äºŒå°ä¸Šã€‚ 3.3 LeastActive LoadBalanceæœ€å°‘æ´»è·ƒè°ƒç”¨æ•°ï¼Œç›¸åŒæ´»è·ƒæ•°çš„éšæœºï¼Œæ´»è·ƒæ•°æŒ‡è°ƒç”¨å‰åè®¡æ•°å·®ã€‚ ä½¿æ…¢çš„æä¾›è€…æ”¶åˆ°æ›´å°‘è¯·æ±‚ï¼Œå› ä¸ºè¶Šæ…¢çš„æä¾›è€…çš„è°ƒç”¨å‰åè®¡æ•°å·®ä¼šè¶Šå¤§ã€‚ æ¯ä¸ªæœåŠ¡ç»´æŠ¤ä¸€ä¸ªæ´»è·ƒæ•°è®¡æ•°å™¨ã€‚å½“ A æœºå™¨å¼€å§‹å¤„ç†è¯·æ±‚ï¼Œè¯¥è®¡æ•°å™¨åŠ  1ï¼Œæ­¤æ—¶ A è¿˜æœªå¤„ç†å®Œæˆã€‚è‹¥å¤„ç†å®Œæ¯•åˆ™è®¡æ•°å™¨å‡ 1ã€‚è€Œ B æœºå™¨æ¥å—åˆ°è¯·æ±‚åå¾ˆå¿«å¤„ç†å®Œæ¯•ã€‚é‚£ä¹ˆ A,B çš„æ´»è·ƒæ•°åˆ†åˆ«æ˜¯ 1ï¼Œ0ã€‚å½“åˆäº§ç”Ÿäº†ä¸€ä¸ªæ–°çš„è¯·æ±‚ï¼Œåˆ™é€‰æ‹© B æœºå™¨å»æ‰§è¡Œ(B æ´»è·ƒæ•°æœ€å°)ï¼Œè¿™æ ·ä½¿æ…¢çš„æœºå™¨ A æ”¶åˆ°å°‘çš„è¯·æ±‚ã€‚ 3.4 ConsistentHash LoadBalanceä¸€è‡´æ€§ Hashï¼Œç›¸åŒå‚æ•°çš„è¯·æ±‚æ€»æ˜¯å‘åˆ°åŒä¸€æä¾›è€…ã€‚ å½“æŸä¸€å°æä¾›è€…æŒ‚æ—¶ï¼ŒåŸæœ¬å‘å¾€è¯¥æä¾›è€…çš„è¯·æ±‚ï¼ŒåŸºäºè™šæ‹ŸèŠ‚ç‚¹ï¼Œå¹³æ‘Šåˆ°å…¶å®ƒæä¾›è€…ï¼Œä¸ä¼šå¼•èµ·å‰§çƒˆå˜åŠ¨ã€‚ ç®—æ³•å‚è§ï¼šhttp://en.wikipedia.org/wiki/Consistent_hashing ç¼ºçœåªå¯¹ç¬¬ä¸€ä¸ªå‚æ•° Hashï¼Œå¦‚æœè¦ä¿®æ”¹ï¼Œè¯·é…ç½® &lt;dubbo:parameter key=&quot;hash.arguments&quot; value=&quot;0,1&quot; /&gt; ç¼ºçœç”¨ 160 ä»½è™šæ‹ŸèŠ‚ç‚¹ï¼Œå¦‚æœè¦ä¿®æ”¹ï¼Œè¯·é…ç½® &lt;dubbo:parameter key=&quot;hash.nodes&quot; value=&quot;320&quot; /&gt;","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Dubbo","slug":"Dubbo","permalink":"https://www.codetool.top/tags/Dubbo/"},{"name":"RPC","slug":"RPC","permalink":"https://www.codetool.top/tags/RPC/"}]},{"title":"Dubboæ¦‚è¿°å’ŒåŸºæœ¬ä½¿ç”¨","slug":"Dubboæ¦‚è¿°å’ŒåŸºæœ¬ä½¿ç”¨","date":"2020-03-19T12:12:21.000Z","updated":"2020-03-19T12:13:34.736Z","comments":true,"path":"article/Dubboæ¦‚è¿°å’ŒåŸºæœ¬ä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/Dubbo%E6%A6%82%E8%BF%B0%E5%92%8C%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 Dubboæ¦‚è¿°åœ¨å¤§è§„æ¨¡æœåŠ¡åŒ–ä¹‹å‰ï¼Œåº”ç”¨å¯èƒ½åªæ˜¯é€šè¿‡RMIæˆ–Hessianç­‰å·¥å…·ï¼Œç®€å•çš„æš´éœ²å’Œå¼•ç”¨è¿œç¨‹æœåŠ¡ï¼Œé€šè¿‡é…ç½®æœåŠ¡çš„URLåœ°å€è¿›è¡Œè°ƒç”¨ï¼Œé€šè¿‡F5ç­‰ç¡¬ä»¶è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚ å½“æœåŠ¡è¶Šæ¥è¶Šå¤šæ—¶ï¼ŒæœåŠ¡URLé…ç½®ç®¡ç†å˜å¾—éå¸¸å›°éš¾ï¼ŒF5ç¡¬ä»¶è´Ÿè½½å‡è¡¡å™¨çš„å•ç‚¹å‹åŠ›ä¹Ÿè¶Šæ¥è¶Šå¤§ã€‚æ­¤æ—¶éœ€è¦ä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ŒåŠ¨æ€çš„æ³¨å†Œå’Œå‘ç°æœåŠ¡ï¼Œä½¿æœåŠ¡çš„ä½ç½®é€æ˜ã€‚å¹¶é€šè¿‡åœ¨æ¶ˆè´¹æ–¹è·å–æœåŠ¡æä¾›æ–¹åœ°å€åˆ—è¡¨ï¼Œå®ç°è½¯è´Ÿè½½å‡è¡¡å’ŒFailoverï¼ˆå¤±æ•ˆè½¬ç§»ï¼‰ï¼Œé™ä½å¯¹F5ç¡¬ä»¶è´Ÿè½½å‡è¡¡å™¨çš„ä¾èµ–ï¼Œä¹Ÿèƒ½å‡å°‘éƒ¨åˆ†æˆæœ¬ã€‚ å½“è¿›ä¸€æ­¥å‘å±•ï¼ŒæœåŠ¡é—´ä¾èµ–å…³ç³»å˜å¾—é”™è¸ªå¤æ‚ï¼Œç”šè‡³åˆ†ä¸æ¸…å“ªä¸ªåº”ç”¨è¦åœ¨å“ªä¸ªåº”ç”¨ä¹‹å‰å¯åŠ¨ï¼Œæ¶æ„å¸ˆéƒ½ä¸èƒ½å®Œæ•´çš„æè¿°åº”ç”¨çš„æ¶æ„å…³ç³»ã€‚è¿™æ—¶ï¼Œéœ€è¦è‡ªåŠ¨ç”»å‡ºåº”ç”¨é—´çš„ä¾èµ–å…³ç³»å›¾ï¼Œä»¥å¸®åŠ©æ¶æ„å¸ˆç†æ¸…ç†å…³ç³»ã€‚ æ¥ç€ï¼ŒæœåŠ¡çš„è°ƒç”¨é‡è¶Šæ¥è¶Šå¤§ï¼ŒæœåŠ¡çš„å®¹é‡é—®é¢˜å°±æš´éœ²å‡ºæ¥ï¼Œè¿™ä¸ªæœåŠ¡éœ€è¦å¤šå°‘æœºå™¨æ”¯æ’‘ï¼Ÿä»€ä¹ˆæ—¶å€™è¯¥åŠ æœºå™¨ï¼Ÿä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œç¬¬ä¸€æ­¥ï¼Œè¦å°†æœåŠ¡ç°åœ¨æ¯å¤©çš„è°ƒç”¨é‡ï¼Œå“åº”æ—¶é—´ï¼Œéƒ½ç»Ÿè®¡å‡ºæ¥ï¼Œä½œä¸ºå®¹é‡è§„åˆ’çš„å‚è€ƒæŒ‡æ ‡ã€‚å…¶æ¬¡ï¼Œè¦å¯ä»¥åŠ¨æ€è°ƒæ•´æƒé‡ï¼Œåœ¨çº¿ä¸Šï¼Œå°†æŸå°æœºå™¨çš„æƒé‡ä¸€ç›´åŠ å¤§ï¼Œå¹¶åœ¨åŠ å¤§çš„è¿‡ç¨‹ä¸­è®°å½•å“åº”æ—¶é—´çš„å˜åŒ–ï¼Œç›´åˆ°å“åº”æ—¶é—´åˆ°è¾¾é˜€å€¼ï¼Œè®°å½•æ­¤æ—¶çš„è®¿é—®é‡ï¼Œå†ä»¥æ­¤è®¿é—®é‡ä¹˜ä»¥æœºå™¨æ•°åæ¨æ€»å®¹é‡ã€‚ ä»¥ä¸Šæ˜¯Dubboæœ€åŸºæœ¬çš„å‡ ä¸ªéœ€æ±‚ã€‚ Apache Dubboæ˜¯ä¸€æ¬¾é«˜æ€§èƒ½çš„Java RPCæ¡†æ¶ã€‚å…¶å‰èº«æ˜¯é˜¿é‡Œå·´å·´å…¬å¸å¼€æºçš„ä¸€ä¸ªé«˜æ€§èƒ½ã€è½»é‡çº§çš„å¼€æºJava RPCæ¡†æ¶ï¼Œå¯ä»¥å’ŒSpringæ¡†æ¶æ— ç¼é›†æˆã€‚ Dubboæä¾›äº†ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›ï¼šé¢å‘æ¥å£çš„è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œæ™ºèƒ½å®¹é”™å’Œè´Ÿè½½å‡è¡¡ï¼Œä»¥åŠæœåŠ¡è‡ªåŠ¨æ³¨å†Œå’Œå‘ç°ã€‚ 2 Dubboæ¶æ„ èŠ‚ç‚¹ è§’è‰²è¯´æ˜ Provider æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹ Consumer è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹ Registry æœåŠ¡æ³¨å†Œä¸å‘ç°çš„æ³¨å†Œä¸­å¿ƒ Monitor ç»Ÿè®¡æœåŠ¡çš„è°ƒç”¨æ¬¡è°ƒå’Œè°ƒç”¨æ—¶é—´çš„ç›‘æ§ä¸­å¿ƒ Container æœåŠ¡è¿è¡Œå®¹å™¨ è°ƒç”¨å…³ç³»è¯´æ˜ æœåŠ¡å®¹å™¨è´Ÿè´£å¯åŠ¨ï¼ŒåŠ è½½ï¼Œè¿è¡ŒæœåŠ¡æä¾›è€…ã€‚ æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚ æœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚ æ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…ã€‚ æœåŠ¡æ¶ˆè´¹è€…ï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚ æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒã€‚ 3 dubbo3.1 dubbo-adminçš„å®‰è£…dubbo-adminä¸‹è½½ï¼š https://github.com/apache/dubbo-admin æ„å»ºï¼šï¼ˆæ„å»ºå‰è¦æŠŠæ³¨å†Œä¸­å¿ƒå³zookeeperæ‰“å¼€ï¼‰ åœ¨ dubbo-admin-server/src/main/resources/application.propertiesä¸­æŒ‡å®šæ³¨å†Œä¸­å¿ƒåœ°å€ æ„å»º mvn clean package å¯åŠ¨ mvn --projects dubbo-admin-server spring-boot:run æˆ–è€… cd dubbo-admin-distribution/target; java -jar dubbo-admin-0.1.jar è®¿é—® http://localhost:8080 3.2 dubboçš„ä½¿ç”¨å»ºè®®ä½¿ç”¨ä¸€ä¸ªé¡¹ç›®ä¸“é—¨å­˜æ”¾apiæ¥å£ç›¸å…³ï¼Œå…¶ä»–é¡¹ç›®å…¨éƒ¨ä¾èµ–äºè¿™ä¸ªé¡¹ç›®ï¼Œè¯¥é¡¹ç›®çš„ä¾èµ–ï¼š &lt;dependency> &lt;groupId>org.apache.dubbo&lt;/groupId> &lt;artifactId>dubbo&lt;/artifactId> &lt;version>2.7.5&lt;/version> &lt;/dependency> &lt;!-- æ³¨å†Œä¸­å¿ƒä½¿ç”¨çš„zookeeperï¼Œå¼•å…¥å®¢æˆ·ç«¯--> &lt;dependency> &lt;groupId>org.apache.curator&lt;/groupId> &lt;artifactId>curator-framework&lt;/artifactId> &lt;version>4.0.0&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.apache.curator&lt;/groupId> &lt;artifactId>curator-recipes&lt;/artifactId> &lt;version>4.0.0&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>io.netty&lt;/groupId> &lt;artifactId>netty-all&lt;/artifactId> &lt;version>4.1.32.Final&lt;/version> &lt;/dependency> æä¾›ä¸€ä¸ªæ¥å£ï¼š public interface UserService { String sayHello(String name); } å¦å»ºä¸€ä¸ªé¡¹ç›®ä½œä¸ºæœåŠ¡çš„providerï¼Œå®ç°æ¥å£ï¼š public class UserServiceImpl implements UserService { public String sayHello(String name) { return name+\"è°ƒç”¨äº†sayHelloæœåŠ¡\"; } } providerä¸­æ·»åŠ åŸºäºspringçš„dubboé…ç½®ï¼š &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:dubbo=\"http://dubbo.apache.org/schema/dubbo\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd\"> &lt;!-- æä¾›æ–¹åº”ç”¨ä¿¡æ¯ï¼Œç”¨äºè®¡ç®—ä¾èµ–å…³ç³» --> &lt;dubbo:application name=\"user-service-provider\" /> &lt;!-- ä½¿ç”¨zookeeperæ³¨å†Œä¸­å¿ƒæš´éœ²æœåŠ¡åœ°å€ --> &lt;dubbo:registry address=\"zookeeper://127.0.0.1:2181\" /> &lt;!-- æˆ– &lt;dubbo:registry protocol=\"zookeeper\" address=\"127.0.0.1:2181\" /> --> &lt;!-- ç”¨dubboåè®®åœ¨20880ç«¯å£æš´éœ²æœåŠ¡ nameæŒ‡åè®® --> &lt;dubbo:protocol name=\"dubbo\" port=\"20880\" /> &lt;!-- å£°æ˜éœ€è¦æš´éœ²çš„æœåŠ¡æ¥å£ refå†™å®ç°--> &lt;dubbo:service interface=\"com.rhett.service.UserService\" ref=\"demoService\" /> &lt;!-- å’Œæœ¬åœ°beanä¸€æ ·å®ç°æœåŠ¡ --> &lt;bean id=\"demoService\" class=\"com.rhett.service.impl.UserServiceImpl\" /> &lt;/beans> providerå¯åŠ¨ï¼š public class Server { public static void main(String[] args) throws IOException { ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"provider.xml\"); context.start(); System.in.read(); } } consumeré…ç½®ï¼š &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:dubbo=\"http://dubbo.apache.org/schema/dubbo\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd\"> &lt;!-- æ¶ˆè´¹æ–¹åº”ç”¨åï¼Œç”¨äºè®¡ç®—ä¾èµ–å…³ç³»ï¼Œä¸æ˜¯åŒ¹é…æ¡ä»¶ï¼Œä¸è¦ä¸æä¾›æ–¹ä¸€æ · --> &lt;dubbo:application name=\"user-service-consumer\" /> &lt;!-- ä½¿ç”¨zookeeperæ³¨å†Œä¸­å¿ƒæš´éœ²å‘ç°æœåŠ¡åœ°å€ --> &lt;dubbo:registry address=\"zookeeper://127.0.0.1:2181\" client=\"curator\"/> &lt;!-- ç”Ÿæˆè¿œç¨‹æœåŠ¡ä»£ç†ï¼Œå¯ä»¥å’Œæœ¬åœ°beanä¸€æ ·ä½¿ç”¨demoService --> &lt;dubbo:reference id=\"userService\" interface=\"com.rhett.service.UserService\" /> &lt;/beans> consumerè°ƒç”¨ï¼š @Test public void testUserService(){ ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"consumer.xml\"); context.start(); UserService userService = (UserService) context.getBean(\"userService\"); String h = userService.sayHello(\"æœåŠ¡ç«¯\"); System.out.println(h); } æŸ¥çœ‹è¾“å‡ºï¼š æœåŠ¡ç«¯è°ƒç”¨äº†sayHelloæœåŠ¡3.3 æ•´åˆSpringBootä½¿ç”¨mavenä¾èµ–ï¼š &lt;dependency> &lt;groupId>org.apache.dubbo&lt;/groupId> &lt;artifactId>dubbo-spring-boot-starter&lt;/artifactId> &lt;version>2.7.5&lt;/version> &lt;/dependency> æœåŠ¡æä¾›æ–¹é…ç½®ï¼š dubbo.application.name=user-service-provider dubbo.registry.address=zookeeper://127.0.0.1:2181 dubbo.protocol.name=dubbo dubbo.protocol.port=20880 æœåŠ¡è°ƒç”¨æ–¹é…ç½®ï¼š dubbo.application.name=boot-user-service-consumer dubbo.registry.address=zookeeper://127.0.0.1:2181 åœ¨é…ç½®ç±»ä¸­ä½¿ç”¨@EnableDubboå¼€å¯Dubboæ³¨è§£åŠŸèƒ½ åœ¨æœåŠ¡æä¾›æ–¹ä½¿ç”¨@org.apache.dubbo.config.annotation.Serviceæ³¨è§£æ ‡æ³¨è¦æš´éœ²çš„æœåŠ¡ åœ¨æœåŠ¡è°ƒç”¨æ–¹ä½¿ç”¨@org.apache.dubbo.config.annotation.Referenceæ³¨è§£æ¥æ ‡æ³¨è¦ä½¿ç”¨çš„çš„æœåŠ¡ 3.4 å…¶ä»–Dubboçš„é…ç½®æ”¯æŒå¤šç§æ¥æºï¼š JVM System Propertiesï¼Œ-Då‚æ•° Externalized Configurationï¼Œå¤–éƒ¨åŒ–é…ç½® ServiceConfigã€ReferenceConfigç­‰ç¼–ç¨‹æ¥å£é‡‡é›†çš„é…ç½® æœ¬åœ°é…ç½®æ–‡ä»¶dubbo.properties åŠ è½½ä¼˜å…ˆé¡ºåºç”±é«˜åˆ°ä½ æ›´å¤šé«˜çº§ç”¨æ³•è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttp://dubbo.apache.org/zh-cn/docs/user/quick-start.html","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Dubbo","slug":"Dubbo","permalink":"https://www.codetool.top/tags/Dubbo/"},{"name":"RPC","slug":"RPC","permalink":"https://www.codetool.top/tags/RPC/"}]},{"title":"RPCæ¡†æ¶çš„è®¤è¯†å’Œä½¿ç”¨Nettyå®ç°ç®€æ˜“RPC","slug":"RPCæ¡†æ¶çš„è®¤è¯†å’Œä½¿ç”¨Nettyå®ç°ç®€æ˜“RPC","date":"2020-03-19T05:47:37.000Z","updated":"2020-03-19T05:49:38.842Z","comments":true,"path":"article/RPCæ¡†æ¶çš„è®¤è¯†å’Œä½¿ç”¨Nettyå®ç°ç®€æ˜“RPC/","link":"","permalink":"https://www.codetool.top/article/RPC%E6%A1%86%E6%9E%B6%E7%9A%84%E8%AE%A4%E8%AF%86%E5%92%8C%E4%BD%BF%E7%94%A8Netty%E5%AE%9E%E7%8E%B0%E7%AE%80%E6%98%93RPC/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š è°èƒ½ç”¨é€šä¿—çš„è¯­è¨€è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯RPCæ¡†æ¶ï¼Ÿ - é©¬ç§‰å°§çš„å›ç­” 1 ä»€ä¹ˆæ˜¯RPC ç®€å•çš„è¯´ï¼ŒRPCå°±æ˜¯ä»ä¸€å°æœºå™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰ä¸Šé€šè¿‡å‚æ•°ä¼ é€’çš„æ–¹å¼è°ƒç”¨å¦ä¸€å°æœºå™¨ï¼ˆæœåŠ¡å™¨ï¼‰ä¸Šçš„ä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•ï¼ˆå¯ä»¥ç»Ÿç§°ä¸ºæœåŠ¡ï¼‰å¹¶å¾—åˆ°è¿”å›çš„ç»“æœã€‚ RPC ä¼šéšè—åº•å±‚çš„é€šè®¯ç»†èŠ‚ï¼ˆä¸éœ€è¦ç›´æ¥å¤„ç†Socketé€šè®¯æˆ–Httpé€šè®¯ï¼‰ RPC æ˜¯ä¸€ä¸ªè¯·æ±‚å“åº”æ¨¡å‹ã€‚å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›å“åº”ï¼ˆç±»ä¼¼äºHttpçš„å·¥ä½œæ–¹å¼ï¼‰ RPC åœ¨ä½¿ç”¨å½¢å¼ä¸Šåƒè°ƒç”¨æœ¬åœ°å‡½æ•°ï¼ˆæˆ–æ–¹æ³•ï¼‰ä¸€æ ·å»è°ƒç”¨è¿œç¨‹çš„å‡½æ•°ï¼ˆæˆ–æ–¹æ³•ï¼‰ã€‚ RPCå¯ä»¥ç›´æ¥å»ºç«‹åœ¨tcpä¹‹ä¸Šï¼Œå¦‚dubboï¼›ä¹Ÿå¯ä»¥å»ºç«‹åœ¨httpåè®®ä¹‹ä¸Šï¼Œå¦‚gRPCï¼ŒHessianã€‚ å¸¸ç”¨çš„RPCæ¡†æ¶æœ‰ï¼ŒDubboã€gRPCã€rpcxã€thrift 2 ä¸€äº›RPCæ¡†æ¶çš„ä½¿ç”¨2.1 RMIRMI(remote method invocation)æ˜¯javaåŸç”Ÿæ”¯æŒçš„è¿œç¨‹è°ƒç”¨ï¼ŒRMIé‡‡ç”¨JRMPï¼ˆJava RemoteMessageing Protocolï¼‰ä½œä¸ºé€šä¿¡åè®®ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯çº¯javaç‰ˆæœ¬çš„åˆ†å¸ƒå¼è¿œç¨‹è°ƒç”¨è§£å†³æ–¹æ¡ˆã€‚ 2.1.1 RMIçš„æ ¸å¿ƒæ¦‚å¿µClientã€Serverã€æ³¨å†Œä¸­å¿ƒ 2.1.2 RMIåŸºæœ¬ä½¿ç”¨æœåŠ¡ç«¯æ¥å£å’Œå®ç°ç±»ï¼š public interface UserService extends Remote { public String sayHello(String name) throws RemoteException; } public class UserServiceImpl extends UnicastRemoteObject implements UserService { public UserServiceImpl() throws RemoteException { } public String sayHello(String name) throws RemoteException { return name+\"æˆåŠŸè°ƒç”¨äº†æœåŠ¡ç«¯çš„æœåŠ¡\"; } } æœåŠ¡ç«¯å¯åŠ¨ï¼š public class ServerMain { public static void main(String[] args) throws Exception { //1. å¯åŠ¨RMIæ³¨å†ŒæœåŠ¡ï¼ŒæŒ‡å®šç«¯å£å· LocateRegistry.createRegistry(8888); //2. åˆ›å»ºè¦è¢«è®¿é—®çš„è¿œç¨‹å¯¹è±¡çš„å®ä¾‹ UserService userService = new UserServiceImpl(); //3. æŠŠè¿œç¨‹å¯¹è±¡å®ä¾‹æ³¨å†Œåˆ°RMIæ³¨å†ŒæœåŠ¡å™¨ä¸Š Naming.bind(\"rmi://localhost:8888/UserService\",userService); System.out.println(\"æœåŠ¡ç«¯å¯åŠ¨ä¸­......\"); } } å®¢æˆ·ç«¯å¤åˆ¶ä¸€ä¸ªUserServiceæ¥å£ï¼Œä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è°ƒç”¨ï¼š public class clientMain { public static void main(String[] args) throws RemoteException, NotBoundException, MalformedURLException { UserService userService = (UserService) Naming.lookup(\"rmi://localhost:8888/UserService\"); String s = userService.sayHello(\"å®¢æˆ·ç«¯\"); System.out.println(s); } } 2.2 HessianåŸºæœ¬ä½¿ç”¨Hessianä½¿ç”¨C/Sæ–¹å¼ï¼ŒåŸºäºHTTPåè®®ä¼ è¾“ï¼Œä½¿ç”¨HessianäºŒè¿›åˆ¶åºåˆ—åŒ– å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ·»åŠ hessianä¾èµ– &lt;dependencies> &lt;dependency> &lt;groupId>com.caucho&lt;/groupId> &lt;artifactId>hessian&lt;/artifactId> &lt;version>4.0.63&lt;/version> &lt;/dependency> &lt;/dependencies> æœåŠ¡ç«¯æ·»åŠ webappç¯å¢ƒï¼Œéƒ¨ç½²è‡³tomcat &lt;build> &lt;plugins> &lt;plugin> &lt;groupId>org.apache.tomcat.maven&lt;/groupId> &lt;artifactId>tomcat7-maven-plugin&lt;/artifactId> &lt;version>2.2&lt;/version> &lt;configuration> &lt;port>8888&lt;/port> &lt;path>/&lt;/path> &lt;uriEncoding>UTF-8&lt;/uriEncoding> &lt;/configuration> &lt;/plugin> &lt;/plugins> &lt;/build> æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ·»åŠ æ¥å£UserService public interface UserService { public String sayHello(String name); } æœåŠ¡ç«¯æ·»åŠ å®ç° public class UserServiceImpl implements UserService { public String sayHello(String name) { return name+\"è°ƒç”¨äº†hessianæœåŠ¡ç«¯çš„æœåŠ¡\"; } } æœåŠ¡ç«¯åœ¨web.xmlä¸­é…ç½®servletï¼š &lt;servlet> &lt;servlet-name>HessianServlet&lt;/servlet-name> &lt;servlet-class>com.caucho.hessian.server.HessianServlet&lt;/servlet-class> &lt;init-param> &lt;param-name>service-class&lt;/param-name> &lt;param-value>com.rhett.service.impl.UserServiceImpl&lt;/param-value> &lt;/init-param> &lt;/servlet> &lt;servlet-mapping> &lt;servlet-name>HessianServlet&lt;/servlet-name> &lt;url-pattern>/api/service&lt;/url-pattern> &lt;/servlet-mapping> å¯åŠ¨æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è°ƒç”¨æœåŠ¡ç«¯æœåŠ¡ï¼š public class ClientTest { public static void main(String[] args) throws MalformedURLException { String url = \"http://localhost:8888/api/service\"; HessianProxyFactory hessianProxyFactory = new HessianProxyFactory(); UserService userService = (UserService) hessianProxyFactory.create(UserService.class, url); String h = userService.sayHello(\"hessianå®¢æˆ·ç«¯\"); System.out.println(h); } } 3 ä½¿ç”¨Nettyå®ç°ç®€æ˜“RPC å°±æ˜¯è¦å®ç°ä¸Šå›¾è¿™äº›æ­¥éª¤ æœåŠ¡æ¶ˆè´¹æ–¹(client)ä»¥æœ¬åœ°è°ƒç”¨æ–¹å¼è°ƒç”¨æœåŠ¡ client stubæ¥æ”¶åˆ°è°ƒç”¨åè´Ÿè´£å°†æ–¹æ³•ã€å‚æ•°ç­‰å°è£…æˆèƒ½å¤Ÿè¿›è¡Œç½‘ç»œä¼ è¾“çš„æ¶ˆæ¯ä½“ sockets å°†æ¶ˆæ¯è¿›è¡Œç¼–ç å¹¶å‘é€åˆ°æœåŠ¡ç«¯ serverstubæ”¶åˆ°æ¶ˆæ¯åè¿›è¡Œè§£ç  serverstubæ ¹æ®è§£ç ç»“æœè°ƒç”¨æœ¬åœ°çš„æœåŠ¡ æœ¬åœ°æœåŠ¡æ‰§è¡Œå¹¶å°†ç»“æœè¿”å›ç»™server stub server stubå°†è¿”å›å¯¼å…¥ç»“æœå°è£…æˆæ¶ˆæ¯ä½“ sockets è¿›è¡Œç¼–ç å¹¶å‘é€è‡³æ¶ˆè´¹æ–¹ client stubæ¥æ”¶åˆ°æ¶ˆæ¯å¹¶è¿›è¡Œè§£ç  æœåŠ¡æ¶ˆè´¹æ–¹(client)å¾—åˆ°ç»“æœ æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„å…¬ç”¨æ¥å£ï¼š public interface UserService { String sayHello(String name); } æœåŠ¡ç«¯æœåŠ¡å®ç°ï¼š public class UserServiceImpl implements UserService { public String sayHello(String name) { return name+\"è°ƒç”¨è‡ªå®šä¹‰rpcæ¡†æ¶æœåŠ¡æˆåŠŸäº†\"; } } æœåŠ¡ç«¯ï¼š public class NettyServer { //ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œå®Œæˆå¯¹NettyServerçš„åˆå§‹åŒ–å’Œå¯åŠ¨ public static void startServer(String host,int port){ NioEventLoopGroup bossGroup = new NioEventLoopGroup(1); NioEventLoopGroup workerGroup = new NioEventLoopGroup(); try { ServerBootstrap serverBootstrap = new ServerBootstrap(); serverBootstrap.group(bossGroup,workerGroup) .channel(NioServerSocketChannel.class) .childHandler(new ChannelInitializer&lt;SocketChannel>() { protected void initChannel(SocketChannel ch) throws Exception { ChannelPipeline pipeline = ch.pipeline(); pipeline.addLast(new StringDecoder()); pipeline.addLast(new StringEncoder());//ç¼–è§£ç å™¨ pipeline.addLast(new NettyServerHandler()); } }); ChannelFuture channelFuture = serverBootstrap.bind(host, port).sync(); System.out.println(\"æœåŠ¡æä¾›æ–¹å¼€å§‹æä¾›æœåŠ¡...\"); channelFuture.channel().closeFuture().sync(); }catch (Exception e){ e.printStackTrace(); }finally { bossGroup.shutdownGracefully(); workerGroup.shutdownGracefully(); } } } handlerï¼š public class NettyServerHandler extends ChannelInboundHandlerAdapter { @Override public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception { //è·å–å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼Œå¹¶è°ƒç”¨æœåŠ¡ System.out.println(\"msg=\" + msg); //å®¢æˆ·ç«¯åœ¨è°ƒç”¨æœåŠ¡å™¨çš„apiæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªåè®® //æ¯”å¦‚è¦æ±‚å®¢æˆ·ç«¯æ¯æ¬¡å‘æ¶ˆæ¯æ—¶éƒ½å¿…é¡»ä»¥æŸä¸ªå­—ç¬¦ä¸²å¼€å¤´\"UserService#sayHello#xxx\" if(msg.toString().startsWith(\"UserService#sayHello#\")){ String result = new UserServiceImpl().sayHello(msg.toString().substring(msg.toString().lastIndexOf(\"#\") + 1)); ctx.writeAndFlush(result); } } @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception { ctx.close(); } } æœåŠ¡ç«¯å¯åŠ¨ï¼š //å¯åŠ¨ä¸€ä¸ªæœåŠ¡çš„æä¾›è€…ï¼Œå°±æ˜¯NettyServer public class RPCServer { public static void main(String[] args) { NettyServer.startServer(\"localhost\",7000); } } å®¢æˆ·ç«¯ï¼š public class NettyClient { private static ExecutorService executor = Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors()); private static NettyClientHandler clientHandler; public Object getBean(final Class&lt;?> serviceClass,final String providerName){ return Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(),new Class&lt;?>[]{serviceClass}, (proxy,method,args)->{ if(clientHandler == null){ initClient(); } //è®¾ç½®è¦å‘ç»™æœåŠ¡ç«¯çš„ä¿¡æ¯ clientHandler.setMsg(providerName+args[0]); return executor.submit(clientHandler).get(); }); } //åˆå§‹åŒ–å®¢æˆ·ç«¯ private static void initClient(){ clientHandler = new NettyClientHandler(); //åˆ›å»ºEventLoopGroup NioEventLoopGroup group = new NioEventLoopGroup(); Bootstrap bootstrap = new Bootstrap(); bootstrap.group(group) .channel(NioSocketChannel.class) .option(ChannelOption.TCP_NODELAY,true) .handler(new ChannelInitializer&lt;SocketChannel>() { protected void initChannel(SocketChannel ch) throws Exception { ChannelPipeline pipeline = ch.pipeline(); pipeline.addLast(new StringDecoder()); pipeline.addLast(new StringEncoder()); pipeline.addLast(clientHandler); } }); try { ChannelFuture future = bootstrap.connect(\"localhost\", 7000).sync(); } catch (InterruptedException e) { e.printStackTrace(); } } } handlerï¼š public class NettyClientHandler extends ChannelInboundHandlerAdapter implements Callable { private ChannelHandlerContext context; private String result;//è¿”å›çš„ç»“æœ private String msg;//å®¢æˆ·ç«¯è°ƒç”¨æ–¹æ³•ä¼ å…¥çš„ä¿¡æ¯ void setMsg(String msg){ this.msg = msg; } @Override public void channelActive(ChannelHandlerContext ctx) throws Exception { context = ctx; } @Override public synchronized void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception { result = msg.toString(); notify(); } @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception { ctx.close(); } //è¢«ä»£ç†å¯¹è±¡è°ƒç”¨ï¼Œå‘é€æ•°æ®ç»™æœåŠ¡å™¨ï¼Œç­‰å¾…è¢«å”¤é†’è¿”å›ç»“æœ public synchronized Object call() throws Exception { context.writeAndFlush(msg); wait(); return result; } } å®¢æˆ·ç«¯è°ƒç”¨ï¼š public class RPCClient { public static final String providerName = \"UserService#sayHello#\"; public static void main(String[] args) { //åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€… NettyClient nettyClient = new NettyClient(); //åˆ›å»ºä»£ç†å¯¹è±¡ UserService userService = (UserService) nettyClient.getBean(UserService.class, providerName); String msg = userService.sayHello(\"å®¢æˆ·ç«¯\"); System.out.println(msg); } } æŸ¥çœ‹è¾“å‡ºï¼š å®¢æˆ·ç«¯è°ƒç”¨è‡ªå®šä¹‰rpcæ¡†æ¶æœåŠ¡æˆåŠŸäº†","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"RPC","slug":"RPC","permalink":"https://www.codetool.top/tags/RPC/"},{"name":"Netty","slug":"Netty","permalink":"https://www.codetool.top/tags/Netty/"}]},{"title":"leetcode409-æœ€é•¿å›æ–‡ä¸²","slug":"leetcode409-æœ€é•¿å›æ–‡ä¸²","date":"2020-03-19T00:33:34.000Z","updated":"2020-03-19T01:20:06.449Z","comments":true,"path":"article/leetcode409-æœ€é•¿å›æ–‡ä¸²/","link":"","permalink":"https://www.codetool.top/article/leetcode409-%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E4%B8%B2/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªåŒ…å«å¤§å†™å­—æ¯å’Œå°å†™å­—æ¯çš„å­—ç¬¦ä¸²ï¼Œæ‰¾åˆ°é€šè¿‡è¿™äº›å­—æ¯æ„é€ æˆçš„æœ€é•¿çš„å›æ–‡ä¸²ã€‚ åœ¨æ„é€ è¿‡ç¨‹ä¸­ï¼Œè¯·æ³¨æ„åŒºåˆ†å¤§å°å†™ã€‚æ¯”å¦‚ &quot;Aa&quot; ä¸èƒ½å½“åšä¸€ä¸ªå›æ–‡å­—ç¬¦ä¸²ã€‚ æ³¨æ„:å‡è®¾å­—ç¬¦ä¸²çš„é•¿åº¦ä¸ä¼šè¶…è¿‡ 1010ã€‚ ç¤ºä¾‹ 1: è¾“å…¥:â€œabccccddâ€ è¾“å‡º:7 è§£é‡Š:æˆ‘ä»¬å¯ä»¥æ„é€ çš„æœ€é•¿çš„å›æ–‡ä¸²æ˜¯â€dccaccdâ€, å®ƒçš„é•¿åº¦æ˜¯ 7ã€‚ 2 è§£æ³•2.1 æ€æƒ³ä¸€ä¸ªå›æ–‡æ•°æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªå¥‡æ•°ä¸ªæ•°çš„æ•°å­—ï¼Œå¯ä»¥æœ‰ä»»æ„å¤šå¶æ•°ä¸ªæ•°çš„æ•°å­—ï¼Œå…ˆå°†æ‰€æœ‰å­—æ¯çš„ä¸ªæ•°ç»Ÿè®¡å‡ºæ¥ï¼Œä¿ç•™æ‰€æœ‰å¶æ•°ä¸ªæ•°çš„å­—æ¯ï¼Œå¥‡æ•°ä¸ªæ•°æœ€å¤šçš„å­—æ¯å…¨éƒ¨ä¿ç•™ï¼Œå…¶ä»–å¥‡æ•°ä¸ªçš„å­—æ¯å»æ‰ä¸€ä¸ªä¿ç•™å¶æ•°ä¸ªã€‚ 2.2 ä»£ç class Solution { public int longestPalindrome(String s) { int[] count = new int[52]; for(char i:s.toCharArray()){ if(i&lt;'a') count[i-'A'] ++; else count[i-'a'+26] ++; } int ans = 0; int decr = 0; for(int i = 0;i&lt;52;i++){ if(count[i]%2 == 0) ans+=count[i]; else { ans+=count[i]-decr; decr = 1; } } return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"Zookeeperåº”ç”¨åœºæ™¯å’Œå„ç§åˆ†å¸ƒå¼é”çš„å®ç°","slug":"Zookeeperåº”ç”¨åœºæ™¯å’Œå„ç§åˆ†å¸ƒå¼é”çš„å®ç°","date":"2020-03-18T11:34:41.000Z","updated":"2020-03-18T11:48:55.523Z","comments":true,"path":"article/Zookeeperåº”ç”¨åœºæ™¯å’Œå„ç§åˆ†å¸ƒå¼é”çš„å®ç°/","link":"","permalink":"https://www.codetool.top/article/Zookeeper%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E5%92%8C%E5%90%84%E7%A7%8D%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B0/","excerpt":"","text":"è¯¥æ–‡å‚è€ƒèµ„æºï¼š æµ…è°ˆåˆ†å¸ƒå¼é”â€“åŸºäºæ•°æ®åº“å®ç°ç¯‡_æ•°æ®åº“_powerfulçš„åšå®¢-CSDNåšå®¢ 1 é…ç½®ä¸­å¿ƒåœ¨å¹³å¸¸çš„ä¸šåŠ¡å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦å°†ç³»ç»Ÿçš„ä¸€äº›é€šç”¨çš„å…¨å±€é…ç½®ï¼Œä¾‹å¦‚æœºå™¨åˆ—è¡¨é…ç½®ï¼Œè¿è¡Œæ—¶å¼€å…³é…ç½®ï¼Œæ•°æ®åº“é…ç½®ä¿¡æ¯ç­‰ç»Ÿ-é›†ä¸­å­˜å‚¨ï¼Œè®©é›†ç¾¤æ‰€æœ‰æœºå™¨å…±äº«é…ç½®ä¿¡æ¯ï¼Œç³»ç»Ÿåœ¨å¯åŠ¨ä¼šé¦–å…ˆä»é…ç½®ä¸­å¿ƒè¯»å–é…ç½®ä¿¡æ¯,è¿›è¡Œåˆå§‹åŒ–ã€‚ä¼ ç»Ÿçš„å®ç°æ–¹å¼å°†é…ç½®å­˜å‚¨åœ¨æœ¬åœ°æ–‡ä»¶å’Œå†…å­˜ä¸­ï¼Œä¸€æ—¦æœºå™¨è§„æ¨¡æ›´å¤§,é…ç½®å˜æ›´é¢‘ç¹æƒ…å†µä¸‹ï¼Œæœ¬åœ°æ–‡ä»¶å’Œå†…å­˜æ–¹å¼çš„é…ç½®ç»´æŠ¤æˆæœ¬è¾ƒé«˜ï¼Œä½¿ç”¨zookeeperä½œä¸ºåˆ†å¸ƒå¼çš„é…ç½®ä¸­å¿ƒå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ æˆ‘ä»¬å°†é…ç½®ä¿¡æ¯å­˜åœ¨zkä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ä¸­ï¼ŒåŒæ—¶ç»™è¯¥èŠ‚ç‚¹æ³¨å†Œä¸€ä¸ªæ•°æ®èŠ‚ç‚¹å˜æ›´çš„watcherç›‘å¬ï¼Œä¸€æ—¦èŠ‚ç‚¹æ•°æ®å‘ç”Ÿå˜æ›´ï¼Œæ‰€æœ‰çš„è®¢é˜…è¯¥èŠ‚ç‚¹çš„å®¢æˆ·ç«¯éƒ½å¯ä»¥è·å–æ•°æ®å˜æ›´é€šçŸ¥ã€‚ 2 è´Ÿè½½å‡è¡¡å»ºç«‹serverèŠ‚ç‚¹ï¼Œå¹¶å»ºç«‹ç›‘å¬å™¨ç›‘è§†serverså­èŠ‚ç‚¹çš„çŠ¶æ€ï¼ˆç”¨äºåœ¨æœåŠ¡å™¨å¢æ·»æ—¶åŠæ—¶åŒæ­¥å½“å‰é›†ç¾¤ä¸­æœåŠ¡å™¨åˆ—è¡¨ï¼‰ã€‚åœ¨æ¯ä¸ªæœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œåœ¨serversèŠ‚ç‚¹ä¸‹å»ºç«‹å…·ä½“æœåŠ¡å™¨åœ°å€çš„å­èŠ‚ç‚¹,å¹¶åœ¨å¯¹åº”çš„å­èŠ‚ç‚¹ä¸‹å­˜å…¥æœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨zookeeperæœåŠ¡å™¨ä¸Šå¯ä»¥è·å–å½“å‰é›†ç¾¤ä¸­çš„æœåŠ¡å™¨åˆ—è¡¨åŠç›¸å…³ä¿¡æ¯ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªè´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œåœ¨æ¯ä¸ªè¯·æ±‚è¿‡æ¥æ—¶ä»zookeeperæœåŠ¡å™¨ä¸­è·å–å½“å‰é›†ç¾¤æœåŠ¡å™¨åˆ—è¡¨ï¼Œæ ¹æ®ç®—æ³•é€‰å‡ºå…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨æ¥å¤„ç†è¯·æ±‚ã€‚ 3 å‘½åæœåŠ¡å‘½åæœåŠ¡æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åŸºæœ¬åŠŸèƒ½ä¹‹ä¸€ã€‚è¢«å‘½åçš„å®ä½“é€šå¸¸å¯ä»¥æ˜¯é›†ç¾¤ä¸­çš„æœºå™¨ã€æä¾›çš„æœåŠ¡åœ°å€æˆ–è€…è¿œç¨‹å¯¹è±¡ï¼Œè¿™äº›éƒ½å¯ä»¥ç§°ä½œä¸ºåå­—ã€‚å¸¸è§çš„å°±æ˜¯ä¸€äº›åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ï¼ˆRPCã€RMIï¼‰ä¸­çš„æœåŠ¡åœ°å€åˆ—è¡¨ï¼Œé€šè¿‡ä½¿ç”¨åç§°æœåŠ¡å®¢æˆ·ç«¯å¯ä»¥è·å–èµ„æºçš„å®ä½“ã€æœåŠ¡åœ°å€å’Œæä¾›è€…ä¿¡æ¯ã€‚å‘½åæœåŠ¡å°±æ˜¯é€šè¿‡ä¸€ä¸ªèµ„æºå¼•ç”¨çš„æ–¹å¼æ¥å®ç°å¯¹èµ„æºçš„å®šä½å’Œä½¿ç”¨ã€‚åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œä¸Šå±‚åº”ç”¨ä»…ä»…éœ€è¦ä¸€ä¸ªå…¨å±€å”¯ä¸€åç§°ï¼Œå°±åƒæ•°æ®åº“ä¸­çš„ä¸»é”®ã€‚ åœ¨å•åº“å•è¡¨ç³»ç»Ÿä¸­å¯ä»¥é€šè¿‡è‡ªå¢IDæ¥æ ‡è¯†æ¯ä¸€æ¡è®°å½•ï¼Œä½†æ˜¯éšç€è§„æ¨¡å˜å¤§åˆ†åº“åˆ†è¡¨å¾ˆå¸¸è§ï¼Œé‚£ä¹ˆè‡ªå¢IDæœ‰ä»…èƒ½é’ˆå¯¹å•ä¸€è¡¨ç”ŸæˆIDï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹æ— æ³•ä¾é è¿™ä¸ªæ¥æ ‡è¯†å”¯ä¸€IDã€‚UUIDå°±æ˜¯ä¸€ç§å…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦ã€‚ä½†æ˜¯é•¿åº¦è¿‡é•¿ä¸æ˜“è¯†åˆ«ã€‚ åœ¨ Zookeeperä¸­é€šè¿‡åˆ›å»ºé¡ºåºèŠ‚ç‚¹å°±å¯ä»¥å®ç°ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯éƒ½ä¼šæ ¹æ®è‡ªå·±çš„ä»»åŠ¡ç±»å‹æ¥åˆ›å»ºä¸€ä¸ªé¡ºåºèŠ‚ç‚¹ï¼Œä¾‹å¦‚ job-00000001ã€‚ //CreateMode.PERSISTENT_SEQUENTIALå¯ä»¥åœ¨ç¬¬ä¸€ä¸ªå‚æ•°pathåé¢é™„åŠ ä¸€ä¸ªå…«ä½çš„å…¨å±€é€’å¢çš„æ•°å­— String path = zooKeeper.create(\"/type1/iob\", \"app2Value\".getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT_SEQUENTIAL); System.out.println(path); 4 DNSæœåŠ¡4.1 åŸŸåé…ç½®åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿåº”ç”¨ä¸­ï¼Œæ¯ä¸€ä¸ªåº”ç”¨éƒ½éœ€è¦åˆ†é…ä¸€ä¸ªåŸŸåï¼Œæ—¥å¸¸å¼€å‘ä¸­ï¼Œå¾€å¾€ä½¿ç”¨æœ¬åœ°HOSTç»‘å®šåŸŸåè§£æï¼Œå¼€å‘é˜¶æ®µå¯ä»¥éšæ—¶ä¿®æ”¹åŸŸåå’ŒIPçš„æ˜ å°„ï¼Œå¤§å¤§æé«˜å¼€å‘çš„è°ƒè¯•æ•ˆç‡ã€‚å¦‚æœåº”ç”¨çš„æœºå™¨è§„æ¨¡è¾¾åˆ°ä¸€å®šç¨‹åº¦åï¼Œéœ€è¦é¢‘ç¹æ›´æ–°åŸŸåæ—¶ï¼Œéœ€è¦åœ¨è§„æ¨¡çš„é›†ç¾¤ä¸­å˜æ›´ï¼Œæ— æ³•ä¿è¯å®æ—¶æ€§ã€‚æ‰€æœ‰æˆ‘ä»¬åœ¨zkä¸Šåˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹æ¥è¿›è¡ŒåŸŸåé…ç½®ã€‚ 4.2 åŸŸåè§£æåº”ç”¨è§£ææ—¶ï¼Œé¦–å…ˆä»zkåŸŸåèŠ‚ç‚¹ä¸­è·å–åŸŸåæ˜ å°„çš„IPå’Œç«¯å£ã€‚ 4.3 åŸŸåå˜æ›´æ¯ä¸ªåº”ç”¨éƒ½ä¼šåœ¨åœ¨å¯¹åº”çš„åŸŸåèŠ‚ç‚¹æ³¨å†Œä¸€ä¸ªæ•°æ®å˜æ›´çš„watcherç›‘å¬ï¼Œä¸€æ—¦ç›‘å¬çš„åŸŸåèŠ‚ç‚¹æ•°æ®å˜æ›´ï¼Œ zkä¼šå‘æ‰€æœ‰è®¢é˜…çš„å®¢æˆ·ç«¯å‘é€åŸŸåå˜æ›´é€šçŸ¥ã€‚ 5 é›†ç¾¤ç®¡ç†éšç€åˆ†å¸ƒå¼ç³»ç»Ÿè§„æ¨¡æ—¥ç›Šæ‰©å¤§ï¼Œé›†ç¾¤ä¸­æœºå™¨çš„æ•°é‡è¶Šæ¥è¶Šå¤šã€‚æœ‰æ•ˆçš„é›†ç¾¤ç®¡ç†è¶Šæ¥è¶Šé‡è¦äº†ï¼Œzookeeperé›†ç¾¤ç®¡ç†ä¸»è¦åˆ©ç”¨äº†watcheræœºåˆ¶å’Œåˆ›å»ºä¸´æ—¶èŠ‚ç‚¹æ¥å®ç°ã€‚ä»¥æœºå™¨ä¸Šä¸‹çº¿å’Œæœºå™¨ç›‘æ§ä¸ºä¾‹ï¼š 5.1 æœºå™¨ä¸Šä¸‹çº¿æ–°å¢æœºå™¨çš„æ—¶å€™ï¼Œå°†Agentéƒ¨ç½²åˆ°æ–°å¢çš„æœºå™¨ä¸Šï¼Œå½“Agentéƒ¨ç½²å¯åŠ¨æ—¶ï¼Œä¼šå‘zookeeperæŒ‡å®šçš„èŠ‚ç‚¹ä¸‹åˆ›å»ºä¸€ä¸ªä¸´æ—¶å­èŠ‚ç‚¹ï¼Œå½“Agentåœ¨zkä¸Šåˆ›å»ºå®Œè¿™ä¸ªä¸´æ—¶èŠ‚ç‚¹åï¼Œå½“å…³æ³¨çš„èŠ‚ç‚¹zookeeper/machinesä¸‹çš„å­èŠ‚ç‚¹åŠ å…¥æ–°çš„èŠ‚ç‚¹æ—¶æˆ–åˆ é™¤éƒ½ä¼šå‘é€é€šçŸ¥ï¼Œè¿™æ ·å°±å¯¹æœºå™¨çš„ä¸Šä¸‹çº¿è¿›è¡Œç›‘æ§ã€‚ 5.2 æœºå™¨ç›‘æ§åœ¨æœºå™¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒAgentä¼šå®šæ—¶å°†ä¸»æœºçš„çš„è¿è¡ŒçŠ¶æ€ä¿¡æ¯å†™å…¥åˆ°/machines/hostnä¸»æœºèŠ‚ç‚¹ï¼Œç›‘æ§ä¸­å¿ƒé€šè¿‡è®¢é˜…è¿™äº›èŠ‚ç‚¹çš„æ•°æ®å˜åŒ–æ¥è·å–ä¸»æœºçš„è¿è¡Œä¿¡æ¯ã€‚ 6 åˆ†å¸ƒå¼é”åˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼é€šå¸¸æœ‰ä¸‰ç§ï¼šæ•°æ®åº“ã€redisã€zookeeper 6.1 æ•°æ®åº“æ‚²è§‚é”è¿™éƒ¨åˆ†çš„åŸç†å‚è€ƒMySQLä¹‹è¡¨é”ã€è¡Œé”ã€MVCCè¯¦è§£ 6.1.1 insertè‡ªåŠ¨åŠ é”æ€æƒ³æ˜¯ï¼Œå½“æˆ‘ä»¬è¦é”ä½æŸä¸ªæ–¹æ³•æˆ–èµ„æºæ—¶ï¼Œæˆ‘ä»¬å°±åœ¨è¯¥è¡¨ä¸­å¢åŠ ä¸€æ¡è®°å½•ï¼Œæƒ³è¦é‡Šæ”¾é”çš„æ—¶å€™å°±åˆ é™¤è¿™æ¡è®°å½•ã€‚ å¯¹äºUPDATEã€DELETEå’ŒINSERTè¯­å¥ï¼ŒInnoDBä¼šè‡ªåŠ¨ç»™æ¶‰åŠçš„æ•°æ®é›†åŠ æ’ä»–é” åˆ›å»ºæ•°æ®åº“ï¼š CREATE TABLE `methodLock` ( `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®', `method_name` varchar(64) UNIQUE NOT NULL DEFAULT '' COMMENT 'é”å®šçš„æ–¹æ³•å', `desc` varchar(1024) NOT NULL DEFAULT 'å¤‡æ³¨ä¿¡æ¯', `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ä¿å­˜æ•°æ®æ—¶é—´ï¼Œè‡ªåŠ¨ç”Ÿæˆ', PRIMARY KEY (`id`), UNIQUE KEY `uidx_method_name` (`method_name `) ) DEFAULT CHARSET=utf8 COMMENT='é”å®šä¸­çš„æ–¹æ³•'; æ³¨æ„method_nameå¿…é¡»æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œå¦åˆ™é”çš„æ˜¯å…¨è¡¨è€Œä¸æ˜¯è®°å½•æœ¬èº«ã€‚ è·å¾—é”: insert into methodLock(method_name,desc) values (&#39;method_name&#39;,&#39;desc&#39;); é‡Šæ”¾é”ï¼š delete from methodLock where method_name =&#39;method_name&#39;; ä¸Šé¢è¿™ç§ç®€å•çš„å®ç°æœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š è¿™æŠŠé”å¼ºä¾èµ–æ•°æ®åº“çš„å¯ç”¨æ€§ï¼Œæ•°æ®åº“æ˜¯ä¸€ä¸ªå•ç‚¹ï¼Œä¸€æ—¦æ•°æ®åº“æŒ‚æ‰ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡ç³»ç»Ÿä¸å¯ç”¨ã€‚ è¿™æŠŠé”æ²¡æœ‰å¤±æ•ˆæ—¶é—´ï¼Œä¸€æ—¦è§£é”æ“ä½œå¤±è´¥ï¼Œå°±ä¼šå¯¼è‡´é”è®°å½•ä¸€ç›´åœ¨æ•°æ®åº“ä¸­ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•å†è·å¾—åˆ°é”ã€‚ è¿™æŠŠé”åªèƒ½æ˜¯éé˜»å¡çš„ï¼Œå› ä¸ºæ•°æ®çš„insertæ“ä½œï¼Œä¸€æ—¦æ’å…¥å¤±è´¥å°±ä¼šç›´æ¥æŠ¥é”™ã€‚æ²¡æœ‰è·å¾—é”çš„çº¿ç¨‹å¹¶ä¸ä¼šè¿›å…¥æ’é˜Ÿé˜Ÿåˆ—ï¼Œè¦æƒ³å†æ¬¡è·å¾—é”å°±è¦å†æ¬¡è§¦å‘è·å¾—é”æ“ä½œã€‚ è¿™æŠŠé”æ˜¯éé‡å…¥çš„ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹åœ¨æ²¡æœ‰é‡Šæ”¾é”ä¹‹å‰æ— æ³•å†æ¬¡è·å¾—è¯¥é”ã€‚å› ä¸ºæ•°æ®ä¸­æ•°æ®å·²ç»å­˜åœ¨äº†ã€‚ 6.1.2 selectæ‰‹åŠ¨åŠ é”select ... for updateå¦‚æœè®°å½•å­˜åœ¨ï¼Œä¼šç»™è®°å½•åŠ ä¸Šè¡Œé”å®ç°ä¸€è‡´æ€§é”å®šè¯»ã€‚ è·å¾—é”ï¼š select * from methodLock where method_name = #{currentMethod} for update; é‡Šæ”¾é”ï¼š commit è¿™ä¸ªæ–¹æ³•çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœæŸ¥è¯¢çš„è®°å½•ä¸å­˜åœ¨ï¼Œmysqlä¼šåŠ ä¸Šé—´éš™é”ï¼Œè€Œé—´éš™é”æ˜¯å…±äº«é”ï¼Œä¹Ÿå°±æ˜¯å…è®¸è¯»æ“ä½œï¼Œä¸ä¼šé˜»å¡ï¼Œæ‰€ä»¥å½“æŸ¥è¯¢çš„è®°å½•ä¸å­˜åœ¨è¿™ç§æ–¹æ³•æ˜¯ä¸é€‚ç”¨çš„ã€‚ è¿™é‡Œè¿˜å¯èƒ½å­˜åœ¨å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œè™½ç„¶æˆ‘ä»¬å¯¹ method_name ä½¿ç”¨äº†å”¯ä¸€ç´¢å¼•ï¼Œå¹¶ä¸”æ˜¾ç¤ºä½¿ç”¨for update æ¥ä½¿ç”¨è¡Œçº§é”ã€‚ä½†æ˜¯ï¼ŒMySql ä¼šå¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œå³ä¾¿åœ¨æ¡ä»¶ä¸­ä½¿ç”¨äº†ç´¢å¼•å­—æ®µï¼Œä½†æ˜¯å¦ä½¿ç”¨ç´¢å¼•æ¥æ£€ç´¢æ•°æ®æ˜¯ç”± MySQL é€šè¿‡åˆ¤æ–­ä¸åŒæ‰§è¡Œè®¡åˆ’çš„ä»£ä»·æ¥å†³å®šçš„ï¼Œå¦‚æœMySQL è®¤ä¸ºå…¨è¡¨æ‰«æ•ˆç‡æ›´é«˜ï¼Œæ¯”å¦‚å¯¹ä¸€äº›å¾ˆå°çš„è¡¨ï¼Œå®ƒå°±ä¸ä¼šä½¿ç”¨ç´¢å¼•ï¼Œè¿™ç§æƒ…å†µä¸‹InnoDB å°†ä½¿ç”¨è¡¨é”ï¼Œè€Œä¸æ˜¯è¡Œé”ã€‚ 6.2 æ•°æ®åº“ä¹è§‚é”æ•°æ®åº“çš„ä¹è§‚é”è®¤ä¸ºå¤§å¤šæ•°æ—¶å€™æ“ä½œéƒ½ä¸ä¼šå†²çªï¼Œå®ƒç»™æ•°æ®æ·»åŠ ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œè¯»å–å‡ºæ•°æ®æ—¶ï¼Œå°†æ­¤ç‰ˆæœ¬å·ä¸€åŒè¯»å‡ºï¼Œä¹‹åæ›´æ–°æ—¶ï¼Œå¯¹æ­¤ç‰ˆæœ¬å·åŠ 1ã€‚åœ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œä¼šå¯¹ç‰ˆæœ¬å·è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæ˜¯ä¸€è‡´çš„ï¼Œæ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œåˆ™ä¼šæˆåŠŸæ‰§è¡Œæœ¬æ¬¡æ“ä½œï¼›å¦‚æœç‰ˆæœ¬å·ä¸ä¸€è‡´ï¼Œåˆ™ä¼šæ›´æ–°å¤±è´¥ã€‚ è·å¾—é”ï¼š select state,version from methodLock where method_name = 'currentMethod'; update methodLock set state = 'locked',version = version + 1 where method_name = 'currentMethod' and state = 'unlock' and version = 'version'; é‡Šæ”¾é”ï¼š update methodLock set state = 'unlock' where method_name = 'currentMethod' and state = 'locked'; ä¹è§‚é”åªèƒ½è§£å†³æŒä¹…åŒ–æ˜¯ DB æ•°æ®çš„ä¸€æ¬¡æ›´æ–°é—®é¢˜ã€‚å‡å¦‚ä½ çš„æ•°æ®ä¸æ˜¯åœ¨ DBï¼Œæˆ–è€…ä¸€ä¸ªè¿‡ç¨‹æœ‰ä¸‰ä¸ªæ•°æ®çš„æ›´æ–°æ“ä½œï¼Œçº¿ç¨‹ A æ›´æ–°äº†æ•°æ® 1 å’Œæ•°æ® 2ï¼Œçº¿ç¨‹ B æ›´æ–°äº†æ•°æ® 3ï¼Œä¹è§‚é”å°±ä¸èƒ½èµ·ä½œç”¨ã€‚ 6.3 Redisredisåˆ†å¸ƒå¼é”çš„å®ç°å’Œæ•°æ®åº“çš„æ€æƒ³å·®ä¸å¤šï¼Œå®ƒæ˜¯åŸºäºsetnxï¼ˆset if not existsï¼‰å®ç°çš„ï¼Œè®¾ç½®æˆåŠŸï¼Œè¿”å›1ï¼›è®¾ç½®å¤±è´¥ï¼Œè¿”å›0ï¼Œé‡Šæ”¾é”çš„æ“ä½œé€šè¿‡delæŒ‡ä»¤æ¥å®Œæˆã€‚ å¦‚æœè®¾ç½®é”ååœ¨æ‰§è¡Œä¸­é—´è¿‡ç¨‹æ—¶ï¼Œç¨‹åºæŠ›å‡ºå¼‚å¸¸ï¼Œå¯¼è‡´delæŒ‡ä»¤æ²¡æœ‰è°ƒç”¨ï¼Œé”æ°¸è¿œæ— æ³•é‡Šæ”¾ï¼Œè¿™æ ·å°±ä¼šé™·å…¥æ­»é”ã€‚æ‰€ä»¥æˆ‘ä»¬æ‹¿åˆ°é”ä¹‹åä¼šç»™é”åŠ ä¸Šä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·å³ä½¿ä¸­é—´å‡ºç°å¼‚å¸¸ï¼Œè¿‡æœŸæ—¶é—´åˆ°åä¼šè‡ªåŠ¨é‡Šæ”¾é”ã€‚ åŒæ—¶åœ¨setnx å’Œ expire å¦‚æœè¿›ç¨‹æŒ‚æ‰ï¼Œexpireä¸èƒ½æ‰§è¡Œä¹Ÿä¼šæ­»é”ã€‚æ‰€ä»¥è¦ä¿è¯setnxå’Œexpireæ˜¯ä¸€ä¸ªåŸå­æ€§æ“ä½œå³å¯ã€‚redis 2.8ä¹‹åæ¨å‡ºäº†setnxå’Œexpireçš„ç»„åˆæŒ‡ä»¤ set key value ex 5 nxredis å®ç°åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜ï¼šä¸ºäº†è§£å†³rediså•ç‚¹é—®é¢˜ï¼Œæˆ‘ä»¬ä¼šéƒ¨ç½²redisé›†ç¾¤ï¼Œåœ¨ Sentinel é›†ç¾¤ä¸­ï¼Œä¸»èŠ‚ç‚¹çªç„¶æŒ‚æ‰äº†ã€‚åŒæ—¶ä¸»èŠ‚ç‚¹ä¸­æœ‰æŠŠé”è¿˜æ²¡æœ‰æ¥å¾—åŠåŒæ­¥åˆ°ä»èŠ‚ç‚¹ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´ç³»ç»Ÿä¸­åŒæ ·ä¸€æŠŠé”è¢«ä¸¤ä¸ªå®¢æˆ·ç«¯åŒæ—¶æŒæœ‰ï¼Œä¸å®‰å…¨æ€§ç”±æ­¤äº§ç”Ÿã€‚rediså®˜æ–¹ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ¨å‡ºäº†Redlock ç®—æ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯å¸¦æ¥çš„ç½‘ç»œæ¶ˆè€—è¾ƒå¤§ã€‚ ä½¿ç”¨redissonï¼ˆä¸€ä¸ªredisçš„ä½œç”¨äºjavaçš„ç¬¬ä¸‰æ–¹åº“ï¼‰å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ 6.4 ZookeeperåŸç†: zookeeperé€šè¿‡åˆ›å»ºä¸´æ—¶åºåˆ—èŠ‚ç‚¹æ¥å®ç°åˆ†å¸ƒå¼é”ï¼Œé€‚ç”¨äºé¡ºåºæ‰§è¡Œçš„ç¨‹åºï¼Œå¤§ä½“æ€è·¯å°±æ˜¯åˆ›å»ºä¸´æ—¶åºåˆ—èŠ‚ç‚¹,æ‰¾å‡ºæœ€å°çš„åºåˆ—èŠ‚ç‚¹,è·å–åˆ†å¸ƒå¼é”,ç¨‹åºæ‰§è¡Œå®Œæˆä¹‹åæ­¤åºåˆ—èŠ‚ç‚¹æ¶ˆå¤±ï¼Œé€šè¿‡watchæ¥ç›‘æ§è‡ªå·±å‰ä¸€ä¸ªèŠ‚ç‚¹çš„åˆ é™¤ï¼Œå½“è‡ªå·±ä¸ºåºåˆ—ä¸­ç¼–å·æœ€å°çš„èŠ‚ç‚¹çš„æ—¶å€™ï¼Œè·å¾—åˆ†å¸ƒå¼é”ã€‚å½“é‡Šæ”¾é”çš„æ—¶å€™ï¼Œåªéœ€å°†è¿™ä¸ªç¬æ—¶èŠ‚ç‚¹åˆ é™¤å³å¯ã€‚åŒæ—¶ï¼Œå…¶å¯ä»¥é¿å…æœåŠ¡å®•æœºå¯¼è‡´çš„é”æ— æ³•é‡Šæ”¾ï¼Œè€Œäº§ç”Ÿçš„æ­»é”é—®é¢˜ã€‚ ä¼˜ç‚¹ æ— å•ç‚¹é—®é¢˜ã€‚ZK æ˜¯é›†ç¾¤éƒ¨ç½²çš„ï¼Œåªè¦é›†ç¾¤ä¸­æœ‰åŠæ•°ä»¥ä¸Šçš„æœºå™¨å­˜æ´»ï¼Œå°±å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ã€‚ æŒæœ‰é”ä»»æ„é•¿çš„æ—¶é—´ï¼Œå¯è‡ªåŠ¨é‡Šæ”¾é”ã€‚ä½¿ç”¨ Zookeeper å¯ä»¥æœ‰æ•ˆçš„è§£å†³é”æ— æ³•é‡Šæ”¾çš„é—®é¢˜ï¼Œå› ä¸ºåœ¨åˆ›å»ºé”çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯ä¼šåœ¨ ZK ä¸­åˆ›å»ºä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ï¼Œä¸€æ—¦å®¢æˆ·ç«¯è·å–åˆ°é”ä¹‹åçªç„¶æŒ‚æ‰ï¼ˆSession è¿æ¥æ–­å¼€ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªä¸´æ—¶èŠ‚ç‚¹å°±ä¼šè‡ªåŠ¨åˆ é™¤æ‰ã€‚å…¶ä»–å®¢æˆ·ç«¯å°±å¯ä»¥å†æ¬¡è·å¾—é”ã€‚è¿™é¿å…äº†åŸºäº Redis çš„é”å¯¹äºæœ‰æ•ˆæ—¶é—´(lock validity time)åˆ°åº•è®¾ç½®å¤šé•¿çš„ä¸¤éš¾é—®é¢˜ã€‚å®é™…ä¸Šï¼ŒåŸºäº ZooKeeper çš„é”æ˜¯ä¾é  Sessionï¼ˆå¿ƒè·³ï¼‰æ¥ç»´æŒé”çš„æŒæœ‰çŠ¶æ€çš„ï¼Œè€Œ Redis ä¸æ”¯æŒ Sessionã€‚ å¯é˜»å¡ã€‚ä½¿ç”¨ Zookeeper å¯ä»¥å®ç°é˜»å¡çš„é”ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡åœ¨ ZK ä¸­åˆ›å»ºé¡ºåºèŠ‚ç‚¹ï¼Œå¹¶ä¸”åœ¨èŠ‚ç‚¹ä¸Šç»‘å®šç›‘å¬å™¨ï¼Œä¸€æ—¦èŠ‚ç‚¹æœ‰å˜åŒ–ï¼ŒZookeeper ä¼šé€šçŸ¥å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ£€æŸ¥è‡ªå·±åˆ›å»ºçš„èŠ‚ç‚¹æ˜¯ä¸æ˜¯å½“å‰æ‰€æœ‰èŠ‚ç‚¹ä¸­åºå·æœ€å°çš„ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆè‡ªå·±å°±è·å–åˆ°é”ï¼Œä¾¿å¯ä»¥æ‰§è¡Œä¸šåŠ¡é€»è¾‘äº†ã€‚ å¯é‡å…¥ã€‚å®¢æˆ·ç«¯åœ¨åˆ›å»ºèŠ‚ç‚¹çš„æ—¶å€™ï¼ŒæŠŠå½“å‰å®¢æˆ·ç«¯çš„ä¸»æœºä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯ç›´æ¥å†™å…¥åˆ°èŠ‚ç‚¹ä¸­ï¼Œä¸‹æ¬¡æƒ³è¦è·å–é”çš„æ—¶å€™å’Œå½“å‰æœ€å°çš„èŠ‚ç‚¹ä¸­çš„æ•°æ®æ¯”å¯¹ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚å¦‚æœå’Œè‡ªå·±çš„ä¿¡æ¯ä¸€æ ·ï¼Œé‚£ä¹ˆè‡ªå·±ç›´æ¥è·å–åˆ°é”ï¼Œå¦‚æœä¸ä¸€æ ·å°±å†åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„é¡ºåºèŠ‚ç‚¹ï¼Œå‚ä¸æ’é˜Ÿã€‚zookeeper ç¬¬ä¸‰æ–¹åº“Curator å®¢æˆ·ç«¯ä¸­å°è£…äº†ä¸€ä¸ªå¯é‡å…¥çš„é”æœåŠ¡ã€‚ ç¼ºç‚¹ zookeeper å®ç°çš„åˆ†å¸ƒå¼é”å…¶å®å­˜åœ¨ä¸€ä¸ªç¼ºç‚¹ï¼Œé‚£å°±æ˜¯æ€§èƒ½ä¸Šå¯èƒ½å¹¶æ²¡æœ‰ç¼“å­˜æœåŠ¡é‚£ä¹ˆé«˜ã€‚å› ä¸ºæ¯æ¬¡åœ¨åˆ›å»ºé”å’Œé‡Šæ”¾é”çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½è¦åŠ¨æ€åˆ›å»ºã€é”€æ¯ç¬æ—¶èŠ‚ç‚¹æ¥å®ç°é”åŠŸèƒ½ã€‚ZK ä¸­åˆ›å»ºå’Œåˆ é™¤èŠ‚ç‚¹åªèƒ½é€šè¿‡ Leader æœåŠ¡å™¨æ¥æ‰§è¡Œï¼Œç„¶åå°†æ•°æ®åŒä¸åˆ°æ‰€æœ‰çš„ Follower æœºå™¨ä¸Šã€‚ 7 åˆ†å¸ƒå¼é˜Ÿåˆ—é˜Ÿåˆ—ç‰¹æ€§ï¼šFIFOï¼ˆå…ˆå…¥å…ˆå‡ºï¼‰ï¼Œzookeeperå®ç°åˆ†å¸ƒå¼é˜Ÿåˆ—çš„æ­¥éª¤ï¼š åœ¨é˜Ÿåˆ—èŠ‚ç‚¹ä¸‹åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼Œä¾‹å¦‚/queue_info/192.168.1.1-0000001 è°ƒç”¨ getChildren()æ¥å£æ¥è·å–/queue_infoèŠ‚ç‚¹ä¸‹æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œè·å–é˜Ÿåˆ—ä¸­æ‰€æœ‰å…ƒç´  æ¯”è¾ƒè‡ªå·±èŠ‚ç‚¹æ˜¯å¦æ˜¯åºå·æœ€å°çš„èŠ‚ç‚¹ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ç­‰å¾…å…¶ä»–èŠ‚ç‚¹å‡ºé˜Ÿåˆ—ï¼Œåœ¨åºå·æœ€å°çš„èŠ‚ç‚¹æ³¨å†Œwatcher è·å–watcheré€šçŸ¥åï¼Œé‡å¤æ­¥éª¤","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"https://www.codetool.top/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"},{"name":"zookeeper","slug":"zookeeper","permalink":"https://www.codetool.top/tags/zookeeper/"}]},{"title":"Zookeeperä¸­çš„Watcheræœºåˆ¶ä¸æºç åˆ†æ","slug":"Zookeeperä¸­çš„Watcheræœºåˆ¶","date":"2020-03-18T03:02:14.000Z","updated":"2020-03-18T11:35:28.073Z","comments":true,"path":"article/Zookeeperä¸­çš„Watcheræœºåˆ¶/","link":"","permalink":"https://www.codetool.top/article/Zookeeper%E4%B8%AD%E7%9A%84Watcher%E6%9C%BA%E5%88%B6/","excerpt":"","text":"1 watcheræœºåˆ¶æ¦‚è¿°zookeeperä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªæœºåˆ¶å°±æ˜¯watcherï¼Œåœ¨zkCliä¸­å¯ä»¥åœ¨getã€lsã€ls2ã€stat ç­‰æ“ä½œä¸­æ·»åŠ watchï¼Œä»è€Œç›‘å¬èŠ‚ç‚¹å˜åŒ–ï¼Œèµ·åˆ°åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ”¶åˆ°æ¶ˆæ¯é€šçŸ¥ä½œç”¨ã€‚ Watcheræœºåˆ¶åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼šæ³¨å†Œã€å­˜å‚¨ã€é€šçŸ¥ æ³¨å†Œï¼š æ³¨å†ŒWatcherå­˜å‚¨ï¼š Watcherå¯¹è±¡å­˜åœ¨å®¢æˆ·ç«¯çš„WatcherManagerä¸­é€šçŸ¥ï¼š æœåŠ¡ç«¯è§¦å‘Watcheräº‹ä»¶ï¼Œé€šçŸ¥å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ä»WatcherManagerä¸­å–å‡ºå¯¹åº”çš„Watcherå¯¹è±¡æ‰§è¡Œå›è°ƒ 2 æºç åˆ†æ2.1 å®¢æˆ·ç«¯æ³¨å†Œæˆ‘ä»¬é€šè¿‡zkCliçš„æ‰§è¡Œå‘½ä»¤æµç¨‹æ¥çœ‹ä¸€ä¸‹watchèµ·åˆ°äº†ä»€ä¹ˆä½œç”¨ï¼š æ‰¾åˆ°å¯¹åº”çš„ç±»ä¸‹çš„mainæ–¹æ³•ï¼š public static void main(String args[]) throws CliException, IOException, InterruptedException { ZooKeeperMain main = new ZooKeeperMain(args); main.run();//è·Ÿè¿›å» } void run() throws CliException, IOException, InterruptedException { if (cl.getCommand() == null) { System.out.println(\"Welcome to ZooKeeper!\"); boolean jlinemissing = false; try { //è¿™ä¸€éƒ¨åˆ†ä½¿ç”¨åå°„ç”ŸæˆConsoleReaderå®ä¾‹è¯»å–å‘½ä»¤è¡ŒæŒ‡ä»¤ Class&lt;?> consoleC = Class.forName(\"jline.console.ConsoleReader\"); Class&lt;?> completorC = Class.forName(\"org.apache.zookeeper.JLineZNodeCompleter\"); System.out.println(\"JLine support is enabled\"); Object console = consoleC.getConstructor().newInstance(); Object completor = completorC.getConstructor(ZooKeeper.class).newInstance(zk); Method addCompletor = consoleC.getMethod(\"addCompleter\", Class.forName(\"jline.console.completer.Completer\")); addCompletor.invoke(console, completor); //æ‰§è¡ŒæŒ‡ä»¤ String line; Method readLine = consoleC.getMethod(\"readLine\", String.class); while ((line = (String)readLine.invoke(console, getPrompt())) != null) { //æ‰§è¡Œï¼æ­¤å¤„è·Ÿè¿› executeLine(line); } }//catch ... } public void executeLine(String line) throws CliException, InterruptedException, IOException { if (!line.equals(\"\")) { //å°†å‘½ä»¤å­—ç¬¦ä¸²è½¬æ¢æˆMyCommandOptionså¯¹è±¡ cl.parseCommand(line); //æ·»åŠ å‘½ä»¤åˆ°å†å²è®°å½• addToHistory(commandCount,line); //æ‰§è¡Œå‘½ä»¤ï¼Œæ­¤å¤„è·Ÿè¿› processCmd(cl); commandCount++; } } protected boolean processCmd(MyCommandOptions co) throws CliException, IOException, InterruptedException { boolean watch = false; try { //æ‰§è¡Œå‘½ä»¤ï¼Œæ­¤å¤„è·Ÿè¿› watch = processZKCmd(co); exitCode = 0; } catch (CliException ex) { exitCode = ex.getExitCode(); System.err.println(ex.getMessage()); } return watch; } protected boolean processZKCmd(MyCommandOptions co) throws CliException, IOException, InterruptedException { String[] args = co.getArgArray(); String cmd = co.getCommand(); //å‘½ä»¤æ²¡è¾“å…¥ if (args.length &lt; 1) { usage(); throw new MalformedCommandException(\"No command entered\"); } //ä¸å­˜åœ¨è¯¥æŒ‡ä»¤ if (!commandMap.containsKey(cmd)) { usage(); throw new CommandNotFoundException(\"Command not found \" + cmd); } boolean watch = false; LOG.debug(\"Processing \" + cmd); //quitç­‰æ— å®é™…æ“ä½œçš„æŒ‡ä»¤ if (cmd.equals(\"quit\")) { zk.close(); System.exit(exitCode); } else if (cmd.equals(\"redo\") &amp;&amp; args.length >= 2) { Integer i = Integer.decode(args[1]); if (commandCount &lt;= i || i &lt; 0) { // don't allow redoing this redo throw new MalformedCommandException(\"Command index out of range\"); } cl.parseCommand(history.get(i)); if (cl.getCommand().equals(\"redo\")) { throw new MalformedCommandException(\"No redoing redos\"); } history.put(commandCount, history.get(i)); processCmd(cl); } else if (cmd.equals(\"history\")) { for (int i = commandCount - 10; i &lt;= commandCount; ++i) { if (i &lt; 0) continue; System.out.println(i + \" - \" + history.get(i)); } } else if (cmd.equals(\"printwatches\")) { if (args.length == 1) { System.out.println(\"printwatches is \" + (printWatches ? \"on\" : \"off\")); } else { printWatches = args[1].equals(\"on\"); } } else if (cmd.equals(\"connect\")) { if (args.length >= 2) { connectToZK(args[1]); } else { connectToZK(host); } } // Below commands all need a live connection if (zk == null || !zk.getState().isAlive()) { System.out.println(\"Not connected\"); return false; } // å¦‚æœæ˜¯æ­£å¸¸çš„æ“ä½œå‘½ä»¤ï¼Œä½¿ç”¨cliCmdçš„å­ç±»æ‰§è¡Œ CliCommand cliCmd = commandMapCli.get(cmd); if(cliCmd != null) { cliCmd.setZk(zk); watch = cliCmd.parse(args).exec();//æ­¤å¤„è·Ÿè¿› } else if (!commandMap.containsKey(cmd)) { usage(); } return watch; } è¿™é‡Œæˆ‘ä»¬é€‰æ‹©cliCmdçš„å­ç±»GetCommandè·Ÿè¿›execæ–¹æ³•ï¼š public boolean exec() throws CliException { //æ ¹æ®æ˜¯å¦å…·æœ‰'-w'å‚æ•°åˆ¤æ–­æ˜¯å¦ç›‘å¬ boolean watch = cl.hasOption(\"w\"); String path = args[1]; Stat stat = new Stat(); byte data[]; try { //ä½¿ç”¨getDataå‘½ä»¤è·å–æ•°æ®ï¼Œæ­¤å¤„è·Ÿè¿› data = zk.getData(path, watch, stat); } catch (IllegalArgumentException ex) { throw new MalformedPathException(ex.getMessage()); } catch (KeeperException|InterruptedException ex) { throw new CliException(ex); } data = (data == null) ? \"null\".getBytes() : data; out.println(new String(data)); if (cl.hasOption(\"s\")) { new StatPrinter(out).print(stat); } return watch; } public byte[] getData(String path, boolean watch, Stat stat) throws KeeperException, InterruptedException { //å¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ä¸€ä¸ªwatchManager.defaultWatcherï¼Œå®ƒæ˜¯ä¸€ä¸ªé»˜è®¤çš„watcher return getData(path, watch ? watchManager.defaultWatcher : null, stat); } public byte[] getData(final String path, Watcher watcher, Stat stat) throws KeeperException, InterruptedException { final String clientPath = path; PathUtils.validatePath(clientPath); // the watch contains the un-chroot path WatchRegistration wcb = null; if (watcher != null) { //å¦‚æœwatcherä¸ä¸ºç©ºæ³¨å†Œwatcherï¼Œæ­¤å¤„è·Ÿè¿›ï¼Œè¿”å›ä¸€ä¸ªWatchRegistration wcb = new DataWatchRegistration(watcher, clientPath); } final String serverPath = prependChroot(clientPath); RequestHeader h = new RequestHeader(); h.setType(ZooDefs.OpCode.getData); GetDataRequest request = new GetDataRequest(); request.setPath(serverPath); request.setWatch(watcher != null); GetDataResponse response = new GetDataResponse(); //æ­¤å¤„ç”¨åˆ°äº†è¿”å›çš„WatchRegistrationï¼Œè·Ÿè¿› ReplyHeader r = cnxn.submitRequest(h, request, response, wcb); if (r.getErr() != 0) { throw KeeperException.create(KeeperException.Code.get(r.getErr()), clientPath); } if (stat != null) { DataTree.copyStat(response.getStat(), stat); } return response.getData(); } public DataWatchRegistration(Watcher watcher, String clientPath) { super(watcher, clientPath);//è°ƒç”¨WatchRegistrationçš„æ„é€ æ–¹æ³• } public WatchRegistration(Watcher watcher, String clientPath) { //åŒ…å«ä¸€ä¸ªwatcherå’Œä¸€ä¸ªç›‘å¬åœ°å€ this.watcher = watcher; this.clientPath = clientPath; } public ReplyHeader submitRequest(RequestHeader h, Record request, Record response, WatchRegistration watchRegistration) throws InterruptedException { return submitRequest(h, request, response, watchRegistration, null); } public ReplyHeader submitRequest(RequestHeader h, Record request, Record response, WatchRegistration watchRegistration, WatchDeregistration watchDeregistration) throws InterruptedException { ReplyHeader r = new ReplyHeader(); //ä½¿ç”¨watchRegistrationæ„å»ºäº†ä¸€ä¸ªqueuePacket Packet packet = queuePacket(h, r, request, response, null, null, null, null, watchRegistration, watchDeregistration); synchronized (packet) { if (requestTimeout > 0) { // Wait for request completion with timeout waitForPacketFinish(r, packet); } else { // Wait for request completion infinitely while (!packet.finished) { packet.wait(); } } } if (r.getErr() == Code.REQUESTTIMEOUT.intValue()) { sendThread.cleanAndNotifyState(); } return r; } public Packet queuePacket(RequestHeader h, ReplyHeader r, Record request, Record response, AsyncCallback cb, String clientPath, String serverPath, Object ctx, WatchRegistration watchRegistration, WatchDeregistration watchDeregistration) { Packet packet = null; // Note that we do not generate the Xid for the packet yet. It is // generated later at send-time, by an implementation of ClientCnxnSocket::doIO(), // where the packet is actually sent. packet = new Packet(h, r, request, response, watchRegistration); packet.cb = cb; packet.ctx = ctx; packet.clientPath = clientPath; packet.serverPath = serverPath; packet.watchDeregistration = watchDeregistration; // The synchronized block here is for two purpose: // 1. synchronize with the final cleanup() in SendThread.run() to avoid race // 2. synchronized against each packet. So if a closeSession packet is added, // later packet will be notified. synchronized (state) { if (!state.isAlive() || closing) { conLossPacket(packet); } else { // If the client is asking to close the session then // mark as closing if (h.getType() == OpCode.closeSession) { closing = true; } outgoingQueue.add(packet); } } //å°†è¯¥packetæ·»åŠ åˆ°äº†sendThreadçš„ClientCnxnSocketä¸­ sendThread.getClientCnxnSocket().packetAdded(); return packet; } åœ¨å°†packetæ·»åŠ åˆ°äº†sendThreadçš„ClientCnxnSocketä¸­ä¹‹åï¼Œæ³¨æ„SendThreadæ˜¯ä¸åœåœ°åœ¨doIOï¼Œè€Œè¿™é‡ŒpacketAddedä¹‹åè¿˜ä¼šè°ƒç”¨selectorçš„wakeup()æ–¹æ³•ï¼Œé€šçŸ¥æœåŠ¡ç«¯è¿™è¾¹æœ‰ä¸€ä¸ªpacketå‘è¿‡å»äº†ï¼Œå¹¶ä¸”åœ¨finishPacketä¹‹åï¼Œå‘ZooKeeperä¸­çš„ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ZKWatchManagerå†…çš„hashmapæ·»åŠ äº†è¿™ä¸ªwatcher private final Map&lt;String, Set&lt;Watcher>> dataWatches = new HashMap&lt;String, Set&lt;Watcher>>(); private final Map&lt;String, Set&lt;Watcher>> existWatches = new HashMap&lt;String, Set&lt;Watcher>>(); private final Map&lt;String, Set&lt;Watcher>> childWatches = new HashMap&lt;String, Set&lt;Watcher>>(); 2.2 æœåŠ¡ç«¯å­˜å‚¨é‚£ä¹ˆæœåŠ¡ç«¯å¹²äº†ä»€ä¹ˆå‘¢ï¼Ÿ ç ”ç©¶æœåŠ¡ç«¯æºç å¯ä»¥å‘ç°ï¼Œåœ¨æœåŠ¡ç«¯æ˜¯leadingçŠ¶æ€æ—¶ï¼Œé€šè¿‡è°ƒç”¨LeaderZooKeeperServerçš„startupæ–¹æ³•ï¼Œé‡Œé¢å†è°ƒç”¨ZooKeeperServerä¸­çš„startupæ–¹æ³•ï¼Œåœ¨è°ƒç”¨setupRequestProcessors()è¿›è¡Œè¯·æ±‚å¤„ç†: protected void setupRequestProcessors() { RequestProcessor finalProcessor = new FinalRequestProcessor(this); RequestProcessor syncProcessor = new SyncRequestProcessor(this, finalProcessor); ((SyncRequestProcessor)syncProcessor).start(); firstProcessor = new PrepRequestProcessor(this, syncProcessor); ((PrepRequestProcessor)firstProcessor).start(); } è¿™é‡Œé¢æœ‰ä¸€ä¸ªPrepRequestProcessorå’Œä¸€ä¸ªå°è£…äº†FinalRequestProcessorçš„SyncRequestProcessorï¼Œé€šè¿‡é˜…è¯»æºç å‘ç°FinalRequestProcessorçš„processRequestä¸­ public void processRequest(Request request) { //prehandling... switch (request.type) { //case... case OpCode.getData: { lastOp = \"GETD\"; GetDataRequest getDataRequest = new GetDataRequest(); ByteBufferInputStream.byteBuffer2Record(request.request, getDataRequest); DataNode n = zks.getZKDatabase().getNode(getDataRequest.getPath()); if (n == null) { throw new KeeperException.NoNodeException(); } PrepRequestProcessor.checkACL(zks, zks.getZKDatabase().aclForNode(n), ZooDefs.Perms.READ, request.authInfo); Stat stat = new Stat(); //é€šè¿‡getWatchè·å–æ˜¯å¦ç›‘è§†ï¼Œå¦‚æœç›‘è§†ä¼ é€’ä¸€ä¸ªServerCnxnå¯¹è±¡ï¼Œç»§æ‰¿è‡ªWatcher byte b[] = zks.getZKDatabase().getData(getDataRequest.getPath(), stat, getDataRequest.getWatch() ? cnxn : null); rsp = new GetDataResponse(b, stat); break; } //case... public byte[] getData(String path, Stat stat, Watcher watcher) throws KeeperException.NoNodeException { return dataTree.getData(path, stat, watcher); } public byte[] getData(String path, Stat stat, Watcher watcher) throws KeeperException.NoNodeException { DataNode n = nodes.get(path); if (n == null) { throw new KeeperException.NoNodeException(); } synchronized (n) { n.copyStat(stat); if (watcher != null) { //æ·»åŠ ç›‘è§†ï¼Œè·Ÿè¿› dataWatches.addWatch(path, watcher); } return n.data; } } synchronized void addWatch(String path, Watcher watcher) { //ä½¿ç”¨watchTableè®°å½•æŸè·¯å¾„æ‰€æœ‰çš„ç›‘è§†å™¨ HashSet&lt;Watcher> list = watchTable.get(path); if (list == null) { // don't waste memory if there are few watches on a node // rehash when the 4th entry is added, doubling size thereafter // seems like a good compromise list = new HashSet&lt;Watcher>(4); watchTable.put(path, list); } list.add(watcher); HashSet&lt;String> paths = watch2Paths.get(watcher); if (paths == null) { // cnxns typically have many watches, so use default cap here paths = new HashSet&lt;String>(); watch2Paths.put(watcher, paths); } paths.add(path); } è¿™æ ·å°±æŠŠç›‘è§†å™¨å’Œpathå…³è”èµ·æ¥äº†ï¼Œè€ŒæœåŠ¡ç«¯å¯ä»¥é€šè¿‡åˆšåˆšä¼ å…¥çš„ServerCnxnè”ç³»å®¢æˆ·ç«¯ã€‚ 2.3 æœåŠ¡ç«¯é€šçŸ¥è€Œå¦‚æœæ•°æ®å‘ç”Ÿå˜åŠ¨æ— éå°±æ˜¯å¤„ç†äº†setå‘½ä»¤ï¼Œæ‰¾åˆ°å¯¹åº”çš„å‡½æ•°ï¼š public Stat setData(String path, byte[] data, int version, long zxid, long time) throws NoNodeException { Stat s = new Stat(); DataNode n = (DataNode)this.nodes.get(path); if (n == null) { throw new NoNodeException(); } else { byte[] lastdata = null; byte[] lastdata; // èµ‹å€¼node synchronized(n) { lastdata = n.data; n.data = data; n.stat.setMtime(time); n.stat.setMzxid(zxid); n.stat.setVersion(version); n.copyStat(s); } String lastPrefix; if ((lastPrefix = this.getMaxPrefixWithQuota(path)) != null) { this.updateBytes(lastPrefix, (long)((data == null ? 0 : data.length) - (lastdata == null ? 0 : lastdata.length))); } // è§¦å‘watcher this.dataWatches.triggerWatch(path, EventType.NodeDataChanged); return s; } } public Set&lt;Watcher> triggerWatch(String path, EventType type) { return this.triggerWatch(path, type, (Set)null); } public Set&lt;Watcher> triggerWatch(String path, EventType type, Set&lt;Watcher> supress) { WatchedEvent e = new WatchedEvent(type, KeeperState.SyncConnected, path); HashSet watchers; synchronized(this) { //ç§»é™¤watcherï¼ watchers = (HashSet)this.watchTable.remove(path); if (watchers == null || watchers.isEmpty()) { if (LOG.isTraceEnabled()) { ZooTrace.logTraceMessage(LOG, 64L, \"No watchers for \" + path); } return null; } Iterator i$ = watchers.iterator(); while(i$.hasNext()) { //ç§»é™¤watcherï¼ Watcher w = (Watcher)i$.next(); HashSet&lt;String> paths = (HashSet)this.watch2Paths.get(w); if (paths != null) { paths.remove(path); } } } Iterator i$ = watchers.iterator(); while(true) { Watcher w; do { if (!i$.hasNext()) { return watchers; } w = (Watcher)i$.next(); } while(supress != null &amp;&amp; supress.contains(w)); // watcherè°ƒç”¨ï¼Œè¿™é‡Œçš„eå¯¹è±¡é‡Œåªæœ‰é€šçŸ¥çŠ¶æ€ï¼ˆKeeperStateï¼‰ã€äº‹ä»¶ç±»å‹ï¼ˆEventTypeï¼‰ä»¥åŠèŠ‚ç‚¹è·¯å¾„ï¼ˆPathï¼‰ // æ²¡æœ‰ä¿®æ”¹è¿‡åçš„æ–°å€¼ä¹Ÿæ²¡æœ‰è€çš„å€¼ w.process(e); } } public synchronized void process(WatchedEvent event) { // è¯·æ±‚å¤´æ ‡è®°-1ï¼Œè¡¨æ˜æ˜¯é€šçŸ¥ ReplyHeader h = new ReplyHeader(-1, -1L, 0); if (LOG.isTraceEnabled()) { ZooTrace.logTraceMessage(LOG, 64L, \"Deliver event \" + event + \" to 0x\" + Long.toHexString(this.sessionId) + \" through \" + this); } WatcherEvent e = event.getWrapper(); // å‘é€é€šçŸ¥ç»™å®¢æˆ·ç«¯ this.sendResponse(h, e, \"notification\"); } åœ¨æ­¤å¤„å°±æŠŠç›‘å¬çš„äº‹ä»¶ç±»å‹å’ŒçŠ¶æ€è¿”å›ç»™äº†å®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆå†è¿”å›å®¢æˆ·ç«¯çœ‹çœ‹å®¢æˆ·ç«¯çš„å¤„ç† 2.4 å®¢æˆ·ç«¯å¤„ç†äº‹ä»¶ï¼ˆä¾å®¢æˆ·ç«¯è€Œå®šï¼‰åœ¨å®¢æˆ·ç«¯çš„SendThreadä¸­è°ƒç”¨äº†doTransport-&gt;doIO-&gt;readResponseæ¥æ¥æ”¶æœåŠ¡å™¨çš„å“åº” void readResponse(ByteBuffer incomingBuffer) throws IOException { ByteBufferInputStream bbis = new ByteBufferInputStream( incomingBuffer); BinaryInputArchive bbia = BinaryInputArchive.getArchive(bbis); ReplyHeader replyHdr = new ReplyHeader(); replyHdr.deserialize(bbia, \"header\"); //if replyHdr.getXid() == ... // å¦‚æœæ˜¯é€šçŸ¥ if (replyHdr.getXid() == -1) { // -1 means notification if (LOG.isDebugEnabled()) { LOG.debug(\"Got notification sessionid:0x\" + Long.toHexString(sessionId)); } //ååºåˆ—åŒ– WatcherEvent event = new WatcherEvent(); event.deserialize(bbia, \"response\"); // ä»æœåŠ¡å™¨åœ°å€è½¬æ¢ä¸ºå®¢æˆ·ç«¯åœ°å€ if (chrootPath != null) { String serverPath = event.getPath(); if(serverPath.compareTo(chrootPath)==0) event.setPath(\"/\"); else if (serverPath.length() > chrootPath.length()) event.setPath(serverPath.substring(chrootPath.length())); else { LOG.warn(\"Got server path \" + event.getPath() + \" which is too short for chroot path \" + chrootPath); } } WatchedEvent we = new WatchedEvent(event); if (LOG.isDebugEnabled()) { LOG.debug(\"Got \" + we + \" for sessionid 0x\" + Long.toHexString(sessionId)); } //äº¤ç»™eventThreadçº¿ç¨‹å¤„ç† eventThread.queueEvent( we ); return; } //... } public void queueEvent(WatchedEvent event) { queueEvent(event, null); } private void queueEvent(WatchedEvent event, Set&lt;Watcher> materializedWatchers) { if (event.getType() == EventType.None &amp;&amp; sessionState == event.getState()) { return; } //è·å–çŠ¶æ€ sessionState = event.getState(); final Set&lt;Watcher> watchers; if (materializedWatchers == null) { // materialize the watchers based on the event // å› ä¸ºåªæœ‰è·¯å¾„ã€äº‹ä»¶ç±»å‹ï¼Œè¦é€šè¿‡è¿™äº›ä¿¡æ¯è·å–è·å–æ‰€æœ‰çš„watcher watchers = watcher.materialize(event.getState(), event.getType(), event.getPath()); } else { watchers = new HashSet&lt;Watcher>(); watchers.addAll(materializedWatchers); } //å°†Watcherså’ŒWatchedEventå…³è”èµ·æ¥ WatcherSetEventPair pair = new WatcherSetEventPair(watchers, event); // queue the pair (watch set &amp; event) for later processing // åŠ å…¥åˆ°ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ä¸­å¾…å¤„ç† waitingEvents.add(pair); } public Set&lt;Watcher> materialize(Watcher.Event.KeeperState state, Watcher.Event.EventType type, String clientPath) { Set&lt;Watcher> result = new HashSet&lt;Watcher>(); //æ”¶é›†å¹¶ç§»é™¤äº‹ä»¶ switch (type) { case None: result.add(defaultWatcher); boolean clear = disableAutoWatchReset &amp;&amp; state != Watcher.Event.KeeperState.SyncConnected; synchronized(dataWatches) { for(Set&lt;Watcher> ws: dataWatches.values()) { result.addAll(ws); } if (clear) { dataWatches.clear(); } } synchronized(existWatches) { for(Set&lt;Watcher> ws: existWatches.values()) { result.addAll(ws); } if (clear) { existWatches.clear(); } } synchronized(childWatches) { for(Set&lt;Watcher> ws: childWatches.values()) { result.addAll(ws); } if (clear) { childWatches.clear(); } } return result; case NodeDataChanged: case NodeCreated: synchronized (dataWatches) { addTo(dataWatches.remove(clientPath), result); } synchronized (existWatches) { addTo(existWatches.remove(clientPath), result); } break; case NodeChildrenChanged: synchronized (childWatches) { addTo(childWatches.remove(clientPath), result); } break; case NodeDeleted: synchronized (dataWatches) { addTo(dataWatches.remove(clientPath), result); } // XXX This shouldn't be needed, but just in case synchronized (existWatches) { Set&lt;Watcher> list = existWatches.remove(clientPath); if (list != null) { addTo(list, result); LOG.warn(\"We are triggering an exists watch for delete! Shouldn't happen!\"); } } synchronized (childWatches) { addTo(childWatches.remove(clientPath), result); } break; default: String msg = \"Unhandled watch event type \" + type + \" with state \" + state + \" on path \" + clientPath; LOG.error(msg); throw new RuntimeException(msg); } return result; } } è¿™é‡Œå¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯æ ¹æ®äº‹ä»¶ç±»å‹å’Œè·¯å¾„ä»ZKWatchManagerä¸­å–å‡ºäº†å¯¹åº”çš„watcherå¹¶ç§»é™¤äº†å®ƒï¼Œè¯´æ˜å®¢æˆ·ç«¯çš„watcherä¹Ÿæ˜¯ä¸€æ¬¡æ€§çš„ï¼Œ åœ¨ClientCnxnçš„EventThreadä¸­ï¼Œä¸æ–­åœ°ä»waitingEventsä¸­å–äº‹ä»¶ï¼š public void run() { try { isRunning = true; while (true) { //å–äº‹ä»¶ Object event = waitingEvents.take(); if (event == eventOfDeath) { wasKilled = true; } else { //å¤„ç†äº‹ä»¶ï¼Œè·Ÿè¿› processEvent(event); } if (wasKilled) synchronized (waitingEvents) { if (waitingEvents.isEmpty()) { isRunning = false; break; } } } } catch (InterruptedException e) { LOG.error(\"Event thread exiting due to interruption\", e); } LOG.info(\"EventThread shut down for session: 0x{}\", Long.toHexString(getSessionId())); } private void processEvent(Object event) { try { // å¦‚æœæ˜¯WatcherSetEventPair if (event instanceof WatcherSetEventPair) { // each watcher will process the event WatcherSetEventPair pair = (WatcherSetEventPair) event; for (Watcher watcher : pair.watchers) { try { //ä½¿ç”¨watcherçš„process watcher.process(pair.event); } catch (Throwable t) { LOG.error(\"Error while calling watcher \", t); } } } // else if... } catch (Throwable t) { LOG.error(\"Caught unexpected throwable\", t); } } è€Œwatcher.processåœ¨zkCliä¸­çš„å®ç°å°±æ˜¯: private class MyWatcher implements Watcher { public void process(WatchedEvent event) { if (getPrintWatches()) { ZooKeeperMain.printMessage(\"WATCHER::\"); ZooKeeperMain.printMessage(event.toString()); } } } toString: public String toString() { return \"WatchedEvent state:\" + keeperState + \" type:\" + eventType + \" path:\" + path; } å®Œå…¨ç¬¦åˆå®¢æˆ·ç«¯çš„ç›‘å¬è¾“å‡ºï¼Œå°±è¿™æ ·ä¸€ä¸ªç›‘å¬è¿‡ç¨‹å°±å®Œæˆäº†ã€‚è€Œå¯¹äºjavaä¸­zk apiçš„ä½¿ç”¨ï¼Œæ·»åŠ çš„watcheræœ‰æˆ‘ä»¬æä¾›çš„å›è°ƒå‡½æ•°ï¼Œå°±ä¼šè‡ªåŠ¨è°ƒç”¨äº†ã€‚ æºç çœ‹å®Œäº†ï¼Œæ¥ç‚¹å…¶ä»–ä¼˜ç§€åšä¸»çš„æ€»ç»“å‹å‹æƒŠï¼š Zookeeper Watcher æœºåˆ¶è¯¦è§£ - å¤§æ•°æ®up - åšå®¢å›­ zookeeper ä¸­ Watcher é€šçŸ¥æœºåˆ¶çš„ä¸€ç‚¹ç†è§£_å¤§æ•°æ®_éŸ¦ä¸€ç¬‘çš„ä¸“æ -CSDNåšå®¢","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://www.codetool.top/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"name":"zookeeper","slug":"zookeeper","permalink":"https://www.codetool.top/tags/zookeeper/"}]},{"title":"Zookeeperå¯åŠ¨å’Œé€‰ä¸¾è¿‡ç¨‹ç®€è¦æºç åˆ†æ","slug":"Zookeeperå¯åŠ¨å’Œé€‰ä¸¾è¿‡ç¨‹ç®€è¦æºç åˆ†æ","date":"2020-03-18T02:56:42.000Z","updated":"2020-03-18T02:57:03.153Z","comments":true,"path":"article/Zookeeperå¯åŠ¨å’Œé€‰ä¸¾è¿‡ç¨‹ç®€è¦æºç åˆ†æ/","link":"","permalink":"https://www.codetool.top/article/Zookeeper%E5%90%AF%E5%8A%A8%E5%92%8C%E9%80%89%E4%B8%BE%E8%BF%87%E7%A8%8B%E7%AE%80%E8%A6%81%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","excerpt":"","text":"æŒ‰å¯åŠ¨æµç¨‹åˆ†æ ä½äºQuorumPeerMainä¸­çš„mainæ–¹æ³• public static void main(String[] args) { QuorumPeerMain main = new QuorumPeerMain(); try { main.initializeAndRun(args); } //catch... } protected void initializeAndRun(String[] args) throws ConfigException, IOException, AdminServerException { //åŠ è½½é…ç½®æ–‡ä»¶zoo.cfg QuorumPeerConfig config = new QuorumPeerConfig(); if (args.length == 1) { config.parse(args[0]); } // å¯åŠ¨æ¸…é™¤ä»»åŠ¡ï¼Œä¸»è¦æ¸…é™¤æ—§çš„å¿«ç…§å’Œæ—¥å¿—æ–‡ä»¶ DatadirCleanupManager purgeMgr = new DatadirCleanupManager(config .getDataDir(), config.getDataLogDir(), config .getSnapRetainCount(), config.getPurgeInterval()); purgeMgr.start(); // å•æœºå¯åŠ¨å’Œé›†ç¾¤å¯åŠ¨ if (args.length == 1 &amp;&amp; config.isDistributed()) { runFromConfig(config); } else { LOG.warn(\"Either no config or no quorum defined in config, running \" + \" in standalone mode\"); // there is only server in the quorum -- run as standalone ZooKeeperServerMain.main(args); } } 1 å•æœºå¯åŠ¨public static void main(String[] args) { ZooKeeperServerMain main = new ZooKeeperServerMain(); try { main.initializeAndRun(args); } //catch... } protected void initializeAndRun(String[] args) throws ConfigException, IOException, AdminServerException { try { //æ—¥å¿—ç›¸å…³å·¥å…·çš„åŠ è½½ ManagedUtil.registerLog4jMBeans(); } catch (JMException e) { LOG.warn(\"Unable to register log4j JMX control\", e); } //åŒ…è£…config ServerConfig config = new ServerConfig(); if (args.length == 1) { config.parse(args[0]); } else { config.parse(args); } //ä½¿ç”¨configå¯åŠ¨ runFromConfig(config); } public void runFromConfig(ServerConfig config) throws IOException, AdminServerException { LOG.info(\"Starting server\"); FileTxnSnapLog txnLog = null; try { // åˆ›å»ºFileTxnLogå’ŒFileSnapå®ä¾‹ï¼Œå¹¶ä¿å­˜åˆšå¯åŠ¨æ—¶å€™æ—¥å¿—æ•°æ® txnLog = new FileTxnSnapLog(config.dataLogDir, config.dataDir); // åˆ›å»ºæœåŠ¡å™¨ final ZooKeeperServer zkServer = new ZooKeeperServer(txnLog, config.tickTime, config.minSessionTimeout, config.maxSessionTimeout, null); txnLog.setServerStats(zkServer.serverStats()); // æ³¨å†Œå…³é—­æœåŠ¡å™¨çš„å¤„ç†å™¨ final CountDownLatch shutdownLatch = new CountDownLatch(1); zkServer.registerServerShutdownHandler( new ZooKeeperServerShutdownHandler(shutdownLatch)); // å¯åŠ¨ Admin server adminServer = AdminServerFactory.createAdminServer(); adminServer.setZooKeeperServer(zkServer); adminServer.start(); //å¯åŠ¨NIOServerCnxnFactory boolean needStartZKServer = true; //ä»è§£æå‡ºçš„é…ç½®ä¸­é…ç½®NIOServerCnxnFactory if (config.getClientPortAddress() != null) { cnxnFactory = ServerCnxnFactory.createFactory(); cnxnFactory.configure(config.getClientPortAddress(), config.getMaxClientCnxns(), false); //å¯åŠ¨zookeeper server cnxnFactory.startup(zkServer); needStartZKServer = false; } if (config.getSecureClientPortAddress() != null) { secureCnxnFactory = ServerCnxnFactory.createFactory(); secureCnxnFactory.configure(config.getSecureClientPortAddress(), config.getMaxClientCnxns(), true); secureCnxnFactory.startup(zkServer, needStartZKServer); } containerManager = new ContainerManager(zkServer.getZKDatabase(), zkServer.firstProcessor, Integer.getInteger(\"znode.container.checkIntervalMs\", (int) TimeUnit.MINUTES.toMillis(1)), Integer.getInteger(\"znode.container.maxPerMinute\", 10000) ); containerManager.start(); // ç­‰åˆ°ä½¿ç”¨shutdownLatchçš„çº¿ç¨‹æ•°æ¸…é›¶å°±å…³é—­æœåŠ¡å™¨ shutdownLatch.await(); shutdown(); if (cnxnFactory != null) { cnxnFactory.join(); } if (secureCnxnFactory != null) { secureCnxnFactory.join(); } if (zkServer.canShutdown()) { zkServer.shutdown(true); } } catch (InterruptedException e) { // warn, but generally this is ok LOG.warn(\"Server interrupted\", e); } finally { if (txnLog != null) { txnLog.close(); } } } 2 é›†ç¾¤å¯åŠ¨public void runFromConfig(QuorumPeerConfig config) throws IOException, AdminServerException { try { //æ—¥å¿—ç›¸å…³å·¥å…·çš„åŠ è½½ ManagedUtil.registerLog4jMBeans(); } catch (JMException e) { LOG.warn(\"Unable to register log4j JMX control\", e); } //åˆ›å»ºNIOServerCnxnFactory LOG.info(\"Starting quorum peer\"); try { ServerCnxnFactory cnxnFactory = null; ServerCnxnFactory secureCnxnFactory = null; if (config.getClientPortAddress() != null) { cnxnFactory = ServerCnxnFactory.createFactory(); cnxnFactory.configure(config.getClientPortAddress(), config.getMaxClientCnxns(), false); } if (config.getSecureClientPortAddress() != null) { secureCnxnFactory = ServerCnxnFactory.createFactory(); secureCnxnFactory.configure(config.getSecureClientPortAddress(), config.getMaxClientCnxns(), true); } // quorumPeeræ˜¯å’Œé›†ç¾¤ç›¸å…³çš„é…ç½®ä¿¡æ¯ quorumPeer = getQuorumPeer(); quorumPeer.setTxnFactory(new FileTxnSnapLog( config.getDataLogDir(), config.getDataDir())); quorumPeer.enableLocalSessions(config.areLocalSessionsEnabled()); quorumPeer.enableLocalSessionsUpgrading( config.isLocalSessionsUpgradingEnabled()); //quorumPeer.setQuorumPeers(config.getAllMembers()); quorumPeer.setElectionType(config.getElectionAlg()); quorumPeer.setMyid(config.getServerId()); quorumPeer.setTickTime(config.getTickTime()); quorumPeer.setMinSessionTimeout(config.getMinSessionTimeout()); quorumPeer.setMaxSessionTimeout(config.getMaxSessionTimeout()); quorumPeer.setInitLimit(config.getInitLimit()); quorumPeer.setSyncLimit(config.getSyncLimit()); quorumPeer.setConfigFileName(config.getConfigFilename()); quorumPeer.setZKDatabase(new ZKDatabase(quorumPeer.getTxnFactory())); quorumPeer.setQuorumVerifier(config.getQuorumVerifier(), false); if (config.getLastSeenQuorumVerifier()!=null) { quorumPeer.setLastSeenQuorumVerifier(config.getLastSeenQuorumVerifier(), false); } quorumPeer.initConfigInZKDatabase(); quorumPeer.setCnxnFactory(cnxnFactory); quorumPeer.setSecureCnxnFactory(secureCnxnFactory); quorumPeer.setSslQuorum(config.isSslQuorum()); quorumPeer.setUsePortUnification(config.shouldUsePortUnification()); quorumPeer.setLearnerType(config.getPeerType()); quorumPeer.setSyncEnabled(config.getSyncEnabled()); quorumPeer.setQuorumListenOnAllIPs(config.getQuorumListenOnAllIPs()); if (config.sslQuorumReloadCertFiles) { quorumPeer.getX509Util().enableCertFileReloading(); } // sets quorum sasl authentication configurations quorumPeer.setQuorumSaslEnabled(config.quorumEnableSasl); if(quorumPeer.isQuorumSaslAuthEnabled()){ quorumPeer.setQuorumServerSaslRequired(config.quorumServerRequireSasl); quorumPeer.setQuorumLearnerSaslRequired(config.quorumLearnerRequireSasl); quorumPeer.setQuorumServicePrincipal(config.quorumServicePrincipal); quorumPeer.setQuorumServerLoginContext(config.quorumServerLoginContext); quorumPeer.setQuorumLearnerLoginContext(config.quorumLearnerLoginContext); } quorumPeer.setQuorumCnxnThreadsSize(config.quorumCnxnThreadsSize); //åˆå§‹åŒ– quorumPeer.initialize(); //quorumPeerçš„startæ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ªçº¿ç¨‹ quorumPeer.start(); //ç­‰å¾…quorumPeerçº¿ç¨‹ç»“æŸ quorumPeer.join(); } catch (InterruptedException e) { // warn, but generally this is ok LOG.warn(\"Quorum Peer interrupted\", e); } } public synchronized void start() { if (!getView().containsKey(myid)) { throw new RuntimeException(\"My id \" + myid + \" not in the peer list\"); } loadDataBase(); startServerCnxnFactory(); try { //å¯åŠ¨adminServer adminServer.start(); } catch (AdminServerException e) { LOG.warn(\"Problem starting AdminServer\", e); System.out.println(e); } //å¼€å§‹leaderé€‰ä¸¾ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŠ å…¥çš„æ—¶å€™éƒ½ä¼šè¿›è¡Œä¸€è½®é€‰ä¸¾ startLeaderElection(); //å¼€å¯çº¿ç¨‹æ‰§è¡Œrunæ–¹æ³• super.start(); } public void run() { updateThreadName(); //jmxç›‘æ§ç›¸å…³ //... try { //ä¸»å¾ªç¯ main loop while (running) { //æœ‰å››ä¸ªçŠ¶æ€ï¼šLOOKINGã€OBSERVINGã€FOLLOWINGã€LEADING switch (getPeerState()) { case LOOKING: //åˆšå¯åŠ¨çš„æ—¶å€™ä¸ºLOOKINGï¼Œæ­£åœ¨é€‰ä¸¾ LOG.info(\"LOOKING\"); //å½“å‰èŠ‚ç‚¹ä¸ºåªè¯»èŠ‚ç‚¹ï¼Œä¸å…³å¿ƒ if (Boolean.getBoolean(\"readonlymode.enabled\")) { //... //ä¸æ˜¯åªè¯»èŠ‚ç‚¹ } else { try { reconfigFlagClear(); if (shuttingDownLE) { shuttingDownLE = false; startLeaderElection(); } //leaderé€‰ä¸¾ setCurrentVote(makeLEStrategy().lookForLeader()); } catch (Exception e) { LOG.warn(\"Unexpected exception\", e); setPeerState(ServerState.LOOKING); } } break; //case ... } 2.1 leaderé€‰ä¸¾public Vote lookForLeader() throws InterruptedException { //jxmç›‘æ§ç›¸å…³ //... try { //è®°å½•å½“å‰serveræ¥å—å…¶ä»–serverçš„æœ¬è½®æŠ•ç¥¨ä¿¡æ¯ HashMap&lt;Long, Vote> recvset = new HashMap&lt;Long, Vote>(); //é€‰ä¸¾æ¥å—åæ³•å®šserverçš„æŠ•ç¥¨ä¿¡æ¯ HashMap&lt;Long, Vote> outofelection = new HashMap&lt;Long, Vote>(); //é€‰ä¸¾è¶…æ—¶æ—¶é—´ int notTimeout = finalizeWait; synchronized(this){ //æ›´æ–°é€»è¾‘æ—¶é’Ÿ+1 logicalclock.incrementAndGet(); //åˆå§‹åŒ–é€‰ç¥¨ï¼Œç»™è‡ªå·±æŠ•ä¸€ç¥¨ï¼Œè¿™é‡Œçœ‹å‡ºhashmapçš„keyä¸ºmyid updateProposal(getInitId(), getInitLastLoggedZxid(), getPeerEpoch()); } LOG.info(\"New election. My id = \" + self.getId() + \", proposed zxid=0x\" + Long.toHexString(proposedZxid)); //é€šçŸ¥ç»™æ‰€æœ‰å…¶ä»–serveræ–°çš„ä¸€ç¥¨äº§ç”Ÿï¼Œæ”¾å…¥sendqueueé˜Ÿåˆ— sendNotifications(); //å¦‚æœå½“å‰è¿˜æ˜¯LOOKINGå¹¶ä¸”æ²¡æœ‰åœæ­¢ä¸€ç›´æ¥å—é€‰ç¥¨ç›´åˆ°äº§ç”Ÿæ–°leader while ((self.getPeerState() == ServerState.LOOKING) &amp;&amp; (!stop)){ //ä»recvqueueé˜Ÿåˆ—ä¸­é˜»å¡å–å‡ºæŠ•ç¥¨ä¿¡æ¯ï¼ˆå…¶ä»–serverå‘æ¥çš„ï¼‰ Notification n = recvqueue.poll(notTimeout, TimeUnit.MILLISECONDS); //åˆ¤è¯»é€‰ç¥¨ä¿¡æ¯æ˜¯å¦ä¸ºç©º if(n == null){ //åˆ¤æ–­æ˜¯å¦æŠ•é€’è¿‡é€‰ç¥¨ï¼Œå¦‚æœæŠ•é€’è¿‡ï¼Œè¯´æ˜æ²¡æœ‰æ–­å¼€è¿æ¥ if(manager.haveDelivered()){ //é‡æ–°å‘é€é€‰ç¥¨ä¿¡æ¯ sendNotifications(); //å¦‚æœæ²¡æœ‰æŠ•é€’è¿‡ï¼Œè¯´æ˜æ–­å¼€è¿æ¥ï¼Œé‡è¿ } else { manager.connectAll(); } //å°†æ¥æ”¶é€‰ç¥¨æ—¶é™å»¶é•¿äº†ä¸€å€ int tmpTimeOut = notTimeout*2; notTimeout = (tmpTimeOut &lt; maxNotificationInterval? tmpTimeOut : maxNotificationInterval); LOG.info(\"Notification time out: \" + notTimeout); } //æ£€æŸ¥é€‰ä¸¾voterå’ŒæŠ•ç¥¨çš„leaderæ˜¯å¦åˆæ³• else if (validVoter(n.sid) &amp;&amp; validVoter(n.leader)) { //çœ‹voterçš„stateçŠ¶æ€ switch (n.state) { //å¦‚æœè¿˜æ˜¯looking case LOOKING: // å¦‚æœé€‰ç¥¨çš„epochå¤§äºè‡ªå·±çš„é€»è¾‘æ—¶é’Ÿï¼Œè¯´æ˜é€‰ç¥¨æ˜¯æœ€æ–°çš„ï¼Œè‡ªå·±çš„é€‰ç¥¨è¿™ä¸€è½®å·²ç»è¿‡æ—¶ if (n.electionEpoch > logicalclock.get()) { //æ›´æ–°è‡ªå·±çš„é€»è¾‘æ—¶é’Ÿï¼Œå¹¶æ¸…ç©ºå½“å‰æ”¶åˆ°çš„å…¶ä»–serverçš„æŠ•ç¥¨ logicalclock.set(n.electionEpoch); recvset.clear(); //æ¯”è¾ƒè‡ªå·±å’Œé€‰ç¥¨ä¸­è°æ›´é€‚åˆåšleaderï¼Œæ ¹æ®zxidã€peerEpochåšå†³å®š //å¹¶ç”Ÿæˆæ–°çš„é€‰ç¥¨ if(totalOrderPredicate(n.leader, n.zxid, n.peerEpoch, getInitId(), getInitLastLoggedZxid(), getPeerEpoch())) { updateProposal(n.leader, n.zxid, n.peerEpoch); } else { updateProposal(getInitId(), getInitLastLoggedZxid(), getPeerEpoch()); } //å‘é€æ–°çš„æŠ•ç¥¨ç»™å…¶ä»–server sendNotifications(); // å¦åˆ™é€‰ç¥¨çš„epochå°äºè‡ªå·±çš„é€»è¾‘æ—¶é’Ÿï¼Œè¯´æ˜è¯¥é€‰ç¥¨æ˜¯è¿‡æœŸçš„ï¼Œä¸åšæ“ä½œ } else if (n.electionEpoch &lt; logicalclock.get()) { if(LOG.isDebugEnabled()){ LOG.debug(\"Notification election epoch is smaller than logicalclock. n.electionEpoch = 0x\" + Long.toHexString(n.electionEpoch) + \", logicalclock=0x\" + Long.toHexString(logicalclock.get())); } break; // ç­‰äºï¼Œåˆ™è¿˜æ˜¯æ¯”è¾ƒè‡ªå·±å’Œé€‰ç¥¨ä¸­è°æ›´é€‚åˆåšleaderï¼Œå¹¶ç”Ÿæˆæ–°çš„é€‰ç¥¨ } else if (totalOrderPredicate(n.leader, n.zxid, n.peerEpoch, proposedLeader, proposedZxid, proposedEpoch)) { updateProposal(n.leader, n.zxid, n.peerEpoch); sendNotifications(); } if(LOG.isDebugEnabled()){ LOG.debug(\"Adding vote: from=\" + n.sid + \", proposed leader=\" + n.leader + \", proposed zxid=0x\" + Long.toHexString(n.zxid) + \", proposed election epoch=0x\" + Long.toHexString(n.electionEpoch)); } // å°†æ”¶åˆ°çš„é€‰ç¥¨æ”¾å…¥recvset recvset.put(n.sid, new Vote(n.leader, n.zxid, n.electionEpoch, n.peerEpoch)); if (termPredicate(recvset, new Vote(proposedLeader, proposedZxid, logicalclock.get(), proposedEpoch))) { // Verify if there is any change in the proposed leader while((n = recvqueue.poll(finalizeWait, TimeUnit.MILLISECONDS)) != null){ if(totalOrderPredicate(n.leader, n.zxid, n.peerEpoch, proposedLeader, proposedZxid, proposedEpoch)){ recvqueue.put(n); break; } } /* * This predicate is true once we don't read any new * relevant message from the reception queue */ if (n == null) { self.setPeerState((proposedLeader == self.getId()) ? ServerState.LEADING: learningState()); Vote endVote = new Vote(proposedLeader, proposedZxid, logicalclock.get(), proposedEpoch); leaveInstance(endVote); return endVote; } } break; case OBSERVING: LOG.debug(\"Notification from observer: \" + n.sid); break; case FOLLOWING: case LEADING: //å†æ¬¡åˆ¤æ–­é€‰ä¸¾epochæ˜¯å¦ç­‰äºé€»è¾‘æ—¶é’Ÿ.... } else { if (!validVoter(n.leader)) { LOG.warn(\"Ignoring notification for non-cluster member sid {} from sid {}\", n.leader, n.sid); } if (!validVoter(n.sid)) { LOG.warn(\"Ignoring notification for sid {} from non-quorum member sid {}\", n.leader, n.sid); } } } return null; } finally { //jmxç›¸å…³... } }","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://www.codetool.top/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"name":"zookeeper","slug":"zookeeper","permalink":"https://www.codetool.top/tags/zookeeper/"}]},{"title":"leetcode836-çŸ©å½¢é‡å ","slug":"leetcode836-çŸ©å½¢é‡å ","date":"2020-03-18T01:18:03.000Z","updated":"2020-03-18T01:25:16.980Z","comments":true,"path":"article/leetcode836-çŸ©å½¢é‡å /","link":"","permalink":"https://www.codetool.top/article/leetcode836-%E7%9F%A9%E5%BD%A2%E9%87%8D%E5%8F%A0/","excerpt":"","text":"1 åŸé¢˜çŸ©å½¢ä»¥åˆ—è¡¨ [x1, y1, x2, y2] çš„å½¢å¼è¡¨ç¤ºï¼Œå…¶ä¸­ (x1, y1) ä¸ºå·¦ä¸‹è§’çš„åæ ‡ï¼Œ(x2, y2) æ˜¯å³ä¸Šè§’çš„åæ ‡ã€‚ å¦‚æœç›¸äº¤çš„é¢ç§¯ä¸ºæ­£ï¼Œåˆ™ç§°ä¸¤çŸ©å½¢é‡å ã€‚éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œåªåœ¨è§’æˆ–è¾¹æ¥è§¦çš„ä¸¤ä¸ªçŸ©å½¢ä¸æ„æˆé‡å ã€‚ ç»™å‡ºä¸¤ä¸ªçŸ©å½¢ï¼Œåˆ¤æ–­å®ƒä»¬æ˜¯å¦é‡å å¹¶è¿”å›ç»“æœã€‚ ç¤ºä¾‹ 1: è¾“å…¥ï¼š rec1 = [0,0,2,2], rec2 = [1,1,3,3]è¾“å‡ºï¼š true ç¤ºä¾‹ 2: è¾“å…¥ï¼š rec1 = [0,0,1,1], rec2 = [1,0,2,1]è¾“å‡ºï¼š false è¯´æ˜ï¼š ä¸¤ä¸ªçŸ©å½¢ rec1 å’Œ rec2 éƒ½ä»¥å«æœ‰å››ä¸ªæ•´æ•°çš„åˆ—è¡¨çš„å½¢å¼ç»™å‡ºã€‚ çŸ©å½¢ä¸­çš„æ‰€æœ‰åæ ‡éƒ½å¤„äº -10^9 å’Œ 10^9 ä¹‹é—´ã€‚ 2 è§£æ³•2.1 æ€æƒ³é€†å‘æ€ç»´ï¼Œå¦‚æœä¸¤ä¸ªçŸ©å½¢ä¸é‡å åˆ™æŠ•å½±åˆ°xã€yè½´ä¸Šçš„ä¸¤ä¸ªåŒºé—´éƒ½ä¸ä¼šé‡å ï¼Œå¯ä»¥å†™å‡ºä¸‹é¢è¡¨è¾¾å¼ï¼š 2.2 ä»£ç class Solution { public boolean isRectangleOverlap(int[] rec1, int[] rec2) { return !(rec1[2]&lt;=rec2[0]||rec2[2]&lt;=rec1[0]||rec1[3]&lt;=rec2[1]||rec2[3]&lt;=rec1[1]); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"ZookeeperåŸºæœ¬ä½¿ç”¨","slug":"ZookeeperåŸºæœ¬ä½¿ç”¨","date":"2020-03-17T13:39:13.000Z","updated":"2020-03-18T03:15:16.734Z","comments":true,"path":"article/ZookeeperåŸºæœ¬ä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/Zookeeper%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š ä¸€æ–‡äº†è§£Zookeeperæ•°æ®èŠ‚ç‚¹-znode - ç®€ä¹¦ 1 æ•°æ®ç»“æ„ZooKeeperæ•°æ®æ¨¡å‹çš„ç»“æ„ä¸Unixæ–‡ä»¶ç³»ç»Ÿå¾ˆç±»ä¼¼ï¼Œæ•´ä½“ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ä¸€æ£µæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç§°åšä¸€ä¸ªZNodeï¼Œæ¯ä¸ªZNodeéƒ½å¯ä»¥é€šè¿‡å…¶è·¯å¾„å”¯ä¸€æ ‡è¯† Znode èŠ‚ç‚¹ç±»å‹ æŒä¹…åŒ–ç›®å½•èŠ‚ç‚¹ï¼ˆPERSISTENTï¼‰å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹ä¾æ—§å­˜åœ¨ æŒä¹…åŒ–é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹ï¼ˆPERSISTENT_SEQUENTIALï¼‰å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹ä¾æ—§å­˜åœ¨ï¼ŒZookeeperä¼šç»™è¯¥èŠ‚ç‚¹æŒ‰ç…§é¡ºåºç¼–å· ä¸´æ—¶ç›®å½•èŠ‚ç‚¹ï¼ˆEPHEMERALï¼‰å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹è¢«åˆ é™¤ ä¸´æ—¶é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹ï¼ˆ EPHEMERAL_SEQUENTIALï¼‰å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹è¢«åˆ é™¤ï¼ŒZookeeperä¼šç»™è¯¥èŠ‚ç‚¹æŒ‰ç…§é¡ºåºç¼–å· 1.1 znodeçŠ¶æ€ä¿¡æ¯ znodeçŠ¶æ€ä¿¡æ¯ è§£é‡Š cZxid create ZXIDï¼Œå³è¯¥æ•°æ®èŠ‚ç‚¹è¢«åˆ›å»ºæ—¶çš„äº‹åŠ¡id ctime create timeï¼Œå³è¯¥èŠ‚ç‚¹çš„åˆ›å»ºæ—¶é—´ mZxid modified ZXIDï¼Œå³è¯¥èŠ‚ç‚¹æœ€ç»ˆä¸€æ¬¡æ›´æ–°æ—¶çš„äº‹åŠ¡id mtime modified timeï¼Œå³è¯¥èŠ‚ç‚¹æœ€åä¸€æ¬¡çš„æ›´æ–°æ—¶é—´ pZxid è¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶çš„äº‹åŠ¡idï¼Œåªæœ‰å­èŠ‚ç‚¹åˆ—è¡¨å˜æ›´æ‰ä¼šæ›´æ–°pZxidï¼Œå­èŠ‚ç‚¹å†…å®¹å˜æ›´ä¸ä¼šæ›´æ–° cversion å­èŠ‚ç‚¹ç‰ˆæœ¬å·ï¼Œå½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ¯æ¬¡å˜åŒ–æ—¶å€¼å¢åŠ 1 dataVersion æ•°æ®èŠ‚ç‚¹å†…å®¹ç‰ˆæœ¬å·ï¼ŒèŠ‚ç‚¹åˆ›å»ºæ—¶ä¸º0ï¼Œæ¯æ›´æ–°ä¸€æ¬¡èŠ‚ç‚¹å†…å®¹(ä¸ç®¡å†…å®¹æœ‰æ— å˜åŒ–)è¯¥ç‰ˆæœ¬å·çš„å€¼å¢åŠ 1 aclVersion èŠ‚ç‚¹çš„ACLç‰ˆæœ¬å·ï¼Œè¡¨ç¤ºè¯¥èŠ‚ç‚¹ACLä¿¡æ¯å˜æ›´æ¬¡æ•° ephemeralOwner åˆ›å»ºè¯¥ä¸´æ—¶èŠ‚ç‚¹çš„ä¼šè¯çš„sessionIdï¼›å¦‚æœå½“å‰èŠ‚ç‚¹ä¸ºæŒä¹…èŠ‚ç‚¹ï¼Œåˆ™ephemeralOwner=0 dataLength æ•°æ®èŠ‚ç‚¹å†…å®¹é•¿åº¦ numChildren å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•° 1.2 ACLæƒé™ZooKeeperæä¾›äº†ä¸€å¥—å®Œå–„çš„ACLæƒé™æ§åˆ¶æœºåˆ¶ä¿éšœæ•°æ®å®‰å…¨æ€§ã€‚ å¯¹äºèº«ä»½è®¤è¯ï¼Œæä¾›äº†ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š èº«ä»½è®¤è¯æ–¹å¼ è§£é‡Š world é»˜è®¤æ–¹å¼ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½å¯æ— æ¡ä»¶è®¿é—®ï¼Œç»„åˆå½¢å¼ä¸ºï¼šworld:anyone:[permissions] digest ç”¨æˆ·å:å¯†ç è®¤è¯æ–¹å¼ï¼Œæœ€å¸¸ç”¨ï¼Œç»„åˆå½¢å¼ä¸ºï¼šdigest:username:BASE64(SHA1(password)):[permissions] ip å¯¹æŒ‡å®šipè¿›è¡Œé™åˆ¶ï¼Œç»„åˆå½¢å¼ä¸ºï¼šip:127.0.0.1:[permissions] auth è®¤è¯ç™»å½•å½¢å¼ï¼Œéœ€è¦ç”¨æˆ·è·å–æƒé™åæ‰å¯è®¿é—®ï¼Œç»„åˆå½¢å¼ä¸º auth:userpassword:[permissions] å¯¹äºznodeæƒé™ï¼Œæä¾›äº†ä»¥ä¸‹5ç§æ“ä½œæƒé™ã€‚ æƒé™ ç®€å†™ è§£é‡Š CREATE C å…è®¸æˆæƒå¯¹è±¡åœ¨å½“å‰èŠ‚ç‚¹ä¸‹åˆ›å»ºå­èŠ‚ç‚¹ DELETE D å…è®¸æˆæƒå¯¹è±¡åœ¨å½“å‰èŠ‚ç‚¹ä¸‹åˆ é™¤å­èŠ‚ç‚¹ WRITE W å…è®¸æˆæƒå¯¹è±¡åœ¨å½“å‰èŠ‚ç‚¹è¿›è¡Œæ›´æ–°æ“ä½œ READ R å…è®¸æˆæƒå¯¹è±¡åœ¨å½“å‰èŠ‚ç‚¹è·å–èŠ‚ç‚¹å†…å®¹æˆ–è·å–å­èŠ‚ç‚¹åˆ—è¡¨ ADMIN A å…è®¸æˆæƒå¯¹è±¡å¯¹å½“å‰èŠ‚ç‚¹è¿›è¡ŒACLç›¸å…³çš„è®¾ç½®æ“ä½œ 2 å‘½ä»¤è¡Œä½¿ç”¨ä½¿ç”¨Zookeeperä¸‹çš„bin/zkCli.shè¿›å…¥å‘½ä»¤è¡Œ bin/zkCli.sh -server host:port ç›¸å…³å‘½ä»¤æœ‰ï¼š ZooKeeper -server host:port cmd args addauth scheme auth close config [-c] [-w] [-s] connect host:port create [-s] [-e] [-c] [-t ttl] path [data] [acl] delete [-v version] path deleteall path delquota [-n|-b] path get [-s] [-w] path getAcl [-s] path history listquota path ls [-s] [-w] [-R] path ls2 path [watch] printwatches on|off quit reconfig [-s] [-v version] [[-file path] | [-members serverID=host:port1:port2;port3[,...]*]] | [-add serverId=host:port1:port2;port3[,...]]* [-remove serverId[,...]*] redo cmdno removewatches path [-c|-d|-a] [-l] rmr path set [-s] [-v version] path data setAcl [-s] [-v version] [-R] path acl setquota -n|-b val path stat [-w] path sync pathå¸¸ç”¨å‘½ä»¤ï¼š ä½¿ç”¨ ls å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰znodeä¸­æ‰€åŒ…å«çš„å†…å®¹ ls [-s] [-w] [-R] pathæŸ¥çœ‹å½“å‰èŠ‚ç‚¹æ•°æ®å¹¶èƒ½çœ‹åˆ°æ›´æ–°æ¬¡æ•°ç­‰æ•°æ®ï¼Œwatchå¯ä»¥ç›‘æ§èŠ‚ç‚¹çš„å˜åŒ– ls2 path [watch]åˆ›å»ºèŠ‚ç‚¹ï¼Œå‚æ•°ï¼š-s å«æœ‰åºåˆ— -e ä¸´æ—¶ createè·å¾—èŠ‚ç‚¹çš„å€¼ï¼Œwatchå¯ä»¥ç›‘æ§å€¼çš„å˜åŒ– get path [watch]è®¾ç½®èŠ‚ç‚¹çš„å€¼ setæŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ statåˆ é™¤èŠ‚ç‚¹(deleteallé€’å½’åˆ é™¤) delete deleteall2.1 ç¤ºä¾‹åœ¨ä¸Šæ¬¡ZABåè®®æ¦‚è¿°å’ŒZookeeperé›†ç¾¤æ­å»ºæ­å»ºçš„é›†ç¾¤å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹å®¢æˆ·ç«¯ï¼š bin/zkCli.sh -server localhost:2181è¾“å…¥ä»¥ä¸‹å‘½ä»¤å¹¶æ‰§è¡Œï¼š [zk: localhost:2181(CONNECTED) 0] ls / [zookeeper]åˆ›å»ºèŠ‚ç‚¹/app1å¹¶å†æ¬¡æŸ¥çœ‹æ ¹èŠ‚ç‚¹ [zk: localhost:2181(CONNECTED) 1] create /app1 Created /app1 [zk: localhost:2181(CONNECTED) 2] ls / [app1, zookeeper]åˆ›å»ºèŠ‚ç‚¹/app1/nameå¹¶æŸ¥çœ‹çŠ¶æ€ï¼š [zk: localhost:2181(CONNECTED) 3] create /app1/name rhett Created /app1/name [zk: localhost:2181(CONNECTED) 4] stat /app1/name cZxid = 0x10000000b ctime = Tue Mar 17 19:13:54 CST 2020 mZxid = 0x10000000b mtime = Tue Mar 17 19:13:54 CST 2020 pZxid = 0x10000000b cversion = 0 dataVersion = 0 aclVersion = 0 ephemeralOwner = 0x0 dataLength = 5 numChildren = 0è·å–/app1/nameçš„å€¼ï¼š [zk: localhost:2181(CONNECTED) 5] get /app1/name rhettæ¢ä¸€å°zkèŠ‚ç‚¹ï¼Œæ‰“å¼€å®¢æˆ·ç«¯ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š [zk: localhost:2182(CONNECTED) 0] ls / [app1, zookeeper] [zk: localhost:2182(CONNECTED) 1] get /app1/name rhett [zk: localhost:2182(CONNECTED) 2] set /app1/name another [zk: localhost:2182(CONNECTED) 3] stat /app1/name cZxid = 0x10000000b ctime = Tue Mar 17 19:13:54 CST 2020 mZxid = 0x100000014 mtime = Tue Mar 17 20:12:16 CST 2020 pZxid = 0x10000000b cversion = 0 dataVersion = 1 aclVersion = 0 ephemeralOwner = 0x0 dataLength = 7 numChildren = 03 javaä½¿ç”¨zookeeper apimavenä¾èµ–ï¼š &lt;dependency> &lt;groupId>org.apache.zookeeper&lt;/groupId> &lt;artifactId>zookeeper&lt;/artifactId> &lt;version>3.5.7&lt;/version> &lt;/dependency> @Test public void test() throws IOException, KeeperException, InterruptedException { //åˆ›å»ºzookeeperè¿æ¥ ZooKeeper zooKeeper = new ZooKeeper(\"localhost:2181\", 2000, new Watcher() { public void process(WatchedEvent watchedEvent) { System.out.println(\"è§¦å‘äº†\" + watchedEvent.getType()+\"çš„äº‹ä»¶\"); } }); //åˆ›å»ºçˆ¶èŠ‚ç‚¹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è·¯å¾„ï¼Œç¬¬äºŒä¸ªå‚æ•°å€¼ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æƒé™ï¼Œç¬¬å››ä¸ªå‚æ•°èŠ‚ç‚¹ç±»å‹ String path = zooKeeper.create(\"/app2\", \"app2Value\".getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT); System.out.println(path); //åˆ›å»ºå­èŠ‚ç‚¹ String childrenPath = zooKeeper.create(\"/app2/children\", \"childrenValue\".getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT); System.out.println(childrenPath); //è·å–èŠ‚ç‚¹ä¸­çš„å€¼ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è·¯å¾„ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¦ç›‘å¬ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°stat byte[] data = zooKeeper.getData(\"/app2\", false, null); System.out.println(new String(data)); List&lt;String> children = zooKeeper.getChildren(\"/app2\", false); for (String child : children) { System.out.println(child); } //ä¿®æ”¹å€¼ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è·¯å¾„ï¼Œç¬¬äºŒä¸ªå‚æ•°å€¼ //ç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡å®šç‰ˆæœ¬å·ï¼Œå³znodeçš„dataVersionï¼Œå¯ä»¥ä¿è¯æ“ä½œçš„é¡ºåºæ€§ï¼Œ-1å¯åŒ¹é…ä»»ä½•ç‰ˆæœ¬ã€‚ Stat stat = zooKeeper.setData(\"/app2\", \"app2Update\".getBytes(), -1); System.out.println(stat); //åˆ¤æ–­æŸä¸ªèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¦ç›‘å¬ Stat exists = zooKeeper.exists(\"/app2/children\", false); System.out.println(exists); //åˆ é™¤èŠ‚ç‚¹ï¼Œç¬¬äºŒä¸ªå‚æ•°ç‰ˆæœ¬å· zooKeeper.delete(\"/app2/children\",-1); Stat stillExists = zooKeeper.exists(\"/app2/children\", false); System.out.println(stillExists); }","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"https://www.codetool.top/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"},{"name":"zookeeper","slug":"zookeeper","permalink":"https://www.codetool.top/tags/zookeeper/"}]},{"title":"ZABåè®®æ¦‚è¿°å’ŒZookeeperé›†ç¾¤æ­å»º","slug":"ZABåè®®æ¦‚è¿°å’ŒZookeeperé›†ç¾¤æ­å»º","date":"2020-03-17T08:13:10.000Z","updated":"2020-03-17T13:39:52.912Z","comments":true,"path":"article/ZABåè®®æ¦‚è¿°å’ŒZookeeperé›†ç¾¤æ­å»º/","link":"","permalink":"https://www.codetool.top/article/ZAB%E5%8D%8F%E8%AE%AE%E6%A6%82%E8%BF%B0%E5%92%8CZookeeper%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/","excerpt":"","text":"æ¨èé˜…è¯»ï¼š åˆ†å¸ƒå¼ä¸€è‡´æ€§ç†è®ºå’Œä¸€è‡´æ€§åè®®2PCã€3PC æ‹œå åº­å°†å†›é—®é¢˜å’Œå…±è¯†ç®—æ³•Paxosã€Raft 1 Zookeeperæ¦‚è¿°Zookeeper ä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›äº†é«˜æ•ˆä¸”å¯é çš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œæä¾›äº†è¯¸å¦‚ç»Ÿä¸€å‘½åæœåŠ¡ã€å‘å¸ƒè®¢é˜…ã€è´Ÿè½½å‡è¡¡ã€é…ç½®ç®¡ç†å’Œåˆ†å¸ƒå¼é”ç­‰åˆ†å¸ƒå¼çš„åŸºç¡€æœåŠ¡ã€‚ è®¾è®¡ç›®æ ‡æ˜¯å°†é‚£äº›å¤æ‚ä¸”å®¹æ˜“å‡ºé”™çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§æœåŠ¡å°è£…èµ·æ¥ï¼Œæ„æˆä¸€ä¸ªé«˜æ•ˆå¯é çš„åŸè¯­é›†ï¼Œå¹¶ä»¥ä¸€ç³»åˆ—ç®€å•æ˜“ç”¨çš„æ¥å£æä¾›ç»™ç”¨æˆ·ä½¿ç”¨ã€‚ å¯ä»¥ä¿è¯ä»¥ä¸‹ç‰¹æ€§ï¼š é¡ºåºä¸€è‡´æ€§ï¼šä»åŒä¸€ä¸ªå®¢æˆ·ç«¯å‘èµ·çš„äº‹åŠ¡è¯·æ±‚ï¼Œæœ€ç»ˆå°†ä¼šä¸¥æ ¼åœ°æŒ‰ç…§å…¶å‘èµ·é¡ºåºè¢«åº”ç”¨åˆ° Zookeeper ä¸­ã€‚ åŸå­æ€§ï¼šè¦ä¹ˆé›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨éƒ½æˆåŠŸåº”ç”¨äº†æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè¦ä¹ˆéƒ½æ²¡æœ‰åº”ç”¨ã€‚ å•ä¸€è§†å›¾ï¼šæ— è®ºå®¢æˆ·ç«¯è¿æ¥çš„æ˜¯å“ªä¸€ä¸ª Zookeeper æœåŠ¡å™¨ï¼Œå…¶çœ‹åˆ°çš„æœåŠ¡ç«¯æ•°æ®æ¨¡å‹éƒ½æ˜¯ä¸€è‡´æ€§çš„ å¯é æ€§ï¼šä¸€æ—¦æœåŠ¡ç«¯æˆåŠŸåº”ç”¨äº†æŸä¸ªäº‹åŠ¡ï¼Œå¹¶å®Œæˆå¯¹å®¢æˆ·ç«¯çš„å“åº”ï¼Œé‚£ä¹ˆè¯¥äº‹åŠ¡æ‰€å¼•èµ·çš„æœåŠ¡ç«¯çŠ¶æ€å˜æ›´å°†ä¼šè¢«ä¸€ç›´ä¿ç•™ä¸‹æ¥ã€‚ å®æ—¶æ€§ï¼šZookeeper èƒ½ä¿è¯åœ¨ä¸€å®šçš„æ—¶é—´æ®µå†…ï¼Œå®¢æˆ·ç«¯æœ€ç»ˆä¸€å®šèƒ½å¤Ÿä»æœåŠ¡ç«¯ä¸Šè¯»å–åˆ°æœ€æ–°çš„æ•°æ®çŠ¶æ€ã€‚ 2 ZABåè®®ZABï¼ˆzookeeper atomic broadcastï¼‰æ˜¯Zookeeperé‡‡ç”¨çš„åè®®ï¼Œæ˜¯ä¸€ç§æ”¯æŒå´©æºƒæ¢å¤çš„åŸå­å¹¿æ’­åè®®ï¼ŒåŸºäºmulti paxoså®ç°ã€‚ 2.1 ä¸‰ç§è§’è‰² leaderleaderè´Ÿè´£å¤„ç†é›†ç¾¤çš„å†™è¯·æ±‚ï¼Œå¹¶å‘èµ·æŠ•ç¥¨ï¼Œåªæœ‰è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹åŒæ„åæ‰ä¼šæäº¤è¯¥å†™è¯·æ±‚ followerå¤„ç†è¯»è¯·æ±‚ï¼Œå“åº”ç»“æœã€‚è½¬å‘å†™è¯·æ±‚åˆ°leaderï¼Œåœ¨é€‰ä¸¾leaderè¿‡ç¨‹ä¸­å‚ä¸æŠ•ç¥¨ observerobserverå¯ä»¥ç†è§£ä¸ºæ²¡æœ‰æŠ•ç¥¨æƒçš„followerï¼Œä¸»è¦èŒè´£æ˜¯ååŠ©followerå¤„ç†è¯»è¯·æ±‚ã€‚é‚£ä¹ˆå½“æ•´ä¸ªzké›†ç¾¤è¯»è¯·æ±‚è´Ÿè½½å¾ˆé«˜æ—¶ï¼Œä¸ºä»€ä¹ˆä¸å¢åŠ followerèŠ‚ç‚¹å‘¢ï¼ŸåŸå› æ˜¯å¢åŠ followerèŠ‚ç‚¹ä¼šè®©leaderåœ¨æå‡ºå†™è¯·æ±‚ææ¡ˆæ—¶ï¼Œéœ€è¦åŠæ•°ä»¥ä¸Šçš„followeræŠ•ç¥¨èŠ‚ç‚¹åŒæ„ï¼Œè¿™æ ·ä¼šå¢åŠ leaderå’Œfollowerçš„é€šä¿¡é€šä¿¡å‹åŠ›ï¼Œé™ä½å†™æ“ä½œæ•ˆç‡ã€‚ ZooKeeperä½¿ç”¨å•ä¸€ä¸»è¿›ç¨‹Leaderç”¨äºå¤„ç†å®¢æˆ·ç«¯æ‰€æœ‰äº‹åŠ¡è¯·æ±‚ï¼Œå³å†™è¯·æ±‚ã€‚å½“æœåŠ¡å™¨æ•°æ®å‘ç”Ÿå˜æ›´ï¼Œé›†ç¾¤é‡‡ç”¨ZABåŸå­å¹¿æ’­åè®®ï¼Œä»¥äº‹åŠ¡æäº¤proposalçš„å½¢å¼å¹¿æ’­åˆ°æ‰€æœ‰çš„å‰¯æœ¬è¿›ç¨‹ï¼Œæ¯ä¸€ä¸ªäº‹åŠ¡åˆ†é…ä¸€ä¸ªå…¨å±€çš„é€’å¢çš„äº‹åŠ¡ç¼–å·xidã€‚ è‹¥å®¢æˆ·ç«¯æäº¤çš„è¯·æ±‚ä¸ºè¯»è¯·æ±‚æ—¶ï¼Œåˆ™æ¥å—è¯·æ±‚çš„èŠ‚ç‚¹ç›´æ¥æ ¹æ®è‡ªå·±ä¿å­˜çš„æ•°æ®å“åº”ã€‚è‹¥æ˜¯å†™è¯·æ±‚ï¼Œä¸”å½“å‰èŠ‚ç‚¹ä¸æ˜¯leaderï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹å°±ä¼šå°†è¯·æ±‚è½¬å‘ç»™leaderï¼Œleaderä¼šä»¥ææ¡ˆçš„æ–¹å¼å¹¿æ’­æ­¤å†™è¯·æ±‚ï¼Œå¦‚æœè¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹åŒæ„å†™è¯·æ±‚ï¼Œåˆ™è¯¥å†™è¯·æ±‚å°±ä¼šæäº¤ã€‚leaderä¼šé€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…åŒæ­¥æ•°æ®ã€‚ ZABçš„å·¥ä½œåŸºæœ¬å¯ä»¥åˆ†ä¸ºleaderé€‰ä¸¾é˜¶æ®µå’Œæ¶ˆæ¯å¹¿æ’­é˜¶æ®µï¼š 2.2 leaderé€‰ä¸¾å½“æœåŠ¡å¯åŠ¨æˆ–leaderå´©æºƒåï¼Œzkè¿›å…¥leaderé€‰ä¸¾é˜¶æ®µï¼Œleaderé€‰å‡ºåï¼Œå°†å®Œæˆleaderå’Œå…¶ä»–æœºå™¨çš„æ•°æ®åŒæ­¥ï¼Œå½“å¤§å¤šæ•°serverå®Œæˆå’Œleaderçš„åŒæ­¥åï¼Œè¯¥é˜¶æ®µç»“æŸã€‚ æ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸€ä¸ªzxidï¼šzxidä¸€ä¸ªæ˜¯64ä½é•¿åº¦çš„Longç±»å‹ï¼Œå…¶ä¸­é«˜32ä½è¡¨ç¤ºçºªå…ƒepochï¼Œä½32ä½è¡¨ç¤ºäº‹åŠ¡æ ‡è¯†xidã€‚å³zxidç”±ä¸¤éƒ¨åˆ†æ„æˆï¼šepochå’Œxidã€‚epochç±»ä¼¼äºraftçš„termï¼Œæ¯ä¸€ä¸ªæ–°çš„é€‰ä¸¾å¼€å¯æ—¶éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„epochï¼Œæ–°çš„leaderäº§ç”Ÿï¼Œä¼šæ›´æ–°æ‰€æœ‰çš„zkServerçš„zxidçš„epochï¼Œxidæ˜¯ä¸€ä¸ªä¾æ¬¡é€’å¢çš„äº‹åŠ¡ç¼–å·ã€‚ å¯åŠ¨è¿‡ç¨‹ æ¯ä¸€ä¸ª serverå‘å‡ºä¸€ä¸ªæŠ•ç¥¨ç»™é›†ç¾¤ä¸­å…¶ä»–èŠ‚ç‚¹ æ”¶åˆ°å„ä¸ªæœåŠ¡å™¨çš„æŠ•ç¥¨åï¼Œåˆ¤æ–­è¯¥æŠ•ç¥¨æœ‰æ•ˆæ€§ï¼Œæ¯”å¦‚æ˜¯å¦æ˜¯æœ¬è½®æŠ•ç¥¨ï¼Œæ˜¯å¦æ˜¯lookingçŠ¶æ€ å¤„ç†æŠ•ç¥¨ï¼Œ pkåˆ«äººçš„æŠ•ç¥¨å’Œè‡ªå·±çš„æŠ•ç¥¨ æ¯”è¾ƒè§„åˆ™xid&gt;myid â€œå–å¤§åŸåˆ™â€ ç»Ÿè®¡æ˜¯å¦è¶…è¿‡åŠæ•°çš„æ¥å—ç›¸åŒçš„é€‰ç¥¨ ç¡®è®¤ leaderï¼Œæ”¹å˜æœåŠ¡å™¨çŠ¶æ€ æ·»åŠ æ–° serverï¼Œleaderå·²ç»é€‰ä¸¾å‡ºæ¥ï¼Œåªèƒ½ä»¥followerèº«ä»½åŠ å…¥é›†ç¾¤ä¸­ æ³¨æ„ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥æŠ•å¤šç¥¨ï¼Œå³æ¯æ¬¡æ”¶åˆ°ç«é€‰ä¿¡æ¯çš„æ—¶å€™éƒ½å¯ä»¥å†³å®šæ˜¯å¦æŠ•ç¥¨ï¼Œè€Œä¸æ˜¯raftçš„å…ˆæ¥å…ˆå¾—ã€‚ å´©æºƒæ¢å¤è¿‡ç¨‹ leader æŒ‚æ‰åï¼Œé›†ç¾¤ä¸­å…¶ä»–followerä¼šå°†çŠ¶æ€ä»FOLLOWINGå˜ä¸ºLOOKINGï¼Œé‡æ–°è¿›å…¥leaderé€‰ä¸¾ åŒä¸Šå¯åŠ¨è¿‡ç¨‹ 2.3 æ¶ˆæ¯å¹¿æ’­ä¸€æ—¦Leaderå·²ç»å’Œå¤šæ•°çš„Followerè¿›è¡Œäº†çŠ¶æ€åŒæ­¥åï¼Œè¿›å…¥å¹¿æ’­æ¨¡å¼ã€‚è¿›å…¥å¹¿æ’­æ¨¡å¼åï¼Œå¦‚æœæœ‰æ–°åŠ å…¥çš„æœåŠ¡å™¨ï¼Œä¼šè‡ªåŠ¨ä»leaderä¸­åŒæ­¥æ•°æ®ã€‚leaderåœ¨æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚åï¼Œä¼šç”Ÿæˆäº‹åŠ¡ææ¡ˆå¹¿æ’­ç»™å…¶ä»–æœºå™¨ï¼Œæœ‰è¶…è¿‡åŠæ•°ä»¥ä¸Šçš„followeråŒæ„è¯¥æè®®åï¼Œå†æäº¤äº‹åŠ¡ã€‚æ³¨æ„åœ¨ZABçš„äº‹åŠ¡çš„äºŒé˜¶æ®µæäº¤ä¸­ï¼Œç§»é™¤äº†äº‹åŠ¡ä¸­æ–­çš„é€»è¾‘ï¼Œfollowerè¦ä¹ˆackï¼Œè¦ä¹ˆæ”¾å¼ƒï¼Œleaderæ— éœ€ç­‰å¾…æ‰€æœ‰çš„followerçš„ackã€‚ leader æ¥å—åˆ°æ¶ˆæ¯åï¼Œæ¶ˆæ¯é€šè¿‡å…¨å±€å”¯ä¸€çš„64ä½è‡ªå¢äº‹åŠ¡idï¼Œzxidæ ‡è¯† leader å‘é€ç»™followerçš„ææ¡ˆæ˜¯æœ‰åºçš„ï¼Œleaderä¼šåˆ›å»ºä¸€ä¸ªFIFOé˜Ÿåˆ—ï¼Œå°†ææ¡ˆé¡ºåºå†™å…¥é˜Ÿåˆ—ä¸­å‘é€ç»™follower follower æ¥å—åˆ°ææ¡ˆåï¼Œä¼šæ¯”è¾ƒææ¡ˆzxidå’Œæœ¬åœ°äº‹åŠ¡æ—¥å¿—æœ€å¤§çš„zxidï¼Œè‹¥ææ¡ˆzxidæ¯”æœ¬åœ°äº‹åŠ¡idå¤§ï¼Œå°†ææ¡ˆè®°å½•åˆ°æœ¬åœ°æ—¥å¿—ä¸­ï¼Œåé¦ˆackç»™leaderï¼Œå¦åˆ™æ‹’ç» leader æ¥æ”¶åˆ°è¿‡åŠackåï¼Œleaderå‘æ‰€æœ‰çš„followerå‘é€commitï¼Œé€šçŸ¥æ¯ä¸ªfolloweræ‰§è¡Œæœ¬åœ°äº‹åŠ¡ æ›´å¤šRaftå¯¹æ¯”ZABç›¸å…³å¯ä»¥å‚è€ƒï¼š Raftå¯¹æ¯”ZABåè®® - ä¹’ä¹“ç‹‚é­” - OSCHINA 3 Zookeeperé›†ç¾¤æ­å»ºzookeeperä¸‹è½½ï¼š wget https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/zookeeper-3.5.7/apache-zookeeper-3.5.7-bin.tar.gz ä¸‹è½½å®Œæˆåè§£å‹ï¼š tar -zxvf apache-zookeeper-3.5.7-bin.tar.gz è¿›å…¥æ–‡ä»¶å¤¹å¹¶åˆ›å»ºä¸€ä¸ªdataç›®å½•ï¼š cd apache-zookeeper-3.5.7-bin mkdir data æˆ‘ä»¬åœ¨å•æœºä½¿ç”¨ä¸‰ä¸ªzookeeperè¿›ç¨‹æ¥æ­å»ºä¼ªé›†ç¾¤ï¼š cd .. mv apache-zookeeper-3.5.7-bin zookeeper-01 cp -r zookeeper-01 zookeeper-02 cp -r zookeeper-01 zookeeper-03 ä¸ºæ¯ä¸ªzookeeperæ–‡ä»¶å¤¹ä¸‹çš„dataæ–‡ä»¶å¤¹æ–°å»ºä¸€ä¸ªmyidæ–‡ä»¶ï¼Œå†…å®¹åˆ†åˆ«ä¸º1ã€2ã€3 cd zookeeper-01/data vim myid å°†æ¯ä¸€ä¸ªzookeeperæ–‡ä»¶å¤¹ä¸‹çš„conf/zoo_sample.cfgé‡å‘½åä¸ºzoo.cfgï¼Œå¹¶ä¿®æ”¹å†…å®¹ï¼š mv zoo_sample.cfg zoo.cfg vim zoo.cfg é…ç½®æ–‡ä»¶ä¸­é»˜è®¤dataDir=/temp/zookeeperï¼Œä¿®æ”¹ä¸ºå„è‡ªç›®å½•ä¸‹çš„dataæ–‡ä»¶å¤¹ï¼Œå¹¶å°†zookeeper02ã€zookeeper03çš„ç«¯å£å·ä¿®æ”¹ä¸º2182å’Œ2183ï¼ˆé»˜è®¤ä¸º2181ï¼‰ # å®‰è£…çš„æ–‡ä»¶å¤¹ dataDir=/root/zookeeper-02/data clientPort=2182 å¹¶åœ¨æœ«å°¾æ·»åŠ ï¼š server.1=192.168.91.1:2881:3881 server.2=192.168.91.1:2882:3882 server.3=192.168.91.1:2883:3883å®ƒçš„æ ¼å¼æ˜¯ï¼šserver.æœåŠ¡å™¨ID=æœåŠ¡å™¨IPåœ°å€ï¼šæœåŠ¡å™¨ä¹‹é—´é€šä¿¡ç«¯å£ï¼šæœåŠ¡å™¨ä¹‹é—´æŠ•ç¥¨é€‰ä¸¾ç«¯å£ ä¿å­˜å¹¶é€€å‡ºï¼Œä¾æ¬¡å¯åŠ¨1ã€2ã€3ï¼š bin/zkServer.sh start æŒ‰ç…§ZABçš„æŠ•ç¥¨æœºåˆ¶ï¼Œ2å·ä¸»æœºå°†ä¼šæˆä¸ºleaderï¼š root@DESKTOP-TTLFG6F:~/zookeeper-02# bin/zkServer.sh status /usr/bin/java ZooKeeper JMX enabled by default Using config: /root/zookeeper-02/bin/../conf/zoo.cfg Client port found: 2182. Client address: localhost. Mode: leader","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"https://www.codetool.top/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"},{"name":"zookeeper","slug":"zookeeper","permalink":"https://www.codetool.top/tags/zookeeper/"}]},{"title":"leetcode1160-æ‹¼å†™å•è¯","slug":"leetcode1160-æ‹¼å†™å•è¯","date":"2020-03-16T17:04:10.000Z","updated":"2020-04-02T01:53:17.072Z","comments":true,"path":"article/leetcode1160-æ‹¼å†™å•è¯/","link":"","permalink":"https://www.codetool.top/article/leetcode1160-%E6%8B%BC%E5%86%99%E5%8D%95%E8%AF%8D/","excerpt":"","text":"1 åŸé¢˜ç»™ä½ ä¸€ä»½ã€è¯æ±‡è¡¨ã€ï¼ˆå­—ç¬¦ä¸²æ•°ç»„ï¼‰ words å’Œä¸€å¼ ã€å­—æ¯è¡¨ã€ï¼ˆå­—ç¬¦ä¸²ï¼‰ charsã€‚ å‡å¦‚ä½ å¯ä»¥ç”¨ chars ä¸­çš„ã€å­—æ¯ã€ï¼ˆå­—ç¬¦ï¼‰æ‹¼å†™å‡º words ä¸­çš„æŸä¸ªã€å•è¯ã€ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è®¤ä¸ºä½ æŒæ¡äº†è¿™ä¸ªå•è¯ã€‚ æ³¨æ„ï¼šæ¯æ¬¡æ‹¼å†™æ—¶ï¼Œchars ä¸­çš„æ¯ä¸ªå­—æ¯éƒ½åªèƒ½ç”¨ä¸€æ¬¡ã€‚ è¿”å›è¯æ±‡è¡¨ words ä¸­ä½ æŒæ¡çš„æ‰€æœ‰å•è¯çš„ é•¿åº¦ä¹‹å’Œã€‚ ç¤ºä¾‹ 1: è¾“å…¥ï¼š words = [â€œcatâ€,â€btâ€,â€hatâ€,â€treeâ€], chars = â€œatachâ€è¾“å‡ºï¼š 6è§£é‡Šï¼šå¯ä»¥å½¢æˆå­—ç¬¦ä¸² â€œcatâ€ å’Œ â€œhatâ€ï¼Œæ‰€ä»¥ç­”æ¡ˆæ˜¯ 3 + 3 = 6ã€‚ ç¤ºä¾‹ 2: è¾“å…¥ï¼š words = [â€œhelloâ€,â€worldâ€,â€leetcodeâ€], chars = â€œwelldonehoneyrâ€è¾“å‡ºï¼š 10è§£é‡Šï¼šå¯ä»¥å½¢æˆå­—ç¬¦ä¸² â€œhelloâ€ å’Œ â€œworldâ€ï¼Œæ‰€ä»¥ç­”æ¡ˆæ˜¯ 5 + 5 = 10ã€‚ æç¤ºï¼š 1 &lt;= words.length &lt;= 1000 1 &lt;= words[i].length, chars.length &lt;= 100 æ‰€æœ‰å­—ç¬¦ä¸²ä¸­éƒ½ä»…åŒ…å«å°å†™è‹±æ–‡å­—æ¯ 2 è§£æ³•2.1 æ€æƒ³æ•°ç»„ä¸‹æ ‡å¯¹åº”å­—æ¯è®¡æ•° æ—¶é—´å¤æ‚åº¦ï¼šO(n+mn) = O(mn)ï¼Œå…¶ä¸­mä¸ºwordsä¸­å­—ç¬¦ä¸²ä¸ªæ•°ï¼Œnä¸ºcharsçš„é•¿åº¦ã€‚ 2.2 ä»£ç class Solution { public int countCharacters(String[] words, String chars) { int[] count = new int[26]; for(char i:chars.toCharArray()) count[i-'a'] +=1; int sum = 0; for(String i:words){ int[] charCount = new int[26]; boolean known = true; for(char c:i.toCharArray()){ if(++charCount[c-'a']>count[c-'a']) known = false; } if(known) sum += i.length(); } return sum; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ‹œå åº­å°†å†›é—®é¢˜å’Œå…±è¯†ç®—æ³•Paxosã€Raft","slug":"æ‹œå åº­å°†å†›é—®é¢˜å’Œå…±è¯†ç®—æ³•Paxosã€Raft","date":"2020-03-16T16:44:46.000Z","updated":"2020-03-25T04:40:05.296Z","comments":true,"path":"article/æ‹œå åº­å°†å†›é—®é¢˜å’Œå…±è¯†ç®—æ³•Paxosã€Raft/","link":"","permalink":"https://www.codetool.top/article/%E6%8B%9C%E5%8D%A0%E5%BA%AD%E5%B0%86%E5%86%9B%E9%97%AE%E9%A2%98%E5%92%8C%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95Paxos%E3%80%81Raft/","excerpt":"","text":"æœ¬æ–‡å¹¶ä¸ä¼šå¯¹æ¯ç§ç®—æ³•è¿›è¡Œæ·±å…¥ï¼Œæˆ‘åªæ˜¯å‚è€ƒäº†éƒ¨åˆ†ç½‘ä¸Šçš„åšå®¢å’Œæ•´ç†çš„èµ„æ–™ï¼Œä¹Ÿåªæ˜¯å¤„äºä¸€ç§æ‡µæ‡‚çš„çŠ¶æ€ã€‚ æœ¬æ–‡å‚è€ƒèµ„æºï¼š Paxosç®—æ³• - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦ raftåè®®åº”ç”¨æ–¹é¢çš„ç–‘é—®ï¼Ÿ - çŸ¥ä¹ å¦‚ä½•æµ…æ˜¾æ˜“æ‡‚åœ°è§£è¯´ Paxos çš„ç®—æ³•ï¼Ÿ - çŸ¥ä¹ ä¸€è‡´æ€§ç®—æ³•ï¼ˆPaxosã€Raftã€ZABï¼‰_å“”å“©å“”å“© (ã‚œ-ã‚œ)ã¤ãƒ­ å¹²æ¯~-bilibili ä¸€æ–‡ææ‡‚Raftç®—æ³• - xybaby - åšå®¢å›­ä¸€æ–‡ææ‡‚Raftç®—æ³• - xybaby - åšå®¢å›­ è¿˜æœ‰ä¸€äº›æ²¡è®°ä¸‹æ¥ï¼Œç ”ç©¶è¿™äº›ä¸œè¥¿æœ‰è‹±æ–‡èƒ½åŠ›çš„è¿˜æ˜¯å°½é‡å»è¯»å‘æ˜è€…æ‰€è‘—è®ºæ–‡å§ã€‚ã€‚ 1 æ‹œå åº­å°†å†›é—®é¢˜æ‹œå åº­å¸å›½æœ‰è®¸å¤šæ”¯å†›é˜Ÿï¼Œä¸åŒå†›é˜Ÿçš„å°†å†›ä¹‹é—´å¿…é¡»åˆ¶å®šä¸€ä¸ªç»Ÿä¸€çš„è¡ŒåŠ¨è®¡åˆ’ï¼Œä»è€Œåšå‡ºä»…ä¾›æˆ–è€…æ’¤é€€çš„å†³å®šï¼ŒåŒæ—¶ï¼Œå„ä¸ªå°†å†›åœ¨åœ°ç†ä¸Šéƒ½æ˜¯è¢«åˆ†éš”å¼€çš„ï¼Œåªèƒ½ä¾é å†›é˜Ÿçš„é€šè®¯å‘˜æ¥è¿›è¡Œé€šè®¯ã€‚ç„¶è€Œï¼Œåœ¨æ‰€æœ‰çš„é€šè®¯å‘˜ä¸­å¯èƒ½ä¼šå­˜åœ¨å›å¾’ï¼Œè¿™äº›å›å¾’å¯ä»¥ç¯¡æ”¹ä¿¡æ¯ï¼Œä»è€Œè¾¾åˆ°æ¬ºéª—å°†å†›çš„ç›®çš„ã€‚ ä¸ºäº†è§£å†³ç½‘ç»œåˆ†åŒºæƒ…å†µä¸‹ï¼Œéƒ¨åˆ†èŠ‚ç‚¹ä¹‹é—´çš„é€šè®¯å¯èƒ½å‡ºç°æ¶ˆå¤±ä¸¢å¤±æˆ–æ¶ˆæ¯è¢«ç¯¡æ”¹çš„æƒ…å†µã€‚è¡ç”Ÿå‡ºäº†å‡ ç§å…±è¯†ç®—æ³•ï¼š 2 Basic PaxosPaxosæ˜¯æ—©æœŸçš„å…±è¯†ç®—æ³•ï¼Œç”±æ‹œå åº­å°†å†›é—®é¢˜çš„æå‡ºè€… Leslie Lamport æ‰€å‘æ˜ã€‚è°·æ­Œçš„åˆ†å¸ƒå¼é”æœåŠ¡ Chubby å°±æ˜¯ä»¥ Paxos ç®—æ³•ä¸ºåŸºç¡€ã€‚ åœ¨å¤å¸Œè…Šæœ‰ä¸€ä¸ªå«åš Paxos çš„å°å²›ï¼Œå²›ä¸Šé‡‡ç”¨è®®ä¼šçš„å½¢å¼æ¥é€šè¿‡æ³•ä»¤ï¼Œè®®ä¼šä¸­çš„è®®å‘˜é€šè¿‡ä¿¡ä½¿è¿›è¡Œæ¶ˆæ¯çš„ä¼ é€’ã€‚è®®å‘˜å’Œä¿¡ä½¿éƒ½æ˜¯å…¼èŒçš„ï¼Œä»–ä»¬éšæ—¶æœ‰å¯èƒ½ä¼šç¦»å¼€è®®ä¼šå…ï¼Œå¹¶ä¸”ä¿¡ä½¿å¯èƒ½ä¼šé‡å¤åœ°ä¼ é€’æ¶ˆæ¯ï¼Œä¹Ÿå¯èƒ½ä¸€å»ä¸å¤è¿”ã€‚å› æ­¤ï¼Œè®®ä¼šåè®®è¦ä¿è¯åœ¨è¿™ç§æƒ…å†µä¸‹æ³•ä»¤ä»ç„¶èƒ½å¤Ÿæ­£ç¡®çš„äº§ç”Ÿï¼Œå¹¶ä¸”ä¸ä¼šå‡ºç°å†²çªã€‚ Paxosç®—æ³•å‡è®¾æ²¡æœ‰æ‹œå åº­å°†å†›é—®é¢˜ï¼Œå³è™½ç„¶æœ‰å¯èƒ½ä¸€ä¸ªæ¶ˆæ¯è¢«ä¼ é€’äº†ä¸¤æ¬¡ï¼Œä½†æ˜¯ç»å¯¹ä¸ä¼šå‡ºç°é”™è¯¯çš„æ¶ˆæ¯ã€‚ paxosæœ‰ä¸‰ä¸ªç‰ˆæœ¬ï¼š Basic Paxos Multi Paxos Fast Paxos åœ¨paxosç®—æ³•ä¸­ï¼Œæœ‰å››ç§è§’è‰²ï¼Œåˆ†åˆ«å…·æœ‰ä¸‰ç§ä¸åŒçš„è¡Œä¸ºï¼Œä½†å¤šæ•°æƒ…å†µï¼Œä¸€ä¸ªè¿›ç¨‹å¯èƒ½åŒæ—¶å……å½“å¤šç§è§’è‰²ã€‚ client ï¼šç³»ç»Ÿå¤–éƒ¨è§’è‰²ï¼Œè¯·æ±‚å‘èµ·è€…ï¼Œä¸å‚ä¸å†³ç­– proposer ï¼šææ¡ˆæè®®è€…ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰ acceptor ï¼šææ¡ˆçš„è¡¨å†³è€…ï¼Œå³æ˜¯å¦acceptè¯¥ææ¡ˆï¼Œåªæœ‰è¶…è¿‡åŠæ•°ä»¥ä¸Šçš„acceptoræ¥å—äº†ææ¡ˆï¼Œè¯¥ææ¡ˆæ‰è¢«è®¤ä¸ºè¢«â€œé€‰å®šâ€ï¼ˆè‡³å°‘ä¸‰ä¸ªï¼Œå¿…é¡»å•æ•°ï¼‰ learners ï¼šææ¡ˆçš„å­¦ä¹ è€…ï¼Œå½“ææ¡ˆè¢«é€‰å®šåï¼Œå…¶åŒæ­¥æ‰§è¡Œææ¡ˆï¼Œä¸å‚ä¸å†³ç­– paxosç®—æ³•çš„æ€æƒ³æ˜¯ï¼Œproposer å°†å‘èµ·ææ¡ˆï¼ˆvalueï¼‰ç»™æ‰€æœ‰ accpetorï¼Œè¶…è¿‡åŠæ•° accpetor è·å¾—æ‰¹å‡†åï¼Œproposerå°†ææ¡ˆå†™å…¥ accpetor å†…ï¼Œæœ€ç»ˆæ‰€æœ‰ accpetor è·å¾—ä¸€è‡´æ€§çš„ç¡®å®šæ€§å–å€¼ï¼Œä¸”åç»­ä¸å…è®¸å†ä¿®æ”¹ã€‚learnersåªèƒ½â€œå­¦ä¹ â€è¢«æ‰¹å‡†çš„ææ¡ˆã€‚ Paxosç®—æ³•åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šprepareé˜¶æ®µã€accepté˜¶æ®µï¼Œè¿™ä¸¤ä¸ªé˜¶æ®µæ˜¯é’ˆå¯¹proposerçš„ï¼Œå¤šä¸ªproposerè¿›å…¥accpetçš„æ—¶é—´å…·æœ‰å…ˆåé¡ºåºã€‚ 2.1 Prepareé˜¶æ®µ proposeræå‡ºä¸€ä¸ªææ¡ˆï¼Œç¼–å·ä¸ºN,å‘é€ç»™æ‰€æœ‰çš„acceptorã€‚ï¼ˆProposal Numberï¼šæè®®ç¼–å·ï¼Œå¯ç†è§£ä¸ºæè®®ç‰ˆæœ¬å·ï¼Œè¦æ±‚ä¸èƒ½å†²çªï¼Œæ¯æ¬¡ç”Ÿæˆå¿…é¡»æ˜¯é€’å¢çš„ï¼‰ æ¯ä¸ªacceptoréƒ½ä¿å­˜è‡ªå·±çš„acceptçš„æœ€å¤§ææ¡ˆç¼–å·maxNï¼Œå½“acceptoræ”¶åˆ°prepare(N)è¯·æ±‚æ—¶ï¼Œä¼šæ¯”è¾ƒNä¸maxNçš„å€¼ï¼Œè‹¥Nå°äºmaxN,åˆ™ææ¡ˆå·²è¿‡æ—¶ï¼Œæ‹’ç»prepare(N)è¯·æ±‚ã€‚è‹¥Nå¤§äºç­‰äºmaxNï¼Œåˆ™æ¥å—ææ¡ˆï¼Œå¹¶å°†è¯¥acceptoræ›¾ç»æ¥å—è¿‡çš„ç¼–å·æœ€å¤§çš„ææ¡ˆProposal(myid,maxN,value)åé¦ˆç»™proposerï¼šå…¶ä¸­myidè¡¨ç¤ºacceptorçš„æ ‡è¯†idï¼ŒmaxNè¡¨ç¤ºæ¥å—è¿‡çš„æœ€å¤§ææ¡ˆç¼–å·maxNï¼Œvalueè¡¨ç¤ºææ¡ˆå†…å®¹ã€‚è‹¥å½“å‰acceptoræœªæ›¾acceptä»»ä½•æè®®ï¼Œä¼šå°†proposal(myid,null,null)åé¦ˆç»™æè®®è€…ã€‚ acceptoråœ¨æ¥æ”¶ææ¡ˆä¹‹ååšå‡ºä¸¤ä¸ªä¿è¯ï¼ˆPromiseï¼‰ï¼š ä¸å†æ¥å—Proposal Numberå°äºç­‰äºï¼ˆæ³¨æ„ï¼šè¿™é‡Œæ˜¯&lt;= ï¼‰å½“å‰è¯·æ±‚çš„Prepareè¯·æ±‚ã€‚ ä¸å†æ¥å—Proposal Numberå°äºï¼ˆæ³¨æ„ï¼šè¿™é‡Œæ˜¯&lt; ï¼‰å½“å‰è¯·æ±‚çš„Proposeè¯·æ±‚ã€‚ 2.2 accept é˜¶æ®µ proposalå‘å‡ºprepare(N),è‹¥æ”¶åˆ°è¶…è¿‡åŠæ•°acceptorçš„åé¦ˆï¼Œproposalå°†çœŸæ­£çš„ææ¡ˆå†…å®¹proposal(N,value)å‘é€ç»™acceptorã€‚ acceptoræ¥å—æè®®è€…å‘é€çš„proposal(N,value)ææ¡ˆåï¼Œä¼šæ¯”è¾ƒè‡ªå·±æ›¾ç»acceptè¿‡çš„æœ€å¤§ææ¡ˆç¼–å·maxNå’Œåé¦ˆè¿‡çš„prepareçš„æœ€å¤§ç¼–å·ï¼Œè‹¥Nå¤§äºè¿™ä¸¤ä¸ªç¼–å·ï¼Œåˆ™å½“å‰è¡¨å†³è€…acceptè¯¥ææ¡ˆï¼Œå¹¶åé¦ˆç»™æè®®è€…ã€‚å¦åˆ™æ‹’ç»è¯¥æè®®ã€‚ï¼ˆæœ€åç¡®è®¤çš„æè®®åŸºæœ¬ä¸Šå°±æ˜¯ç‰ˆæœ¬å·æœ€æ–°çš„æè®®ï¼Œè€Œç‰ˆæœ¬å·æœ€æ–°çš„æè®®å†…å®¹æ°¸è¿œæ˜¯è¢«å¤§å¤šæ•°acceptoræ¥æ”¶ææ¡ˆå†…å®¹ï¼‰ è¢«æ‹’ç»çš„Proposerå¯ä»¥é‡æ–°è¿›å…¥Prepareé˜¶æ®µï¼Œå¹¶å°†è‡ªå·±çš„ææ¡ˆç¼–å·è‡ªå¢ã€‚ Basic Paxoså­˜åœ¨æ´»é”é—®é¢˜ï¼Œä¸¤ä¸ªProposersäº¤æ›¿PrepareæˆåŠŸï¼Œè€ŒAcceptå¤±è´¥ï¼Œå½¢æˆæ´»é”ï¼ˆLivelockï¼‰ã€‚ 3 Multi-PaxosMulti-Paxoså¼•å…¥äº†Leaderæ¦‚å¿µï¼Œå®ƒæ˜¯å”¯ä¸€çš„Proposerï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½éœ€ç»è¿‡Leaderã€‚ Multi-Paxosé¦–å…ˆéœ€è¦é€‰ä¸¾Leaderï¼ŒLeaderçš„ç¡®å®šä¹Ÿæ˜¯ä¸€æ¬¡å†³è®®çš„å½¢æˆï¼Œæ‰€ä»¥å¯æ‰§è¡Œä¸€æ¬¡Basic Paxoså®ä¾‹æ¥é€‰ä¸¾å‡ºä¸€ä¸ªLeaderã€‚ é€‰å‡ºLeaderä¹‹ååªèƒ½ç”±Leaderæäº¤Proposalï¼Œåœ¨Leaderå®•æœºä¹‹åæœåŠ¡ä¸´æ—¶ä¸å¯ç”¨ï¼Œéœ€è¦é‡æ–°é€‰ä¸¾Leaderç»§ç»­æœåŠ¡ã€‚åœ¨ç³»ç»Ÿä¸­ä»…æœ‰ä¸€ä¸ªLeaderè¿›è¡ŒProposalæäº¤çš„æƒ…å†µä¸‹ï¼ŒPrepareé˜¶æ®µå¯ä»¥è·³è¿‡ã€‚ Multi-Paxosé€šè¿‡æ”¹å˜Prepareé˜¶æ®µçš„ä½œç”¨èŒƒå›´è‡³åé¢Leaderæäº¤çš„æ‰€æœ‰å®ä¾‹ï¼Œä»è€Œä½¿å¾—Leaderçš„è¿ç»­æäº¤åªéœ€è¦æ‰§è¡Œä¸€æ¬¡Prepareé˜¶æ®µï¼Œåç»­åªéœ€è¦æ‰§è¡ŒAccepté˜¶æ®µï¼Œå°†ä¸¤é˜¶æ®µå˜ä¸ºä¸€é˜¶æ®µï¼Œæé«˜äº†æ•ˆç‡ã€‚ä¸ºäº†åŒºåˆ†è¿ç»­æäº¤çš„å¤šä¸ªå®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹ä½¿ç”¨ä¸€ä¸ªInstance IDæ ‡è¯†ï¼ŒInstance IDç”±Leaderæœ¬åœ°é€’å¢ç”Ÿæˆå³å¯ã€‚ Multi-Paxoså…è®¸æœ‰å¤šä¸ªè‡ªè®¤ä¸ºæ˜¯Leaderçš„èŠ‚ç‚¹å¹¶å‘æäº¤Proposalè€Œä¸å½±å“å…¶å®‰å…¨æ€§ï¼Œè¿™æ ·çš„åœºæ™¯å³é€€åŒ–ä¸ºBasic Paxosã€‚ Chubbyå’ŒBoxwoodå‡ä½¿ç”¨Multi-Paxosã€‚ZooKeeperä½¿ç”¨çš„ZABä¹Ÿæ˜¯Multi-Paxosçš„å˜å½¢ã€‚ 4 Raftä¹‹å‰å†™çš„åšå®¢Redisä¸»ä»å¤åˆ¶ã€å“¨å…µã€é›†ç¾¤è¯¦è§£ä¸­ï¼Œredisçš„å“¨å…µæœºåˆ¶sentinelå°±æ˜¯ä½¿ç”¨çš„raftæ€æƒ³ï¼Œæœ‰leader sentinelå’Œleaderé€‰ä¸¾ã€‚ RaftåŸºäºMulti-Paxosæ€æƒ³ï¼Œå®ƒæŠŠMulti-Paxosåˆ’åˆ†ä¸ºä¸‰ä¸ªå­é—®é¢˜ï¼š Leader Electionï¼šLeaderçš„é€‰ä¸¾ Log Replicationï¼šleaderåŒæ­¥logåˆ°å…¶ä»–èŠ‚ç‚¹ safetyï¼šä¿è¯è¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹çš„æ—¥å¿—ä¸ä¼šè¢«å›æ»š Raftå®šä¹‰çš„è§’è‰²ï¼š Leaderï¼š Followerï¼š Candidateï¼šå¦‚æœLeaderå¤±æ•ˆï¼ˆå®•æœºï¼‰ï¼Œfollowerä¸­ä¼šäº§ç”Ÿcandidateç«é€‰leader leaderä¼šä¸åœçš„ç»™followerå‘å¿ƒè·³æ¶ˆæ¯ï¼Œè¡¨æ˜è‡ªå·±çš„å­˜æ´»çŠ¶æ€ã€‚å¦‚æœleaderæ•…éšœï¼Œfollowerä¼šåœ¨ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°leaderçš„å¿ƒè·³åŒ…ï¼Œè¿‡äº†è¶…æ—¶æ—¶é—´é‚£ä¹ˆfollowerä¼šè½¬æ¢æˆcandidateï¼Œé‡æ–°é€‰å‡ºleaderã€‚ raftå®˜æ–¹å‚è€ƒï¼š https://raft.github.io/ http://thesecretlivesofdata.com/raft/ 4.1 Leader Electionleaderé€‰ä¸¾çš„è¿‡ç¨‹ï¼š å¢åŠ èŠ‚ç‚¹æœ¬åœ°çš„ current term ï¼Œåˆ‡æ¢åˆ°candidateçŠ¶æ€ æŠ•è‡ªå·±ä¸€ç¥¨ å¹¶è¡Œç»™å…¶ä»–èŠ‚ç‚¹å‘é€ RequestVote RPCs ç­‰å¾…å…¶ä»–èŠ‚ç‚¹çš„å›å¤ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ ¹æ®æ¥è‡ªå…¶ä»–èŠ‚ç‚¹çš„æ¶ˆæ¯ï¼Œå¯èƒ½å‡ºç°ä¸‰ç§ç»“æœ æ”¶åˆ°majorityçš„æŠ•ç¥¨ï¼ˆå«è‡ªå·±çš„ä¸€ç¥¨ï¼‰ï¼Œåˆ™èµ¢å¾—é€‰ä¸¾ï¼Œæˆä¸ºleader è¢«å‘ŠçŸ¥åˆ«äººå·²å½“é€‰ï¼Œé‚£ä¹ˆè‡ªè¡Œåˆ‡æ¢åˆ°follower ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°majorityæŠ•ç¥¨ï¼Œåˆ™ä¿æŒcandidateçŠ¶æ€ï¼Œé‡æ–°å‘å‡ºé€‰ä¸¾ ç¬¬ä¸€ç§æƒ…å†µï¼Œèµ¢å¾—äº†é€‰ä¸¾ä¹‹åï¼Œæ–°çš„leaderä¼šç«‹åˆ»ç»™æ‰€æœ‰èŠ‚ç‚¹å‘æ¶ˆæ¯ï¼Œå¹¿è€Œå‘Šä¹‹ï¼Œé¿å…å…¶ä½™èŠ‚ç‚¹è§¦å‘æ–°çš„é€‰ä¸¾ã€‚ è€Œä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ç»™å…¶ä»–èŠ‚ç‚¹æŠ•ç¥¨çš„åŸåˆ™æ˜¯ å¯¹æ–¹termï¼ˆä»»æœŸï¼‰ å’Œ log éƒ½è‡³å°‘å’Œè‡ªå·±çš„ä¸€æ ·æ–° å…ˆåˆ°å…ˆå¾— å¦‚æœå‡ºç°å¹³ç¥¨çš„æƒ…å†µï¼Œå„å€™é€‰äººä¼šäº§ç”Ÿä¸€ä¸ªéšæœºçš„timeoutä¹‹åé‡æ–°å‘èµ·ç«é€‰ï¼Œä¾æ®å…ˆåˆ°å…ˆå¾—åŸåˆ™ä¸ä¼šå†å¹³ç¥¨ã€‚ï¼ˆå¹¶ä¸”å¾ˆå¤šå®ç°æ˜¯éœ€è¦èŠ‚ç‚¹ä¸ªæ•°ä¸ºå¥‡æ•°ï¼‰ 4.2 log replicationå½“æœ‰äº†leaderï¼Œç³»ç»Ÿåº”è¯¥è¿›å…¥å¯¹å¤–å·¥ä½œæœŸäº†ã€‚å®¢æˆ·ç«¯çš„ä¸€åˆ‡è¯·æ±‚æ¥å‘é€åˆ°leaderï¼Œleaderæ¥è°ƒåº¦è¿™äº›å¹¶å‘è¯·æ±‚çš„é¡ºåºï¼Œå¹¶ä¸”ä¿è¯leaderä¸followersçŠ¶æ€çš„ä¸€è‡´æ€§ã€‚raftä¸­çš„åšæ³•æ˜¯ï¼Œå°†è¿™äº›è¯·æ±‚ä»¥åŠæ‰§è¡Œé¡ºåºå‘ŠçŸ¥followersã€‚leaderå’Œfollowersä»¥ç›¸åŒçš„é¡ºåºæ¥æ‰§è¡Œè¿™äº›è¯·æ±‚ï¼Œä¿è¯çŠ¶æ€ä¸€è‡´ã€‚ leaderå°†å®¢æˆ·ç«¯è¯·æ±‚ï¼ˆcommandï¼‰å°è£…åˆ°ä¸€ä¸ªä¸ªlog entryï¼Œå°†è¿™äº›log entrieså¤åˆ¶ï¼ˆreplicateï¼‰åˆ°æ‰€æœ‰followerèŠ‚ç‚¹ï¼Œç„¶åå¤§å®¶æŒ‰ç›¸åŒé¡ºåºåº”ç”¨ï¼ˆapplyï¼‰log entryä¸­çš„commandã€‚ä¸‹ä¸€æ¬¡çš„çš„å¿ƒè·³åŒ…followerç»™leaderè¿”å›ackï¼Œleaderå†æŠŠå“åº”è¿”å›ç»™è¯·æ±‚å‘èµ·è€…ï¼ˆClientï¼‰ã€‚ 4.3 safety4.3.1 Follower å®•æœºå½“ leader åœ¨ commit log æ—¶, æŸ follower å®•æœºï¼Œç„¶åè¿™ä¸ª follower åæ¥è¢«é€‰ä¸º leader,å®ƒä¼šè¦†ç›–æ‰ç°åœ¨ follwer é‚£äº›å·²ç» committed log, ç”±äºè¿™äº› log æ˜¯å·²ç»æ‰§è¡Œè¿‡çš„,æ‰€ä»¥ç»“æœä¸åŒçš„æœºå™¨å°±æ‰§è¡Œä¸åŒçš„æŒ‡ä»¤. åœ¨é€‰ä¸¾è¿‡ç¨‹ä¸­,å†åŠ å¤šä¸€ä¸ªé™åˆ¶å°±å¯ä»¥é˜²æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿ, å³: Leader completeness property:å¯¹äºä»»æ„ä¸€ä¸ª term, leader éƒ½è¦åŒ…å«æ‰€æœ‰åœ¨ä¹‹å‰ term é‡Œ committed çš„ logã€‚ 4.3.2 Leader å®•æœº4.3.2.1 æ•°æ®åˆ°è¾¾LeaderèŠ‚ç‚¹å‰è¿™ä¸ªé˜¶æ®µ Leader æŒ‚æ‰ä¸å½±å“ä¸€è‡´æ€§ 4.3.2.2 æ•°æ®åˆ°è¾¾LeaderèŠ‚ç‚¹ï¼Œä½†æœªå¤åˆ¶åˆ°FollowerèŠ‚ç‚¹è¿™ä¸ªé˜¶æ®µ Leader æŒ‚æ‰ï¼Œæ•°æ®å±äºæœªæäº¤çŠ¶æ€ï¼ŒClient ä¸ä¼šæ”¶åˆ° Ack ä¼šè®¤ä¸ºè¶…æ—¶å¤±è´¥å¯å®‰å…¨å‘èµ·é‡è¯•ã€‚Follower èŠ‚ç‚¹ä¸Šæ²¡æœ‰è¯¥æ•°æ®ï¼Œé‡æ–°é€‰ä¸»å Client é‡è¯•é‡æ–°æäº¤å¯æˆåŠŸã€‚åŸæ¥çš„ Leader èŠ‚ç‚¹æ¢å¤åä½œä¸º Follower åŠ å…¥é›†ç¾¤é‡æ–°ä»å½“å‰ä»»æœŸçš„æ–° Leader å¤„åŒæ­¥æ•°æ®ï¼Œå¼ºåˆ¶ä¿æŒå’Œ Leader æ•°æ®ä¸€è‡´ã€‚ 4.3.2.3 æ•°æ®åˆ°è¾¾LeaderèŠ‚ç‚¹ï¼ŒæˆåŠŸå¤åˆ¶åˆ°æ‰€æœ‰FollowerèŠ‚ç‚¹ï¼Œä½†è¿˜æœªå‘Leaderå“åº”æ¥æ”¶è¿™ä¸ªé˜¶æ®µ Leader æŒ‚æ‰ï¼Œè™½ç„¶æ•°æ®åœ¨ Follower èŠ‚ç‚¹å¤„äºæœªæäº¤çŠ¶æ€ï¼ˆUncommittedï¼‰ä½†ä¿æŒä¸€è‡´ï¼Œé‡æ–°é€‰å‡º Leader åå¯å®Œæˆæ•°æ®æäº¤ï¼Œæ­¤æ—¶ Client ç”±äºä¸çŸ¥åˆ°åº•æäº¤æˆåŠŸæ²¡æœ‰ï¼Œå¯é‡è¯•æäº¤ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µ Raft è¦æ±‚ RPC è¯·æ±‚å®ç°å¹‚ç­‰æ€§ï¼Œä¹Ÿå°±æ˜¯è¦å®ç°å†…éƒ¨å»é‡æœºåˆ¶ã€‚ 4.3.2.4 æ•°æ®åˆ°è¾¾LeaderèŠ‚ç‚¹ï¼ŒæˆåŠŸå¤åˆ¶åˆ°éƒ¨åˆ†FollowerèŠ‚ç‚¹ï¼Œä½†è¿˜æœªå‘Leaderå“åº”æ¥æ”¶è¿™ä¸ªé˜¶æ®µ Leader æŒ‚æ‰ï¼Œæ•°æ®åœ¨ Follower èŠ‚ç‚¹å¤„äºæœªæäº¤çŠ¶æ€ï¼ˆUncommittedï¼‰ä¸”ä¸ä¸€è‡´ï¼ŒRaft åè®®è¦æ±‚æŠ•ç¥¨åªèƒ½æŠ•ç»™æ‹¥æœ‰æœ€æ–°æ•°æ®çš„èŠ‚ç‚¹ã€‚æ‰€ä»¥æ‹¥æœ‰æœ€æ–°æ•°æ®çš„èŠ‚ç‚¹ä¼šè¢«é€‰ä¸ºLeader å†å¼ºåˆ¶åŒæ­¥æ•°æ®åˆ° Followerï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±å¹¶æœ€ç»ˆä¸€è‡´ã€‚ 4.3.2.5 æ•°æ®åˆ°è¾¾LeaderèŠ‚ç‚¹ï¼ŒæˆåŠŸå¤åˆ¶åˆ°Followeræ‰€æœ‰æˆ–å¤šæ•°èŠ‚ç‚¹ï¼Œæ•°æ®åœ¨æ‰€æœ‰èŠ‚ç‚¹éƒ½å¤„äºå·²æäº¤çŠ¶æ€ï¼Œä½†è¿˜æœªå“åº”Clientè¿™ä¸ªé˜¶æ®µ Leader æŒ‚æ‰ï¼Œé›†ç¾¤å†…éƒ¨æ•°æ®å…¶å®å·²ç»æ˜¯ä¸€è‡´çš„ï¼ŒClient é‡å¤é‡è¯•åŸºäºå¹‚ç­‰ç­–ç•¥å¯¹ä¸€è‡´æ€§æ— å½±å“ã€‚ 4.3.2.6 ç½‘ç»œåˆ†åŒºå¯¼è‡´çš„è„‘è£‚æƒ…å†µï¼Œå‡ºç°åŒ Leaderå¦‚æœå‡ºç°ç½‘ç»œåˆ†åŒºæƒ…å†µï¼Œå¯èƒ½ä¼šå‡ºç°ä¸¤è¾¹å„æ¨é€‰å‡ºä¸€ä¸ªleaderï¼Œä½†å¦‚æœleaderä¸èƒ½å°†logå¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ï¼ˆmajorityï¼‰ï¼Œå°±ä¸ä¼šç»™è¯·æ±‚å‘èµ·è€…è¿”å›æˆåŠŸæ¶ˆæ¯ï¼Œå¹¶è®©æ¥æ”¶åˆ°è‡ªå·±æ—¥å¿—å¤åˆ¶çš„è¯·æ±‚çš„èŠ‚ç‚¹å›æ»šã€‚ï¼ˆè¿˜æœ‰ä¸€ä¸ªlast_index, term_idä½œä¸ºleaderç«é€‰çš„ä¾æ®ï¼Œåªæœ‰æ‹¥æœ‰æœ€æ–°çš„redo logçš„candidateæ‰èƒ½æˆä¸ºleaderï¼‰ ç½‘ç»œæ¢å¤åæ—§çš„ Leader å‘ç°é›†ç¾¤ä¸­æœ‰æ›´æ–°ä»»æœŸï¼ˆTermï¼‰çš„æ–° Leader åˆ™è‡ªåŠ¨é™çº§ä¸ºFollower å¹¶ä»æ–° Leader å¤„åŒæ­¥æ•°æ®è¾¾æˆé›†ç¾¤æ•°æ®ä¸€è‡´ã€‚","categories":[{"name":"é¡¹ç›®/ç¼–ç¨‹ç†è®º","slug":"é¡¹ç›®-ç¼–ç¨‹ç†è®º","permalink":"https://www.codetool.top/categories/%E9%A1%B9%E7%9B%AE-%E7%BC%96%E7%A8%8B%E7%90%86%E8%AE%BA/"}],"tags":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"https://www.codetool.top/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"}]},{"title":"åˆ†å¸ƒå¼ä¸€è‡´æ€§ç†è®ºå’Œä¸€è‡´æ€§åè®®2PCã€3PC","slug":"åˆ†å¸ƒå¼ä¸€è‡´æ€§ç†è®ºå’Œä¸€è‡´æ€§åè®®2PCã€3PC","date":"2020-03-16T14:32:27.000Z","updated":"2020-03-25T04:40:05.296Z","comments":true,"path":"article/åˆ†å¸ƒå¼ä¸€è‡´æ€§ç†è®ºå’Œä¸€è‡´æ€§åè®®2PCã€3PC/","link":"","permalink":"https://www.codetool.top/article/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E7%90%86%E8%AE%BA%E5%92%8C%E4%B8%80%E8%87%B4%E6%80%A7%E5%8D%8F%E8%AE%AE2PC%E3%80%813PC/","excerpt":"","text":"1 åˆ†å¸ƒå¼ä¸€è‡´æ€§1.1 æ•°æ®çš„ä¸€è‡´æ€§æ¨¡å‹ å¼ºä¸€è‡´æ€§ï¼šè¦æ±‚æ— è®ºæ›´æ–°æ“ä½œå®åœ¨å“ªä¸€ä¸ªå‰¯æœ¬æ‰§è¡Œï¼Œä¹‹åæ‰€æœ‰çš„è¯»æ“ä½œéƒ½è¦èƒ½è·å¾—æœ€æ–°çš„æ•°æ®ã€‚ å¼±ä¸€è‡´æ€§ï¼šç”¨æˆ·è¯»åˆ°æŸä¸€æ“ä½œå¯¹ç³»ç»Ÿç‰¹å®šæ•°æ®çš„æ›´æ–°éœ€è¦ä¸€æ®µæ—¶é—´ï¼Œæˆ‘ä»¬ç§°è¿™æ®µæ—¶é—´ä¸ºâ€œä¸ä¸€è‡´æ€§çª—å£â€ã€‚ æœ€ç»ˆä¸€è‡´æ€§ï¼šæ˜¯å¼±ä¸€è‡´æ€§çš„ä¸€ç§ç‰¹ä¾‹ï¼Œä¿è¯ç”¨æˆ·æœ€ç»ˆèƒ½å¤Ÿè¯»å–åˆ°æŸæ“ä½œå¯¹ç³»ç»Ÿç‰¹å®šæ•°æ®çš„æ›´æ–°ã€‚ æ•°æ®çš„å¼ºä¸€è‡´æ€§è¦æ±‚å¦‚æœæ•°æ®ä¸ä¸€è‡´ï¼Œå°±ä¸å¯¹å¤–æä¾›æ•°æ®æœåŠ¡ï¼Œä¿è¯ç”¨æˆ·è¯»å–çš„æ•°æ®å§‹ç»ˆæ˜¯ä¸€è‡´çš„ã€‚æ•°æ®å¼ºä¸€è‡´æ€§åªéœ€è¦é€šè¿‡é”æœºåˆ¶å³å¯è§£å†³ã€‚ å¸¸ç”¨çš„é”å®ç°ç®—æ³•æœ‰ Lamport bakery algorithm ï¼ˆä¿—ç§°é¢åŒ…åº—ç®—æ³•ï¼‰ï¼Œ è¿˜æœ‰ Paxos ç®—æ³•ä»¥åŠä¹è§‚é”ã€‚ 1.2 CAPCAP å®šç†æ˜¯ 2000 å¹´ï¼Œç”± Eric Brewer æå‡ºæ¥çš„ã€‚Brewer è®¤ä¸ºåœ¨åˆ†å¸ƒå¼çš„ç¯å¢ƒä¸‹è®¾è®¡å’Œéƒ¨ç½²ç³»ç»Ÿæ—¶ï¼Œæœ‰ 3 ä¸ªæ ¸å¿ƒçš„éœ€æ±‚ï¼Œä»¥ä¸€ç§ç‰¹æ®Šçš„å…³ç³»å­˜åœ¨ã€‚è¿™é‡Œçš„åˆ†å¸ƒå¼ç³»ç»Ÿè¯´çš„æ˜¯åœ¨ç‰©ç†ä¸Šåˆ†å¸ƒçš„ç³»ç»Ÿã€‚ CAP ç†è®ºçš„æ ¸å¿ƒæ˜¯ï¼šä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶å¾ˆå¥½çš„æ»¡è¶³ä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§è¿™ä¸‰ä¸ªéœ€æ±‚ï¼Œæœ€å¤šåªèƒ½åŒæ—¶è¾ƒå¥½çš„æ»¡è¶³ä¸¤ä¸ªã€‚ Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ï¼šæ‰€æœ‰çš„èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´è¯»åˆ°ç›¸åŒçš„æ•°æ®ã€‚è¿™å°±æ˜¯æ•°æ®ä¸Šçš„ä¸€è‡´æ€§ï¼Œå½“æ•°æ®å†™å…¥æˆåŠŸåï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹ä¼šåŒæ—¶çœ‹åˆ°è¿™ä¸ªæ–°çš„æ•°æ® Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ï¼šä¿è¯æ— è®ºæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½èƒ½å¤Ÿæ”¶åˆ°ä¸€ä¸ªåé¦ˆã€‚è¿™å°±æ˜¯æ•°æ®çš„å¯ç”¨æ€§ã€‚é‡ç‚¹æ˜¯ç³»ç»Ÿä¸€å®šè¦æœ‰å“åº”ã€‚ Partition-Toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰ï¼šå³ä½¿ç³»ç»Ÿä¸­æœ‰éƒ¨åˆ†é—®é¢˜æˆ–è€…æœ‰æ¶ˆæ¯çš„ä¸¢å¤±ï¼Œç³»ç»Ÿä»èƒ½å¤Ÿç»§ç»­è¿è¡Œï¼Œè¿™è¢«ç§°ä¸ºåˆ†åŒºå®¹é”™æ€§ï¼Œä¹Ÿå°±æ˜¯åœ¨ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†å‡ºé—®é¢˜æ—¶ï¼Œç³»ç»Ÿä»èƒ½ç»§ç»­å·¥ä½œã€‚ å› ä¸ºåœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¸å¯èƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ã€å¯ç”¨æ€§ã€åˆ†åŒºå®¹é”™æ€§ï¼Œæœ€å¤šæ»¡è¶³ä¸¤ä¸ªï¼Œå‘å±•è€Œæ¥çš„æœ‰ä¸‰å¤§ç±»ç³»ç»Ÿï¼š CA - å•ç‚¹é›†ç¾¤ï¼Œæ»¡è¶³ä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§çš„ç³»ç»Ÿï¼Œé€šå¸¸åœ¨å¯æ‰©å±•æ€§ä¸Šä¸å¤ªå¼ºå¤§ã€‚ä¸€ç§è¾ƒä¸ºç®€å•çš„åšæ³•æ˜¯å°†æ‰€æœ‰çš„æ•°æ®ï¼ˆæˆ–è€…æ˜¯ä»…ä»…ä¸äº‹åŠ¡ç›¸å…³çš„æ•°æ®ï¼‰éƒ½æ”¾åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼èŠ‚ç‚¹ä¸Šã€‚è¿™æ ·çš„åšæ³•è™½ç„¶æ— æ³•100%åœ°ä¿è¯ç³»ç»Ÿä¸ä¼šå‡ºé”™ï¼Œä½†è‡³å°‘ä¸ä¼šç¢°åˆ°ç”±äºç½‘ç»œåˆ†åŒºå¸¦æ¥çš„è´Ÿé¢å½±å“ï¼Œæ”¾å¼ƒ P çš„åŒæ—¶ä¹Ÿæ„å‘³ç€æ”¾å¼ƒäº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€‚ CP - æ»¡è¶³ä¸€è‡´æ€§ï¼Œåˆ†åŒºå®¹é”™æ€§çš„ç³»ç»Ÿã€‚ ä¸€æ—¦ç³»ç»Ÿé‡åˆ°ç½‘ç»œåˆ†åŒºæˆ–è€…å…¶ä»–æ•…éšœæ—¶ï¼Œé‚£ä¹ˆå—åˆ°å½±å“çš„æœåŠ¡éœ€è¦ç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œå› æ­¤åœ¨ç­‰å¾…æœŸé—´ç³»ç»Ÿæ— æ³•å¯¹å¤–æä¾›æ­£å¸¸æœåŠ¡ï¼Œå³ä¸å¯ç”¨ã€‚ AP - æ»¡è¶³å¯ç”¨æ€§ï¼Œåˆ†åŒºå®¹é”™æ€§çš„ç³»ç»Ÿï¼Œé€šå¸¸å¯èƒ½å¯¹ä¸€è‡´æ€§è¦æ±‚ä½ä¸€äº›ã€‚æ”¾å¼ƒä¸€è‡´æ€§æŒ‡çš„æ˜¯æ”¾å¼ƒå¼ºä¸€è‡´æ€§ï¼Œè€Œä¿ç•™æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œè¿™æ ·çš„ç³»ç»Ÿæ— æ³•ä¿è¯æ•°æ®ä¿æŒå®æ—¶çš„ä¸€è‡´æ€§ï¼Œä½†æ˜¯èƒ½å¤Ÿæ‰¿è¯ºçš„æ˜¯ï¼Œæ•°æ®æœ€ç»ˆä¼šè¾¾åˆ°ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ã€‚è¿™å°±å¼•å…¥äº†ä¸€ä¸ªæ—¶é—´çª—å£çš„æ¦‚å¿µï¼Œå…·ä½“å¤šä¹…èƒ½å¤Ÿè¾¾åˆ°æ•°æ®ä¸€è‡´æ€§å–å†³äºç³»ç»Ÿçš„è®¾è®¡ï¼Œä¸»è¦åŒ…æ‹¬æ•°æ®å‰¯æœ¬åœ¨ä¸åŒèŠ‚ç‚¹ä¹‹é—´çš„å¤åˆ¶æ—¶é—´é•¿çŸ­ã€‚ å¯¹äºåˆ†å¸ƒå¼äº’è”ç½‘åº”ç”¨è€Œè¨€ï¼Œå¿…é¡»ä¿è¯Pï¼Œæ‰€ä»¥è¦ä¹ˆæ»¡è¶³APæ¨¡å‹ã€è¦ä¹ˆæ»¡è¶³CPæ¨¡å‹ã€‚ å¾ˆå¤š NoSQL éƒ½æ˜¯ AP æ¨¡å‹ å¯¹äºCPæ¨¡å‹ï¼Œç½‘ç»œçš„é—®é¢˜å¯èƒ½ä¼šè®©æ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ 1.3 BASEBASE å°±æ˜¯ä¸ºäº†è§£å†³å…³ç³»æ•°æ®åº“å¼ºä¸€è‡´æ€§å¼•èµ·çš„é—®é¢˜è€Œé€ æˆå¯ç”¨æ€§é™ä½ï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡çš„ä½æ€§èƒ½ï¼‰è€Œæå‡ºçš„è§£å†³æ–¹æ¡ˆã€‚ BASE å…¶å®æ˜¯ä¸‹é¢ä¸‰ä¸ªæœ¯è¯­çš„ç¼©å†™ï¼š åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰ è½¯çŠ¶æ€ï¼ˆSoft stateï¼‰ æœ€ç»ˆä¸€è‡´ï¼ˆEventually consistentï¼‰ å®ƒçš„æ€æƒ³æ˜¯é€šè¿‡è®©ç³»ç»Ÿæ”¾æ¾å¯¹æŸä¸€æ—¶åˆ»æ•°æ®ä¸€è‡´æ€§çš„è¦æ±‚æ¥æ¢å–ç³»ç»Ÿæ•´ä½“ä¼¸ç¼©æ€§å’Œæ€§èƒ½ä¸Šæ”¹è§‚ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œç¼˜ç”±å°±åœ¨äºå¤§å‹ç³»ç»Ÿå¾€å¾€ç”±äºåœ°åŸŸåˆ†å¸ƒå’Œæé«˜æ€§èƒ½çš„è¦æ±‚ï¼Œä¸å¯èƒ½é‡‡ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ¥å®Œæˆè¿™äº›æŒ‡æ ‡ï¼Œè¦æƒ³è·å¾—è¿™äº›æŒ‡æ ‡ï¼Œæˆ‘ä»¬å¿…é¡»é‡‡ç”¨å¦å¤–ä¸€ç§æ–¹å¼æ¥å®Œæˆï¼Œè¿™é‡Œ BASE å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•ã€‚ 1.3.1 åŸºæœ¬å¯ç”¨åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°ä¸å¯é¢„çŸ¥æ•…éšœçš„æ—¶å€™ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼Œæ¯”å¦‚ å“åº”æ—¶é—´ä¸Šçš„æŸå¤±ï¼šå‡ºç°æ•…éšœæ—¶å“åº”ç¨æ…¢ åŠŸèƒ½ä¸Šçš„æŸå¤±ï¼šéƒ¨åˆ†ç”¨æˆ·å¯èƒ½ä¼šè¢«å¼•å¯¼åˆ°ä¸€ä¸ªé™çº§é¡µé¢ 1.3.2 è½¯çŠ¶æ€å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€çš„å­˜åœ¨ä¸ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿåœ¨ä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥çš„è¿‡ç¨‹å­˜åœ¨å»¶æ—¶ã€‚ 1.3.3 æœ€ç»ˆä¸€è‡´ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œæœ€ç»ˆä¸€è‡´æ€§çš„æœ¬è´¨æ˜¯éœ€è¦ç³»ç»Ÿä¿è¯æœ€ç»ˆæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´ï¼Œè€Œä¸éœ€è¦å®æ—¶ä¿è¯ç³»ç»Ÿæ•°æ®çš„å¼ºä¸€è‡´æ€§ã€‚ 2 2PCè¦è¾¾æˆåˆ†å¸ƒå¼ä¸€è‡´æ€§ï¼Œå‘å±•å‡ºäº†è®¸å¤šä¸€è‡´æ€§åè®®ï¼Œå…¶ä¸­2PCæ˜¯åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ä¿è¯äº‹åŠ¡åŸå­æ€§å’Œä¸€è‡´æ€§è®¾è®¡çš„ç®—æ³•ï¼Œä¹Ÿè¢«è®¤ä¸ºæ˜¯ä¸€ç§ä¸€è‡´æ€§åè®®ï¼Œç”¨æ¥ä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿæ•°æ®çš„ä¸€è‡´æ€§ã€‚ç›®å‰ï¼Œç»å¤§å¤šæ•°æ•°æ®åº“éƒ½æ˜¯é‡‡ç”¨ 2PC åè®®æ¥å®Œæˆåˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†çš„ã€‚ å®ƒå°†äº‹åŠ¡çš„æäº¤åˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼š 2.1 é˜¶æ®µä¸€ï¼šæäº¤äº‹åŠ¡è¯·æ±‚ æŠ•ç¥¨é˜¶æ®µç”±ä¸€æ–¹è¿›è¡Œæè®®(propose)å¹¶æ”¶é›†å…¶ä»–èŠ‚ç‚¹çš„åé¦ˆ(vote)ï¼Œæˆ‘ä»¬å°†æè®®çš„èŠ‚ç‚¹ç§°ä¸ºåè°ƒè€…ï¼Œå…¶ä»–å‚ä¸å†³è®®èŠ‚ç‚¹ç§°ä¸ºå‚ä¸è€…ã€‚ äº‹åŠ¡è¯¢é—®åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€äº‹åŠ¡å†…å®¹ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œå¹¶å¼€å§‹ç­‰å¾…å„å‚ä¸è€…çš„å“åº”ã€‚ æ‰§è¡Œäº‹åŠ¡å„å‚ä¸è€…èŠ‚ç‚¹æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶å°† Undo å’Œ Redo ä¿¡æ¯è®°å…¥äº‹åŠ¡æ—¥å¿—ä¸­ã€‚ å„å‚ä¸è€…å‘åè°ƒè€…åé¦ˆäº‹åŠ¡è¯¢é—®çš„å“åº”å¦‚æœå‚ä¸è€…æˆåŠŸæ‰§è¡Œäº†äº‹åŠ¡æ“ä½œï¼Œé‚£ä¹ˆå°±åé¦ˆç»™åè°ƒè€… yes å“åº”ï¼Œè¡¨ç¤ºäº‹åŠ¡å¯ä»¥æ‰§è¡Œï¼›å¦‚æœå‚ä¸è€…æ²¡æœ‰æˆåŠŸæ‰§è¡Œäº‹åŠ¡ï¼Œé‚£ä¹ˆå°±åé¦ˆç»™åè°ƒè€… no å“åº”ï¼Œè¡¨ç¤ºäº‹åŠ¡ä¸å¯ä»¥æ‰§è¡Œã€‚ 2.2 é˜¶æ®µäºŒï¼šæ‰§è¡Œäº‹åŠ¡æäº¤ æ‰§è¡Œé˜¶æ®µåè°ƒè€…æ ¹æ®åé¦ˆå†³å®šæäº¤(commit)æˆ–ä¸­æ­¢(abort)äº‹åŠ¡ã€‚ æ­£å¸¸æƒ…å†µä¸‹ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ä¸¤ç§å¯èƒ½ï¼š 2.2.1 æ‰§è¡Œäº‹åŠ¡æäº¤å‡å¦‚åè°ƒè€…ä»æ‰€æœ‰çš„å‚ä¸è€…è·å¾—åé¦ˆéƒ½æ˜¯ yesï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œäº‹åŠ¡æäº¤ã€‚ å‘é€æäº¤è¯·æ±‚åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…èŠ‚ç‚¹å‘å‡º commit è¯·æ±‚ äº‹åŠ¡æäº¤å‚ä¸è€…æ¥æ”¶åˆ° commit è¯·æ±‚åï¼Œä¼šæ­£å¼æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œå¹¶åœ¨å®Œæˆæäº¤ä¹‹åé‡Šæ”¾åœ¨æ•´ä¸ªäº‹åŠ¡æ‰§è¡ŒæœŸé—´å ç”¨çš„äº‹åŠ¡èµ„æºã€‚ åé¦ˆäº‹åŠ¡æäº¤ç»“æœå‚ä¸è€…åœ¨å®Œæˆäº‹åŠ¡æäº¤ä¹‹åï¼Œå‘åè°ƒè€…å‘é€ ACK æ¶ˆæ¯ã€‚ å®Œæˆäº‹åŠ¡åè°ƒè€…æ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…åé¦ˆçš„ ACK æ¶ˆæ¯ï¼Œå®Œæˆäº‹åŠ¡ 2.2.2 ä¸­æ–­äº‹åŠ¡å‡å¦‚ä»»ä½•ä¸€ä¸ªå‚ä¸è€…å‘åè°ƒè€…åé¦ˆäº† no å“åº”ï¼Œæˆ–è€…åœ¨ç­‰å¾…è¶…æ—¶ä¹‹åï¼Œåè°ƒè€…æ— æ³•æ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„åé¦ˆå“åº”ï¼Œé‚£ä¹ˆå°±ä¼šä¸­æ–­äº‹åŠ¡ã€‚ å‘é€å›æ»šè¯·æ±‚åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…èŠ‚ç‚¹å‘å‡º rollback è¯·æ±‚ äº‹åŠ¡å›æ»šå‚ä¸è€…æ¥æ”¶åˆ° rollback è¯·æ±‚åï¼Œä¼šåˆ©ç”¨å…¶åœ¨é˜¶æ®µä¸€ä¸­è®°å½•çš„ Undo ä¿¡æ¯æ¥ä¸­äº‹åŠ¡å›æ»šæ“ä½œï¼Œå¹¶åœ¨å®Œæˆå›æ»šä¹‹åé‡Šæ”¾åœ¨æ•´ä¸ªäº‹åŠ¡æ‰§è¡ŒæœŸé—´å ç”¨çš„èµ„æºã€‚ åé¦ˆäº‹åŠ¡å›æ»šç»“æœå‚ä¸è€…åœ¨å®Œæˆäº‹åŠ¡å›æ»šä¹‹åï¼Œå‘åè°ƒè€…å‘é€ ACK æ¶ˆæ¯ ä¸­æ–­äº‹åŠ¡åè°ƒè€…æ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…åé¦ˆçš„ ACK æ¶ˆæ¯ï¼Œå®Œæˆäº‹åŠ¡ä¸­æ–­ã€‚ 2.3 ä¼˜ç¼ºç‚¹2PCçš„ä¼˜ç‚¹æ˜¯åŸç†ç®€å•ï¼Œå®ç°æ–¹ä¾¿ï¼Œç¼ºç‚¹æœ‰ åŒæ­¥é˜»å¡ï¼šä¸¤é˜¶æ®µæäº¤ä¸­çš„ç¬¬äºŒé˜¶æ®µ, åè°ƒè€…éœ€è¦ç­‰å¾…æ‰€æœ‰å‚ä¸è€…å‘å‡º yes è¯·æ±‚, æˆ–è€…ä¸€ä¸ªå‚ä¸è€…å‘å‡º no è¯·æ±‚å, æ‰èƒ½æ‰§è¡Œæäº¤æˆ–è€…ä¸­æ–­æ“ä½œ. è¿™ä¼šé€ æˆé•¿æ—¶é—´åŒæ—¶é”ä½å¤šä¸ªèµ„æº, é€ æˆæ€§èƒ½ç“¶é¢ˆï¼Œå¦‚æœå‚ä¸è€…æœ‰ä¸€ä¸ªè€—æ—¶é•¿çš„æ“ä½œ, æ€§èƒ½æŸè€—ä¼šæ›´æ˜æ˜¾ã€‚ å•ç‚¹é—®é¢˜ï¼šåè°ƒè€…çš„è§’è‰²åœ¨æ•´ä¸ª 2PC ä¸­èµ·åˆ°äº†éå¸¸é‡è¦çš„ä½œç”¨ã€‚ä¸€æ—¦åè°ƒè€…å‡ºç°é—®é¢˜ï¼Œé‚£ä¹ˆæ•´ä¸ª 2PCæµç¨‹å°†æ— æ³•è¿è½¬ã€‚å¦‚æœåè°ƒè€…æ˜¯åœ¨é˜¶æ®µäºŒå‡ºç°é—®é¢˜çš„è¯ï¼Œé‚£ä¹ˆå…¶ä»–å‚ä¸è€…å°†ä¼šä¸€ç›´å¤„äºé”å®šäº‹åŠ¡èµ„æºçš„çŠ¶æ€ä¸­ï¼Œè€Œæ— æ³•ç»§ç»­å®Œæˆäº‹åŠ¡æ“ä½œã€‚ æ•°æ®ä¸ä¸€è‡´/è„‘è£‚ï¼šåœ¨é˜¶æ®µäºŒä¸­ï¼Œå³åœ¨æ‰§è¡Œäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå½“åè°ƒè€…å‘æ‰€æœ‰çš„å‚ä¸è€…å‘é€ commit è¯·æ±‚ä¹‹åï¼Œå‘ç”Ÿäº†å±€éƒ¨ç½‘ç»œå¼‚å¸¸æˆ–è€…æ˜¯åè°ƒè€…åœ¨å°šæœªå®Œå…¨å‘é€å®Œcommitè¯·æ±‚ä¹‹å‰è‡ªèº«å‘ç”Ÿäº†å´©æºƒï¼Œå¯¼è‡´æœ€ç»ˆåªæœ‰éƒ¨åˆ†å‚ä¸è€…æ”¶åˆ°äº† commit è¯·æ±‚ã€‚äºæ˜¯ï¼Œè¿™éƒ¨åˆ†æ”¶åˆ°äº† commit è¯·æ±‚çš„å‚ä¸è€…å°±ä¼šè¿›è¡Œäº‹åŠ¡çš„æäº¤ï¼Œè€Œå…¶ä»–æ²¡æœ‰æ”¶åˆ° commit è¯·æ±‚çš„å‚ä¸è€…åˆ™æ— æ³•è¿›è¡Œäº‹åŠ¡æäº¤ï¼Œäºæ˜¯å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ å¤ªè¿‡ä¿å®ˆï¼šå¦‚æœåœ¨åè°ƒè€…æŒ‡ç¤ºå‚ä¸è€…è¿›è¡Œäº‹åŠ¡æäº¤è¯¢é—®çš„è¿‡ç¨‹ä¸­ï¼Œå‚ä¸è€…å‡ºç°æ•…éšœè€Œå¯¼è‡´åè°ƒè€…å§‹ç»ˆæ— æ³•è·å–åˆ°æ‰€æœ‰å‚ä¸è€…çš„å“åº”ä¿¡æ¯çš„è¯ï¼Œè¿™æ—¶åè°ƒè€…åªèƒ½ä¾é å…¶è‡ªèº«çš„è¶…æ—¶æœºåˆ¶æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ä¸­æ–­äº‹åŠ¡ï¼Œè¿™æ ·çš„ç­–ç•¥æ˜¾å¾—æ¯”è¾ƒä¿å®ˆã€‚2PC æ²¡æœ‰æ¶‰åŠè¾ƒä¸ºå®Œå–„çš„å®¹é”™æœºåˆ¶ï¼Œä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„å¤±è´¥éƒ½ä¼šå¯¼è‡´æ•´ä¸ªäº‹åŠ¡çš„å¤±è´¥ã€‚ æ ¹æ®2PCåè®®ï¼Œè¡ç”Ÿå‡ºä¸€ç§åˆ†å¸ƒå¼äº‹åŠ¡è§„èŒƒXAï¼Œç›®å‰è®¸å¤šæ•°æ®åº“éƒ½æ”¯æŒã€‚ 3 3PCæ˜¯2PCçš„æ”¹è¿›ç‰ˆï¼Œå…¶å°†2PCçš„æäº¤äº‹åŠ¡è¯·æ±‚è¿‡ç¨‹ä¸€åˆ†ä¸ºäºŒï¼Œå½¢æˆäº†ç”±CanCommitã€PreCommitå’Œ doCommit ä¸‰ä¸ªé˜¶æ®µç»„æˆçš„äº‹åŠ¡å¤„ç†åè®®ã€‚ åœ¨ 2PC ä¸­ä¸€ä¸ªå‚ä¸è€…çš„çŠ¶æ€åªæœ‰å®ƒè‡ªå·±å’Œåè°ƒè€…çŸ¥æ™“ï¼Œå‡å¦‚åè°ƒè€…æè®®åè‡ªèº«å®•æœºï¼Œä¸€ä¸ªå‚ä¸è€…åˆå®•æœºï¼Œå…¶ä»–å‚ä¸è€…å°±ä¼šè¿›å…¥æ—¢ä¸èƒ½å›æ»šã€åˆä¸èƒ½å¼ºåˆ¶ commit çš„é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°å‚ä¸è€…å®•æœºæ¢å¤ã€‚è¿™å¼•å‡ºä¸¤ä¸ªç–‘é—®ï¼š èƒ½ä¸èƒ½å»æ‰é˜»å¡ï¼Œä½¿ç³»ç»Ÿå¯ä»¥åœ¨ commit/abort å‰å›æ»š(rollback)åˆ°å†³è®®å‘èµ·å‰çš„åˆå§‹çŠ¶æ€ï¼Ÿ å½“æ¬¡å†³è®®ä¸­ï¼Œå‚ä¸è€…é—´èƒ½ä¸èƒ½ç›¸äº’çŸ¥é“å¯¹æ–¹çš„çŠ¶æ€ï¼Œåˆæˆ–è€…å‚ä¸è€…é—´æ ¹æœ¬ä¸ä¾èµ–å¯¹æ–¹çš„çŠ¶æ€ï¼Ÿ 3.1 é˜¶æ®µä¸€ï¼šCanCommit äº‹åŠ¡è¯¢é—®åè°ƒè€…å‘æ‰€æœ‰çš„å‚ä¸è€…å‘é€ä¸€ä¸ªåŒ…å«äº‹åŠ¡å†…å®¹çš„ canCommit è¯·æ±‚ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œå¹¶å¼€å§‹ç­‰å¾…å„å‚ä¸è€…çš„å“åº” å„å‚ä¸è€…å‘åè°ƒè€…åé¦ˆäº‹åŠ¡è¯¢é—®çš„å“åº”å‚ä¸è€…æ¥æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„ canCommit è¯·æ±‚åï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœå…¶è‡ªèº«è®¤ä¸ºå¯ä»¥é¡ºåˆ©æ‰§è¡Œäº‹åŠ¡ï¼ˆé€šå¸¸æ˜¯å°è¯•è·å–æ•°æ®åº“é”ï¼‰ï¼Œé‚£ä¹ˆä¼šåé¦ˆ yes å“åº”ï¼Œå¹¶è¿›å…¥é¢„å¤‡çŠ¶æ€ï¼Œå¦åˆ™åé¦ˆ no å“åº”ã€‚ 3.2 é˜¶æ®µäºŒï¼šPreCommitåœ¨é˜¶æ®µäºŒä¸­ï¼Œåè°ƒè€…ä¼šæ ¹æ®å„å‚ä¸è€…çš„åé¦ˆæƒ…å†µæ¥å†³å®šæ˜¯å¦å¯ä»¥è¿›è¡Œäº‹åŠ¡çš„ PreCommit æ“ä½œï¼Œæ­£ç¡®æƒ…å†µä¸‹ï¼ŒåŒ…å«ä¸¤ç§å¯èƒ½ã€‚ 3.2.1 æ‰§è¡Œäº‹åŠ¡é¢„æäº¤å‡å¦‚åè°ƒè€…ä»æ‰€æœ‰çš„å‚ä¸è€…è·å¾—çš„åé¦ˆéƒ½æ˜¯ yesï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œäº‹åŠ¡é¢„æäº¤ã€‚ å‘é€é¢„æäº¤è¯·æ±‚åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…èŠ‚ç‚¹å‘å‡º preCommit è¯·æ±‚ï¼Œå¹¶è¿›å…¥ Prepared é˜¶æ®µ äº‹åŠ¡é¢„æäº¤å‚ä¸è€…æ¥æ”¶åˆ° preCommit è¯·æ±‚åï¼Œä¼šæ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶å°† Undo å’Œ Redo ä¿¡æ¯è®°å½•åˆ°äº‹åŠ¡æ—¥å¿—ä¸­ å„å‚ä¸è€…å‘åè°ƒè€…åé¦ˆäº‹åŠ¡æ‰§è¡Œçš„å“åº”å¦‚æœå‚ä¸è€…æˆåŠŸæ‰§è¡Œäº†äº‹åŠ¡æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šåé¦ˆç»™åè°ƒè€… ACK å“åº”ï¼ŒåŒæ—¶ç­‰å¾…æœ€ç»ˆçš„æŒ‡ä»¤ï¼šæäº¤ï¼ˆcommitï¼‰æˆ–ä¸­æ­¢ï¼ˆabortï¼‰ã€‚å¦‚æœå¤±è´¥ï¼Œé‚£ä¹ˆä¼šåé¦ˆç»™åè°ƒè€… no å“åº”ã€‚ 3.2.2 ä¸­æ–­äº‹åŠ¡å‡å¦‚ä»»ä½•ä¸€ä¸ªå‚ä¸è€…å‘åè°ƒè€…åé¦ˆäº† no å“åº”ï¼Œæˆ–è€…åœ¨ç­‰å¾…è¶…æ—¶ä¹‹åï¼Œåè°ƒè€…å°šæ— æ³•æ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„åé¦ˆå“åº”ï¼Œé‚£ä¹ˆå°±ä¼šä¸­æ–­äº‹åŠ¡ã€‚ å‘é€ä¸­æ–­è¯·æ±‚åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…èŠ‚ç‚¹å‘å‡º abort è¯·æ±‚ ä¸­æ–­äº‹åŠ¡æ— è®ºæ˜¯æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„ abort è¯·æ±‚ï¼Œæˆ–è€…æ˜¯åœ¨ç­‰å¾…åè°ƒè€…è¯·æ±‚è¿‡ç¨‹ä¸­å‡ºç°è¶…æ—¶ï¼Œå‚ä¸è€…éƒ½ä¼šä¸­æ–­äº‹åŠ¡ 3.3 é˜¶æ®µä¸‰ï¼šdoCommitè¯¥é˜¶æ®µå°†è¿›è¡ŒçœŸæ­£çš„äº‹åŠ¡æäº¤ï¼Œä¼šå­˜åœ¨ä»¥ä¸‹ä¸¤ç§å¯èƒ½çš„æƒ…å†µ 3.3.1 æ‰§è¡Œæäº¤ å‘é€æäº¤è¯·æ±‚å‡è®¾åè°ƒè€…å¤„äºæ­£å¸¸å·¥ä½œçŠ¶æ€ï¼Œå¹¶ä¸”å®ƒæ¥æ”¶åˆ°äº†æ¥è‡ªæ‰€æœ‰å‚ä¸è€…çš„ ACK å“åº”ï¼Œé‚£ä¹ˆå®ƒå°†ä»â€œé¢„æäº¤â€çŠ¶æ€è½¬æ¢åˆ°â€œæäº¤â€çŠ¶æ€ï¼Œå¹¶å‘æ‰€æœ‰çš„å‚ä¸è€…å‘é€ doCommit è¯·æ±‚ã€‚ äº‹åŠ¡æäº¤å‚ä¸è€…æ¥æ”¶åˆ° doCommit è¯·æ±‚åï¼Œä¼šæ­£å¼æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œå¹¶åœ¨å®Œæˆæäº¤ä¹‹åé‡Šæ”¾åœ¨æ•´ä¸ªäº‹åŠ¡æ‰§è¡Œé˜¶æ®µå ç”¨çš„äº‹åŠ¡èµ„æº åé¦ˆäº‹åŠ¡æäº¤ç»“æœå‚ä¸è€…åœ¨å®Œæˆäº‹åŠ¡æäº¤ä¹‹åï¼Œå‘åè°ƒè€…å‘é€ ACK æ¶ˆæ¯ å®Œæˆäº‹åŠ¡åè°ƒè€…æ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…åé¦ˆçš„ ACK æ¶ˆæ¯åï¼Œå®Œæˆäº‹åŠ¡ã€‚ 3.3.2 ä¸­æ–­äº‹åŠ¡è¿›å…¥è¿™ä¸€é˜¶æ®µï¼Œå‡è®¾åè°ƒè€…å¤„äºæ­£å¸¸å·¥ä½œçŠ¶æ€ï¼Œå¹¶ä¸”æœ‰ä»»æ„ä¸€ä¸ªå‚ä¸è€…å‘åè°ƒè€…åé¦ˆ no å“åº”ï¼Œæˆ–è€…åœ¨ç­‰å¾…è¶…æ—¶ä¹‹åï¼Œåè°ƒè€…å°šæ— æ³•æ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„åé¦ˆå“åº”ï¼Œé‚£ä¹ˆå°±ä¼šä¸­æ–­äº‹åŠ¡ã€‚ å‘é€ä¸­æ–­è¯·æ±‚åè°ƒè€…å‘æ‰€æœ‰çš„å‚ä¸è€…å‘é€ abort è¯·æ±‚ äº‹åŠ¡å›æ»šå‚ä¸è€…æ¥æ”¶åˆ° abort è¯·æ±‚åï¼Œä¼šåˆ©ç”¨å…¶åœ¨é˜¶æ®µäºŒè®°å½•çš„ Undo ä¿¡æ¯æ¥æ‰§è¡Œäº‹åŠ¡å›æ»šæ“ä½œï¼Œå¹¶åœ¨å®Œæˆå›æ»šä¹‹åé‡Šæ”¾åœ¨æ•´ä¸ªäº‹åŠ¡æ‰§è¡ŒæœŸé—´å ç”¨çš„èµ„æºã€‚ åé¦ˆäº‹åŠ¡å›æ»šç»“æœå‚ä¸è€…åœ¨å®Œæˆäº‹åŠ¡å›æ»šä¹‹åï¼Œå‘åè°ƒè€…å‘é€ ACK æ¶ˆæ¯ ä¸­æ–­äº‹åŠ¡åè°ƒè€…æ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…åé¦ˆçš„ ACK æ¶ˆæ¯åï¼Œä¸­æ–­äº‹åŠ¡ã€‚ ä¸€æ—¦è¿›å…¥é˜¶æ®µä¸‰ï¼Œå¯èƒ½ä¼šå­˜åœ¨ä»¥ä¸‹ä¸¤ç§æ•…éšœï¼š åè°ƒè€…å‡ºç°é—®é¢˜ åè°ƒè€…å’Œå‚ä¸è€…ä¹‹é—´çš„ç½‘ç»œå‡ºç°æ•…éšœæ— è®ºå‡ºç°å“ªç§æƒ…å†µï¼Œéƒ½ä¼šå¯¼è‡´å‚ä¸è€…æ— æ³•åŠæ—¶æ¥æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„doCommitæˆ–abortè¯·æ±‚ï¼Œé’ˆå¯¹è¿™ç§å¼‚å¸¸æƒ…å†µï¼Œå‚ä¸è€…ä¼šåœ¨ç­‰å¾…è¶…æ—¶ä¹‹åï¼Œç»§ç»­è¿›è¡Œäº‹åŠ¡æäº¤ã€‚ 3.4 ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ï¼š ç›¸è¾ƒäº 2PCï¼Œå¼•å…¥è¶…æ—¶æœºåˆ¶ï¼Œæœ€å¤§çš„ä¼˜ç‚¹æ˜¯é™ä½äº†å‚ä¸è€…çš„é˜»å¡èŒƒå›´ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨å‡ºç°å•ç‚¹æ•…éšœåç»§ç»­è¾¾æˆä¸€è‡´ã€‚ ç¼ºç‚¹ï¼š åœ¨å‚ä¸è€…æ¥æ”¶åˆ° preCommit æ¶ˆæ¯åï¼Œå¦‚æœç½‘ç»œå‡ºç°åˆ†åŒºï¼Œæ­¤æ—¶åè°ƒè€…æ‰€åœ¨çš„èŠ‚ç‚¹å’Œå‚ä¸è€…æ— æ³•è¿›è¡Œæ­£å¸¸çš„ç½‘ç»œé€šä¿¡ï¼Œæ­¤æ—¶è¯¥å‚ä¸è€…ä¾ç„¶ä¼šè¿›è¡Œäº‹åŠ¡çš„æäº¤ï¼Œè¿™å¿…ç„¶ä¼šå‡ºç°æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚ ç”±äº2PCã€3PCéƒ½æ²¡æœ‰è§£å†³ç½‘ç»œåˆ†åŒºå¼•èµ·çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œåæ¥åˆå‡ºç°äº†è®¸å¤šå…±è¯†åè®®ï¼Œç­‰åˆ°ä¸‹ç¯‡åšå®¢å†è°ˆã€‚","categories":[{"name":"é¡¹ç›®/ç¼–ç¨‹ç†è®º","slug":"é¡¹ç›®-ç¼–ç¨‹ç†è®º","permalink":"https://www.codetool.top/categories/%E9%A1%B9%E7%9B%AE-%E7%BC%96%E7%A8%8B%E7%90%86%E8%AE%BA/"}],"tags":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"https://www.codetool.top/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"}]},{"title":"Nettyæºç åˆæ¢-NioEventLoopGroup","slug":"Nettyæºç åˆæ¢-NioEventLoopGroup","date":"2020-03-16T10:37:54.000Z","updated":"2020-03-18T08:15:52.105Z","comments":true,"path":"article/Nettyæºç åˆæ¢-NioEventLoopGroup/","link":"","permalink":"https://www.codetool.top/article/Netty%E6%BA%90%E7%A0%81%E5%88%9D%E6%8E%A2-NioEventLoopGroup/","excerpt":"","text":"1 æ€»ç»“æŠŠæ€»ç»“æ”¾å‰é¢ä»Šåå¥½å¤ä¹ ï¼š è¿™æ ·çœ‹ä¸‹æ¥nettyæºç ç¡®å®è®¾è®¡çš„æŒºå¤æ‚çš„ï¼Œæˆ‘é˜…è¯»èµ·æ¥æœ‰ç‚¹åƒåŠ›ï¼Œå› ä¸ºä¹‹å‰æˆ‘é˜…è¯»æºç éƒ½æ˜¯è¿‡ç¨‹é©±åŠ¨çš„ï¼Œè¿™æ¬¡ç›´æ¥ä»æŸä¸€ä¸ªç±»å¼€å§‹è¯»ï¼Œä¹Ÿä¸çŸ¥é“è¿™ä¸ªç±»åœ¨å“ªä¸ªåœ°æ–¹ç”¨åˆ°äº†ï¼Œä¸‹æ¬¡å°±è¿˜æ˜¯æŒ‰nettyè¿è¡Œçš„æŸå—æµç¨‹å»è·Ÿè¸ªæºç ã€‚ï¼ˆè¿™ç¯‡æ–‡ç« æ˜¯å¤±è´¥çš„ï¼‰ NioEventLoopGroupä¸­å«ä¸€ä¸ªchildrenæ•°ç»„ï¼Œç±»å‹ä¸ºNioEventLoopï¼Œå¦‚æœè°ƒç”¨é»˜è®¤æ„é€ æ–¹æ³•æ„é€ NioEventLoopGroupï¼Œå…¶å¤§å°é»˜è®¤ä¸ºå¯ç”¨CPUæ ¸æ•°*2ï¼ˆæˆ–ä¸é…ç½®å±æ€§ä¹‹é—´çš„æœ€å¤§å€¼ï¼‰ NioEventLoopç»§æ‰¿è‡ªSingleThreadEventExecutorï¼Œä»–æ˜¯ä¸€ä¸ªä¸»è¦çš„çˆ¶ç±»ï¼Œå…·ä½“æœ‰ä»€ä¹ˆç”¨ä¸‹æ¬¡çœ‹åˆ°ç›¸å…³æºç å†ç ”ç©¶ NioEventLoopä¸­æœ‰ä¸ªSelectorProviderï¼Œå®ƒåœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸­çš„å®ç°æ˜¯ä¸åŒçš„ï¼Œwindowsçš„SelectorProvideræä¾›çš„selectoræ˜¯ä½¿ç”¨selectå®ç°çš„ï¼Œlinuxä½¿ç”¨epollï¼Œsalarisä½¿ç”¨pollï¼Œmacosxä½¿ç”¨kqueue 2 æºç åˆ†æ å®ç°äº†ExecutorServiceï¼Œè¯´æ˜å®ƒå…·æœ‰ç±»ä¼¼çº¿ç¨‹æ± çš„æ€§è´¨ï¼ŒExecutorServiceå’ŒScheduledExecuterServiceåˆ†åˆ«å¯¹åº”submitå’Œscheduleæ–¹æ³•ï¼ˆä»»åŠ¡å’Œå®šæ—¶ä»»åŠ¡ï¼‰ ç„¶åå°±è¦çœ‹è¿™ä¸ªæ ¸å¿ƒæ¥å£ï¼šEventExecutorGroupï¼Œè¿™ä¸ªæ¥å£ç®—æ˜¯nettyæä¾›çš„æœ€é¡¶å±‚çš„æ¥å£äº†ï¼Œå†å¾€ä¸Šå°±æ˜¯jdkçš„åœ°ç›˜äº†ï¼Œå®ƒçš„javadocæè¿°æ˜¯ The EventExecutorGroup is responsible for providing the EventExecutorâ€™s to use via its next() method. Besides this, it is also responsible for handling their life-cycle and allows shutting them down in a global fashion. EventExecutorGroupè´Ÿè´£é€šè¿‡å…¶next()æ–¹æ³•æä¾›è¦ä½¿ç”¨çš„EventExecutorã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜è´Ÿè´£å¤„ç†å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶å…è®¸ä»¥å…¨å±€æ–¹å¼å…³é—­å®ƒä»¬ã€‚ï¼ˆshutdownGracefullyï¼‰ è€ŒEventExecutorå®é™…ä¸Šæ˜¯ä¸€ä¸ªå®ç°äº†EventExecutorGroupçš„å­æ¥å£ï¼Œå®ƒæä¾›äº†parent()æ–¹æ³•è·å–æ‰€å±çš„EventExecutorGroupã€‚ é€šè¿‡AbstractEventExecutorGroupå‘ç°ï¼Œä»–è°ƒç”¨submitã€scheduleç­‰æ–¹æ³•å®é™…ä¸Šæ˜¯åœ¨next()è¿”å›çš„EventExecutorä¸Šè°ƒç”¨ã€‚ ç„¶åçœ‹MultithreadEventExecutorGroupç±»ï¼Œè¿™ä¸ªç±»å·²ç»æä¾›äº†ç»å¤§éƒ¨åˆ†å®ç°ï¼Œ public abstract class MultithreadEventExecutorGroup extends AbstractEventExecutorGroup { //ç»´æŠ¤äº†ä¸€ä¸ªEventExecutoræ•°ç»„ private final EventExecutor[] children; //åªè¯»çš„EventExecutor private final Set&lt;EventExecutor> readonlyChildren; //ç»ˆæ­¢çš„EventExecutorè®¡æ•° private final AtomicInteger terminatedChildren = new AtomicInteger(); //Promiseæ˜¯ä¸€ä¸ªå¯å†™çš„Future private final Promise&lt;?> terminationFuture = new DefaultPromise(GlobalEventExecutor.INSTANCE); //Chooses the next EventExecutor to use.é€‰æ‹©ä¸‹ä¸€ä¸ªEventExecutor private final EventExecutorChooserFactory.EventExecutorChooser chooser; //... } ç„¶åä»æœ€åº•ä¸‹NioEventLoopGroupçš„æ„é€ æ–¹æ³•çœ‹èµ·ï¼Œè¿™ä¸ªç±»æ²¡æœ‰ä»€ä¹ˆæ–°å¢çš„å±æ€§å’Œæ–¹æ³•ï¼ŒåŸºæœ¬æ˜¯æä¾›äº†ä¸€äº›æ„é€ æ–¹æ³•ï¼Œé»˜è®¤æ„é€  public NioEventLoopGroup() { this(0); } ä¼ é€’é“¾ï¼š //nThreads = 0 public NioEventLoopGroup(int nThreads) { this(nThreads, (Executor) null); } //nThreads = 0, executor = null public NioEventLoopGroup(int nThreads, Executor executor) { this(nThreads, executor, SelectorProvider.provider()); } //nThreads = 0, executor = null,selectorProvider = SelectorProvider.provider() //selectorProviderä½¿ç”¨æ¥æä¾›NIOæ ¸å¿ƒselectorçš„ä¸€ä¸ªç±» public NioEventLoopGroup( int nThreads, Executor executor, final SelectorProvider selectorProvider) { this(nThreads, executor, selectorProvider, DefaultSelectStrategyFactory.INSTANCE); } //nThreads = 0, executor = null,selectorProvider = SelectorProvider.provider() //selectStrategyFactory = DefaultSelectStrategyFactory() public NioEventLoopGroup(int nThreads, Executor executor, final SelectorProvider selectorProvider, final SelectStrategyFactory selectStrategyFactory) { super(nThreads, executor, selectorProvider, selectStrategyFactory, RejectedExecutionHandlers.reject()); } æ¥ä¸‹æ¥è°ƒç”¨çˆ¶ç±»MultithreadEventLoopGroupçš„æ„é€ æ–¹æ³•ï¼š //nThreads = 0, executor = null //args = [SelectorProvider.provider(),DefaultSelectStrategyFactory(),RejectedExecutionHandlers.reject()] protected MultithreadEventLoopGroup(int nThreads, Executor executor, Object... args) { super(nThreads == 0 ? DEFAULT_EVENT_LOOP_THREADS : nThreads, executor, args); } è¿™é‡Œå¦‚æœnThreadsæ˜¯0ï¼Œä¼ äº†ä¸€ä¸ªDEFAULT_EVENT_LOOP_THREADSç»™çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œè€Œå‰é¢ä¼ è¿‡æ¥çš„nThreadså°±æ˜¯0ï¼Œé‚£ä¹ˆè¿™ä¸ªDEFAULT_EVENT_LOOP_THREADSæ˜¯å¤šå°‘å‘¢ï¼Ÿ private static final int DEFAULT_EVENT_LOOP_THREADS; static { DEFAULT_EVENT_LOOP_THREADS = Math.max(1, SystemPropertyUtil.getInt( \"io.netty.eventLoopThreads\", NettyRuntime.availableProcessors() * 2)); if (logger.isDebugEnabled()) { logger.debug(\"-Dio.netty.eventLoopThreads: {}\", DEFAULT_EVENT_LOOP_THREADS); } } å¯è§å®ƒæ˜¯ä»1ã€ç¯å¢ƒé…ç½®ä¸­çš„io.netty.eventLoopThreadsã€NettyRuntime.availableProcessors() * 2ä¸­å–æœ€å¤§å€¼ï¼Œè€ŒNettyRuntime.availableProcessors() * 2æ˜¯nettyå¯ç”¨ä¸»æœºCPUçš„æ ¸æ•°*2ã€‚ æœ€åï¼Œå®ƒè°ƒç”¨MultithreadEventExecutorGroupçš„æ„é€ æ–¹æ³•ï¼š /** * nThreadsï¼šè¿™ä¸ªMultithreadEventExecutorGroupä¼šç”¨å‡ ä¸ªçº¿ç¨‹ * executorï¼šä½¿ç”¨çš„çº¿ç¨‹æ± ï¼Œå¦‚æœæ˜¯nullä½¿ç”¨é»˜è®¤çš„ * chooserFactoryï¼Œç»™chooserFactoryèµ‹å€¼ */ protected MultithreadEventExecutorGroup(int nThreads, Executor executor, EventExecutorChooserFactory chooserFactory, Object... args) { if (nThreads &lt;= 0) { throw new IllegalArgumentException(String.format(\"nThreads: %d (expected: > 0)\", nThreads)); } //å‰é¢é»˜è®¤ä¼ è¿‡æ¥çš„å°±æ˜¯ç©ºï¼Œä½¿ç”¨new ThreadPerTaskExecutor(newDefaultThreadFactory()); if (executor == null) { executor = new ThreadPerTaskExecutor(newDefaultThreadFactory()); } //childrençš„å¤§å°ä¸ºnThreadsï¼Œå³é»˜è®¤æ˜¯nettyå¯ç”¨ä¸»æœºCPUçš„æ ¸æ•°*2ï¼ˆå¦‚æœæ˜¯æœ€å¤§å€¼ï¼‰ children = new EventExecutor[nThreads]; //ç»™childrenèµ‹å€¼ for (int i = 0; i &lt; nThreads; i ++) { boolean success = false; try { children[i] = newChild(executor, args); success = true; } catch (Exception e) { // TODO: Think about if this is a good exception type throw new IllegalStateException(\"failed to create a child event loop\", e); } finally { if (!success) { for (int j = 0; j &lt; i; j ++) { children[j].shutdownGracefully(); } for (int j = 0; j &lt; i; j ++) { EventExecutor e = children[j]; try { while (!e.isTerminated()) { e.awaitTermination(Integer.MAX_VALUE, TimeUnit.SECONDS); } } catch (InterruptedException interrupted) { // Let the caller handle the interruption. Thread.currentThread().interrupt(); break; } } } } } chooser = chooserFactory.newChooser(children); final FutureListener&lt;Object> terminationListener = new FutureListener&lt;Object>() { @Override public void operationComplete(Future&lt;Object> future) throws Exception { if (terminatedChildren.incrementAndGet() == children.length) { terminationFuture.setSuccess(null); } } }; for (EventExecutor e: children) { e.terminationFuture().addListener(terminationListener); } Set&lt;EventExecutor> childrenSet = new LinkedHashSet&lt;EventExecutor>(children.length); Collections.addAll(childrenSet, children); readonlyChildren = Collections.unmodifiableSet(childrenSet); } newChildï¼Œå¯¹äºNioEventLoopGroupçš„å®ç°ä¸ºï¼š @Override protected EventLoop newChild(Executor executor, Object... args) throws Exception { EventLoopTaskQueueFactory queueFactory = args.length == 4 ? (EventLoopTaskQueueFactory) args[3] : null; return new NioEventLoop(this, executor, (SelectorProvider) args[0], ((SelectStrategyFactory) args[1]).newSelectStrategy(), (RejectedExecutionHandler) args[2], queueFactory); } å®ƒè¿”å›ä¸€ä¸ªEventLoopï¼Œå¯ä»¥çœ‹åˆ°å¯¹äºNioEventLoopGroupï¼Œå®ƒçš„childrenæ•°ç»„ä¸­å­˜æ”¾çš„å®é™…æ˜¯ä¸€ä¸ªNioEventLoopå¯¹è±¡ã€‚ NioEventLoop(NioEventLoopGroup parent, Executor executor, SelectorProvider selectorProvider, SelectStrategy strategy, RejectedExecutionHandler rejectedExecutionHandler, EventLoopTaskQueueFactory queueFactory) { super(parent, executor, false, newTaskQueue(queueFactory), newTaskQueue(queueFactory), rejectedExecutionHandler); if (selectorProvider == null) { throw new NullPointerException(\"selectorProvider\"); } if (strategy == null) { throw new NullPointerException(\"selectStrategy\"); } provider = selectorProvider; final SelectorTuple selectorTuple = openSelector(); selector = selectorTuple.selector; unwrappedSelector = selectorTuple.unwrappedSelector; selectStrategy = strategy; } NioEventLoopæœ‰ä»¥ä¸‹å±æ€§ï¼š private Selector selector; private Selector unwrappedSelector; private SelectedSelectionKeySet selectedKeys; private final SelectorProvider provider; è€Œå®ƒç»§æ‰¿çš„SingleThreadEventExecutoræœ‰ä»¥ä¸‹å±æ€§ï¼š private final Queue&lt;Runnable> taskQueue; private volatile Thread thread; @SuppressWarnings(\"unused\") private volatile ThreadProperties threadProperties; private final Executor executor; private volatile boolean interrupted; private final CountDownLatch threadLock = new CountDownLatch(1); private final Set&lt;Runnable> shutdownHooks = new LinkedHashSet&lt;Runnable>(); private final boolean addTaskWakesUp; private final int maxPendingTasks; private final RejectedExecutionHandler rejectedExecutionHandler; private long lastExecutionTime; @SuppressWarnings({ \"FieldMayBeFinal\", \"unused\" }) private volatile int state = ST_NOT_STARTED; private volatile long gracefulShutdownQuietPeriod; private volatile long gracefulShutdownTimeout; private long gracefulShutdownStartTime; private final Promise&lt;?> terminationFuture = new DefaultPromise&lt;Void>(GlobalEventExecutor.INSTANCE); ä¸åŒæ“ä½œç³»ç»Ÿçš„I/Oå¤šè·¯å¤ç”¨é€‰æ‹©å™¨å„è‡ªå†…æ ¸å®ç°ä¸åŒï¼Œç›®å‰æœ‰selectã€pollã€epollã€kqueueå››ç§å®ç°ï¼ŒJDKé‡Œä¸ä¹‹å¯¹åº”çš„å®ç°ä¹Ÿéšç€æ“ä½œç³»ç»Ÿçš„ä¸åŒè€Œä¸åŒï¼Œ JDKé‡Œå¯¹äºSelectorçš„å®ç°éƒ½äº¤ç”±SelectorProviderçš„æ–¹æ³•openSelector()æ¥æä¾›ï¼Œè€ŒSelectorProviderçš„å®ç°æ ¹æ®æ“ä½œç³»ç»Ÿè€Œå˜åŒ–ï¼š public static SelectorProvider provider() { synchronized (lock) { if (provider != null) return provider; return AccessController.doPrivileged( new PrivilegedAction&lt;SelectorProvider>() { public SelectorProvider run() { if (loadProviderFromProperty()) return provider; if (loadProviderAsService()) return provider; //æ ¹æ®ä¸åŒæ“ä½œç³»ç»Ÿçš„å®ç°æ¥åˆ›å»ºSelectorProvider provider = sun.nio.ch.DefaultSelectorProvider.create(); return provider; } }); } } Windowså®ç°ï¼š public static SelectorProvider create() { return new sun.nio.ch.WindowsSelectorProvider(); } public class WindowsSelectorProvider extends SelectorProviderImpl { public AbstractSelector openSelector() throws IOException { return new WindowsSelectorImpl(this); } } é€šè¿‡é˜…è¯»WindowsSelectorImpl.cæºç å‘ç°å®ƒæ˜¯é€šè¿‡selectå®ç°çš„ Unixç³»å®ç°ï¼š public static SelectorProvider create() { String osname = AccessController .doPrivileged(new GetPropertyAction(\"os.name\")); if (osname.equals(\"SunOS\")) return createProvider(\"sun.nio.ch.DevPollSelectorProvider\"); if (osname.equals(\"Linux\")) return createProvider(\"sun.nio.ch.EPollSelectorProvider\"); return new sun.nio.ch.PollSelectorProvider(); } public class EPollSelectorProvider extends SelectorProviderImpl { public AbstractSelector openSelector() throws IOException { return new EPollSelectorImpl(this); } public Channel inheritedChannel() throws IOException { return InheritedChannel.getChannel(); } } Linuxæ˜¯é€šè¿‡EPollSelectorImplä¸­è°ƒç”¨EPollArrayWrapperç±»æ¥é€šè¿‡ç³»ç»Ÿå‡½æ•°epollå®ç°çš„SunOSï¼ˆsolarisï¼‰åˆ™æ˜¯è°ƒç”¨DevPollArrayWrapperé€šè¿‡ç³»ç»Ÿå‡½æ•°pollå®ç°çš„ MacosXå®ç°ï¼š public static SelectorProvider create() { return new sun.nio.ch.KQueueSelectorProvider(); } KQueueæ˜¯å¦ä¸€ç§å¤šè·¯å¤ç”¨çš„æ–¹æ³•ï¼Œè¿™é‡Œå°±ä¸å»çœ‹äº†ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://www.codetool.top/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"name":"Netty","slug":"Netty","permalink":"https://www.codetool.top/tags/Netty/"}]},{"title":"ç¨‹åºå‘˜é¢è¯•é‡‘å…¸01.06-å­—ç¬¦ä¸²å‹ç¼©","slug":"ç¨‹åºå‘˜é¢è¯•é‡‘å…¸01-06-å­—ç¬¦ä¸²å‹ç¼©","date":"2020-03-15T16:38:54.000Z","updated":"2020-03-15T16:41:30.493Z","comments":true,"path":"article/ç¨‹åºå‘˜é¢è¯•é‡‘å…¸01-06-å­—ç¬¦ä¸²å‹ç¼©/","link":"","permalink":"https://www.codetool.top/article/%E7%A8%8B%E5%BA%8F%E5%91%98%E9%9D%A2%E8%AF%95%E9%87%91%E5%85%B801-06-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8E%8B%E7%BC%A9/","excerpt":"","text":"1 åŸé¢˜ï¼ˆæ¥æºLeetcodeï¼‰å­—ç¬¦ä¸²å‹ç¼©ã€‚åˆ©ç”¨å­—ç¬¦é‡å¤å‡ºç°çš„æ¬¡æ•°ï¼Œç¼–å†™ä¸€ç§æ–¹æ³•ï¼Œå®ç°åŸºæœ¬çš„å­—ç¬¦ä¸²å‹ç¼©åŠŸèƒ½ã€‚æ¯”å¦‚ï¼Œå­—ç¬¦ä¸²aabcccccaaaä¼šå˜ä¸ºa2b1c5a3ã€‚è‹¥â€œå‹ç¼©â€åçš„å­—ç¬¦ä¸²æ²¡æœ‰å˜çŸ­ï¼Œåˆ™è¿”å›åŸå…ˆçš„å­—ç¬¦ä¸²ã€‚ä½ å¯ä»¥å‡è®¾å­—ç¬¦ä¸²ä¸­åªåŒ…å«å¤§å°å†™è‹±æ–‡å­—æ¯ï¼ˆaè‡³zï¼‰ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: â€œaabcccccaaaâ€è¾“å‡º: â€œa2b1c5a3â€ ç¤ºä¾‹ 2: è¾“å…¥: â€œabbccdâ€è¾“å‡º: â€œabbccdâ€è§£é‡Š: â€œabbccdâ€å‹ç¼©åä¸ºâ€a1b2c2d1â€ï¼Œæ¯”åŸå­—ç¬¦ä¸²é•¿åº¦æ›´é•¿ã€‚ æç¤ºï¼š å­—ç¬¦ä¸²é•¿åº¦åœ¨[0, 50000]èŒƒå›´å†…ã€‚ 2 è§£æ³•2.1 æ€æƒ³é‡å¤çš„è®¡æ•°ï¼Œç”¨StringBuilderå­—ç¬¦ä¸²æ‹¼æ¥å°±è¡Œäº†ã€‚ 2.2 ä»£ç class Solution { public String compressString(String S) { char[] chars = S.toCharArray(); if(chars.length == 0) return S; char last = chars[0]; StringBuilder sb = new StringBuilder(); sb.append(last); int count = 1; for(int i = 1;i&lt;chars.length;i++){ if(chars[i] == last){ count++; }else{ sb.append(count); count = 1; last = chars[i]; sb.append(last); } } sb.append(count); if(sb.length()&lt;chars.length) return sb.toString(); return S; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"Nettyå¿ƒè·³æ£€æµ‹å’ŒåŸºäºWebsocketåè®®çš„æœåŠ¡ç«¯å¼€å‘","slug":"Nettyå¿ƒè·³æ£€æµ‹å’ŒåŸºäºWebsocketåè®®çš„æœåŠ¡ç«¯å¼€å‘","date":"2020-03-15T14:47:59.000Z","updated":"2020-03-15T17:35:27.958Z","comments":true,"path":"article/Nettyå¿ƒè·³æ£€æµ‹å’ŒåŸºäºWebsocketåè®®çš„æœåŠ¡ç«¯å¼€å‘/","link":"","permalink":"https://www.codetool.top/article/Netty%E5%BF%83%E8%B7%B3%E6%A3%80%E6%B5%8B%E5%92%8C%E5%9F%BA%E4%BA%8EWebsocket%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91/","excerpt":"","text":"1 å¿ƒè·³æ£€æµ‹åœ¨ TCP é•¿è¿æ¥ä¸­ï¼ŒNettyæœåŠ¡ç«¯æ„ŸçŸ¥å®¢æˆ·ç«¯ï¼ˆæˆ–æ˜¯å®¢æˆ·ç«¯æ„ŸçŸ¥æœåŠ¡ç«¯ï¼‰æ–­å¼€è¿æ¥çš„å…¶ä¸­ä¸€ä¸ªæ–¹æ³•æ˜¯handlerçš„channelInactiveã€‚ä½†å¯èƒ½ä¼šæœ‰ä¸€äº›æƒ…å†µï¼Œæ¯”å¦‚çº¿è·¯å‡ºç°é—®é¢˜ï¼Œè®©å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è™½ç„¶æ˜¯è¿æ¥çŠ¶æ€ä½†äº‹å®æ— æ³•é€šä¿¡ã€‚è¿™ç§æƒ…å†µå°±é€šè¿‡å¿ƒè·³æ£€æµ‹å¯¹æ–¹æ˜¯å¦æœ‰å“åº”ï¼Œå¿ƒè·³æ£€æµ‹ï¼ˆå¿ƒè·³åŒ…çš„å‘é€ï¼‰éœ€è¦ç¼–ç¨‹äººå‘˜åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å±‚é¢å®ç°ï¼Œè€ŒNettyä¸­æä¾›äº†IdleStateHandlerç”¨äºå¤„ç†é€šé“ç©ºé—²çš„æƒ…å†µï¼ˆåœ¨å¿ƒè·³æœºåˆ¶å¯ç”¨çš„æƒ…å†µä¸‹å°±ä»£è¡¨è¿æ¥æ–­å¼€ï¼‰ã€‚ //ç¬¬ä¸€ä¸ªå‚æ•°æ²¡æœ‰è¯»äº‹ä»¶çš„æ—¶é—´ï¼Œç¬¬äºŒä¸ªå‚æ•°æ²¡æœ‰å†™äº‹ä»¶çš„æ—¶é—´ //ç¬¬ä¸‰ä¸ªå‚æ•°æ—¢æ²¡æœ‰è¯»äº‹ä»¶ä¹Ÿæ²¡æœ‰å†™äº‹ä»¶çš„æ—¶é—´ //è®¾ç½®ä¸º0ä»£è¡¨ä¸é™åˆ¶ //æ»¡è¶³ä»»æ„ä¸€ä¸ªåˆ™è§¦å‘IdleStateEventï¼Œå¯ä»¥åœ¨userEventTriggeredä¸­å¤„ç† pipeline.addLast(new IdleStateHandler(10,10,6, TimeUnit.SECONDS)); handlerä¸­ï¼š @Override public void userEventTriggered(ChannelHandlerContext ctx, Object evt) throws Exception { if(evt instanceof IdleStateEvent){ IdleStateEvent event = (IdleStateEvent)evt; String eventType = null; switch (event.state()){ case ALL_IDLE: eventType = \"è¯»å†™ç©ºé—²\"; break; case READER_IDLE: eventType = \"è¯»ç©ºé—²\"; break; case WRITER_IDLE: eventType = \"å†™ç©ºé—²\"; break; } System.out.println(ctx.channel().remoteAddress()+\"--è¶…æ—¶æ—¶é—´--\"+eventType); //æœåŠ¡å™¨å¯ä»¥æ–­å¼€è¯¥channelè¿æ¥ //ctx.channel.close(); } } 2 åŸºäºWebsocketçš„æœåŠ¡ç«¯å¼€å‘é¦–å…ˆWebsocketåè®®æ˜¯åŸºäºHttpåè®®çš„ï¼Œå®ƒå€Ÿç”¨äº†HTTPåè®®æ¥å®Œæˆä¸€éƒ¨åˆ†æ¡æ‰‹ï¼Œæ‰€ä»¥è¿æ¥çš„è¯·æ±‚çœ‹èµ·æ¥å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š GET /chat HTTP/1.1 Host: server.example.com Upgrade: websocket Connection: Upgrade Sec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw== Sec-WebSocket-Protocol: chat, superchat Sec-WebSocket-Version: 13 Origin: http://example.comæ‰€ä»¥é¦–å…ˆè¦ç»™pipelineåŠ ä¸€ä¸ªHttpServerCodecï¼š pipeline.addLast(\"MyHttpServerCodec\",new HttpServerCodec()); ç„¶åæ˜¯Httpç›¸å…³çš„handler pipeline.addLast(new ChunkedWriteHandler()); pipeline.addLast(new HttpObjectAggregator(8192)); ç„¶åæ˜¯websocketæ ¸å¿ƒhandlerï¼š //å°†httpåè®®å‡çº§ä¸ºwebsocketåè®®ï¼Œå‚æ•°ä»£è¡¨è¯·æ±‚çš„uri pipeline.addLast(new WebSocketServerProtocolHandler(\"/ws\")); ç„¶åå†™ä¸€ä¸ªå¤„ç†æ¶ˆæ¯çš„å¤„ç†å™¨ï¼š public class TextWebsocketFrameHandler extends SimpleChannelInboundHandler&lt;TextWebSocketFrame> { protected void channelRead0(ChannelHandlerContext ctx, TextWebSocketFrame msg) throws Exception { System.out.println(\"æœåŠ¡ç«¯æ”¶åˆ°æ¶ˆæ¯ï¼š\"+msg.text()); //å›å¤æ¶ˆæ¯ ctx.channel().writeAndFlush(new TextWebSocketFrame(\"æœåŠ¡å™¨æ—¶é—´ã€\"+ LocalDateTime.now()+\"ã€‘:\"+msg.text())); } //è¿æ¥å»ºç«‹æ—¶ï¼ŒhandlerAddedè¢«è°ƒç”¨ @Override public void handlerAdded(ChannelHandlerContext ctx) throws Exception { System.out.println(\"handlerAddedè¢«è°ƒç”¨\"+ctx.channel().id().asLongText()); } //è¿æ¥æ–­å¼€æ—¶ï¼ŒhandlerRemovedè¢«è°ƒç”¨ @Override public void handlerRemoved(ChannelHandlerContext ctx) throws Exception { System.out.println(\"handlerRemovedè¢«è°ƒç”¨\"+ctx.channel().id().asLongText()); } @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception { System.out.println(\"å¼‚å¸¸å‘ç”Ÿ\"+cause.getMessage()); ctx.close();//å…³é—­è¿æ¥ } } è¿™ä¸ªå¤„ç†å™¨ä¸­çš„channelRead0å¯ä»¥å°†å®¢æˆ·ç«¯å‘æ¥çš„æ¶ˆæ¯åŠ ä¸ŠæœåŠ¡å™¨æ—¶é—´è¿”å›ç»™å®¢æˆ·ç«¯ æœåŠ¡å™¨å¯åŠ¨ç±»æ€»ä½“çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š public class WebsocketServer { public void bind(int port) throws Exception{ EventLoopGroup bossGroup = new NioEventLoopGroup(); EventLoopGroup workerGroup = new NioEventLoopGroup(); try{ ServerBootstrap serverBootstrap = new ServerBootstrap(); serverBootstrap.group(bossGroup,workerGroup) .channel(NioServerSocketChannel.class) .option(ChannelOption.SO_BACKLOG, 1024) .childHandler(new ChannelInitializer&lt;SocketChannel>() { protected void initChannel(SocketChannel ch) throws Exception { ChannelPipeline pipeline = ch.pipeline(); pipeline.addLast(new HttpServerCodec()); pipeline.addLast(new ChunkedWriteHandler()); pipeline.addLast(new HttpObjectAggregator(8192)); pipeline.addLast(new WebSocketServerProtocolHandler(\"/ws\")); pipeline.addLast(new TextWebsocketFrameHandler()); } }); System.out.println(\"---------æœåŠ¡å™¨æ­£åœ¨å¯åŠ¨---------\"); ChannelFuture future = serverBootstrap.bind(port).sync(); future.channel().closeFuture().sync(); }finally { bossGroup.shutdownGracefully(); workerGroup.shutdownGracefully(); } } public static void main(String[] args) throws Exception { int port = 7000; new WebsocketServer().bind(port); } } ç¼–å†™ç½‘é¡µè¿›è¡Œæµ‹è¯•ï¼š &lt;!DOCTYPE html> &lt;html lang=\"en\"> &lt;head> &lt;meta charset=\"UTF-8\"> &lt;title>Title&lt;/title> &lt;/head> &lt;body> &lt;form onsubmit=\"return false\"> &lt;textarea name=\"message\" style=\"height: 300px;width: 300px\">&lt;/textarea> &lt;input type=\"button\" value=\"å‘é€æ¶ˆæ¯\" onclick=\"send(this.form.message.value)\"> &lt;textarea id=\"responseText\" style=\"height: 300px;width: 300px\">&lt;/textarea> &lt;input type=\"button\" value=\"æ¸…ç©ºå†…å®¹\" onclick=\"document.getElementById('responseText').value=''\"> &lt;/form> &lt;/body> &lt;script> let socket; if(window.WebSocket){ let rt = document.getElementById(\"responseText\"); socket = new WebSocket(\"ws://localhost:7000/ws\"); //æ”¶åˆ°æ¶ˆæ¯ socket.onmessage = function (ev) { rt.value += \"\\n\" + ev.data; } //è¿æ¥å¼€å¯ socket.onopen = function (ev) { rt.value = \"--------è¿æ¥å¼€å¯äº†---------\"; } socket.onclose = function (ev) { rt.value += \"\\n\" + \"-------è¿æ¥å…³é—­äº†-------\"; } }else { alert(\"å½“å‰æµè§ˆå™¨ä¸æ”¯æŒwebsocket\"); } //å‘é€æ¶ˆæ¯ function send(message) { if(!socket){//å…ˆåˆ¤æ–­socketæ˜¯å¦åˆ›å»ºå¥½ return; } if(socket.readyState == WebSocket.OPEN){ //å‘é€æ¶ˆæ¯ socket.send(message); }else{ alert(\"è¿æ¥æ²¡æœ‰å¼€å¯\"); } } &lt;/script> &lt;/html> æµ‹è¯•ï¼š","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"https://www.codetool.top/tags/Netty/"}]},{"title":"NettyåŸºäºHttpåè®®çš„æœåŠ¡ç«¯å¼€å‘","slug":"NettyåŸºäºHttpåè®®çš„æœåŠ¡ç«¯å¼€å‘","date":"2020-03-15T14:14:59.000Z","updated":"2020-03-15T16:28:11.783Z","comments":true,"path":"article/NettyåŸºäºHttpåè®®çš„æœåŠ¡ç«¯å¼€å‘/","link":"","permalink":"https://www.codetool.top/article/Netty%E5%9F%BA%E4%BA%8EHttp%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91/","excerpt":"","text":"1 ç®€å•æ¡ˆä¾‹å…ˆç…§å¸¸å†™ä¸€ä¸ªHandlerï¼Œæ³¨æ„æ”¶åˆ°çš„æ˜¯HttpObjectï¼ˆå®é™…ä¸Šæ˜¯ä¸€ä¸ªDefaultHttpRequestï¼‰ç±»å‹ã€‚å®ƒé™„å¸¦äº†å®¢æˆ·ç«¯çš„è¯·æ±‚ä¿¡æ¯ï¼ˆuriã€è¯·æ±‚methodã€è¯·æ±‚å¤´ï¼‰ public class TestHttpServerHandler extends SimpleChannelInboundHandler&lt;HttpObject> { //è¯»å–äº‹ä»¶ protected void channelRead0(ChannelHandlerContext ctx, HttpObject msg) throws Exception { if(msg instanceof HttpRequest){ System.out.println(\"msg ç±»å‹=\"+msg.getClass()); System.out.println(\"å®¢æˆ·ç«¯åœ°å€\" + ctx.channel().remoteAddress()); //æ„å»ºHttpResponse ByteBuf content = Unpooled.copiedBuffer(\"hello,æˆ‘æ˜¯æœåŠ¡å™¨\", CharsetUtil.UTF_8); DefaultFullHttpResponse response = new DefaultFullHttpResponse(HttpVersion.HTTP_1_1, HttpResponseStatus.OK, content); //è®¾ç½®å“åº”å¤´ response.headers().set(HttpHeaderNames.CONTENT_TYPE,\"text/plain; charset=utf-8\"); response.headers().set(HttpHeaderNames.CONTENT_LENGTH,content.readableBytes()); //è¿”å›response ctx.writeAndFlush(response); } } } åœ¨ChannelInitializerè¿™é‡Œï¼Œä¸ºchannelçš„pipelineæ·»åŠ ä¸Šé¢å†™çš„handlerã€‚æ³¨æ„åœ¨å‰é¢æ·»åŠ ä¸€ä¸ªHttpServerCodecï¼Œæ˜¯Nettyæä¾›çš„åŸºäºHTTPçš„ç¼–è§£ç å™¨ã€‚ public class TestServerInitializer extends ChannelInitializer&lt;SocketChannel> { protected void initChannel(SocketChannel ch) throws Exception { //å‘ç®¡é“åŠ å…¥å¤„ç†å™¨ //å¾—åˆ°ç®¡é“ ChannelPipeline pipeline = ch.pipeline(); //åŠ å…¥nettyæä¾›çš„httpServerCodec ï¼ˆcoder+decoderï¼‰ //åŸºäºHTTPçš„ç¼–è§£ç å™¨ pipeline.addLast(\"MyHttpServerCodec\",new HttpServerCodec()); pipeline.addLast(\"MyTestHttpServerHandler\",new TestHttpServerHandler()); } } å¯åŠ¨æœåŠ¡ç«¯çš„ä»£ç ï¼š public class TestHttpServer { public void bind(int port) throws Exception{ //é…ç½®æœåŠ¡å™¨çš„NIOçº¿ç¨‹ç»„ EventLoopGroup bossGroup = new NioEventLoopGroup(); EventLoopGroup workerGroup = new NioEventLoopGroup(); try{ ServerBootstrap serverBootstrap = new ServerBootstrap(); serverBootstrap.group(bossGroup,workerGroup) .channel(NioServerSocketChannel.class) .option(ChannelOption.SO_BACKLOG, 1024) .childHandler(new TestServerInitializer()); System.out.println(\"---------æœåŠ¡å™¨æ­£åœ¨å¯åŠ¨---------\"); ChannelFuture future = serverBootstrap.bind(port).sync(); //ç­‰å¾…æœåŠ¡ç«¯ç›‘å¬ç«¯å£å…³é—­ future.channel().closeFuture().sync(); }finally { bossGroup.shutdownGracefully(); workerGroup.shutdownGracefully(); } } public static void main(String[] args) throws Exception { int port = 8080; new TestHttpServer().bind(8080); } } è¿™æ ·ä¸€ä¸ªç®€å•æ¡ˆä¾‹å°±å®ç°äº†ï¼Œåªè¦å®¢æˆ·ç«¯å‘è¯¥æœåŠ¡ç«¯çš„ä¸»æœºã€ç«¯å£å‘èµ·HTTPè¯·æ±‚ï¼Œå°±ä¼šæ”¶åˆ°å¯¹åº”çš„å“åº”ï¼Œè€Œç”±äºæ²¡æœ‰åˆ¤æ–­è¯·æ±‚æ–¹æ³•ã€uriï¼Œæ— è®ºä»€ä¹ˆè¯·æ±‚éƒ½ä¼šæ”¶åˆ°ä¸€æ ·çš„å“åº”ã€‚ 2 å¯¹è¯·æ±‚èµ„æºï¼ˆuriï¼‰è¿›è¡Œè¿‡æ»¤æµè§ˆå™¨åœ¨å¯¹æŸç½‘ç«™å‘èµ·getè¯·æ±‚çš„æ—¶å€™ï¼Œé€šå¸¸è¿˜ä¼šå‘èµ·å¯¹è¯¥ç½‘ç«™/favicon.icoçš„è¯·æ±‚ï¼Œå¦‚æœæˆ‘ä»¬ä¸æƒ³å¯¹è¿™ä¸ªè¯·æ±‚åšå‡º404å›åº”ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š public class TestHttpServerHandler extends SimpleChannelInboundHandler&lt;HttpObject> { //è¯»å–äº‹ä»¶ protected void channelRead0(ChannelHandlerContext ctx, HttpObject msg) throws Exception { if(msg instanceof HttpRequest){ System.out.println(\"msg ç±»å‹=\"+msg.getClass()); System.out.println(\"å®¢æˆ·ç«¯åœ°å€\" + ctx.channel().remoteAddress()); //è·å–åˆ°è¯·æ±‚URI HttpRequest httpRequest = (HttpRequest) msg; URI uri = new URI(httpRequest.uri()); if(\"/favicon.ico\".equals(uri.getPath())){ System.out.println(\"è¯·æ±‚äº†å›¾æ ‡ï¼Œè¿”å›404\"); ByteBuf error = Unpooled.copiedBuffer(\"è¯¥èµ„æºä¸å­˜åœ¨\", CharsetUtil.UTF_8); DefaultFullHttpResponse response = new DefaultFullHttpResponse(HttpVersion.HTTP_1_1, HttpResponseStatus.NOT_FOUND, error); response.headers().set(HttpHeaderNames.CONTENT_TYPE,\"text/plain; charset=utf-8\"); response.headers().set(HttpHeaderNames.CONTENT_LENGTH,error.readableBytes()); ctx.writeAndFlush(response); return; } //æ„å»ºHttpResponse ByteBuf content = Unpooled.copiedBuffer(\"hello,æˆ‘æ˜¯æœåŠ¡å™¨\", CharsetUtil.UTF_8); DefaultFullHttpResponse response = new DefaultFullHttpResponse(HttpVersion.HTTP_1_1, HttpResponseStatus.OK, content); response.headers().set(HttpHeaderNames.CONTENT_TYPE,\"text/plain; charset=utf-8\"); response.headers().set(HttpHeaderNames.CONTENT_LENGTH,content.readableBytes()); //è¿”å›response ctx.writeAndFlush(response); } } } è¿™é‡Œé€šè¿‡HttpRequestæ¥è·å–äº†å®¢æˆ·ç«¯è¯·æ±‚çš„uriï¼Œé™¤äº†uriå¤–ï¼Œé€šè¿‡HttpRequestè¿˜å¯ä»¥è·å–ï¼š httpRequest.method()ï¼šè·å–è¯·æ±‚æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•åœ¨HttpMethodä¸­è¢«æšä¸¾ httpRequest.protocolVersion()ï¼šè·å–åè®®ç‰ˆæœ¬ï¼Œæ˜¯HttpVersion.HTTP_1_0æˆ–HttpVersion.HTTP_1_1 httpRequest.headers()ï¼šè¯·æ±‚å¤´ï¼Œå¯è¯»å¯å†™ï¼Œä½¿ç”¨get/setæ–¹æ³• 3 å…¶ä»–handleråœ¨ç®€å•æ¡ˆä¾‹ä¸­åªç”¨äº†ä¸€ä¸ªHttpServerCodecä½œä¸ºhttpç¼–è§£ç å™¨ï¼Œè¿˜æœ‰ä¸€äº›è‡ªå¸¦çš„handlerå¯ä»¥ä½¿ç”¨ï¼š HttpObjectAggregatorï¼Œå¯¹äºPOSTè¯·æ±‚å­˜åœ¨è¯·æ±‚ä½“ï¼ŒHTTPæ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯åˆ†æ®µä¼ è¾“çš„ï¼ŒHttpObjectAggregatorå¯ä»¥å°†å¤šä¸ªæ®µèšåˆã€‚ ChunkedWriteHandlerï¼Œåœ¨ç®€å•æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬ç”¨äº†å“åº”å¤´çš„CONTENT_LENGTHæ¥æŒ‡å®šå“åº”ä½“çš„é•¿åº¦ï¼Œè€Œæœ‰çš„æ—¶å€™æ— æ³•ç¡®å®šä¿¡æ¯å¤§å°ï¼Œå°±å¯ä»¥ä½¿ç”¨Chunkedç¼–ç ä¼ è¾“ï¼ˆåˆ†å—ï¼‰ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"https://www.codetool.top/tags/Netty/"}]},{"title":"Nettyè§£å†³TCPç²˜åŒ…æ‹†åŒ…-å››ç§è‡ªå¸¦è§£ç å™¨","slug":"Nettyè§£å†³TCPç²˜åŒ…æ‹†åŒ…-å››ç§è‡ªå¸¦è§£ç å™¨","date":"2020-03-15T10:09:30.000Z","updated":"2020-03-15T10:13:16.274Z","comments":true,"path":"article/Nettyè§£å†³TCPç²˜åŒ…æ‹†åŒ…-å››ç§è‡ªå¸¦è§£ç å™¨/","link":"","permalink":"https://www.codetool.top/article/Netty%E8%A7%A3%E5%86%B3TCP%E7%B2%98%E5%8C%85%E6%8B%86%E5%8C%85-%E5%9B%9B%E7%A7%8D%E8%87%AA%E5%B8%A6%E8%A7%A3%E7%A0%81%E5%99%A8/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š LengthFieldBasedFrameDecoder ç§’æ‡‚ - ç–¯ç‹‚åˆ›å®¢åœˆ - åšå®¢å›­ åœ¨TCPåè®®ä¸­ï¼Œä¸€ä¸ªå®Œæ•´çš„åŒ…å¯èƒ½ä¼šè¢«æ‹†åˆ†ä¸ºå¤šä¸ªåŒ…è¿›è¡Œå‘é€ï¼Œä¹Ÿæœ‰å¯èƒ½æŠŠå¤šä¸ªå°çš„åŒ…å°è£…æˆä¸€ä¸ªå¤§çš„æ•°æ®åŒ…è¿›è¡Œå‘é€ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„TCPç²˜åŒ…å’Œæ‹†åŒ…é—®é¢˜ã€‚ 1 ç²˜åŒ…/æ‹†åŒ…å‘ç”Ÿçš„åŸå›  åº”ç”¨ç¨‹åºwriteå†™å…¥çš„å­—èŠ‚å¤§å°å¤§äºå¥—æ¥å£å‘é€ç¼“å†²åŒºå¤§å° è¿›è¡ŒMSSå¤§å°çš„TCPåˆ†æ®µï¼ˆæœ€å¤§æŠ¥æ–‡é•¿åº¦ï¼‰ ä»¥å¤ªç½‘å¸§çš„payloadå¤§äºMTUè¿›è¡ŒIPåˆ†ç‰‡ï¼ˆé“¾è·¯å±‚çš„æœ€å¤§ä¼ è¾“å•å…ƒï¼‰ 1.1 å‘ç”Ÿç²˜åŒ…é—®é¢˜çš„æ—¶é—´æœåŠ¡å™¨æ¡ˆä¾‹1.1.1 æœåŠ¡ç«¯public class NettyServer { public void bind(int port) throws Exception{ //é…ç½®æœåŠ¡å™¨çš„NIOçº¿ç¨‹ç»„ EventLoopGroup bossGroup = new NioEventLoopGroup(); EventLoopGroup workerGroup = new NioEventLoopGroup(); try{ ServerBootstrap serverBootstrap = new ServerBootstrap(); serverBootstrap.group(bossGroup,workerGroup) .channel(NioServerSocketChannel.class) .option(ChannelOption.SO_BACKLOG, 1024) .childHandler(new ChildChannelHandler()); //ç»‘å®šç«¯å£ï¼ŒåŒæ­¥ç­‰å¾…æˆåŠŸ ChannelFuture future = serverBootstrap.bind(port).sync(); //ç­‰å¾…æœåŠ¡ç«¯ç›‘å¬ç«¯å£å…³é—­ future.channel().closeFuture().sync(); }finally { bossGroup.shutdownGracefully(); workerGroup.shutdownGracefully(); } } private class ChildChannelHandler extends ChannelInitializer&lt;SocketChannel>{ protected void initChannel(SocketChannel ch) throws Exception { ch.pipeline().addLast(new NettyServerHandler()); } } public static void main(String[] args) throws Exception { int port = 8080; new NettyServer().bind(8080); } } public class NettyServerHandler extends ChannelInboundHandlerAdapter { private int counter; @Override public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception { ByteBuf buf = (ByteBuf) msg; String body = buf.toString(CharsetUtil.UTF_8); System.out.println(\"The time server receive order: \"+ body + \"; the counter is: \" + ++counter); //å¦‚æœæ”¶åˆ°çš„è¯·æ±‚æ˜¯QUERY TIME ORDERå°±è¿”å›å½“å‰æ—¶é—´ String currentTime = \"QUERY TIME ORDER\".equalsIgnoreCase(body)?new java.util.Date( System.currentTimeMillis() ).toString():\"BAD ORDER\"; currentTime = currentTime + System.getProperty(\"line.separator\"); ByteBuf resp = Unpooled.copiedBuffer(currentTime.getBytes()); ctx.writeAndFlush(resp); } @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception { ctx.close(); } } 1.1.2 å®¢æˆ·ç«¯public class NettyClient { public void connect(int port,String host) throws Exception{ //é…ç½®å®¢æˆ·ç«¯NIOçº¿ç¨‹ç»„ EventLoopGroup group = new NioEventLoopGroup(); try { Bootstrap bootstrap = new Bootstrap(); bootstrap.group(group).channel(NioSocketChannel.class) .option(ChannelOption.TCP_NODELAY, true) .handler(new ChannelInitializer&lt;SocketChannel>() { protected void initChannel(SocketChannel ch) throws Exception { ch.pipeline().addLast(new NettyClientHandler()); } }); ChannelFuture future = bootstrap.connect(host, port).sync(); future.channel().closeFuture().sync(); }finally { group.shutdownGracefully(); } } public static void main(String[] args) throws Exception { int port = 8080; new NettyClient().connect(port, \"127.0.0.1\"); } } public class NettyClientHandler extends ChannelInboundHandlerAdapter { private static final Logger logger = Logger.getLogger(NettyClientHandler.class.getName()); private int counter; private byte[] req; public NettyClientHandler() { req = (\"QUERY TIME ORDER\" + System.getProperty(\"line.separator\")).getBytes(); } @Override public void channelActive(ChannelHandlerContext ctx) throws Exception { ByteBuf message = null; //è¿ç»­å‘é€ä¸€ç™¾æ¡QUERY TIME ORDERæ¶ˆæ¯ for(int i = 0;i&lt;100;i++){ message = Unpooled.buffer(req.length); message.writeBytes(req); ctx.writeAndFlush(message); } } @Override public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception { ByteBuf buf = (ByteBuf) msg; String body = buf.toString(CharsetUtil.UTF_8); System.out.println(\"Now isï¼š\"+body+\"; the counter is: \"+ ++counter); } @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception { logger.warning(\"Unexpected exception from downstream: \"+cause.getMessage()); ctx.close(); } } åˆ†åˆ«è¿è¡ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼Œé¢„æœŸç»“æœåº”è¯¥æ˜¯æœåŠ¡ç«¯å“åº”100æ¬¡æ—¶é—´ï¼Œç„¶è€ŒæœåŠ¡ç«¯æ‰“å°ï¼š The time server receive order: QUERY TIME ORDER QUERY TIME ORDER QUERY TIME ORDER QUERY TIME ORDER QUERY TIME ORDER QUERY TIME ORDER ---çœç•¥éƒ¨åˆ†ï¼Œæ­¤å¤„å…±57æ¡QUERY TIME ORDER---- QUERY TIME ORDER QUERY TIME ORDER; the counter is: 1 The time server receive order: QUERY TIME ORDER ---çœç•¥éƒ¨åˆ†ï¼Œæ­¤å¤„å…±43æ¡QUERY TIME ORDER---- QUERY TIME ORDER QUERY TIME ORDER ; the counter is: 2å¯è§å‘ç”Ÿäº†ç²˜åŒ…é—®é¢˜ï¼Œè‡ªç„¶å®¢æˆ·ç«¯ä¹Ÿæ²¡æœ‰æ”¶åˆ°æ­£ç¡®çš„å“åº”ï¼š Now isï¼šBAD ORDER BAD ORDER ; the counter is: 12 è§£å†³ç­–ç•¥ æ¶ˆæ¯å®šé•¿ï¼Œä¾‹å¦‚æ¯ä¸ªæŠ¥æ–‡çš„å¤§å°ä¸ºå›ºå®šé•¿åº¦200å­—èŠ‚ï¼Œå¦‚æœä¸å¤Ÿï¼Œç©ºä½è¡¥ç©ºæ ¼; åœ¨åŒ…å°¾å¢åŠ å›è½¦æ¢è¡Œç¬¦è¿›è¡Œåˆ†å‰²ï¼Œä¾‹å¦‚FTPåè®®; å°†æ¶ˆæ¯åˆ†ä¸ºæ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ï¼Œæ¶ˆæ¯å¤´ä¸­åŒ…å«è¡¨ç¤ºæ¶ˆæ¯æ€»é•¿åº¦(æˆ–è€…æ¶ˆæ¯ä½“é•¿åº¦)çš„å­—æ®µï¼Œé€šå¸¸è®¾è®¡æ€è·¯ä¸ºæ¶ˆæ¯å¤´çš„ç¬¬ä¸€ä¸ªå­—æ®µä½¿ç”¨int32æ¥è¡¨ç¤ºæ¶ˆæ¯çš„æ€»é•¿åº¦; æ›´å¤æ‚çš„åº”ç”¨å±‚åè®®ã€‚ 2.1 ä½¿ç”¨LineBasedFrameDecoderè§£å†³TCPç²˜åŒ…é—®é¢˜ä¸ºäº†è§£å†³TCPç²˜åŒ…/æ‹†åŒ…å¯¼è‡´çš„åŠåŒ…è¯»å†™é—®é¢˜ï¼ŒNetty é»˜è®¤æä¾›äº†å¤šç§ç¼–è§£ç å™¨ç”¨äºå¤„ç†åŠåŒ…ï¼ŒLineBasedFrameDecoderæ˜¯å…¶ä¸­çš„ä¸€ç§ï¼Œé€šè¿‡æ¢è¡Œç¬¦æ¥åˆ†åŒ…ã€‚ 2.2 ä½¿ç”¨LineBasedFrameDecoderæ”¹å†™åçš„æ¡ˆä¾‹éœ€è¦æ”¹å†™çš„æœ‰å››ä¸ªåœ°æ–¹ï¼š åœ¨NettyServerä¸­pipelineæ·»åŠ å¤„ç†å™¨ private class ChildChannelHandler extends ChannelInitializer&lt;SocketChannel>{ protected void initChannel(SocketChannel ch) throws Exception { ch.pipeline().addLast(new LineBasedFrameDecoder(1024)); ch.pipeline().addLast(new StringDecoder()); ch.pipeline().addLast(new NettyServerHandler()); } } åœ¨NettyServerHandlerä¸­æŠŠæ¶ˆæ¯å½“å­—ç¬¦ä¸²å¤„ç† @Override public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception { //è½¬String String body = (String) msg; System.out.println(\"The time server receive order: \"+ body + \"; the counter is: \" + ++counter); String currentTime = \"QUERY TIME ORDER\".equalsIgnoreCase(body)?new java.util.Date( System.currentTimeMillis() ).toString():\"BAD ORDER\"; currentTime = currentTime + System.getProperty(\"line.separator\"); ByteBuf resp = Unpooled.copiedBuffer(currentTime.getBytes()); ctx.writeAndFlush(resp); } åœ¨NettyClientä¸­pipelineæ·»åŠ å¤„ç†å™¨ new ChannelInitializer&lt;SocketChannel>() { protected void initChannel(SocketChannel ch) throws Exception { ch.pipeline().addLast(new LineBasedFrameDecoder(1024)); ch.pipeline().addLast(new StringDecoder()); ch.pipeline().addLast(new NettyClientHandler()); } } åœ¨NettyClientHandlerä¸­æŠŠæ¶ˆæ¯å½“å­—ç¬¦ä¸²å¤„ç† @Override public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception { String body = (String) msg; System.out.println(\"Now isï¼š\"+body+\"; the counter is: \"+ ++counter); } å†æ¬¡åˆ†åˆ«è¿è¡ŒæœåŠ¡ç«¯ã€å®¢æˆ·ç«¯ï¼Œå‘ç°é—®é¢˜è§£å†³ï¼š The time server receive order: QUERY TIME ORDER; the counter is: 1 The time server receive order: QUERY TIME ORDER; the counter is: 2 The time server receive order: QUERY TIME ORDER; the counter is: 3 -----------------------çœç•¥--------------------------- The time server receive order: QUERY TIME ORDER; the counter is: 98 The time server receive order: QUERY TIME ORDER; the counter is: 99 The time server receive order: QUERY TIME ORDER; the counter is: 100Now isï¼šSun Mar 15 16:39:58 CST 2020; the counter is: 1 Now isï¼šSun Mar 15 16:39:58 CST 2020; the counter is: 2 Now isï¼šSun Mar 15 16:39:58 CST 2020; the counter is: 3 -----------------------çœç•¥------------------------- Now isï¼šSun Mar 15 16:39:58 CST 2020; the counter is: 98 Now isï¼šSun Mar 15 16:39:58 CST 2020; the counter is: 99 Now isï¼šSun Mar 15 16:39:58 CST 2020; the counter is: 1002.3 LineBasedFrameDecoderå·¥ä½œåŸç†LineBasedFrameDecoderçš„å·¥ä½œåŸç†æ˜¯å®ƒä¾æ¬¡éå†ByteBufä¸­çš„å¯è¯»å­—èŠ‚ï¼Œåˆ¤æ–­çœ‹æ˜¯å¦æœ‰â€œ\\nâ€æˆ–è€…â€œ\\r\\nâ€ï¼Œ å¦‚æœæœ‰ï¼Œå°±ä»¥æ­¤ä½ç½®ä¸ºç»“æŸä½ç½®ï¼Œä»å¯è¯»ç´¢å¼•åˆ°ç»“æŸä½ç½®åŒºé—´çš„å­—èŠ‚å°±ç»„æˆäº†ä¸€è¡Œã€‚å®ƒæ˜¯ä»¥æ¢è¡Œç¬¦ä¸ºç»“æŸæ ‡å¿—çš„è§£ç å™¨ï¼Œæ”¯æŒæºå¸¦ç»“æŸç¬¦æˆ–è€…ä¸æºå¸¦ç»“æŸç¬¦ä¸¤ç§è§£ç æ–¹å¼ï¼ŒåŒæ—¶æ”¯æŒé…ç½®å•è¡Œçš„æœ€å¤§é•¿åº¦ã€‚å¦‚æœè¿ç»­è¯»å–åˆ°æœ€å¤§é•¿åº¦åä»ç„¶æ²¡æœ‰å‘ç°æ¢è¡Œç¬¦ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼ŒåŒæ—¶å¿½ç•¥æ‰ä¹‹å‰è¯»åˆ°çš„å¼‚å¸¸ç æµã€‚ StringDecoderçš„åŠŸèƒ½éå¸¸ç®€å•ï¼Œå°±æ˜¯å°†æ¥æ”¶åˆ°çš„å¯¹è±¡è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œç„¶åç»§ç»­è°ƒç”¨åé¢çš„Handlerã€‚ LineBasedFrameDecoder + StringDecoder ç»„åˆå°±æ˜¯æŒ‰è¡Œåˆ‡æ¢çš„æ–‡æœ¬è§£ç å™¨ï¼Œå®ƒè¢«è®¾è®¡ç”¨æ¥æ”¯æŒTCPçš„ç²˜åŒ…å’Œæ‹†åŒ…ã€‚ å¦‚æœå‘é€çš„æ¶ˆæ¯ä¸æ˜¯ä»¥æ¢è¡Œç¬¦ç»“æŸçš„ï¼Œæˆ–è€…æ²¡æœ‰å›è½¦æ¢è¡Œç¬¦ï¼Œå¸Œæœ›æ ¹æ®æ¶ˆæ¯å¤´ä¸­çš„é•¿åº¦å­—æ®µæ¥åˆ†åŒ…ï¼ŒNettyæä¾›äº†å¤šç§æ”¯æŒTCPç²˜åŒ…/æ‹†åŒ…çš„è§£ç å™¨ï¼Œç”¨æ¥æ»¡è¶³ç”¨æˆ·çš„ä¸åŒè¯‰æ±‚ã€‚ 2.4 å…¶ä»–è§£ç å™¨2.4.1 DelimiterBasedFrameDecoderè¿™æ˜¯ä¸€ä¸ªæ ¹æ®è‡ªå®šä¹‰åˆ†éš”ç¬¦åˆ†åŒ…çš„è§£ç å™¨ ä½¿ç”¨ï¼š private class ChildChannelHandler extends ChannelInitializer&lt;SocketChannel>{ protected void initChannel(SocketChannel ch) throws Exception { ByteBuf delimiter = Unpooled.copiedBuffer(\"$_\".getBytes()); //ç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨å•æ¡æ¶ˆæ¯çš„æœ€å¤§é•¿åº¦ï¼Œå½“è¾¾åˆ°è¯¥é•¿åº¦ä»æ²¡æœ‰æŸ¥åˆ°åˆ†éš”ç¬¦æŠ›å‡ºå¼‚å¸¸ ch.pipeline().addLast(new DelimiterBasedFrameDecoder(1024,delimiter)); ch.pipeline().addLast(new StringDecoder()); ch.pipeline().addLast(new NettyServerHandler()); } } å‘æ¶ˆæ¯çš„æ—¶å€™ä¹Ÿè¦åœ¨æ¶ˆæ¯æœ«å°¾å¢åŠ â€$_â€œï¼Œå’ŒLineBasedFrameDecoderåŠ æ¢è¡Œç¬¦å·®ä¸å¤šçš„åšæ³•ã€‚ 2.4.2 FixedLengthFrameDecoderè¿™æ˜¯ä¸€ä¸ªæŒ‰å›ºå®šé•¿åº¦åˆ†åŒ…çš„è§£ç å™¨ ä½¿ç”¨ï¼š private class ChildChannelHandler extends ChannelInitializer&lt;SocketChannel>{ protected void initChannel(SocketChannel ch) throws Exception { ch.pipeline().addLast(new FixedLengthFrameDecoder(20)); ch.pipeline().addLast(new StringDecoder()); ch.pipeline().addLast(new NettyServerHandler()); } } æ— è®ºä¸€æ¬¡æ¥æ”¶åˆ°å¤šå°‘æ•°æ®æŠ¥ï¼Œå®ƒéƒ½ä¼šæŒ‰ç…§æ„é€ å‡½æ•°ä¸­è®¾ç½®çš„å›ºå®šé•¿åº¦è¿›è¡Œè§£ç ã€‚é€‚ç”¨äºæ•°æ®é•¿åº¦å›ºå®šçš„æƒ…å†µï¼Œå¦åˆ™åœ¨handlerä¸­æ‰‹åŠ¨å¡«å……é•¿åº¦ä¹Ÿè¡Œã€‚ 2.4.3 LengthFieldBasedFrameDecoderè¿™ä¸ªå°±æ˜¯åœ¨åœ¨æ•°æ®åŒ…ä¸­ï¼ŒåŠ äº†ä¸€ä¸ªé•¿åº¦å­—æ®µï¼ˆé•¿åº¦åŸŸï¼‰ï¼Œä¿å­˜ä¸Šå±‚åŒ…çš„é•¿åº¦ã€‚è§£ç çš„æ—¶å€™ï¼Œä¼šæŒ‰ç…§è¿™ä¸ªé•¿åº¦ï¼Œè¿›è¡Œä¸Šå±‚ByteBufåº”ç”¨åŒ…çš„æå–ã€‚ ä½¿ç”¨ï¼š private class ChildChannelHandler extends ChannelInitializer&lt;SocketChannel>{ protected void initChannel(SocketChannel ch) throws Exception { ch.pipeline().addLast(new LengthFieldBasedFrameDecoder(1024,0,4,0,4)); ch.pipeline().addLast(new StringDecoder()); ch.pipeline().addLast(new NettyServerHandler()); } } å…¶ä¸­äº”ä¸ªå‚æ•°ï¼š ï¼ˆ1ï¼‰maxFrameLength - å‘é€çš„æ•°æ®åŒ…æœ€å¤§é•¿åº¦ï¼› ï¼ˆ2ï¼‰lengthFieldOffset - é•¿åº¦åŸŸåç§»é‡ï¼ŒæŒ‡çš„æ˜¯é•¿åº¦åŸŸä½äºæ•´ä¸ªæ•°æ®åŒ…å­—èŠ‚æ•°ç»„ä¸­çš„ä¸‹æ ‡ï¼› ï¼ˆ3ï¼‰lengthFieldLength - é•¿åº¦åŸŸçš„è‡ªå·±çš„å­—èŠ‚æ•°é•¿åº¦ã€‚ ï¼ˆ4ï¼‰lengthAdjustment â€“ é•¿åº¦åŸŸçš„åç§»é‡çŸ«æ­£ã€‚ å¦‚æœé•¿åº¦åŸŸçš„å€¼ï¼Œé™¤äº†åŒ…å«æœ‰æ•ˆæ•°æ®åŸŸçš„é•¿åº¦å¤–ï¼Œè¿˜åŒ…å«äº†å…¶ä»–åŸŸï¼ˆå¦‚é•¿åº¦åŸŸè‡ªèº«ï¼‰é•¿åº¦ï¼Œé‚£ä¹ˆï¼Œå°±éœ€è¦è¿›è¡ŒçŸ«æ­£ã€‚çŸ«æ­£çš„å€¼ä¸ºï¼šåŒ…é•¿ - é•¿åº¦åŸŸçš„å€¼ â€“ é•¿åº¦åŸŸåç§» â€“ é•¿åº¦åŸŸé•¿ã€‚ ï¼ˆ5ï¼‰initialBytesToStrip â€“ ä¸¢å¼ƒçš„èµ·å§‹å­—èŠ‚æ•°ã€‚ä¸¢å¼ƒå¤„äºæœ‰æ•ˆæ•°æ®å‰é¢çš„å­—èŠ‚æ•°é‡ã€‚æ¯”å¦‚å‰é¢æœ‰4ä¸ªèŠ‚ç‚¹çš„é•¿åº¦åŸŸï¼Œåˆ™å®ƒçš„å€¼ä¸º4ã€‚ LengthFieldBasedFrameDecoder(1024,0,4,0,4)çš„æ„æ€å°±æ˜¯ï¼Œæ•°æ®åŒ…æœ€å¤§é•¿åº¦ä¸º1024ï¼Œé•¿åº¦åŸŸå é¦–éƒ¨çš„å››ä¸ªå­—èŠ‚ï¼Œåœ¨è¯»æ•°æ®çš„æ—¶å€™å»æ‰é¦–éƒ¨å››ä¸ªå­—èŠ‚ï¼ˆå³é•¿åº¦åŸŸï¼‰ åœ¨ä½¿ç”¨çš„æ—¶å€™handlerå†™ByteBufæ•°æ®çš„æ—¶å€™åº”è¯¥åœ¨é¦–éƒ¨å¢æ·»ä¸€ä¸ªå››ä¸ªå­—èŠ‚çš„é•¿åº¦åŸŸï¼Œä»£è¡¨æ•°æ®é•¿åº¦ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"https://www.codetool.top/tags/Netty/"}]},{"title":"Nettyä½¿ç”¨å…¥é—¨æ¡ˆä¾‹","slug":"Nettyä½¿ç”¨å…¥é—¨æ¡ˆä¾‹","date":"2020-03-15T07:42:54.000Z","updated":"2020-03-15T07:43:28.770Z","comments":true,"path":"article/Nettyä½¿ç”¨å…¥é—¨æ¡ˆä¾‹/","link":"","permalink":"https://www.codetool.top/article/Netty%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B/","excerpt":"","text":"mavenä¾èµ–ï¼š &lt;dependency> &lt;groupId>io.netty&lt;/groupId> &lt;artifactId>netty-all&lt;/artifactId> &lt;version>4.1.42.Final&lt;/version> &lt;/dependency> 1 æœåŠ¡ç«¯//å†™æœåŠ¡ç«¯çš„pipelineç®¡é“å¤„ç†å™¨ï¼Œå¦‚æœworker groupä¸­çš„NioEventLoopç›‘å¬åˆ°äº†channelçš„read/writeäº‹ä»¶å°±ä¼šè§¦å‘ public class NettyServerHandler extends ChannelInboundHandlerAdapter { @Override /** * è¯»å–æ•°æ®äº‹ä»¶ï¼Œå¯ä»¥è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ * ChannelHandlerContextä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå«æœ‰ç®¡é“pipelineï¼Œé€šé“channelï¼Œåœ°å€ * Object å®¢æˆ·ç«¯å‘é€çš„æ•°æ® */ public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception { System.out.println(\"server ctx = \"+ctx); //å°†msgè½¬æˆä¸€ä¸ªByteBuf ByteBuf buf = (ByteBuf) msg; System.out.println(\"å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯æ˜¯ï¼š\"+buf.toString(CharsetUtil.UTF_8)); System.out.println(\"å®¢æˆ·ç«¯åœ°å€ï¼š\"+ctx.channel().remoteAddress()); } //æ•°æ®è¯»å–å®Œæ¯• @Override public void channelReadComplete(ChannelHandlerContext ctx) throws Exception { //write+flushï¼Œå°†æ•°æ®å†™å…¥åˆ°ç¼“å­˜ï¼Œå¹¶åˆ·æ–° ctx.writeAndFlush(Unpooled.copiedBuffer(\"helloï¼Œå®¢æˆ·ç«¯~\",CharsetUtil.UTF_8)); } //å¤„ç†å¼‚å¸¸ï¼Œä¸€èˆ¬æ˜¯è¦å…³é—­é€šé“ @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception { ctx.close(); } } public class NettyServer { public static void main(String[] args) throws InterruptedException { //åˆ›å»ºBossGroupå’ŒWorkerGroup //1. bossGroupåªå¤„ç†è¿æ¥è¯·æ±‚ //2. workerGroupå¤„ç†ä¸šåŠ¡è¯·æ±‚ //ä¸¤ä¸ªä¸­éƒ½æœ‰æ— é™å¾ªç¯çš„NioEventLoop NioEventLoopGroup bossGroup = new NioEventLoopGroup(); NioEventLoopGroup workerGroup = new NioEventLoopGroup(); try { //åˆ›å»ºæœåŠ¡å™¨ç«¯çš„å¯åŠ¨ç±» ServerBootstrap bootstrap = new ServerBootstrap(); //ä½¿ç”¨é“¾å¼ç¼–ç¨‹é…ç½® bootstrap.group(bossGroup,workerGroup)//è®¾ç½®ä¸¤ä¸ªçº¿ç¨‹ç»„ .channel(NioServerSocketChannel.class)//ä½¿ç”¨NioServerSocketChannelä½œä¸ºæœåŠ¡å™¨çš„é€šé“å®ç° .option(ChannelOption.SO_BACKLOG,128)//è®¾ç½®çº¿ç¨‹é˜Ÿåˆ—å¾—åˆ°è¿æ¥ä¸ªæ•° .childOption(ChannelOption.SO_KEEPALIVE,true)//è®¾ç½®ä¿æŒæ´»åŠ¨è¿æ¥çŠ¶æ€ .childHandler(new ChannelInitializer&lt;SocketChannel>() { //åˆ›å»ºä¸€ä¸ªé€šé“åˆå§‹åŒ–å¯¹è±¡ //ç»™pipelineè®¾ç½®å¤„ç†å™¨ protected void initChannel(SocketChannel ch) throws Exception { ch.pipeline().addLast(new NettyServerHandler()); } });//ç»™workerGroupçš„EventLoopå¯¹åº”çš„ç®¡é“è®¾ç½®å¤„ç†å™¨ System.out.println(\"----------æœåŠ¡å™¨ is ready-----------\"); //syncåŒæ­¥é˜»å¡ç­‰å¾…ç»‘å®šå®Œæˆï¼Œè¿”å›ä¸€ä¸ªChannelFutureç”¨äºå¼‚æ­¥æ“ä½œçš„é€šçŸ¥å›è°ƒ //å¯åŠ¨æœåŠ¡å™¨ ChannelFuture cf = bootstrap.bind(6668).sync(); //å¯¹å…³é—­é€šé“è¿›è¡Œç›‘å¬ cf.channel().closeFuture().sync(); } finally { //å…³é—­å¾ªç¯çº¿ç¨‹ç»„ bossGroup.shutdownGracefully(); workerGroup.shutdownGracefully(); } } } 2 å®¢æˆ·ç«¯public class NettyClientHandler extends ChannelInboundHandlerAdapter { //é€šé“å°±ç»ªäº‹ä»¶ @Override public void channelActive(ChannelHandlerContext ctx) throws Exception { System.out.println(\"client \" + ctx); ctx.writeAndFlush(Unpooled.copiedBuffer(\"hello,server\", CharsetUtil.UTF_8)); } //å½“é€šé“æœ‰è¯»å–äº‹ä»¶æ—¶ï¼Œä¼šè§¦å‘ @Override public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception { ByteBuf buf = (ByteBuf) msg; System.out.println(\"æœåŠ¡å™¨å›å¤çš„æ¶ˆæ¯ï¼š\"+buf.toString(CharsetUtil.UTF_8)); System.out.println(\"æœåŠ¡å™¨çš„åœ°å€ï¼š\"+ctx.channel().remoteAddress()); } @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception { cause.printStackTrace(); ctx.close(); } } public class NettyClient { public static void main(String[] args) throws InterruptedException { //å®¢æˆ·ç«¯åªéœ€è¦ä¸€ä¸ªäº‹ä»¶å¾ªç¯ç»„ NioEventLoopGroup eventExecutors = new NioEventLoopGroup(); try { //åˆ›å»ºå®¢æˆ·ç«¯çš„å¯åŠ¨å¯¹è±¡ Bootstrap bootstrap = new Bootstrap(); //è®¾ç½®ç›¸å…³å‚æ•° bootstrap.group(eventExecutors) .channel(NioSocketChannel.class) .handler(new ChannelInitializer&lt;SocketChannel>() { protected void initChannel(SocketChannel ch) throws Exception { ch.pipeline().addLast(new NettyClientHandler());//åŠ å…¥å¤„ç†å™¨ } }); System.out.println(\"-----------å®¢æˆ·ç«¯ ok------------\"); //å¯åŠ¨å®¢æˆ·ç«¯å»è¿æ¥æœåŠ¡å™¨ ChannelFuture channelFuture = bootstrap.connect(\"127.0.0.1\", 6668).sync(); //ç»™å…³é—­é€šé“è¿›è¡Œç›‘å¬ channelFuture.channel().closeFuture().sync(); } finally { eventExecutors.shutdownGracefully(); } } } 3 å¼‚æ­¥æ¨¡å‹å¼‚æ­¥çš„æ¦‚å¿µå’ŒåŒæ­¥ç›¸å¯¹ã€‚å½“ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹è°ƒç”¨å‘å‡ºåï¼Œè°ƒç”¨è€…ä¸èƒ½ç«‹åˆ»å¾—åˆ°ç»“æœã€‚å®é™…å¤„ç†è¿™ä¸ªè°ƒç”¨çš„ç»„ä»¶åœ¨å®Œæˆåï¼Œé€šè¿‡çŠ¶æ€ã€é€šçŸ¥å’Œå›è°ƒæ¥é€šçŸ¥è°ƒç”¨è€…ã€‚ Netty ä¸­çš„ I/O æ“ä½œæ˜¯å¼‚æ­¥çš„ï¼ŒåŒ…æ‹¬ Bindã€Writeã€Connect ç­‰æ“ä½œä¼šç®€å•çš„è¿”å›ä¸€ä¸ª ChannelFutureã€‚ public interface ChannelFuture extends Future&lt;Void&gt; è°ƒç”¨è€…å¹¶ä¸èƒ½ç«‹åˆ»è·å¾—ç»“æœï¼Œè€Œæ˜¯é€šè¿‡ Future-Listener æœºåˆ¶ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿çš„ä¸»åŠ¨è·å–æˆ–è€…é€šè¿‡é€šçŸ¥æœºåˆ¶è·å¾— IO æ“ä½œç»“æœ 4 å¼‚æ­¥ä»»åŠ¡çš„æ”¯æŒ4.1 TaskQueueHandlerä¸­å¯ä»¥é€šè¿‡ä½¿ç”¨NioEventLoopGroupä¸­çš„TaskQueueæ¥å®ç°å¼‚æ­¥ä»»åŠ¡ï¼Œè§£å†³Handlerä¸­å¯èƒ½ä¼šå‡ºç°çš„é•¿æ—¶é—´é˜»å¡é—®é¢˜ã€‚ public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception { ctx.channel().eventLoop().execute(new Runnable() { public void run() { try { Thread.sleep(10000); System.out.println(\"handling...\"); System.out.println(\"server ctx = \"+ctx); //å°†msgè½¬æˆä¸€ä¸ªByteBuf ByteBuf buf = (ByteBuf) msg; System.out.println(\"å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯æ˜¯ï¼š\"+buf.toString(CharsetUtil.UTF_8)); System.out.println(\"å®¢æˆ·ç«¯åœ°å€ï¼š\"+ctx.channel().remoteAddress()); } catch (InterruptedException e) { e.printStackTrace(); } } }); } 4.2 ScheduleTaskQueueå¯ä»¥ä½¿ç”¨ScheduleTaskQueueå®šä¹‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception { // åœ¨æŒ‡å®šå»¶è¿Ÿåæ‰§è¡Œä»»åŠ¡ ctx.channel().eventLoop().schedule(new Runnable() { public void run() { System.out.println(\"è¿™æ˜¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡\"); } }, 5, TimeUnit.SECONDS); System.out.println(\"server ctx = \"+ctx); //å°†msgè½¬æˆä¸€ä¸ªByteBuf ByteBuf buf = (ByteBuf) msg; System.out.println(\"å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯æ˜¯ï¼š\"+buf.toString(CharsetUtil.UTF_8)); System.out.println(\"å®¢æˆ·ç«¯åœ°å€ï¼š\"+ctx.channel().remoteAddress()); }","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"https://www.codetool.top/tags/Netty/"}]},{"title":"leetcode695-å²›å±¿çš„æœ€å¤§é¢ç§¯","slug":"leetcode695-å²›å±¿çš„æœ€å¤§é¢ç§¯","date":"2020-03-14T17:12:35.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode695-å²›å±¿çš„æœ€å¤§é¢ç§¯/","link":"","permalink":"https://www.codetool.top/article/leetcode695-%E5%B2%9B%E5%B1%BF%E7%9A%84%E6%9C%80%E5%A4%A7%E9%9D%A2%E7%A7%AF/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªåŒ…å«äº†ä¸€äº› 0 å’Œ 1çš„éç©ºäºŒç»´æ•°ç»„ grid , ä¸€ä¸ª å²›å±¿ æ˜¯ç”±å››ä¸ªæ–¹å‘ (æ°´å¹³æˆ–å‚ç›´) çš„ 1 (ä»£è¡¨åœŸåœ°) æ„æˆçš„ç»„åˆã€‚ä½ å¯ä»¥å‡è®¾äºŒç»´çŸ©é˜µçš„å››ä¸ªè¾¹ç¼˜éƒ½è¢«æ°´åŒ…å›´ç€ã€‚ æ‰¾åˆ°ç»™å®šçš„äºŒç»´æ•°ç»„ä¸­æœ€å¤§çš„å²›å±¿é¢ç§¯ã€‚(å¦‚æœæ²¡æœ‰å²›å±¿ï¼Œåˆ™è¿”å›é¢ç§¯ä¸º0ã€‚) ç¤ºä¾‹ 1: [[0,0,1,0,0,0,0,1,0,0,0,0,0], [0,0,0,0,0,0,0,1,1,1,0,0,0], [0,1,1,0,1,0,0,0,0,0,0,0,0], [0,1,0,0,1,1,0,0,1,0,1,0,0], [0,1,0,0,1,1,0,0,1,1,1,0,0], [0,0,0,0,0,0,0,0,0,0,1,0,0], [0,0,0,0,0,0,0,1,1,1,0,0,0], [0,0,0,0,0,0,0,1,1,0,0,0,0]]å¯¹äºä¸Šé¢è¿™ä¸ªç»™å®šçŸ©é˜µåº”è¿”å› 6ã€‚æ³¨æ„ç­”æ¡ˆä¸åº”è¯¥æ˜¯11ï¼Œå› ä¸ºå²›å±¿åªèƒ½åŒ…å«æ°´å¹³æˆ–å‚ç›´çš„å››ä¸ªæ–¹å‘çš„â€˜1â€™ã€‚ ç¤ºä¾‹ 2: [[0,0,0,0,0,0,0,0]]å¯¹äºä¸Šé¢è¿™ä¸ªç»™å®šçš„çŸ©é˜µ, è¿”å› 0ã€‚ æ³¨æ„: ç»™å®šçš„çŸ©é˜µgrid çš„é•¿åº¦å’Œå®½åº¦éƒ½ä¸è¶…è¿‡ 50ã€‚ 2 è§£æ³•2.1 æ€æƒ³å¯¹äºæ¯ä¸ªç‚¹dfsæœç´¢å››å‘¨ä¸º1çš„ç‚¹ï¼Œæœç´¢åˆ°ä¹‹åæŠŠè¯¥ç‚¹æ ‡è®°ä¸º0ï¼Œé˜²æ­¢é‡å¤æœç´¢ã€‚ 2.2 ä»£ç class Solution { public int maxAreaOfIsland(int[][] grid) { int ans = 0; for (int i = 0; i &lt; grid.length; i++) { for (int j = 0; j &lt; grid[i].length; j++) { if (grid[i][j] == 1) ans = Math.max(ans, dfs(i, j, grid)); } } return ans; } private int dfs(int i, int j, int[][] grid) { if (i &lt; 0 || j &lt; 0 || i >= grid.length || j >= grid[i].length || grid[i][j] == 0) { return 0; } grid[i][j] = 0; int num = 1; num += dfs(i + 1, j, grid); num += dfs(i - 1, j, grid); num += dfs(i, j + 1, grid); num += dfs(i, j - 1, grid); return num; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"Nettyæ¦‚è¿°ï¼ˆçº¿ç¨‹æ¨¡å‹ï¼‰","slug":"Nettyæ¦‚è¿°ï¼ˆçº¿ç¨‹æ¨¡å‹ï¼‰","date":"2020-03-14T14:26:37.000Z","updated":"2020-03-14T14:27:25.545Z","comments":true,"path":"article/Nettyæ¦‚è¿°ï¼ˆçº¿ç¨‹æ¨¡å‹ï¼‰/","link":"","permalink":"https://www.codetool.top/article/Netty%E6%A6%82%E8%BF%B0%EF%BC%88%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B%EF%BC%89/","excerpt":"","text":"nettyå®˜ç½‘ï¼š https://netty.io/ 1 åŸç”ŸNIOå­˜åœ¨çš„é—®é¢˜ NIO çš„ç±»åº“å’Œ API ç¹æ‚ï¼Œä½¿ç”¨éº»çƒ¦ï¼šéœ€è¦ç†Ÿç»ƒæŒæ¡ Selectorã€ServerSocketChannelã€SocketChannelã€ByteBufferç­‰ã€‚ éœ€è¦å…·å¤‡å…¶ä»–çš„é¢å¤–æŠ€èƒ½ï¼šè¦ç†Ÿæ‚‰ Java å¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œå› ä¸º NIO ç¼–ç¨‹æ¶‰åŠåˆ° Reactor æ¨¡å¼ï¼Œä½ å¿…é¡»å¯¹å¤šçº¿ç¨‹å’Œç½‘ç»œç¼–ç¨‹éå¸¸ç†Ÿæ‚‰ï¼Œæ‰èƒ½ç¼–å†™å‡ºé«˜è´¨é‡çš„ NIO ç¨‹åºã€‚ å¼€å‘å·¥ä½œé‡å’Œéš¾åº¦éƒ½éå¸¸å¤§ï¼šä¾‹å¦‚å®¢æˆ·ç«¯é¢ä¸´æ–­è¿é‡è¿ã€ç½‘ç»œé—ªæ–­ã€åŠåŒ…è¯»å†™ã€å¤±è´¥ç¼“å­˜ã€ç½‘ç»œæ‹¥å¡å’Œå¼‚å¸¸æµçš„å¤„ç†ç­‰ç­‰ã€‚ JDK NIO çš„ Bugï¼šä¾‹å¦‚è‡­åæ˜­è‘—çš„ Epoll Bugï¼Œå®ƒä¼šå¯¼è‡´ Selector ç©ºè½®è¯¢ï¼Œæœ€ç»ˆå¯¼è‡´ CPU 100%ã€‚ç›´åˆ° JDK 1.7 ç‰ˆæœ¬è¯¥é—®é¢˜ä»æ—§å­˜åœ¨ï¼Œæ²¡æœ‰è¢«æ ¹æœ¬è§£å†³ã€‚ 2 Nettyç‰¹ç‚¹ Netty æ˜¯ç”± JBOSS æä¾›çš„ä¸€ä¸ª Java å¼€æºæ¡†æ¶ï¼Œç°ä¸º Githubä¸Šçš„ç‹¬ç«‹é¡¹ç›®ã€‚ Netty æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€åŸºäºäº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œç”¨ä»¥å¿«é€Ÿå¼€å‘é«˜æ€§èƒ½ã€é«˜å¯é æ€§çš„ç½‘ç»œ IO ç¨‹åºã€‚ Nettyä¸»è¦é’ˆå¯¹åœ¨TCPåè®®ä¸‹ï¼Œé¢å‘Clientsç«¯çš„é«˜å¹¶å‘åº”ç”¨ï¼Œæˆ–è€…Peer-to-Peeråœºæ™¯ä¸‹çš„å¤§é‡æ•°æ®æŒç»­ä¼ è¾“çš„åº”ç”¨ã€‚ Nettyæœ¬è´¨æ˜¯ä¸€ä¸ªNIOæ¡†æ¶ï¼Œé€‚ç”¨äºæœåŠ¡å™¨é€šè®¯ç›¸å…³çš„å¤šç§åº”ç”¨åœºæ™¯ 3 Nettyçº¿ç¨‹æ¨¡å‹ç›®å‰å­˜åœ¨çš„çº¿ç¨‹æ¨¡å‹æœ‰ï¼š ä¼ ç»Ÿé˜»å¡ I/O æœåŠ¡æ¨¡å‹ ï¼ˆå³ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªIOï¼‰ Reactor æ¨¡å¼ Reactoræ¨¡å¼åˆç§°ååº”å™¨æ¨¡å¼ã€åˆ†å‘è€…æ¨¡å¼(Dispatcher) ã€é€šçŸ¥è€…æ¨¡å¼(notifier) Reactor åœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­è¿è¡Œï¼Œè´Ÿè´£ç›‘å¬å’Œåˆ†å‘äº‹ä»¶ï¼Œåˆ†å‘ç»™é€‚å½“çš„å¤„ç†ç¨‹åºæ¥å¯¹ IO äº‹ä»¶åšå‡ºååº”ã€‚ å®ƒå°±åƒå…¬å¸çš„ç”µè¯æ¥çº¿å‘˜ï¼Œå®ƒæ¥å¬æ¥è‡ªå®¢æˆ·çš„ç”µè¯å¹¶å°†çº¿è·¯è½¬ç§»åˆ°é€‚å½“çš„è”ç³»äººã€‚ æ ¹æ® Reactor çš„æ•°é‡å’Œå¤„ç†èµ„æºæ± çº¿ç¨‹çš„æ•°é‡ä¸åŒï¼Œæœ‰ 3 ç§å…¸å‹çš„å®ç° å• Reactor å•çº¿ç¨‹ å• Reactor å¤šçº¿ç¨‹ ä¸»ä» Reactor å¤šçº¿ç¨‹ mainReactorè´Ÿè´£ç›‘å¬server socketï¼Œacceptæ–°è¿æ¥ï¼Œå¹¶å°†å»ºç«‹çš„socketåˆ†æ´¾ç»™subReactorã€‚subReactorè´Ÿè´£å¤šè·¯åˆ†ç¦»å·²è¿æ¥çš„socketï¼Œè¯»å†™ç½‘ ç»œæ•°æ®ï¼Œå¯¹ä¸šåŠ¡å¤„ç†åŠŸèƒ½ï¼Œå…¶æ‰”ç»™workerçº¿ç¨‹æ± å®Œæˆã€‚é€šå¸¸ï¼ŒsubReactorä¸ªæ•°ä¸Šå¯ä¸CPUä¸ªæ•°ç­‰åŒ Netty ä¸»è¦åŸºäºä¸»ä» Reactor å¤šçº¿ç¨‹æ¨¡å‹ï¼Œåšäº†ä¸€å®šçš„æ”¹è¿›ï¼Œå…¶ä¸­ä¸»ä» Reactor å¤šçº¿ç¨‹æ¨¡å‹æœ‰å¤šä¸ª Reactor 4 nettyæ¶æ„ NettyæŠ½è±¡å‡ºä¸¤ç»„çº¿ç¨‹æ±  BossGroup ä¸“é—¨è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥, WorkerGroup ä¸“é—¨è´Ÿè´£ç½‘ç»œçš„è¯»å†™ã€‚ BossGroup å’Œ WorkerGroup ç±»å‹éƒ½æ˜¯ NioEventLoopGroup NioEventLoopGroup ç›¸å½“äºä¸€ä¸ªäº‹ä»¶å¾ªç¯ç»„, è¿™ä¸ªç»„ä¸­å«æœ‰å¤šä¸ªäº‹ä»¶å¾ªç¯ ï¼Œæ¯ä¸€ä¸ªäº‹ä»¶å¾ªç¯æ˜¯ NioEventLoop NioEventLoop è¡¨ç¤ºä¸€ä¸ªä¸æ–­å¾ªç¯çš„æ‰§è¡Œå¤„ç†ä»»åŠ¡çš„çº¿ç¨‹ï¼Œ æ¯ä¸ªNioEventLoop éƒ½æœ‰ä¸€ä¸ªselector , ç”¨äºç›‘å¬ç»‘å®šåœ¨å…¶ä¸Šçš„socketçš„ç½‘ç»œé€šè®¯ NioEventLoopGroup å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹, å³å¯ä»¥å«æœ‰å¤šä¸ªNioEventLoop æ¯ä¸ªBoss NioEventLoop å¾ªç¯æ‰§è¡Œçš„æ­¥éª¤æœ‰3æ­¥ select: è½®è¯¢accept äº‹ä»¶ processSelectedKeys: å¤„ç†accept äº‹ä»¶ , ä¸clientå»ºç«‹è¿æ¥ , ç”ŸæˆNioScocketChannel , å¹¶å°†å…¶æ³¨å†Œåˆ°æŸä¸ªworker NIOEventLoop ä¸Šçš„ selector runAllTasks: å¤„ç†ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡ æ¯ä¸ª Worker NIOEventLoop å¾ªç¯æ‰§è¡Œçš„æ­¥éª¤ select: è½®è¯¢read, writeäº‹ä»¶ processSelectedKeys: å¤„ç†i/oäº‹ä»¶ï¼Œ å³read , write äº‹ä»¶ï¼Œåœ¨å¯¹åº”NioSocketChannelå¤„ç† runAllTasks: å¤„ç†ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œå³ runAllTasks æ¯ä¸ªWorker NIOEventLoop å¤„ç†ä¸šåŠ¡æ—¶ï¼Œä¼šä½¿ç”¨pipeline(ç®¡é“), pipeline ä¸­åŒ…å«äº† channel , å³é€šè¿‡pipeline å¯ä»¥è·å–åˆ°å¯¹åº”é€šé“, ç®¡é“ä¸­ç»´æŠ¤äº†å¾ˆå¤šçš„å¤„ç†å™¨","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"https://www.codetool.top/tags/Netty/"}]},{"title":"NIOé›¶æ‹·è´ä¸å…¶ç³»ç»Ÿå‡½æ•°è°ƒç”¨","slug":"NIOé›¶æ‹·è´ä¸å…¶ç³»ç»Ÿå‡½æ•°è°ƒç”¨","date":"2020-03-14T11:37:17.000Z","updated":"2020-03-14T11:44:09.572Z","comments":true,"path":"article/NIOé›¶æ‹·è´ä¸å…¶ç³»ç»Ÿå‡½æ•°è°ƒç”¨/","link":"","permalink":"https://www.codetool.top/article/NIO%E9%9B%B6%E6%8B%B7%E8%B4%9D%E4%B8%8E%E5%85%B6%E7%B3%BB%E7%BB%9F%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š Java NIOå­¦ä¹ ç¬”è®°å››ï¼ˆé›¶æ‹·è´è¯¦è§£ï¼‰_Java_æ‹¿ç¬”å°æ˜Ÿçš„åšå®¢-CSDNåšå®¢ 1 å…³äºBufferå’ŒChannelçš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚ ByteBufferä¸æ­¢å¯ä»¥å­˜å–byteç±»å‹çš„æ•°æ®ï¼Œå®ƒæ”¯æŒç±»å‹åŒ–çš„putå’Œget, putæ”¾å…¥çš„æ˜¯ä»€ä¹ˆæ•°æ®ç±»å‹ï¼Œgetå°±åº”è¯¥ä½¿ç”¨ç›¸åº”çš„æ•°æ®ç±»å‹æ¥å–å‡ºï¼ˆæŒ‰ç…§é¡ºåºï¼‰ï¼Œå¦åˆ™å¯èƒ½æœ‰ BufferUnderflowException å¼‚å¸¸ã€‚ buffer.asReadOnlyBuffer()å¯ä»¥ä»ä¸€ä¸ªbufferè·å–ä¸€ä¸ªåªè¯»bufferã€‚ NIO ä¸­æä¾›äº†DirectBufferã€MappedByteBuffer ä»¥æé«˜IOæ•ˆç‡ã€‚ï¼ˆä½¿ç”¨å †å¤–å†…å­˜ï¼Œæ˜ å°„æ“ä½œç³»ç»Ÿçš„å†…å­˜ï¼‰ï¼Œä½¿ç”¨FileChannel::mapè¿”å›ä¸€ä¸ªMappedByteBuffer NIO è¿˜æ”¯æŒé€šè¿‡å¤šä¸ªBuffer (å³ Buffer æ•°ç»„) å®Œæˆè¯»å†™æ“ä½œï¼Œå³ Scattering å’Œ Gatheringï¼Œä¾æ¬¡å†™å…¥å’Œä¾æ¬¡è¯»å…¥ã€‚ 2 é›¶æ‹·è´é›¶æ‹·è´ä»æ“ä½œç³»ç»Ÿè§’åº¦ï¼Œæ˜¯æŒ‡CPUä¸æ‰§è¡Œæ‹·è´æ•°æ®ä»ä¸€ä¸ªå­˜å‚¨åŒºåŸŸåˆ°å¦ä¸€ä¸ªå­˜å‚¨åŒºåŸŸçš„ä»»åŠ¡ï¼Œè¿™é€šå¸¸ç”¨äºé€šè¿‡ç½‘ç»œä¼ è¾“ä¸€ä¸ªæ–‡ä»¶æ—¶ä»¥å‡å°‘CPUå‘¨æœŸå’Œå†…å­˜å¸¦å®½ã€‚ 2.1 ä¼ ç»ŸIOåœ¨Javaä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡InputStreamä»æºæ•°æ®ä¸­è¯»å–æ•°æ®æµåˆ°ä¸€ä¸ªç¼“å†²åŒºé‡Œï¼Œç„¶åå†å°†å®ƒä»¬è¾“å…¥åˆ°OutputStreamé‡Œã€‚æˆ‘ä»¬çŸ¥é“ï¼Œè¿™ç§IOæ–¹å¼ä¼ è¾“æ•ˆç‡æ˜¯æ¯”è¾ƒä½çš„ã€‚é‚£ä¹ˆï¼Œå½“ä½¿ç”¨ä¸Šé¢çš„ä»£ç æ—¶æ“ä½œç³»ç»Ÿä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼š JVMå‘å‡ºread()ç³»ç»Ÿè°ƒç”¨ã€‚ OSä¸Šä¸‹æ–‡åˆ‡æ¢åˆ°å†…æ ¸æ¨¡å¼ï¼ˆç¬¬ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰å¹¶å°†æ•°æ®è¯»å–åˆ°å†…æ ¸ç©ºé—´ç¼“å†²åŒºã€‚(ç¬¬ä¸€æ¬¡æ‹·è´ï¼šhardware â€”-&gt; kernel bufferï¼‰è¿™é‡Œçš„æ•°æ®è¯»å–æ˜¯DMA copyï¼Œæ˜¯å¿…ç»æ­¥éª¤ï¼Œä¸èƒ½ä¼˜åŒ–æ‰ã€‚ OSå†…æ ¸ç„¶åå°†æ•°æ®å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ç¼“å†²åŒº(ç¬¬äºŒæ¬¡æ‹·è´: kernel buffer â€”â€”&gt; user buffer)ï¼Œç„¶åreadç³»ç»Ÿè°ƒç”¨è¿”å›ã€‚è€Œç³»ç»Ÿè°ƒç”¨çš„è¿”å›åˆä¼šå¯¼è‡´ä¸€æ¬¡å†…æ ¸ç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢(ç¬¬äºŒæ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢)ã€‚ JVMå¤„ç†ä»£ç é€»è¾‘å¹¶å‘é€write()ç³»ç»Ÿè°ƒç”¨ã€‚ OSä¸Šä¸‹æ–‡åˆ‡æ¢åˆ°å†…æ ¸æ¨¡å¼(ç¬¬ä¸‰æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢)ï¼Œå¹¶ä»ç”¨æˆ·ç©ºé—´ç¼“å†²åŒºå¤åˆ¶æ•°æ®åˆ°å†…æ ¸ç©ºé—´ç¼“å†²åŒº(ç¬¬ä¸‰æ¬¡æ‹·è´: user buffer â€”â€”&gt; kernel buffer)ã€‚ writeç³»ç»Ÿè°ƒç”¨è¿”å›ï¼Œå¯¼è‡´å†…æ ¸ç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´çš„å†æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢(ç¬¬å››æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢)ã€‚å°†å†…æ ¸ç©ºé—´ç¼“å†²åŒºä¸­çš„æ•°æ®å†™åˆ°hardware(ç¬¬å››æ¬¡æ‹·è´: kernel buffer â€”â€”&gt; hardware)ã€‚ ä¸ºäº†å‡å°‘æ‹·è´å’Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°ï¼Œå¸¸è§çš„æ–¹æ³•æœ‰mmap(å†…å­˜æ˜ å°„)sendFileã€‚ 2.2 mmapmmapé€šè¿‡å†…å­˜æ˜ å°„ï¼Œå°†æ–‡ä»¶æ˜ å°„åˆ°å†…æ ¸ç¼“å†²åŒºï¼ŒåŒæ—¶ï¼Œç”¨æˆ·ç©ºé—´å¯ä»¥å…±äº«å†…æ ¸ç©ºé—´çš„æ•°æ®ã€‚è¿™æ ·ï¼Œåœ¨è¿›è¡Œç½‘ç»œä¼ è¾“æ—¶ï¼Œå°±å¯ä»¥å‡å°‘å†…æ ¸ç©ºé—´åˆ°ç”¨æˆ·æ§ä»¶çš„æ‹·è´æ¬¡æ•°ã€‚ å‘å‡ºmmapç³»ç»Ÿè°ƒç”¨ï¼Œå¯¼è‡´ç”¨æˆ·ç©ºé—´åˆ°å†…æ ¸ç©ºé—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢(ç¬¬ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢)ã€‚é€šè¿‡DMAå¼•æ“å°†ç£ç›˜æ–‡ä»¶ä¸­çš„å†…å®¹æ‹·è´åˆ°å†…æ ¸ç©ºé—´ç¼“å†²åŒºä¸­(ç¬¬ä¸€æ¬¡æ‹·è´: hard drive â€”â€”&gt; kernel buffer)ã€‚ mmapç³»ç»Ÿè°ƒç”¨è¿”å›ï¼Œå¯¼è‡´å†…æ ¸ç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢(ç¬¬äºŒæ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢)ã€‚æ¥ç€ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´å…±äº«è¿™ä¸ªç¼“å†²åŒºï¼Œè€Œä¸éœ€è¦å°†æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚å› ä¸ºç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´å…±äº«äº†è¿™ä¸ªç¼“å†²åŒºæ•°æ®ï¼Œæ‰€ä»¥ç”¨æˆ·ç©ºé—´å°±å¯ä»¥åƒåœ¨æ“ä½œè‡ªå·±ç¼“å†²åŒºä¸­æ•°æ®ä¸€èˆ¬æ“ä½œè¿™ä¸ªç”±å†…æ ¸ç©ºé—´å…±äº«çš„ç¼“å†²åŒºæ•°æ®ã€‚ å‘å‡ºwriteç³»ç»Ÿè°ƒç”¨ï¼Œå¯¼è‡´ç”¨æˆ·ç©ºé—´åˆ°å†…æ ¸ç©ºé—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢(ç¬¬ä¸‰æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢)ã€‚å°†æ•°æ®ä»å†…æ ¸ç©ºé—´ç¼“å†²åŒºæ‹·è´åˆ°å†…æ ¸ç©ºé—´socketç›¸å…³è”çš„ç¼“å†²åŒº(ç¬¬äºŒæ¬¡æ‹·è´: kernel buffer â€”â€”&gt; socket buffer)ã€‚ writeç³»ç»Ÿè°ƒç”¨è¿”å›ï¼Œå¯¼è‡´å†…æ ¸ç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢(ç¬¬å››æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢)ã€‚é€šè¿‡DMAå¼•æ“å°†å†…æ ¸ç©ºé—´socketç¼“å†²åŒºä¸­çš„æ•°æ®ä¼ é€’åˆ°åè®®å¼•æ“(ç¬¬ä¸‰æ¬¡æ‹·è´: socket buffer â€”â€”&gt; protocol engine) é€šè¿‡mmapå®ç°çš„é›¶æ‹·è´I/Oè¿›è¡Œäº†4æ¬¡ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä»¥åŠ3æ¬¡æ•°æ®æ‹·è´ã€‚å…¶ä¸­3æ¬¡æ•°æ®æ‹·è´ä¸­åŒ…æ‹¬äº†2æ¬¡DMAæ‹·è´å’Œ1æ¬¡CPUæ‹·è´ã€‚æ˜æ˜¾ï¼Œå®ƒä¸ä¼ ç»ŸI/Oç›¸æ¯”ä»…ä»…å°‘äº†1æ¬¡å†…æ ¸ç©ºé—´ç¼“å†²åŒºå’Œç”¨æˆ·ç©ºé—´ç¼“å†²åŒºä¹‹é—´çš„CPUæ‹·è´ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•´ä¸ªæ–‡ä»¶æˆ–è€…æ•´ä¸ªæ–‡ä»¶çš„ä¸€éƒ¨åˆ†æ˜ å°„åˆ°å†…å­˜å½“ä¸­ï¼Œç”¨æˆ·ç›´æ¥å¯¹å†…å­˜ä¸­å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œï¼Œç„¶åæ˜¯ç”±æ“ä½œç³»ç»Ÿæ¥è¿›è¡Œç›¸å…³çš„é¡µé¢è¯·æ±‚å¹¶å°†å†…å­˜çš„ä¿®æ”¹å†™å…¥åˆ°æ–‡ä»¶å½“ä¸­ã€‚æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåªéœ€è¦å¤„ç†å†…å­˜çš„æ•°æ®ï¼Œè¿™æ ·å¯ä»¥å®ç°éå¸¸è¿…é€Ÿçš„I/Oæ“ä½œã€‚ 2.3 sendFileLinux 2.1ç‰ˆæœ¬æä¾›äº†sendFileå‡½æ•°ï¼Œå…¶åŸºæœ¬åŸç†å¦‚ä¸‹ï¼šæ•°æ®æ ¹æœ¬ä¸ç»è¿‡ç”¨æˆ·æ€ï¼Œç›´æ¥ä»å†…æ ¸ç¼“å†²åŒºè¿›å…¥åˆ° Socket Bufferï¼ŒåŒæ—¶ï¼Œç”±äºå’Œç”¨æˆ·æ€å®Œå…¨æ— å…³ï¼Œå°±å‡å°‘äº†ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ å‘å‡ºsendfileç³»ç»Ÿè°ƒç”¨ï¼Œå¯¼è‡´ç”¨æˆ·ç©ºé—´åˆ°å†…æ ¸ç©ºé—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢(ç¬¬ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢)ã€‚é€šè¿‡DMAå°†ç£ç›˜æ–‡ä»¶ä¸­çš„å†…å®¹æ‹·è´åˆ°å†…æ ¸ç©ºé—´ç¼“å†²åŒºä¸­(ç¬¬ä¸€æ¬¡æ‹·è´: hard driver â€”â€”&gt; kernel buffer)ã€‚ ç„¶åå†å°†æ•°æ®ä»å†…æ ¸ç©ºé—´ç¼“å†²åŒºæ‹·è´åˆ°å†…æ ¸ä¸­ä¸socketç›¸å…³çš„ç¼“å†²åŒºä¸­(ç¬¬äºŒæ¬¡æ‹·è´: kernel buffer â€”â€”&gt; socket buffer)ã€‚ sendfileç³»ç»Ÿè°ƒç”¨è¿”å›ï¼Œå¯¼è‡´å†…æ ¸ç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢(ç¬¬äºŒæ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢)ã€‚é€šè¿‡DMAå¼•æ“å°†å†…æ ¸ç©ºé—´socketç¼“å†²åŒºä¸­çš„æ•°æ®ä¼ é€’åˆ°åè®®å¼•æ“(ç¬¬ä¸‰æ¬¡æ‹·è´: socket buffer â€”â€”&gt; protocol engine)ã€‚ é€šè¿‡sendfileå®ç°çš„é›¶æ‹·è´I/Oåªä½¿ç”¨äº†2æ¬¡ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä»¥åŠ3æ¬¡æ•°æ®çš„æ‹·è´ã€‚ ä½ å¯èƒ½ä¼šè¯´æ“ä½œç³»ç»Ÿä»ç„¶éœ€è¦åœ¨å†…æ ¸å†…å­˜ç©ºé—´ä¸­å¤åˆ¶æ•°æ®ï¼ˆkernel buffer â€”&gt;socket bufferï¼‰ã€‚ æ˜¯çš„ï¼Œä½†ä»æ“ä½œç³»ç»Ÿçš„è§’åº¦æ¥çœ‹ï¼Œè¿™å·²ç»æ˜¯é›¶æ‹·è´ï¼Œå› ä¸ºæ²¡æœ‰æ•°æ®ä»å†…æ ¸ç©ºé—´å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ã€‚ å†…æ ¸éœ€è¦å¤åˆ¶çš„åŸå› æ˜¯å› ä¸ºé€šç”¨ç¡¬ä»¶DMAè®¿é—®éœ€è¦è¿ç»­çš„å†…å­˜ç©ºé—´ï¼ˆå› æ­¤éœ€è¦ç¼“å†²åŒºï¼‰ã€‚ ä½†æ˜¯ï¼Œå¦‚æœç¡¬ä»¶æ”¯æŒscatter-and-gatherï¼Œè¿™æ˜¯å¯ä»¥é¿å…çš„ã€‚ Linux åœ¨ 2.4 ç‰ˆæœ¬ä¸­ï¼Œåšäº†ä¸€äº›ä¿®æ”¹ï¼Œé¿å…äº†ä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ° Socket buffer çš„æ“ä½œï¼Œç›´æ¥æ‹·è´åˆ°åè®®æ ˆï¼Œä»è€Œå†ä¸€æ¬¡å‡å°‘äº†æ•°æ®æ‹·è´ã€‚ 3 NIOä¸­çš„é›¶æ‹·è´NIOä¸­æœ‰ä¸€ä¸ªtransferToï¼Œå®ƒå¯ä»¥åœ¨ä¸¤ä¸ªFileChannelç›´æ¥ä¼ é€’æ•°æ®è€Œä¸éœ€è¦ç»è¿‡bufferï¼Œè¿™å¯¹å¤§æ–‡ä»¶çš„è¯»å†™å¸®åŠ©æ˜¯å¾ˆå¤§çš„ï¼Œé‚£å®ƒç©¶ç«Ÿä½¿ç”¨äº†ä»€ä¹ˆæ–¹æ³•å®ç°å‘¢ï¼Ÿæˆ‘åœ¨openjdk1.8ä¸‹æ‰¾åˆ°äº†å®ƒçš„æºç ï¼š public long transferTo(long position, long count, WritableByteChannel target) throws IOException { ensureOpen(); if (!target.isOpen()) throw new ClosedChannelException(); if (!readable) throw new NonReadableChannelException(); if (target instanceof FileChannelImpl &amp;&amp; !((FileChannelImpl)target).writable) throw new NonWritableChannelException(); if ((position &lt; 0) || (count &lt; 0)) throw new IllegalArgumentException(); long sz = size(); if (position > sz) return 0; int icount = (int)Math.min(count, Integer.MAX_VALUE); if ((sz - position) &lt; icount) icount = (int)(sz - position); long n; //æ³¨æ„è¿™ä¸ªéƒ¨åˆ†------------------------------------------ // Attempt a direct transfer, if the kernel supports it if ((n = transferToDirectly(position, icount, target)) >= 0) return n; // Attempt a mapped transfer, but only to trusted channel types if ((n = transferToTrustedChannel(position, icount, target)) >= 0) return n; // Slow path for untrusted targets return transferToArbitraryChannel(position, icount, target); //æ³¨æ„è¿™ä¸ªéƒ¨åˆ†------------------------------------------ } å¯ä»¥çœ‹å‡ºä¼˜å…ˆä½¿ç”¨transferToDirectlyï¼Œå…¶æ¬¡æ˜¯transferToTrustedChannel private long transferToDirectly(long position, int icount, WritableByteChannel target) throws IOException { if (!transferSupported) return IOStatus.UNSUPPORTED; FileDescriptor targetFD = null; if (target instanceof FileChannelImpl) { if (!fileSupported) return IOStatus.UNSUPPORTED_CASE; targetFD = ((FileChannelImpl)target).fd; } else if (target instanceof SelChImpl) { // Direct transfer to pipe causes EINVAL on some configurations if ((target instanceof SinkChannelImpl) &amp;&amp; !pipeSupported) return IOStatus.UNSUPPORTED_CASE; targetFD = ((SelChImpl)target).getFD(); } if (targetFD == null) return IOStatus.UNSUPPORTED; int thisFDVal = IOUtil.fdVal(fd); int targetFDVal = IOUtil.fdVal(targetFD); if (thisFDVal == targetFDVal) // Not supported on some configurations return IOStatus.UNSUPPORTED; long n = -1; int ti = -1; try { begin(); ti = threads.add(); if (!isOpen()) return -1; //æ³¨æ„è¿™ä¸ªéƒ¨åˆ†------------------------------------------ do { n = transferTo0(thisFDVal, position, icount, targetFDVal); } while ((n == IOStatus.INTERRUPTED) &amp;&amp; isOpen()); //æ³¨æ„è¿™ä¸ªéƒ¨åˆ†------------------------------------------ if (n == IOStatus.UNSUPPORTED_CASE) { if (target instanceof SinkChannelImpl) pipeSupported = false; if (target instanceof FileChannelImpl) fileSupported = false; return IOStatus.UNSUPPORTED_CASE; } if (n == IOStatus.UNSUPPORTED) { // Don't bother trying again transferSupported = false; return IOStatus.UNSUPPORTED; } return IOStatus.normalize(n); } finally { threads.remove(ti); end (n > -1); } } åœ¨WINDOWSä¸‹ï¼š JNIEXPORT jlong JNICALL Java_sun_nio_ch_FileChannelImpl_transferTo0(JNIEnv *env, jobject this, jint srcFD, jlong position, jlong count, jint dstFD) { return IOS_UNSUPPORTED; } å³Windowsä¸æ”¯æŒtransferToDirectlyã€‚ åœ¨unixç³»æ“ä½œç³»ç»Ÿä¸‹ï¼š JNIEXPORT jlong JNICALL Java_sun_nio_ch_FileChannelImpl_transferTo0(JNIEnv *env, jobject this, jint srcFD, jlong position, jlong count, jint dstFD) { #if defined(__linux__) off64_t offset = (off64_t)position; //æ³¨æ„ linux -> sendfile --------------------------------- jlong n = sendfile64(dstFD, srcFD, &amp;offset, (size_t)count); if (n &lt; 0) { if (errno == EAGAIN) return IOS_UNAVAILABLE; if ((errno == EINVAL) &amp;&amp; ((ssize_t)count >= 0)) return IOS_UNSUPPORTED_CASE; if (errno == EINTR) { return IOS_INTERRUPTED; } JNU_ThrowIOExceptionWithLastError(env, \"Transfer failed\"); return IOS_THROWN; } return n; #elif defined (__solaris__) sendfilevec64_t sfv; size_t numBytes = 0; jlong result; sfv.sfv_fd = srcFD; sfv.sfv_flag = 0; sfv.sfv_off = (off64_t)position; sfv.sfv_len = count; result = sendfilev64(dstFD, &amp;sfv, 1, &amp;numBytes); /* Solaris sendfilev() will return -1 even if some bytes have been * transferred, so we check numBytes first. */ if (numBytes > 0) return numBytes; if (result &lt; 0) { if (errno == EAGAIN) return IOS_UNAVAILABLE; if (errno == EOPNOTSUPP) return IOS_UNSUPPORTED_CASE; if ((errno == EINVAL) &amp;&amp; ((ssize_t)count >= 0)) return IOS_UNSUPPORTED_CASE; if (errno == EINTR) return IOS_INTERRUPTED; JNU_ThrowIOExceptionWithLastError(env, \"Transfer failed\"); return IOS_THROWN; } return result; #elif defined(__APPLE__) off_t numBytes; int result; numBytes = count; result = sendfile(srcFD, dstFD, position, &amp;numBytes, NULL, 0); if (numBytes > 0) return numBytes; if (result == -1) { if (errno == EAGAIN) return IOS_UNAVAILABLE; if (errno == EOPNOTSUPP || errno == ENOTSOCK || errno == ENOTCONN) return IOS_UNSUPPORTED_CASE; if ((errno == EINVAL) &amp;&amp; ((ssize_t)count >= 0)) return IOS_UNSUPPORTED_CASE; if (errno == EINTR) return IOS_INTERRUPTED; JNU_ThrowIOExceptionWithLastError(env, \"Transfer failed\"); return IOS_THROWN; } return result; #elif defined(_AIX) jlong max = (jlong)java_lang_Integer_MAX_VALUE; struct sf_parms sf_iobuf; jlong result; if (position > max) return IOS_UNSUPPORTED_CASE; if (count > max) count = max; memset(&amp;sf_iobuf, 0, sizeof(sf_iobuf)); sf_iobuf.file_descriptor = srcFD; sf_iobuf.file_offset = (off_t)position; sf_iobuf.file_bytes = count; result = send_file(&amp;dstFD, &amp;sf_iobuf, SF_SYNC_CACHE); /* AIX send_file() will return 0 when this operation complete successfully, * return 1 when partial bytes transfered and return -1 when an error has * Occured. */ if (result == -1) { if (errno == EWOULDBLOCK) return IOS_UNAVAILABLE; if ((errno == EINVAL) &amp;&amp; ((ssize_t)count >= 0)) return IOS_UNSUPPORTED_CASE; if (errno == EINTR) return IOS_INTERRUPTED; if (errno == ENOTSOCK) return IOS_UNSUPPORTED; JNU_ThrowIOExceptionWithLastError(env, \"Transfer failed\"); return IOS_THROWN; } if (sf_iobuf.bytes_sent > 0) return (jlong)sf_iobuf.bytes_sent; return IOS_UNSUPPORTED_CASE; #else return IOS_UNSUPPORTED_CASE; #endif } sendfile64å°±æ˜¯linux2.4æ”¹è¿›åçš„sendfileï¼Œå…·ä½“å¯ä»¥å‚è€ƒ https://linux.die.net/man/2/sendfile64 è€ŒtransferToTrustedChannelå°±å’ŒFileChannelçš„mapæ–¹æ³•åŸç†ä¸€è‡´äº†ï¼Œä½¿ç”¨çš„æ˜¯mmapï¼Œè¿™é‡Œå°±ä¸è´´æºç è·Ÿè¸ªäº†ï¼Œåœ¨windowsä¸‹ä½¿ç”¨çš„æ˜¯ç³»ç»Ÿå‡½æ•°CreateFileMappingï¼Œåœ¨linuxä¸‹ä½¿ç”¨çš„æ˜¯ç³»ç»Ÿå‡½æ•°mmap64 4 æ€»ç»“ mmap é€‚åˆå°æ•°æ®é‡è¯»å†™ï¼ŒsendFile é€‚åˆå¤§æ–‡ä»¶ä¼ è¾“ã€‚ mmap éœ€è¦ 4 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œ3 æ¬¡æ•°æ®æ‹·è´ï¼›sendFile éœ€è¦ 3 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæœ€å°‘ 2 æ¬¡æ•°æ®æ‹·è´ã€‚ sendFile å¯ä»¥åˆ©ç”¨ DMA æ–¹å¼ï¼Œå‡å°‘ CPU æ‹·è´ï¼Œmmap åˆ™ä¸èƒ½ï¼ˆå¿…é¡»ä»å†…æ ¸æ‹·è´åˆ° Socket ç¼“å†²åŒºï¼‰ã€‚ åœ¨Javaä¸­å¯ä»¥ä½¿ç”¨FileChannelçš„transferToæ–¹æ³•å®ç°é›¶æ‹·è´ï¼Œåœ¨windowsä¸‹ä½¿ç”¨çš„æ˜¯mmapæ–¹å¼ï¼Œè°ƒç”¨ç³»ç»Ÿå‡½æ•°CreateFileMappingï¼Œåœ¨linuxä¸‹ä¼˜å…ˆä½¿ç”¨æ”¹è¿›åçš„sendFileï¼Œè°ƒç”¨ç³»ç»Ÿå‡½æ•°sendFile64ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"IO","slug":"IO","permalink":"https://www.codetool.top/tags/IO/"},{"name":"NIO","slug":"NIO","permalink":"https://www.codetool.top/tags/NIO/"},{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://www.codetool.top/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"}]},{"title":"leetcode300-æœ€é•¿ä¸Šå‡å­åºåˆ—","slug":"leetcode300-æœ€é•¿ä¸Šå‡å­åºåˆ—","date":"2020-03-13T16:33:27.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode300-æœ€é•¿ä¸Šå‡å­åºåˆ—/","link":"","permalink":"https://www.codetool.top/article/leetcode300-%E6%9C%80%E9%95%BF%E4%B8%8A%E5%8D%87%E5%AD%90%E5%BA%8F%E5%88%97/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ— åºçš„æ•´æ•°æ•°ç»„ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ã€‚ ç¤ºä¾‹ï¼š è¾“å…¥: [10,9,2,5,3,7,101,18]è¾“å‡º: 4è§£é‡Š: æœ€é•¿çš„ä¸Šå‡å­åºåˆ—æ˜¯ [2,3,7,101]ï¼Œå®ƒçš„é•¿åº¦æ˜¯ 4ã€‚ è¯´æ˜ï¼š å¯èƒ½ä¼šæœ‰å¤šç§æœ€é•¿ä¸Šå‡å­åºåˆ—çš„ç»„åˆï¼Œä½ åªéœ€è¦è¾“å‡ºå¯¹åº”çš„é•¿åº¦å³å¯ã€‚ ä½ ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦åº”è¯¥ä¸º O(n2) ã€‚ è¿›é˜¶: ä½ èƒ½å°†ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦é™ä½åˆ° O(n log n) å—? 2 è§£æ³•2.1 æ€æƒ³åŠ¨æ€è§„åˆ’ï¼Œå¯¹äºæŸä¸ªå…ƒç´ ï¼Œå…¶dpå€¼åº”è¯¥ç­‰äºå·¦è¾¹æ¯”å…¶å°çš„å…ƒç´ ä¸­æœ€å¤§çš„dpå€¼+1ã€‚ 2.2 ä»£ç public class Solution { public int lengthOfLIS(int[] nums) { if (nums.length == 0) return 0; int[] dp = new int[nums.length]; dp[0] = 1; int maxCount = 1; for (int i = 1; i &lt; dp.length; i++) { int maxval = 0; for (int j = 0; j &lt; i; j++) { if (nums[i] > nums[j]) maxval = Math.max(maxval, dp[j]); } dp[i] = maxval + 1; maxCount = Math.max(maxCount, dp[i]); } return maxCount; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"Springæ•´åˆRabbitMQåŠå…¶å„ç»„ä»¶ä»‹ç»","slug":"Springæ•´åˆRabbitMQåŠå…¶å„ç»„ä»¶ä»‹ç»","date":"2020-03-13T14:54:21.000Z","updated":"2020-03-13T15:42:56.170Z","comments":true,"path":"article/Springæ•´åˆRabbitMQåŠå…¶å„ç»„ä»¶ä»‹ç»/","link":"","permalink":"https://www.codetool.top/article/Spring%E6%95%B4%E5%90%88RabbitMQ%E5%8F%8A%E5%85%B6%E5%90%84%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/","excerpt":"","text":"1 Spring-rabbitä½¿ç”¨Spring-rabbitï¼Œmavenä¾èµ–ï¼š &lt;dependency> &lt;groupId>org.springframework.amqp&lt;/groupId> &lt;artifactId>spring-rabbit&lt;/artifactId> &lt;version>2.2.5.RELEASE&lt;/version> &lt;/dependency> å„ç»„ä»¶ä»‹ç»ï¼š 1.1 RabbitAdminç¼–å†™é…ç½®ç±»ï¼ŒRabbitAdminä¸ºæ ¸å¿ƒæ“ä½œRabbitMQçš„ç±»ï¼Œæˆ‘ä»¬è¦æ³¨å…¥ä¸€ä¸ªå®ƒçš„beanï¼š @Configuration public class RabbitMQConfig { @Bean public ConnectionFactory connectionFactory(){ CachingConnectionFactory connectionFactory = new CachingConnectionFactory(); connectionFactory.setAddresses(\"127.0.0.1\"); connectionFactory.setUsername(\"guest\"); connectionFactory.setPassword(\"guest\"); connectionFactory.setVirtualHost(\"/\"); return connectionFactory; } @Bean public RabbitAdmin rabbitAdmin(ConnectionFactory connectionFactory){ RabbitAdmin rabbitAdmin = new RabbitAdmin(connectionFactory); rabbitAdmin.setAutoStartup(true);//å¿…é¡»è®¾ç½®ä¸ºtrue return rabbitAdmin; } } RabbitAdminå¯ä»¥å£°æ˜é˜Ÿåˆ—ã€äº¤æ¢å™¨ã€ç»‘å®šç­‰ã€‚ @RunWith(SpringJUnit4ClassRunner.class) @ContextConfiguration(classes = SpringConfiguration.class) public class RabbitTest { @Autowired private RabbitAdmin rabbitAdmin; @Test public void testAdmin() throws Exception{ //å£°æ˜ rabbitAdmin.declareExchange(new DirectExchange(\"test.direct\",false,false)); rabbitAdmin.declareExchange(new TopicExchange(\"test.topic\",false,false)); rabbitAdmin.declareQueue(new Queue(\"test.direct.queue\",false)); rabbitAdmin.declareQueue(new Queue(\"test.topic.queue\",false)); rabbitAdmin.declareBinding(new Binding(\"test.direct.queue\",Binding.DestinationType.QUEUE, \"test.direct\",\"direct\",new HashMap&lt;>())); rabbitAdmin.declareBinding( BindingBuilder .bind(new Queue(\"test.topic.queue\",false)) //é˜Ÿåˆ— .to(new TopicExchange(\"test.topic\",false,false)) //äº¤æ¢æœº .with(\"user.#\")); //æŒ‡å®šè·¯ç”±key //æ¸…ç©ºé˜Ÿåˆ—æ•°æ® rabbitAdmin.purgeQueue(\"test.topic.queue\",false); } } ä¹Ÿå¯ä»¥æŠŠQueueã€Exchangeã€Bindingæ³¨å…¥åˆ°IoCå®¹å™¨ä¸­ï¼Œå†ä½¿ç”¨ã€‚ 1.2 RabbitTemplateè¯¥ç±»æä¾›äº†ä¸°å¯Œçš„å‘é€æ¶ˆæ¯æ–¹æ³•ï¼ŒåŒ…æ‹¬å¯é æ€§æŠ•é€’æ¶ˆæ¯æ–¹æ³•ã€å›è°ƒç›‘å¬æ¶ˆæ¯æ¥å£ConfirmCallbackã€è¿”å›å€¼ç¡®è®¤æ¥å£ReturnCallbackç­‰ç­‰ã€‚ åŒæ ·æˆ‘ä»¬éœ€è¦è¿›è¡Œæ³¨å…¥åˆ°Springå®¹å™¨ä¸­ï¼Œç„¶åç›´æ¥ä½¿ç”¨ã€‚ @Configuration public class RabbitMQConfig { @Bean public ConnectionFactory connectionFactory(){ CachingConnectionFactory connectionFactory = new CachingConnectionFactory(); connectionFactory.setAddresses(\"127.0.0.1\"); connectionFactory.setUsername(\"guest\"); connectionFactory.setPassword(\"guest\"); connectionFactory.setVirtualHost(\"/\"); return connectionFactory; } @Bean public RabbitAdmin rabbitAdmin(ConnectionFactory connectionFactory){ RabbitAdmin rabbitAdmin = new RabbitAdmin(connectionFactory); rabbitAdmin.setAutoStartup(true);//å¿…é¡»è®¾ç½®ä¸ºtrue return rabbitAdmin; } @Bean public RabbitTemplate rabbitTemplate(ConnectionFactory connectionFactory){ RabbitTemplate rabbitTemplate = new RabbitTemplate(connectionFactory); return rabbitTemplate; } } @Test public void testSendMessage() throws Exception{ MessageProperties messageProperties = new MessageProperties(); messageProperties.getHeaders().put(\"desc\", \"ä¿¡æ¯æè¿°..\"); messageProperties.getHeaders().put(\"type\", \"è‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹..\"); Message message = new Message(\"Hello RabbitMQ\".getBytes(), messageProperties); rabbitTemplate.convertAndSend(\"test.topic\",\"user.template\",message,new MessagePostProcessor(){ @Override public Message postProcessMessage(Message message) throws AmqpException { System.out.println(\"-----æ·»åŠ é¢å¤–çš„è®¾ç½®------\"); message.getMessageProperties().getHeaders().put(\"desc\", \"é¢å¤–ä¿®æ”¹çš„ä¿¡æ¯æè¿°\"); message.getMessageProperties().getHeaders().put(\"attr\", \"é¢å¤–æ–°åŠ çš„ä¿¡æ¯æè¿°\"); return message; } }); } sendæˆ–convertAndSendç”¨æ¥å‘é€æ¶ˆæ¯ï¼ŒMessagePostProcessorå¯ä»¥å¸®æˆ‘ä»¬åœ¨æ¶ˆæ¯å‘é€å‰å†å¯¹æ¶ˆæ¯åšä¸€äº›å¤„ç†ã€‚ convertAndSendå¯ä»¥ä¼ çš„æ¶ˆæ¯æ˜¯ä¸€ä¸ªObjectå¯¹è±¡ï¼Œå¦‚æœä¸æ˜¯Messageç±»å‹ï¼Œä¼šå¸®æˆ‘ä»¬ç”¨è½¬æ¢å™¨è½¬æ¢æˆæ¶ˆæ¯å¯¹è±¡ï¼Œé»˜è®¤çš„Converteræ˜¯SimpleMessageConverterï¼Œå¯ä»¥è‡ªå®šä¹‰Converterç„¶åä½¿ç”¨setMessageConverterè®¾ç½®è½¬æ¢å™¨ã€‚ å…¶ä»–è‡ªå¸¦å¯ç”¨çš„Converterè¿˜æœ‰Jackson2MessageConvertorã€SerializerMessageConverterç­‰ç­‰ã€‚ SimpleMessageConverterå¦‚ä½•å°†Javaå¯¹è±¡è½¬æˆæ¶ˆæ¯ï¼š @Override protected Message createMessage(Object object, MessageProperties messageProperties) throws MessageConversionException { byte[] bytes = null; //å¦‚æœæ˜¯å­—èŠ‚æ•°ç»„ï¼Œç›´æ¥è®¾ç½®æˆæ¶ˆæ¯ä½“ if (object instanceof byte[]) { bytes = (byte[]) object; messageProperties.setContentType(MessageProperties.CONTENT_TYPE_BYTES); } //å¦‚æœæ˜¯Stringï¼Œè½¬æˆå­—èŠ‚æ•°ç»„è®¾ç½®æ¶ˆæ¯ä½“ï¼Œé»˜è®¤ä»¥UTF-8ç¼–ç  else if (object instanceof String) { try { bytes = ((String) object).getBytes(this.defaultCharset); } catch (UnsupportedEncodingException e) { throw new MessageConversionException( \"failed to convert to Message content\", e); } messageProperties.setContentType(MessageProperties.CONTENT_TYPE_TEXT_PLAIN); messageProperties.setContentEncoding(this.defaultCharset); } //å¦‚æœæ˜¯å¯åºåˆ—åŒ–çš„ï¼Œå°±å°†å¯¹è±¡åºåˆ—åŒ– else if (object instanceof Serializable) { try { bytes = SerializationUtils.serialize(object); } catch (IllegalArgumentException e) { throw new MessageConversionException( \"failed to convert to serialized Message content\", e); } messageProperties.setContentType(MessageProperties.CONTENT_TYPE_SERIALIZED_OBJECT); } if (bytes != null) { messageProperties.setContentLength(bytes.length); return new Message(bytes, messageProperties); } //å¦åˆ™å°±æ˜¯ä¸æ”¯æŒçš„ç±»å‹ throw new IllegalArgumentException(getClass().getSimpleName() + \" only supports String, byte[] and Serializable payloads, received: \" + object.getClass().getName()); } 1.3 SimpleMessageListenerContainerSimpleMessageListenerContaineræ˜¯ä¸€ä¸ªæ¶ˆæ¯ç›‘å¬å®¹å™¨ï¼ˆå°±æ˜¯æ¶ˆè´¹è€…çš„å®¹å™¨ï¼Œå¯ä»¥ç›‘å¬å¤šä¸ªé˜Ÿåˆ—ä¸Šçš„æ¶ˆæ¯ï¼‰ è¿™ä¸ªç±»éå¸¸çš„å¼ºå¤§ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å®ƒè¿›è¡Œå¾ˆå¤šè®¾ç½®ï¼Œå¯¹äºæ¶ˆè´¹è€…çš„é…ç½®é¡¹ï¼Œè¿™ä¸ªç±»éƒ½å¯ä»¥æ»¡è¶³ ç›‘å¬é˜Ÿåˆ—(å¤šä¸ªé˜Ÿåˆ—)ã€è‡ªåŠ¨å¯åŠ¨ã€è‡ªåŠ¨å£°æ˜åŠŸèƒ½ è®¾ç½®äº‹åŠ¡ç‰¹æ€§ã€äº‹åŠ¡ç®¡ç†å™¨ã€äº‹åŠ¡å±æ€§ã€äº‹åŠ¡å®¹é‡(å¹¶å‘)ã€æ˜¯å¦å¼€å¯äº‹åŠ¡ã€å›æ»šæ¶ˆæ¯ç­‰ è®¾ç½®æ¶ˆè´¹è€…æ•°é‡ã€æœ€å°æœ€å¤§æ•°é‡ã€æ‰¹é‡æ¶ˆè´¹ è®¾ç½®æ¶ˆæ¯ç¡®è®¤å’Œè‡ªåŠ¨ç¡®è®¤æ¨¡å¼ã€æ˜¯å¦é‡å›é˜Ÿåˆ—ã€å¼‚å¸¸æ•è·handlerå‡½æ•°ã€‚ è®¾ç½®æ¶ˆè´¹è€…æ ‡ç­¾ç”Ÿæˆç­–ç•¥ã€æ˜¯å¦ç‹¬å æ¨¡å¼ã€æ¶ˆè´¹è€…å±æ€§ç­‰ è®¾ç½®å…·ä½“çš„ç›‘å¬å™¨ã€æ¶ˆæ¯è½¬æ¢å™¨ç­‰ç­‰ã€‚ æ³¨æ„: SimpleMessageListenerContainerå¯ä»¥è¿›è¡ŒåŠ¨æ€è®¾ç½®ï¼Œ æ¯”å¦‚åœ¨è¿è¡Œä¸­çš„åº”ç”¨å¯ä»¥åŠ¨æ€çš„ä¿®æ”¹å…¶æ¶ˆè´¹è€…æ•°é‡çš„å¤§å°ã€æ¥æ”¶æ¶ˆæ¯çš„æ¨¡å¼ç­‰ã€‚ å¾ˆå¤šåŸºäºRabbitMQçš„è‡ªåˆ¶å®šåŒ–åç«¯ç®¡æ§å°åœ¨è¿›è¡ŒåŠ¨æ€è®¾ç½®çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯æ ¹æ®è¿™ä¸€ç‰¹æ€§å»å®ç°çš„ã€‚å¯ä»¥çœ‹å‡ºSpringAMQPéå¸¸çš„å¼ºå¤§ã€‚ @Configuration public class RabbitMQConfig { //ç•¥ã€‚ã€‚ã€‚ @Bean public Queue directQueue(){ return new Queue(\"test.direct.queue\",false); } @Bean public Queue topicQueue(){ return new Queue(\"test.topic.queue\",false); } @Bean public SimpleMessageListenerContainer simpleMessageListenerContainer(ConnectionFactory connectionFactory){ SimpleMessageListenerContainer container = new SimpleMessageListenerContainer(connectionFactory); container.setQueues(directQueue(),topicQueue()); container.setConcurrentConsumers(2); container.setDefaultRequeueRejected(false); container.setAcknowledgeMode(AcknowledgeMode.AUTO); container.setConsumerTagStrategy(new ConsumerTagStrategy() { @Override public String createConsumerTag(String queue) { return queue+\"_\"+ UUID.randomUUID().toString(); } }); container.setMessageListener(new ChannelAwareMessageListener() { @Override public void onMessage(Message message, Channel channel) throws Exception { String msg = new String(message.getBody()); System.out.println(\"----------æ¶ˆè´¹è€…ï¼š\" +msg); } }); return container; } } åªè¦å®ƒåœ¨IoCå®¹å™¨ä¸­ï¼Œå°±ä¿æŒç›‘å¬æ³¨å†Œé˜Ÿåˆ—ä¸Šçš„æ¶ˆæ¯ï¼Œç›‘å¬åˆ°æ¶ˆæ¯å°±å¯ä»¥é€šè¿‡å†…éƒ¨çš„MessageListeneræ¥å¤„ç†æ¶ˆæ¯ã€‚å¦‚æœæ”¶åˆ°çš„æ¶ˆæ¯æ˜¯åºåˆ—åŒ–çš„ã€jsonç­‰å…¶ä»–ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨Converterè½¬æ¢ã€‚æˆ–å†™ä¸€ä¸ªMessageListenerAdapterï¼Œå®ƒå¯ä»¥æ³¨å†ŒConverterã€‚ 1.4 MessageListenerAdapterMessageListenerAdapter å¯ä»¥æŠŠä¸€ä¸ªæ²¡æœ‰å®ç°MessageListenerå’ŒChannelAwareMessageListeneræ¥å£çš„ç±»é€‚é…æˆä¸€ä¸ªå¯ä»¥å¤„ç†æ¶ˆæ¯çš„å¤„ç†å™¨ é»˜è®¤çš„æ–¹æ³•åç§°ä¸ºï¼šhandleMessageï¼Œå¯ä»¥é€šè¿‡setDefaultListenerMethodè®¾ç½®æ–°çš„æ¶ˆæ¯å¤„ç†æ–¹æ³• MessageListenerAdapteræ”¯æŒä¸åŒçš„é˜Ÿåˆ—äº¤ç»™ä¸åŒçš„æ–¹æ³•å»æ‰§è¡Œã€‚ä½¿ç”¨setQueueOrTagToMethodNameæ–¹æ³•è®¾ç½®ï¼Œå½“æ ¹æ®queueåç§°æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ–¹æ³•çš„æ—¶å€™ï¼Œå°±ä¼šäº¤ç»™é»˜è®¤çš„æ–¹æ³•å»å¤„ç†ã€‚ ä½œè€…ï¼šäºŒæœˆ_æ˜¥é£é“¾æ¥ï¼šhttps://www.jianshu.com/p/d21bafe3b9fd MessageListenerAdapterè¿˜å¯ä»¥é€šè¿‡MessageConverterå°†æ”¶åˆ°çš„æ¶ˆæ¯è½¬æ¢æˆå…¶ä»–ç±»å‹çš„æ•°æ®ï¼Œä»è€Œç»™Delegateä¸­çš„æ–¹æ³•å¤„ç†ã€‚ 1.5 MessageConverterJavaå¯¹è±¡å’ŒMessageäº’è½¬ã€‚ public interface MessageConverter { Message toMessage(Object object, MessageProperties messageProperties) throws MessageConversionException; Object fromMessage(Message message) throws MessageConversionException; } 2 SpringBootæ•´åˆRabbitMQmavenä¾èµ–ï¼š &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-amqp&lt;/artifactId> &lt;/dependency> ä½¿ç”¨SpringBootå°±ä¸ç”¨æˆ‘ä»¬æ‰‹åŠ¨å»æ³¨å…¥ç»„ä»¶äº†ï¼Œæ˜¾ç„¶è¿™äº›æœ¬æ¥æ˜¯åº”è¯¥åœ¨ConnectionFactoryä¸­é…ç½®çš„ä¸œè¥¿ç°åœ¨éƒ½å¯ä»¥æ‹¿å‡ºæ¥ï¼ŒSpringBooté¢„å…ˆå¸®æˆ‘ä»¬æ³¨å…¥å„ç§ç»„ä»¶beanã€‚ #RABBITMQ START spring.rabbitmq.host=127.0.0.1 spring.rabbitmq.port=5672 spring.rabbitmq.username=guest spring.rabbitmq.password=guest # æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼šnoneä¸å¯ç”¨ï¼Œsimpleä½¿ç”¨waitForConfirmsï¼Œcorrelatedä½¿ç”¨CorrelationData spring.rabbitmq.publisher-confirm-type=none # è‡ªå®šä¹‰çš„å±æ€§ï¼Œå®šä¹‰äº†ä¸¤ä¸ªé˜Ÿåˆ—çš„åç§° rabbitmq.queue.msg=spring-boot-queue-msg rabbitmq.queue.user=spring-boot-queue-user #RABBITMQ END å…ˆé…ç½®@EnableRabbitï¼Œå¯ä»¥ä½¿ç”¨@RabbitListener(queues={})æ¥ç»™æ–¹æ³•æ³¨å†Œä¸€ä¸ªMessageListenerContainerï¼Œè¿™ä¸ªMessageListenerContaineræ˜¯ä»SpringBooté»˜è®¤æ³¨å…¥çš„MessageListenerContainerFactoryè·å–çš„ï¼Œå¦‚æœè¦ä¿®æ”¹é»˜è®¤çš„Converterï¼Œå°±è¦è‡ªå·±æ³¨å…¥MessageListenerContainerFactoryï¼Œç„¶åæ›´æ”¹converterã€‚ æ›´å¤šçš„æ³¨è§£ç›¸å…³è§ï¼šä½¿ç”¨@RabbitListeneræ³¨è§£æ¶ˆè´¹æ¶ˆæ¯_Java_æ€è€ƒã€æ€»ç»“ã€ä¸“æ³¨-CSDNåšå®¢ å…¶ä»–çš„ç”¨æ³•å°±æ²¡æœ‰å¾ˆå¤§åŒºåˆ«äº†ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://www.codetool.top/tags/Spring/"},{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"https://www.codetool.top/tags/RabbitMQ/"}]},{"title":"RabbitMQæ¶ˆæ¯ç§¯å‹è§£å†³æ–¹æ¡ˆ-TTLä¸æ­»ä¿¡é˜Ÿåˆ—","slug":"RabbitMQæ¶ˆæ¯ç§¯å‹è§£å†³æ–¹æ¡ˆ-TTLä¸æ­»ä¿¡é˜Ÿåˆ—","date":"2020-03-13T10:57:19.000Z","updated":"2020-03-13T10:58:10.092Z","comments":true,"path":"article/RabbitMQæ¶ˆæ¯ç§¯å‹è§£å†³æ–¹æ¡ˆ-TTLä¸æ­»ä¿¡é˜Ÿåˆ—/","link":"","permalink":"https://www.codetool.top/article/RabbitMQ%E6%B6%88%E6%81%AF%E7%A7%AF%E5%8E%8B%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-TTL%E4%B8%8E%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97/","excerpt":"","text":"æ¶ˆæ¯ç§¯å‹çš„åœºæ™¯æœ‰å¾ˆå¤šï¼Œå¦‚æœå‘é€çš„æ¶ˆæ¯æ²¡æœ‰å¾—åˆ°åŠæ—¶å›å¤ï¼Œåˆ™ä¼šå¯¼è‡´æŒä¹…åŒ–æ¶ˆæ¯ä¸æ–­ç§¯å‹è€Œå¾—ä¸åˆ°é‡Šæ”¾ï¼Œä»è€Œå µå¡æ¶ˆæ¯é˜Ÿåˆ—ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œå¯ä»¥é€šè¿‡é…ç½®æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´å’Œæ­»ä¿¡é˜Ÿåˆ—å¤„ç†æ¥é¢„é˜²ã€‚ 1 TTLæ¶ˆæ¯RabbitMQæ”¯æŒæ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ï¼Œå³ä¹‹å‰æŸç¯‡åšå®¢åœ¨æ¶ˆæ¯å±æ€§ä¸­è®¾ç½®çš„expiration(&quot;10000&quot;)ï¼Œä¹Ÿæ”¯æŒåœ¨é˜Ÿåˆ—å±‚é¢é…ç½®é˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ï¼Œä»æ¶ˆæ¯å…¥é˜Ÿåˆ—å¼€å§‹è®¡ç®—ï¼Œåªè¦è¶…è¿‡äº†é˜Ÿåˆ—çš„è¶…æ—¶æ—¶é—´é…ç½®ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šè‡ªåŠ¨åœ°æ¸…é™¤ã€‚ é…ç½®é˜Ÿåˆ—çš„æ¶ˆæ¯è¿‡æœŸæ—¶é—´ï¼šåœ¨å£°æ˜é˜Ÿåˆ—çš„æ—¶å€™é…ç½®é˜Ÿåˆ—å‚æ•°x-message-ttlï¼š Map&lt;String, Object> arguments = new HashMap&lt;>(); arguments.put(\"x-message-ttl\", 10000); channel.queueDeclare(queueName,true,false, false, arguments); 2 æ­»ä¿¡é˜Ÿåˆ—2.1 æ¦‚è¿°DLXï¼ŒDead-Letter-Exchange åˆ©ç”¨DLXï¼Œå½“æ¶ˆæ¯åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­å˜æˆæ­»ä¿¡ (dead message)ä¹‹åï¼Œå®ƒèƒ½è¢«é‡æ–°publishåˆ°å¦ä¸€ä¸ªExchangeï¼Œè¿™ä¸ªExchangeå°±æ˜¯DLX æ¶ˆæ¯å˜æˆæ­»ä¿¡æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µ æ¶ˆæ¯è¢«æ‹’ç»(basic.reject/basic.nack)ï¼Œå¹¶ä¸”requeue=false æ¶ˆæ¯TTLè¿‡æœŸ é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦ DLXç‰¹ç‚¹ï¼š DLXä¹Ÿæ˜¯ä¸€ä¸ªæ­£å¸¸çš„Exchange, å’Œä¸€èˆ¬çš„Exchangeæ²¡æœ‰åŒºåˆ«ï¼Œ å®ƒèƒ½åœ¨ä»»ä½•çš„é˜Ÿåˆ—ä¸Šè¢«æŒ‡å®šï¼Œå®é™…ä¸Šå°±æ˜¯è®¾ç½®æŸä¸ªé˜Ÿåˆ—çš„å±æ€§ã€‚ å½“è¿™ä¸ªé˜Ÿåˆ—ä¸­æœ‰æ­»ä¿¡æ—¶ï¼ŒRabbitMQå°±ä¼šè‡ªåŠ¨çš„å°†è¿™ä¸ªæ¶ˆæ¯é‡æ–°å‘å¸ƒåˆ°è®¾ç½®çš„Exchangeä¸Šå»ï¼Œè¿›è€Œè¢«è·¯ç”±åˆ°å¦ä¸€ä¸ªé˜Ÿåˆ—ã€‚ å¯ä»¥ç›‘å¬è¿™ä¸ªé˜Ÿåˆ—ä¸­æ¶ˆæ¯åšç›¸åº”çš„å¤„ç†ï¼Œè¿™ä¸ªç‰¹æ€§å¯ä»¥å¼¥è¡¥RabbitMQ3.0ä»¥å‰æ”¯æŒçš„immediateå‚æ•°çš„åŠŸèƒ½ã€‚ å£°æ˜é˜Ÿåˆ—æ—¶æ·»åŠ å‚æ•°x-dead-letter-exchangeï¼Œå€¼ä¸ºæ­»ä¿¡é˜Ÿåˆ—äº¤æ¢æœºçš„åå­—ã€‚ 2.2 ç¤ºä¾‹æ¶ˆè´¹ç«¯ï¼š public class Comsumer { public static void main(String[] args) throws Exception { ConnectionFactory connectionFactory = new ConnectionFactory(); connectionFactory.setHost(\"127.0.0.1\"); connectionFactory.setPort(5672); connectionFactory.setUsername(\"guest\"); connectionFactory.setPassword(\"guest\"); connectionFactory.setVirtualHost(\"/\"); Connection connection = connectionFactory.newConnection(); Channel channel = connection.createChannel(); String exchange = \"test_dlx_exchange\"; String routingKey = \"dlx.#\"; String queueName = \"test_consumer_queue\"; String dlxName = \"dlx.exchange\"; String dlxQueueName = \"dlx.queue\"; //å£°æ˜å¹¶ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—åˆ°äº¤æ¢å™¨ä¸Š channel.exchangeDeclare(dlxName, \"topic\",true,false,null); channel.queueDeclare(dlxQueueName,true,false,false,null); channel.queueBind(dlxQueueName, dlxName, \"#\"); Map&lt;String, Object> arguments = new HashMap&lt;>(); //è®¾ç½®é˜Ÿåˆ—æ¶ˆæ¯ttl arguments.put(\"x-message-ttl\", 10000); //è®¾ç½®æ­»ä¿¡é˜Ÿåˆ—äº¤æ¢å™¨ arguments.put(\"x-dead-letter-exchange\",dlxName); //å£°æ˜ä¸€ä¸ªæ­£å¸¸æ¥æ”¶æ¶ˆæ¯çš„é˜Ÿåˆ—å’Œäº¤æ¢æœº channel.exchangeDeclare(exchange, \"topic\",true,false,null); channel.queueDeclare(queueName,true,false, false, arguments); channel.queueBind(queueName, exchange,routingKey); com.rabbitmq.client.Consumer consumer = new DefaultConsumer(channel) { @Override //æ¶ˆè´¹æ¶ˆæ¯ public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException { String routingKey = envelope.getRoutingKey(); String contentType = properties.getContentType(); System.out.println(\"æ¶ˆè´¹çš„è·¯ç”±é”®ï¼š\"+routingKey); System.out.println(\"æ¶ˆè´¹çš„å†…å®¹ç±»å‹ï¼š\"+contentType); long deliveryTag = envelope.getDeliveryTag(); // ç¡®è®¤æ¶ˆæ¯ channel.basicAck(deliveryTag, false); System.out.println(\"æ¶ˆè´¹çš„æ¶ˆæ¯ä½“å†…å®¹ï¼š\"); String bodyStr = new String(body,\"UTF-8\"); System.out.println(bodyStr); } }; //ç›´æ¥æ¥æ”¶æ­»ä¿¡é˜Ÿåˆ—å†…çš„æ¶ˆæ¯ï¼Œè¿™æ ·æ­£å¸¸é˜Ÿåˆ—æ²¡æœ‰æ¶ˆè´¹è€…ï¼Œè¿‡äº†10såæ¶ˆæ¯å°±ä¼šè¢«è½¬å‘åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ã€‚ channel.basicConsume(dlxQueueName,false,consumer); } } ç”Ÿäº§ç«¯ï¼š public class Producer { public static void main(String[] args) throws Exception { ConnectionFactory connectionFactory = new ConnectionFactory(); connectionFactory.setHost(\"127.0.0.1\"); connectionFactory.setPort(5672); connectionFactory.setUsername(\"guest\"); connectionFactory.setPassword(\"guest\"); connectionFactory.setVirtualHost(\"/\"); Connection connection = connectionFactory.newConnection(); Channel channel = connection.createChannel(); String exchange = \"test_dlx_exchange\"; String routingKey = \"dlx.save\"; String msg = \"Hello RabbitMQ \"; channel.basicPublish(exchange,routingKey,null,msg.getBytes()); channel.close(); connection.close(); } } å…ˆè¿è¡Œæ¶ˆè´¹ç«¯ï¼Œæš‚åœæ¶ˆè´¹ç«¯åº”ç”¨ï¼Œå†è¿è¡Œç”Ÿäº§ç«¯ï¼Œè§‚å¯Ÿåˆ°ä¸€å¼€å§‹æ¶ˆæ¯åœ¨æ­£å¸¸é˜Ÿåˆ—ä¸­ è¿‡äº†åç§’ï¼Œæ¶ˆæ¯è¿›å…¥æ­»ä¿¡é˜Ÿåˆ— å†æ¬¡è¿è¡Œæ¶ˆè´¹ç«¯åº”ç”¨ï¼Œçœ‹åˆ°æ§åˆ¶å°è¾“å‡ºæ¶ˆæ¯ æ¶ˆè´¹çš„è·¯ç”±é”®ï¼šdlx.save æ¶ˆè´¹çš„å†…å®¹ç±»å‹ï¼šnull æ¶ˆè´¹çš„æ¶ˆæ¯ä½“å†…å®¹ï¼š Hello RabbitMQ","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"æ¶ˆæ¯é˜Ÿåˆ—","slug":"æ¶ˆæ¯é˜Ÿåˆ—","permalink":"https://www.codetool.top/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"},{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"https://www.codetool.top/tags/RabbitMQ/"}]},{"title":"RabbitMQå¯é æŠ•é€’å’Œæ¶ˆè´¹ç¡®è®¤","slug":"RabbitMQå¯é æŠ•é€’å’Œæ¶ˆè´¹ç¡®è®¤","date":"2020-03-13T07:29:35.000Z","updated":"2020-03-13T07:40:23.531Z","comments":true,"path":"article/RabbitMQå¯é æŠ•é€’å’Œæ¶ˆè´¹ç¡®è®¤/","link":"","permalink":"https://www.codetool.top/article/RabbitMQ%E5%8F%AF%E9%9D%A0%E6%8A%95%E9%80%92%E5%92%8C%E6%B6%88%E8%B4%B9%E7%A1%AE%E8%AE%A4/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š RabbitMQå­¦ä¹ (äº”)â€”â€”æ¶ˆæ¯ç¡®è®¤æœºåˆ¶(AMQPäº‹åŠ¡)_å¤§æ•°æ®_Anumbrella-CSDNåšå®¢ 1 å¯é æŠ•é€’ç”Ÿäº§ç«¯è´Ÿè´£çš„ä»»åŠ¡æœ‰ï¼š ä¿éšœæ¶ˆæ¯çš„æˆåŠŸå‘å‡º ä¿éšœMQèŠ‚ç‚¹çš„æˆåŠŸæ¥æ”¶ï¼Œå¹¶æ”¶åˆ°æ¥è‡ªMQèŠ‚ç‚¹çš„ç¡®è®¤åº”ç­” å®Œå–„çš„æ¶ˆæ¯è¡¥å¿æœºåˆ¶ é‚£ä¹ˆå¦‚ä½•ç¡®ä¿MQï¼ˆBrokerï¼‰æ”¶åˆ°äº†æ¶ˆæ¯ï¼Ÿå°±è¦è®²åˆ°RabbitMQå¯¹æ¶ˆæ¯ç¡®è®¤æœºåˆ¶çš„æ”¯æŒ 1.1 æ¶ˆæ¯ç¡®è®¤æœºåˆ¶1.1.1 AMQPäº‹åŠ¡æœºåˆ¶åœ¨AMQPä¸­å½“æŠŠä¿¡é“è®¾ç½®æˆäº†äº‹åŠ¡æ¨¡å¼ä¹‹åï¼Œç”Ÿäº§è€…å’ŒBrokerä¹‹é—´ä¼šæœ‰ä¸€ç§å‘é€/å“åº”æœºåˆ¶åˆ¤æ–­å½“å‰å‘½ä»¤æ“ä½œæ˜¯å¦å¯ä»¥ç»§ç»­ã€‚ AMQP-clientä¸­ä¸äº‹åŠ¡æœ‰å…³çš„ä¸»è¦æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š txSelect()ï¼šå¼€å¯äº‹åŠ¡ txCommit()ï¼šæäº¤äº‹åŠ¡ txRollback()ï¼šå›æ»šäº‹åŠ¡ å½“æˆ‘ä»¬ä½¿ç”¨txSelectå¼€å§‹äº‹åŠ¡ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘é€æ¶ˆæ¯ç»™Brokerï¼Œå¦‚æœtxCommitæäº¤æˆåŠŸäº†ï¼Œåˆ™æ¶ˆæ¯ä¸€å®šåˆ°è¾¾äº†Brokeräº†ï¼Œå¦‚æœåœ¨txCommitæ‰§è¡Œä¹‹å‰Brokerå‡ºç°å¼‚å¸¸å´©æºƒæˆ–è€…ç”±äºå…¶ä»–åŸå› æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¾¿å¯ä»¥æ•è·å¼‚å¸¸é€šè¿‡txRollbackæ–¹æ³•è¿›è¡Œå›æ»šäº‹åŠ¡ã€‚ ä½†æ˜¯äº‹åŠ¡æ¨¡å¼è¦æ±‚ç”Ÿäº§è€…åŒæ­¥ç­‰å¾…Brokerçš„è¿”å›ç»“æœï¼Œæ‰€ä»¥æ€§èƒ½ä¸å¥½ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ã€‚ 1.1.2 å‘é€æ–¹ç¡®è®¤æœºåˆ¶å‘é€æ–¹ç¡®è®¤æœºåˆ¶æ˜¯RabbitMQå¯¹AMQPçš„æ‹“å±•å®ç°ï¼Œå‘é€æ–¹ç¡®è®¤æ¨¡å¼æ˜¯RabbitMQå¯¹AMQPçš„æ‰©å±•å®ç°ï¼ŒæŠŠä¿¡é“è®¾ç½®æˆç¡®è®¤æ¨¡å¼ä¹‹åï¼Œåœ¨è¯¥ä¿¡é“ä¸Šå‘å¸ƒçš„æ‰€æœ‰æ¶ˆæ¯éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªå”¯ä¸€ID, ä¸€æ—¦æ¶ˆæ¯è¢«æŠ•é€’åˆ°æ‰€æœ‰åŒ¹é…çš„é˜Ÿåˆ—ä¸­ï¼Œè¯¥ä¿¡é“å°±ä¼šå‘ç”Ÿäº§è€…å‘é€ç¡®è®¤æ¶ˆæ¯ï¼Œåœ¨ç¡®è®¤æ¶ˆæ¯ä¸­åŒ…å«äº†ä¹‹å‰çš„å”¯ä¸€IDï¼Œä»è€Œè®©ç”Ÿäº§è€…çŸ¥é“æ¶ˆæ¯å·²åˆ°è¾¾ç›®çš„é˜Ÿåˆ—ã€‚å‘é€æ–¹ç¡®è®¤æ¨¡å¼çš„æœ€å¤§ä¼˜åŠ¿æ˜¯å¼‚æ­¥ï¼Œç”Ÿäº§è€…å‘é€å®Œä¸€æ¡æ¶ˆæ¯åå¯ç»§ç»­å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯ï¼Œå½“ç”Ÿäº§è€…æ”¶åˆ°ç¡®è®¤æ¶ˆæ¯åè°ƒç”¨å›è°ƒæ–¹æ³•å¤„ç†ã€‚ç”±äºæ²¡æœ‰äº‹åŠ¡å›æ»šçš„æ¦‚å¿µï¼Œè¿™ç§æ–¹å¼æ¯”äº‹åŠ¡æ¨¡å¼è½»äº†è®¸å¤šï¼Œå…¶å¯¹Brokerçš„æ€§èƒ½å½±å“ç›¸å¯¹æ¥è¯´ä¹Ÿå°äº†å¾ˆå¤šã€‚ AMQP-clientä¸­ä¸å‘é€æ–¹ç¡®è®¤æœ‰å…³çš„ä¸»è¦æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š confirmSelect()ï¼šå¼€å¯ç¡®è®¤æ¨¡å¼ waitForConfirms()ï¼šé˜»å¡ç­‰å¾…Brokerç¡®è®¤ addConfirmListener()ï¼šè¿™æ˜¯æ”¯æŒå¼‚æ­¥ç¡®è®¤çš„å…³é”®ï¼Œå¯ä»¥è®©å‘é€æ–¹åœ¨æ”¶åˆ°ç¡®è®¤æ¶ˆæ¯åè°ƒç”¨æ¥å£å†…çš„å›è°ƒæ–¹æ³•ã€‚ channel.addConfirmListener(new ConfirmListener() { @Override //æ”¶åˆ°ç¡®è®¤åçš„å›è°ƒï¼ŒdeliveryTagæ¯å‘é€ä¸€æ¡æ¶ˆæ¯+1ï¼ˆidï¼‰ public void handleAck(long deliveryTag, boolean multiple) throws IOException { } @Override //æ”¶åˆ°NACKåçš„å›è°ƒ public void handleNack(long deliveryTag, boolean multiple) throws IOException { } }); éœ€è¦æ³¨æ„ handleNack æ–¹æ³•åªåœ¨æ¯”å¦‚ç£ç›˜å†™æ»¡äº†ï¼ŒMQå‡ºç°äº†ä¸€äº›å¼‚å¸¸ï¼Œæˆ–è€…Queueå®¹é‡åˆ°è¾¾ä¸Šé™äº†è¿™ç±»æƒ…å†µä¸‹è°ƒç”¨ï¼Œå¦‚æœå› ä¸ºç½‘ç»œæˆ–å®•æœºåŸå› æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­ä¸¢å¤±ç­‰æƒ…å†µä¸ä¼šå—åˆ°NACKï¼Œè¿™ä¸ªæ—¶å€™å°±å¾—è€ƒè™‘å‘é€ç«¯è¿™è¾¹å®šæ—¶åˆ¤æ–­æ˜¯å¦æ”¶åˆ°ACKä»è€Œåˆ¤æ–­Brokeræ˜¯å¦æ”¶åˆ°æ¶ˆæ¯ã€‚ 1.2 è·¯ç”±é€€å›å¦‚æœBrokeræ”¶åˆ°äº†æ¶ˆæ¯ï¼Œä½†æ²¡æœ‰å¯è·¯ç”±çš„é˜Ÿåˆ—ï¼Œæˆ–æ˜¯é˜Ÿåˆ—å·²æ»¡ï¼Œä¹Ÿä¸èƒ½å®ç°å¯é æŠ•é€’ã€‚é’ˆå¯¹è¿™ä¸ªæƒ…å†µRabbitMQæä¾›äº†ReturnListenerï¼Œå’ŒConfirmListenerå·®ä¸å¤šçš„ç”¨æ³•ã€‚ä½†æ˜¯å‘æ¶ˆæ¯çš„æ—¶å€™ä½¿ç”¨ void basicPublish(String exchange, String routingKey, boolean mandatory, BasicProperties props, byte[] body) throws IOException; é‡è½½ï¼Œå…¶ä¸­Mandotoryè¿™ä¸ªå±æ€§å¦‚æœä¸ºtrueä»£è¡¨å¦‚æœæ²¡æœ‰è·¯ç”±æˆåŠŸï¼Œåˆ™é€€å›ç»™ç”Ÿäº§æ®µï¼Œå¦‚æœä¸ºfalseåˆ™ç›´æ¥åˆ é™¤ï¼Œè¿™é‡Œå¿…é¡»è®¾ç½®ä¸ºtrueã€‚ channel.addReturnListener(new ReturnListener() { @Override //å¦‚æœæ— æ³•è·¯ç”±ï¼Œé€€å› public void handleReturn(int replyCode, String replyText, String exchange, String routingKey, AMQP.BasicProperties properties, byte[] body) throws IOException { } }); 2 æ¶ˆè´¹ç¡®è®¤2.1 æ¶ˆè´¹è€…ACKæœ‰çš„æ—¶å€™ä¸ä»…è¦ä¿è¯å‘é€ç«¯100%å°†æ¶ˆæ¯å‘é€åˆ°äº†Brokerï¼Œè¿˜éœ€è¦ç¡®è®¤æ¶ˆè´¹ç«¯æ˜¯å¦æ”¶åˆ°æ¶ˆæ¯æˆ–æ˜¯æ˜¯å¦æ¶ˆè´¹äº†æ¶ˆæ¯ã€‚ RabbitMQæ”¯æŒæ¶ˆè´¹ç«¯çš„ä¸¤ç§æ¶ˆæ¯å›æ‰§æœºåˆ¶ï¼š è‡ªåŠ¨å›æ‰§ï¼šBrokerå‘é€æ¶ˆæ¯ç»™æ¥æ”¶ç«¯åç«‹å³åˆ é™¤è¯¥æ¶ˆæ¯ï¼Œä¸ç­‰å¾…æ¶ˆè´¹ç«¯å›æ‰§ã€‚ æ‰‹åŠ¨å›æ‰§ï¼šBrokerå‘é€æ¶ˆæ¯ç»™æ¥æ”¶ç«¯åæš‚ä¸åˆ é™¤è¯¥æ¶ˆæ¯ï¼Œç­‰å¾…æ¶ˆè´¹ç«¯å›æ‰§åå†åˆ é™¤ã€‚å¦‚æœæ²¡æœ‰ç­‰åˆ°æ¶ˆè´¹è€…çš„ACKï¼Œä¼šå°†æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–æ¶ˆè´¹è€…ã€‚ æ˜¯å¦å¼€å¯è‡ªåŠ¨å›æ‰§æ¨¡å¼ç”±æ¶ˆè´¹ç«¯çš„basicConsumeæ–¹æ³•çš„autoAckå‚æ•°å†³å®šï¼Œæ‰‹åŠ¨å›æ‰§éœ€è¦åœ¨è‡ªå®šä¹‰æ¶ˆè´¹è€…ä¸­å®ç°ï¼š public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException { String routingKey = envelope.getRoutingKey(); String contentType = properties.getContentType(); System.out.println(\"æ¶ˆè´¹çš„è·¯ç”±é”®ï¼š\"+routingKey); System.out.println(\"æ¶ˆè´¹çš„å†…å®¹ç±»å‹ï¼š\"+contentType); long deliveryTag = envelope.getDeliveryTag(); // æ‰‹åŠ¨å›æ‰§ channel.basicAck(deliveryTag, false); System.out.println(\"æ¶ˆè´¹çš„æ¶ˆæ¯ä½“å†…å®¹ï¼š\"); String bodyStr = new String(body,\"UTF-8\"); System.out.println(bodyStr); } 2.2 æ‹’ç»æ¶ˆæ¯å½“æ¶ˆè´¹è€…ç›®å‰ä¸èƒ½å¤„ç†è¯¥æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥é€‰æ‹©ç»™Brokerå‘é€ä¸€ä¸ªæ‹’ç»æ¶ˆæ¯çš„æŒ‡ä»¤ï¼Œå¹¶ä¸”å¯ä»¥è¦æ±‚Brokerå°†è¯¥æ¶ˆæ¯ä¸¢å¼ƒæˆ–é‡æ–°æ”¾å…¥é˜Ÿåˆ—ä¸­ã€‚å¯¹åº”channelä¸­çš„ä¸¤ä¸ªæ–¹æ³•ï¼š //é€€å›ä¸€æ¡æ¶ˆæ¯ï¼ŒdeliveryTagæŒ‡å®šæ¶ˆæ¯çš„deliveryTagï¼Œrequeueä¸ºtrueé‡æ–°æ”¾å…¥é˜Ÿåˆ—ï¼Œå¦åˆ™é”€æ¯ void basicReject(long deliveryTag, boolean requeue) throws IOException; //é€€å›å¤šæ¡æ¶ˆæ¯ï¼Œå¦‚æœmultipleä¸ºtrueä»£è¡¨é™¤äº†å·²åº”ç­”çš„æ¶ˆæ¯ï¼Œå¦åˆ™æ¯”å½“å‰deliveryTagå°çš„æ¶ˆæ¯å…¨éƒ¨æ‹’ç» void basicNack(long deliveryTag, boolean multiple, boolean requeue) throws IOException; 2.3 æ¶ˆæ¯é¢„å–ï¼ˆæ¶ˆè´¹ç«¯é™æµï¼‰åœ¨å®é™…åœºæ™¯ä¸­ï¼Œå¦‚æœå¯¹æ¯æ¡æ¶ˆæ¯çš„å¤„ç†æ—¶é—´ä¸åŒï¼Œåˆ™å¯èƒ½å¯¼è‡´æœ‰äº›æ¶ˆè´¹è€…ä¸€ç›´å¾ˆå¿™ï¼Œè€Œæœ‰äº›æ¶ˆè´¹è€…å¤„ç†å¾ˆå¿«å¹¶ä¸€ç›´ç©ºé—²ã€‚è¿™æ—¶å¯é€šè¿‡è®¾ç½®é¢„å–æ•°é‡(PrefetchCount)é™åˆ¶æ¯ä¸ªæ¶ˆè´¹è€…åœ¨æ”¶åˆ°ä¸‹ä¸€ä¸ªç¡®è®¤å›æ‰§å‰ä¸€æ¬¡æœ€å¤šå¯ä»¥æ¥æ”¶å¤šå°‘æ¡æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œè®¾ç½®prefetchCountä¸º1ï¼Œåˆ™è¡¨ç¤ºRabbitMQæœåŠ¡å™¨æ¯æ¬¡ç»™æ¯ä¸ªæ¶ˆè´¹è€…å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œåœ¨æ”¶åˆ°è¯¥æ¶ˆæ¯çš„æ¶ˆè´¹è€…ACKæŒ‡ä»¤ä¹‹å‰RabbitMQä¸ä¼šå†å‘è¯¥æ¶ˆè´¹è€…å‘é€æ–°çš„æ¶ˆæ¯ã€‚å¯ä»¥é€šè¿‡channelä¸­çš„basicQosæ–¹æ³•è®¾ç½®é¢„å–æ•°é‡ï¼š è¦ä½¿ç”¨è¿™ä¸ªç­–ç•¥ï¼Œå¿…é¡»ä½¿ç”¨æ‰‹åŠ¨å›æ‰§ï¼Œå¦åˆ™Brokerä¸ä¼šç­‰å¾…ACKæ¶ˆæ¯ã€‚ //prefetchSizeæŒ‡çš„æ˜¯ä»¥å­—èŠ‚åº¦é‡çš„æœ€å¤§å¤§å°ï¼Œ0ä»£è¡¨ä¸é™åˆ¶ï¼Œé€šå¸¸ä¸ç”¨è¿™ä¸ªå‚æ•° void basicQos(int prefetchSize, int prefetchCount, boolean global) throws IOException; //å¸¸ç”¨ç‰ˆæœ¬ï¼Œglobalå†³å®šæ˜¯ç”Ÿæ•ˆäºChannelè¿˜æ˜¯Consumer void basicQos(int prefetchCount, boolean global) throws IOException; 3 æ€»ç»“æœ‰äº†ä»¥ä¸ŠæŠ€æœ¯æ”¯æ’‘ï¼Œå°±å¯ä»¥é€šè¿‡ä¸€ç³»åˆ—çš„æªæ–½æ¥å®ç°æ¶ˆæ¯100%èƒ½ä»ç”Ÿäº§ç«¯åˆ°è¾¾æ¶ˆè´¹ç«¯ï¼Œå…·ä½“ä¸šåŠ¡è§£å†³æ–¹æ¡ˆå¯ä»¥å‚è€ƒï¼š RabbitMQæ¶ˆæ¯100%å¯é æ€§æŠ•é€’çš„è§£å†³æ–¹æ¡ˆå®ç°(ä¸€)_å¤§æ•°æ®_eluanshi12çš„åšå®¢-CSDNåšå®¢","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"æ¶ˆæ¯é˜Ÿåˆ—","slug":"æ¶ˆæ¯é˜Ÿåˆ—","permalink":"https://www.codetool.top/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"},{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"https://www.codetool.top/tags/RabbitMQ/"}]},{"title":"å‰‘æŒ‡offer03-æ•°ç»„ä¸­é‡å¤çš„æ•°å­—","slug":"å‰‘æŒ‡offer03-æ•°ç»„ä¸­é‡å¤çš„æ•°å­—","date":"2020-03-12T17:29:19.000Z","updated":"2020-03-12T17:32:13.776Z","comments":true,"path":"article/å‰‘æŒ‡offer03-æ•°ç»„ä¸­é‡å¤çš„æ•°å­—/","link":"","permalink":"https://www.codetool.top/article/%E5%89%91%E6%8C%87offer03-%E6%95%B0%E7%BB%84%E4%B8%AD%E9%87%8D%E5%A4%8D%E7%9A%84%E6%95%B0%E5%AD%97/","excerpt":"","text":"1 åŸé¢˜ï¼ˆæ¥æºLeetcodeï¼‰æ‰¾å‡ºæ•°ç»„ä¸­é‡å¤çš„æ•°å­—ã€‚ åœ¨ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„ nums é‡Œçš„æ‰€æœ‰æ•°å­—éƒ½åœ¨ 0ï½n-1 çš„èŒƒå›´å†…ã€‚æ•°ç»„ä¸­æŸäº›æ•°å­—æ˜¯é‡å¤çš„ï¼Œä½†ä¸çŸ¥é“æœ‰å‡ ä¸ªæ•°å­—é‡å¤äº†ï¼Œä¹Ÿä¸çŸ¥é“æ¯ä¸ªæ•°å­—é‡å¤äº†å‡ æ¬¡ã€‚è¯·æ‰¾å‡ºæ•°ç»„ä¸­ä»»æ„ä¸€ä¸ªé‡å¤çš„æ•°å­—ã€‚ ç¤ºä¾‹ 1: è¾“å…¥:[2, 3, 1, 0, 2, 5, 3]è¾“å‡º: 2 æˆ– 3 é™åˆ¶ï¼š 2 &lt;= n &lt;= 100000 2 è§£æ³•2.1 æ€æƒ³é™å®šäº†èŒƒå›´ï¼Œå°±ç”¨bitmapå»é‡çš„æ€æƒ³ 2.2 ä»£ç class Solution { public int findRepeatNumber(int[] nums) { boolean exist[] = new boolean[nums.length]; for(int i:nums){ if(exist[i] == true) return i; exist[i] = true; } return -1; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"å‰‘æŒ‡offer","slug":"å‰‘æŒ‡offer","permalink":"https://www.codetool.top/tags/%E5%89%91%E6%8C%87offer/"}]},{"title":"AMQPåè®®ä»‹ç»å’Œä½¿ç”¨AMQP-clientæ“ä½œRabbitMQ","slug":"AMQPåè®®ä»‹ç»å’ŒRabbitMQå…¥é—¨æ¡ˆä¾‹","date":"2020-03-12T14:08:39.000Z","updated":"2020-03-13T07:01:40.639Z","comments":true,"path":"article/AMQPåè®®ä»‹ç»å’ŒRabbitMQå…¥é—¨æ¡ˆä¾‹/","link":"","permalink":"https://www.codetool.top/article/AMQP%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D%E5%92%8CRabbitMQ%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š æ·±å…¥ç†è§£AMQPåè®®_ç½‘ç»œ_My Blogs-CSDNåšå®¢ æ¨èé˜…è¯»ï¼š æ¶ˆæ¯é˜Ÿåˆ—æ¦‚è¿°ä¸JMSä½¿ç”¨ 1 RabbitMQæ¦‚è¿°RabbitMQæ˜¯ä¸€ä¸ªç”±Erlangè¯­è¨€å¼€å‘çš„åŸºäºAMQPæ ‡å‡†çš„å¼€æºå®ç°ã€‚RabbitMQ æœ€åˆèµ·æºäºé‡‘èç³»ç»Ÿï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å­˜å‚¨è½¬å‘æ¶ˆæ¯ï¼Œåœ¨æ˜“ç”¨æ€§ã€æ‰©å±•æ€§ã€é«˜å¯ç”¨æ€§ç­‰æ–¹é¢è¡¨ç°ä¸ä¿—ã€‚å…¶å…·ä½“ç‰¹ç‚¹åŒ…æ‹¬: ä¿è¯å¯é æ€§(Reliability)ã€‚RabbitMQ ä½¿ç”¨ä¸€äº›æœºåˆ¶æ¥ä¿è¯å¯é æ€§ï¼Œå¦‚æŒä¹…åŒ–ã€ä¼ è¾“ç¡®è®¤ã€å‘å¸ƒç¡®è®¤ç­‰ã€‚ å…·æœ‰çµæ´»çš„è·¯ç”±(Flexible Routing)åŠŸèƒ½ã€‚åœ¨æ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—ä¹‹å‰ï¼Œæ˜¯é€šè¿‡Exchange(äº¤æ¢å™¨)æ¥è·¯ç”±æ¶ˆæ¯çš„ã€‚å¯¹äºå…¸å‹çš„è·¯ç”±åŠŸèƒ½ï¼ŒRabbitMQå·²ç»æä¾›äº†ä¸€äº›å†…ç½®çš„Exchangeæ¥å®ç°ã€‚é’ˆå¯¹æ›´å¤æ‚çš„è·¯ç”±åŠŸèƒ½ï¼Œå¯ä»¥å°†å¤šä¸ªExchangeç»‘å®šåœ¨ä¸€èµ·ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ’ä»¶æœºåˆ¶æ¥å®ç°è‡ªå·±çš„Exchangeã€‚ æ”¯æŒæ¶ˆæ¯é›†ç¾¤(Clustering)ã€‚ å¤šå°RabbitMQæœåŠ¡å™¨å¯ä»¥ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œå½¢æˆä¸€ä¸ªé€»è¾‘Brokerã€‚ å…·æœ‰é«˜å¯ç”¨æ€§(Highly Available)ã€‚é˜Ÿåˆ—å¯ä»¥åœ¨é›†ç¾¤ä¸­çš„æœºå™¨ä¸Šè¿›è¡Œé•œåƒï¼Œä½¿å¾—åœ¨éƒ¨åˆ†èŠ‚ç‚¹å‡ºç°é—®é¢˜çš„æƒ…å†µä¸‹é˜Ÿåˆ—ä»ç„¶å¯ç”¨ã€‚ æ”¯æŒå¤šç§åè®®(Multi-protocol)ã€‚RabbitMQ é™¤æ”¯æŒAMQPåè®®ä¹‹å¤–ï¼Œè¿˜é€šè¿‡æ’ä»¶çš„æ–¹å¼æ”¯æŒå…¶ä»–æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼Œæ¯”å¦‚STOMPã€MQTTç­‰ã€‚ 2 AMQPåè®®2.1 AMQPæ ¸å¿ƒæ¦‚å¿µServerï¼ŒæœåŠ¡å™¨ï¼Œåˆç§°Brokerï¼Œæ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå®ç°AMQPå®ä½“æœåŠ¡ Connectionï¼Œè¿æ¥ï¼Œåº”ç”¨ç¨‹åºå’ŒBrokerçš„ç½‘ç»œè¿æ¥ Channelï¼Œç½‘ç»œä¿¡é“ï¼Œå‡ ä¹æ‰€æœ‰çš„æ“ä½œéƒ½åœ¨Channelä¸­è¿›è¡Œï¼Œå®¢æˆ·ç«¯å¯å»ºç«‹å¤šä¸ªChannelï¼Œæ¯ä¸ªChannelä»£è¡¨ä¸€ä¸ªä¼šè¯ä»»åŠ¡ã€‚æœ‰ç‚¹åƒJMSçš„Sessionã€‚ Messageï¼Œæ¶ˆæ¯ï¼Œç”±Propertieså’ŒBodyç»„æˆï¼ŒPropertieså¯ä»¥å¯¹æ¶ˆæ¯è¿›è¡Œä¿®é¥°ï¼ˆç±»ä¼¼äºHttpçš„è¯·æ±‚å¤´ï¼‰ï¼ŒBodyå°±æ˜¯æ¶ˆæ¯ä½“å†…å®¹ã€‚ Exchangeï¼Œäº¤æ¢æœºï¼Œç”¨æ¥æ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯å¹¶å°†è¿™äº›æ¶ˆæ¯è·¯ç”±ç»™æœåŠ¡å™¨ä¸­çš„é˜Ÿåˆ— Queueï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”¨æ¥ä¿å­˜æ¶ˆæ¯ç›´åˆ°å‘é€ç»™æ¶ˆè´¹è€…ã€‚ Routing Keyï¼Œè·¯ç”±é”®ï¼Œè™šæ‹Ÿæœºå¯ä»¥ç”¨å®ƒæ¥ç¡®å®šå¦‚ä½•è·¯ç”±ä¸€ä¸ªç‰¹å®šæ¶ˆæ¯ Bindingï¼Œç»‘å®šï¼Œç”¨äºExchangeå’ŒQueueä¹‹é—´çš„å…³è”ã€‚ä¸€ä¸ªBindingè·¯ç”±è§„åˆ™å°±æ˜¯ä¸€ä¸ªRoutingKeyå’ŒQueueçš„å¯¹åº”å…³ç³»ã€‚ Virtual hostï¼šè™šæ‹Ÿä¸»æœºï¼Œç”¨äºè¿›è¡Œé€»è¾‘éš”ç¦»ï¼Œæœ€ä¸Šå±‚çš„æ¶ˆæ¯è·¯ç”±ã€‚æ¯ä¸ªVirtual hostç±»ä¼¼äºä¸€ä¸ªminiç‰ˆçš„æ¶ˆæ¯æœåŠ¡å™¨ã€‚ä¸€ä¸ªVirtual hosté‡Œé¢å¯ä»¥æœ‰è‹¥å¹²ä¸ªExchangeå’ŒQueueï¼ŒåŒä¸€ä¸ªVirtual Hosté‡Œé¢ä¸èƒ½æœ‰ç›¸åŒåç§°çš„Exchangeå’ŒQueueã€‚ åœ¨Serverå†…éƒ¨æ˜¯å¯ä»¥æœ‰å¤šä¸ªExchangeå’ŒQueueçš„ã€‚ 2.2 æ ¸å¿ƒç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ2.2.1 æ¶ˆæ¯çš„ç”Ÿå‘½å‘¨æœŸ Publisheräº§ç”Ÿä¸€æ¡æ•°æ®ï¼Œå‘é€åˆ°Brokerã€‚ Brokerä¸­çš„Exchangeæ ¹æ®RoutingKeyæŸ¥è¯¢æŠ•é€’çš„ç›®æ ‡Queueï¼ˆBrokerä»æ¶ˆæ¯å±æ€§ä¸­è·å–Routing Keyï¼Œå¦‚æœä¸èƒ½å®Œæˆè·¯ç”±ä¼šå°†æ¶ˆæ¯ä¸¢å¼ƒæˆ–è¿”å›ç»™ç”Ÿäº§è€…ï¼Œä¸€æ¡æ¶ˆæ¯å¯ä»¥è·¯ç”±åˆ°å¤šä¸ªé˜Ÿåˆ—ï¼‰ã€‚ Consumerå‘Brokerå‘ŠçŸ¥è‡ªå·±ç›‘å¬å“ªä¸ªé˜Ÿåˆ—ï¼Œå½“æœ‰æ•°æ®åˆ°è¾¾Queueï¼ŒBrokerä¼šæ¨é€ç»™Consumerã€‚å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…ï¼Œæ¶ˆæ¯é˜Ÿåˆ—é€šè¿‡AMQPå°†æ¶ˆæ¯è¿”å›ç»™ç”Ÿäº§è€…ã€‚ 2.2.2 äº¤æ¢å™¨çš„ç”Ÿå‘½å‘¨æœŸæ¯å°AMQPæœåŠ¡å™¨éƒ½é¢„å…ˆåˆ›å»ºäº†è®¸å¤šäº¤æ¢å™¨å®ä¾‹ï¼Œå®ƒä»¬åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶å°±å­˜åœ¨å¹¶ä¸”ä¸èƒ½è¢«é”€æ¯ã€‚å¦‚æœä½ çš„åº”ç”¨ç¨‹åºæœ‰ç‰¹æ®Šè¦æ±‚ï¼Œåˆ™å¯ä»¥é€‰æ‹©è‡ªå·±åˆ›å»ºäº¤æ¢å™¨ï¼Œå¹¶åœ¨å®Œæˆå·¥ä½œåè¿›è¡Œé”€æ¯ã€‚ 2.2.3 é˜Ÿåˆ—çš„ç”Ÿå‘½å‘¨æœŸä¸»è¦æœ‰ä¸¤ç§æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå³æŒä¹…åŒ–æ¶ˆæ¯é˜Ÿåˆ—å’Œä¸´æ—¶æ¶ˆæ¯é˜Ÿåˆ—ã€‚æŒä¹…åŒ–æ¶ˆæ¯é˜Ÿåˆ—å¯è¢«å¤šä¸ªæ¶ˆè´¹è€…å…±äº«ï¼Œä¸ç®¡æ˜¯å¦æœ‰æ¶ˆè´¹è€…æ¥æ”¶ï¼Œå®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹å­˜åœ¨ã€‚ä¸´æ—¶æ¶ˆæ¯é˜Ÿåˆ—å¯¹æŸä¸ªæ¶ˆè´¹è€…æ˜¯ç§æœ‰çš„ï¼Œåªèƒ½ç»‘å®šåˆ°æ­¤æ¶ˆè´¹è€…ï¼Œå½“æ¶ˆè´¹è€…æ–­å¼€è¿æ¥æ—¶ï¼Œè¯¥æ¶ˆæ¯é˜Ÿåˆ—å°†è¢«åˆ é™¤ã€‚ 2.3 åŠŸèƒ½å‘½ä»¤AMQPåè®®æ–‡æœ¬æ˜¯åˆ†å±‚æè¿°çš„ï¼Œ0-9ç‰ˆæœ¬åˆ†ä¸ºåŠŸèƒ½å±‚å’Œä¼ è¾“å±‚ã€‚ åŠŸèƒ½å±‚ï¼šå®šä¹‰äº†ä¸€ç³»åˆ—çš„å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤æŒ‰åŠŸèƒ½é€»è¾‘ç»„åˆæˆä¸åŒçš„ç±»ï¼ˆClassï¼‰ï¼Œå®¢æˆ·ç«¯åº”ç”¨å¯ä»¥åˆ©ç”¨å®ƒä»¬æ¥å®ç°è‡ªå·±çš„ä¸šåŠ¡åŠŸèƒ½ã€‚ ä¼ è¾“å±‚ï¼šå°†åŠŸèƒ½å±‚æ¥æ”¶çš„æ¶ˆæ¯ä¼ é€’ç»™æœåŠ¡å™¨ç»è¿‡ç›¸åº”å¤„ç†åå†è¿”å›ï¼Œå¤„ç†çš„äº‹æƒ…åŒ…æ‹¬ä¿¡é“å¤ç”¨ã€å¸§åŒæ­¥ã€å†…å®¹ç¼–ç ã€å¿ƒè·³æ£€æµ‹ã€æ•°æ®è¡¨ç¤ºå’Œé”™è¯¯å¤„ç†ç­‰ã€‚ 0-10ç‰ˆæœ¬åˆ†ä¸ºæ¨¡å‹å±‚ã€ä¼šè¯å±‚å’Œä¼ è¾“å±‚ã€‚ æ¨¡å‹å±‚ï¼šåŸæ¥çš„åŠŸèƒ½å±‚ï¼Œå®šä¹‰äº†ä¸€ç³»åˆ—çš„å‘½ä»¤ï¼Œåˆ©ç”¨å®ƒä»¬æ¥å®ç°ä¸šåŠ¡åŠŸèƒ½ã€‚ ä¼šè¯å±‚ï¼šè´Ÿè´£å°†å‘½ä»¤ä»å®¢æˆ·ç«¯åº”ç”¨ä¼ é€’ç»™æœåŠ¡å™¨ï¼Œå†å°†æœåŠ¡ç«¯çš„å“åº”è¿”å›ç»™å®¢æˆ·ç«¯åº”ç”¨ï¼Œä¼šè¯å±‚ä¸ºè¿™ä¸ªè¿‡ç¨‹æä¾›äº†å¯é æ€§ã€åŒæ­¥æœºåˆ¶å’Œé”™è¯¯å¤„ç†ã€‚ ä¼ è¾“å±‚ï¼šæä¾›ä¿¡é“å¤ç”¨ã€å¸§åŒæ­¥ã€é”™è¯¯æ£€æµ‹å’Œæ•°æ®è¡¨ç¤ºã€‚ 2.4 æ¶ˆæ¯æ•°æ®æ ¼å¼AMQPæ˜¯äºŒè¿›åˆ¶åè®®ï¼Œæ‰€æœ‰çš„æ¶ˆæ¯æ•°æ®è¢«ç»„ç»‡æˆå„ç§ç±»å‹çš„å¸§ï¼Œä»¥0-9-1ç‰ˆæœ¬ä¸ºä¾‹ï¼Œå¸§çš„æ ¼å¼ï¼š å¸§å¤´ï¼ˆheaderï¼Œ7ä¸ªå­—èŠ‚ï¼‰ï¼ŒåŒ…å«å¸§ç±»å‹typeï¼ˆä¸€ä¸ªå­—èŠ‚ï¼‰ã€ä¿¡é“ï¼ˆChannelï¼‰ã€sizeï¼ˆå¸§è´Ÿè½½çš„å¤§å°ï¼‰ å¸§ç±»å‹åŒ…æ‹¬ï¼š 1ï¼Œâ€œMETHODâ€ï¼Œæ–¹æ³•å¸§ 2ï¼Œâ€œHEADERâ€ï¼Œå†…å®¹å¤´å¸§ 3ï¼Œâ€œBODYâ€ï¼Œå†…å®¹ä½“å¸§ 4ï¼Œâ€œHEARTBEATâ€ï¼Œå¿ƒè·³å¸§ ä»»æ„å¤§å°çš„å¸§è´Ÿè½½ï¼ˆæ ¼å¼ä¾èµ–äºå¸§ç±»å‹ï¼‰ 2.5 äº¤æ¢å™¨ç±»å‹ä¸åŒç±»å‹çš„äº¤æ¢å™¨åˆ†å‘æ¶ˆæ¯çš„ç­–ç•¥æ˜¯ä¸åŒçš„ï¼Œç›®å‰äº¤æ¢å™¨æœ‰å››ç§ç±»å‹ï¼šDirectï¼ŒFanoutï¼ŒTopicï¼ŒHeadersï¼Œå…¶ä¸­HeadersåŸºæœ¬ä¸ç”¨äº†ã€‚ 2.5.1 Directäº¤æ¢å™¨å¦‚æœæ¶ˆæ¯ä¸­çš„è·¯ç”±é”®å’ŒBindingä¸­çš„ç»‘å®šé”®ä¸€è‡´ï¼Œäº¤æ¢å™¨å°±æŠŠæ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—ä¸­ã€‚ 2.5.2 Fanoutäº¤æ¢å™¨Fanoutäº¤æ¢å™¨ä¸å¤„ç†è·¯ç”±é”®ï¼Œå®ƒæŠŠæ¶ˆæ¯è½¬å‘ç»™æ‰€æœ‰ä¸å…¶ç»‘å®šçš„é˜Ÿåˆ—ï¼Œç±»ä¼¼äºå­ç½‘è½¬å‘ã€‚ 2.5.3 Topicäº¤æ¢å™¨Topicäº¤æ¢å™¨é€šè¿‡æ¨¡å¼åŒ¹é…åˆ†é…æ¶ˆæ¯çš„è·¯ç”±é”®å±æ€§ï¼Œå°†è·¯ç”±é”®å’ŒæŸç§æ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œæ¯ä¸ªé˜Ÿåˆ—éƒ½ç»‘å®šäº†ä¸€ç§æ¨¡å¼ï¼Œæœ‰ä¸¤ç§é€šé…ç¬¦ï¼šâ€œ#â€åŒ¹é…0ä¸ªæˆ–å¤šä¸ªå•è¯ï¼Œâ€œ*â€åŒ¹é…ä¸€ä¸ªå•è¯ 3 RabbitMQä½¿ç”¨RabbitMQçš„å®‰è£…è¿™é‡Œä¸åšä»‹ç»ã€‚ï¼ˆä¸å¤ªä¼šï¼‰ é»˜è®¤ç«¯å£å·5672 å¯åŠ¨RabbitMQæœåŠ¡ï¼šrabbitmq-server start &amp; æœåŠ¡çš„åœæ­¢ï¼šrabbitmqctl stop_app å¯ç”¨ç½‘é¡µå¯è§†åŒ–ç®¡ç†æ’ä»¶ï¼š rabbitmq-plugins enable rabbitmq_management å®‰è£…å®Œä¹‹ååœ¨/usr/lib/rabbitmq/lib/rabbitmq_server-3.6.5/ebinä¸‹é¢æ›´æ”¹rabbit.appä¸­çš„loop_usersï¼ŒæŠŠ[]é‡Œé¢çš„å†…å®¹å»æ‰ã€‚ï¼ˆé»˜è®¤ç”¨æˆ·æ˜¯guestï¼Œå¯†ç guestï¼Œè¿™é‡Œå…è®¸guestè¿œç¨‹è®¿é—®ï¼Œæˆ–è€…ä½ æ·»åŠ ä¸€ä¸ªç”¨æˆ·ï¼Œèµ‹äºˆæƒé™ï¼‰ è®¿é—®åœ°å€ï¼šhttp://localhost:15672/ 3.1 å‘½ä»¤è¡Œæ“ä½œrabbitmqctl stop_appï¼šå…³é—­åº”ç”¨ rabbitmqctl start_appï¼šå¼€å¯åº”ç”¨ rabbitmqctl statusï¼šèŠ‚ç‚¹çŠ¶æ€ rabbitmqctl add_user username passwordï¼šæ·»åŠ ç”¨æˆ· rabbitmqctl change_password username newpasswordï¼šä¿®æ”¹å¯†ç  rabbitmqctl list_usersï¼šåˆ—å‡ºæ‰€æœ‰ç”¨æˆ· rabbitmqctl delete_user usernameï¼šåˆ é™¤ç”¨æˆ· rabbitmqctl list_user_permissions usernameï¼šåˆ—å‡ºç”¨æˆ·æƒé™ rabbitmqctl clear_permissions -p vhostpath usernameï¼šæ¸…é™¤ç”¨æˆ·æƒé™ rabbitmqctl set_permissions -p vhostpath username &quot;.*&quot; &quot;.*&quot; &quot;. *&quot;ï¼šæ¸…é™¤ç”¨æˆ·æƒé™ rabbitmqctl add_vhost vhostpathï¼šåˆ›å»ºè™šæ‹Ÿä¸»æœº rabbitmqctl delete_vhost vhostpathï¼šåˆ é™¤è™šæ‹Ÿä¸»æœº rabbitmqctl list_vhostsï¼šåˆ—å‡ºæ‰€æœ‰è™šæ‹Ÿä¸»æœº rabbitmqctl list_permissions -p vhostpathï¼šåˆ—å‡ºè™šæ‹Ÿä¸»æœºæƒé™ rabbitmqctl list_queuesï¼šæŸ¥çœ‹æ‰€æœ‰é˜Ÿåˆ—ä¿¡æ¯ rabbitmqctl -p vhostpath purge_queue blueï¼šæ¸…é™¤é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯ rabbitmqctl resetï¼šç§»é™¤æ‰€æœ‰æ•°æ®ï¼Œè¦åœ¨rabbitmqctl stop_appä¹‹åä½¿ç”¨ 3.2 AMQP-clinetä½¿ç”¨mavenä¾èµ–ï¼š &lt;dependency> &lt;groupId>com.rabbitmq&lt;/groupId> &lt;artifactId>amqp-client&lt;/artifactId> &lt;version>5.6.0&lt;/version> &lt;/dependency> è¿™é‡Œçš„AMQPæŒ‡çš„æ˜¯ä¸€å¥—æ“æ§rabbitMQçš„APIï¼Œç±»ä¼¼äºJMS éœ€è¦æ³¨æ„çš„æ˜¯JMSéœ€è¦é€šè¿‡sessionå»åˆ›å»ºæ¶ˆè´¹è€…å’Œç”Ÿäº§è€…ï¼ŒAMQPåªéœ€è¦é€šè¿‡channelå»åˆ›å»ºæ¶ˆè´¹è€…ã€‚ public class Producer { public static void main(String[] args) throws IOException, TimeoutException { //1.åˆ›å»ºä¸€ä¸ªConnectionFactory ConnectionFactory connectionFactory = new ConnectionFactory(); connectionFactory.setHost(\"127.0.0.1\"); connectionFactory.setPort(5672); connectionFactory.setUsername(\"guest\"); connectionFactory.setPassword(\"guest\"); connectionFactory.setVirtualHost(\"/\"); //2.åˆ›å»ºä¸€ä¸ªè¿æ¥ Connection connection = connectionFactory.newConnection(); //3.é€šè¿‡connectionåˆ›å»ºä¸€ä¸ªChannel Channel channel = connection.createChannel(); for (int i=0;i&lt;5;i++) { String msg = \"Hello RabbitMQ!\"; //4.é€šè¿‡Channelå‘é€æ•°æ®ï¼Œå››ä¸ªå‚æ•°ï¼šexchangeï¼ŒroutingKeyï¼Œpropsï¼Œbody channel.basicPublish(\"\",\"test001\",null,msg.getBytes()); } //5. å…³é—­è¿æ¥ channel.close(); connection.close(); } } public class Comsumer { public static void main(String[] args) throws IOException, TimeoutException { //1.åˆ›å»ºä¸€ä¸ªConnectionFactory ConnectionFactory connectionFactory = new ConnectionFactory(); connectionFactory.setHost(\"127.0.0.1\"); connectionFactory.setPort(5672); connectionFactory.setUsername(\"guest\"); connectionFactory.setPassword(\"guest\"); connectionFactory.setVirtualHost(\"/\"); //2.åˆ›å»ºä¸€ä¸ªè¿æ¥ Connection connection = connectionFactory.newConnection(); //3.é€šè¿‡connectionåˆ›å»ºä¸€ä¸ªChannel Channel channel = connection.createChannel(); //4.å£°æ˜ä¸€ä¸ªé˜Ÿåˆ— String queueName = \"test001\"; //äº”ä¸ªå‚æ•°ï¼šqueueé˜Ÿåˆ—åã€durableæ˜¯å¦æŒä¹…åŒ–ã€exclusiveä¿è¯é¡ºåºç‹¬å é” //autoDeleteå¦‚æœé˜Ÿåˆ—ä¸å†è¢«ä½¿ç”¨ï¼ˆç»‘å®šï¼‰å°±è‡ªåŠ¨åˆ é™¤ã€argumentsé™„å¸¦çš„å‚æ•° channel.queueDeclare(queueName,true,false, false, null); //5.åˆ›å»ºæ¶ˆè´¹è€… com.rabbitmq.client.Consumer consumer = new DefaultConsumer(channel) { @Override //æ¶ˆè´¹æ¶ˆæ¯ public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException { String routingKey = envelope.getRoutingKey(); String contentType = properties.getContentType(); System.out.println(\"æ¶ˆè´¹çš„è·¯ç”±é”®ï¼š\"+routingKey); System.out.println(\"æ¶ˆè´¹çš„å†…å®¹ç±»å‹ï¼š\"+contentType); long deliveryTag = envelope.getDeliveryTag(); // ç¡®è®¤æ¶ˆæ¯ channel.basicAck(deliveryTag, false); System.out.println(\"æ¶ˆè´¹çš„æ¶ˆæ¯ä½“å†…å®¹ï¼š\"); String bodyStr = new String(body,\"UTF-8\"); System.out.println(bodyStr); } }; // 6.è®¾ç½®Channelï¼Œä¸‰ä¸ªå‚æ•°ï¼šqueueé˜Ÿåˆ—åï¼ŒautoAckè‡ªåŠ¨ç­¾æ”¶ï¼ŒCallbackä¸€ä¸ªConsumerå¯¹è±¡ channel.basicConsume(queueName,false,consumer); } } è¦æ³¨æ„amqp-clientè€ç‰ˆæœ¬æœ‰ä¸€ä¸ªQueueingConsumerï¼Œä¼šé€ æˆå†…å­˜æº¢å‡ºï¼Œå·²ç»è¢«åºŸå¼ƒäº†ã€‚ åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œç”Ÿäº§è€…çš„basicPublishæ²¡æœ‰æŒ‡å®šä»»ä½•äº¤æ¢å™¨ï¼Œæ­¤æ—¶ä½¿ç”¨çš„æ˜¯é»˜è®¤äº¤æ¢å™¨AMQP DEFAULTï¼Œæ­¤äº¤æ¢å™¨é»˜è®¤ç»‘å®šæ‰€æœ‰é˜Ÿåˆ—ï¼Œä¼ routingKeyç»™å®ƒçš„æ—¶å€™ï¼Œå®ƒä¼šæ‰¾æœ‰æ²¡æœ‰é˜Ÿåˆ—åå’Œè¯¥keyç›¸åŒçš„é˜Ÿåˆ—ï¼Œæœ‰åˆ™è·¯ç”±æ¶ˆæ¯ç»™è¯¥é˜Ÿåˆ—ã€‚ å…¶ä»–ç›¸å…³APIï¼š // å£°æ˜äº¤æ¢æœºï¼Œåé¢ä¸¤ä¸ªå‚æ•°å¯çœç•¥ï¼Œç¬¬äºŒä¸ªå‚æ•°å£°æ˜ç±»å‹ï¼Œå‚è€ƒä¸Šé¢å…³äºäº¤æ¢å™¨ç±»å‹çš„ä»‹ç» channel.exchangeDeclare(String exchange, String type, boolean durable, boolean autoDelete); // ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœºï¼Œä¸ºé˜Ÿåˆ—åˆ†é…ä¸€ä¸ªkey channel.queueBind(String queue, String exchange, String routingKey); Exchangeé™¤äº†å’ŒQueueç»‘å®šï¼Œè¿˜å¯ä»¥å’Œå¦ä¸€ä¸ªExchangeè¿›è¡Œç»‘å®šï¼Œå°±å¯ä»¥æŠŠæ¶ˆæ¯ç»å¤šæ¬¡è·¯ç”±ã€‚ //destinationè¢«ç»‘å®šçš„äº¤æ¢æœºï¼Œsourceå‘èµ·ç»‘å®šçš„äº¤æ¢æœº channel.exchangeBind(String destination, String source, String routingKey) throws IOException; æ¶ˆæ¯ç”±Propertieså’ŒPayloadç»„æˆï¼ŒPayloadå°±æ˜¯æ¶ˆæ¯ä½“ï¼Œè€ŒPropertiesåŒ…å«ï¼š Delivery modeï¼šæ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ï¼Œ1ï¼šå¦ï¼Œ2ï¼šæ˜¯ Headersï¼šå¤´ä¿¡æ¯ï¼Œæ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªé”®å€¼å¯¹ç»„æˆçš„ è¿˜åŒ…å«ä¸€äº›é¢„å®šä¹‰å±æ€§ï¼Œå¦‚ä¸‹ï¼š content_typeï¼šæ¶ˆæ¯ç±»å‹ content_encoding:æ¶ˆæ¯ç¼–ç  priorityï¼šæ¶ˆæ¯ä¼˜å…ˆçº§ï¼ˆ0-9ï¼‰ï¼Œä½†ä¸ä¿è¯éµä» message-idå’Œcorrelation-idï¼šè¡¨ç¤ºå”¯ä¸€æ¶ˆæ¯æ ‡è¯†å’Œæ¶ˆæ¯å“åº”æ ‡è¯†ï¼Œç”¨äºåœ¨å·¥ä½œæµç¨‹ä¸­å®ç°æ¶ˆæ¯è·Ÿè¸ª timestampï¼šè¡¨ç¤ºæ¶ˆæ¯åˆ›å»ºæ—¶é—´ expirationï¼šè¡¨ç¤ºæ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ reply-toï¼šå®ç°å“åº”æ¶ˆæ¯çš„è·¯ç”±ï¼ˆæ„å»ºä¸€ä¸ªç”¨æ¥æ¢å¤æ¶ˆæ¯çš„ç§æœ‰å“åº”é˜Ÿåˆ—ï¼‰ Javaç¤ºä¾‹ï¼ŒæŠŠæ¶ˆæ¯å±æ€§ä¼ å…¥ï¼š Map&lt;String,Object> headers = new HashMap&lt;>(); headers.put(\"my1\", \"111\"); headers.put(\"my2\", \"222\"); //å®šä¹‰å±æ€§ AMQP.BasicProperties properties = new AMQP.BasicProperties.Builder() .deliveryMode(2) .contentEncoding(\"UTF-8\") .expiration(\"10000\") .headers(headers) .build(); String msg = \"Hello RabbitMQ!\"; channel.basicPublish(\"\",\"test001\",properties,msg.getBytes());","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"æ¶ˆæ¯é˜Ÿåˆ—","slug":"æ¶ˆæ¯é˜Ÿåˆ—","permalink":"https://www.codetool.top/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"},{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"https://www.codetool.top/tags/RabbitMQ/"}]},{"title":"æ¶ˆæ¯é˜Ÿåˆ—æ¦‚è¿°ä¸JMSä½¿ç”¨","slug":"æ¶ˆæ¯é˜Ÿåˆ—æ¦‚è¿°ä¸JMSä½¿ç”¨","date":"2020-03-12T08:38:35.000Z","updated":"2020-03-12T09:03:08.660Z","comments":true,"path":"article/æ¶ˆæ¯é˜Ÿåˆ—æ¦‚è¿°ä¸JMSä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E6%A6%82%E8%BF%B0%E4%B8%8EJMS%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 ç³»ç»Ÿé—´é€šä¿¡æ¦‚è¿°ä¸€èˆ¬æ¥è¯´ï¼Œå¤§å‹åº”ç”¨é€šå¸¸ä¼šè¢«æ‹†åˆ†æˆå¤šä¸ªå­ç³»ç»Ÿï¼Œè¿™äº›å­ç³»ç»Ÿå¯èƒ½ä¼šéƒ¨ç½²åœ¨å¤šå°æœºå™¨ä¸Šï¼Œä¹Ÿå¯èƒ½åªæ˜¯ä¸€å°æœºå™¨çš„å¤šä¸ªè¿›ç¨‹ä¸­ï¼Œè¿™æ ·çš„åº”ç”¨å°±æ˜¯åˆ†å¸ƒå¼åº”ç”¨ã€‚è€Œåˆ†å¸ƒå¼åº”ç”¨çš„å­ç³»ç»Ÿä¹‹é—´å¹¶ä¸æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œå®ƒä»¬éœ€è¦ç›¸äº’é€šä¿¡æ¥å…±åŒå®ŒæˆæŸä¸ªåŠŸèƒ½ï¼Œè¿™å°±æ¶‰åŠç³»ç»Ÿé—´é€šä¿¡äº†ã€‚ é€šå¸¸æœ‰ä¸¤ç§æ–¹å¼æ¥å®ç°ç³»ç»Ÿé—´é€šä¿¡ï¼Œä¸€ç§æ˜¯åŸºäºè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰çš„æ–¹å¼ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“è°ƒç”¨çš„å…·ä½“å®ç°ç»†èŠ‚ï¼Œåªéœ€ç›´æ¥è°ƒç”¨å®é™…å­˜åœ¨äºè¿œç¨‹è®¡ç®—æœºä¸Šçš„æŸä¸ªå¯¹è±¡å³å¯ï¼Œä½†è°ƒç”¨æ–¹å¼çœ‹èµ·æ¥å’Œè°ƒç”¨æœ¬åœ°åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡ä¸€æ ·ã€‚å…¸å‹çš„RPCå®ç°åŒ…æ‹¬Dubboã€Thriftã€GRPCç­‰ï¼Œç”šè‡³Rest APIã€‚ å¦ä¸€ç§æ˜¯åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼ã€‚æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼æ˜¯æŒ‡ç”±åº”ç”¨ä¸­çš„æŸä¸ªç³»ç»Ÿè´Ÿè´£å‘é€ä¿¡æ¯ï¼Œç”±å…³å¿ƒè¿™æ¡æ¶ˆæ¯çš„ç›¸åº”ç³»ç»Ÿè´Ÿè´£æ¥æ”¶æ¶ˆæ¯ï¼Œå¹¶åœ¨æ”¶åˆ°æ¶ˆæ¯åè¿›è¡Œå„è‡ªç³»ç»Ÿå†…çš„ä¸šåŠ¡å¤„ç†ã€‚æ¶ˆæ¯å¯ä»¥éå¸¸ç®€å•ï¼Œæ¯”å¦‚åªåŒ…å«æ–‡æœ¬å­—ç¬¦ä¸²;ä¹Ÿå¯ä»¥å¾ˆå¤æ‚ï¼Œæ¯”å¦‚åŒ…å«å­—èŠ‚æµã€å­—èŠ‚æ•°ç»„ï¼Œè¿˜å¯èƒ½åŒ…å«åµŒå…¥å¯¹è±¡ï¼Œç”šè‡³æ˜¯Javaå¯¹è±¡(ç»è¿‡åºåˆ—åŒ–çš„å¯¹è±¡)ã€‚ æ¶ˆæ¯å‘å¸ƒè€…åªè´Ÿè´£å°†æ¶ˆæ¯å‘å¸ƒåˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆæ¯ä½¿ç”¨è€…åªè´Ÿè´£ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–æ¶ˆæ¯ï¼Œç”±æ¶ˆæ¯é˜Ÿåˆ—æ¥è´Ÿè´£æ¶ˆæ¯çš„ä¼ é€’ï¼Œè¿™æ ·å‘å¸ƒè€…å’Œä½¿ç”¨è€…éƒ½ä¸ç”¨çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ã€‚ 2 æ¶ˆæ¯é˜Ÿåˆ—æ¦‚è¿°2.1 ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—2.1.1 è§£è€¦å„æ¨¡å—ä¹‹é—´å¦‚æœå­˜åœ¨äº’ç›¸è°ƒç”¨çš„å…³ç³»ï¼Œåº”å°½å¯èƒ½è§£è€¦åˆï¼Œæ¶ˆæ¯é˜Ÿåˆ—å°±æ˜¯åœ¨æ¨¡å—ä¹‹é—´å¢åŠ äº†ä¸€ä¸ªä¸­é—´å±‚æ¥å®ç°è§£è€¦ï¼Œä½¿ä»»ä½•ä¸€ä¸ªæ¨¡å—åªå…³å¿ƒè‡ªå·±çš„æ ¸å¿ƒæµç¨‹ï¼Œä¸å¿…å…³æ³¨æ•°æ®æ¥æºæˆ–ç»“æœã€‚ 2.1.2 æµé‡å‰Šå³°åœ¨ç³»ç»Ÿè¿è¡Œä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°æŸä¸€æ—¶åˆ»ç½‘ç«™è¯·æ±‚é‡çˆ†æ¶¨ï¼ˆä¾‹å¦‚ä¸šåŠ¡æ´»åŠ¨æˆ–DDosæ”»å‡»ï¼‰ï¼Œå¾ˆéš¾åœ¨åŒä¸€æ—¶åˆ»å¤„ç†è¿™ä¹ˆå¤šè¯·æ±‚ï¼Œå¦‚æœå¤„ç†ä¸å½“ç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§å‹åŠ›å¯èƒ½ä¼šå¯¼è‡´é›ªå´©æ•ˆåº”ã€‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å°†çŸ­æ—¶é—´é«˜å¹¶å‘çš„è¯·æ±‚æŒä¹…åŒ–ï¼Œç„¶åé€æ­¥å¤„ç†ï¼Œä»è€Œæ”¹å–„ç³»ç»Ÿæ€§èƒ½ã€‚ 2.1.3 å¼‚æ­¥å¾ˆå¤šå…¬å¸ä¼šæ„å»ºä¸€ä¸ªæ—¥å¿—æ”¶é›†ç³»ç»Ÿï¼Œç”±å®ƒæ¥ç»Ÿä¸€æ”¶é›†ä¸šåŠ¡æ—¥å¿—æ•°æ®ï¼Œä¾›ç¦»çº¿å’Œåœ¨çº¿çš„åˆ†æç³»ç»Ÿä½¿ç”¨ã€‚å¦‚æœæ¯ä¸ªä¸šåŠ¡å¤„ç†è¯·æ±‚åéƒ½åŒæ­¥å¤„ç†å†™æ—¥å¿—ï¼Œå¯èƒ½ä¼šé€ æˆå»¶è¿Ÿï¼Œç”šè‡³å‡ºç°å¼‚å¸¸ä¼šå½±å“ä¸šåŠ¡æœåŠ¡é˜»å¡ï¼Œè¿™æ—¶å€™å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å¼‚æ­¥å¤„ç†æ—¥å¿—æ¶ˆæ¯ã€‚ 2.1.4 åˆ†å¸ƒå¼äº‹åŠ¡åœ¨å¤§å‹ç³»ç»Ÿä¸­æ•°æ®åº“å¯èƒ½ä¼šåˆ†åº“åˆ†è¡¨ï¼Œåˆ†å¸ƒåœ¨å¤šå°æœåŠ¡å™¨ä¸Šï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡æ¶‰åŠå¤šå¼ è¡¨ã€ç”šè‡³æ˜¯å¤šä¸ªåº“åˆ†å¸ƒåœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œå¦‚ä½•å¤„ç†è¿™ä¸ªäº‹åŠ¡å‘¢ï¼Ÿä¸€ç§æ–¹æ³•æ˜¯ä¸šç•Œå¼•å…¥çš„ä¸€ä¸ªå¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„è§„èŒƒâ€”â€”XAï¼ˆå…¨å±€äº‹åŠ¡ç®¡ç†å™¨ï¼‰ï¼Œå®ƒåœ¨äº‹åŠ¡ç®¡ç†å™¨å’Œèµ„æºç®¡ç†å™¨ä¹‹é—´å½¢æˆé€šä¿¡æ¡¥æ¢ï¼Œç›®å‰ä¸»æµæ•°æ®åº“éƒ½æä¾›å¯¹XAè§„èŒƒçš„æ”¯æŒã€‚ ä½†XAçš„é—®é¢˜æ˜¯æ€§èƒ½ä¸ç®—å¾ˆå¥½ï¼Œæ‰€ä»¥é€šå¸¸ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡çš„æœ¬è´¨æ˜¯ç³»ç»Ÿé—´çš„é€šä¿¡ï¼Œé…åˆäº‹ä»¶è¡¨èƒ½å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå…·ä½“å®ç°è¿™é‡Œä¸åšè¯¦è¿°ã€‚ 2.2 æ¶ˆæ¯é˜Ÿåˆ—çš„ç‰¹ç‚¹æ¶ˆæ¯é˜Ÿåˆ—çš„æ€æƒ³å°±æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼Œç»„æˆå°±æ˜¯ç”Ÿäº§è€…ã€é˜»å¡é˜Ÿåˆ—ã€æ¶ˆè´¹è€…ï¼Œå…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯é˜»å¡é˜Ÿåˆ—ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿå°±æ˜¯ä¸€ç§é˜»å¡é˜Ÿåˆ—ï¼ŒJDKä¸­ä¹Ÿå­˜åœ¨ä¸å°‘è¯¥æ¨¡å¼ä½“ç°ï¼Œä¾‹å¦‚çº¿ç¨‹æ± ä¸­å°±ä½¿ç”¨äº†BlockingQueueï¼Œå…³äºJDKä¸­çš„BlockingQueueä¹‹å‰ä¹Ÿå†™è¿‡ä¸€ç¯‡åšå®¢ç ”ç©¶ï¼Œå¯ä»¥å‚è€ƒé˜»å¡é˜Ÿåˆ—BlockingQueueè¯¦è§£ è€Œç”Ÿäº§ç¯å¢ƒä¸‹è¦æ±‚çš„æ¶ˆæ¯é˜Ÿåˆ—å°±ä¸æ­¢JDKä¸­çš„BlockingQueueè¿™ä¹ˆç®€å•äº†ï¼Œåœ¨ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—äº§å“èƒ½è§£å†³è¯¸å¦‚æ¶ˆæ¯å †ç§¯ã€æ¶ˆæ¯æŒä¹…åŒ–ã€å¯é æŠ•é€’ã€æ¶ˆæ¯é‡å¤ã€ä¸¥æ ¼æœ‰åºã€é›†ç¾¤ç­‰å„ç§é—®é¢˜ã€‚ 2.2.1 æ¶ˆæ¯å †ç§¯å› ä¸ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ˜¯ä¸¤ä¸ªåˆ†å¼€å¤„ç†æ¶ˆæ¯çš„ç³»ç»Ÿï¼Œæ— æ³•é¢„çŸ¥ä¸¤è€…å¯¹æ¶ˆæ¯å¤„ç†é€Ÿåº¦çš„å¿«æ…¢ï¼Œä¸€æ—¦åœ¨æŸä¸ªæ—¶é—´æ®µæ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯çš„é€Ÿåº¦æ²¡æœ‰è·Ÿä¸Šç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„é€Ÿåº¦ï¼Œå¿…å°†å¯¼è‡´æ¶ˆæ¯åœ¨å¤„ç†ä¸­å¿ƒé€æ¸ç§¯å‹è€Œå¾—ä¸åˆ°é‡Šæ”¾ã€‚å› æ­¤ï¼Œæœ‰æ—¶éœ€è¦ç»™æ¶ˆæ¯é˜Ÿåˆ—è®¾ç½®ä¸€ä¸ªé˜ˆå€¼ï¼Œå°†è¶…è¿‡é˜ˆå€¼çš„æ¶ˆæ¯ä¸å†æ”¾å…¥å¤„ç†ï¼Œä»¥é˜²æ­¢ç³»ç»Ÿèµ„æºè¢«è€—å°½ï¼Œå¯¼è‡´æœºå™¨æŒ‚æ‰ç”šè‡³æ•´ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸å¯ç”¨ã€‚è¿™å°±ç±»ä¼¼äºJDKä¸­çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ã€‚ 2.2.2 æ¶ˆæ¯æŒä¹…åŒ–åœ¨æ¶ˆæ¯è¢«æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—åéœ€è¦å°†æ¶ˆæ¯æš‚å­˜ä¸‹æ¥ï¼Œæ¶ˆæ¯æš‚å­˜å¯ä»¥é€‰æ‹©å°†æ¶ˆæ¯æ”¾åœ¨å†…å­˜ä¸­ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æ”¾åˆ°æ–‡ä»¶ã€æ•°æ®åº“ç­‰åœ°æ–¹ã€‚å°†æ¶ˆæ¯æ”¾åœ¨å†…å­˜ä¸­å­˜åœ¨çš„æœ€å¤§é—®é¢˜æ˜¯ï¼Œä¸€æ—¦æœºå™¨å®•æ‰æ¶ˆæ¯å°†ä¸¢å¤±ã€‚å¦‚æœåœºæ™¯éœ€è¦æ¶ˆæ¯ä¸èƒ½ä¸¢å¤±ï¼Œé‚£ä¹ˆåŠ¿å¿…è¦å°†æ¶ˆæ¯æŒä¹…åŒ–ã€‚æŒä¹…åŒ–æ–¹æ¡ˆæœ‰å¾ˆå¤šç§, æ¯”å¦‚å°†æ¶ˆæ¯å­˜åˆ°æœ¬åœ°æ–‡ä»¶ã€åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€æ•°æ®åº“ç³»ç»Ÿä¸­ç­‰ã€‚ 2.2.3 å¯é æŠ•é€’æœ‰äº›åœºæ™¯å¿…é¡»ä¿è¯æ¶ˆæ¯ä¸èƒ½ä¸¢å¤±ã€‚è¿™ç§æƒ…å†µå¯èƒ½å‘ç”Ÿåœ¨å‡ºç°ç½‘ç»œé—®é¢˜ã€ç³»ç»Ÿå®•æœºç­‰æƒ…å†µä¸‹ã€‚ 2.2.4 æ¶ˆæ¯é‡å¤æœ‰äº›æ¶ˆæ¯é˜Ÿåˆ—ä¸ºäº†æ”¯æŒæ¶ˆæ¯å¯é æŠ•é€’ï¼Œä¼šé€‰æ‹©åœ¨æ¥æ”¶åˆ°æ¶ˆæ¯åå…ˆæŒä¹…åŒ–åˆ°æœ¬åœ°ï¼Œç„¶åå‘é€ç»™æ¶ˆè´¹è€…ã€‚å½“æ¶ˆæ¯å‘é€å¤±è´¥æˆ–è€…ä¸çŸ¥é“æ˜¯å¦å‘é€æˆåŠŸæ—¶(æ¯”å¦‚è¶…æ—¶)ï¼Œæ¶ˆæ¯çš„çŠ¶æ€æ˜¯å¾…å‘é€ï¼Œå®šæ—¶ä»»åŠ¡ä¸åœåœ°è½®è¯¢æ‰€æœ‰çš„å¾…å‘é€æ¶ˆæ¯ï¼Œæœ€ç»ˆä¿è¯æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼Œè¿™å°±å¸¦æ¥äº†æ¶ˆæ¯å¯èƒ½ä¼šé‡å¤çš„é—®é¢˜ã€‚ 2.2.5 ä¸¥æ ¼æœ‰åºåœ¨æŸäº›åœºæ™¯ä¸­ä¼šæœ‰éœ€è¦æŒ‰ç…§ç”Ÿäº§æ¶ˆæ¯çš„é¡ºåºæ¥æ¶ˆè´¹çš„æƒ…å½¢,è¿™å°±è¦æ¶ˆæ¯é˜Ÿåˆ—æä¾›æœ‰åºæ¶ˆæ¯çš„ä¿è¯. 2.2.6 é›†ç¾¤æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨ä¹Ÿå¯èƒ½å‡ºç°å®•æœºé—®é¢˜ï¼Œè¦ä¿è¯é«˜å¯ç”¨éœ€è¦é›†ç¾¤æ”¯æŒã€‚ 2.3 æ¶ˆæ¯é˜Ÿåˆ—åè®®å¸¸è§çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼šRabbitMQ, ActiveMQ, Kafka, RocketMQ æ¶ˆæ¯é˜Ÿåˆ—çš„è§„èŒƒåè®®æœ‰AMQPã€MQTTã€STOMPã€XMPPå››ç§ï¼Œè¿™äº›åè®®æ˜¯ç±»ä¼¼äºHTTPçš„æ¯”è¾ƒåº•å±‚çš„é€šä¿¡åè®®ï¼Œè€ŒJavaå¼•å…¥äº†JMSï¼ˆJava Message Serviceï¼ŒJavaæ¶ˆæ¯æœåŠ¡ï¼‰ä¸ºè¿™äº›åè®®æä¾›äº†æ›´é«˜ä¸€å±‚çš„æŠ½è±¡ï¼Œç»™Javaå¼€å‘è€…æä¾›äº†ä¸€ä¸ªä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä¸€è‡´çš„æ¥å£ã€‚ä¸‹é¢ä¸»è¦ä»‹ç»JMSçš„ä½“ç³»æ¨¡å‹ã€‚ 2.3.1 JMSç‚¹å¯¹ç‚¹æ¨¡å‹JMSæŒ‰å…¶è§„èŒƒåˆ†ä¸ºç‚¹å¯¹ç‚¹(Point-to-Point)å’Œå‘å¸ƒè®¢é˜…(Publish/Subscribe)ä¸¤ç§å½¢å¼ã€‚ç‚¹å¯¹ç‚¹å°±æ˜¯å°†ä¸€ä¸ªç³»ç»Ÿçš„æ¶ˆæ¯å‘å¸ƒåˆ°æŒ‡å®šçš„å¦å¤–ä¸€ä¸ªç³»ç»Ÿï¼Œè¿™æ ·å¦å¤–ä¸€ä¸ªç³»ç»Ÿå°±èƒ½è·å¾—æ¶ˆæ¯ï¼Œä»è€Œå¤„ç†å¯¹åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚ æ³¨æ„ç‚¹å¯¹ç‚¹æ¨¡å‹åœ¨JMSä¸­ä½“ç°ä¸ºQueueConneciton ç‚¹å¯¹ç‚¹æ¨¡å‹çš„ç‰¹ç‚¹ï¼š æ¯æ¡æ¶ˆæ¯åªæœ‰ä¸€ä¸ªæ¥æ”¶è€…ï¼Œæ¶ˆæ¯ä¸€æ—¦è¢«æ¥æ”¶å°±ä¸å†ä¿ç•™åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­äº†ã€‚ä¸€ä¸ªé˜Ÿåˆ—ä¸­å¯èƒ½ä¼šæœ‰å¤šä¸ªæ¥æ”¶è€…åœ¨ç›‘å¬ï¼Œä½†æ˜¯æ¶ˆæ¯åªèƒ½è¢«é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªæ¥æ”¶è€…æ¥æ”¶ã€‚ å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´åœ¨æ—¶é—´ä¸Šæ²¡æœ‰ä¾èµ–ï¼Œå½“æ¶ˆæ¯è¢«å‘é€ä¹‹åï¼Œä¸ç®¡æ¥æ”¶è€…æœ‰æ²¡æœ‰åœ¨è¿è¡Œï¼Œéƒ½ä¸ä¼šå½±å“æ¶ˆæ¯è¢«å‘é€åˆ°é˜Ÿåˆ—ä¸­ æ¶ˆæ¯å­˜åœ¨å…ˆåé¡ºåºã€‚ä¸€ä¸ªé˜Ÿåˆ—ä¼šæŒ‰ç…§æ¶ˆæ¯æœåŠ¡å™¨å°†æ¶ˆæ¯æ”¾å…¥é˜Ÿåˆ—ä¸­çš„é¡ºåºæŠŠå®ƒä»¬ä¼ é€ç»™æ¥æ”¶è€…ã€‚å½“æ¶ˆæ¯å·²ç»è¢«æ¥æ”¶æ—¶å°±ä¼šä»é˜Ÿåˆ—å¤´éƒ¨å°†å®ƒä»¬åˆ é™¤(é™¤éä½¿ç”¨äº†æ¶ˆæ¯ä¼˜å…ˆçº§)ã€‚ å½“æ¥æ”¶è€…æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œä¼šå‘é€ç¡®è®¤æ”¶åˆ°é€šçŸ¥ã€‚ 2.3.2 JMSå‘å¸ƒ/è®¢é˜…æ¨¡å‹å‘å¸ƒè®¢é˜…æ¨¡å¼æ˜¯ä¸€ä¸ªç³»ç»Ÿçº¦å®šå°†æ¶ˆæ¯å‘å¸ƒåˆ°ä¸€ä¸ªä¸»é¢˜(Topic)ä¸­ï¼Œç„¶åå„ä¸ªç³»ç»Ÿå°±èƒ½å¤Ÿé€šè¿‡è®¢é˜…è¿™ä¸ªä¸»é¢˜ï¼Œæ ¹æ®å‘é€è¿‡æ¥çš„ä¿¡æ¯å¤„ç†å¯¹åº”çš„ä¸šåŠ¡ã€‚åœ¨æ›´å¤šçš„æ—¶å€™ï¼Œå¼€å‘è€…å¾€å¾€æ›´å¤šåœ°ä½¿ç”¨å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œå› ä¸ºå¯ä»¥è¿›è¡Œæ›´å¤šçš„æ‰©å±•ï¼Œä½¿å¾—æ›´å¤šçš„ç³»ç»Ÿèƒ½å¤Ÿç›‘æ§å¾—åˆ°æ¶ˆæ¯ã€‚ æ³¨æ„ç‚¹å¯¹ç‚¹æ¨¡å‹åœ¨JMSä¸­ä½“ç°ä¸ºTopicConneciton å‘å¸ƒ/è®¢é˜…æ¨¡å‹çš„ç‰¹ç‚¹ï¼š æ¯æ¡æ¶ˆæ¯å¯ä»¥æœ‰å¤šä¸ªè®¢é˜…è€…ã€‚ å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´æœ‰æ—¶é—´ä¸Šçš„ä¾èµ–ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒæŸä¸ªä¸»é¢˜çš„è®¢é˜…è€…éœ€è¦åœ¨åˆ›å»ºäº†è®¢é˜…ä¹‹åæ‰èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œè€Œä¸”ä¸ºäº†æ¥æ”¶æ¶ˆæ¯è®¢é˜…è€…å¿…é¡»ä¿æŒè¿è¡Œçš„çŠ¶æ€ã€‚ JMSå…è®¸è®¢é˜…è€…åˆ›å»ºä¸€ä¸ªå¯æŒä¹…åŒ–çš„è®¢é˜…ï¼Œè¿™æ ·å³ä½¿è®¢é˜…è€…æ²¡æœ‰è¿è¡Œä¹Ÿèƒ½æ¥æ”¶åˆ°æ‰€è®¢é˜…çš„æ¶ˆæ¯ã€‚ æ¯æ¡æ¶ˆæ¯éƒ½ä¼šä¼ é€ç»™è¯¥ä¸»é¢˜ä¸‹çš„æ‰€æœ‰è®¢é˜…è€…ã€‚ é€šå¸¸å‘å¸ƒè€…ä¸ä¼šçŸ¥é“ä¹Ÿæ„è¯†ä¸åˆ°å“ªä¸€ä¸ªè®¢é˜…è€…æ­£åœ¨æ¥æ”¶æ¶ˆæ¯ã€‚ 3 JMSä½¿ç”¨JMSåœ¨ç¼–ç¨‹ä¸­ä½“ç°äº†ä¸åŒçš„æ¥å£ï¼š 3.1 JMS1.13.1.1 ConnectionFactoryæ˜¯åˆ›å»ºConnectionçš„å·¥å‚ï¼Œæ ¹æ®ä¸åŒçš„æ¶ˆæ¯ç±»å‹ç”¨æˆ·å¯é€‰æ‹©ç”¨QueueConnectionFactoryå’ŒTopicConnectionFactoryã€‚ 3.1.2 DestinationæŒ‡æ¶ˆæ¯ç›®çš„åœ°ï¼Œè¦ä¹ˆæ˜¯é˜Ÿåˆ—ï¼ˆQueueï¼‰è¦ä¹ˆæ˜¯ä¸»é¢˜ï¼ˆTopicï¼‰ 3.1.3 Connectionå®¢æˆ·ç«¯ä¸JMSç³»ç»Ÿä¹‹é—´å»ºç«‹çš„è¿æ¥ï¼Œåˆ†ä¸ºQueueConnectionå’ŒTopicConnectionFactoryã€‚ä¸€ä¸ªConnectionå¯ä»¥äº§ç”Ÿå¤šä¸ªSessionã€‚ 3.1.4 Sessionå®é™…æ“ä½œæ¶ˆæ¯çš„æ¥å£ï¼Œè¡¨ç¤ºä¸€ä¸ªå•çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ï¼ˆä¼šè¯ï¼‰ã€‚å¯ä»¥é€šè¿‡Sessionåˆ›å»ºç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ã€æ¶ˆæ¯ï¼Œè¿˜æä¾›äº†äº‹åŠ¡æ“ä½œã€‚Sessionä¹Ÿåˆ†ä¸ºQueueSessionå’ŒTopicSessionã€‚ 3.1.5 MessageProduceræ¶ˆæ¯ç”Ÿäº§è€…ï¼Œç”±Sessionåˆ›å»ºï¼Œå°†æ¶ˆæ¯å‘é€åˆ°Destinationã€‚æ¶ˆè´¹è€…å¯ä»¥åŒæ­¥æˆ–å¼‚æ­¥æ¥æ”¶è¿™äº›æ¶ˆæ¯ï¼Œæ¶ˆæ¯ç”Ÿäº§è€…ä¹Ÿåˆ†ä¸ºQueueSenderå’ŒTopicSenderã€‚ 3.1.6 MessageComsumeræ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œç”±Sessionåˆ›å»ºï¼Œæ¥æ”¶æ¥è‡ªDestinationçš„æ¶ˆæ¯ã€‚åˆ†ä¸ºQueueReceiverå’ŒTopicReceiverã€‚ 3.1.7 Messageæ¶ˆæ¯ï¼Œå°±æ˜¯è¢«ä¼ é€çš„å¯¹è±¡ 3.1.8 MessageListeneræ¶ˆæ¯ç›‘å¬å™¨ï¼Œåœ¨æ¶ˆæ¯åˆ°è¾¾æ—¶è‡ªåŠ¨è°ƒç”¨onMessageæ–¹æ³•ã€‚ 3.2 JMS2.0JMS2.0å¯¹APIåšäº†ç®€åŒ–ï¼š JMSContextæ›¿æ¢Connectionå’ŒSession JMSProduceræ›¿æ¢MessageProducerï¼Œæ”¯æŒé“¾å¼æ“ä½œä¼ é€’æ¶ˆæ¯ã€‚ JMSConsumeræ›¿æ¢MessageComsumerã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"æ¶ˆæ¯é˜Ÿåˆ—","slug":"æ¶ˆæ¯é˜Ÿåˆ—","permalink":"https://www.codetool.top/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"}]},{"title":"leetcode1071-å­—ç¬¦ä¸²çš„æœ€å¤§å…¬å› å­","slug":"leetcode1071-å­—ç¬¦ä¸²çš„æœ€å¤§å…¬å› å­","date":"2020-03-11T16:52:34.000Z","updated":"2020-03-11T17:00:26.087Z","comments":true,"path":"article/leetcode1071-å­—ç¬¦ä¸²çš„æœ€å¤§å…¬å› å­/","link":"","permalink":"https://www.codetool.top/article/leetcode1071-%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%9C%80%E5%A4%A7%E5%85%AC%E5%9B%A0%E5%AD%90/","excerpt":"","text":"1 åŸé¢˜å¯¹äºå­—ç¬¦ä¸² S å’Œ Tï¼Œåªæœ‰åœ¨ S = T + ... + Tï¼ˆT ä¸è‡ªèº«è¿æ¥ 1 æ¬¡æˆ–å¤šæ¬¡ï¼‰æ—¶ï¼Œæˆ‘ä»¬æ‰è®¤å®š â€œT èƒ½é™¤å°½ Sâ€ã€‚ è¿”å›æœ€é•¿å­—ç¬¦ä¸² Xï¼Œè¦æ±‚æ»¡è¶³ X èƒ½é™¤å°½ str1 ä¸” X èƒ½é™¤å°½ str2ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: str1 = â€œABCABCâ€, str2 = â€œABCâ€è¾“å‡º: â€œABCâ€ ç¤ºä¾‹ 2: è¾“å…¥: str1 = â€œABABABâ€, str2 = â€œABABâ€è¾“å‡º: â€œABâ€ ç¤ºä¾‹ 3: è¾“å…¥: str1 = â€œLEETâ€, str2 = â€œCODEâ€è¾“å‡º: â€œâ€ æç¤ºï¼š 1 &lt;= str1.length &lt;= 1000 1 &lt;= str2.length &lt;= 1000 str1[i] å’Œ str2[i] ä¸ºå¤§å†™è‹±æ–‡å­—æ¯ 2 è§£æ³•2.1 æ€æƒ³è¿™é“é¢˜æˆ‘ä¹‹å‰æƒ³å¾—å¾ˆå¤æ‚ï¼ç»“æœä¸€çœ‹é¢˜è§£ï¼šå§æ§½è¿˜èƒ½è¿™æ ·ã€‚ç»™å¤§ä½¬ä»¬è·ªäº†ã€‚ ç¡®å®å¥½ä¹…æ²¡æ¥è§¦è¿™æ ·çš„æ•°å­¦çŸ¥è¯†äº†ï¼šè¾—è½¬ç›¸é™¤æ³•ã€‚ é¦–å…ˆå¦‚æœstr1å’Œstr2æœ‰æœ€å¤§å…¬å› å­ï¼Œé‚£ä¹ˆstr1+str2å°±ä¼šç­‰äºstr2+str1ã€‚ ç„¶åå°±æ˜¯è€ƒè™‘æ€ä¹ˆæŠŠæœ€å¤§å…¬å› å­å­å­—ç¬¦ä¸²å–å‡ºæ¥ï¼Œè¯´å®è¯è¾—è½¬ç›¸é™¤æ³•æˆ‘æ˜¯æ²¡æƒ³åˆ°çš„ï¼Œç™¾åº¦ç™¾ç§‘ï¼š æ¬§å‡ é‡Œå¾·ç®—æ³•åˆç§°è¾—è½¬ç›¸é™¤æ³•ï¼Œæ˜¯æŒ‡ç”¨äºè®¡ç®—ä¸¤ä¸ªæ­£æ•´æ•°aï¼Œbçš„æœ€å¤§å…¬çº¦æ•°ã€‚åº”ç”¨é¢†åŸŸæœ‰æ•°å­¦å’Œè®¡ç®—æœºä¸¤ä¸ªæ–¹é¢ã€‚è®¡ç®—å…¬å¼gcd(a,b) = gcd(b,a mod b)ã€‚ è¿™æ ·æ±‚å‡ºä¸¤ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦çš„æœ€å¤§å…¬å› æ•°ï¼Œå°±æ˜¯å­å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œç„¶åç”¨substringå–å‡ºæ¥ã€‚ 2.2 ä»£ç class Solution { public String gcdOfStrings(String str1, String str2) { if(!(str1+str2).equals(str2+str1)) return \"\"; return str1.substring(0,gcd(str1.length(),str2.length())); } public int gcd(int x,int y){ return x%y==0?y:gcd(y,x%y); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"SpringBootæ•´åˆRedisä½¿ç”¨","slug":"SpringBootæ•´åˆRedisä½¿ç”¨","date":"2020-03-11T15:40:34.000Z","updated":"2020-04-17T10:45:30.010Z","comments":true,"path":"article/SpringBootæ•´åˆRedisä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/SpringBoot%E6%95%B4%E5%90%88Redis%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 SpringDataRedisä¸­çš„RedisTemplateä»‹ç»mavenä¾èµ–ï¼š &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-data-redis&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.apache.commons&lt;/groupId> &lt;artifactId>commons-pool2&lt;/artifactId> &lt;/dependency> é»˜è®¤ä½¿ç”¨çš„æ˜¯lettuceä½œä¸ºredisçš„å®¢æˆ·ç«¯ï¼ŒSpring Data Rediså°è£…äº†å…¶APIï¼ŒRedisTemplateæ˜¯å®ƒçš„æ ¸å¿ƒç±»ã€‚å¼•å…¥commons-pool2çš„åŸå› æ˜¯ lettuce éœ€è¦ä½¿ç”¨ commons-pool 2 åˆ›å»º Redis è¿æ¥æ± ã€‚ Spring Data Redisé€šè¿‡LettuceConnectionæ¥æ“ä½œRedisï¼Œè€Œè¿™ä¸ªå¯¹è±¡é€šè¿‡LettuceConnectionFactoryè·å¾—ï¼Œå› ä¸ºlettureå¯ä»¥å¸®æˆ‘ä»¬åˆ›å»ºè¿æ¥æ± ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦å…³æ³¨åˆ›å»ºè¿æ¥æ± éƒ¨åˆ†ï¼Œéœ€è¦å…³æ³¨çš„æ˜¯LettuceConnectionConfigurationä¸­çš„é…ç½®ä¿¡æ¯ã€‚ï¼ˆå¦‚æœæ˜¯Jediså°±å¾—æˆ‘ä»¬æ‰‹åŠ¨ä»£ç åˆ›å»ºçº¿ç¨‹æ± äº†ï¼‰ 1.1 åºåˆ—åŒ–å™¨å¯ä»¥é€šè¿‡Redisæ¥å­˜å–å¯¹è±¡ï¼Œå®é™…ä¸Šæ˜¯RedisTemplateé€šè¿‡åºåˆ—åŒ–å™¨RedisSerializerè¿›è¡Œäº†åºåˆ—åŒ–ã€‚ RedisSerializeræœ‰ä¸¤ä¸ªä¸»è¦æ–¹æ³•ï¼šserializeï¼ˆåºåˆ—åŒ–ï¼‰å’Œdeserializeï¼ˆååºåˆ—åŒ–ï¼‰ã€‚è¿™é‡ŒJdkSerializationRedisSerializeræ˜¯RedisTemplateé»˜è®¤çš„åºåˆ—åŒ–å™¨ï¼ŒåŸºæœ¬ç”¨çš„å°±æ˜¯jdkåºåˆ—åŒ–çš„æ–¹æ³•ï¼Œjdkä¸­çš„åºåˆ—åŒ–å¯ä»¥çœ‹æˆ‘ä»¥å‰çš„æ–‡ç« å¯¹è±¡çš„è¾“å…¥è¾“å‡º-javaåºåˆ—åŒ–æœºåˆ¶ã€‚ RedisTemplateå¯ä»¥é…ç½®å®ƒä½¿ç”¨çš„åºåˆ—åŒ–å™¨ï¼Œå¦‚ä¸‹è¡¨ å±æ€§ æè¿° å¤‡æ³¨ defaultSerializer é»˜è®¤åºåˆ—åŒ–å™¨ å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä½¿ç”¨JdkSerializationRedisSerializer keySerializer Redisé”®åºåˆ—åŒ–å™¨ å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä½¿ç”¨é»˜è®¤åºåˆ—åŒ–å™¨ valueSerializer Rediså€¼åºåˆ—åŒ–å™¨ å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä½¿ç”¨é»˜è®¤åºåˆ—åŒ–å™¨ hashKeySerializer Redisæ•£åˆ—ç»“æ„fieldåºåˆ—åŒ–å™¨ å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä½¿ç”¨é»˜è®¤åºåˆ—åŒ–å™¨ hashValueSerializer Redisæ•£åˆ—ç»“æ„valueåºåˆ—åŒ–å™¨ å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä½¿ç”¨é»˜è®¤åºåˆ—åŒ–å™¨ stringSerializer å­—ç¬¦ä¸²åºåˆ—åŒ–å™¨ RedisTemplateè‡ªåŠ¨èµ‹å€¼ä¸ºStringRedisSerializerå¯¹è±¡ æ³¨æ„å¦‚æœæ˜¯ä½¿ç”¨é»˜è®¤çš„åºåˆ—åŒ–å™¨ï¼Œåœ¨å­˜é”®çš„æ—¶å€™RedisTemplateä¼šæŠŠé”®ä¹Ÿå½“æˆä¸€ä¸ªJavaå¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼Œæ‰€ä»¥å¦‚æœæƒ³RedisTemplateæŠŠé”®å½“æˆæ™®é€šå­—ç¬¦ä¸²ï¼Œå¾—é…ç½®ä¸ºstringRedisSerializerã€‚æˆ‘ä»¬é‡‡ç”¨ä¸‹é¢çš„æ³¨å…¥æ–¹å¼ï¼š @Configuration public class RedisConfig { @Bean public RedisTemplate&lt;Object,Object> redisTemplate(RedisConnectionFactory redisConnectionFactory) { RedisTemplate&lt;Object,Object> redisTemplate = new RedisTemplate(); // RedisTemplateä¼šè‡ªåŠ¨åˆå§‹åŒ–StringSerializerï¼Œè¿™é‡Œç›´æ¥è·å– RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer(); // è®¾ç½®å­—ç¬¦ä¸²åºåˆ—åŒ–å™¨ redisTemplate.setKeySerializer(stringRedisSerializer); redisTemplate.setHashKeySerializer(stringRedisSerializer); redisTemplate.setConnectionFactory(redisConnectionFactory); redisTemplate.afterPropertiesSet(); return redisTemplate; } } æˆ–è€…ï¼Œåœ¨springbootä¸­ï¼Œç”±äºä¼šè‡ªåŠ¨æ³¨å…¥RedisTemplateå¯¹è±¡ï¼Œå¯ä»¥åœ¨è·å–ä¹‹åæ›´æ”¹å®ƒçš„å±æ€§ @Autowired private RedisTemplate redisTemplate = null; @PostConstruct public void init(){ initRedisTemplate(); } private void initRedisTemplate(){ RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer(); redisTemplate.setKeySerializer(stringRedisSerializer); redisTemplate.setHashKeySerializer(stringRedisSerializer); } 1.2 å¯¹Redisæ•°æ®ç±»å‹æ“ä½œçš„å°è£… æ“ä½œæ¥å£ åŠŸèƒ½ GeoOperations åœ°ç†ä½ç½®æ“ä½œæ¥å£ HashOperations æ•£åˆ—æ“ä½œæ¥å£ HyperLogLogOperations åŸºæ•°æ“ä½œæ¥å£ ListOperations åˆ—è¡¨(é“¾è¡¨)æ“ä½œæ¥å£ SetOperations é›†åˆæ“ä½œæ¥å£ ValueOperations å­—ç¬¦ä¸²æ“ä½œæ¥å£ ZSetOperations æœ‰åºé›†åˆæ“ä½œæ¥å£ è·å–ï¼š //å­—ç¬¦ä¸²æ“ä½œæ¥å£ ValueOperations valueOperations = redisTemplate.opsForValue(); SetOperations setOperations = redisTemplate.opsForSet(); HashOperations hashOperations = redisTemplate.opsForHash(); ListOperations listOperations = redisTemplate.opsForList(); ZSetOperations zSetOperations = redisTemplate.opsForZSet(); è¿™äº›æ¥å£ä¸‹çš„æ–¹æ³•åå°±è·Ÿredisçš„æ“ä½œæŒ‡ä»¤ä¸€æ ·äº†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯åœ¨è¿™äº›ä¸åŒçš„æ¥å£ä¸­æ“ä½œçš„å®é™…ä¸Šä¸æ˜¯åœ¨åŒä¸€ä¸ªredisè¿æ¥ä¸­å®Œæˆçš„ï¼Œé»˜è®¤æ¯ç§ç±»å‹çš„æ•°æ®æ“ä½œéƒ½ä½¿ç”¨äº†ä¸€æ¡æ–°è¿æ¥ã€‚ RedisTemplateè¿˜å¯ä»¥ç»‘å®šä¸€ä¸ªkeyï¼Œå¯¹è¿™ä¸ªkeyåšè¿ç»­çš„æ“ä½œï¼Œå¦‚ï¼š BoundValueOperations stringKeyOps = redisTemplate.boundValueOps(\"stringKey\"); 1.3 SessionCallbackå’ŒRedisCallbackå¦‚æœæˆ‘ä»¬æƒ³åœ¨ä¸€ä¸ªè¿æ¥ä¸­æ‰§è¡Œå¤šä¸ªRediså‘½ä»¤ï¼Œå°±å¯èƒ½éœ€è¦è¿™ä¸¤ä¸ªæ¥å£ï¼Œå…¶ä¸­SessionCallbackå°è£…å¾—æ›´å®Œå–„ï¼Œæ¨èä½¿ç”¨ã€‚ redisTemplate.execute(new SessionCallback() { @Override public Object execute(RedisOperations operations) throws DataAccessException { operations.opsForValue().set(\"key1\",\"value1\"); operations.opsForHash().put(\"hash\",\"field\",\"hvalue\"); return null; } }); 2 SpringBootä¸­æ“ä½œRedis2.1 ä½¿ç”¨RedisTemplateå¸¸ç”¨é…ç½®ï¼š # è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ é»˜è®¤ 0 spring.redis.lettuce.pool.min-idle= 5 # è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ é»˜è®¤ 8 spring.redis.lettuce.pool.max-active= 10 # è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥ é»˜è®¤ 8 spring.redis.lettuce.pool.max-idle= 10 # è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ é»˜è®¤ -1 spring.redis.lettuce.pool.max-wait= 2000 spring.redis.port=6379 spring.redis.host=127.0.0.1 spring.redis.password= # Redisè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ¯«ç§’ spring.redis.timeout= 1000 ç„¶åè·å–RedisTemplateå°±è¡Œäº†ï¼Œè¿™ä¸ªæ˜¯åœ¨IoCå®¹å™¨ä¸­çš„ã€‚ ä¸‹é¢è®²ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•ï¼ŒSpringæä¾›äº†ç¼“å­˜æ³¨è§£ï¼Œä½¿ç”¨è¿™äº›æ³¨è§£å¯ä»¥æœ‰æ•ˆç®€åŒ–ç¼–ç¨‹è¿‡ç¨‹ã€‚ 2.2 ç¼“å­˜ç®¡ç†å™¨Springæ”¯æŒå¤šç§ç¼“å­˜çš„ä½¿ç”¨ï¼Œå®ƒæä¾›äº†æ¥å£CacheManagerï¼Œæœ‰è®¸å¤šå®ç°ç±» åœ¨Spring Bootä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶ç”Ÿæˆç¼“å­˜ç®¡ç†å™¨ï¼Œå¦‚ä¸‹ï¼š # Spring Cache Start # é»˜è®¤æƒ…å†µä¸‹Springä¼šæ ¹æ®ä¸Šä¸‹æ–‡æ¢æµ‹ spring.cache.type=redis # ç¼“å­˜åç§°ï¼Œé…åˆæ³¨è§£ä½¿ç”¨ spring.cache.cache-names= redisCache # æ˜¯å¦å…è®¸Redisç¼“å­˜ç©ºå€¼ spring.cache.redis.cache-null-values=true # æ˜¯å¦å¯ç”¨Redisçš„é”®å‰ç¼€ spring.cache.redis.use-key-prefix=true # Redisçš„é”®å‰ç¼€ spring.cache.redis.key-prefix= # ç¼“å­˜è¶…æ—¶æ—¶é—´æˆ³ï¼Œé…ç½®ä¸º0åˆ™ä¸è®¾ç½®è¶…æ—¶æ—¶é—´ spring.cache.redis.time-to-live=0ms # Spring Cache End ä¸ºäº†ä½¿ç”¨ç¼“å­˜ç®¡ç†å™¨ï¼Œé¦–å…ˆåœ¨é…ç½®ç±»ä¸­åŠ å…¥æ³¨è§£@EnableCaching ç„¶ååœ¨Serviceå±‚ï¼ˆè€Œä¸æ˜¯DAOå±‚ï¼‰çš„æ–¹æ³•ä¸ŠåŠ ä¸Šå¦‚ä¸‹æ³¨è§£ï¼š @Cacheable é€šå¸¸åº”ç”¨åˆ°è¯»å–æ•°æ®çš„æ–¹æ³•ä¸Šï¼Œå¦‚æŸ¥æ‰¾æ–¹æ³•ï¼šå…ˆä»ç¼“å­˜ä¸­è¯»å–ï¼Œå¦‚æœæ²¡æœ‰å†è°ƒç”¨æ–¹æ³•è·å–æ•°æ®ï¼Œç„¶åæŠŠæ•°æ®æŸ¥è¯¢ç»“æœæ·»åŠ åˆ°ç¼“å­˜ä¸­ã€‚å¦‚æœç¼“å­˜ä¸­æŸ¥æ‰¾åˆ°æ•°æ®ï¼Œè¢«æ³¨è§£çš„æ–¹æ³•å°†ä¸ä¼šæ‰§è¡Œã€‚å±æ€§ï¼š valueï¼šç¼“å­˜çš„åç§°ï¼Œè¿™ä¸ªæ˜¯ä¹‹å‰åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„spring.cache.cache-names keyï¼šç¼“å­˜çš„keyï¼Œå¯ä»¥ä½¿ç”¨SpELè¡¨è¾¾å¼ï¼Œå¦‚key = &quot;&#39;redis_user_&#39;+#id&quot; conditionï¼šç¼“å­˜çš„æ¡ä»¶ï¼Œä½¿ç”¨SpELè¡¨è¾¾å¼ï¼Œè¿”å›trueåˆ™ç¼“å­˜ @CachePut é€šå¸¸åº”ç”¨äºä¿å­˜å’Œä¿®æ”¹æ–¹æ³•é…ç½®ï¼Œèƒ½å¤Ÿæ ¹æ®æ–¹æ³•çš„è¯·æ±‚å‚æ•°å¯¹å…¶ç»“æœè¿›è¡Œç¼“å­˜ï¼Œå’Œ @Cacheable ä¸åŒçš„æ˜¯ï¼Œå®ƒæ¯æ¬¡éƒ½ä¼šè§¦å‘è¢«æ³¨è§£æ–¹æ³•çš„è°ƒç”¨ã€‚å±æ€§ï¼š valueï¼šç¼“å­˜çš„åç§° keyï¼šç¼“å­˜çš„key conditionï¼šç¼“å­˜çš„æ¡ä»¶ @CachEvict é€šå¸¸åº”ç”¨äºåˆ é™¤æ–¹æ³•é…ç½®ï¼Œèƒ½å¤Ÿæ ¹æ®ä¸€å®šçš„æ¡ä»¶å¯¹ç¼“å­˜è¿›è¡Œæ¸…ç©ºã€‚å¯ä»¥æ¸…é™¤ä¸€æ¡æˆ–å¤šæ¡ç¼“å­˜ã€‚å±æ€§ï¼š valueï¼šç¼“å­˜çš„åç§° keyï¼šç¼“å­˜çš„key conditionï¼šç¼“å­˜çš„æ¡ä»¶ allEntriesï¼šæ˜¯å¦æ¸…ç©ºæ‰€æœ‰ç¼“å­˜å†…å®¹ï¼Œé»˜è®¤ä¸ºfalse beforeInvocationï¼šæ˜¯å¦åœ¨æ–¹æ³•æ‰§è¡Œå‰å°±æ¸…ç©ºï¼Œé»˜è®¤ä¸ºfalse","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"https://www.codetool.top/tags/Redis/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.codetool.top/tags/SpringBoot/"}]},{"title":"SpringBootå¯¹å®šæ—¶ä»»åŠ¡çš„æ”¯æŒ","slug":"SpringBootå¯¹å®šæ—¶ä»»åŠ¡çš„æ”¯æŒ","date":"2020-03-11T10:27:13.000Z","updated":"2020-03-11T11:41:52.926Z","comments":true,"path":"article/SpringBootå¯¹å®šæ—¶ä»»åŠ¡çš„æ”¯æŒ/","link":"","permalink":"https://www.codetool.top/article/SpringBoot%E5%AF%B9%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%94%AF%E6%8C%81/","excerpt":"","text":"1 æ¦‚è¿°åœ¨ä¼ä¸šçš„å®è·µç”Ÿäº§ä¸­,å¯èƒ½éœ€è¦ä½¿ç”¨ä¸€äº›å®šæ—¶ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œåœ¨æœˆæœ«ã€å­£æœ«å’Œå¹´æœ«éœ€è¦ç»Ÿè®¡å„ç§å„æ ·çš„æŠ¥è¡¨ï¼Œæœˆè¡¨éœ€è¦æœˆæœ«è·‘æ‰¹é‡ç”Ÿæˆï¼Œå­£è¡¨éœ€è¦å­£æœ«è·‘æ‰¹é‡ç”Ÿæˆï¼Œè¿™æ ·å°±éœ€è¦åˆ¶å®šä¸åŒçš„å®šæ—¶ä»»åŠ¡ã€‚ 2 ä½¿ç”¨åœ¨Springä¸­é…ç½®å®šæ—¶ä»»åŠ¡çš„æ–¹æ³•ï¼š é¦–å…ˆåœ¨é…ç½®ç±»ä¸­åŠ å…¥@EnableSchedulingï¼Œç„¶åé€šè¿‡æ³¨è§£@Scheduledå»é…ç½®å¦‚ä½•å®šæ—¶ã€‚ ç¤ºä¾‹ï¼š @Service public class ScheduleService { //è®¡æ•°å™¨ int count = 1; //æ¯éš”ä¸€ç§’æ‰§è¡Œä¸€æ¬¡ @Scheduled(fixedRate = 1000) //ä½¿ç”¨å¼‚æ­¥æ‰§è¡Œ @Async public void scheduledTask(){ System.out.println(\"scheduledTaskæ‰§è¡Œç¬¬\"+count+\"æ¬¡\"); count++; } } å¯åŠ¨SpringBootç¨‹åºï¼Œå¯ä»¥è§‚å¯Ÿåˆ°æ§åˆ¶å°æ‰“å°ä¿¡æ¯ï¼š 2020-03-11 19:00:03.436 INFO 7360 --- [l-thread-pool-1] c.rhett.bootweb.service.ScheduleService : scheduledTaskæ‰§è¡Œç¬¬1æ¬¡ 2020-03-11 19:00:04.432 INFO 7360 --- [l-thread-pool-2] c.rhett.bootweb.service.ScheduleService : scheduledTaskæ‰§è¡Œç¬¬2æ¬¡ 2020-03-11 19:00:05.433 INFO 7360 --- [l-thread-pool-3] c.rhett.bootweb.service.ScheduleService : scheduledTaskæ‰§è¡Œç¬¬3æ¬¡ 2020-03-11 19:00:06.432 INFO 7360 --- [l-thread-pool-4] c.rhett.bootweb.service.ScheduleService : scheduledTaskæ‰§è¡Œç¬¬4æ¬¡ 2020-03-11 19:00:07.433 INFO 7360 --- [l-thread-pool-5] c.rhett.bootweb.service.ScheduleService : scheduledTaskæ‰§è¡Œç¬¬5æ¬¡ ...è¿™è¯´æ˜æ¯ç§’é’ŸSpringéƒ½ä¼šè¿è¡Œè¿™ä¸ªæ ‡æ³¨äº†@Scheduledçš„æ–¹æ³•ï¼Œå¹¶ä¸”ä½¿ç”¨äº†çº¿ç¨‹æ± ï¼ˆåœ¨SpringBootå¯¹å¼‚æ­¥ä»»åŠ¡çš„æ”¯æŒä¸­é…ç½®çš„ï¼‰ã€‚ 3 cronè¡¨è¾¾å¼ä¸Šé¢çš„@Scheduledåªæ˜¯æŒ‰ç…§æ—¶é—´é—´éš”æ‰§è¡Œ,å¦‚æœéœ€è¦æŒ‡å®šæŸä¸ªæ—¶é—´æ‰§è¡Œï¼Œå°±éœ€è¦ä¸€äº›å…¶ä»–å±æ€§é…ç½®äº†ï¼Œä¸‹é¢åˆ—å‡ºäº†@Scheduledçš„ä¸€äº›å±æ€§ï¼š å±æ€§ ç±»å‹ æè¿° cron String ä½¿ç”¨è¡¨è¾¾å¼çš„æ–¹å¼å®šä¹‰ä»»åŠ¡æ‰§è¡Œæ—¶é—´ zone String å¯ä»¥é€šè¿‡å®ƒè®¾å®šåŒºåŸŸæ—¶é—´ fixedDelay long è¡¨ç¤ºä»ä¸Šä¸€ä¸ªä»»åŠ¡å®Œæˆå¼€å§‹åˆ°ä¸‹ä¸€ä¸ªä»»åŠ¡å¼€å§‹çš„é—´éš”,å•ä½ä¸ºæ¯«ç§’ fixedDelayString String ä¸fixedDelayç›¸åŒ,åªæ˜¯ä½¿ç”¨å­—ç¬¦ä¸²,è¿™æ ·å¯ä»¥ä½¿ç”¨SpELæ¥å¼•å…¥é…ç½®æ–‡ä»¶çš„é…ç½® initialDelay long åœ¨Spring IoCå®¹å™¨å®Œæˆåˆå§‹åŒ–å,é¦–æ¬¡ä»»åŠ¡æ‰§è¡Œå»¶è¿Ÿæ—¶é—´,å•ä½ä¸ºæ¯«ç§’ initialDelayString String ä¸initialDelayç›¸åŒ,åªæ˜¯ä½¿ç”¨å­—ç¬¦ä¸²,è¿™æ ·å¯ä»¥ä½¿ç”¨SpELæ¥å¼•å…¥é…ç½®æ–‡ä»¶çš„é…ç½® fixedRate long ä»ä¸Šä¸€ä¸ªä»»åŠ¡å¼€å§‹åˆ°ä¸‹ä¸€ä¸ªä»»åŠ¡å¼€å§‹çš„é—´éš”,å•ä½ä¸ºæ¯«ç§’ fixedRateString String ä¸fixedRateç›¸åŒ,åªæ˜¯ä½¿ç”¨å­—ç¬¦ä¸²,è¿™æ ·å¯ä»¥ä½¿ç”¨SpELæ¥å¼•å…¥é…ç½®æ–‡ä»¶çš„é…ç½® çœ‹åˆ°è¿™äº›å±æ€§æ˜¯ä¸æ˜¯æœ‰ç§è«åçš„ç†Ÿæ‚‰ï¼Ÿï¼ˆå‡è®¾ä½ æ˜¯æˆ‘åšå®¢çš„å¿ å®è¯»è€…ï¼Œè™½ç„¶æ¦‚ç‡ä¸º0%ï¼Œæˆ–è€…ä½ ä¹Ÿå¯¹jdkæ¯”è¾ƒäº†è§£ï¼‰ æ²¡é”™ï¼Œåœ¨æˆ‘ä¹‹å‰å†™çš„ä¸€ç¯‡Javaçº¿ç¨‹æ± è¯¦è§£ä¸­ä»‹ç»äº†ä»»åŠ¡è°ƒåº¦çº¿ç¨‹æ± ScheduledExecutorServiceæœ‰æ¥è¿‘çš„åŠŸèƒ½ï¼Œè€Œåœ¨org.springframework.scheduling.ScheduledTaskRegistrarè¿™ä¸ªç±»ä¸‹é¢ï¼Œä¹Ÿçœ‹åˆ°äº†æœ‰ä¸€ä¸ªæˆå‘˜å±æ€§localExecutorï¼Œå®ƒçš„ç±»å‹å°±æ˜¯ScheduledExecutorServiceã€‚ æ‰€ä»¥fixedRateå’ŒfixedDelayå°±å¯¹åº”ç€ScheduledExecutorServiceæ¥å£çš„scheduleAtFixedRateå’ŒscheduleWithFixedDelayï¼Œdelayè¦ç­‰åˆ°ä¸Šä¸€ä¸ªä»»åŠ¡å®Œæˆæ‰å¼€å§‹è®¡ç®—é—´éš”æ—¶é—´ï¼Œrateä¸ç”¨ã€‚ è€Œcronè¿™ä¸ªå±æ€§åœ¨ScheduledExecutorServiceä¸­å°±æ²¡è§è¿‡äº†ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨æ¥åŒ¹é…æ—¶é—´è¡¨è¾¾å¼ï¼Œæ–¹ä¾¿æˆ‘ä»¬å®šä¹‰åœ¨æŸä¸ªæ—¶é—´è§„åˆ™æ‰§è¡Œä»»åŠ¡ã€‚cronçš„è¯­æ³•æ˜¯ï¼šâ€œç§’ åˆ† æ—¶ å¤© æœˆ æ˜ŸæœŸ å¹´â€ï¼Œå…¶ä¸­å¹´å¯ä»¥çœç•¥ã€‚å®ƒä»¬çš„å–å€¼éƒ½å¾ˆæ¥è¿‘è‡ªç„¶è¡¨è¾¾ï¼Œæ¯”å¦‚è¯´åˆ†çš„å–å€¼0-59ï¼Œå¤©çš„å–å€¼1-31ï¼Œæœˆçš„å–å€¼1-12ï¼Œæ˜ŸæœŸçš„å–å€¼1-7ï¼Œä»£è¡¨æ˜ŸæœŸæ—¥åˆ°æ˜ŸæœŸå…­ï¼ˆè¿™ç‚¹éœ€è¦æ³¨æ„ï¼‰ï¼Œä¹Ÿå¯ä»¥å†™è‹±æ–‡ç¼©å†™SUN-SATã€‚ é™¤äº†å†™å…·ä½“çš„å–å€¼ï¼Œè¿˜å¯ä»¥å†™é€šé…ç¬¦ï¼š é€šé…ç¬¦ æè¿° * è¡¨ç¤ºä»»æ„å€¼ ? ä¸æŒ‡å®šå€¼ï¼Œç”¨äºå¤„ç†å¤©å’Œæ˜ŸæœŸé…ç½®çš„å†²çª - æŒ‡å®šæ—¶é—´åŒºé—´ï¼Œå¦‚å¯¹äºæ˜ŸæœŸï¼Œ2-6ä»£è¡¨çš„æ˜¯æ˜ŸæœŸä¸€åˆ°æ˜ŸæœŸäº” / æŒ‡å®šæ—¶é—´é—´éš”æ‰§è¡Œï¼Œ/å‰é¢æ˜¯å¼€å§‹å€¼ï¼Œ/åé¢æ˜¯æ­¥é•¿ï¼Œä¾‹å¦‚å¯¹äºåˆ†é’Ÿï¼Œ0/3ä»£è¡¨ä»0åˆ†å¼€å§‹ï¼Œæ¯éš”ä¸‰åˆ†æ‰§è¡Œä¸€æ¬¡ L ä»£è¡¨æœ€åçš„ï¼Œå¦‚å¯¹äºæ˜ŸæœŸï¼Œ4Lä»£è¡¨æœ€åä¸€ä¸ªæ˜ŸæœŸä¸‰ # å‰é¢æ˜¯å€¼ï¼Œåé¢æ˜¯ç¬¬å‡ ä¸ªï¼Œå¦‚å¯¹äºæ˜ŸæœŸï¼Œ6#3ä»£è¡¨ç¬¬ä¸‰ä¸ªæ˜ŸæœŸäº” , åˆ—ä¸¾å¤šä¸ªé¡¹ï¼Œä¾‹å¦‚å¯¹äºæœˆä»½ï¼Œ3,5,7ä»£è¡¨æ¯ä¸ª3æœˆã€5æœˆã€7æœˆ","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.codetool.top/tags/SpringBoot/"}]},{"title":"SpringBootå¯¹å¼‚æ­¥ä»»åŠ¡çš„æ”¯æŒ","slug":"SpringBootå¯¹å¼‚æ­¥ä»»åŠ¡çš„æ”¯æŒ","date":"2020-03-11T10:26:19.000Z","updated":"2020-03-11T15:42:17.663Z","comments":true,"path":"article/SpringBootå¯¹å¼‚æ­¥ä»»åŠ¡çš„æ”¯æŒ/","link":"","permalink":"https://www.codetool.top/article/SpringBoot%E5%AF%B9%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%94%AF%E6%8C%81/","excerpt":"","text":"1 å¼‚æ­¥æ–¹æ³•åœ¨é…ç½®ç±»ä¸Šé…ç½® @EnableAsync æ³¨è§£å¼€å¯å¼‚æ­¥å¤„ç†ã€‚ åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Šæ³¨è§£@Asyncå°†è¯¥æ–¹æ³•æ ‡è®°ä¸ºå¼‚æ­¥ä»»åŠ¡ã€‚ ç”¨æ³•å’ŒFutureTask+Callableå·®ä¸å¤šï¼Œå¯ä»¥è¿”å›AsyncResultç±»å‹ï¼Œå®ƒæ˜¯Futureçš„ä¸€ä¸ªå®ç°ç±»ã€‚ ä¾‹ï¼š @Async public Future&lt;String> asyncTask() throws InterruptedException{ Thread.sleep(2000); return new AsyncResult&lt;>(\"ä»»åŠ¡å®Œæˆ\"); } 2 å¼‚æ­¥çº¿ç¨‹æ± å¦‚æœä¸€ç›´ä½¿ç”¨@Asyncä¸é…åˆçº¿ç¨‹æ± ï¼Œä¼šæ¶ˆè€—å¾ˆå¤šèµ„æºï¼Œæ•ˆç‡å˜ä½ï¼ŒSpringä¸­æœ‰ä¸€ä¸ªAsyncConfigureræ¥å£ï¼Œå¯ä»¥é€šè¿‡å®ƒé…ç½®çº¿ç¨‹æ± ã€‚ public interface AsyncConfigurer { //è·å–çº¿ç¨‹æ±  @Nullable default Executor getAsyncExecutor() { return null; } //å¼‚æ­¥å¼‚å¸¸å¤„ç†å™¨ @Nullable default AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() { return null; } } äºæ˜¯æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œåœ¨è¿™é‡Œé¢å†™å®ç°,@EnableAsync æ³¨è§£æ”¾åˆ°è¿™ä¸ªé…ç½®ç±»ä¸Šé¢å¯ä»¥å¢åŠ å¯è¯»æ€§ã€‚ @Configuration @Slf4j public class AsyncConfig implements AsyncConfigurer { @Override public Executor getAsyncExecutor() { log.info(\"æ­£åœ¨åˆ›å»ºçº¿ç¨‹æ± \"); ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor(); executor.setCorePoolSize(10); executor.setMaxPoolSize(30); executor.setQueueCapacity(2000); executor.setThreadNamePrefix(\"global-thread-pool-\"); executor.initialize(); return executor; } } è¿™æ ·åˆ›å»ºçš„çº¿ç¨‹æ± æ˜¯å…¨å±€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤ä½¿ç”¨@Asyncæ ‡æ³¨çš„æ–¹æ³•éƒ½ä¼šä»è¿™ä¸ªçº¿ç¨‹æ± ä¸­å–çº¿ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸€ä¸‹ï¼š @Async public void testPool() throws InterruptedException { System.out.println(Thread.currentThread().getName()); Thread.sleep(1000); } è¾“å‡ºï¼š global-thread-pool-1å¦‚æœæˆ‘ä»¬æƒ³è®©å®ƒçµæ´»åº¦æ›´é«˜ä¸€ç‚¹ï¼Œå¯ä»¥å¾€IoCå®¹å™¨ä¸­æ³¨å…¥ä¸€äº›Executorï¼Œä½¿ç”¨@Async(&quot;&quot;)çš„valueæ¥æŒ‡å®šä¸€ä¸ªè¦ä½¿ç”¨çš„çº¿ç¨‹æ± çš„beanåç§°ã€‚ ä¾‹å¦‚ï¼Œç»™é…ç½®ç±»ä¸­æ·»åŠ æ³¨å…¥Executor beançš„æ–¹æ³•ï¼š @Configuration @Slf4j public class AsyncConfig implements AsyncConfigurer { @Override public Executor getAsyncExecutor() { log.info(\"æ­£åœ¨åˆ›å»ºçº¿ç¨‹æ± \"); ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor(); executor.setCorePoolSize(10); executor.setMaxPoolSize(30); executor.setQueueCapacity(2000); executor.setThreadNamePrefix(\"global-thread-pool-\"); executor.initialize(); return executor; } @Bean(\"bigExecutor\") public Executor getBigExecutor() { log.info(\"æ­£åœ¨åˆ›å»ºçº¿ç¨‹æ± \"); ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor(); executor.setCorePoolSize(50); executor.setMaxPoolSize(80); executor.setQueueCapacity(80); executor.setThreadNamePrefix(\"big-thread-pool-\"); executor.initialize(); return executor; } } æŒ‡å®šä½¿ç”¨çº¿ç¨‹æ± ï¼š @Async(\"bigExecutor\") public void testBigPool() throws InterruptedException { System.out.println(Thread.currentThread().getName()); Thread.sleep(1000); }","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.codetool.top/tags/SpringBoot/"}]},{"title":"Javaä¹‹UDPç¼–ç¨‹","slug":"Javaä¹‹UDPç¼–ç¨‹","date":"2020-03-11T04:24:16.000Z","updated":"2020-03-11T06:11:33.415Z","comments":true,"path":"article/Javaä¹‹UDPç¼–ç¨‹/","link":"","permalink":"https://www.codetool.top/article/Java%E4%B9%8BUDP%E7%BC%96%E7%A8%8B/","excerpt":"","text":"1 DatagramSocketæ¦‚è¿°ä¸Šæ¬¡åœ¨Javaç½‘ç»œå¥—æ¥å­—Socketç¼–ç¨‹é‚£ç¯‡åšå®¢é‡Œåªå†™äº†Socketå’ŒServerSocketï¼Œå³TCPé€šä¿¡ï¼Œè¿™æ¬¡æ¥è¡¥å……ä¸€ä¸‹UDPé€šä¿¡ã€‚ å’ŒSocketç±»ä¼¼çš„ï¼ŒJavaä¸­ä¹Ÿå­˜åœ¨ä¸€ä¸ªDatagramSocketç±»ï¼Œå®ƒå°±æ˜¯é¢å‘UDPä¸­çš„æ•°æ®æŠ¥åŒ…çš„æ¦‚å¿µä¼ è¾“ï¼Œå¯¹åº”java.netåŒ…ä¸‹é¢æœ‰ä¸€ä¸ªç±»DatagramPacketå°±æ˜¯ç”¨æ¥æè¿°æ•°æ®æŠ¥åŒ…ã€‚ å› ä¸ºUDPæ˜¯æ— è¿æ¥çš„ï¼Œä¸åˆ†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Œåœ¨å•æ¬¡é€šä¿¡ä¸­ï¼Œåªæœ‰å‘é€ç«¯å’Œæ¥æ”¶ç«¯ï¼Œå› æ­¤ä¹Ÿæ²¡æœ‰ä»€ä¹ˆDatagramServerSocketã€‚ 2 DatagramSocketä½¿ç”¨DatagramSocket()ï¼šå»ºç«‹ä¸€ä¸ªudp socketï¼Œå®ƒå®é™…ä¸Šæ˜¯è°ƒç”¨äº†DatagramSocket(new InetSocketAddress(0))ï¼Œå³æŒ‡å®šç«¯å£å·ä¸º0ï¼Œ0çš„å«ä¹‰æ˜¯è¿™ä¸ªç«¯å£å·æ˜¯æ ¹æ®ç³»ç»ŸæŒ‡å®šåŠ¨æ€ç”Ÿæˆçš„ã€‚ å…¶ä»–æ„é€ å‡½æ•°å°±æ˜¯å’ŒSocketç±»ä¼¼çš„ä¼ ä¸€ä¸ªç«¯å£å·è¿›å»ã€ä¼ ä¸€ä¸ªSocketAddressè¿›å»ã€‚ bindï¼šç»‘å®šç«¯å£ connectï¼šè™½ç„¶udpæ˜¯æ— è¿æ¥çš„ï¼Œä½†å¯ä»¥åªä¸åŒä¸€å°æœºå™¨é€šä¿¡ï¼Œè¿™ç§æƒ…å†µä¹Ÿç§°å®ƒä¸ºconnectï¼Œconnectä¹‹åæ‰€æœ‰çš„sendå’Œreceiveæ“ä½œéƒ½ä¸æŒ‡å®šçš„ä¸»æœºé€šä¿¡ã€‚ sendï¼šå‘é€ä¸€ä¸ªDatagramPacketæ•°æ®æŠ¥åŒ… receiveï¼šæ¥æ”¶ä¸€ä¸ªæ•°æ®æŠ¥åŒ…ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯é˜»å¡çš„ã€‚ closeï¼šé‡Šæ”¾socket éœ€è¦æ³¨æ„çš„æ˜¯receiveæ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ªæ•°æ®æŠ¥åŒ…å¯¹è±¡ï¼Œè¿™ä¸ªæ•°æ®æŠ¥åŒ…å¯¹è±¡ç”±ä¸€ä¸ªç©ºçš„å­—èŠ‚æ•°ç»„æ„é€ ï¼Œè€Œå­—èŠ‚æ•°ç»„çš„é•¿åº¦å€¼å¾—è€ƒè™‘ï¼Œå¦‚æœè¿‡å°å¯èƒ½ä¼šé€ æˆæ•°æ®æˆªæ–­ï¼Œæ‰€ä»¥å‘é€æ–¹å’Œæ¥æ”¶æ–¹æœ€å¥½å¯¹æ•°æ®åŒ…çš„å¤§å°åˆ¶å®šçº¦å®šè§„èŒƒã€‚ ç¤ºä¾‹ï¼š @Test public void testSend() throws IOException { DatagramSocket socket = new DatagramSocket(); byte[] msg = \"hello\".getBytes(); DatagramPacket packet = new DatagramPacket(msg, 0, msg.length, new InetSocketAddress(\"localhost\", 12306)); socket.send(packet); socket.close(); } @Test public void testReceive() throws IOException { DatagramSocket socket = new DatagramSocket(12306); byte[] buffer = new byte[1024]; DatagramPacket packet = new DatagramPacket(buffer,0, buffer.length); socket.receive(packet); System.out.println(packet.getPort()); System.out.println(new String(packet.getData(),0,packet.getLength())); socket.close(); } 3 DatagramChanneléœ€è¦äº†è§£çš„æ˜¯ï¼ŒUDPæœ¬èº«å°±ä¸å­˜åœ¨ä»€ä¹ˆé˜»å¡ï¼Œä¸éœ€è¦è¿æ¥ï¼Œåªåœ¨receiveçš„æ—¶å€™ä¼šé˜»å¡ç­‰å¾…æ•°æ®æŠ¥ã€‚ä½¿ç”¨DatagramChannelå¯ä»¥è®¾ç½®éé˜»å¡ï¼Œåˆ™åœ¨ä»DatagramChannelä¸­è¯»æ•°æ®æŠ¥çš„æ—¶å€™å¦‚æœæ²¡æœ‰æ•°æ®æŠ¥ï¼Œå°±å¯ä»¥ç«‹å³è¿”å›nullã€‚ ç›¸å…³APIï¼špublic abstract SocketAddress receive(ByteBuffer dst) throws IOException;","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"IO","slug":"IO","permalink":"https://www.codetool.top/tags/IO/"},{"name":"ç½‘ç»œç¼–ç¨‹","slug":"ç½‘ç»œç¼–ç¨‹","permalink":"https://www.codetool.top/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"}]},{"title":"leetcode1013-å°†æ•°ç»„åˆ†æˆå’Œç›¸ç­‰çš„ä¸‰ä¸ªéƒ¨åˆ†","slug":"leetcode1013-å°†æ•°ç»„åˆ†æˆå’Œç›¸ç­‰çš„ä¸‰ä¸ªéƒ¨åˆ†","date":"2020-03-10T17:49:43.000Z","updated":"2020-03-10T17:54:39.324Z","comments":true,"path":"article/leetcode1013-å°†æ•°ç»„åˆ†æˆå’Œç›¸ç­‰çš„ä¸‰ä¸ªéƒ¨åˆ†/","link":"","permalink":"https://www.codetool.top/article/leetcode1013-%E5%B0%86%E6%95%B0%E7%BB%84%E5%88%86%E6%88%90%E5%92%8C%E7%9B%B8%E7%AD%89%E7%9A%84%E4%B8%89%E4%B8%AA%E9%83%A8%E5%88%86/","excerpt":"","text":"1 åŸé¢˜ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ Aï¼Œåªæœ‰å¯ä»¥å°†å…¶åˆ’åˆ†ä¸ºä¸‰ä¸ªå’Œç›¸ç­‰çš„éç©ºéƒ¨åˆ†æ—¶æ‰è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚ å½¢å¼ä¸Šï¼Œå¦‚æœå¯ä»¥æ‰¾å‡ºç´¢å¼• i+1 &lt; j ä¸”æ»¡è¶³ (A[0] + A[1] + ... + A[i] == A[i+1] + A[i+2] + ... + A[j-1] == A[j] + A[j-1] + ... + A[A.length - 1]) å°±å¯ä»¥å°†æ•°ç»„ä¸‰ç­‰åˆ†ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: [0,2,1,-6,6,-7,9,1,2,0,1]è¾“å‡º: trueè§£é‡Š: 0 + 2 + 1 = -6 + 6 - 7 + 9 + 1 = 2 + 0 + 1 ç¤ºä¾‹ 2: è¾“å…¥: [0,2,1,-6,6,7,9,-1,2,0,1]è¾“å‡º: false ç¤ºä¾‹ 3: è¾“å…¥: [3,3,6,5,-2,2,5,1,-9,4]è¾“å‡º: trueè§£é‡Š: 3 + 3 = 6 = 5 - 2 + 2 + 5 + 1 - 9 + 4 æç¤ºï¼š 3 &lt;= A.length &lt;= 50000 -10^4 &lt;= A[i] &lt;= 10^4 2 è§£æ³•2.1 æ€æƒ³è¿™é“é¢˜çš„æ€æƒ³å°±æ˜¯ä¸€ä¸ªæ•°ç»„å¦‚æœèƒ½åˆ†æˆä¸‰ä¸ªå’Œç›¸ç­‰çš„éƒ¨åˆ†ï¼Œé¦–å…ˆè·å–è¿™ä¸ªå‡åˆ†çš„å€¼æ˜¯å¤šå°‘ï¼Œå‡è®¾æ˜¯xï¼Œç„¶åä»å·¦å¾€å³ç¬¬ä¸€ä¸ªå’Œä¸ºxçš„åŒºé—´å¿…é¡»è¦ç®—å…¥ï¼Œç¬¬äºŒä¸ªå’Œä¸ºxçš„åŒºé—´ä¹Ÿå¿…é¡»è¦ç®—å…¥ï¼Œå‰©ä¸‹çš„å…ƒç´ å°±å¿…é¡»æ˜¯ç¬¬ä¸‰ä¸ªåŒºé—´ï¼Œå³å’Œå¿…é¡»ä¸ºxã€‚ 2.2 ä»£ç class Solution { public boolean canThreePartsEqualSum(int[] A) { int sum = 0; for(int i:A) sum+=i; if(sum%3!=0) return false; int single = sum/3; int cur = 0; int count = 0; for(int i = 0;i&lt;A.length;i++){ cur+=A[i]; if(cur==single &amp;&amp; count!=2) { count+=1; if(count==2&amp;&amp;i==A.length-1) return false; cur = 0; } } return count==2 &amp;&amp; cur==single; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"åå¤§æ’åºç®—æ³•ä¸Javaå®ç°","slug":"åå¤§æ’åºç®—æ³•ä¸Javaå®ç°","date":"2020-03-10T17:08:02.000Z","updated":"2020-04-04T14:21:25.773Z","comments":true,"path":"article/åå¤§æ’åºç®—æ³•ä¸Javaå®ç°/","link":"","permalink":"https://www.codetool.top/article/%E5%8D%81%E5%A4%A7%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%E4%B8%8EJava%E5%AE%9E%E7%8E%B0/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š https://github.com/iTimeTraveler/SortAlgorithms åå¤§ç»å…¸æ’åºç®—æ³• - å†°ç‹¼çˆ±é­” - åšå®¢å›­ åå¤§ç»å…¸æ’åºç®—æ³•æ€»ç»“ï¼ˆJavaè¯­è¨€å®ç°ï¼‰_Java_wangçš„åšå®¢-CSDNåšå®¢ 1 æ’åºç®—æ³•æ¦‚è¿° å¯ä»¥çœ‹åˆ°æ—¶é—´å¤æ‚åº¦ä½çš„ç®—æ³•ç©ºé—´å¤æ‚åº¦é€šå¸¸è¾ƒé«˜ï¼Œç”šè‡³æœ€åä¸‰ç§ç®—æ³•å·²ç»æ²¡æœ‰åŸåœ°ç®—æ³•äº†ï¼Œè¿™å°±æ˜¯å¸¸è¯´çš„â€œç”¨ç©ºé—´æ¢æ—¶é—´â€ï¼Œè¶Šå¾€åè¶Šä¸æ¥è¿‘äººçš„è‡ªç„¶æ€æƒ³ï¼Œå¯èƒ½å°±ä¼šæ›´éš¾ç†è§£ï¼Œæ¯•ç«Ÿäººé€šå¸¸æ˜¯ä¸ä¼šåœ¨è„‘å­é‡Œæ’åºçš„æ—¶å€™ä¸ºè¿™ä¸ªæ•°ç»„å¼€è¾Ÿå‡ºä¸€å—æ–°åŒºåŸŸç”¨ç©ºé—´æ¢æ—¶é—´çš„ã€‚ 2 æ’å…¥æ’åºæ’å…¥æ’åºæŠŠæ•°ç»„åˆ†ä¸ºå·²æ’åºçš„éƒ¨åˆ†å’Œæœªæ’åºçš„éƒ¨åˆ†ï¼Œè¿™ç§ç®—æ³•é€šå¸¸é‡‡ç”¨åŸåœ°ç­–ç•¥ï¼Œå°†æ¯ä¸ªå…ƒç´ ä¸ä¹‹å‰çš„å…ƒç´ äº¤æ¢ï¼Œç›´åˆ°æ‰¾åˆ°åˆé€‚çš„ä½ç½®ã€‚ Javaä»£ç ï¼š public void insertionSort2(int[] arr){ for(int i=0; i&lt;arr.length-1; i++ ) { for( int j=i+1; j>0; j-- ) { if( arr[j-1] &lt;= arr[j] ) break; int temp = arr[j]; //äº¤æ¢æ“ä½œ arr[j] = arr[j-1]; arr[j-1] = temp; } } System.out.println(Arrays.toString(arr)); } 3 é€‰æ‹©æ’åºé€‰æ‹©æ’åºä¹Ÿæ˜¯å¾ˆæ¥è¿‘äººçš„è‡ªç„¶æ€æƒ³çš„ä¸€ç§æ’åºæ–¹æ³•ï¼Œä¹Ÿåˆ†ä¸ºå·²æ’åºçš„éƒ¨åˆ†å’Œæœªæ’åºçš„éƒ¨åˆ†ï¼Œç›´æ¥åœ¨æœªæ’åºçš„åºåˆ—ä¸­æ‰¾åˆ°æœ€å°å€¼ï¼Œé™„åŠ åˆ°å·²æ’åºçš„åºåˆ—æœ«å°¾ï¼ˆå’Œæœªæ’åºåºåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼‰ Javaä»£ç ï¼š public void insertionSort2(int[] arr){ for(int i=0; i&lt;arr.length-1; i++ ) { for( int j=i+1; j>0; j-- ) { if( arr[j-1] &lt;= arr[j] ) break; int temp = arr[j]; //äº¤æ¢æ“ä½œ arr[j] = arr[j-1]; arr[j-1] = temp; } } System.out.println(Arrays.toString(arr)); } 4 å†’æ³¡æ’åºå†’æ³¡æ’åºçš„æ€æƒ³ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œæ¯æ¬¡éå†æ¯”è¾ƒç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ ï¼Œå°†å®ƒä»¬çš„é¡ºåºæ’å¥½ï¼Œè¿™æ ·ä¸€ç›´éå†ç›´åˆ°æ‰€æœ‰å…ƒç´ è¢«æ­£ç¡®æ’åºã€‚ /** * å†’æ³¡æ’åº * * â‘ . æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢ä»–ä»¬ä¸¤ä¸ªã€‚ * â‘¡. å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ ä½œåŒæ ·çš„å·¥ä½œï¼Œä»å¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åä¸€å¯¹ã€‚è¿™æ­¥åšå®Œåï¼Œæœ€åçš„å…ƒç´ ä¼šæ˜¯æœ€å¤§çš„æ•°ã€‚ * â‘¢. é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åä¸€ä¸ªã€‚ * â‘£. æŒç»­æ¯æ¬¡å¯¹è¶Šæ¥è¶Šå°‘çš„å…ƒç´ é‡å¤ä¸Šé¢çš„æ­¥éª¤â‘ ~â‘¢ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•ä¸€å¯¹æ•°å­—éœ€è¦æ¯”è¾ƒã€‚ * @param arr å¾…æ’åºæ•°ç»„ */ public static void bubbleSort(int[] arr){ for (int i = arr.length - 1; i > 0; i--) { //å¤–å±‚å¾ªç¯ç§»åŠ¨æ¸¸æ ‡ for(int j = 0; j &lt; i; j++){ //å†…å±‚å¾ªç¯éå†æ¸¸æ ‡åŠä¹‹å(æˆ–ä¹‹å‰)çš„å…ƒç´  if(arr[j] > arr[j+1]){ int temp = arr[j]; arr[j] = arr[j+1]; arr[j+1] = temp; System.out.println(\"Sorting: \" + Arrays.toString(arr)); } } } } 5 å½’å¹¶æ’åº è¿™ä¸ªçš„æ€æƒ³å°±æ˜¯åˆ†æ²»å•¦ï¼Œå…ˆæŠŠæ•°ç»„æ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªå…ƒç´ çš„å­åºåˆ—ï¼Œç„¶åä¸€ç›´åœ¨åˆå¹¶ä¸¤ä¸ªå­åºåˆ—ï¼ˆåŒæŒ‡é’ˆæ³•ï¼‰ï¼Œç›´åˆ°åˆå¹¶å›ä¸€ä¸ªå®Œæ•´çš„æ•°ç»„ã€‚ /** * å½’å¹¶æ’åºï¼Œé€’å½’æ–¹æ³• * * @param array * @return */ public static int[] MergeSort(int[] array) { if (array.length &lt; 2) return array; int mid = array.length / 2; int[] left = Arrays.copyOfRange(array, 0, mid); int[] right = Arrays.copyOfRange(array, mid, array.length); return merge(MergeSort(left), MergeSort(right)); } /** * å½’å¹¶æ’åºâ€”â€”å°†ä¸¤æ®µæ’åºå¥½çš„æ•°ç»„ç»“åˆæˆä¸€ä¸ªæ’åºæ•°ç»„ * * @param left * @param right * @return */ public static int[] merge(int[] left, int[] right) { int[] result = new int[left.length + right.length]; for (int index = 0, i = 0, j = 0; index &lt; result.length; index++) { if (i >= left.length) result[index] = right[j++]; else if (j >= right.length) result[index] = left[i++]; else if (left[i] > right[j]) result[index] = right[j++]; else result[index] = left[i++]; } return result; } 6 å †æ’åºè¿™ä¸ªä¹‹å‰å·²ç»å†™è¿‡å•¦ï¼Œè§å¸¦æœ‰ä¼˜å…ˆçº§çš„å®Œå…¨äºŒå‰æ ‘-å † 7 å¿«é€Ÿæ’åºå¿«é€Ÿæ’åºçš„æ€æƒ³ä¹Ÿæ˜¯åˆ†æ²»ï¼Œæˆ‘ä»¬ä»æ•°ç»„ä¸­é€‰æ‹©ä¸€ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå…ƒç´ ç§°ä¹‹ä¸ºä¸­è½´å…ƒç´ ï¼ˆåŸºå‡†ï¼‰å§ï¼Œç„¶åæŠŠæ•°ç»„ä¸­æ‰€æœ‰å°äºä¸­è½´å…ƒç´ çš„å…ƒç´ æ”¾åœ¨å…¶å·¦è¾¹ï¼Œæ‰€æœ‰å¤§äºæˆ–ç­‰äºä¸­è½´å…ƒç´ çš„å…ƒç´ æ”¾åœ¨å…¶å³è¾¹ï¼Œæ˜¾ç„¶ï¼Œæ­¤æ—¶ä¸­è½´å…ƒç´ æ‰€å¤„çš„ä½ç½®çš„æ˜¯æœ‰åºçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ— éœ€å†ç§»åŠ¨ä¸­è½´å…ƒç´ çš„ä½ç½®ã€‚ ä»ä¸­è½´å…ƒç´ é‚£é‡Œå¼€å§‹æŠŠå¤§çš„æ•°ç»„åˆ‡å‰²æˆä¸¤ä¸ªå°çš„æ•°ç»„(ä¸¤ä¸ªæ•°ç»„éƒ½ä¸åŒ…å«ä¸­è½´å…ƒç´ )ï¼Œæ¥ç€æˆ‘ä»¬é€šè¿‡é€’å½’çš„æ–¹å¼ï¼Œè®©ä¸­è½´å…ƒç´ å·¦è¾¹çš„æ•°ç»„å’Œå³è¾¹çš„æ•°ç»„ä¹Ÿé‡å¤åŒæ ·çš„æ“ä½œï¼Œç›´åˆ°æ•°ç»„çš„å¤§å°ä¸º1ï¼Œæ­¤æ—¶æ¯ä¸ªå…ƒç´ éƒ½å¤„äºæœ‰åºçš„ä½ç½®ã€‚ public class QuickSort { public static int[] quickSort(int[] arr, int left, int right) { if (left &lt; right) { //è·å–ä¸­è½´å…ƒç´ æ‰€å¤„çš„ä½ç½® int mid = partition(arr, left, right); //è¿›è¡Œåˆ†å‰² arr = quickSort(arr, left, mid - 1); arr = quickSort(arr, mid + 1, right); } return arr; } //æ¯æ¬¡éƒ½å‡è®¾ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ä¸­è½´å…ƒç´ ï¼Œä½†åˆ†æˆä¸¤ä¸ªåºåˆ—å—ä¹‹åè¦æŠŠä¸­è½´å…ƒç´ äº¤æ¢åˆ°ä¸­é—´ private static int partition(int[] arr, int left, int right) { //é€‰å–ä¸­è½´å…ƒç´  int pivot = arr[left]; int i = left + 1; int j = right; while (true) { // å‘å³æ‰¾åˆ°ç¬¬ä¸€ä¸ªå°äºç­‰äº pivot çš„å…ƒç´ ä½ç½® while (i &lt;= j &amp;&amp; arr[i] &lt;= pivot) i++; // å‘å·¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºç­‰äº pivot çš„å…ƒç´ ä½ç½® while(i &lt;= j &amp;&amp; arr[j] >= pivot ) j--; if(i >= j) break; //äº¤æ¢ä¸¤ä¸ªå…ƒç´ çš„ä½ç½®ï¼Œä½¿å¾—å·¦è¾¹çš„å…ƒç´ ä¸å¤§äºpivot,å³è¾¹çš„ä¸å°äºpivot int temp = arr[i]; arr[i] = arr[j]; arr[j] = temp; } arr[left] = arr[j]; // ä½¿ä¸­è½´å…ƒç´ å¤„äºæœ‰åºçš„ä½ç½® arr[j] = pivot; return j; } } å¿«é€Ÿæ’åºçš„æœ€åæƒ…å†µè¿˜æ˜¯è›®ææ€–çš„ï¼Œå¦‚æœæ¯ä¸€æ¬¡é€‰å–çš„ä¸­è½´å…ƒç´ éƒ½æ˜¯å½“å‰åºåˆ—æœ€å¤§/æœ€å°çš„å…ƒç´ ã€‚ è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆå¿«é€Ÿæ’åºæ˜¯åŸåœ°ç®—æ³•ï¼Œç©ºé—´å¤æ‚åº¦è¿˜æ˜¯O(logN)ï¼Œæ˜¯å› ä¸ºè¿™ä¸ªç©ºé—´å¤æ‚åº¦è®¡ç®—äº†é€’å½’è°ƒç”¨æ ˆç©ºé—´çš„ä½¿ç”¨ï¼Œæ ˆçš„æ·±åº¦ä¸ºlogNã€‚ 8 å¸Œå°”æ’åºå¸Œå°”æ’åºæ˜¯æ’å…¥æ’åºçš„æ”¹è¿›ç®—æ³•ï¼Œå®ƒæŒ‰æŒ‰ä¸€å®šçš„é—´éš”ä¸ºé€»è¾‘åˆ†ç»„è¿›è¡Œæ’å…¥æ’åºï¼Œè¿™ä¸ªé—´éš”ä¼šæ…¢æ…¢ç¼©å°ã€‚ å…ˆè®©æ•°ç»„ä¸­ä»»æ„é—´éš”ä¸º h çš„å…ƒç´ æœ‰åºï¼Œåˆšå¼€å§‹ h çš„å¤§å°å¯ä»¥æ˜¯ h = n / 2,æ¥ç€è®© h = n / 4ï¼Œè®© h ä¸€ç›´ç¼©å°ï¼Œå½“ h = 1 æ—¶ï¼Œä¹Ÿå°±æ˜¯æ­¤æ—¶æ•°ç»„ä¸­ä»»æ„é—´éš”ä¸º1çš„å…ƒç´ æœ‰åºï¼Œæ­¤æ—¶çš„æ•°ç»„å°±æ˜¯æœ‰åºçš„äº†ã€‚ å¸Œå°”æ’åºéš¾å¾—åœ¨æ—¶é—´å¤æ‚åº¦ä¸ºO(nlogn)çš„ç®—æ³•ä¹‹ä¸­è¿˜ç»´æŒç€åŸåœ°æ’åºO(1)çš„æ—¶é—´å¤æ‚åº¦ï¼Œå…¶æ€æƒ³å€¼å¾—å­¦ä¹ ã€‚ public class ShellSort { public static int[] shellSort(int arr[]) { if (arr == null || arr.length &lt; 2) return arr; int n = arr.length; // å¯¹æ¯ç»„é—´éš”ä¸º hçš„åˆ†ç»„è¿›è¡Œæ’åºï¼Œåˆšå¼€å§‹ h = n / 2; for (int h = n / 2; h > 0; h /= 2) { //å¯¹å„ä¸ªå±€éƒ¨åˆ†ç»„è¿›è¡Œæ’å…¥æ’åº for (int i = h; i &lt; n; i++) { // å°†arr[i] æ’å…¥åˆ°æ‰€åœ¨åˆ†ç»„çš„æ­£ç¡®ä½ç½®ä¸Š insertI(arr, h, i); } } return arr; } /** * å°†arr[i]æ’å…¥åˆ°æ‰€åœ¨åˆ†ç»„çš„æ­£ç¡®ä½ç½®ä¸Š * arr[i]] æ‰€åœ¨çš„åˆ†ç»„ä¸º ... arr[i-2*h],arr[i-h], arr[i+h] ... */ private static void insertI(int[] arr, int h, int i) { int temp = arr[i]; int k; for (k = i - h; k > 0 &amp;&amp; temp &lt; arr[k]; k -= h) { arr[k + h] = arr[k]; } arr[k + h] = temp; } } 9 è®¡æ•°æ’åºè®¡æ•°æ’åºå°±å¾ˆåƒbitmapäº†ï¼ˆè§æµ·é‡æ•°æ®ç®—æ³•-BitMapä»‹ç»å’Œå®ç°ï¼‰ï¼Œå¦‚æœå›æƒ³bitmapï¼Œå®ƒçš„æ’åºæ•ˆç‡æ˜¯æé«˜çš„ï¼Œä½†å…ƒç´ ä¸èƒ½é‡å¤ï¼Œå¦‚æœè¦è§£å†³å…ƒç´ ä¸èƒ½é‡å¤çš„é—®é¢˜ï¼Œå°±å¯ä»¥å°†bitï¼ˆè¡¨ç¤ºæ˜¯å¦å­˜åœ¨ï¼‰è½¬ä¸ºintï¼ˆè¡¨ç¤ºå‡ºç°äº†å¤šå°‘æ¬¡ï¼‰ã€‚ è¿™ç§ç®—æ³•çš„é—®é¢˜å°±å¾ˆæ˜æ˜¾äº†ï¼Œé¦–å…ˆå¾—çŸ¥é“å…ƒç´ å–å€¼çš„èŒƒå›´ï¼Œå¦‚æœèŒƒå›´å¤ªå¤§è¿˜å¾—ç”¨intå­˜å‚¨ç©ºé—´å¤æ‚åº¦æé«˜ã€‚æ‰€ä»¥å®ƒé€‚ç”¨äºå–å€¼èŒƒå›´ä¸å¤§çš„æ•°ç»„æ’åºã€‚ç„¶åå…ƒç´ åªèƒ½æ˜¯æ•´æ•°ï¼Œå¦åˆ™æ— æ³•å’Œæ•°ç»„çš„ä¸‹æ ‡å…³è”èµ·æ¥ã€‚ 10 æ¡¶æ’åºæ¡¶æ’åºä¹Ÿå¾—çŸ¥é“å…ƒç´ çš„å–å€¼èŒƒå›´ï¼Œå®ƒæ˜¯æŠŠæ‰€æœ‰å…ƒç´ æŒ‰å–å€¼èŒƒå›´åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªåŒºé—´ï¼ˆæ¡¶ï¼‰ï¼Œæ¡¶çš„ä¸ªæ•°é€šå¸¸å°±ç­‰äºæ•°ç»„çš„å¤§å°ï¼ŒæŒ‰(array[i] - min) * (bucketNum-1) / då°†å…ƒç´ åˆ’åˆ†åˆ°æ¡¶ä¸­ï¼ˆå³æŒ‰å–å€¼èŒƒå›´å‡åˆ†ï¼‰ã€‚ç„¶ååœ¨æ¯ä¸ªæ¡¶å†…æŒ‰å½’å¹¶æ’åºæˆ–å¿«é€Ÿæ’åºç®—æ³•æ’åºï¼Œç”±äºæ¡¶ä¹‹é—´æœ¬æ¥å°±æ˜¯æœ‰åºçš„ï¼Œå†æŠŠå®ƒä»¬æŒ‰æ¡¶çš„é¡ºåºè¿æ¥èµ·æ¥å³å¯ã€‚ 11 åŸºæ•°æ’åºåŸºæ•°æ’åºçš„æ’åºæ€è·¯æ˜¯è¿™æ ·çš„ï¼šå…ˆä»¥ä¸ªä½æ•°çš„å¤§å°æ¥å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œæ¥ç€ä»¥åä½æ•°çš„å¤§å°æ¥å¤šæ•°è¿›è¡Œæ’åºï¼Œæ¥ç€ä»¥ç™¾ä½æ•°çš„å¤§å°â€¦â€¦ æ’åˆ°æœ€åï¼Œå°±æ˜¯ä¸€ç»„æœ‰åºçš„å…ƒç´ äº†ã€‚ä¸è¿‡ï¼Œå®ƒåœ¨ä»¥æŸä½æ•°è¿›è¡Œæ’åºçš„æ—¶å€™ï¼Œæ˜¯ç”¨â€œæ¡¶â€æ¥æ’åºçš„ã€‚ ç”±äºæŸä½æ•°ï¼ˆä¸ªä½/åä½â€¦.ï¼Œä¸æ˜¯ä¸€æ•´ä¸ªæ•°ï¼‰çš„å¤§å°èŒƒå›´ä¸º0-9ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦10ä¸ªæ¡¶ï¼Œç„¶åæŠŠå…·æœ‰ç›¸åŒæ•°å€¼çš„æ•°æ”¾è¿›åŒä¸€ä¸ªæ¡¶é‡Œï¼Œä¹‹åå†æŠŠæ¡¶é‡Œçš„æ•°æŒ‰ç…§0å·æ¡¶åˆ°9å·æ¡¶çš„é¡ºåºå–å‡ºæ¥ï¼Œè¿™æ ·ä¸€è¶Ÿä¸‹æ¥ï¼ŒæŒ‰ç…§æŸä½æ•°çš„æ’åºå°±å®Œæˆäº†","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"SpringBootå¼€å‘RESTful API","slug":"SpringBootå¼€å‘RESTful API","date":"2020-03-10T13:43:20.000Z","updated":"2020-03-10T13:44:12.838Z","comments":true,"path":"article/SpringBootå¼€å‘RESTful API/","link":"","permalink":"https://www.codetool.top/article/SpringBoot%E5%BC%80%E5%8F%91RESTful%20API/","excerpt":"","text":"1 RESTful APIRESTful APIæ˜¯é¢å‘èµ„æºçš„ï¼Œä»–è®¤ä¸ºä¸€åˆ‡URIçš†èµ„æºï¼Œæ‰€ä»¥URIä¸€å®šè¦æ˜¯åè¯è€Œä¸æ˜¯åŠ¨è¯ï¼ŒåŠ¨è¯çš„å«ä¹‰é€šè¿‡è¯·æ±‚æ–¹æ³•æ¥è¡¨è¾¾ã€‚æœ‰äº†èµ„æºè¿˜éœ€è¦ç¡®å®šå¦‚ä½•è¡¨ç°è¿™ä¸ªèµ„æºï¼Œä¾‹å¦‚JSONã€XMLï¼Œè¿™å°±ç§°ä¸ºè¡¨ç°å±‚ã€‚ GET /getUserInfo?id=15-&gt;GET /users/15 ä¹Ÿä¸è¦åœ¨URIä¸­åŠ å…¥ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚/v1/usersï¼Œå¦‚æœéœ€è¦å¤šç‰ˆæœ¬çš„APIï¼Œè¯·åœ¨è¯·æ±‚ä¸­å¸¦ä¸Šç‰ˆæœ¬å·ï¼Œä¾‹å¦‚Accept: version = 1.0ã€‚ æ¦‚æ‹¬ï¼š çœ‹URLå°±çŸ¥é“è¦ä»€ä¹ˆèµ„æº çœ‹http methodå°±çŸ¥é“é’ˆå¯¹èµ„æºå¹²ä»€ä¹ˆ çœ‹http status codeå°±çŸ¥é“ç»“æœå¦‚ä½• å¸¸ç”¨è¯·æ±‚æ–¹æ³•ï¼š GET ï¼š è·å–ã€è¯»å–èµ„æº POST ï¼š æ·»åŠ èµ„æº PUT ï¼š ä¿®æ”¹èµ„æº DELETE ï¼š åˆ é™¤èµ„æº åŸºç¡€çŠ¶æ€ç ï¼š 200 OK 400 Bad Request 500 Internal Server Error é€šå¸¸200è¡¨ç¤ºæˆåŠŸï¼Œ400è¡¨ç¤ºå®¢æˆ·ç«¯é”™è¯¯ï¼ˆè¯·æ±‚æ ¼å¼ï¼‰ï¼Œ500è¡¨ç¤ºæœåŠ¡ç«¯é”™è¯¯ï¼ˆæœåŠ¡å†…éƒ¨å¼‚å¸¸ï¼‰ å…¶ä»–å¸¸ç”¨çŠ¶æ€ç ï¼š 201 å·²åˆ›å»ºã€‚æˆåŠŸè¯·æ±‚å¹¶åˆ›å»ºäº†æ–°çš„èµ„æº 3xx ä»£è¡¨çš„æ˜¯é‡å®šå‘ï¼Œä¾‹å¦‚301ï¼ˆæ°¸ä¹…ç§»åŠ¨ï¼‰ã€303é‡å®šå‘ã€302ï¼ˆæš‚æ—¶ç§»åŠ¨ï¼‰ 401 æœªé€šè¿‡èº«ä»½è®¤è¯ 403 æ‹’ç»æœåŠ¡è¯¥è¯·æ±‚ 409 æœåŠ¡å™¨å®Œæˆå®¢æˆ·ç«¯çš„ PUT è¯·æ±‚æ—¶å¯èƒ½è¿”å›æ­¤ä»£ç ï¼ŒæœåŠ¡å™¨å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿäº†å†²çª 410 èµ„æºæ›¾ç»å­˜åœ¨ï¼Œä½†ç›®å‰è¢«æ°¸ä¹…åˆ é™¤ã€‚ 502 ä½œä¸ºç½‘å…³æˆ–è€…ä»£ç†å·¥ä½œçš„æœåŠ¡å™¨å°è¯•æ‰§è¡Œè¯·æ±‚æ—¶ï¼Œä»è¿œç¨‹æœåŠ¡å™¨æ¥æ”¶åˆ°äº†ä¸€ä¸ªæ— æ•ˆçš„å“åº” 504 å……å½“ç½‘å…³æˆ–ä»£ç†çš„æœåŠ¡å™¨ï¼ŒæœªåŠæ—¶ä»è¿œç«¯æœåŠ¡å™¨è·å–è¯·æ±‚ å…¶ä»–çŠ¶æ€ç å¯ä»¥å‚è€ƒï¼š HTTPçŠ¶æ€ç  | èœé¸Ÿæ•™ç¨‹ 2 RESTful APIç›¸å…³æ³¨è§£ @RestControllerï¼šä»£æ›¿@Controller+@ResponseBody @xxxMapping @GetMappingï¼šä»£æ›¿@RequestMapping(...,method=GET) @PostMappingï¼šä»£æ›¿@RequestMapping(...,method=POST) @PutMappingï¼šä»£æ›¿@RequestMapping(...,method=PUT) @DeleteMappingï¼šä»£æ›¿@RequestMapping(...,method=DELETE) @PathVariableï¼šæ¥æ”¶URLä¸Šçš„å‚æ•° @RequestParamï¼šæ¥æ”¶è¯·æ±‚ä½“ä¸Šçš„å‚æ•° åœ¨@xxxMappingå’Œ@RequestMappingä¸­ï¼Œæœ‰ä¸¤ä¸ªå±æ€§éœ€è¦å…³æ³¨ï¼šconsumeså’Œproducesï¼Œå¯ä»¥ä¸ºå®ƒä»¬æŒ‡å®šMediaTypeä¸­çš„å€¼æ¥é™å®šè¯¥æ–¹æ³•æ¥æ”¶ä»€ä¹ˆç±»å‹çš„è¯·æ±‚ä½“å’Œè¿”å›ä»€ä¹ˆç±»å‹ã€‚ @PathVariableç¤ºä¾‹ï¼š //è¯·æ±‚çš„urlä¾‹å¦‚â€œ/article/1â€ @DeleteMapping(\"/article/{id}\") public @ResponseBody AjaxResponse deleteArticle(@PathVariable Long id) { @RequestBodyï¼šæ¥æ”¶è¯·æ±‚ä½“ä¸­çš„å¤æ‚æ•°æ®å¹¶è½¬ä¸ºjavaå¯¹è±¡ JSONæ•°æ®å’ŒJavaå¯¹è±¡è‡ªåŠ¨é€šè¿‡HttpMessageConverterï¼ˆè¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…·ä½“åˆ°JSONæœ‰Jacksonæä¾›çš„å®ç°ç±»ï¼‰å®Œæˆè½¬æ¢ã€‚ 3 å¤„ç†HTTPçŠ¶æ€ç ã€å¼‚å¸¸å’Œå“åº”å¤´å¦‚æœåªç”¨@RestControlleræ­é…æ–¹æ³•è¿”å›Stringï¼Œé‚£ä¹ˆæ˜¾ç„¶åªèƒ½å…³æ³¨å“åº”ä½“ï¼Œå¦‚æœéœ€è¦å¤„ç†HTTPçŠ¶æ€ç ã€æ–¹æ³•ä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸å’Œå“åº”å¤´ï¼Œå°±éœ€è¦é¢å¤–çš„æ“ä½œã€‚ Springæä¾›äº†å®ä½“å°è£…ç±»ResponseEntityå’Œæ³¨è§£@ResponseStatusã€‚ ResponseEntityå¯ä»¥æœ‰æ•ˆåœ°å°è£…é”™è¯¯æ¶ˆæ¯ã€å“åº”å¤´å’ŒçŠ¶æ€ç ï¼Œ@ResponseStatusç›¸å¯¹åŠŸèƒ½æ›´å°‘ï¼Œå¯ä»¥é…ç½®æŒ‡å®šçš„çŠ¶æ€ç è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ï¼ˆHttpStatusä¸­æšä¸¾äº†è®¸å¤šçŠ¶æ€ç ï¼‰ ç¤ºä¾‹ï¼šï¼ˆä½¿ç”¨äº†lombokï¼‰ @Slf4j @RestController @RequestMapping(\"/article\") public class ArticleRestController { //å¢åŠ ä¸€ç¯‡Article ï¼Œä½¿ç”¨POSTæ–¹æ³• @ResponseStatus(HttpStatus.CREATED) @RequestMapping(value = \"/\", method = POST, produces = \"application/json\") public String saveArticle(@RequestBody Article article) { log.info(\"saveArticleï¼š{}\",article); return \"{\\\"status\\\":1,\\\"msg\\\":\\\"success\\\"}\"; } //è·å–ä¸€ç¯‡Article ï¼Œä½¿ç”¨GETæ–¹æ³• @RequestMapping(value = \"/{id}\", method = GET, produces = \"application/json\") public ResponseEntity&lt;Article> getArticle(@PathVariable long id) { Article article = Article.builder() .id(1) .author(\"123\") .content(\"456\") .createTime(new Date()) .title(\"789\").build(); HttpHeaders headers = new HttpHeaders(); headers.add(\"success\",\"success\"); return new ResponseEntity&lt;>(article,headers,HttpStatus.OK); } } è‡³äºå¤„ç†å¼‚å¸¸ï¼Œéœ€è¦ä¸¤ä¸ªæ³¨è§£ï¼š@ControllerAdviceå’Œ@ExceptionHandlerã€‚ @ControllerAdviceçš„ä½œç”¨æ˜¯ç»™æ§åˆ¶å™¨å¢åŠ é€šçŸ¥ï¼Œä½œç”¨äºç±»ä¸Šï¼Œå®šä¹‰äº†ä¸€ä¸ªæ§åˆ¶å™¨çš„é€šçŸ¥ç±»ã€‚ @ExceptionHandleré…åˆ@ControllerAdviceä½¿ç”¨å®šä¹‰æ§åˆ¶å™¨å‘ç”Ÿå¼‚å¸¸åçš„æ“ä½œï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå‘ç”Ÿå¼‚å¸¸åï¼Œå¯ä»¥è·³è½¬åˆ°æŒ‡å®šçš„é”™è¯¯é¡µé¢ï¼Œä»¥é¿å…ç”¨æˆ·ä½¿ç”¨çš„ä¸å‹å¥½ã€‚ ç¤ºä¾‹ï¼ˆåœ¨MVCä¸­ï¼‰ï¼š @ControllerAdvice( //æŒ‡å®šæ‹¦æˆªçš„åŒ… basePackages = {\"com.rhett.bootweb.controller.*\"}, //è¢«æ ‡æ³¨ä¸º@Controllerçš„ç±»æ‰æ‹¦æˆª annotations = Controller.class ) public class ErrorControllerAdvice { @ExceptionHandler public String exception(Model model, Exception ex){ //ç»™æ•°æ®æ¨¡å‹å¢åŠ å¼‚å¸¸ä¿¡æ¯ model.addAttribute(\"exception_message\",ex.getMessage()); //è¿”å›å¼‚å¸¸è§†å›¾ return \"exception\"; } } ç¤ºä¾‹ï¼ˆåœ¨RESTful APIä¸­ï¼‰ï¼š @ControllerAdvice( basePackages = {\"com.rhett.bootweb.controller.*\"}, annotations = Controller.class ) public class ErrorControllerAdvice { @ExceptionHandler @ResponseBody //è¿”å›é”™è¯¯çŠ¶æ€ç  @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR) public Map&lt;String,Object> exception(HttpServletRequest request, Exception ex){ Map&lt;String,Object> msgMap = new HashMap&lt;>(); //è·å–å¼‚å¸¸ä¿¡æ¯ msgMap.put(\"message\",ex.getMessage()); msgMap.put(\"cause\",ex.getStackTrace()); return msgMap; } } @ExceptionHandlerè¿˜å¯ä»¥æŒ‡å®šä¸€ä¸ªvalueï¼Œä¸ºæŸä¸€ä¸ªå…·ä½“Excepetionçš„classå¯¹è±¡ï¼Œåªé’ˆå¯¹æŸä¸€å…·ä½“å¼‚å¸¸è¿›è¡Œæ‹¦æˆªã€‚ @ControllerAdviceè¿˜å¯ä»¥é…åˆ@InitBinderä½¿ç”¨ï¼ˆåœ¨æ§åˆ¶å™¨å‚æ•°è½¬æ¢å‰è¢«æ‰§è¡Œçš„ä»£ç ï¼‰","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.codetool.top/tags/SpringBoot/"}]},{"title":"Springå£°æ˜å¼äº‹åŠ¡ç®¡ç†ä»‹ç»","slug":"Springå£°æ˜å¼äº‹åŠ¡ç®¡ç†ä»‹ç»","date":"2020-03-10T11:23:43.000Z","updated":"2020-03-10T11:34:33.255Z","comments":true,"path":"article/Springå£°æ˜å¼äº‹åŠ¡ç®¡ç†ä»‹ç»/","link":"","permalink":"https://www.codetool.top/article/Spring%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E4%BB%8B%E7%BB%8D/","excerpt":"","text":"ä¸ºäº†å‡å°‘æ‰‹åŠ¨ç¼–å†™ç®¡ç†äº‹åŠ¡çš„è¯­å¥ï¼ŒSpringåˆ©ç”¨AOPä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡çš„çº¦å®šæµç¨‹ã€‚ spring æ¡†æ¶ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç»„äº‹åŠ¡æ§åˆ¶çš„æ¥å£ã€‚è¿™ç»„æ¥å£æ˜¯åœ¨spring-tx-5.0.2.RELEASE.jar ä¸­ã€‚ å¯¹äºäº‹åŠ¡,éœ€è¦é€šè¿‡æ ‡æ³¨å‘Šè¯‰Springåœ¨ä»€ä¹ˆåœ°æ–¹å¯ç”¨æ•°æ®åº“äº‹åŠ¡åŠŸèƒ½ã€‚å¯¹äºå£°æ˜å¼äº‹åŠ¡,æ˜¯ä½¿ç”¨@Transactionalè¿›è¡Œæ ‡æ³¨çš„ã€‚è¿™ä¸ªæ³¨è§£å¯ä»¥æ ‡æ³¨åœ¨ç±»æˆ–è€…æ–¹æ³•ä¸Šï¼Œå½“å®ƒæ ‡æ³¨åœ¨ç±»ä¸Šæ—¶ï¼Œä»£è¡¨è¿™ä¸ªç±»æ‰€æœ‰å…¬å…±(public)éé™æ€çš„æ–¹æ³•éƒ½å°†å¯ç”¨äº‹åŠ¡åŠŸèƒ½ã€‚ åœ¨@Transactionalä¸­,è¿˜å…è®¸é…ç½®è®¸å¤šçš„å±æ€§,å¦‚äº‹åŠ¡çš„éš”ç¦»çº§åˆ«å’Œä¼ æ’­è¡Œä¸ºã€å¼‚å¸¸ç±»å‹,ä»è€Œç¡®å®šæ–¹æ³•å‘ç”Ÿä»€ä¹ˆå¼‚å¸¸ä¸‹å›æ»šäº‹åŠ¡æˆ–è€…å‘ç”Ÿä»€ä¹ˆå¼‚å¸¸ä¸‹ä¸å›æ»šäº‹åŠ¡ç­‰ã€‚è¿™äº›é…ç½®å†…å®¹,æ˜¯åœ¨ Spring IoCå®¹å™¨åœ¨åŠ è½½æ—¶å°±ä¼šå°†è¿™äº›é…ç½®ä¿¡æ¯è§£æå‡ºæ¥,ç„¶åæŠŠè¿™äº›ä¿¡æ¯å­˜åˆ°äº‹åŠ¡å®šä¹‰å™¨(TransactionDefinitionæ¥å£çš„å®ç°ç±»ï¼‰é‡Œ,å¹¶ä¸”è®°å½•å“ªäº›ç±»æˆ–è€…æ–¹æ³•éœ€è¦å¯åŠ¨äº‹åŠ¡åŠŸèƒ½,é‡‡å–ä»€ä¹ˆç­–ç•¥å»æ‰§è¡Œäº‹åŠ¡ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­,æˆ‘ä»¬æ‰€éœ€è¦åšçš„åªæ˜¯ç»™éœ€è¦äº‹åŠ¡çš„ç±»æˆ–è€…æ–¹æ³•æ ‡æ³¨@Transactionalå’Œé…ç½®å…¶å±æ€§è€Œå·²,å¹¶ä¸æ˜¯å¾ˆå¤æ‚ã€‚ 1 Springä¸­çš„äº‹åŠ¡æ§åˆ¶APIä»‹ç»mavenä¾èµ–ï¼š &lt;dependency> &lt;groupId>org.springframework&lt;/groupId> &lt;artifactId>spring-tx&lt;/artifactId> &lt;version>5.2.3.RELEASE&lt;/version> &lt;/dependency> å¦‚æœä½¿ç”¨springbootå¯ä»¥é…åˆjpaã€mybatisï¼Œæˆ–è€…å¯¼å…¥jdbc-starterï¼Œéƒ½ä¼šåŒ…å«ï¼š &lt;dependency> &lt;groupId>org.mybatis.spring.boot&lt;/groupId> &lt;artifactId>mybatis-spring-boot-starter&lt;/artifactId> &lt;version>2.1.1&lt;/version> &lt;/dependency> 1.1 PlatformTransactionManageræ­¤æ¥å£æ˜¯ spring çš„äº‹åŠ¡ç®¡ç†å™¨ï¼Œå®ƒé‡Œé¢æä¾›äº†æˆ‘ä»¬å¸¸ç”¨çš„æ“ä½œäº‹åŠ¡çš„æ–¹æ³• public interface PlatformTransactionManager extends TransactionManager { TransactionStatus getTransaction(@Nullable TransactionDefinition definition) throws TransactionException; /*æäº¤äº‹åŠ¡*/ void commit(TransactionStatus status) throws TransactionException; /*å›æ»šäº‹åŠ¡*/ void rollback(TransactionStatus status) throws TransactionException; } æˆ‘ä»¬åœ¨å¼€å‘ä¸­éƒ½æ˜¯ä½¿ç”¨å®ƒçš„å®ç°ç±»ï¼Œå¯¹äºMybatisï¼Œæˆ‘ä»¬ç”¨çš„å°±æ˜¯org.springframework.jdbc.datasource.DataSourceTransactionManager 1.2 TransactionDefinitionå®ƒæ˜¯äº‹åŠ¡çš„å®šä¹‰ä¿¡æ¯å¯¹è±¡ï¼š public interface TransactionDefinition { //ä¼ æ’­è¡Œä¸º int PROPAGATION_REQUIRED = 0; int PROPAGATION_SUPPORTS = 1; int PROPAGATION_MANDATORY = 2; int PROPAGATION_REQUIRES_NEW = 3; int PROPAGATION_NOT_SUPPORTED = 4; int PROPAGATION_NEVER = 5; int PROPAGATION_NESTED = 6; //äº‹åŠ¡éš”ç¦»çº§åˆ« //é»˜è®¤çº§åˆ«ï¼Œå¯èƒ½æ˜¯å››ä¸ªéš”ç¦»çº§åˆ«ä¸­çš„ä¸€ç§ int ISOLATION_DEFAULT = -1; //è¯»æœªæäº¤ int ISOLATION_READ_UNCOMMITTED = 1; //è¯»å·²æäº¤ int ISOLATION_READ_COMMITTED = 2; //é‡å¤è¯» int ISOLATION_REPEATABLE_READ = 4; //ä¸²è¡ŒåŒ– int ISOLATION_SERIALIZABLE = 8; int TIMEOUT_DEFAULT = -1; //è·å–äº‹åŠ¡ä¼ æ’­è¡Œä¸º default int getPropagationBehavior() { return 0; } //è·å–äº‹åŠ¡éš”ç¦»çº§åˆ« default int getIsolationLevel() { return -1; } //è·å–äº‹åŠ¡è¶…æ—¶æ—¶é—´ default int getTimeout() { return -1; } //è·å–äº‹åŠ¡æ˜¯å¦åªè¯» default boolean isReadOnly() { return false; } //è·å–äº‹åŠ¡å¯¹è±¡åç§° @Nullable default String getName() { return null; } static TransactionDefinition withDefaults() { return StaticTransactionDefinition.INSTANCE; } } å…·ä½“äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ä»‹ç»è§ï¼šæ•°æ®åº“ç†è®ºä¹‹äº‹åŠ¡ä¸æ¢å¤æŠ€æœ¯ å¯¹äºäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Œæœ‰ï¼š REQUIRED:å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æ–°å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œå¦‚æœå·²ç»å­˜åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼ŒåŠ å…¥åˆ°è¿™ä¸ªäº‹åŠ¡ä¸­ã€‚ä¸€èˆ¬çš„é€‰æ‹©ï¼ˆé»˜è®¤å€¼ï¼‰ SUPPORTS:æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼ˆæ²¡æœ‰äº‹åŠ¡ï¼‰ MANDATORYï¼šä½¿ç”¨å½“å‰çš„äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ REQUERS_NEW:æ–°å»ºäº‹åŠ¡ï¼Œå¦‚æœå½“å‰åœ¨äº‹åŠ¡ä¸­ï¼ŒæŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚ NOT_SUPPORTED:ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ· NEVER:ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼ŒæŠ›å‡ºå¼‚å¸¸ NESTED:å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œã€‚å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æ‰§è¡Œ REQUIRED ç±»ä¼¼çš„æ“ä½œã€‚ 1.3 TransactionStatuspublic interface TransactionStatus extends TransactionExecution, SavepointManager, Flushable { //æ˜¯å¦æœ‰å­˜å‚¨ç‚¹ boolean hasSavepoint(); //åˆ·æ–°äº‹åŠ¡ @Override void flush(); } å¯¹äºTransactionExecutionï¼Œè¿˜å…·æœ‰isNewTransaction()ï¼šæ˜¯ä¸æ˜¯æ–°çš„äº‹åŠ¡ï¼ŒsetRollbackOnly()ï¼šè®¾ç½®äº‹åŠ¡å›æ»šï¼ŒisRollbackOnly()ï¼šäº‹åŠ¡æ˜¯å¦å›æ»šç­‰æ–¹æ³•ã€‚ 2 XMLé…ç½®äº‹åŠ¡ç®¡ç†&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:aop=\"http://www.springframework.org/schema/aop\" xmlns:tx=\"http://www.springframework.org/schema/tx\" xmlns:context=\"http://www.springframework.org/schema/context\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\" http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd\"> &lt;!-- çœå»DataSourceé…ç½® --> &lt;bean id=\"transactionManager\" class=\"org.springframework.jdbc.datasource.DataSourceTransactionManager\"> &lt;property name=\"dataSource\" ref=\"dataSource\">&lt;/property> &lt;/bean> &lt;!-- äº‹åŠ¡çš„é…ç½® --> &lt;tx:advice id=\"txAdvice\" transaction-manager=\"transactionManager\"> &lt;/tx:advice> &lt;tx:attributes> &lt;!-- æŒ‡å®šæ–¹æ³•åç§°ï¼šæ˜¯ä¸šåŠ¡æ ¸å¿ƒæ–¹æ³• read-onlyï¼šæ˜¯å¦æ˜¯åªè¯»äº‹åŠ¡ã€‚é»˜è®¤ falseï¼Œä¸åªè¯»ã€‚ isolationï¼šæŒ‡å®šäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ã€‚é»˜è®¤å€¼æ˜¯ä½¿ç”¨æ•°æ®åº“çš„é»˜è®¤éš”ç¦»çº§åˆ«ã€‚ propagationï¼šæŒ‡å®šäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºã€‚ timeoutï¼šæŒ‡å®šè¶…æ—¶æ—¶é—´ã€‚é»˜è®¤å€¼ä¸ºï¼š-1ã€‚æ°¸ä¸è¶…æ—¶ã€‚ rollback-forï¼šç”¨äºæŒ‡å®šä¸€ä¸ªå¼‚å¸¸ï¼Œå½“æ‰§è¡Œäº§ç”Ÿè¯¥å¼‚å¸¸æ—¶ï¼Œäº‹åŠ¡å›æ»šã€‚äº§ç”Ÿå…¶ä»–å¼‚å¸¸ï¼Œäº‹åŠ¡ä¸å›æ»šã€‚ æ²¡æœ‰é»˜è®¤å€¼ï¼Œä»»ä½•å¼‚å¸¸éƒ½å›æ»šã€‚ no-rollback-forï¼šç”¨äºæŒ‡å®šä¸€ä¸ªå¼‚å¸¸ï¼Œå½“äº§ç”Ÿè¯¥å¼‚å¸¸æ—¶ï¼Œäº‹åŠ¡ä¸å›æ»šï¼Œäº§ç”Ÿå…¶ä»–å¼‚å¸¸æ—¶ï¼Œäº‹åŠ¡å› æ»šã€‚æ²¡æœ‰é»˜è®¤å€¼ï¼Œä»»ä½•å¼‚å¸¸éƒ½å›æ»šã€‚ --> &lt;tx:method name=\"*\" read-only=\"false\" propagation=\"REQUIRED\"/> &lt;tx:method name=\"find*\" read-only=\"true\" propagation=\"SUPPORTS\"/> &lt;/tx:attributes> &lt;!-- é…ç½® aop --> &lt;aop:config> &lt;!-- é…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ --> &lt;aop:pointcut expression=\"execution(* com.rhett.service.impl.*.*(..))\" id=\"pt1\"/> &lt;/aop:config> &lt;!-- åœ¨ aop:config æ ‡ç­¾å†…éƒ¨ï¼šå»ºç«‹äº‹åŠ¡çš„é€šçŸ¥å’Œåˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„å…³ç³» --> &lt;aop:advisor advice-ref=\"txAdvice\" pointcut-ref=\"pt1\"/> 3 æ³¨è§£é…ç½®äº‹åŠ¡ç®¡ç† é¦–å…ˆæ³¨å…¥äº‹åŠ¡ç®¡ç†å™¨beanï¼Œå¯ä»¥é€šè¿‡æ³¨è§£@Beanï¼Œå¦‚æœä½¿ç”¨spring-bootï¼Œæ— è®ºæ˜¯mybatis-spring-boot-starterè¿˜æ˜¯jpa-starterï¼Œéƒ½ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æ³¨å…¥ä¸€ä¸ªç›¸å…³çš„å®ä¾‹å¯¹è±¡ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨æ³¨è§£@Transactionalå³å¯ã€‚ åœ¨é…ç½®ç±»ä¸Šå¼€å¯æ³¨è§£äº‹åŠ¡æ”¯æŒï¼š@EnableTransactionManagementï¼Œå½“ç„¶ä¹Ÿå¾—å¼€å¯@EnableAspectJAutoProxyAOPæ”¯æŒ åœ¨ä¸šåŠ¡å±‚ä½¿ç”¨@Transactionalæ³¨è§£ï¼Œå±æ€§å’Œxmlä¸­çš„ç±»ä¼¼ã€‚ @Service(\"accountService\") @Transactional(readOnly=true,propagation=Propagation.SUPPORTS) public class AccountServiceImpl implements IAccountService { @Autowired private IAccountDao accountDao; @Override public Account findAccountById(Integer id) { return accountDao.findAccountById(id); } @Override @Transactional(readOnly=false,propagation=Propagation.REQUIRED) public void transfer(String sourceName, String targeName, Float money) { //1.æ ¹æ®åç§°æŸ¥è¯¢ä¸¤ä¸ªè´¦æˆ· Account source = accountDao.findAccountByName(sourceName); Account target = accountDao.findAccountByName(targeName); //2.ä¿®æ”¹ä¸¤ä¸ªè´¦æˆ·çš„é‡‘é¢ source.setMoney(source.getMoney()-money);//è½¬å‡ºè´¦æˆ·å‡é’± target.setMoney(target.getMoney()+money);//è½¬å…¥è´¦æˆ·åŠ é’± //3.æ›´æ–°ä¸¤ä¸ªè´¦æˆ· accountDao.updateAccount(source); //int i=1/0; accountDao.updateAccount(target); } } 4 æ³¨æ„å› ä¸ºSpringæ˜¯é€šè¿‡AOPæ¥å®ç°ç®¡ç†äº‹åŠ¡çš„ï¼Œå¦‚æœæŸä¸ªç±»ä½¿ç”¨äº†@Transactionalï¼Œä½†å¦‚æœåœ¨è¿™ä¸ªç±»ä¸­çš„å…¶ä»–æ–¹æ³•è°ƒç”¨äº†è¯¥æ–¹æ³•ï¼Œç§°ä¸ºâ€è‡ªè°ƒç”¨â€ï¼Œæ²¡æœ‰ç»è¿‡ä»£ç†å¯¹è±¡ï¼Œè¿™ç§æƒ…å†µ@Transactionalå°±å¤±æ•ˆäº†ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://www.codetool.top/tags/Spring/"}]},{"title":"SpringBootæ—¥å¿—æ¡†æ¶çš„ä½¿ç”¨","slug":"SpringBootæ—¥å¿—æ¡†æ¶çš„ä½¿ç”¨","date":"2020-03-09T18:46:53.000Z","updated":"2020-04-14T15:51:09.718Z","comments":true,"path":"article/SpringBootæ—¥å¿—æ¡†æ¶çš„ä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/SpringBoot%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"","text":"å‰ç½®çŸ¥è¯†ï¼š æ—¥å¿—é—¨é¢SLF4Jä»‹ç»å’Œä½¿ç”¨ï¼ˆæ—¥å¿—ç³»åˆ—03ï¼‰ Javaæ—¥å¿—æ¡†æ¶Logbackä»‹ç»å’Œä½¿ç”¨ï¼ˆæ—¥å¿—ç³»åˆ—04ï¼‰ æ¨èé˜…è¯»ï¼š Javaæ—¥å¿—æ¡†æ¶JULå’ŒLog4jä»‹ç»ï¼ˆæ—¥å¿—ç³»åˆ—01ï¼‰ æ—¥å¿—é—¨é¢ä»‹ç»å’ŒJCLä½¿ç”¨ï¼ˆæ—¥å¿—ç³»åˆ—02ï¼‰ Javaæ—¥å¿—æ¡†æ¶LOG4J2çš„ä»‹ç»å’Œä½¿ç”¨ï¼ˆæ—¥å¿—ç³»åˆ—05ï¼‰ ï¼ˆJavaæ—¥å¿—ç³»åˆ—åˆ°è¿™ç¯‡ç®—æ˜¯å®Œç»“äº†å§ï¼Œå®Œç»“æ’’èŠ±â˜…,Â°:.â˜†(ï¿£â–½ï¿£)/$:.Â°â˜… ã€‚ï¼‰ 1 logging-starteræ¦‚è¿°SpringBootä½¿ç”¨æ—¥å¿—åŠŸèƒ½ä¾èµ–äº &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-logging&lt;/artifactId> &lt;/dependency> å®é™…ä¸Šï¼Œä¸éœ€è¦å¯¼å…¥è¿™ä¸ªä¾èµ–ï¼Œå› ä¸ºspringbootçš„æ ¸å¿ƒspring-boot-starterå­˜åœ¨å¯¹spring-boot-starter-loggingçš„ä¼ é€’ä¾èµ–ã€‚ jul-to-slf4jï¼šå°†JULè½¬ä¸ºSLF4Jï¼ˆä½¿ç”¨SLF4Jä½œä¸ºæ—¥å¿—é—¨é¢ï¼‰ log4j-to-slf4jï¼šå°†LOG4J2æ—¥å¿—é—¨é¢è½¬ä¸ºSLF4J logback-classicï¼šä½¿ç”¨logbackä½œä¸ºé»˜è®¤æ—¥å¿—å®ç° SpringBoot 2.0 ä¹‹å‰è¿˜ä¼šæœ‰ä¸€ä¸ªlog4j-over-slf4jç”¨æ¥è½¬æ¢log4jï¼Œ2.0ä¹‹åå°±å–æ¶ˆäº†å¯¹log4jçš„æ”¯æŒã€‚ï¼ˆè™½ç„¶å¯ä»¥é€šè¿‡starterä½¿ç”¨log4jï¼Œä½†å·²ç»ä¸æ¨èäº†ï¼‰ å¯ä»¥çœ‹å‡ºï¼ŒSpringBootä½¿ç”¨SLF4Jä½œä¸ºæ—¥å¿—é—¨é¢ï¼Œlogbackä½œä¸ºé»˜è®¤æ—¥å¿—å®ç°ã€‚ å¦‚æœæ˜¯å…¶ä»–æ—¥å¿—é—¨é¢å’Œæ—¥å¿—æ¡†æ¶ä¼šè‡ªåŠ¨æ¡¥æ¥è‡³SLF4Jã€‚ 2 æ—¥å¿—ç›¸å…³é…ç½®2.1 SpringBooté…ç½®è¿™é‡Œä½¿ç”¨propertiesè¯­æ³•ï¼Œyamlä¹Ÿåªæ˜¯è½¬æ¢ä¸€ä¸‹æ ¼å¼ # è®¾ç½®è‡ªå®šä¹‰loggerçš„æ—¥å¿—çº§åˆ« logging.level.com.rhett.FileLogger=trace # è®¾ç½®console appenderçš„pattern logging.pattern.console=[%-5level] %d{yyyy-MM-dd HH:mm:ss} %c [%thread] --- %m%n # æŒ‡å®šæ—¥å¿—æ–‡ä»¶å­˜æ”¾çš„ç›®å½•ï¼Œé»˜è®¤çš„æ–‡ä»¶åæ˜¯spring.log logging.file.path=logs/springboot/ # è®¾ç½®file appenderçš„pattern logging.pattern.file=[%-5level] %d{yyyy-MM-dd HH:mm:ss} %c [%thread] --- %m%n 2.2 æŒ‡å®šé…ç½®å¦‚æœæƒ³é…ç½®ä¸€äº›é«˜çº§åŠŸèƒ½ï¼Œå¯ä»¥éœ€è¦å¯¼å…¥å…·ä½“æŸä¸ªæ—¥å¿—æ¡†æ¶çš„é…ç½®ï¼ŒSpringBootä¼šè‡ªåŠ¨æŸ¥æ‰¾éµå¾ªå¦‚ä¸‹å‘½åçš„é…ç½®æ–‡ä»¶ï¼š æ—¥å¿—å®ç° æ–‡ä»¶å‘½å Logback logback-spring.xml, logback-spring.groovy, logback.xml, logback.groovy Log4j2 log4j2-spring.xml , log4j2.xml JUL logging.properties å¯¹äºlogbackæ¥è¯´ï¼Œlogback-springè¿˜å¯ä»¥ä½¿ç”¨profileåŠŸèƒ½ï¼š logback.xmlï¼šç›´æ¥å°±è¢«æ—¥å¿—æ¡†æ¶è¯†åˆ«äº†ï¼› logback-spring.xmlï¼šæ—¥å¿—æ¡†æ¶å°±ä¸ç›´æ¥åŠ è½½æ—¥å¿—çš„é…ç½®é¡¹ï¼Œç”±SpringBootè§£ææ—¥å¿—é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨SpringBootçš„ProfileåŠŸèƒ½ &lt;appender name=\"console\" class=\"ch.qos.logback.core.ConsoleAppender\"> &lt;layout class=\"ch.qos.logback.classic.PatternLayout\"> &lt;springProfile name=\"dev\"> &lt;pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} ----> [%thread] ---> %-5level %logger{50} - %msg%n&lt;/pattern> &lt;/springProfile> &lt;springProfile name=\"test\"> &lt;pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} ==== [%thread] ==== %-5level %logger{50} - %msg%n&lt;/pattern> &lt;/springProfile> &lt;/layout> &lt;/appender> åœ¨springbooté…ç½®ä¸­åˆ‡æ¢profileç¯å¢ƒï¼š spring.profiles.active=dev 3 å°†æ—¥å¿—å®ç°åˆ‡æ¢ä¸ºlog4j2ç¦ç”¨logbackã€å¯ç”¨log4j2ï¼Œç„¶åå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨log4j2äº†ã€‚ &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-web&lt;/artifactId> &lt;exclusions> &lt;!-- ç¦ç”¨logback--> &lt;exclusion> &lt;artifactId>spring-boot-starter-logging&lt;/artifactId> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;/exclusion> &lt;/exclusions> &lt;/dependency> &lt;!-- æ·»åŠ log4j2 --> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-log4j2&lt;/artifactId> &lt;/dependency>","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"æ—¥å¿—","slug":"æ—¥å¿—","permalink":"https://www.codetool.top/tags/%E6%97%A5%E5%BF%97/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.codetool.top/tags/SpringBoot/"}]},{"title":"leetcode543-äºŒå‰æ ‘çš„ç›´å¾„","slug":"leetcode543-äºŒå‰æ ‘çš„ç›´å¾„","date":"2020-03-09T17:57:29.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode543-äºŒå‰æ ‘çš„ç›´å¾„/","link":"","permalink":"https://www.codetool.top/article/leetcode543-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E7%9B%B4%E5%BE%84/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€æ£µäºŒå‰æ ‘ï¼Œä½ éœ€è¦è®¡ç®—å®ƒçš„ç›´å¾„é•¿åº¦ã€‚ä¸€æ£µäºŒå‰æ ‘çš„ç›´å¾„é•¿åº¦æ˜¯ä»»æ„ä¸¤ä¸ªç»“ç‚¹è·¯å¾„é•¿åº¦ä¸­çš„æœ€å¤§å€¼ã€‚è¿™æ¡è·¯å¾„å¯èƒ½ç©¿è¿‡æ ¹ç»“ç‚¹ã€‚ ç¤ºä¾‹: ç»™å®šäºŒå‰æ ‘ 1 / \\ 2 3 / \\ 4 5 è¿”å› 3, å®ƒçš„é•¿åº¦æ˜¯è·¯å¾„ [4,2,1,3] æˆ–è€… [5,2,1,3]ã€‚ æ³¨æ„: ä¸¤ç»“ç‚¹ä¹‹é—´çš„è·¯å¾„é•¿åº¦æ˜¯ä»¥å®ƒä»¬ä¹‹é—´è¾¹çš„æ•°ç›®è¡¨ç¤ºã€‚ 2 è§£æ³•2.1 æ€æƒ³è‡ªåº•å‘ä¸Šdfsï¼Œé¦–å…ˆè¦äº†è§£è¿™ä¸ªæœ€é•¿è¾¹ä¸ä¸€å®šç»è¿‡æ ¹èŠ‚ç‚¹ï¼Œå¯¹äºæ¯ä¸ªç»“ç‚¹ï¼Œç»è¿‡å®ƒçš„æœ€é•¿ç›´å¾„ä¸ºå·¦è¾¹çš„æœ€é•¿è¾¹å’Œå³è¾¹çš„æœ€é•¿è¾¹ä¹‹å’Œã€‚è¿™ä¸ªç»“ç‚¹çš„æ·±åº¦ä¸ºå·¦è¾¹æœ€é•¿è¾¹å’Œå³è¾¹æœ€é•¿è¾¹çš„æœ€å¤§å€¼+1ã€‚è¿™æ ·è·å–å‡ºæ‰€æœ‰ç»è¿‡æŸèŠ‚ç‚¹çš„æœ€é•¿ç›´å¾„ï¼Œæ¯”è¾ƒå‡ºæœ€å¤§å€¼ã€‚ 2.2 ä»£ç class Solution { int max = 0; public int diameterOfBinaryTree(TreeNode root) { dfs(root); return ans; } int dfs(TreeNode root){ if(root == null) return 0; int left = dfs(root.left); int right = dfs(root.right); max = Math.max(max, left + right); return Math.max(left, right) + 1; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"Javaæ—¥å¿—æ¡†æ¶LOG4J2çš„ä»‹ç»å’Œä½¿ç”¨","slug":"Javaæ—¥å¿—æ¡†æ¶LOG4J2çš„ä»‹ç»å’Œä½¿ç”¨","date":"2020-03-09T17:35:20.000Z","updated":"2020-03-09T18:49:48.554Z","comments":true,"path":"article/Javaæ—¥å¿—æ¡†æ¶LOG4J2çš„ä»‹ç»å’Œä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/Java%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6LOG4J2%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/","excerpt":"","text":"å‰ç½®çŸ¥è¯†ï¼š æ—¥å¿—é—¨é¢SLF4Jä»‹ç»å’Œä½¿ç”¨ æ¨èé˜…è¯»ï¼š Javaæ—¥å¿—æ¡†æ¶Logbackä»‹ç»å’Œä½¿ç”¨ 1 log4j2æ¦‚è¿°Apache Log4j2æ˜¯å¯¹Log4jçš„å‡çº§ç‰ˆï¼Œå‚è€ƒäº†logbackçš„ä¸€äº›ä¼˜ç§€çš„è®¾è®¡ï¼Œå¹¶ä¸”ä¿®å¤äº†ä¸€äº›é—®é¢˜ï¼Œå› æ­¤å¸¦æ¥äº†ä¸€äº›é‡å¤§çš„æå‡,ä¸»è¦æœ‰: å¼‚å¸¸å¤„ç†ï¼Œåœ¨logbackä¸­, Appenderä¸­çš„å¼‚å¸¸ä¸ä¼šè¢«åº”ç”¨æ„ŸçŸ¥åˆ°,ä½†æ˜¯åœ¨log4j2ä¸­,æä¾›äº†ä¸€äº›å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚ æ€§èƒ½æå‡ï¼Œlog4j2ç›¸è¾ƒäºlog4jå’Œlogbackéƒ½å…·æœ‰å¾ˆæ˜æ˜¾çš„æ€§èƒ½æå‡ã€‚ è‡ªåŠ¨é‡è½½é…ç½®ï¼Œå‚è€ƒäº†logbackçš„è®¾è®¡ï¼Œå½“ç„¶ä¼šæä¾›è‡ªåŠ¨åˆ·æ–°å‚æ•°é…ç½®ï¼Œæœ€å®ç”¨çš„å°±æ˜¯æˆ‘ä»¬åœ¨ç”Ÿäº§ä¸Šå¯ä»¥åŠ¨æ€åœ°ä¿®æ”¹æ—¥å¿—çš„çº§åˆ«è€Œä¸éœ€è¦é‡å¯åº”ç”¨ã€‚ æ— åƒåœ¾æœºåˆ¶ï¼Œlog4j2åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½å¯ä»¥ä½¿ç”¨å…¶è®¾è®¡çš„ä¸€å¥—æ— åƒåœ¾æœºåˆ¶ï¼Œé¿å…é¢‘ç¹çš„æ—¥å¿—æ”¶é›†å¯¼è‡´çš„jvm gcã€‚ Log4j2å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªæ—¥å¿—é—¨é¢ï¼Œä½†slf4jå·²ç»è¶³å¤Ÿä¼˜ç§€ï¼Œè¾ƒå°‘äººæŠŠLog4j2ç”¨ä½œæ—¥å¿—é—¨é¢ï¼Œé€šå¸¸è¿˜æ˜¯æŠŠå®ƒå½“æˆä¸€ä¸ªæ—¥å¿—å®ç°æ­é…slf4jä½¿ç”¨ã€‚ 2 log4j2æ—¥å¿—é—¨é¢ç®€è¦ä»‹ç»ä¸€ä¸‹log4j2ä½œä¸ºæ—¥å¿—é—¨é¢çš„ä½¿ç”¨ mavenä¾èµ–ï¼š &lt;dependency> &lt;groupId>org.apache.logging.log4j&lt;/groupId> &lt;artifactId>log4j-api&lt;/artifactId> &lt;version>2.12.1&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.apache.logging.log4j&lt;/groupId> &lt;artifactId>log4j-core&lt;/artifactId> &lt;version>2.12.1&lt;/version> &lt;/dependency> è¿™æ ·ä½¿ç”¨çš„å°±æ˜¯Log4j2æ—¥å¿—é—¨é¢+æœ¬èº«çš„å®ç° public static final Logger LOGGER = LogManager.getLogger(LOG4J2Test.class); @Test public void testQuick() { LOGGER.fatal(\"fatal\"); LOGGER.error(\"error\"); LOGGER.warn(\"warn\"); LOGGER.info(\"info\"); LOGGER.debug(\"debug\"); LOGGER.trace(\"trace\"); } 3 log4j2+slf4jä½¿ç”¨mavené…ç½® &lt;!-- slf4jæ—¥å¿—é—¨é¢ --> &lt;dependency> &lt;groupId>org.slf4j&lt;/groupId> &lt;artifactId>slf4j-api&lt;/artifactId> &lt;version>1.7.30&lt;/version> &lt;/dependency> &lt;!-- log4j2é€‚é…å™¨ --> &lt;dependency> &lt;groupId>org.apache.logging.log4j&lt;/groupId> &lt;artifactId>log4j-slf4j-impl&lt;/artifactId> &lt;version>2.13.0&lt;/version> &lt;/dependency> &lt;!-- log4j2 --> &lt;dependency> &lt;groupId>org.apache.logging.log4j&lt;/groupId> &lt;artifactId>log4j-core&lt;/artifactId> &lt;version>2.13.0&lt;/version> &lt;/dependency> è¿™æ˜¯æœ€ç®€å•çš„å†™æ³•ï¼Œlog4j-slf4j-implä¾èµ–äºlog4j-apiï¼Œå®ƒæ›´åƒæ˜¯æ¡¥æ¥Log4j2æ—¥å¿—é—¨é¢ã€‚ ä½¿ç”¨å°±æ˜¯SLF4Jçš„ä½¿ç”¨æ–¹æ³•ï¼ˆå‡è®¾ä½ æ²¡è·³å‰ç½®çŸ¥è¯†ğŸŒšï¼‰ 4 log4j2é…ç½®log4j2é»˜è®¤åŠ è½½classpathä¸‹çš„log4j2.xmlæ–‡ä»¶ä¸­çš„é…ç½® å®ƒå’Œlogbackå®åœ¨æ˜¯å¤ªåƒäº†ï¼Œæ¯•ç«Ÿæœ¬æ¥å°±æ˜¯æŠ„è¢­çš„logbackï¼ˆè¿™æ˜¯å¯ä»¥è¯´çš„å—ğŸŒšï¼‰ logbackçš„é…ç½®è§Javaæ—¥å¿—æ¡†æ¶Logbackä»‹ç»å’Œä½¿ç”¨ æ‰€ä»¥æˆ‘æŠŠé…ç½®è´´å‡ºæ¥åº”è¯¥å°±èƒ½çœ‹æ‡‚ï¼š &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;!-- statusï¼Œä»£è¡¨æ—¥å¿—æ¡†æ¶æœ¬èº«çš„è¾“å‡ºæ—¥å¿—çº§åˆ«ï¼›monitorIntervalï¼Œé…ç½®ä¸º120ï¼Œå•ä½ä¸ºç§’ã€‚ç±»ä¼¼äºlogbackçš„scanPeriod --> &lt;Configuration status=\"WARN\" monitorInterval=\"120\"> &lt;!-- ç±»ä¼¼äºlogbackçš„propertyï¼Œä½†æ˜¯æ”¾å…¥äº†propertiesèŠ‚ç‚¹ --> &lt;properties> &lt;property name=\"LOG_HOME\">/logs&lt;/property> &lt;/properties> &lt;!-- å°†æ‰€æœ‰Appenderæ”¾å…¥äº†AppendersèŠ‚ç‚¹ --> &lt;Appenders> &lt;!--ConsoleèŠ‚ç‚¹å°±ç›´æ¥æŒ‡å®šäº†è¿™ä¸ªappenderä½¿ç”¨çš„ç±»æ˜¯logbackè‡ªå¸¦çš„ï¼Œnameæ˜¯è‡ªå·±å‘½åçš„,target=SYSTEM_OUTè¡¨ç¤ºè¾“å‡ºåˆ°æ§åˆ¶å°ã€‚--> &lt;Console name=\"Console\" target=\"SYSTEM_OUT\"> &lt;!--patternå’Œlogbackå‡ ä¹ä¹Ÿæ²¡æœ‰åŒºåˆ«--> &lt;PatternLayout pattern=\"%d{HH:mm:ss.SSS} [%t] [%-5level] %c{36}:%L --- %m%n\"/> &lt;/Console> &lt;!--FileèŠ‚ç‚¹å°±ç›´æ¥æŒ‡å®šäº†è¿™ä¸ªappenderä½¿ç”¨çš„ç±»æ˜¯logbackè‡ªå¸¦çš„ï¼ŒfileNameæŒ‡å®šæ–‡ä»¶è·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨å±æ€§å€¼${}ï¼Œappend=\"true\"è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾--> &lt;File name=\"log\" fileName=\"${LOG_HOME}/test.log\" append=\"true\"> &lt;PatternLayout pattern=\"%d{HH:mm:ss.SSS} [%t] [%-5level] %c{36}:%L --- %m%n\"/> &lt;/File> &lt;!--RandomAccessFileï¼Œæ–‡ä»¶éšæœºè¯»å†™æµAppenderï¼Œæ¯”Fileæ€§èƒ½è¾ƒå¥½--> &lt;RandomAccessFile name=\"log\" fileName=\"${LOG_HOME}/test.log\"> &lt;PatternLayout pattern=\"%d{HH:mm:ss.SSS} [%t] [%-5level] %c{36}:%L --- %m%n\"/> &lt;/RandomAccessFile> &lt;!--RollingFileæˆ–ä½¿ç”¨RollingRandomAccessFileï¼Œè‡ªåŠ¨æ‹†åˆ†çš„æ–‡ä»¶éšæœºè¯»å†™æµAppenderï¼Œ filePatternï¼šå†å²æ—¥å¿—å°å­˜è·¯å¾„ã€‚log4j2ä¹Ÿè‡ªåŠ¨è¯†åˆ«zipç­‰åç¼€ï¼Œè¡¨ç¤ºå†å²æ—¥å¿—éœ€è¦å‹ç¼©ã€‚--> &lt;RollingRandomAccessFile name=\"File\" immediateFlush=\"true\" fileName=\"${LOG_HOME}/today.log\" filePattern=\"${LOG_HOME}/$${date:yyyy-MM-dd}/myrollog-%d{yyyy-MM-dd}-%i.log\"> &lt;!-- å’Œlogbackçš„è¿‡æ»¤å™¨ç±»ä¼¼ï¼ŒonMatchã€onMismatchå¯ä»¥ä¸ºNEUTRALè¡¨ç¤ºä¸­ç«‹ --> &lt;Filters> &lt;!-- æ—¥å¿—çº§åˆ«è¿‡æ»¤å™¨ --> &lt;ThresholdFilter level=\"INFO\" onMatch=\"ACCEPT\" onMismatch=\"DENY\"/> &lt;/Filters> &lt;PatternLayout pattern=\"%d{HH:mm:ss.SSS} [%t] [%-5level] %c{36}:%L --- %m%n\" /> &lt;!-- ä¹Ÿå¯ä»¥æ˜¯ç±»ä¼¼äºlogbackçš„HTMLLayout &lt;HTMLLayout pattern=\"%d{HH:mm:ss.SSS}%t%-5level%c{36}%L%m%n\" /> --> &lt;!--RollingRandomAccessFileçš„å¿…é…é¡¹,TriggeringPolicy(è§¦å‘ç­–ç•¥) --> &lt;Policies> &lt;!--åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œè§¦å‘æ‹†åˆ†è§„åˆ™ï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„æ—¥å¿—æ–‡ä»¶--> &lt;OnStartupTriggeringPolicy /> &lt;!--æŒ‰æ—¶é—´åˆ’åˆ†æ—¥å¿—æ–‡ä»¶ï¼Œå•ä½æ˜¯filePatternä¸­é…ç½®çš„ --> &lt;TimeBasedTriggeringPolicy /> &lt;!--æŒ‰å¤§å°åˆ’åˆ†æ—¥å¿—æ–‡ä»¶--> &lt;SizeBasedTriggeringPolicy size=\"10 MB\" /> &lt;/Policies> &lt;!--è¦†ç›–ç­–ç•¥ï¼Œé™å®šåŒä¸€ä¸ªç›®å½•ä¸‹æ—¥å¿—æ–‡ä»¶çš„æœ€å¤§æ•°é‡--> &lt;DefaultRolloverStrategy max=\"20\"/> &lt;/RollingRandomAccessFile> &lt;/Appenders> &lt;!-- é…ç½®Root Loggerå’Œè‡ªå®šä¹‰logger --> &lt;Loggers> &lt;Root level=\"trace\"> &lt;AppenderRef ref=\"Console\"/> &lt;/Root> &lt;/Loggers> &lt;/Configuration> 5 å¼‚æ­¥æ—¥å¿—Log4j2æä¾›äº†AsyncAppenderå’ŒAsyncLoggerï¼Œé€šè¿‡BlockingQueueæ¥å®ç°å¼‚æ­¥ã€‚ï¼ˆæ¯”logbackåšçš„æ›´å…¨é¢ä¸€ç‚¹ï¼‰ é€šå¸¸ä½¿ç”¨AsyncLoggerã€‚ ä½¿ç”¨å¼‚æ­¥æ—¥å¿—éœ€è¦é…ç½®ä¾èµ–ï¼š &lt;dependency> &lt;groupId>com.lmax&lt;/groupId> &lt;artifactId>disruptor&lt;/artifactId> &lt;version>3.4.2&lt;/version> &lt;/dependency> 5.1 ä½¿ç”¨AsyncAppenderè¿™ç§æ–¹å¼å’Œlogbackç±»ä¼¼ &lt;Appenders> &lt;Async name=\"Async\"> &lt;AppenderRef ref=\"file\" /> &lt;/Async> &lt;/Appenders> &lt;Loggers> &lt;Root level=\"trace\"> &lt;AppenderRef ref=\"Console\"/> &lt;AppenderRef ref=\"Async\"/> &lt;/Root> &lt;/Loggers> 5.2 ä½¿ç”¨AsyncLoggerè¿™ç§æ–¹æ³•å¼‚æ­¥æ€§èƒ½æ›´é«˜ä¸€ç‚¹ 5.2.1 å…¨å±€å¼‚æ­¥æ‰€æœ‰æ—¥å¿—éƒ½å¼‚æ­¥ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸Šä¸ç”¨åšä»»ä½•æ”¹åŠ¨ï¼Œåªéœ€è¦æ·»åŠ ä¸€ä¸ªlog4j2.component.propertiesé…ç½®ï¼š Log4jContextSelector=org.apache.logging.log4j.core.async.AsyncLoggerContextSelector 5.2.2 æ··åˆå¼‚æ­¥å¯ä»¥åœ¨åº”ç”¨ä¸­åŒæ—¶ä½¿ç”¨åŒæ­¥æ—¥å¿—å’Œå¼‚æ­¥æ—¥å¿—ï¼Œè¿™ä½¿å¾—æ—¥å¿—çš„é…ç½®æ–¹å¼æ›´åŠ çµæ´»ã€‚ éœ€è¦é…ç½®è‡ªå®šä¹‰loggerï¼š &lt;Loggers> &lt;!-- includeLocationå…³é—­æ–‡ä»¶ä¿¡æ¯ã€è¡Œå·ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å½±å“æ€§èƒ½ --> &lt;AsyncLogger name=\"com.rhett.AsyncLogger\" level=\"trace\" includeLocation=\"false\" additivity=\"false\"> &lt;AppenderRef ref=\"file\" /> &lt;/AsyncLogger> &lt;/Loggers>","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"æ—¥å¿—","slug":"æ—¥å¿—","permalink":"https://www.codetool.top/tags/%E6%97%A5%E5%BF%97/"}]},{"title":"Javaæ—¥å¿—æ¡†æ¶Logbackä»‹ç»å’Œä½¿ç”¨","slug":"Javaæ—¥å¿—æ¡†æ¶Logbackä»‹ç»å’Œä½¿ç”¨","date":"2020-03-09T15:07:24.000Z","updated":"2020-03-09T15:55:54.323Z","comments":true,"path":"article/Javaæ—¥å¿—æ¡†æ¶Logbackä»‹ç»å’Œä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/Java%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6Logback%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/","excerpt":"","text":"å‰ç½®çŸ¥è¯†ï¼š æ—¥å¿—é—¨é¢SLF4Jä»‹ç»å’Œä½¿ç”¨ 1 Logbackæ¦‚è¿°Logbackæ˜¯ç”±log4jã€slf4jåˆ›å§‹äººCeki GÃ¼lcÃ¼è®¾è®¡çš„å¦ä¸€ä¸ªå¼€æºæ—¥å¿—ç»„ä»¶ï¼Œæ€§èƒ½æ¯”log4jè¦å¥½ã€‚å®ƒè‡ªç„¶åœ°å®ç°äº†slf4jè§„èŒƒã€‚ Logbackä¸»è¦åˆ†ä¸ºä¸‰ä¸ªæ¨¡å—ï¼š logback-coreï¼šlogbackçš„æ ¸å¿ƒæ¨¡å—ï¼Œä¹Ÿæ˜¯å…¶å®ƒä¸¤ä¸ªæ¨¡å—çš„åŸºç¡€æ¨¡å— logback-classicï¼šå®ƒæ˜¯log4jçš„ä¸€ä¸ªæ”¹è‰¯ç‰ˆæœ¬,åŒæ—¶å®ƒå®Œæ•´å®ç°äº†slf4jAPI logback-access: è®¿é—®æ¨¡å—ä¸Servletå®¹å™¨é›†æˆæä¾›é€šè¿‡Httpæ¥è®¿é—®æ—¥å¿—çš„åŠŸèƒ½ Logbackçš„æ ¸å¿ƒç»„ä»¶ï¼š Loggerï¼šæ—¥å¿—çš„è®°å½•å™¨,æŠŠå®ƒå…³è”åˆ°åº”ç”¨çš„å¯¹åº”çš„contextä¸Šåï¼Œä¸»è¦ç”¨äºå­˜æ”¾æ—¥å¿—å¯¹è±¡,ä¹Ÿå¯ä»¥å®šä¹‰æ—¥å¿—ç±»å‹ã€çº§åˆ«ã€‚ Appenderï¼šç”¨äºæŒ‡å®šæ—¥å¿—è¾“å‡ºçš„ç›®çš„åœ°,ç›®çš„åœ°å¯ä»¥æ˜¯æ§åˆ¶å°ã€æ–‡ä»¶ã€æ•°æ®åº“ç­‰ç­‰ã€‚ Layoutï¼šè´Ÿè´£æŠŠäº‹ä»¶è½¬æ¢æˆå­—ç¬¦ä¸²,æ ¼å¼åŒ–çš„æ—¥å¿—ä¿¡æ¯çš„è¾“å‡ºã€‚åœ¨ logbackLayoutencoderä¸­å¯¹è±¡è¢«å°è£…åœ¨ä¸­ã€‚ 2 Logbackä½¿ç”¨mavenä¾èµ–ï¼š è¿™é‡Œä½¿ç”¨slf4jæ¥ç®¡ç† &lt;dependency> &lt;groupId>org.slf4j&lt;/groupId> &lt;artifactId>slf4j-api&lt;/artifactId> &lt;version>1.7.30&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>ch.qos.logback&lt;/groupId> &lt;artifactId>logback-classic&lt;/artifactId> &lt;version>1.2.3&lt;/version> &lt;/dependency> 3 Logbacké…ç½®logbackä¼šä¾æ¬¡è¯»å–ä»¥ä¸‹ç±»å‹é…ç½®æ–‡ä»¶ï¼š logback.groovy logback-test.xml logback.xml å¦‚æœå‡ä¸å­˜åœ¨ä¼šé‡‡ç”¨é»˜è®¤é…ç½® logbackå®˜æ–¹æä¾›çš„log4jé…ç½®è½¬logbacké…ç½®å·¥å…·ï¼šhttp://logback.qos.ch/translator/ 3.1 åŸºæœ¬é…ç½®&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?> &lt;configuration> &lt;property name=\"pattern\" value=\"[%-5level] %d{yyyy-MM-dd HH:mm:ss.SSS} %c %M %L [%thread] %m%n\">&lt;/property> &lt;property name=\"log_dir\" value=\"/logs\">&lt;/property> &lt;!-- æ§åˆ¶å°æ—¥å¿—è¾“å‡ºçš„ appender--> &lt;appender name=\"console\" class=\"ch.qos.logback.core.ConsoleAppender\"> &lt;!-- æ§åˆ¶è¾“å‡ºæµå¯¹è±¡ï¼Œé»˜è®¤System.outæ”¹ä¸ºSystem.err--> &lt;target>System.err&lt;/target> &lt;!-- æ—¥å¿—æ¶ˆæ¯æ ¼å¼é…ç½®--> &lt;encoder class=\"ch.qos.logback.classic.encoder.PatternLayoutEncoder\"> &lt;pattern>${pattern}&lt;/pattern> &lt;/encoder> &lt;/appender> &lt;!-- æ—¥å¿—æ–‡ä»¶è¾“å‡ºçš„ appender--> &lt;appender name=\"file\" class=\"ch.qos.logback.core.FileAppender\"> &lt;!-- æ—¥å¿—æ–‡ä»¶ä¿å­˜è·¯å¾„ --> &lt;file>${log_dir}/logback.log&lt;/file> &lt;!-- æ—¥å¿—æ¶ˆæ¯æ ¼å¼é…ç½®--> &lt;encoder class=\"ch.qos.logback.classic.encoder.PatternLayoutEncoder\"> &lt;pattern>${pattern}&lt;/pattern> &lt;/encoder> &lt;/appender> &lt;!-- root logger é…ç½®--> &lt;root level=\"ALL\"> &lt;appender-ref ref=\"console\">&lt;/appender-ref> &lt;appender-ref ref=\"file\">&lt;/appender-ref> &lt;/root> &lt;/configuration> patternå¸¸ç”¨è½¬æ¢ç¬¦ï¼š %c/%loggerï¼šè¾“å‡ºæ—¥å¿—çš„loggeråï¼Œå¯æœ‰ä¸€ä¸ªæ•´å½¢å‚æ•°ï¼ŒåŠŸèƒ½æ˜¯ç¼©çŸ­loggeråï¼Œä¾‹å¦‚%logger{5} %cnï¼šè¾“å‡ºä¸Šä¸‹æ–‡åç§°ã€‚ %d{pattern}ï¼šè¾“å‡ºæ—¥å¿—çš„æ‰“å°æ—¥å¿—ï¼Œæ¨¡å¼è¯­æ³•ä¸java.text.SimpleDateFormatå…¼å®¹ã€‚ %p/%le/%levelï¼šè¾“å‡ºæ—¥å¿—çº§åˆ«ã€‚ %t/%thread: è¾“å‡ºäº§ç”Ÿæ—¥å¿—çš„çº¿ç¨‹åã€‚ %nï¼šè¾“å‡ºå¹³å°ç›¸å…³çš„åˆ†è¡Œç¬¦â€œ\\nâ€æˆ–è€…â€œ\\r\\nâ€ã€‚ %m/%msg/%messageï¼šè¾“å‡ºåº”ç”¨ç¨‹åºæä¾›çš„ä¿¡æ¯ã€‚ %L/%lineï¼šè¾“å‡ºæ‰§è¡Œæ—¥å¿—è¯·æ±‚çš„è¡Œå·ã€‚ ä½¿ç”¨HTMLæ ¼å¼è¾“å‡ºï¼š &lt;!-- æ—¥å¿—æ–‡ä»¶è¾“å‡ºçš„ appender--> &lt;appender name=\"htmlFile\" class=\"ch.qos.logback.core.FileAppender\"> &lt;!-- æ—¥å¿—æ–‡ä»¶ä¿å­˜è·¯å¾„ --> &lt;file>${log_dir}/logback.html&lt;/file> &lt;!-- æ—¥å¿—æ¶ˆæ¯æ ¼å¼é…ç½®--> &lt;encoder class=\"ch.qos.logback.core.encoder.LayoutWrappingEncoder\"> &lt;layout class=\"ch.qos.logback.classic.html.HTMLLayout\"> &lt;pattern>%level%d{yyyy-MM-dd HH:mm:ss.SSS}%c%M%L%thread%m&lt;/pattern> &lt;/layout> &lt;/encoder> &lt;/appender> 3.2 åŠ¨æ€åˆ·æ–°é…ç½®æ ¹èŠ‚ç‚¹configurationå¯ä»¥é…ç½®ä¸¤ä¸ªå±æ€§ï¼š scan: å½“æ­¤å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼Œé…ç½®æ–‡ä»¶å¦‚æœå‘ç”Ÿæ”¹å˜ï¼Œå°†ä¼šè¢«é‡æ–°åŠ è½½ï¼Œé»˜è®¤å€¼ä¸ºtrueã€‚ scanPeriod: è®¾ç½®ç›‘æµ‹é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰ä¿®æ”¹çš„æ—¶é—´é—´éš”ï¼Œå¦‚æœæ²¡æœ‰ç»™å‡ºæ—¶é—´å•ä½ï¼Œé»˜è®¤å•ä½æ˜¯æ¯«ç§’ã€‚å½“scanä¸ºtrueæ—¶ï¼Œæ­¤å±æ€§ç”Ÿæ•ˆã€‚é»˜è®¤çš„æ—¶é—´é—´éš”ä¸º1åˆ†é’Ÿã€‚ é€šè¿‡é…ç½®è¿™ä¸¤ä¸ªå±æ€§ï¼Œå¯ä»¥åœ¨ç³»ç»Ÿè¿è¡Œæ—¶ä¿®æ”¹logbackçš„é…ç½®è€Œä¸éœ€è¦é‡å†™éƒ¨ç½²ï¼Œä¾‹å¦‚ä¿®æ”¹æ—¥å¿—çº§åˆ« &lt;configuration scan=\"true\" scanPeriod=\"60 seconds\"> &lt;!-- ... --> &lt;/configuration> 3.3 æ—¥å¿—æ‹†åˆ†å’Œå½’æ¡£å‹ç¼©çš„appender&lt;appender name=\"rollFile\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\"> &lt;!-- æ—¥å¿—æ–‡ä»¶ä¿å­˜è·¯å¾„ --> &lt;file>${log_dir}/roll_logback.log&lt;/file> &lt;!-- æ—¥å¿—æ¶ˆæ¯æ ¼å¼é…ç½®--> &lt;encoder class=\"ch.qos.logback.classic.encoder.PatternLayoutEncoder\"> &lt;pattern>${pattern}&lt;/pattern> &lt;/encoder> &lt;!-- æŒ‡å®šæ‹†åˆ†è§„åˆ™ --> &lt;rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\"> &lt;!-- æŒ‰ç…§æ—¶é—´å’Œå‹ç¼©æ ¼å¼å£°æ˜æ‹†åˆ†çš„æ–‡ä»¶å --> &lt;fileNamePattern>${log_dir}/rolling.%d{yyyy-MM-dd}.log%i.gz&lt;/fileNamePattern> &lt;!-- æŒ‰ç…§æ–‡ä»¶å¤§å°æ‹†åˆ† --> &lt;maxFileSize>1MB&lt;/maxFileSize> &lt;/rollingPolicy> &lt;/appender> 3.4 è¿‡æ»¤å™¨å†™åœ¨Appenderä¸­ çº§åˆ«è¿‡æ»¤å™¨ï¼š &lt;filter class=\"ch.qos.logback.classic.filter.LevelFilter\"> &lt;!-- æ—¥å¿—è¿‡æ»¤è§„åˆ™ --> &lt;level>ERROR&lt;/level> &lt;onMatch>ACCEPT&lt;/onMatch> &lt;onMismatch>DENY&lt;/onMismatch> &lt;/filter> å…¶ä»–çš„è¿˜æœ‰ThresholdFilterï¼ˆä¸´ç•Œå€¼è¿‡æ»¤å™¨ï¼‰ã€EvaluatorFilterï¼ˆæ±‚å€¼è¿‡æ»¤å™¨ï¼‰ç­‰ã€‚ 3.5 å¼‚æ­¥æ—¥å¿—&lt;appender name=\"async\" class=\"ch.qos.logback.classic.AsyncAppender\"> &lt;!-- æŒ‡å®šæŸä¸ªå…·ä½“çš„appender --> &lt;appender-ref ref=\"file\">&lt;/appender-ref> &lt;/appender> 3.6 è‡ªå®šä¹‰Logger&lt;!-- è‡ªå®šä¹‰loggerå¯¹è±¡ additivityï¼šæ˜¯å¦ç»§æ‰¿è‡ªrootLogger --> &lt;logger name=\"com.rhett.consoleLogger\" level=\"INFO\" additivity=\"false\"> &lt;appender-ref ref=\"console\">&lt;/appender-ref> &lt;/logger> 4 logback-accessçš„ä½¿ç”¨logback-accessæ¨¡å—ä¸Servletå®¹å™¨(å¦‚Tomcatå’ŒJetty)é›†æˆ,ä»¥æä¾›HTTPè®¿é—®æ—¥å¿—åŠŸèƒ½ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨logback-accesæ¨¡å—æ¥æ›¿æ¢tomcatçš„è®¿é—®æ—¥å¿—ã€‚ æ­¥éª¤ï¼š å°†logback-access.jarä¸logback-core.jarå¤åˆ¶åˆ°$TOMCAT_HOME/lib/ç›®å½•ä¸‹ åœ¨$TOMCAT_HOME/conf/server.xmlä¸­çš„Hostå…ƒç´ ä¸­æ·»åŠ ï¼š &lt;Value className=\"ch.qos.logback.access.tomcat.LogbackValue\" /> logbacké»˜è®¤ä¼šåœ¨$TOMCAT_HOME/confä¸‹æŸ¥æ‰¾æ–‡ä»¶logback-access.xml ç¤ºä¾‹é…ç½®ï¼š &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;configuration> &lt;!-- always a good activate OnConsoleStatusListener--> &lt;statusListener class=\"ch.qos.logback.core.status.OnConsoleStatusListener\"/> &lt;property name=\"LOG_DIR\" value=\"${catalina.base}/logs\"/> &lt;appender name=\"FILE\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\"> &lt;file>${LOG_DIR}/access.log&lt;/file> &lt;rollingPolicy class=\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\"> &lt;fileNamePattern>access.%d{yyyy-MM-dd).log.zip&lt;/fileNamePattern> &lt;/rollingPolicy> &lt;encoder> &lt;pattern>combined&lt;/pattern> &lt;/encoder> &lt;/appender> &lt;appender-ref ref=\"FILE\"/> &lt;/configuration>","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"æ—¥å¿—","slug":"æ—¥å¿—","permalink":"https://www.codetool.top/tags/%E6%97%A5%E5%BF%97/"}]},{"title":"æ—¥å¿—é—¨é¢SLF4Jä»‹ç»å’Œä½¿ç”¨","slug":"æ—¥å¿—é—¨é¢SLF4Jä»‹ç»å’Œä½¿ç”¨","date":"2020-03-09T12:43:21.000Z","updated":"2020-03-09T16:11:37.656Z","comments":true,"path":"article/æ—¥å¿—é—¨é¢SLF4Jä»‹ç»å’Œä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/%E6%97%A5%E5%BF%97%E9%97%A8%E9%9D%A2SLF4J%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 SLF4jæ¦‚è¿°ä¸Šç¯‡æ–‡ç« å†™äº†æ—¥å¿—é—¨é¢ä»‹ç»å’ŒJCLä½¿ç”¨ï¼Œä½œä¸ºä¸€ä¸ªæ›¾ç»çš„ä¸»æµæ—¥å¿—é—¨é¢æŠ€æœ¯ï¼ŒJCLç»ˆç©¶å› ä¸ºè®¾è®¡æ—¶çš„äº§ç”Ÿé—®é¢˜æ‰€é™ï¼Œå¯¼è‡´è‡³ä»Šå·²æ²¡ä»€ä¹ˆäººä½¿ç”¨ï¼Œè€Œä¸€æ¬¾ä¼˜ç§€çš„æ—¥å¿—é—¨é¢æŠ€æœ¯SLF4jï¼Œå¸å–äº†JCLçš„æ•™è®­ä¸ç»éªŒï¼Œå‡ºç°åœ¨javaå¼€å‘è€…çš„è§†é‡ä¸­ï¼Œå¼€å§‹è¢«å¹¿æ³›å…³æ³¨å’Œä½¿ç”¨ã€‚ è¿™é‡Œå¦‚æœè°ˆè°ˆå†å²è¿˜è›®å¥½ç©çš„ï¼Œæ¶‰åŠåˆ°ä¸€ä½Javaæ—¥å¿—é¢†åŸŸçŸ¥åäººç‰©Ceki GÃ¼lcÃ¼ï¼Œlog4jã€slf4jã€logbackéƒ½æ˜¯å‡ºè‡ªä»–ä¹‹æ‰‹ï¼Œåœ¨Apacheç»„ç»‡å¼€å‘çš„log4jï¼Œåæ¥ç¦»å¼€äº†apacheå¼€å‘äº†logbackï¼Œapacheåè€Œåˆæ¨å‡ºäº†log4j2ä¸ä¹‹ç«äº‰ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»çœ‹çœ‹Javaæ—¥å¿—ç³»ç»Ÿå†å²ä»å…¥é—¨åˆ°å´©æºƒ - ä¸ªäººæ–‡ç«  - SegmentFault æ€å¦ SLF4Jï¼Œå³ç®€å•æ—¥å¿—é—¨é¢ï¼ˆSimple Logging Facade for Javaï¼‰,ä¹Ÿä¸ºJavaæ—¥å¿—è®¿é—®æä¾›äº†ä¸€å¥—æ ‡å‡†ã€è§„èŒƒçš„APIæ¡†æ¶ï¼Œå®ƒæ”¯æŒäº†log4jå’Œlogbackï¼Œå®ƒæœ¬èº«ä¹Ÿæä¾›äº†åŠŸèƒ½è¾ƒç®€å•çš„æ—¥å¿—å®ç°ï¼Œä½†ä¸€èˆ¬å¾ˆå°‘ç”¨åˆ°ï¼Œå®ƒçš„è®¾è®¡æ€æƒ³å’ŒJCLè¾ƒä¸ºä¸åŒï¼Œè¦ä¹ˆéµå¾ªslf4jè§„èŒƒå¼€å‘ï¼Œè¦ä¹ˆä½¿ç”¨é€‚é…å™¨æ¥å®Œæˆslf-apiä¸å…·ä½“æ—¥å¿—å®ç°æ¡†æ¶çš„æ•´åˆã€‚ 2 SLF4jä½¿ç”¨2.1 mavenä¾èµ–&lt;!-- slf4jæ—¥å¿—é—¨é¢ --> &lt;dependency> &lt;groupId>org.slf4j&lt;/groupId> &lt;artifactId>slf4j-api&lt;/artifactId> &lt;version>1.7.30&lt;/version> &lt;/dependency> &lt;!-- slf4jå†…ç½®çš„ç®€å•å®ç° --> &lt;dependency> &lt;groupId>org.slf4j&lt;/groupId> &lt;artifactId>slf4j-simple&lt;/artifactId> &lt;version>1.7.30&lt;/version> &lt;/dependency> 2.2 æ—¥å¿—ç»‘å®šSLF4Jä½¿ç”¨æŒ‡å®šçš„æ—¥å¿—æ¡†æ¶éœ€è¦é€šè¿‡â€œæ—¥å¿—ç»‘å®šâ€ï¼Œé€šè¿‡ä¸€äº›jaræ–‡ä»¶å®ç°ã€‚ ç»‘å®šå…·ä½“çš„æ—¥å¿—å®ç°æ¡†æ¶ï¼š ç»‘å®šå·²ç»å®ç°äº†sf4çš„æ—¥å¿—æ¡†æ¶ç›´æ¥æ·»åŠ å¯¹åº”ä¾èµ– ç»‘å®šæ²¡æœ‰å®ç°sf4çš„æ—¥å¿—æ¡†æ¶å…ˆæ·»åŠ æ—¥å¿—çš„é€‚é…å™¨å†æ·»åŠ å®ç°ç±»çš„ä¾èµ– logbackã€slf4j-simpleéµå¾ªäº†slf4j-apiçš„å¼€å‘ï¼Œåªéœ€è¦å¯¼å…¥å¯¹åº”ä¾èµ–ã€‚ slf4j-nopæ˜¯å…³é—­æ—¥å¿—åŠŸèƒ½ã€‚ å¦‚æœç»‘å®šäº†å¤šä¸ªæ—¥å¿—å®ç°ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„æ—¥å¿—å®ç°ã€‚ ä¾‹ï¼šç»‘å®šlog4j &lt;dependency> &lt;groupId>log4j&lt;/groupId> &lt;artifactId>log4j&lt;/artifactId> &lt;version>1.2.17&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.slf4j&lt;/groupId> &lt;artifactId>slf4j-log4j12&lt;/artifactId> &lt;version>1.7.12&lt;/version> &lt;/dependency> 2.3 æ¡¥æ¥slf4jçš„å¼ºå¤§ä¹‹å¤„è¿˜åœ¨äºå®ƒå¯¹é—ç•™ä»£ç çš„æ”¯æŒï¼Œå¦‚æœé¡¹ç›®ä¹‹å‰ä½¿ç”¨çš„æ˜¯ä¾‹å¦‚Log4jç­‰æ—¥å¿—æ¡†æ¶å®ç°ï¼Œå¯ä»¥é€šè¿‡slf4jæä¾›çš„â€œæ¡¥æ¥å™¨â€å°†å…¶è½¬ç§»è‡³slf4jä½¿ç”¨ã€‚ç”šè‡³è¿˜å¯ä»¥æ¡¥æ¥JCLã€‚ ä¾‹å¦‚ï¼šlog4jä»£ç é€šè¿‡æ¡¥æ¥å™¨è½¬ç§»è‡³logbackå®ç°ï¼Œé¦–å…ˆç§»é™¤log4jä¾èµ–ï¼Œç„¶åæ·»åŠ æ¡¥æ¥å™¨ï¼š &lt;dependency> &lt;groupId>org.slf4j&lt;/groupId> &lt;artifactId>log4j-over-slf4j&lt;/artifactId> &lt;version>1.7.12&lt;/version> &lt;/dependency> è¿™é‡Œä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜æ¯”å¦‚log4j-over-slf4jä¸slf4j-log4j12å…±å­˜å‡ºç°stack overflowï¼Œå°±æ˜¯å› ä¸ºslf4j&lt;-&gt;log4jæ­»å¾ªç¯ 2.4 ç‰¹æ€§æ ¸å¿ƒç±»ï¼š Loggerï¼šæ—¥å¿—è®°å½•å™¨ï¼Œç”¨äºå†™æ—¥å¿— LoggerFactoryï¼šæ—¥å¿—è®°å½•å™¨çš„å·¥å‚ç±»ï¼Œç”¨äºè·å–æ—¥å¿—è®°å½•å™¨ã€‚ æ—¥å¿—çº§åˆ«ï¼š trace debug info warn error æ¯”JCLè¿˜å°‘ä¸€ä¸ªfatalçº§åˆ«ã€‚ ä½¿ç”¨å ä½ç¬¦è¾“å‡ºæ—¥å¿—ä¿¡æ¯ï¼š public static final Logger LOGGER = LoggerFactory.getLogger(SLF4JTest.class); @Test public void testQuick() { String name = \"rhett\"; LOGGER.info(\"åå­—ï¼š{}\",name); } å°†ç³»ç»Ÿå¼‚å¸¸ä¿¡æ¯è¾“å‡ºï¼š Loggeræä¾›äº†å¸¦throwableå‚æ•°çš„æ–¹æ³•é‡è½½ï¼Œå¯ä»¥ä¾¿æ·åœ°è¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼š public static final Logger LOGGER = LoggerFactory.getLogger(SLF4JTest.class); @Test public void testException(){ try{ int i = 1/0; }catch (Exception e){ LOGGER.error(\"å‡ºç°å¼‚å¸¸ï¼š\",e); } } 3 SLF4JåŸç†è¿™ä¸ªé˜¶æ®µæ¨èè‡ªå·±è¿›è¡Œæºç è·Ÿè¸ªï¼Œæˆ‘å¤§æ¦‚æŠŠæ–¹æ³•æ ˆè´´ä¸€ä¸‹ public static Logger getLogger(Class&lt;?> clazz) { Logger logger = getLogger(clazz.getName());//!!! if (DETECT_LOGGER_NAME_MISMATCH) { Class&lt;?> autoComputedCallingClass = Util.getCallingClass(); if (autoComputedCallingClass != null &amp;&amp; nonMatchingClasses(clazz, autoComputedCallingClass)) { Util.report(String.format(\"Detected logger name mismatch. Given name: \\\"%s\\\"; computed name: \\\"%s\\\".\", logger.getName(), autoComputedCallingClass.getName())); Util.report(\"See \" + LOGGER_NAME_MISMATCH_URL + \" for an explanation\"); } } return logger; } public static Logger getLogger(String name) { ILoggerFactory iLoggerFactory = getILoggerFactory(); return iLoggerFactory.getLogger(name); } public static ILoggerFactory getILoggerFactory() { if (INITIALIZATION_STATE == UNINITIALIZED) { synchronized (LoggerFactory.class) { if (INITIALIZATION_STATE == UNINITIALIZED) { INITIALIZATION_STATE = ONGOING_INITIALIZATION; performInitialization();//é€šå¾€bindæ–¹æ³• } } } switch (INITIALIZATION_STATE) { case SUCCESSFUL_INITIALIZATION: return StaticLoggerBinder.getSingleton().getLoggerFactory(); case NOP_FALLBACK_INITIALIZATION: return NOP_FALLBACK_FACTORY; case FAILED_INITIALIZATION: throw new IllegalStateException(UNSUCCESSFUL_INIT_MSG); case ONGOING_INITIALIZATION: // support re-entrant behavior. // See also http://jira.qos.ch/browse/SLF4J-97 return SUBST_FACTORY; } throw new IllegalStateException(\"Unreachable code\"); } private final static void bind() { try { Set&lt;URL> staticLoggerBinderPathSet = null; // skip check under android, see also // http://jira.qos.ch/browse/SLF4J-328 if (!isAndroid()) { staticLoggerBinderPathSet = findPossibleStaticLoggerBinderPathSet();//!!! reportMultipleBindingAmbiguity(staticLoggerBinderPathSet); } // the next line does the binding StaticLoggerBinder.getSingleton(); INITIALIZATION_STATE = SUCCESSFUL_INITIALIZATION; reportActualBinding(staticLoggerBinderPathSet); } catch (NoClassDefFoundError ncde) { String msg = ncde.getMessage(); if (messageContainsOrgSlf4jImplStaticLoggerBinder(msg)) { INITIALIZATION_STATE = NOP_FALLBACK_INITIALIZATION; Util.report(\"Failed to load class \\\"org.slf4j.impl.StaticLoggerBinder\\\".\"); Util.report(\"Defaulting to no-operation (NOP) logger implementation\"); Util.report(\"See \" + NO_STATICLOGGERBINDER_URL + \" for further details.\"); } else { failedBinding(ncde); throw ncde; } } catch (java.lang.NoSuchMethodError nsme) { String msg = nsme.getMessage(); if (msg != null &amp;&amp; msg.contains(\"org.slf4j.impl.StaticLoggerBinder.getSingleton()\")) { INITIALIZATION_STATE = FAILED_INITIALIZATION; Util.report(\"slf4j-api 1.6.x (or later) is incompatible with this binding.\"); Util.report(\"Your binding is version 1.5.5 or earlier.\"); Util.report(\"Upgrade your binding to version 1.6.x.\"); } throw nsme; } catch (Exception e) { failedBinding(e); throw new IllegalStateException(\"Unexpected initialization failure\", e); } finally { postBindCleanUp(); } } static Set&lt;URL> findPossibleStaticLoggerBinderPathSet() { // use Set instead of list in order to deal with bug #138 // LinkedHashSet appropriate here because it preserves insertion order // during iteration Set&lt;URL> staticLoggerBinderPathSet = new LinkedHashSet&lt;URL>(); try { ClassLoader loggerFactoryClassLoader = LoggerFactory.class.getClassLoader(); Enumeration&lt;URL> paths; if (loggerFactoryClassLoader == null) { paths = ClassLoader.getSystemResources(STATIC_LOGGER_BINDER_PATH); } else { paths = loggerFactoryClassLoader.getResources(STATIC_LOGGER_BINDER_PATH); } while (paths.hasMoreElements()) { URL path = paths.nextElement(); staticLoggerBinderPathSet.add(path); } } catch (IOException ioe) { Util.report(\"Error getting resources from path\", ioe); } return staticLoggerBinderPathSet; } private static String STATIC_LOGGER_BINDER_PATH = \"org/slf4j/impl/StaticLoggerBinder.class\"; æ³¨æ„: è™½ç„¶StaticLoggerBinderæ˜¯åœ¨org.slf4j.implåŒ…ä¸‹,ä½†æ—¥å¿—é—¨é¢jaråŒ…ä¸­å¹¶æ— æ­¤ç±»,æ­¤ç±»æ˜¯ç”±æ¡¥æ¥å™¨å®ç°çš„ã€‚ æ¡¥æ¥å™¨çš„åŸç†å…¶å®å°±æ˜¯åœ¨å…¶jaråŒ…ä¸­å­˜åœ¨StaticLoggerBinder.class,è¿™æ ·å°±å¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç»‘å®šåº•å±‚çš„æ—¥å¿—å®ç°æ¡†æ¶ã€‚ ç„¶åå›åˆ°bindæ–¹æ³•ï¼š StaticLoggerBinder.getSingleton(); è·å–äº†ä¸€ä¸ªStaticLoggerBinderçš„å•ä¾‹å¯¹è±¡ ç„¶åè¿”å›getILoggerFactoryæ–¹æ³•ï¼š case SUCCESSFUL_INITIALIZATION: return StaticLoggerBinder.getSingleton().getLoggerFactory(); æ€»ç»“ï¼šæ¡¥æ¥å™¨ä¼šè°ƒç”¨çš„æ—¥å¿—æ¡†æ¶å®ç°çš„ç›¸å…³ä»£ç ç”Ÿæˆå…¶å†…éƒ¨çš„Logger(æ­¤Loggerä¸org.slf4j.Logger)ä¸å…¼å®¹,å†é€šè¿‡é€‚é…å™¨åŒ…è£…æ—¥å¿—æ¡†æ¶å®ç°å†…éƒ¨çš„Logger.","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"æ—¥å¿—","slug":"æ—¥å¿—","permalink":"https://www.codetool.top/tags/%E6%97%A5%E5%BF%97/"}]},{"title":"æ—¥å¿—é—¨é¢ä»‹ç»å’ŒJCLä½¿ç”¨","slug":"æ—¥å¿—é—¨é¢ä»‹ç»å’ŒJCLä½¿ç”¨","date":"2020-03-09T09:45:50.000Z","updated":"2020-03-09T10:59:29.223Z","comments":true,"path":"article/æ—¥å¿—é—¨é¢ä»‹ç»å’ŒJCLä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/%E6%97%A5%E5%BF%97%E9%97%A8%E9%9D%A2%E4%BB%8B%E7%BB%8D%E5%92%8CJCL%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 æ—¥å¿—é—¨é¢æ¦‚è¿°ä¹‹å‰æœ‰å†™è¿‡Javaæ—¥å¿—æ¡†æ¶JULå’ŒLog4jä»‹ç»ï¼Œå¯ä»¥å¯¹æ¯”å‘ç°å®ƒä»¬ä¹‹é—´çš„ä½¿ç”¨è¿˜æ˜¯æœ‰ä¸€äº›åŒºåˆ«çš„ï¼Œæ¯”å¦‚æœ‰ä¸€äº›ç±»åæ˜¯ä¸åŒçš„ã€æ—¥å¿—çš„è¾“å‡ºçº§åˆ«ä¹Ÿä¸å®Œå…¨ä¸€è‡´ã€‚ é‚£ä¹ˆå®é™…ä¸Šæ˜¯å¢å¤§äº†æ—¥å¿—æ¡†æ¶ä¸ç¨‹åºçš„è€¦åˆæ€§ï¼Œä½¿å¾—éš¾ä»¥æ›´æ¢æ—¥å¿—æ¡†æ¶ã€‚ç”šè‡³ä¼šé€ æˆä¸€äº›ä¼˜ç§€çš„æ¡†æ¶å¼ºåˆ¶æ€§ä¾èµ–æŸä¸€ä¸ªå…·ä½“çš„æ—¥å¿—å®ç°ç±»ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ—¥å¿—é—¨é¢æŠ€æœ¯å°±è¯ç”Ÿäº†ã€‚ æ—¥å¿—é—¨é¢å®è´¨ä¸Šå°±æ˜¯æä¾›äº†ä¸€å¥—é€šç”¨çš„æ—¥å¿—APIæŠ€æœ¯ï¼Œå’ŒJDBCçš„æ€æƒ³ç±»ä¼¼ï¼Œä½¿ç”¨æ—¥å¿—é—¨é¢ï¼Œå°±å¯ä»¥è½»æ¾åœ°æ›´æ¢æ—¥å¿—å®ç°ã€‚ æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ—¥å¿—é—¨é¢ï¼š é¢å‘æ¥å£å¼€å‘,ä¸å†ä¾èµ–å…·ä½“çš„å®ç°ç±»å‡å°‘ä»£ç çš„è€¦åˆ é¡¹ç›®é€šè¿‡å¯¼å…¥ä¸åŒçš„æ—¥å¿—å®ç°ç±»,å¯ä»¥çµæ´»çš„åˆ‡æ¢æ—¥å¿—æ¡†æ¶ ç»Ÿä¸€API,æ–¹ä¾¿å¼€å‘è€…å­¦ä¹ å’Œä½¿ç”¨ ç»Ÿä¸€é…ç½®ä¾¿äºé¡¹ç›®æ—¥å¿—çš„ç®¡ç† å¸¸è§çš„æ—¥å¿—é—¨é¢ï¼šJCLã€slf4j 2 JCL2.1 JCLä»‹ç»JCLå…¨ç§°ä¸ºJakarta Commons Loggingï¼Œæ˜¯ Apacheæä¾›çš„ä¸€ä¸ªé€šç”¨æ—¥å¿—API å®ƒæ˜¯ä¸ºâ€œæ‰€æœ‰çš„Javaæ—¥å¿—å®ç°â€æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£,å®ƒè‡ªèº«ä¹Ÿæä¾›ä¸€ä¸ªæ—¥å¿—çš„å®ç°,ä½†æ˜¯åŠŸèƒ½éå¸¸å¸¸å¼±(SimpleLog)ã€‚æ‰€ä»¥ä¸€èˆ¬ä¸ä¼šå•ç‹¬ä½¿ç”¨å®ƒã€‚ä»–å…è®¸å¼€å‘äººå‘˜ä½¿ç”¨ä¸åŒçš„å…·ä½“æ—¥å¿—å®ç°å·¥å…·:Log4jã€jdkè‡ªå¸¦çš„æ—¥å¿—(JUL)ã€‚ 2.2 JCLä½¿ç”¨mavenä¾èµ–ï¼š &lt;dependency> &lt;groupId>commons-logging&lt;/groupId> &lt;artifactId>commons-logging&lt;/artifactId> &lt;version>1.2&lt;/version> &lt;/dependency> å¦‚æœè¦ä½¿ç”¨log4jè¿˜éœ€åŠ ä¸Šlog4jçš„ä¾èµ– æ ¸å¿ƒç±»ï¼š Logï¼šæ—¥å¿—è®°å½•å™¨ï¼Œç”¨äºå†™æ—¥å¿— LogFactoryï¼šæ—¥å¿—è®°å½•å™¨çš„å·¥å‚ç±»ï¼Œç”¨äºè·å–æ—¥å¿—è®°å½•å™¨ã€‚ JCLçš„æ—¥å¿—çº§åˆ«ï¼š trace debug info warn error fatal å¯ä»¥çœ‹å‡ºå’Œlog4jçš„æ—¥å¿—çº§åˆ«ä¸€è‡´ï¼Œä½†å®ƒæŠŠJULçš„æ—¥å¿—çº§åˆ«ä¹Ÿé€‚é…åˆ°äº†è¿™å¥—æ—¥å¿—çº§åˆ«ä¸Šã€‚ å¯¹äºé…ç½®æ–‡ä»¶ï¼Œå¦‚æœä½¿ç”¨JULå°±æ·»åŠ JULçš„é…ç½®æ–‡ä»¶ï¼Œå¦‚æœä½¿ç”¨log4jå°±æ·»åŠ Log4jçš„é…ç½®æ–‡ä»¶ã€‚ JCLé»˜è®¤ä¼šæ ¹æ®å¦‚ä¸‹é¡ºåºæŸ¥æ‰¾æ—¥å¿—çš„å®ç°ç±»ï¼š private static final String[] classesToDiscover = { LOGGING_IMPL_LOG4J_LOGGER, \"org.apache.commons.logging.impl.Jdk14Logger\", \"org.apache.commons.logging.impl.Jdk13LumberjackLogger\", \"org.apache.commons.logging.impl.SimpleLog\" }; for(int i=0; i&lt;classesToDiscover.length &amp;&amp; result == null; ++i) { result = createLogFromClass(classesToDiscover[i], logCategory, true); } å…¶ä¸­LOGGING_IMPL_LOG4J_LOGGERä»£è¡¨çš„æ˜¯log4jçš„org.apache.commons.logging.impl.Log4JLoggerï¼Œå¯ä»¥çœ‹åˆ°JCLæ”¯æŒçš„æ—¥å¿—å®ç°æœ‰ï¼š log4j jdk1.4çš„æ—¥å¿—ï¼ˆJULï¼‰ jdk1.3å‰çš„LumberjackLoggerï¼ˆå·²ç»æ·˜æ±°ï¼‰ JCLè‡ªå¸¦çš„SimpleLog å¦‚æœç”¨æˆ·ä¸æŒ‡å®šä½¿ç”¨å“ªä¸ªæ—¥å¿—å®ç°ç±»ï¼ŒJCLä¼šæŒ‰è¿™ä¸ªé¡ºåºæŸ¥æ‰¾ï¼Œä½¿ç”¨æœ€å…ˆæ‰¾åˆ°çš„å®ç°ç±»ã€‚ å¦‚æœéœ€è¦æŒ‡å®šï¼Œè¿˜éœ€è¦æ·»åŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶commons-logging.propertiesåœ¨ç±»è·¯å¾„ä¸‹ï¼š org.apache.commons.logging.Log=org.apache.commons.logging.impl.SimpleLog æ­¤åå°±å¯ä»¥ä½¿ç”¨äº†ï¼š Log log = LogFactory.getLog(JCLTest.class); log.info(\"hello JCL\"); 2.3 JCLçš„é—®é¢˜JCLçš„é—®é¢˜æ˜¯ï¼Œå½“åˆè®¾è®¡çš„æ—¶å€™åªè€ƒè™‘åˆ°äº†åœ¨å½“æ—¶æ¯”è¾ƒä¸»æµçš„æ—¥å¿—æ¡†æ¶log4jã€JULï¼Œä¹Ÿåªæ”¯æŒè¿™å‡ ä¸ªæ—¥å¿—æ¡†æ¶ï¼Œå¯¼è‡´åé¢å¦‚æœå‡ºç°äº†æ›´å¼ºå¤§çš„æ—¥å¿—æ¡†æ¶ï¼Œæ¯”å¦‚è¯´logbackå‡ºç°åï¼Œå¦‚æœéœ€è¦ä½¿ç”¨logbackï¼ŒJCLéœ€è¦é€šè¿‡ä¿®æ”¹ä»£ç çš„æ–¹å¼æ¥é€‚é…ï¼Œå½“ç„¶è¿™ä¼šé€ æˆå¾ˆå¤§çš„éº»çƒ¦ã€‚ JCLè·å–æ—¥å¿—å·¥å‚çš„è¿‡ç¨‹ä¸­ä½¿ç”¨äº†classLoaderæ¥å¯»æ‰¾æ—¥å¿—å·¥å‚å®ç°ï¼Œè¿›è€Œå¯¼è‡´äº†å…¶ä»–ç»„ä»¶ï¼Œå¦‚è‹¥ä½¿ç”¨è‡ªå·±çš„classloaderï¼Œåˆ™ä¸èƒ½è·å–å…·ä½“çš„æ—¥å¿—å·¥å‚å¯¹è±¡ï¼Œåˆ™å¯¼è‡´å¯åŠ¨å¤±è´¥ã€‚ï¼ˆå³æ— æ³•åŠ¨æ€æŸ¥æ‰¾ï¼‰ äºæ˜¯ä¸ä¹…commons-loggingå°±é€€å‡ºäº†äººä»¬çš„è§†çº¿ï¼Œæ›´å¥½çš„æ—¥å¿—é—¨é¢æŠ€æœ¯slf4jè¯ç”Ÿä»¥å–ä»£å®ƒçš„ä½ç½®ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"æ—¥å¿—","slug":"æ—¥å¿—","permalink":"https://www.codetool.top/tags/%E6%97%A5%E5%BF%97/"}]},{"title":"leetcode121-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº","slug":"leetcode121-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº","date":"2020-03-08T16:12:45.000Z","updated":"2020-03-08T16:22:43.537Z","comments":true,"path":"article/leetcode121-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº/","link":"","permalink":"https://www.codetool.top/article/leetcode121-%E4%B9%B0%E5%8D%96%E8%82%A1%E7%A5%A8%E7%9A%84%E6%9C%80%E4%BD%B3%E6%97%B6%E6%9C%BA/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´ æ˜¯ä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚ å¦‚æœä½ æœ€å¤šåªå…è®¸å®Œæˆä¸€ç¬”äº¤æ˜“ï¼ˆå³ä¹°å…¥å’Œå–å‡ºä¸€æ”¯è‚¡ç¥¨ï¼‰ï¼Œè®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚ æ³¨æ„ä½ ä¸èƒ½åœ¨ä¹°å…¥è‚¡ç¥¨å‰å–å‡ºè‚¡ç¥¨ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: [7,1,5,3,6,4]è¾“å‡º: 5è§£é‡Š: åœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 6ï¼‰çš„æ—¶å€™å–å‡ºï¼Œæœ€å¤§åˆ©æ¶¦ = 6-1 = 5 ã€‚ æ³¨æ„åˆ©æ¶¦ä¸èƒ½æ˜¯ 7-1 = 6, å› ä¸ºå–å‡ºä»·æ ¼éœ€è¦å¤§äºä¹°å…¥ä»·æ ¼ã€‚ ç¤ºä¾‹ 2: è¾“å…¥: [7,6,4,3,1]è¾“å‡º: 0è§£é‡Š: åœ¨è¿™ç§æƒ…å†µä¸‹, æ²¡æœ‰äº¤æ˜“å®Œæˆ, æ‰€ä»¥æœ€å¤§åˆ©æ¶¦ä¸º 0ã€‚ 2 è§£æ³•2.1 æ€æƒ³ä»å·¦å¾€å³è®°å½•æœ€ä½ç‚¹ï¼Œè®°å½•ä¸‹å½“å‰ä»·æ ¼ä¸æœ€ä½ç‚¹çš„å·®å€¼çš„æœ€å¤§å€¼ã€‚ 2.2 ä»£ç class Solution { public int maxProfit(int[] prices) { int minprice = Integer.MAX_VALUE; int maxprofit = 0; for (int i = 0; i &lt; prices.length; i++) { if (prices[i] &lt; minprice) minprice = prices[i]; else if (prices[i] - minprice > maxprofit) maxprofit = prices[i] - minprice; } return maxprofit; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"SpringBootè‡ªåŠ¨é…ç½®åŸç†ä¸è‡ªå®šä¹‰é…ç½®ä»‹ç»","slug":"SpringBootè‡ªåŠ¨é…ç½®åŸç†ä¸è‡ªå®šä¹‰é…ç½®ä»‹ç»","date":"2020-03-08T13:34:46.000Z","updated":"2020-03-10T14:27:21.277Z","comments":true,"path":"article/SpringBootè‡ªåŠ¨é…ç½®åŸç†ä¸è‡ªå®šä¹‰é…ç½®ä»‹ç»/","link":"","permalink":"https://www.codetool.top/article/SpringBoot%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86%E4%B8%8E%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%E4%BB%8B%E7%BB%8D/","excerpt":"","text":"SpringBooté…ç½®ä¸è‡ªåŠ¨é…ç½®åŸç† 1 è‡ªåŠ¨é…ç½®åŸç†SpringBootå¯åŠ¨çš„æ—¶å€™åŠ è½½ä¸»é…ç½®ç±»ï¼Œå¼€å¯äº†è‡ªåŠ¨é…ç½®åŠŸèƒ½ @EnableAutoConfigurationï¼š @Target(ElementType.TYPE) @Retention(RetentionPolicy.RUNTIME) @Documented @Inherited @SpringBootConfiguration @EnableAutoConfiguration //!!! @ComponentScan(excludeFilters = { @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class), @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) }) public @interface SpringBootApplication @EnableAutoConfiguration çš„ä½œç”¨ï¼š åˆ©ç”¨EnableAutoConfigurationImportSelectorç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€äº›ç»„ä»¶ @Target(ElementType.TYPE) @Retention(RetentionPolicy.RUNTIME) @Documented @Inherited @AutoConfigurationPackage @Import(AutoConfigurationImportSelector.class) //!!! public @interface EnableAutoConfiguration å¯ä»¥æŸ¥çœ‹AutoConfigurationImportSelector.selectImports()æ–¹æ³•çš„å†…å®¹ï¼› public String[] selectImports(AnnotationMetadata annotationMetadata) { if (!isEnabled(annotationMetadata)) { return NO_IMPORTS; } AutoConfigurationMetadata autoConfigurationMetadata = AutoConfigurationMetadataLoader .loadMetadata(this.beanClassLoader); AutoConfigurationEntry autoConfigurationEntry = getAutoConfigurationEntry(autoConfigurationMetadata, annotationMetadata);//!!! return StringUtils.toStringArray(autoConfigurationEntry.getConfigurations()); } getAutoConfigurationEntry()æ–¹æ³•ï¼š protected AutoConfigurationEntry getAutoConfigurationEntry(AutoConfigurationMetadata autoConfigurationMetadata, AnnotationMetadata annotationMetadata) { if (!isEnabled(annotationMetadata)) { return EMPTY_ENTRY; } AnnotationAttributes attributes = getAttributes(annotationMetadata); List&lt;String> configurations = getCandidateConfigurations(annotationMetadata, attributes);//!!! configurations = removeDuplicates(configurations); Set&lt;String> exclusions = getExclusions(annotationMetadata, attributes); checkExcludedClasses(configurations, exclusions); configurations.removeAll(exclusions); configurations = filter(configurations, autoConfigurationMetadata); fireAutoConfigurationImportEvents(configurations, exclusions); return new AutoConfigurationEntry(configurations, exclusions); } getCandidateConfigurations()æ–¹æ³•ï¼š protected List&lt;String> getCandidateConfigurations(AnnotationMetadata metadata, AnnotationAttributes attributes) { List&lt;String> configurations = SpringFactoriesLoader.loadFactoryNames(getSpringFactoriesLoaderFactoryClass(), getBeanClassLoader()); Assert.notEmpty(configurations, \"No auto configuration classes found in META-INF/spring.factories. If you \" + \"are using a custom packaging, make sure that file is correct.\"); return configurations; } ä»META-INFä¸‹é¢æ‰¾spring.factoriesæ–‡ä»¶ï¼Œå°†é‡Œé¢é…ç½®çš„æ‰€æœ‰EnableAutoConfigurationçš„å€¼åŠ å…¥åˆ°äº†å®¹å™¨ä¸­ æ¯ä¸€ä¸ªè¿™æ ·çš„xxxAutoConfigurationç±»éƒ½æ˜¯å®¹å™¨ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼Œéƒ½åŠ å…¥åˆ°å®¹å™¨ä¸­ï¼›ç”¨ä»–ä»¬æ¥åšè‡ªåŠ¨é…ç½®ã€‚ ä¾‹å¦‚ï¼šè‡ªåŠ¨é…ç½®ç±»DispatcherServletAutoConfiguration ï¼ˆèŠ‚é€‰å†…éƒ¨ç±»DispatcherServletConfigurationï¼‰ //é…ç½®æ–‡ä»¶ @Configuration(proxyBeanMethods = false) //é…ç½®æ¡ä»¶æ»¡è¶³ç±»DefaultDispatcherServletConditionçš„éªŒè¯ @Conditional(DefaultDispatcherServletCondition.class) //å¦‚æœå­˜åœ¨ServletRegistrationç±»åˆ™è¿›è¡Œé…ç½® @ConditionalOnClass(ServletRegistration.class) //å¦‚æœå­˜åœ¨å¯¹åº”çš„å±æ€§é…ç½®ï¼ˆWebMvcPropertieså¯¹åº”çš„æ˜¯spring.mvc.*ï¼‰åˆ™å¯ç”¨é…ç½® @EnableConfigurationProperties({ HttpProperties.class, WebMvcProperties.class }) protected static class DispatcherServletConfiguration { @Bean(name = DEFAULT_DISPATCHER_SERVLET_BEAN_NAME) public DispatcherServlet dispatcherServlet(HttpProperties httpProperties, WebMvcProperties webMvcProperties) { DispatcherServlet dispatcherServlet = new DispatcherServlet(); //æ³¨æ„ dispatcherServlet.setDispatchOptionsRequest(webMvcProperties.isDispatchOptionsRequest()); dispatcherServlet.setDispatchTraceRequest(webMvcProperties.isDispatchTraceRequest()); dispatcherServlet.setThrowExceptionIfNoHandlerFound(webMvcProperties.isThrowExceptionIfNoHandlerFound()); dispatcherServlet.setPublishEvents(webMvcProperties.isPublishRequestHandledEvents()); dispatcherServlet.setEnableLoggingRequestDetails(httpProperties.isLogRequestDetails()); return dispatcherServlet; } @Bean //å¦‚æœå­˜åœ¨ç±»å®šä¹‰åˆ™é…ç½® @ConditionalOnBean(MultipartResolver.class) //åˆ¤æ–­å¦‚æœä¸å­˜åœ¨beanåç§°ä¸ºDispatcherServlet.MULTIPART_RESOLVER_BEAN_NAMEï¼Œåˆ™é…ç½® bean @ConditionalOnMissingBean(name = DispatcherServlet.MULTIPART_RESOLVER_BEAN_NAME) public MultipartResolver multipartResolver(MultipartResolver resolver) { // Detect if the user has created a MultipartResolver but named it incorrectly return resolver; } } é€šè¿‡ä¸Šé¢çš„ä»£ç ,å¯ä»¥çœ‹åˆ°è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»ä½¿ç”¨äº†è®¸å¤š@Conditional**æ³¨è§£æ¥æ¡ä»¶æ€§åœ°åŠ è½½é…ç½®ï¼ˆæ¯”å¦‚è¯´æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„ç±»ï¼‰ï¼Œé…ç½®çš„é»˜è®¤å€¼ä»ä¸€ä¸ª**Propertiesç±»ä¸­å–å‡ºï¼Œå¦‚æœç”¨æˆ·é…ç½®äº†è‡ªå®šä¹‰å±æ€§ï¼Œä¼šè¦†ç›–æ‰**Propertiesä¸­çš„é»˜è®¤å€¼ã€‚ åˆ°è¿™é‡Œ,åº”è¯¥æ˜ç™½ä¸ºä»€ä¹ˆå‡ ä¹åœ¨æ²¡æœ‰ä»»ä½•é…ç½®ä¸‹å°±èƒ½ç”¨Spring Bootå¯åŠ¨ Spring MVCé¡¹ç›®ã€‚ä½†æ˜¯æœ‰æ—¶å€™,æˆ‘ä»¬éœ€è¦å¯¹è¿™äº›é»˜è®¤çš„ç¯å¢ƒè¿›è¡Œä¿®æ”¹ä»¥é€‚åº”ä¸ªæ€§åŒ–çš„è¦æ±‚,è¿™äº›åœ¨ Spring Bootä¸­ä¹Ÿæ˜¯éå¸¸ç®€å•çš„,æ­£å¦‚@EnableConfigurationPropertiesæ³¨è§£é‚£æ ·ï¼Œå®ƒå…è®¸è¯»å…¥é…ç½®æ–‡ä»¶çš„å†…å®¹æ¥è‡ªå®šä¹‰è‡ªåŠ¨åˆå§‹åŒ–æ‰€éœ€çš„å†…å®¹ã€‚ 2 Spring Booté…ç½®æ–‡ä»¶Spring Bootçš„æ‰€æœ‰çš„AutoConfigurationå±æ€§é¡¹å¯ä»¥åœ¨ https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#common-application-properties çœ‹åˆ°ã€‚è¿™ä¸€èŠ‚æˆ‘ä»¬ä¸»è¦ä»‹ç»è‡ªå®šä¹‰é…ç½®ã€‚ 2.1 yamlè¯­æ³•é…ç½®æ–‡ä»¶æ¨èä½¿ç”¨yamlè¯­æ³•æ¥å†™ï¼Œé€šè¿‡ç¼©è¿›æ¥è¡¨è¾¾æ•°æ®å…³ç³»ã€‚ 2.2 å­—ç¬¦ä¸²å­—ç¬¦ä¸²â€‹å¯ä»¥ä¸åŠ å¼•å·ï¼Œå¦‚æœåŠ å¼•å·ï¼š &quot;&quot;ï¼šåŒå¼•å·ï¼›ä¸ä¼šè½¬ä¹‰å­—ç¬¦ä¸²é‡Œé¢çš„ç‰¹æ®Šå­—ç¬¦ï¼›ç‰¹æ®Šå­—ç¬¦ä¼šä½œä¸ºæœ¬èº«æƒ³è¡¨ç¤ºçš„æ„æ€ name: &quot;zhangsan \\n lisi&quot;ï¼š\\nä¼šè§£æä¸ºå›è½¦ &#39;&#39;ï¼šå•å¼•å·ï¼›ä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œç‰¹æ®Šå­—ç¬¦æœ€ç»ˆåªæ˜¯ä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²æ•°æ® name: &#39;zhangsan \\n lisi&#39;ï¼š\\nä¸ä¼šè§£æä¸ºå›è½¦ 2.3 å¯¹è±¡ã€Mapfriends: lastName: zhangsan age: 20 è¡Œå†…å†™æ³•ï¼š friends: {lastName: zhangsan,age: 18} 2.3.1 æ•°ç»„ï¼ˆListã€Setï¼‰pets: - cat - dog - pig è¡Œå†…å†™æ³•ï¼š pets: [cat,dog,pig] 2.4 è‡ªå®šä¹‰å±æ€§é…ç½®å¯ä»¥åœ¨ç±»ä¸ŠåŠ ä¸Š@ConfigurationProperties(prefix=&quot;&quot;)æ³¨è§£ï¼ŒæŠŠæœ¬ç±»ä¸­æ‰€æœ‰å±æ€§å’Œé…ç½®æ–‡ä»¶ä¸­ç›¸å…³çš„é…ç½®è¿›è¡Œç»‘å®šã€‚ åªæœ‰è¿™ä¸ªç»„ä»¶æ˜¯å®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œæ‰èƒ½å®¹å™¨æä¾›çš„@ConfigurationPropertiesåŠŸèƒ½ã€‚ ä¾‹ï¼š JavaBean @Component @ConfigurationProperties(prefix = \"person\") public class Person { private String lastName; private Integer age; private Boolean boss; private Date birth; private Map&lt;String,Object> maps; private List&lt;Object> lists; private Dog dog; //getter and setter... } é…ç½®ï¼š person: lastName: hello age: 18 boss: false birth: 2000/01/01 maps: {k1: v1,k2: 12} lists: - lisi - zhaoliu dog: name: å°ç‹— age: 7 å®ƒé»˜è®¤ä»å…¨å±€é…ç½®ä¸­è·å–å€¼ï¼Œå¯ä»¥ä½¿ç”¨@PropertySource(value={})æ¥æŒ‡å®šé…ç½®æ–‡ä»¶ã€‚ è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨@Valueï¼Œå®ƒå¿…é¡»é…åˆSpELæ¥æŒ‡å®šå¯¹åº”é…ç½®çš„åç§°ï¼Œä¸æ”¯æŒæ¾æ•£è¯­æ³•ç»‘å®šï¼ˆå³å¤§å°å†™ç­‰ä¸åŒ¹é…ï¼‰ã€‚ 2.5 é…ç½®æ–‡ä»¶å ä½ç¬¦2.5.1 éšæœºæ•° ${random.value} ${random.int} ${random.long} ${random.int(10)} ${random.int[1024,65536]} 2.5.2 å ä½ç¬¦è·å–ä¹‹å‰é…ç½®çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥æ˜¯ç”¨:æŒ‡å®šé»˜è®¤å€¼person.last-name=å¼ ä¸‰${random.uuid} person.age=${random.int} person.birth=2017/12/15 person.boss=false person.maps.k1=v1 person.maps.k2=14 person.lists=a,b,c person.dog.name=${person.hello:hello}_dog person.dog.age=15 2.6 é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®springboot å¯åŠ¨ä¼šæ‰«æä»¥ä¸‹ä½ç½®çš„application.propertiesæˆ–è€…application.ymlæ–‡ä»¶ä½œä¸ºSpring bootçš„é»˜è®¤é…ç½®æ–‡ä»¶ file:./config/ file:./ classpath:/config/ classpath:/ ä¼˜å…ˆçº§ç”±é«˜åˆ°åº•ï¼Œé«˜ä¼˜å…ˆçº§çš„é…ç½®ä¼šè¦†ç›–ä½ä¼˜å…ˆçº§çš„é…ç½® SpringBootä¼šä»è¿™å››ä¸ªä½ç½®å…¨éƒ¨åŠ è½½ä¸»é…ç½®æ–‡ä»¶ï¼Œäº’è¡¥é…ç½® æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡spring.config.locationæ¥æ”¹å˜é»˜è®¤çš„é…ç½®æ–‡ä»¶ä½ç½®ã€‚ é¡¹ç›®æ‰“åŒ…å¥½ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°çš„å½¢å¼ï¼Œå¯åŠ¨é¡¹ç›®çš„æ—¶å€™æ¥æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ–°ä½ç½®ï¼›æŒ‡å®šé…ç½®æ–‡ä»¶å’Œé»˜è®¤åŠ è½½çš„è¿™äº›é…ç½®æ–‡ä»¶å…±åŒèµ·ä½œç”¨å½¢æˆäº’è¡¥é…ç½®ï¼› java -jar spring-boot-02-config-02-0.0.1-SNAPSHOT.jar --spring.config.location=G:/application.properties SpringBootæ”¯æŒçš„æ‰€æœ‰çš„å¤–éƒ¨é…ç½®æ–‡ä»¶åŠ è½½æ–¹æ³•è§ï¼š https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-external-config 2.7 @ImportResourceæ³¨è§£@ImportResourceå¯ä»¥å¸®åŠ©å¯¼å…¥ä¼ ç»Ÿxmlç±»å‹çš„é…ç½®ï¼Œä¾‹å¦‚springcontexté…ç½®ï¼Œç›´æ¥å°†å®ƒå†™åœ¨å¯åŠ¨ç±»ä¸Šå°±è¡Œäº†ã€‚ //å¯¼å…¥Springçš„é…ç½®æ–‡ä»¶è®©å…¶ç”Ÿæ•ˆ @ImportResource(locations = {\"classpath:beans.xml\"}) @SpringBootApplication public class BootHelloworldApplication { public static void main(String[] args) { SpringApplication.run(BootHelloworldApplication.class, args); } } 2.8 å¤šç¯å¢ƒåŒ–é…ç½®Profile2.8.1 propertiesåœ¨çœŸå®çš„åº”ç”¨ä¸­ï¼Œå¸¸å¸¸ä¼šæœ‰å¤šä¸ªç¯å¢ƒï¼ˆå¦‚ï¼šå¼€å‘ï¼Œæµ‹è¯•ï¼Œç”Ÿäº§ç­‰ï¼‰ï¼Œä¸åŒçš„ç¯å¢ƒæ•°æ®åº“è¿æ¥éƒ½ä¸ä¸€æ ·ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°spring.profile.activeçš„å¼ºå¤§åŠŸèƒ½äº†ï¼Œå®ƒçš„æ ¼å¼ä¸º application-{profile}.propertiesï¼Œè¿™é‡Œçš„ application ä¸ºå‰ç¼€ä¸èƒ½æ”¹ï¼Œ{profile}æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ã€‚ application.propertieså°±æ˜¯é»˜è®¤çš„é…ç½®æ–‡ä»¶ã€‚ åœ¨ application.properties é…ç½®æ–‡ä»¶ä¸­å†™å…¥ spring.profiles.active=devï¼Œå°±å¯ä»¥æŒ‡å®šä½¿ç”¨profileä¸ºdevçš„é…ç½®æ–‡ä»¶ã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨è™šæ‹Ÿæœºå‚æ•°-Dspring.profiles.active=devæŒ‡å®š 2.8.2 yamlæ–‡æ¡£å—# document 1 server: port: 8081 spring: profiles: active: prod --- # document 2 server: port: 8083 spring: profiles: dev --- # document 3 server: port: 8084 spring: profiles: prod #æŒ‡å®šå±äºå“ªä¸ªç¯å¢ƒ æ–‡æ¡£å—ä¹‹é—´ä½¿ç”¨---åˆ†éš”ï¼Œç¬¬ä¸€ä¸ªæ–‡æ¡£å—ä¸ºé»˜è®¤ä½¿ç”¨çš„é…ç½®ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.codetool.top/tags/SpringBoot/"}]},{"title":"leetcode322-é›¶é’±å…‘æ¢","slug":"leetcode322-é›¶é’±å…‘æ¢","date":"2020-03-08T09:53:09.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode322-é›¶é’±å…‘æ¢/","link":"","permalink":"https://www.codetool.top/article/leetcode322-%E9%9B%B6%E9%92%B1%E5%85%91%E6%8D%A2/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸åŒé¢é¢çš„ç¡¬å¸ coins å’Œä¸€ä¸ªæ€»é‡‘é¢ amountã€‚ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å¯ä»¥å‡‘æˆæ€»é‡‘é¢æ‰€éœ€çš„æœ€å°‘çš„ç¡¬å¸ä¸ªæ•°ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•ä¸€ç§ç¡¬å¸ç»„åˆèƒ½ç»„æˆæ€»é‡‘é¢ï¼Œè¿”å› -1ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: coins = [1, 2, 5], amount = 11è¾“å‡º: 3è§£é‡Š: 11 = 5 + 5 + 1 ç¤ºä¾‹ 2: è¾“å…¥: coins = [1, 2, 5], amount = 11è¾“å‡º: 3è§£é‡Š: 11 = 5 + 5 + 1 è¯´æ˜: ä½ å¯ä»¥è®¤ä¸ºæ¯ç§ç¡¬å¸çš„æ•°é‡æ˜¯æ— é™çš„ã€‚ 2 è§£æ³•2.1 æ€æƒ³è¿™é“é¢˜å’Œleetcode279-å®Œå…¨å¹³æ–¹æ•°ç±»ä¼¼ï¼Œå¯ä»¥ä½¿ç”¨BFS+å‰ªæçš„æ–¹æ³•æ¥åšã€‚ 2.2 ä»£ç class Solution { boolean[] visited; public int coinChange(int[] coins, int amount) { if(amount == 0) return 0; visited = new boolean[amount+1]; Queue&lt;Integer> queue = new LinkedList&lt;>(); queue.offer(amount); queue.offer(null); int depth = 0; while(!queue.isEmpty()){ Integer num = queue.poll(); if(num == null) { if(queue.isEmpty()) return -1; depth++; queue.offer(null); continue; } for(int i = 0;i&lt;coins.length;i++){ int left = num-coins[i]; if(left == 0) return depth + 1; if(left &lt; 0) continue; if(visited[left] == true) continue; visited[left] = true; queue.offer(left); } } return -1; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"SpringBootä»‹ç»å’ŒHelloWorldå…¥é—¨ç¨‹åº","slug":"SpringBootä»‹ç»å’ŒHelloWorldå…¥é—¨ç¨‹åº","date":"2020-03-08T08:47:27.000Z","updated":"2020-03-11T10:50:06.228Z","comments":true,"path":"article/SpringBootä»‹ç»å’ŒHelloWorldå…¥é—¨ç¨‹åº/","link":"","permalink":"https://www.codetool.top/article/SpringBoot%E4%BB%8B%E7%BB%8D%E5%92%8CHelloWorld%E5%85%A5%E9%97%A8%E7%A8%8B%E5%BA%8F/","excerpt":"","text":"1 Spring Boot ç®€ä»‹ ç®€åŒ–Springåº”ç”¨å¼€å‘çš„ä¸€ä¸ªæ¡†æ¶ï¼› æ•´ä¸ªSpringæŠ€æœ¯æ ˆçš„ä¸€ä¸ªå¤§æ•´åˆï¼› J2EEå¼€å‘çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼› Spring Bootç”¨æ¥ç®€åŒ–Springåº”ç”¨å¼€å‘ï¼Œçº¦å®šå¤§äºé…ç½®ï¼Œå»ç¹ä»ç®€ï¼Œjust runå°±èƒ½åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ï¼Œäº§å“çº§åˆ«çš„åº”ç”¨ 1.1 ä¼˜ç‚¹ å¿«é€Ÿåˆ›å»ºç‹¬ç«‹è¿è¡Œçš„Springé¡¹ç›®ä»¥åŠä¸ä¸»æµæ¡†æ¶é›†æˆ ä½¿ç”¨åµŒå…¥å¼çš„Servletå®¹å™¨ï¼Œåº”ç”¨æ— éœ€æ‰“æˆWARåŒ… startersè‡ªåŠ¨ä¾èµ–ä¸ç‰ˆæœ¬æ§åˆ¶ å¤§é‡çš„è‡ªåŠ¨é…ç½®ï¼Œç®€åŒ–å¼€å‘ï¼Œä¹Ÿå¯ä¿®æ”¹é»˜è®¤å€¼ æ— éœ€é…ç½®XMLï¼Œæ— ä»£ç ç”Ÿæˆï¼Œå¼€ç®±å³ç”¨ å‡†ç”Ÿäº§ç¯å¢ƒçš„è¿è¡Œæ—¶åº”ç”¨ç›‘æ§ ä¸äº‘è®¡ç®—çš„å¤©ç„¶é›†æˆ 1.2 starteræ¦‚å¿µSpring Boot Starteræ˜¯ä¸€ç»„è¢«ä¾èµ–ç¬¬ä¸‰æ–¹ç±»åº“çš„é›†åˆã€‚ å¦‚æœä½ è¦å¼€å‘ä¸€ä¸ªwebåº”ç”¨ç¨‹åºï¼Œå°±é€šè¿‡åŒ…ç®¡ç†å·¥å…·(å¦‚maven)å¼•å…¥spring-boot-starter-webå°±å¯ä»¥äº†ï¼Œè€Œä¸ç”¨åˆ†åˆ«å¼•å…¥ä¸‹é¢è¿™ä¹ˆå¤šä¾èµ–ç±»åº“ï¼Œspring-boot-starter-webä¸€æ¬¡æ€§å¸®ä½ å¼•å…¥ä¸‹é¢çš„è¿™äº›å¸¸ç”¨ç±»åº“ã€‚ Spring â€” spring æ ¸å¿ƒ, beans, contextä¸Šä¸‹æ–‡, AOPé¢å‘åˆ‡é¢ Web MVC â€” Spring MVC Jackson â€” JSONæ•°æ®çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ– Validation â€” Hibernateå‚æ•°æ ¡éªŒåŠæ ¡éªŒAPI åµŒå…¥å¼ Servlet Container â€” Tomcat æ—¥å¿—æ¡†æ¶Logging â€” logback, slf4j Spring Boot é»˜è®¤æ”¯æŒçš„starterè§ https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-starter 1.3 Spring Boot Starter Parentæ‰€æœ‰çš„Spring Booté¡¹ç›®é»˜è®¤ä½¿ç”¨spring-boot-starter-parentä½œä¸ºåº”ç”¨ç¨‹åºçš„çˆ¶é¡¹ç›®ã€‚ &lt;parent> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-parent&lt;/artifactId> &lt;version>2.0.0.RELEASE&lt;/version> &lt;/parent> ç»§æ‰¿çˆ¶é¡¹ç›®çš„å¥½å¤„åœ¨äºï¼š ç»Ÿä¸€javaç‰ˆæœ¬é…ç½®å’Œå…¶ä»–çš„ä¸€äº›ä¾èµ–ç±»åº“çš„ç‰ˆæœ¬ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¼•å…¥çš„ç¬¬ä¸‰æ–¹ç±»åº“ä¸è¦åŠ ç‰ˆæœ¬å·ï¼Œçˆ¶é¡¹ç›®æ›¿ä½ ç®¡ç†ç‰ˆæœ¬ï¼Œè€Œä¸”æ˜¯ç»è¿‡å…¼å®¹æ€§æµ‹è¯•çš„ã€‚æ¯”ä½ è‡ªå·±éšä¾¿å¼•å…¥ä¸€ä¸ªç‰ˆæœ¬å…¼å®¹æ€§æ›´å¥½ã€‚ 1.4 Spring Booté›†æˆç¬¬ä¸‰æ–¹ç±»åº“çš„æ­¥éª¤ é€šè¿‡mavenå¼•å…¥springboot-XXXX-starter ä¿®æ”¹ymalæˆ–propertieså…¨å±€ç»Ÿä¸€é…ç½®æ–‡ä»¶ åŠ å…¥ä¸€ä¸ªJava Configã€‚è¿™ä¸ªå±äºä¸ªæ€§åŒ–é…ç½®ï¼Œå¦‚æœä½¿ç”¨é€šç”¨é…ç½®ï¼Œè¿™ä¸€æ­¥ä¸éœ€è¦ã€‚ 1.5 Spring Boot2.xæ–°ç‰¹æ€§1.5.1 åŸºç¡€ç¯å¢ƒå‡çº§ æœ€ä½ JDK 8ï¼Œæ”¯æŒ JDK 9ï¼Œä¸å†æ”¯æŒ Java 6 å’Œ 7ã€‚Spring Boot 2.0 è¦æ±‚ Java 8 ä½œä¸ºæœ€ä½ç‰ˆæœ¬ï¼Œè®¸å¤šç°æœ‰çš„ API å·²æ›´æ–°ï¼Œä»¥åˆ©ç”¨ Java 8 çš„ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œæ¥å£ä¸Šçš„é»˜è®¤æ–¹æ³•ï¼Œå‡½æ•°å›è°ƒä»¥åŠæ–°çš„ APIï¼Œå¦‚ javax.timeã€‚ å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Java 7 æˆ–æ›´æ—©ç‰ˆæœ¬ï¼Œåˆ™åœ¨å¼€å‘ Spring Boot 2.0 åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œéœ€è¦å‡çº§ä½ çš„ JDKã€‚ 1.5.2 ä¾èµ–ç»„ä»¶å‡çº§ Jetty 9.4ï¼ŒJetty æ˜¯ä¸€ä¸ªå¼€æºçš„ Servlet å®¹å™¨ï¼Œå®ƒä¸ºåŸºäº Java çš„ Web å†…å®¹ï¼Œä¾‹å¦‚ JSP å’Œ Servlet æä¾›è¿è¡Œç¯å¢ƒã€‚Jetty æ˜¯ä½¿ç”¨ Java è¯­è¨€ç¼–å†™çš„ï¼Œå®ƒçš„ API ä»¥ä¸€ç»„ JAR åŒ…çš„å½¢å¼å‘å¸ƒã€‚ Tomcat 8.5ï¼ŒApache Tomcat 8.5.x æ—¨åœ¨å–ä»£ 8.0.xï¼Œå®Œå…¨æ”¯æŒ Java 9ã€‚ Flyway 5ï¼ŒFlyway æ˜¯ç‹¬ç«‹äºæ•°æ®åº“çš„åº”ç”¨ã€ç®¡ç†å¹¶è·Ÿè¸ªæ•°æ®åº“å˜æ›´çš„æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†å·¥å…·ã€‚ç”¨é€šä¿—çš„è¯è®²ï¼ŒFlyway å¯ä»¥åƒ SVN ç®¡ç†ä¸åŒäººçš„ä»£ç é‚£æ ·ï¼Œç®¡ç†ä¸åŒäººçš„ SQL è„šæœ¬ï¼Œä»è€Œåšåˆ°æ•°æ®åº“åŒæ­¥ã€‚ Hibernate 5.2ï¼ŒHibernate æ˜¯ä¸€æ¬¾éå¸¸æµè¡Œçš„ ORM æ¡†æ¶ã€‚ Gradle 3.4ï¼ŒSpring Boot çš„ Gradle æ’ä»¶åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå·²è¢«é‡å†™ï¼Œæœ‰äº†é‡å¤§çš„æ”¹è¿›ã€‚ Thymeleaf 3.0ï¼ŒThymeleaf 3 ç›¸å¯¹äº Thymeleaf 2 æœ‰éå¸¸å¤§çš„æ€§èƒ½æå‡ 1.5.3 é»˜è®¤è½¯ä»¶æ›¿æ¢ é»˜è®¤æ•°æ®åº“è¿æ¥æ± å·²ä» Tomcat åˆ‡æ¢åˆ° HikariCPï¼ŒHikariCP æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ JDBC è¿æ¥æ± ï¼ŒHikari æ˜¯æ—¥è¯­â€œå…‰â€çš„æ„æ€ã€‚ Rediså®¢æˆ·ç«¯é»˜è®¤ä½¿ç”¨ Lettuceï¼Œæ›¿æ¢æ‰Jedisã€‚Lettuce æ˜¯ä¸€ä¸ªå¯ä¼¸ç¼©çš„çº¿ç¨‹å®‰å…¨çš„ Redis å®¢æˆ·ç«¯ï¼Œç”¨äºåŒæ­¥ã€å¼‚æ­¥å’Œååº”ä½¿ç”¨ã€‚å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«åŒä¸€ä¸ª RedisConnectionï¼Œå®ƒåˆ©ç”¨ä¼˜ç§€ Netty NIO æ¡†æ¶æ¥é«˜æ•ˆåœ°ç®¡ç†å¤šä¸ªè¿æ¥ï¼Œæ”¯æŒå…ˆè¿›çš„ Redis åŠŸèƒ½ï¼Œå¦‚ Sentinelã€é›†ç¾¤ã€æµæ°´çº¿ã€è‡ªåŠ¨é‡æ–°è¿æ¥å’Œ Redis æ•°æ®æ¨¡å‹ã€‚ 1.5.4 æ–°æŠ€æœ¯çš„å¼•å…¥ å“åº”å¼ç¼–ç¨‹WebFluxï¼Œé‡è¦çš„å˜é© æ”¯æŒ Quartz,Spring Boot 1.0 å¹¶æ²¡æœ‰æä¾›å¯¹ Quartz çš„æ”¯æŒï¼Œä¹‹å‰å‡ºç°äº†å„ç§é›†æˆæ–¹æ¡ˆï¼ŒSpring Boot 2.0 ç»™å‡ºäº†æœ€ç®€å•çš„é›†æˆæ–¹å¼ã€‚ å¯¹Kotlin çš„æ”¯æŒ JOOQ çš„æ”¯æŒ,JOOQ æ˜¯åŸºäº Java è®¿é—®å…³ç³»å‹æ•°æ®åº“çš„å·¥å…·åŒ…ã€‚JOOQ æ—¢å¸å–äº†ä¼ ç»Ÿ ORM æ“ä½œæ•°æ®çš„ç®€å•æ€§å’Œå®‰å…¨æ€§ï¼Œåˆä¿ç•™äº†åŸç”Ÿ SQL çš„çµæ´»æ€§ï¼Œå®ƒæ›´åƒæ˜¯ä»‹äº ORMS å’Œ JDBC çš„ä¸­é—´å±‚ã€‚ 2 Spring Boot HelloWorldä½¿ç”¨Spring Bootæ¥åšä¸€ä¸ªHello Worldå…¥é—¨ç¨‹åºï¼š 1) åœ¨ideaä¸­åˆ›å»ºSpring Initializré¡¹ç›® 2) æ·»åŠ mavenä¾èµ– Ideaä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬ç”Ÿæˆå¦‚ä¸‹pomæ–‡ä»¶ï¼š &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\"> &lt;modelVersion>4.0.0&lt;/modelVersion> &lt;parent> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-parent&lt;/artifactId> &lt;version>2.2.5.RELEASE&lt;/version> &lt;relativePath/> &lt;!-- lookup parent from repository --> &lt;/parent> &lt;groupId>com.rhett&lt;/groupId> &lt;artifactId>boot-helloworld&lt;/artifactId> &lt;version>0.0.1-SNAPSHOT&lt;/version> &lt;name>boot-helloworld&lt;/name> &lt;description>Demo project for Spring Boot&lt;/description> &lt;properties> &lt;java.version>1.8&lt;/java.version> &lt;/properties> &lt;dependencies> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter&lt;/artifactId> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-test&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;exclusions> &lt;exclusion> &lt;groupId>org.junit.vintage&lt;/groupId> &lt;artifactId>junit-vintage-engine&lt;/artifactId> &lt;/exclusion> &lt;/exclusions> &lt;/dependency> &lt;/dependencies> &lt;build> &lt;plugins> &lt;plugin> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-maven-plugin&lt;/artifactId> &lt;/plugin> &lt;/plugins> &lt;/build> &lt;/project> æ·»åŠ web-starterè¿›å»ï¼š &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-web&lt;/artifactId> &lt;/dependency> å¯ä»¥ç§»é™¤ç›¸å…³mavenç®¡ç†çš„æ–‡ä»¶ï¼Œä½¿ç”¨ideaç®¡ç†ï¼š resourcesæ–‡ä»¶å¤¹ä¸­ç›®å½•ç»“æ„ staticï¼šä¿å­˜æ‰€æœ‰çš„é™æ€èµ„æºï¼› js css imagesï¼› templatesï¼šä¿å­˜æ‰€æœ‰çš„æ¨¡æ¿é¡µé¢ï¼›ï¼ˆSpring Booté»˜è®¤jaråŒ…ä½¿ç”¨åµŒå…¥å¼çš„Tomcatï¼Œé»˜è®¤ä¸æ”¯æŒJSPé¡µé¢ï¼‰ï¼›å¯ä»¥ä½¿ç”¨æ¨¡æ¿å¼•æ“ï¼ˆfreemarkerã€thymeleafï¼‰ï¼› application.propertiesï¼šSpring Bootåº”ç”¨çš„é…ç½®æ–‡ä»¶ï¼›å¯ä»¥ä¿®æ”¹ä¸€äº›é»˜è®¤è®¾ç½®ï¼Œå¯ä»¥ä½¿ç”¨ymlè¯­æ³•è¿›è¡Œé…ç½®ã€‚ 3) æŸ¥çœ‹å¯åŠ¨ç±» ideaé»˜è®¤ä¸ºæˆ‘ä»¬ç”Ÿæˆäº†å¯åŠ¨ç±»ï¼š /** * @SpringBootApplicationæ¥æ ‡è®°ä¸€ä¸ªä¸»ç¨‹åºç±»ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªSpring Bootåº”ç”¨ */ @SpringBootApplication public class BootHelloworldApplication { public static void main(String[] args) { SpringApplication.run(BootHelloworldApplication.class, args); } } 4) ç¼–å†™Controller springbootåªä¼šæ‰«æå¯åŠ¨ç±»å½“å‰åŒ…å’Œä»¥ä¸‹çš„åŒ…ï¼Œåˆ›å»ºä»¥ä¸‹åŒ…å±‚æ¬¡ï¼Œç¼–å†™ä¸€ä¸ªHelloControllerï¼š @RestController public class HelloController { @RequestMapping(\"/hello\") public String hello() { return \"hello world\"; } } @RestControllerç›¸å½“äº@ResponseBody+@Controllerï¼Œè¿”å›çš„å†…å®¹ç›´æ¥å†™å…¥å“åº”ä½“ï¼Œä¸ä¼šè§£æåˆ°è§†å›¾ã€‚ 5) å¯åŠ¨ç¨‹åº è¿è¡Œå¯åŠ¨ç±»ä¸­çš„mainæ–¹æ³•ï¼Œç¨‹åºå°±å¯åŠ¨èµ·æ¥äº†ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥localhost:8080/helloæ¥è§‚å¯Ÿè¿è¡Œç»“æœï¼š","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.codetool.top/tags/SpringBoot/"}]},{"title":"MySQLä¹‹åˆ†åŒºè¡¨ä»‹ç»","slug":"MySQLä¹‹åˆ†åŒºè¡¨ä»‹ç»","date":"2020-03-07T14:10:45.000Z","updated":"2020-03-07T14:22:04.547Z","comments":true,"path":"article/MySQLä¹‹åˆ†åŒºè¡¨ä»‹ç»/","link":"","permalink":"https://www.codetool.top/article/MySQL%E4%B9%8B%E5%88%86%E5%8C%BA%E8%A1%A8%E4%BB%8B%E7%BB%8D/","excerpt":"","text":"æœ¬æ–‡å¤§éƒ¨åˆ†å‚è€ƒè‡ªã€ŠMySQLæŠ€æœ¯å†…å¹•ï¼šInnoDBå­˜å‚¨å¼•æ“ã€‹ 1 æ¦‚è¿°å¯¹äºInnoDBï¼Œåˆ†åŒºå°±æ˜¯æŠŠä¸€ä¸ªæ•°æ®è¡¨çš„ç‰©ç†å­˜å‚¨æ‹†åˆ†ä¸ºå¤šä¸ªibdæ–‡ä»¶ï¼ˆç›¸å½“äºç‹¬ç«‹è¡¨ç©ºé—´å†æ‹†åˆ†æˆäº†å¤šä¸ªè¡¨ç©ºé—´ï¼‰ã€‚åˆ†åŒºåçš„MyISAMï¼Œåˆ™æ˜¯æ¯ä¸ªåˆ†åŒºæœ‰ä¸€ä¸ªmyiæ–‡ä»¶ï¼ˆè¡¨çš„ç´¢å¼•ä¿¡æ¯ï¼‰å’Œä¸€ä¸ªmydæ–‡ä»¶ï¼ˆè¡¨çš„æ•°æ®ä¿¡æ¯ï¼‰ã€‚æ¯ä¸€ä¸ªåˆ†åŒºï¼Œåœ¨MySQLçœ‹æ¥éƒ½æ˜¯ä¸€å¼ ç‹¬ç«‹çš„è¡¨ã€‚ 2 åˆ†åŒºç±»å‹2.1 æ°´å¹³åˆ†åŒºè¿™ç§å½¢å¼åˆ†åŒºæ˜¯å¯¹è¡¨çš„è¡Œè¿›è¡Œåˆ†åŒºï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼ä¸åŒåˆ†ç»„é‡Œé¢çš„ç‰©ç†åˆ—åˆ†å‰²çš„æ•°æ®é›†å¾—ä»¥ç»„åˆï¼Œä»è€Œè¿›è¡Œä¸ªä½“åˆ†å‰²ï¼ˆå•åˆ†åŒºï¼‰æˆ–é›†ä½“åˆ†å‰²ï¼ˆ1ä¸ªæˆ–å¤šä¸ªåˆ†åŒºï¼‰ã€‚æ‰€æœ‰åœ¨è¡¨ä¸­å®šä¹‰çš„åˆ—åœ¨æ¯ä¸ªæ•°æ®é›†ä¸­éƒ½èƒ½æ‰¾åˆ°ï¼Œæ‰€ä»¥è¡¨çš„ç‰¹æ€§ä¾ç„¶å¾—ä»¥ä¿æŒã€‚ 2.2 å‚ç›´åˆ†åŒºè¿™ç§åˆ†åŒºæ–¹å¼ä¸€èˆ¬æ¥è¯´æ˜¯é€šè¿‡å¯¹è¡¨çš„å‚ç›´åˆ’åˆ†æ¥å‡å°‘ç›®æ ‡è¡¨çš„å®½åº¦ï¼Œä½¿æŸäº›ç‰¹å®šçš„åˆ—è¢«åˆ’åˆ†åˆ°ç‰¹å®šçš„åˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºéƒ½åŒ…å«äº†å…¶ä¸­çš„åˆ—æ‰€å¯¹åº”çš„è¡Œã€‚ MySQLåœ¨5.1æ—¶æ·»åŠ äº†å¯¹æ°´å¹³åˆ†åŒºçš„æ”¯æŒã€‚å¹¶ä¸æ”¯æŒå‚ç›´åˆ†åŒºã€‚ MySQLæ•°æ®åº“çš„åˆ†åŒºæ˜¯å±€éƒ¨åˆ†åŒºç´¢å¼•ï¼Œä¸€ä¸ªåˆ†åŒºä¸­æ—¢å­˜äº†æ•°æ®ï¼Œåˆæ”¾äº†ç´¢å¼•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªåŒºçš„èšé›†ç´¢å¼•å’Œéèšé›†ç´¢å¼•éƒ½æ”¾åœ¨å„è‡ªåŒºçš„ï¼ˆä¸åŒçš„ç‰©ç†æ–‡ä»¶ï¼‰ã€‚ç›®å‰MySQLæ•°æ®åº“è¿˜ä¸æ”¯æŒå…¨å±€åˆ†åŒºï¼ˆæ•°æ®å­˜æ”¾åœ¨å„ä¸ªåˆ†åŒºä¸­ï¼Œä½†æ˜¯æ‰€æœ‰æ•°æ®çš„ç´¢å¼•æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ï¼‰ã€‚ 3 åˆ†åŒºç®—æ³•å½“å‰MySQLæ”¯æŒä»¥ä¸‹å‡ ç§ç±»å‹çš„åˆ†åŒºï¼š RANGEåˆ†åŒºï¼šè¡Œæ•°æ®åŸºäºå±äºä¸€ä¸ªç»™å®šè¿ç»­åŒºé—´çš„åˆ—å€¼è¢«æ”¾å…¥åˆ†åŒºï¼ŒMySQL5.5å¼€å§‹æ”¯æŒã€‚ LISTåˆ†åŒºï¼šå’ŒRANGEç±»ä¼¼ï¼Œåªæ˜¯LISTåˆ†åŒºé¢å‘çš„æ˜¯ç¦»æ•£çš„å€¼ã€‚MySQL5.5å¼€å§‹æ”¯æŒã€‚ HASHåˆ†åŒºï¼šæ ¹æ®ç”¨æˆ·è‡ªå®šä¹‰çš„è¡¨è¾¾å¼çš„è¿”å›å€¼æ¥è¿›è¡Œåˆ†åŒºï¼Œè¿”å›å€¼ä¸èƒ½ä¸ºè´Ÿæ•°ã€‚ KEYåˆ†åŒºï¼šæ ¹æ®MySQLæ•°æ®åº“æä¾›çš„å“ˆå¸Œå‡½æ•°æ¥è¿›è¡Œåˆ†åŒºã€‚ æ— è®ºå“ªç§ç±»å‹çš„åˆ†åŒºï¼Œå¦‚æœè¡¨ä¸­å­˜åœ¨ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æ—¶ï¼Œåˆ†åŒºåˆ—ï¼ˆç”¨æ¥åˆ¤æ–­è¯¥åˆ†å¾€å“ªä¸ªåˆ†åŒºï¼‰å¿…é¡»æ˜¯å”¯ä¸€ç´¢å¼•çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ã€‚ 3.1 RANGEåˆ†åŒºç¤ºä¾‹ CREATE TABLE tbl_new( id INT NOT NULL PRIMARY KEY, title VARCHAR(20) NOT NULL DEFAULT '' ) PARTITION BY RANGE(id)( PARTITION t0 VALUES LESS THAN(10), PARTITION t1 VALUES LESS THAN(20), PARTITION t2 VALUES LESS THAN(MAXVALUE) ); è¿™ä¸ªè¡¨ä¼šæŠŠä»¥idåˆ—ä½œä¸ºåˆ†åŒºä¾æ®ï¼Œå½“idï¼š 0~10 æ”¾åœ¨ t0 10~20 æ”¾åœ¨ t1 &gt;20 æ”¾åœ¨ t2 å½“æ’å…¥ä¸€ä¸ªä¸åœ¨åˆ†åŒºèŒƒå›´å†…çš„å€¼çš„æ—¶å€™ï¼ŒMySQLä¼šæŠ¥å¼‚å¸¸ã€‚ 3.2 LISTåˆ†åŒºç¤ºä¾‹ create table user ( uid int not null, userName varchar(20), gender tinyint ) partition by list(gender) ( partition male values in (1), partition female values in (2), partition unknown values in (3) ); è¿™ä¸ªè¡¨ä¼šæŠŠä»¥genderåˆ—ï¼ˆæ€§åˆ«ï¼‰ä½œä¸ºåˆ†åŒºä¾æ®ï¼Œå½“genderï¼š = 1 æ”¾åœ¨ male = 2 æ”¾åœ¨ female = 3 æ”¾åœ¨ unknown å½“æ’å…¥ä¸€ä¸ªä¸åœ¨åˆ†åŒºèŒƒå›´å†…çš„å€¼çš„æ—¶å€™ï¼ŒMySQLåŒæ ·ä¼šæŠ¥å¼‚å¸¸ã€‚ å½“ä¸€æ¡Insertè¯­å¥æ’å…¥å¤šä¸ªå€¼çš„æ—¶å€™ï¼Œè€Œå…¶ä¸­æœ‰ä¸€äº›å€¼æ˜¯åœ¨åˆ†åŒºèŒƒå›´å†…çš„ï¼ŒMyISAMå¼•æ“ä¼šæŠŠç¬¬ä¸€ä¸ªä¸æ»¡è¶³èŒƒå›´çš„æ•°æ®å‰é¢çš„æ•°æ®å…¨éƒ¨æ’å…¥ï¼Œè€Œåé¢çš„ä¸å¤„ç†ã€‚è€ŒInnoDBåˆ™æŠŠå®ƒå½“æˆä¸€ä¸ªäº‹åŠ¡ï¼Œéƒ½ä¸ä¼šå¤„ç†ã€‚ 3.3 HASHåˆ†åŒºç¤ºä¾‹ï¼š CREATE TABLE t_hash( a INT, b DATETIME ) ENGINE=InnoDB PARTITION BY HASH(YEAR(b)) PARTITIONS 4; ç”¨æˆ·ç»™æ•°æ®åº“æä¾›åˆ†åŒºçš„ä¾æ®ï¼ŒYEAR(b)ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œç„¶åéœ€è¦é€šè¿‡PARTITIONS numå‘ŠçŸ¥æ•°æ®åº“åˆ†åŒºçš„æ•°é‡ï¼Œç„¶åæ•°æ®åº“è‡ªåŠ¨æ ¹æ®YEAR(b)å°†æ•°æ®å‡åŒ€åˆ†åˆ°è¿™äº›åˆ†åŒºä¸­ã€‚å¦‚æœæ²¡æœ‰PARTITIONS numè¯­å¥ï¼Œåˆ†åŒºçš„æ•°é‡é»˜è®¤ä¸º1ã€‚ 3.4 KEYåˆ†åŒºKEYåˆ†åŒºå’ŒHASHåˆ†åŒºç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºHASHåˆ†åŒºä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„å‡½æ•°è¿›è¡Œåˆ†åŒºï¼ŒKEYåˆ†åŒºä½¿ç”¨MySQLæ•°æ®åº“æä¾›çš„å‡½æ•°è¿›è¡Œåˆ†åŒºã€‚å¯¹äºå¤§å¤šæ•°å­˜å‚¨å¼•æ“ï¼ŒMySQLæ•°æ®åº“ä½¿ç”¨å…¶å†…éƒ¨çš„å“ˆå¸Œå‡½æ•°ï¼Œè¿™äº›å‡½æ•°åŸºäºä¸PASSWORD()ä¸€æ ·çš„è¿ç®—æ³•åˆ™ã€‚ ç¤ºä¾‹ï¼š CREATE TABLE t_key( a INT, b DATETIME ) ENGINE=InnoDB PARTITION BY KEY (b) PARTITIONS 4; 3.5 å…¶ä»–COLUMNSåˆ†åŒºã€å­åˆ†åŒº 4 åˆ†åŒºçš„åº”ç”¨åœºæ™¯ è¡¨éå¸¸å¤§ä»¥è‡³äºæ— æ³•å…¨éƒ¨æ”¾åœ¨å†…å­˜ä¸­ï¼Œæˆ–è€…åªåœ¨è¡¨çš„æœ€åéƒ¨åˆ†æœ‰çƒ­ç‚¹æ•°æ®ï¼Œå…¶ä»–å‡ä¸ºå†å²æ•°æ®ï¼ˆå¯ä»¥å°†çƒ­ç‚¹æ•°æ®æå–å‡ºæ¥ï¼ŒåŠ å¿«çƒ­ç‚¹æ•°æ®çš„æŸ¥è¯¢ã€è®¿é—®æ•ˆç‡ï¼‰ åˆ†åŒºè¡¨çš„æ•°æ®æ›´å®¹æ˜“ç»´æŠ¤ã€‚ï¼ˆæ‰¹é‡åˆ é™¤æ•°æ®-&gt;æ¸…é™¤æ•´ä¸ªåˆ†åŒºï¼‰ åˆ†åŒºè¡¨çš„æ•°æ®å¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„ç‰©ç†è®¾å¤‡ä¸Šï¼Œä»è€Œé«˜æ•ˆåœ°åˆ©ç”¨å¤šä¸ªç¡¬ä»¶è®¾å¤‡ å¯ä»¥ä½¿ç”¨åˆ†åŒºè¡¨æ¥é¿å…æŸäº›ç‰¹æ®Šçš„ç“¶é¢ˆã€‚æ¯”å¦‚ InnoDB çš„å•ä¸ªç´¢å¼•çš„äº’æ–¥è®¿é—®ï¼Œext3 æ–‡ä»¶ç³»ç»Ÿçš„ inode é”ç«äº‰ã€‚ è¿˜å¯ä»¥å¤‡ä»½å’Œæ¢å¤ç‹¬ç«‹çš„åˆ†åŒº 5 åˆ†åŒºçš„é™åˆ¶ ä¸€ä¸ªè¡¨æœ€å¤šåªèƒ½æœ‰ 1024 ä¸ªåˆ†åŒº å¦‚æœè¡¨ä¸­å­˜åœ¨ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æ—¶ï¼Œåˆ†åŒºåˆ—å¿…é¡»æ˜¯å”¯ä¸€ç´¢å¼•çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ã€‚ åˆ†åŒºè¡¨ä¸­æ— æ³•ä½¿ç”¨å¤–é”®ç´¢å¼• 6 åˆ†åŒºçš„é™·é˜±6.1 NULLå€¼ä¼šä½¿åˆ†åŒºè¿‡æ»¤æ— æ•ˆåˆ†åŒºçš„è¡¨è¾¾å¼çš„å€¼å¯ä»¥æ˜¯ NULLï¼›ç¬¬ä¸€ä¸ªåˆ†åŒºæ˜¯ä¸€ä¸ªç‰¹æ®Šåˆ†åŒºï¼Œå¦‚æœè¡¨è¾¾å¼çš„å€¼ä¸º NULL æˆ–éæ³•å€¼ï¼Œè®°å½•éƒ½ä¼šè¢«å­˜æ”¾åˆ°ç¬¬ä¸€ä¸ªåˆ†åŒºã€‚WHERE æŸ¥è¯¢æ—¶å³ä½¿çœ‹èµ·æ¥å¯ä»¥è¿‡æ»¤åˆ°åªæœ‰ä¸€ä¸ªåˆ†åŒºï¼Œä½†å®é™…ä¼šæ£€æŸ¥ä¸¤ä¸ªåˆ†åŒºï¼Œå³ç¬¬ä¸€ä¸ªåˆ†åŒºã€‚æœ€å¥½æ˜¯è®¾ç½®åˆ†åŒºçš„åˆ—ä¸ºNOT NULLã€‚ 6.2 åˆ†åŒºåˆ—å’Œç´¢å¼•åˆ—ä¸åŒ¹é…å¦‚æœå®šä¹‰çš„ç´¢å¼•åˆ—å’Œåˆ†åŒºåˆ—ä¸åŒ¹é…ï¼Œä¼šå¯¼è‡´ç´¢å¼•æ— æ³•è¿›è¡Œåˆ†åŒºè¿‡æ»¤ã€‚ å‡è®¾åœ¨åˆ— a ä¸Šå®šä¹‰äº†ç´¢å¼•ï¼Œè€Œåœ¨åˆ— b ä¸Šè¿›è¡Œåˆ†åŒºã€‚å› ä¸ºæ¯ä¸ªåˆ†åŒºéƒ½æœ‰å…¶ç‹¬ç«‹çš„ç´¢å¼•ï¼Œæ‰€ä»¥æ‰«æ b ä¸Šçš„ç´¢å¼•å°±éœ€è¦æ‰«ææ¯ä¸€ä¸ªåˆ†åŒºå†…å¯¹åº”çš„ç´¢å¼•ã€‚ 6.3 é€‰æ‹©åˆ†åŒºçš„æˆæœ¬å¯èƒ½å¾ˆé«˜å°¤å…¶æ˜¯èŒƒå›´åˆ†åŒºï¼Œå¯¹äºå›ç­”â€œè¿™ä¸€è¡Œå±äºå“ªä¸ªåˆ†åŒºâ€ã€â€œè¿™äº›ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„è¡Œåœ¨å“ªäº›åˆ†åŒºâ€è¿™æ ·çš„é—®é¢˜çš„æˆæœ¬å¯èƒ½ä¼šéå¸¸é«˜ã€‚å…¶ä»–çš„åˆ†åŒºç±»å‹ï¼Œæ¯”å¦‚KEYåˆ†åŒºå’ŒHASHåˆ†åŒºï¼Œå°±æ²¡æœ‰è¿™æ ·çš„é—®é¢˜ã€‚åœ¨æ‰¹é‡æ’å…¥æ—¶é—®é¢˜å°¤å…¶ä¸¥é‡ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"ä¼˜åŒ–","slug":"ä¼˜åŒ–","permalink":"https://www.codetool.top/tags/%E4%BC%98%E5%8C%96/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"MySQL","slug":"MySQL","permalink":"https://www.codetool.top/tags/MySQL/"}]},{"title":"MySQLä¸»ä»å¤åˆ¶ç®€ä»‹","slug":"MySQLä¸»ä»å¤åˆ¶ç®€ä»‹","date":"2020-03-07T11:30:48.000Z","updated":"2020-03-07T11:34:26.870Z","comments":true,"path":"article/MySQLä¸»ä»å¤åˆ¶ç®€ä»‹/","link":"","permalink":"https://www.codetool.top/article/MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%AE%80%E4%BB%8B/","excerpt":"","text":"è¯¥æ–‡ä¸è°ˆåŠè‰¯å¥½çš„ä¸»ä»å¤åˆ¶æ‹“æ‰‘ç»“æ„å’Œä¸»ä»å¤åˆ¶ä¸­å¯èƒ½å‡ºç°çš„é—®é¢˜ï¼Œä»¥åæœ‰æ—¶é—´å†å†™ã€‚ 1 æ¦‚è¿°å¤åˆ¶è§£å†³çš„åŸºæœ¬é—®é¢˜æ˜¯è®©ä¸€å°æœåŠ¡å™¨çš„æ•°æ®ä¸å…¶ä»–æœåŠ¡å™¨ä¿æŒåŒæ­¥ã€‚ä¸€å°ä¸»åº“çš„æ•°æ®å¯ä»¥åŒæ­¥åˆ°å¤šå°å¤‡åº“ä¸Šï¼Œå¤‡åº“æœ¬èº«ä¹Ÿå¯ä»¥è¢«é…ç½®æˆå¦å¤–ä¸€å°æœåŠ¡å™¨çš„ä¸»åº“ã€‚ MySQL æ”¯æŒä¸¤ç§å¤åˆ¶æ–¹å¼ï¼šåŸºäºè¡Œçš„å¤åˆ¶å’ŒåŸºäºè¯­å¥çš„å¤åˆ¶ã€‚è¿™ä¸¤ç§æ–¹å¼éƒ½æ˜¯é€šè¿‡åœ¨ä¸»åº“ä¸Šè®°å½• binlogï¼Œåœ¨å¤‡åº“é‡æ”¾æ—¥å¿—çš„æ–¹å¼æ¥å®ç°å¼‚æ­¥çš„æ•°æ®å¤åˆ¶ã€‚è¿™æ„å‘³ç€ï¼Œåœ¨åŒä¸€æ—¶é—´ç‚¹å¤‡åº“ä¸Šçš„æ•°æ®å¯èƒ½ä¸ä¸»åº“å­˜åœ¨ä¸ä¸€è‡´ï¼Œå¹¶ä¸”ä¿è¯ä¸»å¤‡ä¹‹é—´çš„å»¶è¿Ÿã€‚ å¤åˆ¶é€šå¸¸ä¸ä¼šå¢åŠ ä¸»åº“çš„å¼€é”€ï¼Œä¸»è¦æ˜¯å¯ç”¨ binlog å¸¦æ¥çš„å¼€é”€ï¼Œä½†å‡ºäºå¤‡ä»½æˆ–åŠæ—¶ä»å´©æºƒä¸­æ¢å¤çš„ç›®çš„ï¼Œè¿™ç‚¹å¼€é”€ä¹Ÿæ˜¯å¿…è¦çš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ¯ä¸ªå¤‡åº“ä¹Ÿä¼šå¯¹ä¸»åº“å¢åŠ ä¸€äº›è´Ÿè½½ï¼ˆç½‘ç»œIOï¼‰ï¼Œå°¤å…¶å½“å¤‡åº“è¯·æ±‚ä»ä¸»åº“è¯»å–æ—§çš„ binlog æ—¶ï¼Œå¯èƒ½ä¼šé€ æˆæ›´é«˜çš„ IO å¼€é”€ã€‚ é€šè¿‡å¤åˆ¶å¯ä»¥å°†è¯»æ“ä½œæŒ‡å‘å¤‡åº“æ¥è·å¾—æ›´å¥½çš„è¯»æ‰©å±•ï¼Œä½†å¯¹äºå†™æ“ä½œï¼Œé™¤éè®¾è®¡å¾—å½“ï¼Œå¦åˆ™å¹¶ä¸é€‚åˆé€šè¿‡å¤åˆ¶æ¥æ‰©å±•å†™æ“ä½œã€‚ 1.1 å¤åˆ¶è§£å†³çš„é—®é¢˜ æ•°æ®åˆ†å¸ƒ è´Ÿè½½å‡è¡¡ï¼Œè¯»å†™åˆ†ç¦» å¤‡ä»½ é«˜å¯ç”¨å’Œæ•…éšœåˆ‡æ¢ 2 å¤åˆ¶åŸç†2.1 å¤åˆ¶å¦‚ä½•å·¥ä½œ åœ¨ä¸»åº“ä¸ŠæŠŠæ•°æ®æ›´æ”¹è®°å½•åœ¨ binlog ä¸­ï¼ˆè¿™äº›è®°å½•ç§°ä¸ºäºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶ï¼‰ å¤‡åº“å°†ä¸»åº“ä¸Šçš„æ—¥å¿—å¤åˆ¶åˆ°è‡ªå·±çš„ä¸­ç»§æ—¥å¿—ä¸­ å¤‡åº“è¯»å–ä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†å…¶é‡æ”¾åˆ°å¤‡åº“æ•°æ®ä¹‹ä¸Š 2.2 åŸºäºè¯­å¥çš„å¤åˆ¶ä¸»åº“ä¼šè®°å½•é‚£äº›é€ æˆæ•°æ®æ›´æ”¹çš„æŸ¥è¯¢ï¼Œå½“å¤‡åº“è¯»å–å¹¶é‡æ”¾è¿™äº›äº‹ä»¶æ—¶ï¼Œå®é™…ä¸Šåªæ˜¯æŠŠä¸»åº“ä¸Šæ‰§è¡Œè¿‡çš„ SQL å†æ‰§è¡Œä¸€éã€‚ å³binlogçš„statementæ¨¡å¼ ä¼˜ç‚¹ï¼š å®ç°ç®€å• binlog ä¸­çš„äº‹ä»¶æ›´åŠ ç´§å‡‘ é—®é¢˜ï¼š åŒä¸€æ¡ SQL åœ¨ä¸»åº“å’Œå¤‡åº“ä¸Šæ‰§è¡Œçš„æ—¶é—´å¯èƒ½ç¨å¾®æˆ–å¾ˆä¸ç›¸åŒï¼Œå› æ­¤åœ¨ä¼ è¾“çš„ binlog ä¸­ï¼Œé™¤äº† SQLï¼Œè¿˜æœ‰ä¸€äº›å…ƒæ•°æ®ï¼Œæ¯”å¦‚æ—¶é—´æˆ³ ä¸€äº›æ— æ³•è¢«æ­£ç¡®å¤åˆ¶çš„ SQLï¼Œå­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ æ›´æ–°å¿…é¡»æ˜¯ä¸²è¡Œçš„ï¼Œè¿™éœ€è¦æ›´å¤šçš„é” 2.3 åŸºäºè¡Œçš„å¤åˆ¶ä¼šå°†å®é™…æ•°æ®è®°å½•åœ¨ binlog ä¸­ã€‚å³binlogçš„rowæ¨¡å¼ å¥½å¤„ï¼š å¯ä»¥æ­£ç¡®åœ°å¤åˆ¶æ¯ä¸€è¡Œï¼Œä¸€äº›è¯­å¥å¯ä»¥è¢«æ›´åŠ æœ‰æ•ˆåœ°å¤åˆ¶ å¤åˆ¶æ›´åŠ é«˜æ•ˆï¼ˆä½†ä¹Ÿè§†æƒ…å†µè€Œå®šï¼‰ 3 æ­å»ºæ­¥éª¤3.1 master åœ¨masterçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®å¦‚ä¸‹å†…å®¹ï¼š #mysql æœåŠ¡ID,ä¿è¯æ•´ä¸ªé›†ç¾¤ç¯å¢ƒä¸­å”¯ä¸€ server-id=1 #mysql binlog æ—¥å¿—çš„å­˜å‚¨è·¯å¾„å’Œæ–‡ä»¶åï¼Œä¸»ä»å¤åˆ¶æ˜¯åŸºäºbinlogçš„ log-bin=/var/lib/mysql/mysqlbin #é”™è¯¯æ—¥å¿—,é»˜è®¤å·²ç»å¼€å¯ #log-err #mysqlçš„å®‰è£…ç›®å½• #basedir #mysqlçš„ä¸´æ—¶ç›®å½• #tmpdir #mysqlçš„æ•°æ®å­˜æ”¾ç›®å½• #datadir #æ˜¯å¦åªè¯»,1 ä»£è¡¨åªè¯», 0 ä»£è¡¨è¯»å†™ read-only=0 #å¿½ç•¥çš„æ•°æ®, æŒ‡ä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“ binlog-ignore-db=mysql #æŒ‡å®šåŒæ­¥çš„æ•°æ®åº“ #binlog-do-db=db01 åœ¨å®¢æˆ·ç«¯ä¸­å»ºåŒæ­¥æ•°æ®çš„è´¦æˆ·ï¼Œå¹¶ä¸”è¿›è¡Œæˆæƒæ“ä½œï¼š grant replication slave on *.* to 'slave1'@'slave_host' identified by 'password'; flush privileges; å¦‚æœéœ€è¦é…ç½®å¤šä¸ªä»æœºå°±åˆ›å»ºå¤šä¸ªè´¦æˆ·ï¼Œ&#39;slave_host&#39;ä»£è¡¨ä»æœºçš„ipåœ°å€ã€‚ æŸ¥çœ‹masterçŠ¶æ€ï¼š show master status; File : ä»å“ªä¸ªæ—¥å¿—æ–‡ä»¶å¼€å§‹æ¨é€æ—¥å¿—æ–‡ä»¶ Position ï¼š ä»å“ªä¸ªä½ç½®å¼€å§‹æ¨é€æ—¥å¿— Binlog_Ignore_DB : æŒ‡å®šä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“ 3.2 slave åœ¨ slave ç«¯é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®å¦‚ä¸‹å†…å®¹ï¼š #mysqlæœåŠ¡ç«¯ID,å”¯ä¸€ server-id=2 #æŒ‡å®šbinlogæ—¥å¿— log-bin=/var/lib/mysql/mysqlbin åœ¨å®¢æˆ·ç«¯å†…æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ ï¼š change master to master_host= 'master_host', master_user='slave1', master_password='password', master_log_file='mysqlbin.000001', master_log_pos=413; æŒ‡å®šå½“å‰ä»åº“å¯¹åº”çš„ä¸»åº“çš„IPåœ°å€ï¼Œç”¨æˆ·åï¼Œå¯†ç ï¼Œä»å“ªä¸ªæ—¥å¿—æ–‡ä»¶å¼€å§‹çš„é‚£ä¸ªä½ç½®å¼€å§‹åŒæ­¥æ¨é€æ—¥å¿—ã€‚ï¼ˆè¿™äº›éƒ½æ˜¯åœ¨master statusä¸­çœ‹åˆ°çš„ï¼‰ å¼€å¯åŒæ­¥æ“ä½œ start slave; show slave status; åœæ­¢åŒæ­¥æ“ä½œ stop slave;","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"MySQL","slug":"MySQL","permalink":"https://www.codetool.top/tags/MySQL/"}]},{"title":"MySQLä¹‹æ—¥å¿—é…ç½®å…¨è§£","slug":"MySQLä¹‹æ—¥å¿—é…ç½®å…¨è§£","date":"2020-03-07T09:43:59.000Z","updated":"2020-03-07T09:44:31.028Z","comments":true,"path":"article/MySQLä¹‹æ—¥å¿—é…ç½®å…¨è§£/","link":"","permalink":"https://www.codetool.top/article/MySQL%E4%B9%8B%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE%E5%85%A8%E8%A7%A3/","excerpt":"","text":"1 é”™è¯¯æ—¥å¿—é”™è¯¯æ—¥å¿—æ˜¯ MySQL ä¸­æœ€é‡è¦çš„æ—¥å¿—ä¹‹ä¸€ï¼Œå®ƒè®°å½•äº†å½“ mysqld å¯åŠ¨å’Œåœæ­¢æ—¶ï¼Œä»¥åŠæœåŠ¡å™¨åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿä»»ä½•ä¸¥é‡é”™è¯¯æ—¶çš„ç›¸å…³ä¿¡æ¯ã€‚å½“æ•°æ®åº“å‡ºç°ä»»ä½•æ•…éšœå¯¼è‡´æ— æ³•æ­£å¸¸ä½¿ç”¨æ—¶ï¼Œå¯ä»¥é¦–å…ˆæŸ¥çœ‹æ­¤æ—¥å¿—ã€‚ è¯¥æ—¥å¿—æ˜¯é»˜è®¤å¼€å¯çš„ ï¼Œ é»˜è®¤å­˜æ”¾ç›®å½•ä¸º mysql çš„æ•°æ®ç›®å½•ï¼ˆvar/lib/mysqlï¼‰, é»˜è®¤çš„æ—¥å¿—æ–‡ä»¶åä¸º hostname.errï¼ˆhostnameæ˜¯ä¸»æœºåï¼‰ã€‚ 1.1 ç›¸å…³é…ç½® log-errorï¼šé”™è¯¯æ—¥å¿—å­˜æ”¾è·¯å¾„ log-warningsï¼šæ˜¯å¦å°†è­¦å‘Šä¿¡æ¯ä¹Ÿè¾“å…¥é”™è¯¯æ—¥å¿—ï¼Œ1ä»£è¡¨æ˜¯ï¼ˆ5.7ååºŸå¼ƒï¼‰ log_error_verbosityï¼šï¼ˆä»£æ›¿log-warningsï¼‰é”™è¯¯æ—¥å¿—çº§åˆ« 1ï¼šerrors only 2ï¼šerrors and warnings 3ï¼šerrorsï¼Œwarnings and notes 2 äºŒè¿›åˆ¶æ—¥å¿—äºŒè¿›åˆ¶æ—¥å¿—åŒ…å«äº†æ‰€æœ‰çš„ DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰è¯­å¥å’Œ DMLï¼ˆæ•°æ®æ“çºµè¯­è¨€ï¼‰è¯­å¥çš„äº‹ä»¶ä¿¡æ¯ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬æ•°æ®æŸ¥è¯¢è¯­å¥ã€‚è¯­å¥ä»¥â€äº‹ä»¶â€çš„å½¢å¼ä¿å­˜ï¼Œæ‰€ä»¥åŒ…å«äº†æ—¶é—´ã€äº‹ä»¶å¼€å§‹å’Œç»“æŸä½ç½®ç­‰ä¿¡æ¯ã€‚æ­¤æ—¥å¿—å¯¹äºç¾éš¾æ—¶çš„æ•°æ®æ¢å¤èµ·ç€æå…¶é‡è¦çš„ä½œç”¨ï¼ŒMySQLçš„ä¸»ä»å¤åˆ¶ï¼Œ å°±æ˜¯é€šè¿‡è¯¥binlogå®ç°çš„ã€‚ äºŒè¿›åˆ¶æ—¥å¿—ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯æ²¡æœ‰å¼€å¯çš„ï¼Œéœ€è¦åˆ°MySQLçš„é…ç½®æ–‡ä»¶ä¸­å¼€å¯ï¼Œå¹¶é…ç½®MySQLæ—¥å¿—çš„æ ¼å¼ã€‚ mysqldè¿˜åˆ›å»ºä¸€ä¸ªäºŒè¿›åˆ¶æ—¥å¿—ç´¢å¼•æ–‡ä»¶ï¼Œå½“äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶æ»šåŠ¨çš„æ—¶å€™ä¼šå‘è¯¥æ–‡ä»¶ä¸­å†™å…¥å¯¹åº”çš„ä¿¡æ¯ã€‚æ‰€ä»¥è¯¥æ–‡ä»¶åŒ…å«æ‰€æœ‰ä½¿ç”¨çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„æ–‡ä»¶åã€‚é»˜è®¤æƒ…å†µä¸‹è¯¥æ–‡ä»¶ä¸äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„æ–‡ä»¶åç›¸åŒï¼Œæ‰©å±•åä¸ºâ€™.indexâ€™ã€‚ 2.1 ç›¸å…³é…ç½® log_bin=[on|off|file_name]ï¼šå¼€å¯binlogï¼Œå¦‚æœæ²¡æœ‰ç»™å®šfile_nameï¼Œåˆ™é»˜è®¤ä¸ºdatadirä¸‹çš„ä¸»æœºååŠ â€-binâ€ï¼Œå¹¶åœ¨åé¢è·Ÿä¸Šä¸€ä¸²æ•°å­—è¡¨ç¤ºæ—¥å¿—åºåˆ—å·ã€‚ binlog_format=[STATEMENT|ROW|MIXED]ï¼šæŒ‡å®šäºŒè¿›åˆ¶æ—¥å¿—çš„æ ¼å¼ã€‚ STATEMENTï¼šè¯¥æ—¥å¿—æ ¼å¼åœ¨æ—¥å¿—æ–‡ä»¶ä¸­è®°å½•çš„éƒ½æ˜¯SQLè¯­å¥ï¼ˆstatementï¼‰ï¼Œæ¯ä¸€æ¡å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹çš„SQLéƒ½ä¼šè®°å½•åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œé€šè¿‡Mysqlæä¾›çš„mysqlbinlogå·¥å…·ï¼Œå¯ä»¥æ¸…æ™°çš„æŸ¥çœ‹åˆ°æ¯æ¡è¯­å¥çš„æ–‡æœ¬ã€‚ä¸»ä»å¤åˆ¶çš„æ—¶å€™ï¼Œä»åº“ï¼ˆslaveï¼‰ä¼šå°†æ—¥å¿—è§£æä¸ºåŸæ–‡æœ¬ï¼Œå¹¶åœ¨ä»åº“é‡æ–°æ‰§è¡Œä¸€æ¬¡ã€‚ ROWï¼šè¯¥æ—¥å¿—æ ¼å¼åœ¨æ—¥å¿—æ–‡ä»¶ä¸­è®°å½•çš„æ˜¯æ¯ä¸€è¡Œçš„æ•°æ®å˜æ›´ï¼Œè€Œä¸æ˜¯è®°å½•SQLè¯­å¥ã€‚æ¯”å¦‚ï¼Œæ‰§è¡ŒSQLè¯­å¥ ï¼š update tb_book set status=â€™1â€™ , å¦‚æœæ˜¯STATEMENT æ—¥å¿—æ ¼å¼ï¼Œåœ¨æ—¥å¿—ä¸­ä¼šè®°å½•ä¸€è¡ŒSQLæ–‡ä»¶ï¼› å¦‚æœæ˜¯ROWï¼Œç”±äºæ˜¯å¯¹å…¨è¡¨è¿›è¡Œæ›´æ–°ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€è¡Œè®°å½•éƒ½ä¼šå‘ç”Ÿå˜æ›´ï¼ŒROW æ ¼å¼çš„æ—¥å¿—ä¸­ä¼šè®°å½•æ¯ä¸€è¡Œçš„æ•°æ®å˜æ›´ã€‚ MIXEDï¼šè¿™æ˜¯ç›®å‰MySQLé»˜è®¤çš„æ—¥å¿—æ ¼å¼ï¼Œå³æ··åˆäº†STATEMENT å’Œ ROWä¸¤ç§æ ¼å¼ã€‚é»˜è®¤æƒ…å†µä¸‹é‡‡ç”¨STATEMENTï¼Œä½†æ˜¯åœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹é‡‡ç”¨ROWæ¥è¿›è¡Œè®°å½•ã€‚MIXED æ ¼å¼èƒ½å°½é‡åˆ©ç”¨ä¸¤ç§æ¨¡å¼çš„ä¼˜ç‚¹ï¼Œè€Œé¿å¼€ä»–ä»¬çš„ç¼ºç‚¹ã€‚ log_bin_index = file_nameï¼šé…ç½®ç´¢å¼•æ–‡ä»¶çš„åå­— expire_logs_daysï¼šæŒ‡å®šè‡ªåŠ¨åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—çš„æ—¶é—´ï¼Œå³æ—¥å¿—è¿‡æœŸæ—¶é—´ binlog_do_db ï¼šæ˜ç¡®æŒ‡å®šè¦è®°å½•æ—¥å¿—çš„æ•°æ®åº“ binlog_ignore_db ï¼šæŒ‡å®šä¸è®°å½•äºŒè¿›åˆ¶æ—¥å¿—çš„æ•°æ®åº“ binlog_cache_size = 32768 : åŸºäºäº‹åŠ¡ç±»å‹çš„æ—¥å¿—ä¼šå…ˆè®°å½•åœ¨ç¼“å†²åŒºï¼Œå½“è¾¾åˆ°è¯¥ç¼“å†²å¤§å°æ—¶è¿™äº›æ—¥å¿—ä¼šå†™å…¥ç£ç›˜ max_binlog_size ï¼šæŒ‡å®šäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶æœ€å¤§å€¼ï¼Œè¶…å‡ºæŒ‡å®šå€¼å°†è‡ªåŠ¨æ»šåŠ¨ã€‚ä½†ç”±äºäº‹åŠ¡ä¸ä¼šè·¨æ–‡ä»¶ï¼Œæ‰€ä»¥å¹¶ä¸ä¸€å®šæ€»æ˜¯ç²¾ç¡®ã€‚ sync_binlog = { 0 | n } ï¼šæ—¥å¿—ä½•æ—¶åˆ·åˆ°ç£ç›˜ 0:ä¸åŒæ­¥ï¼Œæ—¥å¿—ä½•æ—¶åˆ·åˆ°ç£ç›˜ç”±FileSystemå†³å®šï¼Œè¿™ä¸ªæ€§èƒ½æœ€å¥½ã€‚ n:æ¯å†™næ¬¡äºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶(ä¸æ˜¯äº‹åŠ¡)ï¼ŒMySQLå°†æ‰§è¡Œä¸€æ¬¡ç£ç›˜åŒæ­¥æŒ‡ä»¤fdatasync()å°†ç¼“å­˜æ—¥å¿—åˆ·æ–°åˆ°ç£ç›˜æ—¥å¿—æ–‡ä»¶ä¸­ã€‚Mysqlä¸­é»˜è®¤çš„è®¾ç½®æ˜¯sync_binlog=0ï¼Œå³ä¸åŒæ­¥ï¼Œè¿™æ—¶æ€§èƒ½æœ€å¥½ï¼Œä½†é£é™©æœ€å¤§ã€‚ä¸€æ—¦ç³»ç»Ÿå¥”æºƒï¼Œç¼“å­˜ä¸­çš„æ—¥å¿—éƒ½ä¼šä¸¢å¤±ã€‚ åœ¨Innodbçš„ä¸»ä»å¤åˆ¶ç»“æ„ä¸­ï¼Œå¦‚æœå¯ç”¨äº†äºŒè¿›åˆ¶æ—¥å¿—(å‡ ä¹éƒ½ä¼šå¯ç”¨)ï¼Œè¦ä¿è¯äº‹åŠ¡çš„ä¸€è‡´æ€§å’ŒæŒä¹…æ€§çš„æ—¶å€™ï¼Œå¿…é¡»å°†sync_binlogçš„å€¼è®¾ç½®ä¸º1ï¼Œå› ä¸ºæ¯æ¬¡äº‹åŠ¡æäº¤éƒ½ä¼šå†™å…¥äºŒè¿›åˆ¶æ—¥å¿—ï¼Œè®¾ç½®ä¸º1å°±ä¿è¯äº†æ¯æ¬¡äº‹åŠ¡æäº¤æ—¶äºŒè¿›åˆ¶æ—¥å¿—éƒ½ä¼šå†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œä»è€Œç«‹å³è¢«ä»æœåŠ¡å™¨å¤åˆ¶è¿‡å»ã€‚ 2.2 æ—¥å¿—æŸ¥çœ‹ç”±äºæ—¥å¿—ä»¥äºŒè¿›åˆ¶æ–¹å¼å­˜å‚¨ï¼Œä¸èƒ½ç›´æ¥è¯»å–ï¼Œéœ€è¦ç”¨mysqlbinlogå·¥å…·æ¥æŸ¥çœ‹ï¼Œè¯­æ³•å¦‚ä¸‹ ï¼š mysqlbinlog log-file 2.3 æ—¥å¿—åˆ é™¤å¯¹äºæ¯”è¾ƒç¹å¿™çš„ç³»ç»Ÿï¼Œç”±äºæ¯å¤©ç”Ÿæˆæ—¥å¿—é‡å¤§ ï¼Œè¿™äº›æ—¥å¿—å¦‚æœé•¿æ—¶é—´ä¸æ¸…é™¤ï¼Œå°†ä¼šå ç”¨å¤§é‡çš„ç£ç›˜ç©ºé—´ã€‚ä¸‹é¢ä»‹ç»å‡ ç§åˆ é™¤æ—¥å¿—çš„å¸¸è§æ–¹æ³• ï¼š 1) é€šè¿‡ Reset Master æŒ‡ä»¤åˆ é™¤å…¨éƒ¨ binlog æ—¥å¿—ï¼Œåˆ é™¤ä¹‹åï¼Œæ—¥å¿—ç¼–å·å°†ä» xxxx.000001é‡æ–°å¼€å§‹ã€‚ 2) æ‰§è¡ŒæŒ‡ä»¤ purge master logs to &#39;mysqlbin.******&#39; ï¼Œè¯¥å‘½ä»¤å°†åˆ é™¤ ****** ç¼–å·ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—ã€‚ 3) æ‰§è¡ŒæŒ‡ä»¤ purge master logs before &#39;yyyy-mm-dd hh24:mi:ss&#39; ï¼Œè¯¥å‘½ä»¤å°†åˆ é™¤æ—¥å¿—ä¸º â€œyyyy-mm-dd hh24:mi:ssâ€ ä¹‹å‰äº§ç”Ÿçš„æ‰€æœ‰æ—¥å¿—ã€‚ 4) è®¾ç½®å‚æ•° --expire_logs_days=# ï¼Œæ­¤å‚æ•°çš„å«ä¹‰æ˜¯è®¾ç½®æ—¥å¿—çš„è¿‡æœŸå¤©æ•°ï¼Œ è¿‡äº†æŒ‡å®šçš„å¤©æ•°åæ—¥å¿—å°†ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œè¿™æ ·å°†æœ‰åˆ©äºå‡å°‘DBA ç®¡ç†æ—¥å¿—çš„å·¥ä½œé‡ã€‚ 3 æŸ¥è¯¢æ—¥å¿—æŸ¥è¯¢æ—¥å¿—ä¸­è®°å½•äº†å®¢æˆ·ç«¯çš„æ‰€æœ‰æ“ä½œè¯­å¥ï¼Œè€ŒäºŒè¿›åˆ¶æ—¥å¿—ä¸åŒ…å«æŸ¥è¯¢æ•°æ®çš„SQLè¯­å¥ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ æŸ¥è¯¢æ—¥å¿—æ˜¯æœªå¼€å¯çš„ã€‚å¦‚æœéœ€è¦å¼€å¯æŸ¥è¯¢æ—¥å¿—ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®ã€‚é€šå¸¸ä¸éœ€è¦å¼€å¯æ­¤æ—¥å¿—ã€‚ 3.1 ç›¸å…³é…ç½® general_log = {0 | 1} ï¼š æ˜¯å¦å¼€å¯æŸ¥è¯¢æ—¥å¿— general_log_file ï¼š æŸ¥è¯¢æ—¥å¿—å­˜æ”¾è·¯å¾„ï¼Œä¸ç»™å®šè·¯å¾„æ—¶é»˜è®¤çš„æ–‡ä»¶åä»¥ hostname.log å‘½åã€‚ 4 æ…¢æŸ¥è¯¢æ—¥å¿—MySQL çš„æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯ MySQL æä¾›çš„ä¸€ç§æ—¥å¿—è®°å½•ï¼Œå®ƒç”¨æ¥è®°å½•åœ¨ MySQL ä¸­å“åº”æ—¶é—´è¶…è¿‡é˜ˆå€¼çš„è¯­å¥ï¼Œå…·ä½“æŒ‡è¿è¡Œæ—¶é—´è¶…è¿‡ long_query_time å€¼çš„ SQLï¼Œåˆ™ä¼šè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚ long_query_time çš„é»˜è®¤å€¼ä¸º 10ï¼Œæ„æ€æ˜¯è¿è¡Œ 10s ä»¥ä¸Šçš„è¯­å¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒMysql æ•°æ®åº“å¹¶ä¸å¯åŠ¨æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ¥è®¾ç½®è¿™ä¸ªå‚æ•°ï¼Œå½“ç„¶ï¼Œå¦‚æœä¸æ˜¯è°ƒä¼˜éœ€è¦çš„è¯ï¼Œä¸€èˆ¬ä¸å»ºè®®å¯åŠ¨è¯¥å‚æ•°ï¼Œå› ä¸ºå¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ä¼šæˆ–å¤šæˆ–å°‘å¸¦æ¥ä¸€å®šçš„æ€§èƒ½å½±å“ã€‚æ…¢æŸ¥è¯¢æ—¥å¿—æ”¯æŒå°†æ—¥å¿—è®°å½•å†™å…¥æ–‡ä»¶ï¼Œä¹Ÿæ”¯æŒå°†æ—¥å¿—è®°å½•å†™å…¥æ•°æ®åº“è¡¨ã€‚ æ ¼å¼å¤§è‡´å¦‚ä¸‹ï¼š # Time: 180118 14:58:37 # User@Host: root[root] @ localhost [] Id: 150 # Query_time: 0.000270 Lock_time: 0.000109 Rows_sent: 0 Rows_examined: 6 SET timestamp=1516258717; delete from user where User=&#39;app&#39;;æ˜¯å“ªæ¡è¯­å¥å¯¼è‡´æ…¢æŸ¥è¯¢ï¼ˆsql_textï¼‰ï¼Œè¯¥æ…¢æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢æ—¶é—´ï¼ˆquery_timeï¼‰ï¼Œé”è¡¨æ—¶é—´ï¼ˆLock_timeï¼‰ï¼Œä»¥åŠæ‰«æè¿‡çš„è¡Œæ•°ï¼ˆrows_examinedï¼‰ 4.1 ç›¸å…³é…ç½® slow_query_log ï¼šæ˜¯å¦å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œ1 è¡¨ç¤ºå¼€å¯ï¼Œ0 è¡¨ç¤ºå…³é—­ã€‚ slow-query-log-fileï¼šæ–°ç‰ˆï¼ˆ5.6 åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰ï¼šMySQL æ•°æ®åº“æ…¢æŸ¥è¯¢æ—¥å¿—å­˜å‚¨è·¯å¾„ã€‚å¯ä»¥ä¸è®¾ç½®è¯¥å‚æ•°ï¼Œç³»ç»Ÿåˆ™ä¼šé»˜è®¤ç»™ä¸€ä¸ªç¼ºçœçš„æ–‡ä»¶ host_name-slow.log long_query_time ï¼šæ…¢æŸ¥è¯¢é˜ˆå€¼ï¼Œå½“æŸ¥è¯¢æ—¶é—´å¤šäºè®¾å®šçš„é˜ˆå€¼æ—¶ï¼Œè®°å½•æ—¥å¿—ã€‚ log_queries_not_using_indexesï¼šæœªä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢ä¹Ÿè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ï¼ˆå¯é€‰é¡¹ï¼‰ã€‚ log_outputï¼šæ—¥å¿—å­˜å‚¨æ–¹å¼ã€‚é»˜è®¤å€¼æ˜¯&#39;FILE&#39;ï¼Œè¡¨ç¤ºå°†æ—¥å¿—å­˜å…¥æ–‡ä»¶ã€‚&#39;TABLE&#39;è¡¨ç¤ºå°†æ—¥å¿—å­˜å…¥æ•°æ®åº“ï¼Œè¿™æ ·æ—¥å¿—ä¿¡æ¯å°±ä¼šè¢«å†™å…¥åˆ° mysql.slow_log è¡¨ä¸­ï¼Œæ”¯æŒåŒæ—¶è®°å½•åˆ°æ–‡ä»¶å’Œæ•°æ®åº“ï¼Œé…ç½®çš„æ—¶å€™ä»¥é€—å·éš”å¼€å³å¯ã€‚ 4.2 æ…¢æ—¥å¿—åˆ†æå·¥å…· mysqldumpslowåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¦‚æœè¦æ‰‹å·¥åˆ†ææ—¥å¿—ï¼ŒæŸ¥æ‰¾ã€åˆ†æ SQLï¼Œæ˜¾ç„¶æ˜¯ä¸ªä½“åŠ›æ´»ï¼ŒMySQL æä¾›äº†æ—¥å¿—åˆ†æå·¥å…· mysqldumpslowã€‚ å‚æ•°ï¼š -s æŒ‰ç…§é‚£ç§æ–¹å¼æ’åº cï¼šè®¿é—®è®¡æ•° lï¼šé”å®šæ—¶é—´ r:è¿”å›è®°å½• alï¼šå¹³å‡é”å®šæ—¶é—´ arï¼šå¹³å‡è®¿é—®è®°å½•æ•° atï¼šå¹³å‡æŸ¥è¯¢æ—¶é—´ -t æ˜¯top nçš„æ„æ€ï¼Œè¿”å›å¤šå°‘æ¡æ•°æ®ã€‚ -g å¯ä»¥è·Ÿä¸Šæ­£åˆ™åŒ¹é…æ¨¡å¼ï¼Œå¤§å°å†™ä¸æ•æ„Ÿã€‚ ä¾‹ï¼š å¾—åˆ°è¿”å›è®°å½•é›†æœ€å¤šçš„ 10 ä¸ª SQLã€‚ mysqldumpslow -s r -t 10 /database/mysql/mysql06_slow.log å¾—åˆ°è®¿é—®æ¬¡æ•°æœ€å¤šçš„ 10 ä¸ª SQL mysqldumpslow -s c -t 10 /database/mysql/mysql06_slow.log å¾—åˆ°æŒ‰ç…§æ—¶é—´æ’åºçš„å‰ 10 æ¡é‡Œé¢å«æœ‰å·¦è¿æ¥çš„æŸ¥è¯¢è¯­å¥ã€‚ mysqldumpslow -s t -t 10 -g â€œleft joinâ€ /database/mysql/mysql06_slow.log å¦å¤–å»ºè®®åœ¨ä½¿ç”¨è¿™äº›å‘½ä»¤æ—¶ç»“åˆ | å’Œ more ä½¿ç”¨ ï¼Œå¦åˆ™æœ‰å¯èƒ½å‡ºç°åˆ·å±çš„æƒ…å†µã€‚ mysqldumpslow -s r -t 20 /mysqldata/mysql/mysql06-slow.log | more","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"MySQL","slug":"MySQL","permalink":"https://www.codetool.top/tags/MySQL/"}]},{"title":"å¤§å‹ç½‘ç«™æ¶æ„çš„æ¼”å˜è¿‡ç¨‹","slug":"å¤§å‹ç½‘ç«™æ¶æ„çš„æ¼”å˜è¿‡ç¨‹","date":"2020-03-07T02:41:31.000Z","updated":"2020-03-25T09:04:58.121Z","comments":true,"path":"article/å¤§å‹ç½‘ç«™æ¶æ„çš„æ¼”å˜è¿‡ç¨‹/","link":"","permalink":"https://www.codetool.top/article/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E7%9A%84%E6%BC%94%E5%8F%98%E8%BF%87%E7%A8%8B/","excerpt":"","text":"1 å•æœºæ—¶ä»£å¤§å‹ç½‘ç«™éƒ½æ˜¯ä»å°å‹ç½‘ç«™å‘å±•è€Œæ¥,ç½‘ç«™æ¶æ„ä¹Ÿæ˜¯ä¸€æ ·,æ˜¯ä»å°å‹ç½‘ç«™æ¶æ„é€æ­¥æ¼”åŒ–è€Œæ¥ã€‚å°å‹ç½‘ç«™æœ€å¼€å§‹æ—¶æ²¡æœ‰å¤ªå¤šäººè®¿é—®,åªéœ€è¦ä¸€å°æœåŠ¡å™¨å°±ç»°ç»°æœ‰ä½™,æœ€å…¸å‹çš„æ˜¯åœ¨å°å‹ç½‘ç«™ä¸Šç§°éœ¸çš„LAMPï¼ˆLinux+Apache+MySQL+PHPï¼‰ã€‚æ­¤æ—¶çš„ç½‘ç«™æ¶æ„å¦‚å›¾æ‰€ç¤ºï¼š 2 åº”ç”¨æœåŠ¡å’Œæ•°æ®æœåŠ¡åˆ†ç¦»éšç€ç½‘ç«™ä¸šåŠ¡çš„å‘å±•,ä¸€å°æœåŠ¡å™¨é€æ¸ä¸èƒ½æ»¡è¶³éœ€æ±‚:è¶Šæ¥è¶Šå¤šçš„ç”¨æˆ·è®¿é—®å¯¼è‡´æ€§èƒ½è¶Šæ¥è¶Šå·®,è¶Šæ¥è¶Šå¤šçš„æ•°æ®å¯¼è‡´å­˜å‚¨ç©ºé—´ä¸è¶³ã€‚è¿™æ—¶å°±éœ€è¦å°†åº”ç”¨å’Œæ•°æ®åˆ†ç¦»ã€‚åº”ç”¨å’Œæ•°æ®åˆ†ç¦»åæ•´ä¸ªç½‘ç«™ä½¿ç”¨ä¸‰å°æœåŠ¡å™¨:åº”ç”¨æœåŠ¡å™¨ã€æ–‡ä»¶æœåŠ¡å™¨å’Œæ•°æ®åº“æœåŠ¡å™¨ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š è¿™ä¸‰å°æœåŠ¡å™¨å¯¹ç¡¬ä»¶èµ„æºçš„è¦æ±‚å„ä¸ç›¸åŒ,åº”ç”¨æœåŠ¡å™¨éœ€è¦å¤„ç†å¤§é‡çš„ä¸šåŠ¡é€»è¾‘,å› æ­¤éœ€è¦æ›´å¿«æ›´å¼ºå¤§çš„CPU;æ•°æ®åº“æœåŠ¡å™¨éœ€è¦å¿«é€Ÿç£ç›˜æ£€ç´¢å’Œæ•°æ®ç¼“å­˜,å› æ­¤éœ€è¦æ›´å¿«çš„ç¡¬ç›˜å’Œæ›´å¤§çš„å†…å­˜;æ–‡ä»¶æœåŠ¡å™¨éœ€è¦å­˜å‚¨å¤§é‡ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶,å› æ­¤éœ€è¦æ›´å¤§çš„ç¡¬ç›˜ã€‚ éšç€ç”¨æˆ·æ•°å¢å¤šï¼Œç½‘ç«™åˆä¸€æ¬¡é¢ä¸´æŒ‘æˆ˜ï¼šæ•°æ®åº“å‹åŠ›å¤ªå¤§å¯¼è‡´è®¿é—®å»¶è¿Ÿï¼Œè¿›è€Œå½±å“æ•´ä¸ªç½‘ç«™çš„æ€§èƒ½ã€‚ 3 ä½¿ç”¨ç¼“å­˜æ”¹å–„ç½‘ç«™æ€§èƒ½ç½‘ç«™è®¿é—®ç‰¹ç‚¹å’Œç°å®ä¸–ç•Œçš„è´¢å¯Œåˆ†é…ä¸€æ ·éµå¾ªäºŒå…«å®šå¾‹:80%çš„ä¸šåŠ¡è®¿é—®é›†ä¸­åœ¨20%çš„æ•°æ®ä¸Šã€‚æ·˜å®ä¹°å®¶æµè§ˆçš„å•†å“é›†ä¸­åœ¨å°‘éƒ¨åˆ†æˆäº¤æ•°å¤šã€è¯„ä»·è‰¯å¥½çš„å•†å“ä¸Š;ç™¾åº¦æœç´¢å…³é”®è¯é›†ä¸­åœ¨å°‘éƒ¨åˆ†çƒ­é—¨è¯æ±‡ä¸Š;åªæœ‰ç»å¸¸ç™»å½•çš„ç”¨æˆ·æ‰ä¼šå‘å¾®åšã€çœ‹å¾®åš,è€Œè¿™éƒ¨åˆ†ç”¨æˆ·ä¹Ÿåªå æ€»ç”¨æˆ·æ•°ç›®çš„ä¸€å°éƒ¨åˆ†ã€‚ æ—¢ç„¶å¤§éƒ¨åˆ†çš„ä¸šåŠ¡è®¿é—®é›†ä¸­åœ¨ä¸€å°éƒ¨åˆ†æ•°æ®ä¸Š,é‚£ä¹ˆå¦‚æœæŠŠè¿™ä¸€å°éƒ¨åˆ†æ•°æ®ç¼“å­˜åœ¨å†…å­˜ä¸­,æ˜¯ä¸æ˜¯å°±å¯ä»¥å‡å°‘æ•°æ®åº“çš„è®¿é—®å‹åŠ›,æé«˜æ•´ä¸ªç½‘ç«™çš„æ•°æ®è®¿é—®é€Ÿåº¦,æ”¹å–„æ•°æ®åº“çš„å†™å…¥æ€§èƒ½äº†å‘¢? ç½‘ç«™ä½¿ç”¨çš„ç¼“å­˜å¯ä»¥åˆ†ä¸ºä¸¤ç§:ç¼“å­˜åœ¨åº”ç”¨æœåŠ¡å™¨ä¸Šçš„æœ¬åœ°ç¼“å­˜å’Œç¼“å­˜åœ¨ä¸“é—¨çš„åˆ†å¸ƒå¼ç¼“å­˜æœåŠ¡å™¨ä¸Šçš„è¿œç¨‹ç¼“å­˜ã€‚æœ¬åœ°ç¼“å­˜çš„è®¿é—®é€Ÿåº¦æ›´å¿«ä¸€äº›,ä½†æ˜¯å—åº”ç”¨æœåŠ¡å™¨å†…å­˜é™åˆ¶,å…¶ç¼“å­˜æ•°æ®é‡æœ‰é™,è€Œä¸”ä¼šå‡ºç°å’Œåº”ç”¨ç¨‹åºäº‰ç”¨å†…å­˜çš„æƒ…å†µã€‚è¿œç¨‹åˆ†å¸ƒå¼ç¼“å­˜å¯ä»¥ä½¿ç”¨é›†ç¾¤çš„æ–¹å¼,éƒ¨ç½²å¤§å†…å­˜çš„æœåŠ¡å™¨ä½œä¸ºä¸“é—¨çš„ç¼“å­˜æœåŠ¡å™¨,å¯ä»¥åœ¨ç†è®ºä¸Šåšåˆ°ä¸å—å†…å­˜å®¹é‡é™åˆ¶çš„ç¼“å­˜æœåŠ¡,å¦‚å›¾æ‰€ç¤ºï¼š ä½¿ç”¨ç¼“å­˜å,æ•°æ®è®¿é—®å‹åŠ›å¾—åˆ°æœ‰æ•ˆç¼“è§£,ä½†æ˜¯å•ä¸€åº”ç”¨æœåŠ¡å™¨èƒ½å¤Ÿå¤„ç†çš„è¯·æ±‚è¿æ¥æœ‰é™,åœ¨ç½‘ç«™è®¿é—®é«˜å³°æœŸ,åº”ç”¨æœåŠ¡å™¨æˆä¸ºæ•´ä¸ªç½‘ç«™çš„ç“¶é¢ˆã€‚ 4 ä½¿ç”¨åº”ç”¨æœåŠ¡å™¨é›†ç¾¤æ”¹å–„ç½‘ç«™çš„å¹¶å‘å¤„ç†èƒ½åŠ›è¿™ä¹Ÿè¢«ç§°ä¸ºè´Ÿè½½å‡è¡¡ï¼š 5 æ•°æ®åº“è¯»å†™åˆ†ç¦»ç½‘ç«™åœ¨ä½¿ç”¨ç¼“å­˜å,ä½¿ç»å¤§éƒ¨åˆ†æ•°æ®è¯»æ“ä½œè®¿é—®éƒ½å¯ä»¥ä¸é€šè¿‡æ•°æ®åº“å°±èƒ½å®Œæˆ,ä½†æ˜¯ä»æœ‰ä¸€éƒ¨åˆ†è¯»æ“ä½œ(ç¼“å­˜è®¿é—®ä¸å‘½ä¸­ã€ç¼“å­˜è¿‡æœŸ)å’Œå…¨éƒ¨çš„å†™æ“ä½œéœ€è¦è®¿é—®æ•°æ®åº“,åœ¨ç½‘ç«™çš„ç”¨æˆ·è¾¾åˆ°ä¸€å®šè§„æ¨¡å,æ•°æ®åº“å› ä¸ºè´Ÿè½½å‹åŠ›è¿‡é«˜è€Œæˆä¸ºç½‘ç«™çš„ç“¶é¢ˆã€‚ é€šå¸¸ä½¿ç”¨ä¸»ä»å¤åˆ¶æŠ€æœ¯ï¼Œåªåœ¨ä¸»æœºä¸Šå†™æ•°æ®ï¼Œåœ¨ä»æœºä¸Šè¯»æ•°æ®ã€‚ 6 ä½¿ç”¨åå‘ä»£ç†å’ŒCDNåŠ é€Ÿç½‘ç«™å“åº”éšç€ç½‘ç«™ä¸šåŠ¡ä¸æ–­å‘å±•,ç”¨æˆ·è§„æ¨¡è¶Šæ¥è¶Šå¤§,ç”±äºä¸­å›½å¤æ‚çš„ç½‘ç»œç¯å¢ƒ,ä¸åŒåœ°åŒºçš„ç”¨æˆ·è®¿é—®ç½‘ç«™æ—¶,é€Ÿåº¦å·®åˆ«ä¹Ÿæå¤§ã€‚æœ‰ç ”ç©¶è¡¨æ˜,ç½‘ç«™è®¿é—®å»¶è¿Ÿå’Œç”¨æˆ·æµå¤±ç‡æ­£ç›¸å…³, ç½‘ç«™è®¿é—®è¶Šæ…¢,ç”¨æˆ·è¶Šå®¹æ˜“å¤±å»è€å¿ƒè€Œç¦»å¼€ã€‚ä¸ºäº†æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ,ç•™ä½ç”¨æˆ·,ç½‘ç«™éœ€è¦åŠ é€Ÿç½‘ç«™è®¿é—®é€Ÿåº¦ã€‚ä¸»è¦æ‰‹æ®µæœ‰ä½¿ç”¨CDNå’Œåå‘ä»£ç†,å¦‚å›¾æ‰€ç¤ºï¼š CDNå’Œåå‘ä»£ç†çš„åŸºæœ¬åŸç†éƒ½æ˜¯ç¼“å­˜,åŒºåˆ«åœ¨äºCDNéƒ¨ç½²åœ¨ç½‘ç»œæä¾›å•†çš„æœºæˆ¿,ä½¿ç”¨æˆ·åœ¨è¯·æ±‚ç½‘ç«™æœåŠ¡æ—¶,å¯ä»¥ä»è·ç¦»è‡ªå·±æœ€è¿‘çš„ç½‘ç»œæä¾›å•†æœºæˆ¿è·å–æ•°æ®;è€Œåå‘ä»£ç†åˆ™éƒ¨ç½²åœ¨ç½‘ç«™çš„ä¸­å¿ƒæœºæˆ¿,å½“ç”¨æˆ·è¯·æ±‚åˆ°è¾¾ä¸­å¿ƒæœºæˆ¿å,é¦–å…ˆè®¿é—®çš„æœåŠ¡å™¨æ˜¯åå‘ä»£ç†æœåŠ¡å™¨,å¦‚æœåå‘ä»£ç†æœåŠ¡å™¨ä¸­ç¼“å­˜ç€ç”¨æˆ·è¯·æ±‚çš„èµ„æº,å°±å°†å…¶ç›´æ¥è¿”å›ç»™ç”¨æˆ·ã€‚ 6.1 å¼•å…¥CDNåæµè§ˆå™¨è®¿é—®ç½‘ç«™çš„æµç¨‹ ç”¨æˆ·å‘æµè§ˆå™¨æäº¤åŸŸå æµè§ˆå™¨å¯¹åŸŸåè¿›è¡Œè§£æï¼Œç”±äº CDN å¯¹åŸŸåè§£æè¿‡ç¨‹è¿›è¡Œäº†è°ƒæ•´ï¼Œæ‰€ä»¥å¾—åˆ°çš„æ˜¯è¯¥åŸŸåå¯¹åº”çš„ CNAME è®°å½•ã€‚ å¯¹ CNAME å†æ¬¡è¿›è¡Œè§£æï¼Œå¾—åˆ°å®é™… IP åœ°å€ã€‚åœ¨è¿™æ¬¡çš„è§£æä¸­ï¼Œä¼šä½¿ç”¨å…¨å±€è´Ÿè½½å‡è¡¡ DNS è§£æï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦è¿”å›å…·ä½“ IP åœ°å€ï¼Œéœ€è¦æ ¹æ®åœ°ç†ä½ç½®ä¿¡æ¯ä»¥åŠæ‰€åœ¨çš„ ISP æ¥ç¡®å®šè¿”å›çš„ç»“æœï¼Œè¿™ä¸ªè¿‡ç¨‹æ‰èƒ½è®©èº«å¤„ä¸åŒåœ°åŸŸã€è¿æ¥ä¸åŒæ¥å…¥å•†çš„ç”¨æˆ·å¾—åˆ°æœ€é€‚åˆè‡ªå·±è®¿é—®çš„ CDN åœ°å€ï¼Œæ‰èƒ½åšåˆ°å°±è¿‘è®¿é—®ï¼Œä»è€Œæå‡é€Ÿåº¦ã€‚ å¾—åˆ°å®é™…çš„ IP åœ°å€åï¼Œå‘æœåŠ¡å™¨å‘å‡ºè®¿é—®è¯·æ±‚ CDN ä¼šæ ¹æ®è¯·æ±‚çš„å†…å®¹æ˜¯å¦åœ¨æœ¬åœ°ç¼“å­˜è¿›è¡Œä¸åŒå¤„ç†ï¼š å¦‚æœå­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›ç»“æœ å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ CDN è¯·æ±‚æºç«™ï¼Œè·å–å†…å®¹ï¼Œç„¶åå†è¿”å›ç»“æœã€‚ 6.2 CDN çš„å‡ ä¸ªå…³é”®æŠ€æœ¯6.2.1 å…¨å±€è°ƒåº¦å…¨å±€è°ƒåº¦æ˜¯å®Œæˆç”¨æˆ·å°±è¿‘è®¿é—®çš„ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®ç”¨æˆ·åœ°åŸŸã€æ¥å…¥è¿è¥å•†ä»¥åŠ CDN æœºæˆ¿çš„è´Ÿè½½æƒ…å†µå»è°ƒåº¦ã€‚å‰é¢ä¸¤ä¸ªè°ƒåº¦å› ç´ éœ€è¦ä¸€ä¸ªå°½å¯èƒ½ç²¾å‡†çš„ IP åœ°å€åº“ï¼Œè¿™æ˜¯æ­£ç¡®è°ƒç”¨çš„å‰æã€‚IP åœ°å€åº“çš„ç»´æŠ¤æ˜¯ä¸€ä¸ªæŒç»­å’Œå˜åŒ–çš„è¿‡ç¨‹ï¼Œå¹¶ä¸”è°ƒåº¦çš„ç­–ç•¥éšç€ CDN æœºæˆ¿çš„å¢åŠ ä¹Ÿä¼šå˜åŒ–ã€‚é™¤äº†è·ç¦»ï¼ŒCDN çš„è´Ÿè½½ä¹Ÿæ˜¯è°ƒåº¦ä¸­çš„ä¸€ä¸ªå½±å“å› ç´ ã€‚ 6.2.2 ç¼“å­˜æŠ€æœ¯å¦‚æœ CDN æœºæˆ¿çš„è¯·æ±‚å‘½ä¸­ç‡ä¸é«˜çš„è¯ï¼Œé‚£ä¹ˆèµ·åˆ°çš„åŠ é€Ÿæ•ˆæœä¹Ÿæ˜¯ç›¸å¯¹æœ‰é™çš„ã€‚ è¦æå‡å‘½ä¸­ç‡ï¼Œå°±éœ€è¦ CDN æœºæˆ¿ä¸­æœ‰å°½å¯èƒ½å…¨é¢çš„æ•°æ®ï¼Œè¿™å°±è¦æ±‚ CDN æœºæˆ¿çš„ç¼“å­˜å®¹é‡è¦è¶³å¤Ÿå¤§ï¼Œå¯ä»¥ä½¿ç”¨å†…å­˜+SSD+æœºæ¢°ç¡¬ç›˜çš„æ··åˆå­˜å‚¨æ–¹å¼æ¥æå‡æ•´ä½“çš„ç¼“å­˜å®¹é‡ï¼Œå¹¶ä¸”éœ€è¦åšå¥½å†·çƒ­æ•°æ®çš„äº¤æ¢ï¼Œåœ¨æå‡å‘½ä¸­ç‡æ—¶ä¹Ÿå°½é‡é™ä½ç¼“å­˜çš„å“åº”æ•°æ®ã€‚ æ­¤å¤–ï¼Œå½“ CDN çš„ cache æ²¡æœ‰å‘½ä¸­è¦å›æºåŠ è½½æ•°æ®æ—¶ï¼Œåˆå¹¶åŒæ ·æ•°æ®çš„è¯·æ±‚ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„ä¼˜åŒ–ï¼Œè¿™æ ·å¯ä»¥å‡å°‘é‡å¤çš„è¯·æ±‚ï¼Œé™ä½æºç«™çš„å‹åŠ›ã€‚ æœ€åï¼Œæ–°å¢ã€å˜æ›´æ•°æ®åçš„ CDN é¢„åŠ è½½ä¹Ÿæ˜¯ä¸€ä¸ªæå‡å‘½ä¸­ç‡çš„åŠæ³•ï¼Œä¹Ÿå°±æ˜¯åœ¨æ²¡æœ‰è¯·æ±‚è¿›æ¥æ—¶ï¼ŒCDN ä¸»åŠ¨å»åŠ è½½æ•°æ®ï¼Œåšå¥½å‡†å¤‡ã€‚å½“ç„¶è¿™ä¸ªä¸»åŠ¨åŠ è½½ä¸€èˆ¬ä¹Ÿéœ€è¦æºç«™æœ‰ä¸€ä¸ªé€šçŸ¥è¿‡æ¥ã€‚ 6.2.3 å†…å®¹åˆ†å‘å†…å®¹åˆ†å‘ä¸»è¦æ˜¯å¯¹å†…å®¹å…¨éƒ¨åœ¨ CDN ä¸Šä¸ç”¨å›æºçš„æ•°æ®çš„ç®¡ç†å’Œåˆ†å‘ï¼Œä¾‹å¦‚ä¸€äº›é™æ€é¡µé¢ç­‰ã€‚å…·ä½“åšæ³•æ˜¯åœ¨å†…å®¹ç®¡ç†ç³»ç»Ÿä¸­è¿›è¡Œç¼–è¾‘ä¿®æ”¹åï¼Œé€šè¿‡åˆ†å‘ç³»ç»Ÿåˆ†å‘åˆ°å„ä¸ª CDN çš„èŠ‚ç‚¹ä¸Šã€‚åˆ†å‘çš„æ•ˆç‡ä»¥åŠå¯¹åˆ†å‘æ–‡ä»¶ä¸€è‡´æ€§ã€æ­£ç¡®æ€§çš„æ ¡éªŒæ˜¯éœ€è¦å…³æ³¨çš„ç‚¹ã€‚ 6.2.4 å¸¦å®½ä¼˜åŒ–CDN æä¾›äº†å†…å®¹åŠ é€Ÿï¼Œå¾ˆå¤šè¯·æ±‚å’Œæµè§ˆéƒ½å‹åˆ°äº† CDN ä¸Šï¼Œé‚£ä¹ˆå¦‚ä½•èƒ½å¤Ÿæ¯”è¾ƒæœ‰æ•ˆåœ°èŠ‚çœè´·æ¬¾æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„äº‹æƒ…ï¼Œå› ä¸ºè¿™ç›´æ¥å…³ç³»åˆ°æµé‡æˆæœ¬ã€‚ä¼˜åŒ–çš„æ€è·¯æ˜¯åªè¿”å›å¿…è¦çš„æ•°æ®ï¼Œç”¨æ›´å¥½çš„å‹ç¼©ç®—æ³•ç­‰ã€‚ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ CDN æœºæˆ¿è·ç¦»æœ€ç»ˆç”¨æˆ·è¿‘çš„ç‰¹ç‚¹ï¼Œè®©ä¸€äº›ä¸Šä¼ çš„å·¥ä½œä» CDN æ¥å…¥ï¼Œç„¶åå†ä» CDN ä¼ åˆ°æºç«™ï¼Œè¿™ä¸€æ–¹é¢å¯ä»¥æå‡ç”¨æˆ·çš„ä¸Šä¼ é€Ÿåº¦ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¾ˆå¥½åœ°åˆ©ç”¨äº†ä» CDNæœºæˆ¿åˆ°æºç«™çš„ä¸Šè¡Œå¸¦å®½ã€‚ 7 ä½¿ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿå’Œåˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿä»»ä½•å¼ºå¤§çš„å•ä¸€æœåŠ¡å™¨éƒ½æ»¡è¶³ä¸äº†å¤§å‹ç½‘ç«™æŒç»­å¢é•¿çš„ä¸šåŠ¡éœ€æ±‚ã€‚æ•°æ®åº“ç»è¿‡è¯»å†™åˆ†ç¦»å,ä»ä¸€å°æœåŠ¡å™¨æ‹†åˆ†æˆä¸¤å°æœåŠ¡å™¨,ä½†æ˜¯éšç€ç½‘ç«™ä¸šåŠ¡çš„å‘å±•ä¾ç„¶ä¸èƒ½æ»¡è¶³éœ€æ±‚,è¿™æ—¶éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼æ•°æ®åº“ã€‚æ–‡ä»¶ç³»ç»Ÿä¹Ÿæ˜¯ä¸€æ ·,éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ,å¦‚å›¾æ‰€ç¤º: åˆ†å¸ƒå¼æ•°æ®åº“æ˜¯ç½‘ç«™æ•°æ®åº“æ‹†åˆ†çš„æœ€åæ‰‹æ®µï¼Œåªæœ‰åœ¨å•è¡¨æ•°æ®è§„æ¨¡éå¸¸åºå¤§çš„æ—¶å€™æ‰ä½¿ç”¨ã€‚ä¸åˆ°ä¸å¾—å·²æ—¶,ç½‘ç«™æ›´å¸¸ç”¨çš„æ•°æ®åº“æ‹†åˆ†æ‰‹æ®µæ˜¯ä¸šåŠ¡åˆ†åº“,å°†ä¸åŒä¸šåŠ¡çš„æ•°æ®åº“éƒ¨ç½²åœ¨ä¸åŒçš„ç‰©ç†æœåŠ¡å™¨ä¸Šã€‚ 8 ä½¿ç”¨NoSQLå’Œæœç´¢å¼•æ“éšç€ç½‘ç«™ä¸šåŠ¡è¶Šæ¥è¶Šå¤æ‚,å¯¹æ•°æ®å­˜å‚¨å’Œæ£€ç´¢çš„éœ€æ±‚ä¹Ÿè¶Šæ¥è¶Šå¤æ‚,ç½‘ç«™éœ€è¦é‡‡ç”¨ä¸€äº›éå…³ç³»æ•°æ®åº“æŠ€æœ¯å¦‚ NoSQLå’Œéæ•°æ®åº“æŸ¥è¯¢æŠ€æœ¯å¦‚æœç´¢å¼•æ“,å¦‚å›¾æ‰€ç¤ºï¼š NoSQLå’Œæœç´¢å¼•æ“éƒ½æ˜¯æºè‡ªäº’è”ç½‘çš„æŠ€æœ¯æ‰‹æ®µ,å¯¹å¯ä¼¸ç¼©çš„åˆ†å¸ƒå¼ç‰¹æ€§å…·æœ‰æ›´å¥½çš„æ”¯æŒã€‚åº”ç”¨æœåŠ¡å™¨åˆ™é€šè¿‡ä¸€ä¸ªç»Ÿä¸€æ•°æ®è®¿é—®æ¨¡å—è®¿é—®å„ç§æ•°æ®,å‡è½»åº”ç”¨ç¨‹åºç®¡ç†è¯¸å¤šæ•°æ®æºçš„éº»çƒ¦ã€‚ 9 ä¸šåŠ¡æ‹†åˆ†å¤§å‹ç½‘ç«™ä¸ºäº†åº”å¯¹æ—¥ç›Šå¤æ‚çš„ä¸šåŠ¡åœºæ™¯,é€šè¿‡ä½¿ç”¨åˆ†è€Œæ²»ä¹‹çš„æ‰‹æ®µå°†æ•´ä¸ªç½‘ç«™ä¸šåŠ¡åˆ†æˆä¸åŒçš„äº§å“çº¿,å¦‚å¤§å‹è´­ç‰©äº¤æ˜“ç½‘ç«™å°±ä¼šå°†é¦–é¡µã€å•†é“ºã€è®¢å•ã€ä¹°å®¶ã€å–å®¶ç­‰æ‹†åˆ†æˆä¸åŒçš„äº§å“çº¿,åˆ†å½’ä¸åŒçš„ä¸šåŠ¡å›¢é˜Ÿè´Ÿè´£ã€‚ å…·ä½“åˆ°æŠ€æœ¯ä¸Š,ä¹Ÿä¼šæ ¹æ®äº§å“çº¿åˆ’åˆ†,å°†ä¸€ä¸ªç½‘ç«™æ‹†åˆ†æˆè®¸å¤šä¸åŒçš„åº”ç”¨,æ¯ä¸ªåº”ç”¨ç‹¬ç«‹éƒ¨ç½²ç»´æŠ¤ã€‚åº”ç”¨ä¹‹é—´å¯ä»¥é€šè¿‡ä¸€ä¸ªè¶…é“¾æ¥å»ºç«‹å…³ç³»(åœ¨é¦–é¡µä¸Šçš„å¯¼èˆªé“¾æ¥æ¯ä¸ªéƒ½æŒ‡å‘ä¸åŒçš„åº”ç”¨åœ°å€),ä¹Ÿå¯ä»¥é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œæ•°æ®åˆ†å‘,å½“ç„¶æœ€å¤šçš„è¿˜æ˜¯é€šè¿‡è®¿é—®åŒä¸€ä¸ªæ•°æ®å­˜å‚¨ç³»ç»Ÿæ¥æ„æˆä¸€ä¸ªå…³è”çš„å®Œæ•´ç³»ç»Ÿ,å¦‚å›¾æ‰€ç¤ºã€‚ 10 åˆ†å¸ƒå¼æœåŠ¡éšç€ä¸šåŠ¡æ‹†åˆ†è¶Šæ¥è¶Šå°ï¼Œå­˜å‚¨ç³»ç»Ÿè¶Šæ¥è¶Šåºå¤§ï¼Œåº”ç”¨ç³»ç»Ÿçš„æ•´ä½“å¤æ‚åº¦å‘ˆæŒ‡æ•°çº§å¢åŠ ï¼Œéƒ¨ç½²ç»´æŠ¤è¶Šæ¥è¶Šå›°éš¾ã€‚ç”±äºæ‰€æœ‰åº”ç”¨è¦å’Œæ‰€æœ‰æ•°æ®åº“ç³»ç»Ÿè¿æ¥ï¼Œåœ¨æ•°ä¸‡å°æœåŠ¡å™¨è§„æ¨¡çš„ç½‘ç«™ä¸­,è¿™äº›è¿æ¥çš„æ•°ç›®æ˜¯æœåŠ¡å™¨è§„æ¨¡çš„å¹³æ–¹,å¯¼è‡´å­˜æ•°æ®åº“æ¥èµ„æºä¸è¶³,æ‹’ç»æœåŠ¡ã€‚ æ—¢ç„¶æ¯ä¸€ä¸ªåº”ç”¨ç³»ç»Ÿéƒ½éœ€è¦æ‰§è¡Œè®¸å¤šç›¸åŒçš„ä¸šåŠ¡æ“ä½œ,æ¯”å¦‚ç”¨æˆ·ç®¡ç†ã€å•†å“ç®¡ç†ç­‰,é‚£ä¹ˆå¯ä»¥å°†è¿™äº›å…±ç”¨çš„ä¸šåŠ¡æå–å‡ºæ¥,ç‹¬ç«‹éƒ¨ç½²ã€‚ç”±è¿™äº›å¯å¤ç”¨çš„ä¸šåŠ¡è¿æ¥æ•°æ®åº“,æä¾›å…±ç”¨ä¸šåŠ¡æœåŠ¡,è€Œåº”ç”¨ç³»ç»Ÿåªéœ€è¦ç®¡ç†ç”¨æˆ·ç•Œé¢,é€šè¿‡åˆ†å¸ƒå¼æœåŠ¡è°ƒç”¨å…±ç”¨ä¸šåŠ¡æœåŠ¡å®Œæˆå…·ä½“ä¸šåŠ¡æ“ä½œ,å¦‚å›¾æ‰€ç¤ºï¼š","categories":[{"name":"é¡¹ç›®/ç¼–ç¨‹ç†è®º","slug":"é¡¹ç›®-ç¼–ç¨‹ç†è®º","permalink":"https://www.codetool.top/categories/%E9%A1%B9%E7%9B%AE-%E7%BC%96%E7%A8%8B%E7%90%86%E8%AE%BA/"}],"tags":[{"name":"æ¶æ„","slug":"æ¶æ„","permalink":"https://www.codetool.top/tags/%E6%9E%B6%E6%9E%84/"}]},{"title":"å‰‘æŒ‡offer59-é˜Ÿåˆ—çš„æœ€å¤§å€¼","slug":"å‰‘æŒ‡offer59-é˜Ÿåˆ—çš„æœ€å¤§å€¼","date":"2020-03-06T16:53:23.000Z","updated":"2020-03-12T18:35:52.535Z","comments":true,"path":"article/å‰‘æŒ‡offer59-é˜Ÿåˆ—çš„æœ€å¤§å€¼/","link":"","permalink":"https://www.codetool.top/article/%E5%89%91%E6%8C%87offer59-%E9%98%9F%E5%88%97%E7%9A%84%E6%9C%80%E5%A4%A7%E5%80%BC/","excerpt":"","text":"1 åŸé¢˜ï¼ˆæ¥æºLeetcodeï¼‰è¯·å®šä¹‰ä¸€ä¸ªé˜Ÿåˆ—å¹¶å®ç°å‡½æ•° max_value å¾—åˆ°é˜Ÿåˆ—é‡Œçš„æœ€å¤§å€¼ï¼Œè¦æ±‚å‡½æ•°max_valueã€push_back å’Œ pop_front çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ã€‚ è‹¥é˜Ÿåˆ—ä¸ºç©ºï¼Œpop_front å’Œ max_value éœ€è¦è¿”å› -1 ç¤ºä¾‹ 1: è¾“å…¥:[â€œMaxQueueâ€,â€push_backâ€,â€push_backâ€,â€max_valueâ€,â€pop_frontâ€,â€max_valueâ€][[],[1],[2],[],[],[]]è¾“å‡º: [null,null,null,2,1,2] ç¤ºä¾‹ 2: è¾“å…¥:[â€œMaxQueueâ€,â€pop_frontâ€,â€max_valueâ€][[],[],[]]è¾“å‡º: [null,-1,-1] é™åˆ¶ï¼š 1 &lt;= push_back,pop_front,max_valueçš„æ€»æ“ä½œæ•° &lt;= 10000 1 &lt;= value &lt;= 10^5 2 è§£æ³•2.1 æ€æƒ³æˆ‘ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯è¦æ‰‹å†™ä¸ªå †ã€‚ã€‚ã€‚å†™å®Œäº†ä¹‹åå‘ç°è‡ªå·±ç†è§£é”™äº†é¢˜æ„ : ) å°±æ˜¯å¦å¤–ä½¿ç”¨ä¸€ä¸ªåŒå‘é˜Ÿåˆ—ç»´æŠ¤ä¸€ä¸ªå•è°ƒé€’å‡çš„é˜Ÿåˆ—ï¼Œå¦‚æœè¦å¼¹å‡ºçš„å…ƒç´ ä¹Ÿæ˜¯é€’å‡é˜Ÿåˆ—çš„å¤´å…ƒç´ ï¼Œå°±æŠŠå®ƒä¹Ÿå¼¹å‡ºã€‚ 2.2 ä»£ç class MaxQueue { Queue&lt;Integer> queue = new LinkedList&lt;>(); Deque&lt;Integer> deque = new LinkedList&lt;>(); public MaxQueue() {} public int max_value() { if(queue.size() == 0) return -1; return deque.peek(); } public void push_back(int value) { queue.offer(value); while(deque.size()!=0&amp;&amp;deque.peekLast()&lt;value){ deque.pollLast(); } deque.offer(value); } public int pop_front() { if(queue.size() == 0) return -1; int pop = queue.poll(); if(pop == deque.peek()){ deque.poll(); } return pop; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"å‰‘æŒ‡offer","slug":"å‰‘æŒ‡offer","permalink":"https://www.codetool.top/tags/%E5%89%91%E6%8C%87offer/"}]},{"title":"MySQLä¹‹è¡¨é”ã€è¡Œé”ã€MVCCè¯¦è§£","slug":"MySQLä¹‹è¡¨é”ã€è¡Œé”ã€MVCCè¯¦è§£","date":"2020-03-06T14:10:34.000Z","updated":"2020-04-11T15:59:03.849Z","comments":true,"path":"article/MySQLä¹‹è¡¨é”ã€è¡Œé”ã€MVCCè¯¦è§£/","link":"","permalink":"https://www.codetool.top/article/MySQL%E4%B9%8B%E8%A1%A8%E9%94%81%E3%80%81%E8%A1%8C%E9%94%81%E3%80%81MVCC%E8%AF%A6%E8%A7%A3/","excerpt":"","text":"è¯¥æ–‡å»ºè®®é…åˆæ•°æ®åº“ç†è®ºä¹‹å¹¶å‘æ§åˆ¶é˜…è¯»ã€‚ 1 æ¦‚è¿°é”æ˜¯è®¡ç®—æœºåè°ƒå¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹å¹¶å‘è®¿é—®æŸä¸€èµ„æºçš„æœºåˆ¶ï¼ˆé¿å…äº‰æŠ¢ï¼‰ã€‚ åœ¨æ•°æ®åº“ä¸­ï¼Œé™¤ä¼ ç»Ÿçš„è®¡ç®—èµ„æºï¼ˆå¦‚ CPUã€RAMã€I/O ç­‰ï¼‰çš„äº‰ç”¨ä»¥å¤–ï¼Œæ•°æ®ä¹Ÿæ˜¯ä¸€ç§ä¾›è®¸å¤šç”¨æˆ·å…±äº«çš„èµ„æºã€‚å¦‚ä½•ä¿è¯æ•°æ®å¹¶å‘è®¿é—®çš„ä¸€è‡´æ€§ã€æœ‰æ•ˆæ€§æ˜¯æ‰€æœ‰æ•°æ®åº“å¿…é¡»è§£å†³çš„ä¸€ä¸ªé—®é¢˜ï¼Œé”å†²çªä¹Ÿæ˜¯å½±å“æ•°æ®åº“å¹¶å‘è®¿é—®æ€§èƒ½çš„ä¸€ä¸ªé‡è¦å› ç´ ã€‚ä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼Œé”å¯¹æ•°æ®åº“è€Œè¨€æ˜¾å¾—å°¤å…¶é‡è¦ï¼Œä¹Ÿæ›´åŠ å¤æ‚ã€‚ 1.1 é”åˆ†ç±»ä»å¯¹æ•°æ®æ“ä½œçš„ç²’åº¦åˆ† ï¼š è¡¨é”ï¼šæ“ä½œæ—¶ï¼Œä¼šé”å®šæ•´ä¸ªè¡¨ã€‚ è¡Œé”ï¼šæ“ä½œæ—¶ï¼Œä¼šé”å®šå½“å‰æ“ä½œè¡Œã€‚ ä»å¯¹æ•°æ®æ“ä½œçš„ç±»å‹åˆ†ï¼š è¯»é”ï¼ˆå…±äº«é”ï¼‰ï¼šé’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªè¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ã€‚ å†™é”ï¼ˆæ’å®ƒé”ï¼‰ï¼šå½“å‰æ“ä½œæ²¡æœ‰å®Œæˆä¹‹å‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚ 1.2 MySQLä¸­çš„é”ç›¸å¯¹å…¶ä»–æ•°æ®åº“è€Œè¨€ï¼ŒMySQLçš„é”æœºåˆ¶æ¯”è¾ƒç®€å•ï¼Œå…¶æœ€æ˜¾è‘—çš„ç‰¹ç‚¹æ˜¯ä¸åŒçš„å­˜å‚¨å¼•æ“æ”¯æŒä¸åŒçš„é”æœºåˆ¶ã€‚ä¸‹è¡¨ä¸­ç½—åˆ—å‡ºäº†å„å­˜å‚¨å¼•æ“å¯¹é”çš„æ”¯æŒæƒ…å†µï¼š å­˜å‚¨å¼•æ“ è¡¨çº§é” è¡Œçº§é” é¡µé¢é” MyISAM æ”¯æŒ ä¸æ”¯æŒ ä¸æ”¯æŒ InnoDB æ”¯æŒ æ”¯æŒ ä¸æ”¯æŒ MEMORY æ”¯æŒ ä¸æ”¯æŒ ä¸æ”¯æŒ BDB æ”¯æŒ ä¸æ”¯æŒ æ”¯æŒ MySQLè¿™3ç§é”çš„ç‰¹æ€§å¯å¤§è‡´å½’çº³å¦‚ä¸‹ ï¼š é”ç±»å‹ ç‰¹ç‚¹ è¡¨çº§é” åå‘MyISAM å­˜å‚¨å¼•æ“ï¼Œå¼€é”€å°ï¼ŒåŠ é”å¿«ï¼›ä¸ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦å¤§ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€é«˜,å¹¶å‘åº¦æœ€ä½ã€‚ è¡Œçº§é” åå‘InnoDB å­˜å‚¨å¼•æ“ï¼Œå¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€ä½,å¹¶å‘åº¦ä¹Ÿæœ€é«˜ã€‚ é¡µé¢é” å¼€é”€å’ŒåŠ é”æ—¶é—´ç•Œäºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦ç•Œäºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œå¹¶å‘åº¦ä¸€èˆ¬ã€‚ ä»ä¸Šè¿°ç‰¹ç‚¹å¯è§ï¼Œå¾ˆéš¾ç¬¼ç»Ÿåœ°è¯´å“ªç§é”æ›´å¥½ï¼Œåªèƒ½å°±å…·ä½“åº”ç”¨çš„ç‰¹ç‚¹æ¥è¯´å“ªç§é”æ›´åˆé€‚ã€‚ ä»…ä»é”çš„è§’åº¦æ¥è¯´ï¼š è¡¨çº§é”æ›´é€‚åˆäºä»¥æŸ¥è¯¢ä¸ºä¸»ï¼Œåªæœ‰å°‘é‡æŒ‰ç´¢å¼•æ¡ä»¶æ›´æ–°æ•°æ®çš„åº”ç”¨ï¼Œå¦‚Web åº”ç”¨ è¡Œçº§é”åˆ™æ›´é€‚åˆäºæœ‰å¤§é‡æŒ‰ç´¢å¼•æ¡ä»¶å¹¶å‘æ›´æ–°å°‘é‡ä¸åŒæ•°æ®ï¼ŒåŒæ—¶åˆæœ‰å¹¶æŸ¥è¯¢çš„åº”ç”¨ï¼Œå¦‚ä¸€äº›åœ¨çº¿äº‹åŠ¡å¤„ç†ï¼ˆOLTPï¼‰ç³»ç»Ÿã€‚ æ‰€æœ‰çš„å­˜å‚¨å¼•æ“éƒ½ä»¥è‡ªå·±çš„æ–¹å¼å®ç°äº†é”æœºåˆ¶ï¼ŒæœåŠ¡å™¨å±‚å®Œå…¨ä¸äº†è§£å­˜å‚¨å¼•æ“ä¸­çš„é”å®ç°ã€‚ä½†æœåŠ¡å™¨å±‚ä¹Ÿä¼šä½¿ç”¨å„ç§æœ‰æ•ˆçš„è¡¨é”æ¥å®ç°ä¸åŒçš„ç›®çš„ã€‚ å¯¹äº MySQL è€Œè¨€ï¼Œäº‹åŠ¡æœºåˆ¶æ›´å¤šæ˜¯é åº•å±‚çš„å­˜å‚¨å¼•æ“å®ç°çš„ï¼Œåœ¨æœåŠ¡å™¨å±‚é¢åªæœ‰è¡¨é”ã€‚æ”¯æŒäº‹åŠ¡çš„ InnoDB å­˜å‚¨å¼•æ“å®ç°äº†è¡Œé”ã€‚ 2 MyISAM è¡¨é”åå‘ MyISAM å­˜å‚¨å¼•æ“ï¼Œå¼€é”€å°ï¼ŒåŠ é”å¿«ï¼Œæ— æ­»é”ï¼›é”å®šç²’åº¦å¤§ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œå¹¶å‘åº¦æœ€ä½ã€‚ åœ¨ç‰¹å®šçš„åœºæ™¯ä¸­ï¼Œè¡¨é”ä¹Ÿå¯èƒ½æœ‰è‰¯å¥½çš„æ€§èƒ½ã€‚æ¯”å¦‚ï¼ŒREAD LOCAL è¡¨é”æ”¯æŒæŸäº›ç±»å‹çš„å¹¶å‘å†™æ“ä½œï¼›å¦å¤–ï¼Œå†™é”ä¹Ÿæ¯”è¯»é”æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œå› æ­¤ä¸€ä¸ªå†™é”è¯·æ±‚å¯ä»¥ä¼šè¢«æ’å…¥åˆ°è¯»é”é˜Ÿåˆ—çš„å‰é¢ã€‚ å°½ç®¡å­˜å‚¨å¼•æ“å¯ä»¥ç®¡ç†è‡ªå·±çš„é”ï¼ŒæœåŠ¡å™¨è¿˜æ˜¯ä¼šä½¿ç”¨å„ç§æœ‰æ•ˆçš„è¡¨é”æ¥å®ç°ä¸åŒçš„ç›®çš„ã€‚æ¯”å¦‚æœåŠ¡å™¨åœ¨ ALTER TABLE æ—¶ä½¿ç”¨è¡¨é”ï¼Œè€Œå¿½ç•¥å­˜å‚¨å¼•æ“çš„é”æœºåˆ¶ã€‚MyISAM åœ¨è¯»è¡¨å‰è‡ªåŠ¨å¯¹è¡¨åŠ è¯»é”ï¼Œåœ¨å†™è¡¨å‰è‡ªåŠ¨å¯¹è¡¨åŠ å†™é”ã€‚ 2.1 SQLè¯­æ³•æ·»åŠ è¡¨é”ï¼š lock table table1 read/write , table2 read/write ,... readä¸ºè¯»é”ï¼Œå…±äº«é”ï¼›writeä¸ºå†™é”ï¼Œç‹¬å é”ã€‚ æ˜¾ç¤ºåŠ è¿‡é”çš„è¡¨ï¼š show open tables; In_use : è¡¨å½“å‰è¢«æŸ¥è¯¢ä½¿ç”¨çš„æ¬¡æ•°ã€‚å¦‚æœè¯¥æ•°ä¸ºé›¶ï¼Œåˆ™è¡¨æ˜¯æ‰“å¼€çš„ï¼Œä½†æ˜¯å½“å‰æ²¡æœ‰è¢«ä½¿ç”¨ã€‚ä¸º1ä»£è¡¨å·²åŠ é”ã€‚ Name_lockedï¼šè¡¨åç§°æ˜¯å¦è¢«é”å®šã€‚åç§°é”å®šç”¨äºå–æ¶ˆè¡¨æˆ–å¯¹è¡¨è¿›è¡Œé‡å‘½åç­‰æ“ä½œã€‚ é‡Šæ”¾è¡¨é”ï¼š unlock tables; 2.2 æ€»ç»“ å¯¹ MyISAM è¡¨çš„è¯»æ“ä½œï¼ˆåŠ è¯»é”ï¼‰ï¼Œä¸ä¼šé˜»å¡å…¶ä»–è¿›ç¨‹å¯¹åŒä¸€è¡¨çš„è¯»è¯·æ±‚ï¼Œä½†ä¼šé˜»å¡å¯¹åŒä¸€è¡¨çš„å†™è¯·æ±‚ã€‚åªæœ‰å½“è¯»é”é‡Šæ”¾åï¼Œæ‰ä¼šæ‰§è¡Œå…¶å®ƒè¿›ç¨‹çš„å†™æ“ä½œã€‚ å¯¹ MyISAM è¡¨çš„å†™æ“ä½œï¼ˆåŠ å†™é”ï¼‰ï¼Œä¼šé˜»å¡å…¶ä»–è¿›ç¨‹å¯¹åŒä¸€è¡¨çš„è¯»å’Œå†™æ“ä½œï¼Œåªæœ‰å½“å†™é”é‡Šæ”¾åï¼Œæ‰ä¼šæ‰§è¡Œå…¶å®ƒè¿›ç¨‹çš„è¯»å†™æ“ä½œã€‚ ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯è¯»é”ä¼šé˜»å¡å†™ï¼Œä½†æ˜¯ä¸ä¼šå µå¡è¯»ã€‚è€Œå†™é”åˆ™ä¼šæŠŠè¯»å’Œå†™éƒ½å µå¡ã€‚è¿™ä¹Ÿæ˜¯MyISAMä¸é€‚åˆåšå†™ä¸ºä¸»è¡¨çš„å¼•æ“çš„åŸå› ã€‚å› ä¸ºå†™é”åï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½åšä»»ä½•æ“ä½œï¼Œå¤§é‡çš„æ›´æ–°ä¼šä½¿æŸ¥è¯¢å¾ˆéš¾å¾—åˆ°é”ï¼Œä»è€Œé€ æˆæ°¸è¿œé˜»å¡ã€‚ 3 InnoDB è¡Œé”ç‰¹ç‚¹ï¼š é”ç²’åº¦å°ï¼Œå¹¶å‘åº¦é«˜ï¼›å¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼Œä¼šå‡ºç°æ­»é” æ”¯æŒäº‹åŠ¡ InnoDBä¹Ÿå®ç°äº†å…±äº«é”å’Œæ’ä»–é”ä¸¤ç§ç±»å‹çš„è¡Œé”ã€‚ InnoDBä¹Ÿæ”¯æŒæ„å‘é”ï¼Œå¯ä»¥å¯¹è¡¨çº§åˆ«ä¸Šæ„å‘é”ã€‚ å¯¹äºUPDATEã€DELETEå’ŒINSERTè¯­å¥ï¼ŒInnoDBä¼šè‡ªåŠ¨ç»™æ¶‰åŠçš„æ•°æ®é›†åŠ æ’ä»–é” å¯¹äºæ™®é€šSELECTè¯­å¥ï¼ŒInnoDBä¸ä¼šåŠ ä»»ä½•é”ï¼Œä½¿ç”¨ä¸€è‡´æ€§éé”å®šè¯» 3.1 äº†è§£ï¼šä¸€è‡´æ€§éé”å®šè¯»ä¸€è‡´æ€§éé”å®šè¯»æ˜¯æŒ‡InnoDBå­˜å‚¨å¼•æ“é€šè¿‡è¡Œå¤šç‰ˆæœ¬æ§åˆ¶ï¼ˆMVCCï¼‰çš„æ–¹å¼æ¥è¯»å–å½“å‰æ‰§è¡Œæ—¶é—´æ•°æ®åº“ä¸­è¡Œçš„æ•°æ®ã€‚å¦‚æœè¯»å–çš„è¡Œæ­£åœ¨æ‰§è¡ŒDELETEæˆ–UPDATEï¼Œè¿™æ—¶è¯»å–æ“ä½œä¸ä¼šå› æ­¤å»ç­‰å¾…è¡Œä¸Šé”çš„é‡Šæ”¾ï¼Œè€Œæ˜¯å»è¯»å–è¡Œçš„ä¸€ä¸ªå¿«ç…§æ•°æ®ã€‚ å¿«ç…§æ•°æ®æ˜¯è¯¥è¡Œçš„ä¹‹å‰ç‰ˆæœ¬çš„æ•°æ®ï¼Œå®ç°æ˜¯é€šè¿‡undoæ®µæ¥å®Œæˆï¼ˆå³ä¸ºäº†å›æ»šäº‹åŠ¡è€Œäº§ç”Ÿçš„é‡åšæ—¥å¿—ï¼‰ã€‚ é€šè¿‡è¯»å–ä¸åŒçš„å¿«ç…§ç‰ˆæœ¬å®ç°ä¸åŒçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š è¯»å·²æäº¤ï¼šä¸€è‡´æ€§éé”å®šè¯»æ€»æ˜¯è¯»å–è¢«é”å®šè¡Œçš„æœ€æ–°ä¸€ä»½å¿«ç…§æ•°æ®ã€‚äº§ç”Ÿäº†ä¸å¯é‡å¤è¯»çš„é—®é¢˜ã€‚ é‡å¤è¯»ï¼šä¸€è‡´æ€§éé”å®šè¯»æ€»æ˜¯è¯»å–äº‹åŠ¡å¼€å§‹æ—¶çš„è¡Œæ•°æ®ç‰ˆæœ¬. è§£å†³ä¸å¯é‡å¤è¯»çš„é—®é¢˜ã€‚ ä¸€è‡´æ€§éé”å®šè¯»æ˜¯InnoDBé»˜è®¤çš„è¯»å–æ–¹å¼ï¼Œä¸ä¼šå ç”¨å’Œç­‰å¾…è¡¨ä¸Šçš„é”ã€‚ 3.2 ä¸€è‡´æ€§é”å®šè¯»æŸäº›æƒ…å†µä¸‹ï¼Œç”¨æˆ·éœ€è¦æ˜¾å¼åœ°å¯¹æ•°æ®åº“è¯»å–æ“ä½œè¿›è¡ŒåŠ é”ä»¥ä¿è¯æ•°æ®é€»è¾‘çš„ä¸€è‡´æ€§ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹è¯­å¥æ˜¾ç¤ºç»™è®°å½•é›†åŠ å…±äº«é”æˆ–æ’ä»–é”ï¼ˆä¸€è‡´æ€§é”å®šè¯»ï¼‰ã€‚ å…±äº«é”ï¼ˆSï¼‰ï¼š SELECT * FROM table_name WHERE ... LOCK IN SHARE MODE æ’ä»–é”ï¼ˆX) ï¼š SELECT * FROM table_name WHERE ... FOR UPDATE å½“äº‹åŠ¡æäº¤äº†ï¼Œé”å°±é‡Šæ”¾äº†ã€‚ å¯ä»¥ä½¿ç”¨show status like &#39;innodb_row_lock%&#39;;æŸ¥çœ‹innodbè¡Œé”çš„äº‰ç”¨æƒ…å†µ Innodb_row_lock_current_waits: å½“å‰æ­£åœ¨ç­‰å¾…é”å®šçš„æ•°é‡ Innodb_row_lock_time: ä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨é”å®šæ€»æ—¶é—´é•¿åº¦ Innodb_row_lock_time_avg:æ¯æ¬¡ç­‰å¾…æ‰€èŠ±å¹³å‡æ—¶é•¿ Innodb_row_lock_time_max:ä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨ç­‰å¾…æœ€é•¿çš„ä¸€æ¬¡æ‰€èŠ±çš„æ—¶é—´ Innodb_row_lock_waits: ç³»ç»Ÿå¯åŠ¨ååˆ°ç°åœ¨æ€»å…±ç­‰å¾…çš„æ¬¡æ•° 3.3 è¡Œé”çš„ä¸‰ç§ç®—æ³•3.3.1 record lockInnoDB é‡Œçš„è¡Œé”ï¼ˆrecord lockï¼‰æ˜¯ç´¢å¼•è®°å½•çš„é”ã€‚ record lock é”ä½çš„æ˜¯ç´¢å¼•è®°å½•ï¼Œå³ä½¿è¯¥è¡¨ä¸Šæ²¡æœ‰ä»»ä½•ç´¢å¼•ï¼Œé‚£ä¹ˆ innodbä¼šåœ¨åå°åˆ›å»ºä¸€ä¸ªéšè—çš„èšé›†ä¸»é”®ç´¢å¼•ï¼Œé‚£ä¹ˆé”ä½çš„å°±æ˜¯è¿™ä¸ªéšè—çš„èšé›†ä¸»é”®ç´¢å¼•ã€‚æ‰€ä»¥è¯´å½“ä¸€æ¡ sql æ²¡æœ‰èµ°ä»»ä½•ç´¢å¼•æ—¶ï¼Œé‚£ä¹ˆå°†ä¼šåœ¨æ¯ä¸€æ¡èšç°‡ç´¢å¼•åé¢åŠ  X é”ï¼Œè¿™ä¸ªç±»ä¼¼äºè¡¨é”ï¼Œä½†åŸç†ä¸Šå’Œè¡¨é”åº”è¯¥æ˜¯å®Œå…¨ä¸åŒçš„ã€‚ 3.3.2 gap lockå½“æˆ‘ä»¬ç”¨èŒƒå›´æ¡ä»¶ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç›¸ç­‰æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œå¹¶è¯·æ±‚å…±äº«æˆ–æ’ä»–é”æ—¶ï¼ŒInnoDBä¼šç»™ç¬¦åˆæ¡ä»¶çš„å·²æœ‰æ•°æ®è¿›è¡ŒåŠ é”ï¼› å¯¹äºé”®å€¼åœ¨æ¡ä»¶èŒƒå›´å†…ä½†å¹¶ä¸å­˜åœ¨çš„è®°å½•ï¼Œå«åš â€œé—´éš™ï¼ˆGAPï¼‰â€ï¼ŒInnoDBä¹Ÿä¼šå¯¹è¿™ä¸ª â€œé—´éš™â€ åŠ é”ï¼Œè¿™ç§é”æœºåˆ¶å°±æ˜¯æ‰€è°“çš„é—´éš™é”ï¼ˆgap lockï¼‰ï¼Œå®ƒé”å®šä¸€ä¸ªèŒƒå›´çš„è®°å½•,ä½†ä¸åŒ…æ‹¬è®°å½•æœ¬èº«ã€‚é”åŠ åœ¨æœªä½¿ç”¨çš„ç©ºé—²ç©ºé—´ä¸Š,å¯èƒ½æ˜¯ä¸¤ä¸ªç´¢å¼•è®°å½•ä¹‹é—´ï¼Œä¹Ÿå¯èƒ½æ˜¯ç¬¬ä¸€ä¸ªç´¢å¼•è®°å½•ä¹‹å‰æˆ–æœ€åä¸€ä¸ªç´¢å¼•ä¹‹åçš„ç©ºé—´ã€‚é—´éš™é”é’ˆå¯¹äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»æˆ–ä»¥ä¸Šçº§åˆ«ã€‚ 3.3.3 next-key lockè¡Œé”ä¸é—´éš™é”ç»„åˆèµ·æ¥ç”¨å°±å«åš Next-Key Lockã€‚é”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«ã€‚å¯¹äºè¡Œçš„æŸ¥è¯¢ï¼Œéƒ½æ˜¯é‡‡ç”¨è¯¥æ–¹æ³•ï¼Œä¸»è¦ç›®çš„æ˜¯é˜»æ­¢å¤šä¸ªäº‹åŠ¡å°†è®°å½•æ’å…¥åˆ°åŒä¸€èŒƒå›´å†…ï¼Œè§£å†³å¹»è¯»çš„é—®é¢˜ã€‚ InnoDB å·¥ä½œåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¹¶ä¸”ä¼šä»¥ Next-Key Lock çš„æ–¹å¼å¯¹æ•°æ®è¡Œè¿›è¡ŒåŠ é”ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆé˜²æ­¢å¹»è¯»çš„å‘ç”Ÿã€‚Next-Key Lock æ˜¯è¡Œé”å’Œé—´éš™é”çš„ç»„åˆï¼Œå½“ InnoDB æ‰«æç´¢å¼•è®°å½•çš„æ—¶å€™ï¼Œä¼šé¦–å…ˆå¯¹ç´¢å¼•è®°å½•åŠ ä¸Šè¡Œé”ï¼ˆRecord Lockï¼‰ï¼Œå†å¯¹ç´¢å¼•è®°å½•ä¸¤è¾¹çš„é—´éš™åŠ ä¸Šé—´éš™é”ï¼ˆGap Lockï¼‰ã€‚åŠ ä¸Šé—´éš™é”ä¹‹åï¼Œå…¶ä»–äº‹åŠ¡å°±ä¸èƒ½åœ¨è¿™ä¸ªé—´éš™ä¿®æ”¹æˆ–è€…æ’å…¥è®°å½•ã€‚ å¦‚æœä¸€ä¸ªç´¢å¼•æœ‰10ï¼Œ11ï¼Œ13å’Œ20è¿™å››ä¸ªå€¼ï¼Œé‚£ä¹ˆè¯¥ç´¢å¼•å¯èƒ½è¢«Next-key Lockingçš„åŒºé—´ä¸ºï¼š (-âˆ,10] (10,11] (11,13] (13,20] (20,ï¼‹âˆ]è‹¥äº‹åŠ¡T1å·²ç»é”å®šäº†å¦‚ä¸‹èŒƒå›´ï¼š (10,11]ï¼Œ(11,13] åˆ™æ’å…¥æ–°çš„è®°å½•12æ—¶ï¼Œé”å®šçš„èŒƒå›´ä¼šå˜æˆï¼š (10,11]ï¼Œ(11,12]ï¼Œ(12,13] å½“æŸ¥è¯¢çš„ç´¢å¼•å«æœ‰å”¯ä¸€å±æ€§æ—¶ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä¼šå¯¹Next-key Lockè¿›è¡Œä¼˜åŒ–ï¼Œå°†å…¶é™çº§ä¸ºRecord lockï¼Œå³ä»…é”ä½ç´¢å¼•æœ¬èº«ï¼Œè€Œä¸æ˜¯èŒƒå›´ã€‚ 3.3.4 å¦‚ä½•ç†è§£ä¸‰ç§ç®—æ³•æˆ‘è¿™é‡Œè°ˆè°ˆæˆ‘è‡ªå·±çš„ç†è§£ï¼š å¯¹äºå”¯ä¸€ç´¢å¼•ï¼ˆæ¯”å¦‚ä¸»é”®ï¼‰ï¼Œåªè¦ä¿è¯é”ä½è¯¥ç´¢å¼•è®°å½•ï¼Œå°±ä¸å¯èƒ½å‡ºç°å¹»è¯»ï¼Œè¿™å¯¹åº”çš„å°±æ˜¯Record Lock æ¯”å¦‚å¯¹äºsqlæŸ¥è¯¢ select * from t_user where id = 5 for update; è¿™ç§æƒ…å†µå°±åªä¼šåŠ ä¸€ä¸ªRecord Lockï¼Œç¬¬ä¸€æ¬¡æŸ¥è¯¢æ•°æ®ä¹‹åé”ä½äº†è¯¥è®°å½•ï¼Œæ­¤ååœ¨åŒä¸€äº‹åŠ¡å†…ä¸€ç›´åˆ°ç¬¬äºŒæ¬¡æŸ¥è¯¢ä¸å¯èƒ½ä¼šå‡ºç°å…¶ä»–äº‹åŠ¡ä¹Ÿå°†å…¶ä»–è®°å½•æ’å…¥åˆ°id = 5è¿™ä¸ªä½ç½®ã€‚ è€Œå¦‚æœä¸æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œç¬¬ä¸€æ¬¡æŸ¥è¯¢æ•°æ®ä¹‹åå³ä½¿æ‰€ä½äº†è¯¥è®°å½•ï¼Œä½†å¯èƒ½è¿˜ä¼šæœ‰è®°å½•è¢«æ’åˆ°id = 5è¿™ä¸ªä½ç½®ï¼Œæ‰€ä»¥æ­¤æ—¶éœ€è¦èŒƒå›´ç´¢å¼•ï¼Œé”ä½ç´¢å¼•ä¸º5è¿™ä¸ªå€¼ï¼Œå¯¹äºèŒƒå›´æŸ¥è¯¢ï¼ŒèŒƒå›´ç´¢å¼•æ›´é‡è¦ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"MySQL","slug":"MySQL","permalink":"https://www.codetool.top/tags/MySQL/"}]},{"title":"MySQLä¹‹å¹¶å‘å‚æ•°è°ƒæ•´","slug":"MySQLä¹‹å¹¶å‘å‚æ•°è°ƒæ•´","date":"2020-03-06T08:56:08.000Z","updated":"2020-03-06T09:23:45.404Z","comments":true,"path":"article/MySQLä¹‹å¹¶å‘å‚æ•°è°ƒæ•´/","link":"","permalink":"https://www.codetool.top/article/MySQL%E4%B9%8B%E5%B9%B6%E5%8F%91%E5%8F%82%E6%95%B0%E8%B0%83%E6%95%B4/","excerpt":"","text":"ä»å®ç°ä¸Šæ¥è¯´ï¼ŒMySQL Server æ˜¯å¤šçº¿ç¨‹ç»“æ„ï¼ŒåŒ…æ‹¬åå°çº¿ç¨‹å’Œå®¢æˆ·æœåŠ¡çº¿ç¨‹ã€‚å¤šçº¿ç¨‹å¯ä»¥æœ‰æ•ˆåˆ©ç”¨æœåŠ¡å™¨èµ„æºï¼Œæé«˜æ•°æ®åº“çš„å¹¶å‘æ€§èƒ½ã€‚åœ¨Mysqlä¸­ï¼Œæ§åˆ¶å¹¶å‘è¿æ¥å’Œçº¿ç¨‹çš„ä¸»è¦å‚æ•°åŒ…æ‹¬ max_connectionsã€back_logã€thread_cache_sizeã€table_open_cahceã€‚ 1 max_connectionsé‡‡ç”¨max_connections æ§åˆ¶å…è®¸è¿æ¥åˆ°MySQLæ•°æ®åº“çš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤å€¼æ˜¯ 151ã€‚å¦‚æœçŠ¶æ€å˜é‡ connection_errors_max_connections ä¸ä¸ºé›¶ï¼Œå¹¶ä¸”ä¸€ç›´å¢é•¿ï¼Œåˆ™è¯´æ˜ä¸æ–­æœ‰è¿æ¥è¯·æ±‚å› æ•°æ®åº“è¿æ¥æ•°å·²è¾¾åˆ°å…è®¸æœ€å¤§å€¼è€Œå¤±è´¥ï¼Œè¿™æ—¶å¯ä»¥è€ƒè™‘å¢å¤§max_connections çš„å€¼ã€‚ Mysql æœ€å¤§å¯æ”¯æŒçš„è¿æ¥æ•°ï¼Œå–å†³äºå¾ˆå¤šå› ç´ ï¼ŒåŒ…æ‹¬ç»™å®šæ“ä½œç³»ç»Ÿå¹³å°çš„çº¿ç¨‹åº“çš„è´¨é‡ã€å†…å­˜å¤§å°ã€æ¯ä¸ªè¿æ¥çš„è´Ÿè·ã€CPUçš„å¤„ç†é€Ÿåº¦ï¼ŒæœŸæœ›çš„å“åº”æ—¶é—´ç­‰ã€‚åœ¨Linux å¹³å°ä¸‹ï¼Œæ€§èƒ½å¥½çš„æœåŠ¡å™¨ï¼Œæ”¯æŒ 500-1000 ä¸ªè¿æ¥ä¸æ˜¯éš¾äº‹ï¼Œéœ€è¦æ ¹æ®æœåŠ¡å™¨æ€§èƒ½è¿›è¡Œè¯„ä¼°è®¾å®šã€‚ 2 back_logback_log å‚æ•°æ§åˆ¶MySQLç›‘å¬TCPç«¯å£æ—¶è®¾ç½®çš„ç§¯å‹è¯·æ±‚æ ˆå¤§å°ã€‚å¦‚æœMySqlçš„è¿æ¥æ•°è¾¾åˆ°max_connectionsæ—¶ï¼Œæ–°æ¥çš„è¯·æ±‚å°†ä¼šè¢«å­˜åœ¨å †æ ˆä¸­ï¼Œä»¥ç­‰å¾…æŸä¸€è¿æ¥é‡Šæ”¾èµ„æºï¼Œè¯¥å †æ ˆçš„æ•°é‡å³back_logï¼Œå¦‚æœç­‰å¾…è¿æ¥çš„æ•°é‡è¶…è¿‡back_logï¼Œå°†ä¸è¢«æˆäºˆè¿æ¥èµ„æºï¼Œå°†ä¼šæŠ¥é”™ã€‚5.6.6 ç‰ˆæœ¬ä¹‹å‰é»˜è®¤å€¼ä¸º 50 ï¼Œ ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤ä¸º 50 + ï¼ˆmax_connections / 5ï¼‰ï¼Œ ä½†æœ€å¤§ä¸è¶…è¿‡900ã€‚ å¦‚æœéœ€è¦æ•°æ®åº“åœ¨è¾ƒçŸ­çš„æ—¶é—´å†…å¤„ç†å¤§é‡è¿æ¥è¯·æ±‚ï¼Œ å¯ä»¥è€ƒè™‘é€‚å½“å¢å¤§back_log çš„å€¼ã€‚ 3 table_open_cacheè¯¥å‚æ•°ç”¨æ¥æ§åˆ¶æ‰€æœ‰SQLè¯­å¥æ‰§è¡Œçº¿ç¨‹å¯æ‰“å¼€è¡¨ç¼“å­˜çš„æ•°é‡ï¼Œ è€Œåœ¨æ‰§è¡ŒSQLè¯­å¥æ—¶ï¼Œæ¯ä¸€ä¸ªSQLæ‰§è¡Œçº¿ç¨‹è‡³å°‘è¦æ‰“å¼€ 1 ä¸ªè¡¨ç¼“å­˜ã€‚è¯¥å‚æ•°çš„å€¼åº”è¯¥æ ¹æ®è®¾ç½®çš„æœ€å¤§è¿æ¥æ•° max_connections ä»¥åŠæ¯ä¸ªè¿æ¥æ‰§è¡Œå…³è”æŸ¥è¯¢ä¸­æ¶‰åŠçš„è¡¨çš„æœ€å¤§æ•°é‡æ¥è®¾å®š ï¼š â€‹max_connections x N 4 thread_cache_sizeä¸ºäº†åŠ å¿«è¿æ¥æ•°æ®åº“çš„é€Ÿåº¦ï¼ŒMySQL ä¼šç¼“å­˜ä¸€å®šæ•°é‡çš„å®¢æˆ·æœåŠ¡çº¿ç¨‹ä»¥å¤‡é‡ç”¨ï¼Œé€šè¿‡å‚æ•° thread_cache_size å¯æ§åˆ¶ MySQL ç¼“å­˜å®¢æˆ·æœåŠ¡çº¿ç¨‹çš„æ•°é‡ã€‚ 5 innodb_lock_wait_timeoutè¯¥å‚æ•°æ˜¯ç”¨æ¥è®¾ç½®InnoDB äº‹åŠ¡ç­‰å¾…è¡Œé”çš„æ—¶é—´ï¼Œé»˜è®¤å€¼æ˜¯50ms ï¼Œ å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡ŒåŠ¨æ€è®¾ç½®ã€‚å¯¹äºéœ€è¦å¿«é€Ÿåé¦ˆçš„ä¸šåŠ¡ç³»ç»Ÿæ¥è¯´ï¼Œå¯ä»¥å°†è¡Œé”çš„ç­‰å¾…æ—¶é—´è°ƒå°ï¼Œä»¥é¿å…äº‹åŠ¡é•¿æ—¶é—´æŒ‚èµ·ï¼› å¯¹äºåå°è¿è¡Œçš„æ‰¹é‡å¤„ç†ç¨‹åºæ¥è¯´ï¼Œ å¯ä»¥å°†è¡Œé”çš„ç­‰å¾…æ—¶é—´è°ƒå¤§ï¼Œ ä»¥é¿å…å‘ç”Ÿå¤§çš„å›æ»šæ“ä½œã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"ä¼˜åŒ–","slug":"ä¼˜åŒ–","permalink":"https://www.codetool.top/tags/%E4%BC%98%E5%8C%96/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"MySQL","slug":"MySQL","permalink":"https://www.codetool.top/tags/MySQL/"}]},{"title":"MySQLä¹‹å†…å­˜ç®¡ç†å’Œä¼˜åŒ–","slug":"MySQLä¹‹å†…å­˜ç®¡ç†å’Œä¼˜åŒ–","date":"2020-03-06T08:55:28.000Z","updated":"2020-03-06T09:26:59.592Z","comments":true,"path":"article/MySQLä¹‹å†…å­˜ç®¡ç†å’Œä¼˜åŒ–/","link":"","permalink":"https://www.codetool.top/article/MySQL%E4%B9%8B%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E5%92%8C%E4%BC%98%E5%8C%96/","excerpt":"","text":"1 å†…å­˜ä¼˜åŒ–åŸåˆ™ å°†å°½é‡å¤šçš„å†…å­˜åˆ†é…ç»™MySQLåšç¼“å­˜ï¼Œä½†è¦ç»™æ“ä½œç³»ç»Ÿå’Œå…¶ä»–ç¨‹åºé¢„ç•™è¶³å¤Ÿå†…å­˜ã€‚ MyISAM å­˜å‚¨å¼•æ“çš„æ•°æ®æ–‡ä»¶è¯»å–ä¾èµ–äºæ“ä½œç³»ç»Ÿè‡ªèº«çš„IOç¼“å­˜ï¼Œå› æ­¤ï¼Œå¦‚æœæœ‰MyISAMè¡¨ï¼Œå°±è¦é¢„ç•™æ›´å¤šçš„å†…å­˜ç»™æ“ä½œç³»ç»ŸåšIOç¼“å­˜ã€‚ æ’åºåŒºã€è¿æ¥åŒºç­‰ç¼“å­˜æ˜¯åˆ†é…ç»™æ¯ä¸ªæ•°æ®åº“ä¼šè¯ï¼ˆsessionï¼‰ä¸“ç”¨çš„ï¼Œå…¶é»˜è®¤å€¼çš„è®¾ç½®è¦æ ¹æ®æœ€å¤§è¿æ¥æ•°åˆç†åˆ†é…ï¼Œå¦‚æœè®¾ç½®å¤ªå¤§ï¼Œä¸ä½†æµªè´¹èµ„æºï¼Œè€Œä¸”åœ¨å¹¶å‘è¿æ¥è¾ƒé«˜æ—¶ä¼šå¯¼è‡´ç‰©ç†å†…å­˜è€—å°½ã€‚ 2 MyISAM å†…å­˜ä¼˜åŒ–MyISAMå­˜å‚¨å¼•æ“ä½¿ç”¨ key_buffer ç¼“å­˜ç´¢å¼•å—ï¼ŒåŠ é€ŸMyISAMç´¢å¼•çš„è¯»å†™é€Ÿåº¦ã€‚å¯¹äºMyISAMè¡¨çš„æ•°æ®å—ï¼Œmysqlæ²¡æœ‰ç‰¹åˆ«çš„ç¼“å­˜æœºåˆ¶ï¼Œå®Œå…¨ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„IOç¼“å­˜ã€‚ 2.1 key_buffer_sizekey_buffer_sizeå†³å®šMyISAMç´¢å¼•å—ç¼“å­˜åŒºçš„å¤§å°ï¼Œç›´æ¥å½±å“åˆ°MyISAMè¡¨çš„å­˜å–æ•ˆç‡ã€‚å¯ä»¥åœ¨MySQLå‚æ•°æ–‡ä»¶ä¸­è®¾ç½®key_buffer_sizeçš„å€¼ï¼Œå¯¹äºä¸€èˆ¬MyISAMæ•°æ®åº“ï¼Œå»ºè®®è‡³å°‘å°†1/4å¯ç”¨å†…å­˜åˆ†é…ç»™key_buffer_sizeã€‚ åœ¨é…ç½®æ–‡ä»¶ä¸­åšå¦‚ä¸‹é…ç½®ï¼š key_buffer_size=512M2.2 read_buffer_sizeä¸ºéœ€è¦å…¨è¡¨æ‰«æçš„MYISAMæ•°æ®è¡¨çº¿ç¨‹æŒ‡å®šç¼“å­˜ã€‚ å¦‚æœéœ€è¦ç»å¸¸é¡ºåºæ‰«æMyISAMè¡¨ï¼Œå¯ä»¥é€šè¿‡å¢å¤§read_buffer_sizeçš„å€¼æ¥æ”¹å–„æ€§èƒ½ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯read_buffer_sizeæ˜¯æ¯ä¸ªsessionç‹¬å çš„ï¼Œå¦‚æœé»˜è®¤å€¼è®¾ç½®å¤ªå¤§ï¼Œå°±ä¼šé€ æˆå†…å­˜æµªè´¹ã€‚ 2.3 read_rnd_buffer_sizeå¯¹äºéœ€è¦åšæ’åºçš„MyISAMè¡¨çš„æŸ¥è¯¢ï¼Œå¦‚å¸¦æœ‰order byå­å¥çš„sqlï¼Œé€‚å½“å¢åŠ  read_rnd_buffer_size çš„å€¼ï¼Œå¯ä»¥æ”¹å–„æ­¤ç±»çš„sqlæ€§èƒ½ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ read_rnd_buffer_size æ˜¯æ¯ä¸ªsessionç‹¬å çš„ï¼Œå¦‚æœé»˜è®¤å€¼è®¾ç½®å¤ªå¤§ï¼Œå°±ä¼šé€ æˆå†…å­˜æµªè´¹ã€‚ 3 InnoDB å†…å­˜ä¼˜åŒ–InnoDBç”¨ä¸€å—å†…å­˜åŒºåšIOç¼“å­˜æ± ï¼Œè¯¥ç¼“å­˜æ± ä¸ä»…ç”¨æ¥ç¼“å­˜InnoDBçš„ç´¢å¼•å—ï¼Œè€Œä¸”ä¹Ÿç”¨æ¥ç¼“å­˜InnoDBçš„æ•°æ®å—ã€‚ 3.1 innodb_buffer_pool_sizeè¯¥å˜é‡å†³å®šäº† InnoDB å­˜å‚¨å¼•æ“è¡¨æ•°æ®å’Œç´¢å¼•æ•°æ®çš„æœ€å¤§ç¼“å­˜åŒºå¤§å°ã€‚åœ¨ä¿è¯æ“ä½œç³»ç»ŸåŠå…¶ä»–ç¨‹åºæœ‰è¶³å¤Ÿå†…å­˜å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œinnodb_buffer_pool_size çš„å€¼è¶Šå¤§ï¼Œç¼“å­˜å‘½ä¸­ç‡è¶Šé«˜ï¼Œè®¿é—®InnoDBè¡¨éœ€è¦çš„ç£ç›˜I/O å°±è¶Šå°‘ï¼Œæ€§èƒ½ä¹Ÿå°±è¶Šé«˜ã€‚ innodb_buffer_pool_size=512M3.2 innodb_log_buffer_sizeå†³å®šäº†InnoDBé‡åšæ—¥å¿—ç¼“å­˜çš„å¤§å°ï¼Œå¯¹äºå¯èƒ½äº§ç”Ÿå¤§é‡æ›´æ–°è®°å½•çš„å¤§äº‹åŠ¡ï¼Œå¢åŠ innodb_log_buffer_size çš„å¤§å°ï¼Œå¯ä»¥é¿å…InnoDBåœ¨äº‹åŠ¡æäº¤å‰å°±æ‰§è¡Œä¸å¿…è¦çš„æ—¥å¿—å†™å…¥ç£ç›˜æ“ä½œã€‚ innodb_log_buffer_size=10M","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"ä¼˜åŒ–","slug":"ä¼˜åŒ–","permalink":"https://www.codetool.top/tags/%E4%BC%98%E5%8C%96/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"MySQL","slug":"MySQL","permalink":"https://www.codetool.top/tags/MySQL/"}]},{"title":"MySQLä¹‹æŸ¥è¯¢ç¼“å­˜ä¼˜åŒ–","slug":"MySQLä¹‹æŸ¥è¯¢ç¼“å­˜ä¼˜åŒ–","date":"2020-03-06T08:53:20.000Z","updated":"2020-03-06T09:27:09.142Z","comments":true,"path":"article/MySQLä¹‹æŸ¥è¯¢ç¼“å­˜ä¼˜åŒ–/","link":"","permalink":"https://www.codetool.top/article/MySQL%E4%B9%8B%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98%E4%BC%98%E5%8C%96/","excerpt":"","text":"å¼€å¯Mysqlçš„æŸ¥è¯¢ç¼“å­˜ï¼Œå½“æ‰§è¡Œå®Œå…¨ç›¸åŒçš„SQLè¯­å¥çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨å°±ä¼šç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–ç»“æœï¼Œå½“æ•°æ®è¢«ä¿®æ”¹ï¼Œä¹‹å‰çš„ç¼“å­˜ä¼šå¤±æ•ˆï¼Œä¿®æ”¹æ¯”è¾ƒé¢‘ç¹çš„è¡¨ä¸é€‚åˆåšæŸ¥è¯¢ç¼“å­˜ã€‚ 1 æŸ¥è¯¢ç¼“å­˜é…ç½®æŸ¥çœ‹å½“å‰çš„MySQLæ•°æ®åº“æ˜¯å¦æ”¯æŒæŸ¥è¯¢ç¼“å­˜ï¼š mysql&gt; SHOW VARIABLES LIKE &#39;have_query_cache&#39;; +------------------+-------+ | Variable_name | Value | +------------------+-------+ | have_query_cache | YES | +------------------+-------+ 1 row in set (0.01 sec)æŸ¥çœ‹å½“å‰MySQLæ˜¯å¦å¼€å¯äº†æŸ¥è¯¢ç¼“å­˜ ï¼š mysql&gt; SHOW VARIABLES LIKE &#39;query_cache_type&#39;; +------------------+-------+ | Variable_name | Value | +------------------+-------+ | query_cache_type | OFF | +------------------+-------+ 1 row in set (0.01 sec)æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜çš„å ç”¨å¤§å° ï¼š mysql&gt; SHOW VARIABLES LIKE &#39;query_cache_size&#39;; +------------------+----------+ | Variable_name | Value | +------------------+----------+ | query_cache_size | 16777216 | +------------------+----------+ 1 row in set (0.00 sec)æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜çš„çŠ¶æ€å˜é‡ï¼š mysql&gt; SHOW STATUS LIKE &#39;Qcache%&#39;; +-------------------------+----------+ | Variable_name | Value | +-------------------------+----------+ | Qcache_free_blocks | 1 | | Qcache_free_memory | 16760152 | | Qcache_hits | 0 | | Qcache_inserts | 0 | | Qcache_lowmem_prunes | 0 | | Qcache_not_cached | 1 | | Qcache_queries_in_cache | 0 | | Qcache_total_blocks | 1 | +-------------------------+----------+ 8 rows in set (0.00 sec)å„ä¸ªå˜é‡çš„å«ä¹‰å¦‚ä¸‹ï¼š å‚æ•° å«ä¹‰ Qcache_free_blocks æŸ¥è¯¢ç¼“å­˜ä¸­çš„å¯ç”¨å†…å­˜å—æ•° Qcache_free_memory æŸ¥è¯¢ç¼“å­˜çš„å¯ç”¨å†…å­˜é‡ Qcache_hits æŸ¥è¯¢ç¼“å­˜å‘½ä¸­æ•° Qcache_inserts æ·»åŠ åˆ°æŸ¥è¯¢ç¼“å­˜çš„æŸ¥è¯¢æ•° Qcache_lowmen_prunes ç”±äºå†…å­˜ä¸è¶³è€Œä»æŸ¥è¯¢ç¼“å­˜ä¸­åˆ é™¤çš„æŸ¥è¯¢æ•° Qcache_not_cached éç¼“å­˜æŸ¥è¯¢çš„æ•°é‡ï¼ˆç”±äº query_cache_type è®¾ç½®è€Œæ— æ³•ç¼“å­˜æˆ–æœªç¼“å­˜ï¼‰ Qcache_queries_in_cache æŸ¥è¯¢ç¼“å­˜ä¸­æ³¨å†Œçš„æŸ¥è¯¢æ•° Qcache_total_blocks æŸ¥è¯¢ç¼“å­˜ä¸­çš„å—æ€»æ•° 2 å¼€å¯æŸ¥è¯¢ç¼“å­˜MySQLçš„æŸ¥è¯¢ç¼“å­˜é»˜è®¤æ˜¯å…³é—­çš„ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®å‚æ•° query_cache_type ï¼Œ æ¥å¼€å¯æŸ¥è¯¢ç¼“å­˜ã€‚query_cache_type è¯¥å‚æ•°çš„å¯å–å€¼æœ‰ä¸‰ä¸ªï¼š å€¼ å«ä¹‰ OFF æˆ– 0 æŸ¥è¯¢ç¼“å­˜åŠŸèƒ½å…³é—­ ON æˆ– 1 æŸ¥è¯¢ç¼“å­˜åŠŸèƒ½æ‰“å¼€ï¼ŒSELECTçš„ç»“æœç¬¦åˆç¼“å­˜æ¡ä»¶å³ä¼šç¼“å­˜ï¼Œå¦åˆ™ï¼Œä¸äºˆç¼“å­˜ï¼Œæ˜¾å¼æŒ‡å®š SQL_NO_CACHEï¼Œä¸äºˆç¼“å­˜ DEMAND æˆ– 2 æŸ¥è¯¢ç¼“å­˜åŠŸèƒ½æŒ‰éœ€è¿›è¡Œï¼Œæ˜¾å¼æŒ‡å®š SQL_CACHE çš„SELECTè¯­å¥æ‰ä¼šç¼“å­˜ï¼›å…¶å®ƒå‡ä¸äºˆç¼“å­˜ é…ç½®å®Œæ¯•ä¹‹åï¼Œé‡å¯æœåŠ¡æ—¢å¯ç”Ÿæ•ˆ ï¼› ç„¶åå°±å¯ä»¥åœ¨å‘½ä»¤è¡Œæ‰§è¡ŒSQLè¯­å¥è¿›è¡ŒéªŒè¯ ï¼Œæ‰§è¡Œä¸€æ¡æ¯”è¾ƒè€—æ—¶çš„SQLè¯­å¥ï¼Œç„¶åå†å¤šæ‰§è¡Œå‡ æ¬¡ï¼ŒæŸ¥çœ‹åé¢å‡ æ¬¡çš„æ‰§è¡Œæ—¶é—´ï¼›è·å–é€šè¿‡æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜çš„ç¼“å­˜å‘½ä¸­æ•°ï¼Œæ¥åˆ¤å®šæ˜¯å¦èµ°æŸ¥è¯¢ç¼“å­˜ã€‚ 3 æŸ¥è¯¢ç¼“å­˜SELECTé€‰é¡¹å¯ä»¥åœ¨SELECTè¯­å¥ä¸­æŒ‡å®šä¸¤ä¸ªä¸æŸ¥è¯¢ç¼“å­˜ç›¸å…³çš„é€‰é¡¹ ï¼š SQL_CACHE : å¦‚æœæŸ¥è¯¢ç»“æœæ˜¯å¯ç¼“å­˜çš„ï¼Œå¹¶ä¸” query_cache_type ç³»ç»Ÿå˜é‡çš„å€¼ä¸ºONæˆ– DEMAND ï¼Œåˆ™ç¼“å­˜æŸ¥è¯¢ç»“æœ ã€‚ SQL_NO_CACHE : æœåŠ¡å™¨ä¸ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ã€‚å®ƒæ—¢ä¸æ£€æŸ¥æŸ¥è¯¢ç¼“å­˜ï¼Œä¹Ÿä¸æ£€æŸ¥ç»“æœæ˜¯å¦å·²ç¼“å­˜ï¼Œä¹Ÿä¸ç¼“å­˜æŸ¥è¯¢ç»“æœã€‚ ä¾‹å­ï¼š SELECT SQL_CACHE id, name FROM customer; SELECT SQL_NO_CACHE id, name FROM customer; 4 æŸ¥è¯¢ç¼“å­˜å¤±æ•ˆçš„æƒ…å†µ4.1 SQL è¯­å¥ä¸ä¸€è‡´è¦æƒ³å‘½ä¸­æŸ¥è¯¢ç¼“å­˜ï¼ŒæŸ¥è¯¢çš„SQLè¯­å¥å¿…é¡»ä¸€è‡´ã€‚ SQL1 : select count(*) from tb_item; SQL2 : Select count(*) from tb_item; åŒºåˆ†å¤§å°å†™ 4.2 å½“æŸ¥è¯¢è¯­å¥ä¸­ç”¨åˆ°äº†å‡½æ•°SQL1 : select * from tb_item where updatetime < now() limit 1; SQL2 : select user(); SQL3 : select database(); è¿™äº›è‡ªå¸¦å‡½æ•°æ¯æ¬¡æŸ¥è¯¢éƒ½æ˜¯ä¸ç¡®å®šçš„ï¼Œä¸ä¼šä½¿ç”¨ç¼“å­˜ã€‚ 4.3 ä¸ä½¿ç”¨ä»»ä½•è¡¨æŸ¥è¯¢è¯­å¥select 'A'; 4.4 æŸ¥è¯¢ç³»ç»Ÿæ•°æ®åº“æŸ¥è¯¢ mysqlï¼Œ information_schemaæˆ– performance_schema æ•°æ®åº“ä¸­çš„è¡¨æ—¶ï¼Œä¸ä¼šèµ°æŸ¥è¯¢ç¼“å­˜ã€‚ select * from information_schema.engines; 4.5 åœ¨å­˜å‚¨çš„å‡½æ•°ï¼Œè§¦å‘å™¨æˆ–äº‹ä»¶çš„ä¸»ä½“å†…æ‰§è¡Œçš„æŸ¥è¯¢4.6 è¡¨æ›´æ”¹å¦‚æœè¡¨æ›´æ”¹ï¼Œåˆ™ä½¿ç”¨è¯¥è¡¨çš„æ‰€æœ‰é«˜é€Ÿç¼“å­˜æŸ¥è¯¢éƒ½å°†å˜ä¸ºæ— æ•ˆå¹¶ä»é«˜é€Ÿç¼“å­˜ä¸­åˆ é™¤ã€‚è¿™åŒ…æ‹¬ä½¿ç”¨MERGEæ˜ å°„åˆ°å·²æ›´æ”¹è¡¨çš„è¡¨çš„æŸ¥è¯¢ã€‚ä¸€ä¸ªè¡¨å¯ä»¥è¢«è®¸å¤šç±»å‹çš„è¯­å¥æ”¹å˜, å¦‚ INSERTï¼Œ UPDATEï¼Œ DELETEï¼Œ TRUNCATE TABLEï¼Œ ALTER TABLEï¼Œ DROP TABLEï¼Œæˆ– DROP DATABASE ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"ä¼˜åŒ–","slug":"ä¼˜åŒ–","permalink":"https://www.codetool.top/tags/%E4%BC%98%E5%8C%96/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"MySQL","slug":"MySQL","permalink":"https://www.codetool.top/tags/MySQL/"}]},{"title":"å‰‘æŒ‡offer57-å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—","slug":"å‰‘æŒ‡offer57-å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—","date":"2020-03-05T17:01:12.000Z","updated":"2020-03-12T17:30:38.736Z","comments":true,"path":"article/å‰‘æŒ‡offer57-å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—/","link":"","permalink":"https://www.codetool.top/article/%E5%89%91%E6%8C%87offer57-%E5%92%8C%E4%B8%BAs%E7%9A%84%E8%BF%9E%E7%BB%AD%E6%AD%A3%E6%95%B0%E5%BA%8F%E5%88%97/","excerpt":"","text":"1 åŸé¢˜ï¼ˆæ¥æºLeetcodeï¼‰è¾“å…¥ä¸€ä¸ªæ­£æ•´æ•° target ï¼Œè¾“å‡ºæ‰€æœ‰å’Œä¸º target çš„è¿ç»­æ­£æ•´æ•°åºåˆ—ï¼ˆè‡³å°‘å«æœ‰ä¸¤ä¸ªæ•°ï¼‰ã€‚ åºåˆ—å†…çš„æ•°å­—ç”±å°åˆ°å¤§æ’åˆ—ï¼Œä¸åŒåºåˆ—æŒ‰ç…§é¦–ä¸ªæ•°å­—ä»å°åˆ°å¤§æ’åˆ—ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: target = 9è¾“å‡º: [[2,3,4],[4,5]] ç¤ºä¾‹ 2: è¾“å…¥: target = 15è¾“å‡º: [[1,2,3,4,5],[4,5,6],[7,8]] é™åˆ¶ï¼š 1 &lt;= target &lt;= 10^5 2 è§£æ³•2.1 æ€æƒ³è¿™é“é¢˜æœ€å¤§çš„å‘å°±æ˜¯ç”¨äºŒç»´æ•°ç»„åšè¿”å›å€¼å§ã€‚ã€‚ç¡®å®è¯­æ³•ä¸ŠæŒºéº»çƒ¦çš„ï¼Œè§£æ³•å°±æ˜¯æ»‘åŠ¨çª—å£ï¼Œä¸€ä¸ªprevä¸€ä¸ªnextï¼Œå¦‚æœå½“å‰åŒºé—´å†…çš„æ‰€æœ‰å€¼çš„å’Œå°äºç›®æ ‡å€¼ï¼Œnextåç§»ä¸€ä½ï¼Œå¦‚æœå¤§äºç›®æ ‡å€¼ï¼Œprevåç§»ä¸€ä½ï¼Œå¦‚æœç­‰äºç›®æ ‡å€¼ï¼ŒæŠŠå½“å‰åŒºé—´å†…çš„æ‰€æœ‰æ•°æ”¾å…¥æ•°ç»„ä¸­å†æ”¾å…¥ä¸€ä¸ªlistä¸­ã€‚ è¿™æ ·ä¸‹å»ç›´åˆ°prevå¤§äºç›®æ ‡å€¼çš„ä¸€åŠï¼Œå°±å¯ä»¥ç»“æŸå¾ªç¯äº†ï¼Œç„¶åå°†listä¸­æ‰€æœ‰çš„æ•°ç»„å†æè¿›ä¸€ä¸ªæ•°ç»„é‡Œå»ã€‚ 2.2 ä»£ç class Solution { public int[][] findContinuousSequence(int target) { List&lt;int[]> list = new ArrayList&lt;int[]>(); int prev = 1,next = 1; int sum = 1; while(next&lt;=(target+1)/2){ if(sum > target){ sum = sum-prev; prev++; }else{ if(sum == target){ int[] nums = new int[next-prev+1]; for(int i = 0;i&lt;next-prev+1;i++){ nums[i] = i+prev; } list.add(nums); } next++; sum = sum+next; } } int[][] ans = new int[list.size()][]; for(int i = 0;i&lt;list.size();i++){ ans[i] = list.get(i); } return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"å‰‘æŒ‡offer","slug":"å‰‘æŒ‡offer","permalink":"https://www.codetool.top/tags/%E5%89%91%E6%8C%87offer/"}]},{"title":"SQLä¼˜åŒ–-ä»æ‰§è¡Œç­–ç•¥ä¸Šæé«˜æ•°æ®åº“æ€§èƒ½","slug":"SQLä¼˜åŒ–-ä»æ‰§è¡Œç­–ç•¥ä¸Šæé«˜æ•°æ®åº“æ€§èƒ½","date":"2020-03-05T15:17:38.000Z","updated":"2020-03-05T15:42:55.808Z","comments":true,"path":"article/SQLä¼˜åŒ–-ä»æ‰§è¡Œç­–ç•¥ä¸Šæé«˜æ•°æ®åº“æ€§èƒ½/","link":"","permalink":"https://www.codetool.top/article/SQL%E4%BC%98%E5%8C%96-%E4%BB%8E%E6%89%A7%E8%A1%8C%E7%AD%96%E7%95%A5%E4%B8%8A%E6%8F%90%E9%AB%98%E6%95%B0%E6%8D%AE%E5%BA%93%E6%80%A7%E8%83%BD/","excerpt":"","text":"è¯¥æ–‡å‰ç½®çŸ¥è¯†ï¼š SQLä¼˜åŒ–å‰ç½®çŸ¥è¯†ä¹‹ä¼˜åŒ–å‰åˆ†æ SQLä¼˜åŒ–å‰ç½®çŸ¥è¯†ä¹‹ç´¢å¼•çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿ æ•°æ®åº“çš„æ€§èƒ½åœ¨ç³»ç»Ÿä¸­éå¸¸é‡è¦ï¼Œåœ¨å‰é¢äº†è§£äº†Redisé«˜å¯ç”¨çš„èƒŒæ™¯ä¸‹ä¹Ÿäº†è§£åˆ°äº†è®¸å¤šé—®é¢˜éƒ½ä¼šç»™æ•°æ®åº“æ–½åŠ éå¸¸å¤§çš„å‹åŠ›ï¼Œä¸€æ—¦æ•°æ®åº“å´©æºƒä¼šå¸¦æ¥éå¸¸ä¸¥é‡çš„åæœä¹ƒè‡³æ•´ä¸ªç³»ç»Ÿå´©æºƒï¼Œå¯¹æ•°æ®åº“æ€§èƒ½çš„ä¼˜åŒ–ä¸»è¦æ–¹æ³•æ˜¯ï¼š SQL è¯­å¥åŠç´¢å¼•çš„ä¼˜åŒ– æ•°æ®åº“è¡¨ç»“æ„çš„ä¼˜åŒ– ç³»ç»Ÿé…ç½®çš„ä¼˜åŒ– ç¡¬ä»¶çš„ä¼˜åŒ– ä»æ•ˆæœä¸Šç¬¬ä¸€æ¡å½±å“æœ€å¤§ï¼Œåé¢è¶Šæ¥è¶Šå°ã€‚è¿™ç¯‡æ–‡ç« å°±ä¸»è¦æ¥é˜è¿°SQLçš„ä¼˜åŒ–æ–¹æ³•ã€‚ æ³¨ï¼šåœ¨æœ¬ç¯‡æ–‡ç« çš„ç¼–å†™è¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç°mysql5.7ç‰ˆæœ¬å¯¹æŸäº›sqlè¯­å¥å·²ç»æœ‰äº†è‡ªåŠ¨ä¼˜åŒ–æœºåˆ¶ï¼Œä½†è¿˜æ˜¯å»ºè®®äº†è§£sqlè¯­å¥çš„ä¼˜åŒ–ï¼Œæ¯•ç«Ÿç‰ˆæœ¬çš„äº‹æ€»ä¸å¦‚è„‘å­é‡Œçš„ä¸œè¥¿ç¨³ã€‚ 1 ä¼˜åŒ–load dataå½“ä½¿ç”¨load data infileå‘½ä»¤å¯¼å…¥æ•°æ®çš„æ—¶å€™ï¼Œé€‚å½“çš„è®¾ç½®å¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ã€‚ 1.1 ä¸»é”®é¡ºåºæ’å…¥å› ä¸ºèšç°‡ç´¢å¼•çš„å…³ç³»ï¼Œå¦‚æœä¸»é”®çš„å€¼æ˜¯é¡ºåºçš„ï¼Œé‚£ä¹ˆ InnoDB ä¼šæŠŠæ¯ä¸€æ¡è®°å½•éƒ½å­˜å‚¨åœ¨ä¸Šä¸€æ¡è®°å½•çš„åé¢ï¼Œå¡«å……çš„æ˜¯åŒä¸€ä¸ªé¡µï¼Œå‡å°‘äº†IOé¡µçš„æ¬¡æ•°ã€‚å¦‚æœInnoDBè¡¨æ²¡æœ‰ä¸»é”®ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šè‡ªåŠ¨é»˜è®¤åˆ›å»ºä¸€ä¸ªå†…éƒ¨åˆ—ä½œä¸ºä¸»é”®ï¼Œæ‰€ä»¥å¦‚æœå¯ä»¥ç»™è¡¨åˆ›å»ºä¸€ä¸ªä¸»é”®ï¼Œå°†å¯ä»¥åˆ©ç”¨è¿™ç‚¹ï¼Œæ¥æé«˜å¯¼å…¥æ•°æ®çš„æ•ˆç‡ã€‚ 1.2 å…³é—­å”¯ä¸€æ€§æ ¡éªŒå¦‚æœå¯ä»¥ç¡®å®šæ’å…¥çš„æ•°æ®æ»¡è¶³å”¯ä¸€æ€§çº¦æŸï¼Œå¯ä»¥åœ¨å¯¼å…¥æ•°æ®å‰æ‰§è¡Œ SET UNIQUE_CHECKS=0ï¼Œå…³é—­å”¯ä¸€æ€§æ ¡éªŒï¼Œåœ¨å¯¼å…¥ç»“æŸåæ‰§è¡ŒSET UNIQUE_CHECKS=1ï¼Œæ¢å¤å”¯ä¸€æ€§æ ¡éªŒï¼Œå¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ã€‚ 1.3 æ‰‹åŠ¨æäº¤äº‹åŠ¡å¦‚æœåº”ç”¨ä½¿ç”¨è‡ªåŠ¨æäº¤çš„æ–¹å¼ï¼Œå»ºè®®åœ¨å¯¼å…¥å‰æ‰§è¡Œ SET AUTOCOMMIT=0ï¼Œå…³é—­è‡ªåŠ¨æäº¤ï¼Œå¯¼å…¥ç»“æŸåå†æ‰§è¡Œ SET AUTOCOMMIT=1ï¼Œæ‰“å¼€è‡ªåŠ¨æäº¤ï¼Œä¹Ÿå¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ã€‚ 2 ä¼˜åŒ–insertè¯­å¥å½“è¿›è¡Œæ•°æ®çš„insertæ“ä½œçš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨ä»¥ä¸‹å‡ ç§ä¼˜åŒ–æ–¹æ¡ˆã€‚ 2.1 åˆå¹¶insertè¯­å¥å¦‚æœéœ€è¦åŒæ—¶å¯¹ä¸€å¼ è¡¨æ’å…¥å¾ˆå¤šè¡Œæ•°æ®æ—¶ï¼Œåº”è¯¥å°½é‡ä½¿ç”¨å¤šä¸ªå€¼çš„insertè¯­å¥ï¼Œè¿™ç§æ–¹å¼å°†å¤§å¤§çš„ç¼©å‡å®¢æˆ·ç«¯ä¸æ•°æ®åº“ä¹‹é—´çš„è¿æ¥ã€å…³é—­ç­‰æ¶ˆè€—ã€‚ä½¿å¾—æ•ˆç‡æ¯”åˆ†å¼€æ‰§è¡Œçš„å•ä¸ªinsertè¯­å¥å¿«ã€‚ ç¤ºä¾‹ï¼Œ åŸå§‹æ–¹å¼ä¸ºï¼š insert into tb_test values(1,'Tom'); insert into tb_test values(2,'Cat'); insert into tb_test values(3,'Jerry'); ä¼˜åŒ–åçš„æ–¹æ¡ˆä¸º ï¼š insert into tb_test values(1,'Tom'),(2,'Cat')ï¼Œ(3,'Jerry'); 2.2 åœ¨äº‹åŠ¡ä¸­è¿›è¡Œæ•°æ®æ’å…¥start transaction; insert into tb_test values(1,'Tom'); insert into tb_test values(2,'Cat'); insert into tb_test values(3,'Jerry'); commit; 2.3 æ•°æ®æœ‰åºæ’å…¥å’Œload dataä¸€æ ·çš„åŸç† 3 ä¼˜åŒ–joinè¿™éƒ¨åˆ†çš„å†…å®¹åœ¨æ•°æ®åº“ç†è®ºä¹‹æŸ¥è¯¢å¤„ç†å’ŒæŸ¥è¯¢ä¼˜åŒ–è°ˆå¾—æ¯”è¾ƒè¯¦ç»†ï¼Œæ€»çš„æ¥è¯´æ˜¯è¦å…ˆé€‰æ‹©å†è¿æ¥ã€‚ 4 å°è¡¨é©±åŠ¨å¤§è¡¨å¦‚æœæœ‰ä¸¤å¼ è¡¨è¿æ¥ï¼Œç±»ä¼¼äºäºŒé‡å¾ªç¯ å¤–å±‚çš„è¡¨åº”è¯¥æ˜¯å°è¡¨ï¼Œå†…å±‚çš„åº”è¯¥æ˜¯å¤§è¡¨ã€‚ è™½ç„¶æ€»çš„éå†æ¬¡æ•°æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯é¢‘ç¹åˆ‡æ¢æ•°æ®è¡¨æ˜¯å½±å“æ•ˆç‡çš„ï¼ˆIO æ¬¡æ•°ï¼‰ï¼Œåº”è¯¥å°½å¯èƒ½å‡å°‘åˆ‡æ¢è¡¨çš„æ¬¡æ•°ã€‚ è¿™æ–¹é¢å†…å®¹å¯ä»¥å‚è€ƒï¼šMySql å°è¡¨é©±åŠ¨å¤§è¡¨ - èŒ¶é¥­ä¸æ’• - åšå®¢å›­ 5 ä¼˜åŒ–order byè¯­å¥5.1 äº†è§£ï¼šä¸¤ç§æ’åºæ–¹å¼ç¬¬ä¸€ç§æ˜¯é€šè¿‡å¯¹è¿”å›æ•°æ®è¿›è¡Œæ’åºï¼Œä¹Ÿå°±æ˜¯é€šå¸¸è¯´çš„ filesort æ’åºï¼Œæ‰€æœ‰ä¸æ˜¯é€šè¿‡ç´¢å¼•ç›´æ¥è¿”å›æ’åºç»“æœçš„æ’åºéƒ½å« FileSort æ’åºã€‚ ç¬¬äºŒç§é€šè¿‡æœ‰åºç´¢å¼•é¡ºåºæ‰«æç›´æ¥è¿”å›æœ‰åºæ•°æ®ï¼Œè¿™ç§æƒ…å†µå³ä¸º using indexï¼Œä¸éœ€è¦é¢å¤–æ’åºï¼Œæ“ä½œæ•ˆç‡é«˜ã€‚ å¯ä»¥åœ¨explainä¸­çœ‹åˆ°sqlè¯­å¥ä½¿ç”¨çš„æ˜¯å“ªç§æ’åºæ–¹æ³•ã€‚ ä¼˜åŒ–ç›®æ ‡ï¼šå°½é‡å‡å°‘é¢å¤–çš„æ’åºï¼Œé€šè¿‡ç´¢å¼•ç›´æ¥è¿”å›æœ‰åºæ•°æ®ã€‚ å¯¹äºç´¢å¼•(a,b,c)ï¼Œä¸èƒ½ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åºçš„æƒ…å†µï¼šï¼ˆåº”é¿å…ï¼‰ ORDER BY a ASC, b DESC, c DESC /æ’åºä¸ä¸€è‡´/ WHERE g = const ORDER BY b, c /ä¸æ»¡è¶³æœ€å·¦å‰ç¼€/ WHERE a in (...) ORDER BY b, c /å¯¹äºæ’åºæ¥è¯´ï¼ŒèŒƒå›´inä¹Ÿä¸èƒ½æ»¡è¶³æœ€å·¦å‰ç¼€/ 5.2 äº†è§£ï¼šfilesortçš„ç®—æ³•æœ‰çš„æ—¶å€™å¹¶ä¸èƒ½é¿å…filesortï¼Œè¯¥å¦‚ä½•ä¼˜åŒ–filesortå°±å¾—äº†è§£å®ƒçš„åº•å±‚å®ç°ã€‚ åŒè·¯æ’åºï¼š MySQL4.1ä¹‹å‰æ˜¯ä½¿ç”¨åŒè·¯æ’åº,å­—é¢æ„æ€å°±æ˜¯ä¸¤æ¬¡æ‰«æç£ç›˜,æœ€ç»ˆå¾—åˆ°æ•°æ®ã€‚ å®ƒçš„å·¥ä½œè¿‡ç¨‹ï¼šè¯»å–è¡ŒæŒ‡é’ˆå’Œ orderbyåˆ—,å¯¹ä»–ä»¬è¿›è¡Œæ’åº,ç„¶åæ‰«æå·²ç»æ’åºå¥½çš„åˆ—è¡¨,æŒ‰ç…§åˆ—è¡¨ä¸­çš„å€¼é‡æ–°ä»åˆ—è¡¨ä¸­è¯»å–å¯¹åº”çš„æ•°æ®è¾“å‡º æ¦‚æ‹¬ï¼š ä»ç£ç›˜å–æ’åºå­—æ®µ,åœ¨ bufferè¿›è¡Œæ’åº,å†ä»ç£ç›˜å–å…¶ä»–å­—æ®µã€‚ ç„¶è€Œå–ä¸€æ‰¹æ•°æ®,è¦å¯¹ç£ç›˜è¿›è¡Œäº†ä¸¤æ¬¡æ‰«æ,ä¼—æ‰€å‘¨çŸ¥,IOæ˜¯å¾ˆè€—æ—¶çš„,æ‰€ä»¥åœ¨mysql4.1ä¹‹å,å‡ºç°äº†ç¬¬äºŒç§æ”¹è¿›çš„ç®—æ³•,å°±æ˜¯å•è·¯æ’åºï¼š å•è·¯æ’åºçš„å·¥ä½œè¿‡ç¨‹ï¼š ä»ç£ç›˜è¯»å–æŸ¥è¯¢éœ€è¦çš„æ‰€æœ‰åˆ—,æŒ‰ç…§ order byåˆ—åœ¨ bufferå¯¹å®ƒä»¬è¿›è¡Œæ’åº,ç„¶åæ‰«ææ’åºåçš„åˆ—è¡¨è¿›è¡Œè¾“å‡º,å®ƒçš„æ•ˆç‡æ›´å¿«ä¸€äº›,é¿å…äº†ç¬¬äºŒæ¬¡è¯»å–æ•°æ®ã€‚å¹¶ä¸”æŠŠéšæœºIOå˜æˆäº†é¡ºåºIO,ä½†æ˜¯å®ƒä¼šä½¿ç”¨æ›´å¤šçš„ç©ºé—´,å› ä¸ºå®ƒæŠŠæ¯ä¸€è¡Œéƒ½ä¿å­˜åœ¨å†…å­˜ä¸­äº†ã€‚ å•è·¯æ’åºé—®é¢˜ï¼š åœ¨ sort_buffer ä¸­å•è·¯æ’åºæ¯”åŒè·¯æ’åºè¦å¤šå ç”¨å¾ˆå¤šç©ºé—´ï¼Œå› ä¸ºå•è·¯æ’åºæ˜¯æŠŠæ‰€æœ‰å­—æ®µéƒ½å–å‡º, æ‰€ä»¥æœ‰å¯èƒ½å–å‡ºçš„æ•°æ®çš„æ€»å¤§å°è¶…å‡ºäº† sort_buffer çš„å®¹é‡ï¼Œå¯¼è‡´æ¯æ¬¡åªèƒ½å– sort_bufferå®¹é‡å¤§å°çš„æ•°æ®ï¼Œè¿›è¡Œæ’åºï¼ˆåˆ›å»º tmp æ–‡ä»¶ï¼Œå¤šè·¯åˆå¹¶ï¼‰ï¼Œæ’å®Œå†å– sort_buffer å®¹é‡å¤§å°ï¼Œå†æ’â€¦â€¦ä»è€Œå¤šæ¬¡ I/Oã€‚æœ¬æ¥æƒ³çœä¸€æ¬¡ I/O æ“ä½œï¼Œåè€Œå¯¼è‡´äº†å¤§é‡çš„ I/O æ“ä½œï¼Œåè€Œå¾—ä¸å¿å¤±ã€‚ 5.3 ä¼˜åŒ–æ–¹å¼1) å°½é‡ä½¿ç”¨ index æ–¹å¼æ’åºï¼Œéµç…§ç´¢å¼•çš„æœ€ä½³å·¦å‰ç¼€ æ’åºæ—¶ä½¿ç”¨çš„å­—æ®µçš„é¡ºåºæœ€å¥½ä¸ index å»ºç«‹çš„é¡ºåºç›¸åŒ ORDER BYæ»¡è¶³ä¸¤ç§æƒ…å†µï¼Œä¼šä½¿ç”¨Indexæ–¹æ³•æ’åºï¼š ORDER BYè¯­å¥ä½¿ç”¨ç´¢å¼•æœ€å·¦å‰ç¼€åˆ— ä½¿ç”¨WHEREå­å¥ä¸ORDER BYå­å¥æ¡ä»¶åˆ—ç»„åˆæ»¡è¶³ç´¢å¼•æœ€å·¦å‰ç¼€åˆ— ä¾‹ï¼šWHERE a = const AND b = const ORDER BY cæ˜¯å…è®¸çš„ 2) select * æ˜¯ä¸€ä¸ªå¤§å¿Œ åªå–å‡ºéœ€è¦çš„å­—æ®µï¼Œ è¿™ç‚¹éå¸¸é‡è¦ã€‚åœ¨è¿™é‡Œçš„å½±å“æ˜¯ï¼š å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå¯ä»¥ç›´æ¥ä»ç´¢å¼•æ ‘ä¸­è¯»å–æ•°æ®ï¼Œé¿å…äºŒæ¬¡æŸ¥è¯¢èšç°‡ç´¢å¼•ï¼Œè¿›è€Œå¯¼è‡´filesortã€‚ å½“Queryçš„å­—æ®µå¤§å°æ€»å’Œå°äº max_length_for_sort_data è€Œä¸”æ’åºå­—æ®µä¸æ˜¯TEXT|BLOB ç±»å‹æ—¶ï¼Œä¼šç”¨æ”¹è¿›åçš„ç®—æ³•â€”â€”å•è·¯æ’åºï¼Œ å¦åˆ™ç”¨è€ç®—æ³•â€”â€”å¤šè·¯æ’åºã€‚ é¿å…å–å‡ºå¤ªå¤šæ•°æ®ä½¿å¾—å ç”¨å†…å­˜è¶…è¿‡ sort_buffer_size è€Œé‡‡ç”¨å¤šè·¯æ’åºã€‚ 3) å°è¯•æé«˜ sort_buffer_size å’Œ max_length_for_sort_data æé«˜è¿™ä¸¤ä¸ªå‚æ•°ï¼Œä¼šå¢åŠ ç”¨æ”¹è¿›ç®—æ³•çš„æ¦‚ç‡ã€‚ä¸¤ä¸ªå‚æ•°æœ€å¥½è¾¾æˆä¸€ç§å¹³è¡¡ï¼Œå¦åˆ™å¦‚æœmax_length_for_sort_dataè®¾çš„å¤ªé«˜ï¼Œæ•°æ®æ€»å®¹é‡è¶…å‡ºsort_buffer_size çš„æ¦‚ç‡å°±å¢å¤§ï¼Œæ˜æ˜¾ç—‡çŠ¶æ˜¯é«˜çš„ç£ç›˜ I/O æ´»åŠ¨å’Œä½çš„å¤„ç†å™¨ä½¿ç”¨ç‡ã€‚ 6 ä¼˜åŒ–GROUP BYè¯­å¥group byå®è´¨æ˜¯å…ˆæ’åºåè¿›è¡Œåˆ†ç»„,éµç…§ç´¢å¼•çš„æœ€ä½³å·¦å‰ç¼€è§„åˆ™ï¼Œæ‰€ä»¥ä¹Ÿå°½é‡æ»¡è¶³è¯¥è§„åˆ™ã€‚ å½“æ— æ³•ä½¿ç”¨ç´¢å¼•æ—¶ï¼ŒGROUP BY ä½¿ç”¨ä¸¤ç§ç­–ç•¥æ¥å®Œæˆï¼šä½¿ç”¨ä¸´æ—¶è¡¨å’Œfilesortæ¥åšåˆ†ç»„ã€‚è¡¨ç°ä¸ºuse temporaryå’Œuse filesortã€‚ å½“æ— æ³•ä½¿ç”¨ç´¢å¼•åˆ—ï¼š å¯ä»¥ä¼˜åŒ–filesortï¼Œå³å¢å¤§sort_buffer_sizeå‚æ•°å’Œmax_length_for_sort_dataå‚æ•°ã€‚ å¯ä»¥åªä½¿ç”¨ä¸´æ—¶è¡¨ï¼Œä¸è¿›è¡Œfilesortï¼Œè¿™æ ·è¿”å›çš„ç»“æœæ˜¯æ— åºçš„ï¼Œæƒ³è¦åŠ ä¸ŠORDER BY null å¦ï¼Œé¿å…ä½¿ç”¨havingï¼Œwhereé«˜äºhavingï¼Œèƒ½å†™åœ¨whereé™å®šçš„æ¡ä»¶å°±ä¸è¦å»havingé™å®šäº†ã€‚ 7 ä¼˜åŒ–åµŒå¥—æŸ¥è¯¢Mysql4.1ç‰ˆæœ¬ä¹‹åï¼Œå¼€å§‹æ”¯æŒSQLçš„å­æŸ¥è¯¢ã€‚è¿™ä¸ªæŠ€æœ¯å¯ä»¥ä½¿ç”¨SELECTè¯­å¥æ¥åˆ›å»ºä¸€ä¸ªå•åˆ—çš„æŸ¥è¯¢ç»“æœï¼Œç„¶åæŠŠè¿™ä¸ªç»“æœä½œä¸ºè¿‡æ»¤æ¡ä»¶ç”¨åœ¨å¦ä¸€ä¸ªæŸ¥è¯¢ä¸­ã€‚ä½¿ç”¨å­æŸ¥è¯¢å¯ä»¥ä¸€æ¬¡æ€§çš„å®Œæˆå¾ˆå¤šé€»è¾‘ä¸Šéœ€è¦å¤šä¸ªæ­¥éª¤æ‰èƒ½å®Œæˆçš„SQLæ“ä½œï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é¿å…äº‹åŠ¡æˆ–è€…è¡¨é”æ­»ï¼Œå¹¶ä¸”å†™èµ·æ¥ä¹Ÿå¾ˆå®¹æ˜“ã€‚ä½†æ˜¯ï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œå­æŸ¥è¯¢æ˜¯å¯ä»¥è¢«æ›´é«˜æ•ˆçš„è¿æ¥ï¼ˆJOINï¼‰æ›¿ä»£ã€‚ äº‹å®ä¸Šï¼ŒMySQL5.7å·²ç»ä¼šè‡ªåŠ¨ä¼˜åŒ–ä¸€äº›å¯ä»¥è¢«è½¬æˆjoinçš„sqlè¯­å¥äº†ï¼Œä¸´æ—¶è¡¨å¼€å§‹è¢«é¿å…ä½¿ç”¨ã€‚ ç¤ºä¾‹ï¼š select * from t_user where id in (select user_id from user_role ); ä¼˜åŒ–ä¸ºï¼š select * from t_user u , user_role ur where u.id = ur.user_id; 8 ä¼˜åŒ–ORæ¡ä»¶å¯¹äºåŒ…å«ORçš„æŸ¥è¯¢å­å¥ï¼Œå¦‚æœè¦åˆ©ç”¨ç´¢å¼•ï¼Œåˆ™ORä¹‹é—´çš„æ¯ä¸ªæ¡ä»¶åˆ—éƒ½å¿…é¡»ç”¨åˆ°ç´¢å¼•ï¼Œè€Œä¸”ä¸èƒ½ä½¿ç”¨åˆ°å¤åˆç´¢å¼•ï¼›å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œåˆ™åº”è¯¥è€ƒè™‘å¢åŠ ç´¢å¼•ã€‚ï¼ˆé¿å…ç´¢å¼•å¤±æ•ˆï¼‰ å¦‚æœæ— æ³•å¢åŠ ç´¢å¼•ï¼Œè¿˜å¯ä»¥è€ƒè™‘ä½¿ç”¨unionåˆå¹¶æœ‰ç´¢å¼•çš„é‚£äº›æŸ¥è¯¢å‡ºæ¥çš„å’Œæ²¡ç´¢å¼•æŸ¥è¯¢å‡ºæ¥çš„ç»“æœé›†ä»£æ›¿orã€‚ï¼ˆåœ¨æ•°æ®é‡å°çš„æƒ…å†µä¸‹ä¸æ¨èï¼Œç”¨åˆ°ä¸´æ—¶è¡¨æœ‰çš„æ—¶å€™æ•ˆç‡æ›´ä½ï¼‰ 9 ä¼˜åŒ–limitè¯­å¥å½“åç§»é‡éå¸¸å¤§çš„æ—¶å€™ï¼Œæ¯”å¦‚ limit 100000,20 è¿™æ ·çš„æŸ¥è¯¢ï¼Œè¿™æ—¶ MySQL éœ€è¦æŸ¥è¯¢ 100020 æ¡è®°å½•ç„¶ååªè¿”å›æœ€å 20 æ¡ï¼Œè¿™æ ·çš„ä»£ä»·éå¸¸é«˜ã€‚è¦ä¼˜åŒ–è¿™ç§æŸ¥è¯¢ï¼Œè¦ä¹ˆåœ¨é¡µé¢ä¸­é™åˆ¶åˆ†é¡µæ•°é‡ï¼Œè¦ä¹ˆä¼˜åŒ–å¤§åç§»çš„æ€§èƒ½ã€‚ ä¸€ä¸ªç®€å•çš„åŠæ³•æ˜¯ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ˆå»¶è¿Ÿå…³è”ï¼‰ æ„æ€å°±æ˜¯å…ˆæŠŠç´¢å¼•æ’åºï¼Œå–å‡º100000-20çš„ç´¢å¼•å€¼ï¼Œç„¶åç”¨è¿™äº›æ•°æ®å†å›è¡¨æŸ¥è¯¢å¯¹åº”è¡Œçš„æ‰€æœ‰åˆ—çš„å€¼ã€‚ä½¿ç”¨å­æŸ¥è¯¢çš„å†™æ³•å°±æ˜¯ï¼š select * from tb_item t, (select id from tb_item order by id limit 100000,20) a where t.id=a.id; å¦ä¸€ç§æ–¹æ³•ï¼Œå¦‚æœä½¿ç”¨ä¹¦ç­¾è®°å½•ä¸Šæ¬¡å–æ•°æ®çš„ä½ç½®ï¼Œé‚£ä¹ˆä¸‹æ¬¡å°±å¯ä»¥ç›´æ¥ä»è¯¥ä¹¦ç­¾è®°å½•çš„ä½ç½®å¼€å§‹æ‰«æã€‚å‡è®¾ä¸»é”®é€’å¢ï¼Œé‚£ä¹ˆå½“æŸ¥è¯¢limit 100000,20è¿”å›çš„æœ€åä¸€æ¡æ•°æ®æ˜¯id= 1000102ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡æŸ¥è¯¢å¯ä»¥ä½¿ç”¨where id&gt;1000102æ¥é™å®šèŒƒå›´ã€‚ 10 ä½¿ç”¨SQLæç¤ºSQLæç¤ºï¼Œæ˜¯ä¼˜åŒ–æ•°æ®åº“çš„ä¸€ä¸ªé‡è¦æ‰‹æ®µï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨SQLè¯­å¥ä¸­åŠ å…¥ä¸€äº›äººä¸ºçš„æç¤ºæ¥è¾¾åˆ°ä¼˜åŒ–æ“ä½œçš„ç›®çš„ã€‚ ä½†æ˜¯é™¤éä½ çš„ä¼˜åŒ–ç»éªŒå¾ˆå¥½ï¼Œå¦åˆ™ä¸å»ºè®®ä½¿ç”¨hintå¼ºåˆ¶è¦æ±‚ä½¿ç”¨æŸä¸ªç´¢å¼•ï¼Œå› ä¸ºè‡³ä»ŠMySQLæœ¬èº«å¯¹sqlçš„ä¼˜åŒ–ç¨‹åº¦å·²ç»å¾ˆé«˜äº† : ) 10.1 USE INDEXåœ¨æŸ¥è¯¢è¯­å¥ä¸­è¡¨åçš„åé¢ï¼Œæ·»åŠ  use index æ¥æä¾›å¸Œæœ›MySQLå»å‚è€ƒçš„ç´¢å¼•åˆ—è¡¨ï¼Œå°±å¯ä»¥è®©MySQLä¸å†è€ƒè™‘å…¶ä»–å¯ç”¨çš„ç´¢å¼•ã€‚ 10.2 IGNORE INDEXå¦‚æœç”¨æˆ·åªæ˜¯å•çº¯çš„æƒ³è®©MySQLå¿½ç•¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªç´¢å¼•ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ ignore index ä½œä¸º hintã€‚ 10.3 FORCE INDEXä¸ºå¼ºåˆ¶MySQLä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„ç´¢å¼•ï¼Œå¯åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨ force index ä½œä¸ºhintã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"ä¼˜åŒ–","slug":"ä¼˜åŒ–","permalink":"https://www.codetool.top/tags/%E4%BC%98%E5%8C%96/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"MySQL","slug":"MySQL","permalink":"https://www.codetool.top/tags/MySQL/"}]},{"title":"SQLä¼˜åŒ–å‰ç½®çŸ¥è¯†ä¹‹ç´¢å¼•çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿","slug":"SQLä¼˜åŒ–å‰ç½®çŸ¥è¯†ä¹‹ç´¢å¼•çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿","date":"2020-03-05T12:15:33.000Z","updated":"2020-03-06T12:11:12.513Z","comments":true,"path":"article/SQLä¼˜åŒ–å‰ç½®çŸ¥è¯†ä¹‹ç´¢å¼•çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿/","link":"","permalink":"https://www.codetool.top/article/SQL%E4%BC%98%E5%8C%96%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86%E4%B9%8B%E7%B4%A2%E5%BC%95%E7%9A%84%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF/","excerpt":"","text":"è¯¥æ–‡çš„å‰ç½®çŸ¥è¯†ï¼šSQLä¼˜åŒ–å‰ç½®çŸ¥è¯†ä¹‹ä¼˜åŒ–å‰åˆ†æ 1 ç´¢å¼•å¤±æ•ˆæœ‰çš„sqlè¯­å¥ä¼šä¸ä½¿ç”¨ç´¢å¼•ï¼Ÿåœ¨ç¼–å†™sqlè¯­å¥çš„æ—¶å€™åº”é¿å…è¿™äº›æƒ…å†µï¼Œä¸€èµ·æ¥çœ‹çœ‹è¿™äº›æƒ…å†µå§ï¼š 1.1 ä¸éµä»æœ€å·¦å‰ç¼€è§„åˆ™å¦‚æœç´¢å¼•äº†å¤šåˆ—ï¼Œè¦éµå®ˆæœ€å·¦å‰ç¼€æ³•åˆ™ã€‚æŒ‡çš„æ˜¯æŸ¥è¯¢ä»ç´¢å¼•çš„æœ€å·¦å‰åˆ—å¼€å§‹ï¼Œå¹¶ä¸”ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ã€‚ æœ€å·¦å‰ç¼€çš„åŸç†æ¥è‡ªäºB+æ ‘å¯¹èŠ‚ç‚¹çš„æ’åºè§„åˆ™ï¼š æ‘˜è‡ªMySQLç´¢å¼•æ¦‚è¿°åŠç´¢å¼•çš„åˆ†ç±» å¦‚æœä¸æ˜¯æŒ‰ç…§ç´¢å¼•çš„æœ€å·¦åˆ—å¼€å§‹æŸ¥æ‰¾ï¼Œåˆ™æ— æ³•ä½¿ç”¨ç´¢å¼• ä¸èƒ½è·³è¿‡ç´¢å¼•ä¸­çš„åˆ— å¦‚æœæŸ¥è¯¢ä¸­æœ‰æŸä¸ªåˆ—çš„èŒƒå›´æŸ¥è¯¢ï¼Œåˆ™å…¶å³è¾¹æ‰€æœ‰åˆ—éƒ½æ— æ³•ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–æŸ¥æ‰¾ éªŒè¯æœ€å·¦å‰ç¼€è§„åˆ™ï¼š å»ºç«‹ç´¢å¼• create index idx_uname_pw_name on t_user(username,password,name); Query OK, 0 rows affected (0.05 sec) Records: 0 Duplicates: 0 Warnings: 0 ä»¥æœ€å·¦å‰ç¼€è§„åˆ™æŸ¥è¯¢ mysql&gt; explain select * from t_user where username = &#39;super&#39;; +----+-------------+--------+------------+------+-------------------+-------------------+---------+-------+------+----------+-------------+ | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra | +----+-------------+--------+------------+------+-------------------+-------------------+---------+-------+------+----------+-------------+ | 1 | SIMPLE | t_user | NULL | ref | idx_uname_pw_name | idx_uname_pw_name | 137 | const | 1 | 100.00 | Using index | +----+-------------+--------+------------+------+-------------------+-------------------+---------+-------+------+----------+-------------+ 1 row in set, 1 warning (0.00 sec)å¯è§ä½¿ç”¨äº†ç´¢å¼• ä¸ä»¥æœ€å·¦å‰ç¼€è§„åˆ™æŸ¥è¯¢ mysql&gt; explain select * from t_user where name = &#39;å­¦ç”Ÿ1&#39;; +----+-------------+--------+------------+-------+---------------+-------------------+---------+------+------+----------+--------------------------+ | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra | +----+-------------+--------+------------+-------+---------------+-------------------+---------+------+------+----------+--------------------------+ | 1 | SIMPLE | t_user | NULL | index | NULL | idx_uname_pw_name | 564 | NULL | 6 | 16.67 | Using where; Using index | +----+-------------+--------+------------+-------+---------------+-------------------+---------+------+------+----------+--------------------------+ 1 row in set, 1 warning (0.00 sec)å¯è§æ­¤æ—¶typeå˜ä¸ºäº†â€indexâ€ï¼Œæ‰«æç´¢å¼•æ ‘ã€‚ 1.2 åœ¨ç´¢å¼•ä¸Šä½¿ç”¨è¡¨è¾¾å¼ç´¢å¼•åˆ—ä¸Šä½¿ç”¨äº†è¡¨è¾¾å¼ï¼Œå¦‚ where substr(a, 1, 3) = â€˜hhhâ€™ï¼Œwhere a = a + 1ï¼Œè¡¨è¾¾å¼æ˜¯ä¸€å¤§å¿Œè®³ï¼Œå†ç®€å• MySQL ä¹Ÿä¸è®¤ã€‚ æœ‰æ—¶æ•°æ®é‡ä¸æ˜¯å¤§åˆ°ä¸¥é‡å½±å“é€Ÿåº¦æ—¶ï¼Œä¸€èˆ¬å¯ä»¥å…ˆæŸ¥å‡ºæ¥ï¼Œæ¯”å¦‚å…ˆæŸ¥æ‰€æœ‰æœ‰è®¢å•è®°å½•çš„æ•°æ®ï¼Œå†åœ¨ç¨‹åºä¸­å»ç­›é€‰ å“ªæ€•æ˜¯è¯¥å­—æ®µæ²¡æœ‰å»ºç«‹ç´¢å¼•ï¼Œä½†ä¸èƒ½ä¿è¯ä»¥åä¸åœ¨è¿™ä¸ªå­—æ®µä¸Šå»ºç«‹ç´¢å¼•ï¼Œæ‰€ä»¥å¯ä»¥è¿™ä¹ˆè¯´ï¼šä¸è¦åœ¨ä»»ä½•å­—æ®µä¸Šè¿›è¡Œæ“ä½œã€‚ mysql&gt; explain select * from t_user where left(username,2) = &#39;ad&#39;; +----+-------------+--------+------------+-------+---------------+-------------------+---------+------+------+----------+--------------------------+ | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra | +----+-------------+--------+------------+-------+---------------+-------------------+---------+------+------+----------+--------------------------+ | 1 | SIMPLE | t_user | NULL | index | NULL | idx_uname_pw_name | 564 | NULL | 6 | 100.00 | Using where; Using index | +----+-------------+--------+------------+-------+---------------+-------------------+---------+------+------+----------+--------------------------+ 1 row in set, 1 warning (0.00 sec) Note (Code 1003): /* select#1 */ select `test`.`t_user`.`id` AS `id`,`test`.`t_user`.`username` AS `username`,`test`.`t_user`.`password` AS `password`,`test`.`t_user`.`name` AS `name` from `test`.`t_user` where (left(`test`.`t_user`.`username`,2) = &#39;ad&#39;)1.3 range ç±»å‹æŸ¥è¯¢å­—æ®µåé¢çš„ç´¢å¼•æ— æ•ˆ æœ€åä¸€æ¬¡åªç”¨åˆ°äº†ä¸¤ä¸ªç´¢å¼•æ­¤æ—¶å¯ä»¥å»ºä¸€ä¸ªåªå«å‰ä¸¤ä¸ªå­—æ®µçš„ç´¢å¼•å¯¹in()æ— æ•ˆï¼Œinä»å¯ä»¥ä½¿ç”¨ç´¢å¼•ã€‚ 1.4 varcharç±»å‹ä¸åŠ å•å¼•å·ï¼Œé€ æˆç´¢å¼•å¤±æ•ˆ ç”±äºåœ¨æŸ¥è¯¢æ—¶ï¼Œæ²¡æœ‰å¯¹å­—ç¬¦ä¸²åŠ å•å¼•å·ï¼ŒMySQLçš„æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼Œä¼šè‡ªåŠ¨çš„è¿›è¡Œç±»å‹è½¬æ¢ï¼Œé€ æˆç´¢å¼•å¤±æ•ˆã€‚ 1.5 å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œé¿å…select *è¦†ç›–ç´¢å¼•çš„æ¦‚å¿µï¼Œå¾€ä¸‹ç¿»ï¼Œç´¢å¼•çš„ç‰¹æ®Šåº”ç”¨-&gt;è¦†ç›–ç´¢å¼• å¦‚æœæŸ¥è¯¢åˆ—ï¼Œè¶…å‡ºç´¢å¼•åˆ—ï¼Œä¹Ÿä¼šé™ä½æ€§èƒ½ã€‚ TIP:using index ï¼šä½¿ç”¨è¦†ç›–ç´¢å¼•çš„æ—¶å€™å°±ä¼šå‡ºç°using whereï¼šåœ¨æŸ¥æ‰¾ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œéœ€è¦å›è¡¨å»æŸ¥è¯¢æ‰€éœ€çš„æ•°æ®using index conditionï¼šæŸ¥æ‰¾ä½¿ç”¨äº†ç´¢å¼•ï¼Œä½†æ˜¯éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®â€‹using index ; using whereï¼šæŸ¥æ‰¾ä½¿ç”¨äº†ç´¢å¼•ï¼Œä½†æ˜¯éœ€è¦çš„æ•°æ®éƒ½åœ¨ç´¢å¼•åˆ—ä¸­èƒ½æ‰¾åˆ°ï¼Œæ‰€ä»¥ä¸éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ® 1.6 ä½¿ç”¨ä¸ç­‰äºæ—¶ç´¢å¼•å¤±æ•ˆ 1.7 is (not) null æ—¶æœ‰æ—¶ç´¢å¼•å¤±æ•ˆ å¤±æ•ˆçš„æƒ…å†µå…¶å®æ˜¯MySQLè¯„ä¼°ä½¿ç”¨ç´¢å¼•æ¯”å…¨è¡¨æ›´æ…¢ï¼Œè§æœ€åä¸€ç‚¹ã€‚ 1.8 like ä»¥é€šé…ç¬¦å¼€å¤´ä¼šå¯¼è‡´å…¨è¡¨æ‰«æ 1.9 ä½¿ç”¨ or æ—¶ç´¢å¼•å¤±æ•ˆ å¦‚æœorå‰çš„æ¡ä»¶ä¸­çš„åˆ—æœ‰ç´¢å¼•ï¼Œè€Œåé¢çš„åˆ—ä¸­æ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆæ¶‰åŠçš„ç´¢å¼•éƒ½ä¸ä¼šè¢«ç”¨åˆ°ã€‚ å…¶å®è¿˜è›®å¥½ç†è§£çš„ï¼Œå› ä¸ºæ²¡æœ‰ç´¢å¼•çš„åˆ—ç¬¦åˆæ¡ä»¶ä¹Ÿæ»¡è¶³orï¼Œè‡ªç„¶è¦å…¨è¡¨æ‰«æã€‚ 1.10 in èµ°ç´¢å¼•ï¼Œ not in ç´¢å¼•å¤±æ•ˆ 1.11 å¦‚æœMySQLè¯„ä¼°ä½¿ç”¨ç´¢å¼•æ¯”å…¨è¡¨æ›´æ…¢ï¼Œåˆ™ä¸ä½¿ç”¨ç´¢å¼•ã€‚è¿™ä¸ªä¸œè¥¿å°±å¾ˆç„å­¦äº†ï¼Œå…¸å‹æƒ…å†µæ˜¯æŸ¥è¯¢çš„æƒ…å†µå äº†æ•´è¡¨å¤§å¤šæ•°ã€‚ 2 ç´¢å¼•çš„ç‰¹æ®Šåº”ç”¨2.1 InnoDB AUTO_INCREMENT2.1.1 æ¦‚è¿°å¦‚æœæ­£åœ¨ä½¿ç”¨ InnoDB è¡¨å¹¶ä¸”æ²¡æœ‰ä»€ä¹ˆæ•°æ®éœ€è¦èšé›†ï¼Œé‚£ä¹ˆå¯ä»¥å®šä¹‰ä¸€ä¸ªä»£ç†é”®ä½œä¸ºä¸»é”®ï¼Œè¿™ç§ä¸»é”®çš„æ•°æ®åº”è¯¥ä¸åº”ç”¨æ— å…³ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ AUTO_INCREMENT è‡ªå¢åˆ—ã€‚è¿™æ ·å¯ä»¥ä¿è¯æ•°æ®è¡Œæ˜¯æŒ‰é¡ºåºå†™å…¥çš„ï¼Œå¯¹äºæ ¹æ®ä¸»é”®åšå…³è”æ“ä½œçš„æ€§èƒ½ä¹Ÿä¼šæ›´å¥½ã€‚ æœ€å¥½é¿å…éšæœºçš„èšç°‡ç´¢å¼•ï¼Œç‰¹åˆ«æ˜¯å¯¹äº IO å¯†é›†å‹åº”ç”¨ï¼Œæ¯”å¦‚ UUIDï¼Œå®ƒä½¿å¾—èšç°‡ç´¢å¼•çš„æ’å…¥å˜å¾—å®Œå…¨éšæœºï¼Œè¿™æ˜¯æœ€åçš„æƒ…å†µï¼Œä½¿å¾—æ•°æ®æ²¡æœ‰ä»»ä½•èšé›†ç‰¹æ€§ã€‚ é¡ºåºä¸»é”®çš„ä¼˜ç‚¹ï¼š å¦‚æœä¸»é”®çš„å€¼æ˜¯é¡ºåºçš„ï¼Œé‚£ä¹ˆ InnoDB ä¼šæŠŠæ¯ä¸€æ¡è®°å½•éƒ½å­˜å‚¨åœ¨ä¸Šä¸€æ¡è®°å½•çš„åé¢ã€‚å½“è¾¾åˆ°é¡µçš„æœ€å¤§å¡«å……å› å­æ—¶ï¼Œä¸‹ä¸€æ¡è®°å½•å°±ä¼šå†™å…¥æ–°çš„é¡µä¸­ã€‚ä¸€æ—¦æ•°æ®æŒ‰ç…§è¿™ç§é¡ºåºçš„æ–¹å¼åŠ è½½ï¼Œä¸»é”®é¡µå°±ä¼šè¿‘ä¼¼äºè¢«é¡ºåºçš„è®°å½•å¡«æ»¡ï¼Œè¿™ä¹Ÿæ­£æ˜¯æ‰€æœŸæœ›çš„ç»“æœã€‚ é¡ºåºä¸»é”®çš„ç¼ºç‚¹ï¼š å¯¹äºé«˜å¹¶å‘å·¥ä½œè´Ÿè½½ï¼Œåœ¨ InnoDB ä¸­æŒ‰ä¸»é”®é¡ºåºæ’å…¥å¯èƒ½ä¼šé€ æˆæ˜æ˜¾çš„äº‰ç”¨ã€‚ä¸»é”®çš„ä¸Šç•Œä¼šæˆä¸ºçƒ­ç‚¹ã€‚å› ä¸ºæ‰€æœ‰çš„æ’å…¥éƒ½åœ¨è¿™é‡Œï¼Œæ‰€ä»¥å¹¶å‘æ’å…¥å¯èƒ½å¯¼è‡´é”ç«äº‰ã€‚å¦ä¸€ä¸ªçƒ­ç‚¹å¯èƒ½æ˜¯AUTO_INCREMENT é”æœºåˆ¶ï¼Œå¯èƒ½éœ€è¦é‡æ–°è®¾è®¡è¡¨æˆ–åº”ç”¨ã€‚ 2.1.2 AUTO-INCé”æœºåˆ¶AUTO-INCé”æ˜¯å½“å‘ä½¿ç”¨å«æœ‰AUTO_INCREMENTåˆ—çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶éœ€è¦è·å–çš„ä¸€ç§ç‰¹æ®Šçš„è¡¨çº§é”ã€‚ åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡æ­£åœ¨å‘è¡¨ä¸­æ’å…¥å€¼ï¼Œåˆ™ä»»ä½•å…¶ä»–äº‹åŠ¡å¿…é¡»ç­‰å¾…å¯¹è¯¥è¡¨æ‰§è¡Œè‡ªå·±çš„æ’å…¥æ“ä½œï¼Œä»¥ä¾¿ç¬¬ä¸€ä¸ªäº‹åŠ¡æ’å…¥çš„è¡Œçš„å€¼æ˜¯è¿ç»­çš„ã€‚ InnoDB ä¼šåœ¨å†…å­˜é‡Œä¿å­˜ä¸€ä¸ªè®¡æ•°å™¨ç”¨æ¥è®°å½• AUTO_INCREMENT çš„å€¼ï¼Œå½“æ’å…¥ä¸€ä¸ªæ–°è¡Œæ•°æ®æ—¶ï¼Œå°±ä¼šç”¨ä¸€ä¸ªè¡¨é”æ¥é”ä½è¿™ä¸ªè®¡æ•°å™¨ï¼Œç›´åˆ°æ’å…¥ç»“æŸã€‚å¦‚æœä¸€è¡Œä¸€è¡Œçš„æ’å…¥æ•°æ®åˆ™æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœå¤§é‡çš„å¹¶å‘æ’å…¥å°±åºŸäº†ï¼Œè¡¨é”ä¼šå¼•èµ· SQL å µå¡ï¼Œä¸ä½†å½±å“æ•ˆç‡ï¼Œè€Œä¸”å¯èƒ½ä¼šç¬é—´è¾¾åˆ° MAX_CONNECTION è€Œå´©æºƒã€‚ æ’å…¥ç±»å‹ï¼š simple insertssimple inserts æŒ‡çš„æ˜¯é‚£ç§èƒ½å¤Ÿäº‹å…ˆç¡®å®šæ’å…¥è¡Œæ•°çš„è¯­å¥ï¼Œæ¯”å¦‚ INSERT/REPLACE INTO ç­‰æ’å…¥å•è¡Œæˆ–è€…å¤šè¡Œçš„è¯­å¥ï¼Œè¯­å¥ä¸­ä¸åŒ…æ‹¬åµŒå¥—å­æŸ¥è¯¢ã€‚æ­¤å¤–ï¼ŒINSERT INTO â€¦ ON DUPLICATE KEY UPDATE è¿™ç±»è¯­å¥ä¹Ÿè¦é™¤å¤–ã€‚ bulk insertsbulk inserts æŒ‡çš„æ˜¯äº‹å…ˆæ— æ³•ç¡®å®šæ’å…¥è¡Œæ•°çš„è¯­å¥ï¼Œæ¯”å¦‚ INSERT/REPLACE INTO â€¦ SELECT,LOAD DATA ç­‰ã€‚ mixed-mode insertsæŒ‡çš„æ˜¯ simple inserts ç±»å‹ä¸­æœ‰äº›è¡ŒæŒ‡å®šäº† auto_increment åˆ—çš„å€¼ï¼Œæœ‰äº›è¡Œæ²¡æœ‰æŒ‡å®šï¼Œæ¯”å¦‚ï¼šINSERT INTO t1 (c1,c2) VALUES (1,â€™aâ€™), (NULL,â€™bâ€™), (5,â€™câ€™), (NULL,â€™dâ€™);å¦å¤–ä¸€ç§ mixed-mode inserts æ˜¯ INSERT â€¦ ON DUPLICATE KEY UPDATE è¿™ç§è¯­å¥ï¼Œå¯èƒ½å¯¼è‡´åˆ†é…çš„ auto_increment å€¼æ²¡æœ‰è¢«ä½¿ç”¨ã€‚ innodb_autoinc_lock_mode é…ç½®é€‰é¡¹æ§åˆ¶ç”¨äºè‡ªåŠ¨å¢é‡é”å®šçš„ç®—æ³•ã€‚ å®ƒå…è®¸æ‚¨é€‰æ‹©å¦‚ä½•åœ¨å¯é¢„æµ‹çš„è‡ªåŠ¨é€’å¢å€¼åºåˆ—å’Œæ’å…¥æ“ä½œçš„æœ€å¤§å¹¶å‘æ€§ä¹‹é—´è¿›è¡Œæƒè¡¡ï¼Œé…ç½®è¯­æ³•ï¼š innodb_autoinc_lock_mode=xï¼Œxå¯å–å€¼ï¼š 0ï¼Œä¼ ç»Ÿçš„ auto_increment æœºåˆ¶ã€‚è¿™ç§æ¨¡å¼ä¸‹æ‰€æœ‰é’ˆå¯¹ auto_increment åˆ—çš„æ’å…¥æ“ä½œéƒ½ä¼šåŠ AUTO-INC é”ï¼Œåˆ†é…çš„å€¼ä¹Ÿæ˜¯ä¸€ä¸ªä¸ªåˆ†é…ï¼Œæ˜¯è¿ç»­çš„ï¼Œæ­£å¸¸æƒ…å†µä¸‹ä¹Ÿä¸ä¼šæœ‰é—´éš™ï¼ˆå½“ç„¶å¦‚æœäº‹åŠ¡ rollback äº†è¿™ä¸ª auto_increment å€¼å°±ä¼šæµªè´¹æ‰ï¼Œä»è€Œé€ æˆé—´éš™ï¼‰ã€‚ 1ï¼Œè¿™ç§æƒ…å†µä¸‹ é’ˆå¯¹ bulk inserts æ‰ä¼šé‡‡ç”¨ AUTO-INC é”è¿™ç§æ–¹å¼ é’ˆå¯¹ simple insertsï¼Œåˆ™ç›´æ¥é€šè¿‡åˆ†æè¯­å¥ï¼Œè·å¾—è¦æ’å…¥çš„æ•°é‡ï¼Œç„¶åä¸€æ¬¡æ€§åˆ†é…è¶³å¤Ÿçš„ auto_increment idï¼Œåªä¼šå°†æ•´ä¸ªåˆ†é…çš„è¿‡ç¨‹é”ä½ã€‚ã€‚å½“ç„¶ï¼Œå¦‚æœå…¶ä»–äº‹åŠ¡å·²ç»æŒæœ‰äº†AUTO-INCé”ï¼Œåˆ™simple insertséœ€è¦ç­‰å¾…. é’ˆå¯¹ Mixed-mode insertsï¼šç›´æ¥åˆ†æè¯­å¥ï¼Œè·å¾—æœ€åæƒ…å†µä¸‹éœ€è¦æ’å…¥çš„æ•°é‡ï¼Œç„¶åä¸€æ¬¡æ€§åˆ†é…è¶³å¤Ÿçš„ auto_increment idï¼Œåªä¼šå°†æ•´ä¸ªåˆ†é…çš„è¿‡ç¨‹é”ä½ã€‚ä¿è¯åŒä¸€æ¡ insert è¯­å¥ä¸­æ–°æ’å…¥çš„ auto_increment id éƒ½æ˜¯è¿ç»­çš„ï¼Œè¯­å¥ä¹‹é—´æ˜¯å¯èƒ½å‡ºç°auto_increment å€¼çš„ç©ºéš™çš„ã€‚æ¯”å¦‚ mixed-mode inserts ä»¥åŠ bulk inserts ä¸­éƒ½æœ‰å¯èƒ½å¯¼è‡´ä¸€äº›åˆ†é…çš„ auto_increment å€¼è¢«æµªè´¹æ‰ä»è€Œå¯¼è‡´é—´éš™ã€‚ 2ï¼Œè¿™ç§æ¨¡å¼ä¸‹ä»»ä½•ç±»å‹çš„ inserts éƒ½ä¸ä¼šé‡‡ç”¨ AUTO-INC é”ï¼Œæ€§èƒ½æœ€å¥½ã€‚è¿™ç§æ¨¡å¼æ˜¯æ¥ä¸€ä¸ªåˆ†é…ä¸€ä¸ªï¼Œè€Œä¸ä¼šé”è¡¨ï¼Œåªä¼šé”ä½åˆ†é… id çš„è¿‡ç¨‹ï¼Œå’Œ innodb_autoinc_lock_mode = 1 çš„åŒºåˆ«åœ¨äºï¼Œä¸ä¼šé¢„åˆ†é…å¤šä¸ªã€‚ä½†æ˜¯åœ¨ replication ä¸­å½“ binlog_format ä¸º statement-based æ—¶ï¼ˆç®€ç§° SBR statement-based replicationï¼‰å­˜åœ¨é—®é¢˜ï¼Œå› ä¸ºæ˜¯æ¥ä¸€ä¸ªåˆ†é…ä¸€ä¸ªï¼Œè¿™æ ·å½“å¹¶å‘æ‰§è¡Œæ—¶ï¼Œâ€œBulk insertsâ€åœ¨åˆ†é…æ—¶ä¼šåŒæ—¶å‘å…¶ä»–çš„ INSERT åˆ†é…ï¼Œä¼šå‡ºç°ä¸»ä»ä¸ä¸€è‡´ï¼ˆä»åº“æ‰§è¡Œç»“æœå’Œä¸»åº“æ‰§è¡Œç»“æœä¸ä¸€æ ·ï¼‰ï¼Œå› ä¸º binlog åªä¼šè®°å½•å¼€å§‹çš„ insert idã€‚å¯èƒ½ä¼šåœ¨åŒä¸€æ¡è¯­å¥å†…éƒ¨äº§ç”Ÿ auto_increment å€¼é—´éš™ã€‚ 2.2 è¦†ç›–ç´¢å¼•å¦‚æœä¸€ä¸ªç´¢å¼•åŒ…å«äº†æ‰€æœ‰éœ€è¦æŸ¥è¯¢å­—æ®µçš„å€¼ï¼Œå°±ç§°ä¸ºè¦†ç›–ç´¢å¼•ã€‚ è¦†ç›–ç´¢å¼•çš„ä¼˜ç‚¹ï¼š ç´¢å¼•æ¡ç›®è¿œå°‘äºæ•°æ®è¡Œå¤§å°ï¼Œå¦‚æœåªéœ€è¦è¯»å–ç´¢å¼•ï¼Œåˆ™ MySQL å°±ä¼šæå¤§åœ°å‡å°‘æ•°æ®è®¿é—®äº†ï¼Œè¿™å¯¹ç¼“å­˜çš„è´Ÿè½½éå¸¸é‡è¦ï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¸‹å“åº”æ—¶é—´å¤§éƒ¨åˆ†èŠ±è´¹åœ¨æ•°æ®æ‹·è´ä¸Šã€‚è¦†ç›–ç´¢å¼•å¯¹ IO å¯†é›†å‹åº”ç”¨ä¹Ÿæœ‰å¸®åŠ©ï¼Œå› ä¸ºç´¢å¼•æ¯”æ•°æ®æ›´å°ï¼Œæ›´å®¹æ˜“å…¨éƒ¨æ”¾å…¥å†…å­˜ä¸­ã€‚ å› ä¸ºç´¢å¼•æ˜¯æŒ‰ç…§åˆ—å€¼é¡ºåºå­˜å‚¨çš„ï¼Œå¯¹äº IO å¯†é›†å‹çš„èŒƒå›´æŸ¥è¯¢ä¼šæ¯”éšæœºä»ç£ç›˜è¯»å–æ¯ä¸€è¡Œæ•°æ®çš„ IO æ¬¡æ•°ä¼šå°‘å¾—å¤šã€‚ InnoDB çš„äºŒçº§ç´¢å¼•åœ¨å¶èŠ‚ç‚¹ä¸­ä¿å­˜äº†è¡Œçš„ä¸»é”®å€¼ï¼Œå¦‚æœäºŒçº§ç´¢å¼•æ˜¯è¦†ç›–ç´¢å¼•ï¼Œåˆ™å¯ä»¥é¿å…å¯¹ä¸»é”®èšç°‡ç´¢å¼•çš„äºŒæ¬¡æŸ¥è¯¢ã€‚ ä¸æ˜¯æ‰€æœ‰ç±»å‹çš„ç´¢å¼•éƒ½å¯ä»¥æˆä¸ºè¦†ç›–ç´¢å¼•ã€‚è¦†ç›–ç´¢å¼•å¿…é¡»è¦å­˜å‚¨ç´¢å¼•åˆ—çš„å€¼ï¼Œè€Œå“ˆå¸Œç´¢å¼•ã€ç©ºé—´ç´¢å¼•å’Œå…¨æ–‡ç´¢å¼•éƒ½ä¸å­˜å‚¨ç´¢å¼•åˆ—çš„å€¼ï¼Œæ‰€ä»¥ MySQL åªèƒ½ä½¿ç”¨ B æ ‘ç´¢å¼•åšè¦†ç›–ç´¢å¼•ã€‚å½“å‘èµ·ä¸€ä¸ªç´¢å¼•è¦†ç›–æŸ¥è¯¢æ—¶ï¼Œåœ¨ EXPLAIN çš„ Extra åˆ—å¯ä»¥çœ‹åˆ° Using index çš„ä¿¡æ¯ã€‚InnoDB çš„äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹éƒ½åŒ…å«äº†ä¸»é”®çš„å€¼ï¼Œè¿™æ„å‘³ç€ InnoDB çš„äºŒçº§ç´¢å¼•å¯ä»¥æœ‰æ•ˆåˆ©ç”¨è¿™äº›é¢å¤–çš„ä¸»é”®åˆ—æ¥è¦†ç›–æŸ¥è¯¢ã€‚ 2.3 ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åºMySQL æœ‰ä¸¤ç§å¯ä»¥ç”Ÿæˆæœ‰åºçš„ç»“æœï¼šé€šè¿‡æ’åºæ“ä½œï¼›æŒ‰ç´¢å¼•é¡ºåºæ‰«æã€‚å¦‚æœ EXPLAIN å‡ºæ¥çš„ type åˆ—çš„å€¼ä¸º indexï¼Œåˆ™è¯´æ˜ MySQL ä½¿ç”¨äº†ç´¢å¼•é¡ºåºæ‰«ææ¥åšæ’åºã€‚ æ‰«æç´¢å¼•æœ¬èº«æ˜¯å¾ˆå¿«çš„ï¼Œä½†å¦‚æœç´¢å¼•ä¸èƒ½è¦†ç›–æŸ¥è¯¢æ‰€éœ€çš„å…¨éƒ¨åˆ—ï¼Œé‚£å°±ä¸å¾—ä¸æ¯æ‰«æä¸€æ¡ç´¢å¼•è®°å½•å°±éƒ½å›è¡¨æŸ¥è¯¢ä¸€æ¬¡å¯¹åº”çš„è¡Œã€‚è¿™åŸºæœ¬ä¸Šéƒ½æ˜¯éšæœº IOï¼Œå› æ­¤æŒ‰ç´¢å¼•é¡ºåºè¯»å–æ•°æ®çš„é€Ÿåº¦é€šå¸¸è¦æ¯”é¡ºåºåœ°å…¨è¡¨æ‰«æè¦æ…¢ï¼Œå°¤å…¶æ˜¯åœ¨ IO å¯†é›†å‹çš„å·¥ä½œè´Ÿè½½æ—¶ã€‚åªæœ‰å½“ç´¢å¼•çš„åˆ—é¡ºåºå’Œ ORDER BY å­å¥çš„é¡ºåºå®Œå…¨ä¸€è‡´ï¼Œå¹¶ä¸”æ‰€æœ‰åˆ—çš„æ’åºæ–¹å‘ï¼ˆé™åºæˆ–å‡åºï¼Œç´¢å¼•é»˜è®¤æ˜¯å‡åºï¼‰éƒ½ä¸€æ ·æ—¶ï¼ŒMySQL æ‰å¯ä»¥ä½¿ç”¨ç´¢å¼•æ¥å¯¹ç»“æœåšæ’åºã€‚å¦‚æœæŸ¥è¯¢éœ€è¦å…³è”å¤šå¼ è¡¨ï¼Œåˆ™åªæœ‰å½“ ORDER BY å­å¥å¼•ç”¨çš„å­—æ®µå…¨éƒ¨ä¸ºç¬¬ä¸€å¼ è¡¨æ—¶ï¼Œæ‰èƒ½ä½¿ç”¨ç´¢å¼•åšæ’åºã€‚ORDER BY å­å¥å’ŒæŸ¥æ‰¾å‹ç´¢å¼•çš„é™åˆ¶æ˜¯ä¸€æ ·çš„ï¼Œéƒ½éœ€è¦æ»¡è¶³ç´¢å¼•çš„æœ€å·¦å‰ç¼€çš„è¦æ±‚ã€‚æœ‰ä¸€ç§æƒ…å†µä¸‹ ORDER BY å­å¥å¯ä»¥ä¸æ»¡è¶³ç´¢å¼•çš„æœ€å·¦å‰ç¼€çš„è¦æ±‚ï¼Œå°±æ˜¯å‰å¯¼åˆ—ä¸ºå¸¸é‡çš„æ—¶å€™ã€‚ 2.4 å‰ç¼€å‹ç¼©ç´¢å¼•MyISAM é€šè¿‡å‰ç¼€å‹ç¼©æ¥å‡å°‘ç´¢å¼•çš„å¤§å°ï¼Œä»è€Œè®©æ›´å¤šçš„ç´¢å¼•å¯ä»¥æ”¾å…¥å†…å­˜ä¸­ã€‚é»˜è®¤åªå‹ç¼©å­—ç¬¦ä¸²ï¼Œä½†é€šè¿‡å‚æ•°è°ƒæ•´ä¹Ÿèƒ½å¯¹æ•´æ•°è¿›è¡Œå‹ç¼©ã€‚ MyISAM å‹ç¼©æ¯ä¸ªç´¢å¼•å—çš„æ–¹æ³•æ—¶ï¼Œå…ˆå®Œå…¨ä¿å­˜ç´¢å¼•å—çš„ç¬¬ä¸€ä¸ªå€¼ï¼Œç„¶åå°†å…¶ä»–å€¼å’Œç¬¬ä¸€ä¸ªå€¼è¿›è¡Œæ¯”è¾ƒå¾—åˆ°ç›¸åŒå‰ç¼€çš„å­—èŠ‚æ•°å’Œå‰©ä½™çš„ä¸åŒåç¼€éƒ¨åˆ†ï¼ŒæŠŠè¿™éƒ¨åˆ†å­˜å‚¨èµ·æ¥å³å¯ã€‚å‹ç¼©å—ä½¿ç”¨æ›´å°‘çš„æƒ…å†µï¼Œä»£ä»·æ˜¯æŸäº›æ“ä½œå¯èƒ½æ›´æ…¢ã€‚å› ä¸ºæ¯ä¸ªå€¼çš„å‹ç¼©å‰ç¼€éƒ½ä¾èµ–å‰é¢çš„å€¼ï¼Œæ‰€ä»¥ MyISAM æŸ¥æ‰¾æ—¶æ— æ³•åœ¨ç´¢å¼•å—ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾è€Œåªèƒ½ä»å¤´å¼€å§‹æ‰«æã€‚ 2.5 å†—ä½™å’Œé‡å¤ç´¢å¼•å†—ä½™ç´¢å¼•ï¼šMySQL å…è®¸åœ¨ç›¸åŒåˆ—ä¸Šåˆ›å»ºå¤šä¸ªç´¢å¼•ã€‚MySQL éœ€è¦å•ç‹¬ç»´æŠ¤é‡å¤çš„ç´¢å¼•ï¼Œå¹¶ä¸”ä¼˜åŒ–å™¨åœ¨ä¼˜åŒ–æŸ¥è¯¢æ—¶ä¹Ÿéœ€è¦é€ä¸ªåœ°è¿›è¡Œè€ƒè™‘ï¼Œè¿™ä¼šå½±å“æ€§èƒ½ã€‚ é‡å¤ç´¢å¼•æ˜¯æŒ‡åœ¨ç›¸åŒçš„åˆ—ä¸ŠæŒ‰ç…§ç›¸åŒçš„é¡ºåºåˆ›å»ºçš„ç›¸åŒç±»å‹çš„ç´¢å¼•ï¼ˆå®Œå…¨ç›¸åŒï¼‰ï¼Œåº”è¯¥é¿å…è¿™æ ·åˆ›å»ºé‡å¤ç´¢å¼•ï¼Œå‘ç°ä»¥åä¹Ÿåº”è¯¥ç«‹å³ç§»é™¤ã€‚ å†—ä½™ç´¢å¼•å’Œé‡å¤ç´¢å¼•æœ‰ä¸€äº›ä¸åŒã€‚å¦‚æœåˆ›å»ºäº†ç´¢å¼•(A,B)ï¼Œåˆåˆ›å»ºäº†ç´¢å¼•(A)å°±æ˜¯å†—ä½™ç´¢å¼•ï¼Œç´¢å¼•(A,B)ä¹Ÿå¯ä»¥å½“åšç´¢å¼•(A)æ¥ä½¿ç”¨ã€‚ä½†æ˜¯å¦‚æœå†åˆ›å»ºç´¢å¼•(B,A)ï¼Œå°±ä¸æ˜¯å†—ä½™ç´¢å¼•ã€‚å¦å¤–ï¼Œå…¶ä»–ä¸åŒç±»å‹çš„ç´¢å¼•ä¹Ÿä¸ä¼šæ˜¯ B æ ‘ç´¢å¼•çš„å†—ä½™ç´¢å¼•ã€‚ å†—ä½™ç´¢å¼•é€šå¸¸å‘ç”Ÿåœ¨ä¸ºè¡¨æ·»åŠ æ–°ç´¢å¼•çš„æ—¶å€™ã€‚ä¾‹å¦‚ï¼Œæœ‰äººå¯èƒ½ä¼šå¢åŠ ä¸€ä¸ªæ–°çš„ç´¢å¼•(A,B)è€Œä¸æ˜¯æ‰©å±•å·²æœ‰çš„ç´¢å¼•(A)ï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯å°†ä¸€ä¸ªç´¢å¼•æ‰©å±•ä¸º(A,PK)ï¼Œå¯¹äº InnoDB è€Œè¨€ PK å·²ç»åŒ…å«åœ¨äºŒçº§ç´¢å¼•ä¸­äº†ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯å†—ä½™çš„ã€‚ å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½ä¸éœ€è¦å†—ä½™ç´¢å¼•ï¼Œåº”è¯¥å°½é‡æ‰©å±•å·²æœ‰çš„ç´¢å¼•è€Œä¸æ˜¯åˆ›å»ºæ–°ç´¢å¼•ã€‚ä½†ä¹Ÿæœ‰æ—¶å€™å‡ºäºæ€§èƒ½æ–¹é¢çš„è€ƒè™‘éœ€è¦å†—ä½™ç´¢å¼•ï¼Œå› ä¸ºæ‰©å±•å·²æœ‰çš„ç´¢å¼•ä¼šå¯¼è‡´å…¶å˜å¾—å¤ªå¤§ï¼Œä»è€Œå½±å“å…¶ä»–ä½¿ç”¨è¯¥ç´¢å¼•çš„æŸ¥è¯¢çš„æ€§èƒ½ã€‚ ä¾‹å¦‚ï¼Œç°åœ¨åœ¨æ•´æ•°åˆ—ä¸Šæœ‰ä¸€ä¸ªç´¢å¼•ï¼Œéœ€è¦é¢å¤–å¢åŠ ä¸€ä¸ªå¾ˆé•¿çš„ VARCHAR åˆ—æ¥æ‰©å±•è¯¥ç´¢å¼•ï¼Œé‚£æ€§èƒ½å¯èƒ½ä¼šæ€¥å‰§ä¸‹é™ã€‚å¯ä»¥ä½¿ç”¨ä¸€äº›å·¥å…·æ¥æ‰¾å‡ºå†—ä½™å’Œé‡å¤çš„ç´¢å¼•ã€‚ 2.6 ç´¢å¼•é‡ç”¨ç°æœ‰ç´¢å¼•(A,B,C)ï¼Œå¦‚æœè¦ä½¿ç”¨ç´¢å¼•ï¼Œé‚£ä¹ˆ where ä¸­å¿…é¡»å†™ä¸º A=a and B = b and C = cã€‚å¦‚æœæ²¡æœ‰å¯¹ B çš„ç­›é€‰ï¼Œè¿˜æƒ³ä½¿ç”¨ç´¢å¼•ï¼Œæ€ä¹ˆç»•è¿‡æœ€å·¦å‰ç¼€åŒ¹é…å‘¢ï¼Ÿ å‡è®¾ B æ˜¯ä¸€ä¸ªé€‰æ‹©æ€§å¾ˆä½çš„åˆ—ï¼Œåªæœ‰ b1 å’Œ b2 ä¸¤ç§å–å€¼ï¼Œé‚£ä¹ˆæŸ¥è¯¢å¯ä»¥å†™ä¸º A = a and Bin(b1,b2) and C = cã€‚ 2.7 é¿å…å¤šä¸ªèŒƒå›´æ¡ä»¶å¯¹äºèŒƒå›´æ¡ä»¶æŸ¥è¯¢ï¼ŒMySQL æ— æ³•å†ä½¿ç”¨èŒƒå›´åˆ—åé¢çš„å…¶ä»–ç´¢å¼•åˆ—äº†ï¼Œä½†æ˜¯å¯¹äºå¤šä¸ªç­‰å€¼æ¡ä»¶æŸ¥è¯¢ï¼ˆin â€¦ï¼‰åˆ™æ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‚ å‡è®¾æœ‰ç´¢å¼•(A,B)ï¼ŒæŸ¥è¯¢æ¡ä»¶ä¸º A &gt; a and B &lt; bï¼Œé‚£ä¹ˆæ­¤æ—¶æ— æ³•åŒæ—¶ä½¿ç”¨ A å’Œ B çš„å¤åˆç´¢å¼•ï¼Œåªèƒ½ç”¨åˆ° A çš„ç´¢å¼•ã€‚ä¸€å®šè¦ç”¨çš„è¯å¯ä»¥è€ƒè™‘å°† A è½¬ä¸º in(a1,a2â€¦)ã€‚ 3 æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µshow status like 'Handler_read%'; show global status like 'Handler_read%'; è¿™ä¸¤æ¡è¯­å¥å¯ä»¥æŸ¥çœ‹mysqlç´¢å¼•çš„ä½¿ç”¨æƒ…å†µï¼š mysql&gt; show status like &#39;Handler_read%&#39;; +-----------------------+-------+ | Variable_name | Value | +-----------------------+-------+ | Handler_read_first | 40 | | Handler_read_key | 43 | | Handler_read_last | 0 | | Handler_read_next | 306 | | Handler_read_prev | 0 | | Handler_read_rnd | 0 | | Handler_read_rnd_next | 18832 | +-----------------------+-------+ 7 rows in set (0.00 sec)Handler_read_firstï¼šç´¢å¼•ä¸­ç¬¬ä¸€æ¡è¢«è¯»çš„æ¬¡æ•°ã€‚å¦‚æœè¾ƒé«˜ï¼Œè¡¨ç¤ºæœåŠ¡å™¨æ­£æ‰§è¡Œå¤§é‡å…¨ç´¢å¼•æ‰«æï¼ˆè¿™ä¸ªå€¼è¶Šä½è¶Šå¥½ï¼‰ã€‚ Handler_read_keyï¼šå¦‚æœç´¢å¼•æ­£åœ¨å·¥ä½œï¼Œè¿™ä¸ªå€¼ä»£è¡¨ä¸€ä¸ªè¡Œè¢«ç´¢å¼•å€¼è¯»çš„æ¬¡æ•°ï¼Œå¦‚æœå€¼è¶Šä½ï¼Œè¡¨ç¤ºç´¢å¼•å¾—åˆ°çš„æ€§èƒ½æ”¹å–„ä¸é«˜ï¼Œå› ä¸ºç´¢å¼•ä¸ç»å¸¸ä½¿ç”¨ï¼ˆè¿™ä¸ªå€¼è¶Šé«˜è¶Šå¥½ï¼‰ã€‚ Handler_read_next ï¼šæŒ‰ç…§é”®é¡ºåºè¯»ä¸‹ä¸€è¡Œçš„è¯·æ±‚æ•°ã€‚å¦‚æœä½ ç”¨èŒƒå›´çº¦æŸæˆ–å¦‚æœæ‰§è¡Œç´¢å¼•æ‰«ææ¥æŸ¥è¯¢ç´¢å¼•åˆ—ï¼Œè¯¥å€¼å¢åŠ ã€‚ Handler_read_prevï¼šæŒ‰ç…§é”®é¡ºåºè¯»å‰ä¸€è¡Œçš„è¯·æ±‚æ•°ã€‚è¯¥è¯»æ–¹æ³•ä¸»è¦ç”¨äºä¼˜åŒ–ORDER BY â€¦ DESCã€‚ Handler_read_rnd ï¼šæ ¹æ®å›ºå®šä½ç½®è¯»ä¸€è¡Œçš„è¯·æ±‚æ•°ã€‚å¦‚æœä½ æ­£æ‰§è¡Œå¤§é‡æŸ¥è¯¢å¹¶éœ€è¦å¯¹ç»“æœè¿›è¡Œæ’åºè¯¥å€¼è¾ƒé«˜ã€‚ä½ å¯èƒ½ä½¿ç”¨äº†å¤§é‡éœ€è¦MySQLæ‰«ææ•´ä¸ªè¡¨çš„æŸ¥è¯¢æˆ–ä½ çš„è¿æ¥æ²¡æœ‰æ­£ç¡®ä½¿ç”¨é”®ã€‚è¿™ä¸ªå€¼è¾ƒé«˜ï¼Œæ„å‘³ç€è¿è¡Œæ•ˆç‡ä½ï¼Œåº”è¯¥å»ºç«‹ç´¢å¼•æ¥è¡¥æ•‘ã€‚ Handler_read_rnd_nextï¼šåœ¨æ•°æ®æ–‡ä»¶ä¸­è¯»ä¸‹ä¸€è¡Œçš„è¯·æ±‚æ•°ã€‚å¦‚æœä½ æ­£è¿›è¡Œå¤§é‡çš„è¡¨æ‰«æï¼Œè¯¥å€¼è¾ƒé«˜ã€‚é€šå¸¸è¯´æ˜ä½ çš„è¡¨ç´¢å¼•ä¸æ­£ç¡®æˆ–å†™å…¥çš„æŸ¥è¯¢æ²¡æœ‰åˆ©ç”¨ç´¢å¼•ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"ä¼˜åŒ–","slug":"ä¼˜åŒ–","permalink":"https://www.codetool.top/tags/%E4%BC%98%E5%8C%96/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"MySQL","slug":"MySQL","permalink":"https://www.codetool.top/tags/MySQL/"}]},{"title":"SQLä¼˜åŒ–å‰ç½®çŸ¥è¯†ä¹‹ä¼˜åŒ–å‰åˆ†æ","slug":"SQLä¼˜åŒ–å‰ç½®çŸ¥è¯†ä¹‹ä¼˜åŒ–å‰åˆ†æ","date":"2020-03-05T07:41:38.000Z","updated":"2020-03-07T09:45:15.111Z","comments":true,"path":"article/SQLä¼˜åŒ–å‰ç½®çŸ¥è¯†ä¹‹ä¼˜åŒ–å‰åˆ†æ/","link":"","permalink":"https://www.codetool.top/article/SQL%E4%BC%98%E5%8C%96%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86%E4%B9%8B%E4%BC%98%E5%8C%96%E5%89%8D%E5%88%86%E6%9E%90/","excerpt":"","text":"åœ¨åº”ç”¨çš„çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç”±äºåˆæœŸæ•°æ®é‡å°ï¼Œå¼€å‘äººå‘˜å†™ SQL è¯­å¥æ—¶æ›´é‡è§†åŠŸèƒ½ä¸Šçš„å®ç°ï¼Œä½†æ˜¯å½“åº”ç”¨ç³»ç»Ÿæ­£å¼ä¸Šçº¿åï¼Œéšç€ç”Ÿäº§æ•°æ®é‡çš„æ€¥å‰§å¢é•¿ï¼Œå¾ˆå¤š SQL è¯­å¥å¼€å§‹é€æ¸æ˜¾éœ²å‡ºæ€§èƒ½é—®é¢˜ï¼Œå¯¹ç”Ÿäº§çš„å½±å“ä¹Ÿè¶Šæ¥è¶Šå¤§ï¼Œæ­¤æ—¶è¿™äº›æœ‰é—®é¢˜çš„ SQL è¯­å¥å°±æˆä¸ºæ•´ä¸ªç³»ç»Ÿæ€§èƒ½çš„ç“¶é¢ˆï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»è¦å¯¹å®ƒä»¬è¿›è¡Œä¼˜åŒ–ï¼Œæœ¬ç« å°†è¯¦ç»†ä»‹ç»åœ¨ MySQL ä¸­ä¼˜åŒ– SQL è¯­å¥çš„æ–¹æ³•ã€‚ å½“é¢å¯¹ä¸€ä¸ªæœ‰ SQL æ€§èƒ½é—®é¢˜çš„æ•°æ®åº“æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥ä»ä½•å¤„å…¥æ‰‹æ¥è¿›è¡Œç³»ç»Ÿçš„åˆ†æï¼Œä½¿å¾—èƒ½å¤Ÿå°½å¿«å®šä½é—®é¢˜ SQL å¹¶å°½å¿«è§£å†³é—®é¢˜ã€‚ 1 æŸ¥çœ‹SQLæ‰§è¡Œé¢‘ç‡MySQL å®¢æˆ·ç«¯è¿æ¥æˆåŠŸåï¼Œé€šè¿‡ show [session|global] status å‘½ä»¤å¯ä»¥æä¾›æœåŠ¡å™¨çŠ¶æ€ä¿¡æ¯ã€‚show [session|global] status å¯ä»¥æ ¹æ®éœ€è¦åŠ ä¸Šå‚æ•°â€œsessionâ€æˆ–è€…â€œglobalâ€æ¥æ˜¾ç¤º session çº§ï¼ˆå½“å‰è¿æ¥ï¼‰çš„è®¡ç»“æœå’Œ global çº§ï¼ˆè‡ªæ•°æ®åº“ä¸Šæ¬¡å¯åŠ¨è‡³ä»Šï¼‰çš„ç»Ÿè®¡ç»“æœã€‚å¦‚æœä¸å†™ï¼Œé»˜è®¤ä½¿ç”¨å‚æ•°æ˜¯â€œsessionâ€ã€‚ ä¸‹é¢çš„å‘½ä»¤æ˜¾ç¤ºäº†å½“å‰ session ä¸­æ‰€æœ‰ç»Ÿè®¡å‚æ•°çš„å€¼ï¼š mysql&gt; show status like &#39;Com_______&#39;; +---------------+-------+ | Variable_name | Value | +---------------+-------+ | Com_binlog | 0 | | Com_commit | 4 | | Com_delete | 4 | | Com_insert | 35 | | Com_repair | 0 | | Com_revoke | 0 | | Com_select | 291 | | Com_signal | 0 | | Com_update | 11 | | Com_xa_end | 0 | +---------------+-------+ 10 rows in set (0.00 sec)global: mysql&gt; show global status like &#39;Com_______&#39;; +---------------+-------+ | Variable_name | Value | +---------------+-------+ | Com_binlog | 0 | | Com_commit | 0 | | Com_delete | 0 | | Com_insert | 0 | | Com_repair | 0 | | Com_revoke | 0 | | Com_select | 1 | | Com_signal | 0 | | Com_update | 0 | | Com_xa_end | 0 | +---------------+-------+ 10 rows in set (0.00 sec)ä¸‹é¢è¿™æ¡è¯­å¥åˆ™åªä¼šæŸ¥çœ‹ä½¿ç”¨innodbå¼•æ“è¡¨çš„æ“ä½œæ¬¡æ•°ï¼š mysql&gt; show status like &#39;Innodb_rows_%&#39;; +----------------------+-------+ | Variable_name | Value | +----------------------+-------+ | Innodb_rows_deleted | 2 | | Innodb_rows_inserted | 49 | | Innodb_rows_read | 382 | | Innodb_rows_updated | 17 | +----------------------+-------+ 4 rows in set (0.00 sec) å‚æ•° å«ä¹‰ Com_select æ‰§è¡Œ select æ“ä½œçš„æ¬¡æ•°ï¼Œä¸€æ¬¡æŸ¥è¯¢åªç´¯åŠ  1ã€‚ Com_insert æ‰§è¡Œ INSERT æ“ä½œçš„æ¬¡æ•°ï¼Œå¯¹äºæ‰¹é‡æ’å…¥çš„ INSERT æ“ä½œï¼Œåªç´¯åŠ ä¸€æ¬¡ã€‚ Com_update æ‰§è¡Œ UPDATE æ“ä½œçš„æ¬¡æ•°ã€‚ Com_delete æ‰§è¡Œ DELETE æ“ä½œçš„æ¬¡æ•°ã€‚ Innodb_rows_read select æŸ¥è¯¢è¿”å›çš„è¡Œæ•°ã€‚ Innodb_rows_inserted æ‰§è¡Œ INSERT æ“ä½œæ’å…¥çš„è¡Œæ•°ã€‚ Innodb_rows_updated æ‰§è¡Œ UPDATE æ“ä½œæ›´æ–°çš„è¡Œæ•°ã€‚ Innodb_rows_deleted æ‰§è¡Œ DELETE æ“ä½œåˆ é™¤çš„è¡Œæ•°ã€‚ 2 å®šä½ä½æ•ˆSQLå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼å®šä½æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„ SQL è¯­å¥ã€‚ æ…¢æŸ¥è¯¢æ—¥å¿— : é€šè¿‡æ…¢æŸ¥è¯¢æ—¥å¿—å®šä½é‚£äº›æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„ SQL è¯­å¥ï¼Œç”¨â€“log-slow-queries[=file_name]é€‰é¡¹å¯åŠ¨æ—¶ï¼Œmysqld å†™ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡ long_query_time ç§’çš„ SQL è¯­å¥çš„æ—¥å¿—æ–‡ä»¶ã€‚è¿™æ–¹é¢çš„é…ç½®è§MySQLä¹‹æ—¥å¿—é…ç½®å…¨è§£ show processlist : æ…¢æŸ¥è¯¢æ—¥å¿—åœ¨æŸ¥è¯¢ç»“æŸä»¥åæ‰çºªå½•ï¼Œæ‰€ä»¥åœ¨åº”ç”¨åæ˜ æ‰§è¡Œæ•ˆç‡å‡ºç°é—®é¢˜çš„æ—¶å€™æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—å¹¶ä¸èƒ½å®šä½é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨show processlistå‘½ä»¤æŸ¥çœ‹å½“å‰MySQLåœ¨è¿›è¡Œçš„çº¿ç¨‹ï¼ŒåŒ…æ‹¬çº¿ç¨‹çš„çŠ¶æ€ã€æ˜¯å¦é”è¡¨ç­‰ï¼Œå¯ä»¥å®æ—¶åœ°æŸ¥çœ‹ SQL çš„æ‰§è¡Œæƒ…å†µï¼ŒåŒæ—¶å¯¹ä¸€äº›é”è¡¨æ“ä½œè¿›è¡Œä¼˜åŒ–ã€‚ show processlistçš„ç»“æœï¼š åˆ—å æè¿° id ç”¨æˆ·ç™»å½•mysqlæ—¶ï¼Œç³»ç»Ÿåˆ†é…çš„â€connection_idâ€ï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•°connection_id()æŸ¥çœ‹ user æ˜¾ç¤ºå½“å‰ç”¨æˆ·ã€‚å¦‚æœä¸æ˜¯rootï¼Œè¿™ä¸ªå‘½ä»¤å°±åªæ˜¾ç¤ºç”¨æˆ·æƒé™èŒƒå›´çš„sqlè¯­å¥ host æ˜¾ç¤ºè¿™ä¸ªè¯­å¥æ˜¯ä»å“ªä¸ªipçš„å“ªä¸ªç«¯å£ä¸Šå‘çš„ï¼Œå¯ä»¥ç”¨æ¥è·Ÿè¸ªå‡ºç°é—®é¢˜è¯­å¥çš„ç”¨æˆ· db æ˜¾ç¤ºè¿™ä¸ªè¿›ç¨‹ç›®å‰è¿æ¥çš„æ˜¯å“ªä¸ªæ•°æ®åº“ command æ˜¾ç¤ºå½“å‰è¿æ¥çš„æ‰§è¡Œçš„å‘½ä»¤ï¼Œä¸€èˆ¬å–å€¼ä¸ºä¼‘çœ ï¼ˆsleepï¼‰ï¼ŒæŸ¥è¯¢ï¼ˆqueryï¼‰ï¼Œè¿æ¥ï¼ˆconnectï¼‰ç­‰ time æ˜¾ç¤ºè¿™ä¸ªçŠ¶æ€æŒç»­çš„æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ state æ˜¾ç¤ºä½¿ç”¨å½“å‰è¿æ¥çš„sqlè¯­å¥çš„çŠ¶æ€ï¼Œå¾ˆé‡è¦çš„åˆ—ã€‚stateæè¿°çš„æ˜¯è¯­å¥æ‰§è¡Œä¸­çš„æŸä¸€ä¸ªçŠ¶æ€ã€‚ä¸€ä¸ªsqlè¯­å¥ï¼Œä»¥æŸ¥è¯¢ä¸ºä¾‹ï¼Œå¯èƒ½éœ€è¦ç»è¿‡copying to tmp tableã€sorting resultã€sending dataç­‰çŠ¶æ€æ‰å¯ä»¥å®Œæˆ info æ˜¾ç¤ºè¿™ä¸ªsqlè¯­å¥ï¼Œæ˜¯åˆ¤æ–­é—®é¢˜è¯­å¥çš„ä¸€ä¸ªé‡è¦ä¾æ® 3 explainåˆ†ææ‰§è¡Œè®¡åˆ’é€šè¿‡ä»¥ä¸Šæ­¥éª¤æŸ¥è¯¢åˆ°æ•ˆç‡ä½çš„ SQL è¯­å¥åï¼Œå¯ä»¥é€šè¿‡ EXPLAINæˆ–è€… DESCå‘½ä»¤è·å– MySQLå¦‚ä½•æ‰§è¡Œ SELECT è¯­å¥çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬åœ¨ SELECT è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­è¡¨å¦‚ä½•è¿æ¥å’Œè¿æ¥çš„é¡ºåºã€‚ æŸ¥è¯¢SQLè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ ï¼š explain select * from tb_item where id = 1; explain select * from tb_item where title = 'é˜¿å°”å¡ç‰¹ (OT-979) å†°å·ç™½ è”é€š3Gæ‰‹æœº3'; å­—æ®µ å«ä¹‰ id selectæŸ¥è¯¢çš„åºåˆ—å·ï¼Œæ˜¯ä¸€ç»„æ•°å­—ï¼Œè¡¨ç¤ºçš„æ˜¯æŸ¥è¯¢ä¸­æ‰§è¡Œselectå­å¥æˆ–è€…æ˜¯æ“ä½œè¡¨çš„é¡ºåºã€‚ select_type è¡¨ç¤º SELECT çš„ç±»å‹ï¼Œå¸¸è§çš„å–å€¼æœ‰ SIMPLEï¼ˆç®€å•è¡¨ï¼Œå³ä¸ä½¿ç”¨è¡¨è¿æ¥æˆ–è€…å­æŸ¥è¯¢ï¼‰ã€PRIMARYï¼ˆä¸»æŸ¥è¯¢ï¼Œå³å¤–å±‚çš„æŸ¥è¯¢ï¼‰ã€UNIONï¼ˆUNION ä¸­çš„ç¬¬äºŒä¸ªæˆ–è€…åé¢çš„æŸ¥è¯¢è¯­å¥ï¼‰ã€SUBQUERYï¼ˆå­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ª SELECTï¼‰ç­‰ table è¾“å‡ºç»“æœé›†çš„è¡¨ type è¡¨ç¤ºè¡¨çš„è¿æ¥ç±»å‹ï¼Œæ€§èƒ½ç”±å¥½åˆ°å·®çš„è¿æ¥ç±»å‹ä¸º( system â€”&gt; const â€”â€“&gt; eq_ref â€”â€”&gt; ref â€”â€”-&gt; ref_or_nullâ€”-&gt; index_merge â€”&gt; index_subquery â€”â€“&gt; range â€”â€“&gt; index â€”â€”&gt; all ) possible_keys è¡¨ç¤ºæŸ¥è¯¢æ—¶ï¼Œå¯èƒ½ä½¿ç”¨çš„ç´¢å¼• key è¡¨ç¤ºå®é™…ä½¿ç”¨çš„ç´¢å¼• key_len ç´¢å¼•å­—æ®µçš„é•¿åº¦ rows æ‰«æè¡Œçš„æ•°é‡ extra æ‰§è¡Œæƒ…å†µçš„è¯´æ˜å’Œæè¿° å‡†å¤‡ä¸‰å¼ å¦‚å›¾æ‰€ç¤ºçš„è¡¨ï¼š 3.1 explain ä¹‹ idid å­—æ®µæ˜¯ selectæŸ¥è¯¢çš„åºåˆ—å·ï¼Œæ˜¯ä¸€ç»„æ•°å­—ï¼Œè¡¨ç¤ºçš„æ˜¯æŸ¥è¯¢ä¸­æ‰§è¡Œselectå­å¥æˆ–è€…æ˜¯æ“ä½œè¡¨çš„é¡ºåºã€‚id æƒ…å†µæœ‰ä¸‰ç§ ï¼š 1ï¼‰ idç›¸åŒè¡¨ç¤ºåŠ è½½è¡¨çš„é¡ºåºæ˜¯ä»ä¸Šåˆ°ä¸‹ã€‚ mysql&gt; explain select * from t_role r, t_user u, user_role ur where r.id = ur.role_id and u.id = ur.user_id ; +----+-------------+-------+------------+--------+-----------------------------+---------+---------+-----------------+------+----------+----------------------------------------------------+ | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra | +----+-------------+-------+------------+--------+-----------------------------+---------+---------+-----------------+------+----------+----------------------------------------------------+ | 1 | SIMPLE | r | NULL | ALL | PRIMARY | NULL | NULL | NULL | 5 | 100.00 | NULL | | 1 | SIMPLE | ur | NULL | ALL | fk_ur_user_id,fk_ur_role_id | NULL | NULL | NULL | 6 | 20.00 | Using where; Using join buffer (Block Nested Loop) | | 1 | SIMPLE | u | NULL | eq_ref | PRIMARY | PRIMARY | 98 | test.ur.user_id | 1 | 100.00 | NULL | +----+-------------+-------+------------+--------+-----------------------------+---------+---------+-----------------+------+----------+----------------------------------------------------+ 3 rows in set, 1 warning (0.01 sec)2ï¼‰ id ä¸åŒidå€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œã€‚ mysql&gt; EXPLAIN SELECT * FROM t_role WHERE id = (SELECT role_id FROM user_role WHERE user_id = (SELECT id FROM t_user WHERE username = &#39;stu1&#39;)); +----+-------------+-----------+------------+-------+----------------------+----------------------+---------+-------+------+----------+-------------+ | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra | +----+-------------+-----------+------------+-------+----------------------+----------------------+---------+-------+------+----------+-------------+ | 1 | PRIMARY | t_role | NULL | const | PRIMARY | PRIMARY | 98 | const | 1 | 100.00 | NULL | | 2 | SUBQUERY | user_role | NULL | ref | fk_ur_user_id | fk_ur_user_id | 99 | const | 1 | 100.00 | Using where | | 3 | SUBQUERY | t_user | NULL | const | unique_user_username | unique_user_username | 137 | const | 1 | 100.00 | Using index | +----+-------------+-----------+------------+-------+----------------------+----------------------+---------+-------+------+----------+-------------+ 3 rows in set, 1 warning (0.00 sec)3ï¼‰ id æœ‰ç›¸åŒï¼Œä¹Ÿæœ‰ä¸åŒï¼ŒåŒæ—¶å­˜åœ¨ã€‚idç›¸åŒçš„å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç»„ï¼Œä»ä¸Šå¾€ä¸‹é¡ºåºæ‰§è¡Œï¼›åœ¨æ‰€æœ‰çš„ç»„ä¸­ï¼Œidçš„å€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œã€‚ 3.2 explain ä¹‹ select_typeè¡¨ç¤º SELECT çš„ç±»å‹ï¼Œå¸¸è§çš„å–å€¼ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š select_type å«ä¹‰ SIMPLE ç®€å•çš„selectæŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸­ä¸åŒ…å«å­æŸ¥è¯¢æˆ–è€…UNION PRIMARY æŸ¥è¯¢ä¸­è‹¥åŒ…å«ä»»ä½•å¤æ‚çš„å­æŸ¥è¯¢ï¼Œæœ€å¤–å±‚æŸ¥è¯¢æ ‡è®°ä¸ºè¯¥æ ‡è¯† SUBQUERY åœ¨SELECT æˆ– WHERE åˆ—è¡¨ä¸­åŒ…å«äº†å­æŸ¥è¯¢ DERIVED åœ¨FROM åˆ—è¡¨ä¸­åŒ…å«çš„å­æŸ¥è¯¢ï¼Œè¢«æ ‡è®°ä¸º DERIVEDï¼ˆè¡ç”Ÿï¼‰ MYSQLä¼šé€’å½’æ‰§è¡Œè¿™äº›å­æŸ¥è¯¢ï¼ŒæŠŠç»“æœæ”¾åœ¨ä¸´æ—¶è¡¨ä¸­ UNION è‹¥ç¬¬äºŒä¸ªSELECTå‡ºç°åœ¨UNIONä¹‹åï¼Œåˆ™æ ‡è®°ä¸ºUNION ï¼› è‹¥UNIONåŒ…å«åœ¨FROMå­å¥çš„å­æŸ¥è¯¢ä¸­ï¼Œå¤–å±‚SELECTå°†è¢«æ ‡è®°ä¸º ï¼š DERIVED UNION RESULT ä»UNIONè¡¨è·å–ç»“æœçš„SELECT mysql&gt; explain select * from t_user where id = (select id from user_role where role_id = &#39;9&#39;); +----+-------------+-----------+------------+------+---------------+---------------+---------+-------+------+----------+-------------+ | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra | +----+-------------+-----------+------------+------+---------------+---------------+---------+-------+------+----------+-------------+ | 1 | PRIMARY | t_user | NULL | ALL | PRIMARY | NULL | NULL | NULL | 6 | 16.67 | Using where | | 2 | SUBQUERY | user_role | NULL | ref | fk_ur_role_id | fk_ur_role_id | 99 | const | 1 | 100.00 | Using index | +----+-------------+-----------+------------+------+---------------+---------------+---------+-------+------+----------+-------------+ 2 rows in set, 3 warnings (0.00 sec)mysql&gt; explain select * from t_user where id = &#39;1&#39; union select * from t_user where id = &#39;2&#39;; +----+--------------+------------+------------+-------+---------------+---------+---------+-------+------+----------+-----------------+ | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra | +----+--------------+------------+------------+-------+---------------+---------+---------+-------+------+----------+-----------------+ | 1 | PRIMARY | t_user | NULL | const | PRIMARY | PRIMARY | 98 | const | 1 | 100.00 | NULL | | 2 | UNION | t_user | NULL | const | PRIMARY | PRIMARY | 98 | const | 1 | 100.00 | NULL | | NULL | UNION RESULT | &lt;union1,2&gt; | NULL | ALL | NULL | NULL | NULL | NULL | NULL | NULL | Using temporary | +----+--------------+------------+------------+-------+---------------+---------+---------+-------+------+----------+-----------------+ 3 rows in set, 1 warning (0.01 sec)æ³¨ï¼š MySQL5.7ä¸­å¯¹Derived tableåšäº†ä¸€ä¸ªæ–°ç‰¹æ€§ã€‚è¯¥ç‰¹æ€§å…è®¸å°†ç¬¦åˆæ¡ä»¶çš„Derived tableä¸­çš„å­è¡¨ä¸çˆ¶æŸ¥è¯¢çš„è¡¨åˆå¹¶è¿›è¡Œç›´æ¥JOINã€‚ä½“ç°ä¸ºsimpleæŸ¥è¯¢ 3.3 explain ä¹‹ tableå±•ç¤ºè¿™ä¸€è¡Œçš„æ•°æ®æ˜¯å…³äºå“ªä¸€å¼ è¡¨çš„ 3.4 explain ä¹‹ typetype æ˜¾ç¤ºçš„æ˜¯è®¿é—®ç±»å‹ï¼Œæ˜¯è¾ƒä¸ºé‡è¦çš„ä¸€ä¸ªæŒ‡æ ‡ï¼Œå¯å–å€¼ä¸ºï¼š type å«ä¹‰ NULL MySQLä¸è®¿é—®ä»»ä½•è¡¨ï¼Œç´¢å¼•ï¼Œç›´æ¥è¿”å›ç»“æœ system è¡¨åªæœ‰ä¸€è¡Œè®°å½•(ç­‰äºç³»ç»Ÿè¡¨)ï¼Œè¿™æ˜¯constç±»å‹çš„ç‰¹ä¾‹ï¼Œä¸€èˆ¬ä¸ä¼šå‡ºç° const è¡¨ç¤ºé€šè¿‡ç´¢å¼•ä¸€æ¬¡å°±æ‰¾åˆ°äº†ï¼Œconst ç”¨äºæ¯”è¾ƒprimary key æˆ–è€… unique ç´¢å¼•ã€‚å› ä¸ºåªåŒ¹é…ä¸€è¡Œæ•°æ®ï¼Œæ‰€ä»¥å¾ˆå¿«ã€‚å¦‚å°†ä¸»é”®ç½®äºwhereåˆ—è¡¨ä¸­ï¼ŒMySQL å°±èƒ½å°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªå¸¸é‡ã€‚constäºå°† â€œä¸»é”®â€ æˆ– â€œå”¯ä¸€â€ ç´¢å¼•çš„æ‰€æœ‰éƒ¨åˆ†ä¸å¸¸é‡å€¼è¿›è¡Œæ¯”è¾ƒ eq_ref ç±»ä¼¼refï¼ŒåŒºåˆ«åœ¨äºä½¿ç”¨çš„æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œä½¿ç”¨ä¸»é”®çš„å…³è”æŸ¥è¯¢ï¼Œå…³è”æŸ¥è¯¢å‡ºçš„è®°å½•åªæœ‰ä¸€æ¡ã€‚å¸¸è§äºä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æ‰«æ ref éå”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œè¿”å›åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„æ‰€æœ‰è¡Œã€‚æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ç´¢å¼•è®¿é—®ï¼Œè¿”å›æ‰€æœ‰åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„æ‰€æœ‰è¡Œï¼ˆå¤šä¸ªï¼‰ ref_or_null ç±»ä¼¼refï¼Œä½†æ˜¯å¯ä»¥æœç´¢å€¼ä¸ºNULLçš„è¡Œã€‚ index_merge è¡¨ç¤ºä½¿ç”¨äº†ç´¢å¼•åˆå¹¶çš„ä¼˜åŒ–æ–¹æ³•ã€‚ range åªæ£€ç´¢ç»™å®šè¿”å›çš„è¡Œï¼Œä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥é€‰æ‹©è¡Œã€‚ where ä¹‹åå‡ºç° between ï¼Œ &lt; , &gt; , in ç­‰æ“ä½œã€‚ index index ä¸ ALLçš„åŒºåˆ«ä¸º index ç±»å‹åªæ˜¯éå†äº†ç´¢å¼•æ ‘ï¼Œ é€šå¸¸æ¯”ALL å¿«ï¼Œ ALL æ˜¯éå†æ•°æ®æ–‡ä»¶ã€‚ all å°†éå†å…¨è¡¨ä»¥æ‰¾åˆ°åŒ¹é…çš„è¡Œ ç»“æœå€¼ä»æœ€å¥½åˆ°æœ€åä»¥æ­¤æ˜¯ï¼š NULL &gt; system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALL==ä¸€èˆ¬æ¥è¯´ï¼Œ æˆ‘ä»¬éœ€è¦ä¿è¯æŸ¥è¯¢è‡³å°‘è¾¾åˆ° range çº§åˆ«ï¼Œ æœ€å¥½è¾¾åˆ°ref ã€‚== 3.5 explain ä¹‹ keypossible_keys : æ˜¾ç¤ºå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨çš„ç´¢å¼•ï¼Œ ä¸€ä¸ªæˆ–å¤šä¸ªã€‚ key ï¼š å®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œ å¦‚æœä¸ºNULLï¼Œ åˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚ key_len : è¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œ è¯¥å€¼ä¸ºç´¢å¼•å­—æ®µæœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿åº¦ï¼Œåœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„å‰æä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½ã€‚ 3.6 explain ä¹‹ rowsæ‰«æè¡Œçš„æ•°é‡ã€‚ 3.7 explain ä¹‹ extraå…¶ä»–çš„é¢å¤–çš„æ‰§è¡Œè®¡åˆ’ä¿¡æ¯ï¼Œåœ¨è¯¥åˆ—å±•ç¤º ã€‚ extra å«ä¹‰ using filesort è¯´æ˜mysqlä¼šå¯¹æ•°æ®ä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨çš„ç´¢å¼•æ’åºï¼Œè€Œä¸æ˜¯æŒ‰ç…§è¡¨å†…çš„ç´¢å¼•é¡ºåºè¿›è¡Œè¯»å–ï¼Œ ç§°ä¸º â€œæ–‡ä»¶æ’åºâ€, æ•ˆç‡ä½ã€‚ using temporary ä½¿ç”¨äº†ä¸´æ—¶è¡¨ä¿å­˜ä¸­é—´ç»“æœï¼ŒMySQLåœ¨å¯¹æŸ¥è¯¢ç»“æœæ’åºæ—¶ä½¿ç”¨ä¸´æ—¶è¡¨ã€‚å¸¸è§äº order by å’Œ group byï¼› æ•ˆç‡ä½ using index è¡¨ç¤ºç›¸åº”çš„selectæ“ä½œä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œ é¿å…è®¿é—®è¡¨çš„æ•°æ®è¡Œï¼Œ æ•ˆç‡ä¸é”™ã€‚ 4 show profileåˆ†æSQLMysqlä»5.0.37ç‰ˆæœ¬å¼€å§‹å¢åŠ äº†å¯¹ show profiles å’Œ show profile è¯­å¥çš„æ”¯æŒã€‚show profiles èƒ½å¤Ÿåœ¨åšSQLä¼˜åŒ–æ—¶å¸®åŠ©æˆ‘ä»¬äº†è§£æ—¶é—´éƒ½è€—è´¹åˆ°å“ªé‡Œå»äº†ã€‚ (5.7ç‰ˆæœ¬åæ¨èä½¿ç”¨performance_schemaå·¥å…·) é€šè¿‡ have_profiling å‚æ•°ï¼Œèƒ½å¤Ÿçœ‹åˆ°å½“å‰MySQLæ˜¯å¦æ”¯æŒprofileï¼š mysql&gt; select @@have_profiling; +------------------+ | @@have_profiling | +------------------+ | YES | +------------------+ 1 row in set, 1 warning (0.00 sec)é»˜è®¤profilingæ˜¯å…³é—­çš„ï¼Œå¯ä»¥é€šè¿‡setè¯­å¥åœ¨Sessionçº§åˆ«å¼€å¯profilingï¼š mysql&gt; set profiling=1; Query OK, 0 rows affected, 1 warning (0.00 sec)æŸ¥çœ‹æ˜¯å¦å¼€å¯ï¼š mysql&gt; select @@profiling; +-------------+ | @@profiling | +-------------+ | 1 | +-------------+ 1 row in set, 1 warning (0.00 sec)é€šè¿‡profileï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´æ¸…æ¥šåœ°äº†è§£SQLæ‰§è¡Œçš„è¿‡ç¨‹ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼Œå¦‚ï¼š show databases; use db01; show tables; select * from tb_item where id &lt; 5; select count(*) from tb_item;æ‰§è¡Œå®Œä¸Šè¿°å‘½ä»¤ä¹‹åï¼Œå†æ‰§è¡Œshow profiles æŒ‡ä»¤ï¼Œ æ¥æŸ¥çœ‹SQLè¯­å¥æ‰§è¡Œçš„è€—æ—¶ï¼š é€šè¿‡show profile for query query_idè¯­å¥å¯ä»¥æŸ¥çœ‹åˆ°è¯¥SQLæ‰§è¡Œè¿‡ç¨‹ä¸­æ¯ä¸ªçº¿ç¨‹çš„çŠ¶æ€å’Œæ¶ˆè€—çš„æ—¶é—´ï¼š Sending data çŠ¶æ€è¡¨ç¤ºMySQLçº¿ç¨‹å¼€å§‹è®¿é—®æ•°æ®è¡Œå¹¶æŠŠç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè€Œä¸ä»…ä»…æ˜¯è¿”å›ä¸ªå®¢æˆ·ç«¯ã€‚ç”±äºåœ¨Sending dataçŠ¶æ€ä¸‹ï¼ŒMySQLçº¿ç¨‹å¾€å¾€éœ€è¦åšå¤§é‡çš„ç£ç›˜è¯»å–æ“ä½œï¼Œæ‰€ä»¥ç»å¸¸æ˜¯æ•´å„æŸ¥è¯¢ä¸­è€—æ—¶æœ€é•¿çš„çŠ¶æ€ã€‚ åœ¨è·å–åˆ°æœ€æ¶ˆè€—æ—¶é—´çš„çº¿ç¨‹çŠ¶æ€åï¼ŒMySQLæ”¯æŒè¿›ä¸€æ­¥é€‰æ‹©allã€cpuã€block io ã€context switchã€page faultsç­‰æ˜ç»†ç±»å‹ç±»æŸ¥çœ‹MySQLåœ¨ä½¿ç”¨ä»€ä¹ˆèµ„æºä¸Šè€—è´¹äº†è¿‡é«˜çš„æ—¶é—´ã€‚ä¾‹å¦‚ï¼Œé€‰æ‹©æŸ¥çœ‹CPUçš„è€—è´¹æ—¶é—´ï¼š å­—æ®µ å«ä¹‰ Status sql è¯­å¥æ‰§è¡Œçš„çŠ¶æ€ Duration sql æ‰§è¡Œè¿‡ç¨‹ä¸­æ¯ä¸€ä¸ªæ­¥éª¤çš„è€—æ—¶ CPU_user å½“å‰ç”¨æˆ·å æœ‰çš„cpu CPU_system ç³»ç»Ÿå æœ‰çš„cpu 5 traceåˆ†æä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’MySQL5.6æä¾›äº†å¯¹SQLçš„è·Ÿè¸ªtrace, é€šè¿‡traceæ–‡ä»¶èƒ½å¤Ÿè¿›ä¸€æ­¥äº†è§£ä¸ºä»€ä¹ˆä¼˜åŒ–å™¨é€‰æ‹©Aè®¡åˆ’, è€Œä¸æ˜¯é€‰æ‹©Bè®¡åˆ’ã€‚ æ‰“å¼€trace ï¼Œè®¾ç½®æ ¼å¼ä¸º JSONï¼Œå¹¶è®¾ç½®traceæœ€å¤§èƒ½å¤Ÿä½¿ç”¨çš„å†…å­˜å¤§å°ï¼Œé¿å…è§£æè¿‡ç¨‹ä¸­å› ä¸ºé»˜è®¤å†…å­˜è¿‡å°è€Œä¸èƒ½å¤Ÿå®Œæ•´å±•ç¤ºã€‚ SET optimizer_trace=\"enabled=on\",end_markers_in_json=on; set optimizer_trace_max_mem_size=1000000; æ‰§è¡ŒSQLè¯­å¥ ï¼š select * from tb_item where id &lt; 4; æœ€åï¼Œ æ£€æŸ¥information_schema.optimizer_traceå°±å¯ä»¥çŸ¥é“MySQLæ˜¯å¦‚ä½•æ‰§è¡ŒSQLçš„ ï¼š select * from information_schema.optimizer_trace\\G; *************************** 1. row *************************** QUERY: select * from tb_item where id &lt; 4 TRACE: { \"steps\": [ { \"join_preparation\": { \"select#\": 1, \"steps\": [ { \"expanded_query\": \"/* select#1 */ select `tb_item`.`id` AS `id`,`tb_item`.`title` AS `title`,`tb_item`.`price` AS `price`,`tb_item`.`num` AS `num`,`tb_item`.`categoryid` AS `categoryid`,`tb_item`.`status` AS `status`,`tb_item`.`sellerid` AS `sellerid`,`tb_item`.`createtime` AS `createtime`,`tb_item`.`updatetime` AS `updatetime` from `tb_item` where (`tb_item`.`id` &lt; 4)\" } ] /* steps */ } /* join_preparation */ }, { \"join_optimization\": { \"select#\": 1, \"steps\": [ { \"condition_processing\": { \"condition\": \"WHERE\", \"original_condition\": \"(`tb_item`.`id` &lt; 4)\", \"steps\": [ { \"transformation\": \"equality_propagation\", \"resulting_condition\": \"(`tb_item`.`id` &lt; 4)\" }, { \"transformation\": \"constant_propagation\", \"resulting_condition\": \"(`tb_item`.`id` &lt; 4)\" }, { \"transformation\": \"trivial_condition_removal\", \"resulting_condition\": \"(`tb_item`.`id` &lt; 4)\" } ] /* steps */ } /* condition_processing */ }, { \"table_dependencies\": [ { \"table\": \"`tb_item`\", \"row_may_be_null\": false, \"map_bit\": 0, \"depends_on_map_bits\": [ ] /* depends_on_map_bits */ } ] /* table_dependencies */ }, { \"ref_optimizer_key_uses\": [ ] /* ref_optimizer_key_uses */ }, { \"rows_estimation\": [ { \"table\": \"`tb_item`\", \"range_analysis\": { \"table_scan\": { \"rows\": 9816098, \"cost\": 2.04e6 } /* table_scan */, \"potential_range_indices\": [ { \"index\": \"PRIMARY\", \"usable\": true, \"key_parts\": [ \"id\" ] /* key_parts */ } ] /* potential_range_indices */, \"setup_range_conditions\": [ ] /* setup_range_conditions */, \"group_index_range\": { \"chosen\": false, \"cause\": \"not_group_by_or_distinct\" } /* group_index_range */, \"analyzing_range_alternatives\": { \"range_scan_alternatives\": [ { \"index\": \"PRIMARY\", \"ranges\": [ \"id &lt; 4\" ] /* ranges */, \"index_dives_for_eq_ranges\": true, \"rowid_ordered\": true, \"using_mrr\": false, \"index_only\": false, \"rows\": 3, \"cost\": 1.6154, \"chosen\": true } ] /* range_scan_alternatives */, \"analyzing_roworder_intersect\": { \"usable\": false, \"cause\": \"too_few_roworder_scans\" } /* analyzing_roworder_intersect */ } /* analyzing_range_alternatives */, \"chosen_range_access_summary\": { \"range_access_plan\": { \"type\": \"range_scan\", \"index\": \"PRIMARY\", \"rows\": 3, \"ranges\": [ \"id &lt; 4\" ] /* ranges */ } /* range_access_plan */, \"rows_for_plan\": 3, \"cost_for_plan\": 1.6154, \"chosen\": true } /* chosen_range_access_summary */ } /* range_analysis */ } ] /* rows_estimation */ }, { \"considered_execution_plans\": [ { \"plan_prefix\": [ ] /* plan_prefix */, \"table\": \"`tb_item`\", \"best_access_path\": { \"considered_access_paths\": [ { \"access_type\": \"range\", \"rows\": 3, \"cost\": 2.2154, \"chosen\": true } ] /* considered_access_paths */ } /* best_access_path */, \"cost_for_plan\": 2.2154, \"rows_for_plan\": 3, \"chosen\": true } ] /* considered_execution_plans */ }, { \"attaching_conditions_to_tables\": { \"original_condition\": \"(`tb_item`.`id` &lt; 4)\", \"attached_conditions_computation\": [ ] /* attached_conditions_computation */, \"attached_conditions_summary\": [ { \"table\": \"`tb_item`\", \"attached\": \"(`tb_item`.`id` &lt; 4)\" } ] /* attached_conditions_summary */ } /* attaching_conditions_to_tables */ }, { \"refine_plan\": [ { \"table\": \"`tb_item`\", \"access_type\": \"range\" } ] /* refine_plan */ } ] /* steps */ } /* join_optimization */ }, { \"join_execution\": { \"select#\": 1, \"steps\": [ ] /* steps */ } /* join_execution */ } ] /* steps */ }","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"ä¼˜åŒ–","slug":"ä¼˜åŒ–","permalink":"https://www.codetool.top/tags/%E4%BC%98%E5%8C%96/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"MySQL","slug":"MySQL","permalink":"https://www.codetool.top/tags/MySQL/"}]},{"title":"leetcode1103-åˆ†ç³–æœII","slug":"leetcode1103-åˆ†ç³–æœII","date":"2020-03-05T05:12:17.000Z","updated":"2020-03-16T17:04:37.282Z","comments":true,"path":"article/leetcode1103-åˆ†ç³–æœII/","link":"","permalink":"https://www.codetool.top/article/leetcode1103-%E5%88%86%E7%B3%96%E6%9E%9CII/","excerpt":"","text":"1 åŸé¢˜æ’æ’åï¼Œåˆ†ç³–æœã€‚ æˆ‘ä»¬ä¹°äº†ä¸€äº›ç³–æœ candiesï¼Œæ‰“ç®—æŠŠå®ƒä»¬åˆ†ç»™æ’å¥½é˜Ÿçš„ n = num_people ä¸ªå°æœ‹å‹ã€‚ ç»™ç¬¬ä¸€ä¸ªå°æœ‹å‹ 1 é¢—ç³–æœï¼Œç¬¬äºŒä¸ªå°æœ‹å‹ 2 é¢—ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°ç»™æœ€åä¸€ä¸ªå°æœ‹å‹ n é¢—ç³–æœã€‚ ç„¶åï¼Œæˆ‘ä»¬å†å›åˆ°é˜Ÿä¼çš„èµ·ç‚¹ï¼Œç»™ç¬¬ä¸€ä¸ªå°æœ‹å‹ n + 1 é¢—ç³–æœï¼Œç¬¬äºŒä¸ªå°æœ‹å‹ n + 2 é¢—ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°ç»™æœ€åä¸€ä¸ªå°æœ‹å‹ 2 * n é¢—ç³–æœã€‚ é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼ˆæ¯æ¬¡éƒ½æ¯”ä¸Šä¸€æ¬¡å¤šç»™å‡ºä¸€é¢—ç³–æœï¼Œå½“åˆ°è¾¾é˜Ÿä¼ç»ˆç‚¹åå†æ¬¡ä»é˜Ÿä¼èµ·ç‚¹å¼€å§‹ï¼‰ï¼Œç›´åˆ°æˆ‘ä»¬åˆ†å®Œæ‰€æœ‰çš„ç³–æœã€‚æ³¨æ„ï¼Œå°±ç®—æˆ‘ä»¬æ‰‹ä¸­çš„å‰©ä¸‹ç³–æœæ•°ä¸å¤Ÿï¼ˆä¸æ¯”å‰ä¸€æ¬¡å‘å‡ºçš„ç³–æœå¤šï¼‰ï¼Œè¿™äº›ç³–æœä¹Ÿä¼šå…¨éƒ¨å‘ç»™å½“å‰çš„å°æœ‹å‹ã€‚ è¿”å›ä¸€ä¸ªé•¿åº¦ä¸º num_peopleã€å…ƒç´ ä¹‹å’Œä¸º candies çš„æ•°ç»„ï¼Œä»¥è¡¨ç¤ºç³–æœçš„æœ€ç»ˆåˆ†å‘æƒ…å†µï¼ˆå³ ans[i] è¡¨ç¤ºç¬¬ i ä¸ªå°æœ‹å‹åˆ†åˆ°çš„ç³–æœæ•°ï¼‰ã€‚ ç¤ºä¾‹ 1: è¾“å…¥ï¼š candies = 7, num_people = 4è¾“å‡ºï¼š [1,2,3,1]è§£é‡Šï¼šç¬¬ä¸€æ¬¡ï¼Œans[0] += 1ï¼Œæ•°ç»„å˜ä¸º [1,0,0,0]ã€‚ç¬¬äºŒæ¬¡ï¼Œans[1] += 2ï¼Œæ•°ç»„å˜ä¸º [1,2,0,0]ã€‚ç¬¬ä¸‰æ¬¡ï¼Œans[2] += 3ï¼Œæ•°ç»„å˜ä¸º [1,2,3,0]ã€‚ç¬¬å››æ¬¡ï¼Œans[3] += 1ï¼ˆå› ä¸ºæ­¤æ—¶åªå‰©ä¸‹ 1 é¢—ç³–æœï¼‰ï¼Œæœ€ç»ˆæ•°ç»„å˜ä¸º [1,2,3,1]ã€‚ ç¤ºä¾‹ 2: è¾“å…¥ï¼š candies = 10, num_people = 3è¾“å‡ºï¼š [5,2,3]è§£é‡Šï¼šç¬¬ä¸€æ¬¡ï¼Œans[0] += 1ï¼Œæ•°ç»„å˜ä¸º [1,0,0]ã€‚ç¬¬äºŒæ¬¡ï¼Œans[1] += 2ï¼Œæ•°ç»„å˜ä¸º [1,2,0]ã€‚ç¬¬ä¸‰æ¬¡ï¼Œans[2] += 3ï¼Œæ•°ç»„å˜ä¸º [1,2,3]ã€‚ç¬¬å››æ¬¡ï¼Œans[0] += 4ï¼Œæœ€ç»ˆæ•°ç»„å˜ä¸º [5,2,3]ã€‚ æç¤ºï¼š 1 &lt;= candies &lt;= 10^9 . 1 &lt;= num_people &lt;= 1000 2 è§£æ³•2.1 æ€æƒ³æ¨¡æ‹Ÿè¿‡ç¨‹ 2.2 ä»£ç class Solution { public int[] distributeCandies(int candies, int num_people) { int[] candie = new int[num_people]; int cur_index = 0; int cur_count = 1; while(candies>0){ if(candies - cur_count &lt; 0){ candie[cur_index]+=candies; candies = 0; break; } candie[cur_index]+=cur_count; candies -= cur_count; cur_index++; cur_count++; if(cur_index == num_people) cur_index = 0; } return candie; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"MySQLç´¢å¼•æ¦‚è¿°åŠç´¢å¼•çš„åˆ†ç±»","slug":"MySQLç´¢å¼•æ¦‚è¿°åŠç´¢å¼•çš„åˆ†ç±»","date":"2020-03-04T12:44:22.000Z","updated":"2020-04-11T15:56:41.032Z","comments":true,"path":"article/MySQLç´¢å¼•æ¦‚è¿°åŠç´¢å¼•çš„åˆ†ç±»/","link":"","permalink":"https://www.codetool.top/article/MySQL%E7%B4%A2%E5%BC%95%E6%A6%82%E8%BF%B0%E5%8F%8A%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%86%E7%B1%BB/","excerpt":"","text":"1 æ¦‚è¿°MySQLå®˜æ–¹å¯¹ç´¢å¼•çš„å®šä¹‰ä¸ºï¼šç´¢å¼•ï¼ˆindexï¼‰æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ï¼ˆæœ‰åºï¼‰ã€‚åœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤è€…æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œ è¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³•ï¼Œè¿™ç§æ•°æ®ç»“æ„å°±æ˜¯ç´¢å¼•ã€‚ å·¦è¾¹æ˜¯æ•°æ®è¡¨ï¼Œä¸€å…±æœ‰ä¸¤åˆ—ä¸ƒæ¡è®°å½•ï¼Œæœ€å·¦è¾¹çš„æ˜¯æ•°æ®è®°å½•çš„ç‰©ç†åœ°å€ï¼ˆæ³¨æ„é€»è¾‘ä¸Šç›¸é‚»çš„è®°å½•åœ¨ç£ç›˜ä¸Šä¹Ÿå¹¶ä¸æ˜¯ä¸€å®šç‰©ç†ç›¸é‚»çš„ï¼‰ã€‚ä¸ºäº†åŠ å¿«Col2çš„æŸ¥æ‰¾ï¼Œå¯ä»¥ç»´æŠ¤ä¸€ä¸ªå³è¾¹æ‰€ç¤ºçš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹åˆ†åˆ«åŒ…å«ç´¢å¼•é”®å€¼å’Œä¸€ä¸ªæŒ‡å‘å¯¹åº”æ•°æ®è®°å½•ç‰©ç†åœ°å€çš„æŒ‡é’ˆï¼Œè¿™æ ·å°±å¯ä»¥è¿ç”¨äºŒå‰æŸ¥æ‰¾å¿«é€Ÿè·å–åˆ°ç›¸åº”æ•°æ®ã€‚ï¼ˆåœ¨æœ‰èšç°‡ç´¢å¼•çš„æ¦‚å¿µæ—¶æŒ‡å‘èšç°‡ç´¢å¼•çš„å€¼ï¼‰ ä¸€èˆ¬æ¥è¯´ç´¢å¼•æœ¬èº«ä¹Ÿå¾ˆå¤§ï¼Œä¸å¯èƒ½å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤ç´¢å¼•å¾€å¾€ä»¥ç´¢å¼•æ–‡ä»¶çš„å½¢å¼å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚ç´¢å¼•æ˜¯æ•°æ®åº“ä¸­ç”¨æ¥æé«˜æ€§èƒ½çš„æœ€å¸¸ç”¨çš„å·¥å…·ã€‚ ç´¢å¼•æ˜¯åœ¨MySQLçš„å­˜å‚¨å¼•æ“å±‚ä¸­å®ç°çš„ï¼Œè€Œä¸æ˜¯åœ¨æœåŠ¡å™¨å±‚å®ç°çš„ã€‚æ‰€ä»¥æ¯ç§å­˜å‚¨å¼•æ“çš„ç´¢å¼•éƒ½ä¸ä¸€å®šå®Œå…¨ç›¸åŒï¼Œä¹Ÿä¸æ˜¯æ‰€æœ‰çš„å­˜å‚¨å¼•æ“éƒ½æ”¯æŒæ‰€æœ‰çš„ç´¢å¼•ç±»å‹çš„ã€‚MySQLç›®å‰æä¾›äº†ä»¥ä¸‹4ç§ç´¢å¼•ï¼š BTREE ç´¢å¼• ï¼š æœ€å¸¸è§çš„ç´¢å¼•ç±»å‹ï¼Œå¤§éƒ¨åˆ†ç´¢å¼•éƒ½æ”¯æŒ B æ ‘ç´¢å¼•ã€‚ HASH ç´¢å¼•ï¼šåªæœ‰Memoryå¼•æ“æ”¯æŒ ï¼Œ ä½¿ç”¨åœºæ™¯ç®€å• ã€‚ R-tree ç´¢å¼•ï¼ˆç©ºé—´ç´¢å¼•ï¼‰ï¼šç©ºé—´ç´¢å¼•æ˜¯MyISAMå¼•æ“çš„ä¸€ä¸ªç‰¹æ®Šç´¢å¼•ç±»å‹ï¼Œä¸»è¦ç”¨äºåœ°ç†ç©ºé—´æ•°æ®ç±»å‹ï¼Œé€šå¸¸ä½¿ç”¨è¾ƒå°‘ï¼Œä¸åšç‰¹åˆ«ä»‹ç»ã€‚ Full-text ï¼ˆå…¨æ–‡ç´¢å¼•ï¼‰ ï¼šå…¨æ–‡ç´¢å¼•ä¹Ÿæ˜¯MyISAMçš„ä¸€ä¸ªç‰¹æ®Šç´¢å¼•ç±»å‹ï¼Œä¸»è¦ç”¨äºå…¨æ–‡ç´¢å¼•ï¼ŒInnoDBä»Mysql5.6ç‰ˆæœ¬å¼€å§‹æ”¯æŒå…¨æ–‡ç´¢å¼•ã€‚ MyISAMã€InnoDBã€Memoryä¸‰ç§å­˜å‚¨å¼•æ“å¯¹å„ç§ç´¢å¼•ç±»å‹çš„æ”¯æŒ ç´¢å¼• InnoDBå¼•æ“ MyISAMå¼•æ“ Memoryå¼•æ“ BTREEç´¢å¼• æ”¯æŒ æ”¯æŒ æ”¯æŒ HASH ç´¢å¼• ä¸æ”¯æŒ ä¸æ”¯æŒ æ”¯æŒ R-tree ç´¢å¼• ä¸æ”¯æŒ æ”¯æŒ ä¸æ”¯æŒ Full-text 5.6ç‰ˆæœ¬ä¹‹åæ”¯æŒ æ”¯æŒ ä¸æ”¯æŒ 2 ç´¢å¼•åˆ†ç±»â€”â€”ä»é€»è¾‘è§’åº¦ ä¸»é”®ç´¢å¼•ç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œå¹¶ä¸”ä¸å…è®¸æœ‰ç©ºå€¼ å”¯ä¸€ç´¢å¼•ç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä½†å…è®¸æœ‰ç©ºå€¼ å•å€¼ç´¢å¼•ä¸€ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªåˆ—ï¼Œä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå•åˆ—ç´¢å¼• å¤åˆç´¢å¼•ä¸€ä¸ªç´¢å¼•åŒ…å«å¤šä¸ªåˆ— å°½é‡ä½¿ç”¨å¤åˆç´¢å¼•ï¼Œè€Œå°‘ä½¿ç”¨å•åˆ—ç´¢å¼• ã€‚ åˆ›å»ºå¤åˆç´¢å¼• create index idx_name_sta_address on tb_seller(name, status, address);å°±ç›¸å½“äºåˆ›å»ºäº†ä¸‰ä¸ªç´¢å¼• ï¼š name name + status name + status + address 3 ç´¢å¼•åˆ†ç±»â€”â€”ä»æ•°æ®ç»“æ„è§’åº¦3.1 Bæ ‘,B+æ ‘ä¹‹å‰çš„åšå®¢æœ‰ä»‹ç»å¤šå‰å¹³è¡¡æŸ¥æ‰¾æ ‘-Bæ ‘ä¸B-æ ‘ é€šå¸¸åœ¨ B+æ ‘ä¸Šæœ‰ä¸¤ä¸ªå¤´æŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘æ ¹ç»“ç‚¹ï¼ˆè¿›è¡Œéšæœºæœç´¢ï¼‰ï¼Œä¸€ä¸ªæŒ‡å‘å…³é”®å­—æœ€å°çš„å¶ç»“ç‚¹ï¼ˆè¿›è¡Œé¡ºåºæœç´¢ï¼‰ã€‚ 3.1.1 B+æ ‘ä¸Bæ ‘çš„æ¯”è¾ƒç»„ç»‡æ–¹å¼ä¸ä¸€æ · B+æ ‘ï¼šæ‰€æœ‰æœ‰æ•ˆçš„ç´¢å¼•å…³é”®å­—å€¼éƒ½å¿…é¡»å­˜å‚¨åœ¨å¶ç»“ç‚¹ä¸­ï¼Œå…¶å†…éƒ¨ç»“ç‚¹ä¸­çš„é”®å€¼åªç”¨äºç´¢å¼•é¡¹çš„æŸ¥æ‰¾å®šä½ã€‚ Bæ ‘ï¼šæœ‰æ•ˆçš„ç´¢å¼•å…³é”®å­—å€¼å¯ä»¥å‡ºç°åœ¨Bæ ‘çš„ä»»æ„ä¸€ä¸ªç»“ç‚¹ä¸­ã€‚ å› æ­¤ï¼š B+æ ‘ï¼šæ‰€æœ‰å…³é”®å­—çš„æŸ¥æ‰¾é€Ÿåº¦åŸºæœ¬ä¸€è‡´ Bæ ‘ï¼šä¾èµ–äºæŸ¥æ‰¾å…³é”®å­—æ‰€åœ¨ç»“ç‚¹çš„å±‚æ¬¡ å¶ç»“ç‚¹ä¸åŒ B+æ ‘ä¸­å¶èŠ‚ç‚¹é—´å¢åŠ é“¾è¡¨æŒ‡é’ˆï¼Œæä¾›å¯¹ç´¢å¼•å…³é”®å­—çš„é¡ºåºæ‰«æåŠŸèƒ½ï¼›å¶èŠ‚ç‚¹çš„ä¸ªæ•°æœªå¿…ç¬¦åˆ m å‰æŸ¥æ‰¾æ ‘çš„è¦æ±‚ï¼Œå®ƒä¾èµ–äºé”®å€¼å­—èŠ‚æ•°å’ŒæŒ‡é’ˆå­—èŠ‚æ•°ï¼Œä¸º m1 é˜¶ã€‚ 3.1.2 MySQLä¸­çš„B+æ ‘é€‚ç”¨åœºæ™¯InnoDB å­˜å‚¨å¼•æ“ä½¿ç”¨çš„æ˜¯ B+æ ‘ã€‚ B+æ ‘ä¸ºå¯¹å¦‚ä¸‹ç±»å‹çš„æŸ¥è¯¢æœ‰æ•ˆï¼š å…¨å€¼åŒ¹é…ï¼šå’Œç´¢å¼•ä¸­çš„æ‰€æœ‰åˆ—è¿›è¡ŒåŒ¹é…ï¼ˆå¤åˆç´¢å¼•ï¼‰ åŒ¹é…æœ€å·¦å‰ç¼€ï¼šåªä½¿ç”¨ç´¢å¼•çš„ç¬¬ä¸€åˆ—æˆ–å‰å‡ åˆ— åŒ¹é…åˆ—å‰ç¼€ï¼šåªåŒ¹é…æŸä¸€åˆ—çš„å€¼çš„å¼€å¤´éƒ¨åˆ† åŒ¹é…èŒƒå›´å€¼ ç²¾ç¡®åŒ¹é…æŸä¸€åˆ—å¹¶èŒƒå›´åŒ¹é…å¦å¤–ä¸€åˆ— è¦†ç›–ç´¢å¼•/åªè®¿é—®ç´¢å¼•çš„æŸ¥è¯¢ ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœ B+æ ‘å¯ä»¥æŒ‰ç…§æŸç§æ–¹å¼æŸ¥æ‰¾åˆ°å€¼ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥æŒ‰ç…§è¿™ç§æ–¹å¼ç”¨äºæ’åºã€‚å¦‚æœ ORDER BY å­å¥æ»¡è¶³å‰é¢åˆ—å‡ºçš„å‡ ç§æŸ¥è¯¢ç±»å‹ï¼Œåˆ™è¿™ä¸ªç´¢å¼•ä¹Ÿå¯ä»¥æ»¡è¶³å¯¹åº”çš„æ’åºéœ€æ±‚ã€‚ ä¸‹é¢æ˜¯ä¸€äº›å…³äºB+æ ‘ç´¢å¼•çš„é™åˆ¶ï¼š å¦‚æœä¸æ˜¯æŒ‰ç…§ç´¢å¼•çš„æœ€å·¦åˆ—å¼€å§‹æŸ¥æ‰¾ï¼Œåˆ™æ— æ³•ä½¿ç”¨ç´¢å¼• ä¸èƒ½è·³è¿‡ç´¢å¼•ä¸­çš„åˆ— å¦‚æœæŸ¥è¯¢ä¸­æœ‰æŸä¸ªåˆ—çš„èŒƒå›´æŸ¥è¯¢ï¼Œåˆ™å…¶å³è¾¹æ‰€æœ‰åˆ—éƒ½æ— æ³•ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–æŸ¥æ‰¾ 3.2 Hash ç´¢å¼•Hashæ ‘æˆ‘åœ¨åšå®¢é«˜æ•ˆæŸ¥æ‰¾çš„æ•°æ®ç»“æ„-HashTreeï¼ˆå“ˆå¸Œæ ‘ï¼‰ä¹Ÿæåˆ°è¿‡äº†ã€‚ åªæœ‰ç²¾ç¡®åŒ¹é…ç´¢å¼•æ‰€æœ‰åˆ—çš„æŸ¥è¯¢æ‰æœ‰æ•ˆï¼Œåœ¨ MySQL ä¸­ï¼Œåªæœ‰ Memory å¼•æ“æ˜¾å¼æ”¯æŒ Hash ç´¢å¼•ã€‚ é™åˆ¶ï¼š å“ˆå¸Œç´¢å¼•åªåŒ…å«å“ˆå¸Œå€¼å’Œè¡ŒæŒ‡é’ˆï¼Œè€Œä¸å­˜å‚¨å­—æ®µå€¼ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨ç´¢å¼•ä¸­çš„å€¼æ¥é¿å…è¯»å–è¡Œï¼ˆæ— æ³•ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼‰ã€‚ä¸è¿‡ï¼Œè®¿é—®å†…å­˜ä¸­çš„è¡Œçš„é€Ÿåº¦å¾ˆå¿«ã€‚ å“ˆå¸Œç´¢å¼•æ•°æ®å¹¶ä¸æ˜¯æŒ‰ç…§ç´¢å¼•å€¼é¡ºåºå­˜å‚¨çš„ï¼Œæ‰€ä»¥æ— æ³•è¿›è¡Œæ’åº å“ˆå¸Œç´¢å¼•ä¸æ”¯æŒéƒ¨åˆ†ç´¢å¼•åˆ—åŒ¹é…æŸ¥æ‰¾ã€‚æ¯”å¦‚å»ºç«‹å¤åˆå“ˆå¸Œç´¢å¼•(A,B)ï¼Œæ— æ³•ä»…ä½¿ç”¨ A ä½¿ç”¨å“ˆå¸Œç´¢å¼•å»æŸ¥è¯¢ ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼Œä»…æ”¯æŒç­‰å€¼æŸ¥è¯¢ å“ˆå¸Œå†²çªä¸¥é‡æ—¶ï¼Œç´¢å¼•ç»´æŠ¤çš„ä»£ç å¾ˆé«˜ã€‚ 3.3 Bæ ‘ç´¢å¼•ä¸Hashç´¢å¼•æ¯”è¾ƒ å¦‚æœæ˜¯ç­‰å€¼æŸ¥è¯¢ï¼Œé‚£ä¹ˆå“ˆå¸Œç´¢å¼•æ˜æ˜¾æœ‰ç»å¯¹ä¼˜åŠ¿ï¼Œå› ä¸ºåªéœ€è¦ç»è¿‡ä¸€æ¬¡ç®—æ³•å³å¯æ‰¾åˆ°ç›¸åº”çš„é”®å€¼ï¼›å½“ç„¶äº†ï¼Œè¿™ä¸ªå‰ææ˜¯ï¼Œé”®å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚å¦‚æœé”®å€¼ä¸æ˜¯å”¯ä¸€çš„ï¼Œå°±éœ€è¦å…ˆæ‰¾åˆ°è¯¥é”®æ‰€åœ¨ä½ç½®ï¼Œç„¶åå†æ ¹æ®é“¾è¡¨å¾€åæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°ç›¸åº”çš„æ•°æ®ï¼›å¦‚æœæ˜¯èŒƒå›´æŸ¥è¯¢æ£€ç´¢ï¼Œè¿™æ—¶å€™å“ˆå¸Œç´¢å¼•å°±æ¯«æ— ç”¨æ­¦ä¹‹åœ°äº†ï¼Œå› ä¸ºåŸå…ˆæ˜¯æœ‰åºçš„é”®å€¼ï¼Œç»è¿‡å“ˆå¸Œç®—æ³•åï¼Œæœ‰å¯èƒ½å˜æˆä¸è¿ç»­çš„äº†ï¼Œå°±æ²¡åŠæ³•å†åˆ©ç”¨ç´¢å¼•å®ŒæˆèŒƒå›´æŸ¥è¯¢æ£€ç´¢ï¼› å“ˆå¸Œç´¢å¼•ä¹Ÿæ²¡åŠæ³•åˆ©ç”¨ç´¢å¼•å®Œæˆæ’åºï¼Œä»¥åŠ like â€˜xxx%â€™ è¿™æ ·çš„éƒ¨åˆ†æ¨¡ç³ŠæŸ¥è¯¢ï¼ˆè¿™ç§éƒ¨åˆ†æ¨¡ç³ŠæŸ¥è¯¢ï¼Œå…¶å®æœ¬è´¨ä¸Šä¹Ÿæ˜¯èŒƒå›´æŸ¥è¯¢ï¼‰ï¼› å“ˆå¸Œç´¢å¼•ä¹Ÿä¸æ”¯æŒå¤šåˆ—è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…è§„åˆ™ï¼› B+æ ‘ç´¢å¼•çš„å…³é”®å­—æ£€ç´¢æ•ˆç‡æ¯”è¾ƒå¹³å‡ï¼Œåœ¨æœ‰å¤§é‡é‡å¤é”®å€¼æƒ…å†µä¸‹ï¼Œå“ˆå¸Œç´¢å¼•çš„æ•ˆç‡æ˜¯æä½çš„ï¼Œå› ä¸ºå­˜åœ¨æ‰€è°“çš„å“ˆå¸Œç¢°æ’é—®é¢˜ã€‚ 4 ç´¢å¼•åˆ†ç±»â€”â€”ä»ç‰©ç†å­˜å‚¨è§’åº¦4.1 èšç°‡ç´¢å¼•ï¼ˆèšé›†ç´¢å¼•ï¼‰InnoDB çš„èšç°‡ç´¢å¼•å®é™…ä¸Šåœ¨åŒä¸€ä¸ªç»“æ„ä¸­ä¿å­˜äº†B+æ ‘ç´¢å¼•å’Œæ•°æ®è¡Œã€‚ å½“è¡¨æœ‰èšç°‡ç´¢å¼•æ—¶ï¼Œå®ƒçš„æ•°æ®è¡Œå®é™…ä¸Šå­˜æ”¾åœ¨ç´¢å¼•çš„å¶å­é¡µä¸­ã€‚èšç°‡è¡¨ç¤ºæ•°æ®è¡Œå’Œç›¸é‚»çš„é”®å€¼ç´§ç´§åœ°å­˜å‚¨åœ¨ä¸€èµ·ã€‚å› ä¸ºæ— æ³•åŒæ—¶æŠŠæ•°æ®è¡Œå­˜å‚¨åœ¨ä¸¤ä¸ªä¸åŒçš„åœ°æ–¹ï¼Œæ‰€ä»¥ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ã€‚ InnoDB é€šè¿‡ä¸»é”®èšç°‡æ•°æ®ã€‚ æ¯å¼ è¡¨éƒ½ä¼šæœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ã€‚èšç°‡ç´¢å¼•æ˜¯ä¸€çº§ç´¢å¼•ã€‚ èšç°‡ç´¢å¼•ä¸€èˆ¬æ˜¯ä¸»é”®ï¼›æ²¡æœ‰ä¸»é”®ï¼Œå°±æ˜¯ç¬¬ä¸€ä¸ªå”¯ä¸€é”®ï¼›æ²¡æœ‰å”¯ä¸€é”®ï¼Œå°±æ˜¯éšè—IDã€‚èšç°‡ç´¢å¼•ä»¥å¤–çš„æ‰€æœ‰ç´¢å¼•éƒ½ç§°ä¸ºäºŒçº§ç´¢å¼•ï¼ˆå³éèšç°‡ç´¢å¼•ï¼‰ã€‚ åœ¨ InnoDB ä¸­ï¼ŒäºŒçº§ç´¢å¼•ä¸­çš„æ¯æ¡è®°å½•éƒ½åŒ…å«è¯¥è¡Œçš„ä¸»é”®åˆ—ï¼Œä»¥åŠä¸ºäºŒçº§ç´¢å¼•æŒ‡å®šçš„åˆ—ã€‚ InnoDB ä½¿ç”¨è¿™ä¸ªä¸»é”®å€¼æ¥æœç´¢èšç°‡ç´¢å¼•ä¸­çš„è¡Œã€‚ èšç°‡ç´¢å¼•çš„ä¼˜ç‚¹ï¼š å¯ä»¥å°†ç›¸å…³æ•°æ®ä¿å­˜åœ¨ä¸€èµ·ï¼Œåªéœ€ä¸€æ¬¡ IO å°±å¯ä»¥å–å‡ºç›¸é‚»çš„æ•°æ® æ•°æ®è®¿é—®æ›´å¿«ï¼Œå› ä¸ºç´¢å¼•å’Œæ•°æ®ä¿å­˜åœ¨åŒä¸€ä¸ª B+æ ‘ä¸­ ä½¿ç”¨è¦†ç›–ç´¢å¼•æ‰«æçš„æŸ¥è¯¢å¯ä»¥ç›´æ¥ä½¿ç”¨å¶èŠ‚ç‚¹ä¸­çš„ä¸»é”®å€¼ ç¼ºç‚¹ï¼š æ’å…¥é€Ÿåº¦ä¸¥é‡ä¾èµ–äºæ’å…¥é¡ºåºã€‚æŒ‰ç…§ä¸»é”®çš„é¡ºåºæ’å…¥æ˜¯åŠ è½½æ•°æ®åˆ° InnoDB è¡¨ä¸­é€Ÿåº¦æœ€å¿«çš„æ–¹å¼ã€‚ä½†å¦‚æœä¸æ˜¯æŒ‰ç…§ä¸»é”®é¡ºåºåŠ è½½æ•°æ®ï¼Œé‚£ä¹ˆåœ¨åŠ è½½å®Œæˆåæœ€å¥½ä½¿ç”¨ OPTIMIZE TABLEå‘½ä»¤é‡æ–°ç»„ç»‡ä¸€ä¸‹è¡¨ æ›´æ–°èšç°‡ç´¢å¼•åˆ—çš„ä»£ä»·å¾ˆé«˜ï¼Œå› ä¸ºä¼šå¼ºåˆ¶ InnoDB å°†æ¯ä¸ªè¢«æ›´æ–°çš„è¡Œç§»åŠ¨åˆ°æ–°çš„ä½ç½® æ’å…¥æ–°è¡Œæˆ–è€…æ›´æ–°ä¸»é”®å¯¼è‡´éœ€è¦ç§»åŠ¨è¡Œçš„æ—¶å€™ï¼Œå¯èƒ½é¢ä¸´é¡µåˆ†è£‚çš„é—®é¢˜ã€‚å½“è¡Œçš„ä¸»é”®å€¼è¦æ±‚å¿…é¡»å°†è¿™ä¸€è¡Œæ’å…¥åˆ°æŸä¸ªå·²æ»¡çš„é¡µä¸­æ—¶ï¼Œå­˜å‚¨å¼•æ“ä¼šå°†è¯¥é¡µåˆ†è£‚æˆä¸¤ä¸ªé¡µé¢æ¥å®¹çº³è¯¥è¡Œï¼Œè¿™å°±æ˜¯ä¸€æ¬¡é¡µåˆ†è£‚æ“ä½œã€‚é¡µåˆ†è£‚ä¼šå¯¼è‡´è¡¨å ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´ã€‚ å¯èƒ½å¯¼è‡´å…¨è¡¨æ‰«æå˜æ…¢ï¼Œå°¤å…¶æ˜¯è¡Œæ¯”è¾ƒç¨€ç–ï¼Œæˆ–è€…ç”±äºé¡µåˆ†è£‚å¯¼è‡´æ•°æ®å­˜å‚¨ä¸è¿ç»­çš„æ—¶å€™ äºŒçº§ç´¢å¼•ï¼ˆéèšç°‡ç´¢å¼•ï¼‰å¯èƒ½ä¼šæ›´å¤§ï¼Œ å› ä¸ºåœ¨äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹åŒ…å«äº†å¼•ç”¨è¡Œçš„ä¸»é”®å€¼ã€‚è¿™æ ·çš„ç­–ç•¥å‡å°‘äº†å½“å‡ºç°è¡Œç§»åŠ¨æˆ–è€…é¡µåˆ†è£‚æ—¶äºŒçº§ç´¢å¼•çš„ç»´æŠ¤å·¥ä½œã€‚ äºŒçº§ç´¢å¼•è®¿é—®éœ€è¦ä¸¤æ¬¡ B æ ‘ç´¢å¼•æŸ¥æ‰¾ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡ã€‚å› ä¸ºäºŒçº§ç´¢å¼•ä¸­å¶å­èŠ‚ç‚¹ä¿å­˜çš„æ˜¯è¡Œçš„ä¸»é”®å€¼ï¼Œè¦æ‰¾åˆ°æ•°æ®è¡Œï¼Œè¿˜éœ€è¦æ‹¿ä¸»é”®å€¼åˆ°èšç°‡ç´¢å¼•ä¸­è¿›è¡Œä¸€æ¬¡æŸ¥æ‰¾ã€‚ å¯¹äº InnoDBï¼Œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•èƒ½å¤Ÿå‡å°‘è¿™æ ·çš„é‡å¤å·¥ä½œã€‚ 4.2 éèšç°‡ç´¢å¼•ï¼ˆè¾…åŠ©ç´¢å¼•ï¼‰å°±æ˜¯ä¸æ˜¯èšç°‡ç´¢å¼•ï¼Œåªå­˜å‚¨äº†èšç°‡ç´¢å¼•çš„å€¼ï¼Œè‹¥æ ¹æ®éèšç°‡ç´¢å¼•æŸ¥æ‰¾éè¦†ç›–ç´¢å¼•é¡¹åˆ™éœ€è¦å›è¡¨ï¼ˆæ‹¿èšç°‡ç´¢å¼•å€¼ï¼‰å†æŸ¥æ‰¾ä¸€éã€‚ 5 ç´¢å¼•ä½¿ç”¨çš„åŸºæœ¬åŸåˆ™ æœ€ç»å¸¸æŸ¥è¯¢çš„åˆ—ä¸Šå»ºç«‹èšç°‡ç´¢å¼•ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ ä¸€ä¸ªåŸºæœ¬è¡¨æœ€å¤šåªå»ºç«‹ä¸€ä¸ªèšç°‡ç´¢å¼• ç»å¸¸æ›´æ–°çš„åˆ—ä¸å®œå»ºç«‹èšç°‡ç´¢å¼• ä¸»é”®å’Œå”¯ä¸€é”®ä¼šè‡ªåŠ¨åˆ›å»ºç´¢å¼• 6 SQLç´¢å¼•è¯­æ³•6.1 åˆ›å»ºç´¢å¼•CREATE [UNIQUE|FULLTEXT|SPATIAL] INDEX index_name [USING index_type] ON tbl_name(index_col_name,...) index_col_name : column_name[(length)][ASC | DESC] uniqueï¼šå”¯ä¸€ç´¢å¼• fulltextï¼šå…¨æ–‡ç´¢å¼• spatialï¼šç©ºé—´ç´¢å¼• ç¤ºä¾‹ï¼š CREATE INDEX PersonIndex ON Person (LastName) CREATE INDEX PersonIndex ON Person (LastName DESC) å¤åˆç´¢å¼•ï¼š CREATE INDEX PersonIndex ON Person (LastName, FirstName) 6.2 æŸ¥çœ‹ç´¢å¼•show index from table_name; ä¼šæ˜¾ç¤ºæ‰€æœ‰å»ºåœ¨è¯¥è¡¨ä¸Šçš„ç´¢å¼•ä¿¡æ¯ 6.3 åˆ é™¤ç´¢å¼•DROP INDEX index_name ON tbl_name; è€ç‰ˆæœ¬å¥½åƒæ˜¯ ALTER TABLE table_name DROP INDEX index_name; ç¤ºä¾‹ï¼š DROP INDEX idx_city_name on city;","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"MySQL","slug":"MySQL","permalink":"https://www.codetool.top/tags/MySQL/"}]},{"title":"å¸¸ç”¨å¼€æºæ•°æ®åº“è¿æ¥æ± C3P0ã€Druidä»‹ç»","slug":"å¸¸ç”¨å¼€æºæ•°æ®åº“è¿æ¥æ± C3P0ã€Druidä»‹ç»","date":"2020-03-04T08:44:11.000Z","updated":"2020-04-01T17:25:31.928Z","comments":true,"path":"article/å¸¸ç”¨å¼€æºæ•°æ®åº“è¿æ¥æ± C3P0ã€Druidä»‹ç»/","link":"","permalink":"https://www.codetool.top/article/%E5%B8%B8%E7%94%A8%E5%BC%80%E6%BA%90%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0C3P0%E3%80%81Druid%E4%BB%8B%E7%BB%8D/","excerpt":"","text":"1 æ¦‚è¿°å¾ˆå¤šæ—¶å€™ï¼Œè¿æ¥çš„æ··ä¹±ç®¡ç†æ‰€é€ æˆçš„ç³»ç»Ÿèµ„æºå¼€é”€è¿‡å¤§æˆä¸ºåˆ¶çº¦å¤§å‹ä¼ä¸šçº§åº”ç”¨æ•ˆç‡çš„ç“¶é¢ˆã€‚å› ä¸ºæ¯ä¸€æ¬¡WEBè¯·æ±‚éƒ½è¦å»ºç«‹ä¸€æ¬¡æ•°æ®åº“è¿æ¥ï¼Œå»ºç«‹è¿æ¥æ˜¯ä¸€ä¸ªè€—è´¹èµ„æºçš„æ´»åŠ¨ï¼Œæ¯æ¬¡éƒ½å¾—èŠ±è´¹0.05-1sçš„æ—¶é—´ï¼Œè€Œä¸”ç³»ç»Ÿè¿˜è¦åˆ†é…å†…å­˜èµ„æºã€‚ æ•°æ®åº“è¿æ¥æ± çš„åŸºæœ¬æ€æƒ³å°±æ˜¯ä¸ºæ•°æ®åº“è¿æ¥å»ºç«‹ä¸€ä¸ªâ€œç¼“å†²æ± â€ã€‚äºç°åœ¨ç¼“å†²æ± ä¸­æ”¾å…¥ä¸€å®šæ•°é‡çš„è¿æ¥ï¼Œå½“éœ€è¦å»ºç«‹æ•°æ®åº“è¿æ¥æ—¶ï¼Œåªéœ€ä»ç¼“å†²æ± ä¸­å–å‡ºä¸€ä¸ªï¼Œä½¿ç”¨å®Œæ¯•ä»¥åå†æ”¾å›å»å³å¯ã€‚ 2 C3P0C3P0æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„å¼€æºæ•°æ®åº“è¿æ¥æ± ï¼Œè¢«å¹¿æ³›ä½¿ç”¨ã€‚ 2.1 ä½¿ç”¨mavenä¾èµ–ï¼š &lt;dependency> &lt;groupId>c3p0&lt;/groupId> &lt;artifactId>c3p0&lt;/artifactId> &lt;version>0.9.1.2&lt;/version> &lt;/dependency> åŸºæœ¬é…ç½®ï¼š &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;c3p0-config> &lt;!-- é»˜è®¤é…ç½®ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šåˆ™ä½¿ç”¨è¿™ä¸ªé…ç½® --> &lt;default-config> &lt;property name=\"user\">root&lt;/property> &lt;property name=\"password\">123456&lt;/property> &lt;property name=\"jdbcUrl\">jdbc:mysql://192.168.91.1:3306/test&lt;/property> &lt;property name=\"driverClass\">com.mysql.cj.jdbc.Driver&lt;/property> &lt;/default-config> &lt;!-- å‘½åçš„é…ç½®,å¯ä»¥é€šè¿‡æ–¹æ³•è°ƒç”¨å®ç° --> &lt;named-config name=\"test\"> &lt;!-- ... --> &lt;/named-config> &lt;/c3p0-config> å…¶ä»–é…ç½®ï¼š å‚æ•° é»˜è®¤å€¼ è§£é‡Š initialPoolSize 3 è¿æ¥æ± åˆå§‹åŒ–æ—¶åˆ›å»ºçš„è¿æ¥æ•°ï¼ˆä»‹äºmaxPoolSizeå’ŒminPoolSizeä¹‹é—´ï¼‰ maxPoolSize 15 è¿æ¥æ± ä¸­æ‹¥æœ‰çš„æœ€å¤§è¿æ¥æ•°ï¼Œå¦‚æœè·å¾—æ–°è¿æ¥æ—¶ä¼šä½¿è¿æ¥æ€»æ•°è¶…è¿‡è¿™ä¸ªå€¼åˆ™ä¸ä¼šå†è·å–æ–°è¿æ¥ï¼Œè€Œæ˜¯ç­‰å¾…å…¶ä»–è¿æ¥é‡Šæ”¾ï¼Œæ‰€ä»¥è¿™ä¸ªå€¼æœ‰å¯èƒ½ä¼šè®¾è®¡åœ°å¾ˆå¤§ minPoolSize 3 è¿æ¥æ± ä¿æŒçš„æœ€å°è¿æ¥æ•°ï¼Œåé¢çš„maxIdleTimeExcessConnectionsè·Ÿè¿™ä¸ªé…åˆä½¿ç”¨æ¥å‡è½»è¿æ¥æ± çš„è´Ÿè½½ acquireIncrement 3 è¿æ¥æ± åœ¨æ— ç©ºé—²è¿æ¥å¯ç”¨æ—¶ä¸€æ¬¡æ€§åˆ›å»ºçš„æ–°æ•°æ®åº“è¿æ¥æ•° maxIdleTime 0 è¿æ¥çš„æœ€å¤§ç©ºé—²æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼ŒæŸä¸ªæ•°æ®åº“è¿æ¥è¿˜æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œåˆ™ä¼šæ–­å¼€æ‰è¿™ä¸ªè¿æ¥å¦‚æœä¸º0ï¼Œåˆ™æ°¸è¿œä¸ä¼šæ–­å¼€è¿æ¥ maxConnectorAge 0 è¿æ¥çš„æœ€å¤§ç»å¯¹å¹´é¾„ï¼Œå•ä½æ˜¯ç§’ï¼Œ0è¡¨ç¤ºç»å¯¹å¹´é¾„æ— é™å¤§ maxIdleTimeExcessConnection 0 å•ä½ç§’ï¼Œä¸ºäº†å‡è½»è¿æ¥æ± çš„è´Ÿè½½ï¼Œå½“è¿æ¥æ± ç»è¿‡æ•°æ®è®¿é—®é«˜å³°åˆ›å»ºäº†å¾ˆå¤šè¿æ¥ï¼Œä½†æ˜¯åé¢è¿æ¥æ± ä¸éœ€è¦ç»´æŠ¤è¿™ä¹ˆå¤šè¿æ¥ï¼Œå¿…é¡»å°äºmaxIdleTime.é…ç½®ä¸ä¸º0ï¼Œåˆ™å°†è¿æ¥æ± çš„æ•°é‡ä¿æŒåˆ°minPoolSize automaticTestTable null å¦‚æœä¸ä¸ºnullï¼Œc3p0å°†ç”ŸæˆæŒ‡å®šåç§°çš„ç©ºè¡¨ï¼Œä½¿ç”¨è¯¥è¡¨æ¥æµ‹è¯•è¿æ¥ connectionTesterClassName com.mchange.v2.c3p0.impl.DefaultConnectionTester é€šè¿‡å®ç°ConnectionTesteræˆ–QueryConnectionTesterçš„ç±»æ¥æµ‹è¯•è¿æ¥ã€‚ç±»åéœ€åˆ¶å®šå…¨è·¯å¾„ã€‚ idleConnectionTestPeriod 0 æ¯ä¸ªå‡ ç§’æ£€æŸ¥æ‰€æœ‰è¿æ¥æ± ä¸­çš„ç©ºé—²è¿æ¥ preferredTestQuery null å®šä¹‰æ‰€æœ‰è¿æ¥æµ‹è¯•éƒ½æ‰§è¡Œçš„æµ‹è¯•è¯­å¥ã€‚åœ¨ä½¿ç”¨è¿æ¥æµ‹è¯•çš„æƒ…å†µä¸‹è¿™ä¸ªä¸€æ˜¾è‘—æé«˜æµ‹è¯•é€Ÿåº¦ã€‚æ³¨æ„ï¼š æµ‹è¯•çš„è¡¨å¿…é¡»åœ¨åˆå§‹æ•°æ®æºçš„æ—¶å€™å°±å­˜åœ¨ testConnectionOnCheckin FALSE å¦‚æœè®¾ä¸ºtrueé‚£ä¹ˆåœ¨å–å¾—è¿æ¥çš„åŒæ—¶å°†æ ¡éªŒè¿æ¥çš„æœ‰æ•ˆæ€§ testConnectionOnCheckout FALSE å¦‚æœä¸ºtrueï¼Œåœ¨è¿æ¥é‡Šæ”¾çš„åŒäº‹å°†æ ¡éªŒè¿æ¥çš„æœ‰æ•ˆæ€§ã€‚ maxStatements 0 JDBCçš„æ ‡å‡†å‚æ•°ï¼Œç”¨ä»¥æ§åˆ¶æ•°æ®æºå†…åŠ è½½dçš„PreparedStatementsæ•°é‡ maxStatementsPerConnection 0 maxStatementsPerConnectionå®šä¹‰äº†è¿æ¥æ± å†…å•ä¸ªè¿æ¥æ‰€æ‹¥æœ‰çš„æœ€å¤§ç¼“å­˜statementsæ•° statementCacheNum-DeferredCloseThreads 0 å¦‚æœå¤§äºé›¶ï¼Œåˆ™è¯­å¥æ± å°†å»¶è¿Ÿç‰©ç†close()ç¼“å­˜è¯­å¥ç›´åˆ°å…¶çˆ¶è¿æ¥æœªè¢«ä»»ä½•å®¢æˆ·ç«¯ä½¿ç”¨ï¼Œæˆ–è€…åœ¨å…¶å†…éƒ¨ï¼ˆä¾‹å¦‚åœ¨æµ‹è¯•ä¸­ï¼‰ç”±æ± æœ¬èº«ä½¿ç”¨ã€‚ acquireRetryAttempts 30 å®šä¹‰åœ¨ä»æ•°æ®åº“è·å–æ–°è¿æ¥å¤±è´¥åé‡å¤å°è¯•çš„æ¬¡æ•° acquireRetryDelay 1000 ä¸¤æ¬¡è¿æ¥é—´éš”æ—¶é—´ï¼Œå•ä½æ¯«ç§’ breakAfterAcquireFailure FALSE è·å–è¿æ¥å¤±è´¥å°†ä¼šå¼•èµ·æ‰€æœ‰ç­‰å¾…è¿æ¥æ± æ¥è·å–è¿æ¥çš„çº¿ç¨‹æŠ›å‡ºå¼‚å¸¸ã€‚ä½†æ˜¯æ•°æ®æºä»æœ‰æ•ˆ ä¿ç•™ï¼Œå¹¶åœ¨ä¸‹æ¬¡è°ƒç”¨getConnection()çš„æ—¶å€™ç»§ç»­å°è¯•è·å–è¿æ¥ã€‚å¦‚æœè®¾ä¸ºtrueï¼Œé‚£ä¹ˆåœ¨å°è¯• è·å–è¿æ¥å¤±è´¥åè¯¥æ•°æ®æºå°†ç”³æ˜å·²æ–­å¼€å¹¶æ°¸ä¹…å…³é—­ autoCommitOnClose FALSE è¿æ¥å…³é—­æ—¶é»˜è®¤å°†æ‰€æœ‰æœªæäº¤çš„æ“ä½œå›æ»šã€‚å¦‚æœä¸ºtrueï¼Œåˆ™æœªæäº¤è®¾ç½®ä¸ºå¾…æäº¤è€Œä¸æ˜¯å›æ»šã€‚ forceIgnoreUnresolvedTransactions FALSE å®˜æ–¹æ–‡æ¡£å»ºè®®è¿™ä¸ªä¸è¦è®¾ç½®ä¸ºtrue checkoutTimeout 0 å½“è¿æ¥æ± ç”¨å®Œæ—¶å®¢æˆ·ç«¯è°ƒç”¨getConnection()åç­‰å¾…è·å–æ–°è¿æ¥çš„æ—¶é—´ï¼Œè¶…æ—¶åå°†æŠ›å‡ºSQLException,å¦‚è®¾ä¸º0åˆ™æ— é™æœŸç­‰å¾…ã€‚å•ä½æ¯«ç§’ã€‚ factoryClassLocation 0 æŒ‡å®šc3p0 librariesçš„è·¯å¾„ï¼Œå¦‚æœï¼ˆé€šå¸¸éƒ½æ˜¯è¿™æ ·ï¼‰åœ¨æœ¬åœ°å³å¯è·å¾—é‚£ä¹ˆæ— éœ€è®¾ç½®ï¼Œé»˜è®¤nullå³å¯ numHelperThreads 3 c3p0æ˜¯å¼‚æ­¥æ“ä½œçš„ï¼Œç¼“æ…¢çš„JDBCæ“ä½œé€šè¿‡å¸®åŠ©è¿›ç¨‹å®Œæˆã€‚æ‰©å±•è¿™äº›æ“ä½œå¯ä»¥æœ‰æ•ˆçš„æå‡æ€§èƒ½é€šè¿‡å¤šçº¿ç¨‹å®ç°å¤šä¸ªæ“ä½œåŒæ—¶è¢«æ‰§è¡Œ ä½¿ç”¨ï¼š DataSource dataSource = new ComboPooledDataSource(); å®ƒä¼šè‡ªåŠ¨å»ç±»è·¯å¾„ä¸‹æŸ¥æ‰¾åä¸ºc3p0-config.xmlé…ç½®æ–‡ä»¶å¹¶åŠ è½½ã€‚ å¯ä»¥ä½¿ç”¨å‘½åçš„é…ç½®ï¼š DataSource dataSource = new ComboPooledDataSource(\"test\"); ä½¿ç”¨çš„å°±æ˜¯name=&quot;test&quot;çš„named-config 3 DruidDruidæ˜¯é˜¿é‡Œå¼€æºçš„ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± ï¼Œå€Ÿé‰´äº†C3P0ç­‰æˆç†Ÿè¿æ¥æ± çš„æ€æƒ³ï¼Œå…·æœ‰è¯¸å¤šä¼˜ç‚¹ 3.1 ä½¿ç”¨mavenä¾èµ–ï¼š &lt;dependency> &lt;groupId>com.alibaba&lt;/groupId> &lt;artifactId>druid&lt;/artifactId> &lt;version>1.1.2&lt;/version> &lt;/dependency> åŸºæœ¬é…ç½®ï¼š driverClassName = com.mysql.cj.jdbc.Driver url = jdbc:mysql://192.168.91.1:3306/test username = root password = 123456 å…¶ä»–é…ç½®ï¼š é…ç½® é»˜è®¤å€¼ è¯´æ˜ initialSize 0 åˆå§‹åŒ–æ—¶å»ºç«‹ç‰©ç†è¿æ¥çš„ä¸ªæ•°ã€‚åˆå§‹åŒ–å‘ç”Ÿåœ¨æ˜¾å¼è°ƒç”¨ init æ–¹æ³•ï¼Œæˆ–è€…ç¬¬ä¸€æ¬¡getConnection æ—¶ maxActive 8 æœ€å¤§å…è®¸çš„è¿æ¥æ•° maxIdle å·²è¿‡æœŸ minIdle æœ€å°çš„ç©ºé—²è¿æ¥æ•° maxWait è·å–è¿æ¥æ—¶æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œå•ä½æ¯«ç§’ã€‚é…ç½®äº† maxWait ä¹‹åï¼Œç¼ºçœå¯ç”¨å…¬å¹³é”ï¼Œå¹¶å‘æ•ˆç‡ä¼šæœ‰æ‰€ä¸‹é™ï¼Œå¦‚æœéœ€è¦å¯ä»¥é€šè¿‡é…ç½® useUnfairLock å±æ€§ä¸º true ä½¿ç”¨éå…¬å¹³é”ã€‚ validationQuery ç”¨æ¥æ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆçš„ sqlï¼Œè¦æ±‚æ˜¯ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ã€‚ testOnBorrow TRUE ç”³è¯·è¿æ¥æ—¶æ‰§è¡Œ validationQuery æ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆï¼Œåšäº†è¿™ä¸ªé…ç½®ä¼šé™ä½æ€§èƒ½ã€‚ testOnReturn FALSE å½’è¿˜è¿æ¥æ—¶æ‰§è¡Œ validationQuery æ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆï¼Œåšäº†è¿™ä¸ªé…ç½®ä¼šé™ä½æ€§èƒ½ testWhileIdle FALSE è®¾ç½®ç©ºé—²æ—¶æ˜¯å¦æ£€æµ‹è¿æ¥å¯ç”¨æ€§ã€‚å»ºè®®é…ç½®ä¸ºtrueï¼Œä¸å½±å“æ€§èƒ½ï¼Œå¹¶ä¸”ä¿è¯å®‰å…¨æ€§ã€‚ç”³è¯·è¿æ¥çš„æ—¶å€™æ£€æµ‹ï¼Œå¦‚æœç©ºé—²æ—¶é—´å¤§äº timeBetweenEvictionRunsMillisï¼Œæ‰§è¡Œ validationQuery æ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆã€‚ timeBetweenEvictionRunsMillis æ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿æ¥çš„é—´éš”æ—¶é—´ minEvictableIdleTimeMillis è¿æ¥åœ¨æ± ä¸­çš„æœ€å°ç”Ÿå­˜æ—¶é—´ connectionInitSqls ç‰©ç†è¿æ¥åˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡Œçš„sql filters å±æ€§ç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œé€šè¿‡åˆ«åçš„æ–¹å¼é…ç½®æ‰©å±•æ’ä»¶ï¼Œå¸¸ç”¨çš„æ’ä»¶æœ‰ï¼š ç›‘æ§ç»Ÿè®¡ç”¨çš„filter:statæ—¥å¿—ç”¨çš„filter:log4jé˜²å¾¡sqlæ³¨å…¥çš„filter:wall proxyFilters ç±»å‹æ˜¯List&lt;com.alibaba.druid.filter.Filter&gt;ï¼Œå¦‚æœåŒæ—¶é…ç½®äº†filterså’ŒproxyFiltersï¼Œæ˜¯ç»„åˆå…³ç³»ï¼Œå¹¶éæ›¿æ¢å…³ç³» ä½¿ç”¨ï¼š Properties properties = new Properties(); InputStream in = Demo1.class.getClassLoader().getResourceAsStream(\"druid.properties\"); properties.load(in); DataSource dataSource = DruidDataSourceFactory.createDataSource(properties); //ä½¿ç”¨è¿æ¥æ±  conn = dataSource.getConnection(); 3.2 æºç public DruidPooledConnection getConnection(long maxWaitMillis) throws SQLException { init(); if (filters.size() > 0) { FilterChainImpl filterChain = new FilterChainImpl(this); return filterChain.dataSource_connect(this, maxWaitMillis); } else { return getConnectionDirect(maxWaitMillis); } } DruidPooledConnectionå†…éƒ¨åŒ…è£…äº†ä¸€ä¸ªConnectionï¼Œå¢å¼ºäº†closeç­‰æ–¹æ³• @Override public void close() throws SQLException { if (this.disable) { return; } DruidConnectionHolder holder = this.holder; if (holder == null) { if (dupCloseLogEnable) { LOG.error(\"dup close\"); } return; } DruidAbstractDataSource dataSource = holder.getDataSource(); boolean isSameThread = this.getOwnerThread() == Thread.currentThread(); if (!isSameThread) { dataSource.setAsyncCloseConnectionEnable(true); } if (dataSource.isAsyncCloseConnectionEnable()) { syncClose(); return; } for (ConnectionEventListener listener : holder.getConnectionEventListeners()) { listener.connectionClosed(new ConnectionEvent(this)); } List&lt;Filter> filters = dataSource.getProxyFilters(); if (filters.size() > 0) { FilterChainImpl filterChain = new FilterChainImpl(dataSource); filterChain.dataSource_recycle(this); } else { recycle(); } this.disable = true; } ã€é™„ã€‘äº†è§£ï¼šDBUtilsçš„ä½¿ç”¨ QueryRunnerã€DbUtilsã€ResultSetHandlerã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"javaweb","slug":"javaweb","permalink":"https://www.codetool.top/tags/javaweb/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"}]},{"title":"leetcode994-è…çƒ‚çš„æ©˜å­","slug":"leetcode994-è…çƒ‚çš„æ©˜å­","date":"2020-03-03T17:23:30.000Z","updated":"2020-04-30T05:51:02.367Z","comments":true,"path":"article/leetcode994-è…çƒ‚çš„æ©˜å­/","link":"","permalink":"https://www.codetool.top/article/leetcode994-%E8%85%90%E7%83%82%E7%9A%84%E6%A9%98%E5%AD%90/","excerpt":"","text":"1 åŸé¢˜åœ¨ç»™å®šçš„ç½‘æ ¼ä¸­ï¼Œæ¯ä¸ªå•å…ƒæ ¼å¯ä»¥æœ‰ä»¥ä¸‹ä¸‰ä¸ªå€¼ä¹‹ä¸€ï¼š å€¼ 0 ä»£è¡¨ç©ºå•å…ƒæ ¼ï¼›å€¼ 1 ä»£è¡¨æ–°é²œæ©˜å­ï¼›å€¼ 2 ä»£è¡¨è…çƒ‚çš„æ©˜å­ã€‚æ¯åˆ†é’Ÿï¼Œä»»ä½•ä¸è…çƒ‚çš„æ©˜å­ï¼ˆåœ¨ 4 ä¸ªæ­£æ–¹å‘ä¸Šï¼‰ç›¸é‚»çš„æ–°é²œæ©˜å­éƒ½ä¼šè…çƒ‚ã€‚ è¿”å›ç›´åˆ°å•å…ƒæ ¼ä¸­æ²¡æœ‰æ–°é²œæ©˜å­ä¸ºæ­¢æ‰€å¿…é¡»ç»è¿‡çš„æœ€å°åˆ†é’Ÿæ•°ã€‚å¦‚æœä¸å¯èƒ½ï¼Œè¿”å› -1ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: [[2,1,1],[1,1,0],[0,1,1]]è¾“å‡º: 4 ç¤ºä¾‹ 2: è¾“å…¥: [[2,1,1],[0,1,1],[1,0,1]]è¾“å‡º: -1è§£é‡Š: å·¦ä¸‹è§’çš„æ©˜å­ï¼ˆç¬¬ 2 è¡Œï¼Œ ç¬¬ 0 åˆ—ï¼‰æ°¸è¿œä¸ä¼šè…çƒ‚ï¼Œå› ä¸ºè…çƒ‚åªä¼šå‘ç”Ÿåœ¨ 4 ä¸ªæ­£å‘ä¸Šã€‚ ç¤ºä¾‹ 3: è¾“å…¥: [[0,2]]è¾“å‡º: 0è§£é‡Š: å› ä¸º 0 åˆ†é’Ÿæ—¶å·²ç»æ²¡æœ‰æ–°é²œæ©˜å­äº†ï¼Œæ‰€ä»¥ç­”æ¡ˆå°±æ˜¯ 0 ã€‚ æç¤ºï¼š 1 &lt;= grid.length &lt;= 10 1 &lt;= grid[0].length &lt;= 10 grid[i][j] ä»…ä¸º 0ã€1 æˆ– 2 2 è§£æ³•2.1 æ€æƒ³å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼Œæ¯æ¬¡å°†æœç´¢åˆ°çš„æ–°é²œæ©˜å­ææˆ2ï¼Œæœ€åå†æœç´¢ä¸€éå…¨å›¾æ˜¯å¦æœ‰å‰©ä½™çš„æ–°é²œæ©˜å­ã€‚ 2.2 ä»£ç class Solution { int height; int width; public int orangesRotting(int[][] grid) { Queue&lt;Integer> queue = new LinkedList&lt;>(); height = grid.length; if(height == 0) return 0; width = grid[0].length; for(int i = 0;i&lt;height;i++){ for(int j = 0;j&lt;width;j++){ if(grid[i][j]==2) queue.offer(i*width+j); } } queue.offer(null); int cur = 0; while(!queue.isEmpty()){ Integer i = queue.poll(); if(i==null){ if(queue.isEmpty()) break; cur++; queue.offer(null); continue; } int x = i/width; int y = i%width; if(x!=0 &amp;&amp; grid[x-1][y]==1){ queue.offer(toInt(x-1,y)); grid[x-1][y]=2; } if(x!=height-1 &amp;&amp; grid[x+1][y]==1){ queue.offer(toInt(x+1,y)); grid[x+1][y]=2; } if(y!=0 &amp;&amp; grid[x][y-1]==1) { queue.offer(toInt(x,y-1)); grid[x][y-1]=2; } if(y!=width-1 &amp;&amp; grid[x][y+1]==1) { queue.offer(toInt(x,y+1)); grid[x][y+1]=2; } } for(int i = 0;i&lt;height;i++){ for(int j = 0;j&lt;width;j++){ if(grid[i][j]==1) return -1; } } return cur; } public int toInt(int x,int y){ return x*width+y; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"Redisé«˜å¹¶å‘ç¯å¢ƒä¸‹å‡ºç°çš„å„ç§é—®é¢˜è¯¦è§£ï¼ˆé«˜å¯ç”¨ï¼‰","slug":"Redisé«˜å¹¶å‘ç¯å¢ƒä¸‹å‡ºç°çš„å„ç§é—®é¢˜è¯¦è§£","date":"2020-03-03T16:43:37.000Z","updated":"2020-03-05T15:33:55.991Z","comments":true,"path":"article/Redisé«˜å¹¶å‘ç¯å¢ƒä¸‹å‡ºç°çš„å„ç§é—®é¢˜è¯¦è§£/","link":"","permalink":"https://www.codetool.top/article/Redis%E9%AB%98%E5%B9%B6%E5%8F%91%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%87%BA%E7%8E%B0%E7%9A%84%E5%90%84%E7%A7%8D%E9%97%AE%E9%A2%98%E8%AF%A6%E8%A7%A3/","excerpt":"","text":"1 ç¼“å­˜é¢„çƒ­æœåŠ¡å™¨å¯åŠ¨åè¿…é€Ÿå®•æœº é—®é¢˜åŸå› ï¼š è¯·æ±‚æ•°é‡è¾ƒé«˜ ä¸»ä»ä¹‹é—´æ•°æ®ååé‡è¾ƒå¤§ï¼Œæ•°æ®åŒæ­¥æ“ä½œé¢‘åº¦è¾ƒé«˜ 1.1 è§£å†³æ–¹æ¡ˆå‰ç½®å‡†å¤‡å·¥ä½œï¼š æ—¥å¸¸ä¾‹è¡Œç»Ÿè®¡æ•°æ®è®¿é—®è®°å½•ï¼Œç»Ÿè®¡è®¿é—®é¢‘åº¦è¾ƒé«˜çš„çƒ­ç‚¹æ•°æ® åˆ©ç”¨LRUæ•°æ®åˆ é™¤ç­–ç•¥ï¼Œæ„å»ºæ•°æ®ç•™å­˜é˜Ÿåˆ—ä¾‹å¦‚ï¼šstormä¸kafkaé…åˆ å‡†å¤‡å·¥ä½œï¼š å°†ç»Ÿè®¡ç»“æœä¸­çš„æ•°æ®åˆ†ç±»ï¼Œæ ¹æ®çº§åˆ«ï¼Œredisä¼˜å…ˆåŠ è½½çº§åˆ«è¾ƒé«˜çš„çƒ­ç‚¹æ•°æ® åˆ©ç”¨åˆ†å¸ƒå¼å¤šæœåŠ¡å™¨åŒæ—¶è¿›è¡Œæ•°æ®è¯»å–ï¼Œæé€Ÿæ•°æ®åŠ è½½è¿‡ç¨‹ çƒ­ç‚¹æ•°æ®ä¸»ä»åŒæ—¶é¢„çƒ­å®æ–½ï¼š ä½¿ç”¨è„šæœ¬ç¨‹åºå›ºå®šè§¦å‘æ•°æ®é¢„çƒ­è¿‡ç¨‹ å¦‚æœæ¡ä»¶å…è®¸ï¼Œä½¿ç”¨äº†CDNï¼ˆå†…å®¹åˆ†å‘ç½‘ç»œï¼‰ï¼Œæ•ˆæœä¼šæ›´å¥½ 1.2 æ€»ç»“ç¼“å­˜é¢„çƒ­å°±æ˜¯ç³»ç»Ÿå¯åŠ¨å‰ï¼Œæå‰å°†ç›¸å…³çš„ç¼“å­˜æ•°æ®ç›´æ¥åŠ è½½åˆ°ç¼“å­˜ç³»ç»Ÿã€‚é¿å…åœ¨ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå†å°†æ•°æ®ç¼“å­˜çš„é—®é¢˜ï¼ç”¨æˆ·ç›´æ¥æŸ¥è¯¢äº‹å…ˆè¢«é¢„çƒ­çš„ç¼“å­˜æ•°æ®ï¼ 2 ç¼“å­˜é›ªå´©ç¼“å­˜é›ªå´©å°±æ˜¯ç¬é—´è¿‡æœŸæ•°æ®é‡å¤ªå¤§ï¼Œå¯¼è‡´å¯¹æ•°æ®åº“æœåŠ¡å™¨é€ æˆå‹åŠ›ã€‚å¦‚èƒ½å¤Ÿæœ‰æ•ˆé¿å…è¿‡æœŸæ—¶é—´é›†ä¸­ï¼Œå¯ä»¥æœ‰æ•ˆè§£å†³é›ªå´©ç°è±¡çš„å‡ºç°ï¼ˆçº¦40%ï¼‰ï¼Œé…åˆå…¶ä»–ç­–ç•¥ä¸€èµ·ä½¿ç”¨ï¼Œå¹¶ç›‘æ§æœåŠ¡å™¨çš„è¿è¡Œæ•°æ®ï¼Œæ ¹æ®è¿è¡Œè®°å½•åšå¿«é€Ÿè°ƒæ•´ã€‚ 2.1 é—®é¢˜ä½“ç° ç³»ç»Ÿå¹³ç¨³è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¿½ç„¶æ•°æ®åº“è¿æ¥é‡æ¿€å¢ åº”ç”¨æœåŠ¡å™¨æ— æ³•åŠæ—¶å¤„ç†è¯·æ±‚ å¤§é‡408ï¼Œ500é”™è¯¯é¡µé¢å‡ºç° å®¢æˆ·åå¤åˆ·æ–°é¡µé¢è·å–æ•°æ® æ•°æ®åº“å´©æºƒ åº”ç”¨æœåŠ¡å™¨å´©æºƒ é‡å¯åº”ç”¨æœåŠ¡å™¨æ— æ•ˆ RedisæœåŠ¡å™¨å´©æºƒ Redisé›†ç¾¤å´©æºƒ é‡å¯æ•°æ®åº“åå†æ¬¡è¢«ç¬é—´æµé‡æ”¾å€’ 2.2 åŸå› åˆ†æ åœ¨ä¸€ä¸ªè¾ƒçŸ­çš„æ—¶é—´å†…ï¼Œç¼“å­˜ä¸­è¾ƒå¤šçš„keyé›†ä¸­è¿‡æœŸ æ­¤å‘¨æœŸå†…è¯·æ±‚è®¿é—®è¿‡æœŸçš„æ•°æ®ï¼Œredisæœªå‘½ä¸­ï¼Œrediså‘æ•°æ®åº“è·å–æ•°æ® æ•°æ®åº“åŒæ—¶æ¥æ”¶åˆ°å¤§é‡çš„è¯·æ±‚æ— æ³•åŠæ—¶å¤„ç† Rediså¤§é‡è¯·æ±‚è¢«ç§¯å‹ï¼Œå¼€å§‹å‡ºç°è¶…æ—¶ç°è±¡ æ•°æ®åº“æµé‡æ¿€å¢ï¼Œæ•°æ®åº“å´©æºƒ é‡å¯åä»ç„¶é¢å¯¹ç¼“å­˜ä¸­æ— æ•°æ®å¯ç”¨ RedisæœåŠ¡å™¨èµ„æºè¢«ä¸¥é‡å ç”¨ï¼ŒRedisæœåŠ¡å™¨å´©æºƒ Redisé›†ç¾¤å‘ˆç°å´©å¡Œï¼Œé›†ç¾¤ç“¦è§£ åº”ç”¨æœåŠ¡å™¨æ— æ³•åŠæ—¶å¾—åˆ°æ•°æ®å“åº”è¯·æ±‚ï¼Œæ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚æ•°é‡è¶Šæ¥è¶Šå¤šï¼Œåº”ç”¨æœåŠ¡å™¨å´©æºƒ åº”ç”¨æœåŠ¡å™¨ï¼Œredisï¼Œæ•°æ®åº“å…¨éƒ¨é‡å¯ï¼Œæ•ˆæœä¸ç†æƒ³ 2.3 è§£å†³æ–¹æ¡ˆé™ä½æ•°æ®åº“å‹åŠ›ï¼š æ›´å¤šçš„é¡µé¢é™æ€åŒ–å¤„ç† æ„å»ºå¤šçº§ç¼“å­˜æ¶æ„Nginxç¼“å­˜+redisç¼“å­˜+ehcacheç¼“å­˜ æ£€æµ‹Mysqlä¸¥é‡è€—æ—¶ä¸šåŠ¡è¿›è¡Œä¼˜åŒ–å¯¹æ•°æ®åº“çš„ç“¶é¢ˆæ’æŸ¥ï¼šä¾‹å¦‚è¶…æ—¶æŸ¥è¯¢ã€è€—æ—¶è¾ƒé«˜äº‹åŠ¡ç­‰ ç¾éš¾é¢„è­¦æœºåˆ¶ ç›‘æ§redisæœåŠ¡å™¨æ€§èƒ½æŒ‡æ ‡ CPUå ç”¨ã€CPUä½¿ç”¨ç‡ å†…å­˜å®¹é‡ æŸ¥è¯¢å¹³å‡å“åº”æ—¶é—´ çº¿ç¨‹æ•° é™æµã€é™çº§çŸ­æ—¶é—´èŒƒå›´å†…ç‰ºç‰²ä¸€äº›å®¢æˆ·ä½“éªŒï¼Œé™åˆ¶ä¸€éƒ¨åˆ†è¯·æ±‚è®¿é—®ï¼Œé™ä½åº”ç”¨æœåŠ¡å™¨å‹åŠ›ï¼Œå¾…ä¸šåŠ¡ä½é€Ÿè¿è½¬åå†é€æ­¥æ”¾å¼€è®¿é—® é¿å…çŸ­æ—¶é—´å¤§é‡keyé›†ä¸­è¿‡æœŸï¼š LRUä¸LFUåˆ‡æ¢ æ•°æ®æœ‰æ•ˆæœŸç­–ç•¥è°ƒæ•´ æ ¹æ®ä¸šåŠ¡æ•°æ®æœ‰æ•ˆæœŸè¿›è¡Œåˆ†ç±»é”™å³°ï¼ŒAç±»90åˆ†é’Ÿï¼ŒBç±»80åˆ†é’Ÿï¼ŒCç±»70åˆ†é’Ÿ è¿‡æœŸæ—¶é—´ä½¿ç”¨å›ºå®šæ—¶é—´+éšæœºå€¼çš„å½¢å¼ï¼Œç¨€é‡Šé›†ä¸­åˆ°æœŸçš„keyçš„æ•°é‡ è¶…çƒ­æ•°æ®ä½¿ç”¨æ°¸ä¹…key å®šæœŸç»´æŠ¤ï¼ˆè‡ªåŠ¨+äººå·¥ï¼‰å¯¹å³å°†è¿‡æœŸæ•°æ®åšè®¿é—®é‡åˆ†æï¼Œç¡®è®¤æ˜¯å¦å»¶æ—¶ï¼Œé…åˆè®¿é—®é‡ç»Ÿè®¡ï¼Œåšçƒ­ç‚¹æ•°æ®çš„å»¶æ—¶ åŠ é” æ…ç”¨ï¼ 3 ç¼“å­˜å‡»ç©¿ç¼“å­˜å‡»ç©¿å°±æ˜¯å•ä¸ªé«˜çƒ­æ•°æ®è¿‡æœŸçš„ç¬é—´ï¼Œæ•°æ®è®¿é—®é‡è¾ƒå¤§ï¼Œæœªå‘½ä¸­redisåï¼Œå‘èµ·äº†å¤§é‡å¯¹åŒä¸€æ•°æ®çš„æ•°æ®åº“è®¿é—®ï¼Œå¯¼è‡´å¯¹æ•°æ®åº“æœåŠ¡å™¨é€ æˆå‹åŠ›ã€‚åº”å¯¹ç­–ç•¥åº”è¯¥åœ¨ä¸šåŠ¡æ•°æ®åˆ†æä¸é¢„é˜²æ–¹é¢è¿›è¡Œï¼Œé…åˆè¿è¡Œç›‘æ§æµ‹è¯•ä¸å³æ—¶è°ƒæ•´ç­–ç•¥ï¼Œæ¯•ç«Ÿå•ä¸ªkeyçš„è¿‡æœŸç›‘æ§éš¾åº¦è¾ƒé«˜ï¼Œé…åˆé›ªå´©å¤„ç†ç­–ç•¥å³å¯ã€‚ 3.1 é—®é¢˜ä½“ç° ç³»ç»Ÿå¹³ç¨³è¿è¡Œè¿‡ç¨‹ä¸­ æ•°æ®åº“è¿æ¥é‡ç¬é—´æ¿€å¢ RedisæœåŠ¡å™¨æ— å¤§é‡keyè¿‡æœŸ Rediså†…å­˜å¹³ç¨³ï¼Œæ— æ³¢åŠ¨ RedisæœåŠ¡å™¨CPUæ­£å¸¸ æ•°æ®åº“å´©æºƒ 3.2 åŸå› åˆ†æ Redisä¸­æŸä¸ªkeyè¿‡æœŸï¼Œè¯¥keyè®¿é—®é‡å·¨å¤§ å¤šä¸ªæ•°æ®è¯·æ±‚ä»æœåŠ¡å™¨ç›´æ¥å‹åˆ°Redisåï¼Œå‡æœªå‘½ä¸­ Redisåœ¨çŸ­æ—¶é—´å†…å‘èµ·äº†å¤§é‡å¯¹æ•°æ®åº“ä¸­åŒä¸€æ•°æ®çš„è®¿é—® 3.3 è§£å†³æ–¹æ¡ˆé˜²æ­¢é«˜çƒ­keyè¿‡æœŸï¼š é¢„å…ˆè®¾å®šä»¥ç”µå•†ä¸ºä¾‹ï¼Œæ¯ä¸ªå•†å®¶æ ¹æ®åº—é“ºç­‰çº§ï¼ŒæŒ‡å®šè‹¥å¹²æ¬¾ä¸»æ‰“å•†å“ï¼Œåœ¨è´­ç‰©èŠ‚æœŸé—´ï¼ŒåŠ å¤§æ­¤ç±»ä¿¡æ¯keyçš„è¿‡æœŸæ—¶é•¿æ³¨æ„ï¼šè´­ç‰©èŠ‚ä¸ä»…ä»…æŒ‡å½“å¤©ï¼Œä»¥åŠåç»­è‹¥å¹²å¤©ï¼Œè®¿é—®å³°å€¼å‘ˆç°é€æ¸é™ä½çš„è¶‹åŠ¿ ç°åœºè°ƒæ•´ç›‘æ§è®¿é—®é‡ï¼Œå¯¹è‡ªç„¶æµé‡æ¿€å¢çš„æ•°æ®å»¶é•¿è¿‡æœŸæ—¶é—´æˆ–è®¾ç½®ä¸ºæ°¸ä¹…æ€§key åå°åˆ·æ–°æ•°æ®å¯åŠ¨å®šæ—¶ä»»åŠ¡ï¼Œé«˜å³°æœŸæ¥ä¸´ä¹‹å‰ï¼Œåˆ·æ–°æ•°æ®æœ‰æ•ˆæœŸï¼Œç¡®ä¿ä¸ä¸¢å¤± äºŒçº§ç¼“å­˜è®¾ç½®ä¸åŒçš„å¤±æ•ˆæ—¶é—´ï¼Œä¿éšœä¸ä¼šè¢«åŒæ—¶æ·˜æ±°å°±è¡Œ åŠ é”åˆ†å¸ƒå¼é”ï¼Œé˜²æ­¢è¢«å‡»ç©¿ï¼Œä½†æ˜¯è¦æ³¨æ„ä¹Ÿæ˜¯æ€§èƒ½ç“¶é¢ˆï¼Œæ…é‡ï¼ å…³äºé›ªå´©ä¸­é™ä½æ•°æ®åº“å‹åŠ›çš„æ–¹æ³•ä¹Ÿé€‚ç”¨ã€‚ 4 ç¼“å­˜ç©¿é€ç¼“å­˜ç©¿é€è®¿é—®äº†ä¸å­˜åœ¨çš„æ•°æ®ï¼Œè·³è¿‡äº†åˆæ³•æ•°æ®çš„redisæ•°æ®ç¼“å­˜é˜¶æ®µï¼Œæ¯æ¬¡è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´å¯¹æ•°æ®åº“æœåŠ¡å™¨é€ æˆå‹åŠ›ã€‚é€šå¸¸æ­¤ç±»æ•°æ®çš„å‡ºç°é‡æ˜¯ä¸€ä¸ªè¾ƒä½çš„å€¼ï¼Œå½“å‡ºç°æ­¤ç±»æƒ…å†µä»¥æ¯’æ”»æ¯’ï¼Œå¹¶åŠæ—¶æŠ¥è­¦ã€‚åº”å¯¹ç­–ç•¥åº”è¯¥åœ¨ä¸´æ—¶é¢„æ¡ˆé˜²èŒƒæ–¹é¢å¤šåšæ–‡ç« ã€‚ æ— è®ºæ˜¯é»‘åå•è¿˜æ˜¯ç™½åå•ï¼Œéƒ½æ˜¯å¯¹æ•´ä½“ç³»ç»Ÿçš„å‹åŠ›ï¼Œè­¦æŠ¥è§£é™¤åå°½å¿«ç§»é™¤ã€‚ 4.1 é—®é¢˜ä½“ç° ç³»ç»Ÿå¹³ç¨³è¿è¡Œè¿‡ç¨‹ä¸­ åº”ç”¨æœåŠ¡å™¨æµé‡éšæ—¶é—´å¢é‡è¾ƒå¤§ RedisæœåŠ¡å™¨å‘½ä¸­ç‡éšæ—¶é—´é€æ­¥é™ä½ Rediså†…å­˜å¹³ç¨³ï¼Œå†…å­˜æ— å‹åŠ› RedisæœåŠ¡å™¨CPUå ç”¨æ¿€å¢ æ•°æ®åº“æœåŠ¡å™¨å‹åŠ›æ¿€å¢ æ•°æ®åº“å´©æºƒ 4.2 åŸå› åˆ†æ å‡ºç°éæ­£å¸¸URLè®¿é—®ï¼ˆé€šå¸¸æ˜¯é»‘å®¢æ”»å‡»ï¼‰ Redisä¸­å¤§é¢ç§¯å‡ºç°æœªå‘½ä¸­ è·å–çš„æ•°æ®åœ¨æ•°æ®åº“ä¸­ä¹Ÿä¸å­˜åœ¨ï¼Œæ•°æ®åº“æŸ¥è¯¢æœªå¾—åˆ°å¯¹åº”æ•°æ®ã€‚ åå¤å‡ºç°ä»¥ä¸Šæƒ…å†µï¼Œrediså’Œæ•°æ®åº“çš„å‹åŠ›æ¿€å¢ã€‚ 4.3 è§£å†³æ–¹æ¡ˆ ç¼“å­˜nullå¯¹æŸ¥è¯¢ç»“æœä¸ºnullçš„æ•°æ®è¿›è¡Œç¼“å­˜ï¼ˆé•¿æœŸä½¿ç”¨ï¼Œå®šæœŸæ¸…ç†ï¼‰ï¼Œè®¾å®šçŸ­æ—¶é™ï¼Œä¾‹å¦‚30-60ç§’ï¼Œæœ€é«˜5åˆ†é’Ÿ ç™½åå•ç­–ç•¥ æå‰é¢„çƒ­å„ç§åˆ†ç±»æ•°æ®idå¯¹åº”çš„bitmapsï¼Œidä½œä¸ºbitmapsçš„offsetï¼Œç›¸å½“äºè®¾ç½®äº†æ•°æ®ç™½åå•ã€‚å½“åŠ è½½æ­£å¸¸æ•°æ®æ—¶ï¼Œæ”¾è¡Œï¼ŒåŠ è½½å¼‚å¸¸æ•°æ®æ—¶ç›´æ¥æ‹¦æˆªï¼ˆæ•ˆç‡åä½ï¼‰ ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆæœ‰å…³å¸ƒéš†è¿‡æ»¤å™¨çš„å‘½ä¸­é—®é¢˜å¯¹å½“å‰çŠ¶å†µå¯ä»¥å¿½ç•¥ï¼‰ å®æ–½ç›‘æ§ å®æ—¶ç›‘æ§rediså‘½ä¸­ç‡ï¼ˆä¸šåŠ¡æ­£å¸¸èŒƒå›´æ—¶ï¼Œé€šå¸¸ä¼šæœ‰ä¸€ä¸ªæ³¢åŠ¨å€¼ï¼‰ä¸nullæ•°æ®çš„å æ¯” éæ´»åŠ¨æ—¶æ®µæ³¢åŠ¨ï¼šé€šå¸¸æ£€æµ‹3-5å€ï¼Œè¶…è¿‡5å€çº³å…¥é‡ç‚¹æ’æŸ¥å¯¹è±¡ æ´»åŠ¨æ—¶æ®µæ³¢åŠ¨ï¼šé€šå¸¸æ£€æµ‹10-50å€ï¼Œè¶…è¿‡50å€çº³å…¥é‡ç‚¹æ’æŸ¥å¯¹è±¡æ ¹æ®å€æ•°ä¸åŒï¼Œå¯åŠ¨ä¸åŒçš„æ’æŸ¥æµç¨‹ã€‚ç„¶åä½¿ç”¨é»‘åå•è¿›è¡Œé˜²æ§ï¼ˆè¿è¥ï¼‰ keyåŠ å¯†é—®é¢˜å‡ºç°åï¼Œä¸´æ—¶å¯åŠ¨é˜²ç¾ä¸šåŠ¡keyï¼Œå¯¹keyè¿›è¡Œä¸šåŠ¡å±‚ä¼ è¾“åŠ å¯†æœåŠ¡ï¼Œè®¾å®šæ ¡éªŒç¨‹åºï¼Œè¿‡æ¥çš„keyæ ¡éªŒã€‚ä¾‹å¦‚æ¯å¤©éšæœºåˆ†é…60ä¸ªåŠ å¯†ä¸²ï¼ŒæŒ‘é€‰2åˆ°3ä¸ªï¼Œæ··æ·†åˆ°é¡µé¢æ•°æ®idä¸­ï¼Œå‘ç°è®¿é—®keyä¸æ»¡è¶³è§„åˆ™ï¼Œé©³å›æ•°æ®è®¿é—®ã€‚ 5 Redisæ€§èƒ½æŒ‡æ ‡ç›‘æ§5.1 æ€§èƒ½æŒ‡æ ‡ Name Description latency Rediså“åº”ä¸€ä¸ªè¯·æ±‚çš„æ—¶é—´ instantaneous_ops_per_sec å¹³å‡æ¯ç§’å¤„ç†è¯·æ±‚æ€»æ•° hit rate (calculated) ç¼“å­˜å‘½ä¸­ç‡(è®¡ç®—å‡ºæ¥çš„) 5.2 å†…å­˜æŒ‡æ ‡ Name Description used_memory å·²ä½¿ç”¨å†…å­˜ mem_fragmentation_ratio å†…å­˜ç¢ç‰‡ç‡ evicted_keys ç”±äºæœ€å¤§å†…å­˜é™åˆ¶è¢«ç§»é™¤çš„keyçš„æ•°é‡ blocked_clients ç”±äºBLPOP,BRPOP,or BRPOPLPUSHè€Œè¢«é˜»å¡çš„å®¢æˆ·ç«¯ 5.3 åŸºæœ¬æ´»åŠ¨æŒ‡æ ‡ Name Description connected_clients å®¢æˆ·ç«¯è¿æ¥æ•° connected_slaves Slaveæ•°é‡ master_last_io_seconds_ago æœ€è¿‘ä¸€æ¬¡ä¸»ä»äº¤äº’ä¹‹åçš„ç§’æ•° keyspace æ•°æ®åº“ä¸­çš„keyå€¼æ€»æ•° 5.4 æŒä¹…æ€§æŒ‡æ ‡ Name Description rdb_last_save_time æœ€åä¸€æ¬¡æŒä¹…åŒ–ä¿å­˜åˆ°ç£ç›˜çš„æ—¶é—´æˆ³ rdb_changes_since_last_save è‡ªæœ€åä¸€æ¬¡æŒä¹…åŒ–ä»¥æ¥æ•°æ®åº“çš„æ›´æ”¹æ•° 5.5 é”™è¯¯æŒ‡æ ‡ Name Description rejected_connections ç”±äºè¾¾åˆ°maxclienté™åˆ¶è€Œè¢«æ‹’ç»çš„è¿æ¥æ•° keyspace_misses Keyå€¼æŸ¥æ‰¾å¤±è´¥(æ²¡æœ‰å‘½ä¸­)æ¬¡æ•° master_link_down_since_seconds ä¸»ä»æ–­å¼€çš„æŒç»­æ—¶é—´(ä»¥ç§’ä¸ºå•ä½) 5.6 ç›‘æ§æ–¹å¼ç›‘æ§æ–¹å¼ å·¥å…· Cloud Insight Redis Prometheus Redis-stat Redis-faina RedisLive zabbix å‘½ä»¤ benchmark redis-cli monitor slowlog 5.6.1 benchmarkå‘½ä»¤ï¼š redis-benchmark [-h ] [-p ] [-c ] [-n &lt;requests]&gt; [-k ]ä¸å¸¦å‚æ•°è¿è¡Œredis-benchmarkä¼šæµ‹è¯•50ä¸ªè¿æ¥ï¼Œ10000æ¬¡è¯·æ±‚å¯¹åº”çš„æ€§èƒ½ redis-benchmark -c 100 -n 5000å¯ä»¥æµ‹è¯•100ä¸ªè¿æ¥ï¼Œ5000æ¬¡è¯·æ±‚å¯¹åº”çš„æ€§èƒ½ é€‰é¡¹ æè¿° é»˜è®¤å€¼ -h æŒ‡å®šæœåŠ¡å™¨ä¸»æœºå 127.0.0.1 -p æŒ‡å®šæœåŠ¡å™¨ç«¯å£ 6379 -s æŒ‡å®šæœåŠ¡å™¨ socket -c æŒ‡å®šå¹¶å‘è¿æ¥æ•° 50 -n æŒ‡å®šè¯·æ±‚æ•° 10000 -d ä»¥å­—èŠ‚çš„å½¢å¼æŒ‡å®šSET/GETå€¼çš„æ•°æ®å¤§å° 2 -k 1=keep alive 0=reconnect 1 -r SET/GET/INCRä½¿ç”¨éšæœºkey,SADDä½¿ç”¨éšæœºå€¼ -P é€šè¿‡ç®¡é“ä¼ è¾“&lt;numreq&gt;è¯·æ±‚ 1 -q å¼ºåˆ¶é€€å‡ºredisã€‚ä»…æ˜¾ç¤ºquery/secå€¼ â€“csv ä»¥CSVæ ¼å¼è¾“å‡º -l ç”Ÿæˆå¾ªç¯,æ°¸ä¹…æ‰§è¡Œæµ‹è¯• -t ä»…è¿è¡Œä»¥é€—å·åˆ†éš”çš„æµ‹è¯•å‘½ä»¤åˆ—è¡¨ã€‚ -I Idleæ¨¡å¼ã€‚ä»…æ‰“å¼€Nä¸ªidleè¿æ¥å¹¶ç­‰å¾…ã€‚ 5.7 monitoråœ¨redis-cliä¸­ä½¿ç”¨æŒ‡ä»¤ monitor æ‰“å°æœåŠ¡å™¨çš„è°ƒè¯•ä¿¡æ¯ã€‚ 5.8 slowlogslowlog [operator]operatorå¯å–ï¼š get ï¼šè·å–æ…¢æŸ¥è¯¢æ—¥å¿— len ï¼šè·å–æ…¢æŸ¥è¯¢æ—¥å¿—æ¡ç›®æ•° reset ï¼šé‡ç½®æ…¢æŸ¥è¯¢æ—¥å¿— ç›¸å…³é…ç½®ï¼š slowlog-log-slower-than 1000 #è®¾ç½®æ…¢æŸ¥è¯¢çš„æ—¶é—´ä¸‹çº¿ï¼Œå•ä½ï¼šå¾®å¦™ slowlog-max-len 100 #è®¾ç½®æ…¢æŸ¥è¯¢å‘½ä»¤å¯¹åº”çš„æ—¥å¿—æ˜¾ç¤ºé•¿åº¦ï¼Œå•ä½ï¼šå‘½ä»¤æ•°","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"https://www.codetool.top/tags/Redis/"}]},{"title":"Redisä¸»ä»å¤åˆ¶ã€å“¨å…µã€é›†ç¾¤è¯¦è§£","slug":"Redisä¸»ä»å¤åˆ¶ã€å“¨å…µã€é›†ç¾¤è¯¦è§£","date":"2020-03-03T15:03:16.000Z","updated":"2020-03-03T15:15:32.017Z","comments":true,"path":"article/Redisä¸»ä»å¤åˆ¶ã€å“¨å…µã€é›†ç¾¤è¯¦è§£/","link":"","permalink":"https://www.codetool.top/article/Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E3%80%81%E5%93%A8%E5%85%B5%E3%80%81%E9%9B%86%E7%BE%A4%E8%AF%A6%E8%A7%A3/","excerpt":"","text":"ã€è¡¥å……ã€‘é«˜å¯ç”¨ï¼šï¼ˆæ€»æ—¶é—´-å®•æœºæ—¶é—´ï¼‰/æ€»æ—¶é—´ï¼Œç›®æ ‡æ˜¯99.999% 1 ä¸»ä»å¤åˆ¶ä¸ºäº†é¿å…å•ç‚¹RedisæœåŠ¡å™¨æ•…éšœï¼Œå‡†å¤‡å¤šå°æœåŠ¡å™¨ï¼Œäº’ç›¸è¿é€šã€‚å°†æ•°æ®å¤åˆ¶å¤šä¸ªå‰¯æœ¬ä¿å­˜åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œè¿æ¥åœ¨ä¸€èµ·ï¼Œå¹¶ä¿è¯æ•°æ®æ˜¯åŒæ­¥çš„ã€‚å³ä½¿æœ‰å…¶ä¸­ä¸€å°æœåŠ¡å™¨å®•æœºï¼Œå…¶ä»–æœåŠ¡å™¨ä¾ç„¶å¯ä»¥ç»§ç»­æä¾›æœåŠ¡ï¼Œå®ç°Redisçš„é«˜å¯ç”¨ï¼ŒåŒæ—¶å®ç°æ•°æ®å†—ä½™å¤‡ä»½ã€‚ æä¾›æ•°æ®æ–¹ï¼šmasteræ¥æ”¶æ•°æ®æ–¹ï¼šslave ä»æœºé€šå¸¸ä¸å…è®¸å†™ï¼Œå½“ä¸»æœºå®•æœºï¼Œéœ€è¦ä¸´æ—¶æ¨é€‰å‡ºä¸€ä¸ªä»æœºä»£æ›¿ä¸»æœºå·¥ä½œã€‚ 1.1 ä½œç”¨ è¯»å†™åˆ†ç¦»ï¼šmasterå†™ã€slaveè¯»ï¼Œæé«˜æœåŠ¡å™¨çš„è´Ÿè½½èƒ½åŠ›ã€‚ è´Ÿè½½å‡è¡¡ï¼šåŸºäºä¸»ä»ç»“æ„ï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œç”±slaveåˆ†æ‹…masterè´Ÿè½½ï¼Œå¹¶æ ¹æ®éœ€æ±‚çš„å˜åŒ–ï¼Œæ”¹å˜slaveçš„æ•°é‡ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹åˆ†æ‹…æ•°æ®è¯»å–è´Ÿè½½ï¼Œå¤§å¤§æé«˜RedisæœåŠ¡å™¨å¹¶å‘é‡ä¸æ•°æ®ååé‡ æ•…éšœæ¢å¤ï¼šå½“masterå‡ºç°é—®é¢˜æ—¶ï¼Œç”±slaveæä¾›æœåŠ¡ï¼Œå®ç°å¿«é€Ÿçš„æ•…éšœæ¢å¤ æ•°æ®å†—ä½™ï¼šå®ç°æ•°æ®çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼ é«˜å¯ç”¨åŸºçŸ³ï¼šåŸºäºä¸»ä»å¤åˆ¶ï¼Œæ„å»ºå“¨å…µæ¨¡å¼ä¸é›†ç¾¤ï¼Œå®ç°Redisçš„é«˜å¯ç”¨æ–¹æ¡ˆ 1.2 å·¥ä½œæµç¨‹ä¸»ä»å¤åˆ¶è¿‡ç¨‹å¤§ä½“å¯ä»¥åˆ†ä¸º3ä¸ªé˜¶æ®µ å»ºç«‹è¿æ¥é˜¶æ®µï¼ˆå³å‡†å¤‡é˜¶æ®µï¼‰ æ•°æ®åŒæ­¥é˜¶æ®µ å‘½ä»¤ä¼ æ’­é˜¶æ®µ 1.2.1 å»ºç«‹è¿æ¥å»ºç«‹slaveåˆ°masterçš„è¿æ¥ï¼Œä½¿masterèƒ½å¤Ÿè¯†åˆ«slaveï¼Œå¹¶ä¿å­˜slaveç«¯å£å· æ­¥éª¤1ï¼šè®¾ç½®masterçš„åœ°å€å’Œç«¯å£ï¼Œä¿å­˜masterä¿¡æ¯ æ­¥éª¤2ï¼šå»ºç«‹socketè¿æ¥ æ­¥éª¤3ï¼šå‘é€pingå‘½ä»¤ï¼ˆå®šæ—¶å™¨ä»»åŠ¡ï¼‰ï¼ˆæ–­å¼€é‡è¿ï¼‰ æ­¥éª¤4ï¼šèº«ä»½éªŒè¯ æ­¥éª¤5ï¼šå‘é€slaveç«¯å£ä¿¡æ¯ å…·ä½“å®ç°ï¼š è®¾ç½®masterä¿¡æ¯ï¼š æ–¹å¼ä¸€ï¼šå®¢æˆ·ç«¯å‘é€å‘½ä»¤slaveof &lt;masterip&gt; &lt;masterport&gt; æ–¹å¼äºŒï¼šå¯åŠ¨æœåŠ¡å™¨å‚æ•°redis-server -slaveof &lt;masterip&gt; &lt;masterport&gt; æ–¹å¼ä¸‰ï¼šæœåŠ¡å™¨é…ç½®slaveof &lt;masterip&gt; &lt;masterport&gt; æ–­å¼€æ–¹å¼ï¼šslaveof no one é…ç½®æˆæƒè®¤è¯ï¼š masterè®¾ç½®å¯†ç çš„æ–¹æ³•ï¼š é…ç½®æ–‡ä»¶ï¼šrequirepass &lt;password&gt; æŒ‡ä»¤è®¾ç½®å¯†ç ï¼šconfig set requirepass &lt;password&gt; slaveå¯†ç è®¤è¯æ–¹æ³•ï¼š æŒ‡ä»¤ï¼šauth &lt;password&gt; å¯åŠ¨å®¢æˆ·ç«¯å‚æ•°ï¼šredis-cli -a &lt;password&gt; é…ç½®æ–‡ä»¶ï¼šmasterauth &lt;password&gt; 1.2.2 æ•°æ®åŒæ­¥ åœ¨slaveåˆæ¬¡è¿æ¥masteråï¼Œå¤åˆ¶masterä¸­çš„æ‰€æœ‰æ•°æ®åˆ°slave å°†slaveçš„æ•°æ®åº“çŠ¶æ€æ›´æ–°æˆmasterå½“å‰çš„æ•°æ®åº“çŠ¶æ€ è¿æ¥åçš„ç¬¬ä¸€æ¬¡åŒæ­¥æ˜¯å…¨é‡å¤åˆ¶ï¼š slaveå‘é€æŒ‡ä»¤ï¼špsync2 masteræ‰§è¡Œbgsaveï¼Œäº§ç”Ÿrdbæ–‡ä»¶ï¼Œè¿™æ®µæ—¶é—´å†…æ‰§è¡Œçš„æŒ‡ä»¤æ”¾åœ¨å‘½ä»¤ç¼“å†²åŒºä¸­ masterå°†rdbæ–‡ä»¶å‘ç»™slave slaveä»rdbæ–‡ä»¶ä¸­æ¢å¤æ•°æ® ç„¶åæ˜¯éƒ¨åˆ†ï¼ˆå¢é‡ï¼‰å¤åˆ¶ï¼š masterå°†å‘½ä»¤ç¼“å†²åŒºä¸­æŒ‡ä»¤ä»¥aofçš„æ ¼å¼å‘é€ç»™slave slaveæ‰§è¡ŒæŒ‡ä»¤ä»¥åŒæ­¥ æ•°æ®åŒæ­¥é˜¶æ®µmasterè¯´æ˜ï¼š å¦‚æœmasteræ•°æ®é‡å·¨å¤§ï¼Œæ•°æ®åŒæ­¥é˜¶æ®µåº”é¿å¼€æµé‡é«˜å³°æœŸï¼Œé¿å…é€ æˆmasteré˜»å¡ï¼Œå½±å“ä¸šåŠ¡æ­£å¸¸æ‰§è¡Œ å¤åˆ¶ç¼“å†²åŒºå¤§å°è®¾å®šä¸åˆç†ï¼Œä¼šå¯¼è‡´æ•°æ®æº¢å‡ºã€‚å¦‚è¿›è¡Œå…¨é‡å¤åˆ¶å‘¨æœŸå¤ªé•¿ï¼Œè¿›è¡Œéƒ¨åˆ†å¤åˆ¶æ—¶å‘ç°æ•°æ®å·²ç»å­˜åœ¨ä¸¢å¤±çš„æƒ…å†µï¼Œå¿…é¡»è¿›è¡Œç¬¬äºŒæ¬¡å…¨é‡å¤åˆ¶ï¼Œè‡´ä½¿slaveé™·å…¥æ­»å¾ªç¯çŠ¶æ€ã€‚ç›¸å…³é…ç½®ï¼šrepl-backlog-size 1mb masterå•æœºå†…å­˜å ç”¨ä¸»æœºå†…å­˜çš„æ¯”ä¾‹ä¸åº”è¿‡å¤§ï¼Œå»ºè®®ä½¿ç”¨50%-70%çš„å†…å­˜ï¼Œç•™ä¸‹30%-50%çš„å†…å­˜ç”¨äºæ‰§è¡Œbgsaveå‘½ä»¤å’Œåˆ›å»ºå¤åˆ¶ç¼“å†²åŒº æ•°æ®åŒæ­¥é˜¶æ®µslaveè¯´æ˜ï¼š ä¸ºé¿å…slaveè¿›è¡Œå…¨é‡å¤åˆ¶ã€éƒ¨åˆ†å¤åˆ¶æ—¶æœåŠ¡å™¨å“åº”é˜»å¡æˆ–æ•°æ®ä¸åŒæ­¥ï¼Œå»ºè®®å…³é—­æ­¤æœŸé—´çš„å¯¹å¤–æœåŠ¡ç›¸å…³é…ç½®ï¼šslave-serve-stale-data yes|no æ•°æ®åŒæ­¥é˜¶æ®µï¼Œmasterå‘é€ç»™slaveä¿¡æ¯å¯ä»¥ç†è§£masteræ˜¯slaveçš„ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œä¸»åŠ¨å‘slaveå‘é€å‘½ä»¤ å¤šä¸ªslaveåŒæ—¶å¯¹masterè¯·æ±‚æ•°æ®åŒæ­¥ï¼Œmasterå‘é€çš„RDBæ–‡ä»¶å¢å¤šï¼Œä¼šå¯¹å¸¦å®½é€ æˆå·¨å¤§å†²å‡»ï¼Œå¦‚æœmasterå¸¦å®½ä¸è¶³ï¼Œå› æ­¤æ•°æ®åŒæ­¥éœ€è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œé€‚é‡é”™å³° slaveè¿‡å¤šæ—¶ï¼Œå»ºè®®è°ƒæ•´æ‹“æ‰‘ç»“æ„ï¼Œç”±ä¸€ä¸»å¤šä»ç»“æ„å˜ä¸ºæ ‘çŠ¶ç»“æ„ï¼Œä¸­é—´çš„èŠ‚ç‚¹æ—¢æ˜¯masterï¼Œä¹Ÿæ˜¯slaveã€‚æ³¨æ„ä½¿ç”¨æ ‘çŠ¶ç»“æ„æ—¶ï¼Œç”±äºå±‚çº§æ·±åº¦ï¼Œå¯¼è‡´æ·±åº¦è¶Šé«˜çš„slaveä¸æœ€é¡¶å±‚masteré—´æ•°æ®åŒæ­¥å»¶è¿Ÿè¾ƒå¤§ï¼Œæ•°æ®ä¸€è‡´æ€§å˜å·®ï¼Œåº”è°¨æ…é€‰æ‹© 1.2.3 å‘½ä»¤ä¼ æ’­ å½“masteræ•°æ®åº“çŠ¶æ€è¢«ä¿®æ”¹åï¼Œå¯¼è‡´ä¸»ä»æœåŠ¡å™¨æ•°æ®åº“çŠ¶æ€ä¸ä¸€è‡´ï¼Œæ­¤æ—¶éœ€è¦è®©ä¸»ä»æ•°æ®åŒæ­¥åˆ°ä¸€è‡´çš„çŠ¶æ€ï¼ŒåŒæ­¥çš„åŠ¨ä½œç§°ä¸ºå‘½ä»¤ä¼ æ’­ masterå°†æ¥æ”¶åˆ°çš„æ•°æ®å˜æ›´å‘½ä»¤å‘é€ç»™slaveï¼Œslaveæ¥æ”¶å‘½ä»¤åæ‰§è¡Œå‘½ä»¤ å‘½ä»¤ä¼ æ’­é˜¶æ®µçš„éƒ¨åˆ†å¤åˆ¶ï¼š å¦‚æœå‘½ä»¤ä¼ æ’­é˜¶æ®µå‡ºç°äº†æ–­ç½‘ç°è±¡ï¼š ç½‘ç»œé—ªæ–­é—ªè¿ â€”â€”å¿½ç•¥ çŸ­æ—¶é—´ç½‘ç»œä¸­æ–­ â€”â€”éƒ¨åˆ†å¤åˆ¶ é•¿æ—¶é—´ç½‘ç»œä¸­æ–­ â€”â€”å…¨é‡å¤åˆ¶ éƒ¨åˆ†å¤åˆ¶çš„ä¸‰ä¸ªæ ¸å¿ƒè¦ç´ ï¼š æœåŠ¡å™¨çš„è¿è¡ŒID æœåŠ¡å™¨è¿è¡ŒIDæ˜¯æ¯ä¸€å°æœåŠ¡å™¨æ¯æ¬¡è¿è¡Œçš„èº«ä»½è¯†åˆ«ç ï¼Œä¸€å°æœåŠ¡å™¨å¤šæ¬¡è¿è¡Œå¯ä»¥ç”Ÿæˆå¤šä¸ªè¿è¡Œidã€‚ ç»„æˆï¼šè¿è¡Œidç”±40ä½å­—ç¬¦ç»„æˆï¼Œæ˜¯ä¸€ä¸ªéšæœºçš„åå…­è¿›åˆ¶å­—ç¬¦ä¾‹å¦‚ï¼šfdc9ff13b9bbaab28db42b3d50f852bb5e3fcdceã€‚ ä½œç”¨ï¼šè¿è¡Œidè¢«ç”¨äºåœ¨æœåŠ¡å™¨é—´è¿›è¡Œä¼ è¾“ï¼Œè¯†åˆ«èº«ä»½ã€‚å¦‚æœæƒ³ä¸¤æ¬¡æ“ä½œå‡å¯¹åŒä¸€å°æœåŠ¡å™¨è¿›è¡Œï¼Œå¿…é¡»æ¯æ¬¡æ“ä½œæºå¸¦å¯¹åº”çš„è¿è¡Œidï¼Œç”¨äºå¯¹æ–¹è¯†åˆ«ã€‚ å®ç°æ–¹å¼ï¼šè¿è¡Œidåœ¨æ¯å°æœåŠ¡å™¨å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œmasteråœ¨é¦–æ¬¡è¿æ¥slaveæ—¶ï¼Œä¼šå°†è‡ªå·±çš„è¿è¡ŒIDå‘é€ç»™slaveï¼Œslaveä¿å­˜æ­¤IDï¼Œé€šè¿‡info Serverå‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹èŠ‚ç‚¹çš„runidã€‚ ä¸»æœåŠ¡å™¨çš„å¤åˆ¶ç§¯å‹ç¼“å†²åŒº å¤åˆ¶ç¼“å†²åŒºï¼Œåˆåå¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼Œæ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„é˜Ÿåˆ—ï¼Œç”¨äºå­˜å‚¨æœåŠ¡å™¨æ‰§è¡Œè¿‡çš„å‘½ä»¤ï¼Œæ¯æ¬¡ä¼ æ’­å‘½ä»¤ï¼Œmasteréƒ½ä¼šå°†ä¼ æ’­çš„å‘½ä»¤è®°å½•ä¸‹æ¥ï¼Œå¹¶å­˜å‚¨åœ¨å¤åˆ¶ç¼“å†²åŒº å†…å®¹å°±æ˜¯AOFæ–‡ä»¶çš„æ ¼å¼ï¼Œæ¯ä¸ªå­—èŠ‚å€¼è¿˜æœ‰ä¸€ä¸ªåç§»é‡ã€‚ ä¸»ä»æœåŠ¡å™¨çš„å¤åˆ¶åç§»é‡ ä¸€ä¸ªæ•°å­—ï¼Œæè¿°å¤åˆ¶ç¼“å†²åŒºä¸­çš„æŒ‡ä»¤å­—èŠ‚ä½ç½® åˆ†ç±»ï¼š masterå¤åˆ¶åç§»é‡ï¼šè®°å½•å‘é€ç»™æ‰€æœ‰slaveçš„æŒ‡ä»¤å­—èŠ‚å¯¹åº”çš„ä½ç½®ï¼ˆå¤šä¸ªï¼‰ slaveå¤åˆ¶åç§»é‡ï¼šè®°å½•slaveæ¥æ”¶masterå‘é€è¿‡æ¥çš„æŒ‡ä»¤å­—èŠ‚å¯¹åº”çš„ä½ç½®ï¼ˆä¸€ä¸ªï¼‰ ä½œç”¨ï¼šåŒæ­¥ä¿¡æ¯ï¼Œæ¯”å¯¹masterä¸slaveçš„å·®å¼‚ï¼Œå½“slaveæ–­çº¿åï¼Œæ¢å¤æ•°æ®ä½¿ç”¨ 1.2.4 å·¥ä½œæµç¨‹æ€»ç»“ 1.3 å¿ƒè·³æœºåˆ¶è¿›å…¥å‘½ä»¤ä¼ æ’­é˜¶æ®µå€™ï¼Œmasterä¸slaveé—´éœ€è¦è¿›è¡Œä¿¡æ¯äº¤æ¢ï¼Œä½¿ç”¨å¿ƒè·³æœºåˆ¶è¿›è¡Œç»´æŠ¤ï¼Œå®ç°åŒæ–¹è¿æ¥ä¿æŒåœ¨çº¿ã€‚ masterå¿ƒè·³ï¼š æŒ‡ä»¤ï¼šPING å‘¨æœŸï¼šç”±repl-ping-slave-periodå†³å®šï¼Œé»˜è®¤10ç§’ ä½œç”¨ï¼šåˆ¤æ–­slaveæ˜¯å¦åœ¨çº¿ æŸ¥è¯¢ï¼šINFO replication è·å–slaveæœ€åä¸€æ¬¡è¿æ¥æ—¶é—´é—´éš”ï¼Œlagé¡¹ç»´æŒåœ¨0æˆ–1è§†ä¸ºæ­£å¸¸ slaveå¿ƒè·³ä»»åŠ¡ æŒ‡ä»¤ï¼šREPLCONF ACK {offset} å‘¨æœŸï¼š1ç§’ ä½œç”¨1ï¼šæ±‡æŠ¥slaveè‡ªå·±çš„å¤åˆ¶åç§»é‡ï¼Œè·å–æœ€æ–°çš„æ•°æ®å˜æ›´æŒ‡ä»¤ ä½œç”¨2ï¼šåˆ¤æ–­masteræ˜¯å¦åœ¨çº¿ æ³¨æ„: å½“slaveå¤šæ•°æ‰çº¿ï¼Œæˆ–å»¶è¿Ÿè¿‡é«˜æ—¶ï¼Œmasterä¸ºä¿éšœæ•°æ®ç¨³å®šæ€§ï¼Œå°†æ‹’ç»æ‰€æœ‰ä¿¡æ¯åŒæ­¥æ“ä½œ ç›¸å…³é…ç½®ï¼š min-slaves-to-write 2 min-slaves-max-lag 8slaveæ•°é‡å°‘äº2ä¸ªï¼Œæˆ–è€…æ‰€æœ‰slaveçš„å»¶è¿Ÿéƒ½å¤§äºç­‰äº10ç§’æ—¶ï¼Œå¼ºåˆ¶å…³é—­masterå†™åŠŸèƒ½ï¼Œåœæ­¢æ•°æ®åŒæ­¥ slaveæ•°é‡ç”±slaveå‘é€REPLCONF ACKå‘½ä»¤åšç¡®è®¤ slaveå»¶è¿Ÿç”±slaveå‘é€REPLCONF ACKå‘½ä»¤åšç¡®è®¤ 1.4 ä¸»ä»å¤åˆ¶å¸¸è§é—®é¢˜1.4.1 é¢‘ç¹çš„å…¨é‡å¤åˆ¶ï¼ˆ1ï¼‰ä¼´éšç€ç³»ç»Ÿçš„è¿è¡Œï¼Œmasterçš„æ•°æ®é‡ä¼šè¶Šæ¥è¶Šå¤§ï¼Œä¸€æ—¦masteré‡å¯ï¼Œrunidå°†å‘ç”Ÿå˜åŒ–ï¼Œä¼šå¯¼è‡´å…¨éƒ¨slaveçš„å…¨é‡å¤åˆ¶æ“ä½œ å†…éƒ¨ä¼˜åŒ–è°ƒæ•´æ–¹æ¡ˆï¼š masterå†…éƒ¨åˆ›å»ºmaster_replidå˜é‡ï¼Œä½¿ç”¨runidç›¸åŒçš„ç­–ç•¥ç”Ÿæˆï¼Œé•¿åº¦41ä½ï¼Œå¹¶å‘é€ç»™æ‰€æœ‰slave åœ¨masterå…³é—­æ—¶æ‰§è¡Œå‘½ä»¤shutdown saveï¼Œè¿›è¡ŒRDBæŒä¹…åŒ–,å°†runidä¸offsetä¿å­˜åˆ°RDBæ–‡ä»¶ä¸­ repl-id repl-offset é€šè¿‡redis-check-rdbå‘½ä»¤å¯ä»¥æŸ¥çœ‹è¯¥ä¿¡æ¯ masteré‡å¯ååŠ è½½RDBæ–‡ä»¶ï¼Œæ¢å¤æ•°æ®é‡å¯åï¼Œå°†RDBæ–‡ä»¶ä¸­ä¿å­˜çš„repl-idä¸repl-offsetåŠ è½½åˆ°å†…å­˜ä¸­ master_repl_id = repl master_repl_offset = repl-offset é€šè¿‡infoå‘½ä»¤å¯ä»¥æŸ¥çœ‹è¯¥ä¿¡æ¯ ä½œç”¨ï¼šæœ¬æœºä¿å­˜ä¸Šæ¬¡runidï¼Œé‡å¯åæ¢å¤è¯¥å€¼ï¼Œä½¿æ‰€æœ‰slaveè®¤ä¸ºè¿˜æ˜¯ä¹‹å‰çš„master 1.4.2 é¢‘ç¹çš„å…¨é‡å¤åˆ¶ï¼ˆ2ï¼‰é—®é¢˜ç°è±¡: ç½‘ç»œç¯å¢ƒä¸ä½³ï¼Œå‡ºç°ç½‘ç»œä¸­æ–­ï¼Œslaveä¸æä¾›æœåŠ¡ é—®é¢˜åŸå› : å¤åˆ¶ç¼“å†²åŒºè¿‡å°ï¼Œæ–­ç½‘åslaveçš„offsetè¶Šç•Œï¼Œè§¦å‘å…¨é‡å¤åˆ¶ æœ€ç»ˆç»“æœ: slaveåå¤è¿›è¡Œå…¨é‡å¤åˆ¶ è§£å†³æ–¹æ¡ˆ: ä¿®æ”¹å¤åˆ¶ç¼“å†²åŒºå¤§å° å»ºè®®è®¾ç½®å¦‚ä¸‹ï¼š æµ‹ç®—ä»masteråˆ°slaveçš„é‡è¿å¹³å‡æ—¶é•¿second è·å–masterå¹³å‡æ¯ç§’äº§ç”Ÿå†™å‘½ä»¤æ•°æ®æ€»é‡write_size_per_second æœ€ä¼˜å¤åˆ¶ç¼“å†²åŒºç©ºé—´ = 2 * second * write_size_per_second 1.4.3 é¢‘ç¹çš„ç½‘ç»œä¸­æ–­ï¼ˆ1ï¼‰é—®é¢˜ç°è±¡: masterçš„CPUå ç”¨è¿‡é«˜ æˆ– slaveé¢‘ç¹æ–­å¼€è¿æ¥ é—®é¢˜åŸå› ï¼š slaveæ¯1ç§’å‘é€REPLCONF ACKå‘½ä»¤åˆ°master å½“slaveæ¥åˆ°äº†æ…¢æŸ¥è¯¢æ—¶ï¼ˆkeys * ï¼Œhgetallç­‰ï¼‰ï¼Œä¼šå¤§é‡å ç”¨CPUæ€§èƒ½ masteræ¯1ç§’è°ƒç”¨å¤åˆ¶å®šæ—¶å‡½æ•°replicationCron()ï¼Œæ¯”å¯¹slaveå‘ç°é•¿æ—¶é—´æ²¡æœ‰è¿›è¡Œå“åº” æœ€ç»ˆç»“æœï¼š masterå„ç§èµ„æºï¼ˆè¾“å‡ºç¼“å†²åŒºã€å¸¦å®½ã€è¿æ¥ç­‰ï¼‰è¢«ä¸¥é‡å ç”¨ è§£å†³æ–¹æ¡ˆï¼š é€šè¿‡è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´repl-timeoutï¼Œç¡®è®¤æ˜¯å¦é‡Šæ”¾slaveã€‚è¯¥å‚æ•°å®šä¹‰äº†è¶…æ—¶æ—¶é—´çš„é˜ˆå€¼ï¼ˆé»˜è®¤60ç§’ï¼‰ï¼Œè¶…è¿‡è¯¥å€¼ï¼Œé‡Šæ”¾slave 1.4.4 é¢‘ç¹çš„ç½‘ç»œä¸­æ–­ï¼ˆ2ï¼‰é—®é¢˜ç°è±¡ï¼š slaveä¸masterè¿æ¥æ–­å¼€ é—®é¢˜åŸå› ï¼š masterå‘é€pingæŒ‡ä»¤é¢‘åº¦è¾ƒä½ masterè®¾å®šè¶…æ—¶æ—¶é—´è¾ƒçŸ­ pingæŒ‡ä»¤åœ¨ç½‘ç»œä¸­å­˜åœ¨ä¸¢åŒ… è§£å†³æ–¹æ¡ˆï¼š æé«˜pingæŒ‡ä»¤å‘é€çš„é¢‘åº¦ repl-ping-slave-period è¶…æ—¶æ—¶é—´repl-timeçš„æ—¶é—´è‡³å°‘æ˜¯pingæŒ‡ä»¤é¢‘åº¦çš„5åˆ°10å€ï¼Œå¦åˆ™slaveå¾ˆå®¹æ˜“åˆ¤å®šè¶…æ—¶ 1.4.5 æ•°æ®ä¸ä¸€è‡´é—®é¢˜ç°è±¡ï¼š å¤šä¸ªslaveè·å–ç›¸åŒæ•°æ®ä¸åŒæ­¥ é—®é¢˜åŸå› ï¼š ç½‘ç»œä¿¡æ¯ä¸åŒæ­¥ï¼Œæ•°æ®å‘é€æœ‰å»¶è¿Ÿ è§£å†³æ–¹æ¡ˆï¼š ä¼˜åŒ–ä¸»ä»é—´çš„ç½‘ç»œç¯å¢ƒï¼Œé€šå¸¸æ”¾ç½®åœ¨åŒä¸€ä¸ªæœºæˆ¿éƒ¨ç½²ï¼Œå¦‚ä½¿ç”¨é˜¿é‡Œäº‘ç­‰äº‘æœåŠ¡å™¨æ—¶è¦æ³¨æ„æ­¤ç°è±¡ ç›‘æ§ä¸»ä»èŠ‚ç‚¹å»¶è¿Ÿï¼ˆé€šè¿‡offsetï¼‰åˆ¤æ–­ï¼Œå¦‚æœslaveå»¶è¿Ÿè¿‡å¤§ï¼Œæš‚æ—¶å±è”½ç¨‹åºå¯¹è¯¥slaveçš„æ•°æ®è®¿é—® slave-serve-stale-data yes|no å¼€å¯åä»…å“åº”infoã€slaveofç­‰å°‘æ•°å‘½ä»¤ï¼ˆæ…ç”¨ï¼Œé™¤éå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚å¾ˆé«˜ï¼‰ 2 å“¨å…µæ¨¡å¼ä¸Šé¢æåˆ°å¦‚æœä¸»æœºå®•æœºï¼Œéœ€è¦ä¸´æ—¶æ¨é€‰å‡ºä¸€ä¸ªä»æœºä»£æ›¿ä¸»æœºå·¥ä½œã€‚ 2.1 ä½œç”¨å“¨å…µ(sentinel) æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œç”¨äºå¯¹ä¸»ä»ç»“æ„ä¸­çš„æ¯å°æœåŠ¡å™¨è¿›è¡Œç›‘æ§ï¼Œå½“å‡ºç°æ•…éšœæ—¶é€šè¿‡æŠ•ç¥¨æœºåˆ¶é€‰æ‹©æ–°çš„masterå¹¶å°†æ‰€æœ‰slaveè¿æ¥åˆ°æ–°çš„masterã€‚ ç›‘æ§ï¼š ä¸æ–­çš„æ£€æŸ¥masterå’Œslaveæ˜¯å¦æ­£å¸¸è¿è¡Œã€‚ masterå­˜æ´»æ£€æµ‹ã€masterä¸slaveè¿è¡Œæƒ…å†µæ£€æµ‹ é€šçŸ¥ï¼ˆæé†’ï¼‰ï¼š å½“è¢«ç›‘æ§çš„æœåŠ¡å™¨å‡ºç°é—®é¢˜æ—¶ï¼Œå‘å…¶ä»–ï¼ˆå“¨å…µé—´ï¼Œå®¢æˆ·ç«¯ï¼‰å‘é€é€šçŸ¥ã€‚ è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼š æ–­å¼€masterä¸slaveè¿æ¥ï¼Œé€‰å–ä¸€ä¸ªslaveä½œä¸ºmasterï¼Œå°†å…¶ä»–slaveè¿æ¥åˆ°æ–°çš„masterï¼Œå¹¶å‘ŠçŸ¥å®¢æˆ·ç«¯æ–°çš„æœåŠ¡å™¨åœ°å€ æ³¨æ„ï¼š å“¨å…µä¹Ÿæ˜¯ä¸€å°redisæœåŠ¡å™¨ï¼Œåªæ˜¯ä¸æä¾›æ•°æ®æœåŠ¡ é€šå¸¸å“¨å…µé…ç½®æ•°é‡ä¸ºå•æ•° 2.2 å¯ç”¨å“¨å…µå¯ç”¨å“¨å…µå‘½ä»¤ï¼š redis-sentinel sentinel-é…ç½®.conf é…ç½®æ–‡ä»¶ï¼š sentinel monitor mymaster 127.0.0.1 6379 2 # é…ç½®ç›‘æ§çš„ä¸»èŠ‚ç‚¹ # è¿™ä¸ªé…ç½®é¡¹æ ¼å¼ä¸ºsentinel monitor &lt;master-group-name&gt; &lt;ip&gt; &lt;port&gt; &lt;quorum&gt; # æ„ä¹‰ä¸ºç›‘è§†ä¸€ä¸ªåä¸ºmymasterçš„ä¸»èŠ‚ç‚¹ï¼ˆè¿™é‡Œçš„mymasterå¯ä»¥è‡ªå®šä¹‰ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ ‡è¯†è¿™ä¸ªé›†ç¾¤ï¼‰ # ä¸»èŠ‚ç‚¹ipåœ°å€æ˜¯127.0.0.1ï¼Œç«¯å£ä¸º6379 # æ³•å®šç¥¨æ•°ä¸º2ç¥¨ã€‚è¡¨ç¤ºè‡³å°‘éœ€è¦2ä¸ªå“¨å…µè®¤ä¸ºèŠ‚ç‚¹downäº†ï¼Œæ‰ç®—downäº†ã€‚ sentinel down-after-milliseconds mymaster 30000 # ç›‘æ§åˆ°æŒ‡å®šçš„é›†ç¾¤çš„ä¸»èŠ‚ç‚¹å¼‚å¸¸çŠ¶æ€æŒç»­å¤šä¹…æ–¹æ‰å°†æ ‡è®°ä¸ºâ€œæ•…éšœâ€ï¼› sentinel parallel-syncs mymaster 1 # æŒ‡åœ¨failoverè¿‡ç¨‹ä¸­ï¼Œèƒ½å¤Ÿè¢«sentinelå¹¶è¡Œé…ç½®çš„ä»èŠ‚ç‚¹çš„æ•°é‡ï¼›æ•°å€¼è¶Šå¤§ï¼Œè¦æ±‚ç½‘ç»œèµ„æºè¶Šé«˜ï¼Œè¦æ±‚è¶Šå°ï¼ŒåŒæ­¥æ—¶é—´çº¦é•¿ sentinel failover-timeout 180000 # sentinelå¿…é¡»åœ¨æ­¤æŒ‡å®šçš„æ—¶é•¿å†…å®Œæˆæ•…éšœè½¬ç§»æ“ä½œï¼Œå¦åˆ™ï¼Œå°†è§†ä¸ºæ•…éšœè½¬ç§»æ“ä½œå¤±è´¥2.3 å“¨å…µå·¥ä½œåŸç†å“¨å…µåœ¨è¿›è¡Œä¸»ä»åˆ‡æ¢è¿‡ç¨‹ä¸­ç»å†ä¸‰ä¸ªé˜¶æ®µ ç›‘æ§ é€šçŸ¥ æ•…éšœè½¬ç§» 2.3.1 ç›‘æ§é˜¶æ®µç”¨äºåŒæ­¥å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€ä¿¡æ¯ è·å–å„ä¸ªsentinelçš„çŠ¶æ€ï¼ˆæ˜¯å¦åœ¨çº¿ï¼‰ è·å–masterçš„çŠ¶æ€ masterå±æ€§ runid roleï¼šmaster å„ä¸ªslaveçš„è¯¦ç»†ä¿¡æ¯ è·å–æ‰€æœ‰slaveçš„çŠ¶æ€ï¼ˆæ ¹æ®masterä¸­çš„slaveä¿¡æ¯ï¼‰ slaveå±æ€§ runid roleï¼šslave master_hostã€master_port offset â€¦â€¦ 2.3.2 é€šçŸ¥é˜¶æ®µsentinelä¹‹é—´ä¹Ÿä¼šç»„å»ºè¿æ¥ç½‘å…±äº«masterå’Œslaveçš„çŠ¶æ€ã€‚ æ¯ä¸ªsentinelæ”¶é›†åˆ°äº†ä¿¡æ¯éƒ½ä¼šå…±äº«ç»™å…¶ä»–çš„sentinelã€‚ 2.3.3 æ•…éšœè½¬ç§»é˜¶æ®µå¦‚æœæŸä¸€sentinelæŸæ—¶åˆ»è”ç³»ä¸ä¸Šä¸»æœºå¹¶ä¸”è¶…è¿‡failover-timeoutæ—¶é—´ï¼Œå°±å¯¹å…¶ä»–sentinelå‘èµ·é€šçŸ¥SENTINEL is-master-down-by-addr â€¦â€¦ï¼Œæ­¤æ—¶è¯¥sentinelå¯¹ä¸»æœºçš„åˆ¤å®šä¸ºSRI_S_DOWNï¼Œå³ä¸»è§‚ä¸‹çº¿ã€‚ å…¶ä»–sentinelæ”¶åˆ°é€šçŸ¥åä¹Ÿå¯¹ä¸»æœºåšå‡ºè¯„åˆ¤ï¼Œå¦‚æœæœ‰è¶…åŠæ•°(æ³•å®šç¥¨æ•°)çš„sentinelè®¤ä¸ºä¸»æœºå®•æœºäº†ï¼Œå°±åˆ¤å®šè¯¥ä¸»æœºä¸ºSRI_O_DOWNï¼Œå³å®¢è§‚ä¸‹çº¿ã€‚ ç„¶åsentinelå†…éƒ¨å¼€å§‹å‘é€ç«é€‰æŒ‡ä»¤äº‰é€‰ä½œä¸ºå¤„ç†è¯¥æ•…éšœçš„å“¨å…µã€‚æ‰€æœ‰å“¨å…µæ ¹æ®æ”¶åˆ°ç«é€‰æŒ‡ä»¤çš„å…ˆåå’Œä¸€äº›è¯„åˆ¤æ ‡å‡†æŠ•ç¥¨ï¼Œè·å¾—æŠ•ç¥¨æ•°æœ€å¤šçš„å“¨å…µå¤„ç†è¯¥æ•…éšœã€‚ å“¨å…µçš„ä»»åŠ¡ï¼š åœ¨æœåŠ¡å™¨åˆ—è¡¨ä¸­æŒ‘é€‰å¤‡é€‰masterï¼š ç­›é€‰åœ¨çº¿çš„ å‰”é™¤å“åº”æ…¢çš„ å‰”é™¤ä¸åŸmasteræ–­å¼€æ—¶é—´ä¹…çš„ æŒ‰ç…§ä¼˜å…ˆåŸåˆ™ ä¼˜å…ˆçº§ offset runid æ ¹æ®ä»¥ä¸Šæ–¹æ³•æŒ‘é€‰å‡ºä¸€ä¸ªå¤‡é€‰masteråï¼Œå¼€å§‹æ›¿æ¢masterï¼š å‘é€æŒ‡ä»¤ï¼ˆsentinelï¼‰ å‘æ–°çš„masterå‘é€slaveof no one å‘å…¶ä»–slaveå‘é€slaveof æ–°masterIPç«¯å£ 3 é›†ç¾¤é›†ç¾¤å°±æ˜¯ä½¿ç”¨ç½‘ç»œå°†è‹¥å¹²å°è®¡ç®—æœºè”é€šèµ·æ¥ï¼Œå¹¶æä¾›ç»Ÿä¸€çš„ç®¡ç†æ–¹å¼ï¼Œä½¿å…¶å¯¹å¤–å‘ˆç°å•æœºçš„æœåŠ¡æ•ˆæœ é›†ç¾¤çš„ä½œç”¨ åˆ†æ•£å•å°æœåŠ¡å™¨çš„è®¿é—®å‹åŠ›ï¼Œå®ç°è´Ÿè½½å‡è¡¡ åˆ†æ•£å•å°æœåŠ¡å™¨çš„å­˜å‚¨å‹åŠ›ï¼Œå®ç°å¯æ‰©å±•æ€§ é™ä½å•å°æœåŠ¡å™¨å®•æœºå¸¦æ¥çš„ä¸šåŠ¡ç¾éš¾ 3.1 è®¾è®¡ é€šè¿‡ç®—æ³•è®¾è®¡ï¼Œè®¡ç®—å‡ºkeyåº”è¯¥ä¿å­˜çš„ä½ç½® å°†æ‰€æœ‰çš„å­˜å‚¨ç©ºé—´è®¡åˆ’åˆ‡å‰²æˆ16384ä»½æ§½ï¼Œæ¯å°ä¸»æœºä¿å­˜ä¸€éƒ¨åˆ†æ¯ä»½ä»£è¡¨çš„æ˜¯ä¸€ä¸ªå­˜å‚¨ç©ºé—´ï¼Œä¸æ˜¯ä¸€ä¸ªkeyçš„ä¿å­˜ç©ºé—´ å°†keyæŒ‰ç…§è®¡ç®—å‡ºçš„ç»“æœæ”¾åˆ°å¯¹åº”çš„å­˜å‚¨ç©ºé—´ é›†ç¾¤å†…éƒ¨ä¹Ÿæœ‰é€šä¿¡ï¼Œæ¯å°æœºå™¨éƒ½çŸ¥é“ä¸€ä¸ªæŒ‡å®šçš„æ§½æ”¾åœ¨å“ªä¸ªæœºå™¨ä¸Šï¼Œå¦‚æœæ§½æœªå‘½ä¸­ï¼Œåˆ™ä¼šé€šçŸ¥ç”¨æˆ·æ­£ç¡®ä½ç½®ã€‚ 3.2 clusteré›†ç¾¤æ­å»ºå‚è€ƒè¯¦è§£Redis Clusteré›†ç¾¤ - è¯·å«æˆ‘å¤´å¤´å“¥ - åšå®¢å›­","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"https://www.codetool.top/tags/Redis/"}]},{"title":"Redisé«˜çº§æ•°æ®ç±»å‹ä»‹ç»","slug":"Redisé«˜çº§æ•°æ®ç±»å‹ä»‹ç»","date":"2020-03-03T10:26:52.000Z","updated":"2020-03-03T10:27:35.861Z","comments":true,"path":"article/Redisé«˜çº§æ•°æ®ç±»å‹ä»‹ç»/","link":"","permalink":"https://www.codetool.top/article/Redis%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%BB%8B%E7%BB%8D/","excerpt":"","text":"1 Bitmapsä¹‹å‰çš„åšå®¢æœ‰æåˆ°è¿‡æµ·é‡æ•°æ®ç®—æ³•-BitMapä»‹ç»å’Œå®ç° å®é™…ä¸ŠRedisä¹Ÿæœ‰è¿™æ ·çš„æ•°æ®ç»“æ„â€”â€”å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„å­—èŠ‚ï¼ˆå®é™…ä¸Šä¹Ÿå°±æ˜¯Stringç±»å‹ï¼‰ï¼Œç›¸å…³æŒ‡ä»¤ï¼š setbit key index 1|0ï¼šå°†å¯¹åº”çš„ä½è®¾ç½®ä¸º1/0ã€‚ getbit key indexï¼šè·å–å¯¹åº”çš„ä½çš„å€¼ã€‚ bitop op destKey key1 [key2...]ï¼šbitmapä¹‹é—´çš„ä½è¿ç®—ï¼Œopå¯ä»¥æ˜¯ï¼š andï¼šä¸ orï¼šæˆ– notï¼šé xorï¼šå¼‚æˆ– bitcount key [start end]ï¼šç»Ÿè®¡bitmapä¸­1çš„æ•°é‡ 2 HyperLogLogä½œç”¨ï¼šç»Ÿè®¡ä¸é‡å¤æ•°æ®çš„æ•°é‡ã€‚ è™½ç„¶Bitmapä¹Ÿå¯ä»¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œä½†å®ƒçš„ç©ºé—´å¤æ‚åº¦æé«˜ï¼Œè€ŒHyperLogLogä¸­çš„LogLogä»£è¡¨çš„æ˜¯å®ƒçš„ç©ºé—´å¤æ‚åº¦ï¼Œå³è¿™ç§ç®—æ³•çš„ç©ºé—´å¤æ‚åº¦ä»…æœ‰O(log2(log2(Nmax)))ã€‚ å®ƒçš„åŸç†åŸºäºåŸºæ•°ä¼°è®¡ç®—æ³•(Cardinality Estimation Algorithm)ï¼šLogLogCountingï¼ˆè¿™ç§ç®—æ³•ä»¥åæœ‰æœºä¼šå†ç ”ç©¶ï¼‰ ç›¸å…³æ“ä½œï¼š pfadd key element [element ...]ï¼šæ·»åŠ æ•°æ® pfcount key [key ...]ï¼šç»Ÿè®¡æ•°æ®ï¼Œè¿”å›ä¸é‡å¤æ•°æ®çš„ä¸ªæ•° pfmerge destkey sourcekey [sourcekey ...]ï¼šåˆå¹¶æ•°æ® è¿™ç§ç®—æ³•æ˜¯ä¸€ç§æ¦‚ç‡ç®—æ³•ï¼Œå®ƒå­˜åœ¨ä¸€å®šçš„è¯¯å·®ã€‚å®ƒåªéœ€è¦12Kå†…å­˜ï¼Œåœ¨æ ‡å‡†è¯¯å·®0.81%çš„å‰æä¸‹ï¼Œèƒ½å¤Ÿç»Ÿè®¡2â€‹64ä¸ªæ•°æ®ã€‚ pfaddå‘½ä»¤å¹¶ä¸æ˜¯ä¸€æ¬¡æ€§åˆ†é…12kå†…å­˜ä½¿ç”¨ï¼Œä¼šéšç€åŸºæ•°çš„å¢åŠ å†…å­˜é€æ¸å¢å¤§ã€‚ ä½†æ˜¯åªè¦ä½¿ç”¨äº†pfmergeå‘½ä»¤åˆå¹¶äº†ç©ºé—´ï¼Œå¾—åˆ°çš„åˆå¹¶åçš„ç©ºé—´å°±æ˜¯12kã€‚ 3 GEOåŠŸèƒ½ï¼šè®¡ç®—ä¸¤ä¸ªç»çº¬åº¦åæ ‡ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚ ç›¸å…³æ“ä½œï¼š geoadd key longitude latitude member [longitude latitude member]ï¼šæ·»åŠ åæ ‡ç‚¹ geopos key member [member ...]ï¼šè·å–åæ ‡ç‚¹ geodist key member1 member2 [unit]ï¼šè®¡ç®—åæ ‡ç‚¹ï¼Œé»˜è®¤å•ä½æ˜¯ç±³ georadius key longitude latitude radius m|km|ft|mi [withcoord] [withdist] [withhash] [count count]ï¼šæ ¹æ®åæ ‡æ±‚èŒƒå›´å†…çš„æ•°æ® georadiusbymember key member radius m|km|ft|mi [withcoord] [withdist] [withhash] [count count]ï¼šæ ¹æ®ç‚¹æ±‚èŒƒå›´å†…çš„æ•°æ® geohash key member [member ...]ï¼šè·å–æŒ‡å®šç‚¹å¯¹åº”çš„åæ ‡hashå€¼ ç¤ºä¾‹ï¼š 127.0.0.1:6379&gt; geoadd map 1 1 a (integer) 1 127.0.0.1:6379&gt; geoadd map 2 2 b (integer) 1 127.0.0.1:6379&gt; geopos map a 1) 1) &quot;0.99999994039535522&quot; 2) &quot;0.99999945914297683&quot; 127.0.0.1:6379&gt; geodist map a b &quot;157270.0561&quot; 127.0.0.1:6379&gt; geodist map a b km &quot;157.2701&quot; 127.0.0.1:6379&gt; georadiusbymember map a 180 km withdist 1) 1) &quot;a&quot; 2) &quot;0.0000&quot; 2) 1) &quot;b&quot; 2) &quot;157.2701&quot; 127.0.0.1:6379&gt; georadiusbymember map a 120 km withdist 1) 1) &quot;a&quot; 2) &quot;0.0000&quot;","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"https://www.codetool.top/tags/Redis/"}]},{"title":"Redisäº‹åŠ¡ã€åˆ†å¸ƒå¼é”ã€åˆ é™¤ç­–ç•¥ä»‹ç»","slug":"Redisäº‹åŠ¡ã€åˆ†å¸ƒå¼é”ã€åˆ é™¤ç­–ç•¥ä»‹ç»","date":"2020-03-03T09:25:22.000Z","updated":"2020-03-03T09:25:45.003Z","comments":true,"path":"article/Redisäº‹åŠ¡ã€åˆ†å¸ƒå¼é”ã€åˆ é™¤ç­–ç•¥ä»‹ç»/","link":"","permalink":"https://www.codetool.top/article/Redis%E4%BA%8B%E5%8A%A1%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E3%80%81%E5%88%A0%E9%99%A4%E7%AD%96%E7%95%A5%E4%BB%8B%E7%BB%8D/","excerpt":"","text":"1 Redisäº‹åŠ¡1.1 æŒ‡ä»¤multiï¼šå¼€å¯äº‹åŠ¡exec: ç»“æŸå¹¶æ‰§è¡Œäº‹åŠ¡discardï¼šç»ˆæ­¢å¹¶æ”¾å¼ƒäº‹åŠ¡ 1.2 æ³¨æ„ å¦‚æœå®šä¹‰çš„äº‹åŠ¡ä¸­æ‰€åŒ…å«çš„å‘½ä»¤å­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œæ•´ä½“äº‹åŠ¡ä¸­æ‰€æœ‰å‘½ä»¤å‡ä¸ä¼šæ‰§è¡Œã€‚åŒ…æ‹¬é‚£äº›è¯­æ³•æ­£ç¡®çš„å‘½ä»¤ã€‚ å¦‚æœä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æŸæŒ‡ä»¤å‡ºç°é”™è¯¯ï¼Œä¸å½±å“å…¶ä»–èƒ½æ‰§è¡Œçš„æŒ‡ä»¤ã€‚ç¨‹åºå‘˜å¯ä»¥æ ¹æ®éœ€è¦æ‰‹åŠ¨å›æ»šï¼ˆæ²¡æœ‰å›æ»šæŒ‡ä»¤ï¼Œåªèƒ½ç”¨é€†æ“ä½œï¼‰ã€‚ 1.3 é”Redisä¸­å¯ä»¥ä½¿ç”¨é”æ¥æ“æ§åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œã€‚ å¯¹ key æ·»åŠ ç›‘è§†é”ï¼Œåœ¨æ‰§è¡Œexecå‰å¦‚æœkeyå‘ç”Ÿäº†å˜åŒ–ï¼Œç»ˆæ­¢äº‹åŠ¡æ‰§è¡Œï¼šwatch key1 [key2â€¦â€¦] å–æ¶ˆå¯¹æ‰€æœ‰ key çš„ç›‘è§†ï¼šunwatch 1.4 åˆ†å¸ƒå¼é”ä½¿ç”¨setnxè®¾ç½®ä¸€ä¸ªå…¬å…±é”ï¼šsetnx lock-key value åˆ©ç”¨setnxå‘½ä»¤çš„è¿”å›å€¼ç‰¹å¾ï¼Œæœ‰å€¼åˆ™è¿”å›è®¾ç½®å¤±è´¥ï¼Œæ— å€¼åˆ™è¿”å›è®¾ç½®æˆåŠŸ å¯¹äºè¿”å›è®¾ç½®æˆåŠŸçš„ï¼Œæ‹¥æœ‰æ§åˆ¶æƒï¼Œè¿›è¡Œä¸‹ä¸€æ­¥çš„å…·ä½“ä¸šåŠ¡æ“ä½œ å¯¹äºè¿”å›è®¾ç½®å¤±è´¥çš„ï¼Œä¸å…·æœ‰æ§åˆ¶æƒï¼Œæ’é˜Ÿæˆ–ç­‰å¾… æ“ä½œå®Œæ¯•é€šè¿‡delæ“ä½œé‡Šæ”¾é” æ³¨æ„ï¼š å› ä¸ºè§£é”æ“ä½œä¾èµ–äºç”¨æˆ·æ§åˆ¶ï¼Œå¿…å®šä¼šå‡ºç°åŠ é”åæœªè§£é”çš„é£é™©ã€‚ è§£å†³æ–¹æ¡ˆï¼š ä½¿ç”¨expire/pexpireè®¾ç½®é”çš„è¿‡æœŸæ—¶é—´ï¼Œåˆ°ç‚¹è‡ªåŠ¨é‡Šæ”¾ã€‚ ç”±äºæ“ä½œé€šå¸¸éƒ½æ˜¯å¾®ç§’æˆ–æ¯«ç§’çº§ï¼Œå› æ­¤è¯¥é”å®šæ—¶é—´ä¸å®œè®¾ç½®è¿‡å¤§ã€‚å…·ä½“æ—¶é—´éœ€è¦ä¸šåŠ¡æµ‹è¯•åç¡®è®¤ã€‚ ä¾‹å¦‚ï¼šæŒæœ‰é”çš„æ“ä½œæœ€é•¿æ‰§è¡Œæ—¶é—´127msï¼Œæœ€çŸ­æ‰§è¡Œæ—¶é—´7msã€‚ æµ‹è¯•ç™¾ä¸‡æ¬¡æœ€é•¿æ‰§è¡Œæ—¶é—´å¯¹åº”å‘½ä»¤çš„æœ€å¤§è€—æ—¶ï¼Œæµ‹è¯•ç™¾ä¸‡æ¬¡ç½‘ç»œå»¶è¿Ÿå¹³å‡è€—æ—¶ é”æ—¶é—´è®¾å®šæ¨èï¼šæœ€å¤§è€—æ—¶120%+å¹³å‡ç½‘ç»œå»¶è¿Ÿ110% å¦‚æœä¸šåŠ¡æœ€å¤§è€—æ—¶&lt;&lt;ç½‘ç»œå¹³å‡å»¶è¿Ÿï¼Œé€šå¸¸ä¸º2ä¸ªæ•°é‡çº§ï¼Œå–å…¶ä¸­å•ä¸ªè€—æ—¶è¾ƒé•¿å³å¯ 2 åˆ é™¤ç­–ç•¥å¯¹äºé‚£äº›ttl=-2çš„å·²ç»è¿‡æœŸçš„æ•°æ®ï¼ŒredisçœŸçš„å°†å®ƒä»¬åˆ é™¤äº†å—ï¼Ÿ å®šæ—¶åˆ é™¤ æƒ°æ€§åˆ é™¤ å®šæœŸåˆ é™¤ rediså†…å­˜ä¸­æœ‰ä¸€å—åŒºåŸŸç”¨äºå­˜å‚¨æ—¶æ•ˆæ€§æ•°æ®çš„è¿‡æœŸæ—¶é—´ï¼Œå®ƒå°†æ•°æ®çš„å­˜å‚¨åœ°å€å’Œè¿‡æœŸæ—¶é—´å…³è”äº†èµ·æ¥ã€‚ 2.1 å®šæ—¶åˆ é™¤åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå½“keyè®¾ç½®æœ‰è¿‡æœŸæ—¶é—´ï¼Œä¸”è¿‡æœŸæ—¶é—´åˆ°è¾¾æ—¶ï¼Œç”±å®šæ—¶å™¨ä»»åŠ¡ç«‹å³æ‰§è¡Œå¯¹é”®çš„åˆ é™¤æ“ä½œã€‚ ä¼˜ç‚¹ï¼šèŠ‚çº¦å†…å­˜ï¼Œåˆ°æ—¶å°±åˆ é™¤ï¼Œå¿«é€Ÿé‡Šæ”¾æ‰ä¸å¿…è¦çš„å†…å­˜å ç”¨ ç¼ºç‚¹ï¼šCPUå‹åŠ›å¾ˆå¤§ï¼Œæ— è®ºCPUæ­¤æ—¶è´Ÿè½½é‡å¤šé«˜ï¼Œå‡å ç”¨CPUï¼Œä¼šå½±å“redisæœåŠ¡å™¨å“åº”æ—¶é—´å’ŒæŒ‡ä»¤ååé‡ æ€»ç»“ï¼šç”¨å¤„ç†å™¨æ€§èƒ½æ¢å–å­˜å‚¨ç©ºé—´ ï¼ˆæ‹¿æ—¶é—´æ¢ç©ºé—´ï¼‰ 2.2 æƒ°æ€§åˆ é™¤æ•°æ®åˆ°è¾¾è¿‡æœŸæ—¶é—´ï¼Œä¸åšå¤„ç†ã€‚ç­‰ä¸‹æ¬¡è®¿é—®è¯¥æ•°æ®æ—¶å¦‚æœæœªè¿‡æœŸï¼Œè¿”å›æ•°æ®ï¼Œå¦‚æœå‘ç°å·²è¿‡æœŸï¼Œåˆ é™¤ï¼Œè¿”å›ä¸å­˜åœ¨ã€‚ ä¼˜ç‚¹ï¼šèŠ‚çº¦CPUæ€§èƒ½ï¼Œå‘ç°å¿…é¡»åˆ é™¤çš„æ—¶å€™æ‰åˆ é™¤ ç¼ºç‚¹ï¼šå†…å­˜å‹åŠ›å¾ˆå¤§ï¼Œå‡ºç°é•¿æœŸå ç”¨å†…å­˜çš„æ•°æ® æ€»ç»“ï¼šç”¨å­˜å‚¨ç©ºé—´æ¢å–å¤„ç†å™¨æ€§èƒ½ï¼ˆæ‹¿æ—¶é—´æ¢ç©ºé—´ï¼‰ 2.3 å®šæœŸåˆ é™¤Rediså¯åŠ¨æœåŠ¡å™¨åˆå§‹åŒ–æ—¶ï¼Œè¯»å–é…ç½®server.hzçš„å€¼ï¼Œé»˜è®¤ä¸º10 æ¯ç§’é’Ÿæ‰§è¡Œserver.hzæ¬¡serverCron()-&gt;databasesCron()-&gt;activeExpireCycle()ã€‚ activeExpireCycle()å¯¹æ¯ä¸ªexpires[*]é€ä¸€è¿›è¡Œæ£€æµ‹ï¼Œæ¯æ¬¡æ‰§è¡Œ250ms/server.hz å¯¹æŸä¸ªexpires[*]æ£€æµ‹æ—¶ï¼ŒéšæœºæŒ‘é€‰Wä¸ªkeyæ£€æµ‹ å¦‚æœkeyè¶…æ—¶ï¼Œåˆ é™¤key å¦‚æœä¸€è½®ä¸­åˆ é™¤çš„keyçš„æ•°é‡&gt;W*25%ï¼Œå¾ªç¯è¯¥è¿‡ç¨‹ å¦‚æœä¸€è½®ä¸­åˆ é™¤çš„keyçš„æ•°é‡â‰¤W25%ï¼Œæ£€æŸ¥ä¸‹ä¸€ä¸ªexpires[]ï¼Œ0-15å¾ªç¯ æ³¨æ„ï¼š Wå–å€¼=ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOPå±æ€§å€¼ å‚æ•°current_dbç”¨äºè®°å½•activeExpireCycle():è¿›å…¥å“ªä¸ªexpires[*] æ‰§è¡Œ å¦‚æœactiveExpireCycle()æ‰§è¡Œæ—¶é—´åˆ°æœŸï¼Œä¸‹æ¬¡ä»current_dbç»§ç»­å‘ä¸‹æ‰§è¡Œ ç‰¹ç‚¹ï¼š å‘¨æœŸæ€§è½®è¯¢redisåº“ä¸­çš„æ—¶æ•ˆæ€§æ•°æ®ï¼Œé‡‡ç”¨éšæœºæŠ½å–çš„ç­–ç•¥ï¼Œåˆ©ç”¨è¿‡æœŸæ•°æ®å æ¯”çš„æ–¹å¼æ§åˆ¶åˆ é™¤é¢‘åº¦ ç‰¹ç‚¹1ï¼šCPUæ€§èƒ½å ç”¨è®¾ç½®æœ‰å³°å€¼ï¼Œæ£€æµ‹é¢‘åº¦å¯è‡ªå®šä¹‰è®¾ç½® ç‰¹ç‚¹2ï¼šå†…å­˜å‹åŠ›ä¸æ˜¯å¾ˆå¤§ï¼Œé•¿æœŸå ç”¨å†…å­˜çš„å†·æ•°æ®ä¼šè¢«æŒç»­æ¸…ç† æ€»ç»“ï¼šå‘¨æœŸæ€§æŠ½æŸ¥å­˜å‚¨ç©ºé—´ï¼ˆéšæœºæŠ½æŸ¥ï¼Œé‡ç‚¹æŠ½æŸ¥ï¼‰ 3 é€å‡ºç®—æ³•Redisä½¿ç”¨å†…å­˜å­˜å‚¨æ•°æ®ï¼Œåœ¨æ‰§è¡Œæ¯ä¸€ä¸ªå‘½ä»¤å‰ï¼Œä¼šè°ƒç”¨freeMemoryIfNeeded()æ£€æµ‹å†…å­˜æ˜¯å¦å……è¶³ã€‚å¦‚æœå†…å­˜ä¸æ»¡è¶³æ–°åŠ å…¥æ•°æ®çš„æœ€ä½å­˜å‚¨è¦æ±‚ï¼Œredisè¦ä¸´æ—¶åˆ é™¤ä¸€äº›æ•°æ®ä¸ºå½“å‰æŒ‡ä»¤æ¸…ç†å­˜å‚¨ç©ºé—´ã€‚æ¸…ç†æ•°æ®çš„ç­–ç•¥ç§°ä¸ºé€å‡ºç®—æ³•ã€‚ æ³¨æ„ï¼šé€å‡ºæ•°æ®çš„è¿‡ç¨‹ä¸æ˜¯100%èƒ½å¤Ÿæ¸…ç†å‡ºè¶³å¤Ÿçš„å¯ä½¿ç”¨çš„å†…å­˜ç©ºé—´ï¼Œå¦‚æœä¸æˆåŠŸåˆ™åå¤æ‰§è¡Œã€‚å½“å¯¹æ‰€æœ‰æ•°æ®å°è¯•å®Œæ¯•åï¼Œå¦‚æœä¸èƒ½è¾¾åˆ°å†…å­˜æ¸…ç†çš„è¦æ±‚ï¼Œå°†å‡ºç°é”™è¯¯ä¿¡æ¯ã€‚ (error) OOM command not allowed when used memory &gt;&#39;maxmemory&#39;3.1 ç›¸å…³é…ç½® maxmemoryï¼šå³redisæœ€å¤šèƒ½ä½¿ç”¨çš„ç‰©ç†å†…å­˜çš„æ¯”ä¾‹ï¼Œé»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºä¸é™åˆ¶ã€‚ç”Ÿäº§ç¯å¢ƒä¸­æ ¹æ®éœ€æ±‚è®¾å®šï¼Œé€šå¸¸è®¾ç½®åœ¨50%ä»¥ä¸Šã€‚ maxmemory-samplesï¼šæ¯æ¬¡é€‰å–å¾…åˆ é™¤æ•°æ®çš„ä¸ªæ•°ã€‚é€‰å–æ•°æ®æ—¶å¹¶ä¸ä¼šå…¨åº“æ‰«æï¼Œå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½æ¶ˆè€—ï¼Œé™ä½è¯»å†™æ€§èƒ½ã€‚å› æ­¤é‡‡ç”¨éšæœºè·å–æ•°æ®çš„æ–¹å¼ä½œä¸ºå¾…æ£€æµ‹åˆ é™¤æ•°æ® maxmemory-policyï¼šåˆ é™¤ç­–ç•¥ã€‚ å¯¹äºä¼šè¿‡æœŸçš„æ•°æ®ï¼š volatile-lruï¼šæŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±° volatile-lfuï¼šæŒ‘é€‰æœ€è¿‘ä½¿ç”¨æ¬¡æ•°æœ€å°‘çš„æ•°æ®æ·˜æ±° volatile-ttlï¼šæŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±° volatile-randomï¼šä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°æ£€æµ‹å…¨åº“æ•°æ®ï¼š allkeys-lruï¼šæŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±° allkeys-lfuï¼šæŒ‘é€‰æœ€è¿‘ä½¿ç”¨æ¬¡æ•°æœ€å°‘çš„æ•°æ®æ·˜æ±° allkeys-randomï¼šä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°æ”¾å¼ƒæ•°æ®é©±é€ï¼š no-envictionï¼ˆé©±é€ï¼‰ï¼šç¦æ­¢é©±é€æ•°æ®ï¼ˆredis5.0ä¸­é»˜è®¤ç­–ç•¥ï¼‰ï¼Œä¼šå¼•å‘é”™è¯¯OOMï¼ˆOut Of Memoryï¼‰ é€šè¿‡æŒ‡ä»¤info Statså¯ä»¥çœ‹åˆ°ç¼“å­˜çš„å‘½ä¸­æ¬¡æ•°å’Œä¸¢å¤±æ¬¡æ•°ã€‚ 4 Redisé…ç½®æ‹“å±• bindï¼šç»‘å®šä¸»æœºåœ°å€ databasesï¼šè®¾ç½®æ•°æ®åº“çš„æ•°é‡ï¼Œé»˜è®¤16 4.1 æ—¥å¿—é…ç½® loglevel debug|verbose|notice|warningï¼šè®¾ç½®æœåŠ¡å™¨ä»¥æŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«ï¼Œé»˜è®¤verbose logfile ç«¯å£å·.logï¼šæ—¥å¿—è®°å½•æ–‡ä»¶å 4.2 å®¢æˆ·ç«¯é…ç½® maxclients 0ï¼šè®¾ç½®åŒä¸€æ—¶é—´æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°ï¼Œé»˜è®¤æ— é™åˆ¶ã€‚å½“å®¢æˆ·ç«¯è¿æ¥è¾¾åˆ°ä¸Šé™ï¼ŒRedisä¼šå…³é—­æ–°çš„è¿æ¥ã€‚ timeout 300ï¼šå®¢æˆ·ç«¯é—²ç½®ç­‰å¾…æœ€å¤§æ—¶é•¿ï¼Œè¾¾åˆ°æœ€å¤§å€¼åå…³é—­è¿æ¥ã€‚å¦‚éœ€å…³é—­æ­¤åŠŸèƒ½ï¼Œè®¾ç½®ä¸º0ã€‚ 4.3 å¤šæœåŠ¡å™¨å¿«æ·é…ç½®include *.confï¼šå¯¼å…¥å¹¶åŠ è½½æŒ‡å®šé…ç½®æ–‡ä»¶ä¿¡æ¯ï¼Œç”¨äºå¿«é€Ÿåˆ›å»ºrediså…¬å…±é…ç½®è¾ƒå¤šçš„rediså®ä¾‹é…ç½®æ–‡ä»¶ï¼Œä¾¿äºç»´æŠ¤ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"https://www.codetool.top/tags/Redis/"}]},{"title":"leetcode46-å…¨æ’åˆ—","slug":"leetcode46-å…¨æ’åˆ—","date":"2020-03-02T18:54:23.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode46-å…¨æ’åˆ—/","link":"","permalink":"https://www.codetool.top/article/leetcode46-%E5%85%A8%E6%8E%92%E5%88%97/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ²¡æœ‰é‡å¤æ•°å­—çš„åºåˆ—ï¼Œè¿”å›å…¶æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ—ã€‚ ç¤ºä¾‹: è¾“å…¥: [1,2,3]è¾“å‡º:[&nbsp;&nbsp;[1,2,3],&nbsp;&nbsp;[1,3,2],&nbsp;&nbsp;[2,1,3],&nbsp;&nbsp;[2,3,1],&nbsp;&nbsp;[3,1,2],&nbsp;&nbsp;[3,2,1]] 2 è§£æ³•2.1 æ€æƒ³åšè¿™é“é¢˜çš„æ—¶å€™æˆ‘æ‰å‘ç°æˆ‘åšè¿™ç±»å›æº¯ç®—æ³•çš„é¢˜è¿˜æ˜¯è›®å°‘çš„ï¼Œå¯¹é›†åˆçš„æµ…å¤åˆ¶apiä¸æ˜¯å¾ˆç†Ÿæ‚‰ã€‚ä¸»è¦æ˜¯æµ…å¤åˆ¶çœŸçš„è›®éº»çƒ¦ -ã€‚-|| æ€æƒ³å°±æ˜¯å›æº¯å•¦ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªæ•°ç»„è®°å½•ä½¿ç”¨è¿‡äº†çš„å…ƒç´ ã€‚ 2.2 ä»£ç class Solution { List&lt;List&lt;Integer>> ans = new ArrayList&lt;>(); int[] globalNums; public List&lt;List&lt;Integer>> permute(int[] nums) { int[] used = new int[nums.length]; globalNums = nums; List&lt;Integer> list = new ArrayList&lt;>(); trackback(list,used,0); return ans; } public void trackback(List&lt;Integer> list,int[] used,int usedCount){ if(usedCount==globalNums.length){ ans.add(list); } for(int i = 0;i&lt;globalNums.length;i++){ if(used[i]==0){ List&lt;Integer> copy = new ArrayList&lt;>(list); copy.add(globalNums[i]); int[] usedCopy = Arrays.copyOf(used,used.length); usedCopy[i] = 1; trackback(copy,usedCopy,usedCount+1); } } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"RedisæŒä¹…åŒ–æ–¹å¼RDBå’ŒAOFä»‹ç»","slug":"RedisæŒä¹…åŒ–æ–¹å¼RDBå’ŒAOFä»‹ç»","date":"2020-03-02T14:58:43.000Z","updated":"2020-03-02T14:59:40.726Z","comments":true,"path":"article/RedisæŒä¹…åŒ–æ–¹å¼RDBå’ŒAOFä»‹ç»/","link":"","permalink":"https://www.codetool.top/article/Redis%E6%8C%81%E4%B9%85%E5%8C%96%E6%96%B9%E5%BC%8FRDB%E5%92%8CAOF%E4%BB%8B%E7%BB%8D/","excerpt":"","text":"1 æŒä¹…åŒ–ç®€ä»‹å°†å†…å­˜ä¸­çš„æ•°æ®éš”æ®µæ—¶é—´åœ¨ç¡¬ç›˜ä¸­åšå¤‡ä»½ï¼Œé˜²æ­¢æ•°æ®çªç„¶ä¸¢å¤± å¿«ç…§æ–¹æ³• RDB æ—¥å¿—æ–¹æ³• AOF 2 RDB2.1 å¯åŠ¨æ–¹å¼2.1.1 æŒ‡ä»¤ï¼šsave è°ï¼šredisæ“ä½œè€…ï¼ˆç”¨æˆ·ï¼‰ ä»€ä¹ˆæ—¶é—´ï¼šå³æ—¶ï¼ˆéšæ—¶è¿›è¡Œï¼‰ å¹²ä»€ä¹ˆäº‹æƒ…ï¼šä¿å­˜æ•°æ® æ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡ä¿å­˜ä¸€æ¬¡æ•°æ®ï¼Œäº§ç”Ÿåœ¨æ—¥å¿—æ–‡ä»¶å¤¹ä¸‹çš„rdbæ–‡ä»¶(äºŒè¿›åˆ¶) saveæŒ‡ä»¤ä¼šé˜»å¡å½“å‰redisæœåŠ¡å™¨ï¼Œçº¿ä¸Šç¯å¢ƒä¸æ¨èä½¿ç”¨ã€‚ 2.1.2 æŒ‡ä»¤ï¼šbgsave è°ï¼šredisæ“ä½œè€…ï¼ˆç”¨æˆ·ï¼‰å‘èµ·æŒ‡ä»¤ï¼›redisæœåŠ¡å™¨æ§åˆ¶æŒ‡ä»¤æ‰§è¡Œ ä»€ä¹ˆæ—¶é—´ï¼šå³æ—¶ï¼ˆå‘èµ·ï¼‰ï¼›åˆç†çš„æ—¶é—´ï¼ˆæ‰§è¡Œï¼‰ å¹²ä»€ä¹ˆäº‹æƒ…ï¼šä¿å­˜æ•°æ® 127.0.0.1:6379&gt; bgsave Background saving startedåŸç†ï¼šè°ƒç”¨linuxçš„forkå‡½æ•°ç”Ÿæˆå­è¿›ç¨‹ï¼Œç”±è¿™ä¸ªå­è¿›ç¨‹è´Ÿè´£åˆ›å»ºrdbæ–‡ä»¶ã€‚ 2.1.3 è‡ªåŠ¨æ‰§è¡Œ è°ï¼šredisæœåŠ¡å™¨å‘èµ·æŒ‡ä»¤ï¼ˆåŸºäºæ¡ä»¶ï¼‰ ä»€ä¹ˆæ—¶é—´ï¼šæ»¡è¶³æ¡ä»¶ å¹²ä»€ä¹ˆäº‹æƒ…ï¼šä¿å­˜æ•°æ® å‘èµ·çš„è¿˜æ˜¯bgsave é…ç½®ï¼š save second changesï¼šæ»¡è¶³é™å®šæ—¶é—´èŒƒå›´å†…keyçš„å˜åŒ–æ•°é‡è¾¾åˆ°æŒ‡å®šæ•°é‡å³è¿›è¡ŒæŒä¹…åŒ–ã€‚ ç¤ºä¾‹ï¼š save 900 1 save 300 10 save 60 10000 2.1.4 å…¶ä»–å¯åŠ¨æ–¹å¼ å…¨é‡å¤åˆ¶ æœåŠ¡å™¨è¿è¡Œè¿‡ç¨‹ä¸­é‡å¯ debug reload å…³é—­æœåŠ¡å™¨æ—¶æŒ‡å®šä¿å­˜æ•°æ® shutdown save 2.2 ç›¸å…³é…ç½® dbfilename dump.rdb è¯´æ˜ï¼šè®¾ç½®æœ¬åœ°æ•°æ®åº“æ–‡ä»¶åï¼Œé»˜è®¤å€¼ä¸º dump.rdb ç»éªŒï¼šé€šå¸¸è®¾ç½®ä¸ºdump-ç«¯å£å·.rdb dir è¯´æ˜ï¼šè®¾ç½®å­˜å‚¨.rdbæ–‡ä»¶çš„è·¯å¾„ ç»éªŒï¼šé€šå¸¸è®¾ç½®æˆå­˜å‚¨ç©ºé—´è¾ƒå¤§çš„ç›®å½•ä¸­ï¼Œç›®å½•åç§°data rdbcompression yes è¯´æ˜ï¼šè®¾ç½®å­˜å‚¨è‡³æœ¬åœ°æ•°æ®åº“æ—¶æ˜¯å¦å‹ç¼©æ•°æ®ï¼Œé»˜è®¤ä¸º yesï¼Œé‡‡ç”¨ LZF å‹ç¼© ç»éªŒï¼šé€šå¸¸é»˜è®¤ä¸ºå¼€å¯çŠ¶æ€ï¼Œå¦‚æœè®¾ç½®ä¸ºnoï¼Œå¯ä»¥èŠ‚çœ CPU è¿è¡Œæ—¶é—´ï¼Œä½†ä¼šä½¿å­˜å‚¨çš„æ–‡ä»¶å˜å¤§ï¼ˆå·¨å¤§ï¼‰ rdbchecksum yes è¯´æ˜ï¼šè®¾ç½®æ˜¯å¦è¿›è¡ŒRDBæ–‡ä»¶æ ¼å¼æ ¡éªŒï¼Œè¯¥æ ¡éªŒè¿‡ç¨‹åœ¨å†™æ–‡ä»¶å’Œè¯»æ–‡ä»¶è¿‡ç¨‹å‡è¿›è¡Œ ç»éªŒï¼šé€šå¸¸é»˜è®¤ä¸ºå¼€å¯çŠ¶æ€ï¼Œå¦‚æœè®¾ç½®ä¸ºnoï¼Œå¯ä»¥èŠ‚çº¦è¯»å†™æ€§è¿‡ç¨‹çº¦10%æ—¶é—´æ¶ˆè€—ï¼Œä½†æ˜¯å­˜å‚¨ä¸€å®šçš„æ•°æ®æŸåé£é™© stop-writes-on-bgsave-error yes è¯´æ˜ï¼šåå°å­˜å‚¨è¿‡ç¨‹ä¸­å¦‚æœå‡ºç°é”™è¯¯ç°è±¡ï¼Œæ˜¯å¦åœæ­¢ä¿å­˜æ“ä½œ ç»éªŒï¼šé€šå¸¸é»˜è®¤ä¸ºå¼€å¯çŠ¶æ€ 2.3 ä¼˜ç‚¹ RDBæ˜¯ä¸€ä¸ªç´§å‡‘å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå­˜å‚¨æ•ˆç‡è¾ƒé«˜ RDBå†…éƒ¨å­˜å‚¨çš„æ˜¯redisåœ¨æŸä¸ªæ—¶é—´ç‚¹çš„æ•°æ®å¿«ç…§ï¼Œéå¸¸é€‚åˆç”¨äºæ•°æ®å¤‡ä»½ï¼Œå…¨é‡å¤åˆ¶ç­‰åœºæ™¯ RDBæ¢å¤æ•°æ®çš„é€Ÿåº¦è¦æ¯”AOFå¿«å¾ˆå¤š åº”ç”¨ï¼šæœåŠ¡å™¨ä¸­æ¯Xå°æ—¶æ‰§è¡Œbgsaveå¤‡ä»½ï¼Œå¹¶å°†RDBæ–‡ä»¶æ‹·è´åˆ°è¿œç¨‹æœºå™¨ä¸­ï¼Œç”¨äºç¾éš¾æ¢å¤ã€‚ 2.4 ç¼ºç‚¹ RDBæ–¹å¼æ— è®ºæ˜¯æ‰§è¡ŒæŒ‡ä»¤è¿˜æ˜¯åˆ©ç”¨é…ç½®ï¼Œæ— æ³•åšåˆ°å®æ—¶æŒä¹…åŒ–ï¼Œå…·æœ‰è¾ƒå¤§çš„å¯èƒ½æ€§ä¸¢å¤±æ•°æ® bgsaveæŒ‡ä»¤æ¯æ¬¡è¿è¡Œè¦æ‰§è¡Œforkæ“ä½œåˆ›å»ºå­è¿›ç¨‹ï¼Œè¦ç‰ºç‰²æ‰ä¸€äº›æ€§èƒ½ Redisçš„ä¼—å¤šç‰ˆæœ¬ä¸­æœªè¿›è¡ŒRDBæ–‡ä»¶æ ¼å¼çš„ç‰ˆæœ¬ç»Ÿä¸€ï¼Œæœ‰å¯èƒ½å‡ºç°å„ç‰ˆæœ¬æœåŠ¡ä¹‹é—´æ•°æ®æ ¼å¼æ— æ³•å…¼å®¹ç°è±¡ 3 AOF3.1 æ¦‚è¿°AOFï¼ˆappend-only-fileï¼‰:ä»¥ç‹¬ç«‹æ—¥å¿—çš„æ–¹å¼è®°å½•æ¯æ¬¡å†™å‘½ä»¤ï¼Œé‡å¯æ—¶å†é‡æ–°æ‰§è¡ŒAOFæ–‡ä»¶ä¸­å‘½ä»¤è¾¾åˆ°æ¢å¤æ•°æ®çš„ç›®çš„ã€‚ä¸RDBç›¸æ¯”å¯ä»¥ç®€å•æè¿°ä¸ºæ”¹è®°å½•æ•°æ®ä¸ºè®°å½•æ•°æ®äº§ç”Ÿçš„è¿‡ç¨‹ AOFçš„ä¸»è¦ä½œç”¨æ˜¯è§£å†³äº†æ•°æ®æŒä¹…åŒ–çš„å®æ—¶æ€§ï¼Œç›®å‰å·²ç»æ˜¯RedisæŒä¹…åŒ–çš„ä¸»æµæ–¹å¼ è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ 3.2 AOFå†™æ•°æ®ä¸‰ç§ç­–ç•¥ alwaysï¼ˆæ¯æ¬¡ï¼‰æ¯æ¬¡å†™å…¥æ“ä½œå‡åŒæ­¥åˆ°AOFæ–‡ä»¶ä¸­ï¼Œæ•°æ®é›¶è¯¯å·®ï¼Œæ€§èƒ½è¾ƒä½ï¼Œå‘½ä»¤å†™å…¥åˆ°aof_bufåï¼Œä¼šè°ƒç”¨ç³»ç»Ÿfsyncæ“ä½œåŒæ­¥åˆ°æ–‡ä»¶ä¸­ã€‚ everysecï¼ˆæ¯ç§’ï¼‰æ¯ç§’å°†ç¼“å†²åŒºä¸­çš„æŒ‡ä»¤åŒæ­¥åˆ°AOFæ–‡ä»¶ä¸­ï¼Œæ•°æ®å‡†ç¡®æ€§è¾ƒé«˜ï¼Œæ€§èƒ½è¾ƒé«˜ï¼Œæ˜¯é»˜è®¤é…ç½®ã€‚åªè°ƒç”¨ç³»ç»Ÿwriteæ“ä½œï¼ŒfsyncåŒæ­¥æ–‡ä»¶æ“ä½œç”±ä¸“é—¨è¿›ç¨‹æ¯ç§’è°ƒç”¨ä¸€æ¬¡ã€‚åœ¨ç³»ç»Ÿçªç„¶å®•æœºçš„æƒ…å†µä¸‹ä¸¢å¤±1ç§’å†…çš„æ•°æ® noï¼ˆç³»ç»Ÿæ§åˆ¶ï¼‰ç”±æ“ä½œç³»ç»Ÿæ§åˆ¶æ¯æ¬¡åŒæ­¥åˆ°AOFæ–‡ä»¶çš„å‘¨æœŸï¼Œæ•´ä½“è¿‡ç¨‹ä¸å¯æ§ï¼Œåªè°ƒç”¨ç³»ç»Ÿwriteæ“ä½œï¼Œä¸å¯¹AOFæ–‡ä»¶åšfsyncæ“ä½œã€‚ 3.3 ç›¸å…³é…ç½® appendonly yes|no å¼€å¯AOF appendfsync always|everysec|no å†™æ•°æ®ç­–ç•¥ 3.4 AOFé‡å†™éšç€å‘½ä»¤ä¸æ–­å†™å…¥AOFï¼Œæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRediså¼•å…¥äº†AOFé‡å†™æœºåˆ¶å‹ç¼©æ–‡ä»¶ä½“ç§¯ã€‚AOFæ–‡ä»¶é‡å†™æ˜¯å°†Redisè¿›ç¨‹å†…çš„æ•°æ®è½¬åŒ–ä¸ºå†™å‘½ä»¤åŒæ­¥åˆ°æ–°AOFæ–‡ä»¶çš„è¿‡ç¨‹ã€‚ç®€å•è¯´å°±æ˜¯å°†å¯¹åŒä¸€ä¸ªæ•°æ®çš„è‹¥å¹²ä¸ªæ¡å‘½ä»¤æ‰§è¡Œç»“æœè½¬åŒ–æˆæœ€ç»ˆç»“æœæ•°æ®å¯¹åº”çš„æŒ‡ä»¤è¿›è¡Œè®°å½•ã€‚ 3.4.1 ä½œç”¨ é™ä½ç£ç›˜å ç”¨é‡ï¼Œæé«˜ç£ç›˜åˆ©ç”¨ç‡ æé«˜æŒä¹…åŒ–æ•ˆç‡ï¼Œé™ä½æŒä¹…åŒ–å†™æ—¶é—´ï¼Œæé«˜IOæ€§èƒ½ é™ä½æ•°æ®æ¢å¤ç”¨æ—¶ï¼Œæé«˜æ•°æ®æ¢å¤æ•ˆç‡ 3.4.2 é‡å†™è§„åˆ™ è¿›ç¨‹å†…å·²è¶…æ—¶çš„æ•°æ®ä¸å†å†™å…¥æ–‡ä»¶ å¿½ç•¥æ— æ•ˆæŒ‡ä»¤ï¼Œé‡å†™æ—¶ä½¿ç”¨è¿›ç¨‹å†…æ•°æ®ç›´æ¥ç”Ÿæˆï¼Œè¿™æ ·æ–°çš„AOFæ–‡ä»¶åªä¿ç•™æœ€ç»ˆæ•°æ®çš„å†™å…¥å‘½ä»¤å¦‚del key1ã€hdel key2ã€srem key3ã€set key4 111ã€set key4 222ç­‰ å¯¹åŒä¸€æ•°æ®çš„å¤šæ¡å†™å‘½ä»¤åˆå¹¶ä¸ºä¸€æ¡å‘½ä»¤ï¼Œå¦‚lpush list1 aã€lpush list1 bã€ lpush list1 c å¯ä»¥è½¬åŒ–ä¸ºï¼šlpush list1 a b cã€‚ ä¸ºé˜²æ­¢æ•°æ®é‡è¿‡å¤§é€ æˆå®¢æˆ·ç«¯ç¼“å†²åŒºæº¢å‡ºï¼Œå¯¹listã€setã€hashã€zsetç­‰ç±»å‹ï¼Œæ¯æ¡æŒ‡ä»¤æœ€å¤šå†™å…¥64ä¸ªå…ƒç´  3.4.3 é‡å†™æ–¹å¼æ‰‹åŠ¨é‡å†™ï¼šbgrewriteaof è‡ªåŠ¨é‡å†™ï¼š # aof_current_sizeè¾¾åˆ°æœ€å°sizeå¼€å§‹é‡å†™ auto-aof-rewrite-min-size size # (aof_current_size-aof_base_size)/aof_base_size>percentageå¼€å§‹é‡å†™ auto-aof-rewrite-percentage percentage é…ç½®è‡ªåŠ¨é‡å†™è¦äº†è§£ä¸¤ä¸ªå‚æ•°ï¼š aof_current_size aof_base_sizeaof_current_sizeè¡¨ç¤ºå½“å‰AOFæ–‡ä»¶å¤§å°ï¼Œaof_base_sizeæŒ‡çš„å°±æ˜¯ä¸Šä¸€æ¬¡é‡å†™åAOFæ–‡ä»¶çš„å¤§å°ã€‚è¿™ä¸¤ä¸ªå‚æ•°å¯ä»¥é€šè¿‡è¿è¡ŒæŒ‡ä»¤info PersistenceæŸ¥çœ‹ã€‚ åŸç†å’Œbgsaveç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”¨å­è¿›ç¨‹å»é‡å†™ã€‚ 4 RDBä¸AOFåŒºåˆ« æŒä¹…åŒ–æ–¹å¼ RDB AOF å ç”¨å­˜å‚¨ç©ºé—´ å°ï¼ˆæ•°æ®çº§ï¼šå‹ç¼©ï¼‰ å¤§ï¼ˆæŒ‡ä»¤çº§ï¼šé‡å†™ï¼‰ å­˜å‚¨é€Ÿåº¦ æ…¢ å¿« æ¢å¤é€Ÿåº¦ å¿« æ…¢ æ•°æ®å®‰å…¨æ€§ ä¼šä¸¢å¤±æ•°æ® ä¾æ®ç­–ç•¥å†³å®š èµ„æºæ¶ˆè€— é«˜/é‡é‡çº§ ä½/è½»é‡çº§ å¯åŠ¨ä¼˜å…ˆçº§ ä½ é«˜ å¦‚ä½•é€‰æ‹©ï¼Ÿ å¯¹æ•°æ®éå¸¸æ•æ„Ÿï¼Œå»ºè®®ä½¿ç”¨é»˜è®¤çš„AOFæŒä¹…åŒ–æ–¹æ¡ˆ AOFæŒä¹…åŒ–ç­–ç•¥ä½¿ç”¨everysecondï¼Œæ¯ç§’é’Ÿfsyncä¸€æ¬¡ã€‚è¯¥ç­–ç•¥redisä»å¯ä»¥ä¿æŒå¾ˆå¥½çš„å¤„ç†æ€§èƒ½ï¼Œå½“å‡ºç°é—®é¢˜æ—¶ï¼Œæœ€å¤šä¸¢å¤±0-1ç§’å†…çš„æ•°æ®ã€‚ æ³¨æ„ï¼šç”±äºAOFæ–‡ä»¶å­˜å‚¨ä½“ç§¯è¾ƒå¤§ï¼Œä¸”æ¢å¤é€Ÿåº¦è¾ƒæ…¢ æ•°æ®å‘ˆç°é˜¶æ®µæœ‰æ•ˆæ€§ï¼Œå»ºè®®ä½¿ç”¨RDBæŒä¹…åŒ–æ–¹æ¡ˆ æ•°æ®å¯ä»¥è‰¯å¥½çš„åšåˆ°é˜¶æ®µå†…æ— ä¸¢å¤±ï¼ˆè¯¥é˜¶æ®µæ˜¯å¼€å‘è€…æˆ–è¿ç»´äººå‘˜æ‰‹å·¥ç»´æŠ¤çš„ï¼‰ï¼Œä¸”æ¢å¤é€Ÿåº¦è¾ƒå¿«ï¼Œé˜¶æ®µç‚¹æ•°æ®æ¢å¤é€šå¸¸é‡‡ç”¨RDBæ–¹æ¡ˆ æ³¨æ„ï¼šåˆ©ç”¨RDBå®ç°ç´§å‡‘çš„æ•°æ®æŒä¹…åŒ–ä¼šä½¿Redisé™çš„å¾ˆä½ï¼Œæ…é‡æ€»ç»“ï¼š ç»¼åˆæ¯”å¯¹ RDBä¸AOFçš„é€‰æ‹©å®é™…ä¸Šæ˜¯åœ¨åšä¸€ç§æƒè¡¡ï¼Œæ¯ç§éƒ½æœ‰åˆ©æœ‰å¼Š å¦‚ä¸èƒ½æ‰¿å—æ•°åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±ï¼Œå¯¹ä¸šåŠ¡æ•°æ®éå¸¸æ•æ„Ÿï¼Œé€‰ç”¨AOF å¦‚èƒ½æ‰¿å—æ•°åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±ï¼Œä¸”è¿½æ±‚å¤§æ•°æ®é›†çš„æ¢å¤é€Ÿåº¦ï¼Œé€‰ç”¨RDB ç¾éš¾æ¢å¤é€‰ç”¨RDB åŒä¿é™©ç­–ç•¥ï¼ŒåŒæ—¶å¼€å¯ RDB å’Œ AOFï¼Œé‡å¯åï¼ŒRedisä¼˜å…ˆä½¿ç”¨ AOF æ¥æ¢å¤æ•°æ®ï¼Œé™ä½ä¸¢å¤±æ•°æ®çš„é‡","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"https://www.codetool.top/tags/Redis/"}]},{"title":"MySQLå›é¡¾-å­˜å‚¨è¿‡ç¨‹ä¸è§¦å‘å™¨","slug":"MySQLå›é¡¾-å­˜å‚¨è¿‡ç¨‹ä¸è§¦å‘å™¨","date":"2020-03-02T12:04:21.000Z","updated":"2020-03-04T13:00:00.501Z","comments":true,"path":"article/MySQLå›é¡¾-å­˜å‚¨è¿‡ç¨‹ä¸è§¦å‘å™¨/","link":"","permalink":"https://www.codetool.top/article/MySQL%E5%9B%9E%E9%A1%BE-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E8%A7%A6%E5%8F%91%E5%99%A8/","excerpt":"","text":"1 å­˜å‚¨è¿‡ç¨‹1.1 æ¦‚è¿°å­˜å‚¨è¿‡ç¨‹æ˜¯ä¸€ç»„ä¸ºäº†å®Œæˆç‰¹å®šåŠŸèƒ½çš„ SQL è¯­å¥é›†åˆã€‚ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹çš„ç›®çš„æ˜¯å°†å¸¸ç”¨æˆ–å¤æ‚çš„å·¥ä½œé¢„å…ˆç”¨ SQL è¯­å¥å†™å¥½å¹¶ç”¨ä¸€ä¸ªæŒ‡å®šåç§°å­˜å‚¨èµ·æ¥ï¼Œè¿™ä¸ªè¿‡ç¨‹ç»ç¼–è¯‘å’Œä¼˜åŒ–åå­˜å‚¨åœ¨æ•°æ®åº“æœåŠ¡å™¨ä¸­ï¼Œå› æ­¤ç§°ä¸ºå­˜å‚¨è¿‡ç¨‹ã€‚å½“ä»¥åéœ€è¦æ•°æ®åº“æä¾›ä¸å·²å®šä¹‰å¥½çš„å­˜å‚¨è¿‡ç¨‹çš„åŠŸèƒ½ç›¸åŒçš„æœåŠ¡æ—¶ï¼Œåªéœ€è°ƒç”¨â€œCALLå­˜å‚¨è¿‡ç¨‹åå­—â€å³å¯è‡ªåŠ¨å®Œæˆã€‚ ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹æ˜¯ä¸€ä¸ªå¯ç¼–ç¨‹çš„å‡½æ•°ï¼Œå®ƒåœ¨æ•°æ®åº“ä¸­åˆ›å»ºå¹¶ä¿å­˜ï¼Œä¸€èˆ¬ç”± SQL è¯­å¥å’Œä¸€äº›ç‰¹æ®Šçš„æ§åˆ¶ç»“æ„ç»„æˆã€‚å½“å¸Œæœ›åœ¨ä¸åŒçš„åº”ç”¨ç¨‹åºæˆ–å¹³å°ä¸Šæ‰§è¡Œç›¸åŒçš„ç‰¹å®šåŠŸèƒ½æ—¶ï¼Œå­˜å‚¨è¿‡ç¨‹å°¤ä¸ºåˆé€‚ã€‚ 1.2 ä¼˜ç‚¹å­˜å‚¨è¿‡ç¨‹é€šå¸¸æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š å°è£…æ€§å­˜å‚¨è¿‡ç¨‹è¢«åˆ›å»ºåï¼Œå¯ä»¥åœ¨ç¨‹åºä¸­è¢«å¤šæ¬¡è°ƒç”¨ï¼Œè€Œä¸å¿…é‡æ–°ç¼–å†™è¯¥å­˜å‚¨è¿‡ç¨‹çš„ SQL è¯­å¥ï¼Œå¹¶ä¸”æ•°æ®åº“ä¸“ä¸šäººå‘˜å¯ä»¥éšæ—¶å¯¹å­˜å‚¨è¿‡ç¨‹è¿›è¡Œä¿®æ”¹ï¼Œè€Œä¸ä¼šå½±å“åˆ°è°ƒç”¨å®ƒçš„åº”ç”¨ç¨‹åºæºä»£ç ã€‚ å¯å¢å¼º SQL è¯­å¥çš„åŠŸèƒ½å’Œçµæ´»æ€§å­˜å‚¨è¿‡ç¨‹å¯ä»¥ç”¨æµç¨‹æ§åˆ¶è¯­å¥ç¼–å†™ï¼Œæœ‰å¾ˆå¼ºçš„çµæ´»æ€§ï¼Œå¯ä»¥å®Œæˆå¤æ‚çš„åˆ¤æ–­å’Œè¾ƒå¤æ‚çš„è¿ç®—ã€‚ å¯å‡å°‘ç½‘ç»œæµé‡ç”±äºå­˜å‚¨è¿‡ç¨‹æ˜¯åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œçš„ï¼Œä¸”æ‰§è¡Œé€Ÿåº¦å¿«ï¼Œå› æ­¤å½“å®¢æˆ·è®¡ç®—æœºä¸Šè°ƒç”¨è¯¥å­˜å‚¨è¿‡ç¨‹æ—¶ï¼Œç½‘ç»œä¸­ä¼ é€çš„åªæ˜¯è¯¥è°ƒç”¨è¯­å¥ï¼Œä»è€Œå¯é™ä½ç½‘ç»œè´Ÿè½½ã€‚ é«˜æ€§èƒ½å­˜å‚¨è¿‡ç¨‹æ‰§è¡Œä¸€æ¬¡åï¼Œäº§ç”Ÿçš„äºŒè¿›åˆ¶ä»£ç å°±é©»ç•™åœ¨ç¼“å†²åŒºï¼Œåœ¨ä»¥åçš„è°ƒç”¨ä¸­ï¼Œåªéœ€è¦ä»ç¼“å†²åŒºä¸­æ‰§è¡ŒäºŒè¿›åˆ¶ä»£ç å³å¯ï¼Œä»è€Œæé«˜äº†ç³»ç»Ÿçš„æ•ˆç‡å’Œæ€§èƒ½ã€‚ æé«˜æ•°æ®åº“çš„å®‰å…¨æ€§å’Œæ•°æ®çš„å®Œæ•´æ€§ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹å¯ä»¥å®Œæˆæ‰€æœ‰æ•°æ®åº“æ“ä½œï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç¼–ç¨‹çš„æ–¹å¼æ§åˆ¶æ•°æ®åº“ä¿¡æ¯è®¿é—®çš„æƒé™ã€‚ 1.3 ç¼–å†™1.3.1 åŸºæœ¬çš„å­˜å‚¨è¿‡ç¨‹CREATE PROCEDURE productpricing() BEGIN SELECT AVG(prod_price) as priceaverage FROM products; END; åˆ›å»ºåä¸º productpricing çš„å‚¨å­˜è¿‡ç¨‹ã€‚å¦‚æœå­˜å‚¨è¿‡ç¨‹ä¸­éœ€è¦ä¼ é€’å‚æ•°ï¼Œåˆ™å°†ä»–ä»¬åœ¨æ‹¬å·ä¸­åˆ—ä¸¾å‡ºæ¥å³å¯ã€‚æ‹¬å·å¿…é¡»æœ‰ã€‚BEGIN å’Œ END å…³é”®å­—ç”¨æ¥é™åˆ¶å­˜å‚¨è¿‡ç¨‹ä½“ã€‚ä¸Šè¿°å­˜å‚¨è¿‡ç¨‹ä½“æœ¬èº«æ˜¯ä¸€ä¸ªç®€å•çš„ select è¯­å¥ã€‚æ³¨æ„è¿™é‡Œåªæ˜¯åˆ›å»ºå­˜å‚¨è¿‡ç¨‹å¹¶æ²¡æœ‰è¿›è¡Œè°ƒç”¨ã€‚ å‚¨å­˜è¿‡ç¨‹çš„ä½¿ç”¨ï¼šCall productpring(); 1.3.2 ä½¿ç”¨å‚æ•°çš„å­˜å‚¨è¿‡ç¨‹ä¸€èˆ¬å­˜å‚¨è¿‡ç¨‹å¹¶ä¸æ˜¾ç¤ºç»“æœï¼Œè€Œæ˜¯æŠŠç»“æœè¿”å›ç»™ä½ æŒ‡å®šçš„å˜é‡ä¸Šã€‚ å˜é‡ï¼šå†…å­˜ä¸­ä¸€ä¸ªç‰¹å®šçš„ä½ç½®ï¼Œç”¨æ¥ä¸´æ—¶å­˜å‚¨æ•°æ®ã€‚ CREATE PROCEDURE prod( OUT pl DECIMAL(8,2), OUT ph DECIMAL(8,2), OUT pa DECIMAL(8,2) ) BEGIN SELECT MIN(prod_price) INTO pl FROM products; SELECT MAX(prod_price) INTO ph FROM products; SELECT AVG(prod_price) INTO pa FROM products; END; å…³é”®å­— OUT æŒ‡å‡ºç›¸åº”çš„å‚æ•°ç”¨æ¥ä»å­˜å‚¨è¿‡ç¨‹ä¼ å‡ºä¸€ä¸ªå€¼(è¿”å›ç»™è°ƒç”¨è€…)ã€‚ MySQL æ”¯æŒ in(ä¼ é€’ç»™å­˜å‚¨è¿‡ç¨‹)ã€out(ä»å­˜å‚¨è¿‡ç¨‹ä¼ å‡ºï¼Œè¿™é‡Œæ‰€ç”¨)å’Œ inout(å¯¹å­˜å‚¨è¿‡ç¨‹ä¼ å…¥å’Œä¼ å‡º)ç±»å‹çš„å‚æ•°ã€‚å­˜å‚¨è¿‡ç¨‹çš„ä»£ç ä½äº begin å’Œ end è¯­å¥å†…ã€‚ä»–ä»¬æ˜¯ä¸€ç³»åˆ— select è¯­å¥ï¼Œç”¨æ¥æ£€ç´¢å€¼ã€‚ç„¶åä¿å­˜åˆ°ç›¸å¯¹åº”çš„å˜é‡(é€šè¿‡ INTO å…³é”®å­—)ã€‚å­˜å‚¨è¿‡ç¨‹çš„å‚æ•°å…è®¸çš„æ•°æ®ç±»å‹ä¸è¡¨ä¸­ä½¿ç”¨çš„ç±»å‹ç›¸åŒã€‚æ³¨æ„è®°å½•é›†æ˜¯ä¸è¢«å…è®¸çš„ç±»å‹ï¼Œå› æ­¤ï¼Œä¸èƒ½é€šè¿‡ä¸€ä¸ªå‚æ•°è¿”å›å¤šä¸ªè¡Œå’Œåˆ—ï¼Œè¿™ä¹Ÿæ˜¯ä¸Šé¢ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ 3 ä¸ªå‚æ•°å’Œ 3 æ¡ selectè¯­å¥çš„åŸå› ã€‚ ä½¿ç”¨ï¼š call PROCEDURE(@pricelow,@pricehigh,@priceaverage); select @pricelow; select @pricehigh; select @pricelow,@pricehigh,@priceaverage; ä¸ºè°ƒç”¨æ­¤å­˜å‚¨è¿‡ç¨‹ï¼Œå¿…é¡»æŒ‡å®š 3 ä¸ªå˜é‡åã€‚å¦‚ä¸Šæ‰€ç¤ºã€‚3 ä¸ªå‚æ•°æ˜¯å­˜å‚¨è¿‡ç¨‹ä¿å­˜ç»“æœçš„ 3 ä¸ªå˜é‡çš„åå­—ã€‚è°ƒç”¨æ—¶ï¼Œè¯­å¥å¹¶ä¸æ˜¾ç¤ºä»»ä½•æ•°æ®ï¼Œå®ƒè¿”å›ä»¥åå¯ä»¥æ˜¾ç¤ºçš„å˜é‡(æˆ–åœ¨å…¶ä»–å¤„ç†ä¸­ä½¿ç”¨)ã€‚ æ³¨æ„ï¼šæ‰€æœ‰çš„ MySQL å˜é‡éƒ½æ˜¯ä»¥@å¼€å¤´ã€‚ ä½¿ç”¨INçš„ç¤ºä¾‹ï¼š CREATE PROCEDURE ordertotal( IN innumber int, OUT outtotal decimal(8,2) ) BEGIN SELECT Sum(item_price * quantity) FROM orderitems WHERE order_num = innumber INTO outtotal; END; CALL ordertotal(20005,@total); select @total; // å¾—åˆ° 20005 è®¢å•çš„åˆè®¡ CALL ordertotal(20009,@total); select @total; //å¾—åˆ° 20009 è®¢å•çš„åˆè®¡ 1.3.3 å¸¦æœ‰æ§åˆ¶è¯­å¥çš„å­˜å‚¨è¿‡ç¨‹CREATE PROCEDURE ordertotal( IN onumber INT, IN taxable BOOLEAN, OUT ototal DECIMAL(8,2) ) COMMENT 'Obtain order total, optionally adding tax' BEGIN -- declear variable for total DECLARE total DECIMAL(8,2); -- declear tax percentage DECLARE taxrate INT DEFAULT 6; -- get the order total SELECT Sum(item_price * quantity) FROM orderitems WHERE order_num = onumber INTO total; -- IS this taxable? IF taxable THEN -- yes ,so add taxrate to the total SELECT total+(total/100*taxrate)INTO total; END IF; -- finally ,save to out variable SELECT total INTO ototal; END; åœ¨å­˜å‚¨è¿‡ç¨‹ä¸­æˆ‘ä»¬ä½¿ç”¨äº† DECLARE è¯­å¥ï¼Œä»–ä»¬è¡¨ç¤ºå®šä¹‰ä¸¤ä¸ªå±€éƒ¨å˜é‡ï¼ŒDECLARE è¦æ±‚æŒ‡å®šå˜é‡åå’Œæ•°æ®ç±»å‹ã€‚å®ƒä¹Ÿæ”¯æŒå¯é€‰çš„é»˜è®¤å€¼(taxrate é»˜è®¤ 6%)ï¼Œå› ä¸ºåæœŸæˆ‘ä»¬è¿˜è¦åˆ¤æ–­è¦ä¸è¦å¢åŠ ç¨ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬æŠŠ SELECT æŸ¥è¯¢çš„ç»“æœå­˜å‚¨åˆ°å±€éƒ¨å˜é‡ total ä¸­ï¼Œç„¶ååœ¨ IF å’Œ THEN çš„é…åˆä¸‹ï¼Œæ£€æŸ¥ taxable æ˜¯å¦ä¸ºçœŸï¼Œç„¶ååœ¨çœŸçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åˆ©ç”¨å¦ä¸€æ¡ SELECT è¯­å¥å¢åŠ è¥ä¸šç¨åˆ°å±€éƒ¨å˜é‡ total ä¸­ï¼Œç„¶åæˆ‘ä»¬å†åˆ©ç”¨ SELECT è¯­å¥å°† total(å¢åŠ ç¨æˆ–è€…ä¸å¢åŠ ç¨çš„ç»“æœ)ä¿å­˜åˆ°æ€»çš„ ototal ä¸­ã€‚ ä¸Šé¢çš„ COMMENT å…³é”®å­—å¯ä»¥ç»™å‡ºæˆ–è€…ä¸ç»™å‡ºï¼Œå¦‚æœç»™å‡ºï¼Œå°†åœ¨ SHOW PROCEDURE STATUS çš„ç»“æœä¸­æ˜¾ç¤ºã€‚ æ‰€æœ‰è¯­æ³•ï¼š å˜é‡ç›¸å…³ï¼š DECLARE var_name[,...] type [DEFAULT value]ï¼šå£°æ˜å˜é‡ SET var_name = expr [, var_name = expr] ...ï¼šå˜é‡èµ‹å€¼ select ... into var_nameï¼šå°†æŸ¥è¯¢çš„ç»“æœèµ‹å€¼ç»™å˜é‡ åˆ†æ”¯å¾ªç¯ï¼š if_then elseif_then else_then if search_condition then statement_list [elseif search_condition then statement_list] ... [else statement_list] end if; case CASE case_value WHEN when_value THEN statement_list [WHEN when_value THEN statement_list] ... [ELSE statement_list] END CASE; while while search_condition do statement_list end while; repeat while æ˜¯æ»¡è¶³æ¡ä»¶æ‰æ‰§è¡Œï¼Œrepeat æ˜¯æ»¡è¶³æ¡ä»¶å°±é€€å‡ºå¾ªç¯ã€‚ REPEAT statement_list UNTIL search_condition END REPEAT; loop é€šå¸¸é…åˆleaveè¯­å¥é€€å‡ºå¾ªç¯ï¼Œä¹Ÿå¯ä»¥æ­»å¾ªç¯ [begin_label:] LOOP statement_list END LOOP [end_label] leave é€€å‡ºå¾ªç¯ CREATE PROCEDURE pro_test11(n int) BEGIN declare total int default 0; ins: LOOP IF n &lt;= 0 then leave ins; END IF; set total = total + n; set n = n - 1; END LOOP ins; select total; END$ 1.3.4 ä½¿ç”¨æ¸¸æ ‡çš„å­˜å‚¨è¿‡ç¨‹æ¸¸æ ‡æ˜¯ç”¨æ¥å­˜å‚¨æŸ¥è¯¢ç»“æœé›†çš„æ•°æ®ç±»å‹ , åœ¨å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°ä¸­å¯ä»¥ä½¿ç”¨å…‰æ ‡å¯¹ç»“æœé›†è¿›è¡Œå¾ªç¯çš„å¤„ç†ã€‚å…‰æ ‡çš„ä½¿ç”¨åŒ…æ‹¬å…‰æ ‡çš„å£°æ˜ã€OPENã€FETCH å’Œ CLOSEï¼Œå…¶è¯­æ³•åˆ†åˆ«å¦‚ä¸‹ã€‚ å£°æ˜å…‰æ ‡ï¼š DECLARE cursor_name CURSOR FOR select_statement ; ä»£è¡¨è¿™ä¸ªå˜é‡æ˜¯ä¸€ä¸ªcursorç±»å‹ï¼Œå¯¹åº”çš„æ˜¯select_statementè¯­å¥çš„ç»“æœé›†ã€‚ OPEN å…‰æ ‡ï¼š OPEN cursor_name ; FETCH å…‰æ ‡ï¼š FETCH cursor_name INTO var_name [, var_name] ... CLOSE å…‰æ ‡ï¼š CLOSE cursor_name ; å®ä¾‹ï¼š -- æŸ¥è¯¢empè¡¨ä¸­æ•°æ®, å¹¶é€è¡Œè·å–è¿›è¡Œå±•ç¤º DELIMITER $ create procedure pro_test12() begin DECLARE id int(11); DECLARE name varchar(50); DECLARE age int(11); DECLARE salary int(11); DECLARE has_data int default 1; DECLARE emp_result CURSOR FOR select * from emp; DECLARE EXIT HANDLER FOR NOT FOUND set has_data = 0; open emp_result; repeat fetch emp_result into id , name , age , salary; select concat('idä¸º',id, ', name ä¸º' ,name , ', ageä¸º ' ,age , ', è–ªæ°´ä¸º: ', salary); until has_data = 0 end repeat; close emp_result; end$ DELIMITER ; é€šè¿‡DECLARE EXIT HANDLER FOR NOT FOUND set has_data = 0;ç›¸å½“äºåœ¨å…‰æ ‡è·å–ä¸åˆ°ä¸‹ä¸€è¡Œçš„æ—¶å€™ç»™has_dataèµ‹å€¼ä¸º0ã€‚ 1.4 ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹MySQL ä¸­ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š ALTER PROCEDURE å­˜å‚¨è¿‡ç¨‹å [ ç‰¹å¾ ... ] ç‰¹å¾æŒ‡å®šäº†å­˜å‚¨è¿‡ç¨‹çš„ç‰¹æ€§ï¼Œå¯èƒ½çš„å–å€¼æœ‰ï¼š CONTAINS SQL è¡¨ç¤ºå­ç¨‹åºåŒ…å« SQL è¯­å¥ï¼Œä½†ä¸åŒ…å«è¯»æˆ–å†™æ•°æ®çš„è¯­å¥ã€‚ NO SQL è¡¨ç¤ºå­ç¨‹åºä¸­ä¸åŒ…å« SQL è¯­å¥ã€‚ READS SQL DATA è¡¨ç¤ºå­ç¨‹åºä¸­åŒ…å«è¯»æ•°æ®çš„è¯­å¥ã€‚ MODIFIES SQL DATA è¡¨ç¤ºå­ç¨‹åºä¸­åŒ…å«å†™æ•°æ®çš„è¯­å¥ã€‚ SQL SECURITY { DEFINER |INVOKER } æŒ‡æ˜è°æœ‰æƒé™æ¥æ‰§è¡Œã€‚ DEFINER è¡¨ç¤ºåªæœ‰å®šä¹‰è€…è‡ªå·±æ‰èƒ½å¤Ÿæ‰§è¡Œã€‚ INVOKER è¡¨ç¤ºè°ƒç”¨è€…å¯ä»¥æ‰§è¡Œã€‚ COMMENT &#39;string&#39; è¡¨ç¤ºæ³¨é‡Šä¿¡æ¯ã€‚ ALTER PROCEDURE showstuscore MODIFIES SQL DATA SQL SECURITY INVOKER; æç¤ºï¼šALTER PROCEDURE è¯­å¥ç”¨äºä¿®æ”¹å­˜å‚¨è¿‡ç¨‹çš„æŸäº›ç‰¹å¾ã€‚å¦‚æœè¦ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹çš„å†…å®¹ï¼Œå¯ä»¥å…ˆåˆ é™¤åŸå­˜å‚¨è¿‡ç¨‹ï¼Œå†ä»¥ç›¸åŒçš„å‘½ååˆ›å»ºæ–°çš„å­˜å‚¨è¿‡ç¨‹ï¼›å¦‚æœè¦ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹çš„åç§°ï¼Œå¯ä»¥å…ˆåˆ é™¤åŸå­˜å‚¨è¿‡ç¨‹ï¼Œå†ä»¥ä¸åŒçš„å‘½ååˆ›å»ºæ–°çš„å­˜å‚¨è¿‡ç¨‹ã€‚ 1.5 åˆ é™¤å­˜å‚¨è¿‡ç¨‹MySQL ä¸­ä½¿ç”¨ DROP PROCEDURE è¯­å¥æ¥åˆ é™¤æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨çš„å­˜å‚¨è¿‡ç¨‹ã€‚è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š DROP { PROCEDURE | FUNCTION } [ IF EXISTS ] &lt;è¿‡ç¨‹å&gt; IF EXISTSï¼šæŒ‡å®šè¿™ä¸ªå…³é”®å­—ç”¨äºé˜²æ­¢å› åˆ é™¤ä¸å­˜åœ¨çš„å­˜å‚¨è¿‡ç¨‹è€Œå¼•å‘çš„é”™è¯¯ã€‚ 2 è§¦å‘å™¨2.1 æ¦‚è¿°MySQL æ•°æ®åº“ä¸­è§¦å‘å™¨æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å­˜å‚¨è¿‡ç¨‹ï¼Œä¸åŒçš„æ˜¯æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹è¦ä½¿ç”¨ CALL è¯­å¥æ¥è°ƒç”¨ï¼Œè€Œè§¦å‘å™¨çš„æ‰§è¡Œä¸éœ€è¦ä½¿ç”¨ CALL è¯­å¥æ¥è°ƒç”¨ï¼Œä¹Ÿä¸éœ€è¦æ‰‹å·¥å¯åŠ¨ï¼Œåªè¦ä¸€ä¸ªé¢„å®šä¹‰çš„äº‹ä»¶å‘ç”Ÿå°±ä¼šè¢« MySQLè‡ªåŠ¨è°ƒç”¨ã€‚ è§¦å‘ç¨‹åºçš„ä¼˜ç‚¹å¦‚ä¸‹ï¼š è§¦å‘ç¨‹åºçš„æ‰§è¡Œæ˜¯è‡ªåŠ¨çš„ï¼Œå½“å¯¹è§¦å‘ç¨‹åºç›¸å…³è¡¨çš„æ•°æ®åšå‡ºç›¸åº”çš„ä¿®æ”¹åç«‹å³æ‰§è¡Œã€‚ è§¦å‘ç¨‹åºå¯ä»¥é€šè¿‡æ•°æ®åº“ä¸­ç›¸å…³çš„è¡¨å±‚å ä¿®æ”¹å¦å¤–çš„è¡¨ã€‚ è§¦å‘ç¨‹åºå¯ä»¥å®æ–½æ¯” FOREIGN KEY çº¦æŸã€CHECK çº¦æŸæ›´ä¸ºå¤æ‚çš„æ£€æŸ¥å’Œæ“ä½œã€‚ åœ¨ MySQL ä¸­ï¼Œåªæœ‰æ‰§è¡Œ INSERTã€UPDATE å’Œ DELETE æ“ä½œæ—¶æ‰èƒ½æ¿€æ´»è§¦å‘å™¨ã€‚ 2.2 åˆ›å»ºè§¦å‘å™¨åœ¨åˆ›å»ºè§¦å‘å™¨æ—¶ï¼Œéœ€è¦ç»™å‡º 4 æ¡è¯­å¥ï¼ˆè§„åˆ™ï¼‰ï¼š å”¯ä¸€çš„è§¦å‘å™¨åï¼› è§¦å‘å™¨å…³è”çš„è¡¨ï¼› è§¦å‘å™¨åº”è¯¥å“åº”çš„æ´»åŠ¨ï¼› è§¦å‘å™¨ä½•æ—¶æ‰§è¡Œ(å¤„ç†ä¹‹å‰æˆ–è€…ä¹‹å) CREATE TRIGGER newproduct AFTER INSERT ON products FOR EACH ROW SELECT 'Product added' INTO @info; CREATE TRIGGER ç”¨æ¥åˆ›å»ºåä¸º newproduct çš„æ–°è§¦å‘å™¨ã€‚è§¦å‘å™¨å¯ä»¥åœ¨ä¸€ä¸ªæ“ä½œå‘ç”Ÿå‰æˆ–è€…å‘ç”Ÿåæ‰§è¡Œï¼Œè¿™é‡Œ AFTER INSERT æ˜¯æŒ‡æ­¤è§¦å‘å™¨åœ¨ INSERT è¯­å¥æˆåŠŸæ‰§è¡Œåæ‰§è¡Œã€‚è¿™ä¸ªè§¦å‘å™¨è¿˜æŒ‡å®š FOR EACH ROW ï¼Œ å› æ­¤ä»£ç å¯¹æ¯ä¸ªæ’å…¥è¡Œéƒ½ä¼šæ‰§è¡Œã€‚æ–‡æœ¬ Product added å°†å¯¹æ¯ä¸ªæ’å…¥çš„è¡Œæ˜¾ç¤ºä¸€æ¬¡ 2.3 INSERT è§¦å‘å™¨æ˜¯åœ¨ insert è¯­å¥æ‰§è¡Œä¹‹å‰æˆ–è€…æ‰§è¡Œä¹‹åè¢«æ‰§è¡Œçš„è§¦å‘å™¨ã€‚ åœ¨ insert è§¦å‘å™¨ä»£ç ä¸­ï¼Œå¯å¼•å…¥ä¸€ä¸ªåä¸º new çš„è™šæ‹Ÿè¡¨ï¼Œè®¿é—®è¢«æ’å…¥çš„è¡Œï¼ˆæ™®é€šæ’å…¥è¯­å¥ä¹‹åä¹Ÿå­˜åœ¨è¿™ä¸ªè¡¨ï¼‰ åœ¨ before insert è§¦å‘å™¨ä¸­ï¼Œnew ä¸­çš„å€¼ä¹Ÿå¯ä»¥è¢«æ›´æ–°(å…è®¸æ›´æ”¹è¢«æ’å…¥çš„å€¼) å¯¹äº auto_increment åˆ—ï¼Œnew åœ¨ insert æ‰§è¡Œä¹‹å‰åŒ…å« 0ï¼Œåœ¨ insert æ‰§è¡Œä¹‹ååŒ…å«æ–°çš„è‡ªåŠ¨ç”Ÿæˆå€¼ CREATE TRIGGER neworder AFTER INSERT ON orders FOR EACH ROW SELECT NEW.order_num; è¯¥è¯­å¥åˆ›å»ºä¸€ä¸ªåä¸º neworder çš„è§¦å‘å™¨ï¼ŒæŒ‰ç…§ AFTER INSERT ON orders æ‰§è¡Œã€‚åœ¨æ’å…¥ä¸€ä¸ªæ–°è®¢å•åˆ° orders è¡¨æ—¶ï¼ŒMySQL ç”Ÿæˆä¸€ä¸ªæ–°çš„è®¢å•å·å¹¶ä¿å­˜åˆ° order_num ä¸­ã€‚è§¦å‘å™¨ä»NEW.order_num å–å¾—è¿™ä¸ªå€¼å¹¶è¿”å›å®ƒã€‚æ­¤è§¦å‘å™¨å¿…é¡»æŒ‰ç…§ AFTER INSERT æ‰§è¡Œï¼Œå› ä¸ºåœ¨BEFORE INSERT è¯­å¥æ‰§è¡Œä¹‹å‰ï¼Œæ–° order_num è¿˜æ²¡æœ‰ç”Ÿæˆã€‚ å¯¹äº orders çš„æ¯æ¬¡æ’å…¥ä½¿ç”¨è¿™ä¸ªè§¦å‘å™¨æ€»æ˜¯è¿”å›æ–°çš„è®¢å•å·ã€‚ 2.4 DELETE è§¦å‘å™¨Delete è§¦å‘å™¨åœ¨ delete è¯­å¥æ‰§è¡Œä¹‹å‰æˆ–è€…ä¹‹åæ‰§è¡Œã€‚ åœ¨ delete è§¦å‘å™¨çš„ä»£ç å†…,å¯ä»¥å¼•ç”¨ä¸€ä¸ªåä¸º OLD çš„è™šæ‹Ÿè¡¨ï¼Œç”¨æ¥è®¿é—®è¢«åˆ é™¤çš„è¡Œã€‚ OLD ä¸­çš„å€¼å…¨ä¸ºåªè¯»ï¼Œä¸èƒ½æ›´æ–°ã€‚ CREATE TRIGGER deleteorder BEFORE DELETE ON orders FOR EACH ROW BEGIN INSERT INTO archive_orders(order_num,order_date,cust_id) values (OLD.order_num,OLD.order_date,OLD.cust_id); END; åœ¨ä»»æ„è®¢å•è¢«åˆ é™¤å‰å°†æ‰§è¡Œæ­¤è§¦å‘å™¨ï¼Œå®ƒä½¿ç”¨ä¸€æ¡ INSERT è¯­å¥å°† OLD ä¸­çš„å€¼(è¦è¢«åˆ é™¤çš„è®¢å•) ä¿å­˜åˆ°ä¸€ä¸ªåä¸º archive_orders çš„å­˜æ¡£è¡¨ä¸­(ä¸ºå®é™…ä½¿ç”¨è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ä¸orders ç›¸åŒçš„åˆ—åˆ›å»ºä¸€ä¸ªåä¸º archive_orders çš„è¡¨) ä½¿ç”¨ BEFORE DELETE è§¦å‘å™¨çš„ä¼˜ç‚¹(ç›¸å¯¹äº AFTER DELETE è§¦å‘å™¨æ¥è¯´)ä¸ºï¼Œå¦‚æœç”±äºæŸç§åŸå› ï¼Œè®¢å•ä¸èƒ½å­˜æ¡£ï¼Œdelete æœ¬èº«å°†è¢«æ”¾å¼ƒã€‚ æˆ‘ä»¬åœ¨è¿™ä¸ªè§¦å‘å™¨ä½¿ç”¨äº† BEGIN å’Œ END è¯­å¥æ ‡è®°è§¦å‘å™¨ä½“ã€‚è¿™åœ¨æ­¤ä¾‹å­ä¸­å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œåªæ˜¯ä¸ºäº†è¯´æ˜ä½¿ç”¨BEGIN END å—çš„å¥½å¤„æ˜¯è§¦å‘å™¨èƒ½å¤Ÿå®¹çº³å¤šæ¡SQL è¯­å¥(åœ¨BEGIN ENDå—ä¸­ä¸€æ¡æŒ¨ç€ä¸€æ¡)ã€‚ 2.5 UPDATE è§¦å‘å™¨åœ¨ update è¯­å¥æ‰§è¡Œä¹‹å‰æˆ–è€…ä¹‹åæ‰§è¡Œ åœ¨ update è§¦å‘å™¨çš„ä»£ç å†…,å¯ä»¥å¼•ç”¨ä¸€ä¸ªåä¸º OLD çš„è™šæ‹Ÿè¡¨ï¼Œç”¨æ¥è®¿é—®ä»¥å‰(UPDATE è¯­å¥ä¹‹å‰)çš„å€¼ï¼Œå¼•ç”¨ä¸€ä¸ªåä¸º NEW çš„è™šæ‹Ÿè¡¨è®¿é—®æ–°æ›´æ–°çš„å€¼ã€‚ åœ¨ BEFORE UPDATE è§¦å‘å™¨ä¸­ï¼ŒNEW ä¸­çš„å€¼å¯èƒ½ä¹Ÿè¢«ç”¨äºæ›´æ–°(å…è®¸æ›´æ”¹å°†è¦ç”¨äº UPDATEè¯­å¥ä¸­çš„å€¼) OLD ä¸­çš„å€¼å…¨ä¸ºåªè¯»ï¼Œä¸èƒ½æ›´æ–°ã€‚ CREATE TRIGGER updatevendor BEFORE UPDATE ON vendors FOR EACH ROW SET NEW.vend_state = Upper(NEW.vemd_state); ä¿è¯å·åç¼©å†™æ€»æ˜¯å¤§å†™(ä¸ç®¡ UPFATE è¯­å¥ä¸­æ˜¯å¦ç»™å‡ºäº†å¤§å†™)ï¼Œæ¯æ¬¡æ›´æ–°ä¸€è¡Œæ—¶ï¼ŒNEW.vend_state ä¸­çš„å€¼(å°†ç”¨æ¥æ›´æ–°è¡¨è¡Œçš„å€¼)éƒ½ç”¨ Upper(NEW.vend_state)æ›¿æ¢ã€‚ 2.6 æ€»ç»“ ä¸å…¶ä»– DBMS ç›¸æ¯”ï¼ŒMySQL 5 ä¸­æ”¯æŒçš„è§¦å‘å™¨ç›¸å½“åˆçº§ï¼Œæœªæ¥çš„ MySQL ç‰ˆæœ¬ä¸­ä¼°è®¡ä¼šå­˜åœ¨ä¸€äº›æ”¹è¿›å’Œå¢å¼ºè§¦å‘å™¨çš„æ”¯æŒã€‚ é€šå¸¸ before ç”¨äºæ•°æ®çš„éªŒè¯å’Œå‡€åŒ–(ä¸ºäº†ä¿è¯æ’å…¥è¡¨ä¸­çš„æ•°æ®ç¡®å®æ˜¯éœ€è¦çš„æ•°æ®) ä¹Ÿé€‚ç”¨äº update è§¦å‘å™¨ã€‚ åˆ›å»ºè§¦å‘å™¨å¯èƒ½éœ€è¦ç‰¹æ®Šçš„å®‰å…¨è®¿é—®æƒé™ï¼Œä½†æ˜¯è§¦å‘å™¨çš„æ‰§è¡Œæ—¶è‡ªåŠ¨çš„ï¼Œå¦‚æœ insertï¼Œupdateï¼Œæˆ–è€… delete è¯­å¥èƒ½å¤Ÿæ‰§è¡Œï¼Œåˆ™ç›¸å…³çš„è§¦å‘å™¨ä¹Ÿèƒ½æ‰§è¡Œã€‚ ç”¨è§¦å‘å™¨æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§(å¤§å°å†™ï¼Œæ ¼å¼ç­‰)ã€‚åœ¨è§¦å‘å™¨ä¸­æ‰§è¡Œè¿™ç§ç±»å‹çš„å¤„ç†çš„ä¼˜ç‚¹å°±æ˜¯å®ƒæ€»æ˜¯è¿›è¡Œè¿™ç§å¤„ç†ï¼Œè€Œä¸”é€æ˜çš„è¿›è¡Œï¼Œä¸å®¢æˆ·æœºåº”ç”¨æ— å…³ã€‚ è§¦å‘å™¨çš„ä¸€ç§éå¸¸æœ‰æ„ä¹‰çš„ä½¿ç”¨å°±æ˜¯åˆ›å»ºå®¡è®¡è·Ÿè¸ªã€‚ä½¿ç”¨è§¦å‘å™¨ï¼ŒæŠŠæ›´æ”¹(å¦‚æœéœ€è¦ï¼Œç”šè‡³è¿˜æœ‰ä¹‹å‰å’Œä¹‹åçš„çŠ¶æ€)è®°å½•åˆ°å¦å¤–ä¸€ä¸ªè¡¨æ˜¯éå¸¸å®¹æ˜“çš„ã€‚ MySQL è§¦å‘å™¨ä¸æ”¯æŒ call è¯­å¥ï¼Œæ— æ³•ä»è§¦å‘å™¨å†…è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ã€‚ æ€»ä½“æ¥è¯´ï¼Œè§¦å‘å™¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼ŒMySQL ä¼šæŒ‰ç…§ä»¥ä¸‹æ–¹å¼æ¥å¤„ç†é”™è¯¯ã€‚ è‹¥å¯¹äºäº‹åŠ¡æ€§è¡¨ï¼Œå¦‚æœè§¦å‘ç¨‹åºå¤±è´¥ï¼Œä»¥åŠç”±æ­¤å¯¼è‡´çš„æ•´ä¸ªè¯­å¥å¤±è´¥ï¼Œé‚£ä¹ˆè¯¥è¯­å¥æ‰€æ‰§è¡Œçš„æ‰€æœ‰æ›´æ”¹å°†å›æ»šï¼›å¯¹äºéäº‹åŠ¡æ€§è¡¨ï¼Œåˆ™ä¸èƒ½æ‰§è¡Œæ­¤ç±»å›æ»šï¼Œå³ä½¿è¯­å¥å¤±è´¥ï¼Œå¤±è´¥ä¹‹å‰æ‰€åšçš„ä»»ä½•æ›´æ”¹ä¾ç„¶æœ‰æ•ˆã€‚ è‹¥ BEFORE è§¦å‘ç¨‹åºå¤±è´¥ï¼Œåˆ™ MySQL å°†ä¸æ‰§è¡Œç›¸åº”è¡Œä¸Šçš„æ“ä½œã€‚ è‹¥åœ¨ BEFORE æˆ– AFTER è§¦å‘ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œåˆ™å°†å¯¼è‡´è°ƒç”¨è§¦å‘ç¨‹åºçš„æ•´ä¸ªè¯­å¥å¤±è´¥ã€‚ ä»…å½“ BEFORE è§¦å‘ç¨‹åºå’Œè¡Œæ“ä½œå‡å·²è¢«æˆåŠŸæ‰§è¡Œï¼ŒMySQL æ‰ä¼šæ‰§è¡ŒAFTERè§¦å‘ç¨‹åºã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"MySQL","slug":"MySQL","permalink":"https://www.codetool.top/tags/MySQL/"}]},{"title":"MySQLå›é¡¾-çº¦æŸã€å¸¸ç”¨å‡½æ•°å’Œè§†å›¾","slug":"MySQLå›é¡¾-çº¦æŸã€å¸¸ç”¨å‡½æ•°å’Œè§†å›¾","date":"2020-03-02T10:35:41.000Z","updated":"2020-03-02T15:04:04.361Z","comments":true,"path":"article/MySQLå›é¡¾-çº¦æŸã€å¸¸ç”¨å‡½æ•°å’Œè§†å›¾/","link":"","permalink":"https://www.codetool.top/article/MySQL%E5%9B%9E%E9%A1%BE-%E7%BA%A6%E6%9D%9F%E3%80%81%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%E5%92%8C%E8%A7%86%E5%9B%BE/","excerpt":"","text":"1 çº¦æŸ ä¸»é”®çº¦æŸï¼šä¸å…è®¸é‡å¤è®°å½•ï¼Œé¿å…æ•°æ®å†—ä½™ å¤–é”®çº¦æŸï¼šä¿è¯æœ¬äº‹åŠ¡æ‰€å…³è”çš„å…¶ä»–äº‹åŠ¡æ˜¯å­˜åœ¨çš„ï¼ˆä¸»é”®è¡¨ä¸­çš„è¿™ä¸ªå­—æ®µï¼‰ å®é™…å¼€å‘ä¸­é€šå¸¸ä¸ä½¿ç”¨å¤–é”®çº¦æŸï¼Œå½±å“æ•ˆç‡ã€‚ checkçº¦æŸï¼šé™åˆ¶å€¼åœ¨æŸä¸€ä¸ªèŒƒå›´ä¹‹å†… defaultçº¦æŸï¼š ç¡®å®šé»˜è®¤å€¼( å¯ä»¥æ›´æ”¹) ä¿è¯äº‹åŠ¡çš„æŸä¸ªå±æ€§ä¸€å®šä¼šæœ‰ä¸€ä¸ªå€¼ uniqueçº¦æŸï¼šå”¯ä¸€é”®ï¼Œä¸å¯é‡å¤ï¼Œä½†å…è®¸ä¸ºç©º unique å’Œ not null å¯ä»¥ç»„åˆä½¿ç”¨ï¼Œé¡ºåºä»»æ„ã€‚ ä¸»é”®å’Œå”¯ä¸€é”®çš„å…³ç³»ï¼šä¸è¦ç”¨ä¸šåŠ¡é€»è¾‘å­—æ®µå½“åšä¸»é”®ï¼Œåº”æ·»åŠ ä¸€ä¸ªæ²¡æœ‰ä»»ä½•å®é™…æ„ä¹‰çš„å­—æ®µï¼ˆä»£ç†ä¸»é”®ï¼‰å½“åšä¸»é”®ã€‚ not nullçº¦æŸ è¦æ±‚ç”¨æˆ·å¿…é¡»ä¸ºè¯¥å­—æ®µèµ‹ä¸€ä¸ªå€¼ï¼Œå¦åˆ™å‡ºé”™ 2 MySQLå¸¸ç”¨å‡½æ•°2.1 æ–‡æœ¬å¤„ç†å‡½æ•° LEFT(x,len) è¿”å›ä¸²å·¦è¾¹æŒ‡å®šé•¿åº¦çš„å­—ä¸²ï¼ˆé•¿åº¦ä¸º lenï¼‰ RIGHT(x,len) è¿”å›ä¸²å³è¾¹æŒ‡å®šé•¿åº¦çš„å­—ä¸²ï¼ˆé•¿åº¦ä¸º lenï¼‰ LENGTH(x)/CHAR_LENGTH(str) â€“ è¿”å›ä¸²çš„é•¿åº¦ LOCATE(x,sub_x) â€“ æ‰¾å‡ºä¸²çš„ä¸€ä¸ªå­ä¸² SUBSTRING(x, from, to) è¿”å›å­å­—ç¬¦ä¸² LOWER(x) å…¨éƒ¨è½¬å°å†™ UPPER(x) å…¨éƒ¨è½¬å¤§å†™ LTRIM(x) å·¦è¾¹æ‰€æœ‰çš„ç©ºæ ¼è¢«åˆ é™¤ RTRIM(x) å³è¾¹æ‰€æœ‰çš„ç©ºæ ¼è¢«åˆ é™¤ TRIM(x) åˆ é™¤ä¸¤è¾¹çš„ç©ºæ ¼ CONCAT(s1,s2â€¦sn) å­—ç¬¦ä¸² s1,s2 ç­‰å¤šä¸ªå­—ç¬¦ä¸²åˆå¹¶ä¸ºä¸€ä¸ªå­—ç¬¦ä¸² 2.2 æ—¥æœŸæ—¶é—´å¤„ç†å‡½æ•° CURDATE()/CURRENT_DATE() è¿”å›å½“å‰æ—¥æœŸï¼Œæ ¼å¼2019-02-19 CURTIME()/CURRENT_TIME() è¿”å›å½“å‰æ—¶é—´ï¼Œæ ¼å¼11:40:45 CURRENT_TIMESTAMP() è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´ï¼Œæ ¼å¼2019-02-19 11:41:32 ADDDATE(d,n) è®¡ç®—èµ·å§‹æ—¥æœŸ d åŠ ä¸Š n å¤©çš„æ—¥æœŸ ADDTIME(t,n) æ—¶é—´ t åŠ ä¸Š n ç§’çš„æ—¶é—´ DATE(str) ä»æ—¥æœŸæˆ–æ—¥æœŸæ—¶é—´è¡¨è¾¾å¼ä¸­æå–æ—¥æœŸå€¼ DAY(d) è¿”å›æ—¥æœŸå€¼ d çš„æ—¥æœŸéƒ¨åˆ†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨EXTRACT(type FROM d) typeå¯ä»¥å–MONTH,DAY,HOUR,MINUTEç­‰ DATEDIFF(d1,d2) è®¡ç®—æ—¥æœŸd1-&gt;d2ä¹‹é—´ç›¸éš”çš„å¤©æ•° DATE_FORMAT(d,f) DATE_FORMATæŒ‰è¡¨è¾¾å¼ fçš„è¦æ±‚æ˜¾ç¤ºæ—¥æœŸ d DAYOFMONTH(d) è®¡ç®—æ—¥æœŸ d æ˜¯æœ¬æœˆçš„ç¬¬å‡ å¤© DAYOFWEEK(d) æ—¥æœŸ d ä»Šå¤©æ˜¯æ˜ŸæœŸå‡ ï¼Œ1 æ˜ŸæœŸæ—¥ï¼Œ2 æ˜ŸæœŸä¸€ï¼Œä»¥æ­¤ç±»æ¨ DAYOFYEAR(d) è®¡ç®—æ—¥æœŸ d æ˜¯æœ¬å¹´çš„ç¬¬å‡ å¤© UNIX_TIMESTAMP() å¾—åˆ°æ—¶é—´æˆ³ FROM_UNIXTIME() æ—¶é—´æˆ³è½¬æ—¥æœŸ 2.3 æ•°å€¼å¤„ç†å‡½æ•° ABS(x) è¿”å›ç»å¯¹å€¼ AVG(expression) è¿”å›ä¸€ä¸ªè¡¨è¾¾å¼çš„å¹³å‡å€¼ï¼Œexpressionæ˜¯ä¸€ä¸ªå­—æ®µ EXP(x) è¿”å›eçš„xæ¬¡æ–¹ CEIL(x)/FLOOR(x) å‘ä¸Šå–æ•´ã€å‘ä¸‹å–æ•´ MOD()ï¼ˆå–ä½™ï¼‰ PI() åœ†å‘¨ç‡ RAND() è¿”å›0åˆ°1çš„éšæœºæ•° SQRT(x) è¿”å›xçš„å¹³æ–¹æ ¹ ROUND(x) è¿”å›ç¦» x æœ€è¿‘çš„æ•´æ•° 3 è§†å›¾è§†å›¾æ˜¯è™šæ‹Ÿçš„è¡¨ï¼Œä¸åŒ…å«æ•°æ®çš„è¡¨ä¸åŒï¼Œè§†å›¾åªåŒ…å«ä½¿ç”¨æ—¶åŠ¨æ€æ£€ç´¢æ•°æ®çš„æŸ¥è¯¢,ä¸»è¦æ˜¯ç”¨äºæŸ¥è¯¢ã€‚ 3.1 ä¸ºä»€ä¹ˆä½¿ç”¨è§†å›¾ é‡ç”¨ sql è¯­å¥ ç®€åŒ–å¤æ‚çš„ sql æ“ä½œï¼Œåœ¨ç¼–å†™æŸ¥è¯¢åï¼Œå¯ä»¥æ–¹ä¾¿åœ°é‡ç”¨å®ƒè€Œä¸å¿…çŸ¥é“ä»–çš„åŸºæœ¬æŸ¥è¯¢ç»†èŠ‚ã€‚ ä½¿ç”¨è¡¨çš„ç»„æˆéƒ¨åˆ†è€Œä¸æ˜¯æ•´ä¸ªè¡¨ã€‚ ä¿æŠ¤æ•°æ®ã€‚å¯ä»¥ç»™ç”¨æˆ·æˆäºˆè¡¨çš„ç‰¹å®šéƒ¨åˆ†çš„è®¿é—®æƒé™è€Œä¸æ˜¯æ•´ä¸ªè¡¨çš„è®¿é—®æƒé™ã€‚ æ›´æ”¹æ•°æ®æ ¼å¼å’Œè¡¨ç¤ºã€‚è§†å›¾å¯è¿”å›ä¸åº•å±‚è¡¨çš„è¡¨ç¤ºå’Œæ ¼å¼ä¸åŒçš„æ•°æ®ã€‚ æ³¨æ„ï¼š åœ¨è§†å›¾åˆ›å»ºä¹‹åï¼Œå¯ä»¥ç”¨ä¸è¡¨åŸºæœ¬ç›¸åŒçš„æ–¹å¼åˆ©ç”¨å®ƒä»¬ã€‚å¯ä»¥å¯¹è§†å›¾æ‰§è¡Œ select æ“ä½œï¼Œè¿‡æ»¤å’Œæ’åºæ•°æ®ï¼Œå°†è§†å›¾è”ç»“åˆ°å…¶ä»–è§†å›¾æˆ–è¡¨ï¼Œç”šè‡³èƒ½æ·»åŠ å’Œæ›´æ–°æ•°æ®ã€‚ é‡è¦çš„æ˜¯çŸ¥é“è§†å›¾ä»…ä»…æ˜¯ç”¨æ¥æŸ¥çœ‹å­˜å‚¨åœ¨åˆ«å¤„çš„æ•°æ®çš„ä¸€ç§è®¾æ–½ã€‚è§†å›¾æœ¬èº«ä¸åŒ…å«æ•°æ®ï¼Œå› æ­¤å®ƒä»¬è¿”å›çš„æ•°æ®æ—¶ä»å…¶ä»–è¡¨ä¸­æ£€ç´¢å‡ºæ¥çš„ã€‚åœ¨æ·»åŠ å’Œæ›´æ”¹è¿™äº›è¡¨ä¸­çš„æ•°æ®æ—¶ï¼Œè§†å›¾å°†è¿”å›æ”¹å˜è¿‡çš„æ•°æ®ã€‚ å› ä¸ºè§†å›¾ä¸åŒ…å«æ•°æ®ï¼Œæ‰€ä»¥æ¯æ¬¡ä½¿ç”¨è§†å›¾æ—¶ï¼Œéƒ½å¿…é¡»å¤„ç†æŸ¥è¯¢æ‰§è¡Œæ—¶æ‰€éœ€çš„ä»»ä¸€æ£€ç´¢ã€‚å¦‚æœä½ ä½¿ç”¨å¤šä¸ªè¿æ¥å’Œè¿‡æ»¤åˆ›å»ºäº†å¤æ‚çš„è§†å›¾æˆ–è€…åµŒå¥—äº†è§†å›¾ï¼Œå¯èƒ½ä¼šå‘ç°æ€§èƒ½ä¸‹é™å¾—å¾ˆå‰å®³ã€‚å› æ­¤ï¼Œåœ¨éƒ¨ç½²ä½¿ç”¨äº†å¤§é‡è§†å›¾çš„åº”ç”¨å‰ï¼Œåº”è¯¥è¿›è¡Œæµ‹è¯•ã€‚ 3.2 è§†å›¾çš„è§„åˆ™å’Œé™åˆ¶ ä¸è¡¨ä¸€æ ·ï¼Œè§†å›¾å¿…é¡»å”¯ä¸€å‘½åï¼› å¯ä»¥åˆ›å»ºä»»æ„å¤šçš„è§†å›¾ï¼› ä¸ºäº†åˆ›å»ºè§†å›¾ï¼Œå¿…é¡»å…·æœ‰è¶³å¤Ÿçš„è®¿é—®æƒé™ã€‚è¿™äº›é™åˆ¶é€šå¸¸ç”±æ•°æ®åº“ç®¡ç†äººå‘˜æˆäºˆã€‚ è§†å›¾å¯ä»¥åµŒå¥—ï¼Œå¯ä»¥åˆ©ç”¨ä»å…¶ä»–è§†å›¾ä¸­æ£€ç´¢æ•°æ®çš„æŸ¥è¯¢æ¥æ„é€ ä¸€ä¸ªè§†å›¾ã€‚ Order by å¯ä»¥åœ¨è§†å›¾ä¸­ä½¿ç”¨ï¼Œä½†å¦‚æœä»è¯¥è§†å›¾æ£€ç´¢æ•°æ® select ä¸­ä¹Ÿæ˜¯å«æœ‰ order byï¼Œé‚£ä¹ˆè¯¥è§†å›¾çš„ order by å°†è¢«è¦†ç›–ã€‚ è§†å›¾ä¸èƒ½ç´¢å¼•ï¼Œä¹Ÿä¸èƒ½æœ‰å…³è”çš„è§¦å‘å™¨æˆ–é»˜è®¤å€¼ è§†å›¾å¯ä»¥å’Œè¡¨ä¸€èµ·ä½¿ç”¨ 3.3 è§†å›¾æ“ä½œçš„SQLè¯­å¥ åˆ©ç”¨ create view view_name as æŸ¥è¯¢è¯­å¥ è¯­å¥æ¥è¿›è¡Œåˆ›å»ºè§†å›¾ ä½¿ç”¨ show create view view_name æ¥æŸ¥çœ‹åˆ›å»ºè§†å›¾çš„è¯­å¥ ç”¨ drop view view_name æ¥åˆ é™¤è§†å›¾ æ›´æ–°è§†å›¾å¯ä»¥å…ˆ drop å† createï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ create or replace view_name as ...ã€‚ 3.4 è§†å›¾çš„æ›´æ–°è§†å›¾æ˜¯å¦å¯ä»¥æ›´æ–°ï¼Œè¦è§†æƒ…å†µè€Œå®šã€‚ é€šå¸¸æƒ…å†µä¸‹è§†å›¾æ˜¯å¯ä»¥æ›´æ–°çš„ï¼Œå¯ä»¥å¯¹ä»–ä»¬è¿›è¡Œ insertï¼Œupdate å’Œ deleteã€‚æ›´æ–°è§†å›¾å°±æ˜¯æ›´æ–°å…¶åŸºè¡¨(è§†å›¾æœ¬èº«æ²¡æœ‰æ•°æ®)ã€‚å¦‚æœä½ å¯¹è§†å›¾è¿›è¡Œå¢åŠ æˆ–è€…åˆ é™¤è¡Œï¼Œå®é™…ä¸Šå°±æ˜¯å¯¹åŸºè¡¨è¿›è¡Œå¢åŠ æˆ–è€…åˆ é™¤è¡Œã€‚ ä½†æ˜¯ï¼Œå¦‚æœ MySQL ä¸èƒ½æ­£ç¡®çš„ç¡®å®šæ›´æ–°çš„åŸºè¡¨æ•°æ®ï¼Œåˆ™ä¸å…è®¸æ›´æ–°(åŒ…æ‹¬æ’å…¥å’Œåˆ é™¤)ï¼Œè¿™å°±æ„å‘³ç€è§†å›¾ä¸­å¦‚æœå­˜åœ¨ä»¥ä¸‹æ“ä½œåˆ™ä¸èƒ½å¯¹è§†å›¾è¿›è¡Œæ›´æ–°ï¼š åˆ†ç»„(ä½¿ç”¨ group by å’Œhaving ) è”ç»“ å­æŸ¥è¯¢ å¹¶ èšé›†å‡½æ•° dictinct å¯¼å‡º(è®¡ç®—)åˆ— ä¸æ¨èæ›´æ”¹è§†å›¾ï¼Œä¼šä½¿å¾—ä¸šåŠ¡é€»è¾‘æ··æ·†ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"MySQL","slug":"MySQL","permalink":"https://www.codetool.top/tags/MySQL/"}]},{"title":"leetcode35-æœç´¢æ’å…¥ä½ç½®","slug":"leetcode35-æœç´¢æ’å…¥ä½ç½®","date":"2020-03-01T17:09:30.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode35-æœç´¢æ’å…¥ä½ç½®/","link":"","permalink":"https://www.codetool.top/article/leetcode35-%E6%90%9C%E7%B4%A2%E6%8F%92%E5%85%A5%E4%BD%8D%E7%BD%AE/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ’åºæ•°ç»„å’Œä¸€ä¸ªç›®æ ‡å€¼ï¼Œåœ¨æ•°ç»„ä¸­æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œå¹¶è¿”å›å…¶ç´¢å¼•ã€‚å¦‚æœç›®æ ‡å€¼ä¸å­˜åœ¨äºæ•°ç»„ä¸­ï¼Œè¿”å›å®ƒå°†ä¼šè¢«æŒ‰é¡ºåºæ’å…¥çš„ä½ç½®ã€‚ ä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸­æ— é‡å¤å…ƒç´ ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: [1,3,5,6], 5è¾“å‡º: 2 ç¤ºä¾‹ 2: è¾“å…¥: [1,3,5,6], 2è¾“å‡º: 1 ç¤ºä¾‹ 3: è¾“å…¥: [1,3,5,6], 7è¾“å‡º: 4 ç¤ºä¾‹ 4: è¾“å…¥: [1,3,5,6], 0è¾“å‡º: 0 2 è§£æ³•2.1 æ€æƒ³äºŒåˆ†æŸ¥æ‰¾ 2.2 ä»£ç class Solution { public int searchInsert(int[] nums, int target) { int left = 0; int right = nums.length; int mid; while(left&lt;right-1){ mid = (left+right)/2; if(nums[mid] == target) return mid; else if(nums[mid] &lt; target) left = mid; else if(nums[mid] > target) right = mid; } if(nums[left]>=target) return left; return left+1; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"Redisé€šç”¨æŒ‡ä»¤å’ŒJedisä½¿ç”¨","slug":"Redisé€šç”¨æŒ‡ä»¤å’ŒJedisä½¿ç”¨","date":"2020-03-01T15:48:46.000Z","updated":"2020-03-02T14:59:11.948Z","comments":true,"path":"article/Redisé€šç”¨æŒ‡ä»¤å’ŒJedisä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/Redis%E9%80%9A%E7%94%A8%E6%8C%87%E4%BB%A4%E5%92%8CJedis%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 keyé€šç”¨æŒ‡ä»¤å¸¸ç”¨æ“ä½œ del key åˆ é™¤æŒ‡å®škey exists key è·å–keyæ˜¯å¦å­˜åœ¨ type key è·å–keyçš„ç±»å‹ key æ—¶æ•ˆæ€§æ§åˆ¶ expire key seconds è®¾ç½®è¿‡æœŸæ—¶é—´ pexpire key milliseconds ï¼ˆæ¯«ç§’ç‰ˆï¼‰ expireat key timestampï¼ˆä½¿ç”¨æ—¶é—´æˆ³ç‰ˆï¼‰ pexpireat key milliseconds-timestamp ttl key è·å–è¿‡æœŸæ—¶é—´ï¼ˆä¸å­˜åœ¨è¿”å›-2ï¼Œæ°¸ä¹…è¿”å›-1ï¼‰ pttl key ï¼ˆæ¯«ç§’ç‰ˆï¼‰ persist key å°†keyä»æ—¶æ•ˆæ€§è½¬æ¢ä¸ºæ°¸ä¹…æ€§ key æŸ¥è¯¢æ“ä½œ keys patternï¼šæŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰keyï¼Œpatternçš„è§„åˆ™ï¼š *åŒ¹é…ä»»æ„æ•°é‡çš„ä»»æ„ç¬¦å· ?åŒ¹é…ä¸€ä¸ªä»»æ„ç¬¦å· []åŒ¹é…æ‹¬å·å†…çš„ä»»æ„ä¸€ä¸ªç¬¦å· key å…¶ä»–æ“ä½œ renane key newkey é‡å‘½åkey renamenx key newkey å¦‚æœæ–°åå­—ä¸å­˜åœ¨æ‰ä¼šé‡å‘½å sort å¯¹é›†åˆä¸­æ‰€æœ‰valueæ’åºï¼Œåªèƒ½æ’listæˆ–set 2 æ•°æ®åº“é€šç”¨æ“ä½œredisä¸ºæ¯ä¸ªæœåŠ¡æä¾›æœ‰16ä¸ªæ•°æ®åº“ï¼Œç¼–å·ä»0åˆ°15ï¼Œæ¯ä¸ªæ•°æ®åº“ä¹‹é—´çš„æ•°æ®ç›¸äº’ç‹¬ç«‹ select index åˆ‡æ¢æ•°æ®åº“ move key db å°†æŸä¸ªé”®ç§»å…¥å…¶ä»–æ•°æ®åº“ä¸­ dbsize å½“å‰dbé”®çš„ä¸ªæ•° flushdb æ¸…ç©ºå½“å‰æ•°æ®åº“ flushall æ¸…ç©ºæ‰€æœ‰æ•°æ®åº“ 3 Jedis3.1 åŸºæœ¬ä½¿ç”¨æ–¹æ³•åå’ŒæŒ‡ä»¤åä¸€è‡´ã€‚ //1.è¿æ¥redis Jedis jedis = new Jedis(\"127.0.0.1\", 6379); //2.æ“ä½œredis jedis.set(\"name\",\"rhett\"); String name = jedis.get(\"name\"); System.out.println(name); //3.å…³é—­è¿æ¥ jedis.close(); æ³¨æ„æ–¹æ³•çš„è¿”å›å€¼ //1.è¿æ¥redis Jedis jedis = new Jedis(\"127.0.0.1\", 6379); //2.æ“ä½œredis //å­—ç¬¦ä¸² jedis.set(\"name\",\"rhett\"); String name = jedis.get(\"name\"); //list jedis.lpush(\"list1\",\"a\",\"b\",\"c\"); jedis.rpush(\"list1\",\"d\"); List&lt;String> list1 = jedis.lrange(\"list1\", 0, -1); list1.forEach(e-> System.out.println(e)); //set jedis.hset(\"hash1\",\"a1\",\"a1\"); jedis.hset(\"hash1\",\"a2\",\"a2\"); jedis.hset(\"hash1\",\"a3\",\"a3\"); //hash Map&lt;String, String> hash1 = jedis.hgetAll(\"hash1\"); hash1.forEach((k,v)-> System.out.println(k+\":\"+v)); Set&lt;String> keys = jedis.keys(\"*\"); keys.forEach(e-> System.out.println(e)); //set jedis.sadd(\"set1\",\"50\"); jedis.sadd(\"set1\",\"10\"); jedis.sadd(\"set1\",\"30\"); Set&lt;String> set1 = jedis.smembers(\"set1\"); set1.forEach(e-> System.out.println(e)); //3.å…³é—­è¿æ¥ jedis.close(); incræ“ä½œè¿”å›çš„æ˜¯Long 3.2 è¿æ¥æ± JedisPool:Jedisæä¾›çš„è¿æ¥æ± æŠ€æœ¯ åŸºäºè¿æ¥æ± çš„å·¥å‚ç±»çš„ç¼–å†™ï¼š public class JedisUtils { private static JedisPool jp = null; private static String host; private static int port; private static int maxTotal; private static int maxIdle; static { ResourceBundle rb = ResourceBundle.getBundle(\"redis\"); host = rb.getString(\"redis.host\"); port = Integer.parseInt(rb.getString(\"redis.port\")); maxTotal = Integer.parseInt(rb.getString(\"redis.maxTotal\")); maxIdle = Integer.parseInt(rb.getString(\"redis.maxIdle\")); JedisPoolConfig jpc = new JedisPoolConfig(); jpc.setMaxTotal(maxTotal); jpc.setMaxIdle(maxIdle); jp = new JedisPool(jpc,host,port); } public static Jedis getJedis(){ return jp.getResource(); } } redis.properties: redis.host=127.0.0.1 redis.port=6379 redis.maxTotal=30 redis.maxIdle=10 4 Rediså¯è§†åŒ–ç®¡ç†å·¥å…·Redis Desktop Manager","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"https://www.codetool.top/tags/Redis/"}]},{"title":"è“æ¡¥æ¯è¯•é¢˜-ç¿»ç¡¬å¸","slug":"è“æ¡¥æ¯è¯•é¢˜-ç¿»ç¡¬å¸","date":"2020-03-01T14:36:17.000Z","updated":"2020-04-30T05:51:57.429Z","comments":true,"path":"article/è“æ¡¥æ¯è¯•é¢˜-ç¿»ç¡¬å¸/","link":"","permalink":"https://www.codetool.top/article/%E8%93%9D%E6%A1%A5%E6%9D%AF%E8%AF%95%E9%A2%98-%E7%BF%BB%E7%A1%AC%E5%B8%81/","excerpt":"","text":"1 åŸé¢˜èµ„æºé™åˆ¶ æ—¶é—´é™åˆ¶ï¼š1.0s å†…å­˜é™åˆ¶ï¼š256.0MB é—®é¢˜æè¿° å°æ˜æ­£åœ¨ç©ä¸€ä¸ªâ€œç¿»ç¡¬å¸â€çš„æ¸¸æˆã€‚ æ¡Œä¸Šæ”¾ç€æ’æˆä¸€æ’çš„è‹¥å¹²ç¡¬å¸ã€‚æˆ‘ä»¬ç”¨ * è¡¨ç¤ºæ­£é¢ï¼Œç”¨ o è¡¨ç¤ºåé¢ï¼ˆæ˜¯å°å†™å­—æ¯ï¼Œä¸æ˜¯é›¶ï¼‰ã€‚ æ¯”å¦‚ï¼Œå¯èƒ½æƒ…å½¢æ˜¯ï¼š**oo***oooo å¦‚æœåŒæ—¶ç¿»è½¬å·¦è¾¹çš„ä¸¤ä¸ªç¡¬å¸ï¼Œåˆ™å˜ä¸ºï¼šoooo***oooo ç°åœ¨å°æ˜çš„é—®é¢˜æ˜¯ï¼šå¦‚æœå·²çŸ¥äº†åˆå§‹çŠ¶æ€å’Œè¦è¾¾åˆ°çš„ç›®æ ‡çŠ¶æ€ï¼Œæ¯æ¬¡åªèƒ½åŒæ—¶ç¿»è½¬ç›¸é‚»çš„ä¸¤ä¸ªç¡¬å¸,é‚£ä¹ˆå¯¹ç‰¹å®šçš„å±€é¢ï¼Œæœ€å°‘è¦ç¿»åŠ¨å¤šå°‘æ¬¡å‘¢ï¼Ÿ æˆ‘ä»¬çº¦å®šï¼šæŠŠç¿»åŠ¨ç›¸é‚»çš„ä¸¤ä¸ªç¡¬å¸å«åšä¸€æ­¥æ“ä½œï¼Œé‚£ä¹ˆè¦æ±‚ï¼š è¾“å…¥æ ¼å¼ ä¸¤è¡Œç­‰é•¿çš„å­—ç¬¦ä¸²ï¼Œåˆ†åˆ«è¡¨ç¤ºåˆå§‹çŠ¶æ€å’Œè¦è¾¾åˆ°çš„ç›®æ ‡çŠ¶æ€ã€‚æ¯è¡Œçš„é•¿åº¦&lt;1000 è¾“å‡ºæ ¼å¼ ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å°æ“ä½œæ­¥æ•°ã€‚ æ ·ä¾‹è¾“å…¥1 **********o****o**** æ ·ä¾‹è¾“å‡º1 5 æ ·ä¾‹è¾“å…¥2 *o**o***o****o***o**o*** æ ·ä¾‹è¾“å‡º2 1 2 è§£æ³•2.1 æ€æƒ³å¦‚æœç¿»åŠ¨çš„æ¬¡æ•°æœ€å°‘ï¼Œä¸€å®šæ˜¯ä»å·¦ç¿»åˆ°å³ï¼Œè¿™é“é¢˜ç¬¦åˆè´ªå¿ƒæ³• 2.2 ä»£ç import java.util.*; public class Main{ public static void main(String[] args) { Scanner scanner = new Scanner(System.in); char[] source = scanner.next().toCharArray(); char[] target = scanner.next().toCharArray(); int ans = 0; for(int i = 0;i&lt;source.length;i++){ if(source[i]!=target[i]){ if(source[i]=='*')source[i] = 'o'; else if(source[i]=='o')source[i] = '*'; if(source[i+1]=='*')source[i+1] = 'o'; else if(source[i+1]=='o')source[i+1] = '*'; ans++; } } System.out.println(ans); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"è“æ¡¥æ¯","slug":"è“æ¡¥æ¯","permalink":"https://www.codetool.top/tags/%E8%93%9D%E6%A1%A5%E6%9D%AF/"}]},{"title":"è“æ¡¥æ¯è¯•é¢˜-å“ˆå¤«æ›¼æ ‘","slug":"è“æ¡¥æ¯è¯•é¢˜-å“ˆå¤«æ›¼æ ‘","date":"2020-03-01T14:28:31.000Z","updated":"2020-04-30T05:53:27.288Z","comments":true,"path":"article/è“æ¡¥æ¯è¯•é¢˜-å“ˆå¤«æ›¼æ ‘/","link":"","permalink":"https://www.codetool.top/article/%E8%93%9D%E6%A1%A5%E6%9D%AF%E8%AF%95%E9%A2%98-%E5%93%88%E5%A4%AB%E6%9B%BC%E6%A0%91/","excerpt":"","text":"1 åŸé¢˜Description Huffmanæ ‘åœ¨ç¼–ç ä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åªå…³å¿ƒHuffmanæ ‘çš„æ„é€ è¿‡ç¨‹ã€‚ ç»™å‡ºä¸€åˆ—æ•°{pi}={p0, p1, â€¦, pn-1}ï¼Œç”¨è¿™åˆ—æ•°æ„é€ Huffmanæ ‘çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š æ‰¾åˆ°{pi}ä¸­æœ€å°çš„ä¸¤ä¸ªæ•°ï¼Œè®¾ä¸ºpaå’Œpbï¼Œå°†paå’Œpbä»{pi}ä¸­åˆ é™¤æ‰ï¼Œç„¶åå°†å®ƒä»¬çš„å’ŒåŠ å…¥åˆ°{pi}ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹çš„è´¹ç”¨è®°ä¸ºpa+ pbã€‚ é‡å¤æ­¥éª¤1ï¼Œç›´åˆ°{pi}ä¸­åªå‰©ä¸‹ä¸€ä¸ªæ•°ã€‚ åœ¨ä¸Šé¢çš„æ“ä½œè¿‡ç¨‹ä¸­ï¼ŒæŠŠæ‰€æœ‰çš„è´¹ç”¨ç›¸åŠ ï¼Œå°±å¾—åˆ°äº†æ„é€ Huffmanæ ‘çš„æ€»è´¹ç”¨ã€‚ æœ¬é¢˜ä»»åŠ¡ï¼šå¯¹äºç»™å®šçš„ä¸€ä¸ªæ•°åˆ—ï¼Œç°åœ¨è¯·ä½ æ±‚å‡ºç”¨è¯¥æ•°åˆ—æ„é€ Huffmanæ ‘çš„æ€»è´¹ç”¨ã€‚ ä¾‹å¦‚ï¼Œå¯¹äºæ•°åˆ—{pi}={5, 3, 8, 2, 9}ï¼ŒHuffmanæ ‘çš„æ„é€ è¿‡ç¨‹å¦‚ä¸‹ï¼š æ‰¾åˆ°{5, 3, 8, 2, 9}ä¸­æœ€å°çš„ä¸¤ä¸ªæ•°ï¼Œåˆ†åˆ«æ˜¯2å’Œ3ï¼Œä»{pi}ä¸­åˆ é™¤å®ƒä»¬å¹¶å°†å’Œ5åŠ å…¥ï¼Œå¾—åˆ°{5, 8, 9, 5}ï¼Œè´¹ç”¨ä¸º5ã€‚ æ‰¾åˆ°{5, 8, 9, 5}ä¸­æœ€å°çš„ä¸¤ä¸ªæ•°ï¼Œåˆ†åˆ«æ˜¯5å’Œ5ï¼Œä»{pi}ä¸­åˆ é™¤å®ƒä»¬å¹¶å°†å’Œ10åŠ å…¥ï¼Œå¾—åˆ°{8, 9, 10}ï¼Œè´¹ç”¨ä¸º10ã€‚ æ‰¾åˆ°{8, 9, 10}ä¸­æœ€å°çš„ä¸¤ä¸ªæ•°ï¼Œåˆ†åˆ«æ˜¯8å’Œ9ï¼Œä»{pi}ä¸­åˆ é™¤å®ƒä»¬å¹¶å°†å’Œ17åŠ å…¥ï¼Œå¾—åˆ°{10, 17}ï¼Œè´¹ç”¨ä¸º17ã€‚ æ‰¾åˆ°{10, 17}ä¸­æœ€å°çš„ä¸¤ä¸ªæ•°ï¼Œåˆ†åˆ«æ˜¯10å’Œ17ï¼Œä»{pi}ä¸­åˆ é™¤å®ƒä»¬å¹¶å°†å’Œ27åŠ å…¥ï¼Œå¾—åˆ°{27}ï¼Œè´¹ç”¨ä¸º27ã€‚ ç°åœ¨ï¼Œæ•°åˆ—ä¸­åªå‰©ä¸‹ä¸€ä¸ªæ•°27ï¼Œæ„é€ è¿‡ç¨‹ç»“æŸï¼Œæ€»è´¹ç”¨ä¸º5+10+17+27=59ã€‚ Input è¾“å…¥çš„ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ­£æ•´æ•°nï¼ˆn&lt;=100ï¼‰ã€‚ æ¥ä¸‹æ¥æ˜¯nä¸ªæ­£æ•´æ•°ï¼Œè¡¨ç¤ºp0, p1, â€¦, pn-1ï¼Œæ¯ä¸ªæ•°ä¸è¶…è¿‡1000ã€‚ Output è¾“å‡ºç”¨è¿™äº›æ•°æ„é€ Huffmanæ ‘çš„æ€»è´¹ç”¨ã€‚ Sample Input 1 55 3 8 2 9 Sample Output 1 59 Hint HINT:æ—¶é—´é™åˆ¶ï¼š1.0s å†…å­˜é™åˆ¶ï¼š512.0MB 2 è§£æ³•2.1 æ€æƒ³ç”¨ä¸€ä¸ªæœ€å°å †ï¼Œæ¯æ¬¡å¼¹å‡ºä¸¤ä¸ªä¸¤ä¸ªæœ€å°æ•°ç„¶åæŠŠå’Œå†æ”¾å…¥å †ä¸­ã€‚ 2.2 ä»£ç import java.util.*; public class Main{ public static void main(String[] args) { Scanner scanner = new Scanner(System.in); int count = scanner.nextInt(); Queue&lt;Integer> queue = new PriorityQueue&lt;>(); for(int i = 0;i&lt;count;i++){ queue.add(scanner.nextInt()); } int sum = 0; while(queue.size()!=1){ int cost = queue.poll()+queue.poll(); sum += cost; queue.offer(cost); } System.out.println(sum); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"è“æ¡¥æ¯","slug":"è“æ¡¥æ¯","permalink":"https://www.codetool.top/tags/%E8%93%9D%E6%A1%A5%E6%9D%AF/"}]},{"title":"leetcode99-æ¢å¤äºŒå‰æœç´¢æ ‘","slug":"leetcode99-æ¢å¤äºŒå‰æœç´¢æ ‘","date":"2020-03-01T08:33:53.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode99-æ¢å¤äºŒå‰æœç´¢æ ‘/","link":"","permalink":"https://www.codetool.top/article/leetcode99-%E6%81%A2%E5%A4%8D%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/","excerpt":"","text":"1 åŸé¢˜äºŒå‰æœç´¢æ ‘ä¸­çš„ä¸¤ä¸ªèŠ‚ç‚¹è¢«é”™è¯¯åœ°äº¤æ¢ã€‚ è¯·åœ¨ä¸æ”¹å˜å…¶ç»“æ„çš„æƒ…å†µä¸‹ï¼Œæ¢å¤è¿™æ£µæ ‘ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: [1,3,null,null,2] &nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;/&nbsp;3&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;2 è¾“å‡º: [3,1,null,null,2] &nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;/&nbsp;1&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;2 ç¤ºä¾‹ 2: è¾“å…¥: [3,1,4,null,null,2] &nbsp;&nbsp;3&nbsp;/&nbsp;\\1&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;2 è¾“å‡º: [2,1,4,null,null,3] &nbsp;&nbsp;2&nbsp;/&nbsp;\\1&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;3 è¿›é˜¶: ä½¿ç”¨ O(n) ç©ºé—´å¤æ‚åº¦çš„è§£æ³•å¾ˆå®¹æ˜“å®ç°ã€‚ ä½ èƒ½æƒ³å‡ºä¸€ä¸ªåªä½¿ç”¨å¸¸æ•°ç©ºé—´çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ 2 è§£æ³•2.1 æ€æƒ³è¿™é“é¢˜å¯ä»¥ä½¿ç”¨ä¸­åºéå†å¾—åˆ°ä¸€ä¸ªåºåˆ—ï¼Œè¿™ä¸ªåºåˆ—çš„ç‰¹å¾æ˜¯ä¸€ä¸ªæœ‰åºåºåˆ—ä¸­çš„ä¸¤ä¸ªå…ƒç´ è¢«äº¤æ¢äº†ï¼Œé‚£ä¹ˆé—®é¢˜å°±å˜æˆå¦‚ä½•æ‰¾åˆ°è¿™ä¸¤ä¸ªå…ƒç´ ã€‚ çœ‹ä¸€ä¸ªä¾‹å­ï¼š 1 2 8 6 7 4 9 ï¼Œæœ‰åºåºåˆ—ä¸­çš„ä¸¤ä¸ªå…ƒç´ è¢«äº¤æ¢äº†ä¸€å®šä¼šé€ æˆä¸€ä¸ªè¾ƒå¤§çš„å…ƒç´ äº¤æ¢åˆ°äº†å‰é¢(8)ï¼Œä¸€ä¸ªè¾ƒå°çš„å…ƒç´ äº¤æ¢åˆ°äº†åé¢(4)ï¼Œä½“ç°åœ¨åºåˆ—ä¸­å°±æ˜¯ä¸¤ä¸ªå¼‚å¸¸çš„æƒ…å†µï¼š6æ¯”8å°ï¼Œ4æ¯”7å°ã€‚æ‰€ä»¥å¯ä»¥åˆ¤æ–­ï¼šç¬¬ä¸€æ¬¡å‡ºç°çš„æŸèŠ‚ç‚¹æ¯”å‰é©±èŠ‚ç‚¹çš„å€¼è¦å°çš„æƒ…å†µï¼Œå‰é©±èŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªè¢«äº¤æ¢äº†çš„èŠ‚ç‚¹ï¼Œè€Œç¬¬äºŒæ¬¡å‡ºç°çš„æŸèŠ‚ç‚¹æ¯”å‰é©±èŠ‚ç‚¹çš„å€¼è¦å°çš„æƒ…å†µï¼Œè¯¥èŠ‚ç‚¹å°±æ˜¯ç¬¬äºŒä¸ªè¢«äº¤æ¢äº†çš„èŠ‚ç‚¹ã€‚ è€Œè¿˜æœ‰ä¸€ç§å¯èƒ½æ˜¯ï¼Œä¸¤ä¸ªè¿ç»­çš„å…ƒç´ è¢«äº¤æ¢äº†ï¼Œå¦‚ï¼š1 3 2 4ï¼Œå‡ºç°çš„æƒ…å†µå°±æ˜¯åªå‡ºç°ä¸€æ¬¡æŸèŠ‚ç‚¹æ¯”å‰é©±èŠ‚ç‚¹çš„å€¼è¦å°çš„æƒ…å†µï¼Œé‚£ä¹ˆä¸¤ä¸ªè¢«äº¤æ¢çš„èŠ‚ç‚¹å°±åˆ†åˆ«æ˜¯å½“å‰èŠ‚ç‚¹(2)å’Œå…¶å‰é©±èŠ‚ç‚¹(3)ã€‚ æ‰¾åˆ°äº†è¿™ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå°±å¯ä»¥ä½¿ç”¨å€¼äº¤æ¢å°†äºŒå‰æœç´¢æ ‘æ¢å¤å›æ¥ã€‚ 2.2 ä»£ç é€’å½’ä¸­åºéå†ï¼š class Solution { TreeNode pred; TreeNode former,latter; public void recoverTree(TreeNode root) { recurTree(root); int cache = former.val; former.val = latter.val; latter.val = cache; } public void recurTree(TreeNode root){ if(root == null) return; recurTree(root.left); if(pred == null) pred = root; else if(root.val &lt; pred.val) { if(former == null) former = pred; latter = root; } pred = root; recurTree(root.right); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"å‰‘æŒ‡offer46-æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²","slug":"å‰‘æŒ‡offer46-æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²","date":"2020-02-29T15:55:26.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/å‰‘æŒ‡offer46-æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²/","link":"","permalink":"https://www.codetool.top/article/%E5%89%91%E6%8C%87offer46-%E6%8A%8A%E6%95%B0%E5%AD%97%E7%BF%BB%E8%AF%91%E6%88%90%E5%AD%97%E7%AC%A6%E4%B8%B2/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ•°å­—ï¼Œæˆ‘ä»¬æŒ‰ç…§å¦‚ä¸‹è§„åˆ™æŠŠå®ƒç¿»è¯‘ä¸ºå­—ç¬¦ä¸²ï¼š0 ç¿»è¯‘æˆ â€œaâ€ ï¼Œ1 ç¿»è¯‘æˆ â€œbâ€ï¼Œâ€¦â€¦ï¼Œ11 ç¿»è¯‘æˆ â€œlâ€ï¼Œâ€¦â€¦ï¼Œ25 ç¿»è¯‘æˆ â€œzâ€ã€‚ä¸€ä¸ªæ•°å­—å¯èƒ½æœ‰å¤šä¸ªç¿»è¯‘ã€‚è¯·ç¼–ç¨‹å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥è®¡ç®—ä¸€ä¸ªæ•°å­—æœ‰å¤šå°‘ç§ä¸åŒçš„ç¿»è¯‘æ–¹æ³•ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š 12258è¾“å‡ºï¼š 5è§£é‡Šï¼š 12258æœ‰5ç§ä¸åŒçš„ç¿»è¯‘ï¼Œåˆ†åˆ«æ˜¯â€bccfiâ€, â€œbwfiâ€, â€œbcziâ€, â€œmcfiâ€å’Œâ€mziâ€ æç¤º: 0 &lt;= num &lt; 231 2 è§£æ³•2.1 æ€æƒ³åŠ¨æ€è§„åˆ’ï¼š å¯ä»¥ä½¿ç”¨leetcode70-çˆ¬æ¥¼æ¢¯çš„æ€æƒ³ï¼Œæ¯æ¬¡ç¿»è¯‘ä¸€ä½æ•°çœ‹æˆè·³ä¸€æ­¥ï¼Œç¿»è¯‘ä¸¤ä½æ•°çœ‹æˆè·³ä¸¤æ­¥ï¼Œé‚£ä¹ˆå¯¹äºä»»æ„è¦è·³çš„ä¸€ä¸ªä½ç½®æ¥è¯´ï¼Œä¾‹å¦‚12258ä¸­çš„8ï¼Œç”±äºæœ€åä¸¤ä½æ˜¯58ä¸èƒ½ç¿»è¯‘ï¼Œä¹Ÿå°±æ˜¯åªèƒ½ç”±1225è·³è¿‡æ¥ï¼Œæ­¤æ—¶f(12258)==f(1225)ï¼Œè€Œå¯¹äº1225ï¼Œç”±äºæœ€åä¸¤ä½æ˜¯25å¯ä»¥ç¿»è¯‘ï¼Œæ‰€ä»¥å¯ä»¥ä»12è·³è¿‡æ¥ï¼Œä¹Ÿå¯ä»¥ä»122è·³è¿‡æ¥ï¼Œæ­¤æ—¶f(1225) == f(12)+f(122)ã€‚å°†è¿™ä¸¤ç§æƒ…å†µä¸€èˆ¬åŒ–å°±èƒ½å¾—å‡ºç»“è®ºï¼š 2.2 ä»£ç class Solution { public int translateNum(int num) { if(num == 0) return 1; if(num &lt; 10) return 1; int left = num%10; //å»é™¤æœ€åä¸€ä½æ•°çš„last int last = num/=10; //è®¡ç®—å‡ºæœ€åä¸¤ä½æ•°çš„å¤§å° left = 10*(num%10)+left; //å»é™¤æœ€åä¸¤ä½æ•°çš„lastOfLast int lastOfLast = num /= 10; if(left>25||left&lt;10) return translateNum(last); else return translateNum(last)+translateNum(lastOfLast); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"å‰‘æŒ‡offer","slug":"å‰‘æŒ‡offer","permalink":"https://www.codetool.top/tags/%E5%89%91%E6%8C%87offer/"}]},{"title":"Redisæ¦‚è¿°å’Œå¸¸ç”¨æ•°æ®ç±»å‹","slug":"Redisæ¦‚è¿°å’Œä½¿ç”¨","date":"2020-02-29T14:40:38.000Z","updated":"2020-04-06T14:22:48.654Z","comments":true,"path":"article/Redisæ¦‚è¿°å’Œä½¿ç”¨/","link":"","permalink":"https://www.codetool.top/article/Redis%E6%A6%82%E8%BF%B0%E5%92%8C%E4%BD%BF%E7%94%A8/","excerpt":"","text":"1 NoSQLæ¦‚è¿°not only SQL ä¼˜åŠ¿ï¼š High Performance Huge Storage High Scalability &amp; High Availibility ç±»å‹ éƒ¨åˆ†ä»£è¡¨ ç‰¹ç‚¹ åˆ—å­˜å‚¨ Hbase Cassandra Hypertable é¡¾åæ€ä¹‰ï¼Œæ˜¯æŒ‰åˆ—å­˜å‚¨æ•°æ®çš„ã€‚æœ€å¤§çš„ç‰¹ç‚¹æ˜¯æ–¹ä¾¿å­˜å‚¨ç»“æ„åŒ–å’ŒåŠç»“æ„åŒ–æ•°æ®ï¼Œæ–¹ä¾¿åšæ•°æ®å‹ç¼©ï¼Œå¯¹é’ˆå¯¹æŸä¸€åˆ—æˆ–è€…æŸå‡ åˆ—çš„æŸ¥è¯¢æœ‰éå¸¸å¤§çš„IOä¼˜åŠ¿ã€‚ æ–‡æ¡£å­˜å‚¨ MongoDB CouchDB æ–‡æ¡£å­˜å‚¨ä¸€èˆ¬ç”¨ç±»ä¼¼jsonçš„æ ¼å¼å­˜å‚¨ï¼Œå­˜å‚¨çš„å†…å®¹æ˜¯æ–‡æ¡£å‹çš„ã€‚è¿™æ ·ä¹Ÿå°±æœ‰æœ‰æœºä¼šå¯¹æŸäº›å­—æ®µå»ºç«‹ç´¢å¼•ï¼Œå®ç°å…³ç³»æ•°æ®åº“çš„æŸäº›åŠŸèƒ½ã€‚ key-valueå­˜å‚¨ Tokyo&nbsp;Cabinet/Tyrant Berkeley&nbsp;DB MemcacheDB Redis å¯ä»¥é€šè¿‡keyå¿«é€ŸæŸ¥è¯¢åˆ°å…¶valueã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå­˜å‚¨ä¸ç®¡valueçš„æ ¼å¼ï¼Œç…§å•å…¨æ”¶ã€‚ï¼ˆRedisåŒ…å«äº†å…¶ä»–åŠŸèƒ½ï¼‰ å›¾å­˜å‚¨ Neo4J FlockDB å›¾å½¢å…³ç³»çš„æœ€ä½³å­˜å‚¨ã€‚ä½¿ç”¨ä¼ ç»Ÿå…³ç³»æ•°æ®åº“æ¥è§£å†³çš„è¯æ€§èƒ½ä½ä¸‹ï¼Œè€Œä¸”è®¾è®¡ä½¿ç”¨ä¸æ–¹ä¾¿ã€‚ å¯¹è±¡å­˜å‚¨ db4o Versant é€šè¿‡ç±»ä¼¼é¢å‘å¯¹è±¡è¯­è¨€çš„è¯­æ³•æ“ä½œæ•°æ®åº“ï¼Œé€šè¿‡å¯¹è±¡çš„æ–¹å¼å­˜å–æ•°æ®ã€‚ xmlæ•°æ®åº“ Berkeley DB XML BaseX é«˜æ•ˆçš„å­˜å‚¨XMLæ•°æ®ï¼Œå¹¶æ”¯æŒXMLçš„å†…éƒ¨æŸ¥è¯¢è¯­æ³•ï¼Œæ¯”å¦‚XQuery,Xpathã€‚ 2 Redisæ¦‚è¿°Redisæ˜¯ä¸€ç§é”®å€¼å¯¹æ•°æ®åº“ã€‚ 2.1 ç‰¹å¾ æ•°æ®é—´æ²¡æœ‰å¿…ç„¶çš„å…³è”å…³ç³» å†…éƒ¨é‡‡ç”¨å•çº¿ç¨‹æœºåˆ¶è¿›è¡Œå·¥ä½œ é«˜æ€§èƒ½ã€‚å®˜æ–¹æä¾›æµ‹è¯•æ•°æ®ï¼Œ50ä¸ªå¹¶å‘æ‰§è¡Œ100000 ä¸ªè¯·æ±‚,è¯»çš„é€Ÿåº¦æ˜¯110000 æ¬¡/s,å†™çš„é€Ÿåº¦æ˜¯81000æ¬¡/sã€‚ å¤šæ•°æ®ç±»å‹æ”¯æŒ å­—ç¬¦ä¸²ç±»å‹ string åˆ—è¡¨ç±»å‹ list æ•£åˆ—ç±»å‹ hash é›†åˆç±»å‹ set æœ‰åºé›†åˆç±»å‹ sorted_set æŒä¹…åŒ–æ”¯æŒã€‚å¯ä»¥è¿›è¡Œæ•°æ®ç¾éš¾æ¢å¤ 2.2 åº”ç”¨ ä¸ºçƒ­ç‚¹æ•°æ®åŠ é€ŸæŸ¥è¯¢ï¼ˆä¸»è¦åœºæ™¯ï¼‰ï¼Œå¦‚çƒ­ç‚¹å•†å“ã€çƒ­ç‚¹æ–°é—»ã€çƒ­ç‚¹èµ„è®¯ã€æ¨å¹¿ç±»ç­‰é«˜è®¿é—®é‡ä¿¡æ¯ç­‰ ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¦‚ç§’æ€ã€æŠ¢è´­ã€è´­ç¥¨æ’é˜Ÿç­‰ å³æ—¶ä¿¡æ¯æŸ¥è¯¢ï¼Œå¦‚å„ä½æ’è¡Œæ¦œã€å„ç±»ç½‘ç«™è®¿é—®ç»Ÿè®¡ã€å…¬äº¤åˆ°ç«™ä¿¡æ¯ã€åœ¨çº¿äººæ•°ä¿¡æ¯ï¼ˆèŠå¤©å®¤ã€ç½‘ç«™ï¼‰ã€è®¾å¤‡ä¿¡å·ç­‰ æ—¶æ•ˆæ€§ä¿¡æ¯æ§åˆ¶ï¼Œå¦‚éªŒè¯ç æ§åˆ¶ã€æŠ•ç¥¨æ§åˆ¶ç­‰ åˆ†å¸ƒå¼æ•°æ®å…±äº«ï¼Œå¦‚åˆ†å¸ƒå¼é›†ç¾¤æ¶æ„ä¸­çš„ session åˆ†ç¦» æ¶ˆæ¯é˜Ÿåˆ— åˆ†å¸ƒå¼é” 2.3 å®‰è£…å®‰è£…ä¹‹åä¿®æ”¹å®‰è£…ç›®å½•ä¸‹çš„redis.confï¼Œå°†daemonize noæ”¹ä¸ºdaemonize yes åŸºæœ¬é…ç½®ï¼š port 6379 #å¯åŠ¨ç«¯å£ daemonize yes #å®ˆæŠ¤è¿›ç¨‹ logfile \"6379.log\" #æ—¥å¿—æ–‡ä»¶å dir /usr/local/redis/data #æ—¥å¿—æ–‡ä»¶ã€æŒä¹…åŒ–æ–‡ä»¶ç›®å½• å¯åŠ¨redisçš„æ–¹å¼ï¼š src/redis-server redis.conf æ›´æ”¹ç«¯å£å¯åŠ¨ï¼š redis-server --port 6380 æˆ–è€…æ›´æ”¹é…ç½®æ–‡ä»¶çš„portï¼šï¼ˆå¯åœ¨ä¸€å°ä¸»æœºä¸Šå¯åŠ¨å¤šä¸ªæœåŠ¡ï¼‰ è¿æ¥æ—¶ä½¿ç”¨ï¼š redis-cli -p 6380é…ç½®æœåŠ¡ï¼š mkdir /etc/redis cp redis.conf /etc/redis/6379.conf cp utils/redis_init_script /etc/init.d/redis å¯åŠ¨æœåŠ¡ï¼š service redis start é»˜è®¤ç«¯å£ï¼š6379 3 RedisåŸºæœ¬æ“ä½œRedis å‘½ä»¤å‚è€ƒ â€” Redis å‘½ä»¤å‚è€ƒ æ¸…é™¤å±å¹•ä¿¡æ¯ï¼šclear æŸ¥çœ‹å‘½ä»¤å¸®åŠ©ï¼šhelp å‘½ä»¤ 3.1 Stringç±»å‹Stringçš„æœ€å¤§å­˜å‚¨é‡æ˜¯512MB Stringçš„ç”¨é€”ä¹‹ä¸€æ˜¯å­˜æ–‡æ¡£ï¼ˆç±»ä¼¼jsonæ•°æ®ï¼‰ é”®åé€šå¸¸æœ‰è§„èŒƒï¼Œä¾‹å¦‚user:id:xxxxxxx:fansï¼ˆè¡¨å:ä¸»é”®å:ä¸»é”®å€¼:å­—æ®µåï¼‰ set key value [EX seconds] [DX miliseconds]æ–°å¢ã€æ›´æ–°é”®å€¼å¯¹ã€‚å®ƒç›¸å½“äº setex key seconds value å’Œ psetex key milliseconds valueã€‚ get keyè·å–å€¼ del keyåˆ é™¤é”®å€¼å¯¹ ttl keyæŸ¥çœ‹ttlï¼ˆå‰©ä½™ç”Ÿå­˜ï¼‰æ—¶é—´ expire key secondsè®¾ç½®è¿‡æœŸæ—¶é—´ keys *æŸ¥çœ‹æ‰€æœ‰çš„key mset key1 value1 key2 value2...åŒæ—¶è®¾ç½®å¤šä¸ªé”®å€¼å¯¹ï¼Œå¯¹åº”è¿˜æœ‰mgetï¼Œå¯ä»¥åŒæ—¶å–å¤šä¸ªå€¼ getset keyæ›´æ–°å€¼çš„åŒæ—¶è¿”å›æ—§å€¼ã€‚ incr keyè‡ªå¢valueï¼ˆåªå¯¹çº¯æ•°å­—çš„å­—ç¬¦ä¸²æœ‰æ•ˆï¼‰ decr valueè‡ªå‡value incrby key numä»¥numå€¼è‡ªå¢ï¼ˆdecrbyåŒç†ï¼‰ï¼Œç±»ä¼¼çš„è¿˜æœ‰incrbyfloatï¼ˆå¢åŠ å°æ•°ï¼‰ æ³¨æ„ï¼š redisæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼Œé‡‡ç”¨å•çº¿ç¨‹å¤„ç†æ‰€æœ‰ä¸šåŠ¡ï¼Œå‘½ä»¤æ˜¯ä¸€ä¸ªä¸€ä¸ªæ‰§è¡Œçš„ï¼Œå› æ­¤æ— éœ€è€ƒè™‘å¹¶å‘å¸¦æ¥çš„æ•°æ®å½±å“ã€‚ èƒ½è·å–çš„æœ€å¤§æ•´æ•°èŒƒå›´æ˜¯javaä¸­longçš„æœ€å¤§å€¼ã€‚ append key toAppend å°†ä¸€æ®µå­—ç¬¦ä¸²é™„åŠ åˆ°æ—§å€¼ä¸Šã€‚ strlen keyè®¡ç®—å€¼çš„é•¿åº¦ setnx key value(set not exist)å¦‚æœkeyä¸å­˜åœ¨åˆ™è®¾ç½®å¹¶è¿”å›1ï¼Œå¦‚æœkeyå­˜åœ¨ä¸æ›´æ–°è¿”å›0 3.2 Hashç±»å‹ æ–°çš„å­˜å‚¨éœ€æ±‚ï¼šå¯¹ä¸€ç³»åˆ—å­˜å‚¨çš„æ•°æ®è¿›è¡Œç¼–ç»„ï¼Œæ–¹ä¾¿ç®¡ç†ï¼Œå…¸å‹åº”ç”¨å­˜å‚¨å¯¹è±¡ä¿¡æ¯ éœ€è¦çš„å­˜å‚¨ç»“æ„ï¼šä¸€ä¸ªå­˜å‚¨ç©ºé—´ä¿å­˜å¤šä¸ªé”®å€¼å¯¹æ•°æ® hashç±»å‹å®é™…ä¸Šå€¼å­˜çš„è¿˜æ˜¯ä¸€ä¸ªç±»ä¼¼äºå“ˆå¸Œè¡¨çš„ç»“æ„ï¼Œé‡Œé¢çš„é”®å€¼å¯¹å«field-value æ³¨æ„äº‹é¡¹ hashç±»å‹ä¸‹çš„valueåªèƒ½å­˜å‚¨å­—ç¬¦ä¸²ï¼Œä¸å…è®¸å­˜å‚¨å…¶ä»–æ•°æ®ç±»å‹ æ¯ä¸ªhashå¯ä»¥å­˜å‚¨232-1ä¸ªé”®å€¼å¯¹ hgetall æ“ä½œå¯ä»¥è·å–å…¨éƒ¨å±æ€§ï¼Œå¦‚æœå†…éƒ¨fieldè¿‡å¤šï¼Œéå†æ•´ä½“æ•°æ®æ•ˆç‡å°±å¾ˆä¼šä½ï¼Œæœ‰å¯èƒ½æˆä¸ºæ•°æ®è®¿é—®ç“¶é¢ˆ hset hashname field valueè®¾ç½®å¯¹åº”hashçš„é”®å€¼å¯¹ hget hashname fieldè·å–å¯¹åº”çš„å“ˆå¸Œä¸­å¯¹åº”çš„é”®å¯¹åº”çš„å€¼ hmset hashname field1 value1 field2 value2... å¤šé‡è®¾ç½® hmget hashname field1 field2...å¤šé‡è·å– hdel hashnameåˆ é™¤é”® hsetnx hashname field valueç±»ä¼¼setnxï¼Œåªæœ‰ä¸å­˜åœ¨æ‰æ·»åŠ ã€‚ hlen hashnameè·å–å“ˆå¸Œä¸­fieldçš„ä¸ªæ•° hexists hashname fieldåˆ¤æ–­fieldæ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨è¿”å›1 hkeys hashnameè·å–æŸå“ˆå¸Œæ‰€æœ‰çš„fieldå hvals hashnameè·å–æŸå“ˆå¸Œæ‰€æœ‰çš„value hgetall hashnameè·å–æ‰€æœ‰çš„fieldåå’Œvalue hincrby hashname field incrementæ³¨æ„è¿™ä¸ªåªæœ‰hincrbyæ²¡æœ‰hincr 3.3 Listç±»å‹ æ•°æ®å­˜å‚¨éœ€æ±‚ï¼šå­˜å‚¨å¤šä¸ªæ•°æ®ï¼Œå¹¶å¯¹æ•°æ®è¿›å…¥å­˜å‚¨ç©ºé—´çš„é¡ºåºè¿›è¡ŒåŒºåˆ† éœ€è¦çš„å­˜å‚¨ç»“æ„ï¼šä¸€ä¸ªå­˜å‚¨ç©ºé—´ä¿å­˜å¤šä¸ªæ•°æ®ï¼Œä¸”é€šè¿‡æ•°æ®å¯ä»¥ä½“ç°è¿›å…¥é¡ºåº listçš„å…ƒç´ å¯ä»¥é‡å¤ lpush listname val1 val2... rpush listname val1 val2...lpushä»å·¦è¾¹æ’å…¥ï¼Œrpushä»å³è¾¹æ’å…¥ã€‚å¦‚æœlistä¸å­˜åœ¨ï¼Œä¼šå…ˆåˆ›å»ºlistï¼Œç„¶åæ’å…¥ã€‚ lrange listname start stopä»å·¦è¾¹æ•°çš„èŒƒå›´ï¼Œstartå’Œstopç´¢å¼•å…è®¸è´Ÿå€¼ï¼Œ-1ä»£è¡¨æœ€åä¸€ä¸ªå…ƒç´ ï¼Œ-2ä»£è¡¨å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ â€¦â€¦ lpop listname rpop listnameä»å·¦è¾¹ï¼ˆå³è¾¹ï¼‰å¼¹å‡ºå…ƒç´  blpop listname timeout brpop listname timeouté˜»å¡ç‰ˆæœ¬çš„lpop/rpopï¼Œå¦‚æœæ­¤æ—¶åˆ—è¡¨ä¸­æ²¡æœ‰å…ƒç´ åˆ™é˜»å¡ï¼Œå¯ä»¥è®¾ç½®æœ€é•¿ç­‰å¾…æ—¶é—´ llen listnameè¿”å›åˆ—è¡¨çš„é•¿åº¦ lset listname index valueä¿®æ”¹åˆ—è¡¨ä¸­ç´¢å¼•indexå¯¹åº”çš„å€¼ lindex listname index è·å–ç´¢å¼•indexå¯¹åº”çš„value lrem listname count valueç§»é™¤å€¼ç­‰äºæŒ‡å®šå€¼çš„å…ƒç´ countä¸ª linsert listname before/after pivot valueè¿™ä¸ªpivotä»£è¡¨çš„æ˜¯listä¸­ä¸€ä¸ªå…ƒç´ çš„å€¼ 3.4 Setç±»å‹ æ–°çš„å­˜å‚¨éœ€æ±‚ï¼šå­˜å‚¨å¤§é‡çš„æ•°æ®ï¼Œåœ¨æŸ¥è¯¢æ–¹é¢æä¾›æ›´é«˜çš„æ•ˆç‡ éœ€è¦çš„å­˜å‚¨ç»“æ„ï¼šèƒ½å¤Ÿä¿å­˜å¤§é‡çš„æ•°æ®ï¼Œé«˜æ•ˆçš„å†…éƒ¨å­˜å‚¨æœºåˆ¶ï¼Œä¾¿äºæŸ¥è¯¢ setç±»å‹ï¼šä¸hashå­˜å‚¨ç»“æ„å®Œå…¨ç›¸åŒï¼Œä»…å­˜å‚¨é”®ï¼Œä¸å­˜å‚¨å€¼ï¼ˆnilï¼‰ï¼Œå¹¶ä¸”å€¼æ˜¯ä¸å…è®¸é‡å¤çš„ sadd setname memberå‘é›†åˆä¸­æ·»åŠ å…ƒç´  smembers setnameè¿”å›é›†åˆçš„å…¨éƒ¨æˆå‘˜ srem setname memberç§»é™¤å…ƒç´  scard setnameè¿”å›é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•° sismember setname memberåˆ¤æ–­æ˜¯å¦åœ¨é›†åˆé‡Œã€‚ srandmember setname [count]éšæœºè·å–é›†åˆä¸­æŒ‡å®šæ•°é‡çš„æ•°æ® spop setnameè¿”å›å¹¶ç§»é™¤éšæœºä¸€ä¸ªå…ƒç´  sinter setname1 setname2 sunion setname1 setname2 sdiff setname1 setname2æ±‚ä¸¤ä¸ªé›†åˆçš„äº¤ã€å¹¶ã€å·®é›†ã€‚ è¿˜æœ‰sinterstoreç­‰æŒ‡ä»¤å¯ä»¥æŠŠç»“æœå­˜å‚¨åˆ°æŒ‡å®šé›†åˆä¸­ã€‚ smove source destination memberå°†å…ƒç´ ä»sourceé›†åˆä¸­ç§»åŠ¨åˆ°destinationä¸­ã€‚ 3.5 Sorted_setç±»å‹ æ–°çš„å­˜å‚¨éœ€æ±‚ï¼šæ•°æ®æ’åºæœ‰åˆ©äºæ•°æ®çš„æœ‰æ•ˆå±•ç¤ºï¼Œéœ€è¦æä¾›ä¸€ç§å¯ä»¥æ ¹æ®è‡ªèº«ç‰¹å¾è¿›è¡Œæ’åºçš„æ–¹å¼ éœ€è¦çš„å­˜å‚¨ç»“æ„ï¼šæ–°çš„å­˜å‚¨æ¨¡å‹ï¼Œå¯ä»¥ä¿å­˜å¯æ’åºçš„æ•°æ® sorted_setç±»å‹ï¼šåœ¨setçš„å­˜å‚¨ç»“æ„åŸºç¡€ä¸Šæ·»åŠ å¯æ’åºå­—æ®µ zadd setname score1 member1 [score2 member2]æ·»åŠ å…ƒç´ ï¼Œæ³¨æ„è¦å¸¦ä¸Šä¸€ä¸ªç”¨äºæ’åºçš„æ•°æ®ï¼ˆç›¸å½“äºæƒï¼‰ã€‚ zrange setname start end [withscores] zrevrange setname start stop [WITHSCORES]zrangeä»å°åˆ°å¤§æ˜¾ç¤ºæŒ‡å®šå…ƒç´ èŒƒå›´ï¼Œå¦‚æœå¸¦æœ‰withscoresåˆ™ä¼šè¿ç€scoreä¸€èµ·è¿”å›ã€‚zrevrangeç›¸åï¼Œä»å¤§åˆ°å°ã€‚ zcard setname zcount setname min maxzcardæ˜¾ç¤ºé›†åˆä¸­æœ‰å¤šå°‘ä¸ªå…ƒç´ zcountæ˜¾ç¤ºåœ¨min-maxä¹‹é—´çš„å…ƒç´ æœ‰å¤šå°‘ä¸ª zrem setname memberç§»é™¤member zrangebyscore setname min max [WITHSCORES] [LIMIT]; zrevrangebyscore setname [WITHSCORES];æŒ‰æ¡ä»¶è·å–å¤„äºmin-maxä¹‹é—´çš„æ•°æ® zremrangebyrank setname start stop zremrangebyscore setname min maxzremrangebyrankæŒ‰æ’ååˆ é™¤å…ƒç´  zremrangebyscoreåˆ é™¤å€¼åœ¨min-maxä¹‹é—´çš„å…ƒç´  zrank setname member zrevrank setname memberæŸ¥çœ‹å…ƒç´ çš„æ­£åºæˆ–å€’åºæ’å zscore setname member zincrby setname increment memberscoreå€¼è·å–ä¸ä¿®æ”¹","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"https://www.codetool.top/tags/Redis/"}]},{"title":"leetcode12-æ•´æ•°è½¬ç½—é©¬æ•°å­—","slug":"leetcode12-æ•´æ•°è½¬ç½—é©¬æ•°å­—","date":"2020-02-29T08:25:42.000Z","updated":"2020-02-29T08:31:44.735Z","comments":true,"path":"article/leetcode12-æ•´æ•°è½¬ç½—é©¬æ•°å­—/","link":"","permalink":"https://www.codetool.top/article/leetcode12-%E6%95%B4%E6%95%B0%E8%BD%AC%E7%BD%97%E9%A9%AC%E6%95%B0%E5%AD%97/","excerpt":"","text":"1 åŸé¢˜ç½—é©¬æ•°å­—åŒ…å«ä»¥ä¸‹ä¸ƒç§å­—ç¬¦ï¼š Iï¼Œ Vï¼Œ Xï¼Œ Lï¼ŒCï¼ŒD å’Œ Mã€‚ å­—ç¬¦ æ•°å€¼ I 1 V 5 X 10 L 50 C 100 D 500 M 1000ä¾‹å¦‚ï¼Œ ç½—é©¬æ•°å­— 2 å†™åš II ï¼Œå³ä¸ºä¸¤ä¸ªå¹¶åˆ—çš„ 1ã€‚12 å†™åš XII ï¼Œå³ä¸º X + II ã€‚ 27 å†™åš XXVII, å³ä¸º XX + V + II ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œç½—é©¬æ•°å­—ä¸­å°çš„æ•°å­—åœ¨å¤§çš„æ•°å­—çš„å³è¾¹ã€‚ä½†ä¹Ÿå­˜åœ¨ç‰¹ä¾‹ï¼Œä¾‹å¦‚ 4 ä¸å†™åš IIIIï¼Œè€Œæ˜¯ IVã€‚æ•°å­— 1 åœ¨æ•°å­— 5 çš„å·¦è¾¹ï¼Œæ‰€è¡¨ç¤ºçš„æ•°ç­‰äºå¤§æ•° 5 å‡å°æ•° 1 å¾—åˆ°çš„æ•°å€¼ 4 ã€‚åŒæ ·åœ°ï¼Œæ•°å­— 9 è¡¨ç¤ºä¸º IXã€‚è¿™ä¸ªç‰¹æ®Šçš„è§„åˆ™åªé€‚ç”¨äºä»¥ä¸‹å…­ç§æƒ…å†µï¼š I å¯ä»¥æ”¾åœ¨ V (5) å’Œ X (10) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 4 å’Œ 9ã€‚ X å¯ä»¥æ”¾åœ¨ L (50) å’Œ C (100) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 40 å’Œ 90ã€‚ C å¯ä»¥æ”¾åœ¨ D (500) å’Œ M (1000) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 400 å’Œ 900ã€‚ ç»™å®šä¸€ä¸ªæ•´æ•°ï¼Œå°†å…¶è½¬ä¸ºç½—é©¬æ•°å­—ã€‚è¾“å…¥ç¡®ä¿åœ¨ 1 åˆ° 3999 çš„èŒƒå›´å†…ã€‚ ç¤ºä¾‹1: è¾“å…¥: 3è¾“å‡º: â€œIIIâ€ ç¤ºä¾‹2: è¾“å…¥: 4è¾“å‡º: â€œIVâ€ ç¤ºä¾‹3: è¾“å…¥: 9è¾“å‡º: â€œIXâ€ ç¤ºä¾‹4: è¾“å…¥: 58è¾“å‡º: â€œLVIIIâ€è§£é‡Š: L = 50, V = 5, III = 3. ç¤ºä¾‹5: è¾“å…¥: 1994è¾“å‡º: â€œMCMXCIVâ€è§£é‡Š: M = 1000, CM = 900, XC = 90, IV = 4. 2 è§£æ³•2.1 æ€æƒ³æ¯ä¸€ä½çš„æ•°å­—+æ‰€åœ¨ä½å†³å®šäº†åœ¨ç½—é©¬æ•°å­—ä¸­ç”¨ä»€ä¹ˆè¡¨ç¤ºã€‚ 2.2 ä»£ç ç®€å•ç²—æš´ class Solution { public String intToRoman(int num) { StringBuilder sb = new StringBuilder(); String[] thous = {\"\",\"M\",\"MM\",\"MMM\"}; String[] hundr = {\"\",\"C\",\"CC\",\"CCC\",\"CD\",\"D\",\"DC\",\"DCC\",\"DCCC\",\"CM\"}; String[] ten = {\"\",\"X\",\"XX\",\"XXX\",\"XL\",\"L\",\"LX\",\"LXX\",\"LXXX\",\"XC\"}; String[] one = {\"\",\"I\",\"II\",\"III\",\"IV\",\"V\",\"VI\",\"VII\",\"VIII\",\"IX\"}; return sb.append(thous[num/1000]).append(hundr[num/100%10]).append(ten[num/10%10]).append(one[num%10]).toString(); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"è“æ¡¥æ¯è¯•é¢˜-å°æ•°ç¬¬nä½","slug":"è“æ¡¥æ¯è¯•é¢˜-å°æ•°ç¬¬nä½","date":"2020-02-28T16:24:46.000Z","updated":"2020-02-28T16:29:05.127Z","comments":true,"path":"article/è“æ¡¥æ¯è¯•é¢˜-å°æ•°ç¬¬nä½/","link":"","permalink":"https://www.codetool.top/article/%E8%93%9D%E6%A1%A5%E6%9D%AF%E8%AF%95%E9%A2%98-%E5%B0%8F%E6%95%B0%E7%AC%ACn%E4%BD%8D/","excerpt":"","text":"1 åŸé¢˜èµ„æºé™åˆ¶ æ—¶é—´é™åˆ¶ï¼š1.0s å†…å­˜é™åˆ¶ï¼š256.0MB é—®é¢˜æè¿° æˆ‘ä»¬çŸ¥é“ï¼Œæ•´æ•°åšé™¤æ³•æ—¶ï¼Œæœ‰æ—¶å¾—åˆ°æœ‰é™å°æ•°ï¼Œæœ‰æ—¶å¾—åˆ°æ— é™å¾ªç¯å°æ•°ã€‚ å¦‚æœæˆ‘ä»¬æŠŠæœ‰é™å°æ•°çš„æœ«å°¾åŠ ä¸Šæ— é™å¤šä¸ª0ï¼Œå®ƒä»¬å°±æœ‰äº†ç»Ÿä¸€çš„å½¢å¼ã€‚ æœ¬é¢˜çš„ä»»åŠ¡æ˜¯ï¼šåœ¨ä¸Šé¢çš„çº¦å®šä¸‹ï¼Œæ±‚æ•´æ•°é™¤æ³•å°æ•°ç‚¹åçš„ç¬¬nä½å¼€å§‹çš„3ä½æ•°ã€‚ è¾“å…¥æ ¼å¼ ä¸€è¡Œä¸‰ä¸ªæ•´æ•°ï¼ša b nï¼Œç”¨ç©ºæ ¼åˆ†å¼€ã€‚aæ˜¯è¢«é™¤æ•°ï¼Œbæ˜¯é™¤æ•°ï¼Œnæ˜¯æ‰€æ±‚çš„å°æ•°åä½ç½®ï¼ˆ0&lt;a,b,n&lt;1000000000ï¼‰ è¾“å‡ºæ ¼å¼ ä¸€è¡Œ3ä½æ•°å­—ï¼Œè¡¨ç¤ºï¼šaé™¤ä»¥bï¼Œå°æ•°åç¬¬nä½å¼€å§‹çš„3ä½æ•°å­—ã€‚ æ ·ä¾‹è¾“å…¥ 1 8 1 æ ·ä¾‹è¾“å‡º 125 æ ·ä¾‹è¾“å…¥ 1 8 3 æ ·ä¾‹è¾“å‡º 500 æ ·ä¾‹è¾“å…¥ 282866 999000 6 æ ·ä¾‹è¾“å‡º 914 2 è§£æ³•2.1 æ€æƒ³ä¸€å¼€å§‹æƒ³æŠŠè¢«é™¤æ•°ç»™ä¹˜ä»¥10çš„å¤šå°‘æ¬¡å¹‚ä¹‹åå†é™¤ä»¥é™¤æ•°ï¼Œç„¶åå‘ç°ä¼šæº¢å‡ºï¼Œè¿™é“é¢˜è¿˜æ˜¯æ¨¡æ‹Ÿé™¤æ³•è§„åˆ™æ±‚è§£ 2.2 ä»£ç import java.util.Scanner; public class Main { public static void main(String[] args) { Scanner scanner = new Scanner(System.in); int divide = scanner.nextInt(); int divideBy = scanner.nextInt(); int start = scanner.nextInt(); int begin = divide%divideBy; for(int i = 0;i&lt;start+2;i++){ begin *= 10; if(i>=start-1) System.out.print(begin/divideBy); begin %= divideBy; } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"è“æ¡¥æ¯","slug":"è“æ¡¥æ¯","permalink":"https://www.codetool.top/tags/%E8%93%9D%E6%A1%A5%E6%9D%AF/"}]},{"title":"è“æ¡¥æ¯è¯•é¢˜-å¤§å°å†™è½¬æ¢","slug":"è“æ¡¥æ¯è¯•é¢˜-å¤§å°å†™è½¬æ¢","date":"2020-02-28T16:04:17.000Z","updated":"2020-02-28T16:09:13.662Z","comments":true,"path":"article/è“æ¡¥æ¯è¯•é¢˜-å¤§å°å†™è½¬æ¢/","link":"","permalink":"https://www.codetool.top/article/%E8%93%9D%E6%A1%A5%E6%9D%AF%E8%AF%95%E9%A2%98-%E5%A4%A7%E5%B0%8F%E5%86%99%E8%BD%AC%E6%8D%A2/","excerpt":"","text":"1 åŸé¢˜èµ„æºé™åˆ¶ æ—¶é—´é™åˆ¶ï¼š1.0s å†…å­˜é™åˆ¶ï¼š256.0MB é—®é¢˜æè¿° è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå°†å¤§å†™å­—ç¬¦å˜æˆå°å†™ã€å°å†™å˜æˆå¤§å†™ï¼Œç„¶åè¾“å‡º è¾“å…¥æ ¼å¼ acbAB è¾“å‡ºæ ¼å¼ ACBab æ ·ä¾‹è¾“å…¥ ä¸€ä¸ªæ»¡è¶³é¢˜ç›®è¦æ±‚çš„è¾“å…¥èŒƒä¾‹ã€‚ä¾‹ï¼šacbAB æ ·ä¾‹è¾“å‡º ä¸ä¸Šé¢çš„æ ·ä¾‹è¾“å…¥å¯¹åº”çš„è¾“å‡ºã€‚ä¾‹ï¼šACBab æ•°æ®è§„æ¨¡å’Œçº¦å®š è¾“å…¥æ•°æ®ä¸­æ¯ä¸€ä¸ªæ•°çš„èŒƒå›´ã€‚ä¾‹ï¼š0&lt;n,m&lt;100, 0&lt;=çŸ©é˜µä¸­çš„æ¯ä¸ªæ•°&lt;=1000ã€‚ 2 è§£æ³•2.1 æ€æƒ³åŠ å‡asciiç å€¼ã€‚ã€‚ 2.2 ä»£ç import java.util.Scanner; public class Main { public static void main(String[] args) { Scanner scanner = new Scanner(System.in); String origin = scanner.next(); StringBuilder sb = new StringBuilder(); for(char i:origin.toCharArray()){ if(i>='a'&amp;&amp;i&lt;='z') sb.append((char)(i-('a'-'A'))); else sb.append((char)(i+('a'-'A'))); } System.out.println(sb.toString()); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"è“æ¡¥æ¯","slug":"è“æ¡¥æ¯","permalink":"https://www.codetool.top/tags/%E8%93%9D%E6%A1%A5%E6%9D%AF/"}]},{"title":"è“æ¡¥æ¯è¯•é¢˜-é»‘è‰²æ˜ŸæœŸäº”","slug":"è“æ¡¥æ¯è¯•é¢˜-é»‘è‰²æ˜ŸæœŸäº”","date":"2020-02-28T15:32:59.000Z","updated":"2020-02-28T15:47:00.477Z","comments":true,"path":"article/è“æ¡¥æ¯è¯•é¢˜-é»‘è‰²æ˜ŸæœŸäº”/","link":"","permalink":"https://www.codetool.top/article/%E8%93%9D%E6%A1%A5%E6%9D%AF%E8%AF%95%E9%A2%98-%E9%BB%91%E8%89%B2%E6%98%9F%E6%9C%9F%E4%BA%94/","excerpt":"","text":"1 åŸé¢˜èµ„æºé™åˆ¶ æ—¶é—´é™åˆ¶ï¼š1.0s å†…å­˜é™åˆ¶ï¼š512.0MB é—®é¢˜æè¿° æœ‰äº›è¥¿æ–¹äººæ¯”è¾ƒè¿·ä¿¡ï¼Œå¦‚æœæŸä¸ªæœˆçš„13å·æ­£å¥½æ˜¯æ˜ŸæœŸäº”ï¼Œä»–ä»¬å°±ä¼šè§‰å¾—ä¸å¤ªå‰åˆ©ï¼Œç”¨å¤äººçš„è¯´æ³•ï¼Œå°±æ˜¯â€œè¯¸äº‹ä¸å®œâ€ã€‚è¯·ä½ ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œç»Ÿè®¡å‡ºåœ¨æŸä¸ªç‰¹å®šçš„å¹´ä»½ä¸­ï¼Œå‡ºç°äº†å¤šå°‘æ¬¡æ—¢æ˜¯13å·åˆæ˜¯æ˜ŸæœŸäº”çš„æƒ…å½¢ï¼Œä»¥å¸®åŠ©ä½ çš„è¿·ä¿¡æœ‹å‹è§£å†³éš¾é¢˜ã€‚ è¯´æ˜ï¼šï¼ˆ1ï¼‰ä¸€å¹´æœ‰365å¤©ï¼Œé—°å¹´æœ‰366å¤©ï¼Œæ‰€è°“é—°å¹´ï¼Œå³èƒ½è¢«4æ•´é™¤ä¸”ä¸èƒ½è¢«100æ•´é™¤çš„å¹´ä»½ï¼Œæˆ–æ˜¯æ—¢èƒ½è¢«100æ•´é™¤ä¹Ÿèƒ½è¢«400æ•´é™¤çš„å¹´ä»½ï¼›ï¼ˆ2ï¼‰å·²çŸ¥1998å¹´1æœˆ1æ—¥æ˜¯æ˜ŸæœŸå››ï¼Œç”¨æˆ·è¾“å…¥çš„å¹´ä»½è‚¯å®šå¤§äºæˆ–ç­‰äº1998å¹´ã€‚ è¾“å…¥æ ¼å¼ï¼šè¾“å…¥åªæœ‰ä¸€è¡Œï¼Œå³æŸä¸ªç‰¹å®šçš„å¹´ä»½ï¼ˆå¤§äºæˆ–ç­‰äº1998å¹´ï¼‰ã€‚ è¾“å‡ºæ ¼å¼ï¼šè¾“å‡ºåªæœ‰ä¸€è¡Œï¼Œå³åœ¨è¿™ä¸€å¹´ä¸­ï¼Œå‡ºç°äº†å¤šå°‘æ¬¡æ—¢æ˜¯13å·åˆæ˜¯æ˜ŸæœŸäº”çš„æƒ…å½¢ã€‚è¾“å…¥è¾“å‡ºæ ·ä¾‹ æ ·ä¾‹è¾“å…¥ 1998 æ ·ä¾‹è¾“å‡º 3 2 è§£æ³•2.1 æ€æƒ³å¯ä»¥å·æ‡’ä½¿ç”¨Calendarç±»æˆ–è€…è¢«åºŸå¼ƒçš„Dateï¼Œä¸è¿‡è¦æ±‚å¯¹Calendarç±»æ¯”è¾ƒç†Ÿæ‚‰ã€‚ã€‚ ä¸ç„¶å°±æŒ‰é—°å¹´çš„æƒ…å†µå»å¤„ç†æ—¥æœŸå§ã€‚ã€‚ 2.2 ä»£ç java api: import java.util.Calendar; import java.util.Scanner; public class Main { public static void main(String[] args) { Scanner scanner = new Scanner(System.in); int year = scanner.nextInt(); int count = 0; Calendar calendar = Calendar.getInstance(); calendar.set(Calendar.YEAR,year); for(int i = 0;i&lt;12;i++){ calendar.set(Calendar.MONTH,i); calendar.set(Calendar.DATE,13); if(calendar.get(Calendar.DAY_OF_WEEK)==Calendar.FRIDAY) count ++; } System.out.println(count); } } ç¡¬ç®—ï¼š import java.util.Scanner; public class Main { public static void main(String[] args) { Scanner scanner = new Scanner(System.in); int year = scanner.nextInt(); int firstDay = getFirstDay(year); boolean isLeap = (year%4==0&amp;&amp;year%100!=0)||(year%100==0&amp;&amp;year%400==0); int count = 0; for(int i = 1;i&lt;=12;i++){ switch (i){ case 1: firstDay = (firstDay+12%7)%7; if(firstDay == 4) count++; break; case 3: firstDay = (firstDay+(isLeap?29:28)%7)%7; if(firstDay == 4) count++; break; case 5: case 7: case 10: case 12: firstDay = (firstDay+30%7)%7; if(firstDay == 4) count++; break; default: firstDay = (firstDay+31%7)%7; if(firstDay == 4) count++; break; } } System.out.println(count); } public static int getFirstDay(int year){ if(year == 1998) return 3; int lastYear = year -1; if((lastYear%4==0&amp;&amp;lastYear%100!=0)||(lastYear%100==0&amp;&amp;lastYear%400==0)) return (getFirstDay(lastYear)+366%7)%7; else return (getFirstDay(lastYear)+365%7)%7; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"è“æ¡¥æ¯","slug":"è“æ¡¥æ¯","permalink":"https://www.codetool.top/tags/%E8%93%9D%E6%A1%A5%E6%9D%AF/"}]},{"title":"æµ·é‡æ•°æ®å»é‡-ç”±BitMapå¼•å‡ºçš„å¸ƒéš†è¿‡æ»¤å™¨","slug":"æµ·é‡æ•°æ®å»é‡-ç”±BitMapå¼•å‡ºçš„å¸ƒéš†è¿‡æ»¤å™¨","date":"2020-02-28T02:51:06.000Z","updated":"2020-03-03T15:50:25.535Z","comments":true,"path":"article/æµ·é‡æ•°æ®å»é‡-ç”±BitMapå¼•å‡ºçš„å¸ƒéš†è¿‡æ»¤å™¨/","link":"","permalink":"https://www.codetool.top/article/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E5%8E%BB%E9%87%8D-%E7%94%B1BitMap%E5%BC%95%E5%87%BA%E7%9A%84%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š é‚£äº›æƒŠè‰³çš„ç®—æ³•ä»¬ï¼ˆä¸€ï¼‰â€”â€”å¸ƒéš†è¿‡æ»¤å™¨_C/C++_xinzhongtianxiaçš„åšå®¢-CSDNåšå®¢ è¯¦è§£å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†ã€ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ - ç®€ä¹¦ 1 æ¦‚è¿°æ˜¨å¤©å­¦ä¹ äº†BitMapè¿™ç§æ•°æ®ç»“æ„ï¼ˆç®—æ³•ï¼‰ï¼Œé“¾æ¥ï¼šæµ·é‡æ•°æ®ç®—æ³•-BitMapä»‹ç»å’Œå®ç° ç„¶è€ŒBitMapä¹Ÿå­˜åœ¨ç€ä¸€äº›é—®é¢˜ï¼š å½“æ ·æœ¬åˆ†å¸ƒæåº¦ä¸å‡åŒ€çš„æ—¶å€™ï¼ŒBitMapä¼šé€ æˆå¾ˆå¤§ç©ºé—´ä¸Šçš„æµªè´¹ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ä½ æœ‰10ä¸ªæ•°ï¼Œåˆ†åˆ«æ˜¯1ã€2ã€3ã€4ã€5ã€6ã€7ã€8ã€99999999999ï¼›é‚£ä¹ˆä½ ä¸å¾—ä¸ç”¨99999999999ä¸ªbitä½å»å®ç°ä½ çš„BitMap,è€Œè¿™ä¸ªBitMapçš„ä¸­é—´ç»å¤§å¤šæ•°ä½ç½®éƒ½æ˜¯0ï¼Œå¹¶ä¸”æ°¸è¿œä¸ä¼šç”¨åˆ°ï¼Œè¿™æ˜¾ç„¶æ˜¯æåº¦ä¸åˆ’ç®—çš„ã€‚ å½“å…ƒç´ ä¸æ˜¯æ•´å‹çš„æ—¶å€™ï¼ŒBitMapå°±ä¸é€‚ç”¨äº†ã€‚æƒ³æƒ³çœ‹ï¼Œä½ æ‹¿åˆ°çš„æ˜¯ä¸€å †urlï¼Œç„¶åå¦‚æœä½ æƒ³ç”¨BitMapåšå»é‡çš„è¯ï¼Œå…ˆå¾—æŠŠurlè½¬æ¢æˆintå‹ï¼Œåœ¨è½¬æ¢çš„è¿‡ç¨‹ä¸­éš¾å…æŸäº›urlä¼šè®¡ç®—å‡ºç›¸åŒçš„intå€¼ï¼Œäºæ˜¯BitMapçš„å‡†ç¡®æ€§å°±ä¼šé™ä½ã€‚ é‚£é’ˆå¯¹è¿™ä¸¤ç§æƒ…å†µæœ‰æ²¡æœ‰è§£å†³åŠæ³•å‘¢ï¼Ÿ ç¬¬ä¸€ç§åˆ†å¸ƒä¸å‡åŒ€çš„æƒ…å†µå¯ä»¥é€šè¿‡hashå‡½æ•°ï¼Œå°†å…ƒç´ éƒ½æ˜ å°„åˆ°ä¸€ä¸ªåŒºé—´èŒƒå›´å†…ï¼Œå‡å°‘å¤§æ®µåŒºé—´é—²ç½®é€ æˆçš„æµªè´¹ï¼Œè¿™å¾ˆç®€å•ï¼Œå–æ¨¡å°±å¥½äº†ï¼Œéš¾çš„æ˜¯å–æ¨¡ä¹‹åçš„å€¼ä¿è¯ä¸ç›¸åŒï¼Œå³ä¸å‘ç”Ÿhashå†²çªã€‚ ç¬¬äºŒç§æƒ…å†µï¼ŒæŠŠå­—ç¬¦ä¸²æ˜ å°„æˆæ•´æ•°æ˜¯å¿…è¦çš„ï¼Œé‚£ä¹ˆå”¯ä¸€è¦åšçš„å°±æ˜¯ä¿è¯æˆ‘ä»¬çš„hashå‡½æ•°å°½å¯èƒ½çš„å‡å°‘hashå†²çªï¼Œä¸€æ¬¡ä¸è¡Œæˆ‘å°±å¤šhashå‡ æ¬¡ï¼Œhashè¿˜æ˜¯å®¹æ˜“ç¢°æ’ï¼Œé‚£æˆ‘å°±æ‰©å¤§æ•°ç»„çš„èŒƒå›´ï¼Œä½¿hashå€¼å°½å¯èƒ½çš„å‡åŒ€åˆ†å¸ƒï¼Œå‡å°‘hashå†²çªçš„æ¦‚ç‡ã€‚ åŸºäºè¿™ç§æ€æƒ³ï¼ŒBloomFilterï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰è¯ç”Ÿäº†ã€‚ 2 åŸç†æ¯”å¦‚ç°åœ¨æœ‰10000ä¸ªå­—ç¬¦ä¸²ï¼Œè¦è¿›è¡Œå»é‡æ“ä½œï¼Œå¦‚æœç”¨bitmapçš„æ–¹æ³•å°†å­—ç¬¦ä¸²çš„å“ˆå¸Œå€¼å¯¹åº”åˆ°ä¸€ä¸ªbitï¼Œç”±äºå­—ç¬¦ä¸²çš„å“ˆå¸Œå€¼ä¸æ˜¯å”¯ä¸€çš„ï¼Œå¯èƒ½å‡ºç°å“ˆå¸Œå†²çªï¼Œè€Œè‹¥ä¸¤ä¸ªå­—ç¬¦ä¸²å“ˆå¸Œå†²çªäº†ï¼Œå°±ä¼šå¯¹åº”åˆ°åŒä¸€ä¸ªbitä¸Šï¼Œbitmapå°±ä¼šè¯¯åˆ¤è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸ç­‰ã€‚ è§£å†³çš„æ–¹æ³•å°±æ˜¯ï¼Œä½¿ç”¨å¤šä¸ªå“ˆå¸Œå‡½æ•°ï¼Œä¾‹å¦‚ä½¿ç”¨ä¸‰ä¸ªå“ˆå¸Œå‡½æ•°ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²å¯ä»¥è®¡ç®—å‡ºä¸‰ä¸ªå“ˆå¸Œæ˜ å°„ï¼Œå°†æ‰€æœ‰æ˜ å°„çš„ä½æ ‡ä¸º1ï¼Œè€Œåˆ¤æ–­æœ‰æ²¡æœ‰é‡å¤çš„æ–¹æ³•æ˜¯ï¼Œåªè¦å¾—åˆ°çš„ä¸‰ä¸ªæ˜ å°„ä½ä¸æ˜¯éƒ½å·²ä¸º1äº†ï¼Œå°±è®¤ä¸ºè¯¥å­—ç¬¦ä¸²æ²¡æœ‰é‡å¤ã€‚ å¯è§å¸ƒéš†è¿‡æ»¤å™¨ç›¸è¾ƒäºBitMapåŠŸèƒ½è¾ƒå•ä¸€ï¼Œæ— æ³•æ ¹æ®å·²æœ‰çš„ä½å€’æ¨å›åŸå§‹æ•°æ®ï¼Œåªèƒ½ç”¨ä½œæŸ¥è¯¢å»é‡åŠŸèƒ½ã€‚ ä½†è¿™ä¹Ÿä¸æ„å‘³ç€å¸ƒéš†è¿‡æ»¤å™¨å°±ä¸ä¼šè¯¯åˆ¤ï¼Œå‡å¦‚ä¸€ä¸ªæ–°çš„æ— é‡å¤çš„å­—ç¬¦ä¸²ï¼Œæ˜ å°„çš„ä½åœ¨ä¹‹å‰å°±è¢«å…¶ä»–å­—ç¬¦ä¸²å¾—åˆ°çš„å“ˆå¸Œæ˜ å°„éƒ½æ ‡ä¸ºäº†1ï¼Œé‚£ä¹ˆå¸ƒéš†è¿‡æ»¤å™¨ä¹Ÿè®¤ä¸ºå®ƒæ˜¯é‡å¤çš„ã€‚ä¸è¿‡è¯¯åˆ¤çš„æ¦‚ç‡è¾ƒå°ï¼ˆæ¯”BitMapå°å¤šäº†ï¼‰ï¼Œåœ¨å¤§éƒ¨åˆ†ç”Ÿäº§ç¯å¢ƒä¸‹æ˜¯å¯ä»¥æ¥å—çš„ï¼ˆå› ä¸ºæœ‰çš„æ—¶å€™ä¸é‡å¤çš„å­—ç¬¦ä¸²æ²¡å¤šå°‘ï¼Œåè€Œé‡å¤çš„å­—ç¬¦ä¸²å äº†å¤§å¤šæ•°ï¼Œä¸»è¦ç›®çš„åªæ˜¯ä¸ç”¨åå¤å¤„ç†é‡å¤çš„å­—ç¬¦ä¸²ï¼‰ã€‚ 3 å‚æ•°è°ƒä¼˜ç”±ä¸Šé¢çš„åŸç†å¯çŸ¥ï¼Œå¯¹äºå¸ƒéš†è¿‡æ»¤å™¨æ€§èƒ½æœ€é‡è¦çš„å‚æ•°æœ‰ä¸¤ä¸ªï¼š bitæ•°ç»„çš„å¤§å°ï¼Œbitè¶Šå¤šä¸”å“ˆå¸Œæ˜ å°„åˆ†å¸ƒå‡åŒ€çš„æ¡ä»¶ä¸‹ï¼Œå“ˆå¸Œå†²çªçš„æ¦‚ç‡æ˜¯è¶Šä½çš„ã€‚ å“ˆå¸Œå‡½æ•°çš„ä¸ªæ•°ï¼Œå“ˆå¸Œå‡½æ•°çš„ä¸ªæ•°å¦‚æœå¤ªå°‘ï¼Œæ›´å®¹æ˜“å†²çªï¼Œè€Œå¦‚æœå“ˆå¸Œå‡½æ•°çš„ä¸ªæ•°å¤ªå¤šï¼Œåˆ™å°†bitæ•°ç»„å†…çš„å…ƒç´ æ ‡ä¸º1çš„è¿›åº¦ä¹Ÿä¼šåŠ å¿«ï¼Œä»è€Œé€ æˆå“ˆå¸Œå†²çªã€‚æ‰€ä»¥å“ˆå¸Œå‡½æ•°çš„ä¸ªæ•°éœ€è¦å‡è¡¡ã€‚ å…³äºå…·ä½“çš„è¯¯åˆ¤ç‡è®¡ç®—ç»´åŸºç™¾ç§‘ç»™å‡ºäº†è®¡ç®—è¿‡ç¨‹ï¼šBloom filter - Wikipedia å¯¹äºä¸€ä¸ªæœŸæœ›çš„è¯¯åˆ¤ç‡pï¼ŒæœŸæœ›çš„æ’å…¥å…ƒç´ ä¸ªæ•°nï¼Œæœ€ä½³æ•°ç»„bitä¸ªæ•°må’Œå“ˆå¸Œå‡½æ•°æ•°é‡kçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š æ‰€ä»¥å½“æ„é€ ä¸€ä¸ªå¸ƒéš†è¿‡æ»¤å™¨çš„æ—¶å€™å¹¶ä¸”å¸Œæœ›è¯¯åˆ¤ç‡å¯æ§æ—¶é€šå¸¸è¦ä¼ å…¥æœŸæœ›çš„è¯¯åˆ¤ç‡ã€æœŸæœ›çš„æ’å…¥å…ƒç´ ä¸ªæ•°ç­‰å‚æ•°ã€‚ è°·æ­Œæœ‰javaä¸­BloomFilterçš„å®ç°ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±å»ç ”ç©¶ä¸€ä¸‹ï¼š &lt;dependency> &lt;groupId>com.google.guava&lt;/groupId> &lt;artifactId>guava&lt;/artifactId> &lt;version>25.1-jre&lt;/version> &lt;/dependency> 4 åº”ç”¨ é‡å¤URLçš„è¿‡æ»¤ é‚®ç®±é»‘åå•çš„å»é‡ æ¨èå»é‡ Redisé˜²æ­¢ç¼“å­˜ç©¿é€å°±å¯ä»¥ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Œæ—¥åå†è°ˆã€‚","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"æµ·é‡æ•°æ®","slug":"æµ·é‡æ•°æ®","permalink":"https://www.codetool.top/tags/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE/"}]},{"title":"leetcode9-å›æ–‡æ•°","slug":"leetcode9-å›æ–‡æ•°","date":"2020-02-27T17:58:40.000Z","updated":"2020-02-27T18:03:18.927Z","comments":true,"path":"article/leetcode9-å›æ–‡æ•°/","link":"","permalink":"https://www.codetool.top/article/leetcode9-%E5%9B%9E%E6%96%87%E6%95%B0/","excerpt":"","text":"1 åŸé¢˜åˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦æ˜¯å›æ–‡æ•°ã€‚å›æ–‡æ•°æ˜¯æŒ‡æ­£åºï¼ˆä»å·¦å‘å³ï¼‰å’Œå€’åºï¼ˆä»å³å‘å·¦ï¼‰è¯»éƒ½æ˜¯ä¸€æ ·çš„æ•´æ•°ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š 121è¾“å‡ºï¼š true ç¤ºä¾‹2: è¾“å…¥ï¼š -121è¾“å‡ºï¼š falseè§£é‡Šï¼š ä»å·¦å‘å³è¯», ä¸º -121 ã€‚ ä»å³å‘å·¦è¯», ä¸º 121- ã€‚å› æ­¤å®ƒä¸æ˜¯ä¸€ä¸ªå›æ–‡æ•°ã€‚ ç¤ºä¾‹3: è¾“å…¥ï¼š 10è¾“å‡ºï¼š falseè§£é‡Šï¼š ä»å³å‘å·¦è¯», ä¸º 01 ã€‚å› æ­¤å®ƒä¸æ˜¯ä¸€ä¸ªå›æ–‡æ•°ã€‚ è¿›é˜¶: ä½ èƒ½ä¸å°†æ•´æ•°è½¬ä¸ºå­—ç¬¦ä¸²æ¥è§£å†³è¿™ä¸ªé—®é¢˜å—ï¼Ÿ 2 è§£æ³•2.1 æ€æƒ³é™¤10å¾—ä½™å¯ä»¥å¾—åˆ°æœ«ä½ï¼Œé™¤10nåˆ™å¯ä»¥å¾—åˆ°é¦–ä½ï¼ˆnä¸ºæ•°å­—é•¿åº¦ï¼‰ã€‚ 2.2 ä»£ç class Solution { public boolean isPalindrome(int x) { if (x &lt; 0) return false; int div = 1; while (x / div >= 10) div *= 10; while (x > 0) { int left = x / div; int right = x % 10; if (left != right) return false; x = (x % div) / 10; div /= 100; } return true; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"SpringMVCä½¿ç”¨-ç»­","slug":"SpringMVCä½¿ç”¨-ç»­","date":"2020-02-27T15:35:47.000Z","updated":"2020-02-27T15:37:39.072Z","comments":true,"path":"article/SpringMVCä½¿ç”¨-ç»­/","link":"","permalink":"https://www.codetool.top/article/SpringMVC%E4%BD%BF%E7%94%A8-%E7%BB%AD/","excerpt":"","text":"1 è½¬å‘å’Œé‡å®šå‘é™¤äº†è§†å›¾è§£æå™¨é…åˆè¿”å›å­—ç¬¦ä¸²çš„æ–¹æ³•ï¼š 1.1 ä½¿ç”¨requestå’Œresponse@RequestMapping(\"/test\") public void testRedir(HttpServletRequest request, HttpServletResponse response) throws Exception { //ä½¿ç”¨requestè½¬å‘é¡µé¢ request.getRequestDispatcher(\"/WEB-INF/pages/success.jsp\") .forward(request,response); //ä½¿ç”¨responseé‡å®šå‘ response.sendRedirect(\"testRetrunString\"); //ä½¿ç”¨responseæŒ‡å®šå“åº”ç»“æœ response.setCharacterEncoding(\"utf-8\"); response.setContentType(\"application/json;charset=utf-8\"); response.getWriter().write(\"json ä¸²\"); } 1.2 ä½¿ç”¨è¿”å›å­—ç¬¦ä¸²å…³é”®å­—@RequestMapping(\"/testForward\") public String testForward() { System.out.println(\"AccountController çš„ testForward æ–¹æ³•æ‰§è¡Œäº†ã€‚ã€‚ã€‚ã€‚\"); return \"forward:/WEB-INF/pages/success.jsp\"; } @RequestMapping(\"/testRedirect\") public String testRedirect() { System.out.println(\"AccountController çš„ testRedirect æ–¹æ³•æ‰§è¡Œäº†ã€‚ã€‚ã€‚ã€‚\"); return \"redirect:testReturnModelAndView\"; } 2 ResponseBody å“åº” json æ•°æ®è¯¥æ³¨è§£ç”¨äºå°† Controller çš„æ–¹æ³•è¿”å›çš„å¯¹è±¡ï¼Œé€šè¿‡ HttpMessageConverter æ¥å£è½¬æ¢ä¸ºæŒ‡å®šæ ¼å¼çš„æ•°æ®å¦‚ï¼šjson,xml ç­‰ï¼Œé€šè¿‡ Response å“åº”ç»™å®¢æˆ·ç«¯ Springmvc é»˜è®¤ç”¨ MappingJacksonHttpMessageConverter å¯¹ json æ•°æ®è¿›è¡Œè½¬æ¢ï¼Œéœ€è¦åŠ å…¥jackson çš„åŒ…ã€‚ &lt;dependency> &lt;groupId>com.fasterxml.jackson.core&lt;/groupId> &lt;artifactId>jackson-databind&lt;/artifactId> &lt;version>2.9.0&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>com.fasterxml.jackson.core&lt;/groupId> &lt;artifactId>jackson-core&lt;/artifactId> &lt;version>2.9.0&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>com.fasterxml.jackson.core&lt;/groupId> &lt;artifactId>jackson-annotations&lt;/artifactId> &lt;version>2.9.0&lt;/version> &lt;/dependency> ç¤ºä¾‹ï¼š @RequestMapping(\"/testResponseJson\") public @ResponseBody Account testResponseJson(@RequestBody Account account) { System.out.println(\"å¼‚æ­¥è¯·æ±‚ï¼š\"+account); return account; } å‰ä¸€ä¸ª@ResponseBodyè¿”å›çš„æ—¶å€™è½¬æ¢ä¸ºjsonï¼Œåä¸€ä¸ª@ResponseBodyæ¥æ”¶è¯·æ±‚æ—¶è½¬æ¢ä¸ºå¯¹è±¡ã€‚ 3 æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½3.1 æ–‡ä»¶ä¸Šä¼ è¿™é‡Œçš„æ–‡ä»¶ä¸Šä¼ ç”¨çš„æ˜¯multipart/form-data å½“ form è¡¨å•çš„ enctype å–å€¼ä¸º Mutilpart/form-data æ—¶ï¼Œè¯·æ±‚æ­£æ–‡å†…å®¹å°±å˜æˆï¼šæ¯ä¸€éƒ¨åˆ†éƒ½æ˜¯ MIME ç±»å‹æè¿°çš„æ­£æ–‡ -----------------------------7de1a433602ac åˆ†ç•Œç¬¦ Content-Disposition: form-data; name=&quot;userName&quot; åè®®å¤´ aaa åè®®çš„æ­£æ–‡ -----------------------------7de1a433602ac Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;C:\\Users\\admin\\Desktop\\fileupload_demofile\\b.txt&quot; Content-Type: text/plain åè®®çš„ç±»å‹ï¼ˆMIME ç±»å‹ï¼‰ bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb -----------------------------7de1a433602ac--Apache Commomsé‡Œçš„ä¸¤ä¸ªå·¥å…·ç±» commons-fileupload-xxx.jar commons-io-xxx.jar ï¼ˆå¦‚æœæ˜¯mavené¡¹ç›®åªéœ€è¦æ·»åŠ commons-fileuploadä¾èµ–ï¼‰ &lt;dependency> &lt;groupId>commons-fileupload&lt;/groupId> &lt;artifactId>commons-fileupload&lt;/artifactId> &lt;version>1.3.3&lt;/version> &lt;/dependency> é…ç½®æ–‡ä»¶ä¸Šä¼ å¤„ç†Bean spring-mvc.xmlé…ç½® &lt;!-- é…ç½®æ–‡ä»¶ä¸Šä¼ è§£æå™¨ --> &lt;bean id=\"multipartResolver\" class=\"org.springframework.web.multipart.commons.CommonsMultipartResolver\"> &lt;!-- è®¾ç½®ä¸Šä¼ æ–‡ä»¶çš„æœ€å¤§å°ºå¯¸ä¸º 5MB --> &lt;property name=\"maxUploadSize\"> &lt; value>5242880&lt;/value> &lt;/property> &lt;/bean> æ–‡ä»¶ä¸Šä¼ å¤„ç†Controller @Controller @RequestMapping(\"/file\") public class FileController { @RequestMapping(\"/initFileUpload\") public String initFileUpload(){ return \"FileUpload\"; } @RequestMapping() public String fileUpLoad(String name, @RequestParam(\"file\")CommonsMultipartFile file, HttpSession session){ if(!file.isEmpty()){ String path = session.getServletContext().getRealPath(\"/upload\"); String fileName = file.getOriginalFilename(); String fileType = fileName.substring(fileName.lastIndexOf(\".\")); File targetFile = new File(path,new Date().getTime()+fileType); try { file.getFileItem().write(targetFile); }catch (Exception e) { e.printStackTrace(); } } return \"FileUpload\"; } } 3.2 æ–‡ä»¶ä¸‹è½½å¯å…ˆè·å–ä¸‹è½½æ–‡ä»¶çš„è¾“å…¥æµï¼Œå¹¶å°†è¾“å…¥æµè¯»å…¥ç¼“å†²æµBufferedInputStreamï¼Œæœ€åå°†ç¼“å†²æµé€šè¿‡å¾ªç¯çš„æ–¹å¼å†™å…¥åˆ°responseçš„è¾“å‡ºæµå®ç°æ–‡ä»¶ä¸‹è½½åŠŸèƒ½ã€‚ public void fileDownLoad(HttpSession session, HttpServletResponse response,String fileName,boolean isOnline) throws Exception{ String path = session.getServletContext().getRealPath(\"/upload\")+\"\\\\\"+fileName; File file = new File(path); System.out.println(path); if(!file.exists()){ response.sendError(404,\"æ‚¨è¦ä¸‹è½½çš„æ–‡ä»¶æ²¡æ‰¾åˆ°\"); return; } BufferedInputStream bufIn = new BufferedInputStream(new FileInputStream(file)); byte[] buff = new byte[1024]; int len = -1; response.reset(); if(isOnline){ URL u = new URL(\"file:///\"+path); response.setContentType(u.openConnection().getContentType()); response.setHeader(\"Content-Disposition\",\"inline;filename=\"+fileName); }else{ response.setContentType(\"application/x-msdownload\"); response.setHeader(\"Content-Disposition\",\"attachment;filename=\"+fileName); } OutputStream out = response.getOutputStream(); while ((len=bufIn.read(buff))!=-1){ out.write(buff,0,len); out.flush(); } bufIn.close(); out.close(); } 4 å¼‚å¸¸å¤„ç†ç³»ç»Ÿçš„ daoã€serviceã€controller å‡ºç°éƒ½é€šè¿‡ throws Exception å‘ä¸ŠæŠ›å‡ºï¼Œæœ€åç”± SpringMVC å‰ç«¯æ§åˆ¶å™¨äº¤ç”±å¼‚å¸¸å¤„ç†å™¨è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚ ç¼–å†™è‡ªå®šä¹‰å¼‚å¸¸ç±» public class SysException extends Exception{ //å­˜å‚¨æç¤ºä¿¡æ¯ private String message; @Override public String getMessage() { return message; } public void setMessage(String message) { this.message = message; } public SysException(String message) { this.message = message; } } ç¼–å†™å¼‚å¸¸å¤„ç†å™¨ public class SysExceptionResolver implements HandlerExceptionResolver { @Override public ModelAndView resolveException(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) { //è·å–å¼‚å¸¸å¯¹è±¡ SysException e = null; if(ex instanceof SysException){ e = (SysException) ex; }else { e = new SysException(\"ç³»ç»Ÿæ­£åœ¨ç»´æŠ¤\"); } ModelAndView mv = new ModelAndView(); mv.addObject(\"errorMsg\",e.getMessage()); mv.setViewName(\"error\"); return mv; } } é…ç½®å¼‚å¸¸å¤„ç†å™¨ï¼ˆè·³è½¬åˆ°æç¤ºé¡µé¢ï¼‰ &lt;!-- é…ç½®å¼‚å¸¸å¤„ç†å™¨ --> &lt;bean id=\"sysExceptionResolver\" class=\"com.rhett.exception.SysExceptionResolver\">&lt;/bean> 5 SpringMVCä¸­çš„æ‹¦æˆªå™¨ è¿‡æ»¤å™¨æ˜¯ servlet è§„èŒƒä¸­çš„ä¸€éƒ¨åˆ†ï¼Œä»»ä½• java web å·¥ç¨‹éƒ½å¯ä»¥ä½¿ç”¨ã€‚ æ‹¦æˆªå™¨æ˜¯ SpringMVC æ¡†æ¶è‡ªå·±çš„ï¼Œåªæœ‰ä½¿ç”¨äº† SpringMVC æ¡†æ¶çš„å·¥ç¨‹æ‰èƒ½ç”¨ã€‚ è¿‡æ»¤å™¨åœ¨ url-pattern ä¸­é…ç½®äº†/*ä¹‹åï¼Œå¯ä»¥å¯¹æ‰€æœ‰è¦è®¿é—®çš„èµ„æºæ‹¦æˆªã€‚ æ‹¦æˆªå™¨å®ƒæ˜¯åªä¼šæ‹¦æˆªè®¿é—®çš„æ§åˆ¶å™¨æ–¹æ³•ï¼Œå¦‚æœè®¿é—®çš„æ˜¯ jspï¼Œhtml,css,image æˆ–è€… js æ˜¯ä¸ä¼šè¿›è¡Œæ‹¦æˆªçš„ã€‚ å®ƒä¹Ÿæ˜¯ AOP æ€æƒ³çš„å…·ä½“åº”ç”¨ã€‚ æˆ‘ä»¬è¦æƒ³è‡ªå®šä¹‰æ‹¦æˆªå™¨ï¼Œ è¦æ±‚å¿…é¡»å®ç° HandlerInterceptor æ¥å£ã€‚ public class HandlerInterceptorDemo1 implements HandlerInterceptor { @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception { System.out.println(\"preHandle æ‹¦æˆªå™¨æ‹¦æˆªäº†\"); return true; } @Override public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler,ModelAndView modelAndView) throws Exception { System.out.println(\"postHandle æ–¹æ³•æ‰§è¡Œäº†\"); } @Override public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception { System.out.println(\"afterCompletion æ–¹æ³•æ‰§è¡Œäº†\"); } } HandlerInterceptoræ¥å£ä¸­çš„æ–¹æ³•ï¼š preHandleæ–¹æ³•æ˜¯controlleræ–¹æ³•æ‰§è¡Œå‰æ‹¦æˆªçš„æ–¹æ³• å¯ä»¥ä½¿ç”¨requestæˆ–è€…responseè·³è½¬åˆ°æŒ‡å®šçš„é¡µé¢ return trueæ”¾è¡Œï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œå¦‚æœæ²¡æœ‰æ‹¦æˆªå™¨ï¼Œæ‰§è¡Œcontrollerä¸­çš„æ–¹æ³•ã€‚ return falseä¸æ”¾è¡Œï¼Œä¸ä¼šæ‰§è¡Œcontrollerä¸­çš„æ–¹æ³•ã€‚ postHandleæ˜¯controlleræ–¹æ³•æ‰§è¡Œåæ‰§è¡Œçš„æ–¹æ³•ï¼Œåœ¨JSPè§†å›¾æ‰§è¡Œå‰ã€‚ å¯ä»¥ä½¿ç”¨requestæˆ–è€…responseè·³è½¬åˆ°æŒ‡å®šçš„é¡µé¢ å¦‚æœæŒ‡å®šäº†è·³è½¬çš„é¡µé¢ï¼Œé‚£ä¹ˆcontrolleræ–¹æ³•è·³è½¬çš„é¡µé¢å°†ä¸ä¼šæ˜¾ç¤ºã€‚ postHandleæ–¹æ³•æ˜¯åœ¨JSPæ‰§è¡Œåæ‰§è¡Œ requestæˆ–è€…responseä¸èƒ½å†è·³è½¬é¡µé¢äº† é…ç½®æ‹¦æˆªå™¨ï¼š &lt;!-- é…ç½®æ‹¦æˆªå™¨ --> &lt;mvc:interceptors> &lt;mvc:interceptor> &lt;!-- è¦æ‹¦æˆªçš„æ–¹æ³• --> &lt;mvc:mapping path=\"/**\"/> &lt;!-- ä¸è¦æ‹¦æˆªçš„æ–¹æ³• --> &lt;!-- &lt;mvc:exclude-mapping path=\"\"/> --> &lt;!-- é…ç½®æ‹¦æˆªå™¨å¯¹è±¡--> &lt;bean id=\"handlerInterceptorDemo1\" class=\"com.rhett.interceptor.MyInterceptor1\">&lt;/bean> &lt;/mvc:interceptor> &lt;/mvc:interceptors> è‹¥é…ç½®å¤šä¸ªæ‹¦æˆªå™¨å½¢æˆæ‹¦æˆªå™¨é“¾ï¼ŒæŒ‰é…ç½®é¡ºåºæ‰§è¡Œã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"SpringMVC","slug":"SpringMVC","permalink":"https://www.codetool.top/tags/SpringMVC/"}]},{"title":"æµ·é‡æ•°æ®ç®—æ³•-BitMapä»‹ç»å’Œå®ç°","slug":"æµ·é‡æ•°æ®ç®—æ³•-BitMapä»‹ç»å’Œå®ç°","date":"2020-02-27T09:22:49.000Z","updated":"2020-02-27T11:48:23.430Z","comments":true,"path":"article/æµ·é‡æ•°æ®ç®—æ³•-BitMapä»‹ç»å’Œå®ç°/","link":"","permalink":"https://www.codetool.top/article/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E7%AE%97%E6%B3%95-BitMap%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%AE%9E%E7%8E%B0/","excerpt":"","text":"ä½œä¸ºä¸€ä¸ªæœ‰ç´ è´¨çš„ç¨‹åºå‘˜ï¼Œåœ¨é¢è¯•ä¸­ï¼ˆä¸æ˜¯ï¼‰ éš¾å…ä¼šé‡åˆ°æµ·é‡æ•°æ®ç›¸å…³çš„é—®é¢˜ï¼Œä¹‹å‰æœ‰æ³¨æ„è¿‡java.utilä¸‹é¢æœ‰ä¸€ä¸ªBitSetæ•°æ®ç»“æ„ï¼Œä½†ä¸æ˜¯å¾ˆæ˜ç™½æ˜¯åšä»€ä¹ˆç”¨çš„ã€‚ä»Šå¤©å°±æ¥ç ”ç©¶ä¸€ä¸‹å®ƒèƒŒåçš„ç®—æ³•â€”â€”BitMapï¼ˆä½å›¾ï¼‰ç®—æ³•ã€‚ 1 BitMapçš„æ¦‚å¿µå…³äºBitMapçš„ä»‹ç»å’Œå®ç°æœ‰ä¸€ç¯‡å¾®ä¿¡æ–‡ç« å·²ç»è®²çš„å¾ˆæ¸…æ¥šäº†ï¼š æ¼«ç”»ï¼šBitmapç®—æ³• æ•´åˆç‰ˆ ä¸»è¦çš„æ€æƒ³å°±æ˜¯æŠŠæ•°æ®å¯¹åº”åˆ°bitä½ä¸­ï¼Œä»è€Œå¯ä»¥å®ç°å»é‡ã€æŸ¥æ‰¾ã€æ’åºç­‰åŠŸèƒ½ã€‚ æˆ‘è¿™ç¯‡æ–‡ç« å°±ä¸å¤åˆ¶ç²˜è´´äº† ï¼ˆå…¨æ˜¯å›¾ç‰‡ç²˜è´´ä¸ªé”¤å­ï¼‰ï¼Œä¸»è¦çœ‹çœ‹javaä¸­BitMapçš„å®ç°-BitSet 2 BitSetå®ç°2.1 é‡è¦å†…éƒ¨å­—æ®µ//ç”¨äºå­˜å‚¨æ•°æ® private long[] words; è¿™ä¸ªå­—æ®µè¯´æ˜äº†åº•å±‚æ˜¯longæ•°ç»„ï¼Œè€Œä¸€ä¸ªlongæ˜¯8ä¸ªå­—èŠ‚ä¹Ÿå°±æ˜¯64ä½ã€‚è€Œä¸”åœ¨BitSetä¸­ï¼ŒæŠŠè¿™æ ·ä¸€ä¸ªlongå•å…ƒç§°ä¸ºâ€œå­—â€ï¼ˆwordï¼‰ã€‚ private transient int wordsInUse = 0; è¿™ä¸ªå­—æ®µä»£è¡¨ç›®å‰longæ•°ç»„ä¸­ä¸ä¸º0çš„å…ƒç´ çš„æœ€å¤§çš„ä¸‹æ ‡ã€‚ï¼ˆå°±æ˜¯ç›®å‰å®é™…ç”¨äº†å¤šå°‘ä¸ªå­—ï¼‰ 2.2 æ„é€ æ–¹æ³•2.2.1 BitSet()public BitSet() { initWords(BITS_PER_WORD); sizeIsSticky = false; } initWordsï¼Œçœ‹æ–¹æ³•åå°±æ˜¯åˆå§‹åŒ–wordsæ•°ç»„äº†ï¼Œè€Œåé¢çš„BITS_PER_WORDåº”è¯¥å°±æ˜¯é»˜è®¤å®¹é‡ã€‚sizeIsStickyçš„java docæè¿°å¤§æ¦‚æ„æ€æ˜¯åˆ¤æ–­è¿™ä¸ªbitsetæ˜¯ä¸æ˜¯ç”¨æˆ·æŒ‡å®šå®¹é‡åˆ›å»ºçš„ï¼Œå¦‚æœæ˜¯ç”¨æˆ·æŒ‡å®šäº†å®¹é‡ï¼Œåé¢å°±å°½å¯èƒ½ä¼šä¿æœ‰è¿™ä¸ªå®¹é‡ã€‚ private final static int ADDRESS_BITS_PER_WORD = 6; private final static int BITS_PER_WORD = 1 &lt;&lt; ADDRESS_BITS_PER_WORD; private void initWords(int nbits) { words = new long[wordIndex(nbits-1) + 1]; } private static int wordIndex(int bitIndex) { return bitIndex >> ADDRESS_BITS_PER_WORD; } ADDRESS_BITS_PER_WORDçš„æ„æ€å°±æ˜¯ä¸€ä¸ªå­—çš„åœ°å€å å¤šå°‘ä½ï¼Œå› ä¸ºæ˜¯64ä½æ˜¯2çš„6æ¬¡æ–¹ï¼Œè¿™é‡Œå°±æ˜¯6ã€‚è€ŒBITS_PER_WORDå°±æ˜¯ä¸€ä¸ªå­—å å¤šå°‘ä½ï¼Œè¿™é‡Œå°±æ˜¯1&lt;&lt;6å³64ä½ã€‚ initWordsçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼ è¿›å»çš„é»˜è®¤å®¹é‡ä¸ºBITS_PER_WORDï¼Œè¿™é‡Œçœ‹å½¢å‚å¯ä»¥çŸ¥é“è¿™ä¸ªå®¹é‡çš„å•ä½æ˜¯bitï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´é»˜è®¤æ„é€ å‡½æ•°åªä¼šåˆ›å»ºä¸€ä¸ªèƒ½å®¹çº³64ä½çš„bitSetã€‚ è€ŒBitSetæ€ä¹ˆçŸ¥é“64ä½éœ€è¦å¤šå°‘ä¸ªå­—(long)å‘¢ï¼Ÿå°±æ˜¯é€šè¿‡wordIndexå»è®¡ç®—ï¼Œå°†ä½å€¼é™¤ä»¥64ï¼Œå¹¶å‘ä¸Šå–æ•´ã€‚ åé¢wordIndexè¿˜ä¼šåœ¨ç´¢å¼•çš„æ—¶å€™ç”¨åˆ°ã€‚ 2.2.2 public BitSet(int nbits)public BitSet(int nbits) { // nbits can't be negative; size 0 is OK if (nbits &lt; 0) throw new NegativeArraySizeException(\"nbits &lt; 0: \" + nbits); initWords(nbits); sizeIsSticky = true; } è¿™ä¸ªæ„é€ æ–¹æ³•å°±æ˜¯ç”¨æˆ·è‡ªå·±æŒ‡å®šåˆå§‹å®¹é‡äº†ï¼Œè¿‡ç¨‹å’Œé»˜è®¤æ„é€ æ–¹æ³•ä¸€æ ·ï¼Œåªæ˜¯æŠŠsizeIsStickyè®¾ä¸ºäº†trueã€‚ 2.3 é‡è¦æ–¹æ³•2.3.1 setpublic void set(int bitIndex) { if (bitIndex &lt; 0) throw new IndexOutOfBoundsException(\"bitIndex &lt; 0: \" + bitIndex); //è®¡ç®—å‡ºå­—çš„ä¸‹æ ‡ int wordIndex = wordIndex(bitIndex); expandTo(wordIndex); words[wordIndex] |= (1L &lt;&lt; bitIndex); // Restores invariants //ä¿è¯ä¸€äº›æ¡ä»¶ checkInvariants(); } è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯æŠŠç›¸åº”çš„ä½è®¾ç½®ä¸ºtrueï¼ˆ1ï¼‰ã€‚è€ŒexpandTo()å°±æ˜¯æ‰©å®¹äº†ï¼Œè¦ä¿è¯æ•°ç»„å¤§å°è¦å¤§äºè¿™ä¸ªå­—çš„ä¸‹æ ‡ã€‚è¿™ä¸ªæ‰©å®¹æ–¹æ³•æˆ‘ä»¬æ”¾åˆ°åé¢å†çœ‹ã€‚ç„¶åå°±æ˜¯words[wordIndex] |= (1L &lt;&lt; bitIndex); ï¼Œè¿™é‡Œçš„1L &lt;&lt; bitIndexæ˜¯ä»€ä¹ˆå‘¢ï¼Œjavaå½“å·¦ç§»è¶…å‡ºä¸€å®šèŒƒå›´çš„æ—¶å€™ï¼Œå¯¹äºlongç±»å‹å°±æ˜¯å½“å·¦ç§»ä½æ•°å¤§äºç­‰äº1000000(64)çš„æ—¶å€™ï¼Œåªä¼šå–æœ€åä¸ƒä½ï¼Œä¹Ÿå°±æ˜¯1L &lt;&lt; bitIndexå®é™…ä¸Šå°±æ˜¯bitIndex%64ï¼Œç®—å‡ºäº†è¯¥ä½åœ¨å­—ä¸­çš„ä½ç½®ã€‚ç„¶åç”¨ä½æˆ–è¿ç®—å°†è¯¥ä½ç½®ä¸º1ã€‚ 2.3.2 clearpublic void clear(int bitIndex) { if (bitIndex &lt; 0) throw new IndexOutOfBoundsException(\"bitIndex &lt; 0: \" + bitIndex); int wordIndex = wordIndex(bitIndex); if (wordIndex >= wordsInUse) return; words[wordIndex] &amp;= ~(1L &lt;&lt; bitIndex); recalculateWordsInUse(); checkInvariants(); } è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯æŠŠç›¸åº”çš„ä½è®¾ç½®ä¸ºfalseï¼ˆ0ï¼‰ã€‚å’Œsetæ–¹æ³•è¿‡ç¨‹å¾ˆåƒï¼Œç”¨ä½ä¸è¿ç®—å°†å¯¹åº”çš„ä½ç½®ä¸º0ã€‚ 2.3.3 set(int fromIndex, int toIndex)public void set(int fromIndex, int toIndex) { //æ£€æŸ¥èŒƒå›´æ˜¯å¦æœ‰æ•ˆ checkRange(fromIndex, toIndex); if (fromIndex == toIndex) return; // Increase capacity if necessary // è·å–èµ·å§‹ä½ç½®å’Œç»“æŸä½ç½®å¯¹åº”çš„å­—çš„ä¸‹æ ‡ï¼Œå¿…è¦æ—¶æ‰©å®¹ int startWordIndex = wordIndex(fromIndex); int endWordIndex = wordIndex(toIndex - 1); expandTo(endWordIndex); long firstWordMask = WORD_MASK &lt;&lt; fromIndex; long lastWordMask = WORD_MASK >>> -toIndex; if (startWordIndex == endWordIndex) { // Case 1: One word words[startWordIndex] |= (firstWordMask &amp; lastWordMask); } else { // Case 2: Multiple words // Handle first word words[startWordIndex] |= firstWordMask; // Handle intermediate words, if any for (int i = startWordIndex+1; i &lt; endWordIndex; i++) words[i] = WORD_MASK; // Handle last word (restores invariants) words[endWordIndex] |= lastWordMask; } checkInvariants(); } WORD_MASKæ˜¯ä»€ä¹ˆå‘¢ï¼š /* Used to shift left or right for a partial word mask */ private static final long WORD_MASK = 0xffffffffffffffffL; å°±æ˜¯ä¸€ä¸ªå…¨1çš„longå‹ï¼Œè¿™ä¸ªå‡½æ•°å…ˆå°†èµ·å§‹ä½ç½®ä¸­çš„èµ·å§‹ä½å¾€åçš„ä½ç½®1ï¼Œç„¶åå°†ä¸­é—´çš„å­—å…¨éƒ¨è®¾ä¸ºå…¨1çš„ï¼Œæœ€åå°†ç»“æŸä½ç½®ä¸­çš„ç»“æŸä½å¾€å‰çš„ä½ç½®ç½®1ã€‚ 2.3.4 intersectsæœ‰äº†ä¸Šé¢é‚£äº›åŸºç¡€æ–¹æ³•ï¼Œå°±å¯ä»¥è¿›è¡Œä¸€äº›é€»è¾‘åˆ¤æ–­äº†ï¼š public boolean intersects(BitSet set) { for (int i = Math.min(wordsInUse, set.wordsInUse) - 1; i >= 0; i--) if ((words[i] &amp; set.words[i]) != 0) return true; return false; } æ¯”è¾ƒä¸¤ä¸ªBitSetæ˜¯å¦æœ‰ç›¸åŒçš„ä½è¢«ç½®1äº†ã€‚ 2.3.5 andpublic void and(BitSet set) { if (this == set) return; while (wordsInUse > set.wordsInUse) words[--wordsInUse] = 0; // Perform logical AND on words in common for (int i = 0; i &lt; wordsInUse; i++) words[i] &amp;= set.words[i]; recalculateWordsInUse(); checkInvariants(); } éå¸¸å¸¸ç”¨çš„ä¸è¿ç®—ï¼Œæ±‚ä¸¤ä¸ªé›†åˆçš„äº¤é›†ï¼Œéœ€è¦ä¸¤ä¸ªbitsetä¸­å¯¹åº”çš„ä½éƒ½è¢«ç½®1ã€‚è¿™é‡Œå°±æ˜¯é€å­—åšä¸è¿ç®—ã€‚ 2.3.6 orpublic void or(BitSet set) { if (this == set) return; int wordsInCommon = Math.min(wordsInUse, set.wordsInUse); if (wordsInUse &lt; set.wordsInUse) { ensureCapacity(set.wordsInUse); wordsInUse = set.wordsInUse; } // Perform logical OR on words in common for (int i = 0; i &lt; wordsInCommon; i++) words[i] |= set.words[i]; // Copy any remaining words if (wordsInCommon &lt; set.wordsInUse) System.arraycopy(set.words, wordsInCommon, words, wordsInCommon, wordsInUse - wordsInCommon); // recalculateWordsInUse() is unnecessary checkInvariants(); } éå¸¸å¸¸ç”¨çš„æˆ–è¿ç®—ï¼Œæ±‚ä¸¤ä¸ªé›†åˆçš„å¹¶é›†ï¼Œéœ€è¦ä¸¤ä¸ªbitsetä¸­ä»»æ„ä¸€ä½è¢«ç½®1ã€‚è¿™é‡Œå°±æ˜¯é€å­—åšæˆ–è¿ç®—ã€‚ 2.3.7 xorpublic void xor(BitSet set) { int wordsInCommon = Math.min(wordsInUse, set.wordsInUse); if (wordsInUse &lt; set.wordsInUse) { ensureCapacity(set.wordsInUse); wordsInUse = set.wordsInUse; } // Perform logical XOR on words in common for (int i = 0; i &lt; wordsInCommon; i++) words[i] ^= set.words[i]; // Copy any remaining words if (wordsInCommon &lt; set.wordsInUse) System.arraycopy(set.words, wordsInCommon, words, wordsInCommon, set.wordsInUse - wordsInCommon); recalculateWordsInUse(); checkInvariants(); } å¼‚æˆ–è¿ç®—ã€‚æ±‚ä¸åŒæ—¶åœ¨ä¸¤ä¸ªé›†åˆå†…çš„å…ƒç´ ã€‚ 2.4 æ‰©å®¹æœ€åæ¥çœ‹æ‰©å®¹ private void expandTo(int wordIndex) { int wordsRequired = wordIndex+1; if (wordsInUse &lt; wordsRequired) { ensureCapacity(wordsRequired); wordsInUse = wordsRequired; } } expandToæ›´æ–°äº†wordsInUseï¼ŒçœŸæ­£çš„æ‰©å®¹åœ¨ensureCapacityé‡Œé¢ private void ensureCapacity(int wordsRequired) { if (words.length &lt; wordsRequired) { // åˆ†é…ä¸¤å€æ•°ç»„å¤§å°æˆ–éœ€è¦çš„æ•°ç»„å¤§å°ä¸­è¾ƒå¤§çš„é‚£ä¸ªã€‚ int request = Math.max(2 * words.length, wordsRequired); words = Arrays.copyOf(words, request); sizeIsSticky = false; } } 3 ä½¿ç”¨å®ä¾‹è¿™æ ·çœ‹æ¥ï¼ŒBitSetå¥½åƒåªèƒ½å­˜å‚¨æ•°å€¼ç±»å‹çš„æ•°æ®ï¼Œå®é™…ä¸Šéæ•°å€¼ç±»å‹å¯ä»¥ä½¿ç”¨å“ˆå¸Œç æˆ–è‡ªå®šçš„å“ˆå¸Œæ˜ å°„å­˜å‚¨ï¼Œä½†è¦ä¿è¯å“ˆå¸Œç åªèƒ½å”¯ä¸€ç¡®å®šä¸€ä¸ªå…ƒç´ ã€‚ 3.1 å»é‡public static void containChars(String str) { BitSet used = new BitSet(); for (int i = 0; i &lt; str.length(); i++) used.set(str.charAt(i)); // set bit for char StringBuilder sb = new StringBuilder(); sb.append(\"[\"); int size = used.size(); for (char i = 'a'; i &lt;= 'z'; i++) { if (used.get(i)) { sb.append((char) i); } } sb.append(\"]\"); System.out.println(sb.toString()); } public static void main(String[] args) { containChars(\"abcdfadsaomdosmdfodsingodsbnafgudbgiub\"); } (é€šå¸¸æ˜¯éå†bitsetä¸­æ‰€æœ‰çš„ä½è¿›è¡Œå»é‡ï¼Œè¿™é‡Œå› ä¸ºå­—æ¯æœ‰é™å¯ä»¥éå†å­—æ¯) 3.2 æ’åºæ’åºä¹Ÿæ˜¯éå†bitsetä¸­æ‰€æœ‰çš„ä½ï¼Œä½†æ˜¯å¯¹äºå“ˆå¸Œç å­˜å‚¨çš„å¹¶æ²¡æœ‰æ’åºä½œç”¨ã€‚å®é™…ä¸Šå°±æ˜¯ç”¨ç©ºé—´æ¢æ—¶é—´ã€‚ public static void main(String[] args) { BitSet used = new BitSet(); used.set(45); used.set(16); used.set(78); used.set(23); used.set(44); used.set(11); used.set(98); for(int i = 0;i&lt;used.size();i++){ if(used.get(i)) System.out.print(i+\" \"); } } 3.3 æŸ¥è¯¢ç»™40äº¿ä¸ªä¸é‡å¤çš„unsigned intçš„æ•´æ•°ï¼Œæ²¡æœ‰æ’è¿‡åºï¼Œç„¶åå†ç»™ä¸€ä¸ªæ•°ï¼Œå¦‚æœå¿«é€Ÿåˆ¤æ–­è¿™ä¸ªæ•°æ˜¯å¦åœ¨é‚£40äº¿ä¸ªæ•°å½“ä¸­ï¼Ÿ ä¸€ä¸ªä¸€ä¸ªsetè¿›å»ï¼Œç„¶åç”¨getåˆ¤æ–­æœ‰æ²¡æœ‰ã€‚ ï¼ˆsetå®Œä¹‹åè¿™ä¸ªæ•°æ®ç»“æ„å°±å¯å¤ç”¨äº†ï¼‰","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"æµ·é‡æ•°æ®","slug":"æµ·é‡æ•°æ®","permalink":"https://www.codetool.top/tags/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE/"}]},{"title":"SpringMVCæ¦‚è¿°å’Œä½¿ç”¨å…¥é—¨","slug":"SpringMVCæ¦‚è¿°å’Œä½¿ç”¨å…¥é—¨","date":"2020-02-27T09:05:01.000Z","updated":"2020-02-27T09:08:52.689Z","comments":true,"path":"article/SpringMVCæ¦‚è¿°å’Œä½¿ç”¨å…¥é—¨/","link":"","permalink":"https://www.codetool.top/article/SpringMVC%E6%A6%82%E8%BF%B0%E5%92%8C%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8/","excerpt":"","text":"1 æ¦‚è¿°1.1 SpringMVCçš„æ¦‚å¿µSpringMVC æ˜¯ä¸€ç§åŸºäº Java çš„å®ç° MVC è®¾è®¡æ¨¡å‹çš„è¯·æ±‚é©±åŠ¨ç±»å‹çš„è½»é‡çº§ Web æ¡†æ¶ï¼Œå±äº Spring FrameWork çš„åç»­äº§å“ï¼Œå·²ç»èåˆåœ¨ Spring Web Flow é‡Œé¢ã€‚Spring æ¡†æ¶æä¾›äº†æ„å»º Web åº”ç”¨ç¨‹åºçš„å…¨åŠŸèƒ½ MVC æ¨¡å—ã€‚ä½¿ç”¨ Spring å¯æ’å…¥çš„ MVC æ¶æ„ï¼Œä»è€Œåœ¨ä½¿ç”¨ Spring è¿›è¡Œ WEB å¼€å‘æ—¶ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨ Spring çš„ Spring MVC æ¡†æ¶æˆ–é›†æˆå…¶ä»– MVC å¼€å‘æ¡†æ¶ï¼Œå¦‚ Struts1(ç°åœ¨ä¸€èˆ¬ä¸ç”¨)ï¼ŒStruts2 ç­‰ã€‚ å®ƒé€šè¿‡ä¸€å¥—æ³¨è§£ï¼Œè®©ä¸€ä¸ªç®€å•çš„ Java ç±»æˆä¸ºå¤„ç†è¯·æ±‚çš„æ§åˆ¶å™¨ï¼Œè€Œæ— é¡»å®ç°ä»»ä½•æ¥å£ã€‚åŒæ—¶å®ƒè¿˜æ”¯æŒRESTful ç¼–ç¨‹é£æ ¼çš„è¯·æ±‚ã€‚ 1.2 SpringMVCçš„ä¼˜åŠ¿ æ¸…æ™°çš„è§’è‰²åˆ’åˆ†ï¼š å‰ç«¯æ§åˆ¶å™¨ï¼ˆDispatcherServletï¼‰ è¯·æ±‚åˆ°å¤„ç†å™¨æ˜ å°„ï¼ˆHandlerMappingï¼‰ å¤„ç†å™¨é€‚é…å™¨ï¼ˆHandlerAdapterï¼‰ è§†å›¾è§£æå™¨ï¼ˆViewResolverï¼‰ å¤„ç†å™¨æˆ–é¡µé¢æ§åˆ¶å™¨ï¼ˆControllerï¼‰ éªŒè¯å™¨ï¼ˆValidatorï¼‰ å‘½ä»¤å¯¹è±¡ï¼ˆCommand è¯·æ±‚å‚æ•°ç»‘å®šåˆ°çš„å¯¹è±¡å°±å«å‘½ä»¤å¯¹è±¡ï¼‰ è¡¨å•å¯¹è±¡ï¼ˆForm Object æä¾›ç»™è¡¨å•å±•ç¤ºå’Œæäº¤åˆ°çš„å¯¹è±¡å°±å«è¡¨å•å¯¹è±¡ï¼‰ã€‚ åˆ†å·¥æ˜ç¡®ï¼Œè€Œä¸”æ‰©å±•ç‚¹ç›¸å½“çµæ´»ï¼Œå¯ä»¥å¾ˆå®¹æ˜“æ‰©å±•ï¼Œè™½ç„¶å‡ ä¹ä¸éœ€è¦ã€‚ ç”±äºå‘½ä»¤å¯¹è±¡å°±æ˜¯ä¸€ä¸ª POJOï¼Œæ— éœ€ç»§æ‰¿æ¡†æ¶ç‰¹å®š APIï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤å¯¹è±¡ç›´æ¥ä½œä¸ºä¸šåŠ¡å¯¹è±¡ã€‚ å’Œ Spring å…¶ä»–æ¡†æ¶æ— ç¼é›†æˆï¼Œæ˜¯å…¶å®ƒ Web æ¡†æ¶æ‰€ä¸å…·å¤‡çš„ã€‚ å¯é€‚é…ï¼Œé€šè¿‡ HandlerAdapter å¯ä»¥æ”¯æŒä»»æ„çš„ç±»ä½œä¸ºå¤„ç†å™¨ã€‚ å¯å®šåˆ¶æ€§ï¼ŒHandlerMappingã€ViewResolver ç­‰èƒ½å¤Ÿéå¸¸ç®€å•çš„å®šåˆ¶ã€‚ åŠŸèƒ½å¼ºå¤§çš„æ•°æ®éªŒè¯ã€æ ¼å¼åŒ–ã€ç»‘å®šæœºåˆ¶ã€‚ åˆ©ç”¨ Spring æä¾›çš„ Mock å¯¹è±¡èƒ½å¤Ÿéå¸¸ç®€å•çš„è¿›è¡Œ Web å±‚å•å…ƒæµ‹è¯•ã€‚ æœ¬åœ°åŒ–ã€ä¸»é¢˜çš„è§£æçš„æ”¯æŒï¼Œä½¿æˆ‘ä»¬æ›´å®¹æ˜“è¿›è¡Œå›½é™…åŒ–å’Œä¸»é¢˜çš„åˆ‡æ¢ã€‚ å¼ºå¤§çš„ JSP æ ‡ç­¾åº“ï¼Œä½¿ JSP ç¼–å†™æ›´å®¹æ˜“ã€‚ â€¦â€¦â€¦â€¦â€¦â€¦è¿˜æœ‰æ¯”å¦‚RESTfulé£æ ¼çš„æ”¯æŒã€ç®€å•çš„æ–‡ä»¶ä¸Šä¼ ã€çº¦å®šå¤§äºé…ç½®çš„å¥‘çº¦å¼ç¼–ç¨‹æ”¯æŒã€åŸºäºæ³¨è§£çš„é›¶é…ç½®æ”¯æŒç­‰ç­‰ã€‚ 1.3 SpringMVCå’ŒStruts2çš„ä¼˜åŠ£åˆ†æå…±åŒç‚¹ï¼š å®ƒä»¬éƒ½æ˜¯è¡¨ç°å±‚æ¡†æ¶ï¼Œéƒ½æ˜¯åŸºäº MVC æ¨¡å‹ç¼–å†™çš„ã€‚ å®ƒä»¬çš„åº•å±‚éƒ½ç¦»ä¸å¼€åŸå§‹ ServletAPIã€‚ å®ƒä»¬å¤„ç†è¯·æ±‚çš„æœºåˆ¶éƒ½æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ§åˆ¶å™¨ã€‚ åŒºåˆ«ï¼š Spring MVC çš„å…¥å£æ˜¯ Servlet, è€Œ Struts2 æ˜¯ Filter Spring MVC æ˜¯åŸºäºæ–¹æ³•è®¾è®¡çš„ï¼Œè€Œ Struts2 æ˜¯åŸºäºç±»ï¼ŒStruts2 æ¯æ¬¡æ‰§è¡Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªåŠ¨ä½œç±»ã€‚æ‰€ä»¥ Spring MVC ä¼šç¨å¾®æ¯” Struts2 å¿«äº›ã€‚ Spring MVC ä½¿ç”¨æ›´åŠ ç®€æ´,åŒæ—¶è¿˜æ”¯æŒ JSR303, å¤„ç† ajax çš„è¯·æ±‚æ›´æ–¹ä¾¿ (JSR303 æ˜¯ä¸€å¥— JavaBean å‚æ•°æ ¡éªŒçš„æ ‡å‡†ï¼Œå®ƒå®šä¹‰äº†å¾ˆå¤šå¸¸ç”¨çš„æ ¡éªŒæ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†è¿™äº›æ³¨è§£åŠ åœ¨æˆ‘ä»¬ JavaBean çš„å±æ€§ä¸Šé¢ï¼Œå°±å¯ä»¥åœ¨éœ€è¦æ ¡éªŒçš„æ—¶å€™è¿›è¡Œæ ¡éªŒäº†ã€‚) Struts2 çš„ OGNL è¡¨è¾¾å¼ä½¿é¡µé¢çš„å¼€å‘æ•ˆç‡ç›¸æ¯” Spring MVC æ›´é«˜äº›ï¼Œä½†æ‰§è¡Œæ•ˆç‡å¹¶æ²¡æœ‰æ¯” JSTL æå‡ï¼Œå°¤å…¶æ˜¯ struts2 çš„è¡¨å•æ ‡ç­¾ï¼Œè¿œæ²¡æœ‰ html æ‰§è¡Œæ•ˆç‡é«˜ã€‚ 2 å…¥é—¨æ¡ˆä¾‹2.1 mavené…ç½®&lt;properties> &lt;project.build.sourceEncoding>UTF-8&lt;/project.build.sourceEncoding> &lt;maven.compiler.source>8&lt;/maven.compiler.source> &lt;maven.compiler.target>8&lt;/maven.compiler.target> &lt;spring.version>5.2.3.RELEASE&lt;/spring.version> &lt;/properties> &lt;dependencies> &lt;dependency> &lt;groupId>junit&lt;/groupId> &lt;artifactId>junit&lt;/artifactId> &lt;version>4.12&lt;/version> &lt;scope>test&lt;/scope> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework&lt;/groupId> &lt;artifactId>spring-context&lt;/artifactId> &lt;version>${spring.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework&lt;/groupId> &lt;artifactId>spring-web&lt;/artifactId> &lt;version>${spring.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework&lt;/groupId> &lt;artifactId>spring-webmvc&lt;/artifactId> &lt;version>${spring.version}&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>javax.servlet&lt;/groupId> &lt;artifactId>servlet-api&lt;/artifactId> &lt;version>2.5&lt;/version> &lt;scope>provided&lt;/scope> &lt;/dependency> &lt;dependency> &lt;groupId>javax.servlet.jsp&lt;/groupId> &lt;artifactId>jsp-api&lt;/artifactId> &lt;version>2.0&lt;/version> &lt;scope>provided&lt;/scope> &lt;/dependency> &lt;/dependencies> 2.2 web.xmlé…ç½®&lt;servlet> &lt;servlet-name>springmvc&lt;/servlet-name> &lt;servlet-class>org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class> &lt;init-param> &lt;param-name>contextConfigLocation&lt;/param-name> &lt;param-value>classpath:spring-mvc.xml&lt;/param-value> &lt;/init-param> &lt;load-on-startup>1&lt;/load-on-startup> &lt;/servlet> &lt;servlet-mapping> &lt;servlet-name>springmvc&lt;/servlet-name> &lt;url-pattern>/&lt;/url-pattern> &lt;/servlet-mapping> DispatcherServletå°±æ˜¯ç”¨äºåˆ†å‘è¯·æ±‚çš„ï¼Œè¿™é‡Œå¯ä»¥è§†ä¸ºè¿‡æ»¤å™¨ã€‚å®ƒé…åˆControllerä¸­çš„@RequestMappingåˆ†å‘è¯·æ±‚ã€‚ init-paramé‡Œé¢çš„contextConfigLocationæŒ‡å¼•springmvcå»åŠ è½½springé…ç½® 2.3 Springé…ç½®æ–‡ä»¶&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:context=\"http://www.springframework.org/schema/context\" xmlns:p=\"http://www.springframework.org/schema/p\" xmlns:mvc=\"http://www.springframework.org/schema/mvc\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd\"> &lt;!--å¯ç”¨ç»„ä»¶æ‰«æ--> &lt;context:component-scan base-package=\"com.test.controller\"/> &lt;!--å¯åŠ¨SpringMVCçš„æ³¨è§£åŠŸèƒ½ï¼Œå®Œæˆè¯·æ±‚å’Œæ³¨è§£POJOçš„æ˜ å°„--> &lt;mvc:annotation-driven/> &lt;!--é…ç½®è§†å›¾è§£æå™¨--> &lt;bean class=\"org.springframework.web.servlet.view.InternalResourceViewResolver\" id=\"internalResourceViewResolver\"> &lt;property name=\"prefix\" value=\"/WEB-INF/pages/\" /> &lt;property name=\"suffix\" value=\".jsp\"/> &lt;/bean> &lt;/beans> 2.4 æ§åˆ¶ç±»ç¼–å†™@Controller @RequestMapping(\"/user\") public class UserController { @RequestMapping(\"/showUser\") public String ShowUser(){ return \"ShowUser\"; } } è¿™é‡Œçš„@RequestMappingä»£è¡¨è¦è®¿é—®é¡¹ç›®ç›®å½•ä¸‹çš„/user/showUseræ‰ä¼šè¢«åˆ†å‘åˆ°è¯¥Controllerç±» æ³¨æ„è¿”å›çš„å­—ç¬¦ä¸²é…åˆè§†å›¾è§£æå™¨ä¼šè·³è½¬åˆ°/WEB-INF/pages/ShowUser.jsp 3 å…¥é—¨æ¡ˆä¾‹æ¶‰åŠçš„ç»„ä»¶ 3.1 DispatcherServletå‰ç«¯æ§åˆ¶å™¨ï¼šç”¨æˆ·è¯·æ±‚åˆ°è¾¾å‰ç«¯æ§åˆ¶å™¨ï¼Œå®ƒå°±ç›¸å½“äº mvc æ¨¡å¼ä¸­çš„ cï¼ŒdispatcherServlet æ˜¯æ•´ä¸ªæµç¨‹æ§åˆ¶çš„ä¸­å¿ƒï¼Œç”±å®ƒè°ƒç”¨å…¶å®ƒç»„ä»¶å¤„ç†ç”¨æˆ·çš„è¯·æ±‚ï¼ŒdispatcherServlet çš„å­˜åœ¨é™ä½äº†ç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§ã€‚ 3.2 HandlerMappingå¤„ç†å™¨æ˜ å°„å™¨ï¼šHandlerMapping è´Ÿè´£æ ¹æ®ç”¨æˆ·è¯·æ±‚æ‰¾åˆ° Handler å³å¤„ç†å™¨ï¼ŒSpringMVC æä¾›äº†ä¸åŒçš„æ˜ å°„å™¨å®ç°ä¸åŒçš„æ˜ å°„æ–¹å¼ï¼Œä¾‹å¦‚ï¼šé…ç½®æ–‡ä»¶æ–¹å¼ï¼Œå®ç°æ¥å£æ–¹å¼ï¼Œæ³¨è§£æ–¹å¼ç­‰ã€‚ 3.3 Handlerå¤„ç†å™¨ï¼šå®ƒå°±æ˜¯æˆ‘ä»¬å¼€å‘ä¸­è¦ç¼–å†™çš„å…·ä½“ä¸šåŠ¡æ§åˆ¶å™¨ã€‚ç”± DispatcherServlet æŠŠç”¨æˆ·è¯·æ±‚è½¬å‘åˆ° Handlerã€‚ç”±Handler å¯¹å…·ä½“çš„ç”¨æˆ·è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚ 3.4 HandlerAdapterå¤„ç†å™¨é€‚é…å™¨ï¼šé€šè¿‡ HandlerAdapter å¯¹å¤„ç†å™¨è¿›è¡Œæ‰§è¡Œï¼Œè¿™æ˜¯é€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ï¼Œé€šè¿‡æ‰©å±•é€‚é…å™¨å¯ä»¥å¯¹æ›´å¤šç±»å‹çš„å¤„ç†å™¨è¿›è¡Œæ‰§è¡Œã€‚ 3.5 View Resolverè§†å›¾è§£æå™¨ï¼šView Resolver è´Ÿè´£å°†å¤„ç†ç»“æœç”Ÿæˆ View è§†å›¾ï¼ŒView Resolver é¦–å…ˆæ ¹æ®é€»è¾‘è§†å›¾åè§£ææˆç‰©ç†è§†å›¾åå³å…·ä½“çš„é¡µé¢åœ°å€ï¼Œå†ç”Ÿæˆ View è§†å›¾å¯¹è±¡ï¼Œæœ€åå¯¹ View è¿›è¡Œæ¸²æŸ“å°†å¤„ç†ç»“æœé€šè¿‡é¡µé¢å±•ç¤ºç»™ç”¨æˆ·ã€‚ 3.6 ViewSpringMVC æ¡†æ¶æä¾›äº†å¾ˆå¤šçš„ View è§†å›¾ç±»å‹çš„æ”¯æŒï¼ŒåŒ…æ‹¬ï¼šjstlViewã€freemarkerViewã€pdfViewç­‰ã€‚æˆ‘ä»¬æœ€å¸¸ç”¨çš„è§†å›¾å°±æ˜¯ jspã€‚ ä¸€èˆ¬æƒ…å†µä¸‹éœ€è¦é€šè¿‡é¡µé¢æ ‡ç­¾æˆ–é¡µé¢æ¨¡ç‰ˆæŠ€æœ¯å°†æ¨¡å‹æ•°æ®é€šè¿‡é¡µé¢å±•ç¤ºç»™ç”¨æˆ·ï¼Œéœ€è¦ç”±ç¨‹åºå‘˜æ ¹æ®ä¸šåŠ¡éœ€æ±‚å¼€å‘å…·ä½“çš„é¡µé¢ã€‚ 3.7 æ€»ç»“åœ¨ SpringMVC çš„å„ä¸ªç»„ä»¶ä¸­ï¼Œå¤„ç†å™¨æ˜ å°„å™¨ã€å¤„ç†å™¨é€‚é…å™¨ã€è§†å›¾è§£æå™¨ç§°ä¸º SpringMVC çš„ä¸‰å¤§ç»„ä»¶ã€‚ ä½¿ç”¨ &lt;mvc:annotation-driven&gt; è‡ªåŠ¨åŠ è½½ HandlerMappingï¼ˆå¤„ç†æ˜ å°„å™¨ï¼‰å’ŒHandlerAdapterï¼ˆå¤„ç†é€‚é…å™¨ï¼‰ï¼Œå¯ç”¨åœ¨ SpringMVC.xml é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨&lt;mvc:annotation-driven&gt;æ›¿ä»£æ³¨è§£å¤„ç†å™¨å’Œé€‚é…å™¨çš„é…ç½®ã€‚ 4 RequestMappingæ³¨è§£4.1 valueå±æ€§valueå±æ€§å°±æ˜¯pathå±æ€§çš„åˆ«åï¼Œå¡«éœ€è¦æŒ‡å®šè¯·æ±‚çš„åœ°å€ï¼Œå¯ä»¥å¡«å†™ï¼š æ™®é€šçš„å…·ä½“å€¼@RequestMapping(&quot;/user&quot;) å«æœ‰æŸä¸€å˜é‡çš„ä¸€ç±»å€¼ @Controller @RequestMapping(\"/user\") public class UserController { @RequestMapping(value=\"/{userId}/deleteUser\",method=RequestMethod.GET) public String deleteUser(@PathVariable String userId){ System.out.println(\"delete:\"+userId); return \"ShowUser\"; } } å«æ­£å€¼è¡¨è¾¾å¼çš„ä¸€ç±»å€¼ @Controller @RequestMapping(\"/user\") public class UserController { @RequestMapping(value=\"/{userBirth:\\\\d{4}-\\\\d{2}-\\\\d{2}}/updateUser\",method=RequestMethod.GET) public String updateUser(@PathVariable String userBirth){ System.out.println(\"userBirth:\"+userBirth); return \"ShowUser\"; } } 4.2 methodå±æ€§GET\\POST\\PUT\\DELETEâ€¦ 4.3 consumeså±æ€§æŒ‡å®šå¤„ç†è¯·æ±‚çš„æäº¤å†…å®¹ç±»å‹ï¼Œä¾‹å¦‚application/jsonã€text/html 4.4 produceså±æ€§æŒ‡å®šè¿”å›çš„å†…å®¹ç±»å‹ï¼Œä»…å½“requestè¯·æ±‚å¤´ä¸­çš„Acceptç±»å‹ä¸­åŒ…å«è¯¥æŒ‡å®šç±»å‹æ‰è¿”å›ã€‚ 4.5 paramså±æ€§æŒ‡å®šrequestä¸­å¿…é¡»åŒ…å«æŸäº›å‚æ•°å€¼æ—¶æ‰è®©è¯¥æ–¹æ³•å¤„ç†è¯·æ±‚ 4.6 headerså±æ€§æŒ‡å®šrequestä¸­å¿…é¡»åŒ…å«æŸäº›æŒ‡å®šçš„headerå€¼æ—¶æ‰è®©è¯¥æ–¹æ³•å¤„ç†è¯·æ±‚ 5 springå‰åå°äº¤äº’5.1 Controllerè·å–å‰å°ä¼ é€’çš„å‚æ•°ï¼ˆGETå‚æ•°ã€POSTå‚æ•°ç­‰ï¼‰ 5.1.1 ç›´æ¥é€šè¿‡å½¢å‚è·å–å½¢å‚çš„åå­—å¿…é¡»å’Œå‰ç«¯ä¼ é€’çš„æ•°æ®åä¸€æ · @RequestMapping(value = \"/addUser\",method = RequestMethod.POST) public String ShowUser(Model model,String name,Integer age){ System.out.println(\"name:\"+name+\"age:\"+age); return \"ShowUser\"; } å¦‚æœä¸ä¸€è‡´å¯ä»¥ä½¿ç”¨@ModelAttributeæˆ–@RequestParamæ¥æŒ‡å®šå½¢å‚è¦æ¥å—çš„å‚æ•°çš„å€¼ã€‚ @RequestMapping(value = \"/addUser\",method = RequestMethod.POST) public String ShowUser(Model model, @ModelAttribute(\"name\") String nickname, Integer age){ System.out.println(\"name:\"+nickname+\"age:\"+age); return \"ShowUser\"; } 5.1.2 ä½¿ç”¨å¯¹è±¡æ¥å—å‰å°ä¼ é€’çš„å‚æ•°å‰å°ä¼ é€’çš„å‚æ•°åå¿…é¡»å’Œå¯¹è±¡çš„å±æ€§åä¸€è‡´ @RequestMapping(value = \"/addUser\",method = RequestMethod.POST) public String ShowUser(Model model, User user,@ModelAttribute(\"name\")String nickname){ System.out.println(\"name:\"+nickname+\"age:\"+user.getAge()); return \"ShowUser\"; } å½“@ModelAttributeæ³¨è§£åº”ç”¨åœ¨æ–¹æ³•å‰çš„æ—¶å€™ï¼ŒSpringMVCåœ¨è°ƒç”¨ç›®æ ‡å¤„ç†æ–¹æ³•å‰ï¼Œä¼šå…ˆé€ä¸ªè°ƒç”¨åœ¨æ–¹æ³•çº§ä¸Šæ ‡æ³¨äº†@ModelAttributeçš„æ–¹æ³•ï¼ˆæŠŠå®ƒçœ‹æˆè·å–å¿…è¦å±æ€§çš„å‰ç½®æ–¹æ³•ï¼‰ å¦‚ä¸‹é¢çš„ä»£ç å¯ä»¥å®ç°åœ¨æ¯æ¬¡è°ƒç”¨å¤„ç†æ–¹æ³•å‰è·å–request response session public class BaseController{ protected HttpServletRequest request; protected HttpServletResponse request; protected HttpSession session; @ModelAttribute public void setReqAndRes(HttpServletRequest request,HttpServletResponse response){ this.request = request; this.response = response; this.session = request.getSession(); } } 5.1.3 ä½¿ç”¨é›†åˆæ¥å—å‰å°ä¼ é€’çš„å‚æ•°å¦‚æœæ˜¯liståˆ™å‰å°ä¼ é€’çš„å‚æ•°åæ˜¯list[index].propNameï¼ˆindexä¸‹æ ‡ï¼ŒpropNameå±æ€§åï¼‰ å¦‚æœæ˜¯Mapåˆ™å‰å°ä¼ é€’çš„å‚æ•°åæ˜¯map[&#39;key&#39;].propNameï¼ˆkeyé”®åï¼ŒpropNameå±æ€§åï¼‰ 5.2 Controllerä¼ é€’å‚æ•°åˆ°å‰å°5.2.1 ç›´æ¥é€šè¿‡requestå¯¹è±¡ä¼ é€’ç›´æ¥é€šè¿‡è·å–çš„requestçš„setAttributeæ–¹æ³•ä¼ é€’ã€‚ 5.2.2 ç›´æ¥é€šè¿‡è¿”å›å€¼ModelAndViewå¯¹è±¡ä¼ é€’@RequestMapping(value = \"/showUser\") public ModelAndView ShowUser(){ return new ModelAndView(\"ShowUser\",\"message\",\"test message!\"); } ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é€»è¾‘è§†å›¾å­—ç¬¦ä¸² ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦å¾€ShowUserè§†å›¾ä¸Šä¼ é€’å‚æ•°çš„åç§°ã€‚ ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¦å¾€ShowUserè§†å›¾ä¸Šä¼ é€’å‚æ•°çš„å€¼ã€‚ å½“è¦ä¼ é€’å¤šä¸ªå‚æ•°æ—¶å¯ä»¥å¤šæ¬¡è°ƒç”¨ModelAndView.addObject(&quot;attributeName&quot;,attributeValue)ã€‚ è¿™äº›æ•°æ®ä¹Ÿæ˜¯å­˜æ”¾åœ¨requestä¸­çš„ã€‚ 5.2.3 ç›´æ¥é€šè¿‡å‚æ•°åˆ—è¡¨ä¸­æ·»åŠ å½¢å‚ModelMapä¼ é€’å†™æˆæ¥å£Modelä¹Ÿè¡Œ @RequestMapping(value = \"/addUser\") public String ShowUser(ModelMap map){ map.put(\"message\",\"test message!\"); map.addAttribute(\"attributeName\",\"attributeValue\"); return \"showUser\"; } 5.3 é…ç½®è§£å†³ä¸­æ–‡ä¹±ç çš„è¿‡æ»¤å™¨web.xml: &lt;filter> &lt;filter-name>characterEncodingFilter&lt;/filter-name> &lt;filter-class>org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class> &lt;init-param> &lt;param-name>encoding&lt;/param-name> &lt;param-value>UTF-8&lt;/param-value> &lt;/init-param> &lt;/filter> &lt;filter-mapping> &lt;filter-name>characterEncodingFilter&lt;/filter-name> &lt;url-pattern>/*&lt;/url-pattern> &lt;/filter-mapping> 5.4 è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨ç¬¬ä¸€æ­¥ï¼šå®šä¹‰ä¸€ä¸ªç±»ï¼Œå®ç° Converter æ¥å£ï¼Œè¯¥æ¥å£æœ‰ä¸¤ä¸ªæ³›å‹å‚æ•°ã€‚ public interface Converter&lt;S, T> {//S:è¡¨ç¤ºæ¥å—çš„ç±»å‹ï¼ŒTï¼šè¡¨ç¤ºç›®æ ‡ç±»å‹ /** * å®ç°ç±»å‹è½¬æ¢çš„æ–¹æ³• */ @Nullable T convert(S source); } public class StringToDateConverter implements Converter&lt;String, Date> { /** * ç”¨äºæŠŠ String ç±»å‹è½¬æˆæ—¥æœŸç±»å‹ */ @Override public Date convert(String source) { DateFormat format = null; try { if(StringUtils.isEmpty(source)) { throw new NullPointerException(\"è¯·è¾“å…¥è¦è½¬æ¢çš„æ—¥æœŸ\"); } format = new SimpleDateFormat(\"yyyy-MM-dd\"); Date date = format.parse(source); return date; } catch (Exception e) { throw new RuntimeException(\"è¾“å…¥æ—¥æœŸæœ‰è¯¯\"); } } } ç¬¬äºŒæ­¥ï¼šåœ¨ spring é…ç½®æ–‡ä»¶ä¸­é…ç½®ç±»å‹è½¬æ¢å™¨ã€‚ &lt;!-- é…ç½®ç±»å‹è½¬æ¢å™¨å·¥å‚ --> &lt;bean id=\"converterService\" class=\"org.springframework.context.support.ConversionServiceFactoryBean\"> &lt;!-- ç»™å·¥å‚æ³¨å…¥ä¸€ä¸ªæ–°çš„ç±»å‹è½¬æ¢å™¨ --> &lt;property name=\"converters\"> &lt;array> &lt;!-- é…ç½®è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨ --> &lt;bean class=\"com.itheima.web.converter.StringToDateConverter\">&lt;/bean> &lt;/array> &lt;/property> &lt;/bean> &lt;mvc:annotation-driven conversion-service=\"converterService\"> &lt;/mvc:annotation-driven> 6 SpringMVCå¸¸ç”¨æ³¨è§£6.1 @Controlleræ§åˆ¶å™¨è´Ÿè´£å¤„ç†ç”±DispatcherServletåˆ†å‘è¿‡æ¥çš„è¯·æ±‚ï¼Œå®ƒæŠŠç”¨æˆ·è¯·æ±‚çš„æ•°æ®ç»è¿‡ä¸šåŠ¡å¤„ç†å±‚å¤„ç†ä¹‹åå°è£…æˆä¸€ä¸ªModelï¼Œç„¶åå†æŠŠè¯¥Modelè¿”å›ç»™å¯¹åº”çš„Viewè¿›è¡Œå±•ç¤ºã€‚SpringMVCä½¿ç”¨@Controllerå®šä¹‰æ§åˆ¶å™¨ï¼Œå®ƒè¿˜å…è®¸è‡ªåŠ¨æ£€æµ‹å®šä¹‰åœ¨ç±»è·¯å¾„ä¸‹çš„ç»„ä»¶å¹¶è‡ªåŠ¨æ³¨å†Œã€‚ 6.2 @RequestMappingå°†URLæ˜ å°„åˆ°æ•´ä¸ªç±»æˆ–ç‰¹å®šçš„å¤„ç†æ–¹æ³•ä¸Šã€‚ 6.3 @PathVariableå°†æ³¨è§£æ–¹æ³•å‚æ•°ç»‘å®šåˆ°URIæ¨¡æ¿éå†çš„å€¼ä¸Šã€‚â€/{userId}/deleteUserâ€ url æ”¯æŒå ä½ç¬¦æ˜¯ spring3.0 ä¹‹ååŠ å…¥çš„ã€‚æ˜¯ springmvc æ”¯æŒ rest é£æ ¼ URL çš„ä¸€ä¸ªé‡è¦æ ‡å¿—ã€‚ å®ä¾‹ï¼š @RequestMapping(\"/usePathVariable/{id}\") public String usePathVariable(@PathVariable(\"id\") Integer id){ System.out.println(id); return \"success\"; } 6.4 @RequestParamå°†è¯·æ±‚çš„å‚æ•°ç»‘å®šåˆ°æ–¹æ³•ä¸­çš„å‚æ•°ä¸Šã€‚ å±æ€§ï¼š valueï¼šè¯·æ±‚å‚æ•°ä¸­çš„åç§°ã€‚ requiredï¼šè¯·æ±‚å‚æ•°ä¸­æ˜¯å¦å¿…é¡»æä¾›æ­¤å‚æ•°ã€‚é»˜è®¤å€¼ï¼štrueã€‚è¡¨ç¤ºå¿…é¡»æä¾›ï¼Œå¦‚æœä¸æä¾›å°†æŠ¥é”™ã€‚ 6.5 @RequestBodyæ–¹æ³•å‚æ•°åº”è¯¥è¢«ç»‘å®šåˆ°HTTPçš„Bodyä¸Šã€‚ç›´æ¥ä½¿ç”¨å¾—åˆ°æ˜¯ key=value&amp;key=valueâ€¦ç»“æ„çš„æ•°æ®ã€‚get è¯·æ±‚æ–¹å¼ä¸é€‚ç”¨ã€‚ å±æ€§ï¼š requiredï¼šæ˜¯å¦å¿…é¡»æœ‰è¯·æ±‚ä½“ã€‚é»˜è®¤å€¼æ˜¯:trueã€‚å½“å–å€¼ä¸º true æ—¶,get è¯·æ±‚æ–¹å¼ä¼šæŠ¥é”™ã€‚å¦‚æœå–å€¼ä¸º falseï¼Œget è¯·æ±‚å¾—åˆ°æ˜¯ nullã€‚ 6.6 @RequestHeaderç”¨äºè·å–è¯·æ±‚æ¶ˆæ¯å¤´ã€‚ å±æ€§ï¼š valueï¼šæä¾›æ¶ˆæ¯å¤´åç§° requiredï¼šæ˜¯å¦å¿…é¡»æœ‰æ­¤æ¶ˆæ¯å¤´ 6.7 @CookieValueç”¨äºæŠŠæŒ‡å®š cookie åç§°çš„å€¼ä¼ å…¥æ§åˆ¶å™¨æ–¹æ³•å‚æ•°ã€‚ å±æ€§ï¼švalueï¼šæŒ‡å®š cookie çš„åç§°ã€‚requiredï¼šæ˜¯å¦å¿…é¡»æœ‰æ­¤ cookieã€‚ 6.8 @SessionAttributeç”¨äºå¤šæ¬¡æ‰§è¡Œæ§åˆ¶å™¨æ–¹æ³•é—´çš„å‚æ•°å…±äº«ã€‚ ç”¨åœ¨æ–¹æ³•å‚æ•°ä¸Šã€‚ å±æ€§ï¼š valueï¼šç”¨äºæŒ‡å®šå­˜å…¥çš„å±æ€§åç§°ã€‚ 6.9 @SessionAttributesç”¨äºå¤šæ¬¡æ‰§è¡Œæ§åˆ¶å™¨æ–¹æ³•é—´çš„å‚æ•°å…±äº«ã€‚ ç”¨åœ¨ç±»ä¸Šã€‚ å±æ€§ï¼š valueï¼šç”¨äºæŒ‡å®šå­˜å…¥çš„å±æ€§åç§° typeï¼šç”¨äºæŒ‡å®šå­˜å…¥çš„æ•°æ®ç±»å‹ã€‚ å®ä¾‹ï¼š @Controller @SessionAttributes(value = \"age\",types = String.class) public class HelloController { @RequestMapping(value = \"/addUser\") public String ShowUser(ModelMap map,@RequestParam(\"age\") int userAge){ System.out.println(\"age:\"+userAge); map.put(\"age\",userAge); return \"ShowUser\"; } } è°ƒç”¨map.put(&quot;age&quot;,userAge);çš„æ—¶å€™å°±ä¼šåŒæ­¥å­˜åˆ°sessionåŸŸä¸­ã€‚ 6.10 @RestControlleråˆ›å»ºRESTç±»å‹çš„æ§åˆ¶å™¨ï¼ˆRESTFUL APIï¼‰ 6.11 HttpEntityï¼ˆä¸æ˜¯æ³¨è§£ï¼‰èƒ½è·å¾—requestè¯·æ±‚å’Œresponseå“åº”ï¼Œè¿˜èƒ½è®¿é—®è¯·æ±‚å’Œè¯·æ±‚å¤´ 6.12 @ModelAttributeå¯ä»¥ä½œç”¨åœ¨æ–¹æ³•æˆ–æ–¹æ³•å‚æ•°ä¸Šã€‚ä½œç”¨åœ¨æ–¹æ³•ä¸Šæ—¶ï¼Œè¡¨æ˜è¯¥æ–¹æ³•çš„ç›®çš„æ—¶æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡å‹å±æ€§ã€‚ @ModelAttributeä¸€å…±å…·æœ‰å¦‚ä¸‹ä¸‰ä¸ªä½œç”¨ï¼š ç»‘å®šè¯·æ±‚å‚æ•°åˆ°å‘½ä»¤å¯¹è±¡ï¼šæ”¾åœ¨åŠŸèƒ½å¤„ç†æ–¹æ³•çš„å…¥å‚ä¸Šæ—¶ï¼Œç”¨äºå°†å¤šä¸ªè¯·æ±‚å‚æ•°ç»‘å®šåˆ°ä¸€ä¸ªå‘½ä»¤å¯¹è±¡ï¼Œä»è€Œç®€åŒ–ç»‘å®šæµç¨‹ï¼Œè€Œä¸”è‡ªåŠ¨æš´éœ²ä¸ºæ¨¡å‹æ•°æ®ç”¨äºè§†å›¾é¡µé¢å±•ç¤ºæ—¶ä½¿ç”¨ï¼› æš´éœ²è¡¨å•å¼•ç”¨å¯¹è±¡ä¸ºæ¨¡å‹æ•°æ®ï¼šæ”¾åœ¨å¤„ç†å™¨çš„ä¸€èˆ¬æ–¹æ³•ï¼ˆéåŠŸèƒ½å¤„ç†æ–¹æ³•ï¼‰ä¸Šæ—¶ï¼Œæ˜¯ä¸ºè¡¨å•å‡†å¤‡è¦å±•ç¤ºçš„è¡¨å•å¼•ç”¨å¯¹è±¡ï¼Œå¦‚æ³¨å†Œæ—¶éœ€è¦é€‰æ‹©çš„æ‰€åœ¨åŸå¸‚ç­‰ï¼Œè€Œä¸”åœ¨æ‰§è¡ŒåŠŸèƒ½å¤„ç†æ–¹æ³•ï¼ˆ@RequestMappingæ³¨è§£çš„æ–¹æ³•ï¼‰ä¹‹å‰ï¼Œè‡ªåŠ¨æ·»åŠ åˆ°æ¨¡å‹å¯¹è±¡ä¸­ï¼Œç”¨äºè§†å›¾é¡µé¢å±•ç¤ºæ—¶ä½¿ç”¨ï¼› æš´éœ²@RequestMappingæ–¹æ³•è¿”å›å€¼ä¸ºæ¨¡å‹æ•°æ®ï¼šæ”¾åœ¨åŠŸèƒ½å¤„ç†æ–¹æ³•çš„è¿”å›å€¼ä¸Šæ—¶ï¼Œæ˜¯æš´éœ²åŠŸèƒ½å¤„ç†æ–¹æ³•çš„è¿”å›å€¼ä¸ºæ¨¡å‹æ•°æ®ï¼Œç”¨äºè§†å›¾é¡µé¢å±•ç¤ºæ—¶ä½¿ç”¨ã€‚ 7 HiddentHttpMethodFilter7.1 ä½œç”¨ç”±äºæµè§ˆå™¨ form è¡¨å•åªæ”¯æŒ GET ä¸ POST è¯·æ±‚ï¼Œè€Œ DELETEã€PUT ç­‰ method å¹¶ä¸æ”¯æŒï¼ŒSpring3.0 æ·»åŠ äº†ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œå¯ä»¥å°†æµè§ˆå™¨è¯·æ±‚æ”¹ä¸ºæŒ‡å®šçš„è¯·æ±‚æ–¹å¼ï¼Œå‘é€ç»™æˆ‘ä»¬çš„æ§åˆ¶å™¨æ–¹æ³•ï¼Œä½¿å¾—æ”¯æŒ GETã€POSTã€PUTä¸ DELETE è¯·æ±‚ã€‚ 7.2 ä½¿ç”¨æ–¹æ³• åœ¨ web.xml ä¸­é…ç½®è¯¥è¿‡æ»¤å™¨ã€‚ è¯·æ±‚æ–¹å¼å¿…é¡»ä½¿ç”¨ post è¯·æ±‚ã€‚ æŒ‰ç…§è¦æ±‚æä¾›_method è¯·æ±‚å‚æ•°ï¼Œè¯¥å‚æ•°çš„å–å€¼å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„è¯·æ±‚æ–¹å¼ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"SpringMVC","slug":"SpringMVC","permalink":"https://www.codetool.top/tags/SpringMVC/"}]},{"title":"leetcode11-ç››æœ€å¤šæ°´çš„å®¹å™¨","slug":"leetcode11-ç››æœ€å¤šæ°´çš„å®¹å™¨","date":"2020-02-26T17:17:55.000Z","updated":"2020-04-22T09:27:27.142Z","comments":true,"path":"article/leetcode11-ç››æœ€å¤šæ°´çš„å®¹å™¨/","link":"","permalink":"https://www.codetool.top/article/leetcode11-%E7%9B%9B%E6%9C%80%E5%A4%9A%E6%B0%B4%E7%9A%84%E5%AE%B9%E5%99%A8/","excerpt":"","text":"1 åŸé¢˜ç»™å®š n ä¸ªéè´Ÿæ•´æ•° a1ï¼Œa2ï¼Œâ€¦ï¼Œanï¼Œæ¯ä¸ªæ•°ä»£è¡¨åæ ‡ä¸­çš„ä¸€ä¸ªç‚¹ (i, ai) ã€‚åœ¨åæ ‡å†…ç”» n æ¡å‚ç›´çº¿ï¼Œå‚ç›´çº¿ i çš„ä¸¤ä¸ªç«¯ç‚¹åˆ†åˆ«ä¸º (i, ai) å’Œ (i, 0)ã€‚æ‰¾å‡ºå…¶ä¸­çš„ä¸¤æ¡çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸ x è½´å…±åŒæ„æˆçš„å®¹å™¨å¯ä»¥å®¹çº³æœ€å¤šçš„æ°´ã€‚ è¯´æ˜ï¼š ä½ ä¸èƒ½å€¾æ–œå®¹å™¨ï¼Œä¸” n çš„å€¼è‡³å°‘ä¸º 2ã€‚ å›¾ä¸­å‚ç›´çº¿ä»£è¡¨è¾“å…¥æ•°ç»„ [1,8,6,2,5,4,8,3,7]ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œå®¹å™¨èƒ½å¤Ÿå®¹çº³æ°´ï¼ˆè¡¨ç¤ºä¸ºè“è‰²éƒ¨åˆ†ï¼‰çš„æœ€å¤§å€¼ä¸º 49ã€‚ ç¤ºä¾‹: è¾“å…¥: [1,8,6,2,5,4,8,3,7]è¾“å‡º: 49 2 è§£æ³•2.1 æ€æƒ³ä¸¤ä¸ªçº¿æ®µä¹‹é—´å½¢æˆçš„åŒºåŸŸå§‹ç»ˆå—è¾ƒçŸ­é•¿åº¦çš„é™åˆ¶ã€‚ å¦å¤–ï¼Œä¸¤ä¸ªçº¿æ®µä¹‹é—´çš„è·ç¦»è¶Šå¤§ï¼Œè·å¾—çš„é¢ç§¯è¶Šå¤§ã€‚ æˆ‘ä»¬åœ¨æ•°ç»„ä¸­ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªåœ¨å¼€å¤´ï¼Œä¸€ä¸ªåœ¨æœ«å°¾ã€‚ æ¯æ¬¡ç§»åŠ¨å°†è¾ƒçŸ­çš„çº¿æ®µå‘è¾ƒé•¿çš„çº¿æ®µç§»åŠ¨ä¸€æ­¥ã€‚å¹¶åœ¨è¿‡ç¨‹ä¸­è®°å½•å‡ºç°çš„æœ€å¤§é¢ç§¯ã€‚ 2.2 ä»£ç public class Solution { public int maxArea(int[] height) { int max = 0; int left = 0; int right = height.length - 1; while (left &lt; right) { max = Math.max(max, Math.min(height[left], height[right]) * (right - left)); if (height[left] &lt; height[right]) left++; else right--; } return max; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"è®¡ç½‘å¤ä¹ 01è®¡ç®—æœºç½‘ç»œæ¦‚è¿°","slug":"è®¡ç½‘å¤ä¹ 01è®¡ç®—æœºç½‘ç»œæ¦‚è¿°","date":"2020-02-26T13:06:34.000Z","updated":"2020-04-10T06:16:10.264Z","comments":true,"path":"article/è®¡ç½‘å¤ä¹ 01è®¡ç®—æœºç½‘ç»œæ¦‚è¿°/","link":"","permalink":"https://www.codetool.top/article/%E8%AE%A1%E7%BD%91%E5%A4%8D%E4%B9%A001%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%A6%82%E8%BF%B0/","excerpt":"","text":"å¶ç„¶ç¿»åˆ°äº†æˆ‘ä¸Šè¯¾æœŸé—´åšçš„æ€ç»´å¯¼å›¾ï¼Œå‘å‡ºæ¥æ°´ä¸€æ°´åšå®¢ï¼ˆä»Šå¤©å¤ªå¿™äº†ï¼‰ æœ¬æ–‡å‚è€ƒèµ„æºï¼š è®¡ç®—æœºç½‘ç»œç³»åˆ—â€“ä»€ä¹ˆæ˜¯ç”µè·¯äº¤æ¢å’Œåˆ†ç»„äº¤æ¢ï¼Ÿ - å¸…åœ° - åšå®¢å›­ ç”µè·¯äº¤æ¢ï¼ŒæŠ¥æ–‡äº¤æ¢ï¼Œåˆ†ç»„äº¤æ¢_ç½‘ç»œ_å¤©é©¬æµæ¬£-CSDNåšå®¢ RTTï¼ˆå¾€è¿”æ—¶é—´ï¼‰å’ŒRPC_ç½‘ç»œ_ITå¾èƒ–å­æŠ€æœ¯ä¸“æ -CSDNåšå®¢ è®¡ç®—æœºç½‘ç»œï¼ˆä¸€ï¼‰å›¾è§£ï¼šè®¡ç®—æœºç½‘ç»œäº”å±‚ä½“ç³»ç»“æ„_ç½‘ç»œ_è…Šå…«ç²¥-CSDNåšå®¢ 1 ä¿¡æ¯æ—¶ä»£çš„ä½œç”¨ 2 äº’è”ç½‘æ¦‚è¿° 3 äº’è”ç½‘ç»„æˆ åˆ’é‡ç‚¹ï¼š 3.1 ç”µè·¯äº¤æ¢ æŠ¥æ–‡ï¼š æˆ‘ä»¬å°†ä½äºåº”ç”¨å±‚çš„ä¿¡æ¯åˆ†ç»„ç§°ä¸ºæŠ¥æ–‡ï¼Œä¸€èˆ¬æŒ‡å®Œæ•´çš„ä¿¡æ¯ï¼Œä¼ è¾“å±‚å®ç°æŠ¥æ–‡äº¤ä»˜ã€‚ ç”µè·¯äº¤æ¢ï¼š ç”µè·¯äº¤æ¢è¦æ±‚å¿…é¡»é¦–å…ˆåœ¨é€šä¿¡åŒæ–¹ä¹‹é—´å»ºç«‹è¿æ¥é€šé“ã€‚åœ¨è¿æ¥å»ºç«‹æˆåŠŸä¹‹åï¼ŒåŒæ–¹çš„é€šä¿¡æ´»åŠ¨æ‰èƒ½å¼€å§‹ã€‚é€šä¿¡æ—¶åŒæ–¹ä¼šä¸€ç›´éœ¸å è¿™æ¡è·¯å¾„ï¼Œå› æ­¤ï¼Œç”µè·¯è¿æ¥çš„æ–¹å¼èµ„æºçš„åˆ©ç”¨ç‡æ˜¯æ¯”è¾ƒä½çš„ã€‚ ä¸ºäº†è§£å†³è¿™ç§èµ„æºåˆ©ç”¨ç‡ä½çš„é—®é¢˜ï¼Œå¼•å‡ºäº†å­˜å‚¨è½¬å‘æŠ€æœ¯ï¼š å­˜å‚¨è½¬å‘ï¼š ä»¥å¤ªç½‘äº¤æ¢æœºçš„æ§åˆ¶å™¨å…ˆå°†è¾“å…¥ç«¯å£åˆ°æ¥çš„æ•°æ®åŒ…ç¼“å­˜èµ·æ¥ï¼Œå…ˆæ£€æŸ¥æ•°æ®åŒ…æ˜¯å¦æ­£ç¡®ï¼Œå¹¶è¿‡æ»¤æ‰å†²çªåŒ…é”™è¯¯ã€‚ç¡®å®šåŒ…æ­£ç¡®åï¼Œå–å‡ºç›®çš„åœ°å€ï¼Œé€šè¿‡æŸ¥æ‰¾è¡¨æ‰¾åˆ°æƒ³è¦å‘é€çš„è¾“å‡ºç«¯å£åœ°å€ï¼Œç„¶åå°†è¯¥åŒ…å‘é€å‡ºå»ã€‚ ä»è€Œå‘å±•å‡ºäº†æŠ¥æ–‡äº¤æ¢ï¼š 3.2 æŠ¥æ–‡äº¤æ¢æŠ¥æ–‡äº¤æ¢ï¼š æ•´ä¸ªæŠ¥æ–‡å…ˆä¼ è¾“åˆ°ç›¸é‚»çš„ç»“ç‚¹ï¼Œå…¨éƒ¨å­˜å‚¨ä¸‹æ¥åæŸ¥æ‰¾è½¬å‘è¡¨ï¼Œè½¬å‘åˆ°ä¸‹ä¸€ä¸ªç»“ç‚¹ã€‚è¿™ç§æ–¹å¼å¹¶ä¸å¸¸è§ï¼Œå› ä¸ºä¸€ä¸ªæŠ¥æ–‡é€šå¸¸å¾ˆå¤§ï¼ŒæŸä¸ªè·¯ç”±å¿…é¡»æ”¶åˆ°ä¸€ä¸ªå®Œæ•´çš„æŠ¥æ–‡æ‰èƒ½æŠŠæŠ¥æ–‡è½¬å‘å‡ºå»ï¼Œäº§ç”Ÿè¾ƒå¤§çš„ä¼ è¾“æ—¶å»¶ï¼Œå› æ­¤æ•ˆç‡è¾ƒä½ã€‚ åˆ†ç»„ï¼š åˆ†ç»„æ˜¯åœ¨ç½‘ç»œä¸­ä¼ è¾“çš„äºŒè¿›åˆ¶æ ¼å¼çš„å•å…ƒï¼Œä¸ºäº†æä¾›é€šä¿¡æ€§èƒ½å’Œå¯é æ€§ï¼Œæ¯ä¸ªç”¨æˆ·å‘é€çš„æ•°æ®ä¼šè¢«åˆ†æˆå¤šä¸ªæ›´å°çš„éƒ¨åˆ†ã€‚åœ¨æ¯ä¸ªéƒ¨åˆ†çš„å‰é¢åŠ ä¸Šä¸€äº›å¿…è¦çš„æ§åˆ¶ä¿¡æ¯ç»„æˆçš„é¦–éƒ¨ï¼Œæœ‰æ—¶ä¹Ÿä¼šåŠ ä¸Šå°¾éƒ¨ï¼Œå°±æ„æˆäº†ä¸€ä¸ªåˆ†ç»„ã€‚å®ƒçš„èµ·å§‹å’Œç›®çš„åœ°æ˜¯ç½‘ç»œå±‚ã€‚ åˆ†ç»„äº¤æ¢ï¼š å°†æŠ¥æ–‡åˆ’åˆ†ä¸ºåˆ†ç»„è½¬å‘ï¼Œæ—¶å»¶æ›´ä½ã€‚ å­˜å‚¨è½¬å‘ä¼šå‡ºç°çš„é—®é¢˜ï¼š æ¯ä¸ªè·¯ç”±å¿…é¡»æ”¶åˆ°ä¸€ä¸ªå®Œæ•´çš„æŠ¥æ–‡/åˆ†ç»„æ‰èƒ½è½¬å‘å‡ºå»ï¼Œäº§ç”Ÿä¼ è¾“æ—¶å»¶ åˆ†ç»„åœ¨è¿›å…¥è·¯ç”±å™¨åè¦å…ˆåœ¨è¾“å…¥é˜Ÿåˆ—ä¸­ç­‰å¾…å¤„ç†ã€‚åœ¨è·¯ç”±å™¨ç¡®å®šäº†è½¬å‘æ¥å£åè¿˜éœ€è¦åœ¨è¾“å‡ºé˜Ÿåˆ—ä¸­ç­‰å¾…è½¬å‘ï¼Œæ‰€ä»¥å°±äº§ç”Ÿäº†æ’é˜Ÿæ—¶å»¶ã€‚ æ•°æ®è¢«åˆ’åˆ†ä¹‹åä¸ºäº†è½¬å‘åŠ ä¸Šäº†ä¸€äº›æ§åˆ¶ä¿¡æ¯ï¼Œå¢åŠ äº†å¼€é”€ã€‚ 4 è®¡ç®—æœºç½‘ç»œç±»åˆ« 5 è®¡ç®—æœºç½‘ç»œæ€§èƒ½ åˆ’é‡ç‚¹ï¼š 5.1 é€Ÿç‡æ•°æ®çš„ä¼ é€é€Ÿç‡ï¼Œä¹Ÿç§°æ•°æ®ç‡æˆ–æ¯”ç‰¹ç‡ï¼Œå•ä½æ˜¯bit/sã€‚ç½‘ç»œçš„é€Ÿç‡å¾€å¾€æŒ‡çš„æ˜¯é¢å®šé€Ÿç‡æˆ–æ ‡ç§°é€Ÿç‡ï¼ˆç†æƒ³é€Ÿç‡ï¼‰ã€‚ 5.2 å¸¦å®½åœ¨è®¡ç®—æœºç½‘ç»œä¸­å¸¦å®½ç”¨æ¥è¡¨ç¤ºç½‘ç»œä¸­æŸé€šé“ä¼ é€æ•°æ®çš„èƒ½åŠ›ï¼Œç½‘ç»œå¸¦å®½æŒ‡åœ¨å•ä½æ—¶é—´å†…ç½‘ç»œä¸­çš„æŸä¿¡é“æ‰€èƒ½é€šè¿‡çš„â€œæœ€é«˜æ•°æ®ç‡â€ï¼Œå•ä½ä¹Ÿæ˜¯bit/sã€‚ å‚è€ƒå¦‚ä½•ç†è§£è®¡ç®—æœºç½‘ç»œæ€§èƒ½æŒ‡æ ‡ä¹‹é€Ÿç‡ä¸å¸¦å®½çš„åŒºåˆ«ï¼Ÿ - çŸ¥ä¹ 5.3 ååé‡ååé‡æŒ‡çš„å°±æ˜¯æŸæ—¶åˆ»çš„é€Ÿç‡ï¼Œå•ä½ä¹Ÿæ˜¯bit/s 5.4 æ—¶å»¶5.4.1 å‘é€æ—¶å»¶ä¸»æœºæˆ–è€…è·¯ç”±å™¨å‘é€æ•°æ®å¸§æ‰€éœ€è¦çš„æ—¶é—´ï¼Œå‘é€æ—¶å»¶çš„è®¡ç®—å…¬å¼ä¸ºï¼š æ•°æ®å¸§é•¿åº¦/å‘é€é€Ÿç‡ 5.4.2 ä¼ æ’­æ—¶å»¶ç”µç£æ³¢åœ¨ä¿¡é“ä¸­ä¼ æ’­ä¸€å®šè·ç¦»éœ€è¦èŠ±è´¹çš„æ—¶é—´ï¼Œä¼ æ’­æ—¶å»¶çš„è®¡ç®—å…¬å¼ä¸ºï¼š ä¿¡é“é•¿åº¦/ç”µç£æ³¢åœ¨ä¿¡é“ä¸Šçš„ä¼ æ’­é€Ÿç‡ 5.4.3 å¤„ç†æ—¶å»¶ä¸»æœºæˆ–è€…è·¯ç”±å™¨åœ¨æ¥å—åˆ°åˆ†ç»„æ—¶å€™è¦è¯è´¹ä¸€å®šçš„æ—¶é—´è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚åˆ†æåˆ†ç»„çš„é¦–éƒ¨ï¼Œä»åˆ†ç»„ä¸­æå–æ•°æ®éƒ¨åˆ†ï¼Œè¿è¡Œå·®é”™æ£€éªŒæˆ–è€…æŸ¥æ‰¾é€‚å½“çš„è·¯ç”±ç­‰ç­‰ã€‚ è¿™éƒ¨åˆ†å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ 5.4.4 æ’é˜Ÿæ—¶å»¶åˆ†ç»„åœ¨è¿›å…¥è·¯ç”±å™¨åè¦å…ˆåœ¨è¾“å…¥é˜Ÿåˆ—ä¸­ç­‰å¾…å¤„ç†ã€‚åœ¨è·¯ç”±å™¨ç¡®å®šäº†è½¬å‘æ¥å£åè¿˜éœ€è¦åœ¨è¾“å‡ºé˜Ÿåˆ—ä¸­ç­‰å¾…è½¬å‘ï¼Œæ‰€ä»¥å°±äº§ç”Ÿäº†æ’é˜Ÿæ—¶å»¶ã€‚ è¿™éƒ¨åˆ†å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ 5.5 æ—¶å»¶å¸¦å®½ç§¯è¡¨ç¤ºä¸€ä¸ªé“¾è·¯å¯ä»¥å®¹çº³çš„æœ€å¤šæ¯”ç‰¹ï¼Œè®¡ç®—å…¬å¼ä¸ºï¼š ä¼ æ’­æ—¶å»¶ * å¸¦å®½ 5.6 å¾€è¿”æ—¶é—´RTTRTT(Round-Trip Time)å¾€è¿”æ—¶é—´åœ¨è®¡ç®—æœºç½‘ç»œä¸­å®ƒæ˜¯ä¸€ä¸ªé‡è¦çš„æ€§èƒ½æŒ‡æ ‡ã€‚è¡¨ç¤ºä»å‘é€ç«¯å‘é€æ•°æ®å¼€å§‹ï¼Œåˆ°å‘é€ç«¯æ”¶åˆ°æ¥è‡ªæ¥æ”¶ç«¯çš„ç¡®è®¤ï¼ˆæ¥æ”¶ç«¯æ”¶åˆ°æ•°æ®åä¾¿ç«‹å³å‘é€ç¡®è®¤ï¼Œä¸åŒ…å«æ•°æ®ä¼ è¾“æ—¶é—´ï¼‰æ€»å…±ç»å†çš„æ—¶é—´ã€‚ å®ƒçº¦ç­‰äºä¼ æ’­æ—¶å»¶*2 6 ä½“ç³»ç»“æ„ åˆ’é‡ç‚¹ï¼š 6.1 OSIä¸ƒå±‚æ¨¡å‹ åº”ç”¨å±‚ï¼š åº”ç”¨ç¨‹åºé—´é€šä¿¡ ä¼ è¾“å•ä½APDU è¡¨ç¤ºå±‚ï¼š å¤„ç†æ•°æ®æ ¼å¼,åŠ å¯† ä¼ è¾“å•ä½PPDU ä¼šè¯å±‚ï¼šå»ºç«‹,ç»´æŠ¤å’Œç®¡ç†ä¼šè¯ ä¼ è¾“å•ä½SPDU ä¼ è¾“å±‚ï¼šå»ºç«‹ç«¯åˆ°ç«¯çš„é“¾æ¥ ä¼ è¾“å•ä½segment(æ®µ) ç½‘ç»œå±‚ï¼šå¯»å€å’Œè·¯ç”±é€‰æ‹© ä¼ è¾“å•ä½packet æ•°æ®é“¾è·¯å±‚ï¼šä»‹è´¨è®¿é—®,é“¾è·¯ç®¡ç† ä¼ è¾“å•ä½frame(å¸§) ç‰©ç†å±‚ï¼šç‰©ç†å±‚ æ¯”ç‰¹æµä¼ è¾“ ä¼ è¾“å•ä½BIT 6.2 TCP/IPå››å±‚æ¨¡å‹ åº”ç”¨å±‚:ç›¸å½“äºOSIä¸Šä¸‰å±‚ å¸¸è§åè®®: FTP TELNET ä¼ è¾“å±‚ TCP UDP ç½‘ç»œå±‚ ICMP IP IGMP é“¾è·¯å±‚:ç›¸å½“äºOSIä¸‹äºŒå±‚ ARP RARP 6.3 ç»¼åˆè€Œæ¥çš„äº”å±‚æ¨¡å‹ å¯¹åº”çš„å„å±‚ä¸­é—´è®¾å¤‡ï¼š å¯¹åº”å„å±‚çš„ä¼ è¾“æ•°æ®å•å…ƒï¼š å…¸å‹è®¾å¤‡ ä¸­é—´è®¾å¤‡ æ•°æ®å•å…ƒ ç½‘ç»œåè®® ç‰©ç†å±‚ ä¸­ç»§å™¨ã€é›†çº¿å™¨ ä¸­ç»§å™¨ã€é›†çº¿å™¨ ä½ï¼ˆbitï¼‰ æ—  ä½¿ç”¨äº†å…‰çº¤ã€ åŒè½´ç”µç¼†ã€åŒç»çº¿â€¦â€¦ æ•°æ®é“¾è·¯å±‚ ç½‘å¡ã€ç½‘æ¡¥ã€äº¤æ¢æœº ç½‘æ¡¥ã€äº¤æ¢æœº æ•°æ®å¸§ ï¼ˆFrameï¼‰ ARQã€SWã€CSMA/CDã€PPPã€HDLCã€ATM&nbsp; ç½‘ç»œå±‚ è·¯ç”±å™¨ã€é˜²ç«å¢™ã€å¤šå±‚äº¤æ¢æœº è·¯ç”±å™¨ æ•°æ®åŒ…ï¼ˆPacketï¼‰æˆ–åˆ†ç»„ IPã€ARP ã€RARP ã€ICMP&nbsp;ã€ICMPv6ã€IGMPã€RIP ã€OSPF ã€BGP ä¼ è¾“å±‚ è¿›ç¨‹å’Œç«¯å£ å››å±‚è·¯ç”±å™¨ TCPï¼šæŠ¥æ–‡æ®µUDPï¼šæ•°æ®æŠ¥ TCP&nbsp;&nbsp;UDP åº”ç”¨å±‚ åº”ç”¨ç¨‹åºï¼Œå¦‚FTPï¼ŒSMTP ï¼ŒHTTP ç½‘å…³ æŠ¥æ–‡ï¼ˆmessageï¼‰ DHCPã€DNSã€FTPã€HTTPã€POP3ã€SMTP ã€SSH ã€TELNET","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","permalink":"https://www.codetool.top/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"}]},{"title":"MySQLå­¦ä¹ ç¬”è®°ä¹‹InnoDBå¼•æ“æ¦‚è¿°","slug":"MySQLå­¦ä¹ ç¬”è®°ä¹‹InnoDBå¼•æ“æ¦‚è¿°ï¼ˆä¸Šï¼‰","date":"2020-02-26T07:27:17.000Z","updated":"2020-03-07T14:14:19.113Z","comments":true,"path":"article/MySQLå­¦ä¹ ç¬”è®°ä¹‹InnoDBå¼•æ“æ¦‚è¿°ï¼ˆä¸Šï¼‰/","link":"","permalink":"https://www.codetool.top/article/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8BInnoDB%E5%BC%95%E6%93%8E%E6%A6%82%E8%BF%B0%EF%BC%88%E4%B8%8A%EF%BC%89/","excerpt":"","text":"è¯¥ç¬”è®°ä¸ºã€ŠMySQLæŠ€æœ¯å†…å¹•:InnoDBå­˜å‚¨å¼•æ“ã€‹çš„è¯»ä¹¦ç¬”è®°ï¼Œå¤šå›¾é¢„è­¦ã€‚ 1 MySQLä½“ç³»ç»“æ„ 1.1 è¿æ¥å±‚ï¼ˆç®¡ç†å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œç»´æŠ¤çº¿ç¨‹æ± ï¼‰ æœ€ä¸Šå±‚æ˜¯ä¸€äº›å®¢æˆ·ç«¯å’Œè¿æ¥æœåŠ¡ï¼Œå¼•å…¥äº†çº¿ç¨‹æ± çš„æ¦‚å¿µï¼›å®ç°åŸºäº SSL çš„å®‰å…¨è¿æ¥ã€‚ æ¯ä¸ªå®¢æˆ·ç«¯éƒ½ä¼šåœ¨æœåŠ¡å™¨è¿›ç¨‹ä¸­æ‹¥æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªè¿æ¥çš„æŸ¥è¯¢åªä¼šåœ¨è¿™ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ å½“å®¢æˆ·ç«¯è¿æ¥åˆ° MySQL æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨éœ€è¦å¯¹å…¶è¿›è¡Œè®¤è¯ã€‚å¦‚æœä½¿ç”¨äº† SSL å®‰å…¨å¥—æ¥å­—çš„æ–¹å¼è¿æ¥ï¼Œè¿˜ä¼šä½¿ç”¨ X.509 è¯ä¹¦è®¤è¯ã€‚ä¸€æ—¦å®¢æˆ·ç«¯è¿æ¥æˆåŠŸï¼ŒæœåŠ¡å™¨ä¼šç»§ç»­éªŒè¯è¯¥å®¢æˆ·ç«¯æ˜¯å¦å…·æœ‰æ‰§è¡ŒæŸä¸ªç‰¹å®šæŸ¥è¯¢çš„æƒé™ã€‚ 1.2 æœåŠ¡å™¨ï¼ˆä¸å…·ä½“å­˜å‚¨å¼•æ“è§£è€¦ï¼ŒæœåŠ¡å™¨é€šè¿‡ API ä¸å­˜å‚¨å¼•æ“è¿›è¡Œé€šä¿¡ï¼‰ SQL æ¥å£ SQL åˆ†æä¸ä¼˜åŒ– å­˜å‚¨è¿‡ç¨‹ è§¦å‘å™¨ è§†å›¾ MySQL ä¼šè§£ææŸ¥è¯¢ï¼Œå¹¶åˆ›å»ºå†…éƒ¨æ•°æ®ç»“æ„ï¼ˆè§£ææ ‘ï¼‰ï¼Œç„¶åå¯¹å…¶è¿›è¡Œå„ç§ä¼˜åŒ–ï¼ŒåŒ…æ‹¬é‡å†™æŸ¥è¯¢ã€å†³å®šè¡¨çš„è¯»å–é¡ºåºï¼Œä»¥åŠé€‰æ‹©åˆé€‚çš„ç´¢å¼•ç­‰ã€‚ ä¼˜åŒ–å™¨å¹¶ä¸å…³å¿ƒè¡¨ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆå­˜å‚¨å¼•æ“ï¼Œä½†å­˜å‚¨å¼•æ“å¯¹ä¼˜åŒ–æŸ¥è¯¢æ˜¯æœ‰å½±å“çš„ã€‚ä¼˜åŒ–å™¨ä¼šè¯·æ±‚å­˜å‚¨å¼•æ“æä¾›å®¹é‡æˆ–æŸä¸ªå…·ä½“æ“ä½œçš„å¼€é”€ä¿¡æ¯ï¼Œä»¥åŠè¡¨æ•°æ®çš„ç»Ÿè®¡ä¿¡æ¯ç­‰ã€‚ å¯¹äº SELECT è¯­å¥ï¼Œåœ¨è§£ææŸ¥è¯¢å‰ï¼ŒæœåŠ¡å™¨ä¼šå…ˆæ£€æŸ¥æŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœèƒ½å¤Ÿåœ¨å…¶ä¸­æ‰¾åˆ°å¯¹åº”çš„æŸ¥è¯¢ï¼ŒæœåŠ¡å™¨å°±ä¸å†æ‰§è¡ŒæŸ¥è¯¢è§£æã€ä¼˜åŒ–å’Œæ‰§è¡Œçš„æ•´ä¸ªè¿‡ç¨‹ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›æŸ¥è¯¢ç¼“å­˜ä¸­çš„ç»“æœé›†ã€‚ 1.3 å­˜å‚¨å¼•æ“å±‚ï¼ˆè´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œå­˜å–ï¼‰ å­˜å‚¨å¼•æ“å±‚ï¼Œå­˜å‚¨å¼•æ“çœŸæ­£çš„è´Ÿè´£äº† MySQL ä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ã€‚ å­˜å‚¨å¼•æ“ API åŒ…å«äº†å‡ åä¸ªåº•å±‚å‡½æ•°ï¼Œç”¨äºæ‰§è¡Œè¯¸å¦‚â€œå¼€å¯ä¸€ä¸ªäº‹åŠ¡â€æˆ–è€…â€œæ ¹æ®ä¸»é”®æå–ä¸€è¡Œè®°å½•â€ç­‰æ“ä½œã€‚ä½†å­˜å‚¨å¼•æ“ä¸ä¼šå»è§£æ SQLï¼ˆInnoDB æ˜¯ä¸€ä¸ªä¾‹å¤–ï¼Œå®ƒä¼šè§£æå¤–é”®å®šä¹‰ï¼Œå› ä¸ºæœåŠ¡å™¨æ²¡æœ‰å®ç°è¯¥åŠŸèƒ½ï¼‰ï¼Œä¸åŒå­˜å‚¨å¼•æ“ä¹‹é—´ä¹Ÿä¸ä¼šç›¸äº’é€šä¿¡ï¼Œè€Œåªæ˜¯ç®€å•åœ°å“åº”ä¸Šå±‚æœåŠ¡å™¨çš„è¯·æ±‚ã€‚ 1.4 å­˜å‚¨å±‚ï¼ˆå°†æ•°æ®å­˜å‚¨åˆ°æ–‡ä»¶ç³»ç»Ÿä¸Šï¼‰ æ•°æ®å­˜å‚¨å±‚ï¼Œä¸»è¦æ˜¯å°†æ•°æ®å­˜å‚¨åœ¨è¿è¡Œäºè£¸è®¾å¤‡çš„æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Šï¼Œå¹¶å®Œæˆä¸å­˜å‚¨å¼•æ“çš„äº¤äº’ã€‚ 2 InnoDBå¼•æ“ä¸MyISAMå¼•æ“ä»‹ç»2.1 InnoDB æ”¯æŒäº‹åŠ¡ è¡Œé”è®¾è®¡ æ”¯æŒå¤–é”® ä½¿ç”¨MVCC é¢å‘OLTP 2.2 MyISAM 3 InnoDBå¼•æ“ä»‹ç»3.1 æ¦‚è¿° 3.2 InnoDBä½“ç³»æ¶æ„ 3.3 åå°çº¿ç¨‹ innodb_purge_threads 3.4 å†…å­˜ innodb_buffer_pool_size innodb_buffer_pool_instances innodb_old_blocks_pct innodb_old_blocks_time innodb_log_buffer_size 3.5 CheckPointæŠ€æœ¯CheckPointæŠ€æœ¯å³æ£€æŸ¥ç‚¹æŠ€æœ¯ï¼Œæˆ‘åœ¨æ•°æ®åº“ç†è®ºä¹‹äº‹åŠ¡ä¸æ¢å¤æŠ€æœ¯ä¸­æœ‰æåŠã€‚ä¸è¿‡å½“æ—¶å¯¹æ£€æŸ¥ç‚¹ç›¸å…³çš„é˜è¿°æ˜¯è®°å½•äº†æäº¤çš„äº‹åŠ¡ï¼Œç„¶è€ŒInnoDBå¹¶ä¸ä¼šç«‹å³å†™å›ç£ç›˜ï¼Œæ‰€ä»¥è¿™é‡Œè°ˆçš„æ˜¯è„é¡µçš„åˆ·æ–°ã€‚ 4 InnoDBé€»è¾‘å­˜å‚¨ç»“æ„InnoDBçš„æ‰€æœ‰æ•°æ®éƒ½è¢«é€»è¾‘åœ°å­˜æ”¾åœ¨è¡¨ç©ºé—´ï¼Œè¡¨ç©ºé—´åˆç”±æ®µï¼ŒåŒºï¼Œé¡µç»„æˆã€‚ 4.1 è¡¨ç©ºé—´é»˜è®¤æƒ…å†µä¸‹InnoDBå­˜å‚¨å¼•æ“æœ‰ä¸€ä¸ªå…±äº«è¡¨ç©ºé—´ibdata1ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½å­˜æ”¾åœ¨è¿™ä¸ªè¡¨ç©ºé—´å†…ã€‚å¦‚æœç”¨æˆ·å¯ç”¨äº†å‚æ•°innodb_file_per_tableï¼Œåˆ™æ¯å¼ è¡¨çš„æ•°æ®å¯ä»¥å•ç‹¬æ”¾åˆ°ä¸€ä¸ªè¡¨ç©ºé—´å†…ï¼Œå¯¹åº”ä¸€ä¸ªibdæ–‡ä»¶ï¼Œç§°ä¸ºç‹¬ç«‹è¡¨ç©ºé—´ï¼Œå®ƒå­˜æ”¾çš„åªæ˜¯æ•°æ®ã€ç´¢å¼•å’Œæ’å…¥ç¼“å†² bitmap é¡µï¼Œå…¶ä»–æ•°æ®ï¼Œå¦‚å›æ»šä¿¡æ¯ã€æ’å…¥ç¼“å†²ç´¢å¼•é¡µã€ç³»ç»Ÿäº‹åŠ¡ä¿¡æ¯ã€äºŒæ¬¡å†™ç¼“å†²ç­‰è¿˜æ˜¯å­˜æ”¾åœ¨åŸæ¥çš„å…±äº«è¡¨ç©ºé—´ä¸­ã€‚ 4.2 æ®µæ®µå°±æ˜¯ä¸Šå›¾çš„segmentåŒºåŸŸï¼Œå¸¸è§çš„æ®µæœ‰æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µç­‰ï¼Œåœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œå¯¹æ®µçš„ç®¡ç†éƒ½æ˜¯ç”±å¼•æ“è‡ªèº«æ‰€å®Œæˆçš„ã€‚ æ•°æ®æ®µå³ä¸ºB+æ ‘çš„å¶å­èŠ‚ç‚¹ï¼Œç´¢å¼•æ®µå³ä¸ºB+æ ‘çš„éç´¢å¼•èŠ‚ç‚¹ã€‚ 4.3 åŒº åŒºå°±æ˜¯ä¸Šå›¾çš„extentåŒºåŸŸï¼ŒåŒºæ˜¯ç”±è¿ç»­çš„é¡µç»„æˆçš„ç©ºé—´ï¼Œæ— è®ºé¡µçš„å¤§å°æ€ä¹ˆå˜ï¼ŒåŒºçš„å¤§å°é»˜è®¤æ€»æ˜¯ä¸º1MBã€‚ä¸ºäº†ä¿è¯åŒºä¸­çš„é¡µçš„è¿ç»­æ€§ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä¸€æ¬¡ä»ç£ç›˜ç”³è¯·4-5ä¸ªåŒºï¼ŒInnoDBé¡µçš„å¤§å°é»˜è®¤ä¸º16kbï¼Œå³ä¸€ä¸ªåŒºä¸€å…±æœ‰64ï¼ˆ1MB/16kb=16ï¼‰ä¸ªè¿ç»­çš„é¡µã€‚æ¯ä¸ªæ®µå¼€å§‹ï¼Œå…ˆç”¨32é¡µï¼ˆpageï¼‰å¤§å°çš„ç¢ç‰‡é¡µæ¥å­˜æ”¾æ•°æ®ï¼Œåœ¨ä½¿ç”¨å®Œè¿™äº›é¡µä¹‹åæ‰æ˜¯64ä¸ªè¿ç»­é¡µçš„ç”³è¯·ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ï¼Œå¯¹äºä¸€äº›å°è¡¨æˆ–è€…æ˜¯undoç±»çš„æ®µï¼Œå¯ä»¥å¼€å§‹ç”³è¯·è¾ƒå°çš„ç©ºé—´ï¼ŒèŠ‚çº¦ç£ç›˜å¼€é”€ã€‚ 4.4 é¡µé¡µåœ¨ä¸€äº›æ–‡æ¡£é‡Œä¹Ÿè¢«ç§°ä¸ºå—ã€‚ é¡µå°±æ˜¯ä¸Šå›¾çš„pageåŒºåŸŸï¼Œä¹Ÿå¯ä»¥å«å—ã€‚é¡µæ˜¯InnoDBç£ç›˜ç®¡ç†çš„æœ€å°å•ä½ã€‚é»˜è®¤å¤§å°ä¸º16KBï¼Œå¯ä»¥é€šè¿‡å‚æ•°innodb_page_sizeæ¥è®¾ç½®ã€‚å¸¸è§çš„é¡µç±»å‹æœ‰ï¼šæ•°æ®é¡µï¼Œundoé¡µï¼Œç³»ç»Ÿé¡µï¼Œäº‹åŠ¡æ•°æ®é¡µï¼Œæ’å…¥ç¼“å†²ä½å›¾é¡µï¼Œæ’å…¥ç¼“å†²ç©ºé—²åˆ—è¡¨é¡µï¼Œæœªå‹ç¼©çš„äºŒè¿›åˆ¶å¤§å¯¹è±¡é¡µï¼Œå‹ç¼©çš„äºŒè¿›åˆ¶å¤§å¯¹è±¡é¡µç­‰ã€‚ 4.5 è¡Œæ¯ä¸ªé¡µå…è®¸å­˜æ”¾ 16KB/2 â€“ 200 è¡Œçš„è®°å½•ï¼Œå³ 7992 è¡Œè®°å½•ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"MySQL","slug":"MySQL","permalink":"https://www.codetool.top/tags/MySQL/"}]},{"title":"leetcode7-æ•´æ•°åè½¬","slug":"leetcode7-æ•´æ•°åè½¬","date":"2020-02-25T17:25:51.000Z","updated":"2020-02-25T17:32:03.665Z","comments":true,"path":"article/leetcode7-æ•´æ•°åè½¬/","link":"","permalink":"https://www.codetool.top/article/leetcode7-%E6%95%B4%E6%95%B0%E5%8F%8D%E8%BD%AC/","excerpt":"","text":"1 åŸé¢˜ç»™å‡ºä¸€ä¸ª 32 ä½çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œä½ éœ€è¦å°†è¿™ä¸ªæ•´æ•°ä¸­æ¯ä½ä¸Šçš„æ•°å­—è¿›è¡Œåè½¬ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š 123è¾“å‡ºï¼š 321 ç¤ºä¾‹2: è¾“å…¥ï¼š -123è¾“å‡ºï¼š -321 ç¤ºä¾‹3: è¾“å…¥ï¼š 120è¾“å‡ºï¼š 21 æ³¨æ„: å‡è®¾æˆ‘ä»¬çš„ç¯å¢ƒåªèƒ½å­˜å‚¨å¾—ä¸‹ 32 ä½çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œåˆ™å…¶æ•°å€¼èŒƒå›´ä¸º [âˆ’231, 231 âˆ’ 1]ã€‚è¯·æ ¹æ®è¿™ä¸ªå‡è®¾ï¼Œå¦‚æœåè½¬åæ•´æ•°æº¢å‡ºé‚£ä¹ˆå°±è¿”å› 0ã€‚ 2 è§£æ³•2.1 æ€æƒ³æ¯æ¬¡ç”¨%10å–ä½™å°±èƒ½è·å¾—åŸæ•°å­—æœ€åä¸€ä½çš„æ•°å­—ï¼Œå…³é”®æ˜¯æ€ä¹ˆåˆ¤æ–­åœ¨è¿ç®—è¿‡ç¨‹ä¸­æ˜¯å¦æº¢å‡ºã€‚ 2.2 ä»£ç class Solution { public int reverse(int x) { int ans = 0; boolean isNeg = false; if(x == Integer.MIN_VALUE) return 0; if(x &lt; 0){ isNeg = true; x = -x; } while(x!=0){ if(ans>Integer.MAX_VALUE/10) return 0; ans = ans*10+ x%10; x = x/10; } if(isNeg) ans = -ans; return ans; } } ç„¶åæœ‰çœ‹åˆ°å¦ä¸€ç§å¾ˆå·§å¦™çš„åˆ¤æ–­æº¢å‡ºçš„æ–¹æ³•ï¼š class Solution { public int reverse(int x) { int ans = 0; while (x != 0) { if ((ans * 10) / 10 != ans) { ans = 0; break; } ans = ans * 10 + x % 10; x = x / 10; } return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"Springä¹‹AOPé…ç½®","slug":"Springä¹‹AOPé…ç½®","date":"2020-02-25T15:39:22.000Z","updated":"2020-03-10T09:46:22.067Z","comments":true,"path":"article/Springä¹‹AOPé…ç½®/","link":"","permalink":"https://www.codetool.top/article/Spring%E4%B9%8BAOP%E9%85%8D%E7%BD%AE/","excerpt":"","text":"1 AOPæ¦‚è¿°1.1 ä»€ä¹ˆæ˜¯AOP åœ¨è½¯ä»¶ä¸šï¼ŒAOPä¸ºAspect Oriented Programmingçš„ç¼©å†™ï¼Œæ„ä¸ºï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œé€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸé—´åŠ¨æ€ä»£ç†å®ç°ç¨‹åºåŠŸèƒ½çš„ç»Ÿä¸€ç»´æŠ¤çš„ä¸€ç§æŠ€æœ¯ã€‚AOPæ˜¯OOPçš„å»¶ç»­ï¼Œæ˜¯è½¯ä»¶å¼€å‘ä¸­çš„ä¸€ä¸ªçƒ­ç‚¹ï¼Œä¹Ÿæ˜¯Springæ¡†æ¶ä¸­çš„ä¸€ä¸ªé‡è¦å†…å®¹ï¼Œæ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ç§è¡ç”ŸèŒƒå‹ã€‚åˆ©ç”¨AOPå¯ä»¥å¯¹ä¸šåŠ¡é€»è¾‘çš„å„ä¸ªéƒ¨åˆ†è¿›è¡Œéš”ç¦»ï¼Œä»è€Œä½¿å¾—ä¸šåŠ¡é€»è¾‘å„éƒ¨åˆ†ä¹‹é—´çš„è€¦åˆåº¦é™ä½ï¼Œæé«˜ç¨‹åºçš„å¯é‡ç”¨æ€§ï¼ŒåŒæ—¶æé«˜äº†å¼€å‘çš„æ•ˆç‡ã€‚ 1.2 ä¸ºä»€ä¹ˆè¦ä½¿ç”¨AOPAOPæœ€ä¸ºå…¸å‹çš„åº”ç”¨å®é™…å°±æ˜¯æ•°æ®åº“äº‹åŠ¡çš„ç®¡æ§ã€‚ä¾‹å¦‚,å½“æˆ‘ä»¬éœ€è¦ä¿å­˜ä¸€ä¸ªç”¨æˆ·æ—¶,å¯èƒ½è¦è¿åŒå®ƒçš„è§’è‰²ä¿¡æ¯ä¸€å¹¶ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œè¦ä¹ˆä¸€èµ·æˆåŠŸï¼Œè¦ä¹ˆä¸€èµ·å¤±è´¥ï¼Œè¿™æ—¶å¯èƒ½å°±éœ€è¦AOPçš„ç®¡æ§ï¼Œå°†å…·ä½“çš„æ•°æ®åº“æ“ä½œç»‡å…¥äº‹åŠ¡ä¸­ã€‚ AOPè¿˜å¯ä»¥å‡å°‘å¤§é‡é‡å¤çš„å·¥ä½œï¼Œä¾‹å¦‚JDBCä»£ç çš„ç®€åŒ–ã€‚ 2 åŠ¨æ€ä»£ç†åŠ¨æ€ä»£ç†ç›¸å…³çŸ¥è¯†è¯·ç§»æ­¥Javaåå°„æœºåˆ¶å’ŒåŠ¨æ€ä»£ç†è¯¦è§£ 2.1 ä¸ä½¿ç”¨åŠ¨æ€ä»£ç†çš„é¡¹ç›®/** * è´¦æˆ·çš„ä¸šåŠ¡å±‚å®ç°ç±» */ public class AccountServiceImpl implements IAccountService{ private IAccountDao accountDao; private TransactionManager txManager; public void setTxManager(TransactionManager txManager) { this.txManager = txManager; } public void setAccountDao(IAccountDao accountDao) { this.accountDao = accountDao; } @Override public List&lt;Account> findAllAccount() { try { txManager.beginTransaction(); List&lt;Account> accounts = accountDao.findAllAccount(); txManager.commit(); return accounts; } catch (Exception e) { txManager.rollback(); throw new RuntimeException(e); } finally { txManager.release(); } } @Override public Account findAccountById(Integer accountId) { try { txManager.beginTransaction(); Account account = accountDao.findAccountById(accountId); txManager.commit(); return account; } catch (Exception e) { txManager.rollback(); throw new RuntimeException(e); } finally { txManager.release(); } } @Override public void saveAccount(Account account) { try { txManager.beginTransaction(); accountDao.saveAccount(account); txManager.commit(); } catch (Exception e) { txManager.rollback(); throw new RuntimeException(e); } finally { txManager.release(); } } @Override public void updateAccount(Account account) { try { txManager.beginTransaction(); accountDao.updateAccount(account); txManager.commit(); } catch (Exception e) { txManager.rollback(); throw new RuntimeException(e); } finally { txManager.release(); } } @Override public void deleteAccount(Integer acccountId) { try { txManager.beginTransaction(); accountDao.deleteAccount(acccountId); txManager.commit(); } catch (Exception e) { txManager.rollback(); throw new RuntimeException(e); } finally { txManager.release(); } } @Override public void transfer(String sourceName, String targetName, Float money) { try { txManager.beginTransaction(); //1.æ ¹æ®åç§°æŸ¥è¯¢è½¬å‡ºè´¦æˆ· Account source = accountDao.findAccountByName(sourceName); //2.æ ¹æ®åç§°æŸ¥è¯¢è½¬å…¥è´¦æˆ· Account target = accountDao.findAccountByName(targetName); //3.è½¬å‡ºå‡é’± source.setMoney(source.getMoney()-money); //4.è½¬å…¥åŠ é’± target.setMoney(target.getMoney()+money); //5.æ›´æ–°è½¬å‡ºè´¦æˆ· accountDao.updateAccount(source); int i = 10/0; //6.æ›´æ–°è½¬å…¥è´¦æˆ· accountDao.updateAccount(target); txManager.commit(); } catch (Exception e) { txManager.rollback(); e.printStackTrace(); } finally { txManager.release(); } } } 2.2 ä½¿ç”¨åŠ¨æ€ä»£ç†çš„é¡¹ç›®public class BeanFactory { private IAccountService accountService; private TransactionManager txManager; public void setTxManager(TransactionManager txManager) { this.txManager = txManager; } public final void setAccountService(IAccountService accountService){ this.accountService = accountService; } /** * è·å–Serviceä»£ç†å¯¹è±¡ * @return */ public IAccountService getAccountService(){ return (IAccountService) Proxy.newProxyInstance(accountService.getClass().getClassLoader(), accountService.getClass().getInterfaces(), new InvocationHandler() { @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { Object rtValue = null; try { txManager.beginTransaction(); method.invoke(accountService,args); txManager.commit(); return rtValue; } catch (Exception e) { txManager.rollback(); throw new RuntimeException(e); } finally { txManager.release(); } } }); } } /** * è´¦æˆ·çš„ä¸šåŠ¡å±‚å®ç°ç±» */ public class AccountServiceImpl implements IAccountService{ private IAccountDao accountDao; public void setAccountDao(IAccountDao accountDao) { this.accountDao = accountDao; } @Override public List&lt;Account> findAllAccount() { return accountDao.findAllAccount(); } @Override public Account findAccountById(Integer accountId) { return accountDao.findAccountById(accountId); } @Override public void saveAccount(Account account) { accountDao.saveAccount(account); } @Override public void updateAccount(Account account) { accountDao.updateAccount(account); } @Override public void deleteAccount(Integer acccountId) { accountDao.deleteAccount(acccountId); } @Override public void transfer(String sourceName, String targetName, Float money) { //1.æ ¹æ®åç§°æŸ¥è¯¢è½¬å‡ºè´¦æˆ· Account source = accountDao.findAccountByName(sourceName); //2.æ ¹æ®åç§°æŸ¥è¯¢è½¬å…¥è´¦æˆ· Account target = accountDao.findAccountByName(targetName); //3.è½¬å‡ºå‡é’± source.setMoney(source.getMoney()-money); //4.è½¬å…¥åŠ é’± target.setMoney(target.getMoney()+money); //5.æ›´æ–°è½¬å‡ºè´¦æˆ· accountDao.updateAccount(source); int i = 10/0; //6.æ›´æ–°è½¬å…¥è´¦æˆ· accountDao.updateAccount(target); } } 3 Springä¸­çš„AOP3.1 AOPç›¸å…³æœ¯è¯­JoinPointï¼ˆè¿æ¥ç‚¹ï¼‰ï¼š æ‰€è°“è¿æ¥ç‚¹æ˜¯æŒ‡é‚£äº›è¢«æ‹¦æˆªåˆ°çš„ç‚¹ã€‚åœ¨ spring ä¸­,è¿™äº›ç‚¹æŒ‡çš„æ˜¯æ–¹æ³•,å› ä¸º spring åªæ”¯æŒæ–¹æ³•ç±»å‹çš„è¿æ¥ç‚¹ã€‚ Pointcut(åˆ‡å…¥ç‚¹): æ‰€è°“åˆ‡å…¥ç‚¹æ˜¯æŒ‡æˆ‘ä»¬è¦å¯¹å“ªäº› Joinpoint è¿›è¡Œæ‹¦æˆªçš„å®šä¹‰ã€‚ Advice(é€šçŸ¥/å¢å¼º):æ‰€è°“é€šçŸ¥æ˜¯æŒ‡æ‹¦æˆªåˆ° Joinpoint ä¹‹åæ‰€è¦åšçš„äº‹æƒ…å°±æ˜¯é€šçŸ¥ã€‚é€šçŸ¥çš„ç±»å‹ï¼šå‰ç½®é€šçŸ¥,åç½®é€šçŸ¥,å¼‚å¸¸é€šçŸ¥,æœ€ç»ˆé€šçŸ¥,ç¯ç»•é€šçŸ¥ã€‚ Introduction(å¼•ä»‹):å¼•ä»‹æ˜¯ä¸€ç§ç‰¹æ®Šçš„é€šçŸ¥åœ¨ä¸ä¿®æ”¹ç±»ä»£ç çš„å‰æä¸‹, Introduction å¯ä»¥åœ¨è¿è¡ŒæœŸä¸ºç±»åŠ¨æ€åœ°æ·»åŠ ä¸€äº›æ–¹æ³•æˆ– Fieldã€‚ Target(ç›®æ ‡å¯¹è±¡): ä»£ç†çš„ç›®æ ‡å¯¹è±¡ã€‚ Weaving(ç»‡å…¥): æ˜¯æŒ‡æŠŠå¢å¼ºåº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡æ¥åˆ›å»ºæ–°çš„ä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ã€‚spring é‡‡ç”¨åŠ¨æ€ä»£ç†ç»‡å…¥ï¼Œè€Œ AspectJ é‡‡ç”¨ç¼–è¯‘æœŸç»‡å…¥å’Œç±»è£…è½½æœŸç»‡å…¥ã€‚ Proxyï¼ˆä»£ç†ï¼‰: ä¸€ä¸ªç±»è¢« AOP ç»‡å…¥å¢å¼ºåï¼Œå°±äº§ç”Ÿä¸€ä¸ªç»“æœä»£ç†ç±»ã€‚ Aspect(åˆ‡é¢): æ˜¯åˆ‡å…¥ç‚¹å’Œé€šçŸ¥ï¼ˆå¼•ä»‹ï¼‰çš„ç»“åˆã€‚ 3.2 mavené…ç½®&lt;dependency> &lt;groupId>org.aspectj&lt;/groupId> &lt;artifactId>aspectjweaver&lt;/artifactId> &lt;version>1.8.13&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework&lt;/groupId> &lt;artifactId>spring-context&lt;/artifactId> &lt;version>5.2.3.RELEASE&lt;/version> &lt;/dependency> 3.3 ç¼–å†™ä¸šåŠ¡å±‚ç±»public class AccountServiceImpl implements IAccountService { @Override public void saveAccount() { System.out.println(\"æ‰§è¡Œäº†ä¿å­˜\"); } @Override public void updateAccount(int i) { System.out.println(\"æ‰§è¡Œäº†æ›´æ–°\"); } @Override public int deleteAccount() { System.out.println(\"æ‰§è¡Œäº†åˆ é™¤\"); return 0; } } 3.4 ç¼–å†™é€šçŸ¥ç±»public class Logger { /** * ç”¨äºæ‰“å°æ—¥å¿—ï¼Œè®¡åˆ’è®©å…¶åœ¨åˆ‡å…¥ç‚¹æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œ */ public void printLog(){ System.out.println(\"loggerç±»ä¸­çš„printLogæ–¹æ³•å¼€å§‹è®°å½• æ—¥å¿—\"); } } 3.5 åŸºäºXMLçš„Springé…ç½®3.5.1 é…ç½®æ–‡ä»¶&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:aop=\"http://www.springframework.org/schema/aop\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd\"> &lt;!-- é…ç½®Springçš„IoCï¼ŒæŠŠServiceå¯¹è±¡é…ç½®è¿›æ¥ --> &lt;bean id=\"accountService\" class=\"com.rhett.service.impl.AccountServiceImpl\">&lt;/bean> &lt;bean id=\"logger\" class=\"com.rhett.utils.Logger\">&lt;/bean> &lt;aop:config> &lt;!-- é…ç½®åˆ‡é¢ --> &lt;aop:aspect id=\"logAdvice\" ref=\"logger\"> &lt;!-- é…ç½®é€šçŸ¥çš„ç±»å‹ï¼Œå¹¶ä¸”å»ºç«‹é€šçŸ¥æ–¹æ³•å’Œåˆ‡å…¥ç‚¹æ–¹æ³•çš„å…³è” --> &lt;aop:before method=\"printLog\" pointcut=\"execution(public void com.rhett.service.impl.AccountServiceImpl.saveAccount())\">&lt;/aop:before> &lt;/aop:aspect> &lt;/aop:config> &lt;/beans> Spring ä¸­åŸºäºXMLçš„AOPé…ç½®æ­¥éª¤ æŠŠé€šçŸ¥ç±»ä¹Ÿäº¤ç»™Springæ¥ç®¡ç†ï¼ˆé…ç½®loggerç±»ï¼‰ ä½¿ç”¨aop:configæ ‡ç­¾è¡¨æ˜å¼€å§‹AOPçš„é…ç½® ä½¿ç”¨aop:aspectæ ‡ç­¾è¡¨æ˜é…ç½®åˆ‡é¢ idå±æ€§ï¼š ç»™åˆ‡é¢æä¾›ä¸€ä¸ªå”¯ä¸€æ ‡è¯† refå±æ€§ï¼šæŒ‡å®šé€šçŸ¥ç±»beançš„id åœ¨aop:aspectæ ‡ç­¾çš„å†…éƒ¨ä½¿ç”¨å¯¹åº”æ ‡ç­¾æ¥é…ç½®é€šçŸ¥çš„ç±»å‹ 3.5.2 é€šçŸ¥çš„ç±»å‹ï¼š å‰ç½®é€šçŸ¥ï¼šaop:before methodå±æ€§ï¼šæŒ‡å®šä¸€ä¸ªæ–¹æ³•ä½œä¸ºå‰ç½®é€šçŸ¥ pointcutå±æ€§ï¼šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œç”¨äºæŒ‡å®šå¯¹ä¸šåŠ¡å±‚å“ªäº›æ–¹æ³•å¢å¼º pointcut-refå±æ€§ï¼šæŒ‡å®šaop:pointcuté…ç½®çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ åç½®é€šçŸ¥: aop:after-returningï¼Œåœ¨åˆ‡å…¥ç‚¹æ–¹æ³•æ­£å¸¸æ‰§è¡Œåæ‰§è¡Œ å¼‚å¸¸é€šçŸ¥ï¼šaop:after-throwingï¼Œåœ¨åˆ‡å…¥ç‚¹æ–¹æ³•å‘ç”Ÿå¼‚å¸¸åæ‰§è¡Œ æœ€ç»ˆé€šçŸ¥ï¼šaop:afterï¼Œæ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼Œæ€»ä¼šæœ€åæ‰§è¡Œã€‚ åˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„å†™æ³•ï¼š å…³é”®å­—ï¼šexecution(è¡¨è¾¾å¼) è¡¨è¾¾å¼ï¼šè®¿é—®ä¿®é¥°ç¬¦ è¿”å›å€¼ åŒ…å.ç±»å.æ–¹æ³•å(å‚æ•°åˆ—è¡¨) å…¨é€šé…å†™æ³•ï¼š* *..*.*(..) è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥çœç•¥ è¿”å›å€¼å¯ä»¥ä½¿ç”¨é€šé…ç¬¦è¡¨ç¤ºä»»æ„è¿”å›å€¼ åŒ…åå¯ä»¥ä½¿ç”¨é€šé…ç¬¦è¡¨ç¤ºä»»æ„åŒ…ï¼Œä½†æ˜¯æœ‰å‡ çº§åŒ…ï¼Œå°±éœ€è¦å†™å‡ ä¸ª* åŒ…åå¯ä»¥ä½¿ç”¨..è¡¨ç¤ºå½“å‰åŒ…åŠå…¶å­åŒ… ç±»åå’Œæ–¹æ³•å éƒ½å¯ä»¥ä½¿ç”¨ * é€šé… å‚æ•°åˆ—è¡¨ï¼š å¯ä»¥ç›´æ¥å†™æ•°æ®ç±»å‹ï¼š åŸºæœ¬ç±»å‹ç›´æ¥å†™åç§° å¼•ç”¨ç±»å‹å†™åŒ…å.ç±»åçš„æ–¹å¼ å¯ä»¥ä½¿ç”¨*è¡¨ç¤ºä»»æ„ç±»å‹ å¯ä»¥ä½¿ç”¨..è¡¨ç¤ºæœ‰æ— å‚æ•°å‡å¯ å¯ä»¥ä½¿ç”¨aop:pointcutæ¥é…ç½®å¤ç”¨è¡¨è¾¾å¼ï¼Œå¯ä»¥å†™åœ¨aop:aspectå†…éƒ¨åªåœ¨è¯¥åˆ‡é¢ç”Ÿæ•ˆï¼Œä¹Ÿå¯ä»¥å†™åœ¨aop:aspectå¤–é¢å¯¹æ‰€æœ‰åˆ‡é¢ç”Ÿæ•ˆ &lt;aop:pointcut id=\"pt1\" expression=\"execution(public void com.rhett.service.impl.AccountServiceImpl.saveAccount())\"/> &lt;aop:after method=\"afterPrintLog\" pointcut-ref=\"pt1\">&lt;/aop:after> ç¯ç»•é€šçŸ¥ï¼š ç¯ç»•é€šçŸ¥éœ€è¦æ˜¾å¼åœ°è°ƒç”¨åˆ‡å…¥ç‚¹æ–¹æ³•ã€‚ Springæ¡†æ¶ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ¥å£ï¼ŒProceedingJoinPointï¼Œè¯¥æ¥å£æœ‰ä¸€ä¸ªæ–¹æ³•proceed()ï¼Œæ­¤æ–¹æ³•å°±ç›¸å½“äºæ˜ç¡®è°ƒç”¨åˆ‡å…¥ç‚¹æ–¹æ³•ã€‚è¯¥æ¥å£å¯ä»¥ä½œä¸ºç¯ç»•é€šçŸ¥çš„æ–¹æ³•å‚æ•°ï¼Œåœ¨ç¨‹åºæ‰§è¡Œæ—¶ï¼Œspringæ¡†æ¶ä¼šä¸ºæˆ‘ä»¬æä¾›è¯¥æ¥å£çš„å®ç°ç±»ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚ ç¼–å†™é€šçŸ¥æ–¹æ³•ï¼š public Object aroundPrintLog(ProceedingJoinPoint pjp){ Object rtValue = null; try { //å‰ç½®é€šçŸ¥... Object[] args = pjp.getArgs();//å¾—åˆ°æ–¹æ³•æ‰§è¡Œæ‰€éœ€çš„å‚æ•° pjp.proceed(args); //åç½®é€šçŸ¥... System.out.println(\"loggerç±»ä¸­çš„aroundPrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—\"); } catch (Throwable throwable) { //å¼‚å¸¸é€šçŸ¥... throwable.printStackTrace(); } finally { //æœ€ç»ˆé€šçŸ¥... } return rtValue; } é…ç½®ç¯ç»•é€šçŸ¥ï¼š &lt;aop:pointcut id=\"pt1\" expression=\"execution(public void com.rhett.service.impl.AccountServiceImpl.saveAccount())\"/> &lt;aop:around method=\"aroundPrintLog\" pointcut-ref=\"pt1\"/> 3.6 åŸºäºæ³¨è§£çš„Springé…ç½®å¼€å¯AOPæ³¨è§£ï¼š &lt;aop:aspectj-autoproxy>&lt;/aop:aspectj-autoproxy> æˆ–åœ¨é…ç½®ç±»ä¸­é…ç½®ï¼š @EnableAspectJAutoProxy é€šçŸ¥ç±»ï¼š @Component @Aspect public class Logger { //é…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ @Pointcut(\"execution(* com.rhett.service.impl.AccountServiceImpl.saveAccount())\") private void pt1(){} /** * å‰ç½®é€šçŸ¥ */ @Before(\"pt1()\") public void beforePrintLog(){ System.out.println(\"loggerç±»ä¸­çš„beforePrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—\"); } /** * åç½®é€šçŸ¥ */ @AfterReturning(\"pt1()\") public void afterReturningLog(){ System.out.println(\"loggerç±»ä¸­çš„afterReturningLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—\"); } /** * å¼‚å¸¸é€šçŸ¥ */ @AfterThrowing(\"pt1()\") public void afterThrowingPrintLog(){ System.out.println(\"loggerç±»ä¸­çš„afterThrowingPrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—\"); } /** * æœ€ç»ˆé€šçŸ¥ */ @After(\"pt1()\") public void afterPrintLog(){ System.out.println(\"loggerç±»ä¸­çš„afterPrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—\"); } @Around(\"pt1()\") public Object aroundPrintLog(ProceedingJoinPoint pjp){ Object rtValue = null; try { //å‰ç½®é€šçŸ¥... Object[] args = pjp.getArgs();//å¾—åˆ°æ–¹æ³•æ‰§è¡Œæ‰€éœ€çš„å‚æ•° pjp.proceed(args); //åç½®é€šçŸ¥... System.out.println(\"loggerç±»ä¸­çš„aroundPrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—\"); } catch (Throwable throwable) { //å¼‚å¸¸é€šçŸ¥... throwable.printStackTrace(); } finally { //æœ€ç»ˆé€šçŸ¥... } return rtValue; } }","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://www.codetool.top/tags/Spring/"}]},{"title":"æ•°æ®åº“ç†è®ºä¹‹èŒƒå¼ä¸åèŒƒå¼","slug":"æ•°æ®åº“ç†è®ºä¹‹èŒƒå¼ä¸åèŒƒå¼","date":"2020-02-25T08:53:41.000Z","updated":"2020-03-25T04:40:05.296Z","comments":true,"path":"article/æ•°æ®åº“ç†è®ºä¹‹èŒƒå¼ä¸åèŒƒå¼/","link":"","permalink":"https://www.codetool.top/article/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%90%86%E8%AE%BA%E4%B9%8B%E8%8C%83%E5%BC%8F%E4%B8%8E%E5%8F%8D%E8%8C%83%E5%BC%8F/","excerpt":"","text":"1 å‡½æ•°ä¾èµ–1.1 å®šä¹‰A å’Œ B æ˜¯ä¸¤ä¸ªå±æ€§é›†ï¼Œæ¥è‡ªåŒä¸€å…³ç³»æ¨¡å¼ï¼Œå¯¹äºåŒæ ·çš„ A å±æ€§å€¼ï¼ŒB å±æ€§å€¼ä¹Ÿç›¸åŒã€‚è¿™ç§å…³ç³»ç§°ä¸ºå‡½æ•°ä¾èµ–ã€‚ è®°ä½œA-&gt;B ï¼Œç§°ä¸ºBå‡½æ•°ä¾èµ–äºAã€‚ 1.2 éƒ¨åˆ†å‡½æ•°ä¾èµ–å¦‚æœå¯¹äºAçš„ä¸€ä¸ªçœŸå­é›†Aâ€™å­˜åœ¨A&#39;-&gt;Bï¼Œç§°ä¸ºBéƒ¨åˆ†ä¾èµ–äºAã€‚ 1.3 å®Œå…¨å‡½æ•°ä¾èµ–å¦‚æœå¯¹äºAçš„ä»»æ„ä¸€ä¸ªçœŸå­é›†Aâ€™éƒ½ä¸å­˜åœ¨A&#39;-&gt;Bï¼Œç§°ä¸ºBå®Œå…¨ä¾èµ–äºAã€‚ 1.4 å¹³å‡¡å‡½æ•°ä¾èµ–å½“Bçš„å±æ€§é›†æ˜¯Açš„å­é›†æ—¶ï¼Œä¸”å­˜åœ¨A-&gt;Bï¼Œç§°è¿™ç§å…³ç³»ä¸ºå¹³å‡¡å‡½æ•°ä¾èµ– 1.5 éå¹³å‡¡å‡½æ•°ä¾èµ–å½“Bçš„å±æ€§é›†ä¸æ˜¯Açš„å­é›†æ—¶ï¼Œä¸”å­˜åœ¨A-&gt;Bï¼Œç§°è¿™ç§å…³ç³»ä¸ºéå¹³å‡¡çš„å‡½æ•°ä¾èµ– 1.6 ä¼ é€’å‡½æ•°ä¾èµ–åœ¨æŸå…³ç³»ä¸­ï¼Œè‹¥å­˜åœ¨ å¦‚æœ X-&gt;Y(éå¹³å‡¡å‡½æ•°ä¾èµ–, å®Œå…¨å‡½æ•°ä¾èµ–) ï¼ŒY-&gt;Zï¼Œåˆ™ç§° Z å¯¹ X æœ‰ä¼ é€’å‡½æ•°ä¾èµ–ã€‚ æ³¨ï¼š Xä¸åŒ…å«Yï¼ŒYä¸ç¡®å®šX 2 è¶…é”®ã€ä¸»é”®ã€å€™é€‰é”® è¶…é”®(super key): åœ¨å…³ç³»ä¸­èƒ½å”¯ä¸€æ ‡è¯†å…ƒç»„çš„å±æ€§é›†ç§°ä¸ºå…³ç³»æ¨¡å¼çš„è¶…é”® å€™é€‰é”®(candidate key): ä¸å«æœ‰å¤šä½™å±æ€§çš„è¶…é”®ç§°ä¸ºå€™é€‰é”®ã€‚ä¹Ÿå°±æ˜¯åœ¨å€™é€‰é”®ä¸­ï¼Œè‹¥å†åˆ é™¤å±æ€§ï¼Œå°±ä¸æ˜¯é”®äº†ï¼ ä¸»é”®(primary key): ç”¨æˆ·åœ¨å€™é€‰é”®ä¸­ä»»é€‰ä¸€ä¸ªä½œä¸ºå…³ç³»çš„ä¸»é”®ã€‚ å¤åˆä¸»é”®(compound primary key)ï¼šä¸»é”®åŒ…å«å¤šä¸ªå±æ€§ã€‚ å€™é€‰é”®ä¸­ X å†³å®šæ‰€æœ‰å±æ€§çš„å‡½æ•°ä¾èµ–æ˜¯å®Œå…¨å‡½æ•°ä¾èµ– åŒ…å«åœ¨ä»»ä½•ä¸€ä¸ªå€™é€‰é”®ä¸­çš„å±æ€§ï¼Œç§°ä¸ºä¸»å±æ€§ï¼Œä¸åŒ…å«åœ¨å€™é€‰é”®ä¸­çš„å±æ€§ç§°ä¸ºéä¸»å±æ€§ 3 èŒƒå¼3.1 1NFç¬¬ä¸€èŒƒå¼ï¼šä¸åŒ…å«éåŸå­é¡¹ï¼Œå³ä»»ä¸€å±æ€§ä¸å¯å†åˆ†ã€‚ 3.2 2NFç¬¬äºŒèŒƒå¼ï¼šåœ¨ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¸Šã€‚æ¯ä¸ªéä¸»å±æ€§å®Œå…¨ä¾èµ–äºä¸»é”®ï¼Œä¸å­˜åœ¨å¤åˆä¸»é”®ã€‚ 3.3 3NFç¬¬ä¸‰èŒƒå¼ï¼šåœ¨ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šã€‚éä¸»å±æ€§ä¸èƒ½ä¼ é€’ä¾èµ–äºä¸»é”®ã€‚ 3.4 BCNFæ‰€æœ‰éä¸»å±æ€§å¯¹æ¯ä¸€ä¸ªå€™é€‰é”®éƒ½æ˜¯å®Œå…¨å‡½æ•°ä¾èµ–ï¼› æ‰€æœ‰çš„ä¸»å±æ€§å¯¹æ¯ä¸€ä¸ªä¸åŒ…å«å®ƒçš„å€™é€‰é”®ï¼Œä¹Ÿæ˜¯å®Œå…¨å‡½æ•°ä¾èµ–ï¼›æ²¡æœ‰ä»»ä½•å±æ€§å®Œå…¨å‡½æ•°ä¾èµ–äºéå€™é€‰é”®çš„ä»»ä½•ä¸€ç»„å±æ€§ã€‚ å®ä¾‹å¯ä»¥å‚è€ƒå…³ç³»æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼ä»¥åŠBCNFèŒƒå¼_æ•°æ®åº“_jsj13263690918çš„åšå®¢-CSDNåšå®¢ 4 åèŒƒå¼èŒƒå¼çš„å‡ºç°æ˜¯ä¸ºäº†é¿å…æ•°æ®å†—ä½™ï¼Œå‡å°‘æ•°æ®åº“çš„ç©ºé—´ï¼Œå‡è½»ç»´æŠ¤æ•°æ®å®Œæ•´æ€§çš„éº»çƒ¦ã€‚ ç„¶è€Œå®ƒä¹Ÿå­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼š æŒ‰ç…§èŒƒå¼çš„è§„èŒƒè®¾è®¡å‡ºæ¥çš„è¡¨ï¼Œç­‰çº§è¶Šé«˜çš„èŒƒå¼è®¾è®¡å‡ºæ¥çš„è¡¨è¶Šå¤šã€‚è€Œè¡¨è¶Šå¤šï¼ŒæŸ¥è¯¢æ—¶è¶Šä¼šæ¶‰åŠåˆ°ä¸€äº›è¿æ¥æ“ä½œï¼Œå½±å“æŸ¥è¯¢çš„æ•ˆç‡ã€‚ å½“æˆ‘ä»¬çš„ä¸šåŠ¡æ‰€æ¶‰åŠçš„è¡¨éå¸¸å¤šï¼Œå¹¶ä¸”æˆ‘ä»¬å¯¹è¡¨çš„æ“ä½œè¦æ—¶é—´ä¸Šè¦å°½é‡çš„å¿«ï¼Œè¿™æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨â€œåèŒƒå¼â€ã€‚ä¾‹å¦‚åˆå¹¶è¡¨ã€å¤åˆ¶å±æ€§ç­‰æ“ä½œã€‚ åèŒƒå¼å°±æ˜¯ä¸éµä»èŒƒå¼è§„åˆ™ï¼Œå…è®¸æ•°æ®åº“ç»´æŠ¤ä¸€äº›å†—ä½™æ•°æ®ï¼Œä»è€Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ 4.1 OLAPå’ŒOLTPä¸­å¦‚ä½•è®¾è®¡èŒƒå¼OLAP ä¸€èˆ¬å†—ä½™æ¯”è¾ƒå¤šï¼Œä»¥æŸ¥è¯¢åˆ†æä¸ºä¸»ï¼Œè¿™ç§ä¸€èˆ¬éƒ½æ˜¯é‡‡ç”¨åèŒƒå¼è®¾è®¡ï¼Œä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚æ›´æ–°ä¸€èˆ¬æ˜¯å®šæ—¶å¤§æ‰¹é‡æ•°æ®æ’å…¥ã€‚ OLTP åˆ™æ˜¯å°½å¯èƒ½æ¶ˆé™¤å†—ä½™ï¼Œä»¥æé«˜å˜æ›´çš„æ•ˆç‡ã€‚å› ä¸ºè¿™ç§åº”ç”¨æ— æ—¶æ— åˆ»ä¸åœ¨é¢‘ç¹å˜åŒ–ã€‚","categories":[{"name":"é¡¹ç›®/ç¼–ç¨‹ç†è®º","slug":"é¡¹ç›®-ç¼–ç¨‹ç†è®º","permalink":"https://www.codetool.top/categories/%E9%A1%B9%E7%9B%AE-%E7%BC%96%E7%A8%8B%E7%90%86%E8%AE%BA/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"}]},{"title":"leetcode540-æœ‰åºæ•°ç»„ä¸­çš„å•ä¸€å…ƒç´ ","slug":"leetcode540-æœ‰åºæ•°ç»„ä¸­çš„å•ä¸€å…ƒç´ ","date":"2020-02-24T17:21:09.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode540-æœ‰åºæ•°ç»„ä¸­çš„å•ä¸€å…ƒç´ /","link":"","permalink":"https://www.codetool.top/article/leetcode540-%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E5%8D%95%E4%B8%80%E5%85%83%E7%B4%A0/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªåªåŒ…å«æ•´æ•°çš„æœ‰åºæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ éƒ½ä¼šå‡ºç°ä¸¤æ¬¡ï¼Œå”¯æœ‰ä¸€ä¸ªæ•°åªä¼šå‡ºç°ä¸€æ¬¡ï¼Œæ‰¾å‡ºè¿™ä¸ªæ•°ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š [1,1,2,3,3,4,4,8,8]è¾“å‡ºï¼š 2 ç¤ºä¾‹2: è¾“å…¥ï¼š [3,3,7,7,10,11,11]è¾“å‡ºï¼š 10 æ³¨æ„: æ‚¨çš„æ–¹æ¡ˆåº”è¯¥åœ¨ O(log n)æ—¶é—´å¤æ‚åº¦å’Œ O(1)ç©ºé—´å¤æ‚åº¦ä¸­è¿è¡Œã€‚ 2 è§£æ³•2.1 æ€æƒ³æœ€ä¼˜è§£æ³•ï¼šäºŒåˆ†æŸ¥æ‰¾è¾¾åˆ°O(log n)æ—¶é—´å¤æ‚åº¦ã€‚ ä¿æŒæ•°ç»„ä¸ªæ•°ä¸ºå¥‡æ•°ï¼ˆå³æ°¸è¿œåªåŒ…å«ä¸€ä¸ªå•ä¸€å…ƒç´ ï¼‰ï¼Œæ¯æ¬¡å–ä¸­é—´çš„å…ƒç´ ï¼Œå¦‚æœå‰é¢çš„å…ƒç´ ä¸å½“å‰å…ƒç´ ç›¸ç­‰ï¼Œåˆåˆ†ä¸¤ç§æƒ…å†µï¼š å‰é¢çš„å…ƒç´ ä¸ªæ•°ä¸ºå¶æ•°ä¸ªï¼Œåˆ™é™¤å»é€‰ä¸­æœ¬èº«çš„è¿™ä¸€å¯¹ï¼Œå‰é¢çš„å…ƒç´ ä¸ªæ•°ä¸ºå¥‡æ•°ä¸ªï¼Œè¯´æ˜å•ä¸€å…ƒç´ å‡ºç°åœ¨è¯¥å…ƒç´ å‰é¢ï¼Œå¯ä»¥æŠŠè¦æŸ¥æ‰¾çš„ç»“æŸä½ç½®æŒ‡å‘å½“å‰å…ƒç´ å¯¹ä¹‹å‰ï¼Œåœ¨å›¾ä¸­ä¸‹ä¸€æ­¥æŒ‡å‘2ã€‚ å‰é¢çš„å…ƒç´ ä¸ªæ•°ä¸ºå¥‡æ•°ä¸ªï¼Œåˆ™é™¤å»é€‰ä¸­æœ¬èº«çš„è¿™ä¸€å¯¹ï¼Œå‰é¢çš„å…ƒç´ ä¸ªæ•°ä¸ºå¶æ•°ä¸ªï¼Œè¯´æ˜å•ä¸€å…ƒç´ å‡ºç°åœ¨è¯¥å…ƒç´ åé¢ï¼Œå¯ä»¥æŠŠè¦æŸ¥æ‰¾çš„å¼€å§‹ä½ç½®æŒ‡å‘å½“å‰å…ƒç´ å¯¹ä¹‹åï¼Œåœ¨å›¾ä¸­ä¸‹ä¸€æ­¥æŒ‡å‘10ã€‚ å¦‚æœå½“å‰å…ƒç´ å’Œåé¢çš„å…ƒç´ ç›¸ç­‰æƒ…å†µä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œå¯ä»¥é€ä¸€åˆ†æã€‚ å…¶ä»–è§£æ³•ï¼šæš´åŠ›æ³•ï¼Œå¼‚æˆ–ã€‚ 2.2 ä»£ç äºŒåˆ†æŸ¥æ‰¾ï¼š class Solution { public int singleNonDuplicate(int[] nums) { int start = 0; int end = nums.length-1; while(start&lt;end){ int mid = (start+end)/2; if(mid%2==0) { if(nums[mid-1]==nums[mid]) end = mid-2; else if(nums[mid+1] == nums[mid]) start = mid+2; else return nums[mid]; }else{ if(nums[mid-1]==nums[mid]) start = mid+1; else if(nums[mid+1] == nums[mid]) end = mid-1; else return nums[mid]; } } return nums[start]; } } æš´åŠ›æ³•ï¼š class Solution { public int singleNonDuplicate(int[] nums) { for (int i = 0; i &lt; nums.length - 1; i+=2) { if (nums[i] != nums[i + 1]) { return nums[i]; } } return nums[nums.length - 1]; } } å¼‚æˆ–ï¼š class Solution { public int singleNonDuplicate(int[] nums) { int cur=0; for (int i:nums) cur=cur^i; return cur; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"Springä¹‹æ³¨è§£é…ç½®IoC","slug":"Springä¹‹æ³¨è§£é…ç½®IoC","date":"2020-02-24T14:14:43.000Z","updated":"2020-03-11T15:48:50.680Z","comments":true,"path":"article/Springä¹‹æ³¨è§£é…ç½®IoC/","link":"","permalink":"https://www.codetool.top/article/Spring%E4%B9%8B%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AEIoC/","excerpt":"","text":"1 æ³¨è§£é…ç½®1.1 å®šä¹‰é…ç½® @Configurationï¼šæŒ‡å®šå½“å‰ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±» @ComponentScanï¼šç”¨äºé€šè¿‡æ³¨è§£æŒ‡å®šSpringåœ¨åˆ›å»ºå®¹å™¨æ—¶è¦æ‰«æçš„åŒ…@ComponentScan(basePackages=&quot;&quot;)æˆ–@ComponentScan(value=&quot;&quot;)æŒ‡å®šåŒ…å @Beanï¼šç”¨äºæŠŠå½“å‰æ–¹æ³•çš„è¿”å›å€¼ä½œä¸ºbeanå¯¹è±¡å­˜å…¥Springçš„IoCå®¹å™¨ä¸­@Bean(name=&quot;&quot;)æŒ‡å®šbeançš„idï¼Œé»˜è®¤å€¼æ˜¯å½“å‰æ–¹æ³•çš„åç§°ã€‚ @Importï¼šå¯¼å…¥å…¶ä»–çš„é…ç½®ç±»ã€‚@Import(Classå¯¹è±¡)æŒ‡å®šè¦å¯¼å…¥çš„é…ç½®ç±»ï¼ˆé€šå¸¸æ˜¯è¢«AnnotationConfigApplicationContextæŒ‡å®šçš„ä¸»é…ç½®ç±»å…³è”å…¶ä»–çš„å­é…ç½®ç±»ï¼‰ é€šè¿‡æ³¨è§£é…ç½®åˆ™è·å–ApplicationContextçš„æ—¶å€™éœ€è¦é€šè¿‡å®ç°ç±»AnnotationConfigApplicationContext(Classå¯¹è±¡)è·å–ã€‚ Springåªä¼šæ‰«æé…ç½®ç±»ä¸‹çš„@Bean 1.2 ç”¨äºåˆ›å»ºå¯¹è±¡ @Component:å°†å½“å‰çš„ç±»å¯¹è±¡å­˜å…¥springå®¹å™¨ä¸­ idå¯ä»¥é€šè¿‡@Component(value = &quot;&quot;)ä¿®æ”¹ï¼Œå¦‚æœä¸è®¾ç½®é»˜è®¤idæ˜¯ç±»åçš„é¦–å­—æ¯å˜å°å†™ã€‚ åœ¨springé…ç½®æ–‡ä»¶ä¸­é…ç½®æ‰«æåŒ…èŒƒå›´ï¼š &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:context=\"http://www.springframework.org/schema/context\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd\"> &lt;!-- å‘ŠçŸ¥springåœ¨åˆ›å»ºå®¹å™¨æ—¶è¦æ‰«æçš„åŒ… --> &lt;context:component-scan base-package=\"com.rhett\">&lt;/context:component-scan> &lt;/beans> @Controllerï¼šä¸€èˆ¬ç”¨äºè¡¨ç°å±‚ @Serviceï¼šä¸€èˆ¬ç”¨äºä¸šåŠ¡å±‚ @Repositoryï¼šä¸€èˆ¬ç”¨äºæŒä¹…å±‚ ä½œç”¨å’Œå±æ€§å’ŒComponentä¸€æ ·ï¼Œåªä¸ºåŒºåˆ†ä¸‰å±‚çš„æ¦‚å¿µã€‚ 1.3 ç”¨äºæ³¨å…¥æ•°æ® @Autowiredï¼šè‡ªåŠ¨æŒ‰ç…§ç±»å‹æ³¨å…¥ï¼Œåªè¦å®¹å™¨ä¸­æœ‰å”¯ä¸€çš„ä¸€ä¸ªbeanå¯¹è±¡ç±»å‹å’Œè¦æ³¨å…¥çš„å˜é‡ç±»å‹åŒ¹é…ï¼Œå°±å¯ä»¥æ³¨å…¥æˆåŠŸã€‚ æ­¤æ—¶setæ–¹æ³•ä¸æ˜¯å¿…é¡»çš„ å¦‚æœå®¹å™¨ä¸­æœ‰å¤šä¸ªç±»å‹å¯ä»¥åŒ¹é…çš„beanå¯¹è±¡ï¼Œåˆ™ä¼šæŠŠè¦æ³¨å…¥çš„å˜é‡çš„åç§°ä½œä¸ºidæŸ¥æ‰¾æ˜¯å¦æœ‰çš„å¯¹åº”çš„beanå¯¹è±¡ã€‚ @Qualifierï¼šå†æŒ‰ç…§ç±»ä¸­æ³¨å…¥çš„åŸºç¡€ä¹‹ä¸Šå†æŒ‰ç…§åç§°æ³¨å…¥ã€‚å®ƒåœ¨ç»™ç±»æˆå‘˜æ³¨å…¥æ—¶ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼ˆéœ€è¦é…åˆ@Autowiredï¼‰ï¼Œä½†æ˜¯åœ¨ç»™æ–¹æ³•å‚æ•°æ³¨å…¥æ—¶å¯ä»¥ã€‚ @Qualifier(value=&quot;&quot;)å¯ä»¥æŒ‡å®šè¦è£…é…çš„beanåœ¨å®¹å™¨ä¸­çš„idã€‚ @Primaryï¼šå¯ä»¥æŒ‡å®šå½“æœ‰å¤šä¸ªç±»å‹å¯ä»¥åŒ¹é…çš„beanå¯¹è±¡ä¼˜å…ˆæ³¨å…¥çš„å¯¹è±¡ã€‚ @Resourceï¼šç›´æ¥æŠŠå­—æ®µåå½“ä½œbeançš„idè¯†åˆ«æ³¨å…¥ï¼Œå¯ä»¥å•ç‹¬ä½¿ç”¨ã€‚ @Resource(name=&quot;&quot;)ï¼šæŒ‡å®šä¸€ä¸ªbeançš„idï¼Œåœ¨è¿™ä¸ªbeanä¸­æŸ¥æ‰¾å±æ€§åå’Œå½“å‰å­—æ®µåå»åˆçš„å¯¹è±¡æ³¨å…¥ã€‚ ä»¥ä¸Šä¸‰ä¸ªæ³¨å…¥éƒ½åªèƒ½æ³¨å…¥å…¶ä»–beanç±»å‹çš„æ•°æ®ï¼Œè€ŒåŸºæœ¬ç±»å‹å’ŒStringç±»å‹æ— æ³•ä½¿ç”¨ä¸Šè¿°æ³¨è§£å®ç°ã€‚ é›†åˆç±»å‹çš„æ³¨å…¥åªèƒ½é€šè¿‡XMLå®ç°ã€‚ @Value()ï¼šç”¨äºæ³¨å…¥åŸºæœ¬ç±»å‹å’ŒStringç±»å‹ã€‚valueå¯ä»¥ä½¿ç”¨Springçš„SpELè¡¨è¾¾å¼ï¼š${è¡¨è¾¾å¼} @PropertySourceï¼šç”¨äºæŒ‡å®špropertiesæ–‡ä»¶çš„ä½ç½®@PropertySource(value=&quot;&quot;)æŒ‡å®šæ–‡ä»¶åç§°å’Œè·¯å¾„ï¼Œé€šè¿‡å‰ç¼€classpath:æŒ‡å®šç±»è·¯å¾„ä¸‹çš„ã€‚ 1.4 ç”¨äºæ”¹å˜ä½œç”¨èŒƒå›´ @Scopeï¼šå’Œbeanæ ‡ç­¾ä¸­çš„scopeå±æ€§çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚ @Scope(value=&quot;&quot;)æŒ‡å®šbeançš„ä½œç”¨èŒƒå›´ã€‚ 1.5 å’Œç”Ÿå‘½å‘¨æœŸç›¸å…³ @PreDestroyï¼šæŒ‡å®šé”€æ¯å‰è°ƒç”¨çš„æ–¹æ³• @PostConstructï¼šæŒ‡å®šæ„é€ åè°ƒç”¨çš„æ–¹æ³• è¿™ä¸¤ä¸ªæ³¨è§£éƒ½æ˜¯å†™åœ¨æ–¹æ³•ä¸Šã€‚ 2 æ¡ä»¶è£…é…Beanæœ‰æ—¶å€™æŸäº›å®¢è§‚çš„å› ç´ ä¼šä½¿ä¸€äº›Beanæ— æ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œä¾‹å¦‚ï¼Œåœ¨æ•°æ®åº“è¿æ¥æ± çš„é…ç½®ä¸­æ¼æ‰ä¸€äº›é…ç½®ä¼šé€ æˆæ•°æ®æºä¸èƒ½è¿æ¥ä¸Šã€‚åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¸å¸Œæœ›IoCå»è£…é…æ•°æ®æºï¼ŒSpring4æä¾›äº†æ–°æ³¨è§£@Conditionalï¼Œå®ƒçš„ä½œç”¨æ˜¯æŒ‰ç…§ä¸€å®šçš„æ¡ä»¶è¿›è¡Œåˆ¤æ–­ï¼Œæ»¡è¶³æ¡ä»¶ç»™å®¹å™¨æ³¨å†Œbeanã€‚å®ƒè¿˜éœ€è¦é…åˆå¦å¤–ä¸€ä¸ªæ¥å£Conditionæ¥å®Œæˆå¯¹åº”çš„åŠŸèƒ½ï¼š @Target({ElementType.TYPE, ElementType.METHOD}) @Retention(RetentionPolicy.RUNTIME) @Documented public @interface Conditional { /** * All {@link Condition Conditions} that must {@linkplain Condition#matches match} * in order for the component to be registered. */ Class&lt;? extends Condition>[] value(); } @FunctionalInterface public interface Condition { /** * Determine if the condition matches. * @param context the condition context * @param metadata metadata of the {@link org.springframework.core.type.AnnotationMetadata class} * or {@link org.springframework.core.type.MethodMetadata method} being checked * @return {@code true} if the condition matches and the component can be registered, * or {@code false} to veto the annotated component's registration */ boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata); } Conditionalæ ¹æ®Conditionä¸­çš„matchæ–¹æ³•ï¼Œè¿”å›trueåˆ™æ³¨å…¥beanï¼Œfalseåˆ™ä¸æ³¨å…¥ã€‚ 3 åŸºäºxmlé…ç½®çš„Spring IoCå®ä¾‹3.1 å®ä½“ç±»/** * è´¦æˆ·çš„å®ä½“ç±» */ public class Account implements Serializable { private Integer id; private String name; private Float money; public Integer getId() { return id; } public void setId(Integer id) { this.id = id; } public String getName() { return name; } public void setName(String name) { this.name = name; } public Float getMoney() { return money; } public void setMoney(Float money) { this.money = money; } @Override public String toString() { return \"Account{\" + \"id=\" + id + \", name='\" + name + '\\'' + \", money=\" + money + '}'; } } 3.2 æŒä¹…å±‚/** * è´¦æˆ·çš„æŒä¹…å±‚æ¥å£ */ public interface IAccountDao { /** * æŸ¥è¯¢æ‰€æœ‰ * @return */ List&lt;Account> findAllAccount(); /** * æŸ¥è¯¢ä¸€ä¸ª * @return */ Account findAccountById(Integer accountId); /** * ä¿å­˜ * @param account */ void saveAccount(Account account); /** * æ›´æ–° * @param account */ void updateAccount(Account account); /** * åˆ é™¤ * @param accountId */ void deleteAccount(Integer accountId); } /** * è´¦æˆ·çš„æŒä¹…å±‚å®ç°ç±» */ public class AccountDaoImpl implements IAccountDao { private QueryRunner runner; public void setRunner(QueryRunner runner) { this.runner = runner; } public List&lt;Account> findAllAccount() { try { return runner.query(\"select * from account\",new BeanListHandler&lt;Account>(Account.class)); } catch (SQLException e) { e.printStackTrace(); } return null; } public Account findAccountById(Integer accountId) { try { return runner.query(\"select * from account where id = ?\",new BeanHandler&lt;Account>(Account.class),accountId); } catch (SQLException e) { e.printStackTrace(); } return null; } public void saveAccount(Account account) { try { runner.update(\"insert into account(name,money) values(?,?)\",account.getName(),account.getMoney()); } catch (SQLException e) { e.printStackTrace(); } } public void updateAccount(Account account) { try { runner.update(\"update account set name=?,money=? where id=?\",account.getName(),account.getMoney(),account.getId()); } catch (SQLException e) { e.printStackTrace(); } } public void deleteAccount(Integer accountId) { try { runner.update(\"delete from account where id=?\",accountId); } catch (SQLException e) { e.printStackTrace(); } } } 3.3 ä¸šåŠ¡å±‚/** * è´¦æˆ·çš„ä¸šåŠ¡å±‚æ¥å£ */ public interface IAccountService { /** * æŸ¥è¯¢æ‰€æœ‰ * @return */ List&lt;Account> findAllAccount(); /** * æŸ¥è¯¢ä¸€ä¸ª * @return */ Account findAccountById(Integer accountId); /** * ä¿å­˜ * @param account */ void saveAccount(Account account); /** * æ›´æ–° * @param account */ void updateAccount(Account account); /** * åˆ é™¤ * @param accountId */ void deleteAccount(Integer accountId); } public class AccountServiceImpl implements IAccountService { private IAccountDao accountDao; public void setAccountDao(IAccountDao accountDao) { this.accountDao = accountDao; } public List&lt;Account> findAllAccount() { return accountDao.findAllAccount(); } public Account findAccountById(Integer accountId) { return accountDao.findAccountById(accountId); } public void saveAccount(Account account) { accountDao.saveAccount(account); } public void updateAccount(Account account) { accountDao.updateAccount(account); } public void deleteAccount(Integer accountId) { accountDao.deleteAccount(accountId); } } 3.4 Springé…ç½®&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd\"> &lt;!-- ä¸šåŠ¡å±‚å¯¹è±¡ --> &lt;bean id=\"accountService\" class=\"com.rhett.service.impl.AccountServiceImpl\"> &lt;!--æ³¨å…¥Dao--> &lt;property name=\"accountDao\" ref=\"accountDao\">&lt;/property> &lt;/bean> &lt;!-- é…ç½®Daoå¯¹è±¡ --> &lt;bean id=\"accountDao\" class=\"com.rhett.dao.impl.AccountDaoImpl\"> &lt;property name=\"runner\" ref=\"runner\">&lt;/property> &lt;/bean> &lt;bean id=\"runner\" class=\"org.apache.commons.dbutils.QueryRunner\" scope=\"prototype\"> &lt;!-- æ³¨å…¥æ•°æ®æº --> &lt;constructor-arg name=\"ds\" ref=\"dataSource\">&lt;/constructor-arg> &lt;/bean> &lt;!-- é…ç½®æ•°æ®æº --> &lt;bean id=\"dataSource\" class=\"com.mchange.v2.c3p0.ComboPooledDataSource\"> &lt;!-- è¿æ¥æ•°æ®åº“çš„å¿…å¤‡ä¿¡æ¯--> &lt;property name=\"driverClass\" value=\"com.mysql.cj.jdbc.Driver\">&lt;/property> &lt;property name=\"jdbcUrl\" value=\"jdbc:mysql://192.168.91.1:3306/learnSpring\">&lt;/property> &lt;property name=\"user\" value=\"root\">&lt;/property> &lt;property name=\"password\" value=\"123456\">&lt;/property> &lt;/bean> &lt;/beans> 3.5 æµ‹è¯•ç±»/** * ä½¿ç”¨Junitå•å…ƒæµ‹è¯•ï¼Œæµ‹è¯•æˆ‘ä»¬çš„é…ç½® */ public class AccountServiceTest { ApplicationContext ac; IAccountService as; @Before public void init(){ //1.è·å–å®¹å™¨ ac = new ClassPathXmlApplicationContext(\"bean.xml\"); //2.å¾—åˆ°ä¸šåŠ¡å±‚å¯¹è±¡ as = ac.getBean(\"accountService\",IAccountService.class); } @Test public void testFindAll() { //3.æ‰§è¡Œæ–¹æ³• List&lt;Account> accounts = as.findAllAccount(); for(Account account:accounts){ System.out.println(account); } } @Test public void testFindOne() { //3.æ‰§è¡Œæ–¹æ³• Account account = as.findAccountById(1); System.out.println(account); } @Test public void testSave() { Account account = new Account(); account.setName(\"test\"); account.setMoney(12345f); as.saveAccount(account); } @Test public void testUpdate() { Account account = new Account(); account.setMoney(23456f); account.setId(4); as.updateAccount(account); } @Test public void testDelete() { as.deleteAccount(5); } } 4 åŸºäºæ³¨è§£é…ç½®çš„Spring IoCå®ä¾‹å®ä½“ç±»ä¸å˜ã€‚ 4.1 æŒä¹…å±‚/** * è´¦æˆ·çš„æŒä¹…å±‚å®ç°ç±» */ @Repository(\"accountDao\") public class AccountDaoImpl implements IAccountDao { @Autowired private QueryRunner runner; //ä¸å˜... } åŠ å…¥@Repositoryå’Œ@Autowired 4.2 ä¸šåŠ¡å±‚@Service(\"accountService\") public class AccountServiceImpl implements IAccountService { @Autowired private IAccountDao accountDao; //ä¸å˜... } åŠ å…¥@Serviceå’Œ@Autowiredã€‚ 4.3 ç¼–å†™é…ç½®ç±»/** * è¯¥ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œå®ƒçš„ä½œç”¨å’Œbean.xmlæ˜¯ä¸€æ ·çš„ */ @Configuration @ComponentScan(\"com.rhett\") @PropertySource(\"classpath:jdbcConfig.properties\") public class SpringConfiguration { @Value(\"${jdbc.driver}\") private String driver; @Value(\"${jdbc.url}\") private String url; @Value(\"${jdbc.username}\") private String username; @Value(\"${jdbc.password}\") private String password; /** * ç”¨äºåˆ›å»ºä¸€ä¸ªQueryRunnerå¯¹è±¡ * @param dataSource * @return */ @Bean(name=\"runner\") @Scope(\"prototype\") public QueryRunner createQueryRunner(DataSource dataSource){ return new QueryRunner(dataSource); } @Bean(name=\"dataSource\") public DataSource createDataSource(){ try { ComboPooledDataSource ds = new ComboPooledDataSource(); ds.setDriverClass(driver); ds.setJdbcUrl(url); ds.setUser(username); ds.setPassword(password); return ds; } catch (PropertyVetoException e) { e.printStackTrace(); } return null; } } propertiesæ–‡ä»¶ï¼š jdbc.driver = com.mysql.cj.jdbc.Driver jdbc.url = jdbc:mysql://192.168.91.1:3306/learnSpring jdbc.username = root jdbc.password = 123456 4.4 æµ‹è¯•ç±»public class AccountServiceTest { ApplicationContext ac; IAccountService as; @Before public void init(){ //1.è·å–å®¹å™¨ ac = new AnnotationConfigApplicationContext(SpringConfiguration.class); //2.å¾—åˆ°ä¸šåŠ¡å±‚å¯¹è±¡ as = ac.getBean(\"accountService\",IAccountService.class); } //ä¸å˜... } 5 Springæ•´åˆJUnitæµ‹è¯•å¯¼å…¥mavenä¾èµ–ï¼š &lt;dependency> &lt;groupId>org.springframework&lt;/groupId> &lt;artifactId>spring-test&lt;/artifactId> &lt;version>5.2.3.RELEASE&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>junit&lt;/groupId> &lt;artifactId>junit&lt;/artifactId> &lt;version>4.12&lt;/version> &lt;scope>test&lt;/scope> &lt;/dependency> ä½¿ç”¨JUnitæä¾›çš„ä¸€ä¸ªæ³¨è§£æŠŠåŸæœ‰çš„mainæ–¹æ³•æ›¿æ¢ç§°Springæä¾›çš„ï¼Œå®ƒåœ¨è¿è¡Œæ—¶ä¼šè‡ªåŠ¨åˆ›å»ºSpringå®¹å™¨ï¼š @RunWith(SpringJUnit4ClassRunner.class) å‘ŠçŸ¥Springçš„è¿è¡Œå™¨ï¼ŒSpringçš„IoCåˆ›å»ºæ˜¯åŸºäºxmlè¿˜æ˜¯æ³¨è§£çš„ï¼Œå¹¶ä¸”è¯´æ˜ä½ç½®ï¼š @ContextConfiguration(locations={})ï¼šæŒ‡å®šxmlæ–‡ä»¶çš„ä½ç½® @ContextConfiguration(classes={})ï¼šæŒ‡å®šé…ç½®ç±»æ‰€åœ¨çš„ä½ç½® ä¿®æ”¹ä¹‹åçš„æµ‹è¯•ç±»ï¼š import java.util.List; /** * ä½¿ç”¨Junitå•å…ƒæµ‹è¯•ï¼Œæµ‹è¯•æˆ‘ä»¬çš„é…ç½® */ @RunWith(SpringJUnit4ClassRunner.class) @ContextConfiguration(classes = SpringConfiguration.class) public class AccountServiceTest { @Autowired IAccountService as; //ä¸å˜... }","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://www.codetool.top/tags/Spring/"}]},{"title":"æ•°æ®åº“ç†è®ºä¹‹å¹¶å‘æ§åˆ¶","slug":"æ•°æ®åº“ç†è®ºä¹‹å¹¶å‘æ§åˆ¶","date":"2020-02-24T12:55:06.000Z","updated":"2020-03-25T04:40:05.296Z","comments":true,"path":"article/æ•°æ®åº“ç†è®ºä¹‹å¹¶å‘æ§åˆ¶/","link":"","permalink":"https://www.codetool.top/article/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%90%86%E8%AE%BA%E4%B9%8B%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/","excerpt":"","text":"1 å¹¶å‘æ§åˆ¶æ¦‚è¿°å¤šç”¨æˆ·æ•°æ®åº“ï¼šå…è®¸å¤šä¸ªç”¨æˆ·åŒæ—¶ä½¿ç”¨çš„æ•°æ®åº“ï¼ˆè®¢ç¥¨ç³»ç»Ÿï¼‰ ä¸åŒçš„å¤šäº‹åŠ¡æ‰§è¡Œæ–¹å¼ï¼š ä¸²è¡Œæ‰§è¡Œï¼šæ¯ä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªäº‹åŠ¡è¿è¡Œï¼Œå…¶ä»–äº‹åŠ¡å¿…é¡»ç­‰åˆ°è¿™ä¸ªäº‹åŠ¡ç»“æŸåæ–¹èƒ½è¿è¡Œã€‚ äº¤å‰å¹¶å‘æ–¹å¼ï¼šå•å¤„ç†æœºç³»ç»Ÿä¸­ï¼Œäº‹åŠ¡çš„å¹¶å‘æ‰§è¡Œå®é™…ä¸Šæ˜¯è¿™äº›å¹¶è¡Œäº‹åŠ¡çš„å¹¶è¡Œæ“ä½œè½®æµäº¤å‰è¿è¡Œï¼ˆä¸æ˜¯çœŸæ­£çš„å¹¶å‘ï¼Œä½†æ˜¯æé«˜äº†ç³»ç»Ÿæ•ˆç‡ï¼‰ åŒæ—¶å¹¶å‘æ–¹å¼ï¼šå¤šå¤„ç†æœºç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªå¤„ç†æœºå¯ä»¥è¿è¡Œä¸€ä¸ªäº‹åŠ¡ï¼Œå¤šä¸ªå¤„ç†æœºå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªäº‹åŠ¡ï¼Œå®ç°å¤šä¸ªäº‹åŠ¡çœŸæ­£çš„å¹¶è¡Œè¿è¡Œ å¹¶å‘æ‰§è¡Œå¸¦æ¥çš„é—®é¢˜ï¼š å¤šä¸ªäº‹åŠ¡åŒæ—¶å­˜å–åŒä¸€æ•°æ®ï¼ˆå…±äº«èµ„æºï¼‰ å­˜å–ä¸æ­£ç¡®çš„æ•°æ®ï¼Œç ´åäº‹åŠ¡ä¸€è‡´æ€§å’Œæ•°æ®åº“ä¸€è‡´æ€§ å¹¶å‘æ“ä½œå¸¦æ¥çš„æ•°æ®ä¸ä¸€è‡´æ€§åŒ…æ‹¬ ä¸¢å¤±ä¿®æ”¹ï¼ˆlost updateï¼‰ ä¸å¯é‡å¤è¯»ï¼ˆnon-repeatable readï¼‰ è¯»è„æ•°æ®ï¼ˆdirty readï¼‰ å¹¶å‘æ§åˆ¶æœºåˆ¶çš„ä»»åŠ¡ï¼š å¯¹å¹¶å‘æ“ä½œè¿›è¡Œæ­£ç¡®çš„è°ƒåº¦ ä¿è¯äº‹åŠ¡çš„éš”ç¦»æ€§ ä¿è¯æ•°æ®åº“çš„ä¸€è‡´æ€§ å¹¶å‘æ§åˆ¶çš„ä¸»è¦æŠ€æœ¯ï¼š å°é”ï¼ˆlockingï¼‰ï¼ˆä¸»è¦ä½¿ç”¨çš„ï¼‰ æ—¶é—´æˆ³ï¼ˆtimestampï¼‰ ä¹è§‚æ§åˆ¶æ³•ï¼ˆoptimistic schedulerï¼‰ å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆmulti-version concurrency control ï¼ŒMVCCï¼‰ 2 å°é”å°é”ï¼šå°é”å°±æ˜¯äº‹åŠ¡ T åœ¨å¯¹æŸä¸ªæ•°æ®å¯¹è±¡ï¼ˆä¾‹å¦‚è¡¨ã€è®°å½•ç­‰ï¼‰æ“ä½œä¹‹å‰ï¼Œå…ˆå‘ç³»ç»Ÿå‘å‡ºè¯·æ±‚ï¼Œå¯¹å…¶åŠ é”ã€‚åŠ é”åäº‹åŠ¡ T å°±å¯¹è¯¥æ•°æ®å¯¹è±¡æœ‰äº†ä¸€å®šçš„æ§åˆ¶ï¼Œåœ¨äº‹åŠ¡ T é‡Šæ”¾å®ƒçš„é”ä¹‹å‰ï¼Œå…¶å®ƒçš„äº‹åŠ¡ä¸èƒ½æ›´æ–°æ­¤æ•°æ®å¯¹è±¡ ç¡®åˆ‡çš„æ§åˆ¶ç”±å°é”çš„ç±»å‹å†³å®šï¼ŒåŸºæœ¬çš„å°é”ç±»å‹æœ‰ä¸¤ç§ï¼šæ’å®ƒé”ï¼ˆX é”ï¼Œexclusive locksï¼‰ã€å…±äº«é”ï¼ˆS é”ï¼Œshare locksï¼‰ æ’å®ƒé”åˆç§°å†™é”ï¼Œå¯¹ A åŠ äº†æ’å®ƒé”ä¹‹åï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½å¯¹ A åŠ  ä»»ä½•ç±»å‹çš„é”ï¼ˆæ’æ–¥è¯»å’Œå†™ï¼‰ å…±äº«é”åˆç§°è¯»é”ï¼Œå¯¹ A åŠ äº†å…±äº«é”ä¹‹åï¼Œå…¶ä»–äº‹åŠ¡åªèƒ½å¯¹ A åŠ  S é”ï¼Œä¸èƒ½åŠ  X é”ï¼ˆåªæ’æ–¥å†™ï¼‰ 2.1 å°é”åè®®åœ¨è¿ç”¨ X é”å’Œ S é”å¯¹æ•°æ®å¯¹è±¡åŠ é”æ—¶ï¼Œéœ€è¦çº¦å®šä¸€äº›è§„åˆ™ï¼šå°é”åè®®ï¼ˆLocking Protocolï¼‰ ä½•æ—¶ç”³è¯· X é”æˆ– S é” æŒé”æ—¶é—´ã€ä½•æ—¶é‡Šæ”¾ å¯¹å°é”æ–¹å¼åˆ¶å®šä¸åŒçš„è§„åˆ™ï¼Œå°±å½¢æˆäº†å„ç§ä¸åŒçš„å°é”åè®®ã€‚ å¸¸ç”¨çš„å°é”åè®®ï¼šä¸‰çº§å°é”åè®® ä¸‰çº§å°é”åè®®åœ¨ä¸åŒç¨‹åº¦ä¸Šè§£å†³äº†å¹¶å‘é—®é¢˜ï¼Œä¸ºå¹¶å‘æ“ä½œçš„æ­£ç¡®è°ƒåº¦æä¾›ä¸€å®šçš„ä¿è¯ã€‚ 2.1.1 ä¸€çº§å°é”åè®®äº‹åŠ¡ T åœ¨ä¿®æ”¹æ•°æ® R ä¹‹å‰ï¼Œå¿…é¡»å…ˆå¯¹å…¶åŠ  X é”ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸï¼ˆcommit/rollbackï¼‰æ‰é‡Šæ”¾ã€‚ ä¸€çº§å°é”åè®®å¯ä»¥é˜²æ­¢ä¸¢å¤±ä¿®æ”¹ã€‚ å¦‚æœæ˜¯è¯»æ•°æ®ï¼Œä¸éœ€è¦åŠ é”ï¼Œæ‰€ä»¥å®ƒä¸èƒ½ä¿è¯å¯é‡å¤è¯»å’Œä¸è¯»â€œè„â€æ•°æ®ã€‚ 2.1.2 äºŒçº§å°é”åè®®åœ¨ä¸€çº§å°é”åè®®çš„åŸºç¡€ï¼ˆå†™è¦åŠ  X é”ï¼Œäº‹åŠ¡ç»“æŸé‡Šæ”¾ï¼‰ä¸Šï¼Œå¢åŠ äº‹åŠ¡ T åœ¨è¯»å…¥æ•°æ® R ä¹‹å‰å¿…é¡»å…ˆå¯¹å…¶åŠ  S é”ï¼Œè¯»å®Œåå³å¯é‡Šæ”¾ S é”ã€‚ï¼ˆè¯»è¦åŠ  S é”ï¼Œè¯»å®Œå³é‡Šæ”¾ï¼‰ äºŒçº§å°é”åè®®é™¤äº†å¯ä»¥é˜²æ­¢ä¸¢å¤±ä¿®æ”¹ï¼Œè¿˜å¯ä»¥é˜²æ­¢è¯»è„æ•°æ® ç”±äºè¯»å®Œæ•°æ®å³é‡Šæ”¾ S é”ï¼Œ ä¸èƒ½ä¿è¯ä¸å¯é‡å¤è¯» 2.1.3 ä¸‰çº§å°é”åè®®æ³¨æ„äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œå¦‚æœäº‹åŠ¡çš„éš”ç¦»çº§åˆ«æ˜¯é‡å¤è¯»ï¼ˆå³MySQLé»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼Œé‚£ä¹ˆäºŒçº§å°é”åè®®å’Œä¸‰çº§å°é”åè®®æ²¡æœ‰åŒºåˆ«ï¼Œå› ä¸ºåœ¨T1æ‰§è¡Œçš„æ—¶å€™T2ä¸èƒ½æ“ä½œï¼‰ åœ¨ä¸€çº§å°é”åè®®åŸºç¡€ä¸Šå¢åŠ äº‹åŠ¡ T åœ¨è¯»å–æ•°æ® R ä¹‹å‰å¿…é¡»å…ˆå¯¹å…¶åŠ  S é”ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸåé‡Šæ”¾ã€‚ ä¸‰çº§å°é”åè®®é™¤äº†å¯ä»¥é˜²æ­¢ä¸¢å¤±ä¿®æ”¹å’Œè¯»è„æ•°æ®å¤–ï¼Œè¿˜é˜²æ­¢äº†ä¸å¯é‡å¤è¯»ã€‚ 3 é¥¥é¥¿å’Œæ­»é”3.1 é¥¥é¥¿äº‹åŠ¡ T1 å°é”äº†æ•°æ® Rï¼Œäº‹åŠ¡ T2 åˆè¯·æ±‚å°é” Rï¼Œäºæ˜¯ T2 ç­‰å¾…ã€‚T3 ä¹Ÿè¯·æ±‚å°é” Rï¼Œå½“T1 é‡Šæ”¾äº† R ä¸Šçš„å°é”ä¹‹åï¼Œç³»ç»Ÿé¦–å…ˆæ‰¹å‡†äº† T3 çš„è¯·æ±‚ï¼ŒT2 ä»ç„¶ç­‰å¾…ã€‚ T4 åˆè¯·æ±‚å°é” Rï¼Œå½“ T3 é‡Šæ”¾äº† R ä¸Šçš„å°é”ä¹‹åç³»ç»Ÿåˆæ‰¹å‡†äº† T4 çš„è¯·æ±‚â€¦â€¦T2 æœ‰å¯èƒ½æ°¸è¿œç­‰å¾…ï¼Œè¿™å°±æ˜¯é¥¥é¥¿çš„æƒ…å½¢ é¿å…é¥¥é¥¿çš„æ–¹æ³•ï¼šå…ˆæ¥å…ˆæœåŠ¡ å½“å¤šä¸ªäº‹åŠ¡è¯·æ±‚å°é”åŒä¸€æ•°æ®å¯¹è±¡æ—¶ï¼ŒæŒ‰è¯·æ±‚å°é”çš„å…ˆåæ¬¡åºå¯¹è¿™äº›äº‹åŠ¡æ’é˜Ÿã€‚è¯¥æ•°æ®å¯¹è±¡ä¸Šçš„é”ä¸€æ—¦é‡Šæ”¾ï¼Œé¦–å…ˆæ‰¹å‡†ç”³è¯·é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªäº‹åŠ¡è·å¾—é”ã€‚ 3.2 æ­»é”æ­»é”ï¼šäº‹åŠ¡ T1 å°é”äº†æ•°æ® R1ï¼ŒT2 å°é”äº†æ•°æ® R2ã€‚T1 åˆè¯·æ±‚å°é” R2ï¼Œå›  T2 å·²å°é”äº† R2ï¼Œ äºæ˜¯ T1 ç­‰å¾… T2 é‡Šæ”¾ R2 ä¸Šçš„é”ã€‚æ¥ç€ T2 åˆç”³è¯·å°é” R1 ï¼Œå›  T1 å·²å°é”äº† R1 ï¼ŒT2 ä¹Ÿåªèƒ½ç­‰å¾… T1 é‡Šæ”¾ R1 ä¸Šçš„é”ã€‚è¿™æ · T1 åœ¨ç­‰å¾… T2ï¼Œè€Œ T2 åˆåœ¨ç­‰å¾… T1 ï¼ŒT1 å’Œ T2 ä¸¤ä¸ªäº‹åŠ¡æ°¸è¿œä¸èƒ½ç»“æŸï¼Œå½¢æˆæ­»é”ã€‚ è§£å†³æ­»é”çš„æ–¹æ³•ï¼š é¢„é˜²ã€è¯Šæ–­å’Œè§£é™¤ 3.2.1 æ­»é”çš„é¢„é˜²äº§ç”Ÿæ­»é”çš„åŸå› æ˜¯ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡éƒ½å·²ç»å°é”äº†ä¸€äº›æ•°æ®å¯¹è±¡ï¼Œç„¶ååˆéƒ½è¯·æ±‚å¯¹å·²è¢«å…¶ä»–äº‹åŠ¡å°é”çš„æ•°æ®å¯¹è±¡åŠ é”ï¼Œä»è€Œå‡ºç°æ­»ç­‰å¾…ã€‚ é¢„é˜²æ­»é”å‘ç”Ÿå°±æ˜¯ç ´åäº§ç”Ÿæ­»é”çš„æ¡ä»¶ æ–¹æ³• ä¸€æ¬¡å°é”æ³•ï¼š è¦æ±‚æ¯ä¸ªäº‹åŠ¡å¿…é¡»ä¸€æ¬¡å°†æ‰€æœ‰è¦ä½¿ç”¨çš„æ•°æ®å…¨éƒ¨åŠ é”ï¼Œå¦åˆ™å°±ä¸èƒ½ç»§ç»­æ‰§è¡Œã€‚ å­˜åœ¨çš„é—®é¢˜ï¼šé™ä½ç³»ç»Ÿçš„å¹¶å‘åº¦ï¼›éš¾ä»¥å®ç°ç²¾ç¡®ç¡®å®šå°é”å¯¹è±¡ é¡ºåºå°é”æ³•ï¼š é¢„å…ˆå¯¹æ•°æ®å¯¹è±¡è§„å®šä¸€ä¸ªå°é”é¡ºåºï¼Œæ‰€æœ‰äº‹åŠ¡éƒ½æŒ‰è¿™ä¸ªé¡ºåºå®æ–½å°é”ã€‚ å­˜åœ¨çš„é—®é¢˜ï¼š ç»´æŠ¤æˆæœ¬ï¼šæ•°æ®åº“ç³»ç»Ÿä¸­çš„å°é”å¯¹è±¡æå¤šï¼Œå¹¶ä¸”åœ¨ä¸æ–­åœ°å˜åŒ– éš¾ä»¥å®ç°ï¼šå¾ˆéš¾å®ç°ç¡®å®šæ¯ä¸€ä¸ªäº‹åŠ¡è¦å°é”å“ªäº›å¯¹è±¡ DBMSæ™®é€šé‡‡ç”¨é‡‡ç”¨çš„è¯Šæ–­å¹¶è§£é™¤æ­»é”çš„æ–¹æ³• 3.2.2 æ­»é”çš„è¯Šæ–­å’Œè§£é™¤æ–¹æ³•ï¼šè¶…æ—¶æ³•å’Œäº‹åŠ¡ç­‰å¾…å›¾æ³• è¶…æ—¶æ³•ï¼šå¦‚æœä¸€ä¸ªäº‹åŠ¡çš„ç­‰å¾…æ—¶é—´è¶…è¿‡äº†è§„å®šçš„æ—¶é™ï¼Œå°±è®¤ä¸ºå‘ç”Ÿäº†æ­»é”ã€‚ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œç¼ºç‚¹æ˜¯ä¼šè¯¯åˆ¤ã€‚ äº‹åŠ¡ç­‰å¾…å›¾æ³•ï¼šç”¨äº‹åŠ¡ç­‰å¾…å›¾åŠ¨æ€åæ˜ æ‰€æœ‰äº‹åŠ¡çš„ç­‰å¾…æƒ…å†µã€‚ äº‹åŠ¡ç­‰å¾…å›¾æ˜¯ä¸€ä¸ªæœ‰å‘å›¾ G=(T,U)ï¼ŒT ä¸ºç»“ç‚¹çš„é›†åˆï¼Œæ¯ä¸ªç»“ç‚¹è¡¨ç¤ºæ­£è¿è¡Œçš„äº‹åŠ¡ï¼ŒUä¸ºè¾¹çš„é›†åˆï¼Œæ¯æ¡è¾¹è¡¨ç¤ºäº‹åŠ¡ç­‰å¾…çš„æƒ…å†µã€‚è‹¥ T1 ç­‰å¾… T2 ï¼Œåˆ™ T1 ã€T2 ä¹‹é—´åˆ’ä¸€æ¡æœ‰å‘è¾¹ï¼Œä» T1 æŒ‡å‘ T2ã€‚ å¦‚æœå›¾ä¸­å½¢æˆäº†ç¯è¯´æ˜å‘ç”Ÿäº†æ­»é”ã€‚ è§£é™¤æ­»é”ï¼šå¹¶å‘æ§åˆ¶å­ç³»ç»Ÿé€‰æ‹©ä¸€ä¸ªå¤„ç†æ­»é”ä»£ä»·æœ€å°çš„äº‹åŠ¡ï¼Œå°†å…¶æ’¤é”€ã€‚é‡Šæ”¾è¯¥äº‹åŠ¡æŒæœ‰çš„æ‰€æœ‰çš„é”ï¼Œä½¿å…¶ä»–äº‹åŠ¡èƒ½å¤Ÿç»§ç»­è¿è¡Œä¸‹å»ã€‚ 4 å¹¶å‘è°ƒåº¦çš„å¯ä¸²è¡Œæ€§4.1 å¯ä¸²è¡ŒåŒ–è°ƒåº¦æ‰§è¡Œç»“æœç­‰ä»·äºä¸²è¡Œè°ƒåº¦çš„è°ƒåº¦å°±æ˜¯æ­£ç¡®çš„ï¼Œè¿™æ ·çš„è°ƒåº¦ç§°ä¸ºå¯ä¸²è¡ŒåŒ–è°ƒåº¦ã€‚ å¯ä¸²è¡Œæ€§æ˜¯å¹¶å‘äº‹åŠ¡æ­£ç¡®è°ƒåº¦çš„å‡†åˆ™ã€‚æŒ‰è¿™ä¸ªå‡†åˆ™è§„å®šï¼Œä¸€ä¸ªç»™å®šçš„å¹¶å‘è°ƒåº¦ï¼Œå½“ä¸”ä»…å½“å®ƒæ˜¯å¯ä¸²è¡ŒåŒ–çš„ï¼Œæ‰è®¤ä¸ºæ˜¯æ­£ç¡®è°ƒåº¦ã€‚ ä¾‹ï¼šç°åœ¨æœ‰ä¸¤ä¸ªäº‹åŠ¡ï¼Œåˆ†åˆ«åŒ…å«ä¸‹åˆ—æ“ä½œï¼š äº‹åŠ¡T1ï¼šè¯»Bï¼›A=B+1ï¼›å†™å›A äº‹åŠ¡T2ï¼šè¯»Aï¼›B=A+1ï¼›å†™å›B 4.2 å†²çªå¯ä¸²è¡ŒåŒ–è°ƒåº¦å†²çªæ“ä½œï¼šä¸åŒçš„äº‹åŠ¡å¯¹åŒä¸€ä¸ªæ•°æ®çš„è¯»å†™å’Œå†™å†™æ“ä½œã€‚ åˆ¤æ–­å¯ä¸²è¡ŒåŒ–è°ƒåº¦çš„å……åˆ†æ¡ä»¶: ä¸åŒäº‹åŠ¡çš„å†²çªæ“ä½œå’ŒåŒä¸€äº‹åŠ¡çš„ä¸¤ä¸ªæ“ä½œæ˜¯ä¸èƒ½äº¤æ¢çš„ã€‚ æˆ‘ä»¬ç”¨Ri(x)è¡¨ç¤ºäº‹åŠ¡Tiè¯»xï¼ŒWi(x)è¡¨ç¤ºäº‹åŠ¡Tiå†™xã€‚åˆ™Ri(x)å’Œ Wj(x)ä¸å¯äº¤æ¢ï¼ŒWi(x)å’ŒWj(x)ä¸å¯äº¤æ¢ å†²çªå¯ä¸²è¡ŒåŒ–è°ƒåº¦ï¼šä¸€ä¸ªè°ƒåº¦ Sc åœ¨ä¿è¯å†²çªæ“ä½œçš„æ¬¡åºä¸å˜çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡äº¤æ¢ä¸¤ä¸ªäº‹åŠ¡ä¸å†²çªæ“ä½œçš„æ¬¡åºå¾—åˆ°å¦ä¸€ä¸ªè°ƒåº¦ Scâ€™ ï¼Œå¦‚æœ Scâ€™ æ˜¯ä¸²è¡Œçš„ï¼Œç§°è°ƒåº¦ Sc ä¸ºå†²çªå¯ä¸²è¡ŒåŒ–çš„è°ƒåº¦ã€‚ è‹¥ä¸€ä¸ªè°ƒåº¦æ˜¯å†²çªå¯ä¸²è¡ŒåŒ–ï¼Œåˆ™ä¸€å®šæ˜¯å¯ä¸²è¡ŒåŒ–çš„ã€‚å†²çªå¯ä¸²è¡ŒåŒ–è°ƒåº¦æ˜¯å¯ä¸²è¡ŒåŒ–è°ƒåº¦çš„å……åˆ†æ¡ä»¶è€Œéå¿…è¦æ¡ä»¶ï¼ŒåŒæ ·å­˜åœ¨ä¸æ»¡è¶³å†²çªå¯ä¸²è¡ŒåŒ–è°ƒåº¦çš„å¯ä¸²è¡ŒåŒ–è°ƒåº¦ã€‚ 5 ä¸¤æ®µé”åè®®DBMS çš„å¹¶å‘æ§åˆ¶æœºåˆ¶å¿…é¡»æä¾›ä¸€å®šçš„æ‰‹æ®µæ¥ä¿è¯è°ƒåº¦æ˜¯å¯ä¸²è¡ŒåŒ–çš„ã€‚ç›®å‰ DBMS æ™®éé‡‡ç”¨ä¸¤æ®µé”åè®®ï¼ˆTwoPhase Lockingï¼Œç®€ç§° 2PLï¼‰çš„æ–¹æ³•æ¥æ˜¾ç¤ºå¹¶å‘è°ƒåº¦çš„å¯ä¸²è¡Œæ€§ã€‚ ä¸¤æ®µé”åè®®æ˜¯æŒ‡æ‰€æœ‰äº‹åŠ¡å¿…é¡»åˆ†ä¸¤ä¸ªé˜¶æ®µå¯¹æ•°æ®å¯¹è±¡è¿›è¡ŒåŠ é”å’Œè§£é”ï¼š åœ¨å¯¹ä»»ä½•æ•°æ®è¿›è¡Œè¯»å†™æ“ä½œä»¥å‰ï¼Œé¦–å…ˆè¦ç”³è¯·å¹¶è·å¾—å¯¹è¯¥æ•°æ®çš„é” ã€‚ åœ¨é‡Šæ”¾ä¸€ä¸ªé”ä¹‹åï¼Œäº‹åŠ¡ä¸å†ç”³è¯·å’Œè·å¾—å…¶ä»–ä»»ä½•çš„é”ã€‚ â€œä¸¤æ®µâ€ é”çš„å«ä¹‰ï¼šäº‹åŠ¡åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ: ç¬¬ä¸€é˜¶æ®µæ˜¯è·å¾—å°é”ï¼Œä¹Ÿç§°ä¸ºæ‰©å±•é˜¶æ®µäº‹åŠ¡å¯ä»¥ç”³è¯·è·å¾—ä»»ä½•æ•°æ®å¯¹è±¡ä¸Šçš„ä»»ä½•ç±»å‹çš„é”ï¼Œä½†æ˜¯ä¸èƒ½é‡Šæ”¾ä»»ä½•é” ç¬¬äºŒé˜¶æ®µæ˜¯é‡Šæ”¾å°é”ï¼Œä¹Ÿç§°ä¸ºæ”¶ç¼©é˜¶æ®µäº‹åŠ¡å¯ä»¥é‡Šæ”¾ä»»ä½•æ•°æ®å¯¹è±¡ä¸Šçš„ä»»ä½•ç±»å‹çš„é”ï¼Œä½†æ˜¯ä¸èƒ½å†ç”³è¯·ä»»ä½•é” äº‹åŠ¡éµå®ˆä¸¤æ®µé”åè®®æ˜¯å¯ä¸²è¡ŒåŒ–è°ƒåº¦çš„å……åˆ†æ¡ä»¶ï¼Œè€Œä¸æ˜¯å¿…è¦æ¡ä»¶ã€‚è‹¥å¹¶å‘äº‹åŠ¡éƒ½éµå®ˆä¸¤æ®µé”åè®®ï¼Œåˆ™å¯¹è¿™äº›äº‹åŠ¡çš„ä»»ä½•å¹¶å‘è°ƒåº¦ç­–ç•¥éƒ½æ˜¯å¯ä¸²è¡ŒåŒ–çš„è‹¥å¹¶å‘äº‹åŠ¡çš„ä¸€ä¸ªè°ƒåº¦æ˜¯å¯ä¸²è¡ŒåŒ–çš„ï¼Œä¸ä¸€å®šæ‰€æœ‰äº‹åŠ¡éƒ½ç¬¦åˆä¸¤æ®µé”åè®® ä¸¤æ®µé”åè®®ä¸é˜²æ­¢æ­»é”çš„ä¸€æ¬¡å°é”æ³•: ä¸€æ¬¡å°é”æ³•è¦æ±‚æ¯ä¸ªäº‹åŠ¡å¿…é¡»ä¸€æ¬¡å°†æ‰€æœ‰è¦ä½¿ç”¨çš„æ•°æ®å…¨éƒ¨åŠ é”ï¼Œå¦åˆ™å°±ä¸èƒ½ç»§ç»­æ‰§è¡Œï¼Œå› æ­¤ä¸€æ¬¡å°é”æ³•éµå®ˆä¸¤æ®µé”åè®® ä½†æ˜¯ä¸¤æ®µé”åè®®å¹¶ä¸è¦æ±‚äº‹åŠ¡å¿…é¡»ä¸€æ¬¡å°†æ‰€æœ‰è¦ä½¿ç”¨çš„æ•°æ®å…¨éƒ¨åŠ é”ï¼Œå› æ­¤éµå®ˆä¸¤æ®µé”åè®®çš„äº‹åŠ¡å¯èƒ½å‘ç”Ÿæ­»é” 6 å°é”çš„ç²’åº¦å°é”å¯¹è±¡çš„å¤§å°ç§°ä¸ºå°é”ç²’åº¦ï¼ˆgranularityï¼‰ã€‚ å°é”çš„å¯¹è±¡å¯ä»¥æ˜¯é€»è¾‘å•å…ƒï¼ˆå±æ€§å€¼ã€å±æ€§å€¼é›†åˆã€å…ƒç»„ã€å…³ç³»ã€ç´¢å¼•é¡¹ã€æ•°æ®åº“ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ç‰©ç†å•å…ƒï¼ˆé¡µã€ç‰©ç†è®°å½•ï¼‰ é€‰æ‹©å°é”ç²’åº¦åŸåˆ™ï¼š å°é”ç²’åº¦å’Œç³»ç»Ÿçš„å¹¶å‘åº¦å’Œå¹¶å‘æ§åˆ¶çš„å¼€é”€å¯†åˆ‡ç›¸å…³ å°é”çš„ç²’åº¦è¶Šå¤§ï¼Œæ•°æ®åº“æ‰€èƒ½å¤Ÿå°é”çš„æ•°æ®å•å…ƒå°±è¶Šå°‘ï¼Œå¹¶å‘åº¦å°±è¶Šä½ï¼Œç³»ç»Ÿå¼€é”€ä¹Ÿè¶Šå°ï¼› å°é”çš„ç²’åº¦è¶Šå°ï¼Œå¹¶å‘åº¦è¾ƒé«˜ï¼Œä½†ç³»ç»Ÿå¼€é”€ä¹Ÿå°±è¶Šå¤§ã€‚ 6.1 å¤šç²’åº¦å°é”å¦‚æœåœ¨ä¸€ä¸ªç³»ç»Ÿä¸­åŒæ—¶æ”¯æŒå¤šç§å°é”ç²’åº¦ä¾›ä¸åŒçš„äº‹åŠ¡é€‰æ‹©ï¼Œè¿™ç§å°é”æ–¹æ³•ç§°ä¸ºå¤šç²’åº¦å°é”ã€‚ï¼ˆmultiple granularity lockingï¼‰ é€‰æ‹©å°é”ç²’åº¦åº”è¯¥åŒæ—¶è€ƒè™‘å°é”å¼€é”€å’Œå¹¶å‘åº¦ä¸¤ä¸ªå› ç´ ï¼Œé€‚å½“é€‰æ‹©å°é”ç²’åº¦ä»¥æ±‚å¾—æœ€ä¼˜çš„æ•ˆæœã€‚ éœ€è¦å¤„ç†å¤šä¸ªå…³ç³»çš„å¤§é‡å…ƒç»„çš„ç”¨æˆ·äº‹åŠ¡ï¼šä»¥æ•°æ®åº“ä¸ºå°é”å•ä½ éœ€è¦å¤„ç†å¤§é‡å…ƒç»„çš„ç”¨æˆ·äº‹åŠ¡ï¼šä»¥å…³ç³»ä¸ºå°é”å•å…ƒ åªå¤„ç†å°‘é‡å…ƒç»„çš„ç”¨æˆ·äº‹åŠ¡ï¼šä»¥å…ƒç»„ä¸ºå°é”å•ä½ å¤šç²’åº¦æ ‘ï¼š ä»¥æ ‘å½¢ç»“æ„æ¥è¡¨ç¤ºå¤šçº§å°é”ç²’åº¦ã€‚æ ¹ç»“ç‚¹æ˜¯æ•´ä¸ªæ•°æ®åº“ï¼Œè¡¨ç¤ºæœ€å¤§çš„æ•°æ®ç²’åº¦ï¼Œå¶ç»“ç‚¹è¡¨ç¤ºæœ€å°çš„æ•°æ®ç²’åº¦ å¤šç²’åº¦å°é”åè®®ï¼šå…è®¸å¤šç²’åº¦æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è¢«ç‹¬ç«‹åœ°åŠ é”ï¼Œå¯¹ä¸€ä¸ªèŠ‚ç‚¹åŠ é”æ„å‘³ç€è¿™ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹ä¹Ÿè¢«åŠ ä»¥åŒæ ·ç±»å‹çš„é”ã€‚å› æ­¤ï¼Œåœ¨å¤šç²’åº¦å°é”ä¸­ä¸€ä¸ªæ•°æ®å¯¹è±¡å¯èƒ½ä»¥æ˜¾å¼å°é”å’Œéšå¼å°é”ä¸¤ç§æ–¹å¼å°é”ã€‚ æ˜¾å¼å°é”ï¼šç›´æ¥åŠ åˆ°æ•°æ®å¯¹è±¡ä¸Šçš„å°é” éšå¼å°é”ï¼šè¯¥æ•°æ®å¯¹è±¡æ²¡æœ‰ç‹¬ç«‹åŠ é”ï¼Œæ˜¯ç”±äºå…¶ä¸Šçº§ç»“ç‚¹åŠ é”è€Œä½¿è¯¥æ•°æ®å¯¹è±¡åŠ ä¸Šäº†é” æ˜¾å¼å°é”å’Œéšå¼å°é”çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ ç³»ç»Ÿæ£€æŸ¥å°é”å†²çªæ—¶è¦æ£€æŸ¥æ˜¾å¼å°é”ï¼Œè¿˜è¦æ£€æŸ¥éšå¼å°é” ä¾‹å¦‚äº‹åŠ¡ T è¦å¯¹å…³ç³» R1 åŠ  X é”ï¼Œç³»ç»Ÿå¿…é¡»æœç´¢å…¶ä¸Šçº§ç»“ç‚¹æ•°æ®åº“ã€å…³ç³» R1ï¼Œè¿˜è¦æœç´¢ R1 çš„ä¸‹çº§ç»“ç‚¹ï¼Œå³ R1 ä¸­çš„æ¯ä¸€ä¸ªå…ƒç»„ ã€‚ å¦‚æœå…¶ä¸­æŸä¸€ä¸ªæ•°æ®å¯¹è±¡å·²ç»åŠ äº†ä¸ç›¸å®¹é”ï¼Œåˆ™ T å¿…é¡»ç­‰å¾…ã€‚ å¯¹æŸä¸ªæ•°æ®å¯¹è±¡åŠ é”ï¼Œç³»ç»Ÿè¦æ£€æŸ¥è¯¥æ•°æ®å¯¹è±¡ä¸Šæœ‰æ— æ˜¾å¼å°é”ä¸ä¹‹å†²çªï¼›å†æ£€æŸ¥å…¶æ‰€æœ‰ä¸Šçº§èŠ‚ç‚¹ï¼Œçœ‹æœ¬äº‹åŠ¡çš„æ˜¾å¼å°é”æ˜¯å¦ä¸è¯¥æ•°æ®å¯¹è±¡ä¸Šçš„éšå¼å°é” ï¼ˆç”±äºä¸Šçº§èŠ‚ç‚¹å·²åŠ çš„å°é”é€ æˆçš„ï¼‰å†²çª ï¼›è¿˜è¦æ£€æŸ¥å…¶æ‰€æœ‰ä¸‹çº§èŠ‚ç‚¹ï¼Œçœ‹å®ƒä»¬çš„æ˜¾å¼å°é”æ˜¯å¦ä¸æœ¬äº‹åŠ¡çš„éšå¼å°é”ï¼ˆå°†åŠ åˆ°ä¸‹çº§èŠ‚ç‚¹çš„å°é”ï¼‰å†²çª ã€‚ è¿™ç§æ£€æŸ¥æ–¹æ³•æ•ˆç‡è¾ƒä½ï¼Œå¼•å…¥ä¸€ç§æ–°çš„é”ï¼šæ„å‘é”ã€‚æœ‰äº† æ„å‘é”ï¼ŒDBMS å°±æ— é¡»é€ä¸ªæ£€æŸ¥ä¸‹ä¸€çº§èŠ‚ç‚¹çš„æ˜¾å¼å°é”ã€‚ 6.2 æ„å‘é”æ„å‘é”ï¼šå¦‚æœå¯¹ä¸€ä¸ªèŠ‚ç‚¹åŠ æ„å‘é”ï¼Œåˆ™å¯è¯´æ˜è¯¥èŠ‚ç‚¹çš„ä¸‹å±‚èŠ‚ç‚¹æ­£åœ¨è¢«åŠ é”ï¼›å¯¹ä»»ä¸€èŠ‚ç‚¹åŠ é”æ—¶ï¼Œå¿…é¡»å…ˆå¯¹å®ƒçš„ä¸Šå±‚èŠ‚ç‚¹åŠ æ„å‘é”ã€‚ ä¾‹å¦‚ï¼Œå¯¹ä»»ä¸€å…ƒç»„åŠ é”æ—¶ï¼Œå¿…é¡»å…ˆå¯¹å®ƒæ‰€åœ¨çš„æ•°æ®åº“å’Œå…³ç³»åŠ æ„å‘é”ã€‚ ä¸‰ç§å¸¸ç”¨çš„æ„å‘é”ï¼šæ„å‘å…±äº«é”ï¼ˆIntent Share Lockï¼ŒIS é”ï¼‰ï¼›æ„å‘æ’å®ƒé”ï¼ˆIntent Exclusive Lockï¼ŒIX é”ï¼‰ï¼›å…±äº«æ„å‘æ’å®ƒé”ï¼ˆShare Intent Exclusive Lock ï¼ŒSIX é”ï¼‰ã€‚ 6.2.1 IS é”å¦‚æœå¯¹ä¸€ä¸ªæ•°æ®å¯¹è±¡åŠ  IS é”ï¼Œè¡¨ç¤ºå®ƒåŠ çš„å­èŠ‚ç‚¹æ‹ŸåŠ  S é”ã€‚ ä¾‹å¦‚ï¼šäº‹åŠ¡ T1 è¦å¯¹ R1 ä¸­æŸä¸ªå…ƒç»„åŠ  S é”ï¼Œåˆ™è¦é¦–å…ˆå¯¹å…³ç³» R1 å’Œæ•°æ®åº“åŠ  IS é”ã€‚ 6.2.2 IX é”å¦‚æœå¯¹ä¸€ä¸ªæ•°æ®å¯¹è±¡åŠ  IX é”ï¼Œè¡¨ç¤ºå®ƒçš„å­èŠ‚ç‚¹æ‹ŸåŠ  X é”ã€‚ ä¾‹å¦‚ï¼šäº‹åŠ¡ T1 è¦å¯¹ R1 ä¸­æŸä¸ªå…ƒç»„åŠ  X é”ï¼Œåˆ™è¦é¦–å…ˆå¯¹å…³ç³» R1 å’Œæ•°æ®åº“åŠ  IX é”ã€‚ 6.2.3 SIX é”å¦‚æœå¯¹ä¸€ä¸ªæ•°æ®å¯¹è±¡åŠ  SIX é”ï¼Œè¡¨ç¤ºå¯¹å®ƒåŠ  S é”ï¼Œå†åŠ  IX é”ï¼Œå³ SIX = S + IXã€‚ ä¾‹å¦‚ï¼šå¯¹æŸä¸ªè¡¨åŠ  SIX é”ï¼Œåˆ™è¡¨ç¤ºè¯¥äº‹åŠ¡è¦è¯»æ•´ä¸ªè¡¨ï¼ˆæ‰€ä»¥è¦å¯¹è¯¥è¡¨åŠ  S é”ï¼‰ï¼ŒåŒæ—¶ä¼šæ›´æ–°ä¸ªåˆ«å…ƒç»„ï¼ˆæ‰€ä»¥è¦å¯¹è¯¥è¡¨åŠ  IX é”ï¼‰ã€‚ æ„å‘é”çš„å¼ºåº¦ï¼šé”çš„å¼ºåº¦æ˜¯æŒ‡å®ƒå¯¹å…¶ä»–é”çš„æ’æ–¥ç¨‹åº¦ã€‚ä¸€ä¸ªäº‹åŠ¡åœ¨ç”³è¯·å°é”æ—¶ä»¥å¼ºé”ä»£æ›¿å¼±é”æ˜¯å®‰å…¨çš„ï¼Œåä¹‹åˆ™ä¸ç„¶ã€‚ å…·æœ‰æ„å‘é”çš„å¤šç²’åº¦å°é”æ–¹æ³•ï¼š ç”³è¯·å°é”æ—¶åº”è¯¥æŒ‰è‡ªä¸Šè€Œä¸‹çš„æ¬¡åºè¿›è¡Œ é‡Šæ”¾å°é”æ—¶åˆ™åº”è¯¥æŒ‰è‡ªä¸‹è€Œä¸Šçš„æ¬¡åºè¿›è¡Œ ä¼˜ç‚¹ï¼š æé«˜äº†ç³»ç»Ÿå¹¶å‘åº¦ã€‚ å‡å°‘äº†åŠ é”å’Œè§£é”çš„å¼€é”€ã€‚ 7 å…¶ä»–å¹¶å‘æ§åˆ¶æœºåˆ¶å¹¶å‘æ§åˆ¶çš„æ–¹æ³•é™¤äº†å°é”æŠ€æœ¯å¤–ï¼Œè¿˜æœ‰æ—¶é—´æˆ³æ–¹æ³•ã€ä¹è§‚æ§åˆ¶æ³•å’Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚ æ—¶é—´æˆ³æ–¹æ³•ï¼šç»™æ¯ä¸€ä¸ªäº‹åŠ¡ç›–ä¸Šä¸€ä¸ªæ—¶æ ‡ï¼Œå³äº‹åŠ¡å¼€å§‹çš„æ—¶é—´ã€‚æ¯ä¸ªäº‹åŠ¡å…·æœ‰å”¯ä¸€çš„æ—¶é—´æˆ³ï¼Œå¹¶æŒ‰ç…§è¿™ä¸ªæ—¶é—´æˆ³æ¥è§£å†³äº‹åŠ¡çš„å†²çªæ“ä½œã€‚å¦‚æœå‘ç”Ÿå†²çªæ“ä½œï¼Œå°±å›æ»šåˆ°å…·æœ‰è¾ƒæ—©æ—¶é—´æˆ³çš„äº‹åŠ¡ï¼Œä»¥ä¿è¯å…¶ä»–äº‹åŠ¡çš„æ­£å¸¸æ‰§è¡Œï¼Œè¢«å›æ»šçš„äº‹åŠ¡è¢«èµ‹äºˆæ–°çš„æ—¶é—´æˆ³è¢«ä»å¤´å¼€å§‹æ‰§è¡Œã€‚ ä¹è§‚æ§åˆ¶æ³•ï¼šä¹è§‚æ§åˆ¶æ³•è®¤ä¸ºäº‹åŠ¡æ‰§è¡Œæ—¶å¾ˆå°‘å‘ç”Ÿå†²çªï¼Œæ‰€ä»¥ä¸å¯¹äº‹åŠ¡è¿›è¡Œç‰¹æ®Šçš„ç®¡åˆ¶ï¼Œè€Œæ˜¯è®© å®ƒè‡ªç”±æ‰§è¡Œï¼Œäº‹åŠ¡æäº¤å‰å†è¿›è¡Œæ­£ç¡®æ€§æ£€æŸ¥ã€‚å¦‚æœæ£€æŸ¥å å‘ç°è¯¥äº‹åŠ¡æ‰§è¡Œä¸­å‡ºç°è¿‡å†²çªå¹¶å½±å“äº†å¯ä¸²è¡Œæ€§ï¼Œåˆ™æ‹’ç»æäº¤å¹¶å›æ»šè¯¥äº‹åŠ¡ã€‚åˆç§°ä¸ºéªŒè¯æ–¹æ³•ã€‚ å¤šç‰ˆæœ¬æ§åˆ¶ï¼š æŒ‡åœ¨æ•°æ®åº“ä¸­é€šè¿‡ç»´æŠ¤æ•°æ®å¯¹è±¡çš„å¤šä¸ªç‰ˆæœ¬ä¿¡æ¯æ¥å®ç°é«˜æ•ˆå¹¶å‘çš„ä¸€ç§ç­–ç•¥ã€‚","categories":[{"name":"é¡¹ç›®/ç¼–ç¨‹ç†è®º","slug":"é¡¹ç›®-ç¼–ç¨‹ç†è®º","permalink":"https://www.codetool.top/categories/%E9%A1%B9%E7%9B%AE-%E7%BC%96%E7%A8%8B%E7%90%86%E8%AE%BA/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"}]},{"title":"leetcode64-æœ€å°è·¯å¾„å’Œ","slug":"leetcode64-æœ€å°è·¯å¾„å’Œ","date":"2020-02-23T16:53:20.000Z","updated":"2020-04-22T09:27:27.142Z","comments":true,"path":"article/leetcode64-æœ€å°è·¯å¾„å’Œ/","link":"","permalink":"https://www.codetool.top/article/leetcode64-%E6%9C%80%E5%B0%8F%E8%B7%AF%E5%BE%84%E5%92%8C/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªåŒ…å«éè´Ÿæ•´æ•°çš„ m x n ç½‘æ ¼ï¼Œè¯·æ‰¾å‡ºä¸€æ¡ä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’çš„è·¯å¾„ï¼Œä½¿å¾—è·¯å¾„ä¸Šçš„æ•°å­—æ€»å’Œä¸ºæœ€å°ã€‚ è¯´æ˜ï¼š æ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚ ç¤ºä¾‹: è¾“å…¥ï¼š[ [1,3,1], [1,5,1], [4,2,1]]è¾“å‡ºï¼š 7è§£é‡Šï¼š å› ä¸ºè·¯å¾„ 1â†’3â†’1â†’1â†’1 çš„æ€»å’Œæœ€å°ã€‚ 2 è§£æ³•2.1 æ€æƒ³åŠ¨æ€è§„åˆ’ï¼Œç”¨ä¸€ä¸ªæ•°ç»„è®°å½•æŸä¸€ä¸ªä½ç½®æœ€å°è·¯å¾„å’Œï¼Œä»å³ä¸‹è§’å¼€å§‹ï¼Œå¾€ä¸Šä¸€å±‚ï¼ˆæ–œçº¿ï¼‰çš„å…ƒç´ çš„æœ€å°è·¯å¾„å’Œä¸ºä¸‹é¢å…ƒç´ çš„æœ€å°è·¯å¾„å’Œä¸å³è¾¹å…ƒç´ çš„æœ€å°è·¯å¾„å’Œä¸­çš„æœ€å°å€¼åŠ ä¸Šå½“å‰ä½ç½®çš„æ•°å­—ã€‚ å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨é€’å½’+è®°å¿†çš„æ–¹æ³•æ±‚è§£ï¼Œ62ã€63æˆ‘éƒ½æ˜¯ç”¨é€’å½’+è®°å¿†æ±‚è§£çš„ï¼Œè¿™é‡Œå°±ä¸ç”¨äº†ã€‚ 2.2 ä»£ç class Solution { public int minPathSum(int[][] grid) { int height = grid.length; if(height == 0) return 0; int width = grid[0].length; int[][] pathLength = new int[height][width]; pathLength[height-1][width-1] = grid[height-1][width-1]; for(int sum = (height+width-3); sum>=0; sum--){ for(int i = 0;i&lt;=sum ;i++){ int j = sum-i; if(i>=height||j>=width) continue; if(i == height-1) pathLength[i][j] = pathLength[i][j+1] + grid[i][j]; else if(j == width-1) pathLength[i][j] = pathLength[i+1][j] + grid[i][j]; else pathLength[i][j] = Math.min(pathLength[i][j+1] ,pathLength[i+1][j])+ grid[i][j]; } } return pathLength[0][0]; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"Springæ¦‚è¿°å’ŒIoCé…ç½®","slug":"Springæ¦‚è¿°å’ŒIoCé…ç½®","date":"2020-02-23T15:28:30.000Z","updated":"2020-03-09T15:37:40.380Z","comments":true,"path":"article/Springæ¦‚è¿°å’ŒIoCé…ç½®/","link":"","permalink":"https://www.codetool.top/article/Spring%E6%A6%82%E8%BF%B0%E5%92%8CIoC%E9%85%8D%E7%BD%AE/","excerpt":"","text":"1 springæ¦‚è¿°Spring æ˜¯è½»é‡çº§çš„ JavaEE çš„å¼€æºæ¡†æ¶ï¼Œå…·æœ‰ IOC/DIï¼ŒAOPï¼ŒMVCï¼ŒTXï¼ŒORM ç­‰åŠŸèƒ½ã€‚ä¼˜ç‚¹æ˜¯ï¼š DI ï¼ˆä¾èµ–æ³¨å…¥ï¼‰æœ‰æ•ˆçš„é™ä½äº†è€¦åˆåº¦ã€‚ AOPï¼ˆé¢å‘åˆ‡é¢ï¼‰æä¾›äº†é€šç”¨çš„ä»»åŠ¡çš„é›†ä¸­ç®¡ç†ã€‚ ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰ç®€åŒ–äº†å¯¹æ•°æ®åº“çš„è®¿é—®ã€‚ ä½ä¾µå…¥å¼è®¾è®¡ï¼Œä»£ç æ±¡æŸ“æä½ã€‚ 2 springçš„ç»„æˆ 3 IOCçš„æ¦‚å¿µå’Œä½œç”¨3.1 ä»€ä¹ˆæ˜¯ç¨‹åºçš„è€¦åˆè€¦åˆæ€§(Coupling)ï¼Œä¹Ÿå«è€¦åˆåº¦ï¼Œæ˜¯å¯¹æ¨¡å—é—´å…³è”ç¨‹åº¦çš„åº¦é‡ã€‚è€¦åˆçš„å¼ºå¼±å–å†³äºæ¨¡å—é—´æ¥å£çš„å¤æ‚æ€§ã€è°ƒç”¨æ¨¡å—çš„æ–¹å¼ä»¥åŠé€šè¿‡ç•Œé¢ä¼ é€æ•°æ®çš„å¤šå°‘ã€‚æ¨¡å—é—´çš„è€¦åˆåº¦æ˜¯æŒ‡æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼ŒåŒ…æ‹¬æ§åˆ¶å…³ç³»ã€è°ƒç”¨å…³ç³»ã€æ•°æ®ä¼ é€’å…³ç³»ã€‚æ¨¡å—é—´è”ç³»è¶Šå¤šï¼Œå…¶è€¦åˆæ€§è¶Šå¼ºï¼ŒåŒæ—¶è¡¨æ˜å…¶ç‹¬ç«‹æ€§è¶Šå·®( é™ä½è€¦åˆæ€§ï¼Œå¯ä»¥æé«˜å…¶ç‹¬ç«‹æ€§)ã€‚è€¦åˆæ€§å­˜åœ¨äºå„ä¸ªé¢†åŸŸï¼Œè€Œéè½¯ä»¶è®¾è®¡ä¸­ç‹¬æœ‰çš„ï¼Œä½†æ˜¯æˆ‘ä»¬åªè®¨è®ºè½¯ä»¶å·¥ç¨‹ä¸­çš„è€¦åˆã€‚ åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œè€¦åˆæŒ‡çš„å°±æ˜¯å°±æ˜¯å¯¹è±¡ä¹‹é—´çš„ä¾èµ–æ€§ã€‚ å¯¹è±¡ä¹‹é—´çš„è€¦åˆè¶Šé«˜ï¼Œç»´æŠ¤æˆæœ¬è¶Šé«˜ã€‚å› æ­¤å¯¹è±¡çš„è®¾è®¡åº”ä½¿ç±»å’Œæ„ä»¶ä¹‹é—´çš„è€¦åˆæœ€å°ã€‚è½¯ä»¶è®¾è®¡ä¸­é€šå¸¸ç”¨è€¦åˆåº¦å’Œå†…èšåº¦ä½œä¸ºè¡¡é‡æ¨¡å—ç‹¬ç«‹ç¨‹åº¦çš„æ ‡å‡†ã€‚åˆ’åˆ†æ¨¡å—çš„ä¸€ä¸ªå‡†åˆ™å°±æ˜¯é«˜å†…èšä½è€¦åˆã€‚ 3.2 è€¦åˆçš„åˆ†ç±» å†…å®¹è€¦åˆã€‚å½“ä¸€ä¸ªæ¨¡å—ç›´æ¥ä¿®æ”¹æˆ–æ“ä½œå¦ä¸€ä¸ªæ¨¡å—çš„æ•°æ®æ—¶ï¼Œæˆ–ä¸€ä¸ªæ¨¡å—ä¸é€šè¿‡æ­£å¸¸å…¥å£è€Œè½¬å…¥å¦ä¸€ä¸ªæ¨¡å—æ—¶ï¼Œè¿™æ ·çš„è€¦åˆè¢«ç§°ä¸ºå†…å®¹è€¦åˆã€‚å†…å®¹è€¦åˆæ˜¯æœ€é«˜ç¨‹åº¦çš„è€¦åˆï¼Œåº”è¯¥é¿å…ä½¿ç”¨ä¹‹ã€‚ å…¬å…±è€¦åˆã€‚ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„æ¨¡å—å…±åŒå¼•ç”¨ä¸€ä¸ªå…¨å±€æ•°æ®é¡¹ï¼Œè¿™ç§è€¦åˆè¢«ç§°ä¸ºå…¬å…±è€¦åˆã€‚åœ¨å…·æœ‰å¤§é‡å…¬å…±è€¦åˆçš„ç»“æ„ä¸­ï¼Œç¡®å®šç©¶ç«Ÿæ˜¯å“ªä¸ªæ¨¡å—ç»™å…¨å±€å˜é‡èµ‹äº†ä¸€ä¸ªç‰¹å®šçš„å€¼æ˜¯ååˆ†å›°éš¾çš„ã€‚ å¤–éƒ¨è€¦åˆã€‚ä¸€ç»„æ¨¡å—éƒ½è®¿é—®åŒä¸€å…¨å±€ç®€å•å˜é‡è€Œä¸æ˜¯åŒä¸€å…¨å±€æ•°æ®ç»“æ„ï¼Œè€Œä¸”ä¸æ˜¯é€šè¿‡å‚æ•°è¡¨ä¼ é€’è¯¥å…¨å±€å˜é‡çš„ä¿¡æ¯ï¼Œåˆ™ç§°ä¹‹ä¸ºå¤–éƒ¨è€¦åˆã€‚ æ§åˆ¶è€¦åˆã€‚ä¸€ä¸ªæ¨¡å—é€šè¿‡æ¥å£å‘å¦ä¸€ä¸ªæ¨¡å—ä¼ é€’ä¸€ä¸ªæ§åˆ¶ä¿¡å·ï¼Œæ¥å—ä¿¡å·çš„æ¨¡å—æ ¹æ®ä¿¡å·å€¼è€Œè¿›è¡Œé€‚å½“çš„åŠ¨ä½œï¼Œè¿™ç§è€¦åˆè¢«ç§°ä¸ºæ§åˆ¶è€¦åˆã€‚ æ ‡è®°è€¦åˆã€‚è‹¥ä¸€ä¸ªæ¨¡å— A é€šè¿‡æ¥å£å‘ä¸¤ä¸ªæ¨¡å— B å’Œ C ä¼ é€’ä¸€ä¸ªå…¬å…±å‚æ•°ï¼Œé‚£ä¹ˆç§°æ¨¡å— B å’Œ C ä¹‹é—´å­˜åœ¨ä¸€ä¸ªæ ‡è®°è€¦åˆã€‚ æ•°æ®è€¦åˆã€‚æ¨¡å—ä¹‹é—´é€šè¿‡å‚æ•°æ¥ä¼ é€’æ•°æ®ï¼Œé‚£ä¹ˆè¢«ç§°ä¸ºæ•°æ®è€¦åˆã€‚æ•°æ®è€¦åˆæ˜¯æœ€ä½çš„ä¸€ç§è€¦åˆå½¢å¼ï¼Œç³»ç»Ÿä¸­ä¸€èˆ¬éƒ½å­˜åœ¨è¿™ç§ç±»å‹çš„è€¦åˆï¼Œå› ä¸ºä¸ºäº†å®Œæˆä¸€äº›æœ‰æ„ä¹‰çš„åŠŸèƒ½ï¼Œå¾€å¾€éœ€è¦å°†æŸäº›æ¨¡å—çš„è¾“å‡ºæ•°æ®ä½œä¸ºå¦ä¸€äº›æ¨¡å—çš„è¾“å…¥æ•°æ®ã€‚ éç›´æ¥è€¦åˆã€‚ä¸¤ä¸ªæ¨¡å—ä¹‹é—´æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œå®ƒä»¬ä¹‹é—´çš„è”ç³»å®Œå…¨æ˜¯é€šè¿‡ä¸»æ¨¡å—çš„æ§åˆ¶å’Œè°ƒç”¨æ¥å®ç°çš„ã€‚ 3.3 å†…èšä¸è€¦åˆå†…èšæ ‡å¿—ä¸€ä¸ªæ¨¡å—å†…å„ä¸ªå…ƒç´ å½¼æ­¤ç»“åˆçš„ç´§å¯†ç¨‹åº¦ï¼Œå®ƒæ˜¯ä¿¡æ¯éšè”½å’Œå±€éƒ¨åŒ–æ¦‚å¿µçš„è‡ªç„¶æ‰©å±•ã€‚å†…èšæ˜¯ä»åŠŸèƒ½è§’åº¦æ¥åº¦é‡æ¨¡å—å†…çš„è”ç³»ï¼Œä¸€ä¸ªå¥½çš„å†…èšæ¨¡å—åº”å½“æ°å¥½åšä¸€ä»¶äº‹ã€‚å®ƒæè¿°çš„æ˜¯æ¨¡å—å†…çš„åŠŸèƒ½è”ç³»ã€‚è€¦åˆæ˜¯è½¯ä»¶ç»“æ„ä¸­å„æ¨¡å—ä¹‹é—´ç›¸äº’è¿æ¥çš„ä¸€ç§åº¦é‡ï¼Œè€¦åˆå¼ºå¼±å–å†³äºæ¨¡å—é—´æ¥å£çš„å¤æ‚ç¨‹åº¦ã€è¿›å…¥æˆ–è®¿é—®ä¸€ä¸ªæ¨¡å—çš„ç‚¹ä»¥åŠé€šè¿‡æ¥å£çš„æ•°æ®ã€‚ ç¨‹åºè®²ç©¶çš„æ˜¯ä½è€¦åˆï¼Œé«˜å†…èšã€‚å°±æ˜¯åŒä¸€ä¸ªæ¨¡å—å†…çš„å„ä¸ªå…ƒç´ ä¹‹é—´è¦é«˜åº¦ç´§å¯†ï¼Œä½†æ˜¯å„ä¸ªæ¨¡å—ä¹‹é—´çš„ç›¸äº’ä¾å­˜åº¦å´è¦ä¸é‚£ä¹ˆç´§å¯†ã€‚ å†…èšå’Œè€¦åˆæ˜¯å¯†åˆ‡ç›¸å…³çš„ï¼ŒåŒå…¶ä»–æ¨¡å—å­˜åœ¨é«˜è€¦åˆçš„æ¨¡å—æ„å‘³ç€ä½å†…èšï¼Œè€Œé«˜å†…èšçš„æ¨¡å—æ„å‘³ç€è¯¥æ¨¡å—åŒå…¶ä»–æ¨¡å—ä¹‹é—´æ˜¯ä½è€¦åˆã€‚åœ¨è¿›è¡Œè½¯ä»¶è®¾è®¡æ—¶ï¼Œåº”åŠ›äº‰åšåˆ°é«˜å†…èšï¼Œä½è€¦åˆã€‚ 4 IOC æ§åˆ¶åè½¬ï¼ˆInversion of Controlï¼Œç¼©å†™ä¸ºIoCï¼‰ï¼Œæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„ä¸€ç§è®¾è®¡åŸåˆ™ï¼Œå¯ä»¥ç”¨æ¥å‡ä½è®¡ç®—æœºä»£ç ä¹‹é—´çš„è€¦åˆåº¦ã€‚å…¶ä¸­æœ€å¸¸è§çš„æ–¹å¼å«åšä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼Œç®€ç§°DIï¼‰ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼å«â€œä¾èµ–æŸ¥æ‰¾â€ï¼ˆDependency Lookupï¼‰ã€‚é€šè¿‡æ§åˆ¶åè½¬ï¼Œå¯¹è±¡åœ¨è¢«åˆ›å»ºçš„æ—¶å€™ï¼Œç”±ä¸€ä¸ªè°ƒæ§ç³»ç»Ÿå†…æ‰€æœ‰å¯¹è±¡çš„å¤–ç•Œå®ä½“å°†å…¶æ‰€ä¾èµ–çš„å¯¹è±¡çš„å¼•ç”¨ä¼ é€’ç»™å®ƒã€‚ä¹Ÿå¯ä»¥è¯´ï¼Œä¾èµ–è¢«æ³¨å…¥åˆ°å¯¹è±¡ä¸­ã€‚ 4.1 åå°„å·¥å‚è¿™æ˜¯ä¸€ä¸ªç®€å•äº†è§£IoCæ€æƒ³çš„å°æ¡ˆä¾‹ public class BeanFactory { private static Properties props; //ä½¿ç”¨é™æ€ä»£ç å—ä¸ºPropertiesèµ‹å€¼ static{ try { //å®ä¾‹åŒ–å¯¹è±¡ props = new Properties(); //è·å–propertiesçš„æµå¯¹è±¡ InputStream in = BeanFactory.class.getClassLoader().getResourceAsStream(\"bean.properties\"); props.load(in); } catch (Exception e) { throw new ExceptionInInitializerError(\"åˆå§‹åŒ–propertieså¤±è´¥!\"); } } /** * æ ¹æ®beançš„åç§°è·å–beanå¯¹è±¡ * @param beanName * @return */ public static Object getBean(String beanName){ Object bean = null; try { String beanPath = props.getProperty(beanName); bean = Class.forName(beanPath).newInstance(); } catch (Exception e) { e.printStackTrace(); } return bean; } } é—®é¢˜ï¼šæ¯æ¬¡éƒ½ä¼šåˆ›å»ºæ–°å¯¹è±¡ï¼Œæ˜¯å¤šä¾‹çš„ å•ä¾‹åå°„å·¥å‚ï¼š public class BeanFactory { private static Properties props; private static Map&lt;String,Object> beans; //ä½¿ç”¨é™æ€ä»£ç å—ä¸ºPropertiesèµ‹å€¼ static{ try { //å®ä¾‹åŒ–å¯¹è±¡ props = new Properties(); //è·å–propertiesçš„æµå¯¹è±¡ InputStream in = BeanFactory.class.getClassLoader().getResourceAsStream(\"bean.properties\"); props.load(in); beans = new HashMap&lt;String, Object>(); //å–å‡ºé…ç½®æ–‡ä»¶ä¸­æ‰€æœ‰çš„key Enumeration keys = props.keys(); //éå†æšä¸¾ while(keys.hasMoreElements()){ //å–å‡ºæ¯ä¸ªkey String key = keys.nextElement().toString(); String beanPath = props.getProperty(key); Object value = Class.forName(beanPath).newInstance(); //æŠŠkeyå’Œvalueå­˜å…¥å®¹å™¨ä¸­ beans.put(key,value); } } catch (Exception e) { throw new ExceptionInInitializerError(\"åˆå§‹åŒ–propertieså¤±è´¥!\"); } } /** * æ ¹æ®beançš„åç§°è·å–beanå¯¹è±¡ * @param beanName * @return */ public static Object getBean(String beanName){ return beans.get(beanName); } } è€Œè¿™ç§æ€æƒ³å°±æ˜¯IOCçš„æ€æƒ³ã€‚ 4.2 Springä¸­çš„IOC4.2.1 springçš„mavené…ç½®&lt;dependency> &lt;groupId>org.springframework&lt;/groupId> &lt;artifactId>spring-context&lt;/artifactId> &lt;version>5.2.3.RELEASE&lt;/version> &lt;/dependency> 4.2.2 springçš„æ€»é…ç½®&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd\"> &lt;!-- æŠŠå¯¹è±¡çš„åˆ›å»ºäº¤ç»™springæ¥ç®¡ç† --> &lt;bean id=\"accountService\" class=\"com.rhett.service.impl.AccountServiceImpl\"/> &lt;bean id=\"accountDao\" class=\"com.rhett.dao.impl.AccountDaoImpl\"/> &lt;/beans> 4.2.3 ç¨‹åºä¸­è·å–bean//1. è·å–æ ¸å¿ƒå®¹å™¨å¯¹è±¡ ApplicationContext ac = new ClassPathXmlApplicationContext(\"bean.xml\"); //2. æ ¹æ®idè·å–beanå¯¹è±¡ IAccountService as = (IAccountService) ac.getBean(\"accountService\"); IAccountDao adao = ac.getBean(\"accountDao\", IAccountDao.class); ApplicationContextçš„ä¸‰ä¸ªå¸¸ç”¨å®ç°ç±»ï¼š ClassPathXmlApplicationContextï¼šå®ƒå¯ä»¥åŠ è½½ç±»è·¯å¾„ä¸‹çš„é…ç½®æ–‡ä»¶ FileSystemXmlApplicationContextï¼šå®ƒå¯ä»¥åŠ è½½ç£ç›˜ä»»æ„è·¯å¾„ä¸‹çš„é…ç½®æ–‡ä»¶ï¼ˆå¿…é¡»æœ‰è®¿é—®æƒé™ï¼‰ AnnotationConfigApplicationContextï¼šå®ƒæ˜¯ç”¨äºè¯»å–æ³¨è§£åˆ›å»ºå®¹å™¨çš„ æ ¸å¿ƒå®¹å™¨çš„ä¸¤ä¸ªæ¥å£BeanFactoryå’ŒApplicationContextçš„åŒºåˆ«ï¼š BeanFactory æ˜¯ä¸æ”¯æŒå›½é™…åŒ–åŠŸèƒ½çš„ï¼Œå› ä¸º BeanFactory æ²¡æœ‰æ‰©å±• Spring ä¸­ MessageResource æ¥å£ã€‚ç›¸åï¼Œç”±äº ApplicationContext æ‰©å±•äº† MessageResource æ¥å£ï¼Œå› è€Œå…·æœ‰æ¶ˆæ¯å¤„ç†çš„èƒ½åŠ›ã€‚ ApplicationContext çš„äº‹ä»¶æœºåˆ¶ä¸»è¦é€šè¿‡ ApplicationEvent å’Œ ApplicationListener è¿™ä¸¤ä¸ªæ¥å£æ¥æä¾›çš„ï¼Œå’Œ java swing ä¸­çš„äº‹ä»¶æœºåˆ¶ä¸€æ ·ã€‚å³å½“ ApplicationContext ä¸­å‘å¸ƒä¸€ä¸ªäº‹ä»¶çš„æ—¶ï¼Œæ‰€æœ‰æ‰©å±•äº† ApplicationListener çš„ Bean éƒ½å°†ä¼šæ¥å—åˆ°è¿™ä¸ªäº‹ä»¶ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚ ApplicationContext æ‰©å±•äº† ResourceLoader(èµ„æºåŠ è½½å™¨)æ¥å£ï¼Œä»è€Œå¯ä»¥ç”¨æ¥åŠ è½½å¤šä¸ª Resourceï¼Œè€Œ BeanFactory æ˜¯æ²¡æœ‰æ‰©å±• ResourceLoader BeanFactroy é‡‡ç”¨çš„æ˜¯å»¶è¿ŸåŠ è½½å½¢å¼æ¥æ³¨å…¥ Bean çš„ï¼Œå³åªæœ‰åœ¨ä½¿ç”¨åˆ°æŸä¸ªBean æ—¶ï¼Œæ‰å¯¹è¯¥ Bean è¿›è¡ŒåŠ è½½å®ä¾‹åŒ–ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±ä¸èƒ½å‘ç°ä¸€äº›å­˜åœ¨çš„ Spring çš„é…ç½®é—®é¢˜ã€‚è€Œ ApplicationContext åˆ™ç›¸åï¼Œå®ƒæ˜¯åœ¨å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¸€æ¬¡æ€§åˆ›å»ºäº†æ‰€æœ‰çš„ Beanã€‚è¿™æ ·ï¼Œåœ¨å®¹å™¨å¯åŠ¨æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘ç° Springä¸­å­˜åœ¨çš„é…ç½®é”™è¯¯ã€‚ 4.2.4 åˆ›å»ºbeançš„ä¸‰ç§æ–¹å¼ç¬¬ä¸€ç§æ–¹å¼ï¼š ä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°åˆ›å»ºã€‚åœ¨springçš„é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨beanæ ‡ç­¾ï¼Œå¦‚æœæ­¤ç±»ä¸­æ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°ï¼Œåˆ™å¯¹è±¡æ— æ³•åˆ›å»º &lt;bean id=\"accountService\" class=\"com.rhett.service.impl.AccountServiceImpl\"/> ç¬¬äºŒç§æ–¹å¼ï¼š ä½¿ç”¨æŸä¸ªç±»ä¸­çš„æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œå¹¶å­˜å…¥springå®¹å™¨ public class InstanceFactory { public IAccountService getAccountService(){ return new AccountServiceImpl(); } } &lt;bean id=\"instanceFactory\" class=\"com.rhett.factory.InstanceFactory\"/> &lt;bean id=\"accountService\" factory-bean=\"instanceFactory\" factory-method=\"getAccountService\"/> ç¬¬ä¸‰ç§æ–¹å¼ï¼š ä½¿ç”¨æŸä¸ªç±»ä¸­çš„é™æ€æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œå¹¶å­˜å…¥springå®¹å™¨ public class StaticFactory { public static IAccountService getAccountService(){ return new AccountServiceImpl(); } } &lt;bean id=\"instanceFactory\" class=\"com.rhett.factory.StaticFactory\" factory-method=\"getAccountService\"/> 4.2.5 beançš„ä½œç”¨èŒƒå›´beanæ ‡ç­¾çš„scopeå±æ€§ç”¨äºæŒ‡å®šbeançš„ä½œç”¨èŒƒå›´ï¼Œå–å€¼ï¼š singletonï¼šå•ä¾‹çš„ï¼ˆé»˜è®¤ï¼‰ prototypeï¼šå¤šä¾‹çš„ requestï¼šä½œç”¨äºwebåº”ç”¨çš„è¯·æ±‚èŒƒå›´ sessionï¼šä½œç”¨äºwebåº”ç”¨çš„ä¼šè¯èŒƒå›´ global-sessionï¼šä½œç”¨äºé›†ç¾¤ç¯å¢ƒçš„ä¼šè¯èŒƒå›´ï¼ˆå…¨å±€ä¼šè¯èŒƒå›´ï¼‰ï¼Œå½“ä¸æ˜¯é›†ç¾¤ç¯å¢ƒæ—¶ï¼Œå®ƒå°±æ˜¯session 4.2.6 beanå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå•ä¾‹å¯¹è±¡ï¼š å½“å®¹å™¨åˆ›å»ºæ—¶å¯¹è±¡å‡ºç”Ÿ åªè¦å®¹å™¨è¿˜åœ¨ï¼Œå¯¹è±¡ä¸€ç›´æ´»ç€ å®¹å™¨é”€æ¯ï¼Œå¯¹è±¡æ¶ˆäº¡ å•ä¾‹å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œå®¹å™¨ç›¸åŒ å¤šä¾‹å¯¹è±¡ï¼š å½“æˆ‘ä»¬ä½¿ç”¨å¯¹è±¡æ—¶åˆ›å»º å¯¹è±¡åªè¦åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å°±ä¸€ç›´æ´»ç€ å½“å¯¹è±¡é•¿æ—¶é—´ä¸ç”¨ï¼Œä¸”æ²¡æœ‰åˆ«çš„å¯¹è±¡å¼•ç”¨æ—¶ï¼Œè¢«åƒåœ¾å›æ”¶ æœ‰ä¸‰ç§æ–¹å¼åœ¨ Bean åˆå§‹åŒ–åå’Œé”€æ¯å‰æ·»åŠ ä¸€äº›æ“ä½œã€‚ Bean çš„æ–¹æ³•åŠ ä¸Š@PostConstruct å’Œ@PreDestroy æ³¨è§£ï¼ˆå¿…é¡»æœ‰ component-scan æ‰æœ‰æ•ˆï¼‰ åœ¨Springé…ç½®ä¸­å®šä¹‰ init-method å’Œ destory-method æ–¹æ³• Bean å®ç° InitializingBean å’Œ DisposableBean æ¥å£ é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ BeanNameAwareæ¥å£è®¾ç½®Beanåç§° BeanFactoryAware/ApplicationContextAwareæ¥å£è®¾ç½®IoCå®¹å™¨ BeanPostProcessorä¸ºæ‰€æœ‰çš„Beanæ·»åŠ é¢„åˆå§‹åŒ–æ–¹æ³•å’Œååˆå§‹åŒ–æ–¹æ³• æœ€å…¨æ¦‚æ‹¬ï¼š å®ä¾‹åŒ–ä¸€ä¸ª Beanï¼ï¼ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ newï¼› æŒ‰ç…§ Spring ä¸Šä¸‹æ–‡å¯¹å®ä¾‹åŒ–çš„ Bean è¿›è¡Œé…ç½®ï¼ï¼ä¹Ÿå°±æ˜¯ IOC æ³¨å…¥ï¼› å¦‚æœè¿™ä¸ª Bean å·²ç»å®ç°äº† BeanNameAware æ¥å£ï¼Œä¼šè°ƒç”¨å®ƒå®ç°çš„ setBeanName(String)æ–¹æ³•ï¼Œæ­¤å¤„ä¼ é€’çš„å°±æ˜¯ Spring é…ç½®æ–‡ä»¶ä¸­ Bean çš„ id å€¼ å¦‚æœè¿™ä¸ª Bean å·²ç»å®ç°äº† BeanFactoryAware æ¥å£ï¼Œä¼šè°ƒç”¨å®ƒå®ç°çš„setBeanFactoryï¼Œä¼ é€’çš„æ˜¯ Spring å·¥å‚è‡ªèº«ï¼ˆå¯ä»¥ç”¨è¿™ä¸ªæ–¹å¼æ¥è·å–å…¶å®ƒ Beanï¼Œåªéœ€åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­é…ç½®ä¸€ä¸ªæ™®é€šçš„ Bean å°±å¯ä»¥ï¼‰ï¼› å¦‚æœè¿™ä¸ª Bean å·²ç»å®ç°äº† ApplicationContextAware æ¥å£ï¼Œä¼šè°ƒç”¨ setApplicationContextæ–¹æ³•ï¼Œä¼ å…¥ Spring ä¸Šä¸‹æ–‡ï¼ˆåŒæ ·è¿™ä¸ªæ–¹å¼ä¹Ÿå¯ä»¥å®ç°æ­¥éª¤ 4 çš„å†…å®¹ï¼Œä½†æ¯” 4 æ›´å¥½ï¼Œå› ä¸º ApplicationContext æ˜¯ BeanFactory çš„å­æ¥å£ï¼Œæœ‰æ›´å¤šçš„å®ç°æ–¹æ³•ï¼‰ï¼› å¦‚æœBeanä¸­æœ‰ @PostConstruct æ ‡æ³¨çš„æ–¹æ³•ï¼Œä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚ å¦‚æœBeanå®ç°äº†InitializingBeanæ¥å£ï¼Œä¼šè°ƒç”¨AfterPropertiesSetæ–¹æ³• å¦‚æœè¿™ä¸ª Bean å…³è”äº† BeanPostProcessor æ¥å£ï¼Œå°†ä¼šè°ƒç”¨ postProcessBeforeInitialization(Object obj, String s)æ–¹æ³•ï¼ŒBeanPostProcessor ç»å¸¸ç”¨ä½œæ˜¯ Beanå†…å®¹çš„æ›´æ”¹ï¼Œå¹¶ä¸”ç”±äºè¿™ä¸ªæ˜¯åœ¨ Bean åˆå§‹åŒ–ç»“æŸæ—¶è°ƒç”¨é‚£ä¸ªçš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥è¢«åº”ç”¨äºå†…å­˜æˆ–ç¼“å­˜æŠ€æœ¯ï¼› å¦‚æœ Bean åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­é…ç½®äº† init-method å±æ€§ä¼šè‡ªåŠ¨è°ƒç”¨å…¶é…ç½®çš„åˆå§‹åŒ–æ–¹æ³•ã€‚ å¦‚æœè¿™ä¸ª Bean å…³è”äº† BeanPostProcessor æ¥å£ï¼Œå°†ä¼šè°ƒç”¨ postProcessAfterInitialization(Object obj, String s)æ–¹æ³• å¦‚æœBeanä¸­æœ‰ @PreDestroy æ ‡æ³¨çš„æ–¹æ³•ï¼Œä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚ å½“ Bean ä¸å†éœ€è¦æ—¶ï¼Œä¼šç»è¿‡æ¸…ç†é˜¶æ®µï¼Œå¦‚æœ Bean å®ç°äº† DisposableBean è¿™ä¸ªæ¥å£ï¼Œä¼šè°ƒç”¨é‚£ä¸ªå…¶å®ç°çš„ destroyæ–¹æ³•ï¼› æœ€åï¼Œå¦‚æœè¿™ä¸ª Bean çš„ Spring é…ç½®ä¸­é…ç½®äº† destroy-method å±æ€§ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨å…¶é…ç½®çš„é”€æ¯æ–¹æ³•ã€‚ 4.3 springä¸­çš„ä¾èµ–æ³¨å…¥ä¾èµ–æ³¨å…¥ï¼šDependency injectionï¼ŒDI ä¾èµ–å…³ç³»çš„ç®¡ç†ï¼šäº¤ç»™springæ¥ç»´æŠ¤ åœ¨å½“å‰ç±»éœ€è¦ç”¨åˆ°å…¶ä»–ç±»çš„å¯¹è±¡ï¼Œç”±springä¸ºæˆ‘ä»¬æä¾›ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­è¯´æ˜ã€‚ä¾èµ–å…³ç³»çš„ç»´æŠ¤å°±ç§°ä¹‹ä¸ºä¾èµ–æ³¨å…¥ã€‚ èƒ½æ³¨å…¥çš„æ•°æ®æœ‰ä¸‰ç±»ï¼š åŸºæœ¬ç±»å‹å’ŒString å…¶ä»–beanç±»å‹ï¼ˆåœ¨é…ç½®æ–‡ä»¶ä¸­æˆ–è€…æ³¨è§£é…ç½®è¿‡çš„beanï¼‰ å¤æ‚ç±»å‹/é›†åˆç±»å‹ æ³¨å…¥çš„æ–¹å¼ï¼Œæœ‰ä¸‰ç§ï¼š ç¬¬ä¸€ç§ï¼šä½¿ç”¨æ„é€ å‡½æ•°æä¾› éœ€è¦æ³¨å…¥ä¾èµ–çš„å®ä½“ç±»ï¼š public class AccountServiceImpl implements IAccountService { private String name; private Integer age; private Date birthday; public AccountServiceImpl(String name, Integer age, Date birthday) { this.name = name; this.age = age; this.birthday = birthday; } public void saveAccount() { System.out.println(\"serviceä¸­çš„saveAccountæ–¹æ³•æ‰§è¡Œäº†\"+name+\",\"+age+\",\"+birthday); } } springé…ç½®ï¼š &lt;bean id=\"accountService\" class=\"com.rhett.service.impl.AccountServiceImpl\"> &lt;constructor-arg name=\"name\" value=\"test\">&lt;/constructor-arg> &lt;constructor-arg name=\"age\" value=\"18\">&lt;/constructor-arg> &lt;constructor-arg name=\"birthday\" ref=\"now\">&lt;/constructor-arg> &lt;/bean> &lt;bean id=\"now\" class=\"java.util.Date\">&lt;/bean> ä½¿ç”¨æ ‡ç­¾ï¼š&lt;constructor-arg&gt; æ ‡ç­¾ä¸­çš„å±æ€§ï¼š typeï¼šç”¨äºæŒ‡å®šè¦æ³¨å…¥çš„æ•°æ®ç±»å‹ indexï¼šç”¨äºæŒ‡å®šè¦æ³¨å…¥çš„æ•°æ®ç»™æ„é€ å‡½æ•°ä¸­æŒ‡å®šç´¢å¼•ä½ç½®çš„å‚æ•°èµ‹å€¼ï¼Œç´¢å¼•çš„ä½ç½®ä»0å¼€å§‹ nameï¼šç”¨äºæŒ‡å®šç»™æ„é€ å‡½æ•°ä¸­æŒ‡å®šåç§°çš„å‚æ•°èµ‹å€¼ï¼ˆé€šå¸¸é€šè¿‡è¿™ä¸ªå°±èƒ½æ‰¾åˆ°å¯¹åº”çš„å‚æ•°ï¼‰ valueï¼šç”¨äºæä¾›åŸºæœ¬ç±»å‹å’ŒStringç±»å‹çš„æ•°æ® refï¼šç”¨äºæŒ‡å®šå…¶ä»–çš„beanç±»å‹æ•°æ®ï¼Œå®ƒæŒ‡çš„å°±æ˜¯åœ¨springçš„Iocå®¹å™¨ä¸­å‡ºç°è¿‡çš„beanå¯¹è±¡ã€‚ ç¬¬äºŒç§ï¼šä½¿ç”¨setæ–¹æ³•æä¾› éœ€è¦æ³¨å…¥ä¾èµ–çš„å®ä½“ç±»ï¼š public class AccountServiceImpl implements IAccountService { private String name; private Integer age; private Date birthday; public void setName(String name) { this.name = name; } public void setAge(Integer age) { this.age = age; } public void setBirthday(Date birthday) { this.birthday = birthday; } public void saveAccount() { System.out.println(\"serviceä¸­çš„saveAccountæ–¹æ³•æ‰§è¡Œäº†\"+name+\",\"+age+\",\"+birthday); } } springé…ç½®ï¼š &lt;bean id=\"accountService\" class=\"com.rhett.service.impl.AccountServiceImpl\"> &lt;property name=\"name\" value=\"TEST\">&lt;/property> &lt;property name=\"age\" value=\"21\">&lt;/property> &lt;property name=\"birthday\" ref=\"now\">&lt;/property> &lt;/bean> &lt;bean id=\"now\" class=\"java.util.Date\">&lt;/bean> ä½¿ç”¨æ ‡ç­¾ï¼š&lt;property&gt; æ ‡ç­¾ä¸­çš„å±æ€§ï¼š nameï¼šç”¨äºæŒ‡å®šæ³¨å…¥æ—¶æ‰€è°ƒç”¨çš„setæ–¹æ³•åç§° valueï¼šç”¨äºæä¾›åŸºæœ¬ç±»å‹å’ŒStringç±»å‹çš„æ•°æ® refï¼šç”¨äºæŒ‡å®šå…¶ä»–çš„beanç±»å‹æ•°æ®ï¼Œå®ƒæŒ‡çš„å°±æ˜¯åœ¨springçš„Iocå®¹å™¨ä¸­å‡ºç°è¿‡çš„beanå¯¹è±¡ã€‚ å¤æ‚ç±»å‹çš„æ³¨å…¥ï¼š éœ€è¦æ³¨å…¥ä¾èµ–çš„å®ä½“ç±»ï¼š public class AccountServiceImpl implements IAccountService { private String[] myStrs; private List&lt;String> myList; private Set&lt;String> mySet; private Map&lt;String,String> myMap; private Properties myProps; public void setMyStrs(String[] myStrs) { this.myStrs = myStrs; } public void setMyList(List&lt;String> myList) { this.myList = myList; } public void setMySet(Set&lt;String> mySet) { this.mySet = mySet; } public void setMyMap(Map&lt;String, String> myMap) { this.myMap = myMap; } public void setMyProps(Properties myProps) { this.myProps = myProps; } } springé…ç½®ï¼š &lt;bean id=\"accountService\" class=\"com.rhett.service.impl.AccountServiceImpl\"> &lt;property name=\"myStrs\"> &lt;array> &lt;value>AAA&lt;/value> &lt;value>BBB&lt;/value> &lt;value>CCC&lt;/value> &lt;/array> &lt;/property> &lt;property name=\"myList\"> &lt;list> &lt;value>AAA&lt;/value> &lt;value>BBB&lt;/value> &lt;value>CCC&lt;/value> &lt;/list> &lt;/property> &lt;property name=\"mySet\"> &lt;set> &lt;value>AAA&lt;/value> &lt;value>BBB&lt;/value> &lt;value>CCC&lt;/value> &lt;/set> &lt;/property> &lt;property name=\"myMap\"> &lt;map> &lt;entry key=\"testA\" value=\"aaa\">&lt;/entry> &lt;entry key=\"testB\"> &lt;value>bbb&lt;/value> &lt;/entry> &lt;/map> &lt;/property> &lt;property name=\"myProps\"> &lt;props> &lt;prop key=\"testC\">ccc&lt;/prop> &lt;prop key=\"testD\">ddd&lt;/prop> &lt;/props> &lt;/property> &lt;/bean> propertyæ ‡ç­¾ä¸­éœ€è¦æ­é…arrayã€listã€setã€mapã€propsä½¿ç”¨ï¼Œå…¶ä¸­arrayã€listã€setå¯ä»¥äº’æ¢é€šç”¨ï¼Œmapã€propså¯ä»¥äº’æ¢é€šç”¨ã€‚ ç¬¬ä¸‰ç§ï¼šä½¿ç”¨æ³¨è§£æä¾› è§Springä¹‹æ³¨è§£é…ç½®IoC ï¼ˆè¿™ç¯‡åšå®¢çš„é•¿åº¦å·²ç»è¶…å‡ºæˆ‘é¢„æœŸäº†ï¼Œä¸€ç¯‡åšå®¢å†™é‚£ä¹ˆå¤šå¤ªä¸åˆ’ç®—äº†ğŸŒšï¼‰","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://www.codetool.top/tags/Spring/"}]},{"title":"å¿«é€Ÿå¤±è´¥(fail-fast)å’Œå®‰å…¨å¤±è´¥(fail-safe)","slug":"å¿«é€Ÿå¤±è´¥-fail-fast-å’Œå®‰å…¨å¤±è´¥-fail-safe","date":"2020-02-22T16:13:19.000Z","updated":"2020-02-22T16:29:34.966Z","comments":true,"path":"article/å¿«é€Ÿå¤±è´¥-fail-fast-å’Œå®‰å…¨å¤±è´¥-fail-safe/","link":"","permalink":"https://www.codetool.top/article/%E5%BF%AB%E9%80%9F%E5%A4%B1%E8%B4%A5-fail-fast-%E5%92%8C%E5%AE%89%E5%85%A8%E5%A4%B1%E8%B4%A5-fail-safe/","excerpt":"","text":"1 å¿«é€Ÿå¤±è´¥åœ¨ç”¨è¿­ä»£å™¨éå†ä¸€ä¸ªé›†åˆå¯¹è±¡æ—¶ï¼Œå¦‚æœéå†è¿‡ç¨‹ä¸­å¯¹é›†åˆå¯¹è±¡çš„å†…å®¹è¿›è¡Œäº†ä¿®æ”¹ï¼ˆå¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ï¼‰ï¼Œåˆ™ä¼šæŠ›å‡º Concurrent Modification Exceptionã€‚ è¿­ä»£å™¨åœ¨éå†æ—¶ç›´æ¥è®¿é—®é›†åˆä¸­çš„å†…å®¹ï¼Œå¹¶ä¸”åœ¨éå†è¿‡ç¨‹ä¸­ä½¿ç”¨ä¸€ä¸ª modCount å˜é‡ã€‚é›†åˆåœ¨è¢«éå†æœŸé—´å¦‚æœå†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šæ”¹å˜ modCount çš„å€¼ã€‚æ¯å½“è¿­ä»£å™¨ä½¿ç”¨ hashNext()/next()éå†ä¸‹ä¸€ä¸ªå…ƒç´ ä¹‹å‰ï¼Œéƒ½ä¼šæ£€æµ‹ modCount å˜é‡æ˜¯å¦ä¸º expectedModCount å€¼ï¼Œæ˜¯çš„è¯å°±è¿”å›éå†ï¼›å¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œç»ˆæ­¢éå†ã€‚ è¿™ä¸ªæœºåˆ¶æˆ‘åœ¨ä¹‹å‰çš„åšå®¢ä¸­ArrayListæºç åˆ†æä¸­æœ‰æåˆ°ï¼Œä¹Ÿåˆ†æäº†è¿­ä»£å™¨ä¸­å…³äºåˆ¤æ–­modCountæ˜¯å¦ä¸ºæœŸæœ›å€¼çš„æºç éƒ¨åˆ†ã€‚ ä¸‹é¢ä¸»è¦æ¥çœ‹å®‰å…¨å¤±è´¥(fail-safe) 2 å®‰å…¨å¤±è´¥é‡‡ç”¨å®‰å…¨å¤±è´¥æœºåˆ¶çš„é›†åˆå®¹å™¨ï¼Œåœ¨éå†æ—¶ä¸æ˜¯ç›´æ¥åœ¨é›†åˆå†…å®¹ä¸Šè®¿é—®çš„ï¼Œè€Œæ˜¯å…ˆå¤åˆ¶åŸæœ‰é›†åˆå†…å®¹ï¼Œåœ¨æ‹·è´çš„é›†åˆä¸Šè¿›è¡Œéå†ã€‚ è¿™ç‚¹å’ŒCopyOnWriteArrayListåœ¨ä¿®æ”¹ä¸Šçš„çš„æœºåˆ¶å¾ˆä¸€è‡´ã€‚ åŸç†ï¼šç”±äºè¿­ä»£æ—¶æ˜¯å¯¹åŸé›†åˆçš„æ‹·è´è¿›è¡Œéå†ï¼Œæ‰€ä»¥åœ¨éå†è¿‡ç¨‹ä¸­å¯¹åŸé›†åˆæ‰€ä½œçš„ä¿®æ”¹å¹¶ä¸èƒ½è¢«è¿­ä»£å™¨æ£€æµ‹åˆ°ï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘ Concurrent Modification Exceptionã€‚ æ¯”å¦‚æˆ‘ä»¬æ¥çœ‹ConcurrentHashMapçš„è¿­ä»£å™¨ï¼š static class Traverser&lt;K,V> { Node&lt;K,V>[] tab; // current table; updated if resized Node&lt;K,V> next; // the next entry to use TableStack&lt;K,V> stack, spare; // to save/restore on ForwardingNodes int index; // index of bin to use next int baseIndex; // current index of initial table int baseLimit; // index bound for initial table final int baseSize; // initial table size Traverser(Node&lt;K,V>[] tab, int size, int index, int limit) { //åœ¨è¿™é‡Œå¤åˆ¶tab this.tab = tab; this.baseSize = size; this.baseIndex = this.index = index; this.baseLimit = limit; this.next = null; } //éå†é€»è¾‘ç•¥ } ç¼ºç‚¹ï¼šåŸºäºæ‹·è´å†…å®¹çš„ä¼˜ç‚¹æ˜¯é¿å…äº† Concurrent Modification Exceptionï¼Œä½†åŒæ ·åœ°ï¼Œè¿­ä»£å™¨å¹¶ä¸èƒ½è®¿é—®åˆ°ä¿®æ”¹åçš„å†…å®¹ï¼Œå³ï¼šè¿­ä»£å™¨éå†çš„æ˜¯å¼€å§‹éå†é‚£ä¸€åˆ»æ‹¿åˆ°çš„é›†åˆæ‹·è´ï¼Œåœ¨éå†æœŸé—´åŸé›†åˆå‘ç”Ÿçš„ä¿®æ”¹è¿­ä»£å™¨æ˜¯ä¸çŸ¥é“çš„ã€‚ åœºæ™¯ï¼šjava.util.concurrent åŒ…ä¸‹çš„å®¹å™¨éƒ½æ˜¯å®‰å…¨å¤±è´¥ï¼Œå¯ä»¥åœ¨å¤šçº¿ç¨‹ä¸‹å¹¶å‘ä½¿ç”¨ï¼Œå¹¶å‘ä¿®æ”¹ã€‚ 3 æ€»ç»“å¿«é€Ÿå¤±è´¥å’Œå®‰å…¨å¤±è´¥æ˜¯å¯¹è¿­ä»£å™¨è€Œè¨€çš„ã€‚ å¿«é€Ÿå¤±è´¥ï¼šå½“åœ¨è¿­ä»£ä¸€ä¸ªé›†åˆçš„æ—¶å€™ï¼Œå¦‚æœæœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹åœ¨ä¿®æ”¹è¿™ä¸ªé›†åˆï¼Œå°±ä¼šæŠ›å‡º ConcurrentModification å¼‚å¸¸ï¼Œjava.util ä¸‹çš„é›†åˆç±»éƒ½æ˜¯å¿«é€Ÿå¤±è´¥ã€‚ å®‰å…¨å¤±è´¥ï¼šåœ¨è¿­ä»£æ—¶å€™ä¼šåœ¨é›†åˆäºŒå±‚åšä¸€ä¸ªæ‹·è´ï¼Œæ‰€ä»¥åœ¨ä¿®æ”¹é›†åˆä¸Šå±‚å…ƒç´ ä¸ä¼šå½±å“ä¸‹å±‚ã€‚åœ¨ java.util.concurrent ä¸‹çš„å¹¶å‘é›†åˆç±»éƒ½æ˜¯å®‰å…¨å¤±è´¥ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://www.codetool.top/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}]},{"title":"leetcode88-åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„","slug":"leetcode88-åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„","date":"2020-02-22T16:01:24.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode88-åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„/","link":"","permalink":"https://www.codetool.top/article/leetcode88-%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸¤ä¸ªæœ‰åºæ•´æ•°æ•°ç»„ nums1 å’Œ nums2 ï¼Œå°† nums2 åˆå¹¶åˆ° nums1 ä¸­ï¼Œä½¿å¾— num1 æˆä¸ºä¸€ä¸ªæœ‰åºæ•°ç»„ã€‚ è¯´æ˜ï¼š åˆå§‹åŒ– nums1 å’Œ nums2 çš„å…ƒç´ æ•°é‡åˆ†åˆ«ä¸º m å’Œ nã€‚ ä½ å¯ä»¥å‡è®¾ nums1 æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼ˆç©ºé—´å¤§å°å¤§äºæˆ–ç­‰äº m + n*ï¼‰æ¥ä¿å­˜ *nums2 ä¸­çš„å…ƒç´ ã€‚ ç¤ºä¾‹: è¾“å…¥ï¼šnums1 = [1,2,3,0,0,0], m = 3nums2 = [2,5,6], n = 3è¾“å‡ºï¼š [1,2,2,3,5,6] 2 è§£æ³•2.1 æ€æƒ³åŒæŒ‡é’ˆï¼Œå…ˆæŠŠç»“æœå†™åˆ°å¦ä¸€ä¸ªæ•°ç»„ï¼Œæœ€åå¤åˆ¶ç»™nums1 2.2 ä»£ç class Solution { public void merge(int[] nums1, int m, int[] nums2, int n) { if(nums2.length==0) return; int[] nums = new int[nums1.length]; int i = 0; int j = 0; int cur = 0; while(i&lt;=m-1||j&lt;=n-1){ if(j!=n&amp;&amp;(i==m||nums1[i]>=nums2[j])) nums[cur++] = nums2[j++]; else nums[cur++] = nums1[i++]; } for(int a = 0; a &lt; nums1.length;a++){ nums1[a] = nums[a]; } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode63-ä¸åŒè·¯å¾„II","slug":"leetcode63-ä¸åŒè·¯å¾„II","date":"2020-02-22T15:09:03.000Z","updated":"2020-04-22T09:27:27.142Z","comments":true,"path":"article/leetcode63-ä¸åŒè·¯å¾„II/","link":"","permalink":"https://www.codetool.top/article/leetcode63-%E4%B8%8D%E5%90%8C%E8%B7%AF%E5%BE%84II/","excerpt":"","text":"1 åŸé¢˜ä¸€ä¸ªæœºå™¨äººä½äºä¸€ä¸ª m x n ç½‘æ ¼çš„å·¦ä¸Šè§’ ï¼ˆèµ·å§‹ç‚¹åœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œStartâ€ ï¼‰ã€‚ æœºå™¨äººæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚æœºå™¨äººè¯•å›¾è¾¾åˆ°ç½‘æ ¼çš„å³ä¸‹è§’ï¼ˆåœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œFinishâ€ï¼‰ã€‚ ç°åœ¨è€ƒè™‘ç½‘æ ¼ä¸­æœ‰éšœç¢ç‰©ã€‚é‚£ä¹ˆä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’å°†ä¼šæœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ ç½‘æ ¼ä¸­çš„éšœç¢ç‰©å’Œç©ºä½ç½®åˆ†åˆ«ç”¨ 1 å’Œ 0 æ¥è¡¨ç¤ºã€‚ è¯´æ˜ï¼š m å’Œ n çš„å€¼å‡ä¸è¶…è¿‡ 100ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š[ [0,0,0], [0,1,0], [0,0,0]]è¾“å‡ºï¼š 2è§£é‡Šï¼š3x3 ç½‘æ ¼çš„æ­£ä¸­é—´æœ‰ä¸€ä¸ªéšœç¢ç‰©ã€‚ä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’ä¸€å…±æœ‰ 2 æ¡ä¸åŒçš„è·¯å¾„ï¼š1. å‘å³ -&gt; å‘å³ -&gt; å‘ä¸‹ -&gt; å‘ä¸‹2. å‘ä¸‹ -&gt; å‘ä¸‹ -&gt; å‘å³ -&gt; å‘å³ 2 è§£æ³•2.1 æ€æƒ³å’Œleetcode62-ä¸åŒè·¯å¾„ç±»ä¼¼ï¼Œå¯ä»¥ä½¿ç”¨é€’å½’+è®°å¿†ï¼Œæ¯ä¸ªä½ç½®çš„è·¯å¾„æ•°ä¸ºå³è¾¹ä½ç½®çš„è·¯å¾„æ•°å’Œä¸‹é¢ä½ç½®çš„è·¯å¾„æ•°ä¹‹å’Œï¼Œæœ‰éšœç¢çš„ç‚¹çš„è·¯å¾„æ•°ä¸º0ã€‚ 2.2 ä»£ç class Solution { int[][] grid; Integer[][] paths; int length; int height; public int uniquePathsWithObstacles(int[][] obstacleGrid) { grid = obstacleGrid; if(grid.length==0||grid[0].length==0) return 0; height = grid.length; length = grid[0].length; paths = new Integer[height][length]; return getPaths(0,0); } public int getPaths(int m,int n){ if(m==height||n==length) return 0; if(grid[m][n]==1) return 0; if(m == height-1 &amp;&amp; n==length-1) return 1; if(paths[m][n] != null) return paths[m][n]; int ans = getPaths(m+1,n)+getPaths(m,n+1); paths[m][n] = ans; return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ•°æ®åº“ç†è®ºä¹‹äº‹åŠ¡ä¸æ¢å¤æŠ€æœ¯","slug":"æ•°æ®åº“ç†è®ºä¹‹äº‹åŠ¡ä¸æ¢å¤æŠ€æœ¯","date":"2020-02-22T14:43:45.000Z","updated":"2020-03-25T04:37:38.168Z","comments":true,"path":"article/æ•°æ®åº“ç†è®ºä¹‹äº‹åŠ¡ä¸æ¢å¤æŠ€æœ¯/","link":"","permalink":"https://www.codetool.top/article/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%90%86%E8%AE%BA%E4%B9%8B%E4%BA%8B%E5%8A%A1%E4%B8%8E%E6%81%A2%E5%A4%8D%E6%8A%80%E6%9C%AF/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿäº‹åŠ¡çš„å››ä¸ªç‰¹æ€§ã€ä¸è€ƒè™‘éš”ç¦»ä¼šå¯¼è‡´çš„ä¸‰ä¸ªé—®é¢˜ä»¥åŠå››ç§éš”ç¦»çº§åˆ«_æ•°æ®åº“_cd546566850çš„åšå®¢-CSDNåšå®¢ 1 åŸºæœ¬æ¦‚å¿µäº‹åŠ¡ï¼šæ˜¯ç”¨æˆ·å®šä¹‰çš„ä¸€ä¸ªæ•°æ®åº“æ“ä½œåºåˆ— ï¼Œè¿™äº›æ“ä½œè¦ä¹ˆå…¨åšï¼Œè¦ä¹ˆå…¨ä¸åšï¼Œæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ã€‚ åœ¨å…³ç³»æ•°æ®åº“ä¸­ï¼Œä¸€ä¸ªäº‹åŠ¡å¯ä»¥æ˜¯ä¸€æ¡æˆ–å¤šæ¡ SQL è¯­å¥, ä¹Ÿå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç¨‹åºã€‚ä¸€ä¸ªç¨‹åºé€šå¸¸åŒ…å«å¤šä¸ªäº‹åŠ¡ æ˜¾å¼å®šä¹‰æ–¹å¼ï¼š begin transaction .... commit/rollback éšå¼æ–¹å¼ï¼š å½“ç”¨æˆ·æ²¡æœ‰æ˜¾å¼åœ°å®šä¹‰äº‹åŠ¡æ—¶ï¼ŒDBMS æŒ‰ç¼ºçœè§„å®šè‡ªåŠ¨åˆ’åˆ†äº‹åŠ¡ï¼ˆä¸€å¥SQLè¯­å¥ä¸€ä¸ªäº‹åŠ¡ï¼‰ AutoCommit äº‹åŠ¡æ˜¯ SQL Server é»˜è®¤äº‹åŠ¡æ–¹å¼, 2 äº‹åŠ¡çš„ç‰¹æ€§ACID åŸå­æ€§ï¼ˆatomicityï¼‰ï¼š ä¸€ä¸ªäº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­åŒ…æ‹¬çš„è¯¸æ“ä½œè¦ä¹ˆéƒ½åšï¼Œè¦ä¹ˆéƒ½ä¸åšï¼› ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰ï¼š äº‹åŠ¡å¿…é¡»ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜æˆå¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚ éš”ç¦»æ€§ï¼ˆisolationï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡å¹²æ‰°ã€‚ æŒç»­æ€§ï¼ˆdurabilityï¼‰ï¼š ä¹Ÿç§°æ°¸ä¹…æ€§ï¼ŒæŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å°±åº”è¯¥æ˜¯æ°¸ä¹…æ€§çš„ã€‚ 2.1 ä¸è€ƒè™‘éš”ç¦»æ€§ä¼šå¯¼è‡´çš„ä¸‰ä¸ªé—®é¢˜ è„è¯»ï¼šè„è¯»æ˜¯æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å¤„ç†è¿‡ç¨‹é‡Œè¯»å–äº†å¦ä¸€ä¸ªæœªæäº¤çš„äº‹åŠ¡ä¸­çš„æ•°æ®ã€‚ ä¸å¯é‡å¤è¯»ï¼šä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»å–åŒä¸€è¡Œçš„æ•°æ®ï¼Œç»“æœå¾—åˆ°ä¸åŒçŠ¶æ€çš„ç»“æœï¼Œä¸­é—´æ­£å¥½å¦ä¸€ä¸ªäº‹åŠ¡æ›´æ–°äº†è¯¥æ•°æ®ï¼Œä¸¤æ¬¡ç»“æœç›¸å¼‚ï¼Œä¸å¯è¢«ä¿¡ä»»ã€‚é€šä¿—æ¥è®²å°±æ˜¯ï¼šäº‹åŠ¡T1åœ¨è¯»å–æŸä¸€æ•°æ®ï¼Œè€Œäº‹åŠ¡T2ç«‹é©¬ä¿®æ”¹äº†è¿™ä¸ªæ•°æ®å¹¶ä¸”æäº¤äº‹åŠ¡ç»™æ•°æ®åº“ï¼Œäº‹åŠ¡T1å†æ¬¡è¯»å–è¯¥æ•°æ®å°±å¾—åˆ°äº†ä¸åŒçš„ç»“æœï¼Œå‘é€äº†ä¸å¯é‡å¤è¯»ã€‚ å¹»è¯»ï¼ˆè™šè¯»ï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œä¸¤æ¬¡æŸ¥è¯¢ï¼Œç¬¬äºŒæ¬¡ç»“æœé›†åŒ…å«ç¬¬ä¸€æ¬¡ä¸­æ²¡æœ‰æˆ–æŸäº›è¡Œå·²ç»è¢«åˆ é™¤çš„æ•°æ®ï¼Œé€ æˆä¸¤æ¬¡ç»“æœä¸ä¸€è‡´ï¼Œåªæ˜¯å¦ä¸€ä¸ªäº‹åŠ¡åœ¨è¿™ä¸¤æ¬¡æŸ¥è¯¢ä¸­é—´æ’å…¥æˆ–åˆ é™¤äº†æ•°æ®é€ æˆçš„ã€‚é€šä¿—æ¥è®²å°±æ˜¯ï¼šä¾‹å¦‚äº‹åŠ¡T1å¯¹ä¸€ä¸ªè¡¨ä¸­æ‰€æœ‰çš„è¡Œçš„æŸä¸ªæ•°æ®é¡¹åšäº†ä»â€œ1â€ä¿®æ”¹ä¸ºâ€œ2â€çš„æ“ä½œï¼Œè¿™æ—¶äº‹åŠ¡T2åˆå¯¹è¿™ä¸ªè¡¨ä¸­æ’å…¥äº†ä¸€è¡Œæ•°æ®é¡¹ï¼Œè€Œè¿™ä¸ªæ•°æ®é¡¹çš„æ•°å€¼è¿˜æ˜¯ä¸ºâ€œ1â€å¹¶ä¸”æäº¤ç»™æ•°æ®åº“ã€‚è€Œæ“ä½œäº‹åŠ¡T1çš„ç”¨æˆ·å¦‚æœå†æŸ¥çœ‹åˆšåˆšä¿®æ”¹çš„æ•°æ®ï¼Œä¼šå‘ç°è¿˜æœ‰ä¸€è¡Œæ²¡æœ‰ä¿®æ”¹ï¼Œå…¶å®è¿™è¡Œæ˜¯ä»äº‹åŠ¡T2ä¸­æ·»åŠ çš„ï¼Œå°±å¥½åƒäº§ç”Ÿå¹»è§‰ä¸€æ ·ï¼Œè¿™å°±æ˜¯å‘ç”Ÿäº†å¹»è¯» 2.2 è§£å†³åŠæ³•ï¼ˆå››ç§éš”ç¦»çº§åˆ«ï¼‰ Read Uncommitedï¼ˆè¯»å–æœªæäº¤å†…å®¹ï¼‰ è¯»æœªæäº¤ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸€ä¸ªäº‹åŠ¡å¯ä»¥è¯»å–å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡çš„æ•°æ®ã€‚ä½†æ˜¯ï¼Œè¯»æœªæäº¤äº§ç”Ÿäº†è„è¯»ï¼Œé‡‡ç”¨è¯»æäº¤å¯ä»¥è§£å†³è„è¯»é—®é¢˜ã€‚ Read Commitedï¼ˆè¯»å–æäº¤å†…å®¹ï¼‰ è¯»æäº¤ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸€ä¸ªäº‹åŠ¡è¦ç­‰å¦ä¸€ä¸ªäº‹åŠ¡æäº¤åæ‰èƒ½è¯»å–æ•°æ®ã€‚ è¯»æäº¤ï¼Œè‹¥æœ‰äº‹åŠ¡å¯¹æ•°æ®è¿›è¡Œæ›´æ–°ï¼ˆUPDATEï¼‰æ“ä½œæ—¶ï¼Œè¯»æ“ä½œäº‹åŠ¡è¦ç­‰å¾…è¿™ä¸ªæ›´æ–°æ“ä½œäº‹åŠ¡æäº¤åæ‰èƒ½è¯»å–æ•°æ®ï¼Œå¯ä»¥è§£å†³è„è¯»é—®é¢˜ã€‚ä½†æ˜¯ï¼Œè¯»æäº¤ä¸¤æ¬¡æŸ¥è¯¢ä¼šäº§ç”Ÿä¸åŒçš„æŸ¥è¯¢ç»“æœï¼Œå°±ä¼šé€ æˆä¸å¯é‡å¤è¯»é—®é¢˜ï¼Œé‡‡ç”¨é‡å¤è¯»å¯ä»¥è§£å†³æ­¤é—®é¢˜ã€‚ Repeatable Readï¼ˆé‡å¤è¯»ï¼‰ é‡å¤è¯»ï¼Œå°±æ˜¯åœ¨å¼€å§‹è¯»å–æ•°æ®ï¼ˆäº‹åŠ¡å¼€å¯ï¼‰æ—¶ï¼Œä¸å†å…è®¸ä¿®æ”¹æ“ä½œã€‚é‡å¤è¯»å¯ä»¥è§£å†³ä¸å¯é‡å¤è¯»é—®é¢˜ã€‚åº”è¯¥æ˜ç™½çš„ä¸€ç‚¹å°±æ˜¯ï¼Œä¸å¯é‡å¤è¯»å¯¹åº”çš„æ˜¯ä¿®æ”¹ï¼Œå³UPDATEæ“ä½œã€‚ä½†æ˜¯å¯èƒ½è¿˜ä¼šæœ‰å¹»è¯»é—®é¢˜ã€‚å› ä¸ºå¹»è¯»é—®é¢˜å¯¹åº”çš„æ˜¯æ’å…¥INSERTæ“ä½œï¼Œè€Œä¸æ˜¯UPDATEæ“ä½œã€‚é‡‡ç”¨Serializableå¯ä»¥è§£å†³å¹»è¯»é—®é¢˜ Serializableï¼ˆå¯ä¸²è¡ŒåŒ–ï¼‰ Serializable æ˜¯æœ€é«˜çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œåœ¨è¯¥çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡ä¸²è¡ŒåŒ–é¡ºåºæ‰§è¡Œï¼Œå¯ä»¥é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»ä¸å¹»è¯»ã€‚ä½†æ˜¯è¿™ç§äº‹åŠ¡éš”ç¦»çº§åˆ«æ•ˆç‡ä½ä¸‹ï¼Œæ¯”è¾ƒè€—æ•°æ®åº“æ€§èƒ½ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ã€‚ æ³¨æ„ å¤§å¤šæ•°æ•°æ®åº“é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯Read committedï¼Œæ¯”å¦‚Sql Server, Oracleã€‚Mysqlçš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯Repeatable readï¼Œåªä¼šå‡ºç°å¹»è¯»ã€‚ éš”ç¦»çº§åˆ«çš„è®¾ç½®åªå¯¹å½“å‰é“¾æ¥æœ‰æ•ˆã€‚å¯¹äºä½¿ç”¨MySQLå‘½ä»¤çª—å£è€Œè¨€ï¼Œä¸€ä¸ªçª—å£å°±ç›¸å½“äºä¸€ä¸ªé“¾æ¥ï¼Œå½“å‰çª—å£è®¾ç½®çš„éš”ç¦»çº§åˆ«åªå¯¹å½“å‰çª—å£ä¸­çš„äº‹åŠ¡æœ‰æ•ˆï¼›å¯¹äºJDBCæ“ä½œæ•°æ®åº“æ¥è¯´ï¼Œä¸€ä¸ªConnectionå¯¹è±¡ç›¸å½“äºä¸€ä¸ªé“¾æ¥ï¼Œè€Œå¯¹äºConnectionå¯¹è±¡è®¾ç½®çš„éš”ç¦»çº§åˆ«åªå¯¹è¯¥Connectionå¯¹è±¡æœ‰æ•ˆï¼Œä¸å…¶ä»–é“¾æ¥Connectionå¯¹è±¡æ— å…³ã€‚ è®¾ç½®æ•°æ®åº“çš„éš”ç¦»çº§åˆ«ä¸€å®šè¦æ˜¯åœ¨å¼€å¯äº‹åŠ¡ä¹‹å‰ã€‚ 3 æ•°æ®åº“æ¢å¤æŠ€æœ¯æ•…éšœæ˜¯ä¸å¯é¿å…çš„ï¼š ç³»ç»Ÿæ•…éšœï¼šè®¡ç®—æœºè½¯ã€ç¡¬ä»¶æ•…éšœ äººä¸ºæ•…éšœï¼šæ“ä½œå‘˜çš„å¤±è¯¯ã€æ¶æ„çš„ç ´åç­‰ã€‚ æ•°æ®åº“çš„æ¢å¤ï¼š æŠŠæ•°æ®åº“ä»é”™è¯¯çŠ¶æ€æ¢å¤åˆ°æŸä¸€å·²çŸ¥çš„æ­£ç¡®çŠ¶æ€ï¼ˆäº¦ç§°ä¸ºä¸€è‡´çŠ¶æ€æˆ–å®Œæ•´çŠ¶æ€ï¼‰ 3.1 æ•…éšœçš„ç§ç±»äº‹åŠ¡å†…éƒ¨çš„æ•…éšœ ï¼š æœ‰çš„æ˜¯å¯ä»¥é€šè¿‡äº‹åŠ¡ç¨‹åºæœ¬èº«å‘ç°çš„ æœ‰çš„ æ˜¯éé¢„æœŸçš„ï¼Œä¸èƒ½ç”±åº”ç”¨ç¨‹åºå¤„ç†ï¼ˆå¦‚è¿ç®—æº¢å‡ºã€æ­»é”ç­‰ï¼‰ åé¢ï¼Œäº‹åŠ¡æ•…éšœä»…æŒ‡éé¢„æœŸçš„æ•…éšœ äº‹åŠ¡æ•…éšœçš„æ¢å¤ï¼šUNDO æ’¤é”€ ç³»ç»Ÿæ•…éšœï¼š é€ æˆç³»ç»Ÿåœæ­¢è¿è½¬çš„ä»»ä½•äº‹ä»¶ï¼Œä½¿å¾—ç³»ç»Ÿè¦é‡æ–°å¯åŠ¨ã€‚ï¼ˆç¡¬ä»¶é”™è¯¯ã€æ–­ç”µç­‰ï¼‰ å½±å“æ­£åœ¨è¿è¡Œçš„æ‰€æœ‰äº‹åŠ¡ï¼Œä½†ä¸ç ´åæ•°æ®åº“ã€‚æ­¤æ—¶å†…å­˜ï¼Œå°¤å…¶æ˜¯æ•°æ®åº“ç¼“å†²åŒºä¸­çš„å†…å®¹å…¨éƒ¨ä¸¢å¤±ï¼Œæ‰€æœ‰è¿è¡Œäº‹åŠ¡éæ­£å¸¸ç»ˆæ­¢ã€‚ æ¢å¤ï¼š æœªæäº¤çš„äº‹åŠ¡ï¼šUNDO æ’¤é”€æ‰€æœ‰æœªå®Œæˆçš„äº‹åŠ¡ å·²æäº¤çš„äº‹åŠ¡ï¼Œä½†ç¼“å†²åŒºå†…å®¹æœªå®Œå…¨å†™å…¥ç£ç›˜ï¼šREDO é‡åšæ‰€æœ‰å·²æäº¤çš„äº‹åŠ¡ ä»‹è´¨æ•…éšœï¼š ç³»ç»Ÿæ•…éšœç§°ä¸ºè½¯æ•…éšœï¼Œä»‹è´¨æ•…éšœç§°ä¸ºç¡¬æ•…éšœï¼ˆå¤–å­˜æ•…éšœï¼Œå¦‚ç£ç›˜æŸåï¼‰ æ¢å¤ï¼šè£…å…¥æ•°æ®åº“å‘ç”Ÿä»‹è´¨æ•…éšœå‰æŸä¸ªæ—¶åˆ»çš„æ•°æ®å‰¯æœ¬ï¼ŒREDO è‡ªæ­¤æ—¶å¼€å§‹çš„æ‰€æœ‰æˆåŠŸäº‹åŠ¡ï¼Œå°†è¿™äº›äº‹åŠ¡å·²æäº¤çš„ç»“æœé‡æ–°å†™å…¥ è®¡ç®—æœºç—…æ¯’ï¼š è®¡ç®—æœºç—…æ¯’æ˜¯ä¸€ç§äººä¸ºçš„æ•…éšœæˆ–ç ´åï¼Œæ˜¯ä¸€äº›æ¶ä½œå‰§è€…ç ”åˆ¶çš„ä¸€ç§è®¡ç®—æœºç¨‹åºã€‚å¯ä»¥ç¹æ®–å’Œä¼ æ’­ï¼Œå¹¶é€ æˆå¯¹è®¡ç®—æœºç³»ç»ŸåŒ…æ‹¬æ•°æ®åº“çš„å±å®³ã€‚ æ€»ä¹‹ï¼š å„ç±»æ•…éšœï¼Œå¯¹æ•°æ®åº“çš„å½±å“æœ‰ä¸¤ç§å¯èƒ½æ€§ ä¸€æ˜¯æ•°æ®åº“æœ¬èº«è¢«ç ´å äºŒæ˜¯æ•°æ®åº“æ²¡æœ‰è¢«ç ´åï¼Œä½†æ•°æ®å¯èƒ½ä¸æ­£ç¡®ï¼Œè¿™æ˜¯ç”±äºäº‹åŠ¡çš„è¿è¡Œè¢«éæ­£å¸¸ç»ˆæ­¢é€ æˆçš„ã€‚ 3.2 æ¢å¤çš„å®ç°æŠ€æœ¯æ¢å¤æ“ä½œçš„åŸºæœ¬åŸç†ï¼šå†—ä½™ æ¢å¤æœºåˆ¶æ¶‰åŠçš„ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼š å¦‚ä½•å»ºç«‹å†—ä½™æ•°æ® æ•°æ®è½¬å‚¨ (backup) æ—¥å¿—æ–‡ä»¶ (logging) å¦‚ä½•åˆ©ç”¨è¿™äº›å†—ä½™æ•°æ®å®æ–½æ•°æ®åº“æ¢å¤ 3.2.1 æ•°æ®è½¬å‚¨è½¬å‚¨æ˜¯æŒ‡ DBA å°†æ•´ä¸ªæ•°æ®åº“å¤åˆ¶åˆ°å…¶ä»–å­˜å‚¨ä»‹è´¨ä¸Šä¿å­˜èµ·æ¥çš„è¿‡ç¨‹ï¼Œå¤‡ç”¨çš„æ•°æ®ç§°ä¸ºåå¤‡å‰¯æœ¬æˆ–åæ´å‰¯æœ¬ æ•°æ®åº“é­åˆ°ç ´ååå¯ä»¥å°†åå¤‡å‰¯æœ¬é‡æ–°è£…å…¥ é‡è£…åå¤‡å‰¯æœ¬åªèƒ½å°†æ•°æ®åº“æ¢å¤åˆ°è½¬å‚¨æ—¶çš„çŠ¶æ€ è½¬å‚¨æ–¹å¼ï¼š æŒ‰ä¸åŒçš„åˆ’åˆ†æ–¹æ³•å¯ä»¥åˆ’åˆ†ä¸ºé™æ€/åŠ¨æ€è½¬å‚¨æˆ–æµ·é‡/å¢é‡è½¬å‚¨ 3.2.1.1 é™æ€è½¬å‚¨ï¼š å®šä¹‰ï¼šåœ¨ç³»ç»Ÿä¸­æ— äº‹åŠ¡è¿è¡Œæ—¶è¿›è¡Œçš„è½¬å‚¨æ“ä½œã€‚ è½¬å‚¨å¼€å§‹çš„æ—¶åˆ»æ•°æ®åº“å¤„äºä¸€è‡´æ€§çŠ¶æ€ï¼Œè€Œè½¬å‚¨ä¸å…è®¸å¯¹æ•°æ®åº“çš„ä»»ä½•å­˜å–ã€ä¿®æ”¹æ´»åŠ¨ã€‚é™æ€è½¬å‚¨å¾—åˆ°çš„ä¸€å®šæ˜¯ä¸€ä¸ªæ•°æ®ä¸€è‡´æ€§çš„å‰¯æœ¬ã€‚ ä¼˜ç‚¹ï¼šå®ç°ç®€å• ç¼ºç‚¹ï¼šé™ä½äº†æ•°æ®åº“çš„å¯ç”¨æ€§ è½¬å‚¨å¿…é¡»ç­‰å¾…æ­£è¿è¡Œçš„ç”¨æˆ·äº‹åŠ¡ç»“æŸæ‰èƒ½è¿›è¡Œï¼›æ–°çš„äº‹åŠ¡å¿…é¡»ç­‰å¾…è½¬å‚¨ç»“æŸæ‰èƒ½æ‰§è¡Œ 3.2.1.2 åŠ¨æ€è½¬å‚¨ï¼š å®šä¹‰ï¼šè½¬å‚¨æœŸé—´å…è®¸å¯¹æ•°æ®åº“è¿›è¡Œå­˜å–æˆ–ä¿®æ”¹ã€‚è½¬å‚¨å’Œç”¨æˆ·äº‹åŠ¡å¯ä»¥å¹¶å‘æ‰§è¡Œ ã€‚ ä¼˜ç‚¹ï¼šä¸ç”¨ç­‰å¾…æ­£åœ¨è¿è¡Œçš„ç”¨æˆ·äº‹åŠ¡ç»“æŸï¼›ä¸ä¼šå½±å“æ–°äº‹åŠ¡çš„è¿è¡Œã€‚ å®ç°ï¼šå¿…é¡»æŠŠè½¬å‚¨æœŸé—´å„äº‹åŠ¡å¯¹æ•°æ®åº“çš„ä¿®æ”¹æ´»åŠ¨ç™»è®°ä¸‹æ¥ï¼Œå»ºç«‹æ—¥å¿—æ–‡ä»¶åå¤‡å‰¯æœ¬åŠ ä¸Šæ—¥å¿—æ–‡ä»¶å°±èƒ½æŠŠæ•°æ®åº“æ¢å¤åˆ°æŸä¸€æ—¶åˆ»çš„æ­£ç¡®çŠ¶æ€ ã€‚ 3.2.1.3 æµ·é‡è½¬å‚¨ï¼š å®šä¹‰ï¼šæ¯æ¬¡è½¬å‚¨å…¨éƒ¨æ•°æ®åº“ ç‰¹ç‚¹ï¼šä»æ¢å¤è§’åº¦ï¼Œä½¿ç”¨æµ·é‡è½¬å‚¨å¾—åˆ°çš„åå¤‡å‰¯æœ¬è¿›è¡Œæ¢å¤æ›´æ–¹ä¾¿ä¸€äº›ã€‚ 3.2.1.4 å¢é‡è½¬å‚¨ï¼š å®šä¹‰ï¼šæ¯æ¬¡åªè½¬å‚¨ä¸Šä¸€æ¬¡è½¬å‚¨åæ›´æ–°è¿‡çš„æ•°æ® ç‰¹ç‚¹ï¼šå¦‚æœæ•°æ®åº“å¾ˆå¤§ï¼Œäº‹åŠ¡å¤„ç†åˆååˆ†é¢‘ç¹ï¼Œåˆ™å¢é‡è½¬å‚¨æ–¹å¼æ›´å®ç”¨æ›´æœ‰æ•ˆ 3.2.2 æ—¥å¿—æ–‡ä»¶æ—¥å¿—æ–‡ä»¶(log)æ˜¯ç”¨æ¥è®°å½•äº‹åŠ¡å¯¹æ•°æ®åº“çš„æ›´æ–°æ“ä½œçš„æ–‡ä»¶ã€‚ æ—¥å¿—æ–‡ä»¶çš„æ ¼å¼ï¼š ä»¥è®°å½•ä¸ºå•ä½ï¼š æ—¥å¿—æ–‡ä»¶ä¸­éœ€è¦ç™»è®°çš„å†…å®¹åŒ…æ‹¬ï¼š å„ä¸ªäº‹åŠ¡çš„å¼€å§‹æ ‡è®°(BEGIN TRANSACTION) å„ä¸ªäº‹åŠ¡çš„ç»“æŸæ ‡è®°(COMMIT æˆ– æˆ– ROLLBACK) å„ä¸ªäº‹åŠ¡çš„æ‰€æœ‰æ›´æ–°æ“ä½œä»¥ä¸Šå‡ä½œä¸ºæ—¥å¿—æ–‡ä»¶ä¸­çš„ä¸€ä¸ªæ—¥å¿—è®°å½• æ¯ä¸ªæ—¥å¿—è®°å½•çš„å†…å®¹ï¼š äº‹åŠ¡æ ‡è¯†ï¼ˆæ ‡æ˜æ˜¯å“ªä¸ªäº‹åŠ¡ï¼‰ æ“ä½œç±»å‹ï¼ˆæ’å…¥ã€åˆ é™¤æˆ–ä¿®æ”¹ï¼‰ æ“ä½œå¯¹è±¡ï¼ˆè®°å½•å†…éƒ¨æ ‡è¯†ï¼‰ æ›´æ–°å‰æ•°æ®çš„æ—§å€¼ï¼ˆå¯¹æ’å…¥æ“ä½œè€Œè¨€ï¼Œæ­¤é¡¹ä¸ºç©ºå€¼ï¼‰ æ›´æ–°åæ•°æ®çš„æ–°å€¼ï¼ˆå¯¹åˆ é™¤æ“ä½œè€Œè¨€, æ­¤é¡¹ä¸ºç©ºå€¼ï¼‰ ä»¥æ•°æ®å—ä¸ºå•ä½ æ—¥å¿—è®°å½•å†…å®¹åŒ…æ‹¬ï¼š äº‹åŠ¡æ ‡è¯†ï¼ˆæ ‡æ˜æ˜¯å“ªä¸ªäº‹åŠ¡ï¼‰ è¢«æ›´æ–°çš„æ•°æ®å— æ—¥å¿—æ–‡ä»¶çš„ä½œç”¨ï¼š è¿›è¡Œäº‹åŠ¡æ•…éšœæ¢å¤ è¿›è¡Œç³»ç»Ÿæ•…éšœæ¢å¤ ååŠ©åå¤‡å‰¯æœ¬è¿›è¡Œä»‹è´¨æ•…éšœæ¢å¤ äº‹åŠ¡æ•…éšœæ¢å¤å’Œç³»ç»Ÿæ•…éšœæ¢å¤å¿…é¡»ç”¨æ—¥å¿—æ–‡ä»¶ åœ¨åŠ¨æ€è½¬å‚¨æ–¹å¼ä¸­å¿…é¡»å»ºç«‹æ—¥å¿—æ–‡ä»¶ï¼Œåå¤‡å‰¯æœ¬å’Œæ—¥å¿—æ–‡ä»¶ç»“åˆèµ·æ¥æ‰èƒ½æœ‰æ•ˆåœ°æ¢å¤æ•°æ®åº“ é™æ€è½¬å‚¨æ–¹å¼ä¸­ä¹Ÿå¯ä»¥å»ºç«‹æ—¥å¿—æ–‡ä»¶ï¼ˆé‡æ–°è£…å…¥åå¤‡å‰¯æœ¬ï¼Œç„¶ååˆ©ç”¨æ—¥å¿—æ–‡ä»¶æŠŠå·²å®Œæˆçš„äº‹åŠ¡è¿›è¡Œé‡åšï¼Œå¯¹æœªå®Œæˆäº‹åŠ¡è¿›è¡Œæ’¤é”€ï¼‰ ç™»è®°æ—¥å¿—æ–‡ä»¶çš„åŸºæœ¬åŸåˆ™ï¼š ç™»è®°çš„æ¬¡åºä¸¥æ ¼æŒ‰å¹¶è¡Œäº‹åŠ¡æ‰§è¡Œçš„æ—¶é—´æ¬¡åº å¿…é¡»å…ˆå†™æ—¥å¿—æ–‡ä»¶ï¼Œåå†™æ•°æ®åº“ (åªè¦æ²¡æœ‰è®°å½•äº‹åŠ¡çš„ç»“æŸæ ‡è®°ï¼Œå°±ç®—å¤šè®°å½•äº†ä¸€æ¡å®é™…æ²¡æœ‰æ‰§è¡Œçš„è¯­å¥ï¼Œæ¢å¤ä¹‹åä¹Ÿä¼šå›æ»š) 3.3 æ¢å¤ç­–ç•¥3.3.1 äº‹åŠ¡æ•…éšœçš„æ¢å¤äº‹åŠ¡æ•…éšœï¼šäº‹åŠ¡åœ¨è¿è¡Œè‡³æ­£å¸¸ç»ˆæ­¢ç‚¹å‰è¢«ç»ˆæ­¢ æ¢å¤æ–¹æ³•ï¼šç”±æ¢å¤å­ç³»ç»Ÿåº”åˆ©ç”¨æ—¥å¿—æ–‡ä»¶æ’¤æ¶ˆï¼ˆUNDOï¼‰æ­¤äº‹åŠ¡å·²å¯¹æ•°æ®åº“è¿›è¡Œçš„ä¿®æ”¹ äº‹åŠ¡æ•…éšœçš„æ¢å¤ç”±ç³»ç»Ÿè‡ªåŠ¨å®Œæˆï¼Œå¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ï¼Œä¸éœ€è¦ç”¨æˆ·å¹²é¢„ äº‹åŠ¡æ•…éšœçš„æ¢å¤æ­¥éª¤ï¼š åå‘æ‰«ææ–‡ä»¶æ—¥å¿—ï¼ŒæŸ¥æ‰¾è¯¥äº‹åŠ¡çš„æ›´æ–°æ“ä½œã€‚ å¯¹è¯¥äº‹åŠ¡çš„æ›´æ–°æ“ä½œæ‰§è¡Œé€†æ“ä½œã€‚å³å°†æ—¥å¿—è®°å½•ä¸­ â€œ æ›´æ–°å‰çš„å€¼â€ â€ å†™å…¥æ•°æ®åº“ ã€‚ æ’å…¥æ“ä½œï¼Œâ€œæ›´æ–°å‰çš„å€¼â€ ä¸ºç©ºï¼Œåˆ™ç›¸å½“äºåšåˆ é™¤æ“ä½œ åˆ é™¤æ“ä½œï¼Œâ€œæ›´æ–°åçš„å€¼â€ ä¸ºç©ºï¼Œåˆ™ç›¸å½“äºåšæ’å…¥æ“ä½œ è‹¥æ˜¯ä¿®æ”¹æ“ä½œï¼Œåˆ™ç›¸å½“äºç”¨ä¿®æ”¹å‰å€¼ä»£æ›¿ä¿®æ”¹åå€¼ ç»§ç»­åå‘æ‰«ææ—¥å¿—æ–‡ä»¶ï¼ŒæŸ¥æ‰¾è¯¥äº‹åŠ¡çš„å…¶ä»–æ›´æ–°æ“ä½œï¼Œå¹¶åšåŒæ ·å¤„ç†ã€‚ å¦‚æ­¤å¤„ç†ä¸‹å»ï¼Œç›´è‡³è¯»åˆ°æ­¤äº‹åŠ¡çš„å¼€å§‹æ ‡è®°ï¼Œäº‹åŠ¡æ•…éšœæ¢å¤å°±å®Œæˆäº†ã€‚ 3.3.2 ç³»ç»Ÿæ•…éšœçš„æ¢å¤ç³»ç»Ÿæ•…éšœå¯èƒ½å¯¼è‡´æœªå®Œæˆäº‹åŠ¡å¯¹æ•°æ®åº“çš„æ›´æ–°å·²å†™å…¥æ•°æ®åº“ï¼Œæˆ–å·²æäº¤äº‹åŠ¡å¯¹æ•°æ®åº“çš„æ›´æ–°è¿˜ç•™åœ¨ç¼“å†²åŒºæ²¡æ¥å¾—åŠå†™å…¥æ•°æ®åº“ï¼Œåªéœ€è¦åšå¯¹åº”çš„UNDOæˆ–REDOæ“ä½œã€‚ 3.3.3 ä»‹è´¨æ•…éšœçš„æ¢å¤ é‡è£…æ•°æ®åº“ è£…å…¥æœ€æ–°çš„åå¤‡å‰¯æœ¬ï¼Œä½¿æ•°æ®åº“æ¢å¤åˆ°æœ€è¿‘ä¸€æ¬¡è½¬å‚¨æ—¶çš„ä¸€è‡´æ€§çŠ¶æ€ï¼ˆåˆ†ä¸ºé™æ€è½¬å‚¨çš„å‰¯æœ¬å’ŒåŠ¨æ€è½¬å‚¨çš„å‰¯æœ¬ï¼ŒåŠ¨æ€è½¬å‚¨çš„å‰¯æœ¬è¿˜éœ€é…åˆæ—¥å¿—æ–‡ä»¶åšæ¢å¤ï¼‰ è£…å…¥æœ‰å…³çš„æ—¥å¿—æ–‡ä»¶å‰¯æœ¬ï¼Œé‡åšå·²å®Œæˆçš„äº‹åŠ¡ ä»‹è´¨æ•…éšœçš„æ¢å¤éœ€è¦ DBA ä»‹å…¥ 3.3.4 å…·æœ‰æ£€æŸ¥ç‚¹çš„æ•°æ®æ¢å¤åˆ©ç”¨æ—¥å¿—æŠ€æœ¯è¿›è¡Œæ•°æ®åº“æ¢å¤å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š æœç´¢æ•´ä¸ªæ—¥å¿—å°†è€—è´¹å¤§é‡çš„æ—¶é—´ REDO å¤„ç†ï¼šäº‹åŠ¡å®é™…ä¸Šå·²ç»æ‰§è¡Œï¼Œåˆé‡æ–°æ‰§è¡Œï¼Œæµªè´¹äº†å¤§é‡æ—¶é—´ å…·æœ‰æ£€æŸ¥ç‚¹çš„æ•°æ®æ¢å¤æŠ€æœ¯åœ¨æ­£å¸¸å·¥ä½œæ—¶å‘¨æœŸæ€§åœ°æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼šå»ºç«‹æ£€æŸ¥ç‚¹ï¼Œä¿å­˜æ•°æ®åº“çŠ¶æ€ã€‚å…·ä½“æ­¥éª¤æ˜¯ï¼š å°†å½“å‰æ—¥å¿—ç¼“å†²åŒºä¸­çš„æ‰€æœ‰æ—¥å¿—è®°å½•å†™å…¥ç£ç›˜çš„æ—¥å¿—æ–‡ä»¶ä¸Š åœ¨æ—¥å¿—æ–‡ä»¶ä¸­å†™å…¥ä¸€ä¸ªæ£€æŸ¥ç‚¹è®°å½• å°†å½“å‰æ•°æ®ç¼“å†²åŒºçš„æ‰€æœ‰æ•°æ®è®°å½•å†™å…¥ç£ç›˜çš„æ•°æ®åº“ä¸­ æŠŠæ£€æŸ¥ç‚¹è®°å½•åœ¨æ—¥å¿—æ–‡ä»¶ä¸­çš„åœ°å€å†™å…¥ä¸€ä¸ªé‡æ–°å¼€å§‹æ–‡ä»¶ å½“äº‹åŠ¡ T åœ¨ä¸€ä¸ªæ£€æŸ¥ç‚¹ä¹‹å‰æäº¤ï¼ŒT å¯¹æ•°æ®åº“æ‰€åšçš„ä¿®æ”¹ä¸€å®šéƒ½å·²å†™å…¥æ•°æ®åº“","categories":[{"name":"é¡¹ç›®/ç¼–ç¨‹ç†è®º","slug":"é¡¹ç›®-ç¼–ç¨‹ç†è®º","permalink":"https://www.codetool.top/categories/%E9%A1%B9%E7%9B%AE-%E7%BC%96%E7%A8%8B%E7%90%86%E8%AE%BA/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"}]},{"title":"Mybatisä¸€çº§ç¼“å­˜ä¸äºŒçº§ç¼“å­˜","slug":"Mybatisä¸€çº§ç¼“å­˜ä¸äºŒçº§ç¼“å­˜","date":"2020-02-22T09:37:45.000Z","updated":"2020-02-22T10:34:20.768Z","comments":true,"path":"article/Mybatisä¸€çº§ç¼“å­˜ä¸äºŒçº§ç¼“å­˜/","link":"","permalink":"https://www.codetool.top/article/Mybatis%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98%E4%B8%8E%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š MyBatis äºŒçº§ç¼“å­˜å…¨è¯¦è§£ - cxuan - åšå®¢å›­ 1 ç¼“å­˜å­˜åœ¨äºå†…å­˜ä¸­çš„ä¸´æ—¶æ•°æ® å‡å°‘å’Œæ•°æ®åº“çš„äº¤äº’æ¬¡æ•°ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡ é€‚ç”¨äºç¼“å­˜çš„æ•°æ®ï¼š ç»å¸¸æŸ¥è¯¢å¹¶ä¸”ä¸ç»å¸¸æ”¹å˜ã€‚ æ•°æ®çš„æ­£ç¡®ä¸å¦å¯¹æœ€ç»ˆç»“æœå½±å“ä¸å¤§ 2 ä¸€çº§ç¼“å­˜2.1 æ¦‚è¿°Mybatisä¸­çš„ä¸€çº§ç¼“å­˜æŒ‡çš„æ˜¯SqlSessionçº§åˆ«çš„ç¼“å­˜ã€‚ ä¸€ä¸ªSqlSessionå¯¹è±¡é€šå¸¸è¡¨ç¤ºç”¨æˆ·å’ŒMybatiså»ºç«‹çš„ä¸€æ¬¡ä¼šè¯ï¼Œåœ¨è¿™ä¸ªä¼šè¯ä¸­ï¼Œé‡å¤æ‰§è¡Œå®Œå…¨ç›¸åŒçš„æŸ¥è¯¢è¯­å¥ä¸”ä¸å—å½±å“çš„æƒ…å†µä¸‹å°±ä¼šä½¿ç”¨ä¸€çº§ç¼“å­˜ã€‚ æ¯å½“ä¸€ä¸ªSqlSessionå¯¹è±¡åˆ›å»ºæ—¶ï¼Œå®ƒä¼šæŒæœ‰ä¸€ä¸ªExecutoræ‰§è¡Œå™¨ï¼Œç›´æ¥å’ŒConnectionæ‰“äº¤é“ï¼Œå½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡æ‰§è¡ŒæŸ¥è¯¢ä¹‹åï¼ŒæŸ¥è¯¢çš„ç»“æœä¼šåŒæ—¶å­˜å…¥åˆ°è¿™ä¸ªExecutoræ‰§è¡Œå™¨ä¸­çš„ä¸€å—åŒºåŸŸï¼š MyBatis å°†ç¼“å­˜å’Œå¯¹ç¼“å­˜ç›¸å…³çš„æ“ä½œå°è£…æˆäº† Cache æ¥å£ä¸­ï¼ŒExecutor æ¥å£çš„å®ç°ç±» BaseExecutor ä¸­æ‹¥æœ‰ä¸€ä¸ª Cache æ¥å£çš„å®ç°ç±» PerpetualCacheï¼Œåˆ™å¯¹äº BaseExecutor å¯¹è±¡è€Œè¨€ï¼Œå®ƒå°†ä½¿ç”¨ PerpetualCache å¯¹è±¡ç»´æŠ¤ç¼“å­˜ã€‚ PerpetualCache å®ç°åŸç†å…¶å®å¾ˆç®€å•ï¼Œå…¶å†…éƒ¨å°±æ˜¯é€šè¿‡ä¸€ä¸ªç®€å•çš„ HashMap&lt;k,v&gt; æ¥å®ç°çš„ï¼Œæ²¡æœ‰å…¶ä»–çš„ä»»ä½•é™åˆ¶ã€‚ 2.2 ç”Ÿå‘½å‘¨æœŸ MyBatis åœ¨å¼€å¯ä¸€ä¸ªæ•°æ®åº“ä¼šè¯æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ SqlSession å¯¹è±¡ï¼ŒSqlSession å¯¹è±¡ä¸­ä¼šæœ‰ä¸€ä¸ªæ–°çš„ Executor å¯¹è±¡ï¼ŒExecutor å¯¹è±¡ä¸­æŒæœ‰ä¸€ä¸ªæ–°çš„ PerpetualCache å¯¹è±¡ï¼›å½“ä¼šè¯ç»“æŸæ—¶ï¼ŒSqlSession å¯¹è±¡åŠå…¶å†…éƒ¨çš„ Executor å¯¹è±¡è¿˜æœ‰ PerpetualCache å¯¹è±¡ä¹Ÿä¸€å¹¶é‡Šæ”¾æ‰ã€‚ å¦‚æœ SqlSession è°ƒç”¨äº† close()æ–¹æ³•ï¼Œä¼šé‡Šæ”¾æ‰ä¸€çº§ç¼“å­˜ PerpetualCache å¯¹è±¡ï¼Œä¸€çº§ç¼“å­˜å°†ä¸å¯ç”¨ï¼› å¦‚æœ SqlSession è°ƒç”¨äº† clearCache()ï¼Œä¼šæ¸…ç©º PerpetualCache å¯¹è±¡ä¸­çš„æ•°æ®ï¼Œä½†æ˜¯è¯¥å¯¹è±¡ä»å¯ä½¿ç”¨ï¼› SqlSession ä¸­æ‰§è¡Œäº†ä»»ä½•ä¸€ä¸ª update æ“ä½œ(update()ã€delete()ã€insert()) ï¼Œéƒ½ä¼šæ¸…ç©ºPerpetualCache å¯¹è±¡çš„æ•°æ®ï¼Œä½†æ˜¯è¯¥å¯¹è±¡å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼› 2.3 å·¥ä½œæµç¨‹ å¯¹äºæŸä¸ªæŸ¥è¯¢ï¼Œæ ¹æ® statementId,params,rowBounds æ¥æ„å»ºä¸€ä¸ª key å€¼ï¼Œæ ¹æ®è¿™ä¸ª key å€¼å»ç¼“å­˜ Cache ä¸­å–å‡ºå¯¹åº”çš„ key å€¼å­˜å‚¨çš„ç¼“å­˜ç»“æœï¼› åˆ¤æ–­ä» Cache ä¸­æ ¹æ®ç‰¹å®šçš„ key å€¼å–çš„æ•°æ®æ•°æ®æ˜¯å¦ä¸ºç©ºï¼Œå³æ˜¯å¦å‘½ä¸­ï¼› å¦‚æœå‘½ä¸­ï¼Œåˆ™ç›´æ¥å°†ç¼“å­˜ç»“æœè¿”å›ï¼› å¦‚æœæ²¡å‘½ä¸­ï¼š å»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®ï¼Œå¾—åˆ°æŸ¥è¯¢ç»“æœï¼› å°† key å’ŒæŸ¥è¯¢åˆ°çš„ç»“æœåˆ†åˆ«ä½œä¸º key,value å¯¹å­˜å‚¨åˆ° Cache ä¸­ï¼› å°†æŸ¥è¯¢ç»“æœè¿”å›ï¼› ä¸€çº§ç¼“å­˜æ˜¯ä¸€ä¸ªç²—ç²’åº¦çš„ç¼“å­˜ï¼Œæ²¡æœ‰æ›´æ–°ç¼“å­˜å’Œç¼“å­˜è¿‡æœŸçš„æ¦‚å¿µ 3 äºŒçº§ç¼“å­˜3.1 æ¦‚è¿°MyBatisä¸€çº§ç¼“å­˜æœ€å¤§çš„å…±äº«èŒƒå›´å°±æ˜¯ä¸€ä¸ªSqlSessionå†…éƒ¨ï¼Œé‚£ä¹ˆå¦‚æœå¤šä¸ª SqlSession éœ€è¦å…±äº«ç¼“å­˜ï¼Œåˆ™éœ€è¦å¼€å¯äºŒçº§ç¼“å­˜ï¼Œå¼€å¯äºŒçº§ç¼“å­˜åï¼Œä¼šä½¿ç”¨ CachingExecutor è£…é¥° Executorï¼Œè¿›å…¥ä¸€çº§ç¼“å­˜çš„æŸ¥è¯¢æµç¨‹å‰ï¼Œå…ˆåœ¨CachingExecutor è¿›è¡ŒäºŒçº§ç¼“å­˜çš„æŸ¥è¯¢ï¼Œå…·ä½“çš„å·¥ä½œæµç¨‹å¦‚ä¸‹æ‰€ç¤º å½“äºŒçº§ç¼“å­˜å¼€å¯åï¼ŒåŒä¸€ä¸ªå‘½åç©ºé—´(namespace) æ‰€æœ‰çš„æ“ä½œè¯­å¥ï¼Œéƒ½å½±å“ç€ä¸€ä¸ªå…±åŒçš„ cacheï¼Œä¹Ÿå°±æ˜¯äºŒçº§ç¼“å­˜è¢«å¤šä¸ª SqlSession å…±äº«ï¼Œæ˜¯ä¸€ä¸ªå…¨å±€çš„å˜é‡ã€‚å½“å¼€å¯ç¼“å­˜åï¼Œæ•°æ®çš„æŸ¥è¯¢æ‰§è¡Œçš„æµç¨‹å°±æ˜¯ äºŒçº§ç¼“å­˜ -&gt; ä¸€çº§ç¼“å­˜ -&gt; æ•°æ®åº“ã€‚ ä½†äºŒçº§ç¼“å­˜ç¼“å­˜çš„æ˜¯æ•°æ®è€Œä¸æ˜¯å¯¹è±¡ï¼Œå½“æˆ‘ä»¬åœ¨ä½¿ç”¨äºŒçº§ç¼“å­˜æ—¶ï¼Œæ‰€ç¼“å­˜çš„ç±»ä¸€å®šè¦å®ç° java.io.Serializable æ¥å£ï¼Œè¿™ç§å°±å¯ä»¥ä½¿ç”¨åºåˆ—åŒ–æ–¹å¼æ¥ä¿å­˜å¯¹è±¡ã€‚ 3.2 ä½¿ç”¨äºŒçº§ç¼“å­˜é»˜è®¤æ˜¯ä¸å¼€å¯çš„ï¼Œéœ€è¦ä»¥ä¸‹æ“ä½œå¼€å¯ï¼š åœ¨Mybatis.xmlæ€»é…ç½® &lt;settings> &lt;setting name=\"cacheEnabled\" value=\"true\"/> &lt;/settings> å› ä¸º cacheEnabled çš„å–å€¼é»˜è®¤å°±ä¸º trueï¼Œæ‰€ä»¥è¿™ä¸€æ­¥å¯ä»¥çœç•¥ä¸é…ç½®ã€‚ä¸º true ä»£è¡¨å¼€å¯äºŒçº§ç¼“å­˜ï¼›ä¸ºfalse ä»£è¡¨ä¸å¼€å¯äºŒçº§ç¼“å­˜ åœ¨Mapperé…ç½®æ–‡ä»¶ä¸­é…ç½® &lt;cache/> cacheæ ‡ç­¾å¯ä»¥è®¾ç½®ä»¥ä¸‹å±æ€§ï¼š eviction: ç¼“å­˜å›æ”¶ç­–ç•¥ï¼Œæœ‰è¿™å‡ ç§å›æ”¶ç­–ç•¥ LRU - æœ€è¿‘æœ€å°‘å›æ”¶ï¼Œç§»é™¤æœ€é•¿æ—¶é—´ä¸è¢«ä½¿ç”¨çš„å¯¹è±¡ FIFO - å…ˆè¿›å…ˆå‡ºï¼ŒæŒ‰ç…§ç¼“å­˜è¿›å…¥çš„é¡ºåºæ¥ç§»é™¤å®ƒä»¬ SOFT - è½¯å¼•ç”¨ï¼Œç§»é™¤åŸºäºåƒåœ¾å›æ”¶å™¨çŠ¶æ€å’Œè½¯å¼•ç”¨è§„åˆ™çš„å¯¹è±¡ WEAK - å¼±å¼•ç”¨ï¼Œæ›´ç§¯æçš„ç§»é™¤åŸºäºåƒåœ¾æ”¶é›†å™¨å’Œå¼±å¼•ç”¨è§„åˆ™çš„å¯¹è±¡ é»˜è®¤æ˜¯ LRU æœ€è¿‘æœ€å°‘å›æ”¶ç­–ç•¥ flushinterval: ç¼“å­˜åˆ·æ–°é—´éš”ï¼Œç¼“å­˜å¤šé•¿æ—¶é—´åˆ·æ–°ä¸€æ¬¡ï¼Œé»˜è®¤ä¸æ¸…ç©ºï¼Œè®¾ç½®ä¸€ä¸ªæ¯«ç§’å€¼ readOnly: æ˜¯å¦åªè¯»ï¼›true åªè¯»ï¼ŒMyBatis è®¤ä¸ºæ‰€æœ‰ä»ç¼“å­˜ä¸­è·å–æ•°æ®çš„æ“ä½œéƒ½æ˜¯åªè¯»æ“ä½œï¼Œä¸ä¼šä¿®æ”¹æ•°æ®ã€‚MyBatis ä¸ºäº†åŠ å¿«è·å–æ•°æ®ï¼Œç›´æ¥å°±ä¼šå°†æ•°æ®åœ¨ç¼“å­˜ä¸­çš„å¼•ç”¨äº¤ç»™ç”¨æˆ·ã€‚ä¸å®‰å…¨ï¼Œé€Ÿåº¦å¿«ã€‚è¯»å†™(é»˜è®¤)ï¼šMyBatis è§‰å¾—æ•°æ®å¯èƒ½ä¼šè¢«ä¿®æ”¹ã€‚ size : ç¼“å­˜å­˜æ”¾å¤šå°‘ä¸ªå…ƒç´  type: æŒ‡å®šè‡ªå®šä¹‰ç¼“å­˜çš„å…¨ç±»å(å®ç°Cacheæ¥å£å³å¯) blockingï¼š è‹¥ç¼“å­˜ä¸­æ‰¾ä¸åˆ°å¯¹åº”çš„keyï¼Œæ˜¯å¦ä¼šä¸€ç›´blockingï¼Œç›´åˆ°æœ‰å¯¹åº”çš„æ•°æ®è¿›å…¥ç¼“å­˜ã€‚ åœ¨Selectæ ‡ç­¾ä¸­é…ç½® &lt;select id=\"\" useCache=\"true\"> ... &lt;/select> 3.3 æ³¨æ„ äºŒçº§ç¼“å­˜æ˜¯ä»¥namespaceä¸ºå•ä½çš„ï¼Œä¸åŒnamespaceä¸‹çš„æ“ä½œäº’ä¸å½±å“ã€‚ insert,update,deleteæ“ä½œä¼šæ¸…ç©ºæ‰€åœ¨namespaceä¸‹çš„å…¨éƒ¨ç¼“å­˜ã€‚ é€šå¸¸ä½¿ç”¨MyBatis Generatorç”Ÿæˆçš„ä»£ç ä¸­ï¼Œéƒ½æ˜¯å„ä¸ªè¡¨ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªè¡¨éƒ½æœ‰è‡ªå·±çš„namespaceã€‚ å¤šè¡¨æ“ä½œä¸€å®šä¸è¦ä½¿ç”¨äºŒçº§ç¼“å­˜ï¼Œå› ä¸ºå¤šè¡¨æ“ä½œè¿›è¡Œæ›´æ–°æ“ä½œï¼Œä¸€å®šä¼šäº§ç”Ÿè„æ•°æ®ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"mybatis","slug":"mybatis","permalink":"https://www.codetool.top/tags/mybatis/"}]},{"title":"æ•°æ®åº“ç†è®ºä¹‹æŸ¥è¯¢å¤„ç†å’ŒæŸ¥è¯¢ä¼˜åŒ–","slug":"æ•°æ®åº“ç†è®ºä¹‹æŸ¥è¯¢å¤„ç†å’ŒæŸ¥è¯¢ä¼˜åŒ–","date":"2020-02-22T03:37:08.000Z","updated":"2020-03-25T04:40:05.296Z","comments":true,"path":"article/æ•°æ®åº“ç†è®ºä¹‹æŸ¥è¯¢å¤„ç†å’ŒæŸ¥è¯¢ä¼˜åŒ–/","link":"","permalink":"https://www.codetool.top/article/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%90%86%E8%AE%BA%E4%B9%8B%E6%9F%A5%E8%AF%A2%E5%A4%84%E7%90%86%E5%92%8C%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/","excerpt":"","text":"å…³ç³»æ•°æ®åº“çš„æŸ¥è¯¢å¤„ç†å’ŒæŸ¥è¯¢ä¼˜åŒ– 1 æŸ¥è¯¢å¤„ç†æŸ¥è¯¢å¤„ç†æ˜¯ æ˜¯ RDBMS æ‰§è¡ŒæŸ¥è¯¢è¯­å¥çš„è¿‡ç¨‹ï¼Œå…¶ä»»åŠ¡æ˜¯æŠŠç”¨æˆ·æäº¤ç»™ RDBMS çš„æŸ¥è¯¢è¯­å¥è½¬æ¢ä¸ºé«˜æ•ˆçš„æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ã€‚ 1.1 æŸ¥è¯¢å¤„ç†æ­¥éª¤æŸ¥è¯¢å¤„ç†åˆ†ä¸º4ä¸ªé˜¶æ®µï¼šæŸ¥è¯¢åˆ†æã€æŸ¥è¯¢æ£€æŸ¥ã€æŸ¥è¯¢ä¼˜åŒ–å’ŒæŸ¥è¯¢æ‰§è¡Œã€‚ æŸ¥è¯¢åˆ†æï¼ˆè¯­æ³•ï¼‰å¯¹æŸ¥è¯¢è¯­å¥è¿›è¡Œæ‰«æã€è¯æ³•åˆ†æã€è¯­æ³•åˆ†æ æŸ¥è¯¢æ£€æŸ¥ï¼ˆè¯­ä¹‰ï¼‰å¯¹åˆæ³•çš„æŸ¥è¯¢è¯­å¥è¿›è¡Œè¯­ä¹‰æ£€æŸ¥ï¼Œå³æ ¹æ®æ•°æ®å­—å…¸ä¸­æœ‰å…³çš„æ¨¡å¼å®šä¹‰æ£€æŸ¥è¯­å¥ä¸­çš„æ•°æ®åº“å¯¹è±¡ï¼Œå¦‚å…³ç³»åã€å±æ€§åç­‰æ˜¯å¦å­˜åœ¨å’Œæœ‰æ•ˆã€‚ ç„¶åè¿›è¡Œå®‰å…¨æ€§ã€å®Œæ•´æ€§æ£€æŸ¥ã€‚æ£€æŸ¥é€šè¿‡åæŠŠSQLè¯­å¥è½¬æ¢æˆç­‰ä»·çš„å…³ç³»ä»£æ•°è¡¨è¾¾å¼ã€‚RDBMS ä¸€èˆ¬é‡‡ç”¨æŸ¥è¯¢æ ‘ï¼ˆè¯­æ³•æ ‘ï¼‰æ¥è¡¨ç¤ºæ‹“å±•çš„å…³ç³»ä»£æ•°è¡¨è¾¾å¼ã€‚ æŸ¥è¯¢ä¼˜åŒ–æŸ¥è¯¢ä¼˜åŒ–å°±æ˜¯é€‰æ‹©ä¸€ä¸ªé«˜æ•ˆæ‰§è¡Œçš„æŸ¥è¯¢å¤„ç†ç­–ç•¥ã€‚åˆ†ä¸ºä»£æ•°ä¼˜åŒ–å’Œç‰©ç†ä¼˜åŒ– ä»£æ•°ä¼˜åŒ–æ˜¯æŒ‡å…³ç³»ä»£æ•°è¡¨è¾¾å¼çš„ä¼˜åŒ–ï¼Œå³æŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼Œé€šè¿‡å¯¹å…³ç³»ä»£æ•°è¡¨è¾¾å¼è¿›è¡Œç­‰ä»·å˜æ¢ï¼Œæ”¹å˜ä»£æ•°è¡¨è¾¾å¼ä¸­æ“ä½œçš„æ¬¡åºå’Œç»„åˆï¼Œä½¿æŸ¥è¯¢æ‰§è¡Œæ›´é«˜æ•ˆã€‚ ç‰©ç†ä¼˜åŒ–æ˜¯æŒ‡é€šè¿‡å­˜å–è·¯å¾„å’Œåº•å±‚æ“ä½œç®—æ³•çš„é€‰æ‹©è¿›è¡Œçš„ä¼˜åŒ–ã€‚é€‰æ‹©çš„ä¾æ®å¯ä»¥æ˜¯åŸºäºè§„åˆ™çš„ã€åŸºäºä»£ä»·çš„ã€åŸºäºè¯­ä¹‰çš„ã€‚ æŸ¥è¯¢æ‰§è¡Œä¾æ®ä¼˜åŒ–å™¨å¾—åˆ°çš„æ‰§è¡Œç­–ç•¥ç”ŸæˆæŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ï¼Œç”±ä»£ç ç”Ÿæˆå™¨ç”Ÿæˆæ‰§è¡Œè¿™ä¸ªæŸ¥è¯¢è®¡åˆ’çš„ä»£ç ï¼Œç„¶å åŠ ä»¥æ‰§è¡Œï¼Œå›é€æŸ¥è¯¢ç»“æœã€‚ 1.2 æŸ¥è¯¢æ“ä½œç®—æ³•(1) å…¨è¡¨æ‰«ææ–¹æ³• (Table Scan)å¯¹æŸ¥è¯¢çš„åŸºæœ¬è¡¨é¡ºåºæ‰«æï¼Œé€ä¸€æ£€æŸ¥æ¯ä¸ªå…ƒç»„æ˜¯å¦æ»¡è¶³é€‰æ‹©æ¡ä»¶ï¼ŒæŠŠæ»¡è¶³æ¡ä»¶çš„å…ƒç»„ä½œä¸ºç»“æœè¾“å‡ºé€‚åˆå°è¡¨ï¼Œä¸é€‚åˆå¤§è¡¨ (2) ç´¢å¼•æ‰«ææ–¹æ³• (Index Scan)é€‚åˆäºé€‰æ‹©æ¡ä»¶ä¸­çš„å±æ€§ä¸Šæœ‰ç´¢å¼•(ä¾‹å¦‚B+æ ‘ç´¢å¼•æˆ–Hashç´¢å¼•)é€šè¿‡ç´¢å¼•å…ˆæ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„å…ƒç»„ä¸»ç æˆ–å…ƒç»„æŒ‡é’ˆï¼Œå†é€šè¿‡å…ƒç»„æŒ‡é’ˆç›´æ¥åœ¨æŸ¥è¯¢çš„åŸºæœ¬è¡¨ä¸­æ‰¾åˆ°å…ƒç»„ã€‚ å½“é€‰æ‹©ç‡è¾ƒä½æ—¶ï¼ŒåŸºäºç´¢å¼•çš„é€‰æ‹©ç®—æ³•è¦ä¼˜äºå…¨è¡¨æ‰«æç®—æ³• ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¾‹å¦‚é€‰æ‹©ç‡è¾ƒé«˜ï¼Œæˆ–è€…è¦æŸ¥æ‰¾çš„å…ƒç»„å‡åŒ€åœ°åˆ†å¸ƒåœ¨æŸ¥æ‰¾çš„è¡¨ä¸­ï¼Œè¿™æ—¶åŸºäºç´¢å¼•çš„é€‰æ‹©ç®—æ³•æ€§èƒ½ä¸å¦‚å…¨è¡¨æ‰«æç®—æ³•ã€‚å› æ­¤é™¤äº†å¯¹è¡¨çš„æ‰«ææ“ä½œï¼Œè¿˜è¦åŠ ä¸Šå¯¹B+æ ‘ç´¢å¼•çš„æ‰«ææ“ä½œï¼Œå¯¹æ¯ä¸€ä¸ªæ£€ç´¢ç ï¼Œä» B+æ ‘æ ¹èŠ‚ç‚¹åˆ°å¶å­ç»“ç‚¹è·¯å¾„ä¸Šçš„æ¯ä¸ªç»“ç‚¹éƒ½è¦è¿›è¡Œä¸€æ¬¡ IO æ“ä½œã€‚ Hashæ ‘å’ŒB+æ ‘ä¹Ÿæœ‰ä¼˜åŠ£ï¼Œç­‰ä¸‹æ¬¡å†™æœ‰å…³ç´¢å¼•çš„æ—¶å€™å†è®²ã€‚ 1.3 è¿æ¥æ“ä½œç®—æ³•è¿æ¥æ“ä½œæ˜¯æŸ¥è¯¢å¤„ç†ä¸­æœ€è€—æ—¶çš„æ“ä½œä¹‹ä¸€ æœ¬èŠ‚åªè®¨è®ºç­‰å€¼è¿æ¥(æˆ–è‡ªç„¶è¿æ¥)æœ€å¸¸ç”¨çš„å®ç°ç®—æ³•ï¼Œä¾‹ï¼š SELECT * FROM Student, SC WHERE Student.Sno=SC.Sno; (1) åµŒå¥—å¾ªç¯ç®—æ³• (nested loop join) å¯¹å¤–å±‚å¾ªç¯(Student è¡¨) çš„æ¯ä¸€ä¸ªå…ƒç»„(s) ï¼Œæ£€ç´¢å†…å±‚å¾ªç¯(SC è¡¨) ä¸­çš„æ¯ä¸€ä¸ªå…ƒç»„(sc) æ£€æŸ¥è¿™ä¸¤ä¸ªå…ƒç»„åœ¨è¿æ¥å±æ€§(Sno)ä¸Šæ˜¯å¦ç›¸ç­‰ã€‚ å¦‚æœæ»¡è¶³è¿æ¥æ¡ä»¶ï¼Œåˆ™ä¸²æ¥åä½œä¸ºç»“æœè¾“å‡ºï¼Œç›´åˆ°å¤–å±‚å¾ªç¯è¡¨ä¸­çš„å…ƒç»„å¤„ç†å®Œä¸ºæ­¢ã€‚ å¯è§å°±æ˜¯O(N2)çš„æ—¶é—´å¤æ‚åº¦ï¼Œååˆ†è€—æ—¶ã€‚ (2) æ’åºâ€”â€”åˆå¹¶ç®—æ³•(sort-merge join æˆ– merge join) å¦‚æœè¿æ¥çš„è¡¨æ²¡æœ‰æ’å¥½åºï¼Œå…ˆå¯¹ Student è¡¨å’Œ SC è¡¨æŒ‰è¿æ¥å±æ€§ Sno æ’åº å– Student è¡¨ä¸­ç¬¬ä¸€ä¸ª Sno ï¼Œä¾æ¬¡æ‰«æ SC è¡¨ä¸­å…·æœ‰ç›¸åŒ Sno çš„å…ƒç»„ å½“æ‰«æåˆ° Sno ä¸ç›¸åŒçš„ç¬¬ä¸€ä¸ª SC å…ƒç»„æ—¶ ï¼Œè¿”å› Student è¡¨æ‰«æå®ƒçš„ä¸‹ä¸€ä¸ªå…ƒç»„ï¼Œå†æ‰«æ SC è¡¨ä¸­å…·æœ‰ç›¸åŒ Sno çš„å…ƒç»„ï¼ŒæŠŠå®ƒä»¬è¿æ¥èµ·æ¥ é‡å¤ä¸Šè¿°æ­¥éª¤ç›´åˆ° Student è¡¨æ‰«æå®Œ è¿™ç§ç®—æ³•å…·æœ‰åŠ¨æ€è§„åˆ’çš„æ€æƒ³ï¼ŒStudentè¡¨å’ŒSCè¡¨éƒ½åªè¦æ‰«æä¸€éï¼Œè€Œä¸”å¦‚æœè¿æ¥çš„å±æ€§æœ‰æ³¨å†Œç´¢å¼•ï¼Œå¹¶ä¸”ç´¢å¼•æ˜¯æœ‰åºçš„ï¼Œå¯ä»¥çœå»æ’åºçš„æ—¶é—´ã€‚ å¯¹äºå¤§è¡¨ï¼Œå…ˆæ’åºåä½¿ç”¨æ’åº-åˆå¹¶è¿æ¥ç®—æ³•æ‰§è¡Œè¿æ¥ï¼Œæ€»çš„æ—¶é—´ä¸€èˆ¬ä»ä¼šå‡å°‘ã€‚ (3) ç´¢å¼•è¿æ¥ (index join) ç®—æ³• æ­¥éª¤ï¼š ï¼ˆå‰æï¼‰åœ¨ SC è¡¨ä¸Šå·²ç»å»ºç«‹å±æ€§ Sno çš„ç´¢å¼•ã€‚ å¯¹ Student ä¸­æ¯ä¸€ä¸ªå…ƒç»„ï¼Œç”± Sno å€¼é€šè¿‡ SC çš„ç´¢å¼•æŸ¥æ‰¾ç›¸åº”çš„ SC å…ƒç»„ã€‚ æŠŠè¿™äº› SC å…ƒç»„å’Œ Student å…ƒç»„è¿æ¥èµ·æ¥ å¾ªç¯æ‰§è¡Œ1ã€2ï¼Œç›´åˆ°Studentè¡¨ä¸­çš„å…ƒç»„å¤„ç†å®Œä¸ºæ­¢ åªæœ‰ä¸€ä¸ªè¡¨éœ€è¦ç´¢å¼• (4) Hash Join ç®—æ³• æŠŠè¿æ¥å±æ€§ä½œä¸º hash ç ï¼Œç”¨åŒä¸€ä¸ªhash å‡½æ•°æŠŠ Student è¡¨å’Œ SC è¡¨ä¸­çš„å…ƒç»„æ•£åˆ—åˆ° hash è¡¨ä¸­ã€‚ åˆ’åˆ†é˜¶æ®µï¼ˆBuildï¼‰ å¯¹åŒ…å«è¾ƒå°‘å…ƒç»„çš„è¡¨(å¦‚ Student è¡¨) è¿›è¡Œä¸€éå¤„ç† æŠŠå®ƒçš„å…ƒç»„æŒ‰ hash å‡½æ•°åˆ†æ•£åˆ° hash è¡¨çš„æ¡¶ä¸­ è¯•æ¢é˜¶æ®µï¼ˆProbeï¼‰ å¯¹å¦ä¸€ä¸ªè¡¨(SC è¡¨) è¿›è¡Œä¸€éå¤„ç† æŠŠ SC è¡¨çš„å…ƒç»„ä¹ŸæŒ‰åŒä¸€ä¸ª hash å‡½æ•°ï¼ˆhash ç æ˜¯è¿æ¥å±æ€§ï¼‰è¿›è¡Œæ•£åˆ— æŠŠ SC å…ƒç»„ä¸æ¡¶ä¸­æ¥è‡ª Student è¡¨å¹¶ä¸ä¹‹ç›¸åŒ¹é…çš„å…ƒç»„è¿æ¥èµ·æ¥ å°†å°è¡¨è½¬ä¸ºå“ˆå¸Œè¡¨ï¼Œç”¨è¡¨1 çš„ åŒ¹é…å­—æ®µç”¨å“ˆå¸Œå‡½æ•°æ˜ å°„åˆ°å“ˆå¸Œè¡¨ ä¸Šé¢ hash join ç®—æ³•å‰æï¼šå‡è®¾ä¸¤ä¸ªè¡¨ä¸­è¾ƒå°çš„è¡¨åœ¨ç¬¬ä¸€é˜¶æ®µåå¯ä»¥å®Œå…¨æ”¾å…¥å†…å­˜çš„ hash æ¡¶ä¸­ã€‚ 2 æŸ¥è¯¢ä¼˜åŒ–æŸ¥è¯¢ä¼˜åŒ–åœ¨å…³ç³»æ•°æ®åº“ç³»ç»Ÿä¸­æœ‰ç€éå¸¸é‡è¦çš„åœ°ä½ å…³ç³»æŸ¥è¯¢ä¼˜åŒ–æ˜¯å½±å“å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ€§èƒ½çš„å…³é”®å› ç´  ç”±äºå…³ç³»è¡¨è¾¾å¼çš„è¯­ä¹‰çº§åˆ«å¾ˆé«˜ï¼Œä½¿å…³ç³»ç³»ç»Ÿå¯ä»¥ä»å…³ç³»è¡¨è¾¾å¼ä¸­åˆ†ææŸ¥è¯¢è¯­ä¹‰ï¼Œæä¾›äº†æ‰§è¡ŒæŸ¥è¯¢ä¼˜åŒ–çš„å¯èƒ½æ€§ 2.1 æ¦‚è¿°2.1.1 å…³ç³»ç³»ç»Ÿçš„æŸ¥è¯¢ä¼˜åŒ–æ˜¯å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå®ç°çš„å…³é”®æŠ€æœ¯åˆæ˜¯å…³ç³»ç³»ç»Ÿçš„ä¼˜ç‚¹æ‰€åœ¨å‡è½»äº†ç”¨æˆ·é€‰æ‹©å­˜å–è·¯å¾„çš„è´Ÿæ‹… 2.2 éå…³ç³»ç³»ç»Ÿç”¨æˆ·ä½¿ç”¨è¿‡ç¨‹åŒ–çš„è¯­è¨€è¡¨è¾¾æŸ¥è¯¢è¦æ±‚ï¼Œæ‰§è¡Œä½•ç§è®°å½•çº§çš„æ“ä½œï¼Œä»¥åŠæ“ä½œçš„åºåˆ—æ˜¯ç”±ç”¨æˆ·æ¥å†³å®šçš„ç”¨æˆ·å¿…é¡»äº†è§£å­˜å–è·¯å¾„ï¼Œç³»ç»Ÿè¦æä¾›ç”¨æˆ·é€‰æ‹©å­˜å–è·¯å¾„çš„æ‰‹æ®µï¼ŒæŸ¥è¯¢æ•ˆç‡ç”±ç”¨æˆ·çš„å­˜å–ç­–ç•¥å†³å®šå¦‚æœç”¨æˆ·åšäº†ä¸å½“çš„é€‰æ‹©ï¼Œç³»ç»Ÿæ˜¯æ— æ³•å¯¹æ­¤åŠ ä»¥æ”¹è¿›çš„ 2.2.1 æŸ¥è¯¢ä¼˜åŒ–çš„ä¼˜ç‚¹ ç”¨æˆ·ä¸å¿…è€ƒè™‘å¦‚ä½•æœ€å¥½åœ°è¡¨è¾¾æŸ¥è¯¢ä»¥è·å¾—è¾ƒå¥½çš„æ•ˆç‡ ç³»ç»Ÿå¯ä»¥æ¯”ç”¨æˆ·ç¨‹åºçš„ â€œä¼˜åŒ–â€ åšå¾—æ›´å¥½ ä¼˜åŒ–å™¨å¯ä»¥ä»æ•°æ®å­—å…¸ä¸­è·å–è®¸å¤šç»Ÿè®¡ä¿¡æ¯ ï¼Œ è€Œç”¨æˆ·ç¨‹åºåˆ™éš¾ä»¥è·å¾—è¿™äº›ä¿¡æ¯ ã€‚ å¦‚æœæ•°æ®åº“çš„ç‰©ç†ç»Ÿè®¡ä¿¡æ¯æ”¹å˜äº†ï¼Œç³»ç»Ÿå¯ä»¥è‡ªåŠ¨å¯¹æŸ¥è¯¢é‡æ–°ä¼˜åŒ–ä»¥é€‰æ‹©ç›¸é€‚åº”çš„æ‰§è¡Œè®¡åˆ’ã€‚åœ¨éå…³ç³»ç³»ç»Ÿä¸­å¿…é¡»é‡å†™ç¨‹åºï¼Œè€Œé‡å†™ç¨‹åºåœ¨å®é™…åº”ç”¨ä¸­å¾€å¾€æ˜¯ä¸å¤ªå¯èƒ½çš„ã€‚ ä¼˜åŒ–å™¨å¯ä»¥è€ƒè™‘æ•°ç™¾ç§ä¸åŒçš„æ‰§è¡Œè®¡åˆ’ï¼Œç¨‹åºå‘˜ä¸€èˆ¬åªèƒ½è€ƒè™‘æœ‰é™çš„å‡ ç§å¯èƒ½æ€§ ã€‚ ä¼˜åŒ–å™¨ä¸­åŒ…æ‹¬äº†å¾ˆå¤šå¤æ‚çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œè¿™äº›ä¼˜åŒ–æŠ€æœ¯å¾€å¾€åªæœ‰æœ€å¥½çš„ç¨‹åºå‘˜æ‰èƒ½æŒæ¡ã€‚ç³»ç»Ÿçš„è‡ªåŠ¨ä¼˜åŒ–ç›¸å½“äºä½¿å¾—æ‰€æœ‰äººéƒ½æ‹¥æœ‰è¿™äº›ä¼˜åŒ–æŠ€æœ¯ã€‚ å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿé€šè¿‡æŸç§ä»£ä»·æ¨¡å‹è®¡ç®—å‡ºå„ç§æŸ¥è¯¢æ‰§è¡Œç­–ç•¥çš„æ‰§è¡Œä»£ä»·ï¼Œç„¶åé€‰å–ä»£ä»·æœ€å°çš„æ‰§è¡Œæ–¹æ¡ˆ 2.2.2 æŸ¥è¯¢ä¼˜åŒ–çš„æ€»ç›®æ ‡ é€‰æ‹©æœ‰æ•ˆçš„ç­–ç•¥ æ±‚å¾—ç»™å®šå…³ç³»è¡¨è¾¾å¼çš„å€¼ ä½¿å¾—æŸ¥è¯¢ä»£ä»·æœ€å°( å®é™…ä¸Šæ˜¯è¾ƒå°) 2.3 ä¸€ä¸ªå®ä¾‹ä¸€ä¸ªå…³ç³»æŸ¥è¯¢å¯ä»¥å¯¹åº”ä¸åŒçš„æ‰§è¡Œæ–¹æ¡ˆï¼Œå…¶æ•ˆç‡å¯èƒ½ç›¸å·®éå¸¸å¤§ã€‚ ä¾‹ï¼šæ±‚é€‰ä¿®äº†2å·è¯¾ç¨‹çš„å­¦ç”Ÿå§“åã€‚ SELECT Student.Sname FROM Student, SC WHERE Student.Sno=SC.Sno AND SC.Cno='2' å‡å®šå­¦ç”Ÿ-è¯¾ç¨‹æ•°æ®åº“ä¸­æœ‰ 1000 ä¸ªå­¦ç”Ÿè®°å½•ï¼Œ10000 ä¸ªé€‰è¯¾è®°å½•é€‰ä¿® 2 å·è¯¾ç¨‹çš„é€‰è¯¾è®°å½•ä¸º 50 ä¸ª ç¬¬ä¸€ç§æƒ…å†µï¼š è®¡ç®—ç¬›å¡å°”ç§¯ ç®—æ³•ï¼š åœ¨å†…å­˜ä¸­å°½å¯èƒ½å¤šåœ°è£…å…¥æŸä¸ªè¡¨(å¦‚ Student è¡¨) çš„è‹¥å¹²å— ï¼Œç•™å‡ºä¸€å—å­˜æ”¾å¦ä¸€ä¸ªè¡¨(å¦‚ SC è¡¨) çš„å…ƒç»„ã€‚ æŠŠ SC ä¸­çš„æ¯ä¸ªå…ƒç»„å’Œ Student ä¸­æ¯ä¸ªå…ƒç»„è¿æ¥ ï¼Œ è¿æ¥åçš„å…ƒç»„è£…æ»¡ä¸€å—åå°±å†™åˆ°ä¸­é—´æ–‡ä»¶ä¸Š ä» SC ä¸­è¯»å…¥ä¸€å—å’Œå†…å­˜ä¸­çš„ Student å…ƒç»„è¿æ¥ï¼Œç›´åˆ° SC è¡¨å¤„ç†å®Œã€‚ å†è¯»å…¥è‹¥å¹²å— Student å…ƒç»„ï¼Œè¯»å…¥ä¸€å— SC å…ƒç»„ é‡å¤ä¸Šè¿°å¤„ç†è¿‡ç¨‹ï¼Œç›´åˆ°æŠŠ Student è¡¨å¤„ç†å®Œ ä½œé€‰æ‹©æ“ä½œ ä¾æ¬¡è¯»å…¥è¿æ¥åçš„å…ƒç»„ï¼ŒæŒ‰ç…§é€‰æ‹©æ¡ä»¶é€‰å–æ»¡è¶³è¦æ±‚çš„è®°å½• å‡å®šå†…å­˜å¤„ç†æ—¶é—´å¿½ç•¥ã€‚è¯»å–ä¸­é—´æ–‡ä»¶èŠ±è´¹çš„æ—¶é—´ (åŒå†™ä¸­é—´æ–‡ä»¶ä¸€æ ·) éœ€è¯»å…¥106å—ã€‚ è‹¥æ»¡è¶³æ¡ä»¶çš„å…ƒç»„å‡è®¾ä»… 50 ä¸ªï¼Œå‡å¯æ”¾åœ¨å†…å­˜ã€‚ ä½œæŠ•å½±æ“ä½œ æŠŠç¬¬ 2 æ­¥çš„ç»“æœåœ¨ Sname ä¸Šä½œæŠ•å½±è¾“å‡ºï¼Œå¾—åˆ°æœ€ç»ˆç»“æœ ç¬¬ä¸€ç§æƒ…å†µä¸‹æ‰§è¡ŒæŸ¥è¯¢çš„æ€»è¯»å†™æ•°æ®å— 2100+106+106 ç¬¬äºŒç§æƒ…å†µï¼š è®¡ç®—è‡ªç„¶è¿æ¥ æ‰§è¡Œè‡ªç„¶è¿æ¥ï¼Œè¯»å– Student å’Œ å’Œ SC è¡¨çš„ç­–ç•¥ä¸å˜ï¼Œæ€»çš„è¯»å–å—æ•°ä»ä¸º 2100 å— è‡ªç„¶è¿æ¥çš„ç»“æœæ¯”ç¬¬ä¸€ç§æƒ…å†µå¤§å¤§å‡å°‘ï¼Œä¸º 104 ä¸ªå…ƒç»„ å†™å‡ºæ•°æ®å—= 103 å— è¯»å–ä¸­é—´æ–‡ä»¶å—ï¼Œæ‰§è¡Œé€‰æ‹©è¿ç®—ï¼Œè¯»å–çš„æ•°æ®å—= 103 å— æŠŠç¬¬ 2 æ­¥ç»“æœæŠ•å½±è¾“å‡ºã€‚ç¬¬äºŒç§æƒ…å†µä¸‹æ‰§è¡ŒæŸ¥è¯¢çš„æ€»è¯»å†™æ•°æ®å—=2100+103+103å…¶æ‰§è¡Œä»£ä»·å¤§çº¦æ˜¯ç¬¬ä¸€ç§æƒ…å†µçš„ 488 åˆ†ä¹‹ä¸€ ç¬¬ä¸‰ç§æƒ…å†µï¼š å…ˆå¯¹ SC è¡¨ä½œé€‰æ‹©è¿ç®— ï¼Œåªéœ€è¯»ä¸€é SC è¡¨ï¼Œå­˜å–100 å—ï¼Œå› ä¸ºæ»¡è¶³æ¡ä»¶çš„å…ƒç»„ä»…50ä¸ªï¼Œä¸å¿…ä½¿ç”¨ä¸­é—´æ–‡ä»¶ã€‚ è¯»å– Student è¡¨ï¼ŒæŠŠè¯»å…¥çš„ Student å…ƒç»„å’Œå†…å­˜ä¸­çš„ SC å…ƒç»„ä½œè¿æ¥ã€‚ä¹Ÿåªéœ€è¯»ä¸€éStudent è¡¨å…± 100 å—ã€‚ æŠŠè¿æ¥ç»“æœæŠ•å½±è¾“å‡ºç¬¬ä¸‰ç§æƒ…å†µæ€»çš„è¯»å†™æ•°æ®å—=100+100å…¶æ‰§è¡Œä»£ä»·å¤§çº¦æ˜¯ç¬¬ä¸€ç§æƒ…å†µçš„ä¸‡åˆ†ä¹‹ä¸€ï¼Œæ˜¯ç¬¬äºŒç§æƒ…å†µçš„ 20 åˆ†ä¹‹ä¸€ æ³¨ï¼šå‡å¦‚ SC è¡¨çš„ Cno å­—æ®µä¸Šæœ‰ç´¢å¼• ç¬¬ä¸€æ­¥å°±ä¸å¿…è¯»å–æ‰€æœ‰çš„ SC å…ƒç»„è€Œåªéœ€è¯»å– Cno=â€˜2â€™ çš„é‚£äº›å…ƒç»„(50 ä¸ª) å­˜å–çš„ç´¢å¼•å—å’Œ SC ä¸­æ»¡è¶³æ¡ä»¶çš„æ•°æ®å—å¤§çº¦æ€»å…± 3 ï½4 å— è‹¥ Student è¡¨åœ¨ Sno ä¸Šä¹Ÿæœ‰ç´¢å¼• ä¸å¿…è¯»å–æ‰€æœ‰çš„ Student å…ƒç»„ å› ä¸ºæ»¡è¶³æ¡ä»¶çš„ SC è®°å½•ä»… 50 ä¸ªï¼Œæ¶‰åŠæœ€å¤š 50 ä¸ª ä¸ª Student è®°å½• è¯»å– Student è¡¨çš„å—æ•°ä¹Ÿå¯å¤§å¤§å‡å°‘ 2.3.1 æ€»ç»“æœ‰é€‰æ‹©å’Œè¿æ¥æ“ä½œæ—¶ï¼Œå…ˆåšé€‰æ‹©æ“ä½œï¼Œè¿™æ ·å‚åŠ è¿æ¥çš„å…ƒç»„å°±å¯ä»¥å¤§å¤§å‡å°‘ï¼Œè¿™æ˜¯ä»£æ•°ä¼˜åŒ–ã€‚ åœ¨ Q3 ä¸­ SC è¡¨çš„é€‰æ‹©æ“ä½œç®—æ³•æœ‰å…¨è¡¨æ‰«ææˆ–ç´¢å¼•æ‰«æï¼Œç»è¿‡åˆæ­¥ä¼°ç®—ï¼Œç´¢å¼•æ‰«ææ–¹æ³•è¾ƒä¼˜ã€‚ å¯¹äº Student å’Œ SC è¡¨çš„è¿æ¥ï¼Œåˆ©ç”¨ Student è¡¨ä¸Šçš„ç´¢å¼•ï¼Œé‡‡ç”¨ç´¢å¼•è¿æ¥ä»£ä»·ä¹Ÿè¾ƒå°ï¼Œè¿™å°±æ˜¯ç‰©ç†ä¼˜åŒ–ã€‚","categories":[{"name":"é¡¹ç›®/ç¼–ç¨‹ç†è®º","slug":"é¡¹ç›®-ç¼–ç¨‹ç†è®º","permalink":"https://www.codetool.top/categories/%E9%A1%B9%E7%9B%AE-%E7%BC%96%E7%A8%8B%E7%90%86%E8%AE%BA/"}],"tags":[{"name":"ä¼˜åŒ–","slug":"ä¼˜åŒ–","permalink":"https://www.codetool.top/tags/%E4%BC%98%E5%8C%96/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"}]},{"title":"leetcode530-äºŒå‰æœç´¢æ ‘çš„æœ€å°ç»å¯¹å·®","slug":"leetcode530-äºŒå‰æœç´¢æ ‘çš„æœ€å°ç»å¯¹å·®","date":"2020-02-21T16:45:13.000Z","updated":"2020-04-22T09:27:27.142Z","comments":true,"path":"article/leetcode530-äºŒå‰æœç´¢æ ‘çš„æœ€å°ç»å¯¹å·®/","link":"","permalink":"https://www.codetool.top/article/leetcode530-%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E7%9A%84%E6%9C%80%E5%B0%8F%E7%BB%9D%E5%AF%B9%E5%B7%AE/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ‰€æœ‰èŠ‚ç‚¹ä¸ºéè´Ÿå€¼çš„äºŒå‰æœç´¢æ ‘ï¼Œæ±‚æ ‘ä¸­ä»»æ„ä¸¤èŠ‚ç‚¹çš„å·®çš„ç»å¯¹å€¼çš„æœ€å°å€¼ã€‚ ç¤ºä¾‹: è¾“å…¥ï¼š &nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;2 è¾“å‡ºï¼š1è§£é‡Šï¼šæœ€å°ç»å¯¹å·®ä¸º1ï¼Œå…¶ä¸­ 2 å’Œ 1 çš„å·®çš„ç»å¯¹å€¼ä¸º 1ï¼ˆæˆ–è€… 2 å’Œ 3ï¼‰ã€‚ æ³¨æ„: æ ‘ä¸­è‡³å°‘æœ‰2ä¸ªèŠ‚ç‚¹ã€‚ 2 è§£æ³•2.1 æ€æƒ³ä¸­åºéå†ï¼Œè®¡ç®—ä¸¤ä¸ªç›¸é‚»èŠ‚ç‚¹ä¹‹é—´å€¼çš„å·®çš„ç»å¯¹å€¼ï¼Œæ¯”è¾ƒå‡ºæœ€å°å€¼ã€‚ 2.2 ä»£ç class Solution { int min = Integer.MAX_VALUE; int last = -1; public int getMinimumDifference(TreeNode root) { traverse(root); return min; } public void traverse(TreeNode root){ if(root == null){ return; } traverse(root.left); if(last!=-1) min = Math.min(min,root.val-last); last = root.val; traverse(root.right); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode208-å®ç°Trie(å‰ç¼€æ ‘)","slug":"leetcode208-å®ç°Trie(å‰ç¼€æ ‘)","date":"2020-02-21T16:29:42.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode208-å®ç°Trie(å‰ç¼€æ ‘)/","link":"","permalink":"https://www.codetool.top/article/leetcode208-%E5%AE%9E%E7%8E%B0Trie(%E5%89%8D%E7%BC%80%E6%A0%91)/","excerpt":"","text":"1 åŸé¢˜å®ç°ä¸€ä¸ª Trie (å‰ç¼€æ ‘)ï¼ŒåŒ…å« insert, search, å’Œ startsWith è¿™ä¸‰ä¸ªæ“ä½œã€‚ ç¤ºä¾‹: Trie trie = new Trie(); trie.insert(&quot;apple&quot;); trie.search(&quot;apple&quot;); // è¿”å› true trie.search(&quot;app&quot;); // è¿”å› false trie.startsWith(&quot;app&quot;); // è¿”å› true trie.insert(&quot;app&quot;); trie.search(&quot;app&quot;); // è¿”å› trueè¯´æ˜: ä½ å¯ä»¥å‡è®¾æ‰€æœ‰çš„è¾“å…¥éƒ½æ˜¯ç”±å°å†™å­—æ¯ a-z æ„æˆçš„ã€‚ ä¿è¯æ‰€æœ‰è¾“å…¥å‡ä¸ºéç©ºå­—ç¬¦ä¸²ã€‚ 2 è§£æ³•2.1 æ€æƒ³æˆ‘ä¹‹å‰çš„åšå®¢ç®—æ³•ç«èµ›å¸¸ç”¨æ•°æ®ç»“æ„-å­—å…¸æ ‘Trieæœ‰ä»‹ç»å­—å…¸æ ‘çš„ç»“æ„ï¼Œå­—å…¸æ ‘çš„å®ç°æ€»æ˜¯è·Ÿç€éœ€æ±‚æ¥çš„ï¼Œè¿™é“é¢˜éœ€è¦åˆ¤æ–­æ˜¯å¦æœ‰å‰ç¼€å’Œæ˜¯å¦æœ‰æ•´ä¸ªå•è¯ï¼Œå¯ä»¥ä¸ºèŠ‚ç‚¹è®¾ç½®ä¸€é¡¹å±æ€§isLeafï¼ˆæ˜¯å¦æ˜¯ä¸€ä¸ªå•è¯çš„ç»“å°¾å­—ç¬¦ï¼‰ã€‚ 2.2 ä»£ç class Trie { class Node{ boolean isLeaf = false; Node[] children = new Node[26]; } Node root; /** Initialize your data structure here. */ public Trie() { root = new Node(); } /** Inserts a word into the trie. */ public void insert(String word) { char[] chars = word.toCharArray(); Node node = root; for(int n = 0;n&lt;chars.length;n++){ if(node.children[chars[n]-'a'] == null) node = (node.children[chars[n]-'a'] = new Node()); else node = node.children[chars[n]-'a']; } node.isLeaf = true; } /** Returns if the word is in the trie. */ public boolean search(String word) { char[] chars = word.toCharArray(); Node node = root; for(int n = 0;n&lt;chars.length;n++){ if(node.children[chars[n]-'a'] == null) return false; else node = node.children[chars[n]-'a']; } if(node.isLeaf==false) return false; return true; } /** Returns if there is any word in the trie that starts with the given prefix. */ public boolean startsWith(String prefix) { char[] chars = prefix.toCharArray(); Node node = root; for(int n = 0;n&lt;chars.length;n++){ if(node.children[chars[n]-'a'] == null) return false; else node = node.children[chars[n]-'a']; } return true; } } /** * Your Trie object will be instantiated and called as such: * Trie obj = new Trie(); * obj.insert(word); * boolean param_2 = obj.search(word); * boolean param_3 = obj.startsWith(prefix); */","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"Mybatiså¤šè¡¨æŸ¥è¯¢-æ˜ å°„å…³ç³»é…ç½®","slug":"Mybatiså¤šè¡¨æŸ¥è¯¢-æ˜ å°„å…³ç³»é…ç½®","date":"2020-02-21T13:27:04.000Z","updated":"2020-02-22T08:12:22.255Z","comments":true,"path":"article/Mybatiså¤šè¡¨æŸ¥è¯¢-æ˜ å°„å…³ç³»é…ç½®/","link":"","permalink":"https://www.codetool.top/article/Mybatis%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2-%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB%E9%85%8D%E7%BD%AE/","excerpt":"","text":"1 resultMapé…ç½®1.1 æ˜¯ä»€ä¹ˆresultMapå¤„ç†ç»“æœé›†æ˜ å°„ 1.2 åŸºç¡€ä½¿ç”¨ è‡ªåŠ¨æ–¹æ³• å¦‚æœresultTypeä¸ºPOJOä¸”å±æ€§åå¯¹åº”æ•°æ®è¡¨ä¸­çš„å­—æ®µåï¼Œä¼šè‡ªåŠ¨ç”ŸæˆresultMapå¤„ç†æ˜ å°„ã€‚ å¦‚æœåˆ—åå’Œå±æ€§åä¸åŒ¹é…ä¹Ÿå¯ä»¥ä½¿ç”¨SQLè¯­å¥ä¸­çš„asç»™åˆ—åèµ·åˆ«åï¼Œå¯¹åº”å±æ€§åäº§ç”Ÿæ˜ å°„ æ‰‹åŠ¨æ–¹æ³• idå’Œresultçš„ä¸åŒç‚¹åœ¨äºï¼Œåœ¨æ¯”è¾ƒå¯¹è±¡å®ä¾‹çš„æ—¶å€™idä½œä¸ºç»“æœé›†çš„æ ‡è¯†å±æ€§ã€‚è¿™æœ‰åŠ©äºæé«˜æ€»ä½“æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åº”ç”¨ç¼“å­˜å’ŒåµŒå¥—ç»“æœæ˜ å°„çš„æ—¶å€™ã€‚ &lt;resultMap id=\"userinfoResultMap\" type=\"com.test.domain.Userinfo\"> &lt;id property=\"userid\" column=\"user_id\"/> &lt;result property=\"username\" column=\"user_name\"/> &lt;result property=\"password\" column=\"password\"/> &lt;/resultMap> æ‹“å±•resultMap &lt;resultMap id=\"userinfoAndAddressResultMap\" type=\"com.test.domain.Userinfo\" extends=\"userinfoResultMap\"> &lt;id property=\"address.addrid\" column=\"addrid\"/> &lt;result property=\"address.city\" column=\"city\"/> &lt;result property=\"address.street\" column=\"street\"/> &lt;result property=\"address.zip\" column=\"zip\"/> &lt;/resultMap> 2 ä¸€å¯¹ä¸€æ˜ å°„2.1 æ–¹æ³•ä¸€ï¼šæ‹“å±•resultMap2.2 æ–¹æ³•äºŒï¼šåµŒå¥—resultMap&lt;resultMap id=\"userinfoAndAddressResultMap\" type=\"com.test.domain.Userinfo\"> &lt;id property=\"userid\" column=\"user_id\"/> &lt;result property=\"username\" column=\"user_name\"/> &lt;result property=\"password\" column=\"password\"/> &lt;association property=\"address\" resultMap=\"addressResultMap\">&lt;/association> &lt;/resultMap> associationå…ƒç´ å¤„ç†â€œä¸€å¯¹ä¸€â€è¿™ç§ç±»å‹å…³ç³» 2.3 æ–¹æ³•ä¸‰ï¼šåµŒå¥—å¼•å…¥selectè¯­å¥&lt;resultMap id=\"addressResultMap\" type=\"com.test.domain.Address\"> &lt;id property=\"addrid\" column=\"addrid\"/> &lt;result property=\"city\" column=\"city\"/> &lt;result property=\"street\" column=\"street\"/> &lt;result property=\"zip\" column=\"zip\"/> &lt;/resultMap> &lt;select id=\"selectAddressById\" parameterType=\"int\" resultMap=\"addressResultMap\"> SELECT * FROM address WHERE addrid = #{addrid} &lt;/select> &lt;resultMap id=\"userinfoAndAddressResultMap\" type=\"com.test.domain.Userinfo\"> &lt;id property=\"userid\" column=\"user_id\"/> &lt;result property=\"username\" column=\"user_name\"/> &lt;result property=\"password\" column=\"password\"/> &lt;association property=\"address\" column=\"addrid\" select=\"selectAddressByID\"/> &lt;/resultMap> æ‹“å±•ï¼šå¦‚æœéœ€è¦å¯ç”¨å»¶è¿ŸåŠ è½½ï¼Œå³çœŸæ­£ç”¨åˆ°Userä¸­çš„Addressçš„æ—¶å€™æ‰è¿›è¡Œå¯¹åº”sqlè¯­å¥çš„æŸ¥è¯¢æ“ä½œï¼Œå¯ä»¥åœ¨mybatisé…ç½®æ–‡ä»¶ä¸­æŠŠæ‡’åŠ è½½æ‰“å¼€ï¼š &lt;settings> &lt;!-- å¼€å¯å…¨å±€å»¶è¿ŸåŠ è½½ --> &lt;setting name=\"lazyLoadingEnabled\" value=\"true\"/> &lt;setting name=\"aggressiveLazyLoading\" value=\"false\"/> &lt;/setting> 3 ä¸€å¯¹å¤šæ˜ å°„ä½¿ç”¨&lt;collection&gt;å…ƒç´ å°†ä¸€å¯¹å¤šç±»å‹çš„ç»“æœæ˜ å°„åˆ°ä¸€ä¸ªå¯¹è±¡é›†åˆä¸Šã€‚ 3.1 æ–¹æ³•ä¸€ï¼šå†…åµŒç»“æœresultMap&lt;resultMap id=\"employeeResultMap\" type=\"com.test.domain.Employee\"> &lt;id property=\"empid\" column=\"empid\"/> &lt;result property=\"empname\" column=\"empname\"/> &lt;/resultMap> &lt;resultMap id=\"departmentResultMap\" type=\"com.test.domain.Department\"> &lt;id property=\"depid\" column=\"depid\"/> &lt;result property=\"depname\" column=\"depname\"/> &lt;collection property=\"employees\" resultMap=\"employeeResultMap\">&lt;/collection> &lt;/resultMap> &lt;select id=\"selectDepartmentAndEmployeeById\" parameterType=\"int\" resultMap=\"departmentResultMap\"> SELECT dep.depid,dep.depname,emp.empid,emp.empname FROM department dep LEFT OUTER JOIN employee emp ON dep.depid = emp.empid WHERE dep.depid = #{depid} &lt;/select> 3.2 æ–¹æ³•äºŒï¼šåµŒå¥—selectè¯­å¥&lt;resultMap id=\"employeeResultMap\" type=\"com.test.domain.Employee\"> &lt;id property=\"empid\" column=\"empid\"/> &lt;result property=\"empname\" column=\"empname\"/> &lt;/resultMap> &lt;resultMap id=\"departmentResultMap\" type=\"com.test.domain.Department\"> &lt;id property=\"depid\" column=\"depid\"/> &lt;result property=\"depname\" column=\"depname\"/> &lt;collection property=\"employees\" select=\"selectEmployeeById\" column=\"depid\">&lt;/collection> &lt;/resultMap> &lt;select id=\"selectEmployeeById\" parameterType=\"int\" resultMap=\"employeeResultMap\"> SELECT emp.empid,emp.empname FROM employee emp WHERE emp.empid = #{empid} &lt;/select> &lt;select id=\"selectDepartmentById\" parameterType=\"int\" resultMap=\"departmentResultMap\"> SELECT dep.depid,dep.depname FROM department dep WHERE dep.depid = #{depid} &lt;/select> 4 æ³¨æ„æ³¨æ„å†…åµŒç»“æœresultMapå’ŒåµŒå¥—selectè¯­å¥çš„æ€è·¯æ˜¯ä¸åŒçš„ï¼Œå†…åµŒç»“æœresultMapåªæ‰§è¡Œä¸€æ¡sqlè¯­å¥ï¼Œè€ŒåµŒå¥—selectè¯­å¥å¯ä»¥åˆ†åˆ«æ‰§è¡Œï¼Œè¿˜æ”¯æŒå»¶è¿ŸåŠ è½½ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"mybatis","slug":"mybatis","permalink":"https://www.codetool.top/tags/mybatis/"}]},{"title":"Mybatisäº‹åŠ¡ã€è¿æ¥æ± ã€åŠ¨æ€SQL","slug":"Mybatisäº‹åŠ¡ã€è¿æ¥æ± ã€åŠ¨æ€SQL","date":"2020-02-21T12:38:07.000Z","updated":"2020-02-23T15:31:31.525Z","comments":true,"path":"article/Mybatisäº‹åŠ¡ã€è¿æ¥æ± ã€åŠ¨æ€SQL/","link":"","permalink":"https://www.codetool.top/article/Mybatis%E4%BA%8B%E5%8A%A1%E3%80%81%E8%BF%9E%E6%8E%A5%E6%B1%A0%E3%80%81%E5%8A%A8%E6%80%81SQL/","excerpt":"","text":"1 äº‹åŠ¡ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ACID ä¸è€ƒè™‘éš”ç¦»æ€§ä¼šäº§ç”Ÿçš„ä¸‰ä¸ªé—®é¢˜ è§£å†³æ–¹æ³•ï¼šå››ç§éš”ç¦»çº§åˆ« ä»¥ä¸Šå†…å®¹è§Mybatisäº‹åŠ¡ã€è¿æ¥æ± ã€åŠ¨æ€SQL mybatisé€šè¿‡sqlsessionçš„commitå’Œrollbackå®ç°æäº¤å’Œå›æ»š ï¼ˆé€šè¿‡Executorå®ç°ï¼ŒExecutorç®¡ç†Connectionï¼‰ å¦‚æœä½¿ç”¨SqlSessionFactoryè·å–SqlSessionçš„æ—¶å€™ä¼ é€’äº†å‚æ•°ï¼š factory.openSesison(true); å¯ä»¥å®ç°è‡ªåŠ¨æäº¤ 2 è¿æ¥æ± æˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­éƒ½ä¼šä½¿ç”¨è¿æ¥æ± ã€‚å› ä¸ºå®ƒå¯ä»¥å‡å°‘æˆ‘ä»¬è·å–è¿æ¥æ‰€éœ€æ—¶é—´ã€‚ mybatisçš„è¿æ¥æ± ï¼š POOLED UNPOOLED JNDI POOLED: javax.sql.DataSource UNPOOLED: é‡‡ç”¨ä¼ ç»Ÿçš„è·å–è¿æ¥çš„æ–¹å¼ï¼Œè™½ç„¶ä¹Ÿå®ç°äº†javax.sql.DataSourceæ¥å£ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä½¿ç”¨æ± çš„æ€æƒ³ JNDI: é‡‡ç”¨æœåŠ¡å™¨æä¾›çš„JNDIå®ç°ï¼Œæ¥è·å–DataSourceå¯¹è±¡ï¼Œå¦‚æœä¸æ˜¯webæˆ–è€…mavençš„warå·¥ç¨‹ï¼Œæ˜¯ä¸èƒ½ä½¿ç”¨çš„ã€‚ MyBatisæ˜¯é€šè¿‡å·¥å‚æ¨¡å¼æ¥åˆ›å»ºæ•°æ®æº DataSource å¯¹è±¡çš„ï¼ŒMyBatis å®šä¹‰äº†æŠ½è±¡çš„å·¥å‚æ¥å£ï¼šorg.apache.ibatis.datasource.DataSourceFactory,é€šè¿‡å…¶getDataSource()æ–¹æ³•è¿”å›æ•°æ®æºDataSourceã€‚ ä¸Šè¿°ä¸‰ç§ä¸åŒç±»å‹çš„ typeï¼Œåˆ™æœ‰å¯¹åº”çš„ä»¥ä¸‹ dataSource å·¥å‚ï¼š POOLED ï¼šPooledDataSourceFactory UNPOOLED ï¼šUnpooledDataSourceFactory JNDI ï¼šJndiDataSourceFactory 2.1 Unpooledè·å–Connectionå½“&lt;dataSource&gt;çš„typeå±æ€§è¢«é…ç½®æˆäº†â€UNPOOLEDâ€ï¼ŒMyBatisé¦–å…ˆä¼šå®ä¾‹åŒ–ä¸€ä¸ªUnpooledDataSourceFactoryå·¥å‚å®ä¾‹ï¼Œ ç„¶åé€šè¿‡ getDataSource() æ–¹æ³•è¿”å›ä¸€ä¸ªUnpooledDataSource å®ä¾‹å¯¹è±¡å¼•ç”¨ï¼Œæˆ‘ä»¬å‡å®šä¸º dataSourceã€‚ ä½¿ç”¨ UnpooledDataSource çš„ getConnection(),æ¯è°ƒç”¨ä¸€æ¬¡å°±ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ Connection å®ä¾‹å¯¹è±¡ã€‚ UnpooledDataSource ä¼šåšä»¥ä¸‹äº‹æƒ…ï¼š åˆå§‹åŒ–é©±åŠ¨ï¼šåˆ¤æ–­ driver é©±åŠ¨æ˜¯å¦å·²ç»åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¦‚æœè¿˜æ²¡æœ‰åŠ è½½ï¼Œåˆ™ä¼šåŠ¨æ€åœ°åŠ è½½ driver ç±»ï¼Œå¹¶å®ä¾‹åŒ–ä¸€ä¸ª Driver å¯¹è±¡ï¼Œä½¿ç”¨ DriverManager.registerDriver()æ–¹æ³•å°†å…¶æ³¨å†Œåˆ°å†…å­˜ä¸­ï¼Œä»¥ä¾›åç»­ä½¿ç”¨ã€‚ åˆ›å»º Connection å¯¹è±¡ï¼šä½¿ç”¨DriverManager.getConnection()æ–¹æ³•åˆ›å»ºè¿æ¥ã€‚ é…ç½® Connection å¯¹è±¡ï¼šè®¾ç½®æ˜¯å¦è‡ªåŠ¨æäº¤ autoCommit å’Œéš”ç¦»çº§åˆ« isolationLevelã€‚ è¿”å› Connection å¯¹è±¡ã€‚ 2.2 Pooledè·å–ConnectionPooledDataSource å°† java.sql.Connection å¯¹è±¡åŒ…è£¹æˆ PooledConnection å¯¹è±¡æ”¾åˆ°äº† PoolState ç±»å‹çš„å®¹å™¨ä¸­ç»´æŠ¤ã€‚MyBatis å°†è¿æ¥æ± ä¸­çš„ PooledConnection åˆ†ä¸ºä¸¤ç§çŠ¶æ€ï¼šç©ºé—²çŠ¶æ€ï¼ˆidleï¼‰å’Œæ´»åŠ¨çŠ¶æ€(active)ï¼Œè¿™ä¸¤ç§çŠ¶æ€çš„ PooledConnection å¯¹è±¡åˆ†åˆ«è¢«å­˜å‚¨åˆ°PoolState å®¹å™¨å†…çš„ idleConnections å’Œ activeConnections ä¸¤ä¸ª List é›†åˆä¸­ï¼š idleConnections: ç©ºé—²(idle)çŠ¶æ€ PooledConnection å¯¹è±¡è¢«æ”¾ç½®åˆ°æ­¤é›†åˆä¸­ï¼Œè¡¨ç¤ºå½“å‰é—²ç½®çš„æ²¡æœ‰è¢«ä½¿ç”¨çš„ PooledConnection é›†åˆï¼Œè°ƒç”¨ PooledDataSource çš„ getConnection()æ–¹æ³•æ—¶ï¼Œä¼šä¼˜å…ˆä»æ­¤é›†åˆä¸­å– PooledConnection å¯¹è±¡ã€‚ å½“ç”¨å®Œä¸€ä¸ª java.sql.Connection å¯¹è±¡æ—¶ï¼ŒMyBatis ä¼šå°†å…¶åŒ…è£¹æˆ PooledConnection å¯¹è±¡æ”¾åˆ°æ­¤é›†åˆä¸­ã€‚ activeConnections: æ´»åŠ¨(active)çŠ¶æ€çš„PooledConnectionå¯¹è±¡è¢«æ”¾ç½®åˆ°åä¸ºactiveConnectionsçš„ArrayListä¸­ï¼Œè¡¨ç¤ºå½“å‰æ­£åœ¨è¢«ä½¿ç”¨çš„PooledConnectioné›†åˆï¼Œè°ƒç”¨PooledDataSourceçš„getConnection()æ–¹æ³•æ—¶ï¼Œä¼šä¼˜å…ˆä»idleConnections é›†åˆä¸­å–PooledConnection å¯¹è±¡,å¦‚æœæ²¡æœ‰ï¼Œåˆ™çœ‹æ­¤é›†åˆæ˜¯å¦å·²æ»¡ï¼Œå¦‚æœæœªæ»¡ï¼ŒPooledDataSourceä¼šåˆ›å»ºå‡ºä¸€ä¸ª PooledConnectionï¼Œæ·»åŠ åˆ°æ­¤é›†åˆä¸­ï¼Œå¹¶è¿”å›ã€‚ popConnection()æ–¹æ³•åˆ°åº•åšäº†ä»€ä¹ˆï¼š å…ˆçœ‹æ˜¯å¦æœ‰ç©ºé—²(idle)çŠ¶æ€ä¸‹çš„ PooledConnection å¯¹è±¡ï¼Œå¦‚æœæœ‰ï¼Œå°±ç›´æ¥è¿”å›ä¸€ä¸ªå¯ç”¨çš„ PooledConnection å¯¹è±¡ï¼›å¦åˆ™è¿›è¡Œç¬¬ 2 æ­¥ã€‚ æŸ¥çœ‹æ´»åŠ¨çŠ¶æ€çš„ PooledConnection æ±  activeConnections æ˜¯å¦å·²æ»¡ï¼›å¦‚æœæ²¡æœ‰æ»¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ PooledConnection å¯¹è±¡ï¼Œç„¶åæ”¾åˆ° activeConnections æ± ä¸­ï¼Œç„¶åè¿”å›æ­¤PooledConnection å¯¹è±¡ï¼›å¦åˆ™è¿›è¡Œç¬¬ä¸‰æ­¥ï¼› çœ‹æœ€å…ˆè¿›å…¥ activeConnections æ± ä¸­çš„ PooledConnection å¯¹è±¡æ˜¯å¦å·²ç»è¿‡æœŸï¼šå¦‚æœå·²ç»è¿‡æœŸï¼Œä» activeConnections æ± ä¸­ç§»é™¤æ­¤å¯¹è±¡ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„ PooledConnection å¯¹è±¡ï¼Œæ·»åŠ åˆ° activeConnections ä¸­ï¼Œç„¶åå°†æ­¤å¯¹è±¡è¿”å›ï¼›å¦åˆ™è¿›è¡Œç¬¬ 4 æ­¥ã€‚ çº¿ç¨‹ç­‰å¾… å½“æˆ‘ä»¬çš„ç¨‹åºä¸­ä½¿ç”¨å®Œ Connection å¯¹è±¡æ—¶ï¼Œå¦‚æœä¸ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šè°ƒç”¨connection.close()æ–¹æ³•ï¼Œå…³é—­ connection è¿æ¥ï¼Œé‡Šæ”¾èµ„æºã€‚ æˆ‘ä»¬å¸Œæœ›å½“ Connection ä½¿ç”¨å®Œåï¼Œè°ƒç”¨.close()æ–¹æ³•ï¼Œè€Œå®é™…ä¸Š Connection èµ„æºå¹¶æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œè€Œå®é™…ä¸Šè¢«æ·»åŠ åˆ°äº†è¿æ¥æ± ä¸­ã€‚ è¿™é‡Œè¦ä½¿ç”¨ä»£ç†æ¨¡å¼ï¼Œä¸ºçœŸæ­£çš„ Connection å¯¹è±¡åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯è°ƒç”¨ç›¸åº”çš„çœŸæ­£ Connection å¯¹è±¡çš„æ–¹æ³•å®ç°ã€‚å½“ä»£ç†å¯¹è±¡æ‰§è¡Œ close()æ–¹æ³•æ—¶ï¼Œè¦ç‰¹æ®Šå¤„ç†ï¼Œä¸è°ƒç”¨çœŸæ­£ Connection å¯¹è±¡çš„ close()æ–¹æ³•ï¼Œè€Œæ˜¯å°† Connection å¯¹è±¡æ·»åŠ åˆ°è¿æ¥æ± ä¸­ã€‚ MyBatis çš„ PooledDataSource çš„ PoolState å†…éƒ¨ç»´æŠ¤çš„å¯¹è±¡æ˜¯ PooledConnection ç±»å‹çš„å¯¹è±¡ï¼Œè€Œ PooledConnection åˆ™æ˜¯å¯¹çœŸæ­£çš„æ•°æ®åº“è¿æ¥ java.sql.Connection å®ä¾‹å¯¹è±¡çš„åŒ…è£¹å™¨ã€‚ PooledConenction å®ç°äº† InvocationHandler æ¥å£ï¼Œå¹¶ä¸” proxyConnection å¯¹è±¡ä¹Ÿæ˜¯æ ¹æ®è¿™ä¸ªå®ƒæ¥ç”Ÿæˆçš„ä»£ç†å¯¹è±¡ã€‚ 3 åŠ¨æ€SQLæ ¹æ®ä¸åŒçš„æ¡ä»¶éœ€è¦æ‰§è¡Œä¸åŒçš„SQLå‘½ä»¤ï¼Œç§°ä¸ºåŠ¨æ€SQL å®˜æ–¹æ–‡æ¡£å‚è€ƒï¼šhttps://mybatis.org/mybatis-3/dynamic-sql.html 3.1 æ¡ä»¶åˆ¤æ–­åœ¨Mapperé…ç½®æ–‡ä»¶ä¸­ï¼Œåœ¨sqlä¸­ï¼Œå¯ä»¥å†™ä¸€äº›ç‰¹æ®Šçš„æ ‡ç­¾ï¼Œå…¶ä¸­çš„å±æ€§testç”¨äºåˆ¤æ–­æ¡ä»¶ï¼ŒåŸºäºOGNLè¡¨è¾¾å¼ ä¾‹ï¼š&lt;if test=&quot;title != null&quot;&gt; ï¼ˆé€»è¾‘è¿ç®—ç”¨ and orï¼‰ 3.2 ifä»è‹¥å¹²æ¡ä»¶ä¸­åˆ†æ”¯ &lt;select id=\"findActiveBlogLike\" resultType=\"Blog\"> SELECT * FROM BLOG WHERE state = â€˜ACTIVEâ€™ &lt;if test=\"title != null\"> AND title like #{title} &lt;/if> &lt;if test=\"author != null and author.name != null\"> AND author_name like #{author.name} &lt;/if> &lt;/select> 3.3 choose,when,otherwiseä»è‹¥å¹²æ¡ä»¶ä¸­é€‰æ‹©ä¸€é¡¹ &lt;select id=\"findActiveBlogLike\" resultType=\"Blog\"> SELECT * FROM BLOG WHERE state = â€˜ACTIVEâ€™ &lt;choose> &lt;when test=\"title != null\"> AND title like #{title} &lt;/when> &lt;when test=\"author != null and author.name != null\"> AND author_name like #{author.name} &lt;/when> &lt;otherwise> AND featured = 1 &lt;/otherwise> &lt;/choose> &lt;/select> 3.4 whereè‹¥å†™äº†whereä½†ifä¸­æ²¡æœ‰ä¸€ä¸ªæ¡ä»¶æ»¡è¶³ï¼Œåˆ™SQLè¯­å¥ä¼šæ‰§è¡Œå¤±è´¥ å½“ç¼–å†™whereæ ‡ç­¾æ—¶ï¼Œå¦‚æœå†…å®¹ä¸­ç¬¬ä¸€ä¸ªæ˜¯andå»æ‰ç¬¬ä¸€ä¸ªand å¦‚æœ&lt;where&gt;ä¸­æœ‰å†…å®¹ä¼šç”Ÿæˆwhereå…³é”®å­—ï¼Œå¦‚æœæ²¡æœ‰å†…å®¹ä¸ç”Ÿæˆwhereå…³é”®å­— &lt;select id=\"findActiveBlogLike\" resultType=\"Blog\"> SELECT * FROM BLOG &lt;where> &lt;if test=\"state != null\"> state = #{state} &lt;/if> &lt;if test=\"title != null\"> AND title like #{title} &lt;/if> &lt;if test=\"author != null and author.name != null\"> AND author_name like #{author.name} &lt;/if> &lt;/where> &lt;/select> 3.5 setåŠ¨æ€æ›´æ–°ï¼ˆupdateï¼‰è¯­å¥ &lt;update id=\"updateAuthorIfNecessary\"> update Author &lt;set> &lt;if test=\"username != null\">username=#{username},&lt;/if> &lt;if test=\"password != null\">password=#{password},&lt;/if> &lt;if test=\"email != null\">email=#{email},&lt;/if> &lt;if test=\"bio != null\">bio=#{bio}&lt;/if> &lt;/set> where id=#{id} &lt;/update> 3.6 foreachå¯¹ä¸€ä¸ªé›†åˆè¿›è¡Œéå† å¯ä»¥ä¼ å…¥å¯è¿­ä»£å¯¹è±¡ indexæ˜¯å½“å‰è¿­ä»£çš„æ¬¡æ•°ï¼Œitemæ˜¯å½“å‰è¿­ä»£è·å–çš„å…ƒç´  å½“ä½¿ç”¨mapå¯¹è±¡çš„æ—¶å€™ï¼Œindexæ˜¯é”®ï¼Œitemæ˜¯å€¼ &lt;select id=\"selectPostIn\" resultType=\"domain.blog.Post\"> SELECT * FROM POST P WHERE ID in &lt;foreach item=\"item\" index=\"index\" collection=\"list\" open=\"(\" separator=\",\" close=\")\"> #{item} &lt;/foreach> &lt;/select> 3.7 bindbind å…ƒç´ å¯ä»¥ä» OGNL è¡¨è¾¾å¼ä¸­åˆ›å»ºä¸€ä¸ªå˜é‡å¹¶å°†å…¶ç»‘å®šåˆ°ä¸Šä¸‹æ–‡ &lt;select id=\"selectBlogsLike\" resultType=\"Blog\"> &lt;bind name=\"pattern\" value=\"'%' + _parameter.getTitle() + '%'\" /> SELECT * FROM BLOG WHERE title LIKE #{pattern} &lt;/select> 3.8 sqlSQLå…ƒç´ ç”¨æ¥å®šä¹‰èƒ½å¤Ÿè¢«å…¶ä»–è¯­å¥å¼•ç”¨çš„å¯é‡ç”¨çš„SQLè¯­å¥å—ï¼Œä¾‹å¦‚ï¼š &lt;sql id=\"userColumns\">id,username,password&lt;/sql> è¿™ä¸ªSQLè¯­å¥å—èƒ½å¤Ÿè¢«å…¶ä»–è¯­å¥å¼•ç”¨ï¼Œé…ç½®ä»£ç å¦‚ä¸‹: &lt;select id=\"selectUser\" parameterType=\"int\" resultType=\"hashmap\"> select&lt;include refid=\"userColumns\"/> from userinfo where id = #{id} &lt;/select>","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"mybatis","slug":"mybatis","permalink":"https://www.codetool.top/tags/mybatis/"}]},{"title":"leetcode62-ä¸åŒè·¯å¾„","slug":"leetcode62-ä¸åŒè·¯å¾„","date":"2020-02-20T16:23:37.000Z","updated":"2020-04-22T09:27:27.142Z","comments":true,"path":"article/leetcode62-ä¸åŒè·¯å¾„/","link":"","permalink":"https://www.codetool.top/article/leetcode62-%E4%B8%8D%E5%90%8C%E8%B7%AF%E5%BE%84/","excerpt":"","text":"1 åŸé¢˜ä¸€ä¸ªæœºå™¨äººä½äºä¸€ä¸ª m x n ç½‘æ ¼çš„å·¦ä¸Šè§’ ï¼ˆèµ·å§‹ç‚¹åœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œStartâ€ ï¼‰ã€‚ æœºå™¨äººæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚æœºå™¨äººè¯•å›¾è¾¾åˆ°ç½‘æ ¼çš„å³ä¸‹è§’ï¼ˆåœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œFinishâ€ï¼‰ã€‚ é—®æ€»å…±æœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ ä¾‹å¦‚ï¼Œä¸Šå›¾æ˜¯ä¸€ä¸ª7 x 3 çš„ç½‘æ ¼ã€‚æœ‰å¤šå°‘å¯èƒ½çš„è·¯å¾„ï¼Ÿ è¯´æ˜ï¼š m å’Œ n çš„å€¼å‡ä¸è¶…è¿‡ 100ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š m = 3, n = 2è¾“å‡ºï¼š 3è§£é‡Šï¼šä»å·¦ä¸Šè§’å¼€å§‹ï¼Œæ€»å…±æœ‰ 3 æ¡è·¯å¾„å¯ä»¥åˆ°è¾¾å³ä¸‹è§’ã€‚1. å‘å³ -&gt; å‘å³ -&gt; å‘ä¸‹2. å‘å³ -&gt; å‘ä¸‹ -&gt; å‘å³3. å‘ä¸‹ -&gt; å‘å³ -&gt; å‘å³ ç¤ºä¾‹2: è¾“å…¥ï¼š m = 7, n = 3è¾“å‡ºï¼š 28 2 è§£æ³•2.1 æ€æƒ³é€’å½’+è®°å¿†ï¼Œæ¯ä¸ªä½ç½®çš„è·¯å¾„æ•°ä¸ºå³è¾¹ä½ç½®çš„è·¯å¾„æ•°å’Œä¸‹é¢ä½ç½®çš„è·¯å¾„æ•°ä¹‹å’Œã€‚ 2.2 ä»£ç class Solution { Integer[][] paths; public int uniquePaths(int m, int n) { paths = new Integer[m][n]; return getPaths(m,n); } public int getPaths(int m,int n){ if(m&lt;1||n&lt;1) return 0; if(m == 1||n==1) return 1; if(paths[m-1][n-1] != null) return paths[m-1][n-1]; int ans = getPaths(m-1,n)+getPaths(m,n-1); paths[m-1][n-1] = ans; return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"ä½¿ç”¨Mybatiså®ŒæˆCRUD","slug":"ä½¿ç”¨Mybatiså®ŒæˆCRUD","date":"2020-02-20T14:37:25.000Z","updated":"2020-02-21T14:34:29.296Z","comments":true,"path":"article/ä½¿ç”¨Mybatiså®ŒæˆCRUD/","link":"","permalink":"https://www.codetool.top/article/%E4%BD%BF%E7%94%A8Mybatis%E5%AE%8C%E6%88%90CRUD/","excerpt":"","text":"1 å®ä¾‹1.1 POJO: Userpackage com.rhett.domain; import java.io.Serializable; import java.util.Date; public class User implements Serializable { private Integer id; private String username; private String address; private String sex; private Date birthday; public Integer getId() { return id; } public void setId(Integer id) { this.id = id; } public String getUsername() { return username; } public void setUsername(String username) { this.username = username; } public String getAddress() { return address; } public void setAddress(String address) { this.address = address; } public String getSex() { return sex; } public void setSex(String sex) { this.sex = sex; } public Date getBirthday() { return birthday; } public void setBirthday(Date birthday) { this.birthday = birthday; } @Override public String toString() { return \"User [id=\" + id + \", username=\" + username + \", birthday=\" + birthday + \", sex=\" + sex + \", address=\" + address + \"]\"; } } 1.2 DAOæ¥å£package com.rhett.dao; import com.rhett.domain.User; import java.util.List; public interface IUserDao { /** * æŸ¥è¯¢æ‰€æœ‰æ“ä½œ */ List&lt;User> findAll(); /** * ä¿å­˜ç”¨æˆ· * @param user */ void saveUser(User user); /** * æ›´æ–°ç”¨æˆ·ä¿¡æ¯ * @param user */ void updateUser(User user); /** * åˆ é™¤ç”¨æˆ· * @param userId */ void deleteUser(Integer userId); /** * æ ¹æ®idæŸ¥æ‰¾ç”¨æˆ· * @param userId * @return */ User findById(Integer userId); /** * æ¨¡ç³ŠæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ * @param username * @return */ List&lt;User> findByName(String username); /** * æŸ¥è¯¢æ€»ç”¨æˆ·æ•° * @return */ int findTotal(); } 1.3 mapperé…ç½®&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"> &lt;mapper namespace=\"com.rhett.dao.IUserDao\"> &lt;!-- é…ç½®æŸ¥è¯¢æ‰€æœ‰æ“ä½œ --> &lt;select id=\"findAll\" resultType=\"User\"> select * from user &lt;/select> &lt;!-- ä¿å­˜ç”¨æˆ· --> &lt;insert id=\"saveUser\" parameterType=\"User\"> &lt;!-- æ’å…¥æ•°æ®åï¼Œè·å–æ•°æ®çš„id --> &lt;selectKey keyProperty=\"id\" keyColumn=\"id\" resultType=\"int\" order=\"AFTER\"> select last_insert_id(); &lt;/selectKey> insert into user(username,address,sex,birthday) values (#{username},#{address},#{sex},#{birthday}); &lt;/insert> &lt;!-- ä¿å­˜ç”¨æˆ· --> &lt;update id=\"updateUser\" parameterType=\"User\"> update user set username=#{username},address=#{address},sex=#{sex},birthday=#{birthday} where id=#{id}; &lt;/update> &lt;!-- åˆ é™¤ç”¨æˆ· --> &lt;delete id=\"deleteUser\"> delete from user where id = #{uid}; &lt;/delete> &lt;!-- æ ¹æ®idæŸ¥è¯¢ç”¨æˆ· --> &lt;select id=\"findById\" resultType=\"User\"> select * from user where id = #{uid}; &lt;/select> &lt;!-- æ ¹æ®åç§°æ¨¡ç³ŠæŸ¥è¯¢ç”¨æˆ· --> &lt;select id=\"findByName\" resultType=\"User\"> select * from user where username like #{username}; &lt;/select> &lt;!-- è·å–ç”¨æˆ·çš„æ€»è®°å½•æ¡æ•° --> &lt;select id=\"findTotal\" resultType=\"int\"> select count(id) from user; &lt;/select> &lt;/mapper> 1.4 mybatisé…ç½®&lt;?xml version=\"1.0\" encoding=\"utf-8\" ?> &lt;!DOCTYPE configuration PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-config.dtd\"> &lt;configuration> &lt;properties resource=\"db.properties\"/> &lt;settings> &lt;setting name=\"logImpl\" value=\"LOG4J\"/> &lt;/settings> &lt;typeAliases> &lt;package name=\"com.rhett.domain\">&lt;/package> &lt;/typeAliases> &lt;environments default=\"development\"> &lt;environment id=\"development\"> &lt;transactionManager type=\"JDBC\"/> &lt;dataSource type=\"POOLED\"> &lt;property name=\"driver\" value=\"${driver}\"/> &lt;property name=\"url\" value=\"${url}\"/> &lt;property name=\"username\" value=\"${username}\"/> &lt;property name=\"password\" value=\"${password}\"/> &lt;/dataSource> &lt;/environment> &lt;/environments> &lt;mappers> &lt;mapper resource=\"com/rhett/dao/IUserDao.xml\"/> &lt;/mappers> &lt;/configuration> 1.5 æµ‹è¯•ç±»package test; import com.rhett.dao.IUserDao; import com.rhett.domain.User; import org.apache.ibatis.io.Resources; import org.apache.ibatis.session.*; import org.junit.*; import java.io.IOException; import java.io.InputStream; import java.util.Date; import java.util.List; public class MybatisTest { InputStream in; SqlSession session; private IUserDao userDao; @Before public void init() throws IOException { // 1.è¯»å–é…ç½®æ–‡ä»¶ in = Resources.getResourceAsStream(\"mybatis.xml\"); // 2.åˆ›å»ºSqlSessionFactoryå·¥å‚ SqlSessionFactoryBuilder builder = new SqlSessionFactoryBuilder(); SqlSessionFactory factory = builder.build(in); // 3.ä½¿ç”¨å·¥å‚ç”ŸæˆSqlSessionå¯¹è±¡ session = factory.openSession(); // 4.ä½¿ç”¨SqlSessionåˆ›å»ºDaoæ¥å£çš„ä»£ç† userDao = session.getMapper(IUserDao.class); } @After public void destroy() throws IOException { session.commit(); // 6.é‡Šæ”¾èµ„æº session.close(); in.close(); } @Test public void testFindAll() throws IOException { // 5.ä½¿ç”¨ä»£ç†å¯¹è±¡æ‰§è¡Œæ–¹æ³• List&lt;User> users = userDao.findAll(); for(User user:users){ System.out.println(user); } } /** * æµ‹è¯•ä¿å­˜æ“ä½œ */ @Test public void testSave() throws IOException { User user = new User(); user.setUsername(\"mybatis save user get insertedId\"); user.setAddress(\"åŒ—äº¬å¸‚é¡ºä¹‰åŒº\"); user.setSex(\"ç”·\"); user.setBirthday(new Date()); System.out.println(\"ä¿å­˜æ“ä½œä¹‹å‰ï¼š\"+user); // 5.ä½¿ç”¨ä»£ç†å¯¹è±¡æ‰§è¡Œæ–¹æ³• userDao.saveUser(user); System.out.println(\"ä¿å­˜æ“ä½œä¹‹åï¼š\"+user); } /** * æµ‹è¯•æ›´æ–°æ“ä½œ */ @Test public void testUpdate() throws IOException { User user = new User(); user.setId(50); user.setUsername(\"mybatis update user\"); user.setAddress(\"åŒ—äº¬å¸‚é¡ºä¹‰åŒº\"); user.setSex(\"å¥³\"); user.setBirthday(new Date()); // 5.ä½¿ç”¨ä»£ç†å¯¹è±¡æ‰§è¡Œæ–¹æ³• userDao.updateUser(user); } /** * æµ‹è¯•æ›´æ–°æ“ä½œ */ @Test public void testDelete() throws IOException { // 5.ä½¿ç”¨ä»£ç†å¯¹è±¡æ‰§è¡Œæ–¹æ³• userDao.deleteUser(48); } /** * æµ‹è¯•æ›´æ–°æ“ä½œ */ @Test public void testFindOne() throws IOException { // 5.æ‰§è¡ŒæŸ¥è¯¢ä¸€ä¸ªæ–¹æ³• User user = userDao.findById(50); System.out.println(user); } /** * æµ‹è¯•æ¨¡ç³ŠæŸ¥è¯¢ */ @Test public void testFindByName() throws IOException { // 5.ä½¿ç”¨ä»£ç†å¯¹è±¡æ‰§è¡Œæ–¹æ³• List&lt;User> users = userDao.findByName(\"%ç‹%\"); for(User user:users){ System.out.println(user); } } /** * æµ‹è¯•æŸ¥è¯¢æ€»è®°å½•æ¡æ•° */ @Test public void testFindTotal() throws IOException { // 5.ä½¿ç”¨ä»£ç†å¯¹è±¡æ‰§è¡Œæ–¹æ³• int count = userDao.findTotal(); System.out.println(count); } } 2 çŸ¥è¯†ç‚¹2.1 SQLå‚æ•°ç»‘å®š2.1.1 #{}å’Œ${} #{}è¡¨ç¤ºä¸€ä¸ªå ä½ç¬¦ï¼Œå¯ä»¥é˜²æ­¢sqlæ³¨å…¥ ${}è¡¨ç¤ºä¸€ä¸ªæ‹¼æ¥ç¬¦ï¼Œå°†ç›´æ¥æ˜¾ç¤ºåœ¨sqlä¸­ 2.1.2 OGNLè¡¨è¾¾å¼#{}ä¸­ä½¿ç”¨OGNLè¡¨è¾¾å¼ï¼š å®ƒæ˜¯ apache æä¾›çš„ä¸€ç§è¡¨è¾¾å¼è¯­è¨€ï¼Œå…¨ç§°æ˜¯ï¼šObject Graphic Navigation Language å¯¹è±¡å›¾å¯¼èˆªè¯­è¨€å®ƒæ˜¯æŒ‰ç…§ä¸€å®šçš„è¯­æ³•æ ¼å¼æ¥è·å–æ•°æ®çš„ã€‚è¯­æ³•æ ¼å¼å°±æ˜¯ä½¿ç”¨ #{å¯¹è±¡.å¯¹è±¡} çš„æ–¹å¼ æ ¹æ®å‚æ•°ç±»å‹çš„ä¸åŒå¯ä»¥å¡«çš„ä¹Ÿä¸åŒï¼š åŸºæœ¬æ•°æ®ç±»å‹ ä½¿ç”¨#{0},#{1}...çš„æ ¼å¼ ä½¿ç”¨#{param1},{param2}...çš„æ ¼å¼ è°ƒç”¨æ—¶ä½¿ç”¨è‡ªå®šä¹‰å‚æ•°æ³¨è§£@Param(&quot;xx&quot;)ï¼Œåˆ™å¯ä»¥ä½¿ç”¨#{xx} å¯¹è±¡çš„å±æ€§ ä½¿ç”¨#{å±æ€§å} Mapçš„å€¼ ä½¿ç”¨#{Mapçš„é”®} 2.1.3 æ³¨æ„ å½“åªæœ‰ä¸€ä¸ªå‚æ•°çš„æ—¶å€™ä¸”æ•°æ®ç±»å‹æ˜¯åŸºæœ¬ç±»å‹ï¼Œ#{}å†…çš„å†…å®¹å¯ä»¥éšæ„å¡«å†™ é™¤éå‚æ•°æ˜¯Mapç±»å‹ï¼Œå¦åˆ™é…ç½®ä¸­çš„ParameterTypeä¸æ˜¯å¿…å¡« 2.2 äº‹åŠ¡ç®¡ç†å®ç°å¢åˆ æ”¹æ—¶ä¸€å®šè¦å»æ§åˆ¶äº‹åŠ¡çš„æäº¤ï¼Œå¦åˆ™ä¼šé»˜è®¤å›æ»šäº‹åŠ¡ï¼Œä½¿ç”¨SqlSession.commit()æ¥å®ç°äº‹åŠ¡æäº¤ã€‚ 2.3 æ’å…¥æ•°æ®ä¹‹åè·å–idé…ç½®selectKeyæ ‡ç­¾ï¼Œidä¼šè‡ªåŠ¨å°è£…åˆ°å‚æ•°å¯¹è±¡ä¸­ï¼š &lt;insert id=\"saveUser\" parameterType=\"USER\"> &lt;!-- é…ç½®ä¿å­˜æ—¶è·å–æ’å…¥çš„ id --> &lt;selectKey keyColumn=\"id\" keyProperty=\"id\" resultType=\"int\"> select last_insert_id(); &lt;/selectKey> insert into user(username,birthday,sex,address) values (#{username},#{birthday},#{sex},#{address}) &lt;/insert> 2.4 è‡ªåŠ¨å°è£…å‡ºç°å®ä½“ç±»å±æ€§å’Œæ•°æ®åº“å­—æ®µåç§°ä¸ä¸€è‡´è§£å†³æ–¹æ¡ˆï¼š åœ¨SQLæŸ¥è¯¢çš„æ—¶å€™ç»™è¿”å›çš„å­—æ®µç”¨asèµ·åˆ«å ç”¨å®ä½“ç±»ä¸­ç”¨æ³¨è§£ç»™å±æ€§èµ·åˆ«å åœ¨Mapper xmlé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨resultMapé…ç½®å¯¹åº”å…³ç³» &lt;resultMap id=\"userMap\" type=\"com.rhett.domain.User\"> &lt;!--ä¸»é”®å­—æ®µçš„å¯¹åº”--> &lt;id property=\"\" column=\"\"/> &lt;result property=\"\" column=\"\"/> &lt;/resultMap> ç„¶ååœ¨selectæ ‡ç­¾ä¸­ä½¿ç”¨resultMap=â€userMapâ€ä»£æ›¿parameterType &lt;select id=\"findAll\" resultMap=\"userMap\">","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"mybatis","slug":"mybatis","permalink":"https://www.codetool.top/tags/mybatis/"}]},{"title":"leetcode53-æœ€å¤§å­åºå’Œ","slug":"leetcode53-æœ€å¤§å­åºå’Œ","date":"2020-02-20T12:05:06.000Z","updated":"2020-04-22T09:27:27.142Z","comments":true,"path":"article/leetcode53-æœ€å¤§å­åºå’Œ/","link":"","permalink":"https://www.codetool.top/article/leetcode53-%E6%9C%80%E5%A4%A7%E5%AD%90%E5%BA%8F%E5%92%8C/","excerpt":"","text":"1 åŸé¢˜åŸé¢˜ ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾åˆ°ä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚ ç¤ºä¾‹: è¾“å…¥ï¼š [-2,1,-3,4,-1,2,1,-5,4],è¾“å‡ºï¼š 6è§£é‡Šï¼š è¿ç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º 6ã€‚ è¿›é˜¶: å¦‚æœä½ å·²ç»å®ç°å¤æ‚åº¦ä¸º O(n) çš„è§£æ³•ï¼Œå°è¯•ä½¿ç”¨æ›´ä¸ºç²¾å¦™çš„åˆ†æ²»æ³•æ±‚è§£ã€‚ 2 è§£æ³•2.1 æ€æƒ³åŠ¨æ€è§„åˆ’ï¼šä»¥ä¸‹æ ‡0ä¸ºå¼€å§‹çš„ä½ç½®ï¼Œä»å·¦å¾€å³éå†æ•°ç»„ï¼Œè·å¾—ä¸€ä¸ªç´¯åŠ çš„sumï¼Œå¦‚æœé‡åˆ°åœ¨æŸä¸ªä½ç½®sumå°äº0ï¼ˆå³å‰é¢å…ƒç´ å’Œä¸ºè´Ÿæ•°ï¼‰ï¼Œè€Œä¸”å½“å‰ä½ç½®å…ƒç´ å€¼å¤§äºsumï¼Œå°±å¯ä»¥æŠŠèµ·å§‹ä½ç½®è°ƒæ•´è‡³å½“å‰ä½ç½®ã€‚ 2.2 ä»£ç class Solution { public int maxSubArray(int[] nums) { int sum = 0; int max = Integer.MIN_VALUE; for(int i = 0;i&lt;nums.length;i++){ if(nums[i]>=sum&amp;&amp;sum&lt;0){ sum = 0; } sum += nums[i]; if(sum>max) max = sum; } return max; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode5-æœ€é•¿å›æ–‡å­ä¸²","slug":"leetcode5-æœ€é•¿å›æ–‡å­ä¸²","date":"2020-02-19T17:25:24.000Z","updated":"2020-02-19T17:57:51.246Z","comments":true,"path":"article/leetcode5-æœ€é•¿å›æ–‡å­ä¸²/","link":"","permalink":"https://www.codetool.top/article/leetcode5-%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E4%B8%B2/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œæ‰¾åˆ° s ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²ã€‚ä½ å¯ä»¥å‡è®¾ s çš„æœ€å¤§é•¿åº¦ä¸º 1000ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š â€œbabadâ€è¾“å‡ºï¼š â€œbabâ€æ³¨æ„ï¼š â€œabaâ€ ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆç­”æ¡ˆã€‚ ç¤ºä¾‹2: è¾“å…¥ï¼š â€œcbbdâ€è¾“å‡ºï¼š â€œbbâ€ 2 è§£æ³•2.1 æ€æƒ³ä»¥æ¯ä¸ªå­—ç¬¦æˆ–ä¸¤ä¸ªå­—ç¬¦ä¸­é—´çš„ä½ç½®ä¸ºä¸­å¿ƒå‘ä¸¤è¾¹å»¶ç”³çœ‹èƒ½è¾¾åˆ°ä¸¤è¾¹å¯¹ç§°çš„æœ€å¤§é•¿åº¦ï¼Œå¦‚æœè¶…è¿‡è®°å½•çš„æœ€å¤§é•¿åº¦å°±æŠŠstartå’Œendä½ç½®è®°å½•ä¸‹æ¥ï¼Œæœ€åæ ¹æ®startå’Œendè¿”å›å¯¹åº”çš„å­å­—ç¬¦ä¸²ã€‚ 2.2 ä»£ç class Solution { int start = 0; int end = 0; char[] chars; public String longestPalindrome(String s) { if(s.equals(\"\")) return \"\"; chars = s.toCharArray(); for(int i = 0;i&lt;chars.length-1;i++){ expandLength(i,i); expandLength(i,i+1); } return s.substring(start,end+1); } public void expandLength(int left,int right){ if(chars[left] != chars[right]) return; while(left!=0&amp;&amp;right!=chars.length-1&amp;&amp;chars[left-1] == chars[right+1]){ left--; right++; } if(right-left>end-start){ start = left; end = right; } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"LinkedHashMapæºç åˆ†æ","slug":"LinkedHashMapæºç åˆ†æ","date":"2020-02-19T14:58:28.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/LinkedHashMapæºç åˆ†æ/","link":"","permalink":"https://www.codetool.top/article/LinkedHashMap%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","excerpt":"","text":"1 æ€»ç»“æ€»ç»“æ”¾å‰é¢é˜²æ­¢å¤ªé•¿ä¸çœ‹ï¼š LinkedHashMapç»§æ‰¿è‡ªHashMapï¼Œä¸ºEntryé¢å¤–ç»´æŠ¤äº†ä¸¤ä¸ªå±æ€§ï¼šbeforeå’Œafterï¼Œå¯ä»¥æŒ‰ç…§èŠ‚ç‚¹çš„æ’å…¥é¡ºåºæˆ–è€…è®¿é—®é¡ºåºä¸ºEntryç»´æŠ¤ä¸€ä¸ªé“¾è¡¨ï¼Œé»˜è®¤æ˜¯æŒ‰æ’å…¥é¡ºåºæ’åºçš„ï¼Œéå†LinkedHashMapçš„æ—¶å€™å°±æ˜¯é€šè¿‡é“¾è¡¨çš„é¡ºåºè®¿é—®ã€‚ LinkedHashMapå°†è®¿é—®èŠ‚ç‚¹ã€ç§»é™¤èŠ‚ç‚¹ä»è€Œè°ƒæ•´é“¾è¡¨çš„æ“ä½œæ”¾åœ¨äº†afterNodeAccess,afterNodeRemovalä¸­ï¼Œä½†æ’å…¥èŠ‚ç‚¹è°ƒæ•´é“¾è¡¨çš„é€»è¾‘å¹¶ä¸æ˜¯åœ¨afterNodeInsertionä¸­ï¼Œè¿™ä¸ªæ–¹æ³•å¯¹LinkedHashMapæ€»æ˜¯æ— ç”¨çš„ï¼Œç„¶è€Œå­ç±»å¯ä»¥é‡å†™è¿™ä¸ªæ–¹æ³•å®ç°ç±»ä¼¼LRUçš„åŠŸèƒ½ã€‚çœŸæ­£çš„æ’å…¥èŠ‚ç‚¹è°ƒæ•´é“¾è¡¨çš„é€»è¾‘æ”¾åœ¨äº†newNodeå’ŒnewTreeNodeä¸­ã€‚ é™¤äº†ç»´æŠ¤é“¾è¡¨ï¼Œå…¶ä»–æ“ä½œå’ŒHashMapéå¸¸ç±»ä¼¼ã€‚ åœ¨SpringMVCçš„ModelMapä¸­çœ‹è¿‡å®ƒçš„åº”ç”¨ã€‚ 2 æ¦‚è¿°HashMap æ˜¯æ— åºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿­ä»£ HashMap æ‰€å¾—åˆ°çš„å…ƒç´ é¡ºåºå¹¶ä¸æ˜¯å®ƒä»¬æœ€åˆæ”¾ç½®åˆ°HashMap çš„é¡ºåºã€‚HashMap çš„è¿™ä¸€ç¼ºç‚¹å¾€å¾€ä¼šé€ æˆè¯¸å¤šä¸ä¾¿ï¼Œå› ä¸ºåœ¨æœ‰äº›åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ç¡®éœ€è¦ç”¨åˆ°ä¸€ä¸ªå¯ä»¥ä¿æŒæ’å…¥é¡ºåºçš„ Mapã€‚åº†å¹¸çš„æ˜¯ï¼ŒJDK ä¸ºæˆ‘ä»¬è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå®ƒä¸ºHashMap æä¾›äº†ä¸€ä¸ªå­ç±» â€”â€” LinkedHashMapã€‚è™½ç„¶ LinkedHashMap å¢åŠ äº†æ—¶é—´å’Œç©ºé—´ä¸Šçš„å¼€é”€ï¼Œä½†æ˜¯å®ƒé€šè¿‡ç»´æŠ¤ä¸€ä¸ªé¢å¤–çš„åŒå‘é“¾è¡¨ä¿è¯äº†è¿­ä»£é¡ºåºã€‚ç‰¹åˆ«åœ°ï¼Œè¯¥è¿­ä»£é¡ºåºå¯ä»¥æ˜¯æ’å…¥é¡ºåºï¼Œä¹Ÿå¯ä»¥æ˜¯è®¿é—®é¡ºåºã€‚å› æ­¤ï¼Œæ ¹æ®é“¾è¡¨ä¸­å…ƒç´ çš„é¡ºåºå¯ä»¥å°† LinkedHashMap åˆ†ä¸ºï¼šä¿æŒæ’å…¥é¡ºåºçš„ LinkedHashMap å’Œ ä¿æŒè®¿é—®é¡ºåºï¼ˆLRUï¼Œget åè°ƒæ•´é“¾è¡¨åºï¼Œæœ€æ–°è·å–çš„æ”¾åœ¨æœ€åï¼‰çš„ LinkedHashMapï¼Œå…¶ä¸­ LinkedHashMap çš„é»˜è®¤å®ç°æ˜¯æŒ‰æ’å…¥é¡ºåºæ’åºçš„ã€‚ ç ´ä¾‹å…ˆçœ‹ä¸€ä¸‹å®ç°é“¾è¡¨çš„ç»“æ„ï¼š 3 é‡è¦å†…éƒ¨ç±»å’Œå­—æ®µ3.1 EntryLinkedHashMapå®ç°é“¾è¡¨æ˜¯é‡å†™äº†Entryå†…éƒ¨ç±»ï¼Œå°†Entryè¿æˆé“¾è¡¨ï¼š static class Entry&lt;K,V> extends HashMap.Node&lt;K,V> { Entry&lt;K,V> before, after; Entry(int hash, K key, V value, Node&lt;K,V> next) { super(hash, key, value, next); } } å¯è§Entryè®¾è®¡ä¸ºäº†å¯ä½œä¸ºåŒå‘é“¾è¡¨çš„ç»“ç‚¹ã€‚ 3.2 head &amp; tailé“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼š transient LinkedHashMap.Entry&lt;K,V> head; é“¾è¡¨çš„å°¾èŠ‚ç‚¹ï¼š transient LinkedHashMap.Entry&lt;K,V> tail; 3.3 accessOrderfinal boolean accessOrder; è¿™ä¸ªå†³å®šé“¾è¡¨çš„è¿æ¥é¡ºåºï¼ŒaccessOrderä¸ºtrueä»£è¡¨æŒ‰è®¿é—®èŠ‚ç‚¹çš„é¡ºåºï¼Œfalseä»£è¡¨æŒ‰æ’å…¥èŠ‚ç‚¹çš„é¡ºåºã€‚ 4 é‡è¦æ–¹æ³•4.1 puté¦–å…ˆéœ€è¦æ˜ç¡®çš„æ˜¯ï¼ŒLinkedHashMapæ˜¯ç»§æ‰¿è‡ªHashMapï¼Œputæ–¹æ³•å¹¶æ²¡æœ‰é‡å†™ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨ä¹‹å‰HashMapæºç åˆ†æçš„æ—¶å€™æåˆ°putValä¸­æœ‰ä¸€ä¸ªå‚æ•°evictæ²¡æœ‰ç”¨åˆ°ï¼Œå®ƒå°±æ˜¯ä¾›LinkedHashMapä½¿ç”¨çš„ã€‚ public V put(K key, V value) { return putVal(hash(key), key, value, false, true); } 4.1.1 putValfinal V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) { Node&lt;K,V>[] tab; Node&lt;K,V> p; int n, i; if ((tab = table) == null || (n = tab.length) == 0) //resizeï¼Œç»™ä¸€ä¸ªåˆå§‹å®¹é‡ï¼Œnè¢«èµ‹äºˆå®¹é‡å¤§å° n = (tab = resize()).length; //å…ˆè·å–åŸæ¥çš„æ¡¶pï¼Œå¦‚æœhashä¸å†²çªï¼Œç›´æ¥æ’å…¥èŠ‚ç‚¹ if ((p = tab[i = (n - 1) &amp; hash]) == null) tab[i] = newNode(hash, key, value, null); //hashå†²çª else { Node&lt;K,V> e; K k; //è™½ç„¶å“ˆå¸Œå†²çªï¼Œä½†é”®æ˜¯ä¸€æ ·çš„ if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; //å¦‚æœå·²ç»æ˜¯ä¸€æ£µçº¢é»‘æ ‘ else if (p instanceof TreeNode) e = ((TreeNode&lt;K,V>)p).putTreeVal(this, tab, hash, key, value); //æ˜¯é“¾è¡¨ else { for (int binCount = 0; ; ++binCount) { if ((e = p.next) == null) { p.next = newNode(hash, key, value, null); //å¦‚æœbinCountå¤§äºTREEIFY_THRESHOLD - 1ï¼Œåˆ™æ ‘åŒ–ï¼Œå¯ä»¥çŒœæµ‹è½¬çº¢é»‘æ ‘ if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st treeifyBin(tab, hash); break; } //é‡åˆ°äº†ç›¸åŒçš„é”®ï¼Œé€€å‡ºå¾ªç¯ if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; } } if (e != null) { // existing mapping for key V oldValue = e.value; //å¦‚æœonlyIfAbsentä¸ä¸ºtrueæˆ–åŸæ¥çš„valueä¸ºnullï¼Œæ›¿æ¢value if (!onlyIfAbsent || oldValue == null) e.value = value; //å¾…åˆ†æ afterNodeAccess(e); return oldValue; } } ++modCount; //å¤§äºthresholdåˆ™æ‰©å®¹ if (++size > threshold) resize(); //å¾…åˆ†æ afterNodeInsertion(evict); return null; } putValæ–¹æ³•ä¹‹å‰åœ¨åˆ†æHashMapçš„æ—¶å€™åˆ†æè¿‡äº†ï¼Œç°åœ¨å°±æ¥çœ‹çœ‹afterNodeAccess(e)å’ŒafterNodeInsertion(evict)å¹²äº†ä»€ä¹ˆï¼š 4.1.2 afterNodeAccessåœ¨ä¸Šé¢çš„putValæ–¹æ³•çš„é€»è¾‘ä¸­ï¼Œå¦‚æœè·å–çš„èŠ‚ç‚¹ä¹‹å‰å°±å·²ç»å­˜åœ¨ï¼Œå°±ä¼šè°ƒç”¨afterNodeAccessæ–¹æ³•ï¼Œæ ¹æ®æˆ‘ä»¬å¯¹LinkedHashMapæ€§è´¨çš„æ¨æµ‹ï¼Œå¦‚æœé“¾è¡¨é¡ºåºä¸ºaccessOrderï¼Œå°±ä¼šè°ƒæ•´Entryåœ¨é“¾è¡¨ä¸­çš„é¡ºåºã€‚ // æŠŠEntryè°ƒæ•´è‡³é“¾è¡¨å°¾éƒ¨ void afterNodeAccess(Node&lt;K,V> e) { // move node to last LinkedHashMap.Entry&lt;K,V> last; // å¦‚æœaccessOrderä¸ºtrueä¸”é“¾è¡¨å°¾éƒ¨ä¸æ˜¯è¿™ä¸ªèŠ‚ç‚¹æ‰ä¼šè°ƒæ•´ä½ç½® if (accessOrder &amp;&amp; (last = tail) != e) { LinkedHashMap.Entry&lt;K,V> p = (LinkedHashMap.Entry&lt;K,V>)e, b = p.before, a = p.after; p.after = null; if (b == null) head = a; else b.after = a; if (a != null) a.before = b; else last = b; if (last == null) head = p; else { p.before = last; last.after = p; } tail = p; ++modCount; } } 4.1.3 afterNodeInsertion//evictä»£è¡¨æ˜¯ä¸æ˜¯å¤„äºåˆ›å»ºæ¨¡å¼ï¼Œputæ–¹æ³•è°ƒç”¨çš„å°±æ˜¯true void afterNodeInsertion(boolean evict) { // possibly remove eldest LinkedHashMap.Entry&lt;K,V> first; if (evict &amp;&amp; (first = head) != null &amp;&amp; removeEldestEntry(first)) { K key = first.key; removeNode(hash(key), key, null, false, true); } } protected boolean removeEldestEntry(Map.Entry&lt;K,V> eldest) { return false; } è¿™ä¸ªæ–¹æ³•åœ¨LinkedHashMapä¸Šè°ƒç”¨ä¼¼ä¹æ€»æ˜¯æ— ç”¨çš„ï¼Œä½†å­ç±»å¯ä»¥é€šè¿‡é‡å†™removeEldestEntryå®ç°è¯¸å¦‚LRUç­‰åŠŸèƒ½ï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨æ·˜æ±°ï¼‰ é‚£ä¹ˆæŠŠèŠ‚ç‚¹è¿åˆ°é“¾è¡¨å°¾éƒ¨çš„æ–¹æ³•åœ¨å“ªå‘¢ï¼Œå…¶å®åˆ†åˆ«åœ¨newNodeå’ŒnewTreeNodeä¸Šï¼š 4.1.4 newNodeNode&lt;K,V> newNode(int hash, K key, V value, Node&lt;K,V> e) { LinkedHashMap.Entry&lt;K,V> p = new LinkedHashMap.Entry&lt;K,V>(hash, key, value, e); linkNodeLast(p); return p; } 4.1.5 newTreeNodeTreeNode&lt;K,V> newTreeNode(int hash, K key, V value, Node&lt;K,V> next) { TreeNode&lt;K,V> p = new TreeNode&lt;K,V>(hash, key, value, next); linkNodeLast(p); return p; } å¯è§æŠŠèŠ‚ç‚¹è¿åˆ°é“¾è¡¨æœ«ç«¯çš„é€»è¾‘å°±åœ¨linkNodeLastæ–¹æ³•ä¸­ï¼š 4.1.6 linkNodeLastprivate void linkNodeLast(LinkedHashMap.Entry&lt;K,V> p) { LinkedHashMap.Entry&lt;K,V> last = tail; tail = p; if (last == null) head = p; else { p.before = last; last.after = p; } } å°±æ˜¯æŠŠèŠ‚ç‚¹è¿åˆ°tailåé¢ 4.2 getLinkedHashMapé‡å†™äº†getæ–¹æ³•ï¼š public V get(Object key) { Node&lt;K,V> e; if ((e = getNode(hash(key), key)) == null) return null; if (accessOrder) afterNodeAccess(e); return e.value; } getNodeè¿˜æ˜¯HashMapä¸­çš„getNodeï¼Œé€»è¾‘æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å¦‚æœaccessOrderä¸ºtrueï¼Œåœ¨è®¿é—®å®Œä¹‹åä¼šè°ƒç”¨ä¸€æ¬¡afterNodeAccessï¼Œè¿™ä¸ªæ–¹æ³•æˆ‘ä»¬å‰é¢çœ‹è¿‡äº†ï¼Œæ˜¯æŠŠèŠ‚ç‚¹è°ƒè‡³é“¾è¡¨çš„å°¾éƒ¨ã€‚ 4.3 removeremoveè¿˜æ˜¯HashMapä¸­çš„remove: public V remove(Object key) { Node&lt;K,V> e; return (e = removeNode(hash(key), key, null, false, true)) == null ? null : e.value; } 4.3.1 removeNode//åé¢ä¸¤ä¸ªå¸ƒå°”å€¼åˆ†åˆ«ä»£è¡¨æ˜¯å¦è¦æ±‚å€¼åŒ¹é…ï¼Œmovableå¦‚æœæ˜¯falseä¸å…è®¸ç§»åŠ¨å…¶ä»–èŠ‚ç‚¹ final Node&lt;K,V> removeNode(int hash, Object key, Object value, boolean matchValue, boolean movable) { Node&lt;K,V>[] tab; Node&lt;K,V> p; int n, index; if ((tab = table) != null &amp;&amp; (n = tab.length) > 0 &amp;&amp; (p = tab[index = (n - 1) &amp; hash]) != null) { Node&lt;K,V> node = null, e; K k; V v; //å¦‚æœé¦–èŠ‚ç‚¹æ˜¯è¦ç§»é™¤çš„èŠ‚ç‚¹ if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) node = p; else if ((e = p.next) != null) { //å¦‚æœæ˜¯çº¢é»‘æ ‘ if (p instanceof TreeNode) //ä½¿ç”¨getTreeNodeå…ˆè·å–çº¢é»‘æ ‘èŠ‚ç‚¹ node = ((TreeNode&lt;K,V>)p).getTreeNode(hash, key); //å¦‚æœæ˜¯é“¾è¡¨ else { do { if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) { // è·å–é“¾è¡¨èŠ‚ç‚¹ node = e; break; } p = e; } while ((e = e.next) != null); } } //å¦‚æœmatchValueä¸ºtrueï¼Œå¿…é¡»è¦æ¯”å¯¹ç”¨æˆ·ç»™çš„æ—§å€¼æ˜¯å¦æ­£ç¡® if (node != null &amp;&amp; (!matchValue || (v = node.value) == value || (value != null &amp;&amp; value.equals(v)))) { //å¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œè°ƒç”¨è¯¥ç±»çš„removeTreeNodeç§»é™¤èŠ‚ç‚¹ if (node instanceof TreeNode) ((TreeNode&lt;K,V>)node).removeTreeNode(this, tab, movable); //å¦‚æœæ˜¯é“¾è¡¨ï¼Œç”¨é“¾è¡¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ›¿æ¢ else if (node == p) tab[index] = node.next; else p.next = node.next; ++modCount; --size; //å¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ä¸€ä¸ªafterNodeRemovalï¼ŒLinkedHashMapé‡å†™äº†å®ç° afterNodeRemoval(node); return node; } } return null; } å’ŒHashMapçš„åŒºåˆ«å°±æ˜¯åœ¨ç§»é™¤å®ŒèŠ‚ç‚¹ä¹‹åä¼šè°ƒç”¨ä¸€æ¬¡afterNodeRemoval(node) 4.3.2 afterNodeRemovalvoid afterNodeRemoval(Node&lt;K,V> e) { // unlink LinkedHashMap.Entry&lt;K,V> p = (LinkedHashMap.Entry&lt;K,V>)e, b = p.before, a = p.after; p.before = p.after = null; if (b == null) head = a; else b.after = a; if (a == null) tail = b; else a.before = b; } å¯ä»¥çœ‹åˆ°å°±æ˜¯æŠŠnodeå‰åçš„èŠ‚ç‚¹æ¥åœ¨äº†ä¸€èµ·ï¼Œå®ç°äº†ä»é“¾è¡¨ä¸­ç§»é™¤èŠ‚ç‚¹ã€‚ 4.4 entrySetpublic Set&lt;Map.Entry&lt;K,V>> entrySet() { Set&lt;Map.Entry&lt;K,V>> es; return (es = entrySet) == null ? (entrySet = new LinkedEntrySet()) : es; } æ¶‰åŠåˆ°LinkedEntrySetç±»ï¼š 4.4.1 LinkedEntrySetfinal class LinkedEntrySet extends AbstractSet&lt;Map.Entry&lt;K,V>> { public final int size() { return size; } public final void clear() { LinkedHashMap.this.clear(); } public final Iterator&lt;Map.Entry&lt;K,V>> iterator() { return new LinkedEntryIterator(); } //... } å¯ä»¥çœ‹åˆ°è¿­ä»£å™¨å®ç°è‡ªLinkedEntryIteratorï¼Œè·Ÿè¸ªè¿›å»ï¼š 4.4.2 LinkedEntryIteratorfinal class LinkedEntryIterator extends LinkedHashIterator implements Iterator&lt;Map.Entry&lt;K,V>> { public final Map.Entry&lt;K,V> next() { return nextNode(); } } ç»§æ‰¿è‡ªLinkedHashIteratorï¼Œçœ‹åˆ°è¿™é‡Œï¼Œå’ŒHashMapçš„è¿­ä»£å™¨å®ç°å·²ç»éå¸¸åƒäº†ï¼Œä¸è¿‡å¯ä»¥æ¨æµ‹LinkedHashIteratorçš„è¿­ä»£å™¨å°±æ˜¯æŒ‰é“¾è¡¨é¡ºåºè¿”å›èŠ‚ç‚¹ï¼š 4.4.3 LinkedHashIteratorabstract class LinkedHashIterator { LinkedHashMap.Entry&lt;K,V> next; LinkedHashMap.Entry&lt;K,V> current; int expectedModCount; LinkedHashIterator() { //æŠŠnextå®šä½åˆ°head next = head; expectedModCount = modCount; current = null; } public final boolean hasNext() { return next != null; } final LinkedHashMap.Entry&lt;K,V> nextNode() { LinkedHashMap.Entry&lt;K,V> e = next; if (modCount != expectedModCount) throw new ConcurrentModificationException(); if (e == null) throw new NoSuchElementException(); current = e; //nextNodeå°±æ˜¯é“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´  next = e.after; return e; } public final void remove() { Node&lt;K,V> p = current; if (p == null) throw new IllegalStateException(); if (modCount != expectedModCount) throw new ConcurrentModificationException(); current = null; K key = p.key; removeNode(hash(key), key, null, false, false); expectedModCount = modCount; } } éªŒè¯äº†æˆ‘ä»¬çš„çŒœæƒ³ã€‚æ ¹æ®æˆ‘ä»¬å¯¹HashMapçš„äº†è§£å¤§æ¦‚ä¹Ÿå¯ä»¥çŒœæƒ³LinkedHashMapçš„KeySetä¹Ÿæ˜¯é€šè¿‡LinkedHashIteratorå¾—åˆ°èŠ‚ç‚¹ï¼Œä½†åªè¿”å›å®ƒçš„keyã€‚ 4.5 keySetpublic Set&lt;K> keySet() { Set&lt;K> ks = keySet; if (ks == null) { ks = new LinkedKeySet(); keySet = ks; } return ks; } 4.5.1 LinkedKeySetfinal class LinkedKeySet extends AbstractSet&lt;K> { public final int size() { return size; } public final void clear() { LinkedHashMap.this.clear(); } public final Iterator&lt;K> iterator() { return new LinkedKeyIterator(); } //... } 4.5.2 LinkedKeyIteratorfinal class LinkedKeyIterator extends LinkedHashIterator implements Iterator&lt;K> { public final K next() { return nextNode().getKey(); } } éªŒè¯äº†æˆ‘ä»¬çš„çŒœæƒ³ã€‚ 5 æ„é€ æ–¹æ³•public LinkedHashMap() { super(); accessOrder = false; } public LinkedHashMap(int initialCapacity) { super(initialCapacity); accessOrder = false; } public LinkedHashMap(int initialCapacity, float loadFactor) { super(initialCapacity, loadFactor); accessOrder = false; } public LinkedHashMap(int initialCapacity, float loadFactor, boolean accessOrder) { super(initialCapacity, loadFactor); this.accessOrder = accessOrder; } å¯è§é»˜è®¤æ˜¯æŒ‰æ’å…¥é¡ºåºæ’åºçš„ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå®ƒçš„åˆå§‹å®¹é‡ã€è´Ÿè½½å› å­ï¼ˆå’ŒHashMapä¸€æ ·çš„æ‰©å®¹ï¼‰ï¼Œè¦è®¾ç½®å®ƒçš„æ’åºé¡ºåºå¿…é¡»å…ˆè®¾ç½®åˆå§‹å®¹é‡å’Œè´Ÿè½½å› å­ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jdk","slug":"jdk","permalink":"https://www.codetool.top/tags/jdk/"},{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://www.codetool.top/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"}]},{"title":"æ¨¡ä»¿Mybatiså…¥é—¨æ¡ˆä¾‹å®ç°ä¸€ä¸ªORMæ¡†æ¶","slug":"æ¨¡ä»¿Mybatiså…¥é—¨æ¡ˆä¾‹å®ç°ä¸€ä¸ªORMæ¡†æ¶","date":"2020-02-19T14:01:49.000Z","updated":"2020-02-21T14:38:07.517Z","comments":true,"path":"article/æ¨¡ä»¿Mybatiså…¥é—¨æ¡ˆä¾‹å®ç°ä¸€ä¸ªORMæ¡†æ¶/","link":"","permalink":"https://www.codetool.top/article/%E6%A8%A1%E4%BB%BFMybatis%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAORM%E6%A1%86%E6%9E%B6/","excerpt":"","text":"å…¥é—¨æ¡ˆä¾‹å‚è§ï¼š Mybatisä½¿ç”¨ä¸å…¥é—¨æ¡ˆä¾‹ 1 è®¾è®¡åˆ†æmainå‡½æ•°é‡Œéƒ½åœ¨å¹²ä»€ä¹ˆï¼Ÿ // 1.è¯»å–é…ç½®æ–‡ä»¶ // è¿™æ˜¯ç›¸å¯¹ç±»çš„è·¯å¾„ï¼Œè¯»å–é…ç½®æ–‡ä»¶æ—¶é€šå¸¸ä½¿ç”¨ä¸¤ä¸ªæ–¹æ³•ï¼š // a. ç±»åŠ è½½å™¨ b.ä½¿ç”¨ServletContextå¯¹è±¡çš„getRealPath() InputStream in = Resources.getResourceAsStream(\"mybatis.xml\"); // 2.åˆ›å»ºSqlSessionFactoryå·¥å‚ï¼Œæ„å»ºè€…æ¨¡å¼ SqlSessionFactoryBuilder builder = new SqlSessionFactoryBuilder(); SqlSessionFactory factory = builder.build(in); // 3.ä½¿ç”¨å·¥å‚ç”ŸæˆSqlSessionå¯¹è±¡ï¼Œå·¥å‚æ¨¡å¼ SqlSession session = factory.openSession(); // 4.ä½¿ç”¨SqlSessionåˆ›å»ºDaoæ¥å£çš„ä»£ç†ï¼Œä»£ç†æ¨¡å¼ IUserDao userDao = session.getMapper(IUserDao.class); // 5.ä½¿ç”¨ä»£ç†å¯¹è±¡æ‰§è¡Œæ–¹æ³• List&lt;User> users = userDao.findAll(); for(User user:users){ System.out.println(user); } // 6.é‡Šæ”¾èµ„æº session.close(); in.close(); è‡ªå®šä¹‰ORMæ¡†æ¶çš„æ€è·¯ï¼š æ ¹æ®é…ç½®æ–‡ä»¶çš„ä¿¡æ¯åˆ›å»ºConnectionå¯¹è±¡ æ³¨å†Œé©±åŠ¨ï¼Œè·å–è¿æ¥ è·å–é¢„å¤„ç†å¯¹è±¡PreparedStatement æ­¤æ—¶éœ€è¦SQLè¯­å¥ conn.prepareStatement(sql) æ‰§è¡ŒæŸ¥è¯¢ ResultSet set = psm.executeQuery() éå†ç»“æœé›†ç”¨äºå°è£… List list = new ArrayList(); while(resultSet.next()){ E element = xxxx;ï¼ˆé€šè¿‡åå°„ï¼‰ //è¿›è¡Œå°è£… list.add(element); } è¿”å›list return list; 2 å®ç°ä»“åº“åœ°å€ï¼š http://git.codetool.top/RhettPeng/mybatis_design/src/master 2.1 ä½¿ç”¨ç±»åŠ è½½å™¨è¯»å–é…ç½®æ–‡ä»¶public class Resources { /** * æ ¹æ®ä¼ å…¥çš„å‚æ•°ï¼Œè·å–ä¸€ä¸ªå­—èŠ‚è¾“å…¥æµ */ public static InputStream getResourceAsStream(String filePath){ return Resources.class.getClassLoader().getResourceAsStream(filePath); } } 2.2 ä½¿ç”¨è¾“å…¥æµæ„å»ºå·¥å‚public class SqlSessionFactoryBuilder { /** * æ ¹æ®å‚æ•°çš„å­—èŠ‚è¾“å…¥æµæ¥æ„å»ºä¸€ä¸ªSqlSessionFactoryå·¥å‚ * @param config * @return */ public SqlSessionFactory build(InputStream config){ //XMLConfigBuilderç”¨äºè§£æxmlé…ç½®æ–‡ä»¶å¹¶ç”ŸæˆConfigurationå¯¹è±¡ Configuration cfg = XMLConfigBuilder.loadConfiguration(config); return new DefaultSqlSessionFactory(cfg); } } Configurationï¼š public class Configuration { private String driver; private String url; private String username; private String password; private Map&lt;String,Mapper> mappers = new HashMap&lt;>(); //getter &amp; setter... } Configurationé‡Œé¢åŒ…å«äº†æ‰€æœ‰è¯»å‡ºæ¥çš„mapperæ˜ å°„ï¼Œkeyä¸ºå…¨é™å®šç±»å.æ–¹æ³•åï¼Œvalueä¸ºMapperå¯¹è±¡ï¼ŒMapperç±»ï¼š /** * ç”¨äºå°è£…æ‰§è¡Œçš„SQLè¯­å¥å’Œç»“æœç±»å‹çš„å…¨é™å®šç±»å */ public class Mapper { private String queryString;//SQL private String resultType;//è¿”å›ç±»å‹ //getter &amp; setter... } å·¥å‚æ¥å£ï¼š public interface SqlSessionFactory { /** * ç”¨äºåˆ›å»ºä¸€ä¸ªSqlSessionå¯¹è±¡ * @return */ SqlSession openSession(); } 2.3 ä½¿ç”¨å·¥å‚è·å–sessionå¯¹è±¡/** * SqlSessionFactoryæ¥å£çš„å®ç°ç±» */ public class DefaultSqlSessionFactory implements SqlSessionFactory { private Configuration cfg; public DefaultSqlSessionFactory(Configuration cfg){ this.cfg = cfg; } /** * ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„æ“ä½œæ•°æ®åº“å¯¹è±¡ * @return */ @Override public SqlSession openSession() { return new DefaultSqlSession(cfg); } } SqlSessionæ¥å£ï¼š /** * è‡ªå®šä¹‰Mybatiså’Œæ•°æ®åº“äº¤äº’çš„æ ¸å¿ƒç±» * å®ƒé‡Œé¢å¯ä»¥åˆ›å»ºdaoæ¥å£çš„ä»£ç†å¯¹è±¡ */ public interface SqlSession { /** * æ ¹æ®å‚æ•°åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ * @param daoInterfaceClass daoçš„å­—èŠ‚ç  * @param &lt;T> * @return */ &lt;T> T getMapper(Class&lt;T> daoInterfaceClass); /** * é‡Šæ”¾èµ„æº */ void close(); } 2.4 ä½¿ç”¨Sessionè·å–ä¸€ä¸ªmapperå¯¹è±¡è¿™é‡Œä½¿ç”¨äº†åŠ¨æ€ä»£ç†ï¼Œé»˜è®¤SqlSessionå®ç°ï¼š public class DefaultSqlSession implements SqlSession { private Configuration cfg; private Connection connection; public DefaultSqlSession(Configuration cfg){ this.cfg = cfg; this.connection = DataSourceUtil.getConnection(cfg); } /** * ç”¨äºåˆ›å»ºä»£ç†å¯¹è±¡ * @param daoInterfaceClass daoçš„å­—èŠ‚ç  * @param &lt;T> * @return */ //é€šè¿‡ä¼ è¿‡æ¥çš„æ¥å£æ‰¾åˆ°Mapperæ˜ å°„ä¸­å¯¹åº”çš„Mapperå¯¹è±¡ï¼Œç„¶åä½¿ç”¨InvocationHandleræ„å»ºåŠ¨æ€ä»£ç†å¯¹è±¡ @Override public &lt;T> T getMapper(Class&lt;T> daoInterfaceClass) { T mapper = (T)Proxy.newProxyInstance(daoInterfaceClass.getClassLoader(), new Class[]{daoInterfaceClass}, new MapperProxy(cfg.getMappers(), connection)); return mapper; } /** * ç”¨äºé‡Šæ”¾èµ„æº */ @Override public void close() { if(connection!=null){ try { connection.close(); } catch (SQLException e) { e.printStackTrace(); } } } } MapperProxyï¼š public class MapperProxy implements InvocationHandler { //key:å…¨é™å®šç±»å+æ–¹æ³•å private Map&lt;String, Mapper> mappers; private Connection conn; public MapperProxy(Map mappers,Connection conn){ this.mappers = mappers; this.conn = conn; } /** * ç”¨äºå¯¹æ–¹æ³•è¿›è¡Œå¢å¼ºï¼Œè¿™é‡Œå°±æ˜¯è°ƒç”¨selectListæ–¹æ³• * @param proxy * @param method * @param args * @return * @throws Throwable */ @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { //1. è·å–æ–¹æ³•å String methodName = method.getName(); //2. è·å–æ–¹æ³•æ‰€åœ¨ç±»çš„åç§° String className = method.getDeclaringClass().getName(); //3. ç»„åˆkey String key = className+\".\"+methodName; //4. è·å–mappersä¸­çš„mapperå¯¹è±¡ Mapper mapper = mappers.get(key); //5. åˆ¤æ–­æ˜¯å¦æœ‰mapper if(mapper==null){ throw new IllegalArgumentException(\"ä¼ å…¥çš„å‚æ•°æœ‰è¯¯\"); } //6. è°ƒç”¨å·¥å…·ç±»æ‰§è¡ŒæŸ¥è¯¢æ‰€æœ‰ return new Executor().selectList(mapper,conn); } } ç”¨æˆ·å®šä¹‰çš„Mapperï¼š public interface IUserDao { /** * æŸ¥è¯¢æ‰€æœ‰æ“ä½œ */ List&lt;User> findAll(); } 3 æ€»ç»“","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"mybatis","slug":"mybatis","permalink":"https://www.codetool.top/tags/mybatis/"}]},{"title":"Mybatisä½¿ç”¨ä¸å…¥é—¨æ¡ˆä¾‹","slug":"Mybatisä½¿ç”¨ä¸å…¥é—¨æ¡ˆä¾‹","date":"2020-02-18T16:01:34.000Z","updated":"2020-02-21T14:38:07.518Z","comments":true,"path":"article/Mybatisä½¿ç”¨ä¸å…¥é—¨æ¡ˆä¾‹/","link":"","permalink":"https://www.codetool.top/article/Mybatis%E4%BD%BF%E7%94%A8%E4%B8%8E%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B/","excerpt":"","text":"1 å‰ç½®ç¯å¢ƒåˆ›å»ºæ•°æ®åº“è¡¨å¹¶æ·»åŠ æ•°æ®ï¼š DROP TABLE IF EXISTS `user`; CREATE TABLE `user` ( `id` int(11) NOT NULL auto_increment, `username` varchar(32) NOT NULL COMMENT 'ç”¨æˆ·åç§°', `birthday` datetime default NULL COMMENT 'ç”Ÿæ—¥', `sex` char(1) default NULL COMMENT 'æ€§åˆ«', `address` varchar(256) default NULL COMMENT 'åœ°å€', PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; insert into `user`(`id`,`username`,`birthday`,`sex`,`address`) values (41,'è€ç‹','2018-02-27 17:47:08','ç”·','åŒ—äº¬'), (42,'å°äºŒç‹','2018-03-02 15:09:37','å¥³','åŒ—äº¬é‡‘ç‡•é¾™'), (43,'å°äºŒç‹','2018-03-04 11:34:34','å¥³','åŒ—äº¬é‡‘ç‡•é¾™'), (45,'ä¼ æ™ºæ’­å®¢','2018-03-04 12:04:06','ç”·','åŒ—äº¬é‡‘ç‡•é¾™'), (46,'è€ç‹','2018-03-07 17:37:26','ç”·','åŒ—äº¬'), (48,'å°é©¬å®è‰','2018-03-08 11:44:00','å¥³','åŒ—äº¬ä¿®æ­£'); 2 é¡¹ç›®ç»“æ„ 2.1 é…ç½®æ–‡ä»¶[db.properties] driver=com.mysql.cj.jdbc.Driver url=jdbc:mysql://192.168.91.1:3306/test?useUnicode=true&amp;characterEncoding=utf-8&amp;allowMultiQueries=true username=root password=123456 [mybatis.xml] &lt;?xml version=\"1.0\" encoding=\"utf-8\" ?> &lt;!DOCTYPE configuration PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-config.dtd\"> &lt;configuration> &lt;properties resource=\"db.properties\"/> &lt;settings> &lt;setting name=\"logImpl\" value=\"LOG4J\"/> &lt;/settings> &lt;typeAliases> &lt;package name=\"com.rhett.domain\">&lt;/package> &lt;/typeAliases> &lt;environments default=\"development\"> &lt;environment id=\"development\"> &lt;transactionManager type=\"JDBC\"/> &lt;dataSource type=\"POOLED\"> &lt;property name=\"driver\" value=\"${driver}\"/> &lt;property name=\"url\" value=\"${url}\"/> &lt;property name=\"username\" value=\"${username}\"/> &lt;property name=\"password\" value=\"${password}\"/> &lt;/dataSource> &lt;/environment> &lt;/environments> &lt;mappers> &lt;mapper resource=\"com/rhett/dao/IUserDao.xml\"/> &lt;/mappers> &lt;/configuration> 2.2 æ·»åŠ JavaBeanåœ¨domainä¸‹ç¼–å†™beanï¼š package com.rhett.domain; import java.io.Serializable; import java.util.Date; public class User implements Serializable { private Integer id; private String username; private Date birthday; private String sex; private String address; public Integer getId() { return id; } public void setId(Integer id) { this.id = id; } public String getUsername() { return username; } public void setUsername(String username) { this.username = username; } public Date getBirthday() { return birthday; } public void setBirthday(Date birthday) { this.birthday = birthday; } public String getSex() { return sex; } public void setSex(String sex) { this.sex = sex; } public String getAddress() { return address; } public void setAddress(String address) { this.address = address; } @Override public String toString() { return \"User [id=\" + id + \", username=\" + username + \", birthday=\" + birthday + \", sex=\" + sex + \", address=\" + address + \"]\"; } } 2.3 ç¼–å†™Mapperé¦–å…ˆç¼–å†™æ¥å£ç±»IuserDaoï¼š package com.rhett.dao; import com.rhett.domain.User; import org.apache.ibatis.annotations.Select; import java.util.List; public interface IUserDao { /** * æŸ¥è¯¢æ‰€æœ‰æ“ä½œ */ List&lt;User> findAll(); } ç„¶ååœ¨resourceså’ŒåŒ…å¯¹åº”çš„ç›¸åŒæ–‡ä»¶å¤¹ä¸‹ç¼–å†™mapperçš„xmlé…ç½®(IUserDao.xml)ï¼š &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"> &lt;mapper namespace=\"com.rhett.dao.IUserDao\"> &lt;!-- é…ç½®æŸ¥è¯¢æ‰€æœ‰æ“ä½œ --> &lt;select id=\"findAll\" resultType=\"User\"> select * from user &lt;/select> &lt;/mapper> ç„¶ååœ¨mybatis.xmlæ–‡ä»¶ä¸­é…ç½®mapperï¼ˆè§ä¸Šé¢çš„é…ç½®ï¼Œæˆ‘ç”¨äº†åŒ…æ‰«æï¼‰ 2.4 ç¼–å†™æµ‹è¯•ç±»package test; import com.rhett.dao.IUserDao; import com.rhett.domain.User; import org.apache.ibatis.io.Resources; import org.apache.ibatis.session.SqlSession; import org.apache.ibatis.session.SqlSessionFactory; import org.apache.ibatis.session.SqlSessionFactoryBuilder; import java.io.IOException; import java.io.InputStream; import java.util.List; public class MybatisTest { public static void main(String[] args) throws IOException { // 1.è¯»å–é…ç½®æ–‡ä»¶ InputStream in = Resources.getResourceAsStream(\"mybatis.xml\"); // 2.åˆ›å»ºSqlSessionFactoryå·¥å‚ SqlSessionFactoryBuilder builder = new SqlSessionFactoryBuilder(); SqlSessionFactory factory = builder.build(in); // 3.ä½¿ç”¨å·¥å‚ç”ŸæˆSqlSessionå¯¹è±¡ SqlSession session = factory.openSession(); // 4.ä½¿ç”¨SqlSessionåˆ›å»ºDaoæ¥å£çš„ä»£ç† IUserDao userDao = session.getMapper(IUserDao.class); // 5.ä½¿ç”¨ä»£ç†å¯¹è±¡æ‰§è¡Œæ–¹æ³• List&lt;User> users = userDao.findAll(); for(User user:users){ System.out.println(user); } // 6.é‡Šæ”¾èµ„æº session.close(); in.close(); } } è¾“å‡ºï¼š User [id=41, username=è€ç‹, birthday=Wed Feb 28 07:47:08 CST 2018, sex=ç”·, address=åŒ—äº¬] User [id=42, username=å°äºŒç‹, birthday=Sat Mar 03 05:09:37 CST 2018, sex=å¥³, address=åŒ—äº¬é‡‘ç‡•é¾™] User [id=43, username=å°äºŒç‹, birthday=Mon Mar 05 01:34:34 CST 2018, sex=å¥³, address=åŒ—äº¬é‡‘ç‡•é¾™] User [id=45, username=ä¼ æ™ºæ’­å®¢, birthday=Mon Mar 05 02:04:06 CST 2018, sex=ç”·, address=åŒ—äº¬é‡‘ç‡•é¾™] User [id=46, username=è€ç‹, birthday=Thu Mar 08 07:37:26 CST 2018, sex=ç”·, address=åŒ—äº¬] User [id=48, username=å°é©¬å®è‰, birthday=Fri Mar 09 01:44:00 CST 2018, sex=å¥³, address=åŒ—äº¬ä¿®æ­£]3 è¡¥å……ï¼šåŸºäºæ³¨è§£çš„ä¿®æ”¹æ–¹æ³•åœ¨ç¼–å†™æ¥å£çš„æ—¶å€™åŠ ä¸Šæ³¨è§£ï¼š public interface IUserDao { /* * æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ· */ @Select(\"select * from user\") List&lt;User> findAll(); } ç„¶åä¿®æ”¹mybatis.xml &lt;!-- å‘ŠçŸ¥ mybatis æ˜ å°„é…ç½®çš„ä½ç½® --> &lt;mappers> &lt;mapper class=\"com.itheima.dao.IUserDao\"/> &lt;/mappers> å°±å¯ä»¥ä¸ç”¨IUserDao.xmläº†ã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"mybatis","slug":"mybatis","permalink":"https://www.codetool.top/tags/mybatis/"}]},{"title":"Mybatisæ¦‚è¿°å’Œé…ç½®ä»‹ç»","slug":"Mybatisæ¦‚è¿°å’Œé…ç½®ä»‹ç»","date":"2020-02-18T15:25:24.000Z","updated":"2020-02-26T06:48:58.246Z","comments":true,"path":"article/Mybatisæ¦‚è¿°å’Œé…ç½®ä»‹ç»/","link":"","permalink":"https://www.codetool.top/article/Mybatis%E6%A6%82%E8%BF%B0%E5%92%8C%E9%85%8D%E7%BD%AE%E4%BB%8B%E7%BB%8D/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š mybatisçš„é…ç½®æ–‡ä»¶è¯¦è§£(äºŒ) - é‚£ä¸€å¤œ - åšå®¢å›­ MyBatiså†…ç½®å¸¸ç”¨Javaç±»å‹å¯¹åº”çš„åˆ«å_Java_å°è¯¸è‘›çš„åšå®¢-CSDNåšå®¢ Mybatisâ€”typeHandlersé»˜è®¤æ”¯æŒçš„ç±»å‹å¤„ç†å™¨ - æ°´ç—•ç¬ - åšå®¢å›­ 1 æ¦‚è¿°mybatisæ˜¯ä¸€ç§æŒä¹…å±‚æ¡†æ¶ï¼Œä¹Ÿå±äºORMæ˜ å°„ã€‚å‰èº«æ˜¯ibatisã€‚ ç›¸æ¯”äºhibernateï¼š hibernateä¸ºå…¨è‡ªåŠ¨åŒ–ï¼Œé…ç½®æ–‡ä»¶ä¹¦å†™ä¹‹åä¸éœ€è¦ä¹¦å†™sqlè¯­å¥ï¼Œä½†æ˜¯æ¬ ç¼ºçµæ´»ï¼Œå¾ˆå¤šæ—¶å€™éœ€è¦ä¼˜åŒ–ï¼› mybatisä¸ºåŠè‡ªåŠ¨åŒ–ï¼Œéœ€è¦è‡ªå·±ä¹¦å†™sqlè¯­å¥ï¼Œéœ€è¦è‡ªå·±å®šä¹‰æ˜ å°„ã€‚å¢åŠ äº†ç¨‹åºå‘˜çš„ä¸€äº›æ“ä½œï¼Œä½†æ˜¯å¸¦æ¥äº†è®¾è®¡ä¸Šçš„çµæ´»ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯æ”¯æŒhibernateçš„ä¸€äº›ç‰¹æ€§ï¼Œå¦‚å»¶è¿ŸåŠ è½½ï¼Œç¼“å­˜å’Œæ˜ å°„ç­‰ï¼›å¯¹æ•°æ®åº“çš„å…¼å®¹æ€§æ¯”hibernateå·®ã€‚ç§»æ¤æ€§ä¸å¥½ï¼Œä½†æ˜¯å¯ç¼–å†™çµæ´»å’Œé«˜æ€§èƒ½çš„sqlè¯­å¥ã€‚ 1.1 ç‰¹ç‚¹ sqlè¯­å¥ä¸ä»£ç åˆ†ç¦»ï¼Œå­˜æ”¾äºxmlé…ç½®æ–‡ä»¶ä¸­ ç”¨é€»è¾‘æ ‡ç­¾æ§åˆ¶åŠ¨æ€SQLçš„æ‹¼æ¥ æŸ¥è¯¢çš„ç»“æœé›†ä¸javaå¯¹è±¡è‡ªåŠ¨æ˜ å°„ 1.2 æ•´ä½“æ¶æ„ 2 é…ç½®2.1 mavené…ç½®æ„å»ºå»ºè®®ä»æ¨¡æ¿maven-archetype-webappæ„å»º ä¾èµ–ï¼š &lt;dependency> &lt;groupId>org.mybatis&lt;/groupId> &lt;artifactId>mybatis&lt;/artifactId> &lt;version>3.5.4&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>mysql&lt;/groupId> &lt;artifactId>mysql-connector-java&lt;/artifactId> &lt;version>6.0.6&lt;/version> &lt;/dependency> 2.2 å…¨å±€é…ç½®æ–‡ä»¶mybatis-config.xmlconfiguration propertiesï¼ˆå±æ€§ï¼‰ settingsï¼ˆå…¨å±€é…ç½®å‚æ•°ï¼‰ typeAliasesï¼ˆç±»å‹åˆ«åï¼‰ typeHandlersï¼ˆç±»å‹å¤„ç†å™¨ï¼‰ enviromentsï¼ˆç¯å¢ƒé›†åˆå±æ€§å¯¹è±¡ï¼‰ enviromentï¼ˆç¯å¢ƒé…ç½®ï¼‰ transactionManagerï¼ˆäº‹åŠ¡ç®¡ç†ï¼‰ dataSourceï¼ˆæ•°æ®æºï¼‰ mappersï¼ˆæ˜ å°„å™¨ï¼‰ objectFactoryï¼ˆå¯¹è±¡å·¥å‚ï¼‰ pluginsï¼ˆæ’ä»¶ï¼‰ è¿™ä¸ªé…ç½®æ–‡ä»¶çš„ç›®çš„æ˜¯ä¸ºäº†åˆ›å»ºä¸€ä¸ªSqlSeesionFactoryå®ä¾‹å¯¹è±¡ã€‚ 2.2.1 å±æ€§æŒ‡å®šä¸€äº›é”®å€¼å¯¹ï¼Œä½œé…ç½®ç”¨ï¼Œå»ºè®®æŠŠè¿™éƒ¨åˆ†æ”¾åœ¨å¦ä¸€ä¸ªpropertiesæ–‡ä»¶ä¸­ï¼Œç„¶åä½¿ç”¨resourceå±æ€§æŒ‡å®šæ–‡ä»¶ã€‚å¦‚ï¼š [db.properties] driver=com.mysql.jdbc.Driver url=jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf-8&amp;allowMultiQueries=true username=root password=123456 &lt;properties resource=\"db.properties\"/> 2.2.2 å…¨å±€é…ç½®å‚æ•°ç”¨äºé…ç½®ä¸€äº›mybatisçš„å‚æ•°ï¼Œä¾‹å¦‚ä½¿ç”¨çš„æ—¥å¿—æ¡†æ¶ï¼š &lt;settings> &lt;setting name=\"logImpl\" value=\"LOG4J\"/> &lt;/settings> mybatiså¯ä»¥ä½¿ç”¨çš„æ—¥å¿—æ¡†æ¶æœ‰ï¼š SLF4J Apache Commons Logging Log4J2 Log4J JDK logging å¦‚æœæ²¡æœ‰é…ç½®æŒ‡å®šçš„æ—¥å¿—æ¡†æ¶ï¼Œmybatisä¼šæŒ‰è¯¥é¡ºåºæŸ¥æ‰¾ï¼Œä½¿ç”¨æœ€å…ˆæŸ¥æ‰¾åˆ°çš„æ—¥å¿—æ¡†æ¶ã€‚ 2.2.3 ç±»å‹åˆ«åç±»å‹åˆ«åå³æŒ‡å®šjavaç±»å‹çš„ä¸€ä¸ªåˆ«åï¼Œå¯ä»¥åœ¨åé¢é…ç½®Mapperçš„resultTypeå’ŒParameterTypeä¸­ä½¿ç”¨ã€‚ æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥é…ç½®ç±»å‹åˆ«åï¼š å•ç‹¬é…ç½®æŸä¸ªç±» &lt;typeAliases> &lt;typeAlias type=\"com.rhett.po.User\" alise=\"user\"/> &lt;/typeAliases> æ‰«æåŒ… å¦‚ä¸‹é…ç½®ï¼Œé‚£ä¹ˆcom.shsxt.poæ‰€æœ‰ç±»å‹åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­çš„åˆ«åå°±æ˜¯å®ƒä»¬çš„ç±»å &lt;typeAliases> &lt;package name=\"com.rhett.po\" > &lt;typeAliases> é€šè¿‡æ³¨è§£ åœ¨JavaBeanä¸Šæ·»åŠ æ³¨è§£@Alias(&quot;åˆ«å&quot;) éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMybatisæœ‰ä¸€äº›ä¸ºJavaç±»å‹é»˜è®¤é…ç½®çš„åˆ«åï¼š æ˜ å°„åˆ«å Alias Javaçš„ç±»å‹ Mapped Type _byte byte _longyiyi long _short short _int int _integer int _double double _float float _boolean boolean string String byte Byte long Long short Short int Integer integer Integer double Double float Float boolean Boolean date Date decimal BigDecimal bigdecimal BigDecimal object Object map Map hashmap HashMap list List arraylist ArrayList collection Collection iterator Iterator 2.2.4 ç±»å‹å¤„ç†å™¨ç±»å‹å¤„ç†å™¨å°±æ˜¯å¤„ç†æ•°æ®åº“æ•°æ®ç±»å‹å’ŒJavaæ•°æ®ç±»å‹ä¹‹é—´çš„æ˜ å°„ ä¸‹é¢æ˜¯Mybatisé»˜è®¤çš„ç±»å‹å¤„ç†å™¨ ç±»å‹å¤„ç†å™¨ Javaç±»å‹ JDBCç±»å‹ BooleanTypeHandler java.lang.Boolean,boolean æ•°æ®åº“å…¼å®¹çš„ BOOLEAN ByteTypeHandler java.lang.Byte, byte æ•°æ®åº“å…¼å®¹çš„ NUMERIC æˆ– BYTE ShortTypeHandler java.lang.Short, short æ•°æ®åº“å…¼å®¹çš„ NUMERIC æˆ– SHORT INTEGER IntegerTypeHandler java.lang.Integer, int æ•°æ®åº“å…¼å®¹çš„ NUMERIC æˆ– INTEGER LongTypeHandler java.lang.Long, long æ•°æ®åº“å…¼å®¹çš„ NUMERIC æˆ– LONG INTEGER FloatTypeHandler java.lang.Float, float æ•°æ®åº“å…¼å®¹çš„ NUMERIC æˆ– FLOAT DoubleTypeHandler java.lang.Double,double æ•°æ®åº“å…¼å®¹çš„ NUMERIC æˆ– DOUBLE BigDecimalTypeHandler java.math.BigDecimal æ•°æ®åº“å…¼å®¹çš„ NUMERIC æˆ– DECIMAL StringTypeHandler java.lang.String CHAR, VARCHAR ClobReaderTypeHandler java.io.Reader - ClobTypeHandler java.lang.String CLOB, LONGVARCHAR NStringTypeHandler java.lang.String NVARCHAR, NCHAR NClobTypeHandler java.lang.String NCLOB BlobInputStreamTypeHandler java.io.InputStream - ByteArrayTypeHandler byte[] æ•°æ®åº“å…¼å®¹çš„å­—èŠ‚æµç±»å‹ BlobTypeHandler byte[] BLOB, LONGVARBINARY DateTypeHandler java.util.Date TIMESTAMP DateOnlyTypeHandler java.util.Date DATE TimeOnlyTypeHandler java.util.Date TIME SqlTimestampTypeHandler java.sql.Timestamp TIMESTAMP SqlDateTypeHandler java.sql.Date DATE SqlTimeTypeHandler java.sql.Time TIME ObjectTypeHandler Any OTHER æˆ–æœªæŒ‡å®šç±»å‹ EnumTypeHandler Enumeration Type VARCHAR-ä»»ä½•å…¼å®¹çš„å­—ç¬¦ä¸²ç±»å‹ï¼Œå­˜å‚¨æšä¸¾çš„åç§°(è€Œä¸æ˜¯ç´¢å¼•) EnumOrdinalTypeHandler Enumeration Type ä»»ä½•å…¼å®¹çš„ NUMERIC æˆ– DOUBLE ç±»å‹ï¼Œå­˜å‚¨æšä¸¾çš„ç´¢å¼•(è€Œä¸æ˜¯åç§°) æœ‰äº›ç±»å‹Mybatisæ˜¯ä¸æ”¯æŒçš„ï¼Œåªèƒ½ç”¨è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨æ¥å¤„ç†ç›¸åº”çš„ç±»å‹ã€‚ è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨çš„æ–¹æ³•ï¼š å®ç°org.apache.ibatis.type.TypeHandleræ¥å£ï¼ˆsetParameter,getResultï¼‰ ç»§æ‰¿org.apache.ibatis.type.BaseTypeHandler é…ç½®è‡ªå®šä¹‰å¤„ç†å™¨ï¼š &lt;typeHandlers> &lt;typeHandler handler=\"com.rhett.mybatis.typehandler.MyTypeHandler\"/> &lt;/typeHandlers> &lt;!-- æˆ–ä½¿ç”¨æ‰¹é‡æ³¨å†Œçš„æ–¹å¼ï¼Œç±»ä¼¼äºæ‰«æåŒ…--> &lt;typeHandlers> &lt;package name=\"com.rhett.mybatis.typehandler\"/> &lt;/typeHandlers> 2.2.5 ç¯å¢ƒé›†åˆå±æ€§å¯¹è±¡è¿™å…¶å®å°±æ˜¯ä¸€äº›æ•°æ®åº“è¿æ¥æ–¹æ³•çš„é…ç½®ï¼Œä¸åŒçš„åœºåˆå¯ä»¥ä½¿ç”¨ä¸åŒçš„ç¯å¢ƒ MyBatis å¯ä»¥é…ç½®æˆé€‚åº”å¤šç§ç¯å¢ƒï¼Œè¿™ç§æœºåˆ¶æœ‰åŠ©äºå°† SQL æ˜ å°„åº”ç”¨äºå¤šç§æ•°æ®åº“ä¹‹ä¸­ï¼Œ ç°å®æƒ…å†µä¸‹æœ‰å¤šç§ç†ç”±éœ€è¦è¿™ä¹ˆåšã€‚ä¾‹å¦‚ï¼Œå¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒéœ€è¦æœ‰ä¸åŒçš„é…ç½®ï¼›æˆ–è€…å…±äº«ç›¸åŒ Schema çš„å¤šä¸ªç”Ÿäº§æ•°æ®åº“ï¼Œ æƒ³ä½¿ç”¨ç›¸åŒçš„ SQL æ˜ å°„ã€‚è®¸å¤šç±»ä¼¼çš„ç”¨ä¾‹ã€‚ä¸è¿‡è¦è®°ä½ï¼šå°½ç®¡å¯ä»¥é…ç½®å¤šä¸ªç¯å¢ƒï¼Œæ¯ä¸ª ä¸è¿‡è¦è®°ä½ï¼šå°½ç®¡å¯ä»¥é…ç½®å¤šä¸ªç¯å¢ƒï¼Œæ¯ä¸ªSqlSessionFactory å®ä¾‹åªèƒ½é€‰ å®ä¾‹åªèƒ½é€‰æ‹©å…¶ä¸€ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ æƒ³è¿æ¥ä¸¤ä¸ªæ•°æ®åº“ï¼Œå°±éœ€è¦åˆ›å»ºä¸¤ä¸ª SqlSessionFactory å®ä¾‹ï¼Œæ¯ä¸ªæ•°æ®åº“å¯¹åº”ä¸€ä¸ªã€‚è€Œå¦‚æœæ˜¯ä¸‰ä¸ªæ•°æ®åº“ï¼Œå°±éœ€è¦ä¸‰ä¸ªå®ä¾‹ï¼Œä¾æ­¤ç±»æ¨ï¼Œè®°èµ·æ¥å¾ˆç®€å•ï¼š &lt;!-- é…ç½®é»˜è®¤çš„enviroment --> &lt;environments default=\"development\"> &lt;environment id=\"development\"> &lt;!-- typeå¯é€‰JDBCæˆ–MANAGEDï¼Œä»£è¡¨äº‹åŠ¡ç”±è°ç®¡ç†--> &lt;transactionManager type=\"JDBC\"/> &lt;!-- æ˜¯å¦ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± ï¼Œæœ‰POOLED,UNPOOLED,JNDI --> &lt;!-- JNDIå¯ä»¥é€šè¿‡é…ç½®Tomcatæ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ --> &lt;dataSource type=\"POOLED\"> &lt;property name=\"driver\" value=\"${driver}\"/> &lt;property name=\"url\" value=\"${url}\"/> &lt;property name=\"username\" value=\"${username}\"/> &lt;property name=\"password\" value=\"${password}\"/> &lt;/dataSource> &lt;/environment> &lt;environment id=\"test\"> &lt;transactionManager type=\"JDBC\"/> &lt;dataSource type=\"POOLED\"> &lt;property name=\"driver\" value=\"${driver2}\"/> &lt;property name=\"url\" value=\"${url2}\"/> &lt;property name=\"username\" value=\"${username2}\"/> &lt;property name=\"password\" value=\"${password2}\"/> &lt;/dataSource> &lt;/environment> &lt;/environments> 2.2.6 æ˜ å°„å™¨Mapperï¼Œæˆ–è€…è¯´æ˜¯Daoï¼Œå°±æ˜¯æŒä¹…å±‚çš„æ¥å£ã€‚ é…ç½®Mappersçš„å››ç§æ–¹å¼ï¼š é€šè¿‡ç±»è·¯å¾„çš„ç›¸å¯¹ä½ç½®å¯¼å…¥xmlæ–¹å¼çš„æ˜ å°„æ–‡ä»¶ï¼š &lt;mappers> &lt;mapper resource=\"com/rhett/mybatis/mapper/BlogMapper.xml\"/> &lt;mapper resource=\"com/rhett/mybatis/mapper/StudentMapper.xml\"/> &lt;/mappers> é€šè¿‡æ–‡ä»¶ç³»ç»Ÿè·¯å¾„æˆ–WEB URLåœ°å€å¯¼å…¥xmlæ–¹å¼çš„æ˜ å°„æ–‡ä»¶ï¼ˆä¸æ¨èï¼‰ï¼š &lt;mappers> &lt;mapper url=\"file:///F:/IDEA/mybatis02/src/main/resources/mybatis.xml\"/> &lt;/mappers> é€šè¿‡æ˜ å°„æ¥å£ç±»çš„æ–¹å¼å¯¼å…¥æ˜ å°„ç±»ï¼š &lt;mappers> &lt;mapper class=\"com.rhett.mybatis.mapper.UserMapper\"/> &lt;/mappers> æ‰¹é‡æ³¨å†ŒæŒ‡å®šåŒ…ä¸‹é¢æ‰€æœ‰æ¥å£æ˜ å°„ç±»ï¼š &lt;mappers> &lt;package name=\"com.rhett.mybatis.mapper\"/> &lt;/mappers> 2.2.7 å¯¹è±¡å·¥å‚objectFactoryçš„ä½œç”¨ï¼šä½¿ç”¨ç»“æœé›†å®ä¾‹åŒ–å¯¹è±¡ã€‚ è‡ªå®šä¹‰objectFactoryçš„æ–¹æ³•ï¼šç»§æ‰¿DefaultObjectFactory","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"mybatis","slug":"mybatis","permalink":"https://www.codetool.top/tags/mybatis/"}]},{"title":"leetcode435-æ— é‡å åŒºé—´","slug":"leetcode435-æ— é‡å åŒºé—´","date":"2020-02-18T05:12:19.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode435-æ— é‡å åŒºé—´/","link":"","permalink":"https://www.codetool.top/article/leetcode435-%E6%97%A0%E9%87%8D%E5%8F%A0%E5%8C%BA%E9%97%B4/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªåŒºé—´çš„é›†åˆï¼Œæ‰¾åˆ°éœ€è¦ç§»é™¤åŒºé—´çš„æœ€å°æ•°é‡ï¼Œä½¿å‰©ä½™åŒºé—´äº’ä¸é‡å ã€‚ æ³¨æ„: å¯ä»¥è®¤ä¸ºåŒºé—´çš„ç»ˆç‚¹æ€»æ˜¯å¤§äºå®ƒçš„èµ·ç‚¹ã€‚ åŒºé—´ [1,2] å’Œ [2,3] çš„è¾¹ç•Œç›¸äº’â€œæ¥è§¦â€ï¼Œä½†æ²¡æœ‰ç›¸äº’é‡å ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š [ [1,2], [2,3], [3,4], [1,3] ]è¾“å‡ºï¼š 1è§£é‡Šï¼š ç§»é™¤ [1,3] åï¼Œå‰©ä¸‹çš„åŒºé—´æ²¡æœ‰é‡å ã€‚ ç¤ºä¾‹2: è¾“å…¥ï¼š [ [1,2], [1,2], [1,2] ]è¾“å‡ºï¼š 2è§£é‡Šï¼š ä½ éœ€è¦ç§»é™¤ä¸¤ä¸ª [1,2] æ¥ä½¿å‰©ä¸‹çš„åŒºé—´æ²¡æœ‰é‡å ã€‚ ç¤ºä¾‹3: è¾“å…¥ï¼š [ [1,2], [2,3] ]è¾“å‡ºï¼š 0è§£é‡Šï¼š ä½ ä¸éœ€è¦ç§»é™¤ä»»ä½•åŒºé—´ï¼Œå› ä¸ºå®ƒä»¬å·²ç»æ˜¯æ— é‡å çš„äº†ã€‚ 2 è§£æ³•2.1 æ€æƒ³é¦–å…ˆå°†æ‰€æœ‰åŒºé—´æŒ‰å¼€å§‹ä½ç½®æ’åºï¼Œç›¸é‚»ä¸¤ä¸ªåŒºé—´ï¼Œå¦‚æœæœ‰é‡å çš„éƒ¨åˆ†åŒ…å«ä¸¤ç§æƒ…å†µï¼š ä¸€ä¸ªåŒºé—´å®Œå…¨åŒ…å«å¦ä¸€ä¸ªåŒºé—´ï¼Œæ­¤æ—¶åªä¿ç•™è¾ƒå°é‚£ä¸ªåŒºé—´ã€‚ ä¸€ä¸ªåŒºé—´çš„æœ«å°¾ä½äºå¦ä¸€ä¸ªåŒºé—´èŒƒå›´å†…ï¼Œæ­¤æ—¶åªä¿ç•™å‰é¢é‚£ä¸ªåŒºé—´ã€‚ï¼ˆä¸¤ä¸ªåŒºé—´å®Œå…¨é‡åˆæˆ–æœ«å°¾é‡åˆä¹ŸæŒ‰è¿™ç§æƒ…å†µå¤„ç†ï¼‰ è¿™ä¸¤ç§å¤„ç†æ–¹å¼éƒ½æ˜¯åœ¨å±€éƒ¨èŒƒå›´å†…ä¸ºåé¢ä¿ç•™æ›´å¤šçš„ç©ºé—´ã€‚ 2.2 ä»£ç class Solution { public int eraseOverlapIntervals(int[][] intervals) { Arrays.sort(intervals, (array1,array2)->{ return array1[0]-array2[0]; }); int lastIndex = 0; int deleteCount = 0; for(int i = 0;i&lt;intervals.length-1;i++){ if(intervals[lastIndex][1]>intervals[i+1][1]){ deleteCount++; lastIndex = i+1; }else if(intervals[lastIndex][1]>intervals[i+1][0]&amp;&amp;intervals[lastIndex][1]&lt;=intervals[i+1][1]){ deleteCount++; }else{ lastIndex = i+1; } } return deleteCount; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode376-æ‘†åŠ¨åºåˆ—","slug":"leetcode376-æ‘†åŠ¨åºåˆ—","date":"2020-02-17T18:00:44.000Z","updated":"2020-02-17T18:09:01.858Z","comments":true,"path":"article/leetcode376-æ‘†åŠ¨åºåˆ—/","link":"","permalink":"https://www.codetool.top/article/leetcode376-%E6%91%86%E5%8A%A8%E5%BA%8F%E5%88%97/","excerpt":"","text":"1 åŸé¢˜å¦‚æœè¿ç»­æ•°å­—ä¹‹é—´çš„å·®ä¸¥æ ¼åœ°åœ¨æ­£æ•°å’Œè´Ÿæ•°ä¹‹é—´äº¤æ›¿ï¼Œåˆ™æ•°å­—åºåˆ—ç§°ä¸ºæ‘†åŠ¨åºåˆ—ã€‚ç¬¬ä¸€ä¸ªå·®ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰å¯èƒ½æ˜¯æ­£æ•°æˆ–è´Ÿæ•°ã€‚å°‘äºä¸¤ä¸ªå…ƒç´ çš„åºåˆ—ä¹Ÿæ˜¯æ‘†åŠ¨åºåˆ—ã€‚ ä¾‹å¦‚ï¼Œ [1,7,4,9,2,5] æ˜¯ä¸€ä¸ªæ‘†åŠ¨åºåˆ—ï¼Œå› ä¸ºå·®å€¼ (6,-3,5,-7,3) æ˜¯æ­£è´Ÿäº¤æ›¿å‡ºç°çš„ã€‚ç›¸å, [1,4,7,2,5] å’Œ [1,7,4,5,5] ä¸æ˜¯æ‘†åŠ¨åºåˆ—ï¼Œç¬¬ä¸€ä¸ªåºåˆ—æ˜¯å› ä¸ºå®ƒçš„å‰ä¸¤ä¸ªå·®å€¼éƒ½æ˜¯æ­£æ•°ï¼Œç¬¬äºŒä¸ªåºåˆ—æ˜¯å› ä¸ºå®ƒçš„æœ€åä¸€ä¸ªå·®å€¼ä¸ºé›¶ã€‚ ç»™å®šä¸€ä¸ªæ•´æ•°åºåˆ—ï¼Œè¿”å›ä½œä¸ºæ‘†åŠ¨åºåˆ—çš„æœ€é•¿å­åºåˆ—çš„é•¿åº¦ã€‚ é€šè¿‡ä»åŸå§‹åºåˆ—ä¸­åˆ é™¤ä¸€äº›ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ï¼‰å…ƒç´ æ¥è·å¾—å­åºåˆ—ï¼Œå‰©ä¸‹çš„å…ƒç´ ä¿æŒå…¶åŸå§‹é¡ºåºã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š [1,7,4,9,2,5]è¾“å‡ºï¼š 6è§£é‡Šï¼š æ•´ä¸ªåºåˆ—å‡ä¸ºæ‘†åŠ¨åºåˆ—ã€‚ ç¤ºä¾‹2: è¾“å…¥ï¼š [1,17,5,10,13,15,10,5,16,8]è¾“å‡ºï¼š 7è§£é‡Šï¼š è¿™ä¸ªåºåˆ—åŒ…å«å‡ ä¸ªé•¿åº¦ä¸º 7 æ‘†åŠ¨åºåˆ—ï¼Œå…¶ä¸­ä¸€ä¸ªå¯ä¸º[1,17,10,13,10,16,8]ã€‚ ç¤ºä¾‹3: è¾“å…¥ï¼š [1,2,3,4,5,6,7,8,9]è¾“å‡ºï¼š 2 è¿›é˜¶:ä½ èƒ½å¦ç”¨ O(n) æ—¶é—´å¤æ‚åº¦å®Œæˆæ­¤é¢˜? 2 è§£æ³•2.1 æ€æƒ³æ•´ä¸ªæ•°ç»„è¦è·å¾—æœ€å¤šçš„èƒ½ç»„æˆæ‘†åŠ¨åºåˆ—çš„æ•°å­—ï¼Œå°±æ˜¯å–å³°é¡¶å’Œè°·åº•å€¼ï¼Œè€Œæˆ‘ä»¬åªéœ€è¦è·å–ä¸ªæ•°å°±è¡Œäº†ï¼Œå¯ä»¥è®°å½•æ•´ä¸ªå˜åŒ–æ³¢å½¢é€’å¢å’Œé€’å‡çš„æ¬¡æ•°ã€‚ 2.2 ä»£ç class Solution { public int wiggleMaxLength(int[] nums) { if(nums.length == 0) return 0; if(nums.length == 1) return 1; int sum = 1; boolean isDown = false; boolean isUp = false; boolean haveBeenFirst = false; for(int i = 0;i&lt;nums.length-1;i++){ //å¦‚æœä¹‹å‰æ˜¯ä¸Šå‡çš„ç°åœ¨ä¸‹é™ if((isDown&amp;&amp;nums[i+1]>nums[i])||(isUp&amp;&amp;nums[i+1]&lt;nums[i])){ sum++; isUp = !isUp; isDown = !isDown; //éœ€è¦æ³¨æ„è®°å½•ç¬¬ä¸€æ¬¡çš„ä¸Šå‡æˆ–ä¸‹é™ }else if(!haveBeenFirst&amp;&amp;nums[i+1]!=nums[i]){ sum++; isUp = nums[i+1]>nums[i]; isDown = nums[i+1]&lt;nums[i]; haveBeenFirst = true; } } return sum; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ‹‰å¸®ç»“æ´¾çš„æ•°æ®ç»“æ„-å¹¶æŸ¥é›†","slug":"æ‹‰å¸®ç»“æ´¾çš„æ•°æ®ç»“æ„-å¹¶æŸ¥é›†","date":"2020-02-17T12:41:03.000Z","updated":"2020-02-17T12:46:25.386Z","comments":true,"path":"article/æ‹‰å¸®ç»“æ´¾çš„æ•°æ®ç»“æ„-å¹¶æŸ¥é›†/","link":"","permalink":"https://www.codetool.top/article/%E6%8B%89%E5%B8%AE%E7%BB%93%E6%B4%BE%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%B9%B6%E6%9F%A5%E9%9B%86/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š è¶…è¶…æœ‰çˆ±çˆ±â€”â€“å¹¶æŸ¥é›†~_chen_zan_yu_çš„åšå®¢-CSDNåšå®¢ 1 æ¦‚è¿°å¹¶æŸ¥é›†é€šå¸¸ç”¨ä½œé›†åˆçš„åˆå¹¶ã€‚ å¹¶æŸ¥é›†æ˜¯ä¸€ç§æ ‘å½¢ç»“æ„ï¼Œåˆå«â€œä¸ç›¸äº¤é›†åˆâ€ï¼Œä¿æŒäº†ä¸€ç»„ä¸ç›¸äº¤çš„åŠ¨æ€é›†åˆï¼Œæ¯ä¸ªé›†åˆé€šè¿‡ä¸€ä¸ªä»£è¡¨æ¥è¯†åˆ«ï¼Œä»£è¡¨å³é›†åˆä¸­çš„æŸä¸ªæˆå‘˜ï¼Œé€šå¸¸é€‰æ‹©æ ¹åšè¿™ä¸ªä»£è¡¨ã€‚ æˆ‘ä»¬å…ˆæ¥ä»‹ç»ä¸€ä¸‹å¹¶æŸ¥é›†çš„æ€æƒ³ï¼š å‡è®¾æˆ‘ä»¬ç°åœ¨å·²çŸ¥ä¸€äº›è¿é€šå…³ç³»ï¼Œä¾‹å¦‚(2,4),(1,2),(5,6),(3,4),(2,3)ï¼Œæˆ‘ä»¬ç”¨ä¸€å¼ å›¾æ¥è¡¨ç¤ºè¿™ä¸ªå…³ç³»ï¼š ç°åœ¨æˆ‘ä»¬ç”¨å¹¶æŸ¥é›†çš„æ€æƒ³æŠŠå®ƒåˆ†æˆå‡ ä¸ªä¸è¿é€šçš„é›†åˆï¼š é¦–å…ˆæˆ‘ä»¬æœ‰ä¸€ä¸ªfatheræ•°ç»„ï¼Œå®ƒè®°å½•çš„æ˜¯åœ¨å¹¶æŸ¥é›†è¿™ä¸ªæ ‘å½¢ç»“æ„ä¸­ï¼ŒæŸä¸ªèŠ‚ç‚¹å¯¹åº”çš„çˆ¶èŠ‚ç‚¹æ˜¯å“ªä¸ªï¼Œç”¨æ•°ç»„è¡¨ç¤ºï¼Œä¸€å¼€å§‹å…¨ä¸º0ã€‚ æˆ‘ä»¬æŠŠ(2,4)è¿™ä¸ªå…³ç³»å–å‡ºæ¥ï¼Œæ¯æ¬¡è¦åšçš„æ“ä½œå°±æ˜¯æŠŠå®ƒä»¬çš„æ ¹èŠ‚ç‚¹è¿æ¥èµ·æ¥ï¼ˆä¸€ç›´å¯»æ‰¾çˆ¶èŠ‚ç‚¹ç›´åˆ°å¯¹åº”çš„fatherä¸º0ï¼‰ï¼Œè¿™é‡Œå°±æŠŠ4è¿æ¥åˆ°2ä¸Šï¼Œç„¶åä¿®æ”¹father[4]çš„å€¼ä¸º2. å†å¤„ç†(1,2)è¿™ä¸ªå…³ç³»ï¼Œç”±äºæ­¤æ—¶1å’Œ2çš„æ ¹èŠ‚ç‚¹æ˜¯å®ƒæœ¬èº«ï¼Œä¹Ÿæ˜¯å°†ä»–ä»¬è¿èµ·æ¥ã€‚æŠŠfather[1]ä¿®æ”¹ä¸º2ã€‚ 5å’Œ6çš„æ ¹èŠ‚ç‚¹ä¹Ÿæ˜¯å®ƒæœ¬èº«ï¼Œå°†ä»–ä»¬è¿èµ·æ¥ï¼Œfather[6]ä¿®æ”¹ä¸º6ã€‚ è¿™é‡Œå‘ç°3çš„æ ¹èŠ‚ç‚¹æ˜¯3ï¼Œ4çš„æ ¹èŠ‚ç‚¹æ˜¯2ï¼Œäºæ˜¯æŠŠ2å’Œ3è¿æ¥èµ·æ¥ã€‚æŠŠfather[2]ä¿®æ”¹ä¸º3ã€‚ æœ€åå¤„ç†(2,3)çš„æ—¶å€™å‘ç°2å’Œ3çš„æ ¹èŠ‚ç‚¹éƒ½æ˜¯3ï¼Œäºæ˜¯ä¸åšå¤„ç†ã€‚ æœ€åå¾—åˆ°çš„é›†åˆæœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯æ•°ç»„ä¸­å€¼ä¸º0çš„3å’Œ5ã€‚ 2 æ“ä½œä¸Šé¢çš„å›¾ä¸­æˆ‘ä»¬ä¸ºäº†æ¨¡æ‹Ÿè‡ªç„¶æ€æƒ³ï¼Œæ•°ç»„çš„ä¸‹æ ‡ä»1å¼€å§‹ï¼Œè€Œå®é™…ç¼–ç¨‹çš„æ—¶å€™æ•°ç»„ä¸‹æ ‡ä»0å¼€å§‹ï¼Œæ ¹æ®é™åˆ¶å¯ä»¥æŠŠæ²¡æœ‰çˆ¶èŠ‚ç‚¹çš„å…ƒç´ çš„å€¼è®¾ä¸º-1ï¼Œä¹Ÿå¯ä»¥å°±è®¾ä¸ºè¯¥å…ƒç´ çš„ä¸‹æ ‡ï¼Œä¹Ÿå¯ä»¥æŠŠä¸‹æ ‡ä¸º0çš„æ•°ç»„å…ƒç´ ç©ºå‡ºæ¥ï¼Œå¯¹javaæ¥è¯´å°±ä¸ç”¨ä¸€å¼€å§‹å°±æŠŠæ•°ç»„èµ‹ä¸€éå€¼ã€‚ å¹¶æŸ¥é›†çš„æ ¸å¿ƒæ“ä½œæœ‰ä¸¤ä¸ªï¼š find_root(x): è¿”å›èƒ½ä»£è¡¨xæ‰€åœ¨é›†åˆçš„èŠ‚ç‚¹ï¼Œé€šå¸¸è¿”å›xæ‰€åœ¨é›†åˆçš„æ ¹èŠ‚ç‚¹ï¼Œæœ‰é€’å½’å’Œéé€’å½’ä¸¤ç§æ–¹æ³•ã€‚ union(x, y): å°†åŒ…å«x,yçš„é›†åˆåˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„é›†åˆã€‚åˆå¹¶ä¸¤ä¸ªé›†åˆçš„å…³é”®æ˜¯æ‰¾åˆ°ä¸¤ä¸ªé›†åˆçš„æ ¹èŠ‚ç‚¹ï¼Œå¦‚æœä¸¤ä¸ªæ ¹èŠ‚ç‚¹ç›¸åŒåˆ™ä¸ç”¨åˆå¹¶ï¼›å¦‚æœä¸åŒï¼Œåˆ™éœ€è¦åˆå¹¶ã€‚ class UnionFind { int[] father; //æ„é€ å‡½æ•°ï¼Œè¿™é‡ŒæŠŠå®ƒä»¬å…¨éƒ¨èµ‹å€¼ä¸º-1ï¼Œä»£è¡¨æ²¡æœ‰çˆ¶èŠ‚ç‚¹ public UnionFind(int totalNodes) { father = new int[totalNodes]; Arrays.fill(father,-1); } //åˆå¹¶ä¸¤ä¸ªé›†åˆï¼Œå³å°†å®ƒä»¬çš„æ ¹èŠ‚ç‚¹è¿æ¥ã€‚ void union(int node1, int node2) { int root1 = find_root(node1); int root2 = find_root(node2); if (root1 != root2) { father[root2] = root1; } } // æ‰¾åˆ°ä¸€ä¸ªæ•°ç»„å…ƒç´ å¯¹åº”çš„æ ¹èŠ‚ç‚¹ int find_root(int node) { while (father[node] != -1) node = father[node]; return node; } //æ£€æŸ¥ä¸¤ä¸ªæ•°ç»„å…ƒç´ ä»£è¡¨çš„é›†åˆæ˜¯ä¸æ˜¯ç›¸è¿çš„ï¼Œå¦‚æœæ˜¯è¯´æ˜å®ƒä»¬çš„æ ¹èŠ‚ç‚¹æ˜¯ç›¸åŒçš„ boolean isConnected(int node1, int node2) { return find_root(node1) == find_root(node2); } } 3 æ“ä½œä¼˜åŒ–å¹¶æŸ¥é›†çš„ä¼˜åŒ–ä¸»è¦åŒ…æ‹¬ï¼š åˆå¹¶æ—¶å¹³è¡¡æ ‘çš„é«˜åº¦ï¼ˆæ¯”è¾ƒè¦åˆå¹¶çš„ä¸¤ä¸ªæ ‘çš„é«˜åº¦ï¼‰ã€‚ æŸ¥è¯¢æ—¶çš„ä¼˜åŒ–ï¼šè·¯å¾„å‹ç¼© å¹³è¡¡æ ‘çš„é«˜åº¦è¿™é‡Œä¸è¯¦ç»†è®²ã€‚ è·¯å¾„å‹ç¼©å°±æ˜¯æ¯æ¬¡æŸ¥è¯¢çš„æ—¶å€™éƒ½ä¼šé¡ºç€è·¯å¾„æŸ¥æ‰¾ï¼Œæœ€ç»ˆæ‰¾åˆ°æ ¹èŠ‚ç‚¹ã€‚è€Œæ‰¾åˆ°äº†æ ¹èŠ‚ç‚¹ä¹‹åå¯ä»¥å°†æŸ¥è¯¢çš„èŠ‚ç‚¹çš„fatherç›´æ¥è¿åˆ°æ ¹èŠ‚ç‚¹ä¸Šï¼Œå®é™…ä¸Šä¹Ÿæ˜¯å‡å°æ ‘çš„é«˜åº¦ã€‚ 4 ç®—æ³•é¢˜è®²è§£4.1 åŸé¢˜è“æ¡¥æ¯å†å±Šè¯•é¢˜ åˆæ ¹æ¤ç‰© é—®é¢˜æè¿° wæ˜Ÿçƒçš„ä¸€ä¸ªç§æ¤å›­ï¼Œè¢«åˆ†æˆ m * n ä¸ªå°æ ¼å­ï¼ˆä¸œè¥¿æ–¹å‘mè¡Œï¼Œå—åŒ—æ–¹å‘nåˆ—ï¼‰ã€‚æ¯ä¸ªæ ¼å­é‡Œç§äº†ä¸€æ ªåˆæ ¹æ¤ç‰©ã€‚è¿™ç§æ¤ç‰©æœ‰ä¸ªç‰¹ç‚¹ï¼Œå®ƒçš„æ ¹å¯èƒ½ä¼šæ²¿ç€å—åŒ—æˆ–ä¸œè¥¿æ–¹å‘ä¼¸å±•ï¼Œä»è€Œä¸å¦ä¸€ä¸ªæ ¼å­çš„æ¤ç‰©åˆæˆä¸ºä¸€ä½“ã€‚ å¦‚æœæˆ‘ä»¬å‘Šè¯‰ä½ å“ªäº›å°æ ¼å­é—´å‡ºç°äº†è¿æ ¹ç°è±¡ï¼Œä½ èƒ½è¯´å‡ºè¿™ä¸ªå›­ä¸­ä¸€å…±æœ‰å¤šå°‘æ ªåˆæ ¹æ¤ç‰©å—ï¼Ÿ è¾“å…¥æ ¼å¼ ç¬¬ä¸€è¡Œï¼Œä¸¤ä¸ªæ•´æ•°mï¼Œnï¼Œç”¨ç©ºæ ¼åˆ†å¼€ï¼Œè¡¨ç¤ºæ ¼å­çš„è¡Œæ•°ã€åˆ—æ•°ï¼ˆ1&lt;m,n&lt;1000ï¼‰ã€‚æ¥ä¸‹æ¥ä¸€è¡Œï¼Œä¸€ä¸ªæ•´æ•°kï¼Œè¡¨ç¤ºä¸‹é¢è¿˜æœ‰kè¡Œæ•°æ®(0&lt;k&lt;100000)æ¥ä¸‹æ¥kè¡Œï¼Œç¬¬è¡Œä¸¤ä¸ªæ•´æ•°aï¼Œbï¼Œè¡¨ç¤ºç¼–å·ä¸ºaçš„å°æ ¼å­å’Œç¼–å·ä¸ºbçš„å°æ ¼å­åˆæ ¹äº†ã€‚ æ ¼å­çš„ç¼–å·ä¸€è¡Œä¸€è¡Œï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œä»å·¦åˆ°å³ç¼–å·ã€‚æ¯”å¦‚ï¼š5 * 4 çš„å°æ ¼å­ï¼Œç¼–å·ï¼š1 2 3 45 6 7 89 10 11 1213 14 15 1617 18 19 20 æ ·ä¾‹è¾“å…¥ 5 4162 31 55 94 87 89 1010 1111 1210 1412 1614 1817 1815 1919 209 1313 17 æ ·ä¾‹è¾“å‡º5 æ ·ä¾‹è¯´æ˜ å…¶åˆæ ¹æƒ…å†µå‚è€ƒä¸‹å›¾ 4.2 è§£ç­”è¿™å°±æ˜¯ä¸€é“å®Œå…¨ä¸åŠ ä¿®é¥°ï¼Œå‡ ä¹è¦æ˜ç¤ºä½ è¿™é“é¢˜åº”è¯¥è¦ç”¨å¹¶æŸ¥é›†çš„ç®—æ³•é¢˜ã€‚æŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„è®²è§£ï¼Œå¯ä»¥å†™å‡ºå¦‚ä¸‹ä»£ç ï¼š import java.util.Scanner; public class Main { static int[] father; public static void main(String[] args) { Scanner scanner = new Scanner(System.in); //å…ˆç®—å‡ºæ•°ç»„çš„å¤§å°ï¼Œè¿™é‡Œæˆ‘ä»¬ä»ä¸‹æ ‡ä¸º1å¼€å§‹è®°å½•æ•°æ®ï¼Œå°±å¯ä»¥ç”¨0æ¥ä»£è¡¨æ²¡æœ‰çˆ¶èŠ‚ç‚¹äº†ã€‚ father = new int[scanner.nextInt()*scanner.nextInt()+1]; int n = scanner.nextInt(); for(int i = 0;i &lt; n;i ++){ union(scanner.nextInt(),scanner.nextInt()); } int sum = 0; //çœ‹çœ‹åˆå¹¶å®Œä¹‹åè¿˜æœ‰å¤šå°‘ä¸ªæ²¡æœ‰çˆ¶èŠ‚ç‚¹çš„å…ƒç´ ï¼Œå°±æ˜¯é›†åˆçš„ä¸ªæ•° for(int i = 1;i&lt;father.length;i++){ if(father[i] == 0) sum+=1; } System.out.println(sum); } //åˆå¹¶ä¸¤ä¸ªé›†åˆï¼Œå³å°†å®ƒä»¬çš„æ ¹èŠ‚ç‚¹è¿æ¥ã€‚ static void union(int node1, int node2) { int root1 = find_root(node1); int root2 = find_root(node2); if (root1 != root2) father[root2] = root1; } // æ‰¾åˆ°ä¸€ä¸ªæ•°ç»„å…ƒç´ å¯¹åº”çš„æ ¹èŠ‚ç‚¹ï¼Œè¿™é‡Œç”±äºæ•´é“é¢˜æˆ‘ä»¬åªéœ€è¦æŸ¥æ‰¾ä¸€æ¬¡å°±ä¸ä¼˜åŒ–äº†ã€‚ static int find_root(int node) { while (father[node] != 0) node = father[node]; return node; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"},{"name":"è“æ¡¥æ¯","slug":"è“æ¡¥æ¯","permalink":"https://www.codetool.top/tags/%E8%93%9D%E6%A1%A5%E6%9D%AF/"}]},{"title":"ç®—æ³•ç«èµ›å¸¸ç”¨æ•°æ®ç»“æ„-å­—å…¸æ ‘Trie","slug":"ç®—æ³•ç«èµ›å¸¸ç”¨æ•°æ®ç»“æ„-å­—å…¸æ ‘Trie","date":"2020-02-17T05:56:24.000Z","updated":"2020-04-30T05:51:44.702Z","comments":true,"path":"article/ç®—æ³•ç«èµ›å¸¸ç”¨æ•°æ®ç»“æ„-å­—å…¸æ ‘Trie/","link":"","permalink":"https://www.codetool.top/article/%E7%AE%97%E6%B3%95%E7%AB%9E%E8%B5%9B%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%AD%97%E5%85%B8%E6%A0%91Trie/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š è¯¦è°ˆæ ‘ç»“æ„ï¼ˆä¼ ç»Ÿæ ‘ã€å­—å…¸æ ‘ã€hash æ ‘ã€Merkle Patricia Treeï¼‰_C/C++_smilejiasmileçš„åšå®¢-CSDNåšå®¢ 1 æ¦‚è¿°Tireæ ‘ç§°ä¸ºå­—å…¸æ ‘ï¼Œåˆç§°å•è¯æŸ¥æ‰¾æ ‘ï¼ŒTrieæ ‘ï¼Œæ˜¯ä¸€ç§æ ‘å½¢ç»“æ„ï¼Œæ˜¯ä¸€ç§å“ˆå¸Œæ ‘çš„å˜ç§ã€‚ï¼ˆé«˜æ•ˆæŸ¥æ‰¾çš„æ•°æ®ç»“æ„-HashTreeï¼ˆå“ˆå¸Œæ ‘ï¼‰ï¼‰å…¸å‹åº”ç”¨æ˜¯ç”¨äºç»Ÿè®¡ï¼Œæ’åºå’Œä¿å­˜å¤§é‡çš„å­—ç¬¦ä¸²ï¼ˆä½†ä¸ä»…é™äºå­—ç¬¦ä¸²ï¼‰ï¼Œæ‰€ä»¥ç»å¸¸è¢«æœç´¢å¼•æ“ç³»ç»Ÿç”¨äºæ–‡æœ¬è¯é¢‘ç»Ÿè®¡ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ï¼šåˆ©ç”¨å­—ç¬¦ä¸²çš„å…¬å…±å‰ç¼€æ¥å‡å°‘æŸ¥è¯¢æ—¶é—´ï¼Œæœ€å¤§é™åº¦åœ°å‡å°‘æ— è°“çš„å­—ç¬¦ä¸²æ¯”è¾ƒï¼ŒæŸ¥è¯¢æ•ˆç‡æ¯”å“ˆå¸Œæ ‘é«˜ã€‚ Trieæ ‘çš„ç¼ºç‚¹æ˜¯å®ƒéå¸¸æ¶ˆè€—ç©ºé—´ã€‚ Trieæ ‘çš„ä¸‰ä¸ªåŸºæœ¬æ€§è´¨ï¼š æ ¹èŠ‚ç‚¹ä¸åŒ…å«å­—ç¬¦ï¼Œé™¤æ ¹èŠ‚ç‚¹å¤–æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½åªåŒ…å«ä¸€ä¸ªå­—ç¬¦ï¼› ä»æ ¹èŠ‚ç‚¹åˆ°æŸä¸€èŠ‚ç‚¹ï¼Œè·¯å¾„ä¸Šç»è¿‡çš„å­—ç¬¦è¿æ¥èµ·æ¥ï¼Œä¸ºè¯¥èŠ‚ç‚¹å¯¹åº”çš„å­—ç¬¦ä¸²ï¼› æ¯ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹åŒ…å«çš„å­—ç¬¦éƒ½ä¸ç›¸åŒã€‚ 2 Trieæ ‘ç»“æ„ ä»æ ¹èŠ‚ç‚¹åˆ°æŸä¸€èŠ‚ç‚¹ï¼Œè·¯å¾„ä¸Šç»è¿‡çš„å­—ç¬¦è¿æ¥èµ·æ¥ï¼Œä¸ºè¯¥èŠ‚ç‚¹å¯¹åº”çš„å­—ç¬¦ä¸²ã€‚ Trieæ ‘çš„åº”ç”¨æœ‰ï¼š ç»´æŠ¤å­—ç¬¦ä¸²é›†åˆï¼ˆå³å­—å…¸ï¼‰ã€‚ å‘å­—ç¬¦ä¸²é›†åˆä¸­æ’å…¥å­—ç¬¦ä¸²ï¼ˆå³å»ºæ ‘ï¼‰ã€‚ æŸ¥è¯¢å­—ç¬¦ä¸²é›†åˆä¸­æ˜¯å¦æœ‰æŸä¸ªå­—ç¬¦ä¸²ï¼ˆå³æŸ¥è¯¢ï¼‰ã€‚ ç»Ÿè®¡å­—ç¬¦ä¸²åœ¨é›†åˆä¸­å‡ºç°çš„ä¸ªæ•°ï¼ˆå³ç»Ÿè®¡ï¼‰ã€‚ å°†å­—ç¬¦ä¸²é›†åˆæŒ‰å­—å…¸åºæ’åºï¼ˆå³å­—å…¸åºæ’åºï¼‰ã€‚ æ±‚é›†åˆå†…ä¸¤ä¸ªå­—ç¬¦ä¸²çš„LCPï¼ˆLongest Common Prefixï¼Œæœ€é•¿å…¬å…±å‰ç¼€ï¼‰ï¼ˆå³æ±‚æœ€é•¿å…¬å…±å‰ç¼€ï¼‰ã€‚ å¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯è¦ç»´æŠ¤ä¸€ä¸ªkey-valueå¯¹ï¼Œkeyå°±æ˜¯è¿™ä¸ªä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹å½¢æˆçš„å­—ç¬¦ä¸²ï¼Œè€Œvalueä¿¡æ¯å°±å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ï¼Œä¾‹å¦‚æ±‰è‹±å­—å…¸å»æŸ¥ä¸€ä¸ªå•è¯çš„ä¸­æ–‡ç¿»è¯‘ã€‚ javaä»£ç å®ç°ï¼šï¼ˆæ ¹æ®ä¸åŒçš„åº”ç”¨å¯ä»¥è®¾è®¡ä¸åŒçš„å®ç°ï¼‰ class Node{ int num;//æœ‰å¤šå°‘å•è¯é€šè¿‡è¿™ä¸ªèŠ‚ç‚¹,å³ç”±æ ¹è‡³è¯¥èŠ‚ç‚¹ç»„æˆçš„å­—ç¬¦ä¸²æ¨¡å¼å‡ºç°çš„æ¬¡æ•° Node[] children = new Node[26];//æ‰€æœ‰çš„å­èŠ‚ç‚¹ Object data;// å¦‚æœæ˜¯å¶å­èŠ‚ç‚¹å¯ä»¥å­˜å‚¨æ•°æ®ã€‚ } 3 ç®—æ³•é¢˜ç¤ºä¾‹ä½ è€ƒå…¥å¤§åŸå¸‚æ²™åªåçš„å­¦æ ¡ï¼Œ ä½†æ˜¯æ²™åªåçš„å½“åœ°äººè¯´ç€ä¸€ç§å¾ˆéš¾æ‡‚çš„æ–¹è¨€ï¼Œ ä½ å®Œå…¨å¬ä¸æ‡‚ã€‚ å¹¸å¥½ä½ æ‰‹ä¸­æœ‰æœ¬å­—å…¸å¯ä»¥å¸®ä½ ã€‚ ç°åœ¨ä½ æœ‰è‹¥å¹²ä¸ªå¬ä¸æ‡‚çš„æ–¹è¨€éœ€è¦æŸ¥è¯¢å­—å…¸ã€‚ è¾“å…¥æ ¼å¼ï¼šç¬¬ä¸€è¡Œï¼Œä¸¤ä¸ªæ•´æ•°nå’Œmã€‚æ¥ä¸‹æ¥æœ‰nè¡Œè¡¨ç¤ºå­—å…¸çš„å†…å®¹ï¼Œæ¯è¡Œè¡¨ç¤ºä¸€æ¡å­—å…¸çš„è®°å½•ã€‚æ¯æ¡è®°å½•åŒ…å«ä¸¤ä¸ªç©ºæ ¼é—´éš”çš„å•è¯ï¼Œç¬¬ä¸€ä¸ªå•è¯ä¸ºè‹±æ–‡å•è¯ï¼Œç¬¬äºŒä¸ªå•è¯ä¸ºå¯¹åº”çš„æ²™åªåæ–¹è¨€ã€‚æ¥ä¸‹æ¥æœ‰mè¡Œï¼Œæ¯è¡Œä¸€ä¸ªå•è¯ï¼Œè¡¨ç¤ºä½ è¦æŸ¥è¯¢çš„æ²™åªåæ–¹è¨€ã€‚ è¾“å‡ºæ ¼å¼ï¼šè¾“å‡ºmè¡Œï¼Œæ¯è¡Œä¸€ä¸ªè‹±æ–‡å•è¯ï¼Œè¡¨ç¤ºç¿»è¯‘åçš„ç»“æœã€‚å¦‚æœæŸä¸ªå•è¯å­—å…¸æŸ¥ä¸åˆ°ï¼Œè¾“å‡ºâ€ehâ€ æ ·ä¾‹è¾“å…¥ï¼š5 3dog ogdaycat atcaypig igpayfroot ootfrayloops oopslayatcayittenkayoopslayæ ·ä¾‹è¾“å‡ºï¼šcatehloops æ³¨ï¼šæ‰€æœ‰å•è¯éƒ½ç”¨å°å†™å­—æ¯è¡¨ç¤ºï¼Œ ä¸”é•¿åº¦ä¸è¶…è¿‡10ã€‚ è§£ç­”ï¼š static class Node{ Node[] children = new Node[26];//æ‰€æœ‰çš„å­èŠ‚ç‚¹ String data;// å¦‚æœæ˜¯å¶å­èŠ‚ç‚¹å¯ä»¥å­˜å‚¨æ•°æ®ã€‚ } public static void main(String[] args) { Scanner scanner = new Scanner(System.in); int referCount = scanner.nextInt(); int targetCount = scanner.nextInt(); Node root = new Node(); for(int i = 0;i&lt;referCount;i++){ String origin = scanner.next(); char[] refer = scanner.next().toCharArray(); Node node = root; for(int n = 0;n&lt;refer.length;n++){ if(node.children[refer[n]-'a'] != null) { node = node.children[refer[n]-'a']; continue; } node = (node.children[refer[n]-'a'] = new Node()); if(n == refer.length-1) node.data = origin; } } for(int i = 0;i&lt;targetCount;i++){ char[] toFind = scanner.next().toCharArray(); Node node = root; boolean isFind = true; for(int n = 0;n&lt;toFind.length;n++){ if((node = node.children[toFind[n]-'a'])!=null) continue; isFind = false; break; } System.out.println(isFind?node.data:\"eh\"); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"leetcode135-åˆ†å‘ç³–æœ","slug":"leetcode135-åˆ†å‘ç³–æœ","date":"2020-02-17T05:16:20.000Z","updated":"2020-04-22T09:27:27.142Z","comments":true,"path":"article/leetcode135-åˆ†å‘ç³–æœ/","link":"","permalink":"https://www.codetool.top/article/leetcode135-%E5%88%86%E5%8F%91%E7%B3%96%E6%9E%9C/","excerpt":"","text":"1 åŸé¢˜è€å¸ˆæƒ³ç»™å­©å­ä»¬åˆ†å‘ç³–æœï¼Œæœ‰ N ä¸ªå­©å­ç«™æˆäº†ä¸€æ¡ç›´çº¿ï¼Œè€å¸ˆä¼šæ ¹æ®æ¯ä¸ªå­©å­çš„è¡¨ç°ï¼Œé¢„å…ˆç»™ä»–ä»¬è¯„åˆ†ã€‚ ä½ éœ€è¦æŒ‰ç…§ä»¥ä¸‹è¦æ±‚ï¼Œå¸®åŠ©è€å¸ˆç»™è¿™äº›å­©å­åˆ†å‘ç³–æœï¼š æ¯ä¸ªå­©å­è‡³å°‘åˆ†é…åˆ° 1 ä¸ªç³–æœã€‚ ç›¸é‚»çš„å­©å­ä¸­ï¼Œè¯„åˆ†é«˜çš„å­©å­å¿…é¡»è·å¾—æ›´å¤šçš„ç³–æœã€‚ é‚£ä¹ˆè¿™æ ·ä¸‹æ¥ï¼Œè€å¸ˆè‡³å°‘éœ€è¦å‡†å¤‡å¤šå°‘é¢—ç³–æœå‘¢ï¼Ÿ ç¤ºä¾‹1: è¾“å…¥ï¼š [1,0,2]è¾“å‡ºï¼š 5è§£é‡Šï¼š ä½ å¯ä»¥åˆ†åˆ«ç»™è¿™ä¸‰ä¸ªå­©å­åˆ†å‘ 2ã€1ã€2 é¢—ç³–æœã€‚ ç¤ºä¾‹2: è¾“å…¥ï¼š [1,2,2]è¾“å‡ºï¼š 4è§£é‡Šï¼š ä½ å¯ä»¥åˆ†åˆ«ç»™è¿™ä¸‰ä¸ªå­©å­åˆ†å‘ 1ã€2ã€1 é¢—ç³–æœã€‚ç¬¬ä¸‰ä¸ªå­©å­åªå¾—åˆ° 1 é¢—ç³–æœï¼Œè¿™å·²æ»¡è¶³ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶ã€‚ 2 è§£æ³•2.1 æ€æƒ³è¦æ»¡è¶³ç›¸é‚»çš„å­©å­ä¸­ï¼Œè¯„åˆ†é«˜çš„å­©å­å¿…é¡»è·å¾—æ›´å¤šçš„ç³–æœï¼Œå¯ä»¥è¿›è¡Œå·¦å³å„ä¸€æ¬¡åŠ¨æ€è§„åˆ’ï¼Œæ¯æ¬¡åªä¿è¯æ»¡è¶³ä¸€è¾¹è¯„åˆ†é«˜çš„å­©å­è·å¾—æ›´å¤šç³–æœã€‚ 2.2 ä»£ç class Solution { public int candy(int[] ratings) { int length = ratings.length; int[] left = new int[length]; int[] right = new int[length]; for(int i = 1; i &lt; length; i++) if(ratings[i] > ratings[i - 1]) left[i] = left[i - 1] + 1; int count = left[length - 1]; for(int i = length - 2; i >= 0; i--) { if(ratings[i] > ratings[i + 1]) right[i] = right[i + 1] + 1; count += Math.max(left[i], right[i]); } return count+length; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"é«˜æ•ˆæŸ¥æ‰¾çš„æ•°æ®ç»“æ„-HashTreeï¼ˆå“ˆå¸Œæ ‘ï¼‰","slug":"é«˜æ•ˆæŸ¥æ‰¾çš„æ•°æ®ç»“æ„-HashTreeï¼ˆå“ˆå¸Œæ ‘ï¼‰","date":"2020-02-16T18:14:52.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/é«˜æ•ˆæŸ¥æ‰¾çš„æ•°æ®ç»“æ„-HashTreeï¼ˆå“ˆå¸Œæ ‘ï¼‰/","link":"","permalink":"https://www.codetool.top/article/%E9%AB%98%E6%95%88%E6%9F%A5%E6%89%BE%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-HashTree%EF%BC%88%E5%93%88%E5%B8%8C%E6%A0%91%EF%BC%89/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š ç—´äººè¯´Hash - å“ˆå¸Œæ ‘ (HashTree)_Java_PinusLeeé˜³å…‰ç¿çƒ‚çš„ç”Ÿæ´»-CSDNåšå®¢ æŸ¥æ‰¾â€”â€”å›¾æ–‡ç¿”è§£HashTreeï¼ˆå“ˆå¸Œæ ‘ï¼‰_Java_èœé¸Ÿçš„è‡ªç•™åœ°-mooyang-CSDNåšå®¢ è¯¥æ•°æ®ç»“æ„çš„è®¾è®¡è€…ç¼–å†™çš„æ–‡æ¡£ï¼šå“ˆå¸Œæ ‘HashTree - ç™¾åº¦æ–‡åº“ 1 æ¦‚è¿°äºŒå‰æ’åºæ ‘ï¼Œå¹³è¡¡äºŒå‰æ ‘ï¼Œçº¢é»‘æ ‘ç­‰äºŒå‰æ’åºæ ‘åœ¨æ•°æ®é‡å¤§çš„æ—¶å€™æ ‘é«˜å¾ˆæ·±ï¼Œæˆ‘ä»¬ä¸æ–­å‘ä¸‹æ‰¾å¯»å€¼æ—¶ä¼šæ¯”è¾ƒå¾ˆå¤šæ¬¡ã€‚äºŒå‰æ’åºæ ‘è‡ªèº«æ˜¯æœ‰é¡ºåºç»“æ„çš„ï¼Œæ¯ä¸ªç»“ç‚¹é™¤æœ€å°ç»“ç‚¹å’Œæœ€å¤§ç»“ç‚¹å¤–éƒ½æœ‰å‰é©±å’Œåç»§ï¼Œä¸è®ºæ˜¯æ’åºè¿˜æ˜¯æœç´¢å®ƒçš„ç»¼åˆæ€§èƒ½æ¯”è¾ƒå¥½ï¼Œä½†æ˜¯å•ç‹¬åœ¨æœç´¢è¿™ä¸€æ–¹é¢äºŒå‰æ’åºæ ‘çš„æ€§èƒ½å°±æ²¡æœ‰è¿™æ¬¡è¦è®²çš„Hashæ ‘å¿«äº†ã€‚ 2 ç†è®ºåŸºç¡€Hashæ ‘çš„ç†è®ºåŸºç¡€ä¸ºè´¨æ•°åˆ†è¾¨å®šç†ï¼š nä¸ªä¸åŒçš„è´¨æ•°å¯ä»¥â€œåˆ†è¾¨â€çš„è¿ç»­æ•´æ•°çš„ä¸ªæ•°å’Œä»–ä»¬çš„ä¹˜ç§¯ç›¸ç­‰ã€‚â€œåˆ†è¾¨â€å°±æ˜¯æŒ‡è¿™äº›è¿ç»­çš„æ•´æ•°ä¸å¯èƒ½æœ‰å®Œå…¨ç›¸åŒçš„ä½™æ•°åºåˆ—ã€‚ åŸºäºè¿™ä¸ªç†è®ºï¼Œå‡è®¾æˆ‘ä»¬å–å‰åä¸ªç´ æ•°ï¼Œèƒ½åˆ†è¾¨çš„æ•´æ•°æœ‰2*3*5*7*9*...*29 = 6 469 693 230ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæœ‰21äº¿ä¸ªæ•°å­—çš„è¯ï¼Œæˆ‘ä»¬æŸ¥æ‰¾çš„å“ªæ€•æ˜¯æœ€åº•å±‚çš„ä¹Ÿä»…ä»…éœ€è¦è®¡ç®—10æ¬¡å°±èƒ½æ‰¾åˆ°å¯¹åº”çš„æ•°å­—ï¼Œè€Œè¿™å·²ç»è¶…å‡ºintç±»å‹çš„èŒƒå›´ã€‚ è€Œè¿™ä¸ªè¦åˆ†è¾©çš„æ•´æ•°ï¼Œå¯ä»¥æ˜¯æ•°æ®åº“ä¸­çš„ä¸»é”®ï¼Œå¯ä»¥æ˜¯å”¯ä¸€æ ‡è¯†æŸä¸€å¯¹è±¡çš„å“ˆå¸Œç ï¼ˆä¸ç”¨å“ˆå¸Œå‡½æ•°ï¼Œä¿è¯ä¸åŒå¯¹è±¡çš„å“ˆå¸Œç ä¸å†²çªï¼‰ã€‚ 3 å“ˆå¸Œæ ‘çš„å®ç°å“ˆå¸Œæ ‘çš„ç»“æ„ï¼šæ¯ä¸€å±‚èŠ‚ç‚¹çš„æœ€å¤§å­èŠ‚ç‚¹æ•°éƒ½ä¸ä¸€æ ·ï¼Œå¯¹åº”è¿™ä¸€å±‚ä»£è¡¨çš„è´¨æ•°å€¼ï¼š javaä»£ç ï¼š private class Node{ //å®šä¹‰äº†ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œæ¯ä¸€ä¸ªç»“ç‚¹ä¼šæœ‰ä¸€ä¸ªnextæ•°ç»„ public Node[] next = null; //ç”¨æ¥è£…å­èŠ‚ç‚¹çš„ä¸‹æ ‡è¡¨ç¤ºä½™æ•° public Integer data = 0; //æ•°å€¼ public boolean isDel = false; //æ˜¯å¦è¢«åˆ é™¤çš„æ ‡è®°ï¼Œä½œåˆ é™¤ç”¨ public Node(Integer data,Integer level){ //æ„é€ å‡½æ•° next = new Node[level]; this.data = data; } public Node(Integer data){ //æ„é€ å‡½æ•° this.data = data; } } 3.1 æ’å…¥æ±‚ä½™çœ‹å¯¹åº”ä½ç½®çš„ç»“ç‚¹ï¼Œå¦‚æœä¸ºç©ºåˆ™åœ¨ç©ºå¤„æ’å…¥ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œå¦‚æœè¢«é€»è¾‘åˆ é™¤äº†æ›¿æ¢å€¼å†é€»è¾‘æ¢å¤ï¼Œå¦‚æœæœ‰å€¼å°±ç»§ç»­å¾€ä¸‹æ‰¾ï¼Œç»§ç»­æ±‚ä½™åˆ¤æ–­ã€‚ 3.2 æŸ¥æ‰¾æŸ¥æ‰¾å’Œæ’å…¥çš„é€»è¾‘ä¸€æ ·ï¼ŒæŒ‰é™¤ä½™çš„æ–¹æ³•ä¸€ç›´æ‰¾åˆ°æŸä¸ªä½ç½® 3.3 åˆ é™¤HashTreeçš„åˆ é™¤èŠ‚ç‚¹å¹¶ä¸è¦æ±‚çœŸæ­£åˆ é™¤èŠ‚ç‚¹ï¼Œåªéœ€è¦é€»è¾‘æ€§åœ°åˆ é™¤èŠ‚ç‚¹ï¼Œå…ˆæŒ‰æŸ¥æ‰¾çš„æ–¹æ³•è·å–å¯¹åº”èŠ‚ç‚¹ï¼ŒæŠŠèŠ‚ç‚¹çš„isDelæ ‡è®°ä¸ºtrueï¼Œè¿™æ ·å¦‚æœæ–°åŠ å…¥èŠ‚ç‚¹éœ€è¦æ”¾åœ¨è¿™ä¸ªä½ç½®ä¹Ÿèƒ½ç›´æ¥æ›¿æ¢å®ƒã€‚","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"æ•°æ®åº“ç†è®ºä¹‹OLTPä¸OLAP","slug":"æ•°æ®åº“ç†è®ºä¹‹OLTPä¸OLAP","date":"2020-02-16T14:56:19.000Z","updated":"2020-03-25T04:37:42.650Z","comments":true,"path":"article/æ•°æ®åº“ç†è®ºä¹‹OLTPä¸OLAP/","link":"","permalink":"https://www.codetool.top/article/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%90%86%E8%AE%BA%E4%B9%8BOLTP%E4%B8%8EOLAP/","excerpt":"","text":"1 OLTPOLTP å³è”æœºäº‹åŠ¡å¤„ç†ï¼Œå°±æ˜¯æˆ‘ä»¬ç»å¸¸è¯´çš„å…³ç³»æ•°æ®åº“ï¼Œæ„å³è®°å½•å³æ—¶çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥ï¼Œå°±æ˜¯æˆ‘ä»¬ç»å¸¸åº”ç”¨çš„ä¸œè¥¿ï¼Œä¸»è¦ä¾›åŸºå±‚äººå‘˜ä½¿ç”¨ï¼Œè¿›è¡Œä¸€çº¿ä¸šåŠ¡æ“ä½œï¼Œè¿™æ˜¯æ•°æ®åº“çš„åŸºç¡€ã€‚ å¯¹äºå„ç§æ•°æ®åº“ç³»ç»Ÿç¯å¢ƒä¸­å¤§å®¶æœ€å¸¸è§çš„ OLTP ç³»ç»Ÿï¼Œå…¶ç‰¹ç‚¹æ˜¯å¹¶å‘é‡å¤§ï¼Œæ•´ä½“æ•°æ®é‡æ¯”è¾ƒå¤šï¼Œä½†æ¯æ¬¡è®¿é—®çš„æ•°æ®æ¯”è¾ƒå°‘ï¼Œä¸”è®¿é—®çš„æ•°æ®æ¯”è¾ƒç¦»æ•£ï¼Œæ´»è·ƒæ•°æ®å æ€»ä½“æ•°æ®çš„æ¯”ä¾‹ä¸æ˜¯å¤ªå¤§ã€‚å¯¹äºè¿™ç±»ç³»ç»Ÿçš„æ•°æ®åº“å®é™…ä¸Šæ˜¯æœ€éš¾ç»´æŠ¤ï¼Œæœ€éš¾ä»¥ä¼˜åŒ–çš„ï¼Œå¯¹ä¸»æœºæ•´ä½“æ€§èƒ½è¦æ±‚ä¹Ÿæ˜¯æœ€é«˜çš„ã€‚å› ä¸ºä¸ä»…è®¿é—®é‡å¾ˆé«˜ï¼Œæ•°æ®é‡ä¹Ÿä¸å°ã€‚ é’ˆå¯¹ä¸Šé¢çš„è¿™äº›ç‰¹ç‚¹å’Œåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ OLTP çš„å¾—å‡ºä¸€ä¸ªå¤§è‡´çš„æ–¹å‘ã€‚ è™½ç„¶ç³»ç»Ÿæ€»ä½“æ•°æ®é‡è¾ƒå¤§ï¼Œä½†æ˜¯ç³»ç»Ÿæ´»è·ƒæ•°æ®åœ¨æ•°æ®æ€»é‡ä¸­æ‰€å çš„æ¯”ä¾‹ä¸å¤§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰©å¤§å†…å­˜å®¹é‡æ¥å°½å¯èƒ½å¤šçš„å°†æ´»è·ƒæ•°æ® cache åˆ°å†…å­˜ä¸­ï¼›è™½ç„¶ IO è®¿é—®éå¸¸é¢‘ç¹ï¼Œä½†æ˜¯æ¯æ¬¡è®¿é—®çš„æ•°æ®é‡è¾ƒå°‘ä¸”å¾ˆç¦»æ•£ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯¹ç£ç›˜å­˜å‚¨çš„è¦æ±‚æ˜¯ IOPS(Input/Output Operations Per Secondï¼Œå³æ¯ç§’è¿›è¡Œè¯»å†™æ“ä½œçš„æ¬¡æ•°)è¡¨ç°è¦å¾ˆå¥½ï¼Œååé‡æ˜¯æ¬¡è¦å› ç´ ï¼› å¹¶å‘é‡å¾ˆé«˜ï¼ŒCPU æ¯ç§’æ‰€è¦å¤„ç†çš„è¯·æ±‚è‡ªç„¶ä¹Ÿå°±å¾ˆå¤šï¼Œæ‰€ä»¥ CPU å¤„ç†èƒ½åŠ›éœ€è¦æ¯”è¾ƒå¼ºåŠ²ï¼›è™½ç„¶ä¸å®¢æˆ·ç«¯çš„æ¯æ¬¡äº¤äº’çš„æ•°æ®é‡å¹¶ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œä½†æ˜¯ç½‘ç»œäº¤äº’éå¸¸é¢‘ç¹ï¼Œæ‰€ä»¥ä¸»æœºä¸å®¢æˆ·ç«¯äº¤äº’çš„ç½‘ç»œè®¾å¤‡å¯¹æµé‡èƒ½åŠ›ä¹Ÿè¦æ±‚ä¸èƒ½å¤ªå¼±ã€‚ 2 OLAPç”¨äºæ•°æ®åˆ†æçš„ OLAP ç³»ç»Ÿçš„ä¸»è¦ç‰¹ç‚¹å°±æ˜¯æ•°æ®é‡éå¸¸å¤§ï¼Œå¹¶å‘è®¿é—®ä¸å¤šï¼Œä½†æ¯æ¬¡è®¿é—®æ‰€éœ€è¦æ£€ç´¢çš„æ•°æ®é‡éƒ½æ¯”è¾ƒå¤šï¼Œè€Œä¸”æ•°æ®è®¿é—®ç›¸å¯¹è¾ƒä¸ºé›†ä¸­ï¼Œæ²¡æœ‰å¤ªæ˜æ˜¾çš„æ´»è·ƒæ•°æ®æ¦‚å¿µã€‚ OLAP å³è”æœºåˆ†æå¤„ç†ï¼Œæ˜¯æ•°æ®ä»“åº“çš„æ ¸å¿ƒéƒ¨å¿ƒï¼Œæ‰€è°“æ•°æ®ä»“åº“æ˜¯å¯¹äºå¤§é‡å·²ç»ç”± OLTP å½¢æˆçš„æ•°æ®çš„ä¸€ç§åˆ†æå‹çš„æ•°æ®åº“ï¼Œç”¨äºå¤„ç†å•†ä¸šæ™ºèƒ½ã€å†³ç­–æ”¯æŒç­‰é‡è¦çš„å†³ç­–ä¿¡æ¯ï¼›æ•°æ®ä»“åº“æ˜¯åœ¨æ•°æ®åº“åº”ç”¨åˆ°ä¸€å®šç¨‹åºä¹‹åè€Œå¯¹å†å²æ•°æ®çš„åŠ å·¥ä¸åˆ†æã€‚æ•°æ®åˆ†æçš„ç›®æ ‡æ˜¯æ¢ç´¢å¹¶æŒ–æ˜æ•°æ®çš„ä»·å€¼ï¼Œä½œä¸ºä¼ä¸šé«˜å±‚è¿›è¡Œå†³ç­–çš„å‚è€ƒã€‚ åŸºäº OLAP ç³»ç»Ÿçš„å„ç§ç‰¹ç‚¹å’Œç›¸åº”çš„åˆ†æï¼Œé’ˆå¯¹ OLAP ç³»ç»Ÿç¡¬ä»¶ä¼˜åŒ–çš„å¤§è‡´ç­–ç•¥å¦‚ä¸‹ï¼š æ•°æ®é‡éå¸¸å¤§ï¼Œæ‰€ä»¥ç£ç›˜å­˜å‚¨ç³»ç»Ÿçš„å•ä½å®¹é‡éœ€è¦å°½é‡å¤§ä¸€äº›ï¼› å•æ¬¡è®¿é—®æ•°æ®é‡è¾ƒå¤§ï¼Œè€Œä¸”è®¿é—®æ•°æ®æ¯”è¾ƒé›†ä¸­ï¼Œé‚£ä¹ˆå¯¹ IO ç³»ç»Ÿçš„æ€§èƒ½è¦æ±‚æ˜¯éœ€è¦æœ‰å°½å¯èƒ½å¤§çš„æ¯ç§’ IO ååé‡ï¼Œæ‰€ä»¥åº”è¯¥é€‰ç”¨æ¯ç§’ååé‡å°½å¯èƒ½å¤§çš„ç£ç›˜ï¼› è™½ç„¶ IO æ€§èƒ½è¦æ±‚ä¹Ÿæ¯”è¾ƒé«˜ï¼Œä½†æ˜¯å¹¶å‘è¯·æ±‚è¾ƒå°‘ï¼Œæ‰€ä»¥ CPU å¤„ç†èƒ½åŠ›è¾ƒéš¾æˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œæ‰€ä»¥ CPU å¤„ç†èƒ½åŠ›æ²¡æœ‰å¤ªè‹›åˆ»çš„è¦æ±‚ï¼› è™½ç„¶æ¯æ¬¡è¯·æ±‚çš„è®¿é—®é‡å¾ˆå¤§ï¼Œä½†æ˜¯æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ•°æ®å¤§éƒ½ä¸ä¼šè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæœ€ç»ˆè¿”å›ç»™å®¢æˆ·ç«¯çš„æ•°æ®é‡éƒ½è¾ƒå°ï¼Œæ‰€ä»¥å’Œå®¢æˆ·ç«¯äº¤äº’çš„ç½‘ç»œè®¾å¤‡è¦æ±‚å¹¶ä¸æ˜¯å¤ªé«˜ï¼› æ­¤å¤–ï¼Œç”±äº OLAP ç³»ç»Ÿç”±äºå…¶æ¯æ¬¡è¿ç®—è¿‡ç¨‹è¾ƒé•¿ï¼Œå¯ä»¥å¾ˆå¥½çš„å¹¶è¡ŒåŒ–ï¼Œæ‰€ä»¥ä¸€èˆ¬çš„ OLAPç³»ç»Ÿéƒ½æ˜¯ç”±å¤šå°ä¸»æœºæ„æˆçš„ä¸€ä¸ªé›†ç¾¤ï¼Œè€Œé›†ç¾¤ä¸­ä¸»æœºä¸ä¸»æœºä¹‹é—´çš„æ•°æ®äº¤äº’é‡ä¸€èˆ¬æ¥è¯´éƒ½æ˜¯éå¸¸å¤§çš„ï¼Œæ‰€ä»¥åœ¨é›†ç¾¤ä¸­ä¸»æœºä¹‹é—´çš„ç½‘ç»œè®¾å¤‡è¦æ±‚å¾ˆé«˜ã€‚","categories":[{"name":"é¡¹ç›®/ç¼–ç¨‹ç†è®º","slug":"é¡¹ç›®-ç¼–ç¨‹ç†è®º","permalink":"https://www.codetool.top/categories/%E9%A1%B9%E7%9B%AE-%E7%BC%96%E7%A8%8B%E7%90%86%E8%AE%BA/"}],"tags":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://www.codetool.top/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"}]},{"title":"æŒ‰é”®æ’åºçš„Map-TreeMapæºç åˆ†æ","slug":"æŒ‰é”®æ’åºçš„Map-TreeMapæºç åˆ†æ","date":"2020-02-16T11:44:53.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/æŒ‰é”®æ’åºçš„Map-TreeMapæºç åˆ†æ/","link":"","permalink":"https://www.codetool.top/article/%E6%8C%89%E9%94%AE%E6%8E%92%E5%BA%8F%E7%9A%84Map-TreeMap%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","excerpt":"","text":"1 æ€»ç»“æ€»ç»“æ”¾å‰é¢ï¼ˆè¿™ç¯‡æŒºçŸ­çš„ï¼‰ TreeMapåŸºäºçº¢é»‘æ ‘å®ç°ï¼Œå¯ä»¥å¯¹Mapä¸­çš„keyæ’åº å®ƒçš„æ’åºå’Œå®šä½éœ€è¦ä¾èµ–æ¯”è¾ƒå™¨æˆ–å®ç° Comparable æ¥å£ï¼Œä¹Ÿå› æ­¤ä¸éœ€è¦keyé‡å†™hashCodeæ–¹æ³•å’Œequalsæ–¹æ³•ï¼Œå°±å¯ä»¥æ’é™¤æ‰é‡å¤çš„keyã€‚ TreeMap çš„æŸ¥è¯¢ã€æ’å…¥ã€åˆ é™¤æ•ˆç‡å‡æ²¡æœ‰ HashMap é«˜ï¼Œä¸€èˆ¬åªæœ‰è¦å¯¹ key æ’åºæ—¶æ‰ä½¿ç”¨TreeMapã€‚ 2 å¯¼è¨€ä¹‹å‰æœ‰å†™è¿‡å¼±å¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘-çº¢é»‘æ ‘ï¼Œç„¶è€Œå¾ˆå¤šå…·ä½“å®ç°éƒ½æ²¡æœ‰æï¼Œè¿™ç¯‡æ–‡ç« å°±æ¥è°ˆè°ˆJDKåŸºäºçº¢é»‘æ ‘å®ç°çš„å¯ä»¥æŒ‰é”®æ’åºçš„Mapâ€”â€”TreeMap è¿˜æ˜¯æŒ‰æˆ‘çš„ä¹ æƒ¯ï¼Œç›´æ¥ä»é‡è¦æ–¹æ³•è¯»èµ·ï¼š 3 é‡è¦æ–¹æ³•3.1 putpublic V put(K key, V value) { //å¯ä»¥çŒœåˆ°Entryåº”è¯¥å°±æ˜¯çº¢é»‘æ ‘çš„èŠ‚ç‚¹ç±» Entry&lt;K,V> t = root; //å¦‚æœæ ¹èŠ‚ç‚¹ä¸ºç©º if (t == null) { //è¿™é‡Œçš„compareåªæ˜¯ç±»å‹æ£€æŸ¥å’Œnullå€¼æ£€æŸ¥key compare(key, key); // type (and possibly null) check root = new Entry&lt;>(key, value, null); size = 1; modCount++; return null; } int cmp; Entry&lt;K,V> parent; // è·å–æ¯”è¾ƒå™¨ Comparator&lt;? super K> cpr = comparator; // å¦‚æœæœ‰æ¯”è¾ƒå™¨ if (cpr != null) { //è·å–è¦æ’å…¥çš„ä½ç½® do { parent = t; cmp = cpr.compare(key, t.key); if (cmp &lt; 0) t = t.left; else if (cmp > 0) t = t.right; else //å¦‚æœå·²æœ‰è¿™ä¸ªé”®äº†ï¼Œé‚£ä¹ˆæ›¿æ¢å€¼ return t.setValue(value); } while (t != null); } // å¦‚æœæ²¡æœ‰æ¯”è¾ƒå™¨ å³ä¸ºå®ç°äº†Comparableæ¥å£ï¼Œç±»ä¼¼çš„é€»è¾‘ else { if (key == null) throw new NullPointerException(); @SuppressWarnings(\"unchecked\") Comparable&lt;? super K> k = (Comparable&lt;? super K>) key; do { parent = t; cmp = k.compareTo(t.key); if (cmp &lt; 0) t = t.left; else if (cmp > 0) t = t.right; else return t.setValue(value); } while (t != null); } //æ„é€ ç»“ç‚¹ Entry&lt;K,V> e = new Entry&lt;>(key, value, parent); //æ’å…¥å¯¹åº”ä½ç½® if (cmp &lt; 0) parent.left = e; else parent.right = e; //æ’å…¥åçš„è°ƒæ•´ fixAfterInsertion(e); size++; modCount++; return null; } çœ‹å®Œè¿™ä¸ªå‡½æ•°çš„ç»“è®ºï¼š Entryæ˜¯ç»“ç‚¹çš„ç±» æŒ‰æ­£å¸¸çš„æœç´¢æ ‘æ–¹æ³•æ’å…¥èŠ‚ç‚¹ä¹‹åï¼Œè°ƒç”¨fixAfterInsertion(e)æ¥è°ƒæ•´æ ‘ã€‚ é‚£ä¹ˆæˆ‘ä»¬åˆ†åˆ«æ¥çœ‹å¯¹åº”çš„æºç ï¼š 3.1.1 Entrystatic final class Entry&lt;K,V> implements Map.Entry&lt;K,V> { K key; V value; Entry&lt;K,V> left; Entry&lt;K,V> right; Entry&lt;K,V> parent; boolean color = BLACK; //... } å…¶å®ä¼¼æ›¾ç›¸è¯†ï¼Œå› ä¸ºä¹‹å‰åœ¨HashMapæºç åˆ†æä¸­çœ‹è¿‡HashMapç”¨çº¢é»‘æ ‘å®ç°çš„éƒ¨åˆ†ä¹Ÿå®ç°äº†çº¢é»‘æ ‘çš„èŠ‚ç‚¹ï¼Œä¸è¿‡å½“æ—¶ä¹Ÿæ²¡æœ‰è°ˆå…·ä½“æ–¹æ³•çš„å®ç°ã€‚ 3.1.2 fixAfterInsertionprivate void fixAfterInsertion(Entry&lt;K,V> x) { //æ’å…¥èŠ‚ç‚¹é»˜è®¤ä¸ºçº¢è‰² x.color = RED; // å¦‚æœçˆ¶èŠ‚ç‚¹ä¹Ÿæ˜¯çº¢è‰² while (x != null &amp;&amp; x != root &amp;&amp; x.parent.color == RED) { //å¦‚æœçˆ¶èŠ‚ç‚¹æ˜¯ç¥–çˆ¶èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ if (parentOf(x) == leftOf(parentOf(parentOf(x)))) { //è·å–ç¥–çˆ¶èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ Entry&lt;K,V> y = rightOf(parentOf(parentOf(x))); //å¦‚æœçˆ¶èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹ä¹Ÿæ˜¯çº¢è‰² if (colorOf(y) == RED) { //æŠŠçˆ¶èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹è®¾ä¸ºé»‘è‰² setColor(parentOf(x), BLACK); setColor(y, BLACK); //æŠŠç¥–çˆ¶èŠ‚ç‚¹è®¾ä¸ºçº¢è‰² setColor(parentOf(parentOf(x)), RED); //å®šä½åˆ°ç¥–çˆ¶èŠ‚ç‚¹ï¼Œåˆ†æä¸‹ä¸€æ­¥çš„å˜åŒ–è§„åˆ™ x = parentOf(parentOf(x)); //å¦‚æœçˆ¶èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹ä¸æ˜¯çº¢è‰² } else { //å¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯å³å­èŠ‚ç‚¹ if (x == rightOf(parentOf(x))) { //è¯´æ˜æ˜¯â€œæŠ˜çº¿å‹å¤±è¡¡â€ï¼Œå…ˆå·¦æ—‹ï¼Œå†å³æ—‹ x = parentOf(x); rotateLeft(x); } //â€œç›´çº¿å‹å¤±è¡¡â€ï¼Œç›´æ¥å³æ—‹ setColor(parentOf(x), BLACK); setColor(parentOf(parentOf(x)), RED); rotateRight(parentOf(parentOf(x))); } } else { Entry&lt;K,V> y = leftOf(parentOf(parentOf(x))); if (colorOf(y) == RED) { setColor(parentOf(x), BLACK); setColor(y, BLACK); setColor(parentOf(parentOf(x)), RED); x = parentOf(parentOf(x)); } else { if (x == leftOf(parentOf(x))) { x = parentOf(x); rotateRight(x); } setColor(parentOf(x), BLACK); setColor(parentOf(parentOf(x)), RED); rotateLeft(parentOf(parentOf(x))); } } } //æ°¸è¿œä¿æŒæ ¹èŠ‚ç‚¹ä¸ºé»‘è‰² root.color = BLACK; } 3.2 getpublic V get(Object key) { Entry&lt;K,V> p = getEntry(key); return (p==null ? null : p.value); } getå…¶å®æ²¡ä»€ä¹ˆå¥½çœ‹çš„ï¼Œå°±æ˜¯æœç´¢æ ‘çš„æœç´¢ã€‚ final Entry&lt;K,V> getEntry(Object key) { // Offload comparator-based version for sake of performance if (comparator != null) return getEntryUsingComparator(key); if (key == null) throw new NullPointerException(); @SuppressWarnings(\"unchecked\") Comparable&lt;? super K> k = (Comparable&lt;? super K>) key; Entry&lt;K,V> p = root; while (p != null) { int cmp = k.compareTo(p.key); if (cmp &lt; 0) p = p.left; else if (cmp > 0) p = p.right; else return p; } return null; } 3.3 removepublic V remove(Object key) { Entry&lt;K,V> p = getEntry(key); if (p == null) return null; V oldValue = p.value; deleteEntry(p); return oldValue; } å†™çº¢é»‘æ ‘çš„æ—¶å€™æåˆ°ï¼Œåˆ é™¤æ“ä½œå¯å¤æ‚äº†ï¼Œåˆ†å¥½å¤šæƒ…å†µï¼Œè¿™é‡Œä¹Ÿä¸è¯¦ç»†è¯´æ˜äº†ï¼š private void deleteEntry(Entry&lt;K,V> p) { modCount++; size--; // If strictly internal, copy successor's element to p and then make p // point to successor. // å¦‚æœpæœ‰ä¸¤ä¸ªå­©å­èŠ‚ç‚¹ if (p.left != null &amp;&amp; p.right != null) { // è·å–åç»§ç»“ç‚¹ Entry&lt;K,V> s = successor(p); // ç”¨åç»§èŠ‚ç‚¹æ›¿æ¢å½“å‰èŠ‚ç‚¹ï¼ˆé¢œè‰²ä¸å˜ï¼‰ p.key = s.key; p.value = s.value; // ç„¶åæŠŠpæŒ‡å‘sï¼Œå’Œåé¢påªæœ‰ä¸€ä¸ªæˆ–0ä¸ªå­©å­èŠ‚ç‚¹çš„æ–¹æ³•é€šç”¨ p = s; } // p has 2 children // Start fixup at replacement node, if it exists. Entry&lt;K,V> replacement = (p.left != null ? p.left : p.right); //æœ‰ä¸€ä¸ªå­©å­èŠ‚ç‚¹ if (replacement != null) { // Link replacement to parent replacement.parent = p.parent; if (p.parent == null) root = replacement; else if (p == p.parent.left) p.parent.left = replacement; else p.parent.right = replacement; // Null out links so they are OK to use by fixAfterDeletion. p.left = p.right = p.parent = null; // Fix replacement if (p.color == BLACK) fixAfterDeletion(replacement); } else if (p.parent == null) { // return if we are the only node. root = null; //æ²¡æœ‰å­©å­èŠ‚ç‚¹ï¼Œä¸”è¦åˆ é™¤çš„æ˜¯é»‘è‰²èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿˜è¦é€šè¿‡fixAfterDeletionå†ç»§ç»­è°ƒæ•´ } else { // No children. Use self as phantom replacement and unlink. if (p.color == BLACK) fixAfterDeletion(p); if (p.parent != null) { if (p == p.parent.left) p.parent.left = null; else if (p == p.parent.right) p.parent.right = null; p.parent = null; } } } private void fixAfterDeletion(Entry&lt;K,V> x) { while (x != root &amp;&amp; colorOf(x) == BLACK) { if (x == leftOf(parentOf(x))) { Entry&lt;K,V> sib = rightOf(parentOf(x)); if (colorOf(sib) == RED) { setColor(sib, BLACK); setColor(parentOf(x), RED); rotateLeft(parentOf(x)); sib = rightOf(parentOf(x)); } if (colorOf(leftOf(sib)) == BLACK &amp;&amp; colorOf(rightOf(sib)) == BLACK) { setColor(sib, RED); x = parentOf(x); } else { if (colorOf(rightOf(sib)) == BLACK) { setColor(leftOf(sib), BLACK); setColor(sib, RED); rotateRight(sib); sib = rightOf(parentOf(x)); } setColor(sib, colorOf(parentOf(x))); setColor(parentOf(x), BLACK); setColor(rightOf(sib), BLACK); rotateLeft(parentOf(x)); x = root; } } else { // symmetric Entry&lt;K,V> sib = leftOf(parentOf(x)); if (colorOf(sib) == RED) { setColor(sib, BLACK); setColor(parentOf(x), RED); rotateRight(parentOf(x)); sib = leftOf(parentOf(x)); } if (colorOf(rightOf(sib)) == BLACK &amp;&amp; colorOf(leftOf(sib)) == BLACK) { setColor(sib, RED); x = parentOf(x); } else { if (colorOf(leftOf(sib)) == BLACK) { setColor(rightOf(sib), BLACK); setColor(sib, RED); rotateLeft(sib); sib = leftOf(parentOf(x)); } setColor(sib, colorOf(parentOf(x))); setColor(parentOf(x), BLACK); setColor(leftOf(sib), BLACK); rotateRight(parentOf(x)); x = root; } } } setColor(x, BLACK); } 4 æ„é€ æ–¹æ³•è€ƒè™‘åˆ°TreeMapæ˜¯ç”±çº¢é»‘æ ‘å®ç°çš„ï¼Œä¸å­˜åœ¨ä»€ä¹ˆæ‰©å®¹ï¼Œæ„é€ æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼š public TreeMap() { comparator = null; } public TreeMap(Comparator&lt;? super K> comparator) { this.comparator = comparator; }","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jdk","slug":"jdk","permalink":"https://www.codetool.top/tags/jdk/"},{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://www.codetool.top/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"}]},{"title":"leetcode134-åŠ æ²¹ç«™","slug":"leetcode134-åŠ æ²¹ç«™","date":"2020-02-15T17:57:56.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode134-åŠ æ²¹ç«™/","link":"","permalink":"https://www.codetool.top/article/leetcode134-%E5%8A%A0%E6%B2%B9%E7%AB%99/","excerpt":"","text":"1 åŸé¢˜åœ¨ä¸€æ¡ç¯è·¯ä¸Šæœ‰ N ä¸ªåŠ æ²¹ç«™ï¼Œå…¶ä¸­ç¬¬ i ä¸ªåŠ æ²¹ç«™æœ‰æ±½æ²¹ gas[i] å‡ã€‚ ä½ æœ‰ä¸€è¾†æ²¹ç®±å®¹é‡æ— é™çš„çš„æ±½è½¦ï¼Œä»ç¬¬ i ä¸ªåŠ æ²¹ç«™å¼€å¾€ç¬¬ i+1 ä¸ªåŠ æ²¹ç«™éœ€è¦æ¶ˆè€—æ±½æ²¹ cost[i] å‡ã€‚ä½ ä»å…¶ä¸­çš„ä¸€ä¸ªåŠ æ²¹ç«™å‡ºå‘ï¼Œå¼€å§‹æ—¶æ²¹ç®±ä¸ºç©ºã€‚ å¦‚æœä½ å¯ä»¥ç»•ç¯è·¯è¡Œé©¶ä¸€å‘¨ï¼Œåˆ™è¿”å›å‡ºå‘æ—¶åŠ æ²¹ç«™çš„ç¼–å·ï¼Œå¦åˆ™è¿”å› -1ã€‚ è¯´æ˜: å¦‚æœé¢˜ç›®æœ‰è§£ï¼Œè¯¥ç­”æ¡ˆå³ä¸ºå”¯ä¸€ç­”æ¡ˆã€‚ è¾“å…¥æ•°ç»„å‡ä¸ºéç©ºæ•°ç»„ï¼Œä¸”é•¿åº¦ç›¸åŒã€‚ è¾“å…¥æ•°ç»„ä¸­çš„å…ƒç´ å‡ä¸ºéè´Ÿæ•°ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼šgas = [1,2,3,4,5]cost = [3,4,5,1,2]è¾“å‡ºï¼š 3è§£é‡Šï¼šä» 3 å·åŠ æ²¹ç«™(ç´¢å¼•ä¸º 3 å¤„)å‡ºå‘ï¼Œå¯è·å¾— 4 å‡æ±½æ²¹ã€‚æ­¤æ—¶æ²¹ç®±æœ‰ = 0 + 4 = 4 å‡æ±½æ²¹å¼€å¾€ 4 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 4 - 1 + 5 = 8 å‡æ±½æ²¹å¼€å¾€ 0 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 8 - 2 + 1 = 7 å‡æ±½æ²¹å¼€å¾€ 1 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 7 - 3 + 2 = 6 å‡æ±½æ²¹å¼€å¾€ 2 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 6 - 4 + 3 = 5 å‡æ±½æ²¹å¼€å¾€ 3 å·åŠ æ²¹ç«™ï¼Œä½ éœ€è¦æ¶ˆè€— 5 å‡æ±½æ²¹ï¼Œæ­£å¥½è¶³å¤Ÿä½ è¿”å›åˆ° 3 å·åŠ æ²¹ç«™ã€‚å› æ­¤ï¼Œ3 å¯ä¸ºèµ·å§‹ç´¢å¼•ã€‚ ç¤ºä¾‹2: è¾“å…¥ï¼šgas = [2,3,4]cost = [3,4,3]è¾“å‡ºï¼š -1è§£é‡Šï¼šä½ ä¸èƒ½ä» 0 å·æˆ– 1 å·åŠ æ²¹ç«™å‡ºå‘ï¼Œå› ä¸ºæ²¡æœ‰è¶³å¤Ÿçš„æ±½æ²¹å¯ä»¥è®©ä½ è¡Œé©¶åˆ°ä¸‹ä¸€ä¸ªåŠ æ²¹ç«™ã€‚æˆ‘ä»¬ä» 2 å·åŠ æ²¹ç«™å‡ºå‘ï¼Œå¯ä»¥è·å¾— 4 å‡æ±½æ²¹ã€‚ æ­¤æ—¶æ²¹ç®±æœ‰ = 0 + 4 = 4 å‡æ±½æ²¹å¼€å¾€ 0 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 4 - 3 + 2 = 3 å‡æ±½æ²¹å¼€å¾€ 1 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 3 - 3 + 3 = 3 å‡æ±½æ²¹ä½ æ— æ³•è¿”å› 2 å·åŠ æ²¹ç«™ï¼Œå› ä¸ºè¿”ç¨‹éœ€è¦æ¶ˆè€— 4 å‡æ±½æ²¹ï¼Œä½†æ˜¯ä½ çš„æ²¹ç®±åªæœ‰ 3 å‡æ±½æ²¹ã€‚å› æ­¤ï¼Œæ— è®ºæ€æ ·ï¼Œä½ éƒ½ä¸å¯èƒ½ç»•ç¯è·¯è¡Œé©¶ä¸€å‘¨ã€‚ 2 è§£æ³•2.1 æ€æƒ³æˆ‘ä»¬ä»0å‡ºå‘ï¼Œæ¯ç»è¿‡ä¸€ä¸ªåŠ æ²¹ç«™è®¡ç®—å‰©ä½™çš„æ²¹é‡ï¼ˆå…è®¸è´Ÿå€¼ï¼‰ï¼Œé‚£ä¹ˆå‡è®¾æœ‰ä¸€ä¸ªåŠ æ²¹ç«™å¯ä»¥ä»è¿™é‡Œå‡ºå‘ç¯è¡Œä¸€åœˆï¼Œé‚£ä¹ˆå‰©ä½™çš„æ²¹é‡åœ¨è¿™ä¹‹å‰åº”è¯¥æ˜¯è¾¾åˆ°äº†æœ€ä½å€¼ï¼Œåé¢æ¸æ¸æ‰â€œå¥½èµ·æ¥äº†â€(æœ‰èµ·åŠ¿)ã€‚ 2.2 ä»£ç class Solution { public int canCompleteCircuit(int[] gas, int[] cost) { int minLeft = Integer.MAX_VALUE; int min = -1; int gasLeft = 0; for(int i = 0;i&lt;gas.length;i++){ gasLeft += gas[i]; gasLeft -= cost[i]; if(gasLeft &lt; minLeft) { minLeft = gasLeft; min = i; } } int station = min+1==gas.length?0:min+1; return gasLeft>=0?station:-1; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"Javaåå°„æœºåˆ¶å’ŒåŠ¨æ€ä»£ç†è¯¦è§£","slug":"Javaåå°„æœºåˆ¶å’ŒåŠ¨æ€ä»£ç†è¯¦è§£","date":"2020-02-15T13:49:08.000Z","updated":"2020-02-25T15:43:09.280Z","comments":true,"path":"article/Javaåå°„æœºåˆ¶å’ŒåŠ¨æ€ä»£ç†è¯¦è§£/","link":"","permalink":"https://www.codetool.top/article/Java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6%E5%92%8C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E8%AF%A6%E8%A7%A3/","excerpt":"","text":"1 åå°„1.1 æ¦‚å¿µåå°„æœºåˆ¶ï¼š æŒ‡çš„æ˜¯å¯ä»¥äºè¿è¡Œæ—¶åŠ è½½ã€æ¢çŸ¥ã€ä½¿ç”¨ç¼–è¯‘æœŸé—´å®Œå…¨æœªçŸ¥çš„ç±»ã€‚ ç¨‹åºåœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯ä»¥åŠ¨æ€åŠ è½½ä¸€ä¸ªåªæœ‰åç§°çš„ç±»ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªå·²åŠ è½½çš„ç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§ï¼› Class c = Class.forName(\"com.abc.test.User\"); åŠ è½½å®Œç±»ä¹‹åï¼Œåœ¨å †å†…å­˜ä¸­ï¼Œå°±äº§ç”Ÿäº†ä¸€ä¸ªClassç±»å‹çš„å¯¹è±¡ï¼ˆä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªClasså¯¹è±¡ï¼‰ï¼Œè¿™ä¸ªå¯¹è±¡å°±åŒ…å«äº†å®Œæ•´çš„ç±»çš„ç»“æ„ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå¯¹è±¡çœ‹åˆ°ç±»çš„ç»“æ„ã€‚è¿™ä¸ªå¯¹è±¡å°±åƒä¸€é¢é•œå­ï¼Œé€è¿‡è¿™ä¸ªé•œå­çœ‹åˆ°ç±»çš„ç»“æ„ï¼Œæ‰€ä»¥æˆ‘ä»¬å½¢è±¡åœ°ç§°ä¹‹ä¸ºï¼šåå°„ã€‚ Class.forName ä½¿ç”¨çš„ç±»åŠ è½½å™¨æ˜¯è°ƒç”¨è€…çš„ç±»åŠ è½½å™¨ã€‚ 1.2 Classç±»ä¸€ä¸ªç±»è¢«åŠ è½½ä¹‹åï¼ŒJVM ä¼šåˆ›å»ºä¸€ä¸ªå¯¹åº”è¯¥ç±»çš„ Class å¯¹è±¡ï¼Œç±»çš„æ•´ä¸ªç»“æ„ä¿¡æ¯ä¼šæ”¾åœ¨ç›¸åº”çš„ Class å¯¹è±¡ä¸­ã€‚ å¦‚æœå¤šæ¬¡æ‰§è¡Œ forName ç­‰åŠ è½½ç±»çš„æ–¹æ³•ï¼Œç±»åªä¼šè¢«åŠ è½½ä¸€æ¬¡ï¼›ä¸€ä¸ªç±»åªä¼šå½¢æˆä¸€ä¸ª Classå¯¹è±¡ï¼Œæ— è®ºæ‰§è¡Œå¤šå°‘æ¬¡åŠ è½½ç±»çš„æ–¹æ³•ï¼Œè·å¾—çš„ Class éƒ½æ˜¯ä¸€æ ·çš„ã€‚ 1.3 ä½¿ç”¨/* * è·å–Classå¯¹è±¡çš„ä¸‰ç§æ–¹å¼ */ Class clazz1 = Class.forName(\"className\"); Class clazz2 = obj.getClass();//objä¸ºæŸä¸€ä¸ªç±»çš„å®ä¾‹ï¼ŒgetClass()è·å–è¿™ä¸ªå®ä¾‹ Class clazz3 = Proson.class//Personä¸ºå¯ä»¥åŠ è½½åˆ°çš„ç±»å /* * ä½¿ç”¨ */ Object obj1=c.newInstance();//åˆ›å»ºä¸€ä¸ªcçš„å®ä¾‹ Constructor constructor = clazz1.getConstructor(String.class, Integer.class);//é€šè¿‡classå¯¹è±¡è·å–ä¸€ä¸ªå‚æ•°ç±»å‹å¯¹åº”çš„æ„é€ å™¨ Object obj2 = constructor.newInstance(\"name\",22);//é€šè¿‡æ„é€ å™¨å¯¹è±¡è·å–å®ä¾‹å¯¹è±¡ Method method1 = obj2.getMethod(\"foo\",String.class);//é€šè¿‡classå¯¹è±¡è·å–ä¸€ä¸ªæ–¹æ³•å¯¹è±¡ method1.invoke(obj2,\"name\");//é€šè¿‡æ–¹æ³•å¯¹è±¡è°ƒç”¨ 1.4 ç”¨é€” åŠ¨æ€åŠ è½½ç±»ã€åŠ¨æ€è·å–ç±»çš„ä¿¡æ¯ï¼ˆå±æ€§ã€æ–¹æ³•ã€æ„é€ å™¨ï¼‰ åŠ¨æ€æ„é€ å¯¹è±¡ åŠ¨æ€æ„é€ ç±»å’Œå¯¹è±¡çš„ä»»æ„æ–¹æ³•ã€æ„é€ å™¨ åŠ¨æ€è°ƒç”¨å’Œå¤„ç†å±æ€§ è·å–æ³›å‹ä¿¡æ¯ å¤„ç†æ³¨è§£ 1.5 æ€§èƒ½åå°„å¸¦æ¥çµæ´»æ€§çš„åŒæ—¶ï¼Œä¹Ÿæœ‰é™ä½ç¨‹åºæ‰§è¡Œæ•ˆç‡çš„å¼Šç«¯ã€‚ å¾ˆå¤šæœ¬æ¥å¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µä¼˜åŒ–å’ŒéªŒè¯çš„ä¸œè¥¿å¿…é¡»è¦ç­‰åˆ°è¿è¡Œæ—¶æ‰èƒ½å¤„ç†ã€‚ setAccessible æ–¹æ³•ä¸ä»…å¯ä»¥æ ‡è®°æŸäº›ç§æœ‰çš„å±æ€§æ–¹æ³•ä¸ºå¯è®¿é—®çš„å±æ€§æ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚ å®é™…ä¸Šæ˜¯å¯ç”¨å’Œç¦ç”¨è®¿é—®å®‰å…¨æ£€æŸ¥çš„å¼€å…³ã€‚å¦‚æœåšæ£€æŸ¥å°±ä¼šé™ä½æ•ˆç‡ï¼›å…³é—­æ£€æŸ¥å°±å¯ä»¥æé«˜æ•ˆç‡ã€‚ åå°„è°ƒç”¨æ–¹æ³•æ¯”ç›´æ¥è°ƒç”¨è¦æ…¢å¤§çº¦ 30 å€ï¼Œå¦‚æœè·³è¿‡å®‰å…¨æ£€æŸ¥çš„è¯æ¯”ç›´æ¥è°ƒç”¨è¦æ…¢å¤§çº¦ 7 å€ å¼€å¯å’Œä¸å¼€å¯å®‰å…¨æ£€æŸ¥å¯¹äºåå°„è€Œè¨€å¯èƒ½ä¼šå·® 4 å€çš„æ‰§è¡Œæ•ˆç‡ã€‚ ä¸ºä»€ä¹ˆæ…¢? éªŒè¯ç­‰é˜²å¾¡ä»£ç è¿‡äºç¹çï¼Œè¿™ä¸€æ­¥æœ¬æ¥åœ¨ link é˜¶æ®µï¼Œç°åœ¨å´åœ¨è®¡ç®—æ—¶è¿›è¡ŒéªŒè¯ äº§ç”Ÿå¾ˆå¤šä¸´æ—¶å¯¹è±¡ï¼Œé€ æˆ GC ä¸è®¡ç®—æ—¶é—´æ¶ˆè€— ç”±äºç¼ºå°‘ä¸Šä¸‹æ–‡ï¼Œä¸¢å¤±äº†å¾ˆå¤šè¿è¡Œæ—¶çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚ JIT(å®ƒå¯ä»¥çœ‹ä½œ JVM çš„é‡è¦è¯„æµ‹æ ‡å‡†ä¹‹ä¸€) å½“ç„¶ï¼Œç°ä»£ JVM ä¹Ÿä¸æ˜¯éå¸¸æ…¢äº†ï¼Œå®ƒèƒ½å¤Ÿå¯¹åå°„ä»£ç è¿›è¡Œç¼“å­˜ä»¥åŠé€šè¿‡æ–¹æ³•è®¡æ•°å™¨åŒæ ·å®ç° JIT ä¼˜åŒ–ï¼Œæ‰€ä»¥åå°„ä¸ä¸€å®šæ…¢ã€‚ 2 åŠ¨æ€ä»£ç†ä»£ç†çš„å®šä¹‰ï¼šç»™ç›®æ ‡å¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œå¹¶ç”±ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹ç›®æ ‡å¯¹è±¡çš„å¼•ç”¨ é™æ€ä»£ç†ï¼šä»£ç†ç±»æ˜¯åœ¨ç¼–è¯‘æ—¶å°±å®ç°å¥½çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ Java ç¼–è¯‘å®Œæˆåä»£ç†ç±»æ˜¯ä¸€ä¸ªå®é™…çš„class æ–‡ä»¶ã€‚ä»£ç†ç±»å’Œè¢«ä»£ç†ç±»éƒ½å®ç°ä¸šåŠ¡æ¥å£ï¼Œä»£ç†ç±»é€šè¿‡ç»„åˆå…³ç³»ä½¿ç”¨è¢«ä»£ç†å¯¹è±¡ã€‚ åŠ¨æ€ä»£ç†ï¼šä»£ç†ç±»æ˜¯åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ Java ç¼–è¯‘å®Œä¹‹åå¹¶æ²¡æœ‰å®é™…çš„ class æ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„ç±»å­—èŠ‚ç ï¼Œå¹¶åŠ è½½åˆ° JVM ä¸­ã€‚ ä»£ç†çš„ç›®çš„ï¼š(1) é€šè¿‡å¼•å…¥ä»£ç†å¯¹è±¡çš„æ–¹å¼æ¥é—´æ¥è®¿é—®ç›®æ ‡å¯¹è±¡ï¼Œé˜²æ­¢ç›´æ¥è®¿é—®ç›®æ ‡å¯¹è±¡ç»™ç³»ç»Ÿå¸¦æ¥çš„ä¸å¿…è¦å¤æ‚æ€§ï¼›(2) é€šè¿‡ä»£ç†å¯¹è±¡å¯¹åŸæœ‰çš„ä¸šåŠ¡å¢å¼ºã€‚ 2.1 JDKåŠ¨æ€ä»£ç†2.1.1 æ¦‚è¿°å’Œä½¿ç”¨é™æ€ä»£ç†çš„ç¼ºé™·ï¼šä¸šåŠ¡çš„æ‹“å±•ï¼Œå®ç°æ¥å£çš„å¢å¤šã€‚å¼€æ”¾-å°é—­åŸåˆ™ï¼šå¯¹å¤–æ‹“å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚ JDK åŠ¨æ€ä»£ç†æ˜¯ç”± Java å†…éƒ¨çš„åå°„æœºåˆ¶+åŠ¨æ€ç”Ÿæˆå­—èŠ‚ç  æ¥å®ç°çš„ï¼Œcglib åŠ¨æ€ä»£ç†åº•å±‚åˆ™æ˜¯å€ŸåŠ© asm æ¥å®ç°çš„ã€‚æ€»çš„æ¥è¯´ï¼Œåå°„æœºåˆ¶åœ¨ç”Ÿæˆç±»çš„è¿‡ç¨‹ä¸­æ¯”è¾ƒé«˜æ•ˆï¼Œè€Œ asm åœ¨ç”Ÿæˆç±»ä¹‹åçš„ç›¸å…³æ‰§è¡Œè¿‡ç¨‹ä¸­æ¯”è¾ƒé«˜æ•ˆï¼ˆå¯ä»¥é€šè¿‡å°† asm ç”Ÿæˆçš„ç±»è¿›è¡Œç¼“å­˜ï¼Œè¿™æ ·è§£å†³ asm ç”Ÿæˆç±»è¿‡ç¨‹ä½æ•ˆé—®é¢˜ï¼‰ã€‚è¿˜æœ‰ä¸€ç‚¹å¿…é¡»æ³¨æ„ï¼šJDK åŠ¨æ€ä»£ç†çš„åº”ç”¨å‰æï¼Œå¿…é¡»æ˜¯ç›®æ ‡ç±»åŸºäºç»Ÿä¸€çš„æ¥å£ã€‚å¦‚æœæ²¡æœ‰ä¸Šè¿°å‰æï¼ŒJDK åŠ¨æ€ä»£ç†ä¸èƒ½åº”ç”¨ã€‚ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼ŒJDK åŠ¨æ€ä»£ç†æœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œcglib è¿™ç§ç¬¬ä¸‰æ–¹ç±»åº“å®ç°çš„åŠ¨æ€ä»£ç†åº”ç”¨æ›´åŠ å¹¿æ³›ï¼Œä¸”åœ¨æ•ˆç‡ä¸Šæ›´æœ‰ä¼˜åŠ¿ã€‚ å‰è€…å¿…é¡»åŸºäºæ¥å£ï¼Œåè€…ä¸éœ€è¦æ¥å£ï¼Œæ˜¯åŸºäºç»§æ‰¿çš„ï¼Œä½†æ˜¯ä¸èƒ½ä»£ç† final ç±»å’Œ final æ–¹æ³•ï¼›JDK é‡‡ç”¨åå°„æœºåˆ¶è°ƒç”¨å§”æ‰˜ç±»çš„æ–¹æ³•ï¼ŒCGLIB é‡‡ç”¨ç±»ä¼¼ç´¢å¼•çš„æ–¹å¼ç›´æ¥è°ƒç”¨å§”æ‰˜ç±»æ–¹æ³•ï¼›å‰è€…æ•ˆç‡ç•¥ä½äºåè€…æ•ˆç‡ï¼ŒCGLIB æ•ˆç‡ç•¥é«˜ï¼ˆä¸æ˜¯ä¸€å®šçš„ï¼‰ Proxy ç±»ï¼ˆä»£ç†ç±»ï¼‰çš„è®¾è®¡ç”¨åˆ°ä»£ç†æ¨¡å¼çš„è®¾è®¡æ€æƒ³ï¼ŒProxy ç±»å¯¹è±¡å®ç°äº†ä»£ç†ç›®æ ‡çš„æ‰€æœ‰æ¥å£ï¼Œå¹¶ä»£æ›¿ç›®æ ‡å¯¹è±¡è¿›è¡Œå®é™…çš„æ“ä½œã€‚ä»£ç†çš„ç›®çš„æ˜¯åœ¨ç›®æ ‡å¯¹è±¡æ–¹æ³•çš„åŸºç¡€ä¸Šä½œå¢å¼ºï¼Œè¿™ç§å¢å¼ºçš„æœ¬è´¨é€šå¸¸å°±æ˜¯å¯¹ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•è¿›è¡Œæ‹¦æˆªã€‚æ‰€ä»¥ï¼ŒProxy åº”è¯¥åŒ…æ‹¬ä¸€ä¸ªæ–¹æ³•æ‹¦æˆªå™¨ï¼Œæ¥æŒ‡ç¤ºå½“æ‹¦æˆªåˆ°æ–¹æ³•è°ƒç”¨æ—¶ä½œä½•ç§å¤„ç†ã€‚InvocationHandler å°±æ˜¯æ‹¦æˆªå™¨çš„æ¥å£ã€‚ è¦æƒ³åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œéœ€è¦ä½¿ç”¨Proxyç±»çš„newProxyInstanceæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼š ä¸€ä¸ªç±»åŠ è½½å™¨ ä¸€ä¸ªClasså¯¹è±¡æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯éœ€è¦å®ç°çš„æ¥å£ ä¸€ä¸ªè°ƒç”¨å¤„ç†å™¨ï¼ˆInvocationHandlerï¼‰ public class RentInvocationHandler implements InvocationHandler { private Object object;//è¢«ä»£ç†çš„å¯¹è±¡ï¼Œå®é™…çš„æ–¹æ³•æ‰§è¡Œè€… public RentInvocationHandler(Object object) { this.object = object; } //é€šè¿‡Proxyè·å–åŠ¨æ€ä»£ç†çš„å¯¹è±¡ public Object getProxyInstance(){ return Proxy.newProxyInstance(object.getClass().getClassLoader(),object.getClass().getInterfaces(),this) } /** * @param proxy:ä»£ç†ç±» * @param methodï¼šä»£ç†ç±»è°ƒç”¨å¤„ç†ç¨‹åºçš„æ–¹æ³•å¯¹è±¡ * @param argsï¼šæ–¹æ³•çš„å‚æ•° */ @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { System.out.println(\"ä½¿ç”¨åŠ¨æ€ä»£ç†åšçš„ä¸€äº›å¢å¼ºçš„æ“ä½œ......\"); //ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºçœŸå®å¯¹è±¡ //ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºå‚æ•° Object result = method.invoke(object, args); return result; } } ä½¿ç”¨çš„æ—¶å€™å°±ç›´æ¥ä¼ è¦ä»£ç†çš„å¯¹è±¡æ„é€ ä»£ç†å¯¹è±¡å°±è¡Œäº†ã€‚ 2.1.2 åŸç†Proxy.newProxyInstanceï¼š public static Object newProxyInstance(ClassLoader loader, Class&lt;?>[] interfaces, InvocationHandler h) throws IllegalArgumentException { Objects.requireNonNull(h); final Class&lt;?>[] intfs = interfaces.clone(); final SecurityManager sm = System.getSecurityManager(); if (sm != null) { checkProxyAccess(Reflection.getCallerClass(), loader, intfs); } /* * Look up or generate the designated proxy class. */ //ç”Ÿæˆä»£ç†ç±»çš„Classå¯¹è±¡ Class&lt;?> cl = getProxyClass0(loader, intfs); /* * Invoke its constructor with the designated invocation handler. */ try { if (sm != null) { checkNewProxyPermission(Reflection.getCallerClass(), cl); } // è·å–ä»£ç†å¯¹è±¡çš„æ„é€ æ–¹æ³•ï¼ˆconstructorParamså°±æ˜¯InvocationHandlerçš„Classï¼‰ final Constructor&lt;?> cons = cl.getConstructor(constructorParams); final InvocationHandler ih = h; if (!Modifier.isPublic(cl.getModifiers())) { AccessController.doPrivileged(new PrivilegedAction&lt;Void>() { public Void run() { cons.setAccessible(true); return null; } }); } // ç”Ÿæˆä»£ç†ç±»çš„å®ä¾‹å¹¶æŠŠ InvocationHandlerImpl çš„å®ä¾‹ä¼ ç»™å®ƒçš„æ„é€ æ–¹æ³• return cons.newInstance(new Object[]{h}); } catch (IllegalAccessException|InstantiationException e) { throw new InternalError(e.toString(), e); } catch (InvocationTargetException e) { Throwable t = e.getCause(); if (t instanceof RuntimeException) { throw (RuntimeException) t; } else { throw new InternalError(t.toString(), t); } } catch (NoSuchMethodException e) { throw new InternalError(e.toString(), e); } } å¯ä»¥çœ‹å‡ºgetProxyClass0åº”è¯¥å°±æ˜¯ç”Ÿæˆä»£ç†ç±»å­—èŠ‚ç çš„å…³é”®ã€‚ private static Class&lt;?> getProxyClass0(ClassLoader loader, Class&lt;?>... interfaces) { if (interfaces.length > 65535) { throw new IllegalArgumentException(\"interface limit exceeded\"); } // If the proxy class defined by the given loader implementing // the given interfaces exists, this will simply return the cached copy; // otherwise, it will create the proxy class via the ProxyClassFactory return proxyClassCache.get(loader, interfaces); } private static final WeakCache&lt;ClassLoader, Class&lt;?>[], Class&lt;?>> proxyClassCache = new WeakCache&lt;>(new KeyFactory(), new ProxyClassFactory()); public V get(K key, P parameter) { Objects.requireNonNull(parameter); expungeStaleEntries(); Object cacheKey = CacheKey.valueOf(key, refQueue); // lazily install the 2nd level valuesMap for the particular cacheKey ConcurrentMap&lt;Object, Supplier&lt;V>> valuesMap = map.get(cacheKey); if (valuesMap == null) { ConcurrentMap&lt;Object, Supplier&lt;V>> oldValuesMap = map.putIfAbsent(cacheKey, valuesMap = new ConcurrentHashMap&lt;>()); if (oldValuesMap != null) { valuesMap = oldValuesMap; } } // create subKey and retrieve the possible Supplier&lt;V> stored by that // subKey from valuesMap Object subKey = Objects.requireNonNull(subKeyFactory.apply(key, parameter)); Supplier&lt;V> supplier = valuesMap.get(subKey); Factory factory = null; while (true) { if (supplier != null) { // supplier might be a Factory or a CacheValue&lt;V> instance V value = supplier.get(); if (value != null) { return value; } } // else no supplier in cache // or a supplier that returned null (could be a cleared CacheValue // or a Factory that wasn't successful in installing the CacheValue) // lazily construct a Factory if (factory == null) { factory = new Factory(key, parameter, subKey, valuesMap); } if (supplier == null) { supplier = valuesMap.putIfAbsent(subKey, factory); if (supplier == null) { // successfully installed Factory supplier = factory; } // else retry with winning supplier } else { if (valuesMap.replace(subKey, supplier, factory)) { // successfully replaced // cleared CacheEntry / unsuccessful Factory // with our Factory supplier = factory; } else { // retry with current supplier supplier = valuesMap.get(subKey); } } } } æœ€ç»ˆè·Ÿéšæºç ä¼šæ‰¾åˆ°ProxyGenerator.generateClassFileæ–¹æ³•ï¼Œå®é™…ä¸Šå°±æ˜¯æ ¹æ®classæ–‡ä»¶è§„åˆ™æ”¹å†™å­—èŠ‚ç æµã€‚ private byte[] generateClassFile() { this.addProxyMethod(hashCodeMethod, Object.class); this.addProxyMethod(equalsMethod, Object.class); this.addProxyMethod(toStringMethod, Object.class); Class[] var1 = this.interfaces; int var2 = var1.length; int var3; Class var4; for(var3 = 0; var3 &lt; var2; ++var3) { var4 = var1[var3]; Method[] var5 = var4.getMethods(); int var6 = var5.length; for(int var7 = 0; var7 &lt; var6; ++var7) { Method var8 = var5[var7]; this.addProxyMethod(var8, var4); } } Iterator var11 = this.proxyMethods.values().iterator(); List var12; while(var11.hasNext()) { var12 = (List)var11.next(); checkReturnTypes(var12); } Iterator var15; try { this.methods.add(this.generateConstructor()); var11 = this.proxyMethods.values().iterator(); while(var11.hasNext()) { var12 = (List)var11.next(); var15 = var12.iterator(); while(var15.hasNext()) { ProxyGenerator.ProxyMethod var16 = (ProxyGenerator.ProxyMethod)var15.next(); this.fields.add(new ProxyGenerator.FieldInfo(var16.methodFieldName, \"Ljava/lang/reflect/Method;\", 10)); this.methods.add(var16.generateMethod()); } } this.methods.add(this.generateStaticInitializer()); } catch (IOException var10) { throw new InternalError(\"unexpected I/O Exception\", var10); } if (this.methods.size() > 65535) { throw new IllegalArgumentException(\"method limit exceeded\"); } else if (this.fields.size() > 65535) { throw new IllegalArgumentException(\"field limit exceeded\"); } else { this.cp.getClass(dotToSlash(this.className)); this.cp.getClass(\"java/lang/reflect/Proxy\"); var1 = this.interfaces; var2 = var1.length; for(var3 = 0; var3 &lt; var2; ++var3) { var4 = var1[var3]; this.cp.getClass(dotToSlash(var4.getName())); } this.cp.setReadOnly(); ByteArrayOutputStream var13 = new ByteArrayOutputStream(); DataOutputStream var14 = new DataOutputStream(var13); try { var14.writeInt(-889275714); var14.writeShort(0); var14.writeShort(49); this.cp.write(var14); var14.writeShort(this.accessFlags); var14.writeShort(this.cp.getClass(dotToSlash(this.className))); var14.writeShort(this.cp.getClass(\"java/lang/reflect/Proxy\")); var14.writeShort(this.interfaces.length); Class[] var17 = this.interfaces; int var18 = var17.length; for(int var19 = 0; var19 &lt; var18; ++var19) { Class var22 = var17[var19]; var14.writeShort(this.cp.getClass(dotToSlash(var22.getName()))); } var14.writeShort(this.fields.size()); var15 = this.fields.iterator(); while(var15.hasNext()) { ProxyGenerator.FieldInfo var20 = (ProxyGenerator.FieldInfo)var15.next(); var20.write(var14); } var14.writeShort(this.methods.size()); var15 = this.methods.iterator(); while(var15.hasNext()) { ProxyGenerator.MethodInfo var21 = (ProxyGenerator.MethodInfo)var15.next(); var21.write(var14); } var14.writeShort(0); return var13.toByteArray(); } catch (IOException var9) { throw new InternalError(\"unexpected I/O Exception\", var9); } } } 2.2 CGLIBåŠ¨æ€ä»£ç†CGLIB(Code Generation Library)æ˜¯ä¸€ä¸ªåŸºäº ASM çš„å­—èŠ‚ç ç”Ÿæˆåº“ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶å¯¹å­—èŠ‚ç è¿›è¡Œä¿®æ”¹å’ŒåŠ¨æ€ç”Ÿæˆã€‚CGLIB é€šè¿‡ç»§æ‰¿æ–¹å¼å®ç°ä»£ç†ã€‚ CGLIB çš„æ ¸å¿ƒç±»ï¼š net.sf.cglib.proxy.Enhancer â€“ ä¸»è¦çš„å¢å¼ºç±» net.sf.cglib.proxy.MethodInterceptor â€“ ä¸»è¦çš„æ–¹æ³•æ‹¦æˆªç±»ï¼Œå®ƒæ˜¯ Callback æ¥å£çš„å­æ¥å£ï¼Œéœ€è¦ç”¨æˆ·å®ç° net.sf.cglib.proxy.MethodProxy â€“ JDK çš„ java.lang.reflect.Method ç±»çš„ä»£ç†ç±»ï¼Œå¯ä»¥æ–¹ä¾¿çš„å®ç°å¯¹æºå¯¹è±¡æ–¹æ³•çš„è°ƒç”¨,å¦‚ä½¿ç”¨ï¼š Object o = methodProxy.invokeSuper(proxy, args);//è™½ç„¶ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¢«ä»£ç†å¯¹è±¡ï¼Œä¹Ÿä¸ä¼šå‡ºç°æ­»å¾ªç¯çš„é—®é¢˜ã€‚ net.sf.cglib.proxy.MethodInterceptor æ¥å£æ˜¯æœ€é€šç”¨çš„å›è°ƒï¼ˆcallbackï¼‰ç±»å‹ï¼Œå®ƒç»å¸¸è¢«åŸºäºä»£ç†çš„ AOP ç”¨æ¥å®ç°æ‹¦æˆªï¼ˆinterceptï¼‰æ–¹æ³•çš„è°ƒç”¨ã€‚è¿™ä¸ªæ¥å£åªå®šä¹‰äº†ä¸€ä¸ªæ–¹æ³• public Object intercept( Object object, java.lang.reflect.Method method,Object[] args, MethodProxy proxy) throws Throwable; ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä»£ç†å¯¹åƒï¼Œç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯æ‹¦æˆªçš„æ–¹æ³•å’Œæ–¹æ³•çš„å‚æ•°ã€‚åŸæ¥çš„æ–¹æ³•å¯èƒ½é€šè¿‡ä½¿ç”¨ java.lang.reflect.Method å¯¹è±¡çš„ä¸€èˆ¬åå°„è°ƒç”¨ï¼Œæˆ–è€…ä½¿ç”¨net.sf.cglib.proxy.MethodProxyå¯¹è±¡è°ƒç”¨ã€‚net.sf.cglib.proxy.MethodProxy é€šå¸¸è¢«é¦–é€‰ä½¿ç”¨ï¼Œå› ä¸ºå®ƒæ›´å¿«ã€‚ public class CglibProxy implements MethodInterceptor { @Override public Object intercept(Object o, Method method, Object[] args, MethodProxy methodProxy) throws Throwable { System.out.println(\"++++++before \" + methodProxy.getSuperName() + \"++++++\"); System.out.println(method.getName()); Object o1 = methodProxy.invokeSuper(o, args); System.out.println(\"++++++before \" + methodProxy.getSuperName() + \"++++++\"); return o1; } } public class Main { public static void main(String[] args) { CglibProxy cglibProxy = new CglibProxy(); Enhancer enhancer = new Enhancer(); enhancer.setSuperclass(UserServiceImpl.class); enhancer.setCallback(cglibProxy); UserService o = (UserService)enhancer.create(); o.getName(1); o.getAge(1); } } æˆ‘ä»¬é€šè¿‡ CGLIB çš„ Enhancer æ¥æŒ‡å®šè¦ä»£ç†çš„ç›®æ ‡å¯¹è±¡ã€å®é™…å¤„ç†ä»£ç†é€»è¾‘çš„å¯¹è±¡ï¼Œæœ€ç»ˆé€šè¿‡è°ƒç”¨ create()æ–¹æ³•å¾—åˆ°ä»£ç†å¯¹è±¡ï¼Œå¯¹è¿™ä¸ªå¯¹è±¡æ‰€æœ‰é final æ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šè½¬å‘ç»™MethodInterceptor.intercept()æ–¹æ³•ï¼Œåœ¨ intercept()æ–¹æ³•é‡Œæˆ‘ä»¬å¯ä»¥åŠ å…¥ä»»ä½•é€»è¾‘ï¼Œæ¯”å¦‚ä¿®æ”¹æ–¹æ³•å‚æ•°ï¼ŒåŠ å…¥æ—¥å¿—åŠŸèƒ½ã€å®‰å…¨æ£€æŸ¥åŠŸèƒ½ç­‰ï¼›é€šè¿‡è°ƒç”¨ MethodProxy.invokeSuper()æ–¹æ³•ï¼Œæˆ‘ä»¬å°†è°ƒç”¨è½¬å‘ç»™åŸå§‹å¯¹è±¡ï¼Œå…·ä½“åˆ°æœ¬ä¾‹ï¼Œå°±æ˜¯ HelloConcrete çš„å…·ä½“æ–¹æ³•ã€‚CGLIG ä¸­MethodInterceptor çš„ä½œç”¨è·Ÿ JDK ä»£ç†ä¸­çš„ InvocationHandler å¾ˆç±»ä¼¼ï¼Œéƒ½æ˜¯æ–¹æ³•è°ƒç”¨çš„ä¸­è½¬ç«™ã€‚ æ³¨æ„ï¼šå¯¹äºä» Object ä¸­ç»§æ‰¿çš„æ–¹æ³•ï¼ŒCGLIB ä»£ç†ä¹Ÿä¼šè¿›è¡Œä»£ç†ï¼Œå¦‚ hashCode()ã€equals()ã€toString()ç­‰ï¼Œä½†æ˜¯ getClass()ã€wait()ç­‰æ–¹æ³•ä¸ä¼šï¼Œå› ä¸ºå®ƒæ˜¯ final æ–¹æ³•ï¼ŒCGLIB æ— æ³•ä»£ç†ã€‚æ—¢ç„¶æ˜¯ç»§æ‰¿å°±ä¸å¾—ä¸è€ƒè™‘ final çš„é—®é¢˜ã€‚æˆ‘ä»¬çŸ¥é“ final ç±»å‹ä¸èƒ½æœ‰å­ç±»ï¼Œæ‰€ä»¥ CGLIB ä¸èƒ½ä»£ç† final ç±»å‹ã€‚ final æ–¹æ³•æ˜¯ä¸èƒ½é‡è½½çš„ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½é€šè¿‡ CGLIB ä»£ç†ï¼Œé‡åˆ°è¿™ç§æƒ…å†µä¸ä¼šæŠ›å¼‚å¸¸ï¼Œè€Œæ˜¯ä¼šè·³è¿‡ final æ–¹æ³•åªä»£ç†å…¶ä»–æ–¹æ³•ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://www.codetool.top/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"},{"name":"åŠ¨æ€ä»£ç†","slug":"åŠ¨æ€ä»£ç†","permalink":"https://www.codetool.top/tags/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"}]},{"title":"CopyOnWriteArrayListæºç åˆ†æ","slug":"CopyOnWriteArrayListæºç åˆ†æ","date":"2020-02-15T11:45:35.000Z","updated":"2020-04-22T09:27:27.142Z","comments":true,"path":"article/CopyOnWriteArrayListæºç åˆ†æ/","link":"","permalink":"https://www.codetool.top/article/CopyOnWriteArrayList%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","excerpt":"","text":"1 æ€»ç»“æ€»ç»“æ”¾å‰é¢é˜²æ­¢å¤ªé•¿ä¸çœ‹ CopyOnWriteArrayListæ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨ã€å¹¶ä¸”åœ¨è¯»æ“ä½œæ—¶æ— é”çš„Listå®ç°ã€‚ CopyOnWriteArrayListå†…éƒ¨é€šè¿‡volatileæ•°ç»„æ¥å­˜å‚¨æ•°æ®ï¼Œé€šè¿‡getArrayå’ŒsetArrayç»´æŒè¯­ä¹‰ï¼Œè¯»æ“ä½œä¸åŠ é”ï¼Œå†™æ“ä½œå¤åˆ¶åŸæ•°ç»„ç„¶ååœ¨å¤åˆ¶çš„æ•°ç»„ä¸Šé¢è¿›è¡Œæ“ä½œï¼Œå®Œæˆæ“ä½œä¹‹åå†ç”¨æ–°æ•°ç»„æ›¿æ¢åŸæ•°ç»„ã€‚ CopyOnWriteArrayListé€‚åˆè¯»å¤šå†™å°‘çš„å¹¶å‘åœºæ™¯ï¼Œå®ƒçš„å†™æ“ä½œæ•ˆç‡æä½ï¼Œæ‰€æœ‰å†™æ“ä½œå…±ç”¨ä¸€æŠŠé”ï¼Œç”šè‡³åœ¨å®¹é‡è¾¾åˆ°æ•°ç»„ä¸Šé™çš„æ—¶å€™æ·»åŠ å…ƒç´ åªä¼šç”¨ä¸€ä¸ªåŸæ•°ç»„çš„å®¹é‡+1çš„æ–°æ•°ç»„æ¥ä»£æ›¿å®ƒã€‚ åªèƒ½ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œä¸èƒ½ä¿è¯æ•°æ®çš„å®æ—¶ä¸€è‡´æ€§ã€‚å†™å’Œè¯»åˆ†åˆ«ä½œç”¨åœ¨æ–°è€ä¸åŒå®¹å™¨ä¸Šï¼Œåœ¨å†™æ“ä½œæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¯»ä¸ä¼šé˜»å¡ä½†è¯»å–åˆ°çš„å´æ˜¯è€å®¹å™¨çš„æ•°æ®ã€‚ 2 é‡è¦æ–¹æ³•2.1 addpublic boolean add(E e) { final ReentrantLock lock = this.lock; lock.lock(); try { // ä»…ä»…return å†…éƒ¨ array Object[] elements = getArray(); int len = elements.length; // å¤åˆ¶ä¸€ä¸ªæ•°ç»„ï¼Œå¹¶ä¸”å®¹é‡+1 Object[] newElements = Arrays.copyOf(elements, len + 1); newElements[len] = e; // ç”¨æ–°æ•°ç»„æ›¿æ¢å†…éƒ¨æ•°ç»„ setArray(newElements); return true; } finally { lock.unlock(); } } 2.2 getpublic E get(int index) { return get(getArray(), index); } private E get(Object[] a, int index) { return (E) a[index]; } å¯ä»¥çœ‹å‡ºæ— è®ºåœ¨ä»€ä¹ˆæ—¶å€™è·å–æ•°ç»„éƒ½æ˜¯ä½¿ç”¨çš„getArray()ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›å†…éƒ¨æ•°ç»„arrayï¼Œè€Œå¯¹arrayçš„ä¿®æ”¹å¹¶ä¸ä¼šåœ¨åŸæ•°ç»„ä¸Šç›´æ¥æ“ä½œï¼Œè€Œæ˜¯å…ˆå¤åˆ¶å†æ“ä½œï¼Œæ“ä½œå®Œä¹‹åæ›¿æ¢åŸæ¥çš„æ•°ç»„ï¼Œè¿™æ ·ä¸è®ºåœ¨ä»€ä¹ˆæ—¶å€™å†™å’Œè¯»éƒ½ä¸ä¼šåœ¨åŒä¸€ä¸ªæ•°ç»„ä¸Šæ“ä½œè€Œé€ æˆå†²çªã€‚ 2.3 setpublic E set(int index, E element) { //å†™æ“ä½œç”¨çš„æ˜¯åŒä¸€æŠŠé” final ReentrantLock lock = this.lock; lock.lock(); try { Object[] elements = getArray(); E oldValue = get(elements, index); if (oldValue != element) { int len = elements.length; Object[] newElements = Arrays.copyOf(elements, len); newElements[index] = element; setArray(newElements); } else { // ä¸ºäº†ä¿æŒâ€œvolatileâ€çš„è¯­ä¹‰ï¼Œä»»ä½•ä¸€ä¸ªè¯»æ“ä½œéƒ½åº”è¯¥æ˜¯ä¸€ä¸ªå†™æ“ä½œçš„ç»“æœï¼Œ // ä¹Ÿå°±æ˜¯è¯»æ“ä½œçœ‹åˆ°çš„æ•°æ®ä¸€å®šæ˜¯æŸä¸ªå†™æ“ä½œçš„ç»“æœï¼ˆå°½ç®¡å†™æ“ä½œæ²¡æœ‰æ”¹å˜æ•°æ®æœ¬èº«ï¼‰ã€‚ // æ‰€ä»¥è¿™é‡Œå³ä½¿ä¸è®¾ç½®ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œä»…ä»…æ˜¯ä¸ºäº†ä¸€ä¸ªè¯­ä¹‰ä¸Šçš„è¡¥å……ï¼ˆå°±å¦‚æºç ä¸­çš„æ³¨é‡Šæ‰€è¨€ï¼‰ // Not quite a no-op; ensures volatile write semantics setArray(elements); } return oldValue; } finally { lock.unlock(); } } 2.4 removepublic E remove(int index) { final ReentrantLock lock = this.lock; lock.lock(); try { Object[] elements = getArray(); int len = elements.length; E oldValue = get(elements, index); int numMoved = len - index - 1; if (numMoved == 0) setArray(Arrays.copyOf(elements, len - 1)); else { //ç§»é™¤çš„æ—¶å€™æ•°ç»„å®¹é‡ä¹Ÿæ˜¯å®Œå…¨ç´§è·Ÿå…ƒç´ çš„æ•°é‡ï¼Œä¸ç•™ç©ºé—´ Object[] newElements = new Object[len - 1]; System.arraycopy(elements, 0, newElements, 0, index); System.arraycopy(elements, index + 1, newElements, index, numMoved); setArray(newElements); } return oldValue; } finally { lock.unlock(); } }","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jdk","slug":"jdk","permalink":"https://www.codetool.top/tags/jdk/"},{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://www.codetool.top/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://www.codetool.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"é—ç•™çº¿ç¨‹å®‰å…¨ç±»Vectorå’ŒHashTableç®€è¦æºç åˆ†æ","slug":"é—ç•™çº¿ç¨‹å®‰å…¨ç±»Vectorå’ŒHashTableç®€è¦æºç åˆ†æ","date":"2020-02-15T09:06:19.000Z","updated":"2020-04-22T09:27:27.142Z","comments":true,"path":"article/é—ç•™çº¿ç¨‹å®‰å…¨ç±»Vectorå’ŒHashTableç®€è¦æºç åˆ†æ/","link":"","permalink":"https://www.codetool.top/article/%E9%81%97%E7%95%99%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%B1%BBVector%E5%92%8CHashTable%E7%AE%80%E8%A6%81%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","excerpt":"","text":"1 æ€»ç»“æ€»ç»“æ”¾å‰é¢é˜²æ­¢å¤ªé•¿ä¸çœ‹ 1.1 Vector Vectorå°±æ˜¯ä½¿ç”¨synchronizedé™åˆ¶çº¿ç¨‹å®‰å…¨çš„ä¸€ä¸ªListå®ç°ã€‚ Vectoræ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œé»˜è®¤åˆå§‹å®¹é‡æ˜¯10ï¼Œåœ¨æ„é€ çš„æ—¶å€™å¯ä»¥æŒ‡å®šåˆå§‹å®¹é‡å’Œä¸€ä¸ªcapacityIncrementï¼Œæ‰©å®¹æ—¶é»˜è®¤ç¿»å€æ‰©å®¹ï¼Œå¦‚æœæŒ‡å®šäº†capacityIncrementåˆ™æ¯æ¬¡æ‰©å®¹å¢åŠ capacityIncrementå®¹é‡ã€‚ Stackæ˜¯åŸºäºVectorå®ç°çš„ã€‚ 1.2 HashTable HashTableåªç”¨æ•°ç»„+é“¾è¡¨å­˜å‚¨èŠ‚ç‚¹ã€‚ HashTableæ·»åŠ èŠ‚ç‚¹çš„æ—¶å€™æŠŠèŠ‚ç‚¹è¿åœ¨é“¾è¡¨çš„å¤´éƒ¨è€Œä¸æ˜¯å°¾éƒ¨ã€‚ HashTableçš„èŠ‚ç‚¹ç±»å‹æ˜¯å†…éƒ¨ç±»Entryã€‚ HashTableçš„æ•°ç»„ä¸‹æ ‡ä¸å“ˆå¸Œå€¼çš„å¯¹åº”å…³ç³»æ˜¯(hash &amp; 0x7FFFFFFF) % tab.lengthï¼Œæœ¬è´¨ä¸Šåªæ˜¯æŠŠHashMapçš„tab.length-1æ¢æˆäº†0x7FFFFFFFï¼Œä¿è¯æœ€é«˜ä½ç¬¦å·ä½ä¸ä¸º1ï¼Œä½†HashMapæŠŠæ¨¡è¿ç®—æ¢æˆäº†ä½è¿ç®—ï¼Œæé«˜äº†æ•ˆç‡ã€‚ HashTableçš„æ•°ç»„åˆå§‹å®¹é‡ä¸º11ï¼Œä¸è¦æ±‚å¿…é¡»æ˜¯2çš„æ•´æ•°æ¬¡å¹‚ï¼Œç”šè‡³æ‰©å®¹çš„æ—¶å€™ä½¿ç”¨2*oldCapacity+1æ¥æ‰©å®¹ä¿è¯å¥‡æ•°ã€‚ 2 Vector2.1 æ„é€ å‡½æ•°public Vector() { this(10); } public Vector(int initialCapacity) { this(initialCapacity, 0); } public Vector(int initialCapacity, int capacityIncrement) { super(); if (initialCapacity &lt; 0) throw new IllegalArgumentException(\"Illegal Capacity: \"+ initialCapacity); this.elementData = new Object[initialCapacity]; this.capacityIncrement = capacityIncrement; } å¯ä»¥çŸ¥é“Vectorä¹Ÿæ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œé»˜è®¤åˆå§‹å®¹é‡æ˜¯10ï¼Œåœ¨æ„é€ çš„æ—¶å€™å¯ä»¥æŒ‡å®šåˆå§‹å®¹é‡å’Œä¸€ä¸ªcapacityIncrementï¼Œå¯ä»¥çŒœåˆ°å’Œæ‰©å®¹ç›¸å…³ã€‚ 2.2 Addpublic synchronized boolean add(E e) { modCount++; ensureCapacityHelper(elementCount + 1); elementData[elementCount++] = e; return true; } ä½¿ç”¨synchronizedå°†æ•´ä¸ªå‡½æ•°é™åˆ¶äº†åŒæ­¥ï¼Œé‡ç‚¹çœ‹æ‰©å®¹ï¼š private void ensureCapacityHelper(int minCapacity) { // overflow-conscious code if (minCapacity - elementData.length > 0) grow(minCapacity); } private void grow(int minCapacity) { // overflow-conscious code int oldCapacity = elementData.length; // ç¿»å€æ‰©å®¹ï¼Œå¦‚æœæŒ‡å®šäº†capacityIncrementåˆ™æ¯æ¬¡æ‰©å®¹å¢åŠ capacityIncrementå®¹é‡ int newCapacity = oldCapacity + ((capacityIncrement > 0) ? capacityIncrement : oldCapacity); if (newCapacity - minCapacity &lt; 0) newCapacity = minCapacity; if (newCapacity - MAX_ARRAY_SIZE > 0) newCapacity = hugeCapacity(minCapacity); elementData = Arrays.copyOf(elementData, newCapacity); } æ‰©å®¹æœºåˆ¶å’ŒArrayListç¨æœ‰ä¸åŒï¼Œé»˜è®¤ç¿»å€æ‰©å®¹ï¼Œå¦‚æœæŒ‡å®šäº†capacityIncrementåˆ™æ¯æ¬¡æ‰©å®¹å¢åŠ capacityIncrementå®¹é‡ã€‚ 2.3 removepublic synchronized E remove(int index) { modCount++; if (index >= elementCount) throw new ArrayIndexOutOfBoundsException(index); E oldValue = elementData(index); int numMoved = elementCount - index - 1; if (numMoved > 0) System.arraycopy(elementData, index+1, elementData, index, numMoved); elementData[--elementCount] = null; // Let gc do its work return oldValue; } åˆ é™¤æœºåˆ¶å’ŒArrayListä¸€æ ·ï¼Œå°±æ˜¯ç”¨synchronizedæŠŠæ•´ä¸ªå‡½æ•°ä¿®é¥°äº†ã€‚ 3 HashTable3.1 æ„é€ æ–¹æ³•public Hashtable() { this(11, 0.75f); } public Hashtable(int initialCapacity) { this(initialCapacity, 0.75f); } public Hashtable(int initialCapacity, float loadFactor) { if (initialCapacity &lt; 0) throw new IllegalArgumentException(\"Illegal Capacity: \"+ initialCapacity); if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException(\"Illegal Load: \"+loadFactor); if (initialCapacity==0) initialCapacity = 1; this.loadFactor = loadFactor; table = new Entry&lt;?,?>[initialCapacity]; threshold = (int)Math.min(initialCapacity * loadFactor, MAX_ARRAY_SIZE + 1); } å¯ä»¥çœ‹å‡ºï¼Œå’ŒHashMapç±»ä¼¼ï¼Œä¹Ÿæœ‰loadFactorï¼Œé»˜è®¤ä½0.75fï¼Œè€ŒinitialCapacityé»˜è®¤ä¸º11ï¼Œä¸æ˜¯ä¸€ä¸ª2çš„æ•´æ•°æ¬¡å¹‚ã€‚ 3.2 putpublic synchronized V put(K key, V value) { // Make sure the value is not null if (value == null) { throw new NullPointerException(); } // Makes sure the key is not already in the hashtable. Entry&lt;?,?> tab[] = table; int hash = key.hashCode(); int index = (hash &amp; 0x7FFFFFFF) % tab.length; @SuppressWarnings(\"unchecked\") Entry&lt;K,V> entry = (Entry&lt;K,V>)tab[index]; for(; entry != null ; entry = entry.next) { //å¦‚æœåŸæ¥å­˜åœ¨æ—§å€¼ï¼Œæ›¿æ¢æ—§å€¼ if ((entry.hash == hash) &amp;&amp; entry.key.equals(key)) { V old = entry.value; entry.value = value; return old; } } addEntry(hash, key, value, index); return null; } private void addEntry(int hash, K key, V value, int index) { modCount++; Entry&lt;?,?> tab[] = table; if (count >= threshold) { // Rehash the table if the threshold is exceeded rehash(); tab = table; hash = key.hashCode(); index = (hash &amp; 0x7FFFFFFF) % tab.length; } // Creates the new entry. @SuppressWarnings(\"unchecked\") Entry&lt;K,V> e = (Entry&lt;K,V>) tab[index]; //æŠŠeèµ‹å€¼ç»™äº†æ–°èŠ‚ç‚¹çš„nextï¼Œå¯è§æ˜¯æŠŠæ–°èŠ‚ç‚¹æ”¾åœ¨äº†é“¾è¡¨çš„å¤´éƒ¨ tab[index] = new Entry&lt;>(hash, key, value, e); count++; } é€šè¿‡è¿™ä¸ªå‡½æ•°å‘ç°å®ƒå’ŒJDK1.8çš„HashMapè¿˜æ˜¯æœ‰æŒºå¤§ä¸åŒçš„ï¼š HashTableåªç”¨æ•°ç»„+é“¾è¡¨å­˜å‚¨èŠ‚ç‚¹ï¼ŒJDK1.8çš„HashMapå¢åŠ äº†çº¢é»‘æ ‘ã€‚ HashTableæ·»åŠ èŠ‚ç‚¹çš„æ—¶å€™æŠŠèŠ‚ç‚¹è¿åœ¨é“¾è¡¨çš„å¤´éƒ¨è€Œä¸æ˜¯å°¾éƒ¨ã€‚ HashTableçš„èŠ‚ç‚¹ç±»å‹æ˜¯å†…éƒ¨ç±»Entryï¼Œè€ŒHashMapæ˜¯Nodeã€‚ æ•°ç»„ä¸‹æ ‡ä¸å“ˆå¸Œå€¼çš„å¯¹åº”å…³ç³»ä¸åŒï¼ŒHashTableæ˜¯(hash &amp; 0x7FFFFFFF) % tab.lengthï¼Œæœ¬è´¨ä¸Šåªæ˜¯æŠŠHashMapçš„tab.length-1æ¢æˆäº†0x7FFFFFFFï¼Œä½†HashMapæŠŠæ¨¡è¿ç®—æ¢æˆäº†ä½è¿ç®—ï¼Œæé«˜äº†æ•ˆç‡ã€‚ ç„¶åæ¥çœ‹æ‰©å®¹ï¼šæ‰©å®¹åªå‘ç”Ÿåœ¨count &gt;= thresholdçš„æ—¶å€™ protected void rehash() { int oldCapacity = table.length; Entry&lt;?,?>[] oldMap = table; // overflow-conscious code // æ–°çš„å®¹é‡ï¼šæ—§å®¹é‡çš„ä¸¤å€+1 int newCapacity = (oldCapacity &lt;&lt; 1) + 1; if (newCapacity - MAX_ARRAY_SIZE > 0) { if (oldCapacity == MAX_ARRAY_SIZE) // Keep running with MAX_ARRAY_SIZE buckets return; newCapacity = MAX_ARRAY_SIZE; } Entry&lt;?,?>[] newMap = new Entry&lt;?,?>[newCapacity]; modCount++; threshold = (int)Math.min(newCapacity * loadFactor, MAX_ARRAY_SIZE + 1); table = newMap; // é‡å»ºHashè¡¨ for (int i = oldCapacity ; i-- > 0 ;) { for (Entry&lt;K,V> old = (Entry&lt;K,V>)oldMap[i] ; old != null ; ) { Entry&lt;K,V> e = old; old = old.next; int index = (e.hash &amp; 0x7FFFFFFF) % newCapacity; e.next = (Entry&lt;K,V>)newMap[index]; newMap[index] = e; } } } 3.3 removepublic synchronized V remove(Object key) { Entry&lt;?,?> tab[] = table; int hash = key.hashCode(); int index = (hash &amp; 0x7FFFFFFF) % tab.length; @SuppressWarnings(\"unchecked\") Entry&lt;K,V> e = (Entry&lt;K,V>)tab[index]; for(Entry&lt;K,V> prev = null ; e != null ; prev = e, e = e.next) { if ((e.hash == hash) &amp;&amp; e.key.equals(key)) { modCount++; if (prev != null) { prev.next = e.next; } else { tab[index] = e.next; } count--; V oldValue = e.value; e.value = null; return oldValue; } } return null; } æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œæ­£å¸¸çš„é“¾è¡¨ç§»é™¤èŠ‚ç‚¹çš„æ–¹æ³•ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jdk","slug":"jdk","permalink":"https://www.codetool.top/tags/jdk/"},{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://www.codetool.top/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://www.codetool.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"leetcode45-è·³è·ƒæ¸¸æˆII","slug":"leetcode45-è·³è·ƒæ¸¸æˆII","date":"2020-02-14T17:51:44.000Z","updated":"2020-04-22T09:27:27.142Z","comments":true,"path":"article/leetcode45-è·³è·ƒæ¸¸æˆII/","link":"","permalink":"https://www.codetool.top/article/leetcode45-%E8%B7%B3%E8%B7%83%E6%B8%B8%E6%88%8FII/","excerpt":"","text":"1 åŸé¢˜åŸé¢˜ ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ï¼Œä½ æœ€åˆä½äºæ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚ æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä½ åœ¨è¯¥ä½ç½®å¯ä»¥è·³è·ƒçš„æœ€å¤§é•¿åº¦ã€‚ ä½ çš„ç›®æ ‡æ˜¯ä½¿ç”¨æœ€å°‘çš„è·³è·ƒæ¬¡æ•°åˆ°è¾¾æ•°ç»„çš„æœ€åä¸€ä¸ªä½ç½®ã€‚ ç¤ºä¾‹: è¾“å…¥ï¼š [2,3,1,1,4]è¾“å‡ºï¼š 2è§£é‡Šï¼š è·³åˆ°æœ€åä¸€ä¸ªä½ç½®çš„æœ€å°è·³è·ƒæ•°æ˜¯ 2ã€‚ ä»ä¸‹æ ‡ä¸º 0 è·³åˆ°ä¸‹æ ‡ä¸º 1 çš„ä½ç½®ï¼Œè·³ 1 æ­¥ï¼Œç„¶åè·³ 3 æ­¥åˆ°è¾¾æ•°ç»„çš„æœ€åä¸€ä¸ªä½ç½®ã€‚ è¯´æ˜: å‡è®¾ä½ æ€»æ˜¯å¯ä»¥åˆ°è¾¾æ•°ç»„çš„æœ€åä¸€ä¸ªä½ç½®ã€‚ 2 è§£æ³•2.1 æ€æƒ³ åŠ¨æ€è§„åˆ’ï¼Œæ‰¾åˆ°èƒ½åˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®çš„æœ€é å·¦çš„ç‚¹ï¼Œç„¶åæŠŠè¿™ä¸ªç‚¹è®¾ä¸ºæ–°çš„è¦åˆ°è¾¾çš„ä½ç½®ï¼Œå†æ‰¾èƒ½åˆ°è¾¾è¿™ä¸ªç‚¹çš„æœ€é å·¦çš„ç‚¹ï¼Œç›´åˆ°æ‰¾åˆ°ä¸‹æ ‡0ä¸ºæ­¢ã€‚ è´ªå¿ƒç®—æ³•ï¼Œæ¯è·³ä¸€æ¬¡ï¼Œåœ¨å¯è·³èŒƒå›´å†…æ‰¾èƒ½è·³åˆ°çš„æœ€è¿œçš„åœ°æ–¹ï¼Œåˆ°è¾¾è¿™ä¸ªæœ€è¿œçš„åœ°æ–¹æ—¶åˆ™æ­¥æ•°åŠ ä¸€ã€‚ 2.2 ä»£ç åŠ¨æ€è§„åˆ’ï¼š class Solution { public int jump(int[] nums) { int jumpTo = nums.length-1; int count = 0; while(jumpTo!=0){ for(int i = 0;i&lt;jumpTo;i++){ if(i+nums[i]>=jumpTo) { jumpTo = i; count++; break; } } } return count; } } è´ªå¿ƒç®—æ³•ï¼š(æ¥æºï¼šwindliang) class Solution { public int jump(int[] nums) { int end = 0; int maxPosition = 0; int steps = 0; for(int i = 0; i &lt; nums.length - 1; i++){ //æ‰¾èƒ½è·³çš„æœ€è¿œçš„ maxPosition = Math.max(maxPosition, nums[i] + i); if( i == end){ //é‡åˆ°è¾¹ç•Œï¼Œå°±æ›´æ–°è¾¹ç•Œï¼Œå¹¶ä¸”æ­¥æ•°åŠ ä¸€ end = maxPosition; steps++; } } return steps; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"Javaæ—¥å¿—æ¡†æ¶JULå’ŒLog4jä»‹ç»","slug":"Javaæ—¥å¿—æ¡†æ¶JULå’ŒLog4jä»‹ç»","date":"2020-02-14T14:23:10.000Z","updated":"2020-03-09T18:55:34.773Z","comments":true,"path":"article/Javaæ—¥å¿—æ¡†æ¶JULå’ŒLog4jä»‹ç»/","link":"","permalink":"https://www.codetool.top/article/Java%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6JUL%E5%92%8CLog4j%E4%BB%8B%E7%BB%8D/","excerpt":"","text":"æ—¥å¿—æ–‡ä»¶æ˜¯ç”¨äºè®°å½•ç³»ç»Ÿæ“ä½œäº‹ä»¶çš„æ–‡ä»¶é›†åˆ,å¯åˆ†ä¸ºäº‹ä»¶æ—¥å¿—å’Œæ¶ˆæ¯æ—¥å¿—ã€‚å…·æœ‰å¤„ç†å†å²æ•°æ®ã€è¯Šæ–­é—®é¢˜çš„è¿½è¸ªä»¥åŠç†è§£ç³»ç»Ÿçš„æ´»åŠ¨ç­‰é‡è¦ä½œç”¨ã€‚ æ—¥å¿—å®ç°ï¼šJULã€logbackã€log4jã€log4j2ç­‰ 1 JULå…¨ç§°java util loggingï¼Œæ˜¯javaåŸç”Ÿçš„æ—¥å¿—æ¡†æ¶ï¼Œä½¿ç”¨æ—¶ä¸éœ€è¦å¦å¤–å¼•ç”¨ç¬¬ä¸‰æ–¹ç±»åº“ï¼Œèƒ½å¤Ÿåœ¨å°å‹åº”ç”¨ä¸­çµæ´»ä½¿ç”¨ 1.1 æ¶æ„ä»‹ç» Loggers:è¢«ç§°ä¸ºè®°å½•å™¨,åº”ç”¨ç¨‹åºé€šè¿‡è·å– Loggerå¯¹è±¡,è°ƒç”¨å…¶APIæ¥æ¥å‘å¸ƒæ—¥å¿—ä¿¡æ¯ã€‚Loggeré€šå¸¸æ˜¯åº”ç”¨ç¨‹åºè®¿é—®æ—¥å¿—ç³»ç»Ÿçš„å…¥å£ç¨‹åºã€‚ Appenders:ä¹Ÿè¢«ç§°ä¸ºHandlers,æ¯ä¸ªLoggeréƒ½ä¼šå…³è”ä¸€ç»„Handlers, Loggerä¼šå°†æ—¥å¿—äº¤ç»™å…³è” Handlerså¤„ç†,ç”±Handlersè´Ÿè´£å°†æ—¥å¿—åšè®°å½•ã€‚Handlersåœ¨æ­¤æ˜¯ä¸€ä¸ªæŠ½è±¡,å…¶å…·ä½“çš„å®ç°å†³å®šäº†æ—¥å¿—è®°å½•çš„ä½ç½®å¯ä»¥æ˜¯æ§åˆ¶å°ã€æ–‡ä»¶ã€ç½‘ç»œä¸Šçš„å…¶ä»–æ—¥å¿—æœåŠ¡æˆ–æ“ä½œç³»ç»Ÿæ—¥å¿—ç­‰ã€‚ Layouts:ä¹Ÿè¢«ç§°ä¸ºFormatters,å®ƒè´Ÿè´£å¯¹æ—¥å¿—äº‹ä»¶ä¸­çš„æ•°æ®è¿›è¡Œè½¬æ¢å’Œæ ¼å¼åŒ–ã€‚Layoutså†³å®šäº†æ•°æ®åœ¨ä¸€æ¡æ—¥å¿—è®°å½•ä¸­çš„æœ€ç»ˆå½¢å¼ã€‚ Level:æ¯æ¡æ—¥å¿—æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªå…³è”çš„æ—¥å¿—çº§åˆ«ã€‚è¯¥çº§åˆ«ç²—ç•¥æŒ‡å¯¼äº†æ—¥å¿—æ¶ˆæ¯çš„é‡è¦æ€§å’Œç´§è¿«,å¯ä»¥å°†Levelå’ŒLoggers, Appendersåšå…³è”ä»¥ä¾¿äºæˆ‘ä»¬è¿‡æ»¤æ¶ˆæ¯ã€‚ Filters:è¿‡æ»¤å™¨,æ ¹æ®éœ€è¦å®šåˆ¶å“ªäº›ä¿¡æ¯ä¼šè¢«è®°å½•,å“ªäº›ä¿¡æ¯ä¼šè¢«æ”¾è¿‡ã€‚ 1.2 ä½¿ç”¨public class JULTest { // å¿«é€Ÿå…¥é—¨ @Test public void testQuick() throws Exception{ // 1.è·å–Logger Logger logger = Logger.getLogger(\"com.rhett.JULTest\"); // 2.æ—¥å¿—è®°å½•è¾“å‡º logger.info(\"Hello JUL\"); // é€šç”¨æ–¹æ³•è¿›è¡Œæ—¥å¿—è®°å½• logger.log(Level.INFO,\"info msg\"); // é€šè¿‡å ä½ç¬¦æ–¹å¼è¾“å‡ºå˜é‡å€¼ String name = \"rhett\"; Integer age = 13; logger.log(Level.INFO,\"ç”¨æˆ·ä¿¡æ¯ï¼š{0},{1}\",new Object[]{name,age}); } } JULçš„æ—¥å¿—çº§åˆ«ï¼š OFF -&gt;Integer.MAX_VALUE SEVERE WARNING INFO CONFIG FINE FINER FINEST ALL -&gt;Integer.MIN_VALUE æ¯ä¸ªçº§åˆ«éƒ½æœ‰ä¸€ä¸ªvalueï¼Œå½“è®¾å®šäº†è¿‡æ»¤çº§åˆ«çš„å€¼çš„æ—¶å€™ï¼Œå°äºè¿™ä¸ªå€¼çš„çº§åˆ«ä¿¡æ¯éƒ½ä¸ä¼šè¾“å‡º //æ—¥å¿—çº§åˆ« @Test public void testLogLevel() throws Exception{ // 1.è·å–logger Logger logger = Logger.getLogger(this.getClass().getName()); // 2.æ—¥å¿—è®°å½•è¾“å‡º logger.severe(\"severe\"); logger.warning(\"warning\"); logger.info(\"info\"); // JULé»˜è®¤çš„æ—¥å¿—çº§åˆ« logger.config(\"config\"); logger.fine(\"fine\"); logger.finer(\"finer\"); logger.finest(\"finest\"); } //æ—¥å¿—çº§åˆ« @Test public void testLogConfig() throws Exception{ // 1.è·å–logger Logger logger = Logger.getLogger(this.getClass().getName()); // å…³é—­ç³»ç»Ÿé»˜è®¤é…ç½® logger.setUseParentHandlers(false); // è‡ªå®šä¹‰é…ç½®æ—¥å¿—çº§åˆ« // åˆ›å»ºConsoleHandler æ§åˆ¶å°è¾“å‡º ConsoleHandler consoleHandler = new ConsoleHandler(); // åˆ›å»ºsimpleFormatter SimpleFormatter simpleFormatter = new SimpleFormatter(); // è¿›è¡Œå…³è” consoleHandler.setFormatter(simpleFormatter); logger.addHandler(consoleHandler); // é…ç½®æ—¥å¿—å…·ä½“çº§åˆ« logger.setLevel(Level.ALL); consoleHandler.setLevel(Level.ALL); // åˆ›å»ºFileHandler FileHandler fileHandler = new FileHandler(\"test.log\"); // è¿›è¡Œå…³è” fileHandler.setFormatter(simpleFormatter); logger.addHandler(fileHandler); // 2.æ—¥å¿—è®°å½•è¾“å‡º logger.severe(\"severe\"); logger.warning(\"warning\"); logger.info(\"info\"); // JULé»˜è®¤çš„æ—¥å¿—çº§åˆ« logger.config(\"config\"); logger.fine(\"fine\"); logger.finer(\"finer\"); logger.finest(\"finest\"); } 1.3 loggerçš„çˆ¶å­å…³ç³»@Test public void testLogParent() throws Exception{ Logger logger1 = Logger.getLogger(\"com.rhett\"); Logger logger2 = Logger.getLogger(\"com\"); // æµ‹è¯•ï¼Œlogger2æ˜¯logger1çš„çˆ¶å¯¹è±¡ System.out.println(logger1.getParent() == logger2); // æ‰€æœ‰æ—¥å¿—è®°å½•å™¨çš„é¡¶çº§çˆ¶å…ƒç´  LogManager$RootLoggerï¼Œåç§°ä¸ºç©ºå­—ç¬¦ä¸² System.out.println(\"logger2 Parent:\"+logger2.getParent()+\",name:\"+logger2.getParent().getName()); // å…³é—­é»˜è®¤é…ç½® logger2.setUseParentHandlers(false); // è®¾ç½®logger2æ—¥å¿—çº§åˆ« // è‡ªå®šä¹‰é…ç½®æ—¥å¿—çº§åˆ« // åˆ›å»ºConsoleHandler æ§åˆ¶å°è¾“å‡º ConsoleHandler consoleHandler = new ConsoleHandler(); // åˆ›å»ºsimpleFormatter SimpleFormatter simpleFormatter = new SimpleFormatter(); // è¿›è¡Œå…³è” consoleHandler.setFormatter(simpleFormatter); logger2.addHandler(consoleHandler); // é…ç½®æ—¥å¿—å…·ä½“çº§åˆ« logger2.setLevel(Level.ALL); consoleHandler.setLevel(Level.ALL); logger1.severe(\"severe\"); logger1.warning(\"warning\"); logger1.info(\"info\"); // JULé»˜è®¤çš„æ—¥å¿—çº§åˆ« logger1.config(\"config\"); logger1.fine(\"fine\"); logger1.finer(\"finer\"); logger1.finest(\"finest\"); } 1.4 è‡ªå®šä¹‰é…ç½®æ–‡ä»¶é»˜è®¤é…ç½®æ–‡ä»¶ï¼šï¼ˆlogging.propertiesï¼‰ # root logger çš„é»˜è®¤å¤„ç†å™¨ handlers= java.util.logging.ConsoleHandler # ä»£è¡¨çš„æ˜¯root loggerçš„æ—¥å¿—çº§åˆ« .level= INFO # é»˜è®¤ä½ç½®ï¼šç³»ç»Ÿç”¨æˆ·ç›®å½•ä¸‹ java.util.logging.FileHandler.pattern = %h/java%u.log java.util.logging.FileHandler.limit = 50000 java.util.logging.FileHandler.count = 1 java.util.logging.FileHandler.formatter = java.util.logging.XMLFormatter # å‘æ§åˆ¶å°è¾“å‡ºçš„handlerå¯¹è±¡ # æŒ‡å®šhandlerå¯¹è±¡çš„æ—¥å¿—çº§åˆ« java.util.logging.ConsoleHandler.level = INFO # æŒ‡å®šhandlerå¯¹è±¡çš„æ—¥å¿—æ¶ˆæ¯æ ¼å¼å¯¹è±¡ java.util.logging.ConsoleHandler.formatter = java.util.logging.SimpleFormatter è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼š # root logger çš„é»˜è®¤å¤„ç†å™¨ handlers= java.util.logging.ConsoleHandler # ä»£è¡¨çš„æ˜¯root loggerçš„æ—¥å¿—çº§åˆ« .level= ALL # è‡ªå®šä¹‰Loggerä½¿ç”¨ com.rhett.handlers = java.util.logging.ConsoleHandler com.rhett.level = CONFIG # å‘æ–‡ä»¶è¾“å‡ºçš„handlerå¯¹è±¡ # æŒ‡å®šæ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤ä½ç½®ï¼šç³»ç»Ÿç”¨æˆ·ç›®å½•ä¸‹ java.util.logging.FileHandler.pattern = %h/java%u.log # æŒ‡å®šæ—¥å¿—æ–‡ä»¶å†…å®¹å¤§å°æœ€å¤šä¸º50000æ¡ java.util.logging.FileHandler.limit = 50000 # æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„æ•°é‡ java.util.logging.FileHandler.count = 1 # æŒ‡å®šhandlerå¯¹è±¡çš„Formatter java.util.logging.FileHandler.formatter = java.util.logging.SimpleFormatter # æŒ‡å®šä»¥è¿½åŠ çš„æ–¹å¼æ·»åŠ æ—¥å¿—å†…å®¹ java.util.logging.FileHandler.append = true # å‘æ§åˆ¶å°è¾“å‡ºçš„handlerå¯¹è±¡ # æŒ‡å®šhandlerå¯¹è±¡çš„æ—¥å¿—çº§åˆ« java.util.logging.ConsoleHandler.level = ALL # æŒ‡å®šhandlerå¯¹è±¡çš„Formatter java.util.logging.ConsoleHandler.formatter = java.util.logging.SimpleFormatter # æŒ‡å®šhandlerå¯¹è±¡çš„å­—ç¬¦é›† java.util.logging.ConsoleHandler.encoding = UTF-8 # æŒ‡å®šformatterçš„formatæ ¼å¼ java.util.logging.SimpleFormatter = %4$s: %5$s [%1$tc]%n 1.5 æ—¥å¿—åŸç†è§£æ åˆå§‹åŒ– LogManager LogManageråŠ è½½logging.propertiesé…ç½® æ·»åŠ Loggeråˆ°LogManager ä»å•ä¾‹LogManagerè·å–Logger è®¾ç½®çº§åˆ«Level,å¹¶æŒ‡å®šæ—¥å¿—è®°å½•LogRecord Filteræä¾›äº†æ—¥å¿—çº§åˆ«ä¹‹å¤–æ›´ç»†ç²’åº¦çš„æ§åˆ¶ Handleræ˜¯ç”¨æ¥å¤„ç†æ—¥å¿—è¾“å‡ºä½ç½® Formatteræ˜¯ç”¨æ¥æ ¼å¼åŒ–LogRecordçš„ 2 Log4j2.1 ä½¿ç”¨@Test public void test01()throws Exception{ //åˆå§‹åŒ–é…ç½®ä¿¡æ¯ BasicConfigurator.configure(); //è·å–logger Logger logger = Logger.getLogger(this.getClass()); //æ—¥å¿—è®°å½• logger.info(\"hello log4j\"); //æ—¥å¿—çº§åˆ« logger.fatal(\"fatal\"); // ä¸¥é‡é”™è¯¯ï¼Œä¸€èˆ¬ä¼šé€ æˆç³»ç»Ÿå´©æºƒå¹¶ç»ˆæ­¢è¿è¡Œ logger.error(\"error\"); // é”™è¯¯ä¿¡æ¯ï¼Œä¸€èˆ¬ä¸ä¼šå½±å“ç³»ç»Ÿè¿è¡Œ logger.warn(\"warn\"); // è­¦å‘Šä¿¡æ¯ï¼Œå¯èƒ½ä¼šå‘ç”Ÿé—®é¢˜ logger.info(\"info\"); // è¿è¡Œä¿¡æ¯ï¼Œæ•°æ®è¿æ¥ã€ç½‘ç»œè¿æ¥ã€IOæ“ä½œç­‰ç­‰ logger.debug(\"debug\"); // è°ƒè¯•ä¿¡æ¯ï¼Œä¸€èˆ¬åœ¨å¼€å‘ä¸­ä½¿ç”¨ï¼Œè®°å½•ç¨‹åºå˜é‡å‚æ•°ä¼ é€’ä¿¡æ¯ç­‰ç­‰ logger.trace(\"trace\"); // è¿½è¸ªä¿¡æ¯ï¼Œè®°å½•ç¨‹åºæ‰€æœ‰çš„æµç¨‹ä¿¡æ¯ } 2.2 log4jç»„ä»¶Log4jæ˜¯Apacheçš„ä¸€ä¸ªå¼€æºé¡¹ç›®ã€‚ Log4Jä¸»è¦ç”±Loggers (æ—¥å¿—è®°å½•å™¨)ã€Appenders (è¾“å‡ºç«¯)å’ŒLayouts(æ—¥å¿—æ ¼å¼åŒ–å™¨)ç»„æˆã€‚å…¶ä¸­Loggersæ§åˆ¶æ—¥å¿—çš„è¾“å‡ºçº§åˆ«ä¸æ—¥å¿—æ˜¯å¦è¾“å‡º; Appenders æŒ‡å®šæ—¥å¿—çš„è¾“å‡ºæ–¹å¼(è¾“å‡ºåˆ°æ§åˆ¶å°ã€æ–‡ä»¶ç­‰) ; Layoutsæ§åˆ¶æ—¥å¿—ä¿¡æ¯çš„è¾“å‡ºæ ¼å¼ã€‚ 2.2.1 Loggersæ—¥å¿—è®°å½•å™¨ï¼Œè´Ÿè´£æ”¶é›†å¤„ç†æ—¥å¿—è®°å½•ï¼Œå®ä¾‹çš„å‘½åå°±æ˜¯ç±»â€XXâ€çš„full quailied name (ç±»çš„å…¨é™å®šå)ï¼ŒLoggerçš„åå­—å¤§å°å†™æ•æ„Ÿï¼Œå…¶å‘½åæœ‰ç»§æ‰¿æœºåˆ¶:ä¾‹å¦‚:nameä¸ºorg.apache.commonsçš„loggerä¼šç»§æ‰¿nameä¸ºorg.apacheçš„loggerã€‚ Log4Jä¸­æœ‰ä¸€ä¸ªç‰¹æ®Šçš„loggerå«åšâ€rootâ€,ä»–æ˜¯æ‰€æœ‰loggerçš„æ ¹ï¼Œ ä¹Ÿå°±æ„å‘³ç€å…¶ä»–æ‰€æœ‰çš„loggeréƒ½ä¼šç›´æ¥æˆ–è€…é—´æ¥åœ°ç»§æ‰¿è‡ªrootã€‚root loggerå¯ä»¥ç”¨Logger.getRootLogger(æ–¹æ³•è·å–ã€‚ log4j 1.2ä¹‹å‰ï¼ŒLogger ç±»å«Categoryç±»ã€‚ 2.2.2 Appendersç±»ä¼¼äºJULä¸­çš„handlerã€‚ Appenderç”¨æ¥æŒ‡å®šæ—¥å¿—è¾“å‡ºåˆ°å“ªä¸ªåœ°æ–¹ï¼Œå¯ä»¥åŒæ—¶æŒ‡å®šæ—¥å¿—çš„è¾“å‡ºç›®çš„åœ°ã€‚Log4j å¸¸ç”¨çš„è¾“å‡ºç›®çš„åœ°æœ‰ä»¥ä¸‹å‡ ç§: è¾“å‡ºç«¯ç±»å‹ ä½œç”¨ ConsoleAppender å°†æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å° FileAppender å°†æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ DailyRollingFileAppender å°†æ—¥å¿—è¾“å‡ºåˆ°ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œå¹¶ä¸”æ¯å¤©è¾“å‡ºåˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶ RollingFileAppender å°†æ—¥å¿—ä¿¡æ¯è¾“å‡ºåˆ°ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œå¹¶ä¸”æŒ‡å®šæ–‡ä»¶çš„å°ºå¯¸ï¼Œå½“æ–‡ä»¶å¤§å°è¾¾åˆ°æŒ‡å®šå°ºå¯¸æ—¶ï¼Œä¼šè‡ªåŠ¨æŠŠæ–‡ä»¶æ”¹åï¼ŒåŒæ—¶äº§ç”Ÿä¸€ä¸ªæ–°çš„æ–‡ä»¶ JDBCAppender æŠŠæ—¥å¿—ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“ä¸­ 2.2.3 Layoutsç±»ä¼¼äºJULä¸­çš„Formatterã€‚ å¸ƒå±€å™¨Layoutsç”¨äºæ§åˆ¶æ—¥å¿—è¾“å‡ºå†…å®¹çš„æ ¼å¼ï¼Œè®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å„ç§éœ€è¦çš„æ ¼å¼è¾“å‡ºæ—¥å¿—ã€‚Log4jå¸¸ç”¨çš„Layouts: æ ¼å¼åŒ–å™¨ç±»å‹ ä½œç”¨ HTMLLayout æ ¼å¼åŒ–æ—¥å¿—è¾“å‡ºä¸ºHTMLè¡¨æ ¼å½¢å¼ SimpleLayout ç®€å•çš„æ—¥å¿—è¾“å‡ºæ ¼å¼åŒ–ï¼Œæ‰“å°çš„æ—¥å¿—æ ¼å¼ä¸º(info - message) PatternLayout æœ€å¼ºå¤§çš„æ ¼å¼åŒ–å™¨ï¼Œå¯ä»¥æ ¹æ®è‡ªå®šä¹‰æ ¼å¼è¾“å‡ºæ—¥å¿—ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šè½¬æ¢æ ¼å¼ï¼Œå°±æ˜¯ç”¨é»˜è®¤çš„è½¬æ¢æ ¼å¼ 2.3 é…ç½®æ–‡ä»¶log4j.properties: # æŒ‡å®šRoot Logger é»˜è®¤é…ç½®ä¿¡æ¯ # æŒ‡å®šæ—¥å¿—çº§åˆ«ï¼Œä½¿ç”¨çš„appender log4j.rootLogger = trace,console # æŒ‡å®šæ—¥å¿—è¾“å‡ºçš„appenderå¯¹è±¡ log4j.appender.console = org.apache.log4j.ConsoleAppender # æŒ‡å®šappenderä½¿ç”¨çš„layout log4j.appender.console.layout = org.apache.log4j.SimpleLayout ä½¿ç”¨PatternLayoutï¼š # æŒ‡å®šRoot Logger é»˜è®¤é…ç½®ä¿¡æ¯ # æŒ‡å®šæ—¥å¿—çº§åˆ«ï¼Œä½¿ç”¨çš„appender log4j.rootLogger = trace,console # æŒ‡å®šæ—¥å¿—è¾“å‡ºçš„appenderå¯¹è±¡ log4j.appender.console = org.apache.log4j.ConsoleAppender # æŒ‡å®šappenderä½¿ç”¨çš„layout log4j.appender.console.layout = org.apache.log4j.PatternLayout log4j.appender.console.layout.conversionPattern = %r [%t] %p %c %x - %m%n conversionPatternçš„å ä½ç¬¦å«ä¹‰å¦‚ä¸‹ï¼š ç¬¦å· å«ä¹‰ %m è¾“å‡ºä»£ç ä¸­æŒ‡å®šçš„æ—¥å¿—ä¿¡æ¯ %p è¾“å‡ºä¼˜å…ˆçº§ï¼Œå³DEBUGã€ INFOç­‰ %n æ¢è¡Œç¬¦(Windowså¹³å°çš„æ¢è¡Œç¬¦ä¸º â€œ\\r\\nâ€, Unixå¹³å°ä¸ºâ€\\nâ€) %r è¾“å‡ºè‡ªåº”ç”¨å¯åŠ¨åˆ°è¾“å‡ºè¯¥logä¿¡æ¯è€—è´¹çš„æ¯«ç§’æ•° %c è¾“å‡ºæ‰“å°è¯­å¥æ‰€å±çš„ç±»çš„å…¨å %t è¾“å‡ºäº§ç”Ÿè¯¥æ—¥å¿—çš„çº¿ç¨‹å…¨å %d è¾“å‡ºæœåŠ¡å™¨å½“å‰æ—¶é—´ï¼Œæ ¼å¼é»˜è®¤ä¸ºISO8601, ä¹Ÿå¯ä»¥æŒ‡å®šæ ¼å¼ï¼Œå¦‚: %d{yyyyå¹´Mæœˆddæ—¥HH:mm:ss} %l è¾“å‡ºæ—¥å¿—æ—¶é—´å‘ç”Ÿçš„ä½ç½®ï¼ŒåŒ…æ‹¬ç±»åã€çº¿ç¨‹ã€åœ¨ä»£ç ä¸­çš„è¡Œæ•°ã€‚å¦‚: Test.main(Test. java:10) %F è¾“å‡ºæ—¥å¿—æ¶ˆæ¯äº§ç”Ÿæ—¶æ‰€åœ¨çš„æ–‡ä»¶åç§° %L è¾“å‡ºä»£ç ä¸­çš„è¡Œå· %% è¾“å‡ºä¸€ä¸ªâ€œ%â€å­—ç¬¦ ä½¿ç”¨FileAppenderï¼š # æŒ‡å®šRoot Logger é»˜è®¤é…ç½®ä¿¡æ¯ # æŒ‡å®šæ—¥å¿—çº§åˆ«ï¼Œä½¿ç”¨çš„appender log4j.rootLogger = trace,console,file # æŒ‡å®šæ—¥å¿—è¾“å‡ºçš„appenderå¯¹è±¡ log4j.appender.console = org.apache.log4j.ConsoleAppender # æŒ‡å®šappenderä½¿ç”¨çš„layout log4j.appender.console.layout = org.apache.log4j.PatternLayout log4j.appender.console.layout.conversionPattern = %r [%t] %p %c %x - %m%n log4j.appender.file = org.apache.log4j.FileAppender log4j.appender.file.layout = org.apache.log4j.PatternLayout log4j.appender.file.layout.conversionPattern = [%-10p]%r %l %d{yyyy-MM-dd HH:mm:ss.SSS} %m%n # æŒ‡å®šæ—¥å¿—æ–‡ä»¶ä¿å­˜è·¯å¾„ log4j.appender.file.file = logs/log4j.log # æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„å­—ç¬¦é›† log4j.appender.file.encoding = UTF-8 ä½¿ç”¨RollingFileAppenderå’ŒDailyRollingFileAppenderï¼š # æŒ‡å®šRoot Logger é»˜è®¤é…ç½®ä¿¡æ¯ # æŒ‡å®šæ—¥å¿—çº§åˆ«ï¼Œä½¿ç”¨çš„appender log4j.rootLogger = trace,console,file,rollingFile,dailyFile # æŒ‡å®šæ—¥å¿—è¾“å‡ºçš„appenderå¯¹è±¡ log4j.appender.console = org.apache.log4j.ConsoleAppender # æŒ‡å®šappenderä½¿ç”¨çš„layout log4j.appender.console.layout = org.apache.log4j.PatternLayout log4j.appender.console.layout.conversionPattern = %r [%t] %p %c %x - %m%n log4j.appender.file = org.apache.log4j.FileAppender log4j.appender.file.layout = org.apache.log4j.PatternLayout log4j.appender.file.layout.conversionPattern = [%-10p]%r %l %d{yyyy-MM-dd HH:mm:ss.SSS} %m%n # æŒ‡å®šæ—¥å¿—æ–‡ä»¶ä¿å­˜è·¯å¾„ log4j.appender.file.file = logs/log4j.log # æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„å­—ç¬¦é›† log4j.appender.file.encoding = UTF-8 log4j.appender.rollingFile = org.apache.log4j.RollingFileAppender log4j.appender.rollingFile.layout = org.apache.log4j.PatternLayout log4j.appender.rollingFile.layout.conversionPattern = [%-10p]%r %l %d{yyyy-MM-dd HH:mm:ss.SSS} %m%n # æŒ‡å®šæ—¥å¿—æ–‡ä»¶ä¿å­˜è·¯å¾„ log4j.appender.rollingFile.file = logs/log4j.log # æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„å­—ç¬¦é›† log4j.appender.rollingFile.encoding = UTF-8 # æŒ‡å®šæ—¥å¿—æ–‡ä»¶å†…å®¹çš„å¤§å° log4j.appender.rollingFile.maxFileSize = 1MB # æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„æ•°é‡ï¼Œè¶…è¿‡è¯¥æ•°é‡åˆ™ä»æœ€ä¹…è¿œçš„æ—¥å¿—æ–‡ä»¶å¼€å§‹è¦†ç›– log4j.appender.rollingFile.maxBackupIndex = 10 log4j.appender.dailyFile = org.apache.log4j.DailyRollingFileAppender log4j.appender.dailyFile.layout = org.apache.log4j.PatternLayout log4j.appender.dailyFile.layout.conversionPattern = [%-10p]%r %l %d{yyyy-MM-dd HH:mm:ss.SSS} %m%n # æŒ‡å®šæ—¥å¿—æ–‡ä»¶ä¿å­˜è·¯å¾„ log4j.appender.dailyFile.file = logs/log4j.log # æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„å­—ç¬¦é›† log4j.appender.dailyFile.encoding = UTF-8 # æŒ‡å®šæ—¥æœŸæ‹†åˆ†è§„åˆ™ log4j.appender.dailyFile.datePattern = '.'yyyy-MM-dd ä½¿ç”¨JDBCAppenderï¼š #mysql log4j.appender.logDB=org.apache.log4j.jdbc.JDBCAppender log4j.appender.logDB.layout=org.apache.log4j.PatternLayout log4j.appender.logDB.Driver=com.mysql.jdbc.Driver log4j.appender.logDB.URL= jdbc :mysql ://localhost :3306/test log4j.appender.logDB.User=root log4j.appender.logDB.Password=root log4j.appender.logDB.Sql=INSERT INTO \\ log(project_name,create_date,level,category,file_name,thread_name,line,all_category,message) \\ values('rhett','%d{yyyy-MM-dd HH:mm:ss}','%p','%c','%F','%t','%L','%l','%m') è‡ªå®šä¹‰loggerè®¾ç½®ï¼š # è‡ªå®šä¹‰loggerå¯¹è±¡è®¾ç½® log4j.logger.com.rhett = info,file","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"æ—¥å¿—","slug":"æ—¥å¿—","permalink":"https://www.codetool.top/tags/%E6%97%A5%E5%BF%97/"}]},{"title":"é˜»å¡é˜Ÿåˆ—BlockingQueueè¯¦è§£","slug":"é˜»å¡é˜Ÿåˆ—BlockingQueueè¯¦è§£","date":"2020-02-14T08:23:09.000Z","updated":"2020-03-18T08:14:33.008Z","comments":true,"path":"article/é˜»å¡é˜Ÿåˆ—BlockingQueueè¯¦è§£/","link":"","permalink":"https://www.codetool.top/article/%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97BlockingQueue%E8%AF%A6%E8%A7%A3/","excerpt":"","text":"é˜»å¡é˜Ÿåˆ—æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼çš„ç»å…¸ä½“ç°ã€‚ æˆ‘ä»¬åœ¨æ›¾åœ¨Javaçº¿ç¨‹æ± è¯¦è§£ä¸­è‡ªå·±å®ç°è¿‡ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œè¿™ç¯‡æ–‡ç« æˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹JDKä¸­çš„é˜»å¡é˜Ÿåˆ—ï¼š 1 BlockingQueueæ¥å£ä¸»è¦æ–¹æ³• æŠ›å‡ºå¼‚å¸¸ ç‰¹æ®Šå€¼ é˜»å¡ è¶…æ—¶ æ’å…¥ add(e) offer(e) put(e) offer(e, time, unit) ç§»é™¤ remove() poll() take() poll(time, unit) æ£€æŸ¥ element() peek() ä¸å¯ç”¨ ä¸å¯ç”¨ å…¶ä¸­æŠ›å‡ºå¼‚å¸¸å’Œç‰¹æ®Šå€¼éƒ½æ˜¯æ¥è‡ªçˆ¶æ¥å£çš„æ–¹æ³•ï¼Œå®ƒä»¬éƒ½æ˜¯éé˜»å¡çš„ï¼Œåˆ†åˆ«ä»£è¡¨å¦‚æœæ“ä½œä¸æˆåŠŸæŠ›å‡º IllegalStateException å¼‚å¸¸ã€å¦‚æœæ“ä½œä¸æˆåŠŸè¿”å›falseã€‚ è€Œâ€œé˜»å¡â€ä¸€åˆ—ä¼šä¸€ç›´ä¿æŒç­‰å¾…ç›´åˆ°æ“ä½œæˆåŠŸï¼Œä½†æ˜¯ç­‰å¾…è¿‡ç¨‹ä¸­å¯ä»¥è¢«interruptæ‰“æ–­ã€‚ â€œè¶…æ—¶â€ä¸€åˆ—åªç­‰å¾…ä¸€ä¸ªé™å®šæ—¶é—´ï¼Œæ—¶é—´å†…æ²¡æœ‰æ“ä½œæˆåŠŸåˆ™è¿”å›falseã€‚ 2 ArrayBlockingQueue2.1 å†…éƒ¨ç»“æ„/** The queued items */ final Object[] items; /** items index for next take, poll, peek or remove */ int takeIndex; /** items index for next put, offer, or add */ int putIndex; /** Main lock guarding all access */ final ReentrantLock lock; /** Condition for waiting takes */ private final Condition notEmpty; /** Condition for waiting puts */ private final Condition notFull; ArrayBlockingQueueå†…éƒ¨ä½¿ç”¨æ•°ç»„æ¥å®ç°é˜Ÿåˆ—æ“ä½œï¼Œæœ‰ä¸¤ä¸ªæŒ‡é’ˆtakeIndexå’ŒputIndexåˆ†åˆ«æŒ‡å‘è¦å–å‡ºçš„ä½ç½®ï¼ˆé˜Ÿåˆ—å¤´ï¼‰å’Œè¦æ”¾å…¥çš„ä½ç½®ï¼ˆé˜Ÿåˆ—å°¾ï¼‰ï¼Œå®ç°äº†ä¸€ä¸ªç±»ä¼¼äºå¾ªç¯é˜Ÿåˆ—çš„ç»“æ„ã€‚ä½¿ç”¨ä¸€æŠŠé”ç®¡ç†å‡ºé˜Ÿã€å…¥é˜Ÿæ“ä½œã€‚ 2.2 å…¥é˜Ÿã€å‡ºé˜ŸåŸç†å…¥é˜Ÿé€šè¿‡enqueueå‡½æ•°å®ç°ï¼š private void enqueue(E x) { // assert lock.getHoldCount() == 1; // assert items[putIndex] == null; final Object[] items = this.items; items[putIndex] = x; //å¦‚æœé˜Ÿåˆ—å°¾è¶…è¿‡æ•°ç»„å°¾éƒ¨æŒ‡å‘æ•°ç»„å¤´ if (++putIndex == items.length) putIndex = 0; count++; notEmpty.signal(); } å…¥é˜Ÿå®Œæˆä¹‹åè°ƒç”¨notEmpty.signal()å”¤é†’ä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ã€‚ å‡ºé˜Ÿé€šè¿‡dequeueå‡½æ•°å®ç°ï¼š private E dequeue() { // assert lock.getHoldCount() == 1; // assert items[takeIndex] != null; final Object[] items = this.items; @SuppressWarnings(\"unchecked\") E x = (E) items[takeIndex]; items[takeIndex] = null; if (++takeIndex == items.length) takeIndex = 0; count--; if (itrs != null) itrs.elementDequeued(); notFull.signal(); return x; } å‡ºé˜Ÿå®Œæˆåè°ƒç”¨notFull.signal();å”¤é†’ä¸€ä¸ªç”Ÿäº§è€…çº¿ç¨‹ã€‚ 2.3 æ„é€ æ–¹æ³•åŠç‰¹ç‚¹æ€»ç»“public ArrayBlockingQueue(int capacity) { this(capacity, false); } public ArrayBlockingQueue(int capacity, boolean fair) { if (capacity &lt;= 0) throw new IllegalArgumentException(); this.items = new Object[capacity]; lock = new ReentrantLock(fair); notEmpty = lock.newCondition(); notFull = lock.newCondition(); } ArrayBlockingQueueçš„é”å¯ä»¥è®¾ç½®ä¸ºå…¬å¹³æˆ–éå…¬å¹³çš„ï¼Œé»˜è®¤ä¸ºéå…¬å¹³çš„ ArrayBlockingQueueæ„é€ æ—¶å¿…é¡»è®¾ç½®å®¹é‡ï¼Œå®¹é‡ä¸ä¼šå˜åŒ–ã€‚ ArrayBlockingQueueçš„å…¥é˜Ÿã€å‡ºé˜Ÿå…±ç”¨ä¸€æŠŠé”ï¼Œä¸èƒ½åŒæ—¶è¿›è¡Œ 3 LinkedBlockingQueue3.1 å†…éƒ¨ç»“æ„static class Node&lt;E> { E item; Node&lt;E> next; Node(E x) { item = x; } } transient Node&lt;E> head; private transient Node&lt;E> last; /** The capacity bound, or Integer.MAX_VALUE if none */ private final int capacity; /** Current number of elements */ private final AtomicInteger count = new AtomicInteger(); /** Lock held by take, poll, etc */ private final ReentrantLock takeLock = new ReentrantLock(); /** Wait queue for waiting takes */ private final Condition notEmpty = takeLock.newCondition(); /** Lock held by put, offer, etc */ private final ReentrantLock putLock = new ReentrantLock(); /** Wait queue for waiting puts */ private final Condition notFull = putLock.newCondition(); LinkedBlockingQueueå†…éƒ¨ä½¿ç”¨é“¾è¡¨æ¥å®ç°é˜Ÿåˆ—æ“ä½œï¼Œæœ‰ä¸¤ä¸ªèŠ‚ç‚¹æŒ‡é’ˆheadå’Œlaståˆ†åˆ«æŒ‡å‘å“¨å…µèŠ‚ç‚¹ã€æ•°ç»„çš„å°¾èŠ‚ç‚¹ã€‚ä¸ArrayBlockingQueueä¸åŒçš„æ˜¯ä½¿ç”¨äº†ä¸¤æŠŠé”åˆ†åˆ«ç®¡ç†å…¥é˜Ÿå’Œå‡ºé˜Ÿã€‚ 3.2 å…¥é˜Ÿã€å‡ºé˜ŸåŸç†å…¥é˜Ÿï¼š public void put(E e) throws InterruptedException { if (e == null) throw new NullPointerException(); int c = -1; Node&lt;E> node = new Node&lt;E>(e); final ReentrantLock putLock = this.putLock; final AtomicInteger count = this.count; putLock.lockInterruptibly(); try { //ç”±äºcountä½¿ç”¨çš„æ˜¯AtomicIntegerï¼Œå³ä½¿å‡ºé˜Ÿæ“ä½œå†²çªäº†ä¹Ÿæ²¡å…³ç³» while (count.get() == capacity) { notFull.await(); } //enqueueå‡½æ•°ä¸­å°±æ˜¯ç®€å•çš„æŠŠèŠ‚ç‚¹è¿æ¥åˆ°é“¾è¡¨å°¾ enqueue(node); c = count.getAndIncrement(); if (c + 1 &lt; capacity) //å¦‚æœæ’å…¥åå®¹é‡æœªæ»¡ï¼Œåˆ™é€šçŸ¥ä¸€ä¸ªç”Ÿäº§è€… notFull.signal(); } finally { putLock.unlock(); } //å¦‚æœæ’å…¥å‰å®¹é‡æ˜¯0åˆ™é€šçŸ¥ä¸€ä¸ªæ¶ˆè´¹è€… if (c == 0) signalNotEmpty(); } å‡ºé˜Ÿï¼š public E take() throws InterruptedException { E x; int c = -1; final AtomicInteger count = this.count; final ReentrantLock takeLock = this.takeLock; takeLock.lockInterruptibly(); try { while (count.get() == 0) { notEmpty.await(); } //dequeueä¸­å°±æ˜¯ç›´æ¥å°†head.nextæŒ‡å‘äº†next.next x = dequeue(); c = count.getAndDecrement(); if (c > 1) //å¦‚æœå‡ºé˜Ÿå‰å®¹é‡å¤§äº1ï¼Œåˆ™é€šçŸ¥ä¸€ä¸ªæ¶ˆè´¹è€… notEmpty.signal(); } finally { takeLock.unlock(); } if (c == capacity) //å¦‚æœå‡ºé˜Ÿå‰å®¹é‡æ˜¯æ»¡çš„ï¼Œåˆ™é€šçŸ¥ä¸€ä¸ªç”Ÿäº§è€… signalNotFull(); return x; } å¯ä»¥çœ‹å‡ºLinkedBlockingQueueçš„å¹¶å‘ç²’åº¦ç›¸è¾ƒäºArrayBlockingQueueæœ‰æ‰€æé«˜ï¼Œå¯ä»¥è®©å…¥é˜Ÿå‡ºé˜ŸåŒæ—¶è¿›è¡Œï¼Œsignalçš„æ¡ä»¶å’Œæ—¶æœºä¹Ÿæ˜¯è€ƒè™‘åˆ°äº†å…¥é˜Ÿå‡ºé˜Ÿçš„å¹¶å‘æ‰§è¡Œã€‚ 3.3 æ„é€ æ–¹æ³•åŠç‰¹ç‚¹æ€»ç»“public LinkedBlockingQueue() { this(Integer.MAX_VALUE); } public LinkedBlockingQueue(int capacity) { if (capacity &lt;= 0) throw new IllegalArgumentException(); this.capacity = capacity; last = head = new Node&lt;E>(null); } LinkedBlockingQueueçš„headå§‹ç»ˆæŒ‡å‘å“¨å…µèŠ‚ç‚¹ LinkedBlockingQueueæ„é€ æ—¶å¯ä»¥è®¾ç½®å®¹é‡ï¼Œé»˜è®¤ä¸ºintçš„æœ€å¤§å€¼ LinkedBlockingQueueçš„å…¥é˜Ÿã€å‡ºé˜Ÿåˆ†åˆ«ç”¨äº†ä¸€æŠŠé”ï¼Œå¯ä»¥åŒæ—¶è¿›è¡Œã€‚ æ€è€ƒï¼šä¸ºä»€ä¹ˆArrayBlockingQueueçš„å…¥é˜Ÿå‡ºé˜Ÿä¸èƒ½åˆ†åˆ«ä½¿ç”¨ä¸€æŠŠé”ï¼Ÿ ç”±äºArrayBlockingQueueçš„å†…éƒ¨ç»“æ„æ˜¯ä½¿ç”¨æ•°ç»„å®ç°çš„ï¼Œç±»ä¼¼äºå¾ªç¯é˜Ÿåˆ—çš„ç»“æ„ï¼Œæ„å‘³ç€å¯èƒ½å‡ºç°å…¥é˜Ÿçš„æŒ‡é’ˆ+1==å‡ºé˜Ÿçš„æŒ‡é’ˆçš„æƒ…å†µï¼Œé‚£ä¹ˆä¸€æ—¦å…ˆå…¥é˜Ÿï¼Œè¦å‡ºé˜Ÿçš„å…ƒç´ å°±ä¼šä¸¢å¤±ï¼Œå¹¶æŠŠåˆšæ‰å…¥é˜Ÿçš„å…ƒç´ å‡ºé˜Ÿäº†ï¼Œé€ æˆæä¸¥é‡çš„åæœã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jdk","slug":"jdk","permalink":"https://www.codetool.top/tags/jdk/"},{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://www.codetool.top/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://www.codetool.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"leetcode378-æœ‰åºçŸ©é˜µä¸­ç¬¬Kå°çš„å…ƒç´ ","slug":"leetcode378-æœ‰åºçŸ©é˜µä¸­ç¬¬Kå°çš„å…ƒç´ ","date":"2020-02-13T17:54:39.000Z","updated":"2020-02-20T15:22:56.573Z","comments":true,"path":"article/leetcode378-æœ‰åºçŸ©é˜µä¸­ç¬¬Kå°çš„å…ƒç´ /","link":"","permalink":"https://www.codetool.top/article/leetcode378-%E6%9C%89%E5%BA%8F%E7%9F%A9%E9%98%B5%E4%B8%AD%E7%AC%ACK%E5%B0%8F%E7%9A%84%E5%85%83%E7%B4%A0/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ª n x n çŸ©é˜µï¼Œå…¶ä¸­æ¯è¡Œå’Œæ¯åˆ—å…ƒç´ å‡æŒ‰å‡åºæ’åºï¼Œæ‰¾åˆ°çŸ©é˜µä¸­ç¬¬kå°çš„å…ƒç´ ã€‚è¯·æ³¨æ„ï¼Œå®ƒæ˜¯æ’åºåçš„ç¬¬kå°å…ƒç´ ï¼Œè€Œä¸æ˜¯ç¬¬kä¸ªå…ƒç´ ã€‚ ç¤ºä¾‹: matrix = [&nbsp;&nbsp;[ 1, 5, 9],&nbsp;&nbsp;[10, 11, 13],&nbsp;&nbsp;[12, 13, 15]],k = 8, è¿”å› 13ã€‚ è¯´æ˜:ä½ å¯ä»¥å‡è®¾ k çš„å€¼æ°¸è¿œæ˜¯æœ‰æ•ˆçš„, 1 â‰¤ k â‰¤ n2 ã€‚ 2 è§£æ³•2.1 æ€æƒ³ä½¿ç”¨æœ€å¤§å †æ±‚topk 2.2 ä»£ç class Solution { public int kthSmallest(int[][] matrix, int k) { Queue&lt;Integer> queue = new PriorityQueue&lt;>((o1,o2)->o2-o1); int width = matrix.length; for(int i = 0;i&lt;width;i++){ for(int j = 0;j&lt;width;j++){ queue.offer(matrix[i][j]); } } while(queue.size()>k) queue.poll(); return queue.peek(); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"è¯¦è§£Javaä¸­çš„å››ç§å¼•ç”¨åŠå…¶åº”ç”¨","slug":"è¯¦è§£Javaä¸­çš„å››ç§å¼•ç”¨åŠå…¶åº”ç”¨","date":"2020-02-13T17:21:13.000Z","updated":"2020-03-18T08:14:33.008Z","comments":true,"path":"article/è¯¦è§£Javaä¸­çš„å››ç§å¼•ç”¨åŠå…¶åº”ç”¨/","link":"","permalink":"https://www.codetool.top/article/%E8%AF%A6%E8%A7%A3Java%E4%B8%AD%E7%9A%84%E5%9B%9B%E7%A7%8D%E5%BC%95%E7%94%A8%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š æ·±å…¥ç†è§£Javaä¸­çš„å¼•ç”¨ï¼ˆä¸€ï¼‰â€”â€”Reference - ç®€ä¹¦ æ·±å…¥ç†è§£Javaä¸­çš„å¼•ç”¨ï¼ˆäºŒï¼‰â€”â€”å¼ºè½¯å¼±è™šå¼•ç”¨ - ç®€ä¹¦ æ·±å…¥ç†è§£Javaä¸­çš„å¼•ç”¨ï¼ˆä¸‰ï¼‰â€”â€”DirectByteBufferä¸ThreadLoalçš„åƒåœ¾å›æ”¶ - ç®€ä¹¦ è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨-ä»–ä»¬çš„ç‰¹ç‚¹åŠåº”ç”¨åœºæ™¯ - ç®€ä¹¦ 1 å¼•ç”¨çš„æŠ½è±¡çˆ¶ç±»â€”â€”Reference1.1 Referenceçš„çŠ¶æ€åœ¨Referenceæºç å¼€å¤´çš„ä¸€æ®µæ³¨é‡Šä¸­è°ˆåˆ°äº†ï¼š ä¸€ä¸ªå¼•ç”¨çš„å®ä¾‹å¤„äºå››ç§çŠ¶æ€ä¹‹ä¸€ï¼š Activeï¼šæ–°åˆ›å»ºçš„å®ä¾‹ä¸ºActiveçŠ¶æ€ï¼Œå½“å¤„äºè¿™ä¸ªçŠ¶æ€ä¸€æ®µæ—¶é—´åçŠ¶æ€å˜ä¸ºPendingæˆ–Inactiveï¼Œè¿™å–å†³äºå®ƒåˆ›å»ºçš„æ—¶å€™æ˜¯å¦æŒ‡å®šäº†ReferenceQueueã€‚ Pendingï¼šå½“ReferenceåŒ…è£…çš„referent = nullçš„æ—¶å€™ï¼ŒJVMä¼šæŠŠReferenceè®¾ç½®æˆpendingçŠ¶æ€ã€‚å¦‚æœReferenceåˆ›å»ºæ—¶æŒ‡å®šäº†ReferenceQueueï¼Œé‚£ä¹ˆä¼šè¢«ReferenceHandlerçº¿ç¨‹å¤„ç†è¿›å…¥åˆ°ReferenceQueueé˜Ÿåˆ—ä¸­ï¼Œå¦‚æœæ²¡æœ‰å°±è¿›å…¥InactiveçŠ¶æ€ã€‚ Enqueue: è¿›å…¥ReferenceQueueä¸­çš„å¯¹è±¡ï¼Œç­‰å¾…è¢«å›æ”¶ Inactive: Referenceå¯¹è±¡ä»ReferenceQueueå–å‡ºæ¥å¹¶è¢«å¤„ç†æ‰ã€‚å¤„äºInactiveçš„Referenceå¯¹è±¡çŠ¶æ€ä¸èƒ½å†æ”¹å˜ 1.2 æ ¸å¿ƒæˆå‘˜å˜é‡1) referent: è¡¨ç¤ºè¢«åŒ…è£…çš„å¯¹è±¡ ä¸‹é¢ä»£ç ä¸­new Object()å°±æ˜¯è¢«åŒ…è£…çš„å¯¹è±¡ã€‚ WeakReference&lt;Object> wo = new WeakReference&lt;Object>(new Object()); 2) queue: è¡¨ç¤ºè¢«åŒ…è£…çš„å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œéœ€è¦è¢«é€šçŸ¥çš„é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—åœ¨Referenceæ„é€ å‡½æ•°ä¸­æŒ‡å®šã€‚å½“referentè¢«å›æ”¶çš„æ—¶å€™ï¼ŒReferenceå¯¹è±¡å°±å¤„åœ¨äº†PendingçŠ¶æ€ï¼ŒReferenceä¼šè¢«æ”¾å…¥åˆ°è¯¥é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœæ„é€ å‡½æ•°æ²¡æœ‰æŒ‡å®šé˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±è¿›å…¥InactiveçŠ¶æ€ã€‚ 3) pending: è¡¨ç¤ºç­‰å¾…è¢«åŠ å…¥åˆ°queueçš„Reference åˆ—è¡¨ã€‚ private static Reference&lt;Object> pending = null; pendingç†è§£é“¾è¡¨æœ‰ç‚¹è´¹è§£ï¼Œå› ä¸ºä»£ç å±‚é¢ä¸Šçœ‹è¿™æ˜æ˜å°±æ˜¯Referenceå¯¹è±¡ã€‚å…¶å®å½“Referenceå¤„åœ¨PendingçŠ¶æ€æ—¶ï¼Œä»–çš„pendingå­—æ®µè¢«èµ‹å€¼æˆäº†ä¸‹ä¸€ä¸ªè¦å¤„ç†çš„å¯¹è±¡ï¼ˆå³ä¸‹é¢è®²çš„discoveredï¼‰ï¼Œé€šè¿‡discoveredå¯ä»¥æ‹¿åˆ°ä¸‹ä¸€ä¸ªå¯¹è±¡å¹¶ä¸”èµ‹å€¼ç»™pendingï¼Œç›´åˆ°æœ€åä¸€ä¸ªï¼Œæ‰€ä»¥è¿™é‡Œå°±å¯ä»¥æŠŠå®ƒå½“æˆä¸€ä¸ªé“¾è¡¨ã€‚è€Œdiscoveredæ˜¯JVMçš„åƒåœ¾å›æ”¶å™¨æ·»åŠ è¿›å»çš„ï¼Œå¤§å®¶å¯ä»¥ä¸ç”¨å…³å¿ƒåº•å±‚ç»†èŠ‚ã€‚ 4) discovered: å½“å¤„äºReferenceå¤„åœ¨pendingçŠ¶æ€ï¼šdiscoveredä¸ºpendingé›†åˆä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼›å…¶ä»–çŠ¶æ€ï¼šdiscoveredä¸ºnull transient private Reference&lt;T> discovered; /* used by VM */ 5) next: å½“Referenceå¯¹è±¡åœ¨queueä¸­æ—¶ï¼ˆå³Referenceå¤„äºEnqueuedçŠ¶æ€ï¼‰ï¼Œnextæè¿°å½“å‰å¼•ç”¨èŠ‚ç‚¹æ‰€å­˜å‚¨çš„ä¸‹ä¸€ä¸ªå³å°†è¢«å¤„ç†çš„èŠ‚ç‚¹ã€‚ @SuppressWarnings(\"rawtypes\") Reference next; ReferenceHandlerçº¿ç¨‹ä¼šæŠŠpendingçŠ¶æ€çš„Referenceæ”¾å…¥ReferenceQueueä¸­ï¼Œä¸Šé¢è¯´çš„nextï¼Œdiscovered å­—æ®µåœ¨å…¥é˜Ÿä¹‹åä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼Œä¸‹ä¸€å°èŠ‚ä¼šä»‹ç»ã€‚ 1.3 ReferenceQueueå…¥é˜Ÿè¿‡ç¨‹æˆ‘ä»¬å¸Œæœ›å½“ä¸€ä¸ªå¯¹è±¡è¢«gcæ‰çš„æ—¶å€™é€šçŸ¥ç”¨æˆ·çº¿ç¨‹ï¼Œè¿›è¡Œé¢å¤–çš„å¤„ç†æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨å¼•ç”¨é˜Ÿåˆ—äº† boolean enqueue(Reference&lt;? extends T> r) { /* Called only by Reference class */ synchronized (lock) { // Check that since getting the lock this reference hasn't already been // enqueued (and even then removed) ReferenceQueue&lt;?> queue = r.queue; if ((queue == NULL) || (queue == ENQUEUED)) { return false; } assert queue == this; //è®¾ç½®queueçŠ¶æ€ r.queue = ENQUEUED; //æ”¹å˜nextæŒ‡é’ˆ r.next = (head == null) ? r : head; head = r; queueLength++; if (r instanceof FinalReference) { sun.misc.VM.addFinalRefCount(1); } lock.notifyAll(); return true; } } å¯ä»¥çœ‹åˆ°å…¥é˜Ÿçš„ReferenceèŠ‚ç‚¹rè¿›å…¥é˜Ÿåˆ—ï¼ŒReferenceèŠ‚ç‚¹è¢«æ”¾åœ¨é˜Ÿåˆ—å¤´ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå…ˆè¿›åå‡ºé˜Ÿåˆ—ã€‚ å…¥é˜Ÿçš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š 2 ReferenceHandlerçº¿ç¨‹Referenceç±»ä¸­å¦ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æˆå‘˜æ˜¯ReferenceHandlerã€‚ReferenceHandleræ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚å½“JVMåŠ è½½Referenceçš„æ—¶å€™ï¼Œå°±ä¼šå¯åŠ¨è¿™ä¸ªçº¿ç¨‹ã€‚ç”¨jstackæŸ¥çœ‹è¯¥çº¿ç¨‹æ ˆå¯ä»¥çœ‹åˆ°ã€‚Reference Handleræ˜¯JVMä¸­çš„2å·çº¿ç¨‹ï¼Œå¹¶ä¸”çº¿æ€§ä¼˜å…ˆçº§è¢«è®¾ç½®ä¸ºé«˜ä¼˜å…ˆçº§ã€‚ çœ‹æºä»£ç ä»–æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š private static class ReferenceHandler extends Thread { ReferenceHandler(ThreadGroup g, String name) { super(g, name); } public void run() { for (;;) { Reference&lt;Object> r; synchronized (lock) { if (pending != null) { r = pending; pending = r.discovered; r.discovered = null; } else { try { try { lock.wait(); } catch (OutOfMemoryError x) { } } catch (InterruptedException x) { } continue; } } // Fast path for cleaners if (r instanceof Cleaner) { ((Cleaner)r).clean(); continue; } ReferenceQueue&lt;Object> q = r.queue; if (q != ReferenceQueue.NULL) q.enqueue(r); } } } é€šè¿‡ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°ReferenceHandlerçº¿ç¨‹åšçš„æ˜¯ä¸æ–­çš„æ£€æŸ¥pendingæ˜¯å¦ä¸ºnull, å¦‚æœä¸ä¸ºnull,å°†pendingå¯¹è±¡è¿›è¡Œå…¥é˜Ÿæ“ä½œï¼Œè€Œpendingçš„èµ‹å€¼ç”±JVMæ“ä½œã€‚æ‰€ä»¥ReferenceQueueåœ¨è¿™é‡Œä½œä¸ºJVMä¸ä¸Šå±‚Referenceå¯¹è±¡ç®¡ç†ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’æ–¹å¼ã€‚ 3 Javaä¸­çš„å››ç§å¼•ç”¨3.1 å¼ºå¼•ç”¨å¼ºå¼•ç”¨æ˜¯æˆ‘ä»¬åœ¨ä»£ç ä¸­æœ€æ™®é€šçš„å¼•ç”¨ï¼Œåªè¦ç»´æŒäº†å¼•ç”¨å°±ä¸ä¼šè¢«å›æ”¶ã€‚ Object o = new Object(); // å¼ºå¼•ç”¨ 3.2 è½¯å¼•ç”¨SoftReference&lt;String> sr = new SoftReference&lt;String>(new String(\"hello\")); å¦‚æœä¸€ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªè½¯å¼•ç”¨ï¼Œé‚£ä¹ˆåœ¨å†…å­˜è¶³å¤Ÿçš„æƒ…å†µä¸‹ï¼Œè¯¥å¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚ç½‘ä¸Šæœ‰å¾ˆå¤šèµ„æ–™è¯´è½¯å¼•ç”¨åªä¼šåœ¨å†…å­˜ç©ºé—´ä¸å¤Ÿç”¨çš„æƒ…å†µä¸‹å¯¹è±¡æ‰ä¼šè¢«å›æ”¶ã€‚ é‚£ä¹ˆä»€ä¹ˆæ—¶å€™æ‰æ˜¯å†…å­˜ä¸å¤Ÿç”¨å‘¢ï¼Ÿ é¦–å…ˆçœ‹ä¸€ä¸‹SoftReferenceç±»çš„æºç å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªå­—æ®µã€‚è¿™ä¸¤ä¸ªå­—æ®µçš„ä½œç”¨å·²ç»æ ‡æ³¨ï¼Œè¿™ä¸JVM GCæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ /** * è®°å½•æœ€è¿‘ä¸€æ¬¡è¢«GCçš„æ—¶é—´ã€‚ */ static private long clock; /** * æ¯æ¬¡è°ƒç”¨getæ–¹æ³•çš„æ—¶å€™æ›´æ–° * è®°å½•å½“å‰Referenceæœ€è¿‘ä¸€æ¬¡è¢«è®¿é—®çš„æ—¶é—´ */ private long timestamp; ä¸€èµ·çœ‹ä¸€ä¸‹HotSpotçš„æºç ï¼Œå¯¹äºè½¯å¼•ç”¨çš„å›æ”¶ç­–ç•¥è§ä¸‹é¢should_clear_referenceå‡½æ•°ã€‚ // The oop passed in is the SoftReference object, and not // the object the SoftReference points to. bool LRUMaxHeapPolicy::should_clear_reference(oop p, jlong timestamp_clock) { jlong interval = timestamp_clock - java_lang_ref_SoftReference::timestamp(p); assert(interval >= 0, \"Sanity check\"); // The interval will be zero if the ref was accessed since the last scavenge/gc. if(interval &lt;= _max_interval) { return false; } return true; } ä¸Šè¿°ä»£ç ä¸­intervalè¡¨ç¤ºå½“å‰å¼•ç”¨å­˜æ´»äº†å¤šä¹…ã€‚ä»–çš„å€¼å°±æ˜¯å¯¹åº”ä¸Šè¿°javaä»£ç ä¸­çš„clockä¸timestampç›¸å‡ã€‚intervalä¸_max_intervalæ¯”è¾ƒï¼Œå¦‚æœå¤§äº _max_intervalï¼Œé‚£ä¹ˆå°±å’Œå¼±å¼•ç”¨ä¸€æ ·å¤„ç†ï¼Œå¦‚æœå°äºå°±å½“åšå¼ºå¼•ç”¨å¤„ç†ã€‚_max_intervalçš„èµ‹å€¼å‡½æ•°å¦‚ä¸‹ï¼š // Capture state (of-the-VM) information needed to evaluate the policy void LRUMaxHeapPolicy::setup() { size_t max_heap = MaxHeapSize; max_heap -= Universe::get_heap_used_at_last_gc(); max_heap /= M; _max_interval = max_heap * SoftRefLRUPolicyMSPerMB; assert(_max_interval >= 0,\"Sanity check\"); } é€šè¿‡æºç å¯è§é¦–å…ˆæ˜¯max_heapå‡å»ä¸Šæ¬¡GCä¹‹åå‰©ä½™å †å¤§å°ï¼Œå¦‚æœä¸Šæ¬¡GCä¹‹åè¿˜æœ‰å¾ˆå¤šå‰©ä½™ç©ºé—´ï¼Œè¯´æ˜å†…å­˜ç©ºé—´ä¸å¤Ÿç”¨äº†ï¼Œé‚£ä¹ˆmax_heapçš„å€¼å°±è¶Šå°ï¼Œç›¸åº”_max_intervalä¹Ÿè¶Šå°ï¼Œè½¯å¼•ç”¨å°±è¶Šå¯èƒ½è¢«å›æ”¶ã€‚ è½¯å¼•ç”¨çš„ä¸€ä¸ªä½œç”¨æ˜¯å®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ã€‚æ¯”å¦‚æµè§ˆå™¨çš„åé€€æŒ‰é’®ï¼š å¦‚æœç½‘é¡µæµè§ˆç»“æŸå°±è¿›è¡Œå†…å®¹çš„å›æ”¶ï¼Œåˆ™æŒ‰åé€€æŸ¥çœ‹å‰é¢æµè§ˆè¿‡çš„é¡µé¢æ—¶ï¼Œéœ€è¦é‡æ–°æ„å»ºã€‚ å¦‚æœå°†æµè§ˆè¿‡çš„ç½‘é¡µå­˜å‚¨åˆ°å†…å­˜ä¸­ä¼šé€ æˆå†…å­˜çš„å¤§é‡æµªè´¹ï¼Œç”šè‡³ä¼šé€ æˆå†…å­˜æº¢å‡ºã€‚é€šè¿‡è½¯å¼•ç”¨å¯ä»¥è§£å†³è¯¥é—®é¢˜ 3.3 å¼±å¼•ç”¨WeakReference&lt;String> wr = new WeakReference(new String(\"123\")); åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸæ›´çŸ­ã€‚å½“åƒåœ¾å›æ”¶å™¨å‘ç°äº†åªæœ‰å¼±å¼•ç”¨çš„å¯¹è±¡æ—¶å€™ï¼Œæ— è®ºå†…å­˜ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œéƒ½ä¼šè¢«GCå›æ”¶ã€‚å½“ä½ å¶å°”éœ€è¦å¼•ç”¨æŸä¸ªå¯¹è±¡ï¼Œéšæ—¶èƒ½è·å–è¯¥å¯¹è±¡ï¼Œä½†æ˜¯ä¸æƒ³ä»‹å…¥è¯¥å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸçš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨å¼±å¼•ç”¨ï¼Œ å› ä¸ºå¼±å¼•ç”¨ä¸ä¼šå¯¹å¯¹è±¡çš„åƒåœ¾å›æ”¶åˆ¤æ–­äº§ç”Ÿé™„åŠ çš„å½±å“ã€‚ åœ¨å°†å¼•ç”¨æ·»åŠ åˆ°å¼•ç”¨é˜Ÿåˆ—æ—¶ï¼Œå¦‚æœå…ˆæ‰«æåˆ°å¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œæ¶ˆæåœ°å°†å¼±å¼•ç”¨ç›´æ¥åŠ å…¥å¼•ç”¨é˜Ÿåˆ—ï¼Œåœ¨æ‰«æå®Œæ‰€æœ‰å¼•ç”¨åï¼Œè‹¥è¯¥å¯¹è±¡è¿˜å­˜æ´»ï¼Œåˆ™å°†è¯¥å¼•ç”¨ä»å¼•ç”¨é˜Ÿåˆ—ä¸­ç§»é™¤ã€‚ ThreadLocalä¸­å°±æ˜¯ä½¿ç”¨äº†å¼±å¼•ç”¨æ¥é¿å…å†…å­˜å†…å­˜æ³„æ¼ï¼Œå‚è€ƒï¼šThreadLocalæºç åˆ†æå’Œç›¸å…³ç†è§£ 3.4 è™šå¼•ç”¨è™šå¼•ç”¨ä¸ä¼šå¯¹å¯¹è±¡çš„åƒåœ¾å›æ”¶æœ‰ä»»ä½•é™„åŠ å½±å“ï¼Œä»–ä¸è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„ä¸€ä¸ªåŒºåˆ«åœ¨äºï¼šè™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ— ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ã€‚æŸ¥çœ‹ä»–çš„æ„é€ æ–¹æ³•å¯ä»¥çœ‹åˆ°å¿…é¡»ä¸ä¸€ä¸ªReferenceQueueç»‘å®šï¼š public PhantomReference(T referent, ReferenceQueue&lt;? super T> q) { super(referent, q); } jdkä¸­ç›´æ¥å†…å­˜çš„å›æ”¶å°±ç”¨åˆ°è™šå¼•ç”¨ï¼Œç”±äºjvmè‡ªåŠ¨å†…å­˜ç®¡ç†çš„èŒƒå›´æ˜¯å †å†…å­˜ï¼Œè€Œç›´æ¥å†…å­˜æ˜¯åœ¨å †å†…å­˜ä¹‹å¤–ï¼ˆå…¶å®æ˜¯å†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œè‡ªè¡Œå»ç†è§£è™šæ‹Ÿå†…å­˜ç©ºé—´çš„ç›¸å…³æ¦‚å¿µï¼‰ï¼Œæ‰€ä»¥ç›´æ¥å†…å­˜çš„åˆ†é…å’Œå›æ”¶éƒ½æ˜¯æœ‰Unsafeç±»å»æ“ä½œï¼Œjavaåœ¨ç”³è¯·ä¸€å—ç›´æ¥å†…å­˜ä¹‹åï¼Œä¼šåœ¨å †å†…å­˜åˆ†é…ä¸€ä¸ªå¯¹è±¡ä¿å­˜è¿™ä¸ªå †å¤–å†…å­˜çš„å¼•ç”¨ï¼Œè¿™ä¸ªå¯¹è±¡è¢«åƒåœ¾æ”¶é›†å™¨ç®¡ç†ï¼Œä¸€æ—¦è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶ï¼Œç›¸åº”çš„ç”¨æˆ·çº¿ç¨‹ä¼šæ”¶åˆ°é€šçŸ¥å¹¶å¯¹ç›´æ¥å†…å­˜è¿›è¡Œæ¸…ç†å·¥ä½œã€‚ æ¯”å¦‚nioä¸­çš„DirectByteBufferï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ByteBuffer.allocate(int capacity)çš„æ—¶å€™åˆ†é…çš„æ˜¯å †ä¸Šçš„ç©ºé—´ï¼Œè€ŒByteBuffer.allocateDirect(int capacity)åˆ†é…çš„æ˜¯å †å¤–å†…å­˜ï¼ˆunsafe.allocateMemoryï¼‰ï¼Œè·å¾—ä¸€å—DirectByteBufferä¹‹åä¼šåˆ›å»ºä¸€ä¸ªCleanerå®ä¾‹ï¼Œè€ŒCleanerå°±æ˜¯PhantomReferenceçš„å­ç±»ï¼ŒCleanerå°±èµ·åˆ°äº†è·Ÿè¸ªDirectByteBufferçš„åƒåœ¾å›æ”¶è¿‡ç¨‹çš„ä½œç”¨ã€‚ä¸€æ—¦Cleanerè¢«æ”¾å…¥äº†ReferenceQueueï¼Œå°±ä¼šè°ƒç”¨å†…éƒ¨çš„clean()æ–¹æ³•æ¥å›æ”¶å¯¹åº”çš„å †å¤–å†…å­˜ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jdk","slug":"jdk","permalink":"https://www.codetool.top/tags/jdk/"},{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://www.codetool.top/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://www.codetool.top/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}]},{"title":"ThreadLocalæºç åˆ†æå’Œç›¸å…³ç†è§£","slug":"ThreadLocalæºç åˆ†æå’Œç›¸å…³ç†è§£","date":"2020-02-13T12:22:15.000Z","updated":"2020-03-18T08:14:33.008Z","comments":true,"path":"article/ThreadLocalæºç åˆ†æå’Œç›¸å…³ç†è§£/","link":"","permalink":"https://www.codetool.top/article/ThreadLocal%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E5%92%8C%E7%9B%B8%E5%85%B3%E7%90%86%E8%A7%A3/","excerpt":"","text":"1 æ€»ç»“æ€»ç»“æ”¾å‰é¢é˜²æ­¢å¤ªé•¿ä¸çœ‹ï¼š æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªthreadLocalså­—æ®µï¼Œæ˜¯ä¸€ä¸ªThreadLocalMapçš„å®ä¾‹ï¼Œæ‰€æœ‰çš„ThreadLocalä»£è¡¨çš„çº¿ç¨‹ç§æœ‰æ•°æ®éƒ½å­˜æ”¾åœ¨è¿™é‡Œé¢ã€‚ ThreadLocalMapå¯¹è±¡çš„åˆ›å»ºæ˜¯æ‡’æƒ°çš„ï¼Œç¬¬ä¸€æ¬¡åœ¨è¯¥çº¿ç¨‹ä¸Šç”¨åˆ°ThreadLocalæ—¶æ‰ä¼šåˆ›å»ºï¼Œåˆå§‹å®¹é‡æ˜¯16ï¼Œthresholdé»˜è®¤ä¸º2/3çš„æ•°ç»„å¤§å°ï¼Œå¦‚æœå…ƒç´ ä¸ªæ•°è¶…è¿‡thresholdï¼Œæ¸…ç†ä¸€æ¬¡æ— ç”¨çš„Entryï¼ˆkeyè¢«å›æ”¶æ‰çš„Entryï¼‰ï¼Œå¦‚æœæ¸…ç†ä¸€æ¬¡ä¹‹åå…ƒç´ ä¸ªæ•°ä»å¤§äº3/4*thresholdï¼Œè¿›è¡Œæ‰©å®¹ï¼ˆç¿»å€ï¼‰ ThreadLocalMapé€šè¿‡çº¿æ€§æ¢æµ‹æ³•è§£å†³å†²çªã€‚ ThreadLocalMapé€šè¿‡å¼±å¼•ç”¨æŒ‡å‘ä¸€ä¸ªThreadLocalå¯¹è±¡ï¼ˆkeyï¼‰ï¼Œå¼ºå¼•ç”¨æŒ‡å‘è¯¥çº¿ç¨‹å¯¹åº”çš„å€¼ï¼ˆvalueï¼‰ Entry-&gt;keyæ˜¯å¼±å¼•ç”¨ï¼Œä»£è¡¨keyä¸€æ—¦åªå‰©ä¸‹Entryçš„å¼•ç”¨ï¼Œä¸‹ä¸€æ¬¡GCçš„æ—¶å€™å°±ä¼šè¢«å›æ”¶ï¼Œä½†è¯¥Entryå’Œå†…éƒ¨çš„valueä»ä¼šå ç”¨ç©ºé—´ï¼Œæ‰€ä»¥å¯ä»¥é€ æˆå†…å­˜æ³„æ¼ï¼Œä½†æ˜¯ThreadLocalMapä¸­çš„è®¸å¤šæ–¹æ³•éƒ½åœ¨æ“ä½œå‰åæ£€æŸ¥äº†æ•°ç»„å†…éƒ¨æ˜¯å¦æœ‰æ— ç”¨çš„Entryï¼Œå¦‚æœæœ‰å°±æ¸…é™¤æ‰ï¼Œæ‰€ä»¥å¹¶ä¸å®¹æ˜“é€ æˆå†…å­˜æ³„æ¼ã€‚ 2 ThreadLocalæ¦‚è¿°ä¸ºå…±äº«å˜é‡åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªå‰¯æœ¬ï¼Œæ¯ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®è‡ªå·±å†…éƒ¨çš„å‰¯æœ¬å˜é‡ private static Integer num = 0; private static ThreadLocal&lt;Integer> numLocal = new ThreadLocal&lt;Integer>(){ @Override protected Integer initialValue() { return 0; } }; public static void main(String[] args) { Thread[] threads = new Thread[5]; for (int i = 0;i&lt;threads.length;i++){ threads[i] = new Thread(()->{ int x = numLocal.get().intValue(); x+=5; numLocal.set(x); System.out.println(Thread.currentThread().getName()+\":\"+numLocal.get()); },\"Thread-\"+i); } for (int i = 0;i&lt;threads.length;i++){ threads[i].start(); } } 3 é‡è¦æ–¹æ³•3.1 setpublic void set(T value) { Thread t = Thread.currentThread(); //é€šè¿‡å½“å‰çº¿ç¨‹è·å–ä¸€ä¸ªThreadLocalMapå¯¹è±¡ ThreadLocalMap map = getMap(t); //å¦‚æœè¯¥å¯¹è±¡ä¸ä¸ºç©ºè°ƒç”¨setæ–¹æ³•ï¼Œå¯ä»¥çŒœæµ‹ç±»ä¼¼mapæ¥å£çš„set if (map != null) map.set(this, value); //å¦‚æœè¯¥å¯¹è±¡æ˜¯ç©ºåˆ™è°ƒç”¨createMapæ–¹æ³•ï¼Œå¯ä»¥çŒœæµ‹èƒ½åˆ›å»ºä¸€ä¸ªThreadLocalMapå¯¹è±¡ else createMap(t, value); } 3.1.1 ThreadLocalMapå…ˆæ¥çœ‹è¿™ä¸ªå«åšThreadLocalMapçš„å†…éƒ¨ç±»ï¼š static class ThreadLocalMap { /** * Entryé‡‡ç”¨å¼±å¼•ç”¨æŒ‡å‘ä¸€ä¸ªThreadLocalå¯¹è±¡ï¼Œè¿™ä¸ªThreadLocalå§‹ç»ˆ * æ˜¯è¿™ä¸ªThreadLocalMapçš„é”®ï¼ˆkeyï¼‰ */ static class Entry extends WeakReference&lt;ThreadLocal&lt;?>> { /** è¿™ä¸ªå€¼ä»£è¡¨ThreadLocalå…³è”çš„å€¼. */ Object value; Entry(ThreadLocal&lt;?> k, Object v) { super(k); value = v; } } //åˆå§‹å®¹é‡ï¼Œå®¹é‡å¿…é¡»æ˜¯2çš„æ•´æ•°æ¬¡å¹‚ private static final int INITIAL_CAPACITY = 16; //å­˜æ”¾æ•°æ®çš„Entryæ•°ç»„ï¼Œç±»ä¼¼äºHashMapçš„Nodeæ•°ç»„ private Entry[] table; //Entryçš„ä¸ªæ•° private int size = 0; //ç±»ä¼¼äºHashMapçš„thresholdï¼Œsizeå¤§äºè¿™ä¸ªå€¼åˆ™æ‰©å®¹ private int threshold; // Default to 0 //... } ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼ŒThreadLocalMapå’ŒHashMapå¾ˆå¤§çš„åŒºåˆ«æ˜¯ï¼ŒEntryæ²¡æœ‰nextå±æ€§ï¼Œè‡³å°‘è¯´æ˜ä¸ä¼šä»¥é“¾è¡¨å½¢å¼å­˜å‚¨ã€‚ æˆ‘ä»¬é€šè¿‡getMap()æ–¹æ³•å‘ç°ï¼Œä¸€ä¸ªThreadå¯¹è±¡çš„å†…éƒ¨æœ‰ä¸€ä¸ªthreadLocalså­—æ®µï¼Œæ˜¯ä¸€ä¸ªThreadLocalMapçš„å¯¹è±¡ï¼Œå¹¶ä¸”çº¿ç¨‹åˆ›å»ºå¹¶ä¸ä¼šç»™è¿™ä¸ªå­—æ®µåˆå§‹åŒ–ã€‚ é‚£ä¹ˆæˆ‘ä»¬å‡è®¾ç¬¬ä¸€æ¬¡åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šè°ƒç”¨setæ–¹æ³•ï¼Œæ­¤æ—¶map==nullï¼Œè°ƒç”¨createMap()åˆ›å»ºä¸€ä¸ªThreadLocalMapå¯¹è±¡ï¼š void createMap(Thread t, T firstValue) { t.threadLocals = new ThreadLocalMap(this, firstValue); } å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•è¿˜é¡ºä¾¿æŠŠè¿™æ¬¡è¦æ·»åŠ çš„æ•°æ®æ·»åŠ äº†è¿›å»ã€‚ æˆ‘ä»¬è¿”å›æ¥çœ‹ThreadLocalMapçš„setæ–¹æ³•ï¼Œçœ‹çœ‹æ˜¯å¦å’ŒHashMapç±»ä¼¼ï¼š 3.1.1.1 ThreadLocalMap.setprivate void set(ThreadLocal&lt;?> key, Object value) { Entry[] tab = table; int len = tab.length; // éå¸¸ç±»ä¼¼HashMapçš„æ•°ç»„ä¸‹æ ‡è®¡ç®—æ–¹æ³•ï¼Œä¸‹æ–‡æˆ‘ä»¬å°†ä¸€ä¸ªæ•°ç»„ä½ç½®ç§°ä¸ºslot int i = key.threadLocalHashCode &amp; (len-1); // å¯ä»¥å‘ç°ï¼Œè¿™æ®µä»£ç æ˜¯ç”¨çº¿æ€§æ¢æµ‹æ³•è§£å†³slotå†²çª for (Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) { ThreadLocal&lt;?> k = e.get(); if (k == key) { e.value = value; return; } // kä»€ä¹ˆæ—¶å€™ä¸ºnullï¼Ÿå› ä¸ºkæ˜¯è¢«å¼±å¼•ç”¨çš„ï¼Œå¦‚æœkä¸ºnullè¯´æ˜ä¸­é€”è¢«å›æ”¶äº†ï¼Œåˆ™æ¸…ç†è¯¥slotï¼Œå¹¶æŠŠæ•°æ®æ”¾è¿›å» if (k == null) { replaceStaleEntry(key, value, i); return; } } tab[i] = new Entry(key, value); int sz = ++size; //å…ˆæ£€æŸ¥iåé¢çš„slotæ˜¯å¦æœ‰è¢«å›æ”¶çš„å¼•ç”¨ï¼Œå¦‚æœæœ‰åˆ™æ¸…ç†ï¼Œå¦åˆ™sizeå¤§äºthresholdåˆ™æ‰©å®¹ if (!cleanSomeSlots(i, sz) &amp;&amp; sz >= threshold) rehash(); } 3.1.1.2 ThreadLocalMap.cleanSomeSlotsprivate boolean cleanSomeSlots(int i, int n) { boolean removed = false; Entry[] tab = table; int len = tab.length; do { i = nextIndex(i, len); Entry e = tab[i]; //æ£€æŸ¥æ˜¯å¦æœ‰è¢«å›æ”¶çš„å¼•ç”¨ if (e != null &amp;&amp; e.get() == null) { n = len; removed = true; // æ¸…ç†è¯¥slot i = expungeStaleEntry(i); } } while ( (n >>>= 1) != 0); return removed; } 3.1.1.3 ThreadLocalMap.expungeStaleEntryprivate int expungeStaleEntry(int staleSlot) { Entry[] tab = table; int len = tab.length; // å…ˆæ¸…ç† tab[staleSlot].value = null; tab[staleSlot] = null; size--; // Rehash until we encounter null Entry e; int i; for (i = nextIndex(staleSlot, len); (e = tab[i]) != null; i = nextIndex(i, len)) { ThreadLocal&lt;?> k = e.get(); if (k == null) { e.value = null; tab[i] = null; size--; } else { // å¯¹äºè¿˜æ²¡æœ‰è¢«å›æ”¶çš„æƒ…å†µï¼Œéœ€è¦åšä¸€æ¬¡ rehashã€‚ //å¦‚æœå¯¹åº”çš„ ThreadLocal çš„ ID å¯¹ len å–æ¨¡å‡ºæ¥çš„ç´¢å¼• h ä¸ä¸ºå½“å‰ä½ç½® iï¼Œ //åˆ™ä» h å‘åçº¿æ€§æ¢æµ‹åˆ°ç¬¬ä¸€ä¸ªç©ºçš„ slotï¼ŒæŠŠå½“å‰çš„ entry ç»™æŒªè¿‡å»ã€‚ int h = k.threadLocalHashCode &amp; (len - 1); if (h != i) { tab[i] = null; // Unlike Knuth 6.4 Algorithm R, we must scan until // null because multiple entries could have been stale. while (tab[h] != null) h = nextIndex(h, len); tab[h] = e; } } } return i; } 3.1.1.4 ThreadLocalMap.rehashprivate void rehash() { expungeStaleEntries(); // å¦‚æœæ¸…ç†å®Œæ‰€æœ‰çš„slotï¼Œsizeä»ç„¶å¤§äº3/4çš„thresholdï¼Œç«‹å³æ‰©å®¹é˜²æ­¢æ»åç°è±¡ if (size >= threshold - threshold / 4) resize(); } 3.1.2 threadLocalHashCodeå†æ¥çœ‹çœ‹è¿™ä¸ªthreadLocalHashCodeæ˜¯æ€ä¹ˆè®¡ç®—çš„ï¼š private final int threadLocalHashCode = nextHashCode(); private static AtomicInteger nextHashCode = new AtomicInteger(); private static final int HASH_INCREMENT = 0x61c88647; private static int nextHashCode() { return nextHashCode.getAndAdd(HASH_INCREMENT); } æ¯ä¸ª ThreadLocal å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª hash å€¼ threadLocalHashCodeï¼Œæ¯åˆå§‹åŒ–ä¸€ä¸ª ThreadLocalå¯¹è±¡ï¼Œhash å€¼å°±å¢åŠ ä¸€ä¸ªå›ºå®šçš„å¤§å° 0x61c88647ã€‚ 3.2 getpublic T get() { Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) { //getEntryæ¥æŸ¥æ‰¾æ˜¯å¦æœ‰è¿™ä¸ªå…ƒç´  ThreadLocalMap.Entry e = map.getEntry(this); //å¦‚æœmapä¸­å­˜åœ¨è¯¥å€¼ï¼Œè¿”å› if (e != null) { @SuppressWarnings(\"unchecked\") T result = (T)e.value; return result; } } //å¦åˆ™setInitialValueï¼Œå¹¶å°†ç»“æœè¿”å› return setInitialValue(); } 3.2.1 getEntryprivate Entry getEntry(ThreadLocal&lt;?> key) { int i = key.threadLocalHashCode &amp; (table.length - 1); Entry e = table[i]; if (e != null &amp;&amp; e.get() == key) return e; else //ç”±äºé‡‡ç”¨çº¿æ€§æ¢æµ‹æ³•ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°éœ€è¦ç»§ç»­å‘åæŸ¥æ‰¾ return getEntryAfterMiss(key, i, e); } 3.2.2 setInitialValueprivate T setInitialValue() { //ä»initialValueæ–¹æ³•è·å–åˆå§‹å€¼ T value = initialValue(); Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); //setåˆ°mapä¸­ if (map != null) map.set(this, value); else createMap(t, value); return value; } è€ŒinitialValueé»˜è®¤è¿”å›nullï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºThreadLocalå¯¹è±¡æ—¶é‡å†™initialValueæ–¹æ³•æ¥æŒ‡å®šç¬¬ä¸€æ¬¡è°ƒç”¨getè·å–çš„å€¼ã€‚ 3.3 removepublic void remove() { ThreadLocalMap m = getMap(Thread.currentThread()); if (m != null) //ç›´æ¥è°ƒç”¨ThreadLocalMapçš„removeæ–¹æ³•ç§»é™¤ m.remove(this); } 3.3.1 ThreadLocalMap.removeprivate void remove(ThreadLocal&lt;?> key) { Entry[] tab = table; int len = tab.length; int i = key.threadLocalHashCode &amp; (len-1); for (Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) { if (e.get() == key) { //åœ¨Entryä¸Šè°ƒç”¨clear e.clear(); //æ¸…ç†åé¢çš„slot expungeStaleEntry(i); return; } } } 4 é—®é¢˜4.1 ä¸ºä»€ä¹ˆ ThreadLocalMap çš„ Key æ˜¯å¼±å¼•ç”¨å¦‚æœæ˜¯å¼ºå¼•ç”¨ï¼ŒThreadLocal å°†æ— æ³•è¢«é‡Šæ”¾å†…å­˜ã€‚ å› ä¸ºå¦‚æœè¿™é‡Œä½¿ç”¨æ™®é€šçš„ key-value å½¢å¼æ¥å®šä¹‰å­˜å‚¨ç»“æ„ï¼Œå®è´¨ä¸Šå°±ä¼šé€ æˆèŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹å¼ºç»‘å®šï¼Œåªè¦çº¿ç¨‹æ²¡æœ‰é”€æ¯ï¼Œé‚£ä¹ˆèŠ‚ç‚¹åœ¨ GC åˆ†æä¸­ä¸€ç›´å¤„äºå¯è¾¾çŠ¶æ€ï¼Œæ²¡åŠæ³•è¢«å›æ”¶ï¼Œè€Œç¨‹åºæœ¬èº«ä¹Ÿæ— æ³•åˆ¤æ–­æ˜¯å¦å¯ä»¥æ¸…ç†èŠ‚ç‚¹ã€‚å¼±å¼•ç”¨æ˜¯ Java ä¸­å››æ¡£å¼•ç”¨çš„ç¬¬ä¸‰æ¡£ï¼Œæ¯”è½¯å¼•ç”¨æ›´åŠ å¼±ä¸€äº›ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡æ²¡æœ‰å¼ºå¼•ç”¨é“¾å¯è¾¾ï¼Œé‚£ä¹ˆä¸€èˆ¬æ´»ä¸è¿‡ä¸‹ä¸€æ¬¡ GCã€‚å½“æŸä¸ªThreadLocal å·²ç»æ²¡æœ‰å¼ºå¼•ç”¨å¯è¾¾ï¼Œåˆ™éšç€å®ƒè¢«åƒåœ¾å›æ”¶ï¼Œåœ¨ ThreadLocalMap é‡Œå¯¹åº”çš„ Entryçš„é”®å€¼ä¼šå¤±æ•ˆï¼Œè¿™ä¸º ThreadLocalMap æœ¬èº«çš„åƒåœ¾æ¸…ç†æä¾›äº†ä¾¿åˆ©ã€‚ 4.2 å¬è¯´ ThreadLocalMap è¿˜æ˜¯ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼Ÿç½‘ä¸Šæœ‰åšå®¢è¯´ThreadLocalè¢«å›æ”¶äº†ä¹‹åä½†mapä¸­å¯¹åº”çš„valueè¿˜æ˜¯å›æ”¶ä¸äº†ï¼Œé€ æˆå†…å­˜æ³„æ¼ï¼Œç¡®å®valueä¸ä¼šåœ¨ThreadLocalè¢«å›æ”¶çš„æ—¶å€™ç«‹åˆ»è¢«æ¸…é™¤ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨æºç ä¸­çœ‹åˆ°å„ç§æ–¹æ³•éƒ½æœ‰åœ¨æ“ä½œå‰åæ£€æŸ¥mapä¸­æ˜¯å¦å­˜åœ¨keyä¸ºnullçš„Entryï¼Œå¦‚æœæœ‰çš„è¯å°±æ¸…ç©ºè¯¥Entryï¼Œæ‰€ä»¥å¤§å¤šæ•°æƒ…å†µä¸‹è¿™ä¸ªEntryè¿˜æ˜¯èƒ½å¾ˆå¿«è¢«æ¸…é™¤çš„ã€‚é™¤éThreadLocalè¢«å›æ”¶äº†ä¹‹åè¯¥çº¿ç¨‹çš„ThreadLocalMapä¸€ç›´ä¸è¿›è¡Œä»»ä½•æ“ä½œï¼Œé‚£ä¹ˆè¯¥valueä¸ä¼šè¢«å›æ”¶ã€‚ ä¸è¿‡ä½œä¸ºä¸€ä¸ªå¥½ä¹ æƒ¯è¿˜æ˜¯æ¨èç”¨å®Œäº†ThreadLocalè°ƒç”¨å®ƒçš„removeæ–¹æ³•ï¼Œèƒ½å¤Ÿç›´æ¥ç§»é™¤è¯¥Entryã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jdk","slug":"jdk","permalink":"https://www.codetool.top/tags/jdk/"},{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://www.codetool.top/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://www.codetool.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"ConcurrentHashMapæºç åˆ†æ","slug":"ConcurrentHashMapæºç åˆ†æ","date":"2020-02-13T12:21:28.000Z","updated":"2020-04-22T09:27:27.142Z","comments":true,"path":"article/ConcurrentHashMapæºç åˆ†æ/","link":"","permalink":"https://www.codetool.top/article/ConcurrentHashMap%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","excerpt":"","text":"1 çº¿ç¨‹å®‰å…¨é›†åˆç±»æ¦‚è¿°çº¿ç¨‹å®‰å…¨é›†åˆç±»å¯ä»¥åˆ†ä¸ºä¸‰å¤§ç±»ï¼š é—ç•™çš„çº¿ç¨‹å®‰å…¨é›†åˆå¦‚ HashTable ï¼Œ Vector ä½¿ç”¨Collectionsè£…é¥°çš„çº¿ç¨‹å®‰å…¨é›†åˆï¼Œå¦‚ï¼šï¼ˆåªæ˜¯å†…éƒ¨ä½¿ç”¨äº†äº’æ–¥é‡mutexè¿›è¡Œé”æ“ä½œï¼‰ Collections.synchronizedCollection Collections.synchronizedList Collections.synchronizedMap Collections.synchronizedSet Collections.synchronizedNavigableMap Collections.synchronizedNavigableSet Collections.synchronizedSortedMap Collections.synchronizedSortedSet java.util.concurrent.* JUCä¸‹çš„å®¹å™¨åˆ™é€šå¸¸åŒ…å«ä¸‰å¤§å…³é”®è¯ï¼šBlockingã€CopyOnWriteã€Concurrent Blocking å¤§éƒ¨åˆ†å®ç°åŸºäºé”ï¼Œå¹¶æä¾›ç”¨æ¥é˜»å¡çš„æ–¹æ³• CopyOnWrite ä¹‹ç±»å®¹å™¨ä¿®æ”¹å¼€é”€ç›¸å¯¹è¾ƒé‡ Concurrent ç±»å‹çš„å®¹å™¨ å†…éƒ¨å¾ˆå¤šæ“ä½œä½¿ç”¨ cas ä¼˜åŒ–ï¼Œä¸€èˆ¬å¯ä»¥æä¾›è¾ƒé«˜ååé‡ å¼±ä¸€è‡´æ€§ éå†æ—¶å¼±ä¸€è‡´æ€§ï¼Œä¾‹å¦‚ï¼Œå½“åˆ©ç”¨è¿­ä»£å™¨éå†æ—¶ï¼Œå¦‚æœå®¹å™¨å‘ç”Ÿä¿®æ”¹ï¼Œè¿­ä»£å™¨ä»ç„¶å¯ä»¥ç»§ç»­è¿›è¡Œéå†ï¼Œè¿™æ—¶å†…å®¹æ˜¯æ—§çš„ æ±‚å¤§å°å¼±ä¸€è‡´æ€§ï¼Œsize æ“ä½œæœªå¿…æ˜¯ 100% å‡†ç¡® è¯»å–å¼±ä¸€è‡´æ€§ å¯¹äºéçº¿ç¨‹å®‰å…¨å®¹å™¨ï¼Œéå†æ—¶å¦‚æœå‘ç”Ÿäº†ä¿®æ”¹ï¼Œä½¿ç”¨ fail-fast æœºåˆ¶ä¹Ÿèƒ½è®©éå†ç«‹åˆ»å¤±è´¥ï¼ŒæŠ›å‡ºConcurrentModificationExceptionï¼Œä¸å†ç»§ç»­éå† 2 JDK 7 HashMap å¹¶å‘æ­»é“¾JDK7ä¸­ï¼Œè§£å†³å“ˆå¸Œå†²çªçš„æ—¶å€™ï¼Œå¾€é“¾è¡¨ä¸­æ’å…¥èŠ‚ç‚¹ï¼Œæ€»æ˜¯ä½äºé“¾è¡¨çš„å¤´éƒ¨ï¼Œè€ŒJDK8ç›¸åï¼Œæ€»æ˜¯æ’å…¥é“¾è¡¨çš„å°¾éƒ¨ã€‚ åœ¨JDK7ä¸­ï¼ŒHashMapåœ¨å¹¶å‘ç¯å¢ƒä¸‹æ‰©å®¹çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°å¹¶å‘æ­»é“¾ï¼Œäº§ç”Ÿéå¸¸ä¸¥é‡çš„åæœã€‚ ç”±äºJDK7ä¸­æ‰©å®¹æ˜¯é€šè¿‡è¿­ä»£å™¨éå†å…ƒç´ æ’å…¥åˆ°æ–°è¡¨ä¸­ï¼ŒåŸæ¥åœ¨é“¾è¡¨ä¸­å¤„äºå¤´éƒ¨çš„å…ƒç´ åœ¨æ–°è¡¨ä¸­å¤„äºå°¾éƒ¨ï¼Œä¹‹å // å°† table è¿ç§»è‡³ newTable void transfer(Entry[] newTable, boolean rehash) { int newCapacity = newTable.length; for (Entry&lt;K,V> e : table) { while(null != e) { Entry&lt;K,V> next = e.next; // 1 å¤„ if (rehash) { e.hash = null == e.key ? 0 : hash(e.key); } int i = indexFor(e.hash, newCapacity); // 2 å¤„ // å°†æ–°å…ƒç´ åŠ å…¥ newTable[i], åŸ newTable[i] ä½œä¸ºæ–°å…ƒç´ çš„ next e.next = newTable[i]; newTable[i] = e; e = next; } } } åŸå§‹é“¾è¡¨ï¼Œæ ¼å¼ï¼š[ä¸‹æ ‡] (key,next) [1] (1,35)-&gt;(35,16)-&gt;(16,null) çº¿ç¨‹ a æ‰§è¡Œåˆ° 1 å¤„ ï¼Œæ­¤æ—¶å±€éƒ¨å˜é‡ e ä¸º (1,35)ï¼Œè€Œå±€éƒ¨å˜é‡ next ä¸º (35,16) çº¿ç¨‹ a æŒ‚èµ· çº¿ç¨‹ b å¼€å§‹æ‰§è¡Œ ç¬¬ä¸€æ¬¡å¾ªç¯ [1] (1,null) ç¬¬äºŒæ¬¡å¾ªç¯ [1] (35,1)-&gt;(1,null) ç¬¬ä¸‰æ¬¡å¾ªç¯ [1] (35,1)-&gt;(1,null) [17] (16,null) åˆ‡æ¢å›çº¿ç¨‹ aï¼Œæ­¤æ—¶å±€éƒ¨å˜é‡ e å’Œ next è¢«æ¢å¤ï¼Œå¼•ç”¨æ²¡å˜ä½†å†…å®¹å˜äº†ï¼še çš„å†…å®¹è¢«æ”¹ä¸º (1,null)ï¼Œè€Œ next çš„å†… å®¹è¢«æ”¹ä¸º (35,1) å¹¶é“¾å‘ (1,null) ç¬¬ä¸€æ¬¡å¾ªç¯ [1] (1,null) ç¬¬äºŒæ¬¡å¾ªç¯ï¼Œæ³¨æ„è¿™æ—¶ e æ˜¯ (35,1) å¹¶é“¾å‘ (1,null) æ‰€ä»¥ next åˆæ˜¯ (1,null) [1] (35,1)-&gt;(1,null) ç¬¬ä¸‰æ¬¡å¾ªç¯ï¼Œe æ˜¯ (1,null)ï¼Œè€Œ next æ˜¯ nullï¼Œä½† e è¢«æ”¾å…¥é“¾è¡¨å¤´ï¼Œè¿™æ · e.next å˜æˆäº† 35 ï¼ˆ2 å¤„ï¼‰ [1] (1,35)-&gt;(35,1)-&gt;(1,35) å·²ç»æ˜¯æ­»é“¾äº† ç©¶å…¶åŸå› ï¼Œæ˜¯å› ä¸ºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨äº†éçº¿ç¨‹å®‰å…¨çš„ map é›†åˆ JDK 8 è™½ç„¶å°†æ‰©å®¹ç®—æ³•åšäº†è°ƒæ•´ï¼Œä¸å†å°†å…ƒç´ åŠ å…¥é“¾è¡¨å¤´ï¼ˆè€Œæ˜¯ä¿æŒä¸æ‰©å®¹å‰ä¸€æ ·çš„é¡ºåºï¼‰ï¼Œä½†ä»ä¸æ„å‘³ç€èƒ½å¤Ÿåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹èƒ½å¤Ÿå®‰å…¨æ‰©å®¹ï¼Œè¿˜ä¼šå‡ºç°å…¶å®ƒé—®é¢˜ï¼ˆå¦‚æ‰©å®¹ä¸¢æ•°æ®ï¼‰ 3 ConcurrentHashMap JDK1.8åŸç†3.1 é‡è¦å±æ€§å’Œå†…éƒ¨ç±»// é»˜è®¤ä¸º 0 // å½“åˆå§‹åŒ–æ—¶, ä¸º -1 // å½“æ‰©å®¹æ—¶, ä¸º -(1 + æ‰©å®¹çº¿ç¨‹æ•°) // å½“åˆå§‹åŒ–æˆ–æ‰©å®¹å®Œæˆåï¼Œä¸º ä¸‹ä¸€æ¬¡çš„æ‰©å®¹çš„é˜ˆå€¼å¤§å° private transient volatile int sizeCtl; // æ•´ä¸ª ConcurrentHashMap å°±æ˜¯ä¸€ä¸ª Node[] static class Node&lt;K,V> implements Map.Entry&lt;K,V> {} // hash è¡¨ transient volatile Node&lt;K,V>[] table; // æ‰©å®¹æ—¶çš„ æ–° hash è¡¨ private transient volatile Node&lt;K,V>[] nextTable; // æ‰©å®¹æ—¶å¦‚æœæŸä¸ª bin è¿ç§»å®Œæ¯•, ç”¨ ForwardingNode ä½œä¸ºæ—§ table bin çš„å¤´ç»“ç‚¹ static final class ForwardingNode&lt;K,V> extends Node&lt;K,V> {} // ç”¨åœ¨ compute ä»¥åŠ computeIfAbsent æ—¶, ç”¨æ¥å ä½, è®¡ç®—å®Œæˆåæ›¿æ¢ä¸ºæ™®é€š Node static final class ReservationNode&lt;K,V> extends Node&lt;K,V> {} // ä½œä¸º treebin çš„å¤´èŠ‚ç‚¹, å­˜å‚¨ root å’Œ first static final class TreeBin&lt;K,V> extends Node&lt;K,V> {} // ä½œä¸º treebin çš„èŠ‚ç‚¹, å­˜å‚¨ parent, left, right static final class TreeNode&lt;K,V> extends Node&lt;K,V> {} 3.2 é‡è¦æ–¹æ³•// è·å– Node[] ä¸­ç¬¬ i ä¸ª Node static final &lt;K,V> Node&lt;K,V> tabAt(Node&lt;K,V>[] tab, int i) // cas ä¿®æ”¹ Node[] ä¸­ç¬¬ i ä¸ª Node çš„å€¼, c ä¸ºæ—§å€¼, v ä¸ºæ–°å€¼ static final &lt;K,V> boolean casTabAt(Node&lt;K,V>[] tab, int i, Node&lt;K,V> c, Node&lt;K,V> v) // ç›´æ¥ä¿®æ”¹ Node[] ä¸­ç¬¬ i ä¸ª Node çš„å€¼, v ä¸ºæ–°å€¼ static final &lt;K,V> void setTabAt(Node&lt;K,V>[] tab, int i, Node&lt;K,V> v) 3.3 æ„é€ å™¨åˆ†æå¯ä»¥çœ‹åˆ°å®ç°äº†æ‡’æƒ°åˆå§‹åŒ–ï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­ä»…ä»…è®¡ç®—äº† table çš„å¤§å°ï¼Œä»¥ååœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰ä¼šçœŸæ­£åˆ›å»º public ConcurrentHashMap(int initialCapacity, float loadFactor, int concurrencyLevel) { if (!(loadFactor > 0.0f) || initialCapacity &lt; 0 || concurrencyLevel &lt;= 0) throw new IllegalArgumentException(); if (initialCapacity &lt; concurrencyLevel) // Use at least as many bins initialCapacity = concurrencyLevel; // as estimated threads long size = (long)(1.0 + (long)initialCapacity / loadFactor); // tableSizeFor ä»ç„¶æ˜¯ä¿è¯è®¡ç®—çš„å¤§å°æ˜¯ 2^n, å³ 16,32,64 ... int cap = (size >= (long)MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : tableSizeFor((int)size); this.sizeCtl = cap; } 3.4 get æµç¨‹public V get(Object key) { Node&lt;K,V>[] tab; Node&lt;K,V> e, p; int n, eh; K ek; // spread æ–¹æ³•èƒ½ç¡®ä¿è¿”å›ç»“æœæ˜¯æ­£æ•° int h = spread(key.hashCode()); if ((tab = table) != null &amp;&amp; (n = tab.length) > 0 &amp;&amp; (e = tabAt(tab, (n - 1) &amp; h)) != null) { // å¦‚æœå¤´ç»“ç‚¹å·²ç»æ˜¯è¦æŸ¥æ‰¾çš„ key if ((eh = e.hash) == h) { if ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek))) return e.val; } // hash ä¸ºè´Ÿæ•°è¡¨ç¤ºè¯¥ bin åœ¨æ‰©å®¹ä¸­æˆ–æ˜¯ treebin, è¿™æ—¶è°ƒç”¨ find æ–¹æ³•æ¥æŸ¥æ‰¾ else if (eh &lt; 0) return (p = e.find(h, key)) != null ? p.val : null; // æ­£å¸¸éå†é“¾è¡¨, ç”¨ equals æ¯”è¾ƒ while ((e = e.next) != null) { if (e.hash == h &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) return e.val; } } return null; } 3.5 put æµç¨‹ä»¥ä¸‹æ•°ç»„ç®€ç§°ï¼ˆtableï¼‰ï¼Œé“¾è¡¨ç®€ç§°ï¼ˆbinï¼‰ public V put(K key, V value) { return putVal(key, value, false); } final V putVal(K key, V value, boolean onlyIfAbsent) { if (key == null || value == null) throw new NullPointerException(); // å…¶ä¸­ spread æ–¹æ³•ä¼šç»¼åˆé«˜ä½ä½ä½, å…·æœ‰æ›´å¥½çš„ hash æ€§ int hash = spread(key.hashCode()); int binCount = 0; for (Node&lt;K,V>[] tab = table;;) { // f æ˜¯é“¾è¡¨å¤´èŠ‚ç‚¹ // fh æ˜¯é“¾è¡¨å¤´ç»“ç‚¹çš„ hash // i æ˜¯é“¾è¡¨åœ¨ table ä¸­çš„ä¸‹æ ‡ Node&lt;K,V> f; int n, i, fh; // è¦åˆ›å»º table if (tab == null || (n = tab.length) == 0) // åˆå§‹åŒ– table ä½¿ç”¨äº† cas, æ— éœ€ synchronized åˆ›å»ºæˆåŠŸ, è¿›å…¥ä¸‹ä¸€è½®å¾ªç¯ tab = initTable(); // è¦åˆ›å»ºé“¾è¡¨å¤´èŠ‚ç‚¹ else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) { // æ·»åŠ é“¾è¡¨å¤´ä½¿ç”¨äº† cas, æ— éœ€ synchronized if (casTabAt(tab, i, null, new Node&lt;K,V>(hash, key, value, null))) break; } // å¸®å¿™æ‰©å®¹ else if ((fh = f.hash) == MOVED) // å¸®å¿™ä¹‹å, è¿›å…¥ä¸‹ä¸€è½®å¾ªç¯ tab = helpTransfer(tab, f); else { V oldVal = null; // é”ä½é“¾è¡¨å¤´èŠ‚ç‚¹ synchronized (f) { // å†æ¬¡ç¡®è®¤é“¾è¡¨å¤´èŠ‚ç‚¹æ²¡æœ‰è¢«ç§»åŠ¨ if (tabAt(tab, i) == f) { // é“¾è¡¨ if (fh >= 0) { binCount = 1; // éå†é“¾è¡¨ for (Node&lt;K,V> e = f;; ++binCount) { K ek; // æ‰¾åˆ°ç›¸åŒçš„ key if (e.hash == hash &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) { oldVal = e.val; // æ›´æ–° if (!onlyIfAbsent) e.val = value; break; } Node&lt;K,V> pred = e; // å·²ç»æ˜¯æœ€åçš„èŠ‚ç‚¹äº†, æ–°å¢ Node, è¿½åŠ è‡³é“¾è¡¨å°¾ if ((e = e.next) == null) { pred.next = new Node&lt;K,V>(hash, key, value, null); break; } } } // çº¢é»‘æ ‘ else if (f instanceof TreeBin) { Node&lt;K,V> p; binCount = 2; // putTreeVal ä¼šçœ‹ key æ˜¯å¦å·²ç»åœ¨æ ‘ä¸­, æ˜¯, åˆ™è¿”å›å¯¹åº”çš„ TreeNode if ((p = ((TreeBin&lt;K,V>)f).putTreeVal(hash, key, value)) != null) { oldVal = p.val; if (!onlyIfAbsent) p.val = value; } } } // é‡Šæ”¾é“¾è¡¨å¤´èŠ‚ç‚¹çš„é” } if (binCount != 0) { if (binCount >= TREEIFY_THRESHOLD) // å¦‚æœé“¾è¡¨é•¿åº¦ >= æ ‘åŒ–é˜ˆå€¼(8), è¿›è¡Œé“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘ treeifyBin(tab, i); if (oldVal != null) return oldVal; break; } } } // å¢åŠ  size è®¡æ•° addCount(1L, binCount); return null; } private final Node&lt;K,V>[] initTable() { Node&lt;K,V>[] tab; int sc; while ((tab = table) == null || tab.length == 0) { if ((sc = sizeCtl) &lt; 0) Thread.yield(); // å°è¯•å°† sizeCtl è®¾ç½®ä¸º -1ï¼ˆè¡¨ç¤ºåˆå§‹åŒ– tableï¼‰ else if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) { // è·å¾—é”, åˆ›å»º table, è¿™æ—¶å…¶å®ƒçº¿ç¨‹ä¼šåœ¨ while() å¾ªç¯ä¸­ yield ç›´è‡³ table åˆ›å»º try { if ((tab = table) == null || tab.length == 0) { int n = (sc > 0) ? sc : DEFAULT_CAPACITY; Node&lt;K,V>[] nt = (Node&lt;K,V>[])new Node&lt;?,?>[n]; table = tab = nt; sc = n - (n >>> 2); } } finally { sizeCtl = sc; } break; } } return tab; } // check æ˜¯ä¹‹å‰ binCount çš„ä¸ªæ•° private final void addCount(long x, int check) { CounterCell[] as; long b, s; if ( // å·²ç»æœ‰äº† counterCells, å‘ cell ç´¯åŠ  (as = counterCells) != null || // è¿˜æ²¡æœ‰, å‘ baseCount ç´¯åŠ  !U.compareAndSwapLong(this, BASECOUNT, b = baseCount, s = b + x) ) { CounterCell a; long v; int m; boolean uncontended = true; if ( // è¿˜æ²¡æœ‰ counterCells as == null || (m = as.length - 1) &lt; 0 || // è¿˜æ²¡æœ‰ cell (a = as[ThreadLocalRandom.getProbe() &amp; m]) == null || // cell cas å¢åŠ è®¡æ•°å¤±è´¥ !(uncontended = U.compareAndSwapLong(a, CELLVALUE, v = a.value, v + x)) ) { // åˆ›å»ºç´¯åŠ å•å…ƒæ•°ç»„å’Œcell, ç´¯åŠ é‡è¯• fullAddCount(x, uncontended); return; } if (check &lt;= 1) return; // è·å–å…ƒç´ ä¸ªæ•° s = sumCount(); } if (check >= 0) { Node&lt;K,V>[] tab, nt; int n, sc; while (s >= (long)(sc = sizeCtl) &amp;&amp; (tab = table) != null &amp;&amp; (n = tab.length) &lt; MAXIMUM_CAPACITY) { int rs = resizeStamp(n); if (sc &lt; 0) { if ((sc >>> RESIZE_STAMP_SHIFT) != rs || sc == rs + 1 || sc == rs + MAX_RESIZERS || (nt = nextTable) == null || transferIndex &lt;= 0) break; // newtable å·²ç»åˆ›å»ºäº†ï¼Œå¸®å¿™æ‰©å®¹ if (U.compareAndSwapInt(this, SIZECTL, sc, sc + 1)) transfer(tab, nt); } // éœ€è¦æ‰©å®¹ï¼Œè¿™æ—¶ newtable æœªåˆ›å»º else if (U.compareAndSwapInt(this, SIZECTL, sc, (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2)) transfer(tab, null); s = sumCount(); } } } 3.6 size è®¡ç®—æµç¨‹size è®¡ç®—å®é™…å‘ç”Ÿåœ¨ putï¼Œremove æ”¹å˜é›†åˆå…ƒç´ çš„æ“ä½œä¹‹ä¸­ æ²¡æœ‰ç«äº‰å‘ç”Ÿï¼Œå‘ baseCount ç´¯åŠ è®¡æ•° æœ‰ç«äº‰å‘ç”Ÿï¼Œæ–°å»º counterCellsï¼Œå‘å…¶ä¸­çš„ä¸€ä¸ª cell ç´¯åŠ è®¡æ•° counterCells åˆå§‹æœ‰ä¸¤ä¸ª cell å¦‚æœè®¡æ•°ç«äº‰æ¯”è¾ƒæ¿€çƒˆï¼Œä¼šåˆ›å»ºæ–°çš„ cell æ¥ç´¯åŠ è®¡æ•° public int size() { long n = sumCount(); return ((n &lt; 0L) ? 0 : (n > (long)Integer.MAX_VALUE) ? Integer.MAX_VALUE : (int)n); } final long sumCount() { CounterCell[] as = counterCells; CounterCell a; // å°† baseCount è®¡æ•°ä¸æ‰€æœ‰ cell è®¡æ•°ç´¯åŠ  long sum = baseCount; if (as != null) { for (int i = 0; i &lt; as.length; ++i) { if ((a = as[i]) != null) sum += a.value; } } return sum; } æ€»ç»“ï¼š åˆå§‹åŒ–ï¼Œä½¿ç”¨ cas æ¥ä¿è¯å¹¶å‘å®‰å…¨ï¼Œæ‡’æƒ°åˆå§‹åŒ– table æ ‘åŒ–ï¼Œå½“ table.length &lt; 64 æ—¶ï¼Œå…ˆå°è¯•æ‰©å®¹ï¼Œè¶…è¿‡ 64 æ—¶ï¼Œå¹¶ä¸” bin.length &gt; 8 æ—¶ï¼Œä¼šå°†é“¾è¡¨æ ‘åŒ–ï¼Œæ ‘åŒ–è¿‡ç¨‹ä¼šç”¨ synchronized é”ä½é“¾è¡¨å¤´ putï¼Œå¦‚æœè¯¥ bin å°šæœªåˆ›å»ºï¼Œåªéœ€è¦ä½¿ç”¨ cas åˆ›å»º binï¼›å¦‚æœå·²ç»æœ‰äº†ï¼Œé”ä½é“¾è¡¨å¤´è¿›è¡Œåç»­ put æ“ä½œï¼Œå…ƒç´ æ·»åŠ è‡³ bin çš„å°¾éƒ¨ getï¼Œæ— é”æ“ä½œä»…éœ€è¦ä¿è¯å¯è§æ€§ï¼Œæ‰©å®¹è¿‡ç¨‹ä¸­ get æ“ä½œæ‹¿åˆ°çš„æ˜¯ ForwardingNode å®ƒä¼šè®© get æ“ä½œåœ¨æ–°table è¿›è¡Œæœç´¢ æ‰©å®¹ï¼Œæ‰©å®¹æ—¶ä»¥ bin ä¸ºå•ä½è¿›è¡Œï¼Œéœ€è¦å¯¹ bin è¿›è¡Œ synchronizedï¼Œä½†è¿™æ—¶å¦™çš„æ˜¯å…¶å®ƒç«äº‰çº¿ç¨‹ä¹Ÿä¸æ˜¯æ— äº‹å¯åšï¼Œå®ƒä»¬ä¼šå¸®åŠ©æŠŠå…¶å®ƒ bin è¿›è¡Œæ‰©å®¹ï¼Œæ‰©å®¹æ—¶å¹³å‡åªæœ‰ 1/6 çš„èŠ‚ç‚¹ä¼šæŠŠå¤åˆ¶åˆ°æ–° table ä¸­ sizeï¼Œå…ƒç´ ä¸ªæ•°ä¿å­˜åœ¨ baseCount ä¸­ï¼Œå¹¶å‘æ—¶çš„ä¸ªæ•°å˜åŠ¨ä¿å­˜åœ¨ CounterCell[] å½“ä¸­ã€‚æœ€åç»Ÿè®¡æ•°é‡æ—¶ç´¯åŠ å³å¯ 4 JDK 7 ConcurrentHashMapå®ƒç»´æŠ¤äº†ä¸€ä¸ª segment æ•°ç»„ï¼Œæ¯ä¸ª segment å¯¹åº”ä¸€æŠŠé” ä¼˜ç‚¹ï¼šå¦‚æœå¤šä¸ªçº¿ç¨‹è®¿é—®ä¸åŒçš„ segmentï¼Œå®é™…æ˜¯æ²¡æœ‰å†²çªçš„ï¼Œè¿™ä¸ jdk8 ä¸­æ˜¯ç±»ä¼¼çš„ ç¼ºç‚¹ï¼šSegments æ•°ç»„é»˜è®¤å¤§å°ä¸º16ï¼Œè¿™ä¸ªå®¹é‡åˆå§‹åŒ–æŒ‡å®šåå°±ä¸èƒ½æ”¹å˜äº†ï¼Œå¹¶ä¸”ä¸æ˜¯æ‡’æƒ°åˆå§‹åŒ– 4.1 æ„é€ å™¨åˆ†æpublic ConcurrentHashMap(int initialCapacity, float loadFactor, int concurrencyLevel) { if (!(loadFactor > 0) || initialCapacity &lt; 0 || concurrencyLevel &lt;= 0) throw new IllegalArgumentException(); if (concurrencyLevel > MAX_SEGMENTS) concurrencyLevel = MAX_SEGMENTS; // ssize å¿…é¡»æ˜¯ 2^n, å³ 2, 4, 8, 16 ... è¡¨ç¤ºäº† segments æ•°ç»„çš„å¤§å° int sshift = 0; int ssize = 1; while (ssize &lt; concurrencyLevel) { ++sshift; ssize &lt;&lt;= 1; } // segmentShift é»˜è®¤æ˜¯ 32 - 4 = 28 this.segmentShift = 32 - sshift; // segmentMask é»˜è®¤æ˜¯ 15 å³ 0000 0000 0000 1111 this.segmentMask = ssize - 1; if (initialCapacity > MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; int c = initialCapacity / ssize; if (c * ssize &lt; initialCapacity) ++c; int cap = MIN_SEGMENT_TABLE_CAPACITY; while (cap &lt; c) cap &lt;&lt;= 1; // åˆ›å»º segments and segments[0] Segment&lt;K,V> s0 = new Segment&lt;K,V>(loadFactor, (int)(cap * loadFactor), (HashEntry&lt;K,V>[])new HashEntry[cap]); Segment&lt;K,V>[] ss = (Segment&lt;K,V>[])new Segment[ssize]; UNSAFE.putOrderedObject(ss, SBASE, s0); // ordered write of segments[0] this.segments = ss; } æ„é€ å®Œæˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º å¯ä»¥çœ‹åˆ° ConcurrentHashMap æ²¡æœ‰å®ç°æ‡’æƒ°åˆå§‹åŒ–ï¼Œç©ºé—´å ç”¨ä¸å‹å¥½å…¶ä¸­ this.segmentShift å’Œ this.segmentMask çš„ä½œç”¨æ˜¯å†³å®šå°† key çš„ hash ç»“æœåŒ¹é…åˆ°å“ªä¸ª segment ä¾‹å¦‚ï¼Œæ ¹æ®æŸä¸€ hash å€¼æ±‚ segment ä½ç½®ï¼Œå…ˆå°†é«˜ä½å‘ä½ä½ç§»åŠ¨ this.segmentShift ä½ ç»“æœå†ä¸ this.segmentMask åšä½äºè¿ç®—ï¼Œ ç»ˆå¾—åˆ° 1010 å³ä¸‹æ ‡ä¸º 10 çš„ segment 4.2 put æµç¨‹public V put(K key, V value) { Segment&lt;K,V> s; if (value == null) throw new NullPointerException(); int hash = hash(key); // è®¡ç®—å‡º segment ä¸‹æ ‡ int j = (hash >>> segmentShift) &amp; segmentMask; // è·å¾— segment å¯¹è±¡, åˆ¤æ–­æ˜¯å¦ä¸º null, æ˜¯åˆ™åˆ›å»ºè¯¥ segment if ((s = (Segment&lt;K,V>)UNSAFE.getObject (segments, (j &lt;&lt; SSHIFT) + SBASE)) == null) { // è¿™æ—¶ä¸èƒ½ç¡®å®šæ˜¯å¦çœŸçš„ä¸º null, å› ä¸ºå…¶å®ƒçº¿ç¨‹ä¹Ÿå‘ç°è¯¥ segment ä¸º null, // å› æ­¤åœ¨ ensureSegment é‡Œç”¨ cas æ–¹å¼ä¿è¯è¯¥ segment å®‰å…¨æ€§ s = ensureSegment(j); } // è¿›å…¥ segment çš„put æµç¨‹ return s.put(key, hash, value, false); } segment ç»§æ‰¿äº†å¯é‡å…¥é”ï¼ˆReentrantLockï¼‰ï¼Œå®ƒçš„ put æ–¹æ³•ä¸º final V put(K key, int hash, V value, boolean onlyIfAbsent) { // å°è¯•åŠ é” HashEntry&lt;K,V> node = tryLock() ? null : // å¦‚æœä¸æˆåŠŸ, è¿›å…¥ scanAndLockForPut æµç¨‹ // å¦‚æœæ˜¯å¤šæ ¸ cpu æœ€å¤š tryLock 64 æ¬¡, è¿›å…¥ lock æµç¨‹ // åœ¨å°è¯•æœŸé—´, è¿˜å¯ä»¥é¡ºä¾¿çœ‹è¯¥èŠ‚ç‚¹åœ¨é“¾è¡¨ä¸­æœ‰æ²¡æœ‰, å¦‚æœæ²¡æœ‰é¡ºä¾¿åˆ›å»ºå‡ºæ¥ scanAndLockForPut(key, hash, value); // æ‰§è¡Œåˆ°è¿™é‡Œ segment å·²ç»è¢«æˆåŠŸåŠ é”, å¯ä»¥å®‰å…¨æ‰§è¡Œ V oldValue; try { HashEntry&lt;K,V>[] tab = table; int index = (tab.length - 1) &amp; hash; HashEntry&lt;K,V> first = entryAt(tab, index); for (HashEntry&lt;K,V> e = first;;) { if (e != null) { // æ›´æ–° K k; if ((k = e.key) == key || (e.hash == hash &amp;&amp; key.equals(k))) { oldValue = e.value; if (!onlyIfAbsent) { e.value = value; ++modCount; } break; } e = e.next; } else { // æ–°å¢ // 1) ä¹‹å‰ç­‰å¾…é”æ—¶, node å·²ç»è¢«åˆ›å»º, next æŒ‡å‘é“¾è¡¨å¤´ if (node != null) node.setNext(first); else // 2) åˆ›å»ºæ–° node node = new HashEntry&lt;K,V>(hash, key, value, first); int c = count + 1; // 3) æ‰©å®¹ if (c > threshold &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY) rehash(node); else // å°† node ä½œä¸ºé“¾è¡¨å¤´ setEntryAt(tab, index, node); ++modCount; count = c; oldValue = null; break; } } } finally { unlock(); } return oldValue; } 4.3 rehash æµç¨‹å‘ç”Ÿåœ¨ put ä¸­ï¼Œå› ä¸ºæ­¤æ—¶å·²ç»è·å¾—äº†é”ï¼Œå› æ­¤ rehash æ—¶ä¸éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨ private void rehash(HashEntry&lt;K,V> node) { HashEntry&lt;K,V>[] oldTable = table; int oldCapacity = oldTable.length; int newCapacity = oldCapacity &lt;&lt; 1; threshold = (int)(newCapacity * loadFactor); HashEntry&lt;K,V>[] newTable = (HashEntry&lt;K,V>[]) new HashEntry[newCapacity]; int sizeMask = newCapacity - 1; for (int i = 0; i &lt; oldCapacity ; i++) { HashEntry&lt;K,V> e = oldTable[i]; if (e != null) { HashEntry&lt;K,V> next = e.next; int idx = e.hash &amp; sizeMask; if (next == null) // Single node on list newTable[idx] = e; else { // Reuse consecutive sequence at same slot HashEntry&lt;K,V> lastRun = e; int lastIdx = idx; // è¿‡ä¸€éé“¾è¡¨, å°½å¯èƒ½æŠŠ rehash å idx ä¸å˜çš„èŠ‚ç‚¹é‡ç”¨ for (HashEntry&lt;K,V> last = next; last != null; last = last.next) { int k = last.hash &amp; sizeMask; if (k != lastIdx) { lastIdx = k; lastRun = last; } } newTable[lastIdx] = lastRun; // å‰©ä½™èŠ‚ç‚¹éœ€è¦æ–°å»º for (HashEntry&lt;K,V> p = e; p != lastRun; p = p.next) { V v = p.value; int h = p.hash; int k = h &amp; sizeMask; HashEntry&lt;K,V> n = newTable[k]; newTable[k] = new HashEntry&lt;K,V>(h, p.key, v, n); } } } } // æ‰©å®¹å®Œæˆ, æ‰åŠ å…¥æ–°çš„èŠ‚ç‚¹ int nodeIndex = node.hash &amp; sizeMask; // add the new node node.setNext(newTable[nodeIndex]); newTable[nodeIndex] = node; // æ›¿æ¢ä¸ºæ–°çš„ HashEntry table table = newTable; } 4.4 get æµç¨‹get æ—¶å¹¶æœªåŠ é”ï¼Œç”¨äº† UNSAFE æ–¹æ³•ä¿è¯äº†å¯è§æ€§ï¼Œæ‰©å®¹è¿‡ç¨‹ä¸­ï¼Œget å…ˆå‘ç”Ÿå°±ä»æ—§è¡¨å–å†…å®¹ï¼Œget åå‘ç”Ÿå°±ä»æ–°è¡¨å–å†…å®¹ public V get(Object key) { Segment&lt;K,V> s; // manually integrate access methods to reduce overhead HashEntry&lt;K,V>[] tab; int h = hash(key); // u ä¸º segment å¯¹è±¡åœ¨æ•°ç»„ä¸­çš„åç§»é‡ long u = (((h >>> segmentShift) &amp; segmentMask) &lt;&lt; SSHIFT) + SBASE; // s å³ä¸º segment if ((s = (Segment&lt;K,V>)UNSAFE.getObjectVolatile(segments, u)) != null &amp;&amp; (tab = s.table) != null) { for (HashEntry&lt;K,V> e = (HashEntry&lt;K,V>) UNSAFE.getObjectVolatile (tab, ((long)(((tab.length - 1) &amp; h)) &lt;&lt; TSHIFT) + TBASE); e != null; e = e.next) { K k; if ((k = e.key) == key || (e.hash == h &amp;&amp; key.equals(k))) return e.value; } } return null; } 4.5 size è®¡ç®—æµç¨‹ è®¡ç®—å…ƒç´ ä¸ªæ•°å‰ï¼Œå…ˆä¸åŠ é”è®¡ç®—ä¸¤æ¬¡ï¼Œå¦‚æœå‰åä¸¤æ¬¡ç»“æœå¦‚ä¸€æ ·ï¼Œè®¤ä¸ºä¸ªæ•°æ­£ç¡®è¿”å› å¦‚æœä¸ä¸€æ ·ï¼Œè¿›è¡Œé‡è¯•ï¼Œé‡è¯•æ¬¡æ•°è¶…è¿‡ 3ï¼Œå°†æ‰€æœ‰ segment é”ä½ï¼Œé‡æ–°è®¡ç®—ä¸ªæ•°è¿”å› public int size() { // Try a few times to get accurate count. On failure due to // continuous async changes in table, resort to locking. final Segment&lt;K,V>[] segments = this.segments; int size; boolean overflow; // true if size overflows 32 bits long sum; // sum of modCounts long last = 0L; // previous sum int retries = -1; // first iteration isn't retry try { for (;;) { if (retries++ == RETRIES_BEFORE_LOCK) { // è¶…è¿‡é‡è¯•æ¬¡æ•°, éœ€è¦åˆ›å»ºæ‰€æœ‰ segment å¹¶åŠ é” for (int j = 0; j &lt; segments.length; ++j) ensureSegment(j).lock(); // force creation } sum = 0L; size = 0; overflow = false; for (int j = 0; j &lt; segments.length; ++j) { Segment&lt;K,V> seg = segmentAt(segments, j); if (seg != null) { sum += seg.modCount; int c = seg.count; if (c &lt; 0 || (size += c) &lt; 0) overflow = true; } } if (sum == last) break; last = sum; } } finally { if (retries > RETRIES_BEFORE_LOCK) { for (int j = 0; j &lt; segments.length; ++j) segmentAt(segments, j).unlock(); } } return overflow ? Integer.MAX_VALUE : size; }","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jdk","slug":"jdk","permalink":"https://www.codetool.top/tags/jdk/"},{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://www.codetool.top/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"}]},{"title":"leetcode373-æŸ¥æ‰¾å’Œæœ€å°çš„Kå¯¹æ•°å­—","slug":"leetcode373-æŸ¥æ‰¾å’Œæœ€å°çš„Kå¯¹æ•°å­—","date":"2020-02-12T18:39:48.000Z","updated":"2020-04-22T09:27:27.142Z","comments":true,"path":"article/leetcode373-æŸ¥æ‰¾å’Œæœ€å°çš„Kå¯¹æ•°å­—/","link":"","permalink":"https://www.codetool.top/article/leetcode373-%E6%9F%A5%E6%89%BE%E5%92%8C%E6%9C%80%E5%B0%8F%E7%9A%84K%E5%AF%B9%E6%95%B0%E5%AD%97/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸¤ä¸ªä»¥å‡åºæ’åˆ—çš„æ•´å½¢æ•°ç»„ nums1 å’Œ nums2, ä»¥åŠä¸€ä¸ªæ•´æ•° kã€‚ å®šä¹‰ä¸€å¯¹å€¼ (u,v)ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ æ¥è‡ª nums1ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ¥è‡ª nums2ã€‚ æ‰¾åˆ°å’Œæœ€å°çš„ k å¯¹æ•°å­— (u1,v1), (u2,v2) â€¦ (uk,vk)ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š nums1 = [1,7,11], nums2 = [2,4,6], k = 3è¾“å‡ºï¼š [1,2],[1,4],[1,6]è§£é‡Šï¼š è¿”å›åºåˆ—ä¸­çš„å‰ 3 å¯¹æ•°ï¼š [1,2],[1,4],[1,6],[7,2],[7,4],[11,2],[7,6],[11,4],[11,6] ç¤ºä¾‹2: è¾“å…¥ï¼š nums1 = [1,1,2], nums2 = [1,2,3], k = 2è¾“å‡ºï¼š [1,1],[1,1]è§£é‡Šï¼š è¿”å›åºåˆ—ä¸­çš„å‰ 2 å¯¹æ•°ï¼š [1,1],[1,1],[1,2],[2,1],[1,2],[2,2],[1,3],[1,3],[2,3] ç¤ºä¾‹3: è¾“å…¥ï¼š nums1 = [1,2], nums2 = [3], k = 3è¾“å‡ºï¼š [1,3],[2,3]è§£é‡Šï¼š ä¹Ÿå¯èƒ½åºåˆ—ä¸­æ‰€æœ‰çš„æ•°å¯¹éƒ½è¢«è¿”å›:[1,3],[2,3] 2 è§£æ³•2.1 æ€æƒ³å¯ä»¥æŠŠæ‰€æœ‰çš„äºŒå…ƒç»„æ’å…¥å †ä¸­ï¼Œé€šè¿‡è‡ªå®šä¹‰çš„æ¯”è¾ƒå™¨æ¥è·å–topkã€‚ 2.2 ä»£ç class Solution { public List&lt;List&lt;Integer>> kSmallestPairs(int[] nums1, int[] nums2, int k) { List&lt;List&lt;Integer>> ans = new ArrayList&lt;>(); Queue&lt;List&lt;Integer>> queue = new PriorityQueue&lt;>( new Comparator&lt;List&lt;Integer>>() { public int compare(List&lt;Integer> o1, List&lt;Integer> o2) { int ans = 0; for(Integer i:o1) ans+=i; for(Integer i:o2) ans-=i; return ans; } }); for(int i:nums1){ for(int j:nums2){ List&lt;Integer> list = new ArrayList&lt;>(); list.add(i); list.add(j); queue.add(list); } } for(int i = 0;i&lt;k;i++){ if(queue.isEmpty()) break; ans.add(queue.poll()); } return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"NIOåº•å±‚åŸç†-epoll","slug":"NIOåº•å±‚åŸç†-epoll","date":"2020-02-12T18:38:48.000Z","updated":"2020-02-12T18:39:37.897Z","comments":true,"path":"article/NIOåº•å±‚åŸç†-epoll/","link":"","permalink":"https://www.codetool.top/article/NIO%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86-epoll/","excerpt":"","text":"BIOæ¨¡å‹å­˜åœ¨ä¸‰ä¸ªsocketï¼š ServerSocketï¼šä¸“é—¨ç”¨æ¥ç›‘å¬æ˜¯å¦æœ‰æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥acceptè¿”å›çš„Socketï¼šä¸“é—¨ç”¨äºå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„socketSocketï¼šå®¢æˆ·ç«¯çš„socket BIOç”±äºaccpetå’Œreadä¼šé˜»å¡ï¼Œå¦‚æœä¸ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œreadæ—¶å€™çš„é˜»å¡ä¼šå¯¼è‡´æ— æ³•ç«‹å³å¤„ç†ä¸‹ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ã€‚ å¦‚æœä½¿ç”¨å¤šçº¿ç¨‹ï¼Œå¦‚æœæŸäº›çº¿ç¨‹ä¸æ´»è·ƒï¼Œå¯èƒ½æµªè´¹CPUèµ„æºã€‚ NIOå¯ä»¥è®¾ç½®é€šè¿‡configureBlockingè®¾ç½®acceptä¸ºéé˜»å¡çš„ï¼Œå¯¹åº”æ“ä½œç³»ç»Ÿäº”ç§IOæ¨¡å‹ä»‹ç»ä¸­çš„éé˜»å¡IOæ¨¡å‹ã€‚ NIOåœ¨æ„ŸçŸ¥å„ä¸ªè¿æ¥çš„è¯»å†™çŠ¶æ€æ˜¯é€šè¿‡æ“ä½œç³»ç»Ÿå†…æ ¸è½®è¯¢å®ç°çš„ã€‚å¯¹åº”æ“ä½œç³»ç»Ÿäº”ç§IOæ¨¡å‹ä»‹ç»ä¸­çš„å¤šè·¯å¤ç”¨IOæ¨¡å‹ã€‚ åœ¨linuxä¸­ï¼Œæ€§èƒ½ä¼šæ›´é«˜ä¸€äº›ï¼Œlinuxå†…æ ¸é€šè¿‡å†…æ ¸å‡½æ•°epollå®ç°è¢«åŠ¨æ„ŸçŸ¥ï¼Œèƒ½æœ‰æ•ˆè§£å†³å¤šä¸ªè¿æ¥ä¸æ´»è·ƒçš„é—®é¢˜ã€‚ epollçš„åŸç†ï¼š epollåŸç†è¯¦è§£åŠepollååº”å †æ¨¡å‹_é’èä¹‹æœ«çš„åšå®¢-CSDNåšå®¢ EpollåŸç†è§£æ_~ LINUX ~-CSDNåšå®¢ å½»åº•ææ‡‚epollé«˜æ•ˆè¿è¡Œçš„åŸç† ï¼ˆå°±è¿™æ ·æ°´äº†ä¸€ç¯‡åšå®¢ï¼‰","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"NIO","slug":"NIO","permalink":"https://www.codetool.top/tags/NIO/"}]},{"title":"æ“ä½œç³»ç»Ÿäº”ç§IOæ¨¡å‹ä»‹ç»","slug":"æ“ä½œç³»ç»Ÿäº”ç§IOæ¨¡å‹ä»‹ç»","date":"2020-02-12T15:19:59.000Z","updated":"2020-04-03T14:32:45.297Z","comments":true,"path":"article/æ“ä½œç³»ç»Ÿäº”ç§IOæ¨¡å‹ä»‹ç»/","link":"","permalink":"https://www.codetool.top/article/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%BA%94%E7%A7%8DIO%E6%A8%A1%E5%9E%8B%E4%BB%8B%E7%BB%8D/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒèµ„æºï¼š äº”ç§IOæ¨¡å‹è¯¦è§£_IOæ¨¡å‹,java_å°èŒƒçš„åšå®¢-CSDNåšå®¢ 1 é˜»å¡ IO æ¨¡å‹æœ€ä¼ ç»Ÿçš„ä¸€ç§ IO æ¨¡å‹ï¼Œå³åœ¨è¯»å†™æ•°æ®è¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿé˜»å¡ç°è±¡ã€‚å½“ç”¨æˆ·çº¿ç¨‹å‘å‡º IO è¯·æ±‚ä¹‹åï¼Œå†…æ ¸ä¼šå»æŸ¥çœ‹æ•°æ®æ˜¯å¦å°±ç»ªï¼Œå¦‚æœæ²¡æœ‰å°±ç»ªå°±ä¼šç­‰å¾…æ•°æ®å°±ç»ªï¼Œè€Œç”¨æˆ·çº¿ç¨‹å°±ä¼šå¤„äºé˜»å¡çŠ¶æ€ï¼Œç”¨æˆ·çº¿ç¨‹äº¤å‡º CPUã€‚å½“æ•°æ®å°±ç»ªä¹‹åï¼Œå†…æ ¸ä¼šå°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·çº¿ç¨‹ï¼Œå¹¶è¿”å›ç»“æœç»™ç”¨æˆ·çº¿ç¨‹ï¼Œç”¨æˆ·çº¿ç¨‹æ‰è§£é™¤ block çŠ¶æ€ã€‚å…¸å‹çš„é˜»å¡ IO æ¨¡å‹çš„ä¾‹å­ä¸ºï¼šdata = socket.read();å¦‚æœæ•°æ®æ²¡æœ‰å°±ç»ªï¼Œå°±ä¼šä¸€ç›´é˜»å¡åœ¨ read æ–¹æ³•ã€‚ 2 éé˜»å¡ IO æ¨¡å‹å½“ç”¨æˆ·çº¿ç¨‹å‘èµ·ä¸€ä¸ª read æ“ä½œåï¼Œå¹¶ä¸éœ€è¦ç­‰å¾…ï¼Œè€Œæ˜¯é©¬ä¸Šå°±å¾—åˆ°äº†ä¸€ä¸ªç»“æœã€‚å¦‚æœç»“æœæ˜¯ä¸€ä¸ªerror æ—¶ï¼Œå®ƒå°±çŸ¥é“æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œäºæ˜¯å®ƒå¯ä»¥å†æ¬¡å‘é€ read æ“ä½œã€‚ä¸€æ—¦å†…æ ¸ä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå¹¶ä¸”åˆå†æ¬¡æ”¶åˆ°äº†ç”¨æˆ·çº¿ç¨‹çš„è¯·æ±‚ï¼Œé‚£ä¹ˆå®ƒé©¬ä¸Šå°±å°†æ•°æ®æ‹·è´åˆ°äº†ç”¨æˆ·çº¿ç¨‹ï¼Œç„¶åè¿”å›ã€‚æ‰€ä»¥äº‹å®ä¸Šï¼Œåœ¨éé˜»å¡ IO æ¨¡å‹ä¸­ï¼Œç”¨æˆ·çº¿ç¨‹éœ€è¦ä¸æ–­åœ°è¯¢é—®å†…æ ¸æ•°æ®æ˜¯å¦å°±ç»ªï¼Œä¹Ÿå°±è¯´éé˜»å¡ IOä¸ä¼šäº¤å‡º CPUï¼Œè€Œä¼šä¸€ç›´å ç”¨ CPUã€‚å…¸å‹çš„éé˜»å¡ IO æ¨¡å‹ä¸€èˆ¬å¦‚ä¸‹ï¼š while(true){ data = socket.read(); if(data!= error){ //å¤„ç†æ•°æ® break; } } ä½†æ˜¯å¯¹äºéé˜»å¡ IO å°±æœ‰ä¸€ä¸ªéå¸¸ä¸¥é‡çš„é—®é¢˜ï¼Œåœ¨ while å¾ªç¯ä¸­éœ€è¦ä¸æ–­åœ°å»è¯¢é—®å†…æ ¸æ•°æ®æ˜¯å¦å°±ç»ªï¼Œè¿™æ ·ä¼šå¯¼è‡´ CPU å ç”¨ç‡éå¸¸é«˜ï¼Œå› æ­¤ä¸€èˆ¬æƒ…å†µä¸‹å¾ˆå°‘ä½¿ç”¨ while å¾ªç¯è¿™ç§æ–¹å¼æ¥è¯»å–æ•°æ®ã€‚ 3 å¤šè·¯å¤ç”¨ IO æ¨¡å‹å¤šè·¯å¤ç”¨ IO æ¨¡å‹æ˜¯ç›®å‰ä½¿ç”¨å¾—æ¯”è¾ƒå¤šçš„æ¨¡å‹ã€‚Java NIO å®é™…ä¸Šå°±æ˜¯å¤šè·¯å¤ç”¨ IOã€‚åœ¨å¤šè·¯å¤ç”¨IOæ¨¡å‹ä¸­ï¼Œä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹(Selector)ä¸æ–­å»è½®è¯¢å¤šä¸ªchannel çš„çŠ¶æ€ï¼Œåªæœ‰å½“channel çœŸæ­£æœ‰è¯»å†™äº‹ä»¶æ—¶ï¼Œæ‰çœŸæ­£è°ƒç”¨å®é™…çš„ IO è¯»å†™æ“ä½œã€‚å› ä¸ºåœ¨å¤šè·¯å¤ç”¨ IO æ¨¡å‹ä¸­ï¼Œåªéœ€è¦ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥ç®¡ç†å¤šä¸ªsocketï¼Œç³»ç»Ÿä¸éœ€è¦å»ºç«‹æ–°çš„è¿›ç¨‹æˆ–è€…çº¿ç¨‹ï¼Œä¹Ÿä¸å¿…ç»´æŠ¤è¿™äº›çº¿ç¨‹å’Œè¿›ç¨‹ï¼Œå¹¶ä¸”åªæœ‰åœ¨çœŸæ­£æœ‰socketè¯»å†™äº‹ä»¶è¿›è¡Œæ—¶ï¼Œæ‰ä¼šä½¿ç”¨ IO èµ„æºï¼Œæ‰€ä»¥å®ƒå¤§å¤§å‡å°‘äº†èµ„æºå ç”¨ã€‚åœ¨ Java NIO ä¸­ï¼Œæ˜¯é€šè¿‡ selector.select()å»æŸ¥è¯¢æ¯ä¸ªé€šé“æ˜¯å¦æœ‰åˆ°è¾¾äº‹ä»¶ï¼Œå¦‚æœæ²¡æœ‰äº‹ä»¶ï¼Œåˆ™ä¸€ç›´é˜»å¡åœ¨é‚£é‡Œï¼Œå› æ­¤è¿™ç§æ–¹å¼ä¼šå¯¼è‡´ç”¨æˆ·çº¿ç¨‹çš„é˜»å¡ã€‚å¤šè·¯å¤ç”¨ IO æ¨¡å¼ï¼Œé€šè¿‡ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥ç®¡ç†å¤šä¸ª socketï¼Œåªæœ‰å½“socket çœŸæ­£æœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿæ‰ä¼šå ç”¨èµ„æºæ¥è¿›è¡Œå®é™…çš„è¯»å†™æ“ä½œã€‚å› æ­¤ï¼Œå¤šè·¯å¤ç”¨ IO æ¯”è¾ƒé€‚åˆè¿æ¥æ•°æ¯”è¾ƒå¤šçš„æƒ…å†µã€‚ å¦å¤–å¤šè·¯å¤ç”¨ IO ä¸ºä½•æ¯”éé˜»å¡ IO æ¨¡å‹çš„æ•ˆç‡é«˜æ˜¯å› ä¸ºåœ¨éé˜»å¡ IO ä¸­ï¼Œä¸æ–­åœ°è¯¢é—® socket çŠ¶æ€æ—¶é€šè¿‡ç”¨æˆ·çº¿ç¨‹å»è¿›è¡Œçš„ï¼Œè€Œåœ¨å¤šè·¯å¤ç”¨ IO ä¸­ï¼Œè½®è¯¢æ¯ä¸ª socket çŠ¶æ€æ˜¯å†…æ ¸åœ¨è¿›è¡Œçš„ï¼Œè¿™ä¸ªæ•ˆç‡è¦æ¯”ç”¨æˆ·çº¿ç¨‹è¦é«˜çš„å¤šã€‚ ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œå¤šè·¯å¤ç”¨ IO æ¨¡å‹æ˜¯é€šè¿‡è½®è¯¢çš„æ–¹å¼æ¥æ£€æµ‹æ˜¯å¦æœ‰äº‹ä»¶åˆ°è¾¾ï¼Œå¹¶ä¸”å¯¹åˆ°è¾¾çš„äº‹ä»¶é€ä¸€è¿›è¡Œå“åº”ã€‚å› æ­¤å¯¹äºå¤šè·¯å¤ç”¨ IO æ¨¡å‹æ¥è¯´ï¼Œä¸€æ—¦äº‹ä»¶å“åº”ä½“å¾ˆå¤§ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´åç»­çš„äº‹ä»¶è¿Ÿè¿Ÿå¾—ä¸åˆ°å¤„ç†ï¼Œå¹¶ä¸”ä¼šå½±å“æ–°çš„äº‹ä»¶è½®è¯¢ã€‚ 4 ä¿¡å·é©±åŠ¨ IO æ¨¡å‹åœ¨ä¿¡å·é©±åŠ¨ IO æ¨¡å‹ä¸­ï¼Œå½“ç”¨æˆ·çº¿ç¨‹å‘èµ·ä¸€ä¸ª IO è¯·æ±‚æ“ä½œï¼Œä¼šç»™å¯¹åº”çš„ socket æ³¨å†Œä¸€ä¸ªä¿¡å·å‡½æ•°ï¼Œç„¶åç”¨æˆ·çº¿ç¨‹ä¼šç»§ç»­æ‰§è¡Œï¼Œå½“å†…æ ¸æ•°æ®å°±ç»ªæ—¶ä¼šå‘é€ä¸€ä¸ªä¿¡å·ç»™ç”¨æˆ·çº¿ç¨‹ï¼Œç”¨æˆ·çº¿ç¨‹æ¥æ”¶åˆ°ä¿¡å·ä¹‹åï¼Œä¾¿åœ¨ä¿¡å·å‡½æ•°ä¸­è°ƒç”¨ IO è¯»å†™æ“ä½œæ¥è¿›è¡Œå®é™…çš„ IO è¯·æ±‚æ“ä½œã€‚ 5 å¼‚æ­¥ IO æ¨¡å‹å¼‚æ­¥ IO æ¨¡å‹æ‰æ˜¯æœ€ç†æƒ³çš„ IO æ¨¡å‹ï¼Œåœ¨å¼‚æ­¥ IO æ¨¡å‹ä¸­ï¼Œå½“ç”¨æˆ·çº¿ç¨‹å‘èµ· read æ“ä½œä¹‹åï¼Œç«‹åˆ»å°±å¯ä»¥å¼€å§‹å»åšå…¶å®ƒçš„äº‹ã€‚è€Œå¦ä¸€æ–¹é¢ï¼Œä»å†…æ ¸çš„è§’åº¦ï¼Œå½“å®ƒå—åˆ°ä¸€ä¸ª asynchronous read ä¹‹åï¼Œå®ƒä¼šç«‹åˆ»è¿”å›ï¼Œè¯´æ˜ read è¯·æ±‚å·²ç»æˆåŠŸå‘èµ·äº†ï¼Œå› æ­¤ä¸ä¼šå¯¹ç”¨æˆ·çº¿ç¨‹äº§ç”Ÿä»»ä½• blockã€‚ç„¶åï¼Œå†…æ ¸ä¼šç­‰å¾…æ•°æ®å‡†å¤‡å®Œæˆï¼Œç„¶åå°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·çº¿ç¨‹ï¼Œå½“è¿™ä¸€åˆ‡éƒ½å®Œæˆä¹‹åï¼Œå†…æ ¸ä¼šç»™ç”¨æˆ·çº¿ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ï¼Œå‘Šè¯‰å®ƒ read æ“ä½œå®Œæˆäº†ã€‚ä¹Ÿå°±è¯´ç”¨æˆ·çº¿ç¨‹å®Œå…¨ä¸éœ€è¦å®é™…çš„æ•´ä¸ª IO æ“ä½œæ˜¯å¦‚ä½•è¿›è¡Œçš„ï¼Œåªéœ€è¦å…ˆå‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œå½“æ¥æ”¶å†…æ ¸è¿”å›çš„æˆåŠŸä¿¡å·æ—¶è¡¨ç¤º IO æ“ä½œå·²ç»å®Œæˆï¼Œå¯ä»¥ç›´æ¥å»ä½¿ç”¨æ•°æ®äº†ã€‚ ä¹Ÿå°±è¯´åœ¨å¼‚æ­¥ IO æ¨¡å‹ä¸­ï¼ŒIO æ“ä½œçš„ä¸¤ä¸ªé˜¶æ®µéƒ½ä¸ä¼šé˜»å¡ç”¨æˆ·çº¿ç¨‹ï¼Œè¿™ä¸¤ä¸ªé˜¶æ®µéƒ½æ˜¯ç”±å†…æ ¸è‡ªåŠ¨å®Œæˆï¼Œç„¶åå‘é€ä¸€ä¸ªä¿¡å·å‘ŠçŸ¥ç”¨æˆ·çº¿ç¨‹æ“ä½œå·²å®Œæˆã€‚ç”¨æˆ·çº¿ç¨‹ä¸­ä¸éœ€è¦å†æ¬¡è°ƒç”¨ IO å‡½æ•°è¿›è¡Œå…·ä½“çš„è¯»å†™ã€‚è¿™ç‚¹æ˜¯å’Œä¿¡å·é©±åŠ¨æ¨¡å‹æœ‰æ‰€ä¸åŒçš„ï¼Œåœ¨ä¿¡å·é©±åŠ¨æ¨¡å‹ä¸­ï¼Œå½“ç”¨æˆ·çº¿ç¨‹æ¥æ”¶åˆ°ä¿¡å·è¡¨ç¤ºæ•°æ®å·²ç»å°±ç»ªï¼Œç„¶åéœ€è¦ç”¨æˆ·çº¿ç¨‹è°ƒç”¨ IO å‡½æ•°è¿›è¡Œå®é™…çš„è¯»å†™æ“ä½œï¼›è€Œåœ¨å¼‚æ­¥ IO æ¨¡å‹ä¸­ï¼Œæ”¶åˆ°ä¿¡å·è¡¨ç¤º IO æ“ä½œå·²ç»å®Œæˆï¼Œä¸éœ€è¦å†åœ¨ç”¨æˆ·çº¿ç¨‹ä¸­è°ƒç”¨ IO å‡½æ•°è¿›è¡Œå®é™…çš„è¯»å†™æ“ä½œã€‚","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://www.codetool.top/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"},{"name":"IO","slug":"IO","permalink":"https://www.codetool.top/tags/IO/"},{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://www.codetool.top/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"}]},{"title":"leetcode295-æ•°æ®æµçš„ä¸­ä½æ•°","slug":"leetcode295-æ•°æ®æµçš„ä¸­ä½æ•°","date":"2020-02-12T13:24:01.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode295-æ•°æ®æµçš„ä¸­ä½æ•°/","link":"","permalink":"https://www.codetool.top/article/leetcode295-%E6%95%B0%E6%8D%AE%E6%B5%81%E7%9A%84%E4%B8%AD%E4%BD%8D%E6%95%B0/","excerpt":"","text":"1 åŸé¢˜ä¸­ä½æ•°æ˜¯æœ‰åºåˆ—è¡¨ä¸­é—´çš„æ•°ã€‚å¦‚æœåˆ—è¡¨é•¿åº¦æ˜¯å¶æ•°ï¼Œä¸­ä½æ•°åˆ™æ˜¯ä¸­é—´ä¸¤ä¸ªæ•°çš„å¹³å‡å€¼ã€‚ ä¾‹å¦‚ï¼Œ [2,3,4] çš„ä¸­ä½æ•°æ˜¯ 3 [2,3] çš„ä¸­ä½æ•°æ˜¯ (2 + 3) / 2 = 2.5 è®¾è®¡ä¸€ä¸ªæ”¯æŒä»¥ä¸‹ä¸¤ç§æ“ä½œçš„æ•°æ®ç»“æ„ï¼š void addNum(int num) - ä»æ•°æ®æµä¸­æ·»åŠ ä¸€ä¸ªæ•´æ•°åˆ°æ•°æ®ç»“æ„ä¸­ã€‚ double findMedian() - è¿”å›ç›®å‰æ‰€æœ‰å…ƒç´ çš„ä¸­ä½æ•°ã€‚ ç¤ºä¾‹ï¼š addNum(1)addNum(2)findMedian() -&gt; 1.5addNum(3)findMedian() -&gt; 2 è¿›é˜¶: å¦‚æœæ•°æ®æµä¸­æ‰€æœ‰æ•´æ•°éƒ½åœ¨ 0 åˆ° 100 èŒƒå›´å†…ï¼Œä½ å°†å¦‚ä½•ä¼˜åŒ–ä½ çš„ç®—æ³•ï¼Ÿ å¦‚æœæ•°æ®æµä¸­ 99% çš„æ•´æ•°éƒ½åœ¨ 0 åˆ° 100 èŒƒå›´å†…ï¼Œä½ å°†å¦‚ä½•ä¼˜åŒ–ä½ çš„ç®—æ³•ï¼Ÿ 2 è§£æ³•2.1 æ€æƒ³æ±‚ä¸­ä½æ ‘å¯ä»¥ç»´æŠ¤ä¸¤ä¸ªå †ï¼Œä¸€ä¸ªå¤§é¡¶å †ç”¨äºå­˜æ”¾æ•°æ®è¾ƒå°çš„åŠéƒ¨åˆ†ï¼Œä¸€ä¸ªå°é¡¶å †ç”¨äºå­˜æ”¾æ•°æ®è¾ƒå¤§çš„åŠéƒ¨åˆ†ã€‚ 2.2 ä»£ç public class MedianFinder { private int count; private PriorityQueue&lt;Integer> maxheap; private PriorityQueue&lt;Integer> minheap; /** * initialize your data structure here. */ public MedianFinder() { count = 0; maxheap = new PriorityQueue&lt;>((x, y) -> y - x); minheap = new PriorityQueue&lt;>(); } public void addNum(int num) { count += 1; maxheap.offer(num); minheap.add(maxheap.poll()); if (count%2 != 0) { maxheap.add(minheap.poll()); } } public double findMedian() { if (count%2 != 0) return (double) maxheap.peek(); else return (double) (maxheap.peek() + minheap.peek()) / 2; } } /** * Your MedianFinder object will be instantiated and called as such: * MedianFinder obj = new MedianFinder(); * obj.addNum(num); * double param_2 = obj.findMedian(); */","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"HashMapæºç åˆ†æ","slug":"HashMapæºç åˆ†æ","date":"2020-02-11T19:13:50.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/HashMapæºç åˆ†æ/","link":"","permalink":"https://www.codetool.top/article/HashMap%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","excerpt":"","text":"HashMapæ˜¯javaä¸­éå¸¸å¸¸è§çš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œåœ¨è¿™ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘ä¾ç„¶ä»¥Mapä¸­çš„æ“ä½œä¸ºå¯¼å‘æ¥å¾ªåºæ¸è¿›ç ”ç©¶HashMapä¸­çš„æºç ï¼Œé˜…è¯»è¿™ç¯‡æ–‡ç« éœ€è¦çš„å‰ç½®çŸ¥è¯†æœ‰ï¼š å¼±å¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘-çº¢é»‘æ ‘ å¤§æ¦‚äº†è§£HashMapçš„ä½¿ç”¨æ–¹æ³•ä»¥åŠå†…éƒ¨ç»“æ„ è¯¥æ–‡åŸºäºJDK1.8 1 æ€»ç»“æ€»ç»“æ”¾å‰é¢é˜²æ­¢å¤ªé•¿ä¸çœ‹ HashMapé€šè¿‡æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘å®ç°ï¼Œéå†è§„åˆ™æ˜¯åœ¨æ•°ç»„ä¸ŠæŒ‰æ§½çš„é¡ºåºï¼Œåœ¨æ§½å†…æŒ‰èŠ‚ç‚¹nextçš„é¡ºåºã€‚ æ¡¶çš„ä¸‹æ ‡å’Œå“ˆå¸Œå€¼çš„å¯¹åº”å…³ç³»ä¸ºï¼šindex = (n - 1) &amp; hashï¼Œnä¸ºæ•°ç»„çš„å¤§å°ï¼Œå‡ºäºå¹³è¡¡æ€§è€ƒè™‘nå¿…é¡»æ˜¯2çš„æ•´æ•°æ¬¡å¹‚ å¦‚æœä¸€ä¸ªæ¡¶ä¸­å…ƒç´ çš„æ•°é‡å¤§äº8çš„æ—¶å€™ï¼Œé“¾è¡¨è½¬çº¢é»‘æ ‘ï¼ˆä½†æ˜¯å®é™…å¦‚æœæ­¤æ—¶æ•°ç»„å¤§å°å°äº64ï¼Œåˆ™æ‰©å®¹é‡å»ºHashè¡¨è€Œä¸æ˜¯æ ‘åŒ–ï¼‰ ä¸€äº›æŒ‡æ ‡å«ä¹‰ï¼š åç§° å«ä¹‰ threshold é”®å€¼å¯¹çš„æ•°é‡ä¸€æ—¦è¶…è¿‡è¿™ä¸ªå€¼å°±éœ€è¦è¿›è¡Œæ•°ç»„æ‰©å®¹å¹¶é‡å»ºå“ˆå¸Œè¡¨ loadFactor thresholdé€šå¸¸æ˜¯é€šè¿‡æ•°ç»„çš„å¤§å°*loadFactorè¿›è¡Œè®¡ç®— ä¸€äº›æŒ‡æ ‡çš„å€¼ï¼š åç§° è§£é‡Š DEFAULT_INITIAL_CAPACITY åˆå§‹åŒ–æ•°ç»„çš„å¤§å°ï¼Œé»˜è®¤ä¸º16 MAXIMUM_CAPACITY æ•°ç»„æœ€å¤§å¤§å°ï¼Œæ˜¯æœ€æ¥è¿‘intä¸Šé™çš„2çš„æ•´æ•°æ¬¡å¹‚1 &lt;&lt; 30 DEFAULT_LOAD_FACTOR è´Ÿè½½å› å­ï¼Œé»˜è®¤ä¸º0.75fï¼ŒåŸå› è§æœ€å TREEIFY_THRESHOLD ä¸€æ—¦æ¡¶ä¸­çš„å…ƒç´ è¾¾åˆ°è¿™ä¸ªå€¼ï¼Œæ•°ç»„å‡çº¢é»‘æ ‘ï¼Œ8 UNTREEIFY_THRESHOLD ä¸€æ—¦æ¡¶ä¸­çš„å…ƒç´ å°äºè¿™ä¸ªå€¼ï¼Œä¸‹æ¬¡resizeçš„æ—¶å€™ä¼šé‡æ–°é™ä¸ºé“¾è¡¨ï¼Œ6 MIN_TREEIFY_CAPACITY åªè¦æ•°ç»„å®¹é‡å°äºè¿™ä¸ªå€¼ï¼Œä¸ä¼šè¿›è¡Œé“¾è¡¨å‡çº¢é»‘æ ‘ï¼Œé€šè¿‡resizeæ‰©å®¹æ¥è§£å†³é—®é¢˜ï¼Œ64 å‘ç”Ÿresize()çš„æ‰€æœ‰æƒ…å†µï¼š æ„é€ å®ŒHashMapä¹‹åç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ ï¼Œæ­¤æ—¶è°ƒç”¨resize()ä¸ºæ•°ç»„åˆ†é…åˆå§‹ç©ºé—´ æ·»åŠ å®Œå…ƒç´ ä¹‹åé”®å€¼å¯¹çš„æ•°é‡å¤§äºthresholdï¼Œå‘ç”Ÿresize()è¿›è¡Œæ‰©å®¹ å½“æƒ³è¦é“¾è¡¨å‡çº¢é»‘æ ‘å…ƒç´ çš„æ—¶å€™ï¼Œæ•°ç»„å®¹é‡å°äº64ï¼Œåˆ™é€šè¿‡resize()å–ä»£æ ‘åŒ–ã€‚ EntrySetå’ŒKeySetéƒ½ä¸ä¼šå»ºç«‹æ–°çš„é›†åˆï¼Œåªæ˜¯åœ¨mapçš„åŸºç¡€ä¸Šåšä¸€äº›æ“ä½œï¼Œä¸åŒçš„æ˜¯entryè·å–çš„æ˜¯æ•´ä¸ªNodeï¼Œè€Œkeyåªæœ‰keyã€‚ 2 é‡è¦æ–¹æ³•æˆ‘ä»¬çŸ¥é“HashMapæ˜¯Mapçš„é‡è¦å®ç°ï¼ŒMapæ¥å£çš„é‡è¦æ–¹æ³•æœ‰ï¼š put(),get(),getOrDefault(),putIfAbsent(),containsKey() replace() remove() entrySet() keySet() ä¸‹é¢å°±è®©æˆ‘ä»¬å¼€å§‹è·Ÿè¸ªè¿™äº›æ–¹æ³•çš„æºç ï¼š 2.1 putpublic V put(K key, V value) { return putVal(hash(key), key, value, false, true); } putå’Œgetæ–¹æ³•æ˜¯Mapæœ€å¸¸ç”¨çš„æ–¹æ³•äº†ï¼Œç†Ÿæ‚‰å“ˆå¸Œè¡¨ç»“æ„çš„éƒ½çŸ¥é“ï¼ŒHashMapçš„åº•å±‚å°±æ˜¯æŠŠå“ˆå¸Œå€¼å’Œå¯¹è±¡å…³è”èµ·æ¥ï¼Œä½†æ˜¯å› ä¸ºå“ˆå¸Œå€¼å¹¶ä¸å”¯ä¸€ï¼Œå¯èƒ½ä¼šå‡ºç°å“ˆå¸Œå†²çªï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªä½ç½®å¯èƒ½éœ€è¦å­˜æ”¾å¤šä¸ªå¯¹è±¡ï¼Œå¦‚æœè§£å†³Hashå†²çªæ˜¯åˆ¶çº¦æŸ¥æ‰¾æ•ˆç‡éå¸¸é‡è¦çš„é—®é¢˜ã€‚ åœ¨è¿™ä¸ªæ–¹æ³•é‡Œï¼Œæˆ‘ä»¬å¤§æ¦‚èƒ½çŒœåˆ°ï¼Œhash()æ˜¯è·å–å“ˆå¸Œå€¼çš„å‡½æ•°ï¼Œå…ˆæ¥çœ‹çœ‹å“ˆå¸Œå€¼æ€ä¹ˆè·å–çš„ï¼š 2.1.1 hashstatic final int hash(Object key) { int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16); } å®é™…ä¸Šå°±æ˜¯é»˜è®¤Objectçš„hashcodeä½æˆ–è‡ªå·±çš„é«˜16ä½ï¼Œè‡³äºObjectçš„hashcodeæ€ä¹ˆæ¥çš„ï¼Œå°±æ¶‰åŠåˆ°JNIå±‚é¢çš„ç†è®ºäº†ï¼Œç½‘ä¸Šæœ‰è¯´æ˜¯å¯¹è±¡åœ°å€è½¬æ¢è€Œæ¥çš„ï¼Œæˆ‘ä¹Ÿæœ‰å°è¯•è·Ÿè¸ªOpenJdkä¸­c++çš„æºç ï¼Œæœ€åå®åœ¨çœ‹ä¸æ‡‚æ”¾å¼ƒäº†QAQã€‚ä¸è¿‡java docä¸Šé¢è¯´hashcodeä¸è¦æ±‚å”¯ä¸€ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åŒçš„å¯¹è±¡å¯ä»¥è®¡ç®—å‡ºåŒä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œæˆ‘ä»¬å°±å§‘ä¸”å¿½ç•¥å®ƒçš„å…·ä½“è®¡ç®—è¿‡ç¨‹ï¼Œçœ‹ä¸€ä¸‹putVal()æ–¹æ³•ï¼š 2.1.2 putValè¿™ä¸ªæ–¹æ³•æœ€åä¸¤ä¸ªå¸ƒå°”ç±»å‹å‚æ•°åˆ†åˆ«ä»£è¡¨onlyIfAbsentï¼šå¦‚æœåŸæ¥å­˜åœ¨é”®ï¼Œå°±ä¸æ›¿æ¢å€¼å’Œevict:å¦‚æœæ˜¯falseï¼Œä»£è¡¨è¿™ä¸ªmapæ­£å¤„äºåˆ›å»ºæ¨¡å¼ //onlyIfAbsentå¤§æ¦‚å¯ä»¥è”æƒ³åˆ°å’ŒputIfAbsentæœ‰å…³ final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) { Node&lt;K,V>[] tab; Node&lt;K,V> p; int n, i; //å¦‚æœtableæ˜¯ç©ºçš„æˆ–ä¸å­˜åœ¨ï¼Œè¿™é‡Œå°†tableèµ‹ç»™tabï¼Œå¯ä»¥çŒœæµ‹tableæ˜¯å­˜å‚¨æ‰€æœ‰å“ˆå¸Œæ¡¶çš„æ•°ç»„ã€‚ if ((tab = table) == null || (n = tab.length) == 0) //resizeï¼Œç»™ä¸€ä¸ªåˆå§‹å®¹é‡ï¼Œnè¢«èµ‹äºˆå®¹é‡å¤§å° n = (tab = resize()).length; //å…ˆè·å–åŸæ¥çš„æ¡¶pï¼Œå¦‚æœhashä¸å†²çªï¼Œç›´æ¥æ’å…¥èŠ‚ç‚¹ if ((p = tab[i = (n - 1) &amp; hash]) == null) tab[i] = newNode(hash, key, value, null); //hashå†²çª else { Node&lt;K,V> e; K k; //è™½ç„¶å“ˆå¸Œå†²çªï¼Œä½†é”®æ˜¯ä¸€æ ·çš„ if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; //å¦‚æœå·²ç»æ˜¯ä¸€æ£µçº¢é»‘æ ‘ else if (p instanceof TreeNode) e = ((TreeNode&lt;K,V>)p).putTreeVal(this, tab, hash, key, value); //æ˜¯é“¾è¡¨ else { for (int binCount = 0; ; ++binCount) { if ((e = p.next) == null) { p.next = newNode(hash, key, value, null); //å¦‚æœbinCountå¤§äºTREEIFY_THRESHOLD - 1ï¼Œåˆ™æ ‘åŒ–ï¼Œå¯ä»¥çŒœæµ‹è½¬çº¢é»‘æ ‘ if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st treeifyBin(tab, hash); break; } //é‡åˆ°äº†ç›¸åŒçš„é”®ï¼Œé€€å‡ºå¾ªç¯ if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; } } if (e != null) { // existing mapping for key V oldValue = e.value; //å¦‚æœonlyIfAbsentä¸ä¸ºtrueæˆ–åŸæ¥çš„valueä¸ºnullï¼Œæ›¿æ¢value if (!onlyIfAbsent || oldValue == null) e.value = value; //æ²¡æœ‰å®ç°ï¼Œä»…åœ¨LinkedHashMapä¸­æœ‰ç”¨åˆ° afterNodeAccess(e); return oldValue; } } ++modCount; //å¤§äºthresholdåˆ™æ‰©å®¹ if (++size > threshold) resize(); //æ²¡æœ‰å®ç°ï¼Œä»…åœ¨LinkedHashMapä¸­æœ‰ç”¨åˆ° afterNodeInsertion(evict); return null; } è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„æ–¹æ³•ï¼Œé€šè¿‡æºç è·Ÿè¸ªå¯ä»¥æ€»ç»“å‡ºï¼š HashMapå†…éƒ¨æ˜¯ç”¨Node[]æ¥å­˜å‚¨æ•°æ®çš„ï¼Œä¸€ä¸ªå“ˆå¸Œå€¼ä¸ºhashçš„å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ä¸º(n - 1) &amp; hashï¼ˆnæ˜¯æ•°ç»„çš„é•¿åº¦ï¼‰ å¦‚æœbinCountå¤§äºTREEIFY_THRESHOLD - 1(static final int TREEIFY_THRESHOLD = 8)ï¼Œåˆ™æ ‘åŒ–ï¼Œå¯ä»¥çŒœæµ‹è½¬çº¢é»‘æ ‘ï¼ˆä½†æ˜¯å®é™…å¦‚æœæ­¤æ—¶æ•°ç»„å¤§å°å°äº64ï¼Œåˆ™æ‰©å®¹é‡å»ºHashè¡¨è€Œä¸æ˜¯æ ‘åŒ–ï¼‰ thresholdæ˜¯sizeçš„ä¸Šé™ï¼Œå¦‚æœsizeè¶…è¿‡thresholdï¼Œåˆ™è°ƒç”¨resize()æ‰©å®¹ åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†Node,TreeNodeï¼Œå¯ä»¥æ¨æµ‹Nodeæ˜¯é“¾è¡¨çš„èŠ‚ç‚¹ï¼Œè€ŒTreeNodeç»§æ‰¿è‡ªNodeï¼Œä»£è¡¨çº¢é»‘æ ‘çš„èŠ‚ç‚¹ 2.1.3 å†…éƒ¨ç±»ï¼šNodestatic class Node&lt;K,V> implements Map.Entry&lt;K,V> { final int hash; final K key; V value; Node&lt;K,V> next; //... } 2.1.4 å†…éƒ¨ç±»ï¼šTreeNodestatic final class TreeNode&lt;K,V> extends LinkedHashMap.Entry&lt;K,V> { TreeNode&lt;K,V> parent; // red-black tree links TreeNode&lt;K,V> left; TreeNode&lt;K,V> right; TreeNode&lt;K,V> prev; // needed to unlink next upon deletion boolean red;//ä»£è¡¨èŠ‚ç‚¹é¢œè‰² //... } åœ¨è¿™ä¸ªç±»ä¸­å®ç°äº†è®¸å¤šçº¢é»‘æ ‘çš„æ“ä½œï¼Œè¿™é‡Œå°±ä¸çœ‹å®ƒä»¬çš„å®ç°äº†ã€‚ 2.1.5 putIfAbsentä¹‹å‰æˆ‘ä»¬æ¨æµ‹putIfAbsentå’ŒputValä¸­çš„å‚æ•°onlyIfAbsentæœ‰å…³ï¼Œç°åœ¨æˆ‘ä»¬çœ‹çœ‹æºç ï¼Œç¡®å®šä¸€ä¸‹ï¼š public V putIfAbsent(K key, V value) { return putVal(hash(key), key, value, true, true); } å¯ä»¥çœ‹å‡ºï¼Œæ¨æµ‹å®Œå…¨æ­£ç¡®ï¼Œå°±æ˜¯æŠŠå‚æ•°onlyIfAbsentè®¾ä¸ºäº†trueï¼Œè¿™æ ·å³ä½¿æŠŠèŠ‚ç‚¹å–å‡ºæ¥äº†ä½†å¹¶ä¸ä¼šæ›¿æ¢æ‰å®ƒçš„valueã€‚ 2.2 getçœ‹å®Œäº†putæˆ‘ä»¬æ¥çœ‹getï¼Œè¿›ä¸€æ­¥å·©å›ºæˆ‘ä»¬å¯¹HashMapç»“æ„çš„è®¤çŸ¥ï¼š public V get(Object key) { Node&lt;K,V> e; //å¯ä»¥çŒœæµ‹getNodeèƒ½é€šè¿‡hashå€¼å’Œé”®æŸ¥æ‰¾åˆ°å…ƒç´ èŠ‚ç‚¹ï¼Œå¯èƒ½æ˜¯é“¾è¡¨èŠ‚ç‚¹ï¼Œä¹Ÿå¯èƒ½æ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ return (e = getNode(hash(key), key)) == null ? null : e.value; } 2.2.1 getNodefinal Node&lt;K,V> getNode(int hash, Object key) { Node&lt;K,V>[] tab; Node&lt;K,V> first, e; int n; K k; //é€šè¿‡å“ˆå¸Œä¸‹æ ‡è®¡ç®—å…¬å¼è·å–æ•°ç»„å“ˆå¸Œä¸­å¯¹åº”çš„èŠ‚ç‚¹ if ((tab = table) != null &amp;&amp; (n = tab.length) > 0 &amp;&amp; (first = tab[(n - 1) &amp; hash]) != null) { // çœ‹çœ‹é¦–èŠ‚ç‚¹æ˜¯ä¸æ˜¯è¦æ‰¾çš„èŠ‚ç‚¹ if (first.hash == hash &amp;&amp; // always check first node ((k = first.key) == key || (key != null &amp;&amp; key.equals(k)))) return first; if ((e = first.next) != null) { //çº¢é»‘æ ‘çš„æƒ…å†µ if (first instanceof TreeNode) //çº¢é»‘æ ‘æŸ¥æ‰¾ç»“ç‚¹è°ƒç”¨è¯¥ç±»ä¸­çš„getTreeNodeæ–¹æ³• return ((TreeNode&lt;K,V>)first).getTreeNode(hash, key); //é“¾è¡¨çš„æƒ…å†µ do { if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; } while ((e = e.next) != null); } } return null; } æ— è®ºæ˜¯çº¢é»‘æ ‘çš„æƒ…å†µï¼ˆæœç´¢äºŒå‰æ ‘çš„æŸ¥æ‰¾ï¼‰è¿˜æ˜¯é“¾è¡¨çš„æƒ…å†µæŸ¥æ‰¾çš„å®ç°éƒ½æŒºç®€å•çš„ï¼Œè¿™é‡Œå°±ä¸æ·±æŒ–äº†ã€‚ 2.2.2 getOrDefaultè‡³äºgetOrDefaultæ˜¯æ€ä¹ˆå®ç°çš„ï¼Œç”±äºgetNodeæ–¹æ³•å¦‚æœæ²¡æ‰¾åˆ°èŠ‚ç‚¹ä¼šè¿”å›nullï¼Œæˆ‘ä»¬å¯ä»¥æ¨æµ‹getOrDefaultå…ˆè°ƒç”¨getNodeæ–¹æ³•ï¼Œå¦‚æœè¿”å›äº†nullï¼Œåˆ™æŠŠç”¨æˆ·ç»™çš„é»˜è®¤å€¼è¿”å›å›å»ã€‚ public V getOrDefault(Object key, V defaultValue) { Node&lt;K,V> e; return (e = getNode(hash(key), key)) == null ? defaultValue : e.value; } 2.2.3 containsKeycontainsKeyçš„åˆ¤æ–­ä¾æ®ä¹Ÿæ˜¯è°ƒç”¨getNodeï¼Œå¦‚æœè¿”å›nullè¯´æ˜æ²¡æœ‰æŸ¥æ‰¾åˆ°å¯¹åº”èŠ‚ç‚¹ï¼Œå³ä¸åŒ…å«è¿™ä¸ªé”®ã€‚ public boolean containsKey(Object key) { return getNode(hash(key), key) != null; } 2.3 replacereplaceå…¶å®è¾ƒä¸ºä¸å¸¸ç”¨ï¼Œå› ä¸ºputæ–¹æ³•å°±èƒ½æ›´æ–°èŠ‚ç‚¹çš„å€¼ï¼Œä»–ä»¬çš„åŒºåˆ«ä¸»è¦æœ‰ï¼š replaceè¿˜æœ‰ä¸€ä¸ªé‡è½½æ–¹æ³•ï¼Œä»…å½“æ—§å€¼ç¬¦åˆç”¨æˆ·ä¼ å…¥çš„å‚æ•°æ—¶æ‰æ›´æ–° é‚£ä¹ˆå®ƒä»¬å®ç°æ›´æ–°çš„æ–¹æ³•æ˜¯ä¸€æ ·çš„å—ï¼Ÿ public V replace(K key, V value) { Node&lt;K,V> e; if ((e = getNode(hash(key), key)) != null) { V oldValue = e.value; e.value = value; afterNodeAccess(e); return oldValue; } return null; } å¯ä»¥çœ‹å‡ºå› ä¸ºreplaceæ˜¯å·²ç»ç¡®å®šäº†å­˜åœ¨è¿™ä¸ªå…ƒç´ ï¼Œç›´æ¥è°ƒç”¨getNodeå»è·å–åŸæ¥çš„èŠ‚ç‚¹ï¼Œå¹¶æ›´æ–°å®ƒçš„å€¼ã€‚ä½†æ˜¯æŸ¥æ‰¾çš„è¿‡ç¨‹æœ¬è´¨å…¶å®å’Œputä¸€æ ·çš„ã€‚ é‚£ä¹ˆreplaceè¿˜æœ‰ä¸€ä¸ªé‡è½½æ–¹æ³•ï¼š public boolean replace(K key, V oldValue, V newValue) { Node&lt;K,V> e; V v; if ((e = getNode(hash(key), key)) != null &amp;&amp; ((v = e.value) == oldValue || (v != null &amp;&amp; v.equals(oldValue)))) { e.value = newValue; afterNodeAccess(e); return true; } return false; } å¯ä»¥çœ‹å‡ºï¼Œä»…å½“åŸæ¥èŠ‚ç‚¹çš„å€¼ç¬¦åˆç”¨æˆ·çš„è¾“å…¥å‚æ•°æ—¶æ‰æ›´æ–°ã€‚ 2.4 removeremoveæ–¹æ³•ç”¨äºä»Mapä¸­ç§»é™¤å…ƒç´ ï¼Œå¯¹åº”çš„æ— éä¹Ÿå°±æ˜¯é“¾è¡¨å…ƒç´ çš„åˆ é™¤æˆ–æ˜¯çº¢é»‘æ ‘å…ƒç´ çš„åˆ é™¤ï¼Œé“¾è¡¨å…ƒç´ çš„åˆ é™¤åªéœ€è¦æ›´æ–°æŒ‡é’ˆï¼Œçº¢é»‘æ ‘å…ƒç´ çš„åˆ é™¤å´å¯èƒ½éœ€è¦é‡æ–°ä¸Šè‰²å’Œæ—‹è½¬ç­‰ä¸€ç³»åˆ—ç¹ççš„åŠ¨ä½œï¼Œä¸éš¾æƒ³åˆ°ï¼Œå¦‚æœçº¢é»‘æ ‘çš„å…ƒç´ åˆ åˆ°ä¸€å®šæ•°é‡ä»¥ä¸‹æ—¶ï¼Œå¯èƒ½ä¼šé€€åŒ–å›é“¾è¡¨ã€‚ çœ‹æºç ï¼š public V remove(Object key) { Node&lt;K,V> e; return (e = removeNode(hash(key), key, null, false, true)) == null ? null : e.value; } è¿™é‡Œæ¶‰åŠåˆ°å‡½æ•°removeNodeï¼Œè·Ÿè¸ªè¿›å»ï¼š //åé¢ä¸¤ä¸ªå¸ƒå°”å€¼åˆ†åˆ«ä»£è¡¨æ˜¯å¦è¦æ±‚å€¼åŒ¹é…ï¼Œmovableå¦‚æœæ˜¯falseä¸å…è®¸ç§»åŠ¨å…¶ä»–èŠ‚ç‚¹ final Node&lt;K,V> removeNode(int hash, Object key, Object value, boolean matchValue, boolean movable) { Node&lt;K,V>[] tab; Node&lt;K,V> p; int n, index; if ((tab = table) != null &amp;&amp; (n = tab.length) > 0 &amp;&amp; (p = tab[index = (n - 1) &amp; hash]) != null) { Node&lt;K,V> node = null, e; K k; V v; //å¦‚æœé¦–èŠ‚ç‚¹æ˜¯è¦ç§»é™¤çš„èŠ‚ç‚¹ if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) node = p; else if ((e = p.next) != null) { //å¦‚æœæ˜¯çº¢é»‘æ ‘ if (p instanceof TreeNode) //ä½¿ç”¨getTreeNodeå…ˆè·å–çº¢é»‘æ ‘èŠ‚ç‚¹ node = ((TreeNode&lt;K,V>)p).getTreeNode(hash, key); //å¦‚æœæ˜¯é“¾è¡¨ else { do { if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) { // è·å–é“¾è¡¨èŠ‚ç‚¹ node = e; break; } p = e; } while ((e = e.next) != null); } } //å¦‚æœmatchValueä¸ºtrueï¼Œå¿…é¡»è¦æ¯”å¯¹ç”¨æˆ·ç»™çš„æ—§å€¼æ˜¯å¦æ­£ç¡® if (node != null &amp;&amp; (!matchValue || (v = node.value) == value || (value != null &amp;&amp; value.equals(v)))) { //å¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œè°ƒç”¨è¯¥ç±»çš„removeTreeNodeç§»é™¤èŠ‚ç‚¹ if (node instanceof TreeNode) ((TreeNode&lt;K,V>)node).removeTreeNode(this, tab, movable); //å¦‚æœæ˜¯é“¾è¡¨ï¼Œç”¨é“¾è¡¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ›¿æ¢ else if (node == p) tab[index] = node.next; else p.next = node.next; ++modCount; --size; //æ²¡æœ‰å®ç°ï¼Œä»…åœ¨LinkedHashMapä¸­æœ‰ç”¨åˆ° afterNodeRemoval(node); return node; } } return null; } è¿™é‡Œæˆ‘ä»¬æš‚æ—¶æ²¡çœ‹åˆ°æœ‰çº¢é»‘æ ‘é€€åŒ–ä¸ºé“¾è¡¨çš„æ“ä½œï¼Œä¸æ€¥ï¼Œç»§ç»­çœ‹ä¸‹å»ã€‚ï¼ˆå®é™…ä¸Šæ˜¯åœ¨ä¸‹ä¸€æ¬¡resizeçš„æ—¶å€™é€€åŒ–ä¸ºé“¾è¡¨ï¼‰ 2.5 entrySetpublic Set&lt;Map.Entry&lt;K,V>> entrySet() { Set&lt;Map.Entry&lt;K,V>> es; return (es = entrySet) == null ? (entrySet = new EntrySet()) : es; } å¯ä»¥çœ‹å‡ºç›´æ¥è·å¾—å†…éƒ¨çš„entrySetå­—æ®µã€‚æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹EntrySetçš„å®šä¹‰ï¼š //Entryæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæœ‰getKey()ã€getValue()ç­‰æ–¹æ³• final class EntrySet extends AbstractSet&lt;Map.Entry&lt;K,V>> { public final int size() { return size; } public final void clear() { HashMap.this.clear(); } public final Iterator&lt;Map.Entry&lt;K,V>> iterator() { return new EntryIterator(); } public final boolean contains(Object o) { if (!(o instanceof Map.Entry)) return false; Map.Entry&lt;?,?> e = (Map.Entry&lt;?,?>) o; Object key = e.getKey(); Node&lt;K,V> candidate = getNode(hash(key), key); return candidate != null &amp;&amp; candidate.equals(e); } public final boolean remove(Object o) { if (o instanceof Map.Entry) { Map.Entry&lt;?,?> e = (Map.Entry&lt;?,?>) o; Object key = e.getKey(); Object value = e.getValue(); return removeNode(hash(key), key, value, true, true) != null; } return false; } public final Spliterator&lt;Map.Entry&lt;K,V>> spliterator() { return new EntrySpliterator&lt;>(HashMap.this, 0, -1, 0, 0); } public final void forEach(Consumer&lt;? super Map.Entry&lt;K,V>> action) { Node&lt;K,V>[] tab; if (action == null) throw new NullPointerException(); if (size > 0 &amp;&amp; (tab = table) != null) { int mc = modCount; for (int i = 0; i &lt; tab.length; ++i) { for (Node&lt;K,V> e = tab[i]; e != null; e = e.next) action.accept(e); } if (modCount != mc) throw new ConcurrentModificationException(); } } } è¿­ä»£å™¨é€šè¿‡EntryIteratorè·å¾—ï¼š 2.5.1 EntryIteratorfinal class EntryIterator extends HashIterator implements Iterator&lt;Map.Entry&lt;K,V>> { public final Map.Entry&lt;K,V> next() { return nextNode(); } } å®ƒåˆç»§æ‰¿äº†HashIteratorï¼š 2.5.2 HashIteratorabstract class HashIterator { Node&lt;K,V> next; // next entry to return Node&lt;K,V> current; // current entry int expectedModCount; // for fast-fail int index; // å½“å‰slot HashIterator() { expectedModCount = modCount; Node&lt;K,V>[] t = table; current = next = null; //ä»slotä¸º0å¤„å¼€å§‹éå† index = 0; if (t != null &amp;&amp; size > 0) { // æ‰¾åˆ°ç¬¬ä¸€ä¸ªæœ‰èŠ‚ç‚¹çš„slotï¼Œå¹¶æŠŠnextèµ‹å€¼ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ do {} while (index &lt; t.length &amp;&amp; (next = t[index++]) == null); } } public final boolean hasNext() { return next != null; } final Node&lt;K,V> nextNode() { Node&lt;K,V>[] t; Node&lt;K,V> e = next; if (modCount != expectedModCount) throw new ConcurrentModificationException(); if (e == null) throw new NoSuchElementException(); // åœ¨å½“å‰æ§½ä¸­å¯»æ‰¾ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœå½“å‰æ§½å·²ç»æ‰¾å®Œäº†ç»§ç»­å‘åå¯»æ‰¾æœ‰èŠ‚ç‚¹çš„slot if ((next = (current = e).next) == null &amp;&amp; (t = table) != null) { do {} while (index &lt; t.length &amp;&amp; (next = t[index++]) == null); } return e; } public final void remove() { Node&lt;K,V> p = current; if (p == null) throw new IllegalStateException(); if (modCount != expectedModCount) throw new ConcurrentModificationException(); current = null; K key = p.key; removeNode(hash(key), key, null, false, false); expectedModCount = modCount; } } 2.6 keySetpublic Set&lt;K> keySet() { Set&lt;K> ks = keySet; if (ks == null) { ks = new KeySet(); keySet = ks; } return ks; } KeySetçš„å®šä¹‰ï¼š final class KeySet extends AbstractSet&lt;K> { public final int size() { return size; } public final void clear() { HashMap.this.clear(); } //KeyIteratorä¹Ÿæ˜¯ç»§æ‰¿è‡ªHashIteratorï¼Œä½†è¿”å›çš„åªæ˜¯èŠ‚ç‚¹ä¸­çš„é”® public final Iterator&lt;K> iterator() { return new KeyIterator(); } public final boolean contains(Object o) { return containsKey(o); } public final boolean remove(Object key) { return removeNode(hash(key), key, null, false, true) != null; } public final Spliterator&lt;K> spliterator() { return new KeySpliterator&lt;>(HashMap.this, 0, -1, 0, 0); } public final void forEach(Consumer&lt;? super K> action) { Node&lt;K,V>[] tab; if (action == null) throw new NullPointerException(); if (size > 0 &amp;&amp; (tab = table) != null) { int mc = modCount; for (int i = 0; i &lt; tab.length; ++i) { for (Node&lt;K,V> e = tab[i]; e != null; e = e.next) action.accept(e.key); } if (modCount != mc) throw new ConcurrentModificationException(); } } } é€šè¿‡ä¸Šé¢çš„EntrySetå’ŒKeySetæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒEntrySetå’ŒKeySetå¹¶æ²¡æœ‰å½¢æˆä¸€ä¸ªçœŸæ­£çš„é›†åˆï¼Œä»–ä»¬çš„ä¸€äº›Setæ“ä½œåªæ˜¯åœ¨åŸmapçš„åŸºç¡€ä¸Šæ“ä½œã€‚æ¯”å¦‚EntrySetçš„iteratorå®é™…ä¸Šåªæ˜¯ä½¿ç”¨äº†HashIteratorï¼Œnext()è¿”å›çš„æ˜¯ä¸€ä¸ªNodeç±»å‹ï¼Œä½†ç”±äºNodeç±»å‹å®ç°äº†Entryæ¥å£ï¼Œæ‰€ä»¥å¯ä»¥å½“ä½œä¸€ä¸ªEntryç”¨ã€‚KeySetåŸç†ç±»ä¼¼ï¼Œåªæ˜¯ä½¿ç”¨äº†HashIteratorè¿”å›çš„Nodeç±»å‹æå–å‡ºäº†keyã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹ä¸­è¯´æ˜ï¼š ã€æ¨èã€‘ä½¿ç”¨ entrySet éå† Map ç±»é›†åˆ KVï¼Œè€Œä¸æ˜¯ keySet æ–¹å¼è¿›è¡Œéå†ã€‚è¯´æ˜ï¼š keySet å…¶å®æ˜¯éå†äº† 2 æ¬¡ï¼Œä¸€æ¬¡æ˜¯è½¬ä¸º Iterator å¯¹è±¡ï¼Œå¦ä¸€æ¬¡æ˜¯ä» hashMap ä¸­å–å‡ºkey æ‰€å¯¹åº”çš„ valueã€‚è€Œ entrySet åªæ˜¯éå†äº†ä¸€æ¬¡å°±æŠŠ key å’Œ value éƒ½æ”¾åˆ°äº† entry ä¸­ï¼Œæ•ˆç‡æ›´é«˜ã€‚å¦‚æœæ˜¯ JDK8ï¼Œä½¿ç”¨ Map.foreach æ–¹æ³•ã€‚æ­£ä¾‹ï¼š values()è¿”å›çš„æ˜¯ V å€¼é›†åˆï¼Œæ˜¯ä¸€ä¸ª list é›†åˆå¯¹è±¡ï¼›keySet()è¿”å›çš„æ˜¯ K å€¼é›†åˆï¼Œæ˜¯ä¸€ä¸ª Set é›†åˆå¯¹è±¡ï¼›entrySet()è¿”å›çš„æ˜¯ K-V å€¼ç»„åˆé›†åˆã€‚ 3 æ„é€ æ–¹æ³•ä¸æ‰©å®¹3.1 æ„é€ æ–¹æ³•é»˜è®¤æ— å‚æ„é€ æ–¹æ³•ï¼š public HashMap() { this.loadFactor = DEFAULT_LOAD_FACTOR; // all other fields defaulted } static final float DEFAULT_LOAD_FACTOR = 0.75f; çœ‹åˆ°è¿™é‡Œä¼¼ä¹æœ‰ç‚¹å¥‡æ€ªï¼ŒHashMapå†…éƒ¨ä¸æ˜¯æœ‰ä¸ªNodeæ•°ç»„å˜›ï¼è¿™é‡Œæ€ä¹ˆæ²¡æœ‰åˆå§‹åŒ–ï¼Ÿä¸è¿‡å›æƒ³ä¸Šé¢çš„putValæ–¹æ³•ï¼Œä¸€å¼€å§‹å°±åˆ¤æ–­äº†tabæ˜¯ä¸æ˜¯ä¸ºnullï¼Œå¦‚æœæ˜¯çš„è¯æ‰§è¡Œresize()ï¼Œä¼°è®¡è¿™ä¸ªresizeæ–¹æ³•å¯ä»¥åˆå§‹åŒ–ã€‚ é‚£ä¹ˆè¿™ä¸ªDEFAULT_LOAD_FACTORæ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿç›´è¯‘å«åšè´Ÿè½½å› å­ï¼Œçœ‹çœ‹åé¢çš„æ–¹æ³•æœ‰æ²¡æœ‰å‡ºç°ã€‚ public HashMap(int initialCapacity) { this(initialCapacity, DEFAULT_LOAD_FACTOR); } è¿™ä¸ªæŒ‡å®šäº†åˆå§‹å®¹é‡çš„æ„é€ æ–¹æ³•å¸¦ç€é»˜è®¤è´Ÿè½½å› å­æŒ‡å‘äº†å¦ä¸€ä¸ªæ„é€ æ–¹æ³• public HashMap(int initialCapacity, float loadFactor) { if (initialCapacity &lt; 0) throw new IllegalArgumentException(\"Illegal initial capacity: \" + initialCapacity); if (initialCapacity > MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException(\"Illegal load factor: \" + loadFactor); this.loadFactor = loadFactor; //tableSizeForå¯ä»¥è¿”å›å¤§äºä¸”æœ€æ¥è¿‘initialCapacityçš„2çš„æ•´æ•°æ¬¡å¹‚ this.threshold = tableSizeFor(initialCapacity); } //å…¶ä¸­ static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30; ä¸ºä»€ä¹ˆæœ€å¤§å®¹é‡æ˜¯MAXIMUM_CAPACITYï¼Ÿ HashMapåœ¨ç¡®å®šæ•°ç»„ä¸‹æ ‡Indexçš„æ—¶å€™ï¼Œé‡‡ç”¨çš„æ˜¯(length-1) &amp; hashçš„æ–¹å¼ï¼Œåªæœ‰å½“lengthä¸º2çš„æŒ‡æ•°å¹‚çš„æ—¶å€™æ‰èƒ½è¾ƒå‡åŒ€çš„åˆ†å¸ƒå…ƒç´ ã€‚æ‰€ä»¥HashMapè§„å®šäº†å…¶å®¹é‡å¿…é¡»æ˜¯2çš„næ¬¡æ–¹ ç”±äºHashMapè§„å®šäº†å…¶å®¹é‡æ˜¯2çš„næ¬¡æ–¹ï¼Œå¯¹äºHashMapæ¥è¯´å…¶æœ€å¤§çš„å®¹é‡åº”è¯¥æ˜¯ä¸è¶…è¿‡intæœ€å¤§å€¼çš„ä¸€ä¸ª2çš„æŒ‡æ•°å¹‚ï¼Œå³1 &lt;&lt; 30 3.2 æ‰©å®¹ç»ˆäºè¦æ¥çœ‹è¿™ä¸ªHashMapä¸­æœ€é‡è¦çš„ä¸€ä¸ªå‡½æ•°äº†-resize() final Node&lt;K,V>[] resize() { Node&lt;K,V>[] oldTab = table; int oldCap = (oldTab == null) ? 0 : oldTab.length; int oldThr = threshold; int newCap, newThr = 0; //å¦‚æœåŸæ¥é•¿åº¦ä¸ä¸º0 if (oldCap > 0) { //å¦‚æœå¤§äºæœ€å¤§å®¹é‡ä¸æ‰©å®¹ç›´æ¥è¿”å› if (oldCap >= MAXIMUM_CAPACITY) { threshold = Integer.MAX_VALUE; return oldTab; } // æ–°å®¹é‡ä¸ºæ—§å®¹é‡çš„ä¸¤å€ else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap >= DEFAULT_INITIAL_CAPACITY) newThr = oldThr &lt;&lt; 1; // ä¸Šé™ä¹Ÿç¿»å€ } // å¦‚æœåŸæ¥é•¿åº¦ä¸º0ä¸”thresholdä¸ä¸º0ï¼Œåˆå§‹å®¹é‡èµ‹å€¼ä¸ºthreshold // è¿™ç§æƒ…å†µå‘ç”Ÿåœ¨ä½¿ç”¨æœ‰å‚æ„é€ å‡½æ•°åï¼Œæ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ã€‚ else if (oldThr > 0) // initial capacity was placed in threshold newCap = oldThr; // å¦‚æœåŸæ¥é•¿åº¦å’Œthresholdéƒ½ä¸º0ï¼Œç”¨DEFAULT_INITIAL_CAPACITY=16å……å½“åˆå§‹å®¹é‡ else { // zero initial threshold signifies using defaults newCap = DEFAULT_INITIAL_CAPACITY; //å…ƒç´ ä¸Šé™ä¸º0.75å€çš„æ•°ç»„å®¹é‡ newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); } if (newThr == 0) { float ft = (float)newCap * loadFactor; newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ? (int)ft : Integer.MAX_VALUE); } threshold = newThr; @SuppressWarnings({\"rawtypes\",\"unchecked\"}) Node&lt;K,V>[] newTab = (Node&lt;K,V>[])new Node[newCap]; table = newTab; if (oldTab != null) { for (int j = 0; j &lt; oldCap; ++j) { Node&lt;K,V> e; if ((e = oldTab[j]) != null) { oldTab[j] = null; if (e.next == null) newTab[e.hash &amp; (newCap - 1)] = e; else if (e instanceof TreeNode) //splitä¸­å¯èƒ½å‡ºç°çº¢é»‘æ ‘é™çº§ä¸ºé“¾è¡¨ ((TreeNode&lt;K,V>)e).split(this, newTab, j, oldCap); else { // preserve order Node&lt;K,V> loHead = null, loTail = null; Node&lt;K,V> hiHead = null, hiTail = null; Node&lt;K,V> next; do { next = e.next; if ((e.hash &amp; oldCap) == 0) { if (loTail == null) loHead = e; else loTail.next = e; loTail = e; } else { if (hiTail == null) hiHead = e; else hiTail.next = e; hiTail = e; } } while ((e = next) != null); if (loTail != null) { loTail.next = null; newTab[j] = loHead; } if (hiTail != null) { hiTail.next = null; newTab[j + oldCap] = hiHead; } } } } } return newTab; } çœ‹å®Œè¿™ä¸ªæ–¹æ³•æˆ‘ä»¬å°±å¤§æ¦‚çŸ¥é“å„ç§æŒ‡æ ‡çš„å«ä¹‰äº†ã€‚ï¼ˆæˆ‘æ”¾åˆ°æ€»ç»“é‡Œå»äº†ï¼‰ ã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹ä¸­æœ‰è¿™æ ·ä¸€æ¡å»ºè®®ï¼š ã€æ¨èã€‘é›†åˆåˆå§‹åŒ–æ—¶ï¼ŒæŒ‡å®šé›†åˆåˆå§‹å€¼å¤§å°ã€‚è¯´æ˜ï¼š HashMap ä½¿ç”¨ HashMap(int initialCapacity) åˆå§‹åŒ–ã€‚æ­£ä¾‹ï¼š initialCapacity = (éœ€è¦å­˜å‚¨çš„å…ƒç´ ä¸ªæ•° / è´Ÿè½½å› å­) + 1ã€‚æ³¨æ„è´Ÿè½½å› å­ï¼ˆå³ loaderfactorï¼‰é»˜è®¤ä¸º 0.75ï¼Œå¦‚æœæš‚æ—¶æ— æ³•ç¡®å®šåˆå§‹å€¼å¤§å°ï¼Œè¯·è®¾ç½®ä¸º 16ï¼ˆå³é»˜è®¤å€¼ï¼‰ã€‚åä¾‹ï¼š HashMap éœ€è¦æ”¾ç½® 1024 ä¸ªå…ƒç´ ï¼Œç”±äºæ²¡æœ‰è®¾ç½®å®¹é‡åˆå§‹å¤§å°ï¼Œéšç€å…ƒç´ ä¸æ–­å¢åŠ ï¼Œå®¹é‡ 7 æ¬¡è¢«è¿«æ‰©å¤§ï¼Œresize éœ€è¦é‡å»º hash è¡¨ï¼Œä¸¥é‡å½±å“æ€§èƒ½ã€‚ 4 é—®é¢˜ ä¸ºä»€ä¹ˆé»˜è®¤è´Ÿè½½å› å­æ˜¯0.75ï¼Ÿ ç½‘ä¸Šå¾ˆå¤šåšå®¢è¯´è¿™è·Ÿæ³Šæ¾åˆ†å¸ƒæœ‰å…³ç³»ï¼ŒåŸå› æ¥è‡ªjdk8ä¸­çš„HashMapçš„ä¸€æ®µæ³¨é‡Šï¼Œè€Œæˆ‘çœ‹åˆ°æœ‰ä¸€ä½åšä¸»åé©³äº†è¿™ç§è§‚ç‚¹ï¼Œè¯´å®˜æ–¹å–é»˜è®¤è´Ÿè½½å› å­ä¸º0.75å’Œæ³Šæ¾åˆ†å¸ƒå¹¶æ²¡æœ‰å…³ç³»ï¼Œåªæ˜¯ä¸€ç§æŠ˜ä¸­çš„é€‰æ‹©ï¼Œè€Œå¯¹äºè´Ÿè½½å› å­ä¸º0.75ï¼ŒåŠ ä¸Šæ³Šæ¾åˆ†å¸ƒå…¬å¼ï¼Œæ¨æ–­å‡ºä¸€ä¸ªæ¡¶çš„å…ƒç´ æ•°é‡è¶…è¿‡8çš„æ¦‚ç‡éå¸¸å°ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆè¦å¼•å…¥çº¢é»‘æ ‘çš„åŸå› ã€‚ å‚è€ƒHashMap defaultLoadFactor = 0.75å’Œæ³Šæ¾åˆ†å¸ƒæ²¡æœ‰å…³ç³»_åšç§¯è–„å‘è€…ï¼Œè½»èˆŸä¸‡é‡å±±-CSDNåšå®¢ ä¸ºä»€ä¹ˆ8å‡çº¢é»‘æ ‘ï¼Œ6é™é“¾è¡¨ï¼Ÿ å¦‚ä¸Šæ‰€è¿°ï¼Œå¯¹äºè´Ÿè½½å› å­ä¸º0.75æ—¶ï¼Œä½¿ç”¨æ³Šæ¾åˆ†å¸ƒå…¬å¼å¯è®¡ç®—å‡ºä¸€ä¸ªæ¡¶ä¸­å…ƒç´ æ•°é‡åˆ†å¸ƒæ¦‚ç‡ä¸ºï¼š 0: 0.60653066 1: 0.30326533 2: 0.07581633 3: 0.01263606 4: 0.00157952 5: 0.00015795 6: 0.00001316 7: 0.00000094 8: 0.00000006å½“æ•°é‡è¾¾åˆ°8çš„æ—¶å€™æ¦‚ç‡å·²ç»éå¸¸å°äº†ï¼Œå®˜æ–¹è®¤ä¸ºæ­¤æ—¶å¯ä»¥ä½¿ç”¨çº¢é»‘æ ‘è§£å†³æ•ˆç‡é—®é¢˜ã€‚ è‡³äºæ•°é‡é™ä¸º6çš„æ—¶å€™å†è¿›è¡Œresizeä¼šé€€åŒ–ä¸ºé“¾è¡¨ï¼Œå®˜æ–¹åœ¨javadocä¸­å†™é“ï¼š The bin count threshold for untreeifying a (split) bin during a resize operation. Should be less than TREEIFY_THRESHOLD, and at most 6 to mesh with shrinkage detection under removal. é¦–å…ˆTREEIFY_THRESHOLDå¿…é¡»å°äºTREEIFY_THRESHOLDï¼Œå³å¿…é¡»å°äº8ï¼Œä¸ºäº†é€‚åº”ç§»é™¤å…ƒç´ çš„æ—¶å€™æ¡¶çš„è½»å¾®æ”¶ç¼©ï¼ŒTREEIFY_THRESHOLDä¸è¶…è¿‡6ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jdk","slug":"jdk","permalink":"https://www.codetool.top/tags/jdk/"},{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://www.codetool.top/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"}]},{"title":"JDK8-Streamæµåº“è¯¦è§£","slug":"JDK8-Streamæµåº“è¯¦è§£ï¼ˆä¸Šï¼‰","date":"2020-02-11T12:15:42.000Z","updated":"2020-02-20T14:55:21.051Z","comments":true,"path":"article/JDK8-Streamæµåº“è¯¦è§£ï¼ˆä¸Šï¼‰/","link":"","permalink":"https://www.codetool.top/article/JDK8-Stream%E6%B5%81%E5%BA%93%E8%AF%A6%E8%A7%A3%EF%BC%88%E4%B8%8A%EF%BC%89/","excerpt":"","text":"æµæä¾›äº†ä¸€ç§è®©æˆ‘ä»¬å¯ä»¥åœ¨æ¯”é›†åˆæ›´é«˜çš„æ¦‚å¿µçº§åˆ«ä¸ŠæŒ‡å®šè®¡ç®—çš„æ•°æ®è§†å›¾ã€‚é€šè¿‡ä½¿ç”¨æµï¼Œæˆ‘ä»¬å¯ä»¥è¯´æ˜æƒ³è¦å®Œæˆä»€ä¹ˆä»»åŠ¡ï¼Œè€Œä¸æ˜¯è¯´æ˜å¦‚ä½•å»å®ç°å®ƒã€‚ 1 æµçš„åˆ›å»º Collection.stream()ï¼šä»ä¸€ä¸ªé›†åˆç”Ÿæˆæµ Collection.parallelStream()ï¼šä»ä¸€ä¸ªé›†åˆç”Ÿæˆå¹¶è¡Œæµ Stream::of(T... t)ï¼šä»ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ä¸­ç”Ÿæˆæµ Arrays::stream(T[] array, int startInclusive, int endExclusive)ï¼šä»æ•°ç»„ä¸­ç”Ÿæˆæµ Stream::empty()ï¼šç”Ÿæˆä¸€ä¸ªç©ºçš„æµ String str = \"1,2,3,4,5,6,7\"; Stream&lt;String> wordStream1 = Stream.of(words); //ç­‰æ•ˆäº Stream&lt;String> wordStream2 = Arrays.stream(words, 0, words.length); 1.1 æ— é™æµ Stream::generate(Supplier&lt;T&gt; s)ï¼Œé€šè¿‡supplierçš„getè·å–æµä¸‹ä¸€ä¸ªè¦ç”Ÿæˆçš„å…ƒç´ ã€‚ Stream&lt;String> echos = Stream.generate(() -> \"Echo\"); Stream&lt;Double> randoms = Stream.generate(Math::random); Stream::iterate(final T seed, final UnaryOperator&lt;T&gt; f)ï¼Œæ¥å—ä¸€ä¸ªç§å­å€¼å’Œä¸€ä¸ªä¸€å…ƒå‡½æ•°ï¼Œä»ç§å­å€¼å¼€å§‹åå¤å°†å‡½æ•°åº”ç”¨åˆ°ä¹‹å‰çš„ç»“æœä¸Šã€‚ Stream&lt;BigInteger> integers = Stream.iterate(BigInteger.ZERO,n->n.add(BigInteger.ONE)); 2 æµçš„ä¿®æ”¹æµçš„æ“ä½œä¸ä¼šä¿®æ”¹å…¶æ•°æ®æºï¼Œå½“æˆ‘ä»¬æƒ³ä¿®æ”¹æµä¸­çš„æ•°æ®æ—¶ï¼Œåªèƒ½é€šè¿‡ä¸€äº›æ–¹æ³•è·å–ä¸€ä¸ªä¸­é—´æµã€‚ 2.1 è¿‡æ»¤Stream&lt;T> filter(Predicate&lt;? super T> predicate) ç”¨äºè¿‡æ»¤æ‰ä¸€äº›æ•°æ®ï¼Œåªä¿ç•™predicate.test()è¿”å›ä¸ºtrueçš„æ•°æ®ã€‚ Stream&lt;Integer> nums = Stream.of(1,2,3,4,5,6,7); Stream&lt;Integer> modNums = nums.filter(i -> i > 4); //5,6,7 2.2 è½¬æ¢&lt;R> Stream&lt;R> map(Function&lt;? super T, ? extends R> mapper); å½“æˆ‘ä»¬æƒ³æŒ‰ç…§æŸç§æ–¹å¼è½¬æ¢æµä¸­çš„çš„å€¼å¯ä»¥ä½¿ç”¨mapå¹¶ä¼ é€’æ‰§è¡Œè¯¥è½¬æ¢çš„å‡½æ•°ã€‚ Stream&lt;Integer> nums = Stream.of(1,2,3,4,5,6,7); Stream&lt;Integer> modNums = nums.map(i -> i + 3); //4,5,6,7,8,9,10 2.3 å…¶ä»–æ“ä½œ Stream&lt;T&gt; limit(long maxSize)ï¼šæˆªå–æœ€å¤§maxSizeä¸ªå…ƒç´ ï¼Œç»„æˆæ–°æµã€‚ Stream&lt;T&gt; skip(long n)ï¼šä¸¢å¼ƒå‰nä¸ªå…ƒç´ ï¼Œç»„æˆæ–°æµã€‚ public static &lt;T&gt; Stream&lt;T&gt; concat(Stream&lt;? extends T&gt; a, Stream&lt;? extends T&gt; b)ï¼šäº§ç”Ÿä¸€ä¸ªæµï¼Œå®ƒçš„å…ƒç´ æ˜¯açš„å…ƒç´ åé¢è·Ÿäº†bçš„å…ƒç´ ã€‚ Stream&lt;T&gt; distinct()ï¼šå»é™¤é‡å¤æ“ä½œ Stream&lt;T&gt; sorted()æˆ–Stream&lt;T&gt; sorted(Comparator&lt;? super T&gt; comparator)ï¼šè¿”å›ä¸€ä¸ªæ’åºåçš„æµã€‚ Stream&lt;T&gt; peek(Consumer&lt;? super T&gt; action)ï¼šå½“å®é™…è®¿é—®ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œä¼šæŠŠå‡½æ•°åº”ç”¨åˆ°è¿™ä¸ªå…ƒç´ ã€‚ï¼ˆä»…å½“è®¿é—®æ—¶ï¼Œå› ä¸ºæµçš„æ“ä½œæ˜¯æ‡’æƒ°çš„ï¼‰ 3 æµçš„çº¦ç®€çº¦ç®€æ˜¯ä¸€ç§ç»ˆç»“æ“ä½œï¼Œå®ƒä»¬ä¼šå°†æµçº¦ç®€ä¸ºå¯ä»¥åœ¨ç¨‹åºä¸­ä½¿ç”¨çš„éæµå€¼ã€‚ long count(); ï¼šè¿”å›æµä¸­å…ƒç´ çš„æ•°é‡ Optional&lt;T&gt; max(Comparator&lt;? super T&gt; comparator);ï¼šè¿”å›æœ€å¤§å€¼ Optional&lt;T&gt; min(Comparator&lt;? super T&gt; comparator);ï¼šè¿”å›æœ€å°å€¼ Optional&lt;T&gt; findFirst();ï¼šè¿”å›ç¬¬ä¸€ä¸ªå€¼ï¼Œæ­é…filterä½¿ç”¨æœ‰å¥‡æ•ˆ Optional&lt;T&gt; findAny();ï¼šè¿”å›ä»»æ„ä¸€ä¸ªå€¼ï¼Œé€‚ç”¨äºå¹¶è¡Œå¤„ç†æµ boolean anyMatch(Predicate&lt;? super T&gt; predicate);ï¼šæ˜¯å¦å­˜åœ¨åŒ¹é… boolean allMatch(Predicate&lt;? super T&gt; predicate);ï¼šæ˜¯å¦å…¨éƒ¨åŒ¹é… boolean noneMatch(Predicate&lt;? super T&gt; predicate);ï¼šæ˜¯å¦ä¸å­˜åœ¨åŒ¹é… éœ€è¦æ³¨æ„çš„æ˜¯éƒ¨åˆ†æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªOptional&lt;T&gt;ç±»å‹çš„è¿”å›å€¼ï¼Œå®ƒè¦ä¹ˆåœ¨å…¶ä¸­åŒ…è£…äº†ç­”æ¡ˆï¼Œè¦ä¹ˆè¡¨ç¤ºæ²¡æœ‰ä»»ä½•å€¼ï¼ˆå› ä¸ºæµç¢°å·§ä¸ºç©ºï¼‰ã€‚ Optionalæœ‰å¦‚ä¸‹ä¸»è¦æ–¹æ³•ï¼š public boolean isPresent();//æ£€æŸ¥å€¼æ˜¯å¦å­˜åœ¨ public T get();//å¦‚æœæœ‰å€¼è¿”å›å€¼ï¼Œæ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ public T orElse(T other);//å¦‚æœæœ‰å€¼è¿”å›å€¼ï¼Œæ²¡æœ‰å€¼è¿”å›ç»™å®šçš„å‚æ•° 4 æ”¶é›†ç»“æœ è°ƒç”¨iterator()è¿”å›ä¸€ä¸ªæ—§å¼é£æ ¼çš„è¿­ä»£å™¨ ä½¿ç”¨forEach()æ–¹æ³•ä¼ å…¥ä¸€ä¸ªä¸€å…ƒæ“ä½œæ–¹æ³•ã€‚ toArray()è¿”å›ä¸€ä¸ªObjectæ•°ç»„ &lt;R, A&gt; R collect(Collector&lt;? super T, A, R&gt; collector);ä¼ å…¥ä¸€ä¸ªcollectorï¼Œè¿”å›é›†åˆï¼Œå¸¸ç”¨çš„æœ‰Collectors.toList()ï¼ŒCollectors.toSet()æˆ–è€…Collectors.toCollection()é‡Œé¢ä¼ å…¥å…·ä½“é›†åˆçš„æ„é€ å™¨æ–¹æ³•","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://www.codetool.top/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}]},{"title":"Junit-å•å…ƒæµ‹è¯•å°å·¥å…·","slug":"Junit-å•å…ƒæµ‹è¯•å°å·¥å…·","date":"2020-02-10T18:46:16.000Z","updated":"2020-04-22T09:27:27.142Z","comments":true,"path":"article/Junit-å•å…ƒæµ‹è¯•å°å·¥å…·/","link":"","permalink":"https://www.codetool.top/article/Junit-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%B0%8F%E5%B7%A5%E5%85%B7/","excerpt":"","text":"1 Junitæ¦‚è¿°JUnit æ˜¯ä¸€ä¸ªå›å½’æµ‹è¯•æ¡†æ¶ï¼Œè¢«å¼€å‘è€…ç”¨äºå®æ–½å¯¹åº”ç”¨ç¨‹åºçš„å•å…ƒæµ‹è¯•ï¼ŒåŠ å¿«ç¨‹åºç¼–åˆ¶é€Ÿåº¦ï¼ŒåŒæ—¶æé«˜ç¼–ç çš„è´¨é‡ã€‚ JUnit æµ‹è¯•æ¡†æ¶å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š JUnitæ˜¯ç”¨äºç¼–å†™å’Œè¿è¡Œæµ‹è¯•çš„å¼€æºæ¡†æ¶ã€‚ æä¾›äº†æ³¨é‡Šï¼Œä»¥ç¡®å®šæµ‹è¯•æ–¹æ³•ã€‚ æä¾›æ–­è¨€æµ‹è¯•é¢„æœŸç»“æœã€‚ æä¾›äº†æµ‹è¯•è¿è¡Œçš„è¿è¡Œæµ‹è¯•ã€‚ JUnitæµ‹è¯•è®©æ‚¨å¯ä»¥æ›´å¿«åœ°ç¼–å†™ä»£ç ï¼Œæé«˜è´¨é‡ JUnitæ˜¯ä¼˜é›…ç®€æ´ã€‚å®ƒæ˜¯ä¸é‚£ä¹ˆå¤æ‚ä»¥åŠä¸éœ€è¦èŠ±è´¹å¤ªå¤šçš„æ—¶é—´ã€‚ JUnitæµ‹è¯•å¯ä»¥è‡ªåŠ¨è¿è¡Œï¼Œæ£€æŸ¥è‡ªå·±çš„ç»“æœï¼Œå¹¶æä¾›å³æ—¶åé¦ˆã€‚æ²¡æœ‰å¿…è¦é€šè¿‡æµ‹è¯•ç»“æœæŠ¥å‘Šæ¥æ‰‹åŠ¨æ¢³ç†ã€‚ JUnitæµ‹è¯•å¯ä»¥ç»„ç»‡æˆæµ‹è¯•å¥—ä»¶åŒ…å«æµ‹è¯•æ¡ˆä¾‹ï¼Œç”šè‡³å…¶ä»–æµ‹è¯•å¥—ä»¶ã€‚ Junitæ˜¾ç¤ºæµ‹è¯•è¿›åº¦çš„ï¼Œå¦‚æœæµ‹è¯•æ˜¯æ²¡æœ‰é—®é¢˜æ¡å½¢æ˜¯ç»¿è‰²çš„ï¼Œæµ‹è¯•å¤±è´¥åˆ™ä¼šå˜æˆçº¢è‰²ã€‚ 2 Junit mavené…ç½®&lt;dependency> &lt;groupId>junit&lt;/groupId> &lt;artifactId>junit&lt;/artifactId> &lt;version>4.13&lt;/version> &lt;scope>test&lt;/scope> &lt;/dependency> æ³¨ï¼šmavené¡¹ç›®é€šå¸¸åœ¨testä¸‹ç¼–å†™æµ‹è¯•ç±» 3 Junitæ–­è¨€ void assertEquals([String message], expected value, actual value)ï¼šæ–­è¨€ä¸¤ä¸ªå€¼ç›¸ç­‰ã€‚æœ‰å¤šç§å‚æ•°ç±»å‹é‡è½½ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯é€‰çš„å­—ç¬¦ä¸²æ¶ˆæ¯ void assertTrue([String message], boolean condition)ï¼šæ–­è¨€ä¸€ä¸ªæ¡ä»¶ä¸ºçœŸ void assertFalse([String message],boolean condition)ï¼šæ–­è¨€ä¸€ä¸ªæ¡ä»¶ä¸ºå‡ void assertNotNull([String message], java.lang.Object object)ï¼šæ–­è¨€ä¸€ä¸ªå¯¹è±¡ä¸ä¸ºç©º(null) void assertNull([String message], java.lang.Object object)ï¼šæ–­è¨€ä¸€ä¸ªå¯¹è±¡ä¸ºç©º(null) void assertSame([String message], java.lang.Object expected, java.lang.Object actual)ï¼šæ–­è¨€ï¼Œä¸¤ä¸ªå¯¹è±¡å¼•ç”¨ç›¸åŒçš„å¯¹è±¡void assertNotSame([String message], java.lang.Object unexpected, java.lang.Object actual)ï¼šæ–­è¨€ï¼Œä¸¤ä¸ªå¯¹è±¡ä¸æ˜¯å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡void assertArrayEquals([String message], expectedArray, resultArray)ï¼šæ–­è¨€é¢„æœŸæ•°ç»„å’Œç»“æœæ•°ç»„ç›¸ç­‰ã€‚æœ‰å¤šç§å‚æ•°ç±»å‹é‡è½½ã€‚ 4 Junitæ³¨è§£ æ³¨è§£ æè¿° @Testpublic void method() Testæ³¨é‡ŠæŒ‡ç¤ºè¯¥å…¬å…±æ— æ•ˆæ–¹æ³•å®ƒæ‰€é™„ç€å¯ä»¥ä½œä¸ºä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚ @Beforepublic void method() Beforeæ³¨é‡Šè¡¨ç¤ºï¼Œè¯¥æ–¹æ³•å¿…é¡»åœ¨ç±»ä¸­çš„æ¯ä¸ªæµ‹è¯•ä¹‹å‰æ‰§è¡Œï¼Œä»¥ä¾¿æ‰§è¡Œæµ‹è¯•æŸäº›å¿…è¦çš„å…ˆå†³æ¡ä»¶ã€‚ @BeforeClasspublic static void method() BeforeClassæ³¨é‡ŠæŒ‡å‡ºè¿™æ˜¯é™„ç€åœ¨é™æ€æ–¹æ³•å¿…é¡»æ‰§è¡Œä¸€æ¬¡å¹¶åœ¨ç±»çš„æ‰€æœ‰æµ‹è¯•ä¹‹å‰ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ä¸€èˆ¬æ˜¯æµ‹è¯•è®¡ç®—å…±äº«é…ç½®æ–¹æ³•(å¦‚è¿æ¥åˆ°æ•°æ®åº“)ã€‚ @Afterpublic void method() After æ³¨é‡ŠæŒ‡ç¤ºï¼Œè¯¥æ–¹æ³•åœ¨æ‰§è¡Œæ¯é¡¹æµ‹è¯•åæ‰§è¡Œ(å¦‚æ‰§è¡Œæ¯ä¸€ä¸ªæµ‹è¯•åé‡ç½®æŸäº›å˜é‡ï¼Œåˆ é™¤ä¸´æ—¶å˜é‡ç­‰) @AfterClasspublic static void method() å½“éœ€è¦æ‰§è¡Œæ‰€æœ‰çš„æµ‹è¯•åœ¨JUnitæµ‹è¯•ç”¨ä¾‹ç±»åæ‰§è¡Œï¼ŒAfterClassæ³¨è§£å¯ä»¥ä½¿ç”¨ä»¥æ¸…ç†å»ºç«‹æ–¹æ³•ï¼Œ(ä»æ•°æ®åº“å¦‚æ–­å¼€è¿æ¥)ã€‚æ³¨æ„ï¼šé™„æœ‰æ­¤æ‰¹æ³¨(ç±»ä¼¼äºBeforeClass)çš„æ–¹æ³•å¿…é¡»å®šä¹‰ä¸ºé™æ€ã€‚ @Ignorepublic static void method() å½“æƒ³æš‚æ—¶ç¦ç”¨ç‰¹å®šçš„æµ‹è¯•æ‰§è¡Œå¯ä»¥ä½¿ç”¨å¿½ç•¥æ³¨é‡Šã€‚æ¯ä¸ªè¢«æ³¨è§£ä¸º@Ignoreçš„æ–¹æ³•å°†ä¸è¢«æ‰§è¡Œã€‚ ä»£ç ç¤ºä¾‹ï¼š import org.junit.*; public class CalculatorTest { int a = 3; int b = 5; int expectAdd = 8; int expectSub = -2; Calculator calculator = new Calculator(); @BeforeClass public static void beforeClass(){ System.out.println(\"@BeforeClass\"); } @Test public void addTest(){ int res = calculator.add(a,b); System.out.println(\"add(\"+a+\",\"+b+\")=\"+res); Assert.assertEquals(res,expectAdd); } @Test public void subTest(){ int res = calculator.sub(a,b); System.out.println(\"sub(\"+a+\",\"+b+\")=\"+res); Assert.assertEquals(res,expectSub); } @AfterClass public static void onceExecutedAfterAll() { System.out.println(\"@AfterClass\"); } @After public void executedAfterEach() { System.out.println(\"@After\"); } } 5 åˆ›å»ºå¥—ä»¶æµ‹è¯•æµ‹è¯•å¥—ä»¶æ˜¯ä¸€äº›æµ‹è¯•ä¸åŒç±»ç”¨ä¾‹ï¼Œå¯ä»¥ä½¿ç”¨@RunWithå’Œ@Suiteæ³¨è§£è¿è¡Œæ‰€æœ‰ä¸œè¥¿åœ¨ä¸€èµ·ã€‚å¦‚æœæœ‰å¾ˆå¤šæµ‹è¯•ç±»ï¼Œæƒ³è®©å®ƒä»¬éƒ½è¿è¡Œåœ¨åŒä¸€æ—¶é—´ï¼Œè€Œä¸æ˜¯å•ä¸€åœ°è¿è¡Œæ¯ä¸ªæµ‹è¯•ï¼Œè¿™æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ ä¸‹é¢è¿™æ®µä»£ç å³åŒæ—¶æµ‹è¯•TestCase1å’ŒTestCase2 package junit; import org.junit.runner.RunWith; import org.junit.runners.Suite; @RunWith(Suite.class) @Suite.SuiteClasses({TestCase1.class,TestCase2.class}) public class TestSuite { } 6 æ„å»ºå‚æ•°åŒ–æµ‹è¯•æ»¡è¶³ä¸‹åˆ—è¦æ±‚ï¼š è¯¥ç±»è¢«æ³¨è§£ä¸º @RunWith(Parameterized.class). è¿™ä¸ªç±»æœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå­˜å‚¨æµ‹è¯•æ•°æ®ã€‚ è¿™ä¸ªç±»æœ‰ä¸€ä¸ªé™æ€æ–¹æ³•ç”Ÿæˆå¹¶è¿”å›æµ‹è¯•æ•°æ®ï¼Œå¹¶æ³¨æ˜@Parametersæ³¨è§£ã€‚ è¿™ä¸ªç±»æœ‰ä¸€ä¸ªæµ‹è¯•ï¼Œå®ƒéœ€è¦æ³¨è§£@Teståˆ°æ–¹æ³•ã€‚ ä»£ç ç¤ºä¾‹ï¼š @RunWith(Parameterized.class) public class CalculatorTest2 { int oper1; int oper2; int expectAdd; int expectSub; Calculator calculator = new Calculator(); public CalculatorTest2(int oper1, int oper2, int expectAdd,int expectSub) { this.oper1 = oper1; this.oper2 = oper2; this.expectAdd = expectAdd; this.expectSub = expectSub; } @Parameterized.Parameters public static Collection addedNumbers(){ return Arrays.asList(new Integer[][]{{1,2,3,-1},{4,2,6,2},{7,3,10,10},{5,2,1,3}}); } @Test public void addTest(){ int res = calculator.add(oper1,oper2); System.out.println(\"add(\"+oper1+\",\"+oper2+\")=\"+res); Assert.assertEquals(res,expectAdd); } @Test public void subTest(){ int res = calculator.sub(oper1,oper2); System.out.println(\"sub(\"+oper1+\",\"+oper2+\")=\"+res); Assert.assertEquals(res,expectSub); } }","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Junit","slug":"Junit","permalink":"https://www.codetool.top/tags/Junit/"}]},{"title":"leetcode313-è¶…çº§ä¸‘æ•°","slug":"leetcode313-è¶…çº§ä¸‘æ•°","date":"2020-02-10T16:48:51.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode313-è¶…çº§ä¸‘æ•°/","link":"","permalink":"https://www.codetool.top/article/leetcode313-%E8%B6%85%E7%BA%A7%E4%B8%91%E6%95%B0/","excerpt":"","text":"1 åŸé¢˜ç¼–å†™ä¸€æ®µç¨‹åºæ¥æŸ¥æ‰¾ç¬¬ n ä¸ªè¶…çº§ä¸‘æ•°ã€‚ è¶…çº§ä¸‘æ•°æ˜¯æŒ‡å…¶æ‰€æœ‰è´¨å› æ•°éƒ½æ˜¯é•¿åº¦ä¸º k çš„è´¨æ•°åˆ—è¡¨ primes ä¸­çš„æ­£æ•´æ•°ã€‚ ç¤ºä¾‹: è¾“å…¥ï¼š n = 12, primes = [2,7,13,19]è¾“å‡ºï¼š 32è§£é‡Šï¼š ç»™å®šé•¿åº¦ä¸º 4 çš„è´¨æ•°åˆ—è¡¨ primes = [2,7,13,19]ï¼Œå‰ 12 ä¸ªè¶…çº§ä¸‘æ•°åºåˆ—ä¸ºï¼š[1,2,4,7,8,13,14,16,19,26,28,32] ã€‚ è¯´æ˜ï¼š 1 æ˜¯ä»»ä½•ç»™å®š primes çš„è¶…çº§ä¸‘æ•°ã€‚ ç»™å®š primes ä¸­çš„æ•°å­—ä»¥å‡åºæ’åˆ—ã€‚ 0 &lt; k â‰¤ 100, 0 &lt; n â‰¤ 106, 0 &lt; primes[i] &lt; 1000 ã€‚ ç¬¬ n ä¸ªè¶…çº§ä¸‘æ•°ç¡®ä¿åœ¨ 32 ä½æœ‰ç¬¦æ•´æ•°èŒƒå›´å†…ã€‚ 2 è§£æ³•2.1 æ€æƒ³è¯¥é¢˜å’Œleetcode264-ä¸‘æ•°IIç±»ä¼¼ï¼Œå¯ä»¥ä½¿ç”¨å †æ¥æ±‚è§£ã€‚ 2.2 ä»£ç class Solution { public int nthUglyNumber(int n) { Queue&lt;Long> queue = new PriorityQueue&lt;>(); int count = 1; long cur = 1; while(count&lt;n){ queue.offer(cur*2); queue.offer(cur*3); queue.offer(cur*5); cur = queue.poll(); while (!queue.isEmpty() &amp;&amp; cur==queue.peek()) queue.poll(); count++; } return (int)cur; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode264-ä¸‘æ•°II","slug":"leetcode264-ä¸‘æ•°II","date":"2020-02-10T15:55:28.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode264-ä¸‘æ•°II/","link":"","permalink":"https://www.codetool.top/article/leetcode264-%E4%B8%91%E6%95%B0II/","excerpt":"","text":"1 åŸé¢˜ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œæ‰¾å‡ºç¬¬ n ä¸ªä¸‘æ•°ã€‚ ä¸‘æ•°å°±æ˜¯åªåŒ…å«è´¨å› æ•° 2, 3, 5 çš„æ­£æ•´æ•°ã€‚ ç¤ºä¾‹: è¾“å…¥ï¼š n = 10è¾“å‡ºï¼š 12è§£é‡Šï¼š 1, 2, 3, 4, 5, 6, 8, 9, 10, 12 æ˜¯å‰ 10 ä¸ªä¸‘æ•°ã€‚ è¯´æ˜ï¼š 1 æ˜¯ä¸‘æ•°ã€‚ n ä¸è¶…è¿‡1690ã€‚ 2 è§£æ³•2.1 æ€æƒ³è¯¥é¢˜çš„å…³é”®æ˜¯è¦çŸ¥é“ä¸‘æ•°çš„é¡ºåºï¼Œä»ç¬¬ä¸€ä¸ªä¸‘æ•°å¼€å§‹ï¼Œå¾—åˆ°å®ƒçš„2ã€3ã€5çš„å€æ•°æ’å…¥åˆ°æœ€å°å †ä¸­ï¼Œè¿™æ ·æ¯æ¬¡æˆ‘ä»¬ä»å †é¡¶æ‹¿å‡ºæ¥çš„éƒ½æ˜¯å †ä¸­æœ€å°çš„å…ƒç´ ï¼Œå³ä¸‹ä¸€ä¸ªä¸‘æ•°ï¼Œé‡å¤è¯¥æ­¥éª¤å¹¶è®¡æ•°å°±èƒ½å¾—åˆ°ç›®æ ‡è§£ã€‚ 2.2 ä»£ç class Solution { public int nthUglyNumber(int n) { Queue&lt;Long> queue = new PriorityQueue&lt;>(); int count = 1; long cur = 1; while(count&lt;n){ queue.offer(cur*2); queue.offer(cur*3); queue.offer(cur*5); cur = queue.poll(); while (!queue.isEmpty() &amp;&amp; cur==queue.peek()) queue.poll(); count++; } return (int)cur; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode215-æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ ","slug":"leetcode215-æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ ","date":"2020-02-09T19:49:02.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode215-æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ /","link":"","permalink":"https://www.codetool.top/article/leetcode215-%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E7%AC%ACK%E4%B8%AA%E6%9C%80%E5%A4%A7%E5%85%83%E7%B4%A0/","excerpt":"","text":"1 åŸé¢˜åœ¨æœªæ’åºçš„æ•°ç»„ä¸­æ‰¾åˆ°ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ã€‚è¯·æ³¨æ„ï¼Œä½ éœ€è¦æ‰¾çš„æ˜¯æ•°ç»„æ’åºåçš„ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯ç¬¬ k ä¸ªä¸åŒçš„å…ƒç´ ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š [3,2,1,5,6,4] å’Œ k = 2è¾“å‡ºï¼š 5 ç¤ºä¾‹2: è¾“å…¥ï¼š [3,2,3,1,2,4,5,5,6] å’Œ k = 4è¾“å‡ºï¼š 4 è¯´æ˜: ä½ å¯ä»¥å‡è®¾ k æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œä¸” 1 â‰¤ k â‰¤ æ•°ç»„çš„é•¿åº¦ã€‚ 2 è§£æ³•2.1 æ€æƒ³å¯ä»¥ä½¿ç”¨æœ€å°å †ï¼Œç»´æŒå †é‡Œä¸è¶…è¿‡kä¸ªæ•°å­—ï¼Œä¸€æ—¦è¶…è¿‡åˆ™ç§»é™¤å †é¡¶æ•°å­—ï¼Œæœ€åå¾—åˆ°çš„å †é¡¶æ•°å­—åˆ™æ˜¯è¦æ±‚çš„ç›®æ ‡æ•°å­—ã€‚ 2.2 ä»£ç class Solution { public int findKthLargest(int[] nums, int k) { Queue&lt;Integer> queue = new PriorityQueue&lt;>(); for(int i:nums){ queue.offer(i); if(queue.size()>k) queue.poll(); } return queue.peek(); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"PriorityQueueæºç åˆ†æ","slug":"PriorityQueueæºç åˆ†æ","date":"2020-02-09T18:43:50.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/PriorityQueueæºç åˆ†æ/","link":"","permalink":"https://www.codetool.top/article/PriorityQueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","excerpt":"","text":"1 æ€»ç»“æ€»ç»“æ”¾å‰é¢é˜²æ­¢å¤ªé•¿ä¸çœ‹ï¼š PriorityQueueæ˜¯ä¸ªæœ€å°å †ï¼Œå¦‚æœè¦æ”¹å˜æ’åºé¡ºåºåªèƒ½é‡å†™æ¯”è¾ƒå™¨ä¼ å…¥æ„é€ æ–¹æ³•ã€‚ å†…éƒ¨å…ƒç´ è¦ä¹ˆå®ç°Comparableæ¥å£ï¼Œè¦ä¹ˆä¼ å…¥æ¯”è¾ƒå™¨è¿›è¡Œæ¯”è¾ƒã€‚ PriorityQueueçš„æ ¸å¿ƒæ“ä½œå°±æ˜¯å †çš„æ€æƒ³ï¼Œæ’å…¥å‘ä¸Šå †åŒ–ï¼Œç§»é™¤å‘ä¸‹å †åŒ–ã€‚ PriorityQueueçš„å†…éƒ¨æ˜¯æ•°ç»„å­˜å‚¨æ•°æ®ï¼Œé»˜è®¤å®¹é‡æ˜¯11ã€‚ æ‰©å®¹æ–¹æ³•æ˜¯ï¼Œå¦‚æœåŸæ•°ç»„å®¹é‡å°äº64ä¸ªï¼Œåˆ™æ–°å®¹é‡æ˜¯å®ƒçš„2å€+2ï¼ˆè€ƒè™‘åˆ°å¤§æ¦‚ç‡æ’å…¥åŒå­©å­èŠ‚ç‚¹ï¼‰ï¼Œå¦åˆ™1.5å€å¢é•¿ 2 æ¦‚è¦æ˜¨å¤©å­¦ä¹ äº†å¸¦æœ‰ä¼˜å…ˆçº§çš„å®Œå…¨äºŒå‰æ ‘-å †ï¼Œæåˆ°äº†å †çš„ä¸€ç§åº”ç”¨å°±æ˜¯å®ç°ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥çœ‹çœ‹jdkä¸­ä¼˜å…ˆçº§é˜Ÿåˆ—PriorityQueueçš„å®ç°å§ã€‚ ä¼˜å…ˆçº§é˜Ÿåˆ—é¡¾åæ€ä¹‰å°±æ˜¯é«˜ä¼˜å…ˆçº§çš„å…ƒç´ å…ˆå‡ºï¼Œä½ä¼˜å…ˆçº§çš„å…ƒç´ åå‡ºï¼ˆè­¦å‘Šï¼Œæ˜¯æˆ‘æƒ³å½“ç„¶äº†ï¼Œå…¶å®æ˜¯ä½ä¼˜å…ˆçº§çš„å…ƒç´ å…ˆå‡ºï¼‰ï¼Œæ‰€ä»¥ä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—å†…çš„å…ƒç´ ç±»å‹åº”è¯¥èƒ½æ¯”è¾ƒå…¶ä¼˜å…ˆçº§ã€‚ é¦–å…ˆçœ‹PriorityQueueçš„å£°æ˜ï¼š public class PriorityQueue&lt;E> extends AbstractQueue&lt;E> implements java.io.Serializable å’ŒLinkedListä¸€æ ·ç»§æ‰¿äº†AbstractQueueï¼Œæ¥è‡ªQueueæ¥å£ï¼Œè¯´æ˜å®ƒçš„ä¸»è¦æ“ä½œæ˜¯offer()ï¼Œpeek()å’Œpoll() ä½†æ˜¯æ³›å‹ä¸­å¹¶ä¸æ˜¯E extends Comparableï¼Œé‚£å®ƒæ˜¯æ€ä¹ˆæ¯”è¾ƒä¼˜å…ˆçº§çš„å‘¢ï¼Ÿ 3 æ ¸å¿ƒæ–¹æ³•3.1 offeræˆ‘ä»¬ç›´æ¥æ¥çœ‹offer()æ–¹æ³•ï¼Œofferæ–¹æ³•å¯ä»¥æ„é€ å‡ºä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—å‡ºæ¥ï¼Œèƒ½è®©æˆ‘ä»¬ç†è§£å®ƒçš„å†…éƒ¨ç»“æ„ï¼š public boolean offer(E e) { if (e == null) throw new NullPointerException(); modCount++; int i = size; // growï¼Œçœ‹åå­—å¤§æ¦‚æ˜ç™½æ˜¯æ‰©å®¹ if (i >= queue.length) grow(i + 1); size = i + 1; // queue[0]ï¼Œå¤§æ¦‚æ˜ç™½å†…éƒ¨æ˜¯ç”¨æ•°ç»„æ¥å­˜å‚¨çš„æ•°æ® if (i == 0) queue[0] = e; else // æ³¨æ„ï¼æ˜¯ä¸æ˜¯ä¼¼æ›¾ç›¸è¯†ï¼ siftUp(i, e); return true; } æˆ‘æƒ³çœ‹è¿‡æˆ‘ä¸Šä¸€ç¯‡åšå®¢çš„çœ‹åˆ°siftUpå°±æ˜ç™½äº†ï¼Œè¿™ä¸å°±æ˜¯å †æ’å…¥å…ƒç´ ä¹‹ååšä¸€ä¸ªå‘ä¸Šå †åŒ–çš„æ“ä½œå˜›ï¼è¿™é‡Œå¯ä»¥ç›´è§‚åœ°çœ‹å‡ºJavaä¸­PriorityQueueå°±æ˜¯ä½¿ç”¨å †æ¥å®ç°çš„ã€‚ ç»§ç»­çœ‹siftUpï¼š private void siftUp(int k, E x) { if (comparator != null) siftUpUsingComparator(k, x); else siftUpComparable(k, x); } åˆ°è¿™é‡Œå¤§æ¦‚å°±çŸ¥é“å®ƒæ˜¯æ€ä¹ˆæ¯”è¾ƒä¼˜å…ˆçº§çš„äº†ã€‚å› ä¸ºPriorityQueueæœ‰å‡ ä¸ªå¸¦æ¯”è¾ƒå™¨çš„æ„é€ æ–¹æ³•ï¼š public PriorityQueue(Comparator&lt;? super E&gt; comparator) public PriorityQueue(int initialCapacity,Comparator&lt;? super E&gt; comparator) é€šè¿‡æ¯”è¾ƒå™¨å°±å¯ä»¥æ¯”è¾ƒå®ƒä»¬çš„ä¼˜å…ˆçº§äº†ï¼Œå¦‚æœæ²¡æœ‰æ¯”è¾ƒå™¨çš„è¯ï¼Œå°±è°ƒç”¨siftUpComparableæ–¹æ³•ï¼Œå¤§æ¦‚å¯ä»¥çŒœåˆ°æ˜¯ç”¨Comparableæ¥å£è¿›è¡Œæ¯”è¾ƒã€‚ // è¿™é‡Œçš„kæ˜¯åŸæ¥è¦æ’å…¥çš„æ•°ç»„ä¸‹æ ‡ private void siftUpComparable(int k, E x) { Comparable&lt;? super E> key = (Comparable&lt;? super E>) x; while (k > 0) { // è·å–çˆ¶èŠ‚ç‚¹çš„ä½ç½® int parent = (k - 1) >>> 1; Object e = queue[parent]; // å¦‚æœå¤§äºçˆ¶èŠ‚ç‚¹çš„å€¼ï¼ˆå¤§äºæ˜¯æ³›æŒ‡ï¼‰ï¼Œä¸ç»§ç»­æ“ä½œ if (key.compareTo((E) e) >= 0) break; queue[k] = e; k = parent; } queue[k] = key; } å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªå‘ä¸Šå †åŒ–çš„æ“ä½œæ˜¯å°†å€¼æ›´å°çš„å…ƒç´ æ”¾åœ¨å †é¡¶ï¼ˆæœ€å°å †ï¼‰ äºæ˜¯ç»§ç»­æ¥çœ‹peek()æ–¹æ³•ï¼š 3.2 peekpublic E peek() { return (size == 0) ? null : (E) queue[0]; } å¯ä»¥çœ‹å‡ºå°±æ˜¯è¿”å›æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ é‚£ä¹ˆçœ‹poll()æ–¹æ³•ï¼š 3.3 pollpublic E poll() { if (size == 0) return null; int s = --size; modCount++; E result = (E) queue[0]; E x = (E) queue[s]; queue[s] = null; if (s != 0) //å‘ä¸‹å †åŒ– siftDown(0, x); return result; } ä¹Ÿå¾ˆç†Ÿæ‚‰ï¼Œå°±æ˜¯å †çš„åŸºæœ¬æ“ä½œï¼Œç§»é™¤å †é¡¶å…ƒç´ ï¼Œç„¶åå‘ä¸‹å †åŒ–ã€‚ private void siftDownComparable(int k, E x) { Comparable&lt;? super E> key = (Comparable&lt;? super E>)x; int half = size >>> 1; // loop while a non-leaf while (k &lt; half) { // å·¦å­©å­ä½ç½® int child = (k &lt;&lt; 1) + 1; // assume left child is least Object c = queue[child]; // å³å­©å­ä½ç½® int right = child + 1; if (right &lt; size &amp;&amp; ((Comparable&lt;? super E>) c).compareTo((E) queue[right]) > 0) c = queue[child = right]; if (key.compareTo((E) c) &lt;= 0) break; queue[k] = c; k = child; } queue[k] = key; } ç›®å‰ä¸ºæ­¢ï¼Œæ ¸å¿ƒæ“ä½œæˆ‘ä»¬å°±çœ‹å®Œäº†ï¼Œè¯´å®è¯æˆ‘ä¹‹å‰ä¸€ç›´ä»¥ä¸ºå®ƒæ˜¯ä¸ªæœ€å¤§å †æ¥ç€ï¼Œæ¯•ç«Ÿæ€»ä¼šè§‰å¾—åº”è¯¥æ˜¯å¤§ä¼˜å…ˆçº§çš„å…ˆå‡ºé˜Ÿåˆ—ã€‚ç„¶è€Œå®é™…ä¸Šæ˜¯æœ€å°å †ï¼Œå¦‚æœè¦æ”¹å˜å®ƒçš„æ’åºé¡ºåºåªèƒ½é‡å†™æ¯”è¾ƒå™¨ä¼ å…¥ã€‚ 4 æ„é€ æ–¹æ³•ä¸æ‰©å®¹4.1 ä»Collectionæ„é€ public PriorityQueue(Collection&lt;? extends E> c) { if (c instanceof SortedSet&lt;?>) { SortedSet&lt;? extends E> ss = (SortedSet&lt;? extends E>) c; this.comparator = (Comparator&lt;? super E>) ss.comparator(); initElementsFromCollection(ss); } else if (c instanceof PriorityQueue&lt;?>) { PriorityQueue&lt;? extends E> pq = (PriorityQueue&lt;? extends E>) c; this.comparator = (Comparator&lt;? super E>) pq.comparator(); initFromPriorityQueue(pq); } else { this.comparator = null; initFromCollection(c); } } PriorityQueueå¯ä»¥ä»SortedSetå’Œå¦ä¸€ä¸ªPriorityQueueä¸­è·å–å®ƒçš„æ¯”è¾ƒå™¨ï¼Œå†è¿›è¡Œæ„é€ ã€‚ private void initFromCollection(Collection&lt;? extends E> c) { initElementsFromCollection(c); heapify(); } æ ¹æ®æˆ‘ä»¬å¯¹å †çš„äº†è§£ï¼Œçœ‹åˆ°è¿™é‡Œå¤§æ¦‚å°±çŸ¥é“äº†å…ˆç»™æ•°ç»„èµ‹å€¼ç„¶ååŸåœ°å †åŒ–ã€‚ private void initElementsFromCollection(Collection&lt;? extends E> c) { Object[] a = c.toArray(); // If c.toArray incorrectly doesn't return Object[], copy it. if (a.getClass() != Object[].class) a = Arrays.copyOf(a, a.length, Object[].class); int len = a.length; if (len == 1 || this.comparator != null) for (int i = 0; i &lt; len; i++) if (a[i] == null) throw new NullPointerException(); this.queue = a; this.size = a.length; } è¿™ä¸ªå‡½æ•°ç»™æ•°ç»„èµ‹å€¼ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯å®¹é‡å°±ç»´æŒåŸé›†åˆçš„å®¹é‡ä¸å˜ï¼Œå¤§æ¦‚è€ƒè™‘çš„æ˜¯ç”±å¦ä¸€ä¸ªé›†åˆæ„é€ è€Œæ¥çš„PriorityQueueå¾ˆå¤§æ¦‚ç‡ä¸ä¼šå†æ·»åŠ å…ƒç´  private void heapify() { for (int i = (size >>> 1) - 1; i >= 0; i--) siftDown(i, (E) queue[i]); } è¿™ä¸ªå‡½æ•°å°±æ˜¯ç»™æ•°ç»„åŸåœ°å †åŒ–äº†ï¼Œ(size&gt;&gt;&gt;1)-1å°±æ˜¯æ•°ç»„æœ€åä¸€ä¸ªéå¶èŠ‚ç‚¹çš„ä½ç½®ï¼Œä»è¿™é‡Œå¼€å§‹å‘ä¸‹å †åŒ–ã€‚ 4.2 æ‰©å®¹PriorityQueueçš„é»˜è®¤æ„é€ æ–¹æ³•æ˜¯ï¼š public PriorityQueue() { this(DEFAULT_INITIAL_CAPACITY, null); } æ‰¾åˆ°å®ƒå¯¹åº”çš„æ„é€ æ–¹æ³•ï¼š public PriorityQueue(int initialCapacity, Comparator&lt;? super E> comparator) { // Note: This restriction of at least one is not actually needed, // but continues for 1.5 compatibility if (initialCapacity &lt; 1) throw new IllegalArgumentException(); this.queue = new Object[initialCapacity]; this.comparator = comparator; } å®ƒéœ€è¦ä¼ å…¥ä¸€ä¸ªæ•°ç»„çš„åˆå§‹å®¹é‡å’Œä¸€ä¸ªcomparatorï¼Œè€Œæˆ‘ä»¬åˆšæ‰çœ‹åˆ°é»˜è®¤çš„å®¹é‡æ˜¯DEFAULT_INITIAL_CAPACITYï¼Œæ‰¾åˆ°å®ƒçš„å®šä¹‰ private static final int DEFAULT_INITIAL_CAPACITY = 11; è¯´æ˜é»˜è®¤æ„é€ æ–¹æ³•çš„åˆå§‹å®¹é‡æ˜¯11ã€‚è¿˜è®°å¾—åœ¨offeræ–¹æ³•ä¸­è§è¿‡ä¸€ä¸ªgrowæ–¹æ³•ï¼Œæ‰¾åˆ°å®šä¹‰ï¼š private void grow(int minCapacity) { int oldCapacity = queue.length; // Double size if small; else grow by 50% // å¦‚æœæ•°ç»„å®¹é‡å°äº64ä¸ªï¼Œåˆ™ç¿»å€ï¼Œå¦åˆ™1.5å€å¢é•¿ int newCapacity = oldCapacity + ((oldCapacity &lt; 64) ? (oldCapacity + 2) : (oldCapacity >> 1)); // overflow-conscious code if (newCapacity - MAX_ARRAY_SIZE > 0) newCapacity = hugeCapacity(minCapacity); queue = Arrays.copyOf(queue, newCapacity); } éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸åŒäºArrayListç›´æ¥1.5å€æ‰©å®¹ï¼ŒPriorityQueueåœ¨æ•°ç»„å®¹é‡å°äº64ä¸ªçš„æ—¶å€™æŒ‰2å€+2æ‰©å®¹ã€‚æˆ‘æƒ³ç†Ÿæ‚‰å †çš„æœ‹å‹åº”è¯¥ä¹Ÿèƒ½æƒ³åˆ°äº†ï¼Œ2å€+2æ­£å¥½æ˜¯å½“å‰æ’å…¥çš„èŠ‚ç‚¹å³å­©å­çš„ä½ç½®ã€‚è¯´æ˜jdké»˜è®¤åœ¨ä¸€å¼€å§‹å †çš„å°ºå¯¸å¾ˆå°çš„æƒ…å†µä¸‹ä¸€æ—¦æ’å…¥äº†ä¸€ä¸ªèŠ‚ç‚¹åˆ™å¾ˆæœ‰å¯èƒ½è¦æ’å…¥å®ƒçš„åŒå­©å­èŠ‚ç‚¹ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jdk","slug":"jdk","permalink":"https://www.codetool.top/tags/jdk/"},{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://www.codetool.top/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"}]},{"title":"å¸¦æœ‰ä¼˜å…ˆçº§çš„å®Œå…¨äºŒå‰æ ‘-å †","slug":"å¸¦æœ‰ä¼˜å…ˆçº§çš„å®Œå…¨äºŒå‰æ ‘-å †","date":"2020-02-09T15:12:12.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/å¸¦æœ‰ä¼˜å…ˆçº§çš„å®Œå…¨äºŒå‰æ ‘-å †/","link":"","permalink":"https://www.codetool.top/article/%E5%B8%A6%E6%9C%89%E4%BC%98%E5%85%88%E7%BA%A7%E7%9A%84%E5%AE%8C%E5%85%A8%E4%BA%8C%E5%8F%89%E6%A0%91-%E5%A0%86/","excerpt":"","text":"1 å †çš„æ¦‚å¿µå †æ˜¯ä¸€ç§å®Œå…¨äºŒå‰æ ‘(é™¤äº†æœ€åä¸€å±‚æ¯ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹éƒ½æ˜¯æ»¡çš„ï¼Œæœ€åä¸€å±‚çš„èŠ‚ç‚¹ä¹Ÿæ˜¯é›†ä¸­åœ¨å·¦è¾¹) è™½ç„¶å †æ˜¯ä¸€æ£µäºŒå‰æ ‘ï¼Œä½†ä¹Ÿç”±äºå®ƒæ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ ‘çš„åŸå› ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ•°ç»„æ¥è¡¨ç¤ºå †ã€‚ï¼ˆå±‚æ¬¡éå†ï¼‰ æˆ‘ä»¬å¸¸ç”¨åˆ°çš„å †æ˜¯æœ€å¤§å †å’Œæœ€å°å † 1.1 æœ€å°å †æœ€å°å †è¦æ±‚ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªçˆ¶ç»“ç‚¹æ¥è¯´ï¼Œå…¶å­ç»“ç‚¹çš„å€¼éƒ½å¤§äºè¿™ä¸ªçˆ¶èŠ‚ç‚¹ã€‚ å¯¹äºè¿™ä¸ªæœ€å°å †ï¼Œå¯ä»¥ç”¨æ•°ç»„è¡¨ç¤ºä¸º[1,3,30,22,10,50] 1.2 æœ€å¤§å †æœ€å¤§å †å’Œæœ€å°å †ç›¸åï¼Œå¯¹äºä»»æ„ä¸€ä¸ªçˆ¶ç»“ç‚¹æ¥è¯´ï¼Œå…¶å­ç»“ç‚¹çš„å€¼éƒ½å°äºè¿™ä¸ªçˆ¶èŠ‚ç‚¹ã€‚ 2 å †çš„æ“ä½œ2.1 æ’å…¥æˆ‘ä»¬çœ‹å¦‚ä½•æ„å»ºä¸€ä¸ªæœ€å°å †ï¼š å¯¹äº[30,15,5,11,22,2] å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬ä¾æ¬¡æŒ‰æ•°ç»„çš„é¡ºåºæ”¾å…¥äºŒå‰æ ‘çš„èŠ‚ç‚¹ï¼Œä¸€æ—¦å‡ºç°å­èŠ‚ç‚¹æ¯”çˆ¶èŠ‚ç‚¹çš„å€¼å°ï¼Œäº¤æ¢å­èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹ã€‚ æˆ‘ä»¬ç§°è¿™ä¸ªæ“ä½œä¸ºå‘ä¸Šå †åŒ–ï¼Œå †åŒ–åçš„æ•°ç»„ä¸º[2,11,5,30,22,15] 2.2 åˆ é™¤å°†å †æ ‘ä¸­å¾…åˆ é™¤çš„èŠ‚ç‚¹Aä¸å †æ ‘ä¸­çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹Bäº’æ¢ï¼Œç„¶åè°ƒæ•´èŠ‚ç‚¹Båˆ°åˆé€‚çš„ä½ç½®ï¼Œæœ€åä»å †æ ‘ä¸­åˆ é™¤æ’åœ¨å †æ•°ç»„æœ€åçš„èŠ‚ç‚¹Aã€‚ ä¸è¿‡åœ¨å †è¿™ä¸ªæ•°æ®ç»“æ„ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸åªéœ€è¦åˆ é™¤å †é¡¶å…ƒç´ ã€‚ 3 å †çš„åº”ç”¨3.1 ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°ä¼˜å…ˆçº§é˜Ÿåˆ—çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œä½†æ˜¯ç”¨å †æ¥å®ç°æ˜¯æœ€ç›´æ¥ã€æœ€é«˜æ•ˆçš„ã€‚å †å’Œä¼˜å…ˆçº§é˜Ÿåˆ—éå¸¸ç›¸ä¼¼ï¼Œä¸€ä¸ªå †å°±å¯ä»¥çœ‹ä½œä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚ä»ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­å–å‡ºä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ï¼Œå°±ç›¸å½“äºå–å‡ºå †é¡¶å…ƒç´ ã€‚ 3.2 å †æ’åºå †æ’åºå®é™…ä¸Šå°±æ˜¯ä¸æ–­è·å–å †é¡¶å…ƒç´ ã€‚ å¯¹äºæœ€å¤§å †æ¥è¯´ï¼Œæˆ‘ä»¬çŸ¥é“æœ€å¤§å †çš„é˜Ÿé¦–å…ƒç´ æ˜¯æ•´ä¸ªå †æœ€å¤§çš„å…ƒç´ ï¼Œå½“æˆ‘ä»¬åˆ é™¤å¹¶å¾—åˆ°å †é¡¶å…ƒç´ æ—¶ï¼Œå‰©ä¸‹çš„å…ƒç´ ä¼šé‡æ–°å †åŒ–ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„å †é¡¶å…ƒç´ ï¼Œè¿™æ ·ä¸æ–­åˆ é™¤å¹¶è·å–å †é¡¶å…ƒç´ ï¼Œæœ€ç»ˆæ‹¿åˆ°çš„å°±æ˜¯ä¸€ä¸ªä»å¤§åˆ°å°çš„æœ‰åºåºåˆ—ã€‚ å½“ç„¶ï¼Œç”¨æ•°ç»„ä»£è¡¨å †ï¼Œæˆ‘ä»¬åœ¨æ’åºçš„æ—¶å€™å¯ä»¥ä¸å¿…åˆ é™¤å…ƒç´ ï¼Œåªéœ€è¦å°†åŸå †é¡¶å…ƒç´ ç§»åŠ¨åˆ°æ•°ç»„æœ«å°¾ï¼Œå°†å‰©ä¸‹çš„å…ƒç´ é‡æ–°å †åŒ–ï¼Œç„¶åé‡å¤è¯¥æ­¥éª¤ï¼Œæœ€åå°±èƒ½å¾—åˆ°ä¸€ä¸ªä»å°åˆ°å¤§æ’åºçš„æ•°ç»„ã€‚ 4 é™„ï¼šä»£ç ç¤ºä¾‹4.1 å®ç°ä¸€ä¸ªå®Œæ•´çš„æœ€å¤§å †å¹¶å †æ’åºä¸€ä¸ªæ•°ç»„public class MaxHeap { private int[] heap; private int size; // ç”¨æ•°ç»„æ¥åˆå§‹åŒ–ä¸€ä¸ªå † public MaxHeap(int[] source){ heap = source; size = source.length; heapify(); } public int get(int index){ return heap[index]; } public int size() { return size; } //ç§»é™¤ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä»è¿™ä¸ªå…ƒç´ å¼€å§‹å‘ä¸‹å †åŒ– public int removeAt(int index){ int node = heap[index]; swap(index,size-1); size--; downShift(index); return node; } //æ„å»ºå † public void heapify(){ for(int i = 0; i &lt; size; i++){ int position = i; upShift(position); } } //å‘ä¸Šå †åŒ– public void upShift(int position){ int parent = getParent(position); while (position>0 &amp;&amp; (heap[position]>heap[parent])){ swap(position,parent); position = parent; parent = getParent(position); } } //å‘ä¸‹å †åŒ– public void downShift(int position){ int children1 = position*2+1; int children2 = position*2+2; while (children1&lt;size){ int toSwap = children1; if(children2&lt;size){ toSwap = heap[children1]>heap[children2]?children1:children2; } if(heap[toSwap]>heap[position]){ swap(position,toSwap); position = toSwap; children1 = position*2+1; children2 = position*2+2; }else break; } } public void swap(int source,int destination){ int cache = heap[source]; heap[source] = heap[destination]; heap[destination] = cache; } /** * è®¡ç®—çˆ¶èŠ‚ç‚¹ä¸‹æ ‡ */ private int getParent(int child) { return (child + 1) / 2 - 1; } @Override public String toString() { StringBuilder sb = new StringBuilder(\"[\"); for (int i = 0;i&lt;size;i++){ sb.append(heap[i]); if(i!=size-1) sb.append(\",\"); } return sb.append(\"]\").toString(); } public static void main(String[] args) { MaxHeap heap = new MaxHeap(new int[]{30,15,5,11,22,2}); System.out.println(heap); while (heap.size()!=0){ //å †æ’åºå¾—åˆ°ä¸€ä¸ªåºåˆ— int head = heap.removeAt(0); System.out.println(head); } //æ“ä½œå®Œåæ•°ç»„é‡Œå…ƒç´ çš„æ˜¯ä»å°åˆ°å¤§æ’åºçš„ System.out.println(Arrays.toString(heap.heap)); } } è¿è¡Œç»“æœï¼š [30,22,5,11,15,2] 30 22 15 11 5 2 [2, 5, 11, 15, 22, 30]4.2 å †æ’åºç®—æ³•Javaå®ç°å®é™…çš„å †æ’åºä¸­ï¼Œæˆ‘ä»¬è‚¯å®šä¸ç”¨å†™è¿™ä¹ˆé•¿ä¸€æ®µä»£ç ï¼Œä¸“é—¨æŠŠæ’åºçš„é€»è¾‘æå–å‡ºæ¥å°±è¡Œäº†ï¼š æ¥è‡ªå †æ’åºç®—æ³•æ€è·¯ä»¥åŠJavaå®ç°_long_lanceçš„åšå®¢-CSDNåšå®¢ public class HeapSorting { public static void main(String[] args) { int[] a=new int[]{0,9,8}; Sort(a,a.length-1); for(int i:a){ System.out.println(i); } } //é€šè¿‡é€’å½’å‘ä¸‹å †åŒ– public static void MaxHeapify(int[] a,int index,int size){ int l=2*index; int r=2*index+1; int largest=index; if(l&lt;=size &amp;&amp; a[l]>a[index]){ largest=l; } if(r&lt;=size &amp;&amp; a[r]>a[largest]){ largest=r; } if(largest!=index){ int temp=a[largest]; a[largest]=a[index]; a[index]=temp; MaxHeapify(a,largest,size); } } //æ•°ç»„å †åŒ–ï¼Œæ³¨æ„ä¸Šé¢å®ç°å †çš„ä»£ç ä¸­æ„å»ºå †æ˜¯é€šè¿‡å‘ä¸Šå †åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥ä¼˜åŒ–æˆå°†æ‰€æœ‰éå¶èŠ‚ç‚¹å‘ä¸‹å †åŒ– public static void HeapBuild(int[] a,int size){ for(int i=size/2;i>=1;i--){ MaxHeapify(a,i,size); } } public static void Sort(int[] a,int size){ HeapBuild(a,size); for(int i=size;i>=2;i--){ //æ¯æ¬¡å°†å †é¡¶å…ƒç´ ç§»åˆ°æ•°ç»„æœ«å°¾ï¼Œç„¶åå†å‘ä¸‹å †åŒ– int temp=a[i]; a[i]=a[1]; a[1]=temp; MaxHeapify(a,1,i-1); } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"å¼±å¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘-çº¢é»‘æ ‘","slug":"å¼±å¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘-çº¢é»‘æ ‘","date":"2020-02-09T13:03:21.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/å¼±å¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘-çº¢é»‘æ ‘/","link":"","permalink":"https://www.codetool.top/article/%E5%BC%B1%E5%B9%B3%E8%A1%A1%E7%9A%84%E4%BA%8C%E5%8F%89%E6%9F%A5%E6%89%BE%E6%A0%91-%E7%BA%A2%E9%BB%91%E6%A0%91/","excerpt":"","text":"ä¸ºä»€ä¹ˆä¼šå‡ºç°çº¢é»‘æ ‘ï¼Ÿ ä¹‹å‰æˆ‘ä»¬æè¿‡AVLæ ‘-è‡ªå¹³è¡¡çš„äºŒå‰æœç´¢æ ‘ï¼Œä½†æ˜¯ä¸€æ—¦æ ‘çš„èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼ŒAVLæ ‘ä¸ºäº†ç»´æŒç»å¯¹å¹³è¡¡ï¼Œéœ€è¦é¢‘ç¹åœ°è¿›è¡Œæ—‹è½¬æ“ä½œã€‚é‚£ä¹ˆä¸€æ—¦æˆ‘ä»¬æ’å…¥ã€åˆ é™¤æ“ä½œæ¯”ä¾‹ç›¸è¾ƒæŸ¥è¯¢æ“ä½œå˜å¤šçš„æ—¶å€™ï¼ŒAVLæ ‘çš„æ•ˆç‡å°±æ˜¾å¾—è¾ƒä¸ºä½ä¸‹äº†ã€‚ 1 çº¢é»‘æ ‘çš„å®šä¹‰é¦–å…ˆï¼Œçº¢é»‘æ ‘æ˜¯ä¸€ä¸ªäºŒå‰æœç´¢æ ‘ï¼Œå®ƒåŒæ—¶æ»¡è¶³ä»¥ä¸‹ç‰¹æ€§ï¼š æ¯ä¸ªèŠ‚ç‚¹è¦ä¹ˆæ˜¯é»‘è‰²ï¼Œè¦ä¹ˆæ˜¯çº¢è‰² æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰² å¦‚æœèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œé‚£ä¹ˆå®ƒçš„å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²çš„ï¼ˆåä¹‹ï¼Œä¸ä¸€å®šéœ€è¦æˆç«‹ï¼‰ ä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹æˆ–ç©ºå­èŠ‚ç‚¹çš„æ¯æ¡è·¯å¾„ï¼Œéƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ï¼ˆæˆ‘ä»¬å°†ç©ºå­èŠ‚ç‚¹è®°ä¸ºé»‘è‰²çš„ï¼‰ çº¢é»‘æ ‘ä¸è¿½æ±‚ç»å¯¹å¹³è¡¡ï¼Œå…¶åªéœ€ä¿è¯æœ€é•¿è·¯å¾„ä¸è¶…è¿‡æœ€çŸ­è·¯å¾„çš„2å€ã€‚ 2 çº¢é»‘æ ‘çš„å˜æ¢æ“ä½œçº¢é»‘æ ‘é™¤æ ¹èŠ‚ç‚¹å¤–æ‰€æœ‰æ’å…¥çš„ç‚¹é»˜è®¤ä¸ºçº¢è‰²ã€‚ä¸ºäº†ç»´æŒä¸€æ£µçº¢é»‘æ ‘ï¼Œæœ‰ä¸‰ç§å˜æ¢æ“ä½œã€‚ 2.1 æ”¹å˜é¢œè‰²çº¢è‰²èŠ‚ç‚¹å˜ä¸ºé»‘è‰²èŠ‚ç‚¹ï¼Œé»‘è‰²èŠ‚ç‚¹å˜ä¸ºçº¢è‰²èŠ‚ç‚¹ã€‚ 2.2 å·¦æ—‹å’ŒAVLæ ‘ä¸€æ ·ï¼Œä»¥ä¸­é—´ç»“ç‚¹ä¸ºè½´ï¼Œä¸­é—´ç»“ç‚¹çš„å·¦å­èŠ‚ç‚¹å˜ä¸ºåŸæ ¹èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ï¼Œå†ä»¥ä¸­é—´ç»“ç‚¹ä¸ºæ ¹èŠ‚ç‚¹ï¼ŒæŠŠåŸæ ¹èŠ‚ç‚¹è¿åˆ°å·¦å­èŠ‚ç‚¹ä¸Šã€‚ 2.3 å³æ—‹å’Œå·¦æ—‹ç±»ä¼¼çš„æ“ä½œ 3 çº¢é»‘æ ‘çš„æ“ä½œ3.1 æ’å…¥3.1.1 å˜é¢œè‰²çš„æƒ…å†µè¦æ’å…¥çš„ä½ç½®çš„çˆ¶èŠ‚ç‚¹æ˜¯çº¢è‰²ï¼Œä¸”çˆ¶èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹ä¹Ÿæ˜¯çº¢è‰²ï¼Œåˆ™ï¼š æŠŠçˆ¶èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹è®¾ä¸ºé»‘è‰² æŠŠçˆ¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹(ç¥–çˆ¶èŠ‚ç‚¹)è®¾ä¸ºçº¢è‰²(å¦‚æœç¥–çˆ¶èŠ‚ç‚¹æ˜¯æ ¹èŠ‚ç‚¹ï¼Œä¸èƒ½å˜é¢œè‰²) å®šä½åˆ°çˆ¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œåˆ†æä¸‹ä¸€æ­¥çš„å˜æ¢è§„åˆ™ æˆ‘ä»¬çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œæ’å…¥6è¿™ä¸ªèŠ‚ç‚¹ï¼Œå‡ºç°ä¸¤ä¸ªçº¢è‰²èŠ‚ç‚¹ä¸Šä¸‹ç›¸é‚»ï¼Œå¼€å§‹å˜é¢œè‰²ï¼Œå°†7ã€13å˜ä¸ºé»‘è‰²ï¼Œ12å˜ä¸ºçº¢è‰²ï¼Œå¹¶å®šä½åˆ°12ï¼Œåˆ†ææ¥ä¸‹æ¥è¦è¿›è¡Œçš„æ“ä½œã€‚ 3.1.2 æ—‹è½¬çš„æƒ…å†µéå¸¸ç±»ä¼¼AVLï¼Œä¸€æ—¦å˜å®Œé¢œè‰²è¿˜å‡ºç°çº¢è‰²çš„èŠ‚ç‚¹ç›¸é‚»ï¼Œè¿›è¡Œæ—‹è½¬æ“ä½œã€‚ æŠ˜çº¿å¼å¤±è¡¡ï¼ˆåšä¸»è‡ªå·±æƒ³å‡ºæ¥çš„æ¦‚å¿µï¼‰ï¼ŒåŒæ—‹ æˆ‘ä»¬ç»§ç»­ä¸Šé¢é‚£å¼ å›¾çš„ä¾‹å­ï¼Œå®šä½åˆ°12åï¼Œå‘ç°ä»ç„¶å‡ºç°ä¸Šä¸‹ä¸¤ä¸ªçº¢è‰²èŠ‚ç‚¹ç›¸é‚»ï¼Œæ­¤æ—¶5-12-7-6å½¢æˆæŠ˜çº¿å¼å¤±è¡¡ï¼Œå’ŒAVLçš„æ–¹æ³•ä¸€æ ·å…ˆå·¦æ—‹å†å³æ—‹ã€‚ æ³¨æ„å³æ—‹ååŸæ ¹èŠ‚ç‚¹è¦å˜ä¸ºçº¢è‰²ï¼Œæ–°æ ¹èŠ‚ç‚¹å˜ä¸ºé»‘è‰²ã€‚ ç›´çº¿å¼å¤±è¡¡ï¼Œå•æ—‹ ç›´çº¿å¼å¤±è¡¡å°±åªæ˜¯å•ç‹¬è¿›è¡Œå·¦æ—‹æˆ–å³æ—‹ã€‚æ—‹è½¬å®Œæˆåä¹Ÿè¦è¿›è¡ŒåŸæ ¹èŠ‚ç‚¹è¦å˜ä¸ºçº¢è‰²ï¼Œæ–°æ ¹èŠ‚ç‚¹å˜ä¸ºé»‘è‰²çš„æ“ä½œã€‚ ï¼ˆæ—‹è½¬åçš„å˜é¢œè‰²å®è´¨å°±æ˜¯ç»´æŠ¤ä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹æˆ–ç©ºå­èŠ‚ç‚¹çš„æ¯æ¡è·¯å¾„ï¼Œéƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹çš„æ€§è´¨ï¼‰ 3.2 åˆ é™¤åˆ é™¤æ“ä½œç±»ä¼¼äºŒå‰æŸ¥æ‰¾æ ‘çš„åˆ é™¤ï¼Œä½†åˆ é™¤ä¹‹åè‹¥ä¸æ»¡è¶³ä¸€æ£µçº¢é»‘æ ‘çš„æ€§è´¨åˆ™ä½¿ç”¨ä¸€ç³»åˆ—ç€è‰²æ“ä½œæ¥é‡æ–°è®©å®ƒæˆä¸ºä¸€æ£µçº¢é»‘æ ‘ã€‚ å…·ä½“æ“ä½œå‚è€ƒç›®å‰æœ€è¯¦ç»†çš„çº¢é»‘æ ‘åŸç†åˆ†æï¼ˆå¤§é‡å›¾ç‰‡+è¿‡ç¨‹æ¨å¯¼ï¼ï¼ï¼ï¼‰_Yå…ˆæ£®0.0-CSDNåšå®¢","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"leetcode55-è·³è·ƒæ¸¸æˆ","slug":"leetcode55-è·³è·ƒæ¸¸æˆ","date":"2020-02-08T17:31:49.000Z","updated":"2020-04-22T09:27:27.142Z","comments":true,"path":"article/leetcode55-è·³è·ƒæ¸¸æˆ/","link":"","permalink":"https://www.codetool.top/article/leetcode55-%E8%B7%B3%E8%B7%83%E6%B8%B8%E6%88%8F/","excerpt":"","text":"1 åŸé¢˜åŸé¢˜ ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ï¼Œä½ æœ€åˆä½äºæ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚ æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä½ åœ¨è¯¥ä½ç½®å¯ä»¥è·³è·ƒçš„æœ€å¤§é•¿åº¦ã€‚ åˆ¤æ–­ä½ æ˜¯å¦èƒ½å¤Ÿåˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š [2,3,1,1,4]è¾“å‡ºï¼š trueè§£é‡Šï¼š æˆ‘ä»¬å¯ä»¥å…ˆè·³ 1 æ­¥ï¼Œä»ä½ç½® 0 åˆ°è¾¾ ä½ç½® 1, ç„¶åå†ä»ä½ç½® 1 è·³ 3 æ­¥åˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ã€‚ ç¤ºä¾‹2: è¾“å…¥ï¼š [3,2,1,0,4]è¾“å‡ºï¼š falseè§£é‡Šï¼š æ— è®ºæ€æ ·ï¼Œä½ æ€»ä¼šåˆ°è¾¾ç´¢å¼•ä¸º 3 çš„ä½ç½®ã€‚ä½†è¯¥ä½ç½®çš„æœ€å¤§è·³è·ƒé•¿åº¦æ˜¯ 0 ï¼Œ æ‰€ä»¥ä½ æ°¸è¿œä¸å¯èƒ½åˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ã€‚ 2 è§£æ³•2.1 æ€æƒ³ åŠ¨æ€è§„åˆ’ï¼Œçœ‹æŸä¸€ä¸ªç‚¹æ˜¯å¦èƒ½åˆ°è¾¾æœ€åä¸€ä¸ªç‚¹ï¼Œå¦‚æœèƒ½ï¼Œé‚£æ˜¯å¦å¦å¤–æŸä¸ªç‚¹èƒ½åˆ°è¾¾è¿™ä¸ªç‚¹ã€‚ è´ªå¿ƒç®—æ³•ï¼Œå¦‚æœèƒ½åˆ°è¾¾ç‚¹aï¼Œé‚£ä¹ˆaä¹‹å‰çš„ç‚¹ä¹Ÿä¸€å®šèƒ½å¤Ÿåˆ°è¾¾ã€‚ä»å³å¾€å·¦æ‰¾åˆ°ä¸€ä¸ªèƒ½åˆ°è¾¾æœ€åä¸€ä¸ªç‚¹çš„ä½ç½®ï¼Œç„¶åç»§ç»­å¾€å·¦æ‰¾åˆ°ä¸€ä¸ªèƒ½åˆ°è¾¾å½“å‰ç‚¹çš„ä½ç½®ï¼Œå¦‚æ­¤å¾ªç¯ï¼Œå¦‚æœèƒ½æ‰¾åˆ°ç¬¬ä¸€ä¸ªç‚¹åˆ™è¿”å›trueã€‚ 2.2 ä»£ç åŠ¨æ€è§„åˆ’+è®°å¿†ï¼š class Solution { int[] numsGlobal; Boolean[] canJump; public boolean canJump(int[] nums) { numsGlobal = nums; canJump = new Boolean[nums.length]; return canJumpTo(nums.length-1); } public boolean canJumpTo(int index){ if(index == 0) return true; if(canJump[index]!=null) return canJump[index]; for(int i = 0;i&lt;index;i++){ if(numsGlobal[i]>=index-i) { if(canJumpTo(i)) { canJump[i] = true; return true; } } } canJump[index] = false; return false; } } è´ªå¿ƒç®—æ³•ï¼š(æ¥æºleetcodeå®˜æ–¹) public class Solution { public boolean canJump(int[] nums) { int lastPos = nums.length - 1; for (int i = nums.length - 1; i >= 0; i--) { if (i + nums[i] >= lastPos) { lastPos = i; } } return lastPos == 0; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"ç½‘ç»œç¼–ç¨‹ä¹‹AIO","slug":"ç½‘ç»œç¼–ç¨‹ä¹‹AIO","date":"2020-02-08T15:53:57.000Z","updated":"2020-02-08T16:52:20.965Z","comments":true,"path":"article/ç½‘ç»œç¼–ç¨‹ä¹‹AIO/","link":"","permalink":"https://www.codetool.top/article/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B9%8BAIO/","excerpt":"","text":"1 AIOä»‹ç»AIOæ˜¯JDK1.7å¼•å…¥çš„ï¼Œä¹Ÿç§°ä¸ºNIO 2.0 NIOçš„åŒæ­¥éé˜»å¡ç±»ä¼¼äºè½®è¯¢ï¼Œè®©Selectorå»è¯¢é—®å„ä¸ªé€šé“çš„çŠ¶æ€ã€‚ è€ŒAIOåˆ™æ˜¯é€šè¿‡Futureå®ç°çœŸæ­£çš„å¼‚æ­¥ï¼Œè®©IOå°±ç»ªæ—¶ç”±ç³»ç»Ÿæ¥é€šçŸ¥åº”ç”¨ç¨‹åºã€‚ æ ¸å¿ƒç±»ï¼š AsyncServerSocketChannel AsyncSocketChannel å½“è¿›è¡Œå¦‚ä¸‹æ“ä½œæ—¶ï¼Œéƒ½æ˜¯å¼‚æ­¥çš„æ“ä½œ connect/accept write read å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹æ¡ˆå¤„ç†ç»“æœï¼š é€šè¿‡è¿”å›çš„Futureå¯¹è±¡è·å–ç»“æœ é€šè¿‡CompletionHandleræ¥å£å®ç°å›è°ƒ å¯¹äºCompletionHandleræ¥å£ï¼Œé‡Œé¢æœ‰completedå’Œfailedæ–¹æ³•ï¼Œåˆ†åˆ«ä»£è¡¨æˆåŠŸåçš„å›è°ƒå’Œå¤±è´¥åçš„å›è°ƒã€‚ 2 ä»£ç ç¤ºä¾‹å®ç°ä¸€ä¸ªå®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å‘é€æ•°æ®ï¼ŒæœåŠ¡ç«¯æŒ‰åŸæ•°æ®è¿”å›çš„ç¨‹åºã€‚ æœåŠ¡ç«¯ï¼š public class Server { final String LOCALHOST = \"localhost\"; final int DEFAULT_PORT = 8888; AsynchronousServerSocketChannel serverSocketChannel; private void close(Closeable... closeable){ for(Closeable c:closeable){ try { c.close(); } catch (IOException e) { e.printStackTrace(); } } } public void start(){ try { // ç»‘å®šç›‘å¬ç«¯å£ serverSocketChannel = AsynchronousServerSocketChannel.open(); serverSocketChannel.bind(new InetSocketAddress(LOCALHOST,DEFAULT_PORT)); System.out.println(\"å¯åŠ¨æœåŠ¡å™¨ï¼Œç›‘å¬ç«¯å£ï¼š\"+DEFAULT_PORT); while (true) { serverSocketChannel.accept(null,new AcceptHandler()); System.in.read(); } } catch (IOException e) { e.printStackTrace(); } finally { close(serverSocketChannel); } } private class AcceptHandler implements CompletionHandler&lt;AsynchronousSocketChannel,Object>{ @Override public void completed(AsynchronousSocketChannel result, Object attachment) { if(serverSocketChannel.isOpen()){ serverSocketChannel.accept(null,this); } AsynchronousSocketChannel clientChannel = result; if(clientChannel!=null&amp;&amp;clientChannel.isOpen()){ ClientHandler handler = new ClientHandler(clientChannel); ByteBuffer buffer = ByteBuffer.allocate(1024); Map&lt;String,Object> info = new HashMap&lt;>(); info.put(\"type\",\"read\"); info.put(\"buffer\",buffer); clientChannel.read(buffer,info,handler); } } @Override public void failed(Throwable exc, Object attachment) { // å¤„ç†é”™è¯¯ exc.printStackTrace(); if(serverSocketChannel.isOpen()){ serverSocketChannel.accept(null,this); } } } private class ClientHandler implements CompletionHandler&lt;Integer,Object>{ private AsynchronousSocketChannel clientChannel; public ClientHandler(AsynchronousSocketChannel channel){ this.clientChannel = channel; } @Override public void completed(Integer result, Object attachment) { Map&lt;String,Object> info = (Map&lt;String, Object>) attachment; String type = (String) info.get(\"type\"); if(type.equals(\"read\")){ ByteBuffer buffer = (ByteBuffer) info.get(\"buffer\"); buffer.flip(); info.put(\"type\",\"write\"); clientChannel.write(buffer,info,this); buffer.clear(); }else if(type.equals(\"write\")){ ByteBuffer buffer = ByteBuffer.allocate(1024); info.put(\"type\",\"read\"); info.put(\"buffer\",buffer); clientChannel.read(buffer,info,this); } } @Override public void failed(Throwable exc, Object attachment) { //å¤„ç†é”™è¯¯ } } public static void main(String[] args) { Server server = new Server(); server.start(); } } å®¢æˆ·ç«¯ï¼š public class Client { final String LOCALHOST = \"localhost\"; final int DEFAULT_PORT = 8888; AsynchronousSocketChannel clientSocketChannel; private void close(Closeable... closeable){ for(Closeable c:closeable){ try { c.close(); } catch (IOException e) { e.printStackTrace(); } } } public void start(){ // åˆ›å»ºchannel try { clientSocketChannel = AsynchronousSocketChannel.open(); Future&lt;Void> future = clientSocketChannel.connect(new InetSocketAddress(LOCALHOST, DEFAULT_PORT)); future.get(); // ç­‰å¾…ç”¨æˆ·çš„è¾“å…¥ BufferedReader consoleReader = new BufferedReader(new InputStreamReader(System.in)); while(true){ String input = consoleReader.readLine(); byte[] inputBytes = input.getBytes(); ByteBuffer buffer = ByteBuffer.wrap(inputBytes); Future&lt;Integer> writeResult = clientSocketChannel.write(buffer); writeResult.get(); buffer.flip(); Future&lt;Integer> readResult = clientSocketChannel.read(buffer); readResult.get(); String echo = new String(buffer.array()); buffer.clear(); System.out.println(echo); } } catch (IOException e) { e.printStackTrace(); } catch (InterruptedException e) { e.printStackTrace(); } catch (ExecutionException e) { e.printStackTrace(); } finally { close(clientSocketChannel); } } public static void main(String[] args) { Client client = new Client(); client.start(); } }","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"IO","slug":"IO","permalink":"https://www.codetool.top/tags/IO/"},{"name":"ç½‘ç»œç¼–ç¨‹","slug":"ç½‘ç»œç¼–ç¨‹","permalink":"https://www.codetool.top/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"},{"name":"AIO","slug":"AIO","permalink":"https://www.codetool.top/tags/AIO/"}]},{"title":"å¤šå‰å¹³è¡¡æŸ¥æ‰¾æ ‘-Bæ ‘ä¸B+æ ‘","slug":"å¤šå‰å¹³è¡¡æŸ¥æ‰¾æ ‘-Bæ ‘ä¸B-æ ‘","date":"2020-02-08T13:47:51.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/å¤šå‰å¹³è¡¡æŸ¥æ‰¾æ ‘-Bæ ‘ä¸B-æ ‘/","link":"","permalink":"https://www.codetool.top/article/%E5%A4%9A%E5%8F%89%E5%B9%B3%E8%A1%A1%E6%9F%A5%E6%89%BE%E6%A0%91-B%E6%A0%91%E4%B8%8EB-%E6%A0%91/","excerpt":"","text":"æœ¬æ–‡å‚è€ƒé“¾æ¥ï¼š ä»Bæ ‘ã€B+æ ‘ã€B*æ ‘è°ˆåˆ°R æ ‘_ç£ç›˜,æ•°æ®ç»“æ„,å­˜å‚¨_ç»“æ„ä¹‹æ³• ç®—æ³•ä¹‹é“-CSDNåšå®¢ ã€æ•°æ®ç»“æ„ã€‘Bæ ‘ã€B+æ ‘è¯¦è§£ - Assassinã® - åšå®¢å›­ BTree.java 1 Bæ ‘çš„ç”±æ¥Bæ ‘æ˜¯ä¸ºäº†ç£ç›˜æˆ–å…¶å®ƒå­˜å‚¨è®¾å¤‡è€Œè®¾è®¡çš„ä¸€ç§å¤šå‰å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼Œè®¸å¤šæ•°æ®åº“ç³»ç»Ÿéƒ½ä¸€èˆ¬ä½¿ç”¨Bæ ‘æˆ–è€…Bæ ‘çš„å„ç§å˜å½¢ç»“æ„ï¼Œå¦‚B+æ ‘ï¼ŒB*æ ‘æ¥å­˜å‚¨ä¿¡æ¯ã€‚ åœ¨å¤§è§„æ¨¡çš„æ•°æ®æŸ¥æ‰¾ä¸­ï¼Œå³ä½¿æ˜¯å¹³è¡¡äºŒå‰æ ‘ä¹Ÿä¼šäº§ç”Ÿè¿‡æ·±çš„æ·±åº¦ï¼Œå¯¼è‡´ç£ç›˜é¢‘ç¹å­˜å–ï¼Œå½±å“æŸ¥æ‰¾æ•ˆç‡ã€‚ ç£ç›˜ä¸Šæ•°æ®å¿…é¡»ç”¨ä¸€ä¸ªä¸‰ç»´åœ°å€å”¯ä¸€æ ‡ç¤ºï¼šæŸ±é¢å·ã€ç›˜é¢å·ã€å—å·ã€‚ è¯»/å†™ç£ç›˜ä¸ŠæŸä¸€æŒ‡å®šæ•°æ®éœ€è¦ä¸‹é¢3ä¸ªæ­¥éª¤ï¼š é¦–å…ˆç§»åŠ¨è‡‚æ ¹æ®æŸ±é¢å·ä½¿ç£å¤´ç§»åŠ¨åˆ°æ‰€éœ€è¦çš„æŸ±é¢ä¸Šï¼Œè¿™ä¸€è¿‡ç¨‹è¢«ç§°ä¸ºå®šä½æˆ–æŸ¥æ‰¾ ã€‚ æ ¹æ®ç›˜é¢å·æ¥ç¡®å®šæŒ‡å®šç›˜é¢ä¸Šçš„ç£é“ã€‚ ç›˜é¢ç¡®å®šä»¥åï¼Œç›˜ç‰‡å¼€å§‹æ—‹è½¬ï¼Œå°†æŒ‡å®šå—å·çš„ç£é“æ®µç§»åŠ¨è‡³ç£å¤´ä¸‹ã€‚ è®¿é—®æŸä¸€å…·ä½“ä¿¡æ¯ï¼Œç”±3éƒ¨åˆ†æ—¶é—´ç»„æˆï¼š æŸ¥æ‰¾æ—¶é—´(seek time) ï¼šç£å¤´ç§»åŠ¨åˆ°æŒ‡å®šç£é“çš„æ—¶é—´ã€‚è¿™éƒ¨åˆ†æ—¶é—´ä»£ä»·æœ€é«˜ï¼Œæœ€å¤§å¯è¾¾åˆ°0.1så·¦å³ã€‚ ç­‰å¾…æ—¶é—´(latency time) ï¼šç£ç›˜æ—‹è½¬åˆ°æŒ‡å®šç›˜å—çš„æ—¶é—´ã€‚ç”±äºç›˜ç‰‡ç»•ä¸»è½´æ—‹è½¬é€Ÿåº¦å¾ˆå¿«ï¼Œä¸€èˆ¬ä¸º7200è½¬/åˆ†(ç”µè„‘ç¡¬ç›˜çš„æ€§èƒ½æŒ‡æ ‡ä¹‹ä¸€, å®¶ç”¨çš„æ™®é€šç¡¬ç›˜çš„è½¬é€Ÿä¸€èˆ¬æœ‰5400rpm(ç¬”è®°æœ¬)ã€7200rpmå‡ ç§)ã€‚å› æ­¤ä¸€èˆ¬æ—‹è½¬ä¸€åœˆå¤§çº¦0.0083sã€‚ ä¼ è¾“æ—¶é—´(transmission time) ï¼šæ•°æ®é€šè¿‡ç³»ç»Ÿæ€»çº¿ä¼ é€åˆ°å†…å­˜çš„æ—¶é—´ï¼Œä¸€èˆ¬ä¼ è¾“ä¸€ä¸ªå­—èŠ‚(byte)å¤§æ¦‚0.02us=2*10-8s ç£ç›˜è¯»å–æ•°æ®æ˜¯ä»¥ç›˜å—(block)ä¸ºåŸºæœ¬å•ä½çš„ã€‚ä½äºåŒä¸€ç›˜å—ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½èƒ½è¢«ä¸€æ¬¡æ€§å…¨éƒ¨è¯»å–å‡ºæ¥ã€‚ è€Œç£ç›˜IOä»£ä»·ä¸»è¦èŠ±è´¹åœ¨æŸ¥æ‰¾æ—¶é—´ä¸Šã€‚å› æ­¤æˆ‘ä»¬åº”è¯¥å°½é‡å°†ç›¸å…³ä¿¡æ¯å­˜æ”¾åœ¨åŒä¸€ç›˜å—ï¼ŒåŒä¸€ç£é“ä¸­ã€‚æˆ–è€…è‡³å°‘æ”¾åœ¨åŒä¸€æŸ±é¢æˆ–ç›¸é‚»æŸ±é¢ä¸Šï¼Œä»¥æ±‚åœ¨è¯»/å†™ä¿¡æ¯æ—¶å°½é‡å‡å°‘ç£å¤´æ¥å›ç§»åŠ¨çš„æ¬¡æ•°ï¼Œé¿å…è¿‡å¤šçš„æŸ¥æ‰¾æ—¶é—´ã€‚ æœ‰äº†Bæ ‘ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†èŠ‚ç‚¹å’Œç›˜å—å…³è”èµ·æ¥ï¼Œé¿å…é¢‘ç¹è¿›è¡Œç£ç›˜IOè®¿é—®ã€‚ 2 Bæ ‘çš„æ“ä½œæˆ‘ä»¬ç”¨é˜¶æ•°mæ¥å®šä¹‰ä¸€æ£µBæ ‘ï¼š æ ‘ä¸­æ¯ä¸ªç»“ç‚¹æœ€å¤šå«æœ‰mä¸ªå­©å­ï¼ˆm&gt;=2ï¼‰ï¼Œè‡³å¤šæœ‰m-1ä¸ªå…³é”®å­—ï¼ˆä¸¤æ£µå­æ ‘æŒ‡é’ˆå¤¹ç€ä¸€ä¸ªå…³é”®å­—ï¼‰ é™¤æ ¹ç»“ç‚¹å’Œå¶å­ç»“ç‚¹å¤–ï¼Œå…¶å®ƒæ¯ä¸ªç»“ç‚¹è‡³å°‘æœ‰âŒˆm/2âŒ‰ä¸ªå­©å­ï¼ˆè‡³å°‘âŒˆm/2âŒ‰-1ä¸ªå…³é”®å­—ï¼Œå‡ºäºæ•ˆç‡åŸå› è§„å®šçš„ï¼‰ è‹¥æ ¹ç»“ç‚¹ä¸æ˜¯å¶å­ç»“ç‚¹ï¼Œåˆ™è‡³å°‘æœ‰2ä¸ªå­©å­ï¼ˆè‡³å°‘ä¸€ä¸ªå…³é”®å­—ï¼‰ æ‰€æœ‰å¶å­ç»“ç‚¹éƒ½å‡ºç°åœ¨åŒä¸€å±‚ï¼Œå¶å­ç»“ç‚¹ä¸åŒ…å«ä»»ä½•å…³é”®å­—ä¿¡æ¯ ä¸€é¢—3é˜¶æ ‘ç»“æ„å¦‚ä¸‹ï¼š 2.1 Bæ ‘çš„æœç´¢Bæ ‘æ˜¯å¤šè·¯æŸ¥æ‰¾æ ‘,äºŒå‰æ’åºæ ‘æ˜¯äºŒè·¯æŸ¥æ‰¾,Bæ ‘æ˜¯å¤šè·¯æŸ¥æ‰¾,æ‰€ä»¥å®ƒæ˜¯äºŒå‰æ’åºæ ‘çš„æ‹“å±•ã€‚å› æ­¤,Bæ ‘çš„æŸ¥æ‰¾æ“ä½œå’ŒäºŒå‰æ’åºæ ‘çš„æŸ¥æ‰¾æ“ä½œéå¸¸ç±»ä¼¼ã€‚ æŸ¥æ‰¾è¿‡ç¨‹: å…ˆè®©å¾…æŸ¥æ‰¾å…³é”®å­—keyå’Œç»“ç‚¹çš„ä¸­çš„å…³é”®å­—æ¯”è¾ƒ,å¦‚æœç­‰äºå…¶ä¸­æŸä¸ªå…³é”®å­—,åˆ™æŸ¥æ‰¾æˆåŠŸã€‚ å¦‚æœå’Œæ‰€æœ‰å…³é”®å­—éƒ½ä¸ç›¸ç­‰,åˆ™çœ‹keyå¤„åœ¨å“ªä¸ªèŒƒå›´å†…,ç„¶åå»å¯¹åº”çš„æŒ‡é’ˆæ‰€æŒ‡å‘çš„å­æ ‘ä¸­æŸ¥æ‰¾ã€‚ Eg:å¦‚æœkeyæ¯”ç¬¬ä¸€ä¸ªå…³é”®å­—K1è¿˜å°,åˆ™å»P0æŒ‡é’ˆæ‰€æŒ‡å‘çš„å­æ ‘ä¸­æŸ¥æ‰¾,å¦‚æœæ¯”æœ€åä¸€ä¸ªå…³é”®å­—Knè¿˜å¤§,åˆ™å»PnæŒ‡é’ˆæ‰€æŒ‡å‘çš„å­æ ‘ä¸­æŸ¥æ‰¾ã€‚ 2.2 Bæ ‘çš„æ’å…¥åœ¨äºŒå‰æ’åºæ ‘ä¸­,ä»…éœ€æŸ¥æ‰¾åˆ°éœ€æ’å…¥çš„ç»ˆç«¯ç»“ç‚¹çš„ä½ç½®ã€‚ä½†æ˜¯,åœ¨Bæ ‘ä¸­æ‰¾åˆ°æ’å…¥çš„ä½ç½®å,å¹¶ä¸èƒ½ç®€å•åœ°å°†å…¶æ·»åŠ åˆ°ç»ˆç«¯ç»“ç‚¹ä½ç½®,å› ä¸ºæ­¤æ—¶å¯èƒ½ä¼šå¯¼è‡´æ•´æ£µæ ‘ä¸å†æ»¡è¶³Bæ ‘ä¸­å®šä¹‰ä¸­çš„è¦æ±‚ã€‚ ç»™å®šä¸€ç»„å…³é”®å­—{20,30,50,52,60,68,70},ç»™å‡ºåˆ›å»ºä¸€æ£µ3é˜¶Bæ ‘çš„è¿‡ç¨‹ã€‚ ç”±äºm=3ï¼Œæ‰€ä»¥é™¤äº†æ ¹ç»“ç‚¹ä»¥å¤–,éå¶å­ç»“ç‚¹è‡³å°‘æœ‰âŒˆ3/2âŒ‰-1=1ä¸ªå…³é”®å­—ï¼Œæœ€å¤šæœ‰3-1=2ä¸ªå…³é”®å­—ã€‚æ‰€ä»¥ä¾æ¬¡æ’å…¥20å’Œ30ä¸¤ä¸ªå…³é”®å­—åˆ°ç»“ç‚¹ã€‚ æ¥ä¸‹æ¥æ’å…¥50ï¼Œå¦‚ä¸‹ï¼Œä½†æ˜¯ç”±äºæœ€å¤šæœ‰2ä¸ªå…³é”®å­—ï¼Œæ‰€ä»¥è¿™ä¸ªç»“ç‚¹ä¸æ»¡è¶³Bæ ‘è¦æ±‚ï¼Œéœ€è¦åˆ†è£‚ åˆ†è£‚çš„æ–¹æ³•: å–è¿™ä¸ªå…³é”®å­—æ•°ç»„ä¸­çš„ä¸­é—´å…³é”®å­—(âŒˆn/2âŒ‰)ä½œä¸ºæ–°çš„ç»“ç‚¹,ç„¶åå…¶ä»–å…³é”®å­—å½¢æˆä¸¤ä¸ªç»“ç‚¹ä½œä¸ºæ–°ç»“ç‚¹çš„å·¦å³å­©å­ã€‚ æ¥ä¸‹æ¥æ’å…¥52,,ç”±äº50ç»“ç‚¹åªæœ‰ä¸€ä¸ªå…³é”®å­—,æ‰€ä»¥å¯ä»¥æ’å…¥52 æ¥ä¸‹æ¥æ’å…¥60,æ’å…¥60ä¹‹åè¯¥ç»“ç‚¹å…³é”®å­—æ•°é‡åˆä¸ç¬¦åˆè¦æ±‚,éœ€è¦åˆ†è£‚ åˆ†è£‚è¿‡ç¨‹: å–ä¸­é—´å…³é”®å­—(âŒˆ3/2âŒ‰=2)52,ç”±äºæ ¹ç»“ç‚¹åªå«30ä¸€ä¸ªå…³é”®å­—,å¯ä»¥å°†52å’Œ30åˆå¹¶åˆ°ä¸€èµ·ã€‚æ¥ä¸‹æ¥éœ€è¦å¤„ç†50å’Œ60è¿™ä¸¤ä¸ªç»“ç‚¹,ç”±äº30&lt;50&lt;52,60&gt;52,æ‰€ä»¥50å’Œ60å„è‡ªå•ç‹¬ä½œä¸ºä¸€ä¸ªç»“ç‚¹ã€‚ æ¥ä¸‹æ¥æ’å…¥68,ç”±äº60ç»“ç‚¹åªæœ‰ä¸€ä¸ªå…³é”®å­—,æ‰€ä»¥å¯ä»¥æ’å…¥68 æ¥ä¸‹æ¥æ’å…¥70ï¼Œæ’å…¥70ä¹‹åè¯¥ç»“ç‚¹å…³é”®è¯æ•°é‡åˆä¸ç¬¦åˆè¦æ±‚ï¼Œéœ€è¦åˆ†è£‚ã€‚ 2.3 Bæ ‘çš„åˆ é™¤Bæ ‘ä¸­çš„åˆ é™¤æ“ä½œä¸æ’å…¥æ“ä½œç±»ä¼¼,ä½†è¦ç¨å¾®å¤æ‚äº›,è¦ä½¿å¾—åˆ é™¤åçš„ç»“ç‚¹ä¸­çš„å…³é”®å­—ä¸ªæ•°â‰¥âŒˆm/2âŒ‰-1,å› æ­¤å°†æ¶‰åŠç»“ç‚¹çš„â€œåˆå¹¶é—®é¢˜ã€‚ç”±äºåˆ é™¤çš„å…³é”®å­—ä½ç½®ä¸åŒ,å¯ä»¥åˆ†ä¸ºå…³é”®å­—åœ¨ç»ˆç«¯ç»“ç‚¹å’Œä¸åœ¨ç»ˆç«¯ç»“ç‚¹ä¸Šä¸¤ç§æƒ…å†µã€‚ å¦‚æœåœ¨ç»ˆç«¯ç»“ç‚¹ä¸Š: ç»“ç‚¹å†…å…³é”®å­—æ•°é‡å¤§äºâŒˆm/2âŒ‰-1,è¿™æ—¶åˆ é™¤è¿™ä¸ªå…³é”®å­—ä¸ä¼šç ´åBæ ‘çš„å®šä¹‰è¦æ±‚ã€‚æ‰€ä»¥ç›´æ¥åˆ é™¤ã€‚ ç»“ç‚¹å†…å…³é”®å­—æ•°é‡ç­‰äºâŒˆm/2âŒ‰-1,å¹¶ä¸”å…¶å·¦å³å…„å¼Ÿç»“ç‚¹ä¸­å­˜åœ¨å…³é”®å­—æ•°é‡å¤§äºâŒˆm/2âŒ‰-1çš„ç»“ç‚¹,åˆ™å»å…„å¼Ÿç»“ç‚¹ä¸­å€Ÿå…³é”®å­—ã€‚ ç»“ç‚¹å†…å…³é”®å­—æ•°é‡ç­‰äºâŒˆm/2âŒ‰-1,å¹¶ä¸”å…¶å·¦å³å…„å¼Ÿç»“ç‚¹ä¸­ä¸å­˜åœ¨å…³é”®å­—æ•°é‡å¤§äºâŒˆm/2âŒ‰-1çš„ç»“ç‚¹,åˆ™éœ€è¦è¿›è¡Œç»“ç‚¹åˆå¹¶ã€‚ å¦‚æœä¸åœ¨ç»ˆç«¯ç»“ç‚¹ä¸Š: æ‰¾å‡ºå®ƒçš„ç›¸é‚»å…³é”®å­—ï¼Œè½¬æ¢æˆåœ¨ç»ˆç«¯ç»“ç‚¹ä¸Šï¼ˆäº¤æ¢ç»“ç‚¹ï¼‰ 2.4 Bæ ‘çš„é«˜åº¦logm/2(N+1)/2 + 1 3 B+æ ‘B+æ ‘çš„ç‰¹å¾ï¼š æœ‰mä¸ªå­æ ‘çš„ä¸­é—´èŠ‚ç‚¹åŒ…å«æœ‰mä¸ªå…ƒç´ ï¼ˆBæ ‘ä¸­æ˜¯k-1ä¸ªå…ƒç´ ï¼‰ï¼Œæ¯ä¸ªå…ƒç´ ä¸ä¿å­˜æ•°æ®ï¼Œåªç”¨æ¥ç´¢å¼• æ‰€æœ‰çš„å¶å­ç»“ç‚¹ä¸­åŒ…å«äº†å…¨éƒ¨å…³é”®å­—çš„ä¿¡æ¯ï¼ŒåŠæŒ‡å‘å«æœ‰è¿™äº›å…³é”®å­—è®°å½•çš„æŒ‡é’ˆï¼Œä¸”å¶å­ç»“ç‚¹æœ¬èº«ä¾å…³é”®å­—çš„å¤§å°è‡ªå°è€Œå¤§çš„é¡ºåºé“¾æ¥ã€‚ (è€ŒBæ ‘çš„å¶å­èŠ‚ç‚¹å¹¶æ²¡æœ‰åŒ…æ‹¬å…¨éƒ¨éœ€è¦æŸ¥æ‰¾çš„ä¿¡æ¯) æ‰€æœ‰çš„éç»ˆç«¯ç»“ç‚¹å¯ä»¥çœ‹æˆæ˜¯ç´¢å¼•éƒ¨åˆ†ï¼Œç»“ç‚¹ä¸­ä»…å«æœ‰å…¶å­æ ‘æ ¹ç»“ç‚¹ä¸­æœ€å¤§ï¼ˆæˆ–æœ€å°ï¼‰å…³é”®å­—ã€‚ (è€ŒBæ ‘çš„éç»ˆèŠ‚ç‚¹ä¹ŸåŒ…å«éœ€è¦æŸ¥æ‰¾çš„æœ‰æ•ˆä¿¡æ¯) ä¸ºä»€ä¹ˆè¯´B+æ ‘æ¯”Bæ ‘æ›´é€‚åˆæ•°æ®åº“ç´¢å¼•ï¼Ÿ B+æ ‘çš„ç£ç›˜è¯»å†™ä»£ä»·æ›´ä½ B+æ ‘çš„å†…éƒ¨ç»“ç‚¹å¹¶æ²¡æœ‰æŒ‡å‘å…³é”®å­—å…·ä½“ä¿¡æ¯çš„æŒ‡é’ˆã€‚å› æ­¤å…¶å†…éƒ¨ç»“ç‚¹ç›¸å¯¹Bæ ‘æ›´å°ã€‚å¦‚æœæŠŠæ‰€æœ‰åŒä¸€å†…éƒ¨ç»“ç‚¹çš„å…³é”®å­—å­˜æ”¾åœ¨åŒä¸€ç›˜å—ä¸­ï¼Œé‚£ä¹ˆç›˜å—æ‰€èƒ½å®¹çº³çš„å…³é”®å­—æ•°é‡ä¹Ÿè¶Šå¤šã€‚ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ä¸­çš„éœ€è¦æŸ¥æ‰¾çš„å…³é”®å­—ä¹Ÿå°±è¶Šå¤šã€‚ç›¸å¯¹æ¥è¯´IOè¯»å†™æ¬¡æ•°ä¹Ÿå°±é™ä½äº†ï¼› B+æ ‘æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®š ç”±äºéç»ˆç»“ç‚¹å¹¶ä¸æ˜¯æœ€ç»ˆæŒ‡å‘æ–‡ä»¶å†…å®¹çš„ç»“ç‚¹ï¼Œè€Œåªæ˜¯å¶å­ç»“ç‚¹ä¸­å…³é”®å­—çš„ç´¢å¼•ã€‚æ‰€ä»¥ä»»ä½•å…³é”®å­—çš„æŸ¥æ‰¾å¿…é¡»èµ°ä¸€æ¡ä»æ ¹ç»“ç‚¹åˆ°å¶å­ç»“ç‚¹çš„è·¯ã€‚æ‰€æœ‰å…³é”®å­—æŸ¥è¯¢çš„è·¯å¾„é•¿åº¦ç›¸åŒï¼Œå¯¼è‡´æ¯ä¸€ä¸ªæ•°æ®çš„æŸ¥è¯¢æ•ˆç‡ç›¸å½“ï¼› B+æ ‘ä¾¿äºèŒƒå›´æŸ¥è¯¢ï¼ˆæœ€é‡è¦çš„åŸå› ï¼ŒèŒƒå›´æŸ¥æ‰¾æ˜¯æ•°æ®åº“çš„å¸¸æ€ï¼‰ Bæ ‘åœ¨æé«˜äº†IOæ€§èƒ½çš„åŒæ—¶å¹¶æ²¡æœ‰è§£å†³å…ƒç´ éå†çš„æ—¶å€™æ•ˆç‡ä½ä¸‹çš„é—®é¢˜ï¼Œæ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒB+æ ‘åº”ç”¨è€Œç”Ÿã€‚B+æ ‘åªéœ€è¦å»éå†å¶å­èŠ‚ç‚¹å°±å¯ä»¥å®ç°æ•´æ£µæ ‘çš„éå†ã€‚è€Œä¸”åœ¨æ•°æ®åº“ä¸­åŸºäºèŒƒå›´çš„æŸ¥è¯¢æ˜¯éå¸¸é¢‘ç¹çš„ï¼Œè€ŒBæ ‘ä¸æ”¯æŒè¿™æ ·çš„æ“ä½œæˆ–è€…è¯´æ•ˆç‡å¤ªä½ 4 é™„ï¼šAlgorithmsç¬¬å››ç‰ˆBæ ‘å®ç°è¿™ä¸ªBæ ‘å®ç°éå¶å­èŠ‚ç‚¹å±…ç„¶ä¸å¸¦ä¿¡æ¯ï¼ŒæŠŠæˆ‘æ•´æ‡µäº† public class BTree&lt;Key extends Comparable&lt;Key>, Value> { // åº¦æ•°Mï¼Œä¸€ä¸ªç»“ç‚¹æœ€å¤šæœ‰M-1ä¸ªå…³é”®å­— private static final int M = 4; private Node root; // æ ¹èŠ‚ç‚¹ private int height; // Bæ ‘çš„é«˜åº¦ private int n; // è¯¥æ ‘ä¸­ä¸€å…±æœ‰å¤šå°‘ä¸ªkey-valueå¯¹ // èŠ‚ç‚¹ private static final class Node { private int m; // æœ‰å¤šå°‘ä¸ªå­èŠ‚ç‚¹ private Entry[] children = new Entry[M]; // å­èŠ‚ç‚¹çš„æ•°ç»„ // create a node with k children private Node(int k) { m = k; } } // ä¸€æ¡ç´¢å¼• // å†…éƒ¨èŠ‚ç‚¹ï¼šåªä½¿ç”¨keyå’Œnext // å¶å­èŠ‚ç‚¹ï¼Œåªä½¿ç”¨keyå’Œvalue private static class Entry { private Comparable key; private final Object val; private Node next; // æŒ‡å‘ä¸€ä¸ªèŠ‚ç‚¹ public Entry(Comparable key, Object val, Node next) { this.key = key; this.val = val; this.next = next; } } /** * Initializes an empty B-tree. */ public BTree() { root = new Node(0); } /** * Returns true if this symbol table is empty. * @return {@code true} if this symbol table is empty; {@code false} otherwise */ public boolean isEmpty() { return size() == 0; } /** * Returns the number of key-value pairs in this symbol table. * @return the number of key-value pairs in this symbol table */ public int size() { return n; } /** * Returns the height of this B-tree (for debugging). * * @return the height of this B-tree */ public int height() { return height; } /** * Returns the value associated with the given key. * * @param key the key * @return the value associated with the given key if the key is in the symbol table * and {@code null} if the key is not in the symbol table * @throws IllegalArgumentException if {@code key} is {@code null} */ public Value get(Key key) { if (key == null) throw new IllegalArgumentException(\"argument to get() is null\"); return search(root, key, height); } private Value search(Node x, Key key, int ht) { Entry[] children = x.children; // å¦‚æœæ˜¯å¶å­èŠ‚ç‚¹ if (ht == 0) { //æ‰¾åˆ°å¶å­èŠ‚ç‚¹ä¸­å¯¹åº”çš„ç´¢å¼•é¡¹ for (int j = 0; j &lt; x.m; j++) { if (eq(key, children[j].key)) return (Value) children[j].val; } } // å¦‚æœä¸æ˜¯å¶å­èŠ‚ç‚¹ else { for (int j = 0; j &lt; x.m; j++) { //å¦‚æœæ˜¯èŠ‚ç‚¹ä¸­æœ€åä¸€æ¡ç´¢å¼•é¡¹æˆ–è€…ä½äºè¯¥ç´¢å¼•é¡¹ä¸ä¸‹ä¸€æ¡ç´¢å¼•é¡¹ä¹‹é—´ if (j+1 == x.m || less(key, children[j+1].key)) //æœç´¢è¯¥ç´¢å¼•é¡¹çš„next return search(children[j].next, key, ht-1); } } return null; } /** * Inserts the key-value pair into the symbol table, overwriting the old value * with the new value if the key is already in the symbol table. * If the value is {@code null}, this effectively deletes the key from the symbol table. * * @param key the key * @param val the value * @throws IllegalArgumentException if {@code key} is {@code null} */ public void put(Key key, Value val) { if (key == null) throw new IllegalArgumentException(\"argument key to put() is null\"); Node u = insert(root, key, val, height); n++; if (u == null) return; // need to split root Node t = new Node(2); t.children[0] = new Entry(root.children[0].key, null, root); t.children[1] = new Entry(u.children[0].key, null, u); root = t; height++; } private Node insert(Node h, Key key, Value val, int ht) { int j; Entry t = new Entry(key, val, null); // external node if (ht == 0) { for (j = 0; j &lt; h.m; j++) { if (less(key, h.children[j].key)) break; } } // internal node else { for (j = 0; j &lt; h.m; j++) { if ((j+1 == h.m) || less(key, h.children[j+1].key)) { Node u = insert(h.children[j++].next, key, val, ht-1); if (u == null) return null; t.key = u.children[0].key; t.next = u; break; } } } for (int i = h.m; i > j; i--) h.children[i] = h.children[i-1]; h.children[j] = t; h.m++; if (h.m &lt; M) return null; else return split(h); } // split node in half private Node split(Node h) { Node t = new Node(M/2); h.m = M/2; for (int j = 0; j &lt; M/2; j++) t.children[j] = h.children[M/2+j]; return t; } /** * Returns a string representation of this B-tree (for debugging). * * @return a string representation of this B-tree. */ public String toString() { return toString(root, height, \"\") + \"\\n\"; } private String toString(Node h, int ht, String indent) { StringBuilder s = new StringBuilder(); Entry[] children = h.children; if (ht == 0) { for (int j = 0; j &lt; h.m; j++) { s.append(indent + children[j].key + \" \" + children[j].val + \"\\n\"); } } else { for (int j = 0; j &lt; h.m; j++) { if (j > 0) s.append(indent + \"(\" + children[j].key + \")\\n\"); s.append(toString(children[j].next, ht-1, indent + \" \")); } } return s.toString(); } // comparison functions - make Comparable instead of Key to avoid casts private boolean less(Comparable k1, Comparable k2) { return k1.compareTo(k2) &lt; 0; } private boolean eq(Comparable k1, Comparable k2) { return k1.compareTo(k2) == 0; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"leetcode611-æœ‰æ•ˆä¸‰è§’å½¢çš„ä¸ªæ•°","slug":"leetcode611-æœ‰æ•ˆä¸‰è§’å½¢çš„ä¸ªæ•°","date":"2020-02-07T18:26:22.000Z","updated":"2020-02-20T14:55:21.051Z","comments":true,"path":"article/leetcode611-æœ‰æ•ˆä¸‰è§’å½¢çš„ä¸ªæ•°/","link":"","permalink":"https://www.codetool.top/article/leetcode611-%E6%9C%89%E6%95%88%E4%B8%89%E8%A7%92%E5%BD%A2%E7%9A%84%E4%B8%AA%E6%95%B0/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªåŒ…å«éè´Ÿæ•´æ•°çš„æ•°ç»„ï¼Œä½ çš„ä»»åŠ¡æ˜¯ç»Ÿè®¡å…¶ä¸­å¯ä»¥ç»„æˆä¸‰è§’å½¢ä¸‰æ¡è¾¹çš„ä¸‰å…ƒç»„ä¸ªæ•°ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š [2,2,3,4]è¾“å‡ºï¼š 3è§£é‡Šï¼šæœ‰æ•ˆçš„ç»„åˆæ˜¯:2,3,4 (ä½¿ç”¨ç¬¬ä¸€ä¸ª 2)2,3,4 (ä½¿ç”¨ç¬¬äºŒä¸ª 2)2,2,3 æ³¨æ„: æ•°ç»„é•¿åº¦ä¸è¶…è¿‡1000ã€‚ æ•°ç»„é‡Œæ•´æ•°çš„èŒƒå›´ä¸º [0, 1000]ã€‚ 2 è§£æ³•2.1 æ€æƒ³ä¸‰è§’å½¢çš„æŸä¸¤è¾¹ä¹‹å’Œå¿…é¡»å¤§äºç¬¬ä¸‰è¾¹ä¸”ä¸¤è¾¹ä¹‹å·®å°äºç¬¬ä¸‰è¾¹ æ–¹æ³•ï¼š æš´åŠ›ï¼šè·å–æ‰€æœ‰3å…ƒç»„ï¼Œåˆ¤æ–­èƒ½å¦æ„æˆä¸‰è§’å½¢ åŠ¨æ€è§„åˆ’ï¼šå…ˆç»™æ•°ç»„æ’åºï¼Œä»»æ„ä¸¤ä¸ªè¾ƒå°è¾¹ä¹‹å’Œå¿…é¡»å¤§äºç¬¬ä¸‰è¾¹ã€‚ å¯¹äºæ•°ç»„[1,3,4,5,6]ï¼Œå…ˆå°†æœ€å¤§è¾¹æŒ‡å‘6ï¼Œä¸€æœ€å°è¾¹iæŒ‡å‘1ï¼Œä¸€æœ€å°è¾¹jæŒ‡å‘5ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 1+5ä¸å¤§äº6ï¼Œå¯ä»¥å°†æœ€å°è¾¹å¾€åç§»ä¸€æ ¼ã€‚ å¦‚å›¾æ‰€ç¤ºï¼Œæ­¤æ—¶3+5å¤§äº6ï¼Œå¯ä»¥ç»„æˆä¸‰è§’å½¢ï¼Œè€Œå› ä¸ºæ•°ç»„æ˜¯æ’åºè¿‡çš„ï¼Œåˆ™æœ€å°è¾¹å†å‘åç§»æœ€å°ä¸¤è¾¹ä¹‹å’Œä¹Ÿæ˜¯å¤§äºç¬¬ä¸‰è¾¹çš„ï¼Œæ‰€ä»¥æ­¤æ—¶å¯ä»¥æŠŠæ€»æ•°åŠ ä¸Šj-iï¼Œç„¶åæŠŠiè¿˜åŸå›æ•°ç»„å¤´éƒ¨ï¼Œjå‘å‰ç§»ä¸€æ ¼ é‡å¤ä¹‹å‰æ­¥éª¤ï¼Œ1+4ä¸å¤§äº6ï¼Œiå‘åç§»ä¸€æ ¼ï¼Œ3+4å¤§äº6ï¼Œæ€»æ•°åŠ ä¸Šj-iã€‚ 2.2 ä»£ç  æš´åŠ› class Solution { public int triangleNumber(int[] nums) { int count = 0; for(int i = 0;i&lt;nums.length-2;i++){ for(int j = i+1;j&lt;nums.length-1;j++){ for(int n = j+1;n&lt;nums.length;n++){ if(nums[i]+nums[j]>nums[n]&amp;&amp;Math.abs(nums[i]-nums[j])&lt;nums[n]) count++; } } } return count; } } åŠ¨æ€è§„åˆ’ class Solution { public int triangleNumber(int[] nums) { int count = 0; Arrays.sort(nums); for(int n = nums.length-1;n>=2;n--){ int i = 0; int j = n-1; while(i&lt;j){ if(nums[i]+nums[j]>nums[n]) { count+=(j-i); j--; }else{ i++; } } } return count; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"åŸºäºNIOæ¨¡å‹æ”¹è¿›å¤šäººèŠå¤©å®¤","slug":"åŸºäºNIOæ¨¡å‹æ”¹è¿›å¤šäººèŠå¤©å®¤","date":"2020-02-07T15:45:50.000Z","updated":"2020-03-11T15:56:49.523Z","comments":true,"path":"article/åŸºäºNIOæ¨¡å‹æ”¹è¿›å¤šäººèŠå¤©å®¤/","link":"","permalink":"https://www.codetool.top/article/%E5%9F%BA%E4%BA%8ENIO%E6%A8%A1%E5%9E%8B%E6%94%B9%E8%BF%9B%E5%A4%9A%E4%BA%BA%E8%81%8A%E5%A4%A9%E5%AE%A4/","excerpt":"","text":"ç¬¬ä¸€ç‰ˆå’Œç¬¬äºŒç‰ˆè§åŸºäºBIOæ¨¡å‹å®ç°å¤šäººèŠå¤©å®¤ NIOä»‹ç»è§ï¼š NIOã€BIOæ¨¡å‹å¯¹æ¯”å®ç°æ–‡ä»¶çš„å¤åˆ¶NIOç½‘ç»œç¼–ç¨‹ä¹‹Selectorä»‹ç» 1 ç¬¬ä¸‰ç‰ˆï¼šä½¿ç”¨NIOæ¨¡å‹æ”¹è¿›1.1 æœåŠ¡ç«¯å®ç°public class ChatServer { private static final int DEFAULT_PORT = 8888; private static final String QUIT = \"quit\"; private static final int Buffer = 1024; private ServerSocketChannel server; private Selector selector; private ByteBuffer rBuffer = ByteBuffer.allocate(Buffer); private ByteBuffer wBuffer = ByteBuffer.allocate(Buffer); private Charset charset = Charset.forName(\"UTF-8\"); private int port; public ChatServer() { } public ChatServer(int port) { this.port = port; } public void start(){ try { server = ServerSocketChannel.open(); server.configureBlocking(false);//ï¼ï¼ï¼ server.socket().bind(new InetSocketAddress(port)); selector = Selector.open(); server.register(selector, SelectionKey.OP_ACCEPT); System.out.println(\"å¯åŠ¨æœåŠ¡å™¨ï¼Œç›‘å¬ç«¯å£ï¼š\"+port+\"...\"); while (true) { selector.select(); Set&lt;SelectionKey> keys = selector.selectedKeys(); for(SelectionKey key:keys){ //å¤„ç†è¢«è§¦å‘çš„äº‹ä»¶ handles(key); } keys.clear(); } } catch (IOException e) { e.printStackTrace(); } finally { close(selector); } } private void handles(SelectionKey key) throws IOException { // ACCEPTäº‹ä»¶ - å’Œå®¢æˆ·ç«¯å»ºç«‹äº†è¿æ¥ if(key.isAcceptable()){ ServerSocketChannel server = (ServerSocketChannel) key.channel(); SocketChannel client = server.accept(); client.configureBlocking(false); client.register(selector,SelectionKey.OP_READ); System.out.println(getClientName(client) +\"å·²è¿æ¥\"); } // READäº‹ä»¶ - å®¢æˆ·ç«¯å‘é€äº†æ¶ˆæ¯ else if(key.isReadable()){ SocketChannel client = (SocketChannel) key.channel(); String fwdMsg = receive(client); if(fwdMsg.isEmpty()){ //å®¢æˆ·ç«¯å¼‚å¸¸ key.cancel(); selector.wakeup(); }else{ System.out.println(getClientName(client)+\":\"+fwdMsg); // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦é€€å‡º if(readyToQuit(fwdMsg)){ key.cancel(); selector.wakeup(); System.out.println(getClientName(client)+\"å·²æ–­å¼€è¿æ¥\"); }else{ forwardMessage(client,fwdMsg); } } } } private void forwardMessage(SocketChannel client, String fwdMsg) { selector.keys().forEach(key->{ SelectableChannel connectedClient = key.channel(); if(connectedClient instanceof ServerSocketChannel) return; if(key.isValid() &amp;&amp; !client.equals(connectedClient)){ wBuffer.clear(); wBuffer.put(charset.encode(getClientName(client)+\":\"+fwdMsg)); wBuffer.flip(); while (wBuffer.hasRemaining()){ try { ((SocketChannel)connectedClient).write(wBuffer); } catch (IOException e) { e.printStackTrace(); } } } }); } private String receive(SocketChannel client) throws IOException { rBuffer.clear(); while(client.read(rBuffer)>0); rBuffer.flip(); return String.valueOf(charset.decode(rBuffer)); } private String getClientName(SocketChannel client){ return \"å®¢æˆ·ç«¯[\"+client.socket().getPort()+\"]\"; } private boolean readyToQuit(String msg){ return QUIT.equals(msg); } private void close(Closeable... closeable){ for(Closeable c:closeable){ try { c.close(); } catch (IOException e) { e.printStackTrace(); } } } public static void main(String[] args) { ChatServer chatServer = new ChatServer(7777); chatServer.start(); } } 1.2 å®¢æˆ·ç«¯å®ç°public class ChatClient { private static final String DEFAULT_SERVER_HOST = \"127.0.0.1\"; private static final int DEFAULT_SERVER_PORT = 8888; private static final String QUIT = \"quit\"; private static final int BUFFER = 1024; private String host; private int port; private SocketChannel client; private ByteBuffer rBuffer = ByteBuffer.allocate(BUFFER); private ByteBuffer wBuffer = ByteBuffer.allocate(BUFFER); private Selector selector; private Charset charset = Charset.forName(\"UTF-8\"); public ChatClient() { } public ChatClient(String host, int port) { this.host = host; this.port = port; } public boolean readyToQuit(String msg){ return QUIT.equals(msg); } private void close(Closeable... closeable){ for(Closeable c:closeable){ try { c.close(); } catch (IOException e) { e.printStackTrace(); } } } private void start(){ try { client = SocketChannel.open(); client.configureBlocking(false); selector = Selector.open(); client.register(selector, SelectionKey.OP_CONNECT); client.connect(new InetSocketAddress(host,port)); while (selector.isOpen()){ selector.select(); Set&lt;SelectionKey> keys = selector.selectedKeys(); keys.forEach(key->{ handles(key); }); keys.clear(); } } catch (IOException e) { e.printStackTrace(); } catch (ClosedSelectorException e){ } finally { close(selector); } } private void handles(SelectionKey key) { // CONNECTè¿æ¥å°±ç»ªäº‹ä»¶ if (key.isConnectable()){ SocketChannel channel = (SocketChannel) key.channel(); if(client.isConnectionPending()){ try { client.finishConnect(); //å¤„ç†ç”¨æˆ·è¾“å…¥ new Thread(new UserInputHandler(this)).start(); client.register(selector,SelectionKey.OP_READ); } catch (IOException e) { e.printStackTrace(); } } } // READäº‹ä»¶ else if(key.isReadable()){ SocketChannel client = (SocketChannel) key.channel(); String msg = null; try { msg = recieve(client); } catch (IOException e) { e.printStackTrace(); } if(msg.isEmpty()){ // æœåŠ¡å™¨å¼‚å¸¸ close(selector); }else{ System.out.println(msg); } } } public void send(String msg) throws IOException { if (msg.isEmpty()) return; wBuffer.clear(); wBuffer.put(charset.encode(msg)); wBuffer.flip(); while (wBuffer.hasRemaining()){ client.write(wBuffer); } if(readyToQuit(msg)){ close(selector); } } private String recieve(SocketChannel client) throws IOException { rBuffer.clear(); while(client.read(rBuffer)>0); rBuffer.flip(); return String.valueOf(charset.decode(rBuffer)); } public static void main(String[] args) { ChatClient client = new ChatClient(\"127.0.0.1\",7777); client.start(); } } å¤„ç†ç”¨æˆ·è¾“å…¥çš„çº¿ç¨‹ï¼š public class UserInputHandler implements Runnable{ private ChatClient chatClient; public UserInputHandler(ChatClient chatClient){ this.chatClient = chatClient; } @Override public void run() { try { // ç­‰å¾…ç”¨æˆ·è¾“å…¥æ¶ˆæ¯ BufferedReader consoleReader = new BufferedReader( new InputStreamReader(System.in) ); while (true){ String input = consoleReader.readLine(); // å‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯ chatClient.send(input); // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å‡†å¤‡é€€å‡º if(chatClient.readyToQuit(input)){ break; } } } catch (IOException e) { e.printStackTrace(); } } }","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"IO","slug":"IO","permalink":"https://www.codetool.top/tags/IO/"},{"name":"ç½‘ç»œç¼–ç¨‹","slug":"ç½‘ç»œç¼–ç¨‹","permalink":"https://www.codetool.top/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"},{"name":"NIO","slug":"NIO","permalink":"https://www.codetool.top/tags/NIO/"}]},{"title":"NIOç½‘ç»œç¼–ç¨‹ä¹‹Selectorä»‹ç»","slug":"NIOç½‘ç»œç¼–ç¨‹ä¹‹Selectorä»‹ç»","date":"2020-02-07T11:38:08.000Z","updated":"2020-03-14T06:06:04.143Z","comments":true,"path":"article/NIOç½‘ç»œç¼–ç¨‹ä¹‹Selectorä»‹ç»/","link":"","permalink":"https://www.codetool.top/article/NIO%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B9%8BSelector%E4%BB%8B%E7%BB%8D/","excerpt":"","text":"1 Selectorè¦å®ç°å¼‚æ­¥IOè¦é€šè¿‡Selectorï¼Œç”šè‡³æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªçº¿ç¨‹ç®¡ç†å¤šä¸ªChannelçš„è¯»å†™ï¼Œè¿™æ˜¯NIOç›¸è¾ƒBIOçš„ä¼˜è¶Šä¹‹å¤„ä¹‹ä¸€ã€‚ Channelå¯ä»¥æ³¨å†Œåˆ°ä¸€ä¸ªSelectorä¸Šï¼ŒSelectorå¯ä»¥ç›‘è§†å¤šä¸ªChannelçš„çŠ¶æ€ Channelçš„çŠ¶æ€æœ‰å››ç§ï¼š CONNECT ACCEPT READ WRITE CONNECTä»£è¡¨æŸä¸ªChannelæˆåŠŸè¿æ¥åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰ã€‚ACCEPTåˆ™æ˜¯ä¸€ä¸ªServerSocketChannelå‡†å¤‡å¥½æ¥æ”¶æ–°è¿æ¥ï¼ˆæœåŠ¡ç«¯ï¼‰ã€‚READä»£è¡¨è¯¥Channelæœ‰æ•°æ®å¯è¯»ï¼ŒWRITEä»£è¡¨è¯¥Channelç­‰å¾…å†™æ“ä½œã€‚ è¿™äº›çŠ¶æ€åœ¨Javaä¸­å¯¹åº”SelectionKeyä¸­çš„å››ä¸ªå¸¸é‡ SelectionKey.OP_CONNECT SelectionKey.OP_ACCEPT SelectionKey.OP_READ SelectionKey.OP_WRITE åœ¨ç»™Channelæ³¨å†Œåˆ°Selectoræ—¶å¯ä»¥æŒ‡å®šè¦ç›‘å¬çš„çŠ¶æ€ï¼š channel.configureBlocking(false); SelectionKey key =channel.register(selector,SelectionKey.OP_READ); è¿™ä¸ªçŠ¶æ€å¯ä»¥æ˜¯å¤šä¸ªçŠ¶æ€åˆæˆçš„ï¼Œæˆ‘ä»¬å«å®ƒinterestOpsï¼Œæ˜¯ä»»æ„å‡ ä¸ªçŠ¶æ€çš„ä½æˆ–ç»“æœã€‚ registeræ–¹æ³•å¯ä»¥è¿”å›ä¸€ä¸ªSelectionKeyï¼Œä½œä¸ºæ³¨å†Œåœ¨è¯¥Selectorä¸Šçš„Channelçš„å”¯ä¸€æ ‡è¯†(ä¸€ä¸ªSelector-Channelå¯¹)ã€‚ Selectorçš„å¸¸ç”¨APIï¼š int select()ï¼šé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°è‡³å°‘æœ‰ä¸€ä¸ªç»‘å®šçš„Channelç¬¦åˆç›‘å¬çš„çŠ¶æ€ï¼Œè¿”å›ç¬¦åˆçŠ¶æ€Channelçš„ä¸ªæ•°ï¼Œä¹Ÿå¯èƒ½æ˜¯0ï¼ˆå¦‚æœä¸­é€”æœ‰ä¸€ä¸ªKeyçš„interestOpsè¢«æ›´æ–°äº†ï¼‰ã€‚ int select(long timeout) ï¼šé˜»å¡ç­‰å¾…é™åˆ¶ä¸€ä¸ªæœ€é•¿æ—¶é—´ï¼Œè¶…è¿‡æ—¶é—´ç›´æ¥è¿”å›ã€‚ int selectNow()ï¼šä¸é˜»å¡ï¼Œç›´æ¥æŸ¥è¯¢æœ‰å‡ ä¸ªç¬¦åˆç›‘å¬çŠ¶æ€çš„Channelã€‚ Set&lt;SelectionKey&gt; selectedKeys()ï¼šç»è¿‡ä»»ä¸€selectæ“ä½œåå¯ä»¥è·å–è¢«selectåˆ°çš„keysã€‚ Selector wakeup()ï¼šå¦‚æœä¸€ä¸ªçº¿ç¨‹è°ƒç”¨select()æ–¹æ³•é˜»å¡äº†ï¼Œå¯ä»¥è®©å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨åŒä¸€ä¸ªSelectorä¸Šçš„wakeup()æ–¹æ³•æ¥å”¤é†’è¿™ä¸ªçº¿ç¨‹ã€‚ void close()ï¼šå…³é—­è¿™ä¸ªSelectorã€‚ 2 SelectionKeySelectionKeyçš„å¸¸ç”¨APIï¼š int interestOps()ï¼šè¿”å›interestOpsï¼Œå¯ä»¥é€šè¿‡ä¸å¸¸é‡è¿›è¡Œä½ä¸æ¥åˆ¤æ–­æ˜¯å¦å«æœ‰æŸä¸ªçŠ¶æ€ã€‚ int readyOps()ï¼šè¿”å›çš„æ˜¯æœ‰å“ªäº›ç›‘å¬çš„çŠ¶æ€ç›®å‰æ˜¯å¯¹åº”çš„ï¼Œä¹Ÿæ˜¯åˆæˆå€¼ï¼Œå¯ä»¥é€šè¿‡ä¸å¸¸é‡è¿›è¡Œä½ä¸æ¥åˆ¤æ–­æ˜¯å¦å«æœ‰æŸä¸ªçŠ¶æ€ã€‚æˆ–è€…ç›´æ¥è°ƒç”¨isConnectable,isAcceptable,isReadable,isWritableã€‚ SelectableChannel channel()ï¼šè·å–è¿™ä¸ªSelectionKeyå¯¹åº”çš„Channel Selector selector()ï¼š è·å–è¿™ä¸ªSelectionKeyå¯¹åº”çš„Selector Object attach(Object ob)ï¼šç»™è¿™ä¸ªSelectionKeyé™„åŠ ä¸€ä¸ªObjectå¯¹è±¡ Object attachment()ï¼šè·å–è¿™ä¸ªé™„åŠ çš„Objectå¯¹è±¡","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"IO","slug":"IO","permalink":"https://www.codetool.top/tags/IO/"},{"name":"ç½‘ç»œç¼–ç¨‹","slug":"ç½‘ç»œç¼–ç¨‹","permalink":"https://www.codetool.top/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"},{"name":"NIO","slug":"NIO","permalink":"https://www.codetool.top/tags/NIO/"}]},{"title":"NIOã€BIOæ¨¡å‹å¯¹æ¯”å®ç°æ–‡ä»¶çš„å¤åˆ¶","slug":"NIOã€BIOæ¨¡å‹å¯¹æ¯”å®ç°æ–‡ä»¶çš„å¤åˆ¶","date":"2020-02-06T18:52:49.000Z","updated":"2020-02-07T19:32:35.651Z","comments":true,"path":"article/NIOã€BIOæ¨¡å‹å¯¹æ¯”å®ç°æ–‡ä»¶çš„å¤åˆ¶/","link":"","permalink":"https://www.codetool.top/article/NIO%E3%80%81BIO%E6%A8%A1%E5%9E%8B%E5%AF%B9%E6%AF%94%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E7%9A%84%E5%A4%8D%E5%88%B6/","excerpt":"","text":"1 NIOç‰¹ç‚¹ ä½¿ç”¨Channelä»£æ›¿Streamï¼Œæ˜¯åŒå‘çš„ ä½¿ç”¨Selectorç›‘æ§å¤šæ¡Channel å¯ä»¥åœ¨ä¸€ä¸ªçº¿ç¨‹é‡Œå¤„ç†å¤šä¸ªChannel I/O 2 Channelå’ŒBuffer2.1 Bufferåº”ç”¨ç¨‹åºå¯¹Channelçš„è¯»å†™å¿…é¡»é€šè¿‡Bufferã€‚Bufferå®è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé€šå¸¸æ˜¯å­—èŠ‚æ•°ç»„ï¼ŒJAVAä¸­çš„å…«ç§åŸºæœ¬ç±»å‹éƒ½æœ‰å„è‡ªå¯¹åº”çš„Bufferã€‚ BufferåŒ…å«ä¸‰ä¸ªæŒ‡é’ˆï¼š capacityï¼šæœ€å¤§å®¹é‡ limitï¼šé™åˆ¶ä½ç½® positionï¼šè¦æ“ä½œçš„ä½ç½® Bufferæ—¢å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™ï¼Œä½†è¯»å’Œå†™ä¹‹é—´å¿…é¡»è¿›è¡Œæ¨¡å¼åˆ‡æ¢ï¼Œå¸¸ç”¨APIï¼š flip()ï¼š ç¿»è½¬æ¨¡å¼ï¼šå†™æ¨¡å¼-&gt;è¯»æ¨¡å¼ æŠŠpositionè¿˜åŸå›åˆå§‹ä½ç½®ï¼ŒlimitæŒ‡é’ˆæŒ‡å‘åˆšæ‰positionæŒ‡å‘çš„ä½ç½®ã€‚positionå’Œlimitä¹‹é—´å³ä¸ºè¦è¯»çš„æ•°æ®ã€‚ clear()ï¼š ç¿»è½¬æ¨¡å¼ï¼šå†™æ¨¡å¼-&gt;è¯»æ¨¡å¼npositionè¿˜åŸåˆå§‹ä½ç½®ï¼ŒlimitæŒ‡å‘capacityã€‚ compact(): ç¿»è½¬æ¨¡å¼ï¼šå†™æ¨¡å¼-&gt;è¯»æ¨¡å¼ å¦‚æœåªè¯»å–äº†ä¸€éƒ¨åˆ†ï¼Œå‰©ä¸‹çš„ä¸€éƒ¨åˆ†ä»¥åå†è¯»ï¼šæŠŠæœªè¯»å–çš„æ•°æ®æ‹·è´åˆ°æœ€å¼€å§‹çš„ä½ç½®ï¼ŒpositionæŒ‡å‘æœªè¯»æ•°æ®åé¢çš„ä½ç½®ï¼ŒlimitæŒ‡å‘capacity 2.2 Channelé€šé“ä¹‹é—´è¿›è¡Œæ•°æ®çš„ä¼ è¾“ï¼Œç±»ä¼¼äºStreamï¼Œå¯ä¸ç»è¿‡Bufferä¹‹é—´transferæ•°æ® ä¸»è¦æœ‰å¦‚ä¸‹å‡ ç§Channel FileChannel ServerSocketChannel SocketChannel 3 NIOå’ŒBIOå®ç°æ–‡ä»¶çš„å¤åˆ¶å£°æ˜æ¥å£ï¼š interface FileCopyRunner{ void copyFile(File source, File target); } å…³é—­èµ„æºæ–¹æ³•ï¼š private static void close(Closeable... closeable){ for(Closeable c:closeable){ try { c.close(); } catch (IOException e) { e.printStackTrace(); } } } BIOï¼Œä¸ä½¿ç”¨ç¼“å†²æµï¼š FileCopyRunner noBufferStreamCopy = new FileCopyRunner() { @Override public void copyFile(File source, File target) { InputStream fin = null; OutputStream fout = null; try { fin = new FileInputStream(source); fout = new FileOutputStream(target); int result; while((result = fin.read())!=-1){ fout.write(result); } } catch (IOException e) { e.printStackTrace(); } finally { close(fin,fout); } } @Override public String toString() { return \"noBufferStreamCopy\"; } }; BIOï¼Œä½¿ç”¨ç¼“å†²æµï¼š FileCopyRunner bufferedStreamCopy = new FileCopyRunner() { @Override public void copyFile(File source, File target) { InputStream fin = null; OutputStream fout = null; try { fin = new BufferedInputStream(new FileInputStream(source)); fout = new BufferedOutputStream(new FileOutputStream(target)); byte[] buffer = new byte[1024]; int result; while((result = fin.read(buffer))!=-1){ fout.write(buffer,0,result); } } catch (IOException e) { e.printStackTrace(); } finally { close(fin,fout); } } @Override public String toString() { return \"bufferedStreamCopy\"; } }; NIOï¼Œç»è¿‡Bufferï¼š FileCopyRunner nioBufferCopy = new FileCopyRunner() { @Override public void copyFile(File source, File target) { FileChannel fin = null; FileChannel fout = null; try { fin = new FileInputStream(source).getChannel(); fout = new FileOutputStream(target).getChannel(); ByteBuffer buffer = ByteBuffer.allocate(1024); while (fin.read(buffer)!=-1){ buffer.flip(); while (buffer.hasRemaining()){ fout.write(buffer); } buffer.clear(); } } catch (IOException e) { e.printStackTrace(); } finally { close(fin,fout); } } @Override public String toString() { return \"nioBufferCopy\"; } }; NIOï¼Œä¸ç»è¿‡Bufferï¼š FileCopyRunner nioTransferCopy = new FileCopyRunner() { @Override public void copyFile(File source, File target) { FileChannel fin = null; FileChannel fout = null; try { fin = new FileInputStream(source).getChannel(); fout = new FileOutputStream(target).getChannel(); long transferred = 0L; long size = fin.size(); while (transferred!=size) { transferred += fin.transferTo(0,size,fout); } } catch (IOException e) { e.printStackTrace(); } finally { close(fin,fout); } } @Override public String toString() { return \"nioTransferCopy\"; } }; å¯ä»¥ç¼–å†™å‡½æ•°è¿›è¡Œæ€§èƒ½æµ‹è¯•ï¼š private static final int ROUNDS = 5; private static void benchmark(FileCopyRunner test,File source,File target){ long elapsed = 0L; for(int i = 0;i&lt;ROUNDS;i++){ long startTime = System.currentTimeMillis(); test.copyFile(source,target); elapsed += System.currentTimeMillis() - startTime; target.delete(); } System.out.println(test+\":\"+elapsed/ROUNDS); }","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"IO","slug":"IO","permalink":"https://www.codetool.top/tags/IO/"},{"name":"NIO","slug":"NIO","permalink":"https://www.codetool.top/tags/NIO/"}]},{"title":"leetcode122-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºII","slug":"leetcode122-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºII","date":"2020-02-06T18:49:26.000Z","updated":"2020-04-22T09:27:27.141Z","comments":true,"path":"article/leetcode122-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºII/","link":"","permalink":"https://www.codetool.top/article/leetcode122-%E4%B9%B0%E5%8D%96%E8%82%A1%E7%A5%A8%E7%9A%84%E6%9C%80%E4%BD%B3%E6%97%B6%E6%9C%BAII/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´ æ˜¯ä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚ è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚ä½ å¯ä»¥å°½å¯èƒ½åœ°å®Œæˆæ›´å¤šçš„äº¤æ˜“ï¼ˆå¤šæ¬¡ä¹°å–ä¸€æ”¯è‚¡ç¥¨ï¼‰ã€‚ æ³¨æ„ï¼š ä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š [7,1,5,3,6,4]è¾“å‡ºï¼š 7è§£é‡Šï¼š åœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 3 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 5-1 = 4 ã€‚ éšåï¼Œåœ¨ç¬¬ 4 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 3ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 6ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 6-3 = 3 ã€‚ ç¤ºä¾‹2: è¾“å…¥ï¼š [1,2,3,4,5]è¾“å‡ºï¼š 4è§£é‡Šï¼š åœ¨ç¬¬ 1 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤© ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 5-1 = 4 ã€‚ æ³¨æ„ä½ ä¸èƒ½åœ¨ç¬¬ 1 å¤©å’Œç¬¬ 2 å¤©æ¥è¿è´­ä¹°è‚¡ç¥¨ï¼Œä¹‹åå†å°†å®ƒä»¬å–å‡ºã€‚ å› ä¸ºè¿™æ ·å±äºåŒæ—¶å‚ä¸äº†å¤šç¬”äº¤æ˜“ï¼Œä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ã€‚ ç¤ºä¾‹3: è¾“å…¥ï¼š [7,6,4,3,1]è¾“å‡ºï¼š 0è§£é‡Šï¼š åœ¨è¿™ç§æƒ…å†µä¸‹, æ²¡æœ‰äº¤æ˜“å®Œæˆ, æ‰€ä»¥æœ€å¤§åˆ©æ¶¦ä¸º 0ã€‚ 2 è§£æ³•2.1 æ€æƒ³ è®°å½•è°·å’Œå³°å€¼ è´ªå¿ƒç®—æ³• 2.2 ä»£ç è®°å½•è°·å’Œå³°å€¼ï¼š class Solution { public int maxProfit(int[] prices) { if(prices.length == 0) return 0; int sum = 0; int min,max; min = max = prices[0]; for(int i = 0;i&lt;prices.length;i++){ if(prices[i]&lt;min) min = prices[i]; if(prices[i]>=max) { max = prices[i]; if(i+1==prices.length || prices[i+1]&lt;max) { sum+=(max-min); if(i+1!=prices.length) min = max = prices[i+1]; } } } return sum; } } è´ªå¿ƒç®—æ³•ï¼š å¯¹äºä»»æ„ä¸¤å¤©ä¹‹é—´ï¼Œåªè¦æ¶¨äº†åˆ™è¿™ä¸ªé’±ä¸€å®šèƒ½èµšåˆ°ã€‚ class Solution { public int maxProfit(int[] prices) { int maxprofit = 0; for (int i = 1; i &lt; prices.length; i++) { if (prices[i] > prices[i - 1]) maxprofit += prices[i] - prices[i - 1]; } return maxprofit; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"JUCåŒ…ä¸‹çš„çº¿ç¨‹åä½œè®¡æ•°CountDownLatchåŠCyclicBarrier","slug":"JUCåŒ…ä¸‹çš„çº¿ç¨‹åä½œè®¡æ•°CountDownLatchåŠCyclicBarrier","date":"2020-02-06T14:53:26.000Z","updated":"2020-02-06T14:55:07.254Z","comments":true,"path":"article/JUCåŒ…ä¸‹çš„çº¿ç¨‹åä½œè®¡æ•°CountDownLatchåŠCyclicBarrier/","link":"","permalink":"https://www.codetool.top/article/JUC%E5%8C%85%E4%B8%8B%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%8D%8F%E4%BD%9C%E8%AE%A1%E6%95%B0CountDownLatch%E5%8F%8ACyclicBarrier/","excerpt":"","text":"1 CountDownLatch1.1 æ¦‚è¿°ç”¨æ¥è¿›è¡Œçº¿ç¨‹åŒæ­¥åä½œï¼Œç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆå€’è®¡æ—¶ã€‚ å…¶ä¸­æ„é€ å‚æ•°ç”¨æ¥åˆå§‹åŒ–ç­‰å¾…è®¡æ•°å€¼ï¼Œawait() ç”¨æ¥ç­‰å¾…è®¡æ•°å½’é›¶ï¼ŒcountDown() ç”¨æ¥è®©è®¡æ•°å‡ä¸€ CountDownLatchä¸èƒ½é‡ç”¨ï¼Œåªèƒ½å‡ä¸èƒ½åŠ  public static void main(String[] args) throws InterruptedException { CountDownLatch latch = new CountDownLatch(3); new Thread(() -> { log.debug(\"begin...\"); sleep(1); latch.countDown(); log.debug(\"end...{}\", latch.getCount()); }).start(); new Thread(() -> { log.debug(\"begin...\"); sleep(2); latch.countDown(); log.debug(\"end...{}\", latch.getCount()); }).start(); new Thread(() -> { log.debug(\"begin...\"); sleep(1.5); latch.countDown(); log.debug(\"end...{}\", latch.getCount()); }).start(); log.debug(\"waiting...\"); latch.await(); log.debug(\"wait end...\"); } è¾“å‡º 18:44:00.778 c.TestCountDownLatch [main] - waiting... 18:44:00.778 c.TestCountDownLatch [Thread-2] - begin... 18:44:00.778 c.TestCountDownLatch [Thread-0] - begin... 18:44:00.778 c.TestCountDownLatch [Thread-1] - begin... 18:44:01.782 c.TestCountDownLatch [Thread-0] - end...2 18:44:02.283 c.TestCountDownLatch [Thread-2] - end...1 18:44:02.782 c.TestCountDownLatch [Thread-1] - end...0 18:44:02.782 c.TestCountDownLatch [main] - wait end... å¯ä»¥é…åˆçº¿ç¨‹æ± ä½¿ç”¨ï¼Œæ”¹è¿›å¦‚ä¸‹ public static void main(String[] args) throws InterruptedException { CountDownLatch latch = new CountDownLatch(3); ExecutorService service = Executors.newFixedThreadPool(4); service.submit(() -> { log.debug(\"begin...\"); sleep(1); latch.countDown(); log.debug(\"end...{}\", latch.getCount()); }); service.submit(() -> { log.debug(\"begin...\"); sleep(1.5); latch.countDown(); log.debug(\"end...{}\", latch.getCount()); }); service.submit(() -> { log.debug(\"begin...\"); sleep(2); latch.countDown(); log.debug(\"end...{}\", latch.getCount()); }); service.submit(()->{ try { log.debug(\"waiting...\"); latch.await(); log.debug(\"wait end...\"); } catch (InterruptedException e) { e.printStackTrace(); } }); } 1.2 åº”ç”¨ç­‰å¾…å¤šçº¿ç¨‹å‡†å¤‡å®Œæ¯• AtomicInteger num = new AtomicInteger(0); ExecutorService service = Executors.newFixedThreadPool(10, (r) -> { return new Thread(r, \"t\" + num.getAndIncrement()); }); CountDownLatch latch = new CountDownLatch(10); String[] all = new String[10]; Random r = new Random(); for (int j = 0; j &lt; 10; j++) { int x = j; service.submit(() -> { for (int i = 0; i &lt;= 100; i++) { try { Thread.sleep(r.nextInt(100)); } catch (InterruptedException e) { } all[x] = Thread.currentThread().getName() + \"(\" + (i + \"%\") + \")\"; System.out.print(\"\\r\" + Arrays.toString(all)); } latch.countDown(); }); } latch.await(); System.out.println(\"\\næ¸¸æˆå¼€å§‹...\"); service.shutdown(); 2 CyclicBarrierå¾ªç¯æ …æ ï¼Œç”¨æ¥è¿›è¡Œçº¿ç¨‹åä½œï¼Œç­‰å¾…çº¿ç¨‹æ»¡è¶³æŸä¸ªè®¡æ•°ã€‚æ„é€ æ—¶è®¾ç½®ã€è®¡æ•°ä¸ªæ•°ã€ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°æŸä¸ªéœ€è¦â€œåŒæ­¥â€çš„æ—¶åˆ»è°ƒç”¨ await() æ–¹æ³•è¿›è¡Œç­‰å¾…ï¼Œå½“ç­‰å¾…çš„çº¿ç¨‹æ•°æ»¡è¶³ã€è®¡æ•°ä¸ªæ•°ã€æ—¶ï¼Œç»§ç»­æ‰§è¡Œ æ„é€ æ–¹æ³•ï¼š public CyclicBarrier(int parties) public CyclicBarrier(int parties, Runnable barrierAction) partiesæ˜¯å‚ä¸çº¿ç¨‹çš„ä¸ªæ•°ï¼Œæ¯æ¬¡è°ƒç”¨awaitç­‰å¾…çš„çº¿ç¨‹æ•°åŠ ä¸€ï¼Œç›´åˆ°è¾¾åˆ°partiesæ‰€æœ‰çº¿ç¨‹ç»§ç»­è¿è¡Œã€‚Runnable å‚æ•°åˆ™æ˜¯å¯ä»¥é€‰æ‹©è®¡æ•°å€¼è¾¾åˆ°partiesè¦åšçš„ä»»åŠ¡ã€‚ åœ¨è®¡æ•°å€¼è¾¾åˆ°partiesä¹‹åï¼Œç­‰å¾…çš„çº¿ç¨‹æ•°æ¸…é›¶ï¼Œå¯ä»¥é‡ç”¨ã€‚ CyclicBarrier cb = new CyclicBarrier(2); // ä¸ªæ•°ä¸º2æ—¶æ‰ä¼šç»§ç»­æ‰§è¡Œ new Thread(()->{ System.out.println(\"çº¿ç¨‹1å¼€å§‹..\"+new Date()); try { cb.await(); // å½“ä¸ªæ•°ä¸è¶³æ—¶ï¼Œç­‰å¾… } catch (InterruptedException | BrokenBarrierException e) { e.printStackTrace(); } System.out.println(\"çº¿ç¨‹1ç»§ç»­å‘ä¸‹è¿è¡Œ...\"+new Date()); }).start(); new Thread(()->{ System.out.println(\"çº¿ç¨‹2å¼€å§‹..\"+new Date()); try { Thread.sleep(2000); } catch (InterruptedException e) { } try { cb.await(); // 2 ç§’åï¼Œçº¿ç¨‹ä¸ªæ•°å¤Ÿ2ï¼Œç»§ç»­è¿è¡Œ } catch (InterruptedException | BrokenBarrierException e) { e.printStackTrace(); } System.out.println(\"çº¿ç¨‹2ç»§ç»­å‘ä¸‹è¿è¡Œ...\"+new Date()); }).start();","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://www.codetool.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"JUCåŒ…ä¸‹çš„ä¿¡å·é‡Semaphore","slug":"JUCåŒ…ä¸‹çš„ä¿¡å·é‡Semaphore","date":"2020-02-06T12:31:42.000Z","updated":"2020-04-22T09:27:27.142Z","comments":true,"path":"article/JUCåŒ…ä¸‹çš„ä¿¡å·é‡Semaphore/","link":"","permalink":"https://www.codetool.top/article/JUC%E5%8C%85%E4%B8%8B%E7%9A%84%E4%BF%A1%E5%8F%B7%E9%87%8FSemaphore/","excerpt":"","text":"1 æ¦‚è¿°ä¿¡å·é‡ï¼Œç”¨æ¥é™åˆ¶èƒ½åŒæ—¶è®¿é—®å…±äº«èµ„æºçš„çº¿ç¨‹ä¸Šé™ã€‚ public static void main(String[] args) { // 1. åˆ›å»º semaphore å¯¹è±¡ Semaphore semaphore = new Semaphore(3); // 2. 10ä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œ for (int i = 0; i &lt; 10; i++) { new Thread(() -> { // 3. è·å–è®¸å¯ try { semaphore.acquire(); } catch (InterruptedException e) { e.printStackTrace(); } try { log.debug(\"running...\"); sleep(1); log.debug(\"end...\"); } finally { // 4. é‡Šæ”¾è®¸å¯ semaphore.release(); } }).start(); } } è¾“å‡ºï¼š 07:35:15.485 c.TestSemaphore [Thread-2] - running... 07:35:15.485 c.TestSemaphore [Thread-1] - running... 07:35:15.485 c.TestSemaphore [Thread-0] - running... 07:35:16.490 c.TestSemaphore [Thread-2] - end... 07:35:16.490 c.TestSemaphore [Thread-0] - end... 07:35:16.490 c.TestSemaphore [Thread-1] - end... 07:35:16.490 c.TestSemaphore [Thread-3] - running... 07:35:16.490 c.TestSemaphore [Thread-5] - running... 07:35:16.490 c.TestSemaphore [Thread-4] - running... 07:35:17.490 c.TestSemaphore [Thread-5] - end... 07:35:17.490 c.TestSemaphore [Thread-4] - end... 07:35:17.490 c.TestSemaphore [Thread-3] - end... 07:35:17.490 c.TestSemaphore [Thread-6] - running... 07:35:17.490 c.TestSemaphore [Thread-7] - running... 07:35:17.490 c.TestSemaphore [Thread-9] - running... 07:35:18.491 c.TestSemaphore [Thread-6] - end... 07:35:18.491 c.TestSemaphore [Thread-7] - end... 07:35:18.491 c.TestSemaphore [Thread-9] - end... 07:35:18.491 c.TestSemaphore [Thread-8] - running... 07:35:19.492 c.TestSemaphore [Thread-8] - end... 2 åº”ç”¨ ä½¿ç”¨ Semaphore é™æµï¼Œåœ¨è®¿é—®é«˜å³°æœŸæ—¶ï¼Œè®©è¯·æ±‚çº¿ç¨‹é˜»å¡ï¼Œé«˜å³°æœŸè¿‡å»å†é‡Šæ”¾è®¸å¯ï¼Œå½“ç„¶å®ƒåªé€‚åˆé™åˆ¶å•æœºçº¿ç¨‹æ•°é‡ï¼Œå¹¶ä¸”ä»…æ˜¯é™åˆ¶çº¿ç¨‹æ•°ï¼Œè€Œä¸æ˜¯é™åˆ¶èµ„æºæ•°ï¼ˆä¾‹å¦‚è¿æ¥æ•°ï¼Œè¯·å¯¹æ¯” Tomcat LimitLatch çš„å®ç°ï¼‰ ç”¨ Semaphore å®ç°ç®€å•è¿æ¥æ± ï¼Œçº¿ç¨‹æ•°å’Œæ•°æ®åº“è¿æ¥æ•°æ˜¯ç›¸ç­‰çš„ class Pool { // 1. è¿æ¥æ± å¤§å° private final int poolSize; // 2. è¿æ¥å¯¹è±¡æ•°ç»„ private Connection[] connections; // 3. è¿æ¥çŠ¶æ€æ•°ç»„ 0 è¡¨ç¤ºç©ºé—²ï¼Œ 1 è¡¨ç¤ºç¹å¿™ private AtomicIntegerArray states; private Semaphore semaphore; // 4. æ„é€ æ–¹æ³•åˆå§‹åŒ– public Pool(int poolSize) { this.poolSize = poolSize; // è®©è®¸å¯æ•°ä¸èµ„æºæ•°ä¸€è‡´ this.semaphore = new Semaphore(poolSize); this.connections = new Connection[poolSize]; this.states = new AtomicIntegerArray(new int[poolSize]); for (int i = 0; i &lt; poolSize; i++) { connections[i] = new MockConnection(\"è¿æ¥\" + (i+1)); } } // 5. å€Ÿè¿æ¥ public Connection borrow() {// t1, t2, t3 // è·å–è®¸å¯ try { semaphore.acquire(); // æ²¡æœ‰è®¸å¯çš„çº¿ç¨‹ï¼Œåœ¨æ­¤ç­‰å¾… } catch (InterruptedException e) { e.printStackTrace(); } for (int i = 0; i &lt; poolSize; i++) { // è·å–ç©ºé—²è¿æ¥ if(states.get(i) == 0) { if (states.compareAndSet(i, 0, 1)) { log.debug(\"borrow {}\", connections[i]); return connections[i]; } } } // ä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ return null; } // 6. å½’è¿˜è¿æ¥ public void free(Connection conn) { for (int i = 0; i &lt; poolSize; i++) { if (connections[i] == conn) { states.set(i, 0); log.debug(\"free {}\", conn); semaphore.release(); break; } } } } 3 åŸç†AQSä½¿ç”¨å…±äº«æ¨¡å¼ï¼Œstateä»£è¡¨èµ„æºæ•°ï¼Œstateå¤§äº0æ‰èƒ½è·å¾—é”ï¼Œå¦åˆ™è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://www.codetool.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"åŸºäºBIOæ¨¡å‹å®ç°å¤šäººèŠå¤©å®¤","slug":"åŸºäºBIOæ¨¡å‹å®ç°å¤šäººèŠå¤©å®¤","date":"2020-02-06T06:20:55.000Z","updated":"2020-02-20T14:51:37.949Z","comments":true,"path":"article/åŸºäºBIOæ¨¡å‹å®ç°å¤šäººèŠå¤©å®¤/","link":"","permalink":"https://www.codetool.top/article/%E5%9F%BA%E4%BA%8EBIO%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0%E5%A4%9A%E4%BA%BA%E8%81%8A%E5%A4%A9%E5%AE%A4/","excerpt":"","text":"1 ç¬¬ä¸€ç‰ˆæœåŠ¡ç«¯å®ç°ï¼š public class ChatServer { private int DEFAULT_PORT = 8888; private final String QUIT = \"quit\"; private ServerSocket serverSocket; private Map&lt;Integer, Writer> connectedClients; public ChatServer() { connectedClients = new HashMap&lt;>(); } public synchronized void addClient(Socket socket) throws IOException { if(socket==null) return; int port = socket.getPort(); BufferedWriter writer = new BufferedWriter( new OutputStreamWriter(socket.getOutputStream()) ); connectedClients.put(port,writer); System.out.println(\"å®¢æˆ·ç«¯[\"+port+\"]å·²è¿æ¥åˆ°æœåŠ¡å™¨\"); } public synchronized void removeClient(Socket socket) throws IOException { if(socket==null) return; int port = socket.getPort(); if(connectedClients.containsKey(port)){ connectedClients.get(port).close(); } connectedClients.remove(port); System.out.println(\"å®¢æˆ·ç«¯[\"+port+\"]å·²æ–­å¼€è¿æ¥\"); } public synchronized void forwardMessage(Socket socket,String fwdMsg){ connectedClients.forEach((id,writer)->{ if(!id.equals(socket.getPort())){ try { writer.write(fwdMsg); writer.flush(); } catch (IOException e) { e.printStackTrace(); } } }); } public synchronized void close(){ if(serverSocket!=null){ try { serverSocket.close(); System.out.println(\"å…³é—­ServerSocket\"); } catch (IOException e) { e.printStackTrace(); } } } public boolean readyToQuit(String msg){ return msg.equals(QUIT); } public void start(){ try { // ç»‘å®šç›‘å¬ç«¯å£ serverSocket = new ServerSocket(DEFAULT_PORT); System.out.println(\"å¯åŠ¨æœåŠ¡å™¨ï¼Œç›‘å¬ç«¯å£ï¼š\"+DEFAULT_PORT+\"...\"); while(true){ // ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ Socket socket = serverSocket.accept(); // åˆ›å»ºChatHandlerçº¿ç¨‹ new Thread(new ChatHandler(this,socket)).start(); } } catch (IOException e) { e.printStackTrace(); } finally { close(); } } public static void main(String[] args) { ChatServer server = new ChatServer(); server.start(); } } æœåŠ¡ç«¯åˆ†é…çº¿ç¨‹æœåŠ¡ç”¨æˆ·ï¼š public class ChatHandler implements Runnable{ private ChatServer server; private Socket socket; public ChatHandler(ChatServer server,Socket socket){ this.server = server; this.socket = socket; } @Override public void run() { try { // å­˜å‚¨æ–°ä¸Šçº¿ç”¨æˆ· server.addClient(socket); // è¯»å–ç”¨æˆ·å‘é€çš„æ¶ˆæ¯ BufferedReader reader = new BufferedReader( new InputStreamReader(socket.getInputStream()) ); String msg = null; while ((msg = reader.readLine())!=null){ String fwdMsg = \"å®¢æˆ·ç«¯[\"+socket.getPort()+\"]:\"+msg; System.out.println(fwdMsg); if(server.readyToQuit(msg)) break; // å°†æ¶ˆæ¯è½¬å‘ç»™èŠå¤©å®¤é‡Œåœ¨çº¿çš„å…¶ä»–ç”¨æˆ· server.forwardMessage(socket,fwdMsg+\"\\n\"); } } catch (IOException e) { e.printStackTrace(); }finally { try { server.removeClient(socket); } catch (IOException e) { e.printStackTrace(); } } } } ç”¨æˆ·ç«¯ï¼š public class ChatClient { private final String DEFAULT_SERVER_HOST = \"127.0.0.1\"; private final int DEFAULT_SERVER_PORT = 8888; private final String QUIT = \"quit\"; private Socket socket; private BufferedReader reader; private BufferedWriter writer; // å‘é€æ¶ˆæ¯ç»™æœåŠ¡å™¨ public void send(String msg) throws IOException { if(!socket.isOutputShutdown()){ writer.write(msg+\"\\n\"); writer.flush(); } } // ä»æœåŠ¡å™¨æ¥æ”¶æ¶ˆæ¯ public String recieve() throws IOException { String msg = null; if(!socket.isInputShutdown()){ msg = reader.readLine(); } return msg; } // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å‡†å¤‡é€€å‡º public boolean readyToQuit(String msg){ return QUIT.equals(msg); } public void close(){ if(writer!=null){ try { System.out.println(\"å…³é—­socket\"); writer.close(); } catch (IOException e) { e.printStackTrace(); } } } public void start(){ try { // åˆ›å»ºsocket socket = new Socket(DEFAULT_SERVER_HOST, DEFAULT_SERVER_PORT); // åˆ›å»ºIOæµ reader = new BufferedReader( new InputStreamReader(socket.getInputStream()) ); writer = new BufferedWriter( new OutputStreamWriter(socket.getOutputStream()) ); // å¤„ç†ç”¨æˆ·çš„è¾“å…¥ new Thread(new UserInputHandler(this)).start(); // è¯»å–æœåŠ¡å™¨è½¬å‘çš„æ¶ˆæ¯ String msg = null; while((msg = recieve())!=null){ System.out.println(msg); } } catch (IOException e) { e.printStackTrace(); }finally { close(); } } public static void main(String[] args) { ChatClient client = new ChatClient(); client.start(); } } ç”¨æˆ·çº¿ç¨‹å¤„ç†IOè¾“å…¥ï¼š public class UserInputHandler implements Runnable{ private ChatClient chatClient; public UserInputHandler(ChatClient chatClient){ this.chatClient = chatClient; } @Override public void run() { try { // ç­‰å¾…ç”¨æˆ·è¾“å…¥æ¶ˆæ¯ BufferedReader consoleReader = new BufferedReader( new InputStreamReader(System.in) ); while (true){ String input = consoleReader.readLine(); // å‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯ chatClient.send(input); // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å‡†å¤‡é€€å‡º if(chatClient.readyToQuit(input)){ break; } } } catch (IOException e) { e.printStackTrace(); } } } 2 ç¬¬äºŒç‰ˆï¼šä½¿ç”¨çº¿ç¨‹æ± æ”¹è¿›æœåŠ¡ç«¯ï¼Œåˆ›å»ºçº¿ç¨‹ä½¿ç”¨çº¿ç¨‹æ± ï¼š public class ChatServer { private int DEFAULT_PORT = 8888; private final String QUIT = \"quit\"; private ExecutorService executorService; private ServerSocket serverSocket; private Map&lt;Integer, Writer> connectedClients; public ChatServer() { executorService = Executors.newFixedThreadPool(10); connectedClients = new HashMap&lt;>(); } public synchronized void addClient(Socket socket) throws IOException { if(socket==null) return; int port = socket.getPort(); BufferedWriter writer = new BufferedWriter( new OutputStreamWriter(socket.getOutputStream()) ); connectedClients.put(port,writer); System.out.println(\"å®¢æˆ·ç«¯[\"+port+\"]å·²è¿æ¥åˆ°æœåŠ¡å™¨\"); } public synchronized void removeClient(Socket socket) throws IOException { if(socket==null) return; int port = socket.getPort(); if(connectedClients.containsKey(port)){ connectedClients.get(port).close(); } connectedClients.remove(port); System.out.println(\"å®¢æˆ·ç«¯[\"+port+\"]å·²æ–­å¼€è¿æ¥\"); } public synchronized void forwardMessage(Socket socket,String fwdMsg){ connectedClients.forEach((id,writer)->{ if(!id.equals(socket.getPort())){ try { writer.write(fwdMsg); writer.flush(); } catch (IOException e) { e.printStackTrace(); } } }); } public synchronized void close(){ if(serverSocket!=null){ try { serverSocket.close(); System.out.println(\"å…³é—­ServerSocket\"); } catch (IOException e) { e.printStackTrace(); } } } public boolean readyToQuit(String msg){ return msg.equals(QUIT); } public void start(){ try { // ç»‘å®šç›‘å¬ç«¯å£ serverSocket = new ServerSocket(DEFAULT_PORT); System.out.println(\"å¯åŠ¨æœåŠ¡å™¨ï¼Œç›‘å¬ç«¯å£ï¼š\"+DEFAULT_PORT+\"...\"); while(true){ // ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ Socket socket = serverSocket.accept(); // åˆ›å»ºChatHandlerçº¿ç¨‹ executorService.execute(new ChatHandler(this,socket)); } } catch (IOException e) { e.printStackTrace(); } finally { close(); } } public static void main(String[] args) { ChatServer server = new ChatServer(); server.start(); } }","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"IO","slug":"IO","permalink":"https://www.codetool.top/tags/IO/"},{"name":"ç½‘ç»œç¼–ç¨‹","slug":"ç½‘ç»œç¼–ç¨‹","permalink":"https://www.codetool.top/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"}]},{"title":"leetcode263-ä¸‘æ•°","slug":"leetcode263-ä¸‘æ•°","date":"2020-02-05T18:51:18.000Z","updated":"2020-02-06T05:38:44.047Z","comments":true,"path":"article/leetcode263-ä¸‘æ•°/","link":"","permalink":"https://www.codetool.top/article/leetcode263-%E4%B8%91%E6%95%B0/","excerpt":"","text":"1 åŸé¢˜ç¼–å†™ä¸€ä¸ªç¨‹åºåˆ¤æ–­ç»™å®šçš„æ•°æ˜¯å¦ä¸ºä¸‘æ•°ã€‚ ä¸‘æ•°å°±æ˜¯åªåŒ…å«è´¨å› æ•° 2, 3, 5 çš„æ­£æ•´æ•°ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š 6è¾“å‡ºï¼š trueè§£é‡Šï¼š 6 = 2 Ã— 3 ç¤ºä¾‹2: è¾“å…¥ï¼š 8è¾“å‡ºï¼š trueè§£é‡Šï¼š 8 = 2 Ã— 2 Ã— 2 ç¤ºä¾‹3: è¾“å…¥ï¼š 14è¾“å‡ºï¼š falseè§£é‡Šï¼š 14 ä¸æ˜¯ä¸‘æ•°ï¼Œå› ä¸ºå®ƒåŒ…å«äº†å¦å¤–ä¸€ä¸ªè´¨å› æ•° 7ã€‚è¯´æ˜ï¼š 1 æ˜¯ä¸‘æ•°ã€‚ è¾“å…¥ä¸ä¼šè¶…è¿‡ 32 ä½æœ‰ç¬¦å·æ•´æ•°çš„èŒƒå›´: [âˆ’231, 231 âˆ’ 1]ã€‚ 2 è§£æ³•2.1 æ€æƒ³åœ¨è¯¥æ•°æ²¡è¢«é™¤ä¸º1ä¹‹å‰é‡å¤é™¤ä»¥2ã€3æˆ–5ã€‚ 2.2 ä»£ç class Solution { public boolean isUgly(int num) { if(num&lt;1) return false; while(num!=1){ if(num%2==0){ num /= 2; continue; } if(num%3==0){ num /= 3; continue; } if(num%5==0){ num /= 5; continue; } return false; } return true; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"JUCåŒ…ä¸‹çš„è¯»å†™é”ReentrantReadWriteLockä»¥åŠStampedLock","slug":"JUCåŒ…ä¸‹çš„è¯»å†™é”ReentrantReadWriteLockä»¥åŠStampedLock","date":"2020-02-05T14:42:15.000Z","updated":"2020-04-22T09:27:27.142Z","comments":true,"path":"article/JUCåŒ…ä¸‹çš„è¯»å†™é”ReentrantReadWriteLockä»¥åŠStampedLock/","link":"","permalink":"https://www.codetool.top/article/JUC%E5%8C%85%E4%B8%8B%E7%9A%84%E8%AF%BB%E5%86%99%E9%94%81ReentrantReadWriteLock%E4%BB%A5%E5%8F%8AStampedLock/","excerpt":"","text":"1 ReentrantReadWriteLock1.1 æ¦‚è¿°å½“è¯»æ“ä½œè¿œè¿œé«˜äºå†™æ“ä½œæ—¶ï¼Œè¿™æ—¶å€™ä½¿ç”¨ è¯»å†™é” è®© è¯»-è¯» å¯ä»¥å¹¶å‘ï¼Œæé«˜æ€§èƒ½ã€‚ ç±»ä¼¼äºæ•°æ®åº“ä¸­çš„ select ... from ... lock in share mode æä¾›ä¸€ä¸ª æ•°æ®å®¹å™¨ç±» å†…éƒ¨åˆ†åˆ«ä½¿ç”¨è¯»é”ä¿æŠ¤æ•°æ®çš„ read() æ–¹æ³•ï¼Œå†™é”ä¿æŠ¤æ•°æ®çš„ write() æ–¹æ³• class DataContainer { private Object data; private ReentrantReadWriteLock rw = new ReentrantReadWriteLock(); private ReentrantReadWriteLock.ReadLock r = rw.readLock(); private ReentrantReadWriteLock.WriteLock w = rw.writeLock(); public Object read() { log.debug(\"è·å–è¯»é”...\"); r.lock(); try { log.debug(\"è¯»å–\"); sleep(1); return data; } finally { log.debug(\"é‡Šæ”¾è¯»é”...\"); r.unlock(); } } public void write() { log.debug(\"è·å–å†™é”...\"); w.lock(); try { log.debug(\"å†™å…¥\"); sleep(1); } finally { log.debug(\"é‡Šæ”¾å†™é”...\"); w.unlock(); } } } æ³¨æ„äº‹é¡¹ è¯»é”ä¸æ”¯æŒæ¡ä»¶å˜é‡ é‡å…¥æ—¶å‡çº§ä¸æ”¯æŒï¼šå³æŒæœ‰è¯»é”çš„æƒ…å†µä¸‹å»è·å–å†™é”ï¼Œä¼šå¯¼è‡´è·å–å†™é”æ°¸ä¹…ç­‰å¾…ï¼ˆå¿…é¡»å…ˆé‡Šæ”¾è¯»é”ï¼‰ r.lock();//è·å–è¯»é” try { // è·å–å†™é”ï¼Œä¸æ”¯æŒ w.lock(); try { // ... } finally{ w.unlock(); } } finally{ r.unlock(); } é‡å…¥æ—¶é™çº§æ”¯æŒï¼šå³æŒæœ‰å†™é”çš„æƒ…å†µä¸‹å»è·å–è¯»é” 1.2 è¯»å†™é”åº”ç”¨ä¹‹ç¼“å­˜ä¸€è‡´æ€§åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæ•°æ®åº“ç¼“å­˜å¯èƒ½ä¼šå‡ºç°ä¸ä¸€è‡´ï¼š å…ˆæ¸…ç©ºç¼“å­˜ï¼š å…ˆæ›´æ–°æ•°æ®åº“ï¼š class GenericCachedDao&lt;T> { // HashMap ä½œä¸ºç¼“å­˜éçº¿ç¨‹å®‰å…¨, éœ€è¦ä¿æŠ¤ HashMap&lt;SqlPair, T> map = new HashMap&lt;>(); ReentrantReadWriteLock lock = new ReentrantReadWriteLock(); GenericDao genericDao = new GenericDao(); public int update(String sql, Object... params) { SqlPair key = new SqlPair(sql, params); // åŠ å†™é”, é˜²æ­¢å…¶å®ƒçº¿ç¨‹å¯¹ç¼“å­˜è¯»å–å’Œæ›´æ”¹ lock.writeLock().lock(); try { int rows = genericDao.update(sql, params); map.clear(); return rows; } finally { lock.writeLock().unlock(); } } public T queryOne(Class&lt;T> beanClass, String sql, Object... params) { SqlPair key = new SqlPair(sql, params); // åŠ è¯»é”, é˜²æ­¢å…¶å®ƒçº¿ç¨‹å¯¹ç¼“å­˜æ›´æ”¹ lock.readLock().lock(); try { T value = map.get(key); if (value != null) { return value; } } finally { lock.readLock().unlock(); } // åŠ å†™é”, é˜²æ­¢å…¶å®ƒçº¿ç¨‹å¯¹ç¼“å­˜è¯»å–å’Œæ›´æ”¹ lock.writeLock().lock(); try { // get æ–¹æ³•ä¸Šé¢éƒ¨åˆ†æ˜¯å¯èƒ½å¤šä¸ªçº¿ç¨‹è¿›æ¥çš„, å¯èƒ½å·²ç»å‘ç¼“å­˜å¡«å……äº†æ•°æ® // ä¸ºé˜²æ­¢é‡å¤æŸ¥è¯¢æ•°æ®åº“, å†æ¬¡éªŒè¯ T value = map.get(key); if (value == null) { // å¦‚æœæ²¡æœ‰, æŸ¥è¯¢æ•°æ®åº“ value = genericDao.queryOne(beanClass, sql, params); map.put(key, value); } return value; } finally { lock.writeLock().unlock(); } } // ä½œä¸º key ä¿è¯å…¶æ˜¯ä¸å¯å˜çš„ class SqlPair { private String sql; private Object[] params; public SqlPair(String sql, Object[] params) { this.sql = sql; this.params = params; } @Override public boolean equals(Object o) { if (this == o) { return true; } if (o == null || getClass() != o.getClass()) { return false; } SqlPair sqlPair = (SqlPair) o; return sql.equals(sqlPair.sql) &amp;&amp; Arrays.equals(params, sqlPair.params); } @Override public int hashCode() { int result = Objects.hash(sql); result = 31 * result + Arrays.hashCode(params); return result; } } } æ³¨æ„ï¼š ä»¥ä¸Šå®ç°ä½“ç°çš„æ˜¯è¯»å†™é”çš„åº”ç”¨ï¼Œä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„ä¸€è‡´æ€§ï¼Œä½†æœ‰ä¸‹é¢çš„é—®é¢˜æ²¡æœ‰è€ƒè™‘ é€‚åˆè¯»å¤šå†™å°‘ï¼Œå¦‚æœå†™æ“ä½œæ¯”è¾ƒé¢‘ç¹ï¼Œä»¥ä¸Šå®ç°æ€§èƒ½ä½ æ²¡æœ‰è€ƒè™‘ç¼“å­˜å®¹é‡ æ²¡æœ‰è€ƒè™‘ç¼“å­˜è¿‡æœŸ åªé€‚åˆå•æœº å¹¶å‘æ€§è¿˜æ˜¯ä½ï¼Œç›®å‰åªä¼šç”¨ä¸€æŠŠé” æ›´æ–°æ–¹æ³•å¤ªè¿‡ç®€å•ç²—æš´ï¼Œæ¸…ç©ºäº†æ‰€æœ‰ keyï¼ˆè€ƒè™‘æŒ‰ç±»å‹åˆ†åŒºæˆ–é‡æ–°è®¾è®¡ keyï¼‰ å¯ä»¥ä½¿ç”¨ä¹è§‚é”å®ç°ï¼šç”¨ CAS å»æ›´æ–° 1.3 è¯»å†™é”åŸç†è¯»å†™é”å°†AQSçš„stateåˆ†ä¸ºé«˜16ä½å’Œä½16ä½ã€‚è¯»é”ç”¨é«˜16ä½ï¼Œè¡¨ç¤ºæŒæœ‰è¯»é”çš„çº¿ç¨‹æ•°ï¼Œå†™é”ç”¨ä½16ä½ï¼Œè¡¨ç¤ºå†™é”çš„é‡å…¥æ¬¡æ•°ã€‚ å‚è€ƒï¼šhttps://www.cnblogs.com/xiaoxi/p/9140541.html 2 StampedLockè¯¥ç±»è‡ª JDK 8 åŠ å…¥ï¼Œæ˜¯ä¸ºäº†è¿›ä¸€æ­¥ä¼˜åŒ–è¯»æ€§èƒ½ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯åœ¨ä½¿ç”¨è¯»é”ã€å†™é”æ—¶éƒ½å¿…é¡»é…åˆã€æˆ³ã€‘ä½¿ç”¨ åŠ è§£è¯»é” long stamp = lock.readLock(); lock.unlockRead(stamp); åŠ è§£å†™é” long stamp = lock.writeLock(); lock.unlockWrite(stamp); ä¹è§‚è¯»ï¼ŒStampedLock æ”¯æŒ tryOptimisticRead() æ–¹æ³•ï¼ˆä¹è§‚è¯»ï¼‰ï¼Œè¯»å–å®Œæ¯•åéœ€è¦åšä¸€æ¬¡ æˆ³æ ¡éªŒ å¦‚æœæ ¡éªŒé€šè¿‡ï¼Œè¡¨ç¤ºè¿™æœŸé—´ç¡®å®æ²¡æœ‰å†™æ“ä½œï¼Œæ•°æ®å¯ä»¥å®‰å…¨ä½¿ç”¨ï¼Œå¦‚æœæ ¡éªŒæ²¡é€šè¿‡ï¼Œéœ€è¦é‡æ–°è·å–è¯»é”ï¼Œä¿è¯æ•°æ®å®‰å…¨ã€‚ æä¾›ä¸€ä¸ª æ•°æ®å®¹å™¨ç±» å†…éƒ¨åˆ†åˆ«ä½¿ç”¨è¯»é”ä¿æŠ¤æ•°æ®çš„ read() æ–¹æ³•ï¼Œå†™é”ä¿æŠ¤æ•°æ®çš„ write() æ–¹æ³• class DataContainerStamped { private int data; private final StampedLock lock = new StampedLock(); public DataContainerStamped(int data) { this.data = data; } public int read(int readTime) { long stamp = lock.tryOptimisticRead(); log.debug(\"optimistic read locking...{}\", stamp); sleep(readTime); if (lock.validate(stamp)) { log.debug(\"read finish...{}, data:{}\", stamp, data); return data; } // é”å‡çº§ - è¯»é” log.debug(\"updating to read lock... {}\", stamp); try { stamp = lock.readLock(); log.debug(\"read lock {}\", stamp); sleep(readTime); log.debug(\"read finish...{}, data:{}\", stamp, data); return data; } finally { log.debug(\"read unlock {}\", stamp); lock.unlockRead(stamp); } } public void write(int newData) { long stamp = lock.writeLock(); log.debug(\"write lock {}\", stamp); try { sleep(2); this.data = newData; } finally { log.debug(\"write unlock {}\", stamp); lock.unlockWrite(stamp); } } } æµ‹è¯• è¯»-è¯» å¯ä»¥ä¼˜åŒ–ï¼šï¼ˆåªæœ‰çº¿ç¨‹è¿›è¡Œè¯»æ“ä½œï¼Œæˆ³ä¸ä¼šå˜åŒ–ï¼Œä¸ä¼šåŠ é”ï¼‰ public static void main(String[] args) { DataContainerStamped dataContainer = new DataContainerStamped(1); new Thread(() -> { dataContainer.read(1); }, \"t1\").start(); sleep(0.5); new Thread(() -> { dataContainer.read(0); }, \"t2\").start(); } è¾“å‡ºç»“æœï¼š 15:58:50.217 c.DataContainerStamped [t1] - optimistic read locking...256 15:58:50.717 c.DataContainerStamped [t2] - optimistic read locking...256 15:58:50.717 c.DataContainerStamped [t2] - read finish...256, data:1 15:58:51.220 c.DataContainerStamped [t1] - read finish...256, data:1 æµ‹è¯• è¯»-å†™ æ—¶ä¼˜åŒ–è¯»è¡¥åŠ è¯»é”ï¼š public static void main(String[] args) { DataContainerStamped dataContainer = new DataContainerStamped(1); new Thread(() -> { dataContainer.read(1); }, \"t1\").start(); sleep(0.5); new Thread(() -> { dataContainer.write(100); }, \"t2\").start(); } è¾“å‡ºç»“æœï¼š 15:57:00.219 c.DataContainerStamped [t1] - optimistic read locking...256 15:57:00.717 c.DataContainerStamped [t2] - write lock 384 15:57:01.225 c.DataContainerStamped [t1] - updating to read lock... 256 15:57:02.719 c.DataContainerStamped [t2] - write unlock 384 15:57:02.719 c.DataContainerStamped [t1] - read lock 513 15:57:03.719 c.DataContainerStamped [t1] - read finish...513, data:1000 15:57:03.719 c.DataContainerStamped [t1] - read unlock 513 æ³¨æ„ StampedLock ä¸æ”¯æŒæ¡ä»¶å˜é‡ StampedLock ä¸æ”¯æŒå¯é‡å…¥","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://www.codetool.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"leetcode169-å¤šæ•°å…ƒç´ ","slug":"leetcode169-å¤šæ•°å…ƒç´ ","date":"2020-02-04T17:58:20.000Z","updated":"2020-02-20T14:55:21.051Z","comments":true,"path":"article/leetcode169-å¤šæ•°å…ƒç´ /","link":"","permalink":"https://www.codetool.top/article/leetcode169-%E5%A4%9A%E6%95%B0%E5%85%83%E7%B4%A0/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªå¤§å°ä¸º n çš„æ•°ç»„ï¼Œæ‰¾åˆ°å…¶ä¸­çš„å¤šæ•°å…ƒç´ ã€‚å¤šæ•°å…ƒç´ æ˜¯æŒ‡åœ¨æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°å¤§äº âŒŠ n/2 âŒ‹ çš„å…ƒç´ ã€‚ ä½ å¯ä»¥å‡è®¾æ•°ç»„æ˜¯éç©ºçš„ï¼Œå¹¶ä¸”ç»™å®šçš„æ•°ç»„æ€»æ˜¯å­˜åœ¨å¤šæ•°å…ƒç´ ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š [3,2,3]è¾“å‡ºï¼š 3 ç¤ºä¾‹2: è¾“å…¥ï¼š [2,2,1,1,1,2,2]è¾“å‡ºï¼š 2 2 è§£æ³•2.1 æ€æƒ³å“ˆå¸Œè¡¨è®°å½•æ¯ä¸ªå…ƒç´ çš„å‡ºç°æ¬¡æ•° 2.2 ä»£ç class Solution { public int majorityElement(int[] nums) { int length = nums.length; Map&lt;Integer,Integer> map = new HashMap&lt;>(); for(int i:nums){ int newer = map.getOrDefault(i,0)+1; if(newer>length/2) return i; map.put(i,newer); } return 0; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"Javaç½‘ç»œå¥—æ¥å­—Socketç¼–ç¨‹","slug":"Javaç½‘ç»œå¥—æ¥å­—Socketç¼–ç¨‹","date":"2020-02-04T17:27:19.000Z","updated":"2020-02-20T14:55:21.051Z","comments":true,"path":"article/Javaç½‘ç»œå¥—æ¥å­—Socketç¼–ç¨‹/","link":"","permalink":"https://www.codetool.top/article/Java%E7%BD%91%E7%BB%9C%E5%A5%97%E6%8E%A5%E5%AD%97Socket%E7%BC%96%E7%A8%8B/","excerpt":"","text":"1 Socketæ¦‚è¿°Socketï¼Œè¯‘ä½œç½‘ç»œå¥—æ¥å­—ï¼Œæ˜¯åº”ç”¨å±‚ä¸TCP/IPåè®®æ—é€šä¿¡çš„ä¸­é—´è½¯ä»¶æŠ½è±¡å±‚ï¼Œå®ƒæ˜¯ä¸€ç»„æ¥å£ã€‚ç½‘ç»œå¥—æ¥å­—ä¸ä¸€ä¸ªåº”ç”¨è¿›ç¨‹ï¼ˆipå’Œç«¯å£å·ï¼‰ç»‘å®šã€‚ 2 Socketä¸ServerSocketSocketä¸ServerSocketæ˜¯Javaä¸­Socketç¼–ç¨‹çš„å¸¸ç”¨ç±»ï¼Œä¸€èˆ¬åˆ†åˆ«æŒ‡å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„socketã€‚ å·¥ä½œæµç¨‹ï¼š æœåŠ¡ç«¯bind():ç»‘å®šç«¯å£ æœåŠ¡ç«¯accept():ç­‰å¾…å®¢æˆ·ç«¯å»ºç«‹è¿æ¥ å®¢æˆ·ç«¯connect():è¿æ¥åˆ°æœåŠ¡ç«¯ åŒæ–¹è¿›è¡ŒIOæ“ä½œ æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯close():å…³é—­socketè¿æ¥ 2.1 ä»£ç ç¤ºä¾‹å®ç°ä¸€ä¸ªå®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å‘é€æ•°æ®ï¼ŒæœåŠ¡ç«¯æŒ‰åŸæ•°æ®è¿”å›çš„ç¨‹åºã€‚ 2.1.1 ç¬¬ä¸€ç‰ˆæœåŠ¡ç«¯ï¼š public class Server { public static void main(String[] args) { final int DEFAULT_PORT = 8888; ServerSocket serverSocket = null; // ç»‘å®šç›‘å¬ç«¯å£ try { serverSocket = new ServerSocket(DEFAULT_PORT); System.out.println(\"å¯åŠ¨æœåŠ¡å™¨ï¼Œç›‘å¬ç«¯å£\"+DEFAULT_PORT); while (true){ Socket socket = serverSocket.accept();//ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ï¼Œé˜»å¡ System.out.println(\"å®¢æˆ·ç«¯[\"+socket.getPort()+\"]å·²è¿æ¥\"); BufferedReader reader = new BufferedReader( new InputStreamReader(socket.getInputStream()) ); BufferedWriter writer = new BufferedWriter( new OutputStreamWriter(socket.getOutputStream()) ); // è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ String msg = reader.readLine(); if(msg!=null){ System.out.println(\"å®¢æˆ·ç«¯[\"+socket.getPort()+\"]: \" + msg); //å›å¤å®¢æˆ·å‘é€çš„æ¶ˆæ¯ writer.write(\"æœåŠ¡å™¨: \"+msg+\"\\n\"); writer.flush(); } } } catch (IOException e) { e.printStackTrace(); } finally { try { serverSocket.close(); } catch (IOException e) { e.printStackTrace(); } } } } å®¢æˆ·ç«¯ï¼šï¼ˆè¿è¡ŒäºåŒä¸€å°ä¸»æœºä¸Šï¼‰ public class Client { public static void main(String[] args) { final String DEFAULT_SERVER_HOST=\"127.0.0.1\"; final int DEFAULT_PORT = 8888; Socket socket = null; BufferedWriter writer = null; try { //åˆ›å»ºsocket socket = new Socket(DEFAULT_SERVER_HOST,DEFAULT_PORT); //åˆ›å»ºIOæµ BufferedReader reader = new BufferedReader( new InputStreamReader(socket.getInputStream()) ); writer = new BufferedWriter( new OutputStreamWriter(socket.getOutputStream()) ); // ç­‰å¾…ç”¨æˆ·è¾“å…¥ä¿¡æ¯ BufferedReader consoleReader = new BufferedReader( new InputStreamReader(System.in) ); String input = consoleReader.readLine(); //å‘é€æ¶ˆæ¯ç»™æœåŠ¡å™¨ writer.write(input+\"\\n\"); writer.flush(); //è¯»å–æœåŠ¡å™¨è¿”å›çš„æ¶ˆæ¯ String msg = reader.readLine(); System.out.println(msg); } catch (IOException e) { e.printStackTrace(); }finally { if(writer!=null){ try { writer.close(); } catch (IOException e) { e.printStackTrace(); } } } } } 2.1.2 ç¬¬äºŒç‰ˆä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥åå¤å‘é€æ¶ˆæ¯ï¼Œç›´åˆ°è¾“å…¥quité€€å‡º å®¢æˆ·ç«¯ï¼š public class Client { public static void main(String[] args) { final String QUIT = \"quit\"; final String DEFAULT_SERVER_HOST=\"127.0.0.1\"; final int DEFAULT_PORT = 8888; Socket socket = null; BufferedWriter writer = null; try { //åˆ›å»ºsocket socket = new Socket(DEFAULT_SERVER_HOST,DEFAULT_PORT); //åˆ›å»ºIOæµ BufferedReader reader = new BufferedReader( new InputStreamReader(socket.getInputStream()) ); writer = new BufferedWriter( new OutputStreamWriter(socket.getOutputStream()) ); // ç­‰å¾…ç”¨æˆ·è¾“å…¥ä¿¡æ¯ BufferedReader consoleReader = new BufferedReader( new InputStreamReader(System.in) ); while(true){ String input = consoleReader.readLine(); if(input.equals(QUIT)) break; //å‘é€æ¶ˆæ¯ç»™æœåŠ¡å™¨ writer.write(input+\"\\n\"); writer.flush(); //è¯»å–æœåŠ¡å™¨è¿”å›çš„æ¶ˆæ¯ String msg = reader.readLine(); System.out.println(msg); } } catch (IOException e) { e.printStackTrace(); }finally { if(writer!=null){ try { writer.close(); } catch (IOException e) { e.printStackTrace(); } } } } } æœåŠ¡ç«¯ï¼š public class Server { public static void main(String[] args) { final int DEFAULT_PORT = 8888; ServerSocket serverSocket = null; // ç»‘å®šç›‘å¬ç«¯å£ try { serverSocket = new ServerSocket(DEFAULT_PORT); System.out.println(\"å¯åŠ¨æœåŠ¡å™¨ï¼Œç›‘å¬ç«¯å£\"+DEFAULT_PORT); while (true){ Socket socket = serverSocket.accept();//ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ï¼Œé˜»å¡ System.out.println(\"å®¢æˆ·ç«¯[\"+socket.getPort()+\"]å·²è¿æ¥\"); BufferedReader reader = new BufferedReader( new InputStreamReader(socket.getInputStream()) ); BufferedWriter writer = new BufferedWriter( new OutputStreamWriter(socket.getOutputStream()) ); String msg = null; while((msg = reader.readLine())!=null){ // è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ System.out.println(\"å®¢æˆ·ç«¯[\"+socket.getPort()+\"]: \" + msg); //å›å¤å®¢æˆ·å‘é€çš„æ¶ˆæ¯ writer.write(\"æœåŠ¡å™¨: \"+msg+\"\\n\"); writer.flush(); } } } catch (IOException e) { e.printStackTrace(); } finally { try { serverSocket.close(); } catch (IOException e) { e.printStackTrace(); } } } }","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"ç½‘ç»œç¼–ç¨‹","slug":"ç½‘ç»œç¼–ç¨‹","permalink":"https://www.codetool.top/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"}]},{"title":"JavaIO-ç¼“å†²æµä¸è½¬æ¢æµ","slug":"JavaIO-ç¼“å†²æµä¸è½¬æ¢æµ","date":"2020-02-04T15:54:20.000Z","updated":"2020-02-07T10:21:06.987Z","comments":true,"path":"article/JavaIO-ç¼“å†²æµä¸è½¬æ¢æµ/","link":"","permalink":"https://www.codetool.top/article/JavaIO-%E7%BC%93%E5%86%B2%E6%B5%81%E4%B8%8E%E8%BD%AC%E6%8D%A2%E6%B5%81/","excerpt":"","text":"1 ç¼“å†²æµ1.1 æ¦‚è¿°ç¼“å†²æµ,ä¹Ÿå«é«˜æ•ˆæµï¼Œæ˜¯å¯¹4ä¸ªåŸºæœ¬çš„FileXxx æµçš„å¢å¼ºï¼Œæ‰€ä»¥ä¹Ÿæ˜¯4ä¸ªæµï¼ŒæŒ‰ç…§æ•°æ®ç±»å‹åˆ†ç±»ï¼š å­—èŠ‚ç¼“å†²æµï¼šBufferedInputStreamï¼ŒBufferedOutputStream å­—ç¬¦ç¼“å†²æµï¼šBufferedReaderï¼ŒBufferedWriter ç¼“å†²æµçš„åŸºæœ¬åŸç†ï¼Œæ˜¯åœ¨åˆ›å»ºæµå¯¹è±¡æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå†…ç½®çš„é»˜è®¤å¤§å°çš„ç¼“å†²åŒºæ•°ç»„ï¼Œé€šè¿‡ç¼“å†²åŒºè¯»å†™ï¼Œå‡å°‘ç³»ç»ŸIOæ¬¡æ•°ï¼Œä»è€Œæé«˜è¯»å†™çš„æ•ˆç‡ã€‚ ï¼ˆç³»ç»ŸIOæŒ‡çš„æ˜¯ç£ç›˜å’Œå†…å­˜é—´çš„äº¤äº’ï¼Œç¼“å­˜æµä¼šè®©æ¯æ¬¡ä»ç£ç›˜è¯»äº†è¶³å¤Ÿçš„æ•°æ®è¿›å†…å­˜ï¼Œå†å°†æ•°æ®å†™å›ç£ç›˜ï¼Œå‡å°‘äº†ç£ç›˜ä¸å†…å­˜é—´çš„äº¤äº’æ¬¡æ•°ï¼‰ é»˜è®¤ç¼“å­˜åŒºçš„å¤§å°æ˜¯8192å­—èŠ‚ã€‚ public BufferedInputStream(InputStream in) ï¼šåˆ›å»ºä¸€ä¸ª æ–°çš„ç¼“å†²è¾“å…¥æµã€‚ public BufferedOutputStream(OutputStream out)ï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å†²è¾“å‡ºæµã€‚ public BufferedReader(Reader in) ï¼šåˆ›å»ºä¸€ä¸ª æ–°çš„ç¼“å†²è¾“å…¥æµã€‚ public BufferedWriter(Writer out)ï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å†²è¾“å‡ºæµã€‚ 1.2 ç‰¹æœ‰æ–¹æ³• BufferedReaderï¼špublic String readLine(): è¯»ä¸€è¡Œæ–‡å­—ã€‚ BufferedWriterï¼špublic void newLine(): å†™ä¸€è¡Œè¡Œåˆ†éš”ç¬¦,ç”±ç³»ç»Ÿå±æ€§å®šä¹‰ç¬¦å·ã€‚ 2 è½¬æ¢æµ2.1 InputStreamReaderç±»è½¬æ¢æµjava.io.InputStreamReaderï¼Œæ˜¯Readerçš„å­ç±»ï¼Œæ˜¯ä»å­—èŠ‚æµåˆ°å­—ç¬¦æµçš„æ¡¥æ¢ã€‚å®ƒè¯»å–å­—èŠ‚ï¼Œå¹¶ä½¿ç”¨æŒ‡å®šçš„å­—ç¬¦é›†å°†å…¶è§£ç ä¸ºå­—ç¬¦ã€‚å®ƒçš„å­—ç¬¦é›†å¯ä»¥ç”±åç§°æŒ‡å®šï¼Œä¹Ÿå¯ä»¥æ¥å—å¹³å°çš„é»˜è®¤å­—ç¬¦é›†ã€‚ 2.1.1 æ„é€ æ–¹æ³• InputStreamReader(InputStream in): åˆ›å»ºä¸€ä¸ªä½¿ç”¨é»˜è®¤å­—ç¬¦é›†çš„å­—ç¬¦æµã€‚ InputStreamReader(InputStream in, String charsetName): åˆ›å»ºä¸€ä¸ªæŒ‡å®šå­—ç¬¦é›†çš„å­—ç¬¦æµã€‚ 2.2 OutputStreamWriterç±»è½¬æ¢æµjava.io.OutputStreamWriter ï¼Œæ˜¯Writerçš„å­ç±»ï¼Œæ˜¯ä»å­—ç¬¦æµåˆ°å­—èŠ‚æµçš„æ¡¥æ¢ã€‚ä½¿ç”¨æŒ‡å®šçš„å­—ç¬¦é›†å°†å­—ç¬¦ç¼–ç ä¸ºå­—èŠ‚ã€‚å®ƒçš„å­—ç¬¦é›†å¯ä»¥ç”±åç§°æŒ‡å®šï¼Œä¹Ÿå¯ä»¥æ¥å—å¹³å°çš„é»˜è®¤å­—ç¬¦é›†ã€‚ 2.2.1 æ„é€ æ–¹æ³• OutputStreamWriter(OutputStream in): åˆ›å»ºä¸€ä¸ªä½¿ç”¨é»˜è®¤å­—ç¬¦é›†çš„å­—ç¬¦æµã€‚ OutputStreamWriter(OutputStream in, String charsetName): åˆ›å»ºä¸€ä¸ªæŒ‡å®šå­—ç¬¦é›†çš„å­—ç¬¦æµã€‚ 2.3 åº”ç”¨æ–‡ä»¶è½¬æ¢ç¼–ç ï¼š public class TransDemo { public static void main(String[] args) { // 1.å®šä¹‰æ–‡ä»¶è·¯å¾„ String srcFile = \"file_gbk.txt\"; String destFile = \"file_utf8.txt\"; // 2.åˆ›å»ºæµå¯¹è±¡ // 2.1 è½¬æ¢è¾“å…¥æµ,æŒ‡å®šGBKç¼–ç  InputStreamReader isr = new InputStreamReader(new FileInputStream(srcFile) , \"GBK\"); // 2.2 è½¬æ¢è¾“å‡ºæµ,é»˜è®¤utf8ç¼–ç  OutputStreamWriter osw = new OutputStreamWriter(new FileOutputStream(destFile)); // 3.è¯»å†™æ•°æ® // 3.1 å®šä¹‰æ•°ç»„ char[] cbuf = new char[1024]; // 3.2 å®šä¹‰é•¿åº¦ int len; // 3.3 å¾ªç¯è¯»å– while ((len = isr.read(cbuf))!=-1) { // å¾ªç¯å†™å‡º osw.write(cbuf,0,len); } // 4.é‡Šæ”¾èµ„æº osw.close(); isr.close(); } }","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://www.codetool.top/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"},{"name":"IO","slug":"IO","permalink":"https://www.codetool.top/tags/IO/"}]},{"title":"AQSåŠå…¶åº”ç”¨ReentrantLockæºç åˆ†æ","slug":"AQSåŠå…¶åº”ç”¨ReentrantLockæºç åˆ†æ","date":"2020-02-04T14:45:27.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/AQSåŠå…¶åº”ç”¨ReentrantLockæºç åˆ†æ/","link":"","permalink":"https://www.codetool.top/article/AQS%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8ReentrantLock%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","excerpt":"","text":"1 AQSåŸç†1.1 æ¦‚è¿°å…¨ç§°æ˜¯ AbstractQueuedSynchronizerï¼Œæ˜¯é˜»å¡å¼é”å’Œç›¸å…³çš„åŒæ­¥å™¨å·¥å…·çš„æ¡†æ¶ ç‰¹ç‚¹ï¼š ç”¨ state å±æ€§æ¥è¡¨ç¤ºèµ„æºçš„çŠ¶æ€ï¼ˆåˆ†ç‹¬å æ¨¡å¼å’Œå…±äº«æ¨¡å¼ï¼‰ï¼Œå­ç±»éœ€è¦å®šä¹‰å¦‚ä½•ç»´æŠ¤è¿™ä¸ªçŠ¶æ€ï¼Œæ§åˆ¶å¦‚ä½•è·å–é”å’Œé‡Šæ”¾é” getState - è·å– state çŠ¶æ€ setState - è®¾ç½® state çŠ¶æ€ compareAndSetState - cas æœºåˆ¶è®¾ç½® state çŠ¶æ€ ç‹¬å æ¨¡å¼æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®èµ„æºï¼Œè€Œå…±äº«æ¨¡å¼å¯ä»¥å…è®¸å¤šä¸ªçº¿ç¨‹è®¿é—®èµ„æº æä¾›äº†åŸºäº FIFO çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œç±»ä¼¼äº Monitor çš„ EntryList æ¡ä»¶å˜é‡æ¥å®ç°ç­‰å¾…ã€å”¤é†’æœºåˆ¶ï¼Œæ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡ï¼Œç±»ä¼¼äº Monitor çš„ WaitSet è·å–é” // å¦‚æœè·å–é”å¤±è´¥ if (!tryAcquire(arg)) { // å…¥é˜Ÿ, å¯ä»¥é€‰æ‹©é˜»å¡å½“å‰çº¿ç¨‹ park unpark } é‡Šæ”¾é” // å¦‚æœé‡Šæ”¾é”æˆåŠŸ if (tryRelease(arg)) { // è®©é˜»å¡çº¿ç¨‹æ¢å¤è¿è¡Œ } 1.2 å®ç°ä¸å¯é‡å…¥é”1.2.1 è‡ªå®šä¹‰åŒæ­¥å™¨åŒæ­¥å™¨å®ç°AQS final class MySync extends AbstractQueuedSynchronizer { @Override protected boolean tryAcquire(int acquires) { if (acquires == 1){ if (compareAndSetState(0, 1)) { setExclusiveOwnerThread(Thread.currentThread()); return true; } } return false; } @Override protected boolean tryRelease(int acquires) { if(acquires == 1) { if(getState() == 0) { throw new IllegalMonitorStateException(); } setExclusiveOwnerThread(null); setState(0); return true; } return false; } protected Condition newCondition() { return new ConditionObject(); } @Override //æ˜¯å¦æŒæœ‰ç‹¬å é” protected boolean isHeldExclusively() { return getState() == 1; } } 1.2.2 è‡ªå®šä¹‰é”class MyLock implements Lock { static MySync sync = new MySync(); @Override // å°è¯•ï¼Œä¸æˆåŠŸï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ— public void lock() { sync.acquire(1); } @Override // å°è¯•ï¼Œä¸æˆåŠŸï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œå¯æ‰“æ–­ public void lockInterruptibly() throws InterruptedException { sync.acquireInterruptibly(1); } @Override // å°è¯•ä¸€æ¬¡ï¼Œä¸æˆåŠŸè¿”å›ï¼Œä¸è¿›å…¥é˜Ÿåˆ— public boolean tryLock() { return sync.tryAcquire(1); } @Override // å°è¯•ï¼Œä¸æˆåŠŸï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œæœ‰æ—¶é™ public boolean tryLock(long time, TimeUnit unit) throws InterruptedException { return sync.tryAcquireNanos(1, unit.toNanos(time)); } @Override // é‡Šæ”¾é” public void unlock() { sync.release(1); } @Override // ç”Ÿæˆæ¡ä»¶å˜é‡ public Condition newCondition() { return sync.newCondition(); } } 1.3 å¿ƒå¾—1.3.1 èµ·æºæ—©æœŸç¨‹åºå‘˜ä¼šè‡ªå·±é€šè¿‡ä¸€ç§åŒæ­¥å™¨å»å®ç°å¦ä¸€ç§ç›¸è¿‘çš„åŒæ­¥å™¨ï¼Œä¾‹å¦‚ç”¨å¯é‡å…¥é”å»å®ç°ä¿¡å·é‡ï¼Œæˆ–åä¹‹ã€‚è¿™æ˜¾ç„¶ä¸å¤Ÿä¼˜é›…ï¼Œäºæ˜¯åœ¨ JSR166ï¼ˆjava è§„èŒƒææ¡ˆï¼‰ä¸­åˆ›å»ºäº† AQSï¼Œæä¾›äº†è¿™ç§é€šç”¨çš„åŒæ­¥å™¨æœºåˆ¶ã€‚ 1.3.2 ç›®æ ‡AQS è¦å®ç°çš„åŠŸèƒ½ç›®æ ‡ é˜»å¡ç‰ˆæœ¬è·å–é” acquire å’Œéé˜»å¡çš„ç‰ˆæœ¬å°è¯•è·å–é”tryAcquire è·å–é”è¶…æ—¶æœºåˆ¶ é€šè¿‡æ‰“æ–­å–æ¶ˆæœºåˆ¶ ç‹¬å æœºåˆ¶åŠå…±äº«æœºåˆ¶ æ¡ä»¶ä¸æ»¡è¶³æ—¶çš„ç­‰å¾…æœºåˆ¶ 1.3.3 è®¾è®¡AQS çš„åŸºæœ¬æ€æƒ³å…¶å®å¾ˆç®€å•è·å–é”çš„é€»è¾‘ while(state çŠ¶æ€ä¸å…è®¸è·å–) { if(é˜Ÿåˆ—ä¸­è¿˜æ²¡æœ‰æ­¤çº¿ç¨‹) { å…¥é˜Ÿå¹¶é˜»å¡ } } å½“å‰çº¿ç¨‹å‡ºé˜Ÿ é‡Šæ”¾é”çš„é€»è¾‘ if(state çŠ¶æ€å…è®¸äº†) { æ¢å¤é˜»å¡çš„çº¿ç¨‹(s) } è¦ç‚¹ åŸå­ç»´æŠ¤ state çŠ¶æ€ é˜»å¡åŠæ¢å¤çº¿ç¨‹ ç»´æŠ¤é˜Ÿåˆ— 1.3.3.1 stateè®¾è®¡ state ä½¿ç”¨ volatile é…åˆ cas ä¿è¯å…¶ä¿®æ”¹æ—¶çš„åŸå­æ€§ state ä½¿ç”¨äº† 32bit int æ¥ç»´æŠ¤åŒæ­¥çŠ¶æ€ï¼Œå› ä¸ºå½“æ—¶ä½¿ç”¨ long åœ¨å¾ˆå¤šå¹³å°ä¸‹æµ‹è¯•çš„ç»“æœå¹¶ä¸ç†æƒ³ 1.3.3.2 é˜»å¡æ¢å¤è®¾è®¡ æ—©æœŸçš„æ§åˆ¶çº¿ç¨‹æš‚åœå’Œæ¢å¤çš„ api æœ‰ suspend å’Œ resumeï¼Œä½†å®ƒä»¬æ˜¯ä¸å¯ç”¨çš„ï¼Œå› ä¸ºå¦‚æœå…ˆè°ƒç”¨çš„ resume ï¼Œé‚£ä¹ˆ suspend å°†æ„ŸçŸ¥ä¸åˆ° è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨ park &amp; unpark æ¥å®ç°çº¿ç¨‹çš„æš‚åœå’Œæ¢å¤ï¼Œå…ˆ unpark å† park ä¹Ÿæ²¡é—®é¢˜ park &amp; unpark æ˜¯é’ˆå¯¹çº¿ç¨‹çš„ï¼Œè€Œä¸æ˜¯é’ˆå¯¹åŒæ­¥å™¨çš„ï¼Œå› æ­¤æ§åˆ¶ç²’åº¦æ›´ä¸ºç²¾ç»† park çº¿ç¨‹è¿˜å¯ä»¥é€šè¿‡ interrupt æ‰“æ–­ 1.3.3.3 é˜Ÿåˆ—è®¾è®¡ ä½¿ç”¨äº† FIFO å…ˆå…¥å…ˆå‡ºé˜Ÿåˆ—ï¼Œå¹¶ä¸æ”¯æŒä¼˜å…ˆçº§é˜Ÿåˆ— è®¾è®¡æ—¶å€Ÿé‰´äº† CLH é˜Ÿåˆ—ï¼Œå®ƒæ˜¯ä¸€ç§å•å‘æ— é”é˜Ÿåˆ— Nodeçš„waitStatusçŠ¶æ€ï¼š CANCELLED(1)ï¼šè¡¨ç¤ºå½“å‰ç»“ç‚¹å·²å–æ¶ˆè°ƒåº¦ã€‚å½“timeoutæˆ–è¢«ä¸­æ–­ï¼ˆå“åº”ä¸­æ–­çš„æƒ…å†µä¸‹ï¼‰ï¼Œä¼šè§¦å‘å˜æ›´ä¸ºæ­¤çŠ¶æ€ï¼Œè¿›å…¥è¯¥çŠ¶æ€åçš„ç»“ç‚¹å°†ä¸ä¼šå†å˜åŒ–ã€‚ SIGNAL(-1)ï¼šè¡¨ç¤ºåç»§ç»“ç‚¹åœ¨ç­‰å¾…å½“å‰ç»“ç‚¹å”¤é†’ã€‚åç»§ç»“ç‚¹å…¥é˜Ÿæ—¶ï¼Œä¼šå°†å‰ç»§ç»“ç‚¹çš„çŠ¶æ€æ›´æ–°ä¸ºSIGNALã€‚ CONDITION(-2)ï¼šè¡¨ç¤ºç»“ç‚¹ç­‰å¾…åœ¨Conditionä¸Šï¼Œå½“å…¶ä»–çº¿ç¨‹è°ƒç”¨äº†Conditionçš„signal()æ–¹æ³•åï¼ŒCONDITIONçŠ¶æ€çš„ç»“ç‚¹å°†ä»ç­‰å¾…é˜Ÿåˆ—è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è·å–åŒæ­¥é”ã€‚ PROPAGATE(-3)ï¼šå…±äº«æ¨¡å¼ä¸‹ï¼Œå‰ç»§ç»“ç‚¹ä¸ä»…ä¼šå”¤é†’å…¶åç»§ç»“ç‚¹ï¼ŒåŒæ—¶ä¹Ÿå¯èƒ½ä¼šå”¤é†’åç»§çš„åç»§ç»“ç‚¹ã€‚ 0ï¼šæ–°ç»“ç‚¹å…¥é˜Ÿæ—¶çš„é»˜è®¤çŠ¶æ€ã€‚ AQS åœ¨ä¸€äº›æ–¹é¢æ”¹è¿›äº† CLH private Node enq(final Node node) { for (;;) { Node t = tail; // é˜Ÿåˆ—ä¸­è¿˜æ²¡æœ‰å…ƒç´  tail ä¸º null if (t == null) { // å°† head ä» null -> dummy if (compareAndSetHead(new Node())) tail = head; } else { // å°† node çš„ prev è®¾ç½®ä¸ºåŸæ¥çš„ tail node.prev = t; // å°† tail ä»åŸæ¥çš„ tail è®¾ç½®ä¸º node if (compareAndSetTail(t, node)) { // åŸæ¥ tail çš„ next è®¾ç½®ä¸º node t.next = node; return t; } } } } 2 ReentrantLockåŸç† ReentrantLockä½¿ç”¨äº†ç»§æ‰¿è‡ªAQSçš„å†…éƒ¨ç±»Syncï¼Œæœ‰ä¸¤ä¸ªå®ç°ï¼šNonefairSyncï¼ˆéå…¬å¹³é”ï¼‰å’ŒFairSyncï¼ˆå…¬å¹³é”ï¼‰ ç”±äºé»˜è®¤æ„é€ éå…¬å¹³é”ï¼Œè¿™é‡Œæ¥çœ‹éå…¬å¹³é”çš„åŸç†ï¼š 2.1 åŠ é”final void lock() { //æ²¡æœ‰ç«äº‰ï¼Œç‹¬å çŠ¶æ€ if (compareAndSetState(0, 1)) setExclusiveOwnerThread(Thread.currentThread()); else acquire(1);//å‡ºç°ç«äº‰ï¼Œä¸‹ä¸€æ­¥ } public final void acquire(int arg) { // å…ˆå†æ¬¡å°è¯•èƒ½ä¸èƒ½è·å¾—é”ï¼ˆä¸‹ä¸€æ­¥ï¼‰ï¼Œå¦åˆ™è¿›å…¥addWaitor(Node.EXCLUSIVE)ï¼Œè·³è¿‡ä¸‹ä¸€æ­¥ if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) //å¦‚æœé˜»å¡è¿‡ç¨‹ä¸­è¢«æ‰“æ–­ï¼Œä¸å“åº”æ‰“æ–­ï¼Œåœ¨è·å¾—é”ä¹‹åæ‰èƒ½å†å“åº”æ‰“æ–­ã€‚ selfInterrupt(); } final boolean nonfairTryAcquire(int acquires) { final Thread current = Thread.currentThread(); int c = getState(); //ç›´æ¥è®¾ç½®ç‹¬å  if (c == 0) { if (compareAndSetState(0, acquires)) { setExclusiveOwnerThread(current); return true; } } //å¯ä»¥é”é‡å…¥ else if (current == getExclusiveOwnerThread()) { int nextc = c + acquires; if (nextc &lt; 0) // overflow throw new Error(\"Maximum lock count exceeded\"); setState(nextc); return true; } //ä¸èƒ½è·å¾—é”ï¼Œä¸‹ä¸€æ­¥ return false; } //addWaiterå°†ç»“ç‚¹é™„åŠ åˆ°é“¾è¡¨å°¾éƒ¨ //modeä»£è¡¨ä¸€ä¸ªnextWaiterï¼Œåœ¨æ¡ä»¶ç­‰å¾…çš„æ—¶å€™ä½¿ç”¨ //Node.EXCLUSIVEä»£è¡¨ç‹¬å æ¨¡å¼ã€‚ //æ·»åŠ åˆ°é“¾è¡¨æœ«å°¾åè°ƒç”¨acquireQueuedï¼Œä¸‹ä¸€æ­¥ private Node addWaiter(Node mode) { Node node = new Node(Thread.currentThread(), mode); // Try the fast path of enq; backup to full enq on failure Node pred = tail; if (pred != null) { node.prev = pred; if (compareAndSetTail(pred, node)) { pred.next = node; return node; } } enq(node); return node; } final boolean acquireQueued(final Node node, int arg) { boolean failed = true; try { boolean interrupted = false; for (;;) { final Node p = node.predecessor(); //å¦‚æœnodeæ˜¯ç¬¬äºŒä¸ªèŠ‚ç‚¹å†æ¬¡å°è¯•è·å–é” if (p == head &amp;&amp; tryAcquire(arg)) { setHead(node); p.next = null; // help GC failed = false; return interrupted; } //å¦åˆ™å°è¯•é˜»å¡ï¼Œä¸‹ä¸€æ­¥ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; } } finally { if (failed) cancelAcquire(node); } } //æ£€æŸ¥æ˜¯å¦å¯ä»¥parkï¼ˆå‰ä¸€ä¸ªèŠ‚ç‚¹çš„waitStatusåº”è¯¥æ ‡è®°æˆ-1ï¼‰ //å¯ä»¥çš„è¯è°ƒç”¨parkAndCheckInterruptï¼Œä¸‹ä¸€æ­¥ private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) { int ws = pred.waitStatus; if (ws == Node.SIGNAL) /* * This node has already set status asking a release * to signal it, so it can safely park. */ return true; if (ws > 0) { /* * Predecessor was cancelled. Skip over predecessors and * indicate retry. */ do { node.prev = pred = pred.prev; } while (pred.waitStatus > 0); pred.next = node; } else { /* * waitStatus must be 0 or PROPAGATE. Indicate that we * need a signal, but don't park yet. Caller will need to * retry to make sure it cannot acquire before parking. */ compareAndSetWaitStatus(pred, ws, Node.SIGNAL); } return false; } ä½¿ç”¨LockSupport.parké˜»å¡ private final boolean parkAndCheckInterrupt() { LockSupport.park(this); return Thread.interrupted(); } 2.2 è§£é”public final boolean release(int arg) { //è°ƒç”¨tryReleaseé‡Šæ”¾é”ï¼Œå› ä¸ºæ­¤æ—¶æ˜¯ç‹¬å å¼çš„ï¼Œå¾ˆå®¹æ˜“å°±èƒ½é‡Šæ”¾é”ã€‚ //å¦‚æœé‡å…¥è¿‡äº†éœ€è¦æŠŠè®¡æ•°å‡ä¸º0äº†æ‰ç®—é‡Šæ”¾æˆåŠŸã€‚ if (tryRelease(arg)) { Node h = head; //å”¤é†’ç­‰å¾…é˜Ÿåˆ—é‡Œçš„ä¸‹ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸‹ä¸€æ­¥ if (h != null &amp;&amp; h.waitStatus != 0) unparkSuccessor(h); return true; } return false; } //å”¤é†’åç»§ç»“ç‚¹ private void unparkSuccessor(Node node) { int ws = node.waitStatus; if (ws &lt; 0) compareAndSetWaitStatus(node, ws, 0); Node s = node.next; //å¦‚æœä¸‹ä¸€ä¸ªèŠ‚ç‚¹è¢«canceläº†ä»åå¾€å‰æ‰¾åˆ°ä¸€ä¸ªæ­£å¸¸çš„èŠ‚ç‚¹æ›¿æ¢å®ƒ if (s == null || s.waitStatus > 0) { s = null; for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev) if (t.waitStatus &lt;= 0) s = t; } //unparkå”¤é†’ if (s != null) LockSupport.unpark(s.thread); } 2.3 å¯æ‰“æ–­åŸç†æ ¸å¿ƒæ–¹æ³•ï¼š private void doAcquireInterruptibly(int arg) throws InterruptedException { final Node node = addWaiter(Node.EXCLUSIVE); boolean failed = true; try { for (;;) { final Node p = node.predecessor(); if (p == head &amp;&amp; tryAcquire(arg)) { setHead(node); p.next = null; // help GC failed = false; return; } //å¦‚æœç­‰å¾…è¿‡ç¨‹ä¸­è¢«æ‰“æ–­parkAndCheckInterruptè¿”å›falseï¼ŒæŠ›å‡ºå¼‚å¸¸ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) throw new InterruptedException(); } } finally { if (failed) cancelAcquire(node); } } 2.4 å…¬å¹³é”åŸç†// ä¸éå…¬å¹³é”ä¸»è¦åŒºåˆ«åœ¨äº tryAcquire æ–¹æ³•çš„å®ç° protected final boolean tryAcquire(int acquires) { final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) { // å…ˆæ£€æŸ¥ AQS é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰å‰é©±èŠ‚ç‚¹, æ²¡æœ‰æ‰å»ç«äº‰ if (!hasQueuedPredecessors() &amp;&amp; compareAndSetState(0, acquires)) { setExclusiveOwnerThread(current); return true; } } else if (current == getExclusiveOwnerThread()) { int nextc = c + acquires; if (nextc &lt; 0) throw new Error(\"Maximum lock count exceeded\"); setState(nextc); return true; } return false; } 2.5 æ¡ä»¶å˜é‡å®ç°åŸç†æ¯ä¸ªæ¡ä»¶å˜é‡å…¶å®å°±å¯¹åº”ç€ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œå…¶å®ç°ç±»æ˜¯ ConditionObject ConditionObjecté‡Œé¢æœ‰ä¸€ä¸ªfirstWaiterã€lastWaiterï¼Œç„¶è€Œå®ƒæ˜¯ä¸€ä¸ªå•å‘é˜Ÿåˆ—ã€‚ 2.5.1 awaitè¿‡ç¨‹public final void await() throws InterruptedException { if (Thread.interrupted()) throw new InterruptedException(); // å°†çº¿ç¨‹æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œä¸‹ä¸€æ­¥ Node node = addConditionWaiter(); // é‡Šæ”¾å æœ‰çš„é”ï¼Œè·³è¿‡ä¸‹ä¸€æ­¥ long savedState = fullyRelease(node); int interruptMode = 0; //æ˜¯å¦åœ¨é˜»å¡é˜Ÿåˆ—ä¸­ï¼ˆå³è¿˜æ²¡æœ‰è·å¾—åˆ°é”ï¼‰ while (!isOnSyncQueue(node)) { LockSupport.park(this); if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) break; } // è‡ªæ—‹ç­‰å¾…è·å–åˆ°åŒæ­¥çŠ¶æ€ï¼ˆå³è·å–åˆ°lockï¼‰ if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE) interruptMode = REINTERRUPT; if (node.nextWaiter != null) // clean up if cancelled unlinkCancelledWaiters(); // å¤„ç†è¢«ä¸­æ–­çš„æƒ…å†µ if (interruptMode != 0) reportInterruptAfterWait(interruptMode); } private Node addConditionWaiter() { Node t = lastWaiter; // If lastWaiter is cancelled, clean out. if (t != null &amp;&amp; t.waitStatus != Node.CONDITION) { unlinkCancelledWaiters(); t = lastWaiter; } //è¿æ¥åˆ°ç­‰å¾…é˜Ÿåˆ— Node node = new Node(Thread.currentThread(), Node.CONDITION); if (t == null) firstWaiter = node; else t.nextWaiter = node; lastWaiter = node; return node; } final long fullyRelease(Node node) { boolean failed = true; try { long savedState = getState(); //é‡å¤è°ƒç”¨tryReleaseç›´åˆ°é”å…¨éƒ¨è¢«é‡Šæ”¾ï¼Œç„¶åå”¤é†’åç»§ç»“ç‚¹ if (release(savedState)) { failed = false; return savedState; } else { throw new IllegalMonitorStateException(); } } finally { if (failed) node.waitStatus = Node.CANCELLED; } } 2.5.2 signalè¿‡ç¨‹public final void signal() { //åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯ä¸æ˜¯é”çš„æŒæœ‰è€… if (!isHeldExclusively()) throw new IllegalMonitorStateException(); Node first = firstWaiter; //å‘å‡ºä¿¡å·ï¼Œä¸‹ä¸€æ­¥ if (first != null) doSignal(first); } private void doSignal(Node first) { do { if ( (firstWaiter = first.nextWaiter) == null) lastWaiter = null; first.nextWaiter = null; } //è½¬ç§»èŠ‚ç‚¹åˆ°é˜»å¡é˜Ÿåˆ— while (!transferForSignal(first) &amp;&amp; (first = firstWaiter) != null); } final boolean transferForSignal(Node node) { //è®¾ç½®å›çŠ¶æ€0 if (!compareAndSetWaitStatus(node, Node.CONDITION, 0)) return false; //æ’å…¥é˜»å¡é˜Ÿåˆ—æœ«å°¾ Node p = enq(node); int ws = p.waitStatus; if (ws > 0 || !compareAndSetWaitStatus(p, ws, Node.SIGNAL)) LockSupport.unpark(node.thread); return true; }","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jdk","slug":"jdk","permalink":"https://www.codetool.top/tags/jdk/"},{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://www.codetool.top/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://www.codetool.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"leetcode23-åˆå¹¶Kä¸ªæ’åºé“¾è¡¨","slug":"leetcode23-åˆå¹¶Kä¸ªæ’åºé“¾è¡¨","date":"2020-02-03T18:58:38.000Z","updated":"2020-02-20T14:55:21.129Z","comments":true,"path":"article/leetcode23-åˆå¹¶Kä¸ªæ’åºé“¾è¡¨/","link":"","permalink":"https://www.codetool.top/article/leetcode23-%E5%90%88%E5%B9%B6K%E4%B8%AA%E6%8E%92%E5%BA%8F%E9%93%BE%E8%A1%A8/","excerpt":"","text":"1 åŸé¢˜åˆå¹¶ k ä¸ªæ’åºé“¾è¡¨ï¼Œè¿”å›åˆå¹¶åçš„æ’åºé“¾è¡¨ã€‚è¯·åˆ†æå’Œæè¿°ç®—æ³•çš„å¤æ‚åº¦ã€‚ ç¤ºä¾‹: è¾“å…¥ï¼š[ 1-&gt;4-&gt;5, 1-&gt;3-&gt;4, 2-&gt;6]è¾“å‡ºï¼š 1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4-&gt;5-&gt;6 2 è§£æ³•2.1 æ€æƒ³é€ä¸€æ¯”è¾ƒæˆ–ä¸¤ä¸¤åˆå¹¶ï¼ˆåˆ†æ²»ï¼‰ã€‚ 2.2 ä»£ç é€ä¸€æ¯”è¾ƒï¼š æ—¶é—´å¤æ‚åº¦O(nm)ï¼ˆnä¸ºé“¾è¡¨ä¸ªæ•°ï¼Œmä¸ºé“¾è¡¨æœ€å¤§é•¿åº¦ï¼‰ class Solution { public ListNode mergeKLists(ListNode[] lists) { ListNode head = new ListNode(0); ListNode cur = head; int min = -1; int leftCount = lists.length; while(leftCount>0){ for(int i = 0;i&lt;leftCount;i++){ if(lists[i]!=null&amp;&amp;(min==-1||lists[i].val&lt;lists[min].val)) min = i; } if(min == -1){ leftCount--; break; } ListNode node = lists[min]; if(lists[min].next==null){ lists[min]=lists[leftCount-1]; leftCount--; }else lists[min] = lists[min].next; cur.next = node; cur = cur.next; min = -1; } return head.next; } } ä¸¤ä¸¤åˆå¹¶ï¼šæ—¶é—´å¤æ‚åº¦O(nm/2)ï¼ˆnä¸ºé“¾è¡¨ä¸ªæ•°ï¼Œmä¸ºé“¾è¡¨æœ€å¤§é•¿åº¦ï¼‰ class Solution { public ListNode mergeKLists(ListNode[] lists) { int len = lists.length; if (len == 0) { return null; } // å°†nä¸ªé“¾è¡¨ä»¥ä¸­é—´ä¸ºå¯¹ç§°ï¼Œåˆå¹¶ while(len>1) { for (int i=0; i&lt;len/2; i++) { lists[i] = mergeTwoListsForK(lists[i], lists[len-1-i]); } len = (len+1)/2; } return lists[0]; } private ListNode mergeTwoListsForK(ListNode l1, ListNode l2) { ListNode head = new ListNode(-1); ListNode p = head; while(l1 != null &amp;&amp; l2 != null) { if (l1.val &lt; l2.val) { p.next = l1; l1 = l1.next; } else { p.next = l2; l2 = l2.next; } p = p.next; } if (l1 != null) { p.next = l1; } else if (l2 != null) { p.next = l2; } return head.next; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"javaä¸­çš„Fileç±»ä»¥åŠIOæµ","slug":"Fileç±»ä»¥åŠIOæµ","date":"2020-02-03T18:24:45.000Z","updated":"2020-02-04T15:00:31.104Z","comments":true,"path":"article/Fileç±»ä»¥åŠIOæµ/","link":"","permalink":"https://www.codetool.top/article/File%E7%B1%BB%E4%BB%A5%E5%8F%8AIO%E6%B5%81/","excerpt":"","text":"1 File ç±»1.1 æ¦‚è¿°java.io.File ç±»æ˜¯æ–‡ä»¶å’Œç›®å½•è·¯å¾„åçš„æŠ½è±¡è¡¨ç¤ºï¼Œä¸»è¦ç”¨äºæ–‡ä»¶å’Œç›®å½•çš„åˆ›å»ºã€æŸ¥æ‰¾å’Œåˆ é™¤ç­‰æ“ä½œã€‚ 1.2 æ„é€ æ–¹æ³• public File(String pathname) ï¼šé€šè¿‡å°†ç»™å®šçš„è·¯å¾„åå­—ç¬¦ä¸²è½¬æ¢ä¸ºæŠ½è±¡è·¯å¾„åæ¥åˆ›å»ºæ–°çš„ Fileå®ä¾‹ã€‚ public File(String parent, String child) ï¼šä»çˆ¶è·¯å¾„åå­—ç¬¦ä¸²å’Œå­è·¯å¾„åå­—ç¬¦ä¸²åˆ›å»ºæ–°çš„ Fileå®ä¾‹ã€‚ public File(File parent, String child) ï¼šä»çˆ¶æŠ½è±¡è·¯å¾„åå’Œå­è·¯å¾„åå­—ç¬¦ä¸²åˆ›å»ºæ–°çš„ Fileå®ä¾‹ã€‚ æ„é€ ä¸¾ä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š // æ–‡ä»¶è·¯å¾„å String pathname = \"D:\\\\aaa.txt\"; File file1 = new File(pathname); // æ–‡ä»¶è·¯å¾„å String pathname2 = \"D:\\\\aaa\\\\bbb.txt\"; File file2 = new File(pathname2); // é€šè¿‡çˆ¶è·¯å¾„å’Œå­è·¯å¾„å­—ç¬¦ä¸² String parent = \"d:\\\\aaa\"; String child = \"bbb.txt\"; File file3 = new File(parent, child); // é€šè¿‡çˆ¶çº§Fileå¯¹è±¡å’Œå­è·¯å¾„å­—ç¬¦ä¸² File parentDir = new File(\"d:\\\\aaa\"); String child = \"bbb.txt\"; File file4 = new File(parentDir, child); 1.3 å¸¸ç”¨æ–¹æ³•1.3.1 è·å–åŠŸèƒ½çš„æ–¹æ³• public String getPath() ï¼šè¿”å›æ­¤Fileçš„è·¯å¾„ï¼ˆæ„é€ æ—¶çš„è·¯å¾„ï¼‰ã€‚ public String getAbsolutePath() ï¼šè¿”å›æ­¤Fileçš„ç»å¯¹è·¯å¾„åå­—ç¬¦ä¸²ã€‚ public String getCanonicalPath() ï¼šè¿”å›æ­¤Fileçš„ç»è¿‡è·¯å¾„å˜æ¢åçš„å­—ç¬¦ä¸²ã€‚ public String getPath() ï¼šå°†æ­¤Fileè½¬æ¢ä¸ºè·¯å¾„åå­—ç¬¦ä¸²ã€‚ public String getName() ï¼šè¿”å›ç”±æ­¤Fileè¡¨ç¤ºçš„æ–‡ä»¶æˆ–ç›®å½•çš„åç§°ã€‚ public long length() ï¼šè¿”å›ç”±æ­¤Fileè¡¨ç¤ºçš„æ–‡ä»¶çš„é•¿åº¦ã€‚ 1.3.2 åˆ¤æ–­åŠŸèƒ½çš„æ–¹æ³• public boolean exists() ï¼šæ­¤Fileè¡¨ç¤ºçš„æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å®é™…å­˜åœ¨ã€‚ public boolean isDirectory() ï¼šæ­¤Fileè¡¨ç¤ºçš„æ˜¯å¦ä¸ºç›®å½•ã€‚ public boolean isFile() ï¼šæ­¤Fileè¡¨ç¤ºçš„æ˜¯å¦ä¸ºæ–‡ä»¶ã€‚ 1.3.3 åˆ›å»ºåˆ é™¤åŠŸèƒ½çš„æ–¹æ³• public boolean createNewFile() ï¼šå½“ä¸”ä»…å½“å…·æœ‰è¯¥åç§°çš„æ–‡ä»¶å°šä¸å­˜åœ¨æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºæ–‡ä»¶ã€‚ public boolean delete() ï¼šåˆ é™¤ç”±æ­¤Fileè¡¨ç¤ºçš„æ–‡ä»¶æˆ–ç›®å½•ã€‚ public boolean mkdir() ï¼šåˆ›å»ºç”±æ­¤Fileè¡¨ç¤ºçš„ç›®å½•ã€‚ public boolean mkdirs() ï¼šåˆ›å»ºç”±æ­¤Fileè¡¨ç¤ºçš„ç›®å½•ï¼ŒåŒ…æ‹¬ä»»ä½•å¿…éœ€ä½†ä¸å­˜åœ¨çš„çˆ¶ç›®å½•ã€‚ 1.3.4 ç›®å½•çš„éå† public String[] list() ï¼šè¿”å›ä¸€ä¸ªStringæ•°ç»„ï¼Œè¡¨ç¤ºè¯¥Fileç›®å½•ä¸­çš„æ‰€æœ‰å­æ–‡ä»¶æˆ–ç›®å½•ã€‚ public File[] listFiles() ï¼šè¿”å›ä¸€ä¸ªFileæ•°ç»„ï¼Œè¡¨ç¤ºè¯¥Fileç›®å½•ä¸­çš„æ‰€æœ‰çš„å­æ–‡ä»¶æˆ–ç›®å½•ã€‚ listFileså¯ä»¥æ¥å—ä¸€ä¸ªFileFilteræ¥å£ï¼Œåªå¾—åˆ°ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶ã€‚ 1.4 åº”ç”¨ç¤ºä¾‹æ‰“å°ç›®å½•æ ‘ï¼š public class Main { public static void main(String[] args) throws Exception { if(args.length>1) { System.out.println(\"å‚æ•°æ ¼å¼é”™è¯¯ï¼\"); return; } String dirName = \"./\"; if(args.length == 1) dirName = args[0]; File dir = new File(dirName); if(!dir.isDirectory()) { System.out.println(\"ç›®å½•ä¸å­˜åœ¨ï¼\"); return; } printDir(dir,0); } public static void printDir(File dir,int depth) throws IOException { StringBuilder sb = new StringBuilder(); for(int i = 0;i&lt;depth;i++) sb.append(\" \"); String tab = sb.toString(); for(File file:dir.listFiles()){ if(file.isDirectory()){ System.out.println(tab+\"\\u001B[31m\" + file.getName() + \"\\033[0m\"); printDir(file,depth+1); }else System.out.println(tab+file.getName()); } } } åªè¾“å‡ºç›®å½•ï¼š public class Main { public static void main(String[] args){ File dir = new File(\"./\"); for(File file:dir.listFiles(f->{ if(f.isDirectory()) return true; return false; })){ System.out.println(file.getName()); } } } 2 å­—èŠ‚æµä¸å­—ç¬¦æµ2.1 æµçš„åˆ†ç±» è¾“å…¥æµ è¾“å‡ºæµ å­—èŠ‚æµ å­—èŠ‚è¾“å…¥æµInputStream å­—èŠ‚è¾“å‡ºæµOutputStream å­—ç¬¦æµ å­—ç¬¦è¾“å…¥æµReader å­—ç¬¦è¾“å‡ºæµWriter 2.2 å…³é—­å’Œåˆ·æ–°å› ä¸ºå†…ç½®ç¼“å†²åŒºçš„åŸå› ï¼Œå¦‚æœä¸å…³é—­è¾“å‡ºæµï¼Œæ— æ³•å†™å‡ºå­—ç¬¦åˆ°æ–‡ä»¶ä¸­ã€‚ä½†æ˜¯å…³é—­çš„æµå¯¹è±¡ï¼Œæ˜¯æ— æ³•ç»§ç»­å†™å‡ºæ•°æ®çš„ã€‚å¦‚æœæˆ‘ä»¬æ—¢æƒ³å†™å‡ºæ•°æ®ï¼Œåˆæƒ³ç»§ç»­ä½¿ç”¨æµï¼Œå°±éœ€è¦flush æ–¹æ³•äº†ã€‚ flush ï¼šåˆ·æ–°ç¼“å†²åŒºï¼Œæµå¯¹è±¡å¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚ close:å…ˆåˆ·æ–°ç¼“å†²åŒºï¼Œç„¶åé€šçŸ¥ç³»ç»Ÿé‡Šæ”¾èµ„æºã€‚æµå¯¹è±¡ä¸å¯ä»¥å†è¢«ä½¿ç”¨äº†ã€‚ 2.3 OutputStreamjava.io.OutputStreamæŠ½è±¡ç±»æ˜¯è¡¨ç¤ºå­—èŠ‚è¾“å‡ºæµçš„æ‰€æœ‰ç±»çš„è¶…ç±»ï¼Œå°†æŒ‡å®šçš„å­—èŠ‚ä¿¡æ¯å†™å‡ºåˆ°ç›®çš„åœ°ã€‚å®ƒå®šä¹‰äº†å­—èŠ‚è¾“å‡ºæµçš„åŸºæœ¬å…±æ€§åŠŸèƒ½æ–¹æ³•ã€‚ public void close() ï¼šå…³é—­æ­¤è¾“å‡ºæµå¹¶é‡Šæ”¾ä¸æ­¤æµç›¸å…³è”çš„ä»»ä½•ç³»ç»Ÿèµ„æºã€‚ public void flush() ï¼šåˆ·æ–°æ­¤è¾“å‡ºæµå¹¶å¼ºåˆ¶ä»»ä½•ç¼“å†²çš„è¾“å‡ºå­—èŠ‚è¢«å†™å‡ºã€‚ public void write(byte[] b)ï¼šå°† b.lengthå­—èŠ‚ä»æŒ‡å®šçš„å­—èŠ‚æ•°ç»„å†™å…¥æ­¤è¾“å‡ºæµã€‚ public void write(byte[] b, int off, int len) ï¼šä»æŒ‡å®šçš„å­—èŠ‚æ•°ç»„å†™å…¥ lenå­—èŠ‚ï¼Œä»åç§»é‡ offå¼€å§‹è¾“å‡ºåˆ°æ­¤è¾“å‡ºæµã€‚ public abstract void write(int b) ï¼šå°†æŒ‡å®šçš„å­—èŠ‚ï¼ˆbçš„ä½8ä½ï¼‰å†™å…¥è¾“å‡ºæµã€‚ Stringæœ‰ä¸ªæ–¹æ³•getByte()å¯ä»¥æ–¹ä¾¿åœ°è·å–å­—ç¬¦ä¸²å­—èŠ‚æ•°ç»„ã€‚ 2.3.1 FileOutputStreamç±»java.io.FileOutputStreamç±»æ˜¯æ–‡ä»¶è¾“å‡ºæµï¼Œç”¨äºå°†æ•°æ®å†™å‡ºåˆ°æ–‡ä»¶ã€‚ æ„é€ æ–¹æ³•ï¼š public FileOutputStream(File file, boolean append)ï¼š åˆ›å»ºæ–‡ä»¶è¾“å‡ºæµä»¥å†™å…¥ç”±æŒ‡å®šçš„ Fileå¯¹è±¡è¡¨ç¤ºçš„æ–‡ä»¶ã€‚ public FileOutputStream(String name, boolean append)ï¼š åˆ›å»ºæ–‡ä»¶è¾“å‡ºæµä»¥æŒ‡å®šçš„åç§°å†™å…¥æ–‡ä»¶ã€‚ å…¶ä¸­boolean appendå‚æ•°éƒ½å¯çœç•¥ï¼Œé»˜è®¤ä¸ºfalseã€‚å†³å®šæ‰“å¼€æ–‡ä»¶æ—¶æ˜¯å¦åœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ ï¼Œå¦åˆ™è¦†ç›–æ–‡ä»¶å†…å®¹ã€‚ å½“ä½ åˆ›å»ºä¸€ä¸ªæµå¯¹è±¡æ—¶ï¼Œå¿…é¡»ä¼ å…¥ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ã€‚è¯¥è·¯å¾„ä¸‹ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œä¼šåˆ›å»ºè¯¥æ–‡ä»¶ã€‚ 2.4 InputStreamjava.io.InputStreamæŠ½è±¡ç±»æ˜¯è¡¨ç¤ºå­—èŠ‚è¾“å…¥æµçš„æ‰€æœ‰ç±»çš„è¶…ç±»ï¼Œå¯ä»¥è¯»å–å­—èŠ‚ä¿¡æ¯åˆ°å†…å­˜ä¸­ã€‚å®ƒå®šä¹‰äº†å­—èŠ‚è¾“å…¥æµçš„åŸºæœ¬å…±æ€§åŠŸèƒ½æ–¹æ³•ã€‚ public void close() ï¼šå…³é—­æ­¤è¾“å…¥æµå¹¶é‡Šæ”¾ä¸æ­¤æµç›¸å…³è”çš„ä»»ä½•ç³»ç»Ÿèµ„æºã€‚ public abstract int read()ï¼š ä»è¾“å…¥æµè¯»å–æ•°æ®çš„ä¸‹ä¸€ä¸ªå­—èŠ‚ã€‚ public int read(byte[] b)ï¼š ä»è¾“å…¥æµä¸­è¯»å–ä¸€äº›å­—èŠ‚ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åˆ°å­—èŠ‚æ•°ç»„ bä¸­ ã€‚ï¼ˆè¯»æ»¡bçš„é•¿åº¦ï¼‰ public int read(byte b[], int off, int len) ä»è¾“å…¥æµä¸­è¯»å–ä¸€äº›å­—èŠ‚ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åˆ°å­—èŠ‚æ•°ç»„bä¸­ ã€‚ï¼ˆoffä¸ºåç§»é‡ï¼Œlenä¸ºè¯»å–é•¿åº¦ï¼‰ public long skip(long n) è·³è¿‡né•¿åº¦å­—èŠ‚ä¸è¯»å–ã€‚ï¼ˆæŒ‡é’ˆåç§»nå­—èŠ‚ï¼‰ public void reset() æŒ‡é’ˆé‡æ–°ç§»è‡³æµå¼€å¤´ read()æ–¹æ³•å¦‚æœè¯»åˆ°æµæœ«å°¾è¿”å›-1ã€‚read(byte[] b)æ–¹æ³•è¿”å›è¯»å–çš„é•¿åº¦ï¼Œè¯»åˆ°æœ«å°¾è¿”å›-1ã€‚ 2.4.1 FileInputStreamç±»java.io.FileInputStreamç±»æ˜¯æ–‡ä»¶è¾“å…¥æµï¼Œä»æ–‡ä»¶ä¸­è¯»å–å­—èŠ‚ã€‚ æ„é€ æ–¹æ³•ï¼š FileInputStream(File file)ï¼š é€šè¿‡æ‰“å¼€ä¸å®é™…æ–‡ä»¶çš„è¿æ¥æ¥åˆ›å»ºä¸€ä¸ª FileInputStream ï¼Œè¯¥æ–‡ä»¶ç”±æ–‡ä»¶ç³»ç»Ÿä¸­çš„ Fileå¯¹è±¡ fileå‘½åã€‚ FileInputStream(String name)ï¼š é€šè¿‡æ‰“å¼€ä¸å®é™…æ–‡ä»¶çš„è¿æ¥æ¥åˆ›å»ºä¸€ä¸ª FileInputStream ï¼Œè¯¥æ–‡ä»¶ç”±æ–‡ä»¶ç³»ç»Ÿä¸­çš„è·¯å¾„å nameå‘½åã€‚ å½“ä½ åˆ›å»ºä¸€ä¸ªæµå¯¹è±¡æ—¶ï¼Œå¿…é¡»ä¼ å…¥ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ã€‚è¯¥è·¯å¾„ä¸‹ï¼Œå¦‚æœæ²¡æœ‰è¯¥æ–‡ä»¶,ä¼šæŠ›å‡ºFileNotFoundException ã€‚ 2.4.2 åº”ç”¨å¤åˆ¶å›¾ç‰‡æ–‡ä»¶ï¼š public class Copy { public static void main(String[] args) throws IOException { // 1.åˆ›å»ºæµå¯¹è±¡ // 1.1 æŒ‡å®šæ•°æ®æº FileInputStream fis = new FileInputStream(\"D:\\\\test.jpg\"); // 1.2 æŒ‡å®šç›®çš„åœ° FileOutputStream fos = new FileOutputStream(\"test_copy.jpg\"); // 2.è¯»å†™æ•°æ® // 2.1 å®šä¹‰æ•°ç»„ byte[] b = new byte[1024]; // 2.2 å®šä¹‰é•¿åº¦ int len; // 2.3 å¾ªç¯è¯»å– while ((len = fis.read(b))!=-1) { // 2.4 å†™å‡ºæ•°æ® fos.write(b, 0 , len); } // 3.å…³é—­èµ„æº fos.close(); fis.close(); } } 2.5 Readerjava.io.ReaderæŠ½è±¡ç±»æ˜¯è¡¨ç¤ºç”¨äºè¯»å–å­—ç¬¦æµçš„æ‰€æœ‰ç±»çš„è¶…ç±»ï¼Œå¯ä»¥è¯»å–å­—ç¬¦ä¿¡æ¯åˆ°å†…å­˜ä¸­ã€‚å®ƒå®šä¹‰äº†å­—ç¬¦è¾“å…¥æµçš„åŸºæœ¬å…±æ€§åŠŸèƒ½æ–¹æ³•ã€‚ public void close() ï¼šå…³é—­æ­¤æµå¹¶é‡Šæ”¾ä¸æ­¤æµç›¸å…³è”çš„ä»»ä½•ç³»ç»Ÿèµ„æºã€‚ public int read()ï¼š ä»è¾“å…¥æµè¯»å–ä¸€ä¸ªå­—ç¬¦ã€‚ è¿”å›çš„charè‡ªåŠ¨æå‡ä¸ºintã€‚ public int read(char[] cbuf)ï¼š ä»è¾“å…¥æµä¸­è¯»å–ä¸€äº›å­—ç¬¦ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åˆ°å­—ç¬¦æ•°ç»„ cbufä¸­ ã€‚ public int read(char cbuf[], int off, int len)ï¼šï¼š ä»è¾“å…¥æµä¸­è¯»å–ä¸€äº›å­—ç¬¦ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åˆ°å­—ç¬¦æ•°ç»„ cbufä¸­ ã€‚ï¼ˆoffä¸ºåç§»é‡ï¼Œlenä¸ºè¯»å–é•¿åº¦ï¼‰ readå¸¦æ•°ç»„å‚æ•°çš„è¿”å›çš„æ˜¯è¯»å–çš„å­—ç¬¦é•¿åº¦ï¼Œæœªè¯»å–è¿”å›-1ã€‚ 2.5.1 FileReaderç±»java.io.FileReaderç±»æ˜¯è¯»å–å­—ç¬¦æ–‡ä»¶çš„ä¾¿åˆ©ç±»ã€‚æ„é€ æ—¶ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„å­—ç¬¦ç¼–ç å’Œé»˜è®¤å­—èŠ‚ç¼“å†²åŒºã€‚ æ„é€ æ–¹æ³•ï¼š FileReader(File file)ï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„ FileReader ï¼Œç»™å®šè¦è¯»å–çš„Fileå¯¹è±¡ã€‚ FileReader(String fileName)ï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„ FileReader ï¼Œç»™å®šè¦è¯»å–çš„æ–‡ä»¶çš„åç§°ã€‚ 2.6 Writerjava.io.WriteræŠ½è±¡ç±»æ˜¯è¡¨ç¤ºç”¨äºå†™å‡ºå­—ç¬¦æµçš„æ‰€æœ‰ç±»çš„è¶…ç±»ï¼Œå°†æŒ‡å®šçš„å­—ç¬¦ä¿¡æ¯å†™å‡ºåˆ°ç›®çš„åœ°ã€‚å®ƒå®šä¹‰äº†å­—èŠ‚è¾“å‡ºæµçš„åŸºæœ¬å…±æ€§åŠŸèƒ½æ–¹æ³•ã€‚ void write(int c) å†™å…¥å•ä¸ªå­—ç¬¦ã€‚ void write(char[] cbuf)å†™å…¥å­—ç¬¦æ•°ç»„ã€‚ abstract void write(char[] cbuf, int off, int len)å†™å…¥å­—ç¬¦æ•°ç»„çš„æŸä¸€éƒ¨åˆ†,offæ•°ç»„çš„å¼€å§‹ç´¢å¼•,lenå†™çš„å­—ç¬¦ä¸ªæ•°ã€‚ void write(String str)å†™å…¥å­—ç¬¦ä¸²ã€‚ void write(String str, int off, int len) å†™å…¥å­—ç¬¦ä¸²çš„æŸä¸€éƒ¨åˆ†,offå­—ç¬¦ä¸²çš„å¼€å§‹ç´¢å¼•,lenå†™çš„å­—ç¬¦ä¸ªæ•°ã€‚ void flush()åˆ·æ–°è¯¥æµçš„ç¼“å†²ã€‚ void close() å…³é—­æ­¤æµï¼Œä½†è¦å…ˆåˆ·æ–°å®ƒã€‚ 2.6.1 FileWriterç±»java.io.FileWriterç±»æ˜¯å†™å‡ºå­—ç¬¦åˆ°æ–‡ä»¶çš„ä¾¿åˆ©ç±»ã€‚æ„é€ æ—¶ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„å­—ç¬¦ç¼–ç å’Œé»˜è®¤å­—èŠ‚ç¼“å†²åŒºã€‚ æ„é€ æ–¹æ³•ï¼š FileWriter(File file)ï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„ FileWriterï¼Œç»™å®šè¦è¯»å–çš„Fileå¯¹è±¡ã€‚ FileWriter(String fileName)ï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„ FileWriterï¼Œç»™å®šè¦è¯»å–çš„æ–‡ä»¶çš„åç§°ã€‚ 2.7 try-with-resourceå¦‚æœé‡åˆ°å¼‚å¸¸éœ€è¦å…³é—­æµï¼ŒJDK7ä¹‹å‰å¯ä»¥ä½¿ç”¨try-catch-finallyï¼ŒJDK7æä¾›äº†ä¸€ç§try-with-resourceè¯­æ³•ç³–ï¼Œå¯ä»¥æ–¹ä¾¿å…³é—­æµã€‚ ä»£ç ä½¿ç”¨æ¼”ç¤ºï¼š public class HandleException2 { public static void main(String[] args) { // åˆ›å»ºæµå¯¹è±¡ try ( FileWriter fw = new FileWriter(\"**\"); ) { // å†™å‡ºæ•°æ® } catch (IOException e) { e.printStackTrace(); } } }","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://www.codetool.top/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"},{"name":"IO","slug":"IO","permalink":"https://www.codetool.top/tags/IO/"}]},{"title":"Javaçº¿ç¨‹æ± è¯¦è§£","slug":"Javaçº¿ç¨‹æ± è¯¦è§£","date":"2020-02-03T13:44:01.000Z","updated":"2020-04-22T09:27:27.142Z","comments":true,"path":"article/Javaçº¿ç¨‹æ± è¯¦è§£/","link":"","permalink":"https://www.codetool.top/article/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%AF%A6%E8%A7%A3/","excerpt":"","text":"çº¿ç¨‹æ± å°±æ˜¯äº«å…ƒæ¨¡å¼å’Œç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼çš„åº”ç”¨ 1 åŠ¨æ‰‹å®ç°çº¿ç¨‹æ±  æ­¥éª¤1ï¼šè‡ªå®šä¹‰æ‹’ç»ç­–ç•¥æ¥å£ @FunctionalInterface // æ‹’ç»ç­–ç•¥ interface RejectPolicy&lt;T> { void reject(BlockingQueue&lt;T> queue, T task); } æ­¥éª¤2ï¼šè‡ªå®šä¹‰ä»»åŠ¡é˜Ÿåˆ— class BlockingQueue&lt;T> { // 1. ä»»åŠ¡é˜Ÿåˆ— private Deque&lt;T> queue = new ArrayDeque&lt;>(); // 2. é” private ReentrantLock lock = new ReentrantLock(); // 3. ç”Ÿäº§è€…æ¡ä»¶å˜é‡ private Condition fullWaitSet = lock.newCondition(); // 4. æ¶ˆè´¹è€…æ¡ä»¶å˜é‡ private Condition emptyWaitSet = lock.newCondition(); // 5. å®¹é‡ private int capcity; public BlockingQueue(int capcity) { this.capcity = capcity; } // å¸¦è¶…æ—¶é˜»å¡è·å– public T poll(long timeout, TimeUnit unit) { lock.lock(); try { // å°† timeout ç»Ÿä¸€è½¬æ¢ä¸º çº³ç§’ long nanos = unit.toNanos(timeout); while (queue.isEmpty()) { try { // è¿”å›å€¼æ˜¯å‰©ä½™æ—¶é—´ if (nanos &lt;= 0) { return null; } nanos = emptyWaitSet.awaitNanos(nanos); } catch (InterruptedException e) { e.printStackTrace(); } } T t = queue.removeFirst(); fullWaitSet.signal(); return t; } finally { lock.unlock(); } } // é˜»å¡è·å– public T take() { lock.lock(); try { while (queue.isEmpty()) { try { emptyWaitSet.await(); } catch (InterruptedException e) { e.printStackTrace(); } } T t = queue.removeFirst(); fullWaitSet.signal(); return t; } finally { lock.unlock(); } } // é˜»å¡æ·»åŠ  public void put(T task) { lock.lock(); try { while (queue.size() == capcity) { try { log.debug(\"ç­‰å¾…åŠ å…¥ä»»åŠ¡é˜Ÿåˆ— {} ...\", task); fullWaitSet.await(); } catch (InterruptedException e) { e.printStackTrace(); } } log.debug(\"åŠ å…¥ä»»åŠ¡é˜Ÿåˆ— {}\", task); queue.addLast(task); emptyWaitSet.signal(); } finally { lock.unlock(); } } // å¸¦è¶…æ—¶æ—¶é—´é˜»å¡æ·»åŠ  public boolean offer(T task, long timeout, TimeUnit timeUnit) { lock.lock(); try { long nanos = timeUnit.toNanos(timeout); while (queue.size() == capcity) { try { if(nanos &lt;= 0) { return false; } log.debug(\"ç­‰å¾…åŠ å…¥ä»»åŠ¡é˜Ÿåˆ— {} ...\", task); nanos = fullWaitSet.awaitNanos(nanos); } catch (InterruptedException e) { e.printStackTrace(); } } log.debug(\"åŠ å…¥ä»»åŠ¡é˜Ÿåˆ— {}\", task); queue.addLast(task); emptyWaitSet.signal(); return true; } finally { lock.unlock(); } } public int size() { lock.lock(); try { return queue.size(); } finally { lock.unlock(); } } public void tryPut(RejectPolicy&lt;T> rejectPolicy, T task) { lock.lock(); try { // åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦æ»¡ if(queue.size() == capcity) { rejectPolicy.reject(this, task); } else { // æœ‰ç©ºé—² log.debug(\"åŠ å…¥ä»»åŠ¡é˜Ÿåˆ— {}\", task); queue.addLast(task); emptyWaitSet.signal(); } } finally { lock.unlock(); } } } æ­¥éª¤3ï¼šè‡ªå®šä¹‰çº¿ç¨‹æ±  class ThreadPool { // ä»»åŠ¡é˜Ÿåˆ— private BlockingQueue&lt;Runnable> taskQueue; // çº¿ç¨‹é›†åˆ private HashSet&lt;Worker> workers = new HashSet&lt;>(); // æ ¸å¿ƒçº¿ç¨‹æ•° private int coreSize; // è·å–ä»»åŠ¡æ—¶çš„è¶…æ—¶æ—¶é—´ private long timeout; private TimeUnit timeUnit; private RejectPolicy&lt;Runnable> rejectPolicy; // æ‰§è¡Œä»»åŠ¡ public void execute(Runnable task) { // å½“ä»»åŠ¡æ•°æ²¡æœ‰è¶…è¿‡ coreSize æ—¶ï¼Œç›´æ¥äº¤ç»™ worker å¯¹è±¡æ‰§è¡Œ // å¦‚æœä»»åŠ¡æ•°è¶…è¿‡ coreSize æ—¶ï¼ŒåŠ å…¥ä»»åŠ¡é˜Ÿåˆ—æš‚å­˜ synchronized (workers) { if(workers.size() &lt; coreSize) { Worker worker = new Worker(task); log.debug(\"æ–°å¢ worker{}, {}\", worker, task); workers.add(worker); worker.start(); } else { // taskQueue.put(task); // 1) æ­»ç­‰ // 2) å¸¦è¶…æ—¶ç­‰å¾… // 3) è®©è°ƒç”¨è€…æ”¾å¼ƒä»»åŠ¡æ‰§è¡Œ // 4) è®©è°ƒç”¨è€…æŠ›å‡ºå¼‚å¸¸ // 5) è®©è°ƒç”¨è€…è‡ªå·±æ‰§è¡Œä»»åŠ¡ taskQueue.tryPut(rejectPolicy, task); } } } public ThreadPool(int coreSize, long timeout, TimeUnit timeUnit, int queueCapcity, RejectPolicy&lt;Runnable> rejectPolicy) { this.coreSize = coreSize; this.timeout = timeout; this.timeUnit = timeUnit; this.taskQueue = new BlockingQueue&lt;>(queueCapcity); this.rejectPolicy = rejectPolicy; } class Worker extends Thread{ private Runnable task; public Worker(Runnable task) { this.task = task; } @Override public void run() { // æ‰§è¡Œä»»åŠ¡ // 1) å½“ task ä¸ä¸ºç©ºï¼Œæ‰§è¡Œä»»åŠ¡ // 2) å½“ task æ‰§è¡Œå®Œæ¯•ï¼Œå†æ¥ç€ä»ä»»åŠ¡é˜Ÿåˆ—è·å–ä»»åŠ¡å¹¶æ‰§è¡Œ // while(task != null || (task = taskQueue.take()) != null) { while(task != null || (task = taskQueue.poll(timeout, timeUnit)) != null) { try { log.debug(\"æ­£åœ¨æ‰§è¡Œ...{}\", task); task.run(); } catch (Exception e) { e.printStackTrace(); } finally { task = null; } } synchronized (workers) { log.debug(\"worker è¢«ç§»é™¤{}\", this); workers.remove(this); } } } } 2 ThreadPoolExecutor 2.1 çº¿ç¨‹æ± çŠ¶æ€ThreadPoolExecutor ä½¿ç”¨ int çš„é«˜ 3 ä½æ¥è¡¨ç¤ºçº¿ç¨‹æ± çŠ¶æ€ï¼Œä½ 29 ä½è¡¨ç¤ºçº¿ç¨‹æ•°é‡ çŠ¶æ€å é«˜3ä½ æ¥æ”¶æ–°ä»»åŠ¡ å¤„ç†é˜»å¡é˜Ÿåˆ—ä»»åŠ¡ è¯´æ˜ RUNNING 111 Y Y SHUTDOWN 000 N Y ä¸ä¼šæ¥æ”¶æ–°ä»»åŠ¡ï¼Œä½†ä¼šå¤„ç†é˜»å¡é˜Ÿåˆ—å‰©ä½™ä»»åŠ¡ STOP 001 N N ä¼šä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶æŠ›å¼ƒé˜»å¡é˜Ÿåˆ—ä»»åŠ¡ TIDYING 010 ä»»åŠ¡å…¨æ‰§è¡Œå®Œæ¯•ï¼Œæ´»åŠ¨çº¿ç¨‹ä¸º 0 å³å°†è¿›å…¥ç»ˆç»“ TERMINATED 011 ç»ˆç»“çŠ¶æ€ ä»æ•°å­—ä¸Šæ¯”è¾ƒï¼ŒTERMINATED &gt; TIDYING &gt; STOP &gt; SHUTDOWN &gt; RUNNING è¿™äº›ä¿¡æ¯å­˜å‚¨åœ¨ä¸€ä¸ªåŸå­å˜é‡ ctl ä¸­ï¼Œç›®çš„æ˜¯å°†çº¿ç¨‹æ± çŠ¶æ€ä¸çº¿ç¨‹ä¸ªæ•°åˆäºŒä¸ºä¸€ï¼Œè¿™æ ·å°±å¯ä»¥ç”¨ä¸€æ¬¡ cas åŸå­æ“ä½œè¿›è¡Œèµ‹å€¼ // c ä¸ºæ—§å€¼ï¼Œ ctlOf è¿”å›ç»“æœä¸ºæ–°å€¼ ctl.compareAndSet(c, ctlOf(targetState, workerCountOf(c)))); // rs ä¸ºé«˜ 3 ä½ä»£è¡¨çº¿ç¨‹æ± çŠ¶æ€ï¼Œ wc ä¸ºä½ 29 ä½ä»£è¡¨çº¿ç¨‹ä¸ªæ•°ï¼Œctl æ˜¯åˆå¹¶å®ƒä»¬ private static int ctlOf(int rs, int wc) { return rs | wc; } 2.2 æ„é€ æ–¹æ³•public ThreadPoolExecutor( int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable> workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler ) corePoolSize æ ¸å¿ƒçº¿ç¨‹æ•°ç›® (æœ€å¤šä¿ç•™çš„çº¿ç¨‹æ•°) maximumPoolSize æœ€å¤§çº¿ç¨‹æ•°ç›® keepAliveTime ç”Ÿå­˜æ—¶é—´ - é’ˆå¯¹æ•‘æ€¥çº¿ç¨‹ unit æ—¶é—´å•ä½ - é’ˆå¯¹æ•‘æ€¥çº¿ç¨‹ workQueue é˜»å¡é˜Ÿåˆ— threadFactory çº¿ç¨‹å·¥å‚ - å¯ä»¥ä¸ºçº¿ç¨‹åˆ›å»ºæ—¶èµ·ä¸ªå¥½åå­— handler æ‹’ç»ç­–ç•¥ å·¥ä½œæ–¹å¼ï¼š çº¿ç¨‹æ± ä¸­åˆšå¼€å§‹æ²¡æœ‰çº¿ç¨‹ï¼Œå½“ä¸€ä¸ªä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± åï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚ å½“çº¿ç¨‹æ•°è¾¾åˆ° corePoolSize å¹¶æ²¡æœ‰çº¿ç¨‹ç©ºé—²ï¼Œè¿™æ—¶å†åŠ å…¥ä»»åŠ¡ï¼Œæ–°åŠ çš„ä»»åŠ¡ä¼šè¢«åŠ å…¥workQueue é˜Ÿåˆ—æ’é˜Ÿï¼Œç›´åˆ°æœ‰ç©ºé—²çš„çº¿ç¨‹ã€‚ å¦‚æœé˜Ÿåˆ—é€‰æ‹©äº†æœ‰ç•Œé˜Ÿåˆ—ï¼Œé‚£ä¹ˆä»»åŠ¡è¶…è¿‡äº†é˜Ÿåˆ—å¤§å°æ—¶ï¼Œä¼šåˆ›å»º maximumPoolSize - corePoolSize æ•°ç›®çš„çº¿ç¨‹æ¥æ•‘æ€¥ã€‚ å¦‚æœçº¿ç¨‹åˆ°è¾¾ maximumPoolSize ä»ç„¶æœ‰æ–°ä»»åŠ¡è¿™æ—¶ä¼šæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚æ‹’ç»ç­–ç•¥ jdk æä¾›äº† 4 ç§å®ç°ï¼Œå…¶å®ƒè‘—åæ¡†æ¶ä¹Ÿæä¾›äº†å®ç° AbortPolicy è®©è°ƒç”¨è€…æŠ›å‡º RejectedExecutionException å¼‚å¸¸ï¼Œè¿™æ˜¯é»˜è®¤ç­–ç•¥ CallerRunsPolicy è®©è°ƒç”¨è€…è¿è¡Œä»»åŠ¡ DiscardPolicy æ”¾å¼ƒæœ¬æ¬¡ä»»åŠ¡ DiscardOldestPolicy æ”¾å¼ƒé˜Ÿåˆ—ä¸­æœ€æ—©çš„ä»»åŠ¡ï¼Œæœ¬ä»»åŠ¡å–è€Œä»£ä¹‹ Dubbo çš„å®ç°ï¼Œåœ¨æŠ›å‡º RejectedExecutionException å¼‚å¸¸ä¹‹å‰ä¼šè®°å½•æ—¥å¿—ï¼Œå¹¶ dump çº¿ç¨‹æ ˆä¿¡æ¯ï¼Œæ–¹ä¾¿å®šä½é—®é¢˜ Netty çš„å®ç°ï¼Œæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ ActiveMQ çš„å®ç°ï¼Œå¸¦è¶…æ—¶ç­‰å¾…ï¼ˆ60sï¼‰å°è¯•æ”¾å…¥é˜Ÿåˆ—ï¼Œç±»ä¼¼æˆ‘ä»¬ä¹‹å‰è‡ªå®šä¹‰çš„æ‹’ç»ç­–ç•¥ PinPoint çš„å®ç°ï¼Œå®ƒä½¿ç”¨äº†ä¸€ä¸ªæ‹’ç»ç­–ç•¥é“¾ï¼Œä¼šé€ä¸€å°è¯•ç­–ç•¥é“¾ä¸­æ¯ç§æ‹’ç»ç­–ç•¥ å½“é«˜å³°è¿‡å»åï¼Œè¶…è¿‡ corePoolSize çš„æ•‘æ€¥çº¿ç¨‹å¦‚æœä¸€æ®µæ—¶é—´æ²¡æœ‰ä»»åŠ¡åšï¼Œéœ€è¦ç»“æŸèŠ‚çœèµ„æºï¼Œè¿™ä¸ªæ—¶é—´ç”± keepAliveTime å’Œ unit æ¥æ§åˆ¶ã€‚ BlockingQueueçš„å„ç§å®ç°ç±»ï¼š(å‚è€ƒé“¾æ¥) ArrayBlockingQueueï¼šåŸºäºæ•°ç»„çš„é˜»å¡é˜Ÿåˆ—å®ç°ï¼Œåœ¨ArrayBlockingQueueå†…éƒ¨ï¼Œç»´æŠ¤äº†ä¸€ä¸ªå®šé•¿çš„æ•°ç»„ï¼Œä»¥ä¾¿ç¼“å­˜é˜Ÿåˆ—ä¸­çš„æ•°æ®å¯¹è±¡ï¼Œå…¶å†…éƒ¨æ²¡å®ç°è¯»å†™åˆ†ç¦»ï¼Œä¹Ÿå°±æ„å‘³ç€ç”Ÿäº§å’Œæ¶ˆè´¹è€…ä¸èƒ½å®Œå…¨å¹¶è¡Œã€‚é•¿åº¦æ˜¯éœ€è¦å®šä¹‰çš„ï¼Œå¯ä»¥æŒ‡å®šå…ˆè¿›å…ˆå‡ºæˆ–è€…å…ˆè¿›åå‡ºï¼Œå› ä¸ºé•¿åº¦æ˜¯éœ€è¦å®šä¹‰çš„ï¼Œæ‰€ä»¥ä¹Ÿå«æœ‰ç•Œé˜Ÿåˆ—ï¼Œåœ¨å¾ˆå¤šåœºåˆéå¸¸é€‚åˆä½¿ç”¨ã€‚ LinkedBlockingQueueï¼šåŸºäºé“¾è¡¨çš„é˜»å¡é˜Ÿåˆ—ï¼ŒåŒArrayBlockingQueueç±»ä¼¼ï¼Œå…¶å†…éƒ¨ä¹Ÿç»´æŒç€ä¸€ä¸ªæ•°æ®ç¼“å†²é˜Ÿåˆ—ï¼ˆè¯¥é˜Ÿåˆ—ç”±ä¸€ä¸ªé“¾è¡¨æ„æˆï¼‰ï¼ŒLinkedBlockingQueueä¹‹æ‰€ä»¥èƒ½å¤Ÿé«˜æ•ˆåœ°å¤„ç†å¹¶å‘æ•°æ®ï¼Œæ˜¯å› ä¸ºå…¶å†…éƒ¨å®ç°é‡‡ç”¨åˆ†ç¦»é”ï¼ˆè¯»å†™åˆ†ç¦»ä¸¤ä¸ªé”ï¼‰ï¼Œä»è€Œå®ç°ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ“ä½œå®Œå…¨å¹¶è¡Œè¿è¡Œã€‚éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ— ç•Œé˜Ÿåˆ—ã€‚ SynchronousQueueï¼šä¸€ç§æ²¡æœ‰ç¼“å†²çš„é˜Ÿåˆ—ï¼Œç”Ÿäº§è€…äº§ç”Ÿçš„æ•°æ®ç›´æ¥ä¼šè¢«æ¶ˆè´¹è€…è·å–å¹¶ä¸”ç«‹åˆ»æ¶ˆè´¹ã€‚ PriorityBlockingQueueï¼šåŸºäºä¼˜å…ˆçº§åˆ«çš„é˜»å¡é˜Ÿåˆ—ï¼ˆä¼˜å…ˆçº§çš„åˆ¤æ–­é€šè¿‡æ„é€ å‡½æ•°ä¼ å…¥çš„Compatorå¯¹è±¡æ¥å†³å®šï¼Œä¹Ÿå°±æ˜¯è¯´ä¼ å…¥é˜Ÿåˆ—çš„å¯¹è±¡å¿…é¡»å®ç°Comparableæ¥å£ï¼‰ï¼Œåœ¨å®ç°PriorityBlockingQueueæ—¶ï¼Œå†…éƒ¨æ§åˆ¶çº¿ç¨‹åŒæ­¥çš„é”é‡‡ç”¨çš„æ˜¯å…¬å¹³é”ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å®ƒä¹Ÿæ˜¯ä¸€ä¸ªæ— ç•Œçš„é˜Ÿåˆ—ã€‚ DelayQueueï¼šå¸¦æœ‰å»¶è¿Ÿæ—¶é—´çš„Queueï¼Œå…¶ä¸­çš„å…ƒç´ åªæœ‰å½“å…¶æŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´åˆ°äº†ï¼Œæ‰èƒ½å¤Ÿä»é˜Ÿåˆ—ä¸­è·å–åˆ°è¯¥å…ƒç´ ã€‚DelayQueueä¸­çš„å…ƒç´ å¿…é¡»å…ˆå®ç°Delayedæ¥å£ï¼ŒDelayQueueæ˜¯ä¸€ä¸ªæ²¡æœ‰å¤§å°é™åˆ¶çš„é˜Ÿåˆ—ï¼Œåº”ç”¨åœºæ™¯å¾ˆå¤šï¼Œæ¯”å¦‚å¯¹ç¼“å­˜è¶…æ—¶çš„æ•°æ®è¿›è¡Œç§»é™¤ã€ä»»åŠ¡è¶…æ—¶å¤„ç†ã€ç©ºé—²è¿æ¥çš„å…³é—­ç­‰ç­‰ã€‚ æ ¹æ®è¿™ä¸ªæ„é€ æ–¹æ³•ï¼ŒJDK Executors ç±»ä¸­æä¾›äº†ä¼—å¤šå·¥å‚æ–¹æ³•æ¥åˆ›å»ºå„ç§ç”¨é€”çš„çº¿ç¨‹æ± ã€‚ 2.3 newFixedThreadPoolå›ºå®šå¤§å°çº¿ç¨‹æ± public static ExecutorService newFixedThreadPool(int nThreads) { return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable>()); } ç‰¹ç‚¹ æ ¸å¿ƒçº¿ç¨‹æ•° == æœ€å¤§çº¿ç¨‹æ•°ï¼ˆæ²¡æœ‰æ•‘æ€¥çº¿ç¨‹è¢«åˆ›å»ºï¼‰ï¼Œå› æ­¤ä¹Ÿæ— éœ€è¶…æ—¶æ—¶é—´ é˜»å¡é˜Ÿåˆ—æ˜¯æ— ç•Œçš„ï¼Œå¯ä»¥æ”¾ä»»æ„æ•°é‡çš„ä»»åŠ¡ è¯„ä»· é€‚ç”¨äºä»»åŠ¡é‡å·²çŸ¥ï¼Œç›¸å¯¹è€—æ—¶çš„ä»»åŠ¡ 2.4 newCachedThreadPoolå¸¦ç¼“å†²çº¿ç¨‹æ± public static ExecutorService newCachedThreadPool() { return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable>()); } ç‰¹ç‚¹ æ ¸å¿ƒçº¿ç¨‹æ•°æ˜¯ 0ï¼Œ æœ€å¤§çº¿ç¨‹æ•°æ˜¯ Integer.MAX_VALUEï¼Œæ•‘æ€¥çº¿ç¨‹çš„ç©ºé—²ç”Ÿå­˜æ—¶é—´æ˜¯ 60sï¼Œæ„å‘³ç€ å…¨éƒ¨éƒ½æ˜¯æ•‘æ€¥çº¿ç¨‹ï¼ˆ60s åå¯ä»¥å›æ”¶ï¼‰ æ•‘æ€¥çº¿ç¨‹å¯ä»¥æ— é™åˆ›å»º é˜Ÿåˆ—é‡‡ç”¨äº† SynchronousQueue å®ç°ç‰¹ç‚¹æ˜¯ï¼Œå®ƒæ²¡æœ‰å®¹é‡ï¼Œæ²¡æœ‰çº¿ç¨‹æ¥å–æ˜¯æ”¾ä¸è¿›å»çš„ï¼ˆä¸€æ‰‹äº¤é’±ã€ä¸€æ‰‹äº¤è´§ï¼‰ è¯„ä»· æ•´ä¸ªçº¿ç¨‹æ± è¡¨ç°ä¸ºçº¿ç¨‹æ•°ä¼šæ ¹æ®ä»»åŠ¡é‡ä¸æ–­å¢é•¿ï¼Œæ²¡æœ‰ä¸Šé™ï¼Œå½“ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œç©ºé—² 1åˆ†é’Ÿåé‡Šæ”¾çº¿ç¨‹ã€‚ é€‚åˆä»»åŠ¡æ•°æ¯”è¾ƒå¯†é›†ï¼Œä½†æ¯ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´è¾ƒçŸ­çš„æƒ…å†µã€‚ 2.5 newSingleThreadExecutorå•çº¿ç¨‹çº¿ç¨‹æ± public static ExecutorService newSingleThreadExecutor() { return new FinalizableDelegatedExecutorService (new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable>())); } ä½¿ç”¨åœºæ™¯ï¼šå¸Œæœ›å¤šä¸ªä»»åŠ¡æ’é˜Ÿæ‰§è¡Œã€‚çº¿ç¨‹æ•°å›ºå®šä¸º 1ï¼Œä»»åŠ¡æ•°å¤šäº 1 æ—¶ï¼Œä¼šæ”¾å…¥æ— ç•Œé˜Ÿåˆ—æ’é˜Ÿã€‚ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè¿™å”¯ä¸€çš„çº¿ç¨‹ä¹Ÿä¸ä¼šè¢«é‡Šæ”¾ã€‚ åŒºåˆ«ï¼š è‡ªå·±åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹ä¸²è¡Œæ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœä»»åŠ¡æ‰§è¡Œå¤±è´¥è€Œç»ˆæ­¢é‚£ä¹ˆæ²¡æœ‰ä»»ä½•è¡¥æ•‘æªæ–½ï¼Œè€Œçº¿ç¨‹æ± è¿˜ä¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¿è¯æ± çš„æ­£å¸¸å·¥ä½œ Executors.newSingleThreadExecutor() çº¿ç¨‹ä¸ªæ•°å§‹ç»ˆä¸º1ï¼Œä¸èƒ½ä¿®æ”¹ FinalizableDelegatedExecutorService åº”ç”¨çš„æ˜¯è£…é¥°å™¨æ¨¡å¼ï¼Œåªå¯¹å¤–æš´éœ²äº† ExecutorService æ¥å£ï¼Œå› æ­¤ä¸èƒ½è°ƒç”¨ ThreadPoolExecutor ä¸­ç‰¹æœ‰çš„æ–¹æ³• Executors.newFixedThreadPool(1) åˆå§‹æ—¶ä¸º1ï¼Œä»¥åè¿˜å¯ä»¥ä¿®æ”¹ å¯¹å¤–æš´éœ²çš„æ˜¯ ThreadPoolExecutor å¯¹è±¡ï¼Œå¯ä»¥å¼ºè½¬åè°ƒç”¨ setCorePoolSize ç­‰æ–¹æ³•è¿›è¡Œä¿®æ”¹ 2.6 æäº¤ä»»åŠ¡// æ‰§è¡Œä»»åŠ¡ void execute(Runnable command); // æäº¤ä»»åŠ¡ taskï¼Œç”¨è¿”å›å€¼ Future è·å¾—ä»»åŠ¡æ‰§è¡Œç»“æœ &lt;T> Future&lt;T> submit(Callable&lt;T> task); Future&lt;Integer> future1 = pool.submit(() -> { return 1; }); // æäº¤ tasks ä¸­æ‰€æœ‰ä»»åŠ¡ &lt;T> List&lt;Future&lt;T>> invokeAll(Collection&lt;? extends Callable&lt;T>> tasks) throws InterruptedException; // æäº¤ tasks ä¸­æ‰€æœ‰ä»»åŠ¡ï¼Œå¸¦è¶…æ—¶æ—¶é—´ï¼Œä¸¢å¼ƒè¶…å‡ºæ—¶é—´æœªè¿è¡Œçš„çº¿ç¨‹ï¼Œè¿”å›çš„Listä¸­çš„ç»“æœæŒ‰çº¿ç¨‹é¡ºåºæ’åº &lt;T> List&lt;Future&lt;T>> invokeAll(Collection&lt;? extends Callable&lt;T>> tasks, long timeout, TimeUnit unit) throws InterruptedException; // æäº¤ tasks ä¸­æ‰€æœ‰ä»»åŠ¡ï¼Œå“ªä¸ªä»»åŠ¡å…ˆæˆåŠŸæ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›æ­¤ä»»åŠ¡æ‰§è¡Œç»“æœï¼Œå…¶å®ƒä»»åŠ¡å–æ¶ˆ &lt;T> T invokeAny(Collection&lt;? extends Callable&lt;T>> tasks) throws InterruptedException, ExecutionException; // æäº¤ tasks ä¸­æ‰€æœ‰ä»»åŠ¡ï¼Œå“ªä¸ªä»»åŠ¡å…ˆæˆåŠŸæ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›æ­¤ä»»åŠ¡æ‰§è¡Œç»“æœï¼Œå…¶å®ƒä»»åŠ¡å–æ¶ˆï¼Œå¸¦è¶…æ—¶æ—¶é—´ &lt;T> T invokeAny(Collection&lt;? extends Callable&lt;T>> tasks, long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException; 2.7 å…³é—­çº¿ç¨‹æ± 2.7.1 shutdown/* çº¿ç¨‹æ± çŠ¶æ€å˜ä¸º SHUTDOWN - ä¸ä¼šæ¥æ”¶æ–°ä»»åŠ¡ - ä½†å·²æäº¤ä»»åŠ¡ä¼šæ‰§è¡Œå®Œ - æ­¤æ–¹æ³•ä¸ä¼šé˜»å¡è°ƒç”¨çº¿ç¨‹çš„æ‰§è¡Œ */ void shutdown(); public void shutdown() { final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try { checkShutdownAccess(); // ä¿®æ”¹çº¿ç¨‹æ± çŠ¶æ€ advanceRunState(SHUTDOWN); // ä»…ä¼šæ‰“æ–­ç©ºé—²çº¿ç¨‹ interruptIdleWorkers(); onShutdown(); // æ‰©å±•ç‚¹ ScheduledThreadPoolExecutor } finally { mainLock.unlock(); } // å°è¯•ç»ˆç»“(æ²¡æœ‰è¿è¡Œçš„çº¿ç¨‹å¯ä»¥ç«‹åˆ»ç»ˆç»“ï¼Œå¦‚æœè¿˜æœ‰è¿è¡Œçš„çº¿ç¨‹ä¹Ÿä¸ä¼šç­‰) tryTerminate(); } 2.7.2 shutdownNow/* çº¿ç¨‹æ± çŠ¶æ€å˜ä¸º STOP - ä¸ä¼šæ¥æ”¶æ–°ä»»åŠ¡ - ä¼šå°†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡è¿”å› - å¹¶ç”¨ interrupt çš„æ–¹å¼ä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ */ List&lt;Runnable> shutdownNow(); public List&lt;Runnable> shutdownNow() { List&lt;Runnable> tasks; final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try { checkShutdownAccess(); // ä¿®æ”¹çº¿ç¨‹æ± çŠ¶æ€ advanceRunState(STOP); // æ‰“æ–­æ‰€æœ‰çº¿ç¨‹ interruptWorkers(); // è·å–é˜Ÿåˆ—ä¸­å‰©ä½™ä»»åŠ¡ tasks = drainQueue(); } finally { mainLock.unlock(); } // å°è¯•ç»ˆç»“ tryTerminate(); return tasks; } 2.7.3 å…¶å®ƒæ–¹æ³•// ä¸åœ¨ RUNNING çŠ¶æ€çš„çº¿ç¨‹æ± ï¼Œæ­¤æ–¹æ³•å°±è¿”å› true boolean isShutdown(); // çº¿ç¨‹æ± çŠ¶æ€æ˜¯å¦æ˜¯ TERMINATED boolean isTerminated(); // è°ƒç”¨ shutdown åï¼Œç”±äºè°ƒç”¨çº¿ç¨‹å¹¶ä¸ä¼šç­‰å¾…æ‰€æœ‰ä»»åŠ¡è¿è¡Œç»“æŸï¼Œå› æ­¤å¦‚æœå®ƒæƒ³åœ¨çº¿ç¨‹æ±  TERMINATED ååšäº›äº‹ æƒ…ï¼Œå¯ä»¥åˆ©ç”¨æ­¤æ–¹æ³•ç­‰å¾… boolean awaitTermination(long timeout, TimeUnit unit) throws InterruptedException; 2.8 çº¿ç¨‹æ± å¤šå¤§åˆé€‚2.8.1 CPU å¯†é›†å‹è¿ç®—é€šå¸¸é‡‡ç”¨ cpu æ ¸æ•° + 1 èƒ½å¤Ÿå®ç°æœ€ä¼˜çš„ CPU åˆ©ç”¨ç‡ï¼Œ+1 æ˜¯ä¿è¯å½“çº¿ç¨‹ç”±äºé¡µç¼ºå¤±æ•…éšœï¼ˆæ“ä½œç³»ç»Ÿï¼‰æˆ–å…¶å®ƒåŸå› å¯¼è‡´æš‚åœæ—¶ï¼Œé¢å¤–çš„è¿™ä¸ªçº¿ç¨‹å°±èƒ½é¡¶ä¸Šå»ï¼Œä¿è¯ CPU æ—¶é’Ÿå‘¨æœŸä¸è¢«æµªè´¹ 2.8.2 I/O å¯†é›†å‹è¿ç®—CPU ä¸æ€»æ˜¯å¤„äºç¹å¿™çŠ¶æ€ï¼Œä¾‹å¦‚ï¼Œå½“ä½ æ‰§è¡Œä¸šåŠ¡è®¡ç®—æ—¶ï¼Œè¿™æ—¶å€™ä¼šä½¿ç”¨ CPU èµ„æºï¼Œä½†å½“ä½ æ‰§è¡Œ I/O æ“ä½œæ—¶ã€è¿œç¨‹RPC è°ƒç”¨æ—¶ï¼ŒåŒ…æ‹¬è¿›è¡Œæ•°æ®åº“æ“ä½œæ—¶ï¼Œè¿™æ—¶å€™ CPU å°±é—²ä¸‹æ¥äº†ï¼Œä½ å¯ä»¥åˆ©ç”¨å¤šçº¿ç¨‹æé«˜å®ƒçš„åˆ©ç”¨ç‡ã€‚ ç»éªŒå…¬å¼å¦‚ä¸‹ çº¿ç¨‹æ•° = æ ¸æ•° * æœŸæœ› CPU åˆ©ç”¨ç‡ * æ€»æ—¶é—´(CPUè®¡ç®—æ—¶é—´+ç­‰å¾…æ—¶é—´) / CPU è®¡ç®—æ—¶é—´ ä¾‹å¦‚ 4 æ ¸ CPU è®¡ç®—æ—¶é—´æ˜¯ 50% ï¼Œå…¶å®ƒç­‰å¾…æ—¶é—´æ˜¯ 50%ï¼ŒæœŸæœ› cpu è¢« 100% åˆ©ç”¨ï¼Œå¥—ç”¨å…¬å¼ 4 * 100% * 100% / 50% = 8 ä¾‹å¦‚ 4 æ ¸ CPU è®¡ç®—æ—¶é—´æ˜¯ 10% ï¼Œå…¶å®ƒç­‰å¾…æ—¶é—´æ˜¯ 90%ï¼ŒæœŸæœ› cpu è¢« 100% åˆ©ç”¨ï¼Œå¥—ç”¨å…¬å¼ 4 * 100% * 100% / 10% = 40 2.9 ä»»åŠ¡è°ƒåº¦çº¿ç¨‹æ± 2.9.1 ä½¿ç”¨æ–¹æ³•åœ¨ã€ä»»åŠ¡è°ƒåº¦çº¿ç¨‹æ± ã€åŠŸèƒ½åŠ å…¥ä¹‹å‰ï¼Œå¯ä»¥ä½¿ç”¨ java.util.Timer æ¥å®ç°å®šæ—¶åŠŸèƒ½ï¼ŒTimer çš„ä¼˜ç‚¹åœ¨äºç®€å•æ˜“ç”¨ï¼Œä½†ç”±äºæ‰€æœ‰ä»»åŠ¡éƒ½æ˜¯ç”±åŒä¸€ä¸ªçº¿ç¨‹æ¥è°ƒåº¦ï¼Œå› æ­¤æ‰€æœ‰ä»»åŠ¡éƒ½æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œï¼Œå‰ä¸€ä¸ªä»»åŠ¡çš„å»¶è¿Ÿæˆ–å¼‚å¸¸éƒ½å°†ä¼šå½±å“åˆ°ä¹‹åçš„ä»»åŠ¡ã€‚ public static void main(String[] args) { Timer timer = new Timer(); TimerTask task1 = new TimerTask() { @Override public void run() { log.debug(\"task 1\"); sleep(2); } }; TimerTask task2 = new TimerTask() { @Override public void run() { log.debug(\"task 2\"); } }; // ä½¿ç”¨ timer æ·»åŠ ä¸¤ä¸ªä»»åŠ¡ï¼Œå¸Œæœ›å®ƒä»¬éƒ½åœ¨ 1s åæ‰§è¡Œ // ä½†ç”±äº timer å†…åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ¥é¡ºåºæ‰§è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œå› æ­¤ã€ä»»åŠ¡1ã€çš„å»¶æ—¶ï¼Œå½±å“äº†ã€ä»»åŠ¡2ã€çš„æ‰§è¡Œ timer.schedule(task1, 1000); timer.schedule(task2, 1000); } ä½¿ç”¨ ScheduledExecutorService æ”¹å†™ï¼š // æ„é€ æ–¹æ³•åªæ˜¯è®¾ç½®corePoolSize ScheduledExecutorService executor = Executors.newScheduledThreadPool(2); // æ·»åŠ ä¸¤ä¸ªä»»åŠ¡ï¼Œå¸Œæœ›å®ƒä»¬éƒ½åœ¨ 1s åæ‰§è¡Œ executor.schedule(() -> { System.out.println(\"ä»»åŠ¡1ï¼Œæ‰§è¡Œæ—¶é—´ï¼š\" + new Date()); try { Thread.sleep(2000); } catch (InterruptedException e) { } }, 1000, TimeUnit.MILLISECONDS); executor.schedule(() -> { System.out.println(\"ä»»åŠ¡2ï¼Œæ‰§è¡Œæ—¶é—´ï¼š\" + new Date()); }, 1000, TimeUnit.MILLISECONDS); æ„é€ æ–¹æ³•æºç ï¼š public ScheduledThreadPoolExecutor(int corePoolSize) { super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS, new DelayedWorkQueue()); } æ–¹æ³•ï¼š /* * æ¯é—´éš”ä¸€æ®µæ—¶é—´æäº¤æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ * command å¾…æ‰§è¡Œçš„ä»»åŠ¡ * initialDelay ç¬¬ä¸€æ¬¡æ‰§è¡Œä»»åŠ¡çš„å»¶è¿Ÿ * period æ¯æ¬¡æ‰§è¡Œä»»åŠ¡ä¹‹é—´çš„å»¶è¿Ÿ * unit æ—¶é—´å•ä½ */ executor.scheduleAtFixedRate(Runnable command,long initialDelay,long period,TimeUnit unit) /* * æŒ‰ä¸€å®šé—´éš”åœ¨ä¸Šä¸€æ¬¡ä»»åŠ¡æ‰§è¡Œç»“æŸä¹‹åæäº¤æ‰§è¡Œä¸‹ä¸€æ¬¡ä»»åŠ¡ */ executor.scheduleWithFixedDelay(Runnable command,long initialDelay,long period,TimeUnit unit) 2.9.2 åº”ç”¨è®©æ¯å‘¨å›› 18:00:00 å®šæ—¶æ‰§è¡Œä»»åŠ¡ // è·å¾—å½“å‰æ—¶é—´ LocalDateTime now = LocalDateTime.now(); // è·å–æœ¬å‘¨å›› 18:00:00.000 LocalDateTime thursday = now.with(DayOfWeek.THURSDAY).withHour(18).withMinute(0).withSecond(0).withNano(0); // å¦‚æœå½“å‰æ—¶é—´å·²ç»è¶…è¿‡ æœ¬å‘¨å›› 18:00:00.000ï¼Œ é‚£ä¹ˆæ‰¾ä¸‹å‘¨å›› 18:00:00.000 if(now.compareTo(thursday) >= 0) { thursday = thursday.plusWeeks(1); } // è®¡ç®—æ—¶é—´å·®ï¼Œå³å»¶æ—¶æ‰§è¡Œæ—¶é—´ long initialDelay = Duration.between(now, thursday).toMillis(); // è®¡ç®—é—´éš”æ—¶é—´ï¼Œå³ 1 å‘¨çš„æ¯«ç§’å€¼ long oneWeek = 7 * 24 * 3600 * 1000; ScheduledExecutorService executor = Executors.newScheduledThreadPool(2); System.out.println(\"å¼€å§‹æ—¶é—´ï¼š\" + new Date()); executor.scheduleAtFixedRate(() -> { System.out.println(\"æ‰§è¡Œæ—¶é—´ï¼š\" + new Date()); }, initialDelay, oneWeek, TimeUnit.MILLISECONDS); 2.10 å¤„ç†çº¿ç¨‹ä¸­çš„å¼‚å¸¸åº”è¯¥åœ¨çº¿ç¨‹å†…éƒ¨æ•è·å¹¶å¤„ç†å¼‚å¸¸ï¼Œå¦åˆ™å…¶ä»–çº¿ç¨‹å’Œä¸»çº¿ç¨‹å®Œå…¨æ„ŸçŸ¥ä¸åˆ°æŸä¸ªçº¿ç¨‹æŠ›å‡ºçš„å¼‚å¸¸ã€‚ ä½¿ç”¨çº¿ç¨‹æ± çš„submitæ–¹æ³•æ—¶ï¼Œå¦‚æœcallableä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œè¿”å›Future.get()ä¼šå‡ºç°å¼‚å¸¸ä¿¡æ¯ã€‚ 3 fork/join3.1 æ¦‚å¿µFork/Join æ˜¯ JDK 1.7 åŠ å…¥çš„æ–°çš„çº¿ç¨‹æ± å®ç°ï¼Œå®ƒä½“ç°çš„æ˜¯ä¸€ç§åˆ†æ²»æ€æƒ³ï¼Œé€‚ç”¨äºèƒ½å¤Ÿè¿›è¡Œä»»åŠ¡æ‹†åˆ†çš„ cpu å¯†é›†å‹è¿ç®— æ‰€è°“çš„ä»»åŠ¡æ‹†åˆ†ï¼Œæ˜¯å°†ä¸€ä¸ªå¤§ä»»åŠ¡æ‹†åˆ†ä¸ºç®—æ³•ä¸Šç›¸åŒçš„å°ä»»åŠ¡ï¼Œç›´è‡³ä¸èƒ½æ‹†åˆ†å¯ä»¥ç›´æ¥æ±‚è§£ã€‚è·Ÿé€’å½’ç›¸å…³çš„ä¸€äº›è®¡ç®—ï¼Œå¦‚å½’å¹¶æ’åºã€æ–æ³¢é‚£å¥‘æ•°åˆ—ã€éƒ½å¯ä»¥ç”¨åˆ†æ²»æ€æƒ³è¿›è¡Œæ±‚è§£ Fork/Join åœ¨åˆ†æ²»çš„åŸºç¡€ä¸ŠåŠ å…¥äº†å¤šçº¿ç¨‹ï¼Œå¯ä»¥æŠŠæ¯ä¸ªä»»åŠ¡çš„åˆ†è§£å’Œåˆå¹¶äº¤ç»™ä¸åŒçš„çº¿ç¨‹æ¥å®Œæˆï¼Œè¿›ä¸€æ­¥æå‡äº†è¿ç®—æ•ˆç‡ Fork/Join é»˜è®¤ä¼šåˆ›å»ºä¸ cpu æ ¸å¿ƒæ•°å¤§å°ç›¸åŒçš„çº¿ç¨‹æ±  3.2 ä½¿ç”¨æäº¤ç»™ Fork/Join çº¿ç¨‹æ± çš„ä»»åŠ¡éœ€è¦ç»§æ‰¿ RecursiveTaskï¼ˆæœ‰è¿”å›å€¼ï¼‰æˆ– RecursiveActionï¼ˆæ²¡æœ‰è¿”å›å€¼ï¼‰ï¼Œä¾‹å¦‚ä¸‹é¢å®šä¹‰äº†ä¸€ä¸ªå¯¹ 1~n ä¹‹é—´çš„æ•´æ•°æ±‚å’Œçš„ä»»åŠ¡ class AddTask1 extends RecursiveTask&lt;Integer> { int n; public AddTask1(int n) { this.n = n; } @Override public String toString() { return \"{\" + n + '}'; } @Override protected Integer compute() { // å¦‚æœ n å·²ç»ä¸º 1ï¼Œå¯ä»¥æ±‚å¾—ç»“æœäº† if (n == 1) { log.debug(\"join() {}\", n); return n; } // å°†ä»»åŠ¡è¿›è¡Œæ‹†åˆ†(fork) AddTask1 t1 = new AddTask1(n - 1); t1.fork(); log.debug(\"fork() {} + {}\", n, t1); // åˆå¹¶(join)ç»“æœ int result = n + t1.join(); log.debug(\"join() {} + {} = {}\", n, t1, result); return result; } } ç„¶åæäº¤ç»™ ForkJoinPool æ¥æ‰§è¡Œ public static void main(String[] args) { ForkJoinPool pool = new ForkJoinPool(4); System.out.println(pool.invoke(new AddTask1(5))); }","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://www.codetool.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"leetcode682-æ£’çƒæ¯”èµ›","slug":"leetcode682-æ£’çƒæ¯”èµ›","date":"2020-02-02T18:01:47.000Z","updated":"2020-02-02T18:05:21.989Z","comments":true,"path":"article/leetcode682-æ£’çƒæ¯”èµ›/","link":"","permalink":"https://www.codetool.top/article/leetcode682-%E6%A3%92%E7%90%83%E6%AF%94%E8%B5%9B/","excerpt":"","text":"1 åŸé¢˜ä½ ç°åœ¨æ˜¯æ£’çƒæ¯”èµ›è®°å½•å‘˜ã€‚ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²å¯ä»¥æ˜¯ä»¥ä¸‹å››ç§ç±»å‹ä¹‹ä¸€ï¼š1. æ•´æ•°ï¼ˆä¸€è½®çš„å¾—åˆ†ï¼‰ï¼šç›´æ¥è¡¨ç¤ºæ‚¨åœ¨æœ¬è½®ä¸­è·å¾—çš„ç§¯åˆ†æ•°ã€‚2. &quot;+&quot;ï¼ˆä¸€è½®çš„å¾—åˆ†ï¼‰ï¼šè¡¨ç¤ºæœ¬è½®è·å¾—çš„å¾—åˆ†æ˜¯å‰ä¸¤è½®æœ‰æ•ˆ å›åˆå¾—åˆ†çš„æ€»å’Œã€‚3. &quot;D&quot;ï¼ˆä¸€è½®çš„å¾—åˆ†ï¼‰ï¼šè¡¨ç¤ºæœ¬è½®è·å¾—çš„å¾—åˆ†æ˜¯å‰ä¸€è½®æœ‰æ•ˆ å›åˆå¾—åˆ†çš„ä¸¤å€ã€‚4. &quot;C&quot;ï¼ˆä¸€ä¸ªæ“ä½œï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªå›åˆçš„åˆ†æ•°ï¼‰ï¼šè¡¨ç¤ºæ‚¨è·å¾—çš„æœ€åä¸€ä¸ªæœ‰æ•ˆ å›åˆçš„åˆ†æ•°æ˜¯æ— æ•ˆçš„ï¼Œåº”è¯¥è¢«ç§»é™¤ã€‚ æ¯ä¸€è½®çš„æ“ä½œéƒ½æ˜¯æ°¸ä¹…æ€§çš„ï¼Œå¯èƒ½ä¼šå¯¹å‰ä¸€è½®å’Œåä¸€è½®äº§ç”Ÿå½±å“ã€‚ä½ éœ€è¦è¿”å›ä½ åœ¨æ‰€æœ‰å›åˆä¸­å¾—åˆ†çš„æ€»å’Œã€‚ ç¤ºä¾‹ 1: è¾“å…¥: [â€œ5â€,â€2â€,â€Câ€,â€Dâ€,â€+â€]è¾“å‡º: 30è§£é‡Š:ç¬¬1è½®ï¼šä½ å¯ä»¥å¾—åˆ°5åˆ†ã€‚æ€»å’Œæ˜¯ï¼š5ã€‚ç¬¬2è½®ï¼šä½ å¯ä»¥å¾—åˆ°2åˆ†ã€‚æ€»å’Œæ˜¯ï¼š7ã€‚æ“ä½œ1ï¼šç¬¬2è½®çš„æ•°æ®æ— æ•ˆã€‚æ€»å’Œæ˜¯ï¼š5ã€‚ç¬¬3è½®ï¼šä½ å¯ä»¥å¾—åˆ°10åˆ†ï¼ˆç¬¬2è½®çš„æ•°æ®å·²è¢«åˆ é™¤ï¼‰ã€‚æ€»æ•°æ˜¯ï¼š15ã€‚ç¬¬4è½®ï¼šä½ å¯ä»¥å¾—åˆ°5 + 10 = 15åˆ†ã€‚æ€»æ•°æ˜¯ï¼š30ã€‚ ç¤ºä¾‹ 2: è¾“å…¥: [â€œ5â€,â€-2â€,â€4â€,â€Câ€,â€Dâ€,â€9â€,â€+â€,â€+â€]è¾“å‡º: 27è§£é‡Š:ç¬¬1è½®ï¼šä½ å¯ä»¥å¾—åˆ°5åˆ†ã€‚æ€»å’Œæ˜¯ï¼š5ã€‚ç¬¬2è½®ï¼šä½ å¯ä»¥å¾—åˆ°-2åˆ†ã€‚æ€»æ•°æ˜¯ï¼š3ã€‚ç¬¬3è½®ï¼šä½ å¯ä»¥å¾—åˆ°4åˆ†ã€‚æ€»å’Œæ˜¯ï¼š7ã€‚æ“ä½œ1ï¼šç¬¬3è½®çš„æ•°æ®æ— æ•ˆã€‚æ€»æ•°æ˜¯ï¼š3ã€‚ç¬¬4è½®ï¼šä½ å¯ä»¥å¾—åˆ°-4åˆ†ï¼ˆç¬¬ä¸‰è½®çš„æ•°æ®å·²è¢«åˆ é™¤ï¼‰ã€‚æ€»å’Œæ˜¯ï¼š-1ã€‚ç¬¬5è½®ï¼šä½ å¯ä»¥å¾—åˆ°9åˆ†ã€‚æ€»æ•°æ˜¯ï¼š8ã€‚ç¬¬6è½®ï¼šä½ å¯ä»¥å¾—åˆ°-4 + 9 = 5åˆ†ã€‚æ€»æ•°æ˜¯13ã€‚ç¬¬7è½®ï¼šä½ å¯ä»¥å¾—åˆ°9 + 5 = 14åˆ†ã€‚æ€»æ•°æ˜¯27ã€‚ æ³¨æ„ï¼š è¾“å…¥åˆ—è¡¨çš„å¤§å°å°†ä»‹äº1å’Œ1000ä¹‹é—´ã€‚ åˆ—è¡¨ä¸­çš„æ¯ä¸ªæ•´æ•°éƒ½å°†ä»‹äº-30000å’Œ30000ä¹‹é—´ã€‚ 2 è§£æ³•2.1 æ€æƒ³æ¯æ¬¡æ ¹æ®å¯¹åº”å­—ç¬¦ä¸²çš„ç±»å‹è¿›è¡Œä¸åŒçš„å¤„ç†ã€‚ 2.2 ä»£ç class Solution { public int calPoints(String[] ops) { List&lt;Integer> list = new ArrayList&lt;>(); int cur = 0; for(String i:ops){ if(i.equals(\"+\")){ list.add(list.get(cur-1)+list.get(cur-2)); cur++; } else if(i.equals(\"D\")){ list.add(list.get(cur-1)*2); cur++; } else if(i.equals(\"C\")){ list.remove(list.size()-1); cur--; } else { list.add(Integer.valueOf(i)); cur++; } } int ans = 0; for(Integer i:list){ ans+=i; } return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"CASåº”ç”¨ä¹‹JUCä¸‹çš„åŸå­ç±»","slug":"CASåº”ç”¨ä¹‹JUCä¸‹çš„åŸå­ç±»","date":"2020-02-02T09:47:58.000Z","updated":"2020-02-02T09:48:44.905Z","comments":true,"path":"article/CASåº”ç”¨ä¹‹JUCä¸‹çš„åŸå­ç±»/","link":"","permalink":"https://www.codetool.top/article/CAS%E5%BA%94%E7%94%A8%E4%B9%8BJUC%E4%B8%8B%E7%9A%84%E5%8E%9F%E5%AD%90%E7%B1%BB/","excerpt":"","text":"1 åŸå­æ•´æ•°AtomicInteger i = new AtomicInteger(0); // è·å–å¹¶è‡ªå¢ï¼ˆi = 0, ç»“æœ i = 1, è¿”å› 0ï¼‰ï¼Œç±»ä¼¼äº i++ System.out.println(i.getAndIncrement()); // è‡ªå¢å¹¶è·å–ï¼ˆi = 1, ç»“æœ i = 2, è¿”å› 2ï¼‰ï¼Œç±»ä¼¼äº ++i System.out.println(i.incrementAndGet()); // è‡ªå‡å¹¶è·å–ï¼ˆi = 2, ç»“æœ i = 1, è¿”å› 1ï¼‰ï¼Œç±»ä¼¼äº --i System.out.println(i.decrementAndGet()); // è·å–å¹¶è‡ªå‡ï¼ˆi = 1, ç»“æœ i = 0, è¿”å› 1ï¼‰ï¼Œç±»ä¼¼äº i-- System.out.println(i.getAndDecrement()); // è·å–å¹¶åŠ å€¼ï¼ˆi = 0, ç»“æœ i = 5, è¿”å› 0ï¼‰ System.out.println(i.getAndAdd(5)); // åŠ å€¼å¹¶è·å–ï¼ˆi = 5, ç»“æœ i = 0, è¿”å› 0ï¼‰ System.out.println(i.addAndGet(-5)); // è·å–å¹¶æ›´æ–°ï¼ˆi = 0, p ä¸º i çš„å½“å‰å€¼, ç»“æœ i = -2, è¿”å› 0ï¼‰ // å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨ System.out.println(i.getAndUpdate(p -> p - 2)); // æ›´æ–°å¹¶è·å–ï¼ˆi = -2, p ä¸º i çš„å½“å‰å€¼, ç»“æœ i = 0, è¿”å› 0ï¼‰ // å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨ System.out.println(i.updateAndGet(p -> p + 2)); // è·å–å¹¶è®¡ç®—ï¼ˆi = 0, p ä¸º i çš„å½“å‰å€¼, x ä¸ºå‚æ•°1, ç»“æœ i = 10, è¿”å› 0ï¼‰ // å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨ // getAndUpdate å¦‚æœåœ¨ lambda ä¸­å¼•ç”¨äº†å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œè¦ä¿è¯è¯¥å±€éƒ¨å˜é‡æ˜¯ final çš„ // getAndAccumulate å¯ä»¥é€šè¿‡ å‚æ•°1 æ¥å¼•ç”¨å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œä½†å› ä¸ºå…¶ä¸åœ¨ lambda ä¸­å› æ­¤ä¸å¿…æ˜¯ final System.out.println(i.getAndAccumulate(10, (p, x) -> p + x)); // è®¡ç®—å¹¶è·å–ï¼ˆi = 10, p ä¸º i çš„å½“å‰å€¼, x ä¸ºå‚æ•°1, ç»“æœ i = 0, è¿”å› 0ï¼‰ // å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨ System.out.println(i.accumulateAndGet(-10, (p, x) -> p + x)); 2 åŸå­å¼•ç”¨AtomicReference class DecimalAccountSafeCas implements DecimalAccount { AtomicReference&lt;BigDecimal> ref; public DecimalAccountSafeCas(BigDecimal balance) { ref = new AtomicReference&lt;>(balance); } public BigDecimal getBalance() { return ref.get(); } @Override public void withdraw(BigDecimal amount) { while (true) { BigDecimal prev = ref.get(); BigDecimal next = prev.subtract(amount); if (ref.compareAndSet(prev, next)) { break; } } } } 3 è§£å†³ABAé—®é¢˜3.1 AtomicStampedReferenceAtomicStampedReferenceé™„å¸¦ä¸€ä¸ªStampä¿¡æ¯ï¼ˆç‰ˆæœ¬å·ï¼‰ static AtomicStampedReference&lt;String> ref = new AtomicStampedReference&lt;>(\"A\", 0); public static void main(String[] args) throws InterruptedException { log.debug(\"main start...\"); // è·å–å€¼ A String prev = ref.getReference(); // è·å–ç‰ˆæœ¬å· int stamp = ref.getStamp(); log.debug(\"ç‰ˆæœ¬ {}\", stamp); // å¦‚æœä¸­é—´æœ‰å…¶å®ƒçº¿ç¨‹å¹²æ‰°ï¼Œå‘ç”Ÿäº† ABA ç°è±¡ other(); sleep(1); // å°è¯•æ”¹ä¸º C log.debug(\"change A->C {}\", ref.compareAndSet(prev, \"C\", stamp, stamp + 1)); } private static void other() { new Thread(() -> { log.debug(\"change A->B {}\", ref.compareAndSet(ref.getReference(), \"B\", ref.getStamp(), ref.getStamp() + 1)); log.debug(\"æ›´æ–°ç‰ˆæœ¬ä¸º {}\", ref.getStamp()); }, \"t1\").start(); sleep(0.5); new Thread(() -> { log.debug(\"change B->A {}\", ref.compareAndSet(ref.getReference(), \"A\", ref.getStamp(), ref.getStamp() + 1)); log.debug(\"æ›´æ–°ç‰ˆæœ¬ä¸º {}\", ref.getStamp()); }, \"t2\").start(); } 3.2 AtomicMarkableReferenceAtomicStampedReferenceå¯ä»¥çŸ¥é“å˜é‡è¢«æ›´æ–°äº†å‡ æ¬¡ï¼Œä½†æ˜¯æœ‰æ—¶å€™ï¼Œå¹¶ä¸å…³å¿ƒå¼•ç”¨å˜é‡æ›´æ”¹äº†å‡ æ¬¡ï¼Œåªæ˜¯å•çº¯çš„å…³å¿ƒæ˜¯å¦æ›´æ”¹è¿‡ï¼Œæ‰€ä»¥å°±æœ‰äº†AtomicMarkableReference class GarbageBag { String desc; public GarbageBag(String desc) { this.desc = desc; } public void setDesc(String desc) { this.desc = desc; } @Override public String toString() { return super.toString() + \" \" + desc; } } public class TestABAAtomicMarkableReference { public static void main(String[] args) throws InterruptedException { GarbageBag bag = new GarbageBag(\"è£…æ»¡äº†åƒåœ¾\"); // å‚æ•°2 mark å¯ä»¥çœ‹ä½œä¸€ä¸ªæ ‡è®°ï¼Œè¡¨ç¤ºåƒåœ¾è¢‹æ»¡äº† AtomicMarkableReference&lt;GarbageBag> ref = new AtomicMarkableReference&lt;>(bag, true); log.debug(\"ä¸»çº¿ç¨‹ start...\"); GarbageBag prev = ref.getReference(); log.debug(prev.toString()); new Thread(() -> { log.debug(\"æ‰“æ‰«å«ç”Ÿçš„çº¿ç¨‹ start...\"); bag.setDesc(\"ç©ºåƒåœ¾è¢‹\"); while (!ref.compareAndSet(bag, bag, true, false)) {} log.debug(bag.toString()); }).start(); Thread.sleep(1000); log.debug(\"ä¸»çº¿ç¨‹æƒ³æ¢ä¸€åªæ–°åƒåœ¾è¢‹ï¼Ÿ\"); boolean success = ref.compareAndSet(prev, new GarbageBag(\"ç©ºåƒåœ¾è¢‹\"), true, false); log.debug(\"æ¢äº†ä¹ˆï¼Ÿ\" + success); log.debug(ref.getReference().toString()); } } 4 åŸå­æ•°ç»„//è·å¾—æ•°ç»„ç¬¬iä¸ªä¸‹æ ‡çš„å…ƒç´  public final int get(int i); //è·å¾—æ•°ç»„çš„é•¿åº¦ public final int length(); //å°†æ•°ç»„ç¬¬iä¸ªä¸‹æ ‡è®¾ç½®ä¸ºnewValueï¼Œå¹¶è¿”å›æ—§çš„å€¼ public final int getAndSet(int i, int newValue); //è¿›è¡ŒCASæ“ä½œï¼Œå¦‚æœç¬¬iä¸ªä¸‹æ ‡çš„å…ƒç´ ç­‰äºexpectï¼Œåˆ™è®¾ç½®ä¸ºupdateï¼Œè®¾ç½®æˆåŠŸè¿”å›true public final boolean compareAndSet(int i, int expect, intupdate); //å°†ç¬¬iä¸ªä¸‹æ ‡çš„å…ƒç´ åŠ 1 public final int getAndIncrement(int i); //å°†ç¬¬iä¸ªä¸‹æ ‡çš„å…ƒç´ å‡1 public final int getAndDecrement(int i); //å°†ç¬¬iä¸ªä¸‹æ ‡çš„å…ƒç´ å¢åŠ deltaï¼ˆdeltaå¯ä»¥æ˜¯è´Ÿæ•°ï¼‰ public final int getAndAdd(int i, int delta); 5 å­—æ®µæ›´æ–°å™¨package automic; import java.util.concurrent.atomic.AtomicIntegerFieldUpdater; /** * åŸå­æ•´å‹å­—æ®µæ›´æ–°æ“ä½œ * @author gosaint * */ public class AtomicIntegerFieldUpdaterTest { private static Class&lt;Person> cls; /** * AtomicIntegerFieldUpdaterè¯´æ˜ * åŸºäºåå°„çš„å®ç”¨å·¥å…·ï¼Œå¯ä»¥å¯¹æŒ‡å®šç±»çš„æŒ‡å®š volatile int å­—æ®µè¿›è¡ŒåŸå­æ›´æ–°ã€‚æ­¤ç±»ç”¨äºåŸå­æ•°æ®ç»“æ„ï¼Œ * è¯¥ç»“æ„ä¸­åŒä¸€èŠ‚ç‚¹çš„å‡ ä¸ªå­—æ®µéƒ½ç‹¬ç«‹å—åŸå­æ›´æ–°æ§åˆ¶ã€‚ * æ³¨æ„ï¼Œæ­¤ç±»ä¸­ compareAndSet æ–¹æ³•çš„ä¿è¯å¼±äºå…¶ä»–åŸå­ç±»ä¸­è¯¥æ–¹æ³•çš„ä¿è¯ã€‚ * å› ä¸ºæ­¤ç±»ä¸èƒ½ç¡®ä¿æ‰€æœ‰ä½¿ç”¨çš„å­—æ®µéƒ½é€‚åˆäºåŸå­è®¿é—®ç›®çš„ï¼Œæ‰€ä»¥å¯¹äºç›¸åŒæ›´æ–°å™¨ä¸Šçš„ compareAndSet å’Œ set çš„å…¶ä»–è°ƒç”¨ï¼Œ * å®ƒä»…å¯ä»¥ä¿è¯åŸå­æ€§å’Œå¯å˜è¯­ä¹‰ã€‚ * @param args */ public static void main(String[] args) { // æ–°å»ºAtomicLongFieldUpdaterå¯¹è±¡ï¼Œä¼ é€’å‚æ•°æ˜¯â€œclasså¯¹è±¡â€å’Œâ€œlongç±»å‹åœ¨ç±»ä¸­å¯¹åº”çš„åç§°â€ AtomicIntegerFieldUpdater&lt;Person> mAtoLong = AtomicIntegerFieldUpdater.newUpdater(Person.class, \"id\"); Person person = new Person(12345); mAtoLong.compareAndSet(person, 12345, 1000); System.out.println(\"id=\"+person.getId()); } } class Person { volatile int id; public Person(int id) { this.id = id; } public void setId(int id) { this.id = id; } public int getId() { return id; } } 6 åŸå­ç´¯åŠ å™¨å‚è€ƒ https://www.jianshu.com/p/b3c5b05055de 7 Unsafeç±»Unsafe å¯¹è±¡æä¾›äº†éå¸¸åº•å±‚çš„ï¼Œæ“ä½œå†…å­˜ã€çº¿ç¨‹çš„æ–¹æ³•ï¼ŒUnsafe å¯¹è±¡ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œåªèƒ½é€šè¿‡åå°„è·å¾— public class UnsafeAccessor { static Unsafe unsafe; static { try { Field theUnsafe = Unsafe.class.getDeclaredField(\"theUnsafe\"); theUnsafe.setAccessible(true); unsafe = (Unsafe) theUnsafe.get(null); } catch (NoSuchFieldException | IllegalAccessException e) { throw new Error(e); } } static Unsafe getUnsafe() { return unsafe; } } Unsafeçš„compareAndSwap***æ–¹æ³•æä¾›äº†casæ“ä½œ","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://www.codetool.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"leetcode636-å‡½æ•°çš„ç‹¬å æ—¶é—´","slug":"leetcode636-å‡½æ•°çš„ç‹¬å æ—¶é—´","date":"2020-02-01T19:15:08.000Z","updated":"2020-02-20T14:55:21.051Z","comments":true,"path":"article/leetcode636-å‡½æ•°çš„ç‹¬å æ—¶é—´/","link":"","permalink":"https://www.codetool.top/article/leetcode636-%E5%87%BD%E6%95%B0%E7%9A%84%E7%8B%AC%E5%8D%A0%E6%97%B6%E9%97%B4/","excerpt":"","text":"1 åŸé¢˜ç»™å‡ºä¸€ä¸ªéæŠ¢å å•çº¿ç¨‹CPUçš„ n ä¸ªå‡½æ•°è¿è¡Œæ—¥å¿—ï¼Œæ‰¾åˆ°å‡½æ•°çš„ç‹¬å æ—¶é—´ã€‚ æ¯ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ Idï¼Œä» 0 åˆ° n-1ï¼Œå‡½æ•°å¯èƒ½ä¼šé€’å½’è°ƒç”¨æˆ–è€…è¢«å…¶ä»–å‡½æ•°è°ƒç”¨ã€‚ æ—¥å¿—æ˜¯å…·æœ‰ä»¥ä¸‹æ ¼å¼çš„å­—ç¬¦ä¸²ï¼šfunction_idï¼šstart_or_endï¼štimestampã€‚ä¾‹å¦‚ï¼š&quot;0:start:0&quot; è¡¨ç¤ºå‡½æ•° 0 ä» 0 æ—¶åˆ»å¼€å§‹è¿è¡Œã€‚&quot;0:end:0&quot; è¡¨ç¤ºå‡½æ•° 0 åœ¨ 0 æ—¶åˆ»ç»“æŸã€‚ å‡½æ•°çš„ç‹¬å æ—¶é—´å®šä¹‰æ˜¯åœ¨è¯¥æ–¹æ³•ä¸­èŠ±è´¹çš„æ—¶é—´ï¼Œè°ƒç”¨å…¶ä»–å‡½æ•°èŠ±è´¹çš„æ—¶é—´ä¸ç®—è¯¥å‡½æ•°çš„ç‹¬å æ—¶é—´ã€‚ä½ éœ€è¦æ ¹æ®å‡½æ•°çš„ Id æœ‰åºåœ°è¿”å›æ¯ä¸ªå‡½æ•°çš„ç‹¬å æ—¶é—´ã€‚ ç¤ºä¾‹ 1: è¾“å…¥:n = 2logs =[â€œ0:start:0â€, â€œ1:start:2â€, â€œ1:end:5â€, â€œ0:end:6â€]è¾“å‡º:[3, 4]è¯´æ˜ï¼šå‡½æ•° 0 åœ¨æ—¶åˆ» 0 å¼€å§‹ï¼Œåœ¨æ‰§è¡Œäº† 2ä¸ªæ—¶é—´å•ä½ç»“æŸäºæ—¶åˆ» 1ã€‚ç°åœ¨å‡½æ•° 0 è°ƒç”¨å‡½æ•° 1ï¼Œå‡½æ•° 1 åœ¨æ—¶åˆ» 2 å¼€å§‹ï¼Œæ‰§è¡Œ 4 ä¸ªæ—¶é—´å•ä½åç»“æŸäºæ—¶åˆ» 5ã€‚å‡½æ•° 0 å†æ¬¡åœ¨æ—¶åˆ» 6 å¼€å§‹æ‰§è¡Œï¼Œå¹¶åœ¨æ—¶åˆ» 6 ç»“æŸè¿è¡Œï¼Œä»è€Œæ‰§è¡Œäº† 1 ä¸ªæ—¶é—´å•ä½ã€‚æ‰€ä»¥å‡½æ•° 0 æ€»å…±çš„æ‰§è¡Œäº† 2 +1 =3 ä¸ªæ—¶é—´å•ä½ï¼Œå‡½æ•° 1 æ€»å…±æ‰§è¡Œäº† 4 ä¸ªæ—¶é—´å•ä½ã€‚ è¯´æ˜ï¼š è¾“å…¥çš„æ—¥å¿—ä¼šæ ¹æ®æ—¶é—´æˆ³æ’åºï¼Œè€Œä¸æ˜¯æ ¹æ®æ—¥å¿—Idæ’åºã€‚ ä½ çš„è¾“å‡ºä¼šæ ¹æ®å‡½æ•°Idæ’åºï¼Œä¹Ÿå°±æ„å‘³ç€ä½ çš„è¾“å‡ºæ•°ç»„ä¸­åºå·ä¸º 0 çš„å…ƒç´ ç›¸å½“äºå‡½æ•° 0 çš„æ‰§è¡Œæ—¶é—´ã€‚ ä¸¤ä¸ªå‡½æ•°ä¸ä¼šåœ¨åŒæ—¶å¼€å§‹æˆ–ç»“æŸã€‚ å‡½æ•°å…è®¸è¢«é€’å½’è°ƒç”¨ï¼Œç›´åˆ°è¿è¡Œç»“æŸã€‚ 1 &lt;= n &lt;= 100 2 è§£æ³•2.1 æ€æƒ³å‡½æ•°çš„è°ƒç”¨å¤©ç”Ÿç¬¦åˆæ ˆçš„æ€æƒ³ 2.2 ä»£ç æˆ‘ä¸€å¼€å§‹ä½¿ç”¨äº†è¾…åŠ©ç±»è®°å½•è¶³å¤Ÿçš„ä¿¡æ¯ã€‚ class FunctionTime{ String function_id; String timestamp; FunctionTime(String function_id,String timestamp){ this.function_id = function_id; this.timestamp = timestamp; } } class Solution { public int[] exclusiveTime(int n, List&lt;String> logs) { int[] ans = new int[n]; Stack&lt;FunctionTime> stack = new Stack&lt;>(); for(String i:logs){ String[] info = i.split(\":\"); if(!stack.isEmpty()&amp;&amp;info[1].equals(\"end\")){ FunctionTime func = stack.pop(); ans[Integer.valueOf(func.function_id)]+=(Integer.valueOf(info[2])-Integer.valueOf(func.timestamp)+1); //æ–°æ–¹æ³•ç»“æŸæ—¶æŠŠåŸæ–¹æ³•å¼€å§‹çš„æ—¶é—´è®¾ä¸ºå½“å‰æ—¶é—´+1ã€‚ if(!stack.isEmpty()) stack.peek().timestamp = String.valueOf(Integer.valueOf(info[2])+1); }else{ if(!stack.isEmpty()) { //æ–°æ–¹æ³•å¼€å§‹æ—¶ç»™ä¸Šä¸€ä¸ªæ–¹æ³•åŠ ä¸Šæ—¶é—´ã€‚ FunctionTime peek = stack.peek(); ans[Integer.valueOf(peek.function_id)]+=(Integer.valueOf(info[2])-Integer.valueOf(peek.timestamp)); } FunctionTime func = new FunctionTime(info[0],info[2]); stack.push(func); } } return ans; } } ç„¶åå‘ç°å¯ä»¥ç®€åŒ–ã€‚ class Solution { public int[] exclusiveTime(int n, List&lt;String> logs) { int[] ans = new int[n]; Stack&lt;Integer> stack = new Stack(); int curTime = 0; for(String i:logs){ String[] info = i.split(\":\"); int id = Integer.valueOf(info[0]); int timestamp = Integer.valueOf(info[2]); if(info[1].equals(\"start\")){ if(!stack.isEmpty()){ ans[stack.peek()] += timestamp - curTime; } stack.push(id); curTime = timestamp; }else{ timestamp++; ans[stack.pop()] += timestamp - curTime; } curTime = timestamp; } return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"Javaå¤šçº¿ç¨‹å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹","slug":"Javaå¤šçº¿ç¨‹å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹","date":"2020-02-01T18:16:59.000Z","updated":"2020-02-01T18:26:04.552Z","comments":true,"path":"article/Javaå¤šçº¿ç¨‹å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹/","link":"","permalink":"https://www.codetool.top/article/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%85%B1%E4%BA%AB%E6%A8%A1%E5%9E%8B%E4%B9%8B%E7%AE%A1%E7%A8%8B/","excerpt":"","text":"1 Monitorï¼ˆé”ï¼‰Monitorè¢«ç¿»è¯‘ä¸ºç›‘è§†å™¨æˆ–ç®¡ç¨‹ã€‚ Monitoræ˜¯é‡é‡çº§é”çš„å®ç°ï¼Œæ˜¯å‘æ“ä½œç³»ç»Ÿç”³è¯·çš„ã€‚ Monitorçš„ç»“æ„ï¼šWaitSetã€EntryListã€Owner è¿è¡ŒçŠ¶æ€:OwneræŒ‡å‘å½“å‰çº¿ç¨‹ å µå¡çŠ¶æ€ï¼šè¿›å…¥EntryListï¼Œç§°ä¸ºBLOCKEDçŠ¶æ€ã€‚å½“Ownerè§£é™¤å ç”¨ä¹‹åï¼Œé€šçŸ¥EntryListä¸­çš„çº¿ç¨‹å¯ä»¥ç«äº‰é”ã€‚ 2 é”ä¼˜åŒ–2.1 è½»é‡çº§é”è§æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°13 2.2 é”è†¨èƒ€å¦‚æœåœ¨å°è¯•åŠ è½»é‡çº§é”çš„è¿‡ç¨‹ä¸­ï¼ŒCAS æ“ä½œæ— æ³•æˆåŠŸï¼Œè¿™æ—¶ä¸€ç§æƒ…å†µå°±æ˜¯æœ‰å…¶å®ƒçº¿ç¨‹ä¸ºæ­¤å¯¹è±¡åŠ ä¸Šäº†è½»é‡çº§é”ï¼ˆæœ‰ç«äº‰ï¼‰ï¼Œè¿™æ—¶éœ€è¦è¿›è¡Œé”è†¨èƒ€ï¼Œå°†è½»é‡çº§é”å˜ä¸ºé‡é‡çº§é”ã€‚ 2.3 è‡ªæ—‹ä¼˜åŒ–é‡é‡çº§é”ç«äº‰çš„æ—¶å€™ï¼Œè¿˜å¯ä»¥ä½¿ç”¨è‡ªæ—‹æ¥è¿›è¡Œä¼˜åŒ–ï¼Œå¦‚æœå½“å‰çº¿ç¨‹è‡ªæ—‹æˆåŠŸï¼ˆå³è¿™æ—¶å€™æŒé”çº¿ç¨‹å·²ç»é€€å‡ºäº†åŒæ­¥å—ï¼Œé‡Šæ”¾äº†é”ï¼‰ï¼Œè¿™æ—¶å½“å‰çº¿ç¨‹å°±å¯ä»¥é¿å…é˜»å¡ã€‚ è‡ªæ—‹ä¼šå ç”¨ CPU æ—¶é—´ï¼Œå•æ ¸ CPU è‡ªæ—‹å°±æ˜¯æµªè´¹ï¼Œå¤šæ ¸ CPU è‡ªæ—‹æ‰èƒ½å‘æŒ¥ä¼˜åŠ¿ã€‚ åœ¨ Java 6 ä¹‹åè‡ªæ—‹é”æ˜¯è‡ªé€‚åº”çš„ï¼Œæ¯”å¦‚å¯¹è±¡åˆšåˆšçš„ä¸€æ¬¡è‡ªæ—‹æ“ä½œæˆåŠŸè¿‡ï¼Œé‚£ä¹ˆè®¤ä¸ºè¿™æ¬¡è‡ªæ—‹æˆåŠŸçš„å¯èƒ½æ€§ä¼šé«˜ï¼Œå°±å¤šè‡ªæ—‹å‡ æ¬¡ï¼›åä¹‹ï¼Œå°±å°‘è‡ªæ—‹ç”šè‡³ä¸è‡ªæ—‹ï¼Œæ€»ä¹‹ï¼Œæ¯”è¾ƒæ™ºèƒ½ã€‚ Java 7 ä¹‹åä¸èƒ½æ§åˆ¶æ˜¯å¦å¼€å¯è‡ªæ—‹åŠŸèƒ½ 2.4 åå‘é”å‚è€ƒæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°13 ä¸€ä¸ªå¯¹è±¡åˆ›å»ºæ—¶ï¼š å¦‚æœå¼€å¯äº†åå‘é”ï¼ˆé»˜è®¤å¼€å¯ï¼‰ï¼Œé‚£ä¹ˆå¯¹è±¡åˆ›å»ºåï¼Œmarkword å€¼ä¸º 0x05 å³æœ€å 3 ä½ä¸º 101ï¼Œè¿™æ—¶å®ƒçš„threadã€epochã€age éƒ½ä¸º 0(ä»£è¡¨å®ƒæ˜¯å¯åå‘çš„ï¼Œä¸€æ—¦è·å–äº†å®ƒçš„å“ˆå¸Œç å°±ä¸å¯åå‘äº†) åå‘é”æ˜¯é»˜è®¤æ˜¯å»¶è¿Ÿçš„ï¼Œä¸ä¼šåœ¨ç¨‹åºå¯åŠ¨æ—¶ç«‹å³ç”Ÿæ•ˆï¼Œå¦‚æœæƒ³é¿å…å»¶è¿Ÿï¼Œå¯ä»¥åŠ  VM å‚æ•° -XX:BiasedLockingStartupDelay=0 æ¥ç¦ç”¨å»¶è¿Ÿ å¦‚æœæ²¡æœ‰å¼€å¯åå‘é”ï¼Œé‚£ä¹ˆå¯¹è±¡åˆ›å»ºåï¼Œmarkword å€¼ä¸º 0x01 å³æœ€å 3 ä½ä¸º 001ï¼Œè¿™æ—¶å®ƒçš„ hashcodeã€age éƒ½ä¸º 0ï¼Œç¬¬ä¸€æ¬¡ç”¨åˆ° hashcode æ—¶æ‰ä¼šèµ‹å€¼ è°ƒç”¨ wait/notifyä¹Ÿä¼šæ’¤é”€åå‘é”ï¼š public static void main(String[] args) throws InterruptedException { Dog d = new Dog(); Thread t1 = new Thread(() -> { log.debug(ClassLayout.parseInstance(d).toPrintableSimple(true)); synchronized (d) { log.debug(ClassLayout.parseInstance(d).toPrintableSimple(true)); try { d.wait(); } catch (InterruptedException e) { e.printStackTrace(); } log.debug(ClassLayout.parseInstance(d).toPrintableSimple(true)); } }, \"t1\"); t1.start(); new Thread(() -> { try { Thread.sleep(6000); } catch (InterruptedException e) { e.printStackTrace(); } synchronized (d) { log.debug(\"notify\"); d.notify(); } }, \"t2\").start(); } 2.4.1 æ‰¹é‡é‡åå‘å½“ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºäº†å¤§é‡å¯¹è±¡å¹¶æ‰§è¡Œäº†åˆå§‹çš„åŒæ­¥æ“ä½œï¼Œåæ¥å¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿæ¥å°†è¿™äº›å¯¹è±¡ä½œä¸ºé”å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œä¼šå¯¼åå‘é”é‡åå‘çš„æ“ä½œã€‚ å¦‚æœå¯¹è±¡è™½ç„¶è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œä½†æ²¡æœ‰ç«äº‰ï¼Œè¿™æ—¶åå‘äº†çº¿ç¨‹ T1 çš„å¯¹è±¡ä»æœ‰æœºä¼šé‡æ–°åå‘ T2ï¼Œé‡åå‘ä¼šé‡ç½®å¯¹è±¡çš„ Thread ID. é»˜è®¤åå‘é”æ‰¹é‡é‡åå‘é˜ˆå€¼ä¸º20ã€‚ ï¼ˆå‰20ä¸ªå¯¹è±¡ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œåé¢20-40åˆ™é‡åå‘ï¼‰ 2.4.2 æ‰¹é‡æ’¤é”€åœ¨å¤šçº¿ç¨‹ç«äº‰å‰§çƒˆçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨åå‘é”å°†ä¼šé™ä½æ•ˆç‡ï¼Œäºæ˜¯ä¹äº§ç”Ÿäº†æ‰¹é‡æ’¤é”€æœºåˆ¶ã€‚ é»˜è®¤åå‘é”æ‰¹é‡æ’¤é”€é˜ˆå€¼ä¸º40ï¼Œå¦‚æœæ’¤é”€åå‘é”æ¬¡æ•°è¶…è¿‡40ï¼Œä¸ä¼šå†é‡åå‘ï¼Œå…¨éƒ¨æ”¹ä¸ºä¸å¯åå‘çš„ï¼Œæ–°å»ºçš„å¯¹è±¡ä¹Ÿæ”¹ä¸ºä¸å¯åå‘çš„ã€‚ 2.5 é”æ¶ˆé™¤å‚è€ƒæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°13 å…³é—­é”æ¶ˆé™¤ä¼˜åŒ–ï¼š-XX:-EliminateLocks 3 wait notify 3.1 åŸç† Owner çº¿ç¨‹å‘ç°æ¡ä»¶ä¸æ»¡è¶³ï¼Œè°ƒç”¨ wait æ–¹æ³•ï¼Œå³å¯è¿›å…¥ WaitSet å˜ä¸º WAITING çŠ¶æ€ BLOCKED å’Œ WAITING çš„çº¿ç¨‹éƒ½å¤„äºé˜»å¡çŠ¶æ€ï¼Œä¸å ç”¨ CPU æ—¶é—´ç‰‡ BLOCKED çº¿ç¨‹ä¼šåœ¨ Owner çº¿ç¨‹é‡Šæ”¾é”æ—¶å”¤é†’ WAITING çº¿ç¨‹ä¼šåœ¨ Owner çº¿ç¨‹è°ƒç”¨ notify æˆ– notifyAll æ—¶å”¤é†’ï¼Œä½†å”¤é†’åå¹¶ä¸æ„å‘³è€…ç«‹åˆ»è·å¾—é”ï¼Œä»éœ€è¿›å…¥ EntryList é‡æ–°ç«äº‰ 3.2 API obj.wait() è®©è¿›å…¥ object ç›‘è§†å™¨çš„çº¿ç¨‹åˆ° waitSet ç­‰å¾… obj.wait(long millis) ç­‰å¾…é™åˆ¶çš„æ—¶é—´ï¼Œè¶…å‡ºæ—¶é—´è¿›å…¥å°±ç»ªçŠ¶æ€ obj.notify() åœ¨ object ä¸Šæ­£åœ¨ waitSet ç­‰å¾…çš„çº¿ç¨‹ä¸­éšæœºæŒ‘ä¸€ä¸ªå”¤é†’ obj.notifyAll() è®© object ä¸Šæ­£åœ¨ waitSet ç­‰å¾…çš„çº¿ç¨‹å…¨éƒ¨å”¤é†’ å®ƒä»¬éƒ½æ˜¯çº¿ç¨‹ä¹‹é—´è¿›è¡Œåä½œçš„æ‰‹æ®µï¼Œéƒ½å±äº Object å¯¹è±¡çš„æ–¹æ³•ã€‚å¿…é¡»è·å¾—æ­¤å¯¹è±¡çš„é”ï¼Œæ‰èƒ½è°ƒç”¨è¿™å‡ ä¸ªæ–¹æ³• synchronized(lock) { while(æ¡ä»¶ä¸æˆç«‹) { lock.wait(); } // å¹²æ´» } //å¦ä¸€ä¸ªçº¿ç¨‹ synchronized(lock) { lock.notifyAll(); } 3.3 sleep(long n) å’Œ wait(long n) çš„åŒºåˆ« sleep æ˜¯ Thread æ–¹æ³•ï¼Œè€Œ wait æ˜¯ Object çš„æ–¹æ³• sleep ä¸éœ€è¦å¼ºåˆ¶å’Œ synchronized é…åˆä½¿ç”¨ï¼Œä½† wait éœ€è¦å’Œ synchronized ä¸€èµ·ç”¨ sleep åœ¨ç¡çœ çš„åŒæ—¶ï¼Œä¸ä¼šé‡Šæ”¾å¯¹è±¡é”çš„ï¼Œä½† wait åœ¨ç­‰å¾…çš„æ—¶å€™ä¼šé‡Šæ”¾å¯¹è±¡é” 4 åŒæ­¥æ¨¡å¼ä¹‹ä¿æŠ¤æ€§æš‚åœå³ Guarded Suspensionï¼Œç”¨åœ¨ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œç»“æœ 4.1 è¦ç‚¹ï¼š æœ‰ä¸€ä¸ªç»“æœéœ€è¦ä»ä¸€ä¸ªçº¿ç¨‹ä¼ é€’åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œè®©ä»–ä»¬å…³è”åŒä¸€ä¸ª GuardedObject å¦‚æœæœ‰ç»“æœä¸æ–­ä»ä¸€ä¸ªçº¿ç¨‹åˆ°å¦ä¸€ä¸ªçº¿ç¨‹é‚£ä¹ˆå¯ä»¥ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ— JDK ä¸­ï¼Œjoin çš„å®ç°ã€Future çš„å®ç°ï¼Œé‡‡ç”¨çš„å°±æ˜¯æ­¤æ¨¡å¼ å› ä¸ºè¦ç­‰å¾…å¦ä¸€æ–¹çš„ç»“æœï¼Œå› æ­¤å½’ç±»åˆ°åŒæ­¥æ¨¡å¼ 4.2 å®ç°ï¼šclass GuardedObject { private Object response; private final Object lock = new Object(); public Object get() { synchronized (lock) { // æ¡ä»¶ä¸æ»¡è¶³åˆ™ç­‰å¾… while (response == null) { try { lock.wait(); } catch (InterruptedException e) { e.printStackTrace(); } } return response; } } public void complete(Object response) { synchronized (lock) { // æ¡ä»¶æ»¡è¶³ï¼Œé€šçŸ¥ç­‰å¾…çº¿ç¨‹ this.response = response; lock.notifyAll(); } } } å¸¦è¶…æ—¶çš„ç‰ˆæœ¬ï¼š class GuardedObjectV2 { private Object response; private final Object lock = new Object(); public Object get(long millis) { synchronized (lock) { // 1) è®°å½•æœ€åˆæ—¶é—´ long begin = System.currentTimeMillis(); // 2) å·²ç»ç»å†çš„æ—¶é—´ long timePassed = 0; while (response == null) { // 4) å‡è®¾ millis æ˜¯ 1000ï¼Œç»“æœåœ¨ 400 æ—¶å”¤é†’äº†ï¼Œé‚£ä¹ˆè¿˜æœ‰ 600 è¦ç­‰ long waitTime = millis - timePassed; log.debug(\"waitTime: {}\", waitTime); if (waitTime &lt;= 0) { log.debug(\"break...\"); break; } try { lock.wait(waitTime); } catch (InterruptedException e) { e.printStackTrace(); } // 3) å¦‚æœæå‰è¢«å”¤é†’ï¼Œè¿™æ—¶å·²ç»ç»å†çš„æ—¶é—´å‡è®¾ä¸º 400 timePassed = System.currentTimeMillis() - begin; log.debug(\"timePassed: {}, object is null {}\", timePassed, response == null); } return response; } } public void complete(Object response) { synchronized (lock) { // æ¡ä»¶æ»¡è¶³ï¼Œé€šçŸ¥ç­‰å¾…çº¿ç¨‹ this.response = response; log.debug(\"notify...\"); lock.notifyAll(); } } } 5 å¼‚æ­¥æ¨¡å¼ä¹‹ç”Ÿäº§è€…/æ¶ˆè´¹è€… 5.1 è¦ç‚¹ ä¸å‰é¢çš„ä¿æŠ¤æ€§æš‚åœä¸­çš„ GuardObject ä¸åŒï¼Œä¸éœ€è¦äº§ç”Ÿç»“æœå’Œæ¶ˆè´¹ç»“æœçš„çº¿ç¨‹ä¸€ä¸€å¯¹åº” æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥ç”¨æ¥å¹³è¡¡ç”Ÿäº§å’Œæ¶ˆè´¹çš„çº¿ç¨‹èµ„æº ç”Ÿäº§è€…ä»…è´Ÿè´£äº§ç”Ÿç»“æœæ•°æ®ï¼Œä¸å…³å¿ƒæ•°æ®è¯¥å¦‚ä½•å¤„ç†ï¼Œè€Œæ¶ˆè´¹è€…ä¸“å¿ƒå¤„ç†ç»“æœæ•°æ® æ¶ˆæ¯é˜Ÿåˆ—æ˜¯æœ‰å®¹é‡é™åˆ¶çš„ï¼Œæ»¡æ—¶ä¸ä¼šå†åŠ å…¥æ•°æ®ï¼Œç©ºæ—¶ä¸ä¼šå†æ¶ˆè€—æ•°æ® JDK ä¸­å„ç§é˜»å¡é˜Ÿåˆ—ï¼Œé‡‡ç”¨çš„å°±æ˜¯è¿™ç§æ¨¡å¼ 5.2 å®ç°class Message { private int id; private Object message; public Message(int id, Object message) { this.id = id; this.message = message; } public int getId() { return id; } public Object getMessage() { return message; } } class MessageQueue { private LinkedList&lt;Message> queue; private int capacity; public MessageQueue(int capacity) { this.capacity = capacity; queue = new LinkedList&lt;>(); } public Message take() { synchronized (queue) { while (queue.isEmpty()) { log.debug(\"æ²¡è´§äº†, wait\"); try { queue.wait(); } catch (InterruptedException e) { e.printStackTrace(); } } Message message = queue.removeFirst(); queue.notifyAll(); return message; } } public void put(Message message) { synchronized (queue) { while (queue.size() == capacity) { log.debug(\"åº“å­˜å·²è¾¾ä¸Šé™, wait\"); try { queue.wait(); } catch (InterruptedException e) { e.printStackTrace(); } } queue.addLast(message); queue.notifyAll(); } } } 6 park unpark6.1 åŸºæœ¬ä½¿ç”¨å®ƒä»¬æ˜¯ LockSupport ç±»ä¸­çš„æ–¹æ³• // æš‚åœå½“å‰çº¿ç¨‹ LockSupport.park(); // æ¢å¤æŸä¸ªçº¿ç¨‹çš„è¿è¡Œ LockSupport.unpark(æš‚åœçº¿ç¨‹å¯¹è±¡) å…ˆparkå†unpark Thread t1 = new Thread(() -> { System.out.println(\"start...\"); try { Thread.sleep(1000); System.out.println(\"park...\"); LockSupport.park(); System.out.println(\"resume...\"); } catch (InterruptedException e) { e.printStackTrace(); } },\"t1\"); t1.start(); Thread.sleep(2000); System.out.println(\"unpark...\"); LockSupport.unpark(t1); å¯ä»¥å…ˆè°ƒç”¨unparkå†è°ƒç”¨parkï¼Œä¼šæŠµæ¶ˆã€‚ï¼ˆä½†æ˜¯å¤šæ¬¡unparkä¹Ÿåªèƒ½æŠµæ¶ˆä¸€æ¬¡parkï¼‰ 6.2 ç‰¹ç‚¹ä¸ Object çš„ wait &amp; notify ç›¸æ¯” waitï¼Œnotify å’Œ notifyAll å¿…é¡»é…åˆ Object Monitor ä¸€èµ·ä½¿ç”¨ï¼Œè€Œ parkï¼Œunpark ä¸å¿… park &amp; unpark æ˜¯ä»¥çº¿ç¨‹ä¸ºå•ä½æ¥ã€é˜»å¡ã€‘å’Œã€å”¤é†’ã€‘çº¿ç¨‹ï¼Œè€Œ notify åªèƒ½éšæœºå”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼ŒnotifyAllæ˜¯å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ï¼Œå°±ä¸é‚£ä¹ˆã€ç²¾ç¡®ã€‘ park &amp; unpark å¯ä»¥å…ˆ unparkï¼Œè€Œ wait &amp; notify ä¸èƒ½å…ˆ notify 7 ReentrantLockç›¸å¯¹äº synchronized å®ƒå…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ å¯ä¸­æ–­ å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ å¯ä»¥è®¾ç½®ä¸ºå…¬å¹³é” æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡ ä¸ synchronized ä¸€æ ·ï¼Œéƒ½æ”¯æŒå¯é‡å…¥ // è·å–é” reentrantLock.lock(); try { // ä¸´ç•ŒåŒº } finally { // é‡Šæ”¾é” reentrantLock.unlock(); } 7.1 å¯æ‰“æ–­lockInterruptibly()æ–¹æ³•ç­‰å¾…é”æœŸé—´å¯ä»¥è¢«interruptæ‰“æ–­ ReentrantLock lock = new ReentrantLock(); Thread t1 = new Thread(() -> { log.debug(\"å¯åŠ¨...\"); try { //å¦‚æœè¯¥é”æ²¡æœ‰è¢«å ç”¨å°±ä¼šè·å¾—é” //å¦‚æœè¯¥é”è¢«å ç”¨å°±è¿›å…¥é˜»å¡é˜Ÿåˆ—ï¼Œå¯ä»¥è¢«å…¶ä»–çº¿ç¨‹ç”¨interruptæ‰“æ–­ lock.lockInterruptibly(); } catch (InterruptedException e) { e.printStackTrace(); log.debug(\"ç­‰é”çš„è¿‡ç¨‹ä¸­è¢«æ‰“æ–­\"); return; } try { log.debug(\"è·å¾—äº†é”\"); } finally { lock.unlock(); } }, \"t1\"); lock.lock(); log.debug(\"è·å¾—äº†é”\"); t1.start(); try { sleep(1); t1.interrupt(); log.debug(\"æ‰§è¡Œæ‰“æ–­\"); } finally { lock.unlock(); } 7.2 é”è¶…æ—¶tryLock()å¯å¸¦å‚å¯ä¸å¸¦å‚ï¼Œå¦‚æœæœªæŒ‡å®šæ—¶é—´ï¼Œåªè¦è¯¥é”è¢«å ç”¨å°±è·å–ä¸åˆ°é”ï¼Œè¿”å›falseï¼Œå¦‚æœæŒ‡å®šæ—¶é—´ï¼Œåœ¨æŒ‡å®šæ—¶é—´å†…è¯¥é”è¿˜è¢«å ç”¨åˆ™è·å–ä¸åˆ°é”ï¼Œè¿”å›false ReentrantLock lock = new ReentrantLock(); Thread t1 = new Thread(() -> { log.debug(\"å¯åŠ¨...\"); if (!lock.tryLock()) { log.debug(\"è·å–ç«‹åˆ»å¤±è´¥ï¼Œè¿”å›\"); return; } try { log.debug(\"è·å¾—äº†é”\"); } finally { lock.unlock(); } }, \"t1\"); lock.lock(); log.debug(\"è·å¾—äº†é”\"); t1.start(); try { sleep(2); } finally { lock.unlock(); } 7.3 å…¬å¹³é”ReentrantLock é»˜è®¤æ˜¯ä¸å…¬å¹³çš„ï¼Œå¯ä»¥ä½¿ç”¨new ReentrantLock(true)è®¾ç½®ä¸ºå…¬å¹³é”ï¼Œé‡‡ç”¨å…ˆåˆ°å…ˆå¾—çš„æ–¹æ³•è·å¾—é”ã€‚ï¼ˆæ’é˜Ÿï¼‰ 7.4 æ¡ä»¶å˜é‡ Condition.await() Condition.await(int millis) Condition.signal() Condition.signalAll() ä½¿ç”¨è¦ç‚¹ï¼š await å‰éœ€è¦è·å¾—é” await æ‰§è¡Œåï¼Œä¼šé‡Šæ”¾é”ï¼Œè¿›å…¥ conditionObject ç­‰å¾… await çš„çº¿ç¨‹è¢«å”¤é†’ï¼ˆæˆ–æ‰“æ–­ã€æˆ–è¶…æ—¶ï¼‰å–é‡æ–°ç«äº‰ lock é” ç«äº‰ lock é”æˆåŠŸåï¼Œä» await åç»§ç»­æ‰§è¡Œ 8 åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶8.1 å›ºå®šé¡ºåºæ¯”å¦‚ï¼Œå¿…é¡»å…ˆ 2 å 1 æ‰“å° 8.1.1 wait notify ç‰ˆ// ç”¨æ¥åŒæ­¥çš„å¯¹è±¡ static Object obj = new Object(); // t2 è¿è¡Œæ ‡è®°ï¼Œ ä»£è¡¨ t2 æ˜¯å¦æ‰§è¡Œè¿‡ static boolean t2runed = false; public static void main(String[] args) { Thread t1 = new Thread(() -> { synchronized (obj) { // å¦‚æœ t2 æ²¡æœ‰æ‰§è¡Œè¿‡ while (!t2runed) { try { // t1 å…ˆç­‰ä¸€ä¼š obj.wait(); } catch (InterruptedException e) { e.printStackTrace(); } } } System.out.println(1); }); Thread t2 = new Thread(() -> { System.out.println(2); synchronized (obj) { // ä¿®æ”¹è¿è¡Œæ ‡è®° t2runed = true; // é€šçŸ¥ obj ä¸Šç­‰å¾…çš„çº¿ç¨‹ï¼ˆå¯èƒ½æœ‰å¤šä¸ªï¼Œå› æ­¤éœ€è¦ç”¨ notifyAllï¼‰ obj.notifyAll(); } }); t1.start(); t2.start(); } 8.1.2 Park Unpark ç‰ˆpark å’Œ unpark æ–¹æ³•æ¯”è¾ƒçµæ´»ï¼Œä»–ä¿©è°å…ˆè°ƒç”¨ï¼Œè°åè°ƒç”¨æ— æ‰€è°“ã€‚å¹¶ä¸”æ˜¯ä»¥çº¿ç¨‹ä¸ºå•ä½è¿›è¡Œã€æš‚åœã€å’Œã€æ¢å¤ã€ï¼Œä¸éœ€è¦ã€åŒæ­¥å¯¹è±¡ã€å’Œã€è¿è¡Œæ ‡è®°ã€ Thread t1 = new Thread(() -> { try { Thread.sleep(1000); } catch (InterruptedException e) { } // å½“æ²¡æœ‰ã€è®¸å¯ã€æ—¶ï¼Œå½“å‰çº¿ç¨‹æš‚åœè¿è¡Œï¼›æœ‰ã€è®¸å¯ã€æ—¶ï¼Œç”¨æ‰è¿™ä¸ªã€è®¸å¯ã€ï¼Œå½“å‰çº¿ç¨‹æ¢å¤è¿è¡Œ LockSupport.park(); System.out.println(\"1\"); }); Thread t2 = new Thread(() -> { System.out.println(\"2\"); // ç»™çº¿ç¨‹ t1 å‘æ”¾ã€è®¸å¯ã€ï¼ˆå¤šæ¬¡è¿ç»­è°ƒç”¨ unpark åªä¼šå‘æ”¾ä¸€ä¸ªã€è®¸å¯ã€ï¼‰ LockSupport.unpark(t1); }); t1.start(); t2.start(); 8.2 äº¤æ›¿è¾“å‡ºè§leetcode1115-äº¤æ›¿æ‰“å°FooBar é™¤æ­¤ä¹‹å¤–çŸ¥é“çº¿ç¨‹å¯¹è±¡è¿˜å¯ä»¥ä½¿ç”¨parkã€unparkã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://www.codetool.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"leetcode1115-äº¤æ›¿æ‰“å°FooBar","slug":"leetcode1115-äº¤æ›¿æ‰“å°FooBar","date":"2020-02-01T18:03:48.000Z","updated":"2020-02-01T18:26:40.115Z","comments":true,"path":"article/leetcode1115-äº¤æ›¿æ‰“å°FooBar/","link":"","permalink":"https://www.codetool.top/article/leetcode1115-%E4%BA%A4%E6%9B%BF%E6%89%93%E5%8D%B0FooBar/","excerpt":"","text":"1 åŸé¢˜æˆ‘ä»¬æä¾›ä¸€ä¸ªç±»ï¼š class FooBar { public void foo() { for (int i = 0; i &lt; n; i++) { print(&quot;foo&quot;); } } public void bar() { for (int i = 0; i &lt; n; i++) { print(&quot;bar&quot;); } } }ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹å°†ä¼šå…±ç”¨ä¸€ä¸ª FooBar å®ä¾‹ã€‚å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹å°†ä¼šè°ƒç”¨ foo() æ–¹æ³•ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°†ä¼šè°ƒç”¨ bar() æ–¹æ³•ã€‚ è¯·è®¾è®¡ä¿®æ”¹ç¨‹åºï¼Œä»¥ç¡®ä¿ â€œfoobarâ€ è¢«è¾“å‡º n æ¬¡ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: n = 1è¾“å‡º: â€œfoobarâ€è§£é‡Š: è¿™é‡Œæœ‰ä¸¤ä¸ªçº¿ç¨‹è¢«å¼‚æ­¥å¯åŠ¨ã€‚å…¶ä¸­ä¸€ä¸ªè°ƒç”¨ foo() æ–¹æ³•, å¦ä¸€ä¸ªè°ƒç”¨ bar() æ–¹æ³•ï¼Œâ€foobarâ€ å°†è¢«è¾“å‡ºä¸€æ¬¡ã€‚ ç¤ºä¾‹ 2: è¾“å…¥: n = 2è¾“å‡º: â€œfoobarfoobarâ€è§£é‡Š: â€œfoobarâ€ å°†è¢«è¾“å‡ºä¸¤æ¬¡ã€‚ 2 è§£æ³•2.1 æ€æƒ³wait_notify, await_signal 2.2 ä»£ç wait_notify class FooBar { boolean flag = false; private int n; public FooBar(int n) { this.n = n; } public void foo(Runnable printFoo) throws InterruptedException { synchronized(this){ for (int i = 0; i &lt; n; i++) { while(flag) this.wait(); // printFoo.run() outputs \"foo\". Do not change or remove this line. printFoo.run(); flag = true; this.notifyAll(); } } } public void bar(Runnable printBar) throws InterruptedException { synchronized(this){ for (int i = 0; i &lt; n; i++) { while(!flag) this.wait(); // printBar.run() outputs \"bar\". Do not change or remove this line. printBar.run(); flag = false; this.notifyAll(); } } } } await_signal class FooBar { private int n; boolean flag; ReentrantLock lock; Condition condition; public FooBar(int n) { this.n = n; lock = new ReentrantLock(); condition = lock.newCondition(); } public void foo(Runnable printFoo) throws InterruptedException { lock.lock(); try{ for (int i = 0; i &lt; n; i++) { while(flag) condition.await(); // printFoo.run() outputs \"foo\". Do not change or remove this line. printFoo.run(); flag = true; condition.signalAll(); } }finally{ lock.unlock(); } } public void bar(Runnable printBar) throws InterruptedException { lock.lock(); try{ for (int i = 0; i &lt; n; i++) { while(!flag) condition.await(); // printBar.run() outputs \"bar\". Do not change or remove this line. printBar.run(); flag = false; condition.signalAll(); } }finally{ lock.unlock(); } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://www.codetool.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"leetcode1114-æŒ‰åºæ‰“å°","slug":"leetcode1114-æŒ‰åºæ‰“å°","date":"2020-02-01T11:27:07.000Z","updated":"2020-02-01T11:35:27.657Z","comments":true,"path":"article/leetcode1114-æŒ‰åºæ‰“å°/","link":"","permalink":"https://www.codetool.top/article/leetcode1114-%E6%8C%89%E5%BA%8F%E6%89%93%E5%8D%B0/","excerpt":"","text":"1 åŸé¢˜æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç±»ï¼š public class Foo { public void one() { print(&quot;one&quot;); } public void two() { print(&quot;two&quot;); } public void three() { print(&quot;three&quot;); } }ä¸‰ä¸ªä¸åŒçš„çº¿ç¨‹å°†ä¼šå…±ç”¨ä¸€ä¸ª Foo å®ä¾‹ã€‚ çº¿ç¨‹ A å°†ä¼šè°ƒç”¨ one() æ–¹æ³• çº¿ç¨‹ B å°†ä¼šè°ƒç”¨ two() æ–¹æ³• çº¿ç¨‹ C å°†ä¼šè°ƒç”¨ three() æ–¹æ³•è¯·è®¾è®¡ä¿®æ”¹ç¨‹åºï¼Œä»¥ç¡®ä¿ two() æ–¹æ³•åœ¨ one() æ–¹æ³•ä¹‹åè¢«æ‰§è¡Œï¼Œthree() æ–¹æ³•åœ¨ two() æ–¹æ³•ä¹‹åè¢«æ‰§è¡Œã€‚ ç¤ºä¾‹ 1: è¾“å…¥: [1,2,3]è¾“å‡º: â€œonetwothreeâ€è§£é‡Š:æœ‰ä¸‰ä¸ªçº¿ç¨‹ä¼šè¢«å¼‚æ­¥å¯åŠ¨ã€‚è¾“å…¥ [1,2,3] è¡¨ç¤ºçº¿ç¨‹ A å°†ä¼šè°ƒç”¨ one() æ–¹æ³•ï¼Œçº¿ç¨‹ B å°†ä¼šè°ƒç”¨ two() æ–¹æ³•ï¼Œçº¿ç¨‹ C å°†ä¼šè°ƒç”¨ three() æ–¹æ³•ã€‚æ­£ç¡®çš„è¾“å‡ºæ˜¯ â€œonetwothreeâ€ã€‚ ç¤ºä¾‹ 2: è¾“å…¥: [1,3,2]è¾“å‡º: â€œonetwothreeâ€è§£é‡Š:è¾“å…¥ [1,3,2] è¡¨ç¤ºçº¿ç¨‹ A å°†ä¼šè°ƒç”¨ one() æ–¹æ³•ï¼Œçº¿ç¨‹ B å°†ä¼šè°ƒç”¨ three() æ–¹æ³•ï¼Œçº¿ç¨‹ C å°†ä¼šè°ƒç”¨ two() æ–¹æ³•ã€‚æ­£ç¡®çš„è¾“å‡ºæ˜¯ â€œonetwothreeâ€ã€‚ æ³¨æ„: å°½ç®¡è¾“å…¥ä¸­çš„æ•°å­—ä¼¼ä¹æš—ç¤ºäº†é¡ºåºï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸ä¿è¯çº¿ç¨‹åœ¨æ“ä½œç³»ç»Ÿä¸­çš„è°ƒåº¦é¡ºåºã€‚ ä½ çœ‹åˆ°çš„è¾“å…¥æ ¼å¼ä¸»è¦æ˜¯ä¸ºäº†ç¡®ä¿æµ‹è¯•çš„å…¨é¢æ€§ã€‚ 2 è§£æ³•2.1 æ€æƒ³wait_notify 2.2 ä»£ç class Foo { boolean first = false; boolean second = false; public Foo() { } public void first(Runnable printFirst) throws InterruptedException { synchronized(this){ // printFirst.run() outputs \"first\". Do not change or remove this line. printFirst.run(); first = true; this.notifyAll(); } } public void second(Runnable printSecond) throws InterruptedException { synchronized(this){ while(!first) this.wait(); // printSecond.run() outputs \"second\". Do not change or remove this line. printSecond.run(); second = true; this.notifyAll(); } } public void third(Runnable printThird) throws InterruptedException { synchronized(this){ while(!second) this.wait(); // printThird.run() outputs \"third\". Do not change or remove this line. printThird.run(); } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://www.codetool.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"leetcode503-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ II","slug":"leetcode503-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ II","date":"2020-01-31T18:00:58.000Z","updated":"2020-02-20T14:55:21.051Z","comments":true,"path":"article/leetcode503-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ II/","link":"","permalink":"https://www.codetool.top/article/leetcode503-%E4%B8%8B%E4%B8%80%E4%B8%AA%E6%9B%B4%E5%A4%A7%E5%85%83%E7%B4%A0II/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªå¾ªç¯æ•°ç»„ï¼ˆæœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¾“å‡ºæ¯ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ã€‚æ•°å­— x çš„ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ æ˜¯æŒ‰æ•°ç»„éå†é¡ºåºï¼Œè¿™ä¸ªæ•°å­—ä¹‹åçš„ç¬¬ä¸€ä¸ªæ¯”å®ƒæ›´å¤§çš„æ•°ï¼Œè¿™æ„å‘³ç€ä½ åº”è¯¥å¾ªç¯åœ°æœç´¢å®ƒçš„ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¾“å‡º -1ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š [1,2,1]è¾“å‡ºï¼š [2,-1,2]è§£é‡Šï¼š ç¬¬ä¸€ä¸ª 1 çš„ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°æ˜¯ 2ï¼›æ•°å­— 2 æ‰¾ä¸åˆ°ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°ï¼›ç¬¬äºŒä¸ª 1 çš„ä¸‹ä¸€ä¸ªæœ€å¤§çš„æ•°éœ€è¦å¾ªç¯æœç´¢ï¼Œç»“æœä¹Ÿæ˜¯ 2ã€‚ æ³¨æ„: è¾“å…¥æ•°ç»„çš„é•¿åº¦ä¸ä¼šè¶…è¿‡ 10000ã€‚ 2 è§£æ³•2.1 æ€æƒ³å•è°ƒæ ˆï¼Œç»´æŒä¸€ä¸ªé€’å‡çš„æ ˆï¼Œå°†æ•°ç»„çš„ä¸‹æ ‡å…¥æ ˆï¼Œé‡åˆ°ä¸€ä¸ªæ¯”æ ˆé¡¶å…ƒç´ å¯¹åº”å€¼å¤§çš„å…ƒç´ å¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼Œç›´åˆ°æ ˆé¡¶å…ƒç´ æ¯”è¯¥å…ƒç´ å€¼å¤§ï¼Œå‹å…¥è¯¥å…ƒç´ ã€‚å¾ªç¯æä¸¤æ¬¡ã€‚ 2.2 ä»£ç class Solution { public int[] nextGreaterElements(int[] nums) { Stack&lt;Integer> stack = new Stack&lt;>(); boolean[] mark = new boolean[nums.length]; int[] ans = new int[nums.length]; for(int n = 0;n&lt;2;n++){ for(int i = 0;i&lt;nums.length;i++){ while(!stack.isEmpty()&amp;&amp;nums[i]>nums[stack.peek()]){ int index = stack.pop(); ans[index] = nums[i]; mark[index] = true; } if(!mark[i]) stack.push(i); } } for(int i = 0;i&lt;ans.length;i++) if(!mark[i]) ans[i] = -1; return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"Javaå¤šçº¿ç¨‹åŸºç¡€","slug":"Javaå¤šçº¿ç¨‹åŸºç¡€","date":"2020-01-31T11:08:06.000Z","updated":"2020-01-31T18:16:48.445Z","comments":true,"path":"article/Javaå¤šçº¿ç¨‹åŸºç¡€/","link":"","permalink":"https://www.codetool.top/article/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80/","excerpt":"","text":"1 å¤šçº¿ç¨‹åº”ç”¨1.1 å¼‚æ­¥è°ƒç”¨ä»¥è°ƒç”¨æ–¹è§’åº¦æ¥è®²ï¼Œå¦‚æœ éœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œæ‰èƒ½ç»§ç»­è¿è¡Œå°±æ˜¯åŒæ­¥ ä¸éœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œå°±èƒ½ç»§ç»­è¿è¡Œå°±æ˜¯å¼‚æ­¥ åŒæ­¥åœ¨å¤šçº¿ç¨‹ä¸­è¿˜æœ‰å¦å¤–ä¸€ä¸ªæ„æ€ï¼Œæ˜¯è®©å¤šä¸ªçº¿ç¨‹æ­¥è°ƒä¸€è‡´ã€‚ å¼‚æ­¥å¯ä»¥é˜²æ­¢ç¨‹åºé˜»å¡ï¼Œä¾‹å¦‚IOæ“ä½œå¯ä»¥å¤„ç†ä¸ºå¼‚æ­¥çš„ã€‚ 1.2 æé«˜æ•ˆç‡å……åˆ†åˆ©ç”¨å¤šæ ¸cpuçš„ä¼˜åŠ¿ï¼Œæé«˜è¿è¡Œæ•ˆç‡ã€‚ ä¾‹å¤–ï¼šä¸æ˜¯æ‰€æœ‰è®¡ç®—ä»»åŠ¡éƒ½èƒ½æ‹†åˆ†ï¼Œå¯èƒ½è¿è¡Œæ•ˆç‡ä¹Ÿä¸ä¼šæé«˜ã€‚ 2 Javaçº¿ç¨‹2.1 åˆ›å»ºå’Œè¿è¡Œçº¿ç¨‹2.1.1 ç›´æ¥ä½¿ç”¨Thread// åˆ›å»ºçº¿ç¨‹å¯¹è±¡ Thread t = new Thread() { public void run() { // è¦æ‰§è¡Œçš„ä»»åŠ¡ } }; // å¯åŠ¨çº¿ç¨‹ t.start(); 2.1.2 ä½¿ç”¨Runnableé…åˆThreadRunnable runnable = new Runnable() { public void run(){ // è¦æ‰§è¡Œçš„ä»»åŠ¡ } }; // åˆ›å»ºçº¿ç¨‹å¯¹è±¡ Thread t = new Thread(runnable); // å¯åŠ¨çº¿ç¨‹ t.start(); Java 8 ä»¥åå¯ä»¥ä½¿ç”¨ lambda ç²¾ç®€ä»£ç  // åˆ›å»ºä»»åŠ¡å¯¹è±¡ Runnable task2 = () -> log.debug(\"hello\"); // å‚æ•°1 æ˜¯ä»»åŠ¡å¯¹è±¡; å‚æ•°2 æ˜¯çº¿ç¨‹åå­—ï¼Œæ¨è Thread t2 = new Thread(task2, \"t2\"); t2.start(); æˆ– Thread t2 = new Thread(()->log.debug(\"hello\"), \"t2\"); t2.start(); 2.1.3 Threadä¸Runnableçš„å…³ç³»åœ¨Threadæºç ä¸­ï¼ŒRunnableè¢«èµ‹ç»™æˆå‘˜å˜é‡targetï¼Œåœ¨run()ä¸­è°ƒç”¨target.run()ï¼ˆç»„åˆå…³ç³»ï¼‰ï¼Œè€Œç›´æ¥é‡å†™run()å°±ä¼šè¦†ç›–æ‰Threadçš„run()ï¼ˆç»§æ‰¿å…³ç³»ï¼‰ã€‚ æ–¹æ³•1 æ˜¯æŠŠçº¿ç¨‹å’Œä»»åŠ¡åˆå¹¶åœ¨äº†ä¸€èµ·ï¼Œæ–¹æ³•2 æ˜¯æŠŠçº¿ç¨‹å’Œä»»åŠ¡åˆ†å¼€äº† ç”¨ Runnable æ›´å®¹æ˜“ä¸çº¿ç¨‹æ± ç­‰é«˜çº§ API é…åˆ ç”¨ Runnable è®©ä»»åŠ¡ç±»è„±ç¦»äº† Thread ç»§æ‰¿ä½“ç³»ï¼Œæ›´çµæ´» 2.1.4 FutureTaské…åˆThreadFutureTaskå®ç°äº†Runnableæ¥å£ã€‚ FutureTask èƒ½å¤Ÿæ¥æ”¶ Callable ç±»å‹çš„å‚æ•°ï¼Œç”¨æ¥å¤„ç†æœ‰è¿”å›ç»“æœçš„æƒ…å†µã€‚Callableæ˜¯å¸¦è¿”å›å€¼ç±»å‹ç‰ˆæœ¬çš„Runnableã€‚ // åˆ›å»ºä»»åŠ¡å¯¹è±¡ FutureTask&lt;Integer> task3 = new FutureTask&lt;>(() -> { log.debug(\"hello\"); return 100; }); // å‚æ•°1 æ˜¯ä»»åŠ¡å¯¹è±¡; å‚æ•°2 æ˜¯çº¿ç¨‹åå­—ï¼Œæ¨è new Thread(task3, \"t3\").start(); // ä¸»çº¿ç¨‹é˜»å¡ï¼ŒåŒæ­¥ç­‰å¾… task æ‰§è¡Œå®Œæ¯•çš„ç»“æœ Integer result = task3.get(); log.debug(\"ç»“æœæ˜¯:{}\", result); 2.2 linuxä¸‹å¯¹è¿›ç¨‹çº¿ç¨‹çš„æ“ä½œ ps -feæŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹ ps -fT -p &lt;PID&gt;æŸ¥çœ‹æŸä¸ªè¿›ç¨‹ï¼ˆPIDï¼‰çš„æ‰€æœ‰çº¿ç¨‹ killæ€æ­»è¿›ç¨‹ top æŒ‰å¤§å†™Håˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºçº¿ç¨‹ top -H -p &lt;PID&gt;æŸ¥çœ‹æŸä¸ªè¿›ç¨‹ï¼ˆPIDï¼‰çš„æ‰€æœ‰çº¿ç¨‹ 2.3 Threadå¸¸ç”¨æ–¹æ³• æ–¹æ³•å static åŠŸèƒ½è¯´æ˜ æ³¨æ„ start() å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œåœ¨æ–°çš„çº¿ç¨‹è¿è¡Œ run æ–¹æ³•ä¸­çš„ä»£ç  start æ–¹æ³•åªæ˜¯è®©çº¿ç¨‹è¿›å…¥å°±ç»ªï¼Œé‡Œé¢ä»£ç ä¸ä¸€å®šç«‹åˆ»è¿è¡Œï¼ˆCPU çš„æ—¶é—´ç‰‡è¿˜æ²¡åˆ†ç»™å®ƒï¼‰ã€‚æ¯ä¸ªçº¿ç¨‹å¯¹è±¡çš„startæ–¹æ³•åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œå¦‚æœè°ƒç”¨äº†å¤šæ¬¡ä¼šå‡ºç°IllegalThreadStateException run() æ–°çº¿ç¨‹å¯åŠ¨åä¼šè°ƒç”¨çš„æ–¹æ³• å¦‚æœåœ¨æ„é€  Thread å¯¹è±¡æ—¶ä¼ é€’äº† Runnable å‚æ•°ï¼Œåˆ™çº¿ç¨‹å¯åŠ¨åä¼šè°ƒç”¨ Runnable ä¸­çš„ run æ–¹æ³•ï¼Œå¦åˆ™é»˜è®¤ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ä½†å¯ä»¥åˆ›å»º Thread çš„å­ç±»å¯¹è±¡ï¼Œæ¥è¦†ç›–é»˜è®¤è¡Œä¸º join() ç­‰å¾…çº¿ç¨‹è¿è¡Œç»“æŸ(è¿›ç¨‹é—´é€šä¿¡) join(long n) ç­‰å¾…çº¿ç¨‹è¿è¡Œç»“æŸ,æœ€å¤šç­‰å¾…næ¯«ç§’ getId() è·å–çº¿ç¨‹é•¿æ•´å‹çš„ id id å”¯ä¸€ getName() è·å–çº¿ç¨‹å setName(String) ä¿®æ”¹çº¿ç¨‹å getPriority() è·å–çº¿ç¨‹ä¼˜å…ˆçº§ setPriority(int) ä¿®æ”¹çº¿ç¨‹ä¼˜å…ˆçº§ javaä¸­è§„å®šçº¿ç¨‹ä¼˜å…ˆçº§æ˜¯1~10 çš„æ•´æ•°ï¼Œè¾ƒå¤§çš„ä¼˜å…ˆçº§èƒ½æé«˜è¯¥çº¿ç¨‹è¢« CPU è°ƒåº¦çš„æœºç‡ getState() è·å–çº¿ç¨‹çŠ¶æ€ Java ä¸­çº¿ç¨‹çŠ¶æ€æ˜¯ç”¨ 6 ä¸ª enum è¡¨ç¤ºï¼Œåˆ†åˆ«ä¸ºï¼šNEW, RUNNABLE, BLOCKED, WAITING,TIMED_WAITING, TERMINATED isInterrupted() åˆ¤æ–­æ˜¯å¦è¢«æ‰“æ–­ ä¸ä¼šæ¸…é™¤æ‰“æ–­æ ‡è®° isAlive() çº¿ç¨‹æ˜¯å¦å­˜æ´»ï¼ˆè¿˜æ²¡æœ‰è¿è¡Œå®Œæ¯•ï¼‰ interrupt() æ‰“æ–­çº¿ç¨‹ å¦‚æœè¢«æ‰“æ–­çº¿ç¨‹æ­£åœ¨ sleepï¼Œwaitï¼Œjoin ä¼šå¯¼è‡´è¢«æ‰“æ–­çš„çº¿ç¨‹æŠ›å‡º InterruptedExceptionï¼Œå¹¶æ¸…é™¤æ‰“æ–­æ ‡è®°ï¼›å¦‚æœæ‰“æ–­çš„æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Œåˆ™ä¼šè®¾ç½®æ‰“æ–­æ ‡è®° ï¼›park çš„çº¿ç¨‹è¢«æ‰“æ–­ï¼Œä¹Ÿä¼šè®¾ç½®æ‰“æ–­æ ‡è®° interrupted() static åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦è¢«æ‰“æ–­ ä¼šæ¸…é™¤æ‰“æ–­æ ‡è®° currentThread() static è·å–å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ sleep(long n) static è®©å½“å‰æ‰§è¡Œçš„çº¿ç¨‹ä¼‘çœ næ¯«ç§’ï¼Œä¼‘çœ æ—¶è®©å‡º cpuçš„æ—¶é—´ç‰‡ç»™å…¶å®ƒçº¿ç¨‹ yield() static æç¤ºçº¿ç¨‹è°ƒåº¦å™¨è®©å‡ºå½“å‰çº¿ç¨‹å¯¹CPUçš„ä½¿ç”¨ ä¸»è¦æ˜¯ä¸ºäº†æµ‹è¯•å’Œè°ƒè¯• currentThread() static è·å–å½“å‰çº¿ç¨‹å¯¹è±¡ 2.4 sleepä¸yield2.4.1 sleep è°ƒç”¨ sleep ä¼šè®©å½“å‰çº¿ç¨‹ä» Running è¿›å…¥ Timed Waiting çŠ¶æ€ï¼ˆé˜»å¡ï¼‰ å…¶å®ƒçº¿ç¨‹å¯ä»¥ä½¿ç”¨ interrupt æ–¹æ³•æ‰“æ–­æ­£åœ¨ç¡çœ çš„çº¿ç¨‹ï¼Œè¿™æ—¶ sleep æ–¹æ³•ä¼šæŠ›å‡º InterruptedException ç¡çœ ç»“æŸåçš„çº¿ç¨‹æœªå¿…ä¼šç«‹åˆ»å¾—åˆ°æ‰§è¡Œ å»ºè®®ç”¨ TimeUnit çš„ sleep ä»£æ›¿ Thread çš„ sleep æ¥è·å¾—æ›´å¥½çš„å¯è¯»æ€§ TimeUnit.SECONDS.sleep(1); TimeUnit.MILLISECONDS.sleep(1) 2.4.2 yield è°ƒç”¨ yield ä¼šè®©å½“å‰çº¿ç¨‹ä» Running è¿›å…¥ Runnable å°±ç»ªçŠ¶æ€ï¼Œç„¶åè°ƒåº¦æ‰§è¡Œå…¶å®ƒçº¿ç¨‹(ä»æœ‰å¯èƒ½ç«‹å³è¢«è°ƒåº¦) å…·ä½“çš„å®ç°ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦å™¨ 2.4.3 sleepåº”ç”¨åœ¨æ²¡æœ‰åˆ©ç”¨cpuæ¥è®¡ç®—æ—¶,ä¸è¦è®©while(true)ç©ºè½¬æµªè´¹cpu,è¿™æ—¶å¯ä»¥ä½¿ç”¨yieldæˆ–sleepæ¥è®©å‡ºcpuçš„ä½¿ç”¨æƒç»™å…¶ä»–ç¨‹åº while(true){ try{ Thread.sleep(50); }catch(InterruptedException e){ e.printStackTrace(); } } å¯ä»¥ç”¨waitæˆ–æ¡ä»¶å˜é‡è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœ ä¸åŒçš„æ˜¯,åä¸¤ç§éƒ½éœ€è¦åŠ é”,å¹¶ä¸”éœ€è¦ç›¸åº”çš„å”¤é†’æ“ä½œ,ä¸€èˆ¬é€‚ç”¨äºè¦è¿›è¡ŒåŒæ­¥çš„åœºæ™¯ sleepé€‚ç”¨äºæ— éœ€é”åŒæ­¥çš„åœºæ™¯ 2.5 joinæ–¹æ³•2.5.1 joinæ–¹æ³•çš„ä½œç”¨ä¸‹é¢è¿™æ®µä»£ç ï¼Œçº¿ç¨‹t1è¿è¡Œæ”¹å˜rçš„å€¼éœ€è¦1ç§’çš„æ—¶é—´ï¼Œä¸»çº¿ç¨‹å°±è·å–ä¸äº†rè¢«æ”¹å˜åçš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨joinè§£å†³ã€‚ static int r = 0; public static void main(String[] args) throws InterruptedException { test1(); } private static void test1() throws InterruptedException { log.debug(\"å¼€å§‹\"); Thread t1 = new Thread(() -> { log.debug(\"å¼€å§‹\"); sleep(1); log.debug(\"ç»“æŸ\"); r = 10; }); t1.start(); //ä½¿ç”¨joinå¯ä»¥ç­‰å¾…t1è¿è¡Œç»“æŸ //t1.join(); log.debug(\"ç»“æœä¸º:{}\", r); log.debug(\"ç»“æŸ\"); } è¿™ç§åº”ç”¨å°±æ˜¯åŒæ­¥æœºåˆ¶ã€‚ 2.5.2 æœ‰æ—¶æ•ˆçš„joinjoin(long millis)å¦‚æœåœ¨é™å®šçš„æ—¶é—´å†…çº¿ç¨‹æ²¡æœ‰ç»“æŸï¼Œåˆ™å½“å‰çº¿ç¨‹åœæ­¢ç­‰å¾…ï¼Œç»§ç»­æ‰§è¡Œã€‚ joinçš„åº•å±‚å®ç°æ˜¯wait 2.6 interruptæ–¹æ³•åªæ˜¯ç½®ä¸€ä¸ªæ ‡å¿—ä½ï¼Œæ˜¯å¦åœæ­¢è¿è¡Œç”±çº¿ç¨‹è‡ªå·±å†³å®šã€‚ 2.6.1 ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ class TPTInterrupt { private Thread thread; public void start(){ thread = new Thread(() -> { while(true) { Thread current = Thread.currentThread(); if(current.isInterrupted()) { log.debug(\"æ–™ç†åäº‹\"); break; } try { Thread.sleep(1000); log.debug(\"å°†ç»“æœä¿å­˜\"); } catch (InterruptedException e) { current.interrupt(); } // æ‰§è¡Œç›‘æ§æ“ä½œ } },\"ç›‘æ§çº¿ç¨‹\"); thread.start(); } public void stop() { thread.interrupt(); } } 2.6.2 æ‰“æ–­parkçº¿ç¨‹æ‰“æ–­ park çº¿ç¨‹, ä¸ä¼šæ¸…ç©ºæ‰“æ–­çŠ¶æ€ private static void test3() throws InterruptedException { Thread t1 = new Thread(() -> { log.debug(\"park...\"); LockSupport.park(); log.debug(\"unpark...\"); log.debug(\"æ‰“æ–­çŠ¶æ€ï¼š{}\", Thread.currentThread().isInterrupted()); }, \"t1\"); t1.start(); sleep(1); t1.interrupt(); } 2.7 ä¸æ¨èä½¿ç”¨çš„æ–¹æ³• æ–¹æ³•å static åŠŸèƒ½è¯´æ˜ stop() åœæ­¢çº¿ç¨‹è¿è¡Œ suspend() æŒ‚èµ·ï¼ˆæš‚åœï¼‰çº¿ç¨‹è¿è¡Œ resume() æ¢å¤çº¿ç¨‹è¿è¡Œ 2.8 ä¸»çº¿ç¨‹ä¸å®ˆæŠ¤çº¿ç¨‹é»˜è®¤æƒ…å†µä¸‹ï¼ŒJava è¿›ç¨‹éœ€è¦ç­‰å¾…æ‰€æœ‰çº¿ç¨‹éƒ½è¿è¡Œç»“æŸï¼Œæ‰ä¼šç»“æŸã€‚æœ‰ä¸€ç§ç‰¹æ®Šçš„çº¿ç¨‹å«åšå®ˆæŠ¤çº¿ç¨‹ï¼Œåªè¦å…¶å®ƒéå®ˆæŠ¤çº¿ç¨‹è¿è¡Œç»“æŸäº†ï¼Œå³ä½¿å®ˆæŠ¤çº¿ç¨‹çš„ä»£ç æ²¡æœ‰æ‰§è¡Œå®Œï¼Œä¹Ÿä¼šå¼ºåˆ¶ç»“æŸã€‚ log.debug(\"å¼€å§‹è¿è¡Œ...\"); Thread t1 = new Thread(() -> { log.debug(\"å¼€å§‹è¿è¡Œ...\"); sleep(2); log.debug(\"è¿è¡Œç»“æŸ...\"); }, \"daemon\"); // è®¾ç½®è¯¥çº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ t1.setDaemon(true); t1.start(); sleep(1); log.debug(\"è¿è¡Œç»“æŸ...\"); 2.9 äº”ç§çŠ¶æ€è¿™æ˜¯ä» æ“ä½œç³»ç»Ÿ å±‚é¢æ¥æè¿°çš„ ã€åˆå§‹çŠ¶æ€ã€‘(æ–°å»ºçŠ¶æ€)ä»…æ˜¯åœ¨è¯­è¨€å±‚é¢åˆ›å»ºäº†çº¿ç¨‹å¯¹è±¡ï¼Œè¿˜æœªä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹å…³è” ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ï¼ˆå°±ç»ªçŠ¶æ€ï¼‰æŒ‡è¯¥çº¿ç¨‹å·²ç»è¢«åˆ›å»ºï¼ˆä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹å…³è”ï¼‰ï¼Œå¯ä»¥ç”± CPU è°ƒåº¦æ‰§è¡Œ ã€è¿è¡ŒçŠ¶æ€ã€‘æŒ‡è·å–äº† CPU æ—¶é—´ç‰‡è¿è¡Œä¸­çš„çŠ¶æ€ å½“ CPU æ—¶é—´ç‰‡ç”¨å®Œï¼Œä¼šä»ã€è¿è¡ŒçŠ¶æ€ã€‘è½¬æ¢è‡³ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ï¼Œä¼šå¯¼è‡´çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ ã€é˜»å¡çŠ¶æ€ã€‘ å¦‚æœè°ƒç”¨äº†é˜»å¡ APIï¼Œå¦‚ BIO è¯»å†™æ–‡ä»¶ï¼Œè¿™æ—¶è¯¥çº¿ç¨‹å®é™…ä¸ä¼šç”¨åˆ° CPUï¼Œä¼šå¯¼è‡´çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿›å…¥ã€é˜»å¡çŠ¶æ€ã€‘ ç­‰ BIO æ“ä½œå®Œæ¯•ï¼Œä¼šç”±æ“ä½œç³»ç»Ÿå”¤é†’é˜»å¡çš„çº¿ç¨‹ï¼Œè½¬æ¢è‡³ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ ä¸ã€å¯è¿è¡ŒçŠ¶æ€ã€‘çš„åŒºåˆ«æ˜¯ï¼Œå¯¹ã€é˜»å¡çŠ¶æ€ã€‘çš„çº¿ç¨‹æ¥è¯´åªè¦å®ƒä»¬ä¸€ç›´ä¸å”¤é†’ï¼Œè°ƒåº¦å™¨å°±ä¸€ç›´ä¸ä¼šè€ƒè™‘è°ƒåº¦å®ƒä»¬ ã€ç»ˆæ­¢çŠ¶æ€ã€‘è¡¨ç¤ºçº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸï¼Œä¸ä¼šå†è½¬æ¢ä¸ºå…¶å®ƒçŠ¶æ€ 2.10 å…­ç§çŠ¶æ€è¿™æ˜¯ä» Java API å±‚é¢æ¥æè¿°çš„ æ ¹æ® Thread.State æšä¸¾ï¼Œåˆ†ä¸ºå…­ç§çŠ¶æ€ï¼š NEW çº¿ç¨‹åˆšè¢«åˆ›å»ºï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è°ƒç”¨ start() æ–¹æ³• RUNNABLE å½“è°ƒç”¨äº† start() æ–¹æ³•ä¹‹åï¼Œæ³¨æ„ï¼ŒJava API å±‚é¢çš„ RUNNABLE çŠ¶æ€æ¶µç›–äº† æ“ä½œç³»ç»Ÿ å±‚é¢çš„ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ã€ã€è¿è¡ŒçŠ¶æ€ã€‘å’Œã€é˜»å¡çŠ¶æ€ã€‘ï¼ˆç”±äºBIOå¯¼è‡´çš„çº¿ç¨‹é˜»å¡ï¼Œåœ¨Javaé‡Œæ— æ³•åŒºåˆ†ï¼Œä»ç„¶è®¤ä¸ºæ˜¯å¯è¿è¡Œï¼‰ BLOCKED ï¼Œ WAITING ï¼Œ TIMED_WAITING éƒ½æ˜¯ Java API å±‚é¢å¯¹ã€é˜»å¡çŠ¶æ€ã€‘çš„ç»†åˆ† TERMINATED å½“çº¿ç¨‹ä»£ç è¿è¡Œç»“æŸ","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://www.codetool.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"leetcode496-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ I","slug":"leetcode496-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ I","date":"2020-01-30T18:38:53.000Z","updated":"2020-02-20T14:55:21.052Z","comments":true,"path":"article/leetcode496-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ I/","link":"","permalink":"https://www.codetool.top/article/leetcode496-%E4%B8%8B%E4%B8%80%E4%B8%AA%E6%9B%B4%E5%A4%A7%E5%85%83%E7%B4%A0I/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸¤ä¸ªæ²¡æœ‰é‡å¤å…ƒç´ çš„æ•°ç»„ nums1 å’Œ nums2 ï¼Œå…¶ä¸­nums1 æ˜¯ nums2 çš„å­é›†ã€‚æ‰¾åˆ° nums1 ä¸­æ¯ä¸ªå…ƒç´ åœ¨ nums2 ä¸­çš„ä¸‹ä¸€ä¸ªæ¯”å…¶å¤§çš„å€¼ã€‚ nums1 ä¸­æ•°å­— x çš„ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ æ˜¯æŒ‡ x åœ¨ nums2 ä¸­å¯¹åº”ä½ç½®çš„å³è¾¹çš„ç¬¬ä¸€ä¸ªæ¯” x å¤§çš„å…ƒç´ ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œå¯¹åº”ä½ç½®è¾“å‡º-1ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š nums1 = [4,1,2], nums2 = [1,3,4,2].è¾“å‡ºï¼š [-1,3,-1]è§£é‡Šï¼š&nbsp;&nbsp;&nbsp;&nbsp;å¯¹äºnum1ä¸­çš„æ•°å­—4ï¼Œä½ æ— æ³•åœ¨ç¬¬äºŒä¸ªæ•°ç»„ä¸­æ‰¾åˆ°ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°å­—ï¼Œå› æ­¤è¾“å‡º -1ã€‚&nbsp;&nbsp;&nbsp;&nbsp;å¯¹äºnum1ä¸­çš„æ•°å­—1ï¼Œç¬¬äºŒä¸ªæ•°ç»„ä¸­æ•°å­—1å³è¾¹çš„ä¸‹ä¸€ä¸ªè¾ƒå¤§æ•°å­—æ˜¯ 3ã€‚&nbsp;&nbsp;&nbsp;&nbsp;å¯¹äºnum1ä¸­çš„æ•°å­—2ï¼Œç¬¬äºŒä¸ªæ•°ç»„ä¸­æ²¡æœ‰ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°å­—ï¼Œå› æ­¤è¾“å‡º -1ã€‚ ç¤ºä¾‹2: è¾“å…¥ï¼š nums1 = [2,4], nums2 = [1,2,3,4].è¾“å‡ºï¼š [3,-1]è§£é‡Šï¼š&nbsp;&nbsp;&nbsp;&nbsp;å¯¹äºnum1ä¸­çš„æ•°å­—2ï¼Œç¬¬äºŒä¸ªæ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªè¾ƒå¤§æ•°å­—æ˜¯3ã€‚&nbsp;&nbsp;&nbsp;&nbsp;å¯¹äºnum1ä¸­çš„æ•°å­—4ï¼Œç¬¬äºŒä¸ªæ•°ç»„ä¸­æ²¡æœ‰ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°å­—ï¼Œå› æ­¤è¾“å‡º -1ã€‚ 2 è§£æ³•2.1 æ€æƒ³å•è°ƒæ ˆï¼Œç»´æŒä¸€ä¸ªé€’å‡çš„æ ˆï¼Œé‡åˆ°ä¸€ä¸ªæ¯”æ ˆé¡¶å…ƒç´ å€¼å¤§çš„å…ƒç´ å¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼Œç›´åˆ°æ ˆé¡¶å…ƒç´ æ¯”è¯¥å…ƒç´ å€¼å¤§ï¼Œå‹å…¥è¯¥å…ƒç´ ã€‚ 2.2 ä»£ç class Solution { public int[] nextGreaterElement(int[] nums1, int[] nums2) { Map&lt;Integer,Integer> map = new HashMap&lt;>(); Stack&lt;Integer> stack = new Stack&lt;>(); int ans[] = new int[nums1.length]; for(int i=0;i&lt;nums2.length;i++){ while(!stack.isEmpty()&amp;&amp;nums2[i]>stack.peek()) map.put(stack.pop(),nums2[i]); stack.push(nums2[i]); } for(int i = 0;i&lt;nums1.length;i++){ ans[i] = map.getOrDefault(nums1[i],-1); } return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°13","slug":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°13","date":"2020-01-30T08:08:33.000Z","updated":"2020-04-22T09:10:11.886Z","comments":true,"path":"article/æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°13/","link":"","permalink":"https://www.codetool.top/article/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%AC%AC%E4%B8%89%E7%89%88%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B013/","excerpt":"","text":"ä»¥ä¸‹æ˜¯ç¬¬åä¸‰ç«  Javaå†…å­˜æ¨¡å‹ä¸çº¿ç¨‹çš„å†…å®¹ 1 çº¿ç¨‹å®‰å…¨å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœä¸ç”¨è€ƒè™‘è¿™äº›çº¿ç¨‹åœ¨è¿è¡Œæ—¶ç¯å¢ƒä¸‹çš„è°ƒåº¦å’Œäº¤æ›¿æ‰§è¡Œï¼Œä¹Ÿä¸éœ€è¦è¿›è¡Œé¢å¤–çš„åŒæ­¥ï¼Œæˆ–è€…åœ¨è°ƒç”¨æ–¹è¿›è¡Œä»»ä½•å…¶ä»–çš„åè°ƒæ“ä½œï¼Œè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„è¡Œä¸ºéƒ½å¯ä»¥è·å¾—æ­£ç¡®çš„ç»“æœï¼Œé‚£å°±ç§°è¿™ä¸ªå¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ 1.1 Javaè¯­è¨€ä¸­çš„çº¿ç¨‹å®‰å…¨æˆ‘ä»¬å¯ä»¥å°†Javaè¯­è¨€ä¸­å„ç§æ“ä½œå…±äº«çš„æ•°æ®åˆ†ä¸ºä»¥ä¸‹äº”ç±»ï¼šä¸å¯å˜ã€ç»å¯¹çº¿ç¨‹å®‰å…¨ã€ç›¸å¯¹çº¿ç¨‹å®‰å…¨ã€çº¿ç¨‹å…¼å®¹å’Œçº¿ç¨‹å¯¹ç«‹ã€‚ 1.1.1 ä¸å¯å˜ä¸å¯å˜çš„å¯¹è±¡ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œâ€œä¸å¯å˜â€å¸¦æ¥çš„å®‰å…¨æ€§æ˜¯æœ€ç›´æ¥ã€æœ€çº¯ç²¹çš„ã€‚ Javaè¯­è¨€ä¸­ï¼Œå¦‚æœå¤šçº¿ç¨‹å…±äº«çš„æ•°æ®æ˜¯ä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹ï¼Œé‚£ä¹ˆåªè¦åœ¨å®šä¹‰æ—¶ä½¿ç”¨finalå…³é”®å­—ä¿®é¥°å®ƒå°±å¯ä»¥ä¿è¯å®ƒæ˜¯ä¸å¯å˜çš„ã€‚å¦‚æœå…±äº«æ•°æ®æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”±äºJavaè¯­è¨€ç›®å‰æš‚æ—¶è¿˜æ²¡æœ‰æä¾›å€¼ç±»å‹çš„æ”¯æŒï¼Œé‚£å°±éœ€è¦å¯¹è±¡è‡ªè¡Œä¿è¯å…¶è¡Œä¸ºä¸ä¼šå¯¹å…¶çŠ¶æ€äº§ç”Ÿä»»ä½•å½±å“æ‰è¡Œã€‚ Stringå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¸å¯å˜å¯¹è±¡ã€‚ 1.1.2 ç»å¯¹çº¿ç¨‹å®‰å…¨ä¸ç®¡è¿è¡Œæ—¶ç¯å¢ƒå¦‚ä½•ï¼Œè°ƒç”¨è€…éƒ½ä¸éœ€è¦ä»»ä½•é¢å¤–çš„åŒæ­¥æªæ–½ï¼Œå³ä½¿åœ¨æ–¹æ³•è°ƒç”¨ç«¯ã€‚ 1.1.3 ç›¸å¯¹çº¿ç¨‹å®‰å…¨ç›¸å¯¹çº¿ç¨‹å®‰å…¨å°±æ˜¯æˆ‘ä»¬é€šå¸¸æ„ä¹‰ä¸Šæ‰€è®²çš„çº¿ç¨‹å®‰å…¨ï¼Œå®ƒéœ€è¦ä¿è¯å¯¹è¿™ä¸ªå¯¹è±¡å•æ¬¡çš„æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨çš„æ—¶å€™ä¸éœ€è¦è¿›è¡Œé¢å¤–çš„ä¿éšœæªæ–½ï¼Œä½†æ˜¯å¯¹äºä¸€äº›ç‰¹å®šé¡ºåºçš„è¿ç»­è°ƒç”¨ï¼Œå°±å¯èƒ½éœ€è¦åœ¨è°ƒç”¨ç«¯ä½¿ç”¨é¢å¤–çš„åŒæ­¥æ‰‹æ®µæ¥ä¿è¯è°ƒç”¨çš„æ­£ç¡®æ€§ã€‚ 1.1.4 çº¿ç¨‹å…¼å®¹å¯¹è±¡æœ¬èº«å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡åœ¨è°ƒç”¨ç«¯æ­£ç¡®åœ°ä½¿ç”¨åŒæ­¥æ‰‹æ®µæ¥ä¿è¯å¯¹è±¡åœ¨å¹¶å‘ç¯å¢ƒä¸­å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ã€‚æˆ‘ä»¬å¹³å¸¸è¯´ä¸€ä¸ªç±»ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé€šå¸¸å°±æ˜¯æŒ‡è¿™ç§æƒ…å†µã€‚Javaç±»åº“APIä¸­å¤§éƒ¨åˆ†çš„ç±»éƒ½æ˜¯çº¿ç¨‹å…¼å®¹çš„ï¼Œå¦‚ä¸å‰é¢çš„Vectorå’ŒHashTableç›¸å¯¹åº”çš„é›†åˆç±»ArrayListå’ŒHashMapç­‰ã€‚ 1.1.5 çº¿ç¨‹å¯¹ç«‹çº¿ç¨‹å¯¹ç«‹æ˜¯æŒ‡ä¸ç®¡è°ƒç”¨ç«¯æ˜¯å¦é‡‡å–äº†åŒæ­¥æªæ–½ï¼Œéƒ½æ— æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å¹¶å‘ä½¿ç”¨ä»£ç ã€‚ç”±äºJavaè¯­è¨€å¤©ç”Ÿå°±æ”¯æŒå¤šçº¿ç¨‹çš„ç‰¹æ€§ï¼Œçº¿ç¨‹å¯¹ç«‹è¿™ç§æ’æ–¥å¤šçº¿ç¨‹çš„ä»£ç æ˜¯å¾ˆå°‘å‡ºç°çš„ï¼Œè€Œä¸”é€šå¸¸éƒ½æ˜¯æœ‰å®³çš„ï¼Œåº”å½“å°½é‡é¿å…ã€‚ä¸€ä¸ªçº¿ç¨‹å¯¹ç«‹çš„ä¾‹å­æ˜¯Threadç±»çš„suspend()å’Œresume()æ–¹æ³•ã€‚å¦‚æœæœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æŒæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œä¸€ä¸ªå°è¯•å»ä¸­æ–­çº¿ç¨‹ï¼Œä¸€ä¸ªå°è¯•å»æ¢å¤çº¿ç¨‹ï¼Œåœ¨å¹¶å‘è¿›è¡Œçš„æƒ…å†µä¸‹ï¼Œæ— è®ºè°ƒç”¨æ—¶æ˜¯å¦è¿›è¡Œäº†åŒæ­¥ï¼Œç›®æ ‡çº¿ç¨‹éƒ½å­˜åœ¨æ­»é”é£é™©â€”â€”å‡å¦‚suspend()ä¸­æ–­çš„çº¿ç¨‹å°±æ˜¯å³å°†è¦æ‰§è¡Œresume()çš„é‚£ä¸ªçº¿ç¨‹ï¼Œé‚£å°±è‚¯å®šè¦äº§ç”Ÿæ­»é”äº†ã€‚ä¹Ÿæ­£æ˜¯è¿™ä¸ªåŸå› ï¼Œsuspend()å’Œresume()æ–¹æ³•éƒ½å·²ç»è¢«å£°æ˜åºŸå¼ƒäº†ã€‚å¸¸è§çš„çº¿ç¨‹å¯¹ç«‹çš„æ“ä½œè¿˜æœ‰System.setIn()ã€System.setOut()å’ŒSystem.runFinalizersOnExit()ç­‰ã€‚ 1.2 çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•1.2.1 äº’æ–¥åŒæ­¥äº’æ–¥åŒæ­¥æ˜¯ä¸€ç§æœ€å¸¸è§ä¹Ÿæ˜¯æœ€ä¸»è¦çš„å¹¶å‘æ­£ç¡®æ€§ä¿éšœæ‰‹æ®µã€‚åŒæ­¥æ˜¯æŒ‡åœ¨å¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®å…±äº«æ•°æ®æ—¶ï¼Œä¿è¯å…±äº«æ•°æ®åœ¨åŒä¸€ä¸ªæ—¶åˆ»åªè¢«ä¸€æ¡ï¼ˆæˆ–è€…æ˜¯ä¸€äº›ï¼Œå½“ä½¿ç”¨ä¿¡å·é‡çš„æ—¶å€™ï¼‰çº¿ç¨‹ä½¿ç”¨ã€‚è€Œäº’æ–¥æ˜¯å®ç°åŒæ­¥çš„ä¸€ç§æ‰‹æ®µï¼Œä¸´ç•ŒåŒºã€äº’æ–¥é‡å’Œä¿¡å·é‡éƒ½æ˜¯å¸¸è§çš„äº’æ–¥å®ç°æ–¹å¼ã€‚å› æ­¤åœ¨â€œäº’æ–¥åŒæ­¥â€è¿™å››ä¸ªå­—é‡Œé¢ï¼Œäº’æ–¥æ˜¯å› ï¼ŒåŒæ­¥æ˜¯æœï¼›äº’æ–¥æ˜¯æ–¹æ³•ï¼ŒåŒæ­¥æ˜¯ç›®çš„ã€‚ åœ¨Javaé‡Œé¢ï¼Œæœ€åŸºæœ¬çš„äº’æ–¥åŒæ­¥æ‰‹æ®µå°±æ˜¯synchronizedå…³é”®å­—ï¼Œè¿™æ˜¯ä¸€ç§å—ç»“æ„çš„åŒæ­¥è¯­æ³•ã€‚synchronizedå…³é”®å­—ç»è¿‡Javacç¼–è¯‘ä¹‹åï¼Œä¼šåœ¨åŒæ­¥å—çš„å‰ååˆ†åˆ«å½¢æˆmonitorenterå’Œmonitorexitè¿™ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤ã€‚è¿™ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤éƒ½éœ€è¦ä¸€ä¸ªreferenceç±»å‹çš„å‚æ•°æ¥æŒ‡æ˜è¦é”å®šå’Œè§£é”çš„å¯¹è±¡ã€‚å¦‚æœJavaæºç ä¸­çš„synchronizedæ˜ç¡®æŒ‡å®šäº†å¯¹è±¡å‚æ•°ï¼Œé‚£å°±ä»¥è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ä½œä¸ºreferenceï¼›å¦‚æœæ²¡æœ‰æ˜ç¡®æŒ‡å®šï¼Œé‚£å°†æ ¹æ®synchronizedä¿®é¥°çš„æ–¹æ³•ç±»å‹ï¼ˆå¦‚å®ä¾‹æ–¹æ³•æˆ–ç±»æ–¹æ³•ï¼‰ï¼Œæ¥å†³å®šæ˜¯å–ä»£ç æ‰€åœ¨çš„å¯¹è±¡å®ä¾‹è¿˜æ˜¯å–ç±»å‹å¯¹åº”çš„Classå¯¹è±¡æ¥ä½œä¸ºçº¿ç¨‹è¦æŒæœ‰çš„é”ã€‚ æ³¨æ„ï¼š è¢«synchronizedä¿®é¥°çš„åŒæ­¥å—å¯¹åŒä¸€æ¡çº¿ç¨‹æ¥è¯´æ˜¯å¯é‡å…¥çš„ã€‚è¿™æ„å‘³ç€åŒä¸€çº¿ç¨‹åå¤è¿›å…¥åŒæ­¥å—ä¹Ÿä¸ä¼šå‡ºç°è‡ªå·±æŠŠè‡ªå·±é”æ­»çš„æƒ…å†µã€‚ è¢«synchronizedä¿®é¥°çš„åŒæ­¥å—åœ¨æŒæœ‰é”çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å¹¶é‡Šæ”¾é”ä¹‹å‰ï¼Œä¼šæ— æ¡ä»¶åœ°é˜»å¡åé¢å…¶ä»–çº¿ç¨‹çš„è¿›å…¥ã€‚è¿™æ„å‘³ç€æ— æ³•åƒå¤„ç†æŸäº›æ•°æ®åº“ä¸­çš„é”é‚£æ ·ï¼Œå¼ºåˆ¶å·²è·å–é”çš„çº¿ç¨‹é‡Šæ”¾é”ï¼›ä¹Ÿæ— æ³•å¼ºåˆ¶æ­£åœ¨ç­‰å¾…é”çš„çº¿ç¨‹ä¸­æ–­ç­‰å¾…æˆ–è¶…æ—¶é€€å‡ºã€‚ ä»æ‰§è¡Œæˆæœ¬çš„è§’åº¦çœ‹ï¼ŒæŒæœ‰é”æ˜¯ä¸€ä¸ªé‡é‡çº§çš„æ“ä½œã€‚Javaå¦‚æœè¦é˜»å¡æˆ–å”¤é†’ä¸€æ¡çº¿ç¨‹ï¼Œåˆ™éœ€è¦æ“ä½œç³»ç»Ÿæ¥å¸®å¿™å®Œæˆï¼Œè¿™å°±ä¸å¯é¿å…åœ°é™·å…¥ç”¨æˆ·æ€åˆ°æ ¸å¿ƒæ€çš„è½¬æ¢ä¸­ï¼Œè¿›è¡Œè¿™ç§çŠ¶æ€è½¬æ¢éœ€è¦è€—è´¹å¾ˆå¤šçš„å¤„ç†å™¨æ—¶é—´ã€‚æ‰€ä»¥è¯´synchronizedæ˜¯Javaçš„ä¸€ä¸ªé‡é‡çº§æ“ä½œã€‚è€Œè™šæ‹Ÿæœºæœ¬èº«ä¹Ÿä¼šè¿›è¡Œä¸€äº›ä¼˜åŒ–ï¼Œè­¬å¦‚åœ¨é€šçŸ¥æ“ä½œç³»ç»Ÿé˜»å¡çº¿ç¨‹ä¹‹å‰åŠ å…¥ä¸€æ®µè‡ªæ—‹ç­‰å¾…è¿‡ç¨‹ï¼Œä»¥é¿å…é¢‘ç¹åœ°åˆ‡å…¥æ ¸å¿ƒæ€ä¹‹ä¸­ã€‚ è‡ªJDK 5èµ·ï¼ŒJavaç±»åº“ä¸­æ–°æä¾›äº†java.util.concurrentåŒ…ï¼Œå…¶ä¸­çš„java.util.concurrent.locks.Lockæ¥å£ä¾¿æˆäº†Javaçš„å¦ä¸€ç§å…¨æ–°çš„äº’æ–¥åŒæ­¥æ‰‹æ®µã€‚åŸºäºLockæ¥å£ï¼Œç”¨æˆ·èƒ½å¤Ÿä»¥éå—ç»“æ„æ¥å®ç°äº’æ–¥åŒæ­¥ï¼Œä»è€Œæ‘†è„±äº†è¯­è¨€ç‰¹æ€§çš„æŸç¼šï¼Œæ”¹ä¸ºåœ¨ç±»åº“å±‚é¢å»å®ç°åŒæ­¥ï¼Œè¿™ä¹Ÿä¸ºæ—¥åæ‰©å±•å‡ºä¸åŒè°ƒåº¦ç®—æ³•ã€ä¸åŒç‰¹å¾ã€ä¸åŒæ€§èƒ½ã€ä¸åŒè¯­ä¹‰çš„å„ç§é”æä¾›äº†å¹¿é˜”çš„ç©ºé—´ã€‚ é‡å…¥é”ï¼ˆReentrantLockï¼‰æ˜¯Lockæ¥å£æœ€å¸¸è§çš„ä¸€ç§å®ç°ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒä¸synchronizedä¸€æ ·æ˜¯å¯é‡å…¥çš„ã€‚åœ¨åŸºæœ¬ç”¨æ³•ä¸Šï¼ŒReentrantLockä¹Ÿä¸synchronizedå¾ˆç›¸ä¼¼ï¼Œåªæ˜¯ä»£ç å†™æ³•ä¸Šç¨æœ‰åŒºåˆ«è€Œå·²ã€‚ä¸è¿‡ï¼ŒReentrantLockä¸synchronizedç›¸æ¯”å¢åŠ äº†ä¸€äº›é«˜çº§åŠŸèƒ½ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸‰é¡¹ï¼š ç­‰å¾…å¯ä¸­æ–­ï¼šæ˜¯æŒ‡å½“æŒæœ‰é”çš„çº¿ç¨‹é•¿æœŸä¸é‡Šæ”¾é”çš„æ—¶å€™ï¼Œæ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹å¯ä»¥é€‰æ‹©æ”¾å¼ƒç­‰å¾…ï¼Œæ”¹ä¸ºå¤„ç†å…¶ä»–äº‹æƒ…ã€‚ å¯ä¸­æ–­ç‰¹æ€§å¯¹å¤„ç†æ‰§è¡Œæ—¶é—´éå¸¸é•¿çš„åŒæ­¥å—å¾ˆæœ‰å¸®åŠ©ã€‚ å…¬å¹³é”ï¼šæ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…åŒä¸€ä¸ªé”æ—¶ï¼Œå¿…é¡»æŒ‰ç…§ç”³è¯·é”çš„æ—¶é—´é¡ºåºæ¥ä¾æ¬¡è·å¾—é”ï¼›è€Œéå…¬å¹³é”åˆ™ä¸ä¿è¯è¿™ä¸€ç‚¹ï¼Œåœ¨é”è¢«é‡Šæ”¾æ—¶ï¼Œä»»ä½•ä¸€ä¸ªç­‰å¾…é”çš„çº¿ç¨‹éƒ½æœ‰æœºä¼šè·å¾—é”ã€‚synchronizedä¸­çš„é”æ˜¯éå…¬å¹³çš„ï¼ŒReentrantLockåœ¨é»˜è®¤æƒ…å†µä¸‹ä¹Ÿæ˜¯éå…¬å¹³çš„ï¼Œä½†å¯ä»¥é€šè¿‡å¸¦å¸ƒå°”å€¼çš„æ„é€ å‡½æ•°è¦æ±‚ä½¿ç”¨å…¬å¹³é”ã€‚ä¸è¿‡ä¸€æ—¦ä½¿ç”¨äº†å…¬å¹³é”ï¼Œå°†ä¼šå¯¼è‡´ReentrantLockçš„æ€§èƒ½æ€¥å‰§ä¸‹é™ï¼Œä¼šæ˜æ˜¾å½±å“ååé‡ã€‚ é”ç»‘å®šå¤šä¸ªæ¡ä»¶ï¼šæ˜¯æŒ‡ä¸€ä¸ªReentrantLockå¯¹è±¡å¯ä»¥åŒæ—¶ç»‘å®šå¤šä¸ªConditionå¯¹è±¡ã€‚ åœ¨synchronizedä¸­ï¼Œé”å¯¹è±¡çš„wait()è·Ÿå®ƒçš„notify()æˆ–è€…notifyAll()æ–¹æ³•é…åˆå¯ä»¥å®ç°ä¸€ä¸ªéšå«çš„æ¡ä»¶ï¼Œå¦‚æœè¦å’Œå¤šäºä¸€ä¸ªçš„æ¡ä»¶å…³è”çš„æ—¶å€™ï¼Œå°±ä¸å¾—ä¸é¢å¤–æ·»åŠ ä¸€ä¸ªé”ï¼›è€ŒReentrantLockåˆ™æ— é¡»è¿™æ ·åšï¼Œå¤šæ¬¡è°ƒç”¨newCondition()æ–¹æ³•å³å¯ã€‚ JDK6ä»¥åsynchronizedå’ŒReentrantLockçš„æ€§èƒ½å·®è·å·²ç»ä¸å¤§ã€‚ synchronizedçš„ä¼˜ç‚¹ï¼š synchronizedæ˜¯åœ¨Javaè¯­æ³•å±‚é¢çš„åŒæ­¥ï¼Œè¶³å¤Ÿæ¸…æ™°ï¼Œä¹Ÿè¶³å¤Ÿç®€å•ã€‚æ¯ä¸ªJavaç¨‹åºå‘˜éƒ½ç†Ÿæ‚‰ synchronizedï¼Œä½†J.U.Cä¸­çš„Lockæ¥å£åˆ™å¹¶éå¦‚æ­¤ã€‚å› æ­¤åœ¨åªéœ€è¦åŸºç¡€çš„åŒæ­¥åŠŸèƒ½æ—¶ï¼Œæ›´æ¨è synchronizedã€‚ Lockåº”è¯¥ç¡®ä¿åœ¨finallyå—ä¸­é‡Šæ”¾é”ï¼Œå¦åˆ™ä¸€æ—¦å—åŒæ­¥ä¿æŠ¤çš„ä»£ç å—ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™æœ‰å¯èƒ½æ°¸è¿œä¸ä¼šé‡Šæ”¾æŒæœ‰çš„é”ã€‚è¿™ä¸€ç‚¹å¿…é¡»ç”±ç¨‹åºå‘˜è‡ªå·±æ¥ä¿è¯ï¼Œè€Œä½¿ç”¨synchronizedçš„è¯åˆ™å¯ä»¥ç”±Javaè™šæ‹Ÿæœºæ¥ç¡®ä¿å³ä½¿å‡ºç°å¼‚å¸¸ï¼Œé”ä¹Ÿèƒ½è¢«è‡ªåŠ¨é‡Šæ”¾ã€‚ å°½ç®¡åœ¨JDK 5æ—¶ä»£ReentrantLockæ›¾ç»åœ¨æ€§èƒ½ä¸Šé¢†å…ˆè¿‡synchronizedï¼Œä½†è¿™å·²ç»æ˜¯åå¤šå¹´ä¹‹å‰çš„èƒœåˆ©äº†ã€‚ä»é•¿è¿œæ¥çœ‹ï¼ŒJavaè™šæ‹Ÿæœºæ›´å®¹æ˜“é’ˆå¯¹synchronizedæ¥è¿›è¡Œä¼˜åŒ–ï¼Œå› ä¸ºJavaè™šæ‹Ÿæœºå¯ä»¥åœ¨çº¿ç¨‹å’Œå¯¹è±¡çš„å…ƒæ•°æ®ä¸­è®°å½•synchronizedä¸­é”çš„ç›¸å…³ä¿¡æ¯ï¼Œè€Œä½¿ç”¨J.U.Cä¸­çš„Lockçš„è¯ï¼ŒJavaè™šæ‹Ÿæœºæ˜¯å¾ˆéš¾å¾—çŸ¥å…·ä½“å“ªäº›é”å¯¹è±¡æ˜¯ç”±ç‰¹å®šçº¿ç¨‹é”æŒæœ‰çš„ã€‚ 1.2.2 éé˜»å¡åŒæ­¥äº’æ–¥åŒæ­¥é¢ä¸´çš„ä¸»è¦é—®é¢˜æ˜¯è¿›è¡Œçº¿ç¨‹é˜»å¡å’Œå”¤é†’æ‰€å¸¦æ¥çš„æ€§èƒ½å¼€é”€ï¼Œå› æ­¤è¿™ç§åŒæ­¥ä¹Ÿè¢«ç§°ä¸ºé˜»å¡åŒæ­¥ï¼ˆBlocking Synchronizationï¼‰ã€‚ ä»è§£å†³é—®é¢˜çš„æ–¹å¼ä¸Šçœ‹ï¼Œäº’æ–¥åŒæ­¥å±äºä¸€ç§æ‚²è§‚çš„å¹¶å‘ç­–ç•¥ï¼Œå…¶æ€»æ˜¯è®¤ä¸ºåªè¦ä¸å»åšæ­£ç¡®çš„åŒæ­¥æªæ–½ï¼ˆä¾‹å¦‚åŠ é”ï¼‰ï¼Œé‚£å°±è‚¯å®šä¼šå‡ºç°é—®é¢˜ã€‚éšç€ç¡¬ä»¶æŒ‡ä»¤é›†çš„å‘å±•ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†å¦å¤–ä¸€ä¸ªé€‰æ‹©ï¼šåŸºäºå†²çªæ£€æµ‹çš„ä¹è§‚å¹¶å‘ç­–ç•¥ï¼Œé€šä¿—åœ°è¯´å°±æ˜¯ä¸ç®¡é£é™©ï¼Œå…ˆè¿›è¡Œæ“ä½œï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çº¿ç¨‹äº‰ç”¨å…±äº«æ•°æ®ï¼Œé‚£æ“ä½œå°±ç›´æ¥æˆåŠŸäº†ï¼›å¦‚æœå…±äº«çš„æ•°æ®çš„ç¡®è¢«äº‰ç”¨ï¼Œäº§ç”Ÿäº†å†²çªï¼Œé‚£å†è¿›è¡Œå…¶ä»–çš„è¡¥å¿æªæ–½ï¼Œæœ€å¸¸ç”¨çš„è¡¥å¿æªæ–½æ˜¯ä¸æ–­åœ°é‡è¯•ï¼Œç›´åˆ°å‡ºç°æ²¡æœ‰ç«äº‰çš„å…±äº«æ•°æ®ä¸ºæ­¢ã€‚è¿™ç§ä¹è§‚å¹¶å‘ç­–ç•¥çš„å®ç°ä¸å†éœ€è¦æŠŠçº¿ç¨‹é˜»å¡æŒ‚èµ·ï¼Œå› æ­¤è¿™ç§åŒæ­¥æ“ä½œè¢«ç§°ä¸ºéé˜»å¡åŒæ­¥ï¼Œä½¿ç”¨è¿™ç§æªæ–½çš„ä»£ç ä¹Ÿå¸¸è¢«ç§°ä¸ºæ— é”ç¼–ç¨‹ã€‚ ä¸ºäº†å®ç°ä¹è§‚å¹¶å‘ç­–ç•¥ï¼Œç¡¬ä»¶ä¿è¯æŸäº›ä»è¯­ä¹‰ä¸Šçœ‹èµ·æ¥éœ€è¦å¤šæ¬¡æ“ä½œçš„è¡Œä¸ºå¯ä»¥åªé€šè¿‡ä¸€æ¡å¤„ç†å™¨æŒ‡ä»¤å°±èƒ½å®Œæˆï¼Œè¿™ç±»æŒ‡ä»¤å¸¸ç”¨çš„æœ‰ï¼š æµ‹è¯•å¹¶è®¾ç½®ï¼ˆTest-and-Setï¼‰ è·å–å¹¶å¢åŠ ï¼ˆFetch-and-Incrementï¼‰ äº¤æ¢ï¼ˆSwapï¼‰ æ¯”è¾ƒå¹¶äº¤æ¢ï¼ˆCompare-and-Swapï¼Œç®€ç§°CASï¼‰ åŠ è½½é“¾æ¥/æ¡ä»¶å‚¨å­˜ï¼ˆLoad-Linked/Store-Conditionalï¼Œç®€ç§°LL/SCï¼‰ CASæŒ‡ä»¤éœ€è¦æœ‰ä¸‰ä¸ªæ“ä½œæ•°ï¼Œåˆ†åˆ«æ˜¯å†…å­˜ä½ç½®ï¼ˆåœ¨Javaä¸­å¯ä»¥ç®€å•åœ°ç†è§£ä¸ºå˜é‡çš„å†…å­˜åœ°å€ï¼Œç”¨Vè¡¨ç¤ºï¼‰ã€æ—§çš„é¢„æœŸå€¼ï¼ˆç”¨Aè¡¨ç¤ºï¼‰å’Œå‡†å¤‡è®¾ç½®çš„æ–°å€¼ï¼ˆç”¨Bè¡¨ç¤ºï¼‰ã€‚CASæŒ‡ä»¤æ‰§è¡Œæ—¶ï¼Œå½“ä¸”ä»…å½“Vç¬¦åˆAæ—¶ï¼Œå¤„ç†å™¨æ‰ä¼šç”¨Bæ›´æ–°Vçš„å€¼ï¼Œå¦åˆ™å®ƒå°±ä¸æ‰§è¡Œæ›´æ–°ã€‚ ä½†æ˜¯ï¼Œä¸ç®¡æ˜¯å¦æ›´æ–°äº†Vçš„å€¼ï¼Œéƒ½ä¼šè¿”å›Vçš„æ—§å€¼ï¼Œä¸Šè¿°çš„å¤„ç†è¿‡ç¨‹æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œæ‰§è¡ŒæœŸé—´ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹ä¸­æ–­ã€‚ åœ¨JDK 5ä¹‹åï¼Œsun.misc.Unsafeç±»é‡Œé¢çš„compareAndSwapInt()å’ŒcompareAndSwapLong()ç­‰å‡ ä¸ªæ–¹æ³•åŒ…è£…æä¾›CASæ“ä½œã€‚HotSpotè™šæ‹Ÿæœºåœ¨å†…éƒ¨å¯¹è¿™äº›æ–¹æ³•åšäº†ç‰¹æ®Šå¤„ç†ï¼Œå³æ—¶ç¼–è¯‘å‡ºæ¥çš„ç»“æœå°±æ˜¯ä¸€æ¡å¹³å°ç›¸å…³çš„å¤„ç†å™¨CASæŒ‡ä»¤ï¼Œæ²¡æœ‰æ–¹æ³•è°ƒç”¨çš„è¿‡ç¨‹ï¼Œæˆ–è€…å¯ä»¥è®¤ä¸ºæ˜¯æ— æ¡ä»¶å†…è”è¿›å»äº†ã€‚ä¸è¿‡ç”±äºUnsafeç±»åœ¨è®¾è®¡ä¸Šå°±ä¸æ˜¯æä¾›ç»™ç”¨æˆ·ç¨‹åºè°ƒç”¨çš„ç±»ï¼ˆUnsafe::getUnsafe()çš„ä»£ç ä¸­é™åˆ¶äº†åªæœ‰å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„Classæ‰èƒ½è®¿é—®å®ƒï¼‰ï¼Œå› æ­¤åœ¨JDK 9ä¹‹å‰åªæœ‰Javaç±»åº“å¯ä»¥ä½¿ç”¨CASã€‚è€Œå¦‚æœç”¨æˆ·ç¨‹åºä¹Ÿæœ‰ä½¿ç”¨CASæ“ä½œçš„éœ€æ±‚ï¼Œé‚£è¦ä¹ˆå°±é‡‡ç”¨åå°„æ‰‹æ®µçªç ´Unsafeçš„è®¿é—®é™åˆ¶ï¼Œè¦ä¹ˆå°±åªèƒ½é€šè¿‡Javaç±»åº“APIæ¥é—´æ¥ä½¿ç”¨å®ƒã€‚ç›´åˆ°JDK 9ä¹‹åï¼ŒJavaç±»åº“æ‰åœ¨VarHandleç±»é‡Œå¼€æ”¾äº†é¢å‘ç”¨æˆ·ç¨‹åºä½¿ç”¨çš„CASæ“ä½œã€‚ ä¾‹ï¼šï¼ˆä½¿ç”¨AtomicIntegerå®ç°åŸå­æ“ä½œï¼‰ CASå­˜åœ¨ä¸€ä¸ªé€»è¾‘æ¼æ´ï¼šå¦‚æœä¸€ä¸ªå˜é‡Våˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯Aå€¼ï¼Œå¹¶ä¸”åœ¨å‡†å¤‡èµ‹å€¼çš„æ—¶å€™æ£€æŸ¥åˆ°å®ƒä»ç„¶ä¸ºAå€¼ï¼Œä»æœ‰å¯èƒ½æ˜¯å› ä¸ºåœ¨è¿™æ®µæœŸé—´å®ƒçš„å€¼æ›¾ç»è¢«æ”¹æˆBï¼Œåæ¥åˆè¢«æ”¹å›ä¸ºAï¼Œé‚£CASæ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«æ”¹å˜è¿‡ã€‚è¿™ä¸ªæ¼æ´ç§°ä¸ºCASæ“ä½œçš„â€œABAé—®é¢˜â€ã€‚J.U.CåŒ…ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæä¾›äº†ä¸€ä¸ªå¸¦æœ‰æ ‡è®°çš„åŸå­å¼•ç”¨ç±»AtomicStampedReferenceï¼Œå®ƒå¯ä»¥é€šè¿‡æ§åˆ¶å˜é‡å€¼çš„ç‰ˆæœ¬æ¥ä¿è¯CASçš„æ­£ç¡®æ€§ã€‚ä¸è¿‡ç›®å‰æ¥è¯´è¿™ä¸ªç±»å¤„äºç›¸å½“é¸¡è‚‹çš„ä½ç½®ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ABAé—®é¢˜ä¸ä¼šå½±å“ç¨‹åºå¹¶å‘çš„æ­£ç¡®æ€§ï¼Œå¦‚æœéœ€è¦è§£å†³ABAé—®é¢˜ï¼Œæ”¹ç”¨ä¼ ç»Ÿçš„äº’æ–¥åŒæ­¥å¯èƒ½ä¼šæ¯”åŸå­ç±»æ›´ä¸ºé«˜æ•ˆã€‚ 1.2.3 æ— åŒæ­¥æ–¹æ¡ˆæœ‰ä¸€äº›ä»£ç å¤©ç”Ÿå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼š å¯é‡å…¥ä»£ç ï¼šå¯ä»¥åœ¨ä»£ç æ‰§è¡Œçš„ä»»ä½•æ—¶åˆ»ä¸­æ–­å®ƒï¼Œè½¬è€Œå»æ‰§è¡Œå¦å¤–ä¸€æ®µä»£ç ï¼ˆåŒ…æ‹¬é€’å½’è°ƒç”¨å®ƒæœ¬èº«ï¼‰ï¼Œè€Œåœ¨æ§åˆ¶æƒè¿”å›åï¼ŒåŸæ¥çš„ç¨‹åºä¸ä¼šå‡ºç°ä»»ä½•é”™è¯¯ï¼Œä¹Ÿä¸ä¼šå¯¹ç»“æœæœ‰æ‰€å½±å“ã€‚ çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼šå¦‚æœä¸€æ®µä»£ç ä¸­æ‰€éœ€è¦çš„æ•°æ®å¿…é¡»ä¸å…¶ä»–ä»£ç å…±äº«ï¼Œé‚£å°±çœ‹çœ‹è¿™äº›å…±äº«æ•°æ®çš„ä»£ç æ˜¯å¦èƒ½ä¿è¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚å¦‚æœèƒ½ä¿è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå…±äº«æ•°æ®çš„å¯è§èŒƒå›´é™åˆ¶åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¹‹å†…ï¼Œè¿™æ ·ï¼Œæ— é¡»åŒæ­¥ä¹Ÿèƒ½ä¿è¯çº¿ç¨‹ä¹‹é—´ä¸å‡ºç°æ•°æ®äº‰ç”¨çš„é—®é¢˜ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡java.lang.ThreadLocalç±»æ¥å®ç°çº¿ç¨‹æœ¬åœ°å­˜å‚¨çš„åŠŸèƒ½ã€‚æ¯ä¸€ä¸ªçº¿ç¨‹çš„Threadå¯¹è±¡ä¸­éƒ½æœ‰ä¸€ä¸ªThreadLocalMapå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å­˜å‚¨äº†ä¸€ç»„ä»¥ThreadLocal.threadLocalHashCodeä¸ºé”®ï¼Œä»¥æœ¬åœ°çº¿ç¨‹å˜é‡ä¸ºå€¼çš„K-Vå€¼å¯¹ã€‚ 2 é”ä¼˜åŒ–2.1 è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹ç°åœ¨ç»å¤§å¤šæ•°çš„ä¸ªäººç”µè„‘å’ŒæœåŠ¡å™¨éƒ½æ˜¯å¤šè·¯ï¼ˆæ ¸ï¼‰å¤„ç†å™¨ç³»ç»Ÿï¼Œå¦‚æœç‰©ç†æœºå™¨æœ‰ä¸€ä¸ªä»¥ä¸Šçš„å¤„ç†å™¨æˆ–è€…å¤„ç†å™¨æ ¸å¿ƒï¼Œèƒ½è®©ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„çº¿ç¨‹åŒæ—¶å¹¶è¡Œæ‰§è¡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥è®©åé¢è¯·æ±‚é”çš„é‚£ä¸ªçº¿ç¨‹â€œç¨ç­‰ä¸€ä¼šâ€ï¼Œä½†ä¸æ”¾å¼ƒå¤„ç†å™¨çš„æ‰§è¡Œæ—¶é—´ï¼Œçœ‹çœ‹æŒæœ‰é”çš„çº¿ç¨‹æ˜¯å¦å¾ˆå¿«å°±ä¼šé‡Šæ”¾é”ã€‚ä¸ºäº†è®©çº¿ç¨‹ç­‰å¾…ï¼Œæˆ‘ä»¬åªé¡»è®©çº¿ç¨‹æ‰§è¡Œä¸€ä¸ªå¿™å¾ªç¯ï¼ˆè‡ªæ—‹ï¼‰ï¼Œè¿™é¡¹æŠ€æœ¯å°±æ˜¯æ‰€è°“çš„è‡ªæ—‹é”ã€‚ è‡ªæ—‹ç­‰å¾…çš„æ—¶é—´æœ‰ä¸€å®šçš„é™åº¦ï¼Œå¦‚æœè‡ªæ—‹è¶…è¿‡äº†é™å®šçš„æ¬¡æ•°ä»ç„¶æ²¡æœ‰æˆåŠŸè·å¾—é”ï¼Œå°±åº”å½“ä½¿ç”¨ä¼ ç»Ÿçš„æ–¹å¼å»æŒ‚èµ·çº¿ç¨‹ï¼Œé»˜è®¤å€¼æ˜¯åæ¬¡ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥ä½¿ç”¨å‚æ•°-XXï¼šPreBlockSpinæ¥è‡ªè¡Œæ›´æ”¹ã€‚ JDK 6ä¸­å¼•å…¥äº†è‡ªé€‚åº”çš„è‡ªæ—‹ã€‚è‡ªé€‚åº”æ„å‘³ç€è‡ªæ—‹çš„æ—¶é—´ä¸å†æ˜¯å›ºå®šçš„äº†ï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šçš„ã€‚å¦‚æœåœ¨åŒä¸€ä¸ªé”å¯¹è±¡ä¸Šï¼Œè‡ªæ—‹ç­‰å¾…åˆšåˆšæˆåŠŸè·å¾—è¿‡é”ï¼Œå¹¶ä¸”æŒæœ‰é”çš„çº¿ç¨‹æ­£åœ¨è¿è¡Œä¸­ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°±ä¼šè®¤ä¸ºè¿™æ¬¡è‡ªæ—‹ä¹Ÿå¾ˆæœ‰å¯èƒ½å†æ¬¡æˆåŠŸï¼Œè¿›è€Œå…è®¸è‡ªæ—‹ç­‰å¾…æŒç»­ç›¸å¯¹æ›´é•¿çš„æ—¶é—´ï¼Œæ¯”å¦‚æŒç»­100æ¬¡å¿™å¾ªç¯ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœå¯¹äºæŸä¸ªé”ï¼Œè‡ªæ—‹å¾ˆå°‘æˆåŠŸè·å¾—è¿‡é”ï¼Œé‚£åœ¨ä»¥åè¦è·å–è¿™ä¸ªé”æ—¶å°†æœ‰å¯èƒ½ç›´æ¥çœç•¥æ‰è‡ªæ—‹è¿‡ç¨‹ï¼Œä»¥é¿å…æµªè´¹å¤„ç†å™¨èµ„æºã€‚ 2.2 é”æ¶ˆé™¤é”æ¶ˆé™¤æ˜¯æŒ‡è™šæ‹Ÿæœºå³æ—¶ç¼–è¯‘å™¨åœ¨è¿è¡Œæ—¶ï¼Œå¯¹ä¸€äº›ä»£ç è¦æ±‚åŒæ­¥ï¼Œä½†æ˜¯å¯¹è¢«æ£€æµ‹åˆ°ä¸å¯èƒ½å­˜åœ¨å…±äº«æ•°æ®ç«äº‰çš„é”è¿›è¡Œæ¶ˆé™¤ã€‚å¦‚æœåˆ¤æ–­åˆ°ä¸€æ®µä»£ç ä¸­ï¼Œåœ¨å †ä¸Šçš„æ‰€æœ‰æ•°æ®éƒ½ä¸ä¼šé€ƒé€¸å‡ºå»è¢«å…¶ä»–çº¿ç¨‹è®¿é—®åˆ°ï¼Œé‚£å°±å¯ä»¥æŠŠå®ƒä»¬å½“ä½œæ ˆä¸Šæ•°æ®å¯¹å¾…ï¼Œè®¤ä¸ºå®ƒä»¬æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼ŒåŒæ­¥åŠ é”è‡ªç„¶å°±æ— é¡»å†è¿›è¡Œã€‚ 2.3 é”ç²—åŒ–é€šå¸¸ç¼–å†™ä»£ç æ—¶æ¨èå°†åŒæ­¥å—çš„ä½œç”¨èŒƒå›´é™åˆ¶å¾—å°½é‡å°ï¼Œä½†æ˜¯å¦‚æœä¸€ç³»åˆ—çš„è¿ç»­æ“ä½œéƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡åå¤åŠ é”å’Œè§£é”ï¼Œç”šè‡³åŠ é”æ“ä½œæ˜¯å‡ºç°åœ¨å¾ªç¯ä½“ä¹‹ä¸­çš„ï¼Œé‚£å³ä½¿æ²¡æœ‰çº¿ç¨‹ç«äº‰ï¼Œé¢‘ç¹åœ°è¿›è¡Œäº’æ–¥åŒæ­¥æ“ä½œä¹Ÿä¼šå¯¼è‡´ä¸å¿…è¦çš„æ€§èƒ½æŸè€—ã€‚ å¦‚æœè™šæ‹Ÿæœºæ¢æµ‹åˆ°æœ‰è¿™æ ·ä¸€ä¸²é›¶ç¢çš„æ“ä½œéƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡åŠ é”ï¼Œå°†ä¼šæŠŠåŠ é”åŒæ­¥çš„èŒƒå›´æ‰©å±•ï¼ˆç²—åŒ–ï¼‰åˆ°æ•´ä¸ªæ“ä½œåºåˆ—çš„å¤–éƒ¨ã€‚ 2.4 è½»é‡çº§é”è½»é‡çº§é”æ˜¯JDK 6æ—¶åŠ å…¥çš„æ–°å‹é”æœºåˆ¶ï¼Œâ€œè½»é‡çº§â€æ˜¯ç›¸å¯¹äºä½¿ç”¨æ“ä½œç³»ç»Ÿäº’æ–¥é‡æ¥å®ç°çš„ä¼ ç»Ÿé”è€Œè¨€çš„ï¼Œå› æ­¤ä¼ ç»Ÿçš„é”æœºåˆ¶å°±è¢«ç§°ä¸ºâ€œé‡é‡çº§â€é”ã€‚å®ƒè®¾è®¡çš„åˆè¡·æ˜¯åœ¨æ²¡æœ‰å¤šçº¿ç¨‹ç«äº‰çš„å‰æä¸‹ï¼Œå‡å°‘ä¼ ç»Ÿçš„é‡é‡çº§é”ä½¿ç”¨æ“ä½œç³»ç»Ÿäº’æ–¥é‡äº§ç”Ÿçš„æ€§èƒ½æ¶ˆè€—ã€‚ HotSpotè™šæ‹Ÿæœºçš„å¯¹è±¡å¤´åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚å“ˆå¸Œç ï¼ˆHashCodeï¼‰ã€GCåˆ†ä»£å¹´é¾„ç­‰ã€‚è¿™éƒ¨åˆ†æ•°æ®çš„é•¿åº¦åœ¨32ä½å’Œ64ä½çš„Javaè™šæ‹Ÿæœºä¸­åˆ†åˆ«ä¼šå ç”¨32ä¸ªæˆ–64ä¸ªæ¯”ç‰¹ï¼Œå®˜æ–¹ç§°å®ƒä¸ºâ€œMark Wordâ€ã€‚è¿™éƒ¨åˆ†æ˜¯å®ç°è½»é‡çº§é”å’Œåå‘é”çš„å…³é”®ã€‚å¦å¤–ä¸€éƒ¨åˆ†ç”¨äºå­˜å‚¨æŒ‡å‘æ–¹æ³•åŒºå¯¹è±¡ç±»å‹æ•°æ®çš„æŒ‡é’ˆï¼Œå¦‚æœæ˜¯æ•°ç»„å¯¹è±¡ï¼Œè¿˜ä¼šæœ‰ä¸€ä¸ªé¢å¤–çš„éƒ¨åˆ†ç”¨äºå­˜å‚¨æ•°ç»„é•¿åº¦ã€‚ è½»é‡çº§é”çš„å·¥ä½œè¿‡ç¨‹: åœ¨ä»£ç å³å°†è¿›å…¥åŒæ­¥å—çš„æ—¶å€™ï¼Œå¦‚æœæ­¤åŒæ­¥å¯¹è±¡æ²¡æœ‰è¢«é”å®šï¼ˆé”æ ‡å¿—ä½ä¸ºâ€œ01â€çŠ¶æ€ï¼‰ï¼Œè™šæ‹Ÿæœºé¦–å…ˆå°†åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªåä¸ºé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„Mark Wordçš„æ‹·è´ï¼ˆå®˜æ–¹ä¸ºè¿™ä»½æ‹·è´åŠ äº†ä¸€ä¸ªDisplacedå‰ç¼€ï¼Œå³Displaced Mark Wordï¼‰ï¼Œè¿™æ—¶å€™çº¿ç¨‹å †æ ˆä¸å¯¹è±¡å¤´çš„çŠ¶æ€å¦‚å›¾: ç„¶åï¼Œè™šæ‹Ÿæœºå°†ä½¿ç”¨CASæ“ä½œå°è¯•æŠŠå¯¹è±¡çš„Mark Wordæ›´æ–°ä¸ºæŒ‡å‘Lock Recordçš„æŒ‡é’ˆã€‚å¦‚æœè¿™ä¸ªæ›´æ–°åŠ¨ä½œæˆåŠŸäº†ï¼Œå³ä»£è¡¨è¯¥çº¿ç¨‹æ‹¥æœ‰äº†è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œå¹¶ä¸”å¯¹è±¡Mark Wordçš„é”æ ‡å¿—ä½ï¼ˆMark Wordçš„æœ€åä¸¤ä¸ªæ¯”ç‰¹ï¼‰å°†è½¬å˜ä¸ºâ€œ00â€ï¼Œè¡¨ç¤ºæ­¤å¯¹è±¡å¤„äºè½»é‡çº§é”å®šçŠ¶æ€ã€‚è¿™æ—¶å€™çº¿ç¨‹å †æ ˆä¸å¯¹è±¡å¤´çš„çŠ¶æ€å¦‚å›¾æ‰€ç¤º: å¦‚æœè¿™ä¸ªæ›´æ–°æ“ä½œå¤±è´¥äº†ï¼Œé‚£å°±æ„å‘³ç€è‡³å°‘å­˜åœ¨ä¸€æ¡çº¿ç¨‹ä¸å½“å‰çº¿ç¨‹ç«äº‰è·å–è¯¥å¯¹è±¡çš„é”ã€‚è™šæ‹Ÿæœºé¦–å…ˆä¼šæ£€æŸ¥å¯¹è±¡çš„Mark Wordæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆå¸§ï¼Œå¦‚æœæ˜¯ï¼Œè¯´æ˜å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œé‚£ç›´æ¥è¿›å…¥åŒæ­¥å—ç»§ç»­æ‰§è¡Œå°±å¯ä»¥äº†ï¼Œå¦åˆ™å°±è¯´æ˜è¿™ä¸ªé”å¯¹è±¡å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŠ¢å äº†ã€‚å¦‚æœå‡ºç°ä¸¤æ¡ä»¥ä¸Šçš„çº¿ç¨‹äº‰ç”¨åŒä¸€ä¸ªé”çš„æƒ…å†µï¼Œé‚£è½»é‡çº§é”å°±ä¸å†æœ‰æ•ˆï¼Œå¿…é¡»è¦è†¨èƒ€ä¸ºé‡é‡çº§é”ï¼Œé”æ ‡å¿—çš„çŠ¶æ€å€¼å˜ä¸ºâ€œ10â€ï¼Œæ­¤æ—¶Mark Wordä¸­å­˜å‚¨çš„å°±æ˜¯æŒ‡å‘é‡é‡çº§é”ï¼ˆäº’æ–¥é‡ï¼‰çš„æŒ‡é’ˆï¼Œåé¢ç­‰å¾…é”çš„çº¿ç¨‹ä¹Ÿå¿…é¡»è¿›å…¥é˜»å¡çŠ¶æ€ã€‚ è½»é‡çº§é”çš„è§£é”è¿‡ç¨‹åŒæ ·æ˜¯é€šè¿‡CASæ“ä½œæ¥è¿›è¡Œçš„ï¼Œå¦‚æœå¯¹è±¡çš„Mark Wordä»ç„¶æŒ‡å‘çº¿ç¨‹çš„é”è®°å½•ï¼Œé‚£å°±ç”¨CASæ“ä½œæŠŠå¯¹è±¡å½“å‰çš„Mark Wordå’Œçº¿ç¨‹ä¸­å¤åˆ¶çš„Displaced Mark Wordæ›¿æ¢å›æ¥ã€‚å‡å¦‚èƒ½å¤ŸæˆåŠŸæ›¿æ¢ï¼Œé‚£æ•´ä¸ªåŒæ­¥è¿‡ç¨‹å°±é¡ºåˆ©å®Œæˆäº†ï¼›å¦‚æœæ›¿æ¢å¤±è´¥ï¼Œåˆ™è¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹å°è¯•è¿‡è·å–è¯¥é”ï¼Œå°±è¦åœ¨é‡Šæ”¾é”çš„åŒæ—¶ï¼Œå”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹ã€‚ è½»é‡çº§é”èƒ½æå‡ç¨‹åºåŒæ­¥æ€§èƒ½çš„ä¾æ®æ˜¯â€œå¯¹äºç»å¤§éƒ¨åˆ†çš„é”ï¼Œåœ¨æ•´ä¸ªåŒæ­¥å‘¨æœŸå†…éƒ½æ˜¯ä¸å­˜åœ¨ç«äº‰çš„â€è¿™ä¸€ç»éªŒæ³•åˆ™ã€‚å¦‚æœæ²¡æœ‰ç«äº‰ï¼Œè½»é‡çº§é”ä¾¿é€šè¿‡CASæ“ä½œæˆåŠŸé¿å…äº†ä½¿ç”¨äº’æ–¥é‡çš„å¼€é”€ï¼›ä½†å¦‚æœç¡®å®å­˜åœ¨é”ç«äº‰ï¼Œé™¤äº†äº’æ–¥é‡çš„æœ¬èº«å¼€é”€å¤–ï¼Œè¿˜é¢å¤–å‘ç”Ÿäº†CASæ“ä½œçš„å¼€é”€ã€‚å› æ­¤åœ¨æœ‰ç«äº‰çš„æƒ…å†µä¸‹ï¼Œè½»é‡çº§é”åè€Œä¼šæ¯”ä¼ ç»Ÿçš„é‡é‡çº§é”æ›´æ…¢ã€‚ å¦‚æœå‘ç”Ÿé”é‡å…¥Mark Wordä¼šåå¤å…¥æ ˆã€‚ 2.5 åå‘é”åå‘é”ä¹Ÿæ˜¯JDK 6ä¸­å¼•å…¥çš„ä¸€é¡¹é”ä¼˜åŒ–æªæ–½ï¼Œå®ƒçš„ç›®çš„æ˜¯æ¶ˆé™¤æ•°æ®åœ¨æ— ç«äº‰æƒ…å†µä¸‹çš„åŒæ­¥åŸè¯­ï¼Œè¿›ä¸€æ­¥æé«˜ç¨‹åºçš„è¿è¡Œæ€§èƒ½ã€‚å¦‚æœè¯´è½»é‡çº§é”æ˜¯åœ¨æ— ç«äº‰çš„æƒ…å†µä¸‹ä½¿ç”¨CASæ“ä½œå»æ¶ˆé™¤åŒæ­¥ä½¿ç”¨çš„äº’æ–¥é‡ï¼Œé‚£åå‘é”å°±æ˜¯åœ¨æ— ç«äº‰çš„æƒ…å†µä¸‹æŠŠæ•´ä¸ªåŒæ­¥éƒ½æ¶ˆé™¤æ‰ï¼Œè¿CASæ“ä½œéƒ½ä¸å»åšäº†ã€‚ åå‘é”çš„æ„æ€æ˜¯è¿™ä¸ªé”ä¼šåå‘äºç¬¬ä¸€ä¸ªè·å¾—å®ƒçš„çº¿ç¨‹ï¼Œå¦‚æœåœ¨æ¥ä¸‹æ¥çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¯¥é”ä¸€ç›´æ²¡æœ‰è¢«å…¶ä»–çš„çº¿ç¨‹è·å–ï¼Œåˆ™æŒæœ‰åå‘é”çš„çº¿ç¨‹å°†æ°¸è¿œä¸éœ€è¦å†è¿›è¡ŒåŒæ­¥ã€‚ å‡è®¾å½“å‰è™šæ‹Ÿæœºå¯ç”¨äº†åå‘é”ï¼Œé‚£ä¹ˆå½“é”å¯¹è±¡ç¬¬ä¸€æ¬¡è¢«çº¿ç¨‹è·å–çš„æ—¶å€™ï¼Œè™šæ‹Ÿæœºå°†ä¼šæŠŠå¯¹è±¡å¤´ä¸­çš„æ ‡å¿—ä½è®¾ç½®ä¸ºâ€œ01â€ã€æŠŠåå‘æ¨¡å¼è®¾ç½®ä¸ºâ€œ1â€ï¼Œè¡¨ç¤ºè¿›å…¥åå‘æ¨¡å¼ã€‚åŒæ—¶ä½¿ç”¨CASæ“ä½œæŠŠè·å–åˆ°è¿™ä¸ªé”çš„çº¿ç¨‹çš„IDè®°å½•åœ¨å¯¹è±¡çš„Mark Wordä¹‹ä¸­ã€‚å¦‚æœCASæ“ä½œæˆåŠŸï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹ä»¥åæ¯æ¬¡è¿›å…¥è¿™ä¸ªé”ç›¸å…³çš„åŒæ­¥å—æ—¶ï¼Œè™šæ‹Ÿæœºéƒ½å¯ä»¥ä¸å†è¿›è¡Œä»»ä½•åŒæ­¥æ“ä½œã€‚ ä¸€æ—¦å‡ºç°å¦å¤–ä¸€ä¸ªçº¿ç¨‹å»å°è¯•è·å–è¿™ä¸ªé”çš„æƒ…å†µï¼Œåå‘æ¨¡å¼å°±é©¬ä¸Šå®£å‘Šç»“æŸã€‚æ ¹æ®é”å¯¹è±¡ç›®å‰æ˜¯å¦å¤„äºè¢«é”å®šçš„çŠ¶æ€å†³å®šæ˜¯å¦æ’¤é”€åå‘ï¼ˆåå‘æ¨¡å¼è®¾ç½®ä¸ºâ€œ0â€ï¼‰ï¼Œæ’¤é”€åæ ‡å¿—ä½æ¢å¤åˆ°æœªé”å®šï¼ˆæ ‡å¿—ä½ä¸ºâ€œ01â€ï¼‰æˆ–è½»é‡çº§é”å®šï¼ˆæ ‡å¿—ä½ä¸ºâ€œ00â€ï¼‰çš„çŠ¶æ€ï¼Œåç»­çš„åŒæ­¥æ“ä½œå°±æŒ‰ç…§ä¸Šé¢ä»‹ç»çš„è½»é‡çº§é”é‚£æ ·å»æ‰§è¡Œã€‚åå‘é”ã€è½»é‡çº§é”çš„çŠ¶æ€è½¬åŒ–åŠå¯¹è±¡Mark Wordçš„å…³ç³»å¦‚å›¾æ‰€ç¤ºï¼š å½“ä¸€ä¸ªå¯¹è±¡å·²ç»è®¡ç®—è¿‡ä¸€è‡´æ€§å“ˆå¸Œç åï¼Œå®ƒå°±å†ä¹Ÿæ— æ³•è¿›å…¥åå‘é”çŠ¶æ€äº†ï¼›è€Œå½“ä¸€ä¸ªå¯¹è±¡å½“å‰æ­£å¤„äºåå‘é”çŠ¶æ€ï¼Œåˆæ”¶åˆ°éœ€è¦è®¡ç®—å…¶ä¸€è‡´æ€§å“ˆå¸Œç è¯·æ±‚æ—¶ï¼Œå®ƒçš„åå‘çŠ¶æ€ä¼šè¢«ç«‹å³æ’¤é”€ï¼Œå¹¶ä¸”é”ä¼šè†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚åœ¨é‡é‡çº§é”çš„å®ç°ä¸­ï¼Œå¯¹è±¡å¤´æŒ‡å‘äº†é‡é‡çº§é”çš„ä½ç½®ï¼Œä»£è¡¨é‡é‡çº§é”çš„ObjectMonitorç±»é‡Œæœ‰å­—æ®µå¯ä»¥è®°å½•éåŠ é”çŠ¶æ€ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ01â€ï¼‰ä¸‹çš„Mark Wordï¼Œå…¶ä¸­è‡ªç„¶å¯ä»¥å­˜å‚¨åŸæ¥çš„å“ˆå¸Œç ã€‚ å¦‚æœç¨‹åºä¸­å¤§å¤šæ•°çš„é”éƒ½æ€»æ˜¯è¢«å¤šä¸ªä¸åŒçš„çº¿ç¨‹è®¿é—®ï¼Œé‚£åå‘æ¨¡å¼å°±æ˜¯å¤šä½™çš„ã€‚åœ¨å…·ä½“é—®é¢˜å…·ä½“åˆ†æçš„å‰æä¸‹ï¼Œæœ‰æ—¶å€™ä½¿ç”¨å‚æ•°-XXï¼š-UseBiasedLockingæ¥ç¦æ­¢åå‘é”ä¼˜åŒ–åè€Œå¯ä»¥æå‡æ€§èƒ½ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jvm","slug":"jvm","permalink":"https://www.codetool.top/tags/jvm/"}]},{"title":"leetcode456-132æ¨¡å¼","slug":"leetcode456-132æ¨¡å¼","date":"2020-01-29T18:19:44.000Z","updated":"2020-02-20T14:55:21.051Z","comments":true,"path":"article/leetcode456-132æ¨¡å¼/","link":"","permalink":"https://www.codetool.top/article/leetcode456-132%E6%A8%A1%E5%BC%8F/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ•´æ•°åºåˆ—ï¼ša1, a2, â€¦, anï¼Œä¸€ä¸ª132æ¨¡å¼çš„å­åºåˆ— ai, aj, ak è¢«å®šä¹‰ä¸ºï¼šå½“ i &lt; j &lt; k æ—¶ï¼Œai &lt; ak &lt; ajã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•ï¼Œå½“ç»™å®šæœ‰ n ä¸ªæ•°å­—çš„åºåˆ—æ—¶ï¼ŒéªŒè¯è¿™ä¸ªåºåˆ—ä¸­æ˜¯å¦å«æœ‰132æ¨¡å¼çš„å­åºåˆ—ã€‚ æ³¨æ„ï¼š n çš„å€¼å°äº15000ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š [1, 2, 3, 4]è¾“å‡ºï¼š Falseè§£é‡Šï¼š åºåˆ—ä¸­ä¸å­˜åœ¨132æ¨¡å¼çš„å­åºåˆ—ã€‚ ç¤ºä¾‹2: è¾“å…¥ï¼š [3, 1, 4, 2]è¾“å‡ºï¼š Trueè§£é‡Šï¼š åºåˆ—ä¸­æœ‰ 1 ä¸ª132æ¨¡å¼çš„å­åºåˆ—ï¼š [1, 4, 2]. ç¤ºä¾‹3: è¾“å…¥ï¼š [-1, 3, 2, 0]è¾“å‡ºï¼š Trueè§£é‡Šï¼š åºåˆ—ä¸­æœ‰ 3 ä¸ª132æ¨¡å¼çš„çš„å­åºåˆ—: [-1, 3, 2], [-1, 3, 0] å’Œ [-1, 2, 0]. 2 è§£æ³•2.1 æ€æƒ³ æš´åŠ›ï¼Œä»å°¾å‘å¤´éå†ï¼Œå¦‚æœå½“å‰å…ƒç´ æ˜¯132ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œåˆ™å‰é¢å’Œä¸­é—´ä¸€å®šåˆ†åˆ«æœ‰ä¸€ä¸ªå°äºå½“å‰å…ƒç´ çš„å…ƒç´ å’Œä¸€ä¸ªå¤§äºå½“å‰å…ƒç´ çš„å…ƒç´ ã€‚ æ ˆï¼Œå‚è€ƒ https://leetcode-cn.com/problems/132-pattern/solution/132mo-shi-by-leetcode-2/ 2.2 ä»£ç  æš´åŠ› class Solution { public boolean find132pattern(int[] nums) { for(int i = nums.length-1;i>=2;i--){ int tail = nums[i]; boolean hasPeek = false; for(int j = i-1;j>=0;j--){ if(nums[j]>tail) hasPeek = true; else if(hasPeek&amp;&amp;nums[j]&lt;tail) return true; } } return false; } } æ ˆ public class Solution { public boolean find132pattern(int[] nums) { if (nums.length &lt; 3) return false; Stack&lt;Integer> stack = new Stack&lt;>(); int[] min = new int[nums.length]; min[0] = nums[0]; for (int i = 1; i &lt; nums.length; i++) min[i] = Math.min(min[i - 1], nums[i]); for (int j = nums.length - 1; j >= 0; j--) { if (nums[j] > min[j]) { while (!stack.isEmpty() &amp;&amp; stack.peek() &lt;= min[j]) stack.pop(); if (!stack.isEmpty() &amp;&amp; stack.peek() &lt; nums[j]) return true; stack.push(nums[j]); } } return false; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°12","slug":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°12","date":"2020-01-29T08:25:14.000Z","updated":"2020-04-22T09:27:27.192Z","comments":true,"path":"article/æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°12/","link":"","permalink":"https://www.codetool.top/article/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%AC%AC%E4%B8%89%E7%89%88%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B012/","excerpt":"","text":"ä»¥ä¸‹æ˜¯ç¬¬åäºŒç«  Javaå†…å­˜æ¨¡å‹ä¸çº¿ç¨‹çš„å†…å®¹ 1 ç¡¬ä»¶çš„æ•ˆç‡ä¸ä¸€è‡´æ€§åŸºäºé«˜é€Ÿç¼“å­˜çš„å­˜å‚¨äº¤äº’å¾ˆå¥½åœ°è§£å†³äº†å¤„ç†å™¨ä¸å†…å­˜é€Ÿåº¦ä¹‹é—´çš„çŸ›ç›¾ï¼Œä½†æ˜¯ä¹Ÿä¸ºè®¡ç®—æœºç³»ç»Ÿå¸¦æ¥æ›´é«˜çš„å¤æ‚åº¦ï¼Œå®ƒå¼•å…¥äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼šç¼“å­˜ä¸€è‡´æ€§ã€‚åœ¨å¤šè·¯å¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰è‡ªå·±çš„é«˜é€Ÿç¼“å­˜ï¼Œè€Œå®ƒä»¬åˆå…±äº«åŒä¸€ä¸»å†…å­˜ã€‚å½“å¤šä¸ªå¤„ç†å™¨çš„è¿ç®—ä»»åŠ¡éƒ½æ¶‰åŠåŒä¸€å—ä¸»å†…å­˜åŒºåŸŸæ—¶ï¼Œå°†å¯èƒ½å¯¼è‡´å„è‡ªçš„ç¼“å­˜æ•°æ®ä¸ä¸€è‡´ã€‚ä¸ºäº†è§£å†³ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œéœ€è¦å„ä¸ªå¤„ç†å™¨è®¿é—®ç¼“å­˜æ—¶éƒ½éµå¾ªä¸€äº›åè®®ï¼Œåœ¨è¯»å†™æ—¶è¦æ ¹æ®åè®®æ¥è¿›è¡Œæ“ä½œï¼Œè¿™ç±»åè®®æœ‰MSIã€MESIï¼ˆIllinois Protocolï¼‰ã€MOSIã€Synapseã€FireflyåŠDragon Protocolç­‰ã€‚ ä¸åŒæ¶æ„çš„ç‰©ç†æœºå™¨å¯ä»¥æ‹¥æœ‰ä¸ä¸€æ ·çš„å†…å­˜æ¨¡å‹ï¼Œè€ŒJavaè™šæ‹Ÿæœºä¹Ÿæœ‰è‡ªå·±çš„å†…å­˜æ¨¡å‹ï¼Œå¹¶ä¸”ä¸è¿™é‡Œä»‹ç»çš„å†…å­˜è®¿é—®æ“ä½œåŠç¡¬ä»¶çš„ç¼“å­˜è®¿é—®æ“ä½œå…·æœ‰é«˜åº¦çš„å¯ç±»æ¯”æ€§ã€‚ 2 Javaå†…å­˜æ¨¡å‹2.1 ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜Javaå†…å­˜æ¨¡å‹è§„å®šäº†æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯æ¡çº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„æ•°æ®ï¼Œä¸åŒçš„çº¿ç¨‹ä¹‹é—´ä¹Ÿæ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡å€¼çš„ä¼ é€’å‡éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚ ä¸»å†…å­˜ã€å·¥ä½œå†…å­˜ä¸Javaå†…å­˜åŒºåŸŸä¸­çš„Javaå †ã€æ ˆã€æ–¹æ³•åŒºç­‰å¹¶ä¸æ˜¯åŒä¸€ä¸ªå±‚æ¬¡çš„å¯¹å†…å­˜çš„åˆ’åˆ†ï¼Œè¿™ä¸¤è€…åŸºæœ¬ä¸Šæ˜¯æ²¡æœ‰ä»»ä½•å…³ç³»çš„ã€‚ 2.2 å†…å­˜é—´äº¤äº’æ“ä½œå…³äºä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜ä¹‹é—´å…·ä½“çš„äº¤äº’åè®®ï¼ŒJavaå†…å­˜æ¨¡å‹ä¸­å®šä¹‰äº†ä»¥ä¸‹8ç§æ“ä½œæ¥å®Œæˆã€‚æ¯ä¸€ç§æ“ä½œéƒ½æ˜¯åŸå­çš„ã€ä¸å¯å†åˆ†çš„ï¼š lockï¼ˆé”å®šï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡æ ‡è¯†ä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çš„çŠ¶æ€ã€‚ unlockï¼ˆè§£é”ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é”å®šã€‚ readï¼ˆè¯»å–ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„loadåŠ¨ä½œä½¿ç”¨ã€‚ loadï¼ˆè½½å…¥ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠreadæ“ä½œä»ä¸»å†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­ã€‚ useï¼ˆä½¿ç”¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦ä½¿ç”¨å˜é‡çš„å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶å°†ä¼šæ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚ assignï¼ˆèµ‹å€¼ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜çš„å˜é‡ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªç»™å˜é‡èµ‹å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚ storeï¼ˆå­˜å‚¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„writeæ“ä½œä½¿ç”¨ã€‚ writeï¼ˆå†™å…¥ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡çš„å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­ã€‚ å¦‚æœè¦æŠŠä¸€ä¸ªå˜é‡ä»ä¸»å†…å­˜æ‹·è´åˆ°å·¥ä½œå†…å­˜ï¼Œé‚£å°±è¦æŒ‰é¡ºåºæ‰§è¡Œreadå’Œloadæ“ä½œï¼Œç›¸åå°±è¦é¡ºåºæ‰§è¡Œstoreå’Œwriteæ“ä½œã€‚å¯ä»¥ä¸è¿ç»­æ‰§è¡Œï¼Œä½†å¿…é¡»ç›¸å¯¹åœ°é¡ºåºåœ¨æ‰§è¡Œã€‚ è¿™äº›æ“ä½œå¿…é¡»æ»¡è¶³è§„åˆ™ï¼š ä¸å…è®¸readå’Œloadã€storeå’Œwriteæ“ä½œä¹‹ä¸€å•ç‹¬å‡ºç°ï¼Œå³ä¸å…è®¸ä¸€ä¸ªå˜é‡ä»ä¸»å†…å­˜è¯»å–äº†ä½†å·¥ä½œå†…å­˜ä¸æ¥å—ï¼Œæˆ–è€…å·¥ä½œå†…å­˜å‘èµ·å›å†™äº†ä½†ä¸»å†…å­˜ä¸æ¥å—çš„æƒ…å†µå‡ºç°ã€‚ ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹ä¸¢å¼ƒå®ƒæœ€è¿‘çš„assignæ“ä½œï¼Œå³å˜é‡åœ¨å·¥ä½œå†…å­˜ä¸­æ”¹å˜äº†ä¹‹åå¿…é¡»æŠŠè¯¥å˜åŒ–åŒæ­¥å›ä¸»å†…å­˜ã€‚ ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹æ— åŸå› åœ°ï¼ˆæ²¡æœ‰å‘ç”Ÿè¿‡ä»»ä½•assignæ“ä½œï¼‰æŠŠæ•°æ®ä»çº¿ç¨‹çš„å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜ä¸­ã€‚ ä¸€ä¸ªæ–°çš„å˜é‡åªèƒ½åœ¨ä¸»å†…å­˜ä¸­â€œè¯ç”Ÿâ€ï¼Œä¸å…è®¸åœ¨å·¥ä½œå†…å­˜ä¸­ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæœªè¢«åˆå§‹åŒ–ï¼ˆloadæˆ– assignï¼‰çš„å˜é‡ï¼Œæ¢å¥è¯è¯´å°±æ˜¯å¯¹ä¸€ä¸ªå˜é‡å®æ–½useã€storeæ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæ‰§è¡Œassignå’Œloadæ“ä½œã€‚ ä¸€ä¸ªå˜é‡åœ¨åŒä¸€ä¸ªæ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶è¿›è¡Œlockæ“ä½œï¼Œä½†lockæ“ä½œå¯ä»¥è¢«åŒä¸€æ¡çº¿ç¨‹é‡å¤æ‰§è¡Œå¤šæ¬¡ï¼Œå¤šæ¬¡æ‰§è¡Œlockåï¼Œåªæœ‰æ‰§è¡Œç›¸åŒæ¬¡æ•°çš„unlockæ“ä½œï¼Œå˜é‡æ‰ä¼šè¢«è§£é”ã€‚ å¦‚æœå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œlockæ“ä½œï¼Œé‚£å°†ä¼šæ¸…ç©ºå·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼ï¼Œåœ¨æ‰§è¡Œå¼•æ“ä½¿ç”¨è¿™ä¸ªå˜é‡å‰ï¼Œéœ€è¦é‡æ–°æ‰§è¡Œloadæˆ–assignæ“ä½œä»¥åˆå§‹åŒ–å˜é‡çš„å€¼ã€‚ å¦‚æœä¸€ä¸ªå˜é‡äº‹å…ˆæ²¡æœ‰è¢«lockæ“ä½œé”å®šï¼Œé‚£å°±ä¸å…è®¸å¯¹å®ƒæ‰§è¡Œunlockæ“ä½œï¼Œä¹Ÿä¸å…è®¸å»unlockä¸€ä¸ªè¢«å…¶ä»–çº¿ç¨‹é”å®šçš„å˜é‡ã€‚ å¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œunlockæ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠæ­¤å˜é‡åŒæ­¥å›ä¸»å†…å­˜ä¸­ï¼ˆæ‰§è¡Œstoreã€writeæ“ä½œï¼‰ã€‚ æœ€è¿‘JSR-133æ–‡æ¡£ä¸­æŠŠJavaå†…å­˜æ¨¡å‹çš„æ“ä½œç®€åŒ–æˆreadã€writeã€lockå’Œunlockå››ç§ï¼Œä½†å®é™…è®¾è®¡æ²¡æœ‰å˜ã€‚ 2.3 å¯¹äºvolatileå‹å˜é‡çš„ç‰¹æ®Šè§„åˆ™å½“ä¸€ä¸ªå˜é‡è¢«å®šä¹‰æˆvolatileä¹‹åï¼Œå®ƒå°†å…·å¤‡ä¸¤é¡¹ç‰¹æ€§ï¼š ç¬¬ä¸€é¡¹æ˜¯ä¿è¯æ­¤å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§ï¼Œè¿™é‡Œçš„â€œå¯è§æ€§â€æ˜¯æŒ‡å½“ä¸€æ¡çº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œæ–°å€¼å¯¹äºå…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯å¯ä»¥ç«‹å³å¾—çŸ¥çš„ã€‚è€Œæ™®é€šå˜é‡å¹¶ä¸èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ™®é€šå˜é‡çš„å€¼åœ¨çº¿ç¨‹é—´ä¼ é€’æ—¶å‡éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚ Javaé‡Œé¢çš„è¿ç®—æ“ä½œç¬¦å¹¶éåŸå­æ“ä½œï¼Œè¿™å¯¼è‡´volatileå˜é‡çš„è¿ç®—åœ¨å¹¶å‘ä¸‹ä¸€æ ·æ˜¯ä¸å®‰å…¨çš„ï¼Œç¤ºä¾‹ï¼š è¿™æ®µä»£ç å‘èµ·äº†20ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å¯¹raceå˜é‡è¿›è¡Œ10000æ¬¡è‡ªå¢æ“ä½œï¼Œå¦‚æœè¿™æ®µä»£ç èƒ½å¤Ÿæ­£ç¡®å¹¶å‘çš„è¯ï¼Œæœ€åè¾“å‡ºçš„ç»“æœåº”è¯¥æ˜¯200000ã€‚è¯»è€…è¿è¡Œå®Œè¿™æ®µä»£ç ä¹‹åï¼Œå¹¶ä¸ä¼šè·å¾—æœŸæœ›çš„ç»“æœï¼Œè€Œä¸”ä¼šå‘ç°æ¯æ¬¡è¿è¡Œç¨‹åºï¼Œè¾“å‡ºçš„ç»“æœéƒ½ä¸ä¸€æ ·ï¼Œéƒ½æ˜¯ä¸€ä¸ªå°äº200000çš„æ•°å­—ã€‚ é—®é¢˜å°±å‡ºåœ¨è‡ªå¢è¿ç®—â€œrace++â€ä¹‹ä¸­ï¼Œåç¼–è¯‘è¿™æ®µä»£ç åï¼Œå‘ç°åªæœ‰ä¸€è¡Œä»£ç çš„increase()æ–¹æ³•åœ¨Classæ–‡ä»¶ä¸­æ˜¯ç”±4æ¡å­—èŠ‚ç æŒ‡ä»¤æ„æˆã€‚ä»å­—èŠ‚ç å±‚é¢ä¸Šå·²ç»å¾ˆå®¹æ˜“åˆ†æå‡ºå¹¶å‘å¤±è´¥çš„åŸå› äº†ï¼šå½“getstaticæŒ‡ä»¤æŠŠ raceçš„å€¼å–åˆ°æ“ä½œæ ˆé¡¶æ—¶ï¼Œvolatileå…³é”®å­—ä¿è¯äº†raceçš„å€¼åœ¨æ­¤æ—¶æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯åœ¨æ‰§è¡Œiconst_1ã€iaddè¿™äº›æŒ‡ä»¤çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹å¯èƒ½å·²ç»æŠŠraceçš„å€¼æ”¹å˜äº†ï¼Œè€Œæ“ä½œæ ˆé¡¶çš„å€¼å°±å˜æˆäº†è¿‡æœŸçš„æ•°æ®ï¼Œæ‰€ä»¥ putstaticæŒ‡ä»¤æ‰§è¡Œåå°±å¯èƒ½æŠŠè¾ƒå°çš„raceå€¼åŒæ­¥å›ä¸»å†…å­˜ä¹‹ä¸­ã€‚ public static void increase(); Code: Stack=2, Locals=0, Args_size=0 0: getstatic #13; //Field race:I 3: iconst_1 4: iadd 5: putstatic #13; //Field race:I 8: return LineNumberTable: line 14: 0 line 15: 8ç”±äºvolatileå˜é‡åªèƒ½ä¿è¯å¯è§æ€§ï¼Œåœ¨ä¸ç¬¦åˆä»¥ä¸‹ä¸¤æ¡è§„åˆ™çš„è¿ç®—åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶è¦é€šè¿‡åŠ é”ï¼ˆä½¿ç”¨synchronizedã€java.util.concurrentä¸­çš„é”æˆ–åŸå­ç±»ï¼‰æ¥ä¿è¯åŸå­æ€§ï¼š è¿ç®—ç»“æœå¹¶ä¸ä¾èµ–å˜é‡çš„å½“å‰å€¼ï¼Œæˆ–è€…èƒ½å¤Ÿç¡®ä¿åªæœ‰å•ä¸€çš„çº¿ç¨‹ä¿®æ”¹å˜é‡çš„å€¼ã€‚ å˜é‡ä¸éœ€è¦ä¸å…¶ä»–çš„çŠ¶æ€å˜é‡å…±åŒå‚ä¸ä¸å˜çº¦æŸã€‚ ç¬¬äºŒé¡¹æ˜¯ç¦æ­¢æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ï¼š æœ‰volatileä¿®é¥°çš„å˜é‡ï¼Œèµ‹å€¼åï¼ˆå‰é¢mov%eaxï¼Œ0x150(%esi)è¿™å¥ä¾¿æ˜¯èµ‹å€¼æ“ä½œï¼‰å¤šæ‰§è¡Œäº†ä¸€ä¸ªâ€œlock addl$0x0ï¼Œ(%esp)â€æ“ä½œï¼Œè¿™ä¸ªæ“ä½œçš„ä½œç”¨ç›¸å½“äºä¸€ä¸ªå†…å­˜å±éšœ,æŒ‡ä»¤é‡æ’åºæ—¶ä¸èƒ½æŠŠåé¢çš„æŒ‡ä»¤é‡æ’åºåˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ã€‚ è¿™ç§æ“ä½œç›¸å½“äºå¯¹ç¼“å­˜ä¸­çš„å˜é‡åšäº†ä¸€æ¬¡å‰é¢ä»‹ç»Javaå†…å­˜æ¨¡å¼ä¸­æ‰€è¯´çš„â€œstoreå’Œwriteâ€æ“ä½œã€‚æ‰€ä»¥é€šè¿‡è¿™æ ·ä¸€ä¸ªç©ºæ“ä½œï¼Œå¯è®©å‰é¢volatileå˜é‡çš„ä¿®æ”¹å¯¹å…¶ä»–å¤„ç†å™¨ç«‹å³å¯è§ã€‚ Javaå†…å­˜æ¨¡å‹ä¸­å¯¹volatileå˜é‡å®šä¹‰çš„ç‰¹æ®Šè§„åˆ™çš„å®šä¹‰: å‡å®šTè¡¨ç¤ºä¸€ä¸ªçº¿ç¨‹ï¼ŒVå’ŒWåˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªvolatileå‹å˜é‡ï¼Œé‚£ä¹ˆåœ¨è¿›è¡Œreadã€loadã€useã€assignã€storeå’Œwriteæ“ä½œæ—¶éœ€è¦æ»¡è¶³å¦‚ä¸‹è§„åˆ™ï¼š åªæœ‰å½“çº¿ç¨‹Tå¯¹å˜é‡Væ‰§è¡Œçš„å‰ä¸€ä¸ªåŠ¨ä½œæ˜¯loadçš„æ—¶å€™ï¼Œçº¿ç¨‹Tæ‰èƒ½å¯¹å˜é‡Væ‰§è¡ŒuseåŠ¨ä½œï¼›å¹¶ä¸”ï¼Œåªæœ‰å½“çº¿ç¨‹Tå¯¹å˜é‡Væ‰§è¡Œçš„åä¸€ä¸ªåŠ¨ä½œæ˜¯useçš„æ—¶å€™ï¼Œçº¿ç¨‹Tæ‰èƒ½å¯¹å˜é‡Væ‰§è¡ŒloadåŠ¨ä½œã€‚çº¿ç¨‹Tå¯¹å˜é‡Vçš„useåŠ¨ä½œå¯ä»¥è®¤ä¸ºæ˜¯å’Œçº¿ç¨‹Tå¯¹å˜é‡Vçš„loadã€readåŠ¨ä½œç›¸å…³è”çš„ï¼Œå¿…é¡»è¿ç»­ä¸”ä¸€èµ·å‡ºç°ã€‚ è¿™æ¡è§„åˆ™è¦æ±‚åœ¨å·¥ä½œå†…å­˜ä¸­ï¼Œæ¯æ¬¡ä½¿ç”¨Vå‰éƒ½å¿…é¡»å…ˆä»ä¸»å†…å­˜åˆ·æ–°æœ€æ–°çš„å€¼ï¼Œç”¨äºä¿è¯èƒ½çœ‹è§å…¶ä»–çº¿ç¨‹å¯¹å˜é‡Væ‰€åšçš„ä¿®æ”¹ã€‚ åªæœ‰å½“çº¿ç¨‹Tå¯¹å˜é‡Væ‰§è¡Œçš„å‰ä¸€ä¸ªåŠ¨ä½œæ˜¯assignçš„æ—¶å€™ï¼Œçº¿ç¨‹Tæ‰èƒ½å¯¹å˜é‡Væ‰§è¡ŒstoreåŠ¨ä½œï¼›å¹¶ä¸”ï¼Œåªæœ‰å½“çº¿ç¨‹Tå¯¹å˜é‡Væ‰§è¡Œçš„åä¸€ä¸ªåŠ¨ä½œæ˜¯storeçš„æ—¶å€™ï¼Œçº¿ç¨‹Tæ‰èƒ½å¯¹å˜é‡Væ‰§è¡ŒassignåŠ¨ä½œã€‚çº¿ç¨‹Tå¯¹å˜é‡Vçš„assignåŠ¨ä½œå¯ä»¥è®¤ä¸ºæ˜¯å’Œçº¿ç¨‹Tå¯¹å˜é‡Vçš„storeã€writeåŠ¨ä½œç›¸å…³è”çš„ï¼Œå¿…é¡»è¿ç»­ä¸”ä¸€èµ·å‡ºç°ã€‚ è¿™æ¡è§„åˆ™è¦æ±‚åœ¨å·¥ä½œå†…å­˜ä¸­ï¼Œæ¯æ¬¡ä¿®æ”¹Våéƒ½å¿…é¡»ç«‹åˆ»åŒæ­¥å›ä¸»å†…å­˜ä¸­ï¼Œç”¨äºä¿è¯å…¶ä»–çº¿ç¨‹å¯ä»¥çœ‹åˆ°è‡ªå·±å¯¹å˜é‡Væ‰€åšçš„ä¿®æ”¹ã€‚ å‡å®šåŠ¨ä½œAæ˜¯çº¿ç¨‹Tå¯¹å˜é‡Vå®æ–½çš„useæˆ–assignåŠ¨ä½œï¼Œå‡å®šåŠ¨ä½œFæ˜¯å’ŒåŠ¨ä½œAç›¸å…³è”çš„loadæˆ–storeåŠ¨ä½œï¼Œå‡å®šåŠ¨ä½œPæ˜¯å’ŒåŠ¨ä½œFç›¸åº”çš„å¯¹å˜é‡Vçš„readæˆ–writeåŠ¨ä½œï¼›ä¸æ­¤ç±»ä¼¼ï¼Œå‡å®šåŠ¨ä½œBæ˜¯çº¿ç¨‹Tå¯¹å˜é‡Wå®æ–½çš„useæˆ–assignåŠ¨ä½œï¼Œå‡å®šåŠ¨ä½œGæ˜¯å’ŒåŠ¨ä½œBç›¸å…³è”çš„loadæˆ–storeåŠ¨ä½œï¼Œå‡å®šåŠ¨ä½œQæ˜¯å’ŒåŠ¨ä½œGç›¸åº”çš„å¯¹å˜é‡Wçš„readæˆ–writeåŠ¨ä½œã€‚å¦‚æœAå…ˆäºBï¼Œé‚£ä¹ˆPå…ˆäºQã€‚ è¿™æ¡è§„åˆ™è¦æ±‚volatileä¿®é¥°çš„å˜é‡ä¸ä¼šè¢«æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ï¼Œä»è€Œä¿è¯ä»£ç çš„æ‰§è¡Œé¡ºåºä¸ç¨‹åºçš„é¡ºåºç›¸åŒã€‚ 2.4 é’ˆå¯¹longå’Œdoubleå‹å˜é‡çš„ç‰¹æ®Šè§„åˆ™å¯¹äº64ä½çš„æ•°æ®ç±»å‹ï¼ˆlongå’Œdoubleï¼‰ï¼Œå…è®¸è™šæ‹Ÿæœºå°†æ²¡æœ‰è¢«volatileä¿®é¥°çš„64ä½æ•°æ®çš„è¯»å†™æ“ä½œåˆ’åˆ†ä¸ºä¸¤æ¬¡32ä½çš„æ“ä½œæ¥è¿›è¡Œï¼Œå³å…è®¸è™šæ‹Ÿæœºå®ç°è‡ªè¡Œé€‰æ‹©æ˜¯å¦è¦ä¿è¯64ä½æ•°æ®ç±»å‹çš„loadã€storeã€readå’Œwriteè¿™å››ä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œlongå’Œdoubleçš„éåŸå­æ€§åå®šâ€ã€‚ ä½†æ˜¯ç›®å‰ä¸»æµå¹³å°ä¸‹å•†ç”¨çš„64ä½Javaè™šæ‹Ÿæœºä¸­å¹¶ä¸ä¼šå‡ºç°éåŸå­æ€§è®¿é—®è¡Œä¸ºã€‚å¹¶ä¸”JDK9å¼€å§‹å®éªŒæ€§çš„è™šæ‹Ÿæœºå‚æ•°-XXï¼š+AlwaysAtomicAccessesè¦æ±‚å¯¹æ‰€æœ‰æ•°æ®ç±»å‹è¿›è¡ŒåŸå­æ€§çš„è®¿é—®ã€‚ 2.5 åŸå­æ€§ã€å¯è§æ€§ä¸æœ‰åºæ€§Javaå†…å­˜æ¨¡å‹æ˜¯å›´ç»•ç€åœ¨å¹¶å‘è¿‡ç¨‹ä¸­å¦‚ä½•å¤„ç†åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§è¿™ä¸‰ä¸ªç‰¹å¾æ¥å»ºç«‹çš„ã€‚ 2.5.1 åŸå­æ€§ç”±Javaå†…å­˜æ¨¡å‹æ¥ç›´æ¥ä¿è¯çš„åŸå­æ€§å˜é‡æ“ä½œåŒ…æ‹¬readã€loadã€assignã€useã€storeå’Œwriteè¿™å…­ä¸ªï¼Œæˆ‘ä»¬å¤§è‡´å¯ä»¥è®¤ä¸ºï¼ŒåŸºæœ¬æ•°æ®ç±»å‹çš„è®¿é—®ã€è¯»å†™éƒ½æ˜¯å…·å¤‡åŸå­æ€§çš„ï¼ˆä¾‹å¤–å°±æ˜¯longå’Œdoubleçš„éåŸå­æ€§åå®šï¼‰ å¦‚æœåº”ç”¨åœºæ™¯éœ€è¦ä¸€ä¸ªæ›´å¤§èŒƒå›´çš„åŸå­æ€§ä¿è¯ï¼Œé€šå¸¸é€šè¿‡synchronizedæ¥å®ç°ã€‚ 2.5.2 å¯è§æ€§å¯è§æ€§å°±æ˜¯æŒ‡å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡çš„å€¼æ—¶ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³å¾—çŸ¥è¿™ä¸ªä¿®æ”¹ã€‚æ™®é€šå˜é‡ä¸volatileå˜é‡çš„åŒºåˆ«æ˜¯ï¼Œvolatileçš„ç‰¹æ®Šè§„åˆ™ä¿è¯äº†æ–°å€¼èƒ½ç«‹å³åŒæ­¥åˆ°ä¸»å†…å­˜ï¼Œä»¥åŠæ¯æ¬¡ä½¿ç”¨å‰ç«‹å³ä»ä¸»å†…å­˜åˆ·æ–°ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥è¯´volatileä¿è¯äº†å¤šçº¿ç¨‹æ“ä½œæ—¶å˜é‡çš„å¯è§æ€§ï¼Œè€Œæ™®é€šå˜é‡åˆ™ä¸èƒ½ä¿è¯è¿™ä¸€ç‚¹ã€‚ é™¤äº†volatileä¹‹å¤–ï¼ŒJavaè¿˜æœ‰ä¸¤ä¸ªå…³é”®å­—èƒ½å®ç°å¯è§æ€§ï¼Œå®ƒä»¬æ˜¯synchronizedå’Œfinalã€‚ åŒæ­¥å—çš„å¯è§æ€§æ˜¯ç”±â€œå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œunlockæ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠæ­¤å˜é‡åŒæ­¥å›ä¸»å†…å­˜ä¸­ï¼ˆæ‰§è¡Œstoreã€writeæ“ä½œï¼‰â€è¿™æ¡è§„åˆ™è·å¾—çš„ã€‚è€Œfinalå…³é”®å­—çš„å¯è§æ€§æ˜¯æŒ‡ï¼šè¢«finalä¿®é¥°çš„å­—æ®µåœ¨æ„é€ å™¨ä¸­ä¸€æ—¦è¢«åˆå§‹åŒ–å®Œæˆï¼Œå¹¶ä¸”æ„é€ å™¨æ²¡æœ‰æŠŠâ€œthisâ€çš„å¼•ç”¨ä¼ é€’å‡ºå»ï¼ˆthiså¼•ç”¨é€ƒé€¸æ˜¯ä¸€ä»¶å¾ˆå±é™©çš„äº‹æƒ…ï¼Œå…¶ä»–çº¿ç¨‹æœ‰å¯èƒ½é€šè¿‡è¿™ä¸ªå¼•ç”¨è®¿é—®åˆ°â€œåˆå§‹åŒ–äº†ä¸€åŠâ€çš„å¯¹è±¡ï¼‰ï¼Œé‚£ä¹ˆåœ¨å…¶ä»–çº¿ç¨‹ä¸­å°±èƒ½çœ‹è§finalå­—æ®µçš„å€¼ã€‚ 2.5.3 æœ‰åºæ€§Javaç¨‹åºä¸­å¤©ç„¶çš„æœ‰åºæ€§å¯ä»¥æ€»ç»“ä¸ºä¸€å¥è¯ï¼šå¦‚æœåœ¨æœ¬çº¿ç¨‹å†…è§‚å¯Ÿï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æœ‰åºçš„ï¼›å¦‚æœåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è§‚å¯Ÿå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æ— åºçš„ã€‚å‰åŠå¥æ˜¯æŒ‡â€œçº¿ç¨‹å†…ä¼¼è¡¨ç°ä¸ºä¸²è¡Œçš„è¯­ä¹‰â€ï¼ŒååŠå¥æ˜¯æŒ‡â€œæŒ‡ä»¤é‡æ’åºâ€ç°è±¡å’Œâ€œå·¥ä½œå†…å­˜ä¸ä¸»å†…å­˜åŒæ­¥å»¶è¿Ÿâ€ç°è±¡ã€‚ Javaè¯­è¨€æä¾›äº†volatileå’Œsynchronizedä¸¤ä¸ªå…³é”®å­—æ¥ä¿è¯çº¿ç¨‹ä¹‹é—´æ“ä½œçš„æœ‰åºæ€§ï¼Œvolatileå…³é”®å­—æœ¬èº«å°±åŒ…å«äº†ç¦æ­¢æŒ‡ä»¤é‡æ’åºçš„è¯­ä¹‰ï¼Œè€Œsynchronizedåˆ™æ˜¯ç”±â€œä¸€ä¸ªå˜é‡åœ¨åŒä¸€ä¸ªæ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶è¿›è¡Œlockæ“ä½œâ€è¿™æ¡è§„åˆ™è·å¾—çš„ï¼Œè¿™ä¸ªè§„åˆ™å†³å®šäº†æŒæœ‰åŒä¸€ä¸ªé”çš„ä¸¤ä¸ªåŒæ­¥å—åªèƒ½ä¸²è¡Œåœ°è¿›å…¥ã€‚ 2.6 å…ˆè¡Œå‘ç”ŸåŸåˆ™å…ˆè¡Œå‘ç”Ÿæ˜¯Javaå†…å­˜æ¨¡å‹ä¸­å®šä¹‰çš„ä¸¤é¡¹æ“ä½œä¹‹é—´çš„ååºå…³ç³»ï¼Œæ¯”å¦‚è¯´æ“ä½œAå…ˆè¡Œå‘ç”Ÿäºæ“ä½œBï¼Œå…¶å®å°±æ˜¯è¯´åœ¨å‘ç”Ÿæ“ä½œBä¹‹å‰ï¼Œæ“ä½œAäº§ç”Ÿçš„å½±å“èƒ½è¢«æ“ä½œB è§‚å¯Ÿåˆ°ï¼Œâ€œå½±å“â€åŒ…æ‹¬ä¿®æ”¹äº†å†…å­˜ä¸­å…±äº«å˜é‡çš„å€¼ã€å‘é€äº†æ¶ˆæ¯ã€è°ƒç”¨äº†æ–¹æ³•ç­‰ã€‚ // ä»¥ä¸‹æ“ä½œåœ¨çº¿ç¨‹Aä¸­æ‰§è¡Œ i = 1; // ä»¥ä¸‹æ“ä½œåœ¨çº¿ç¨‹Bä¸­æ‰§è¡Œ j = i; // ä»¥ä¸‹æ“ä½œåœ¨çº¿ç¨‹Cä¸­æ‰§è¡Œ i = 2; å‡è®¾çº¿ç¨‹Aä¸­çš„æ“ä½œâ€œi=1â€å…ˆè¡Œå‘ç”Ÿäºçº¿ç¨‹Bçš„æ“ä½œâ€œj=iâ€ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥ç¡®å®šåœ¨çº¿ç¨‹Bçš„æ“ä½œæ‰§è¡Œåï¼Œå˜é‡jçš„å€¼ä¸€å®šæ˜¯ç­‰äº1ï¼Œå¾—å‡ºè¿™ä¸ªç»“è®ºçš„ä¾æ®æœ‰ä¸¤ä¸ªï¼šä¸€æ˜¯æ ¹æ®å…ˆè¡Œå‘ç”ŸåŸåˆ™ï¼Œâ€œi=1â€çš„ç»“æœå¯ä»¥è¢«è§‚å¯Ÿåˆ°ï¼›äºŒæ˜¯çº¿ç¨‹Cè¿˜æ²¡ç™»åœºï¼Œçº¿ç¨‹Aæ“ä½œç»“æŸä¹‹åæ²¡æœ‰å…¶ä»–çº¿ç¨‹ä¼šä¿®æ”¹å˜é‡içš„å€¼ã€‚ç°åœ¨å†æ¥è€ƒè™‘çº¿ç¨‹Cï¼Œæˆ‘ä»¬ä¾ç„¶ä¿æŒçº¿ç¨‹Aå’ŒBä¹‹é—´çš„å…ˆè¡Œå‘ç”Ÿå…³ç³»ï¼Œè€ŒCå‡ºç°åœ¨çº¿ç¨‹Aå’ŒBçš„æ“ä½œä¹‹é—´ï¼Œä½†æ˜¯Cä¸Bæ²¡æœ‰å…ˆè¡Œå‘ç”Ÿå…³ç³»ï¼Œé‚£jçš„å€¼ä¼šæ˜¯å¤šå°‘å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸ç¡®å®šï¼1å’Œ2éƒ½æœ‰å¯èƒ½ï¼Œå› ä¸ºçº¿ç¨‹Cå¯¹å˜é‡içš„å½±å“å¯èƒ½ä¼šè¢«çº¿ç¨‹Bè§‚å¯Ÿåˆ°ï¼Œä¹Ÿå¯èƒ½ä¸ä¼šï¼Œè¿™æ—¶å€™çº¿ç¨‹Bå°±å­˜åœ¨è¯»å–åˆ°è¿‡æœŸæ•°æ®çš„é£é™©ï¼Œä¸å…·å¤‡å¤šçº¿ç¨‹å®‰å…¨æ€§ã€‚ ä¸‹é¢æ˜¯Javaå†…å­˜æ¨¡å‹ä¸‹ä¸€äº›â€œå¤©ç„¶çš„â€å…ˆè¡Œå‘ç”Ÿå…³ç³»ï¼Œè¿™äº›å…ˆè¡Œå‘ç”Ÿå…³ç³»æ— é¡»ä»»ä½•åŒæ­¥å™¨ååŠ©å°±å·²ç»å­˜åœ¨ï¼Œå¯ä»¥åœ¨ç¼–ç ä¸­ç›´æ¥ä½¿ç”¨ã€‚å¦‚æœä¸¤ä¸ªæ“ä½œä¹‹é—´çš„å…³ç³»ä¸åœ¨æ­¤åˆ—ï¼Œå¹¶ä¸”æ— æ³•ä»ä¸‹åˆ—è§„åˆ™æ¨å¯¼å‡ºæ¥ï¼Œåˆ™å®ƒä»¬å°±æ²¡æœ‰é¡ºåºæ€§ä¿éšœï¼Œè™šæ‹Ÿæœºå¯ä»¥å¯¹å®ƒä»¬éšæ„åœ°è¿›è¡Œé‡æ’åºã€‚ ç¨‹åºæ¬¡åºè§„åˆ™ï¼šåœ¨ä¸€ä¸ªçº¿ç¨‹å†…ï¼ŒæŒ‰ç…§æ§åˆ¶æµé¡ºåºï¼Œä¹¦å†™åœ¨å‰é¢çš„æ“ä½œå…ˆè¡Œå‘ç”Ÿäºä¹¦å†™åœ¨åé¢çš„æ“ä½œã€‚æ³¨æ„ï¼Œè¿™é‡Œè¯´çš„æ˜¯æ§åˆ¶æµé¡ºåºè€Œä¸æ˜¯ç¨‹åºä»£ç é¡ºåºï¼Œå› ä¸ºè¦è€ƒè™‘åˆ†æ”¯ã€å¾ªç¯ç­‰ç»“æ„ã€‚ ç®¡ç¨‹é”å®šè§„åˆ™ï¼šä¸€ä¸ªunlockæ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹åŒä¸€ä¸ªé”çš„lockæ“ä½œã€‚è¿™é‡Œå¿…é¡»å¼ºè°ƒçš„æ˜¯â€œåŒä¸€ä¸ªé”â€ï¼Œè€Œâ€œåé¢â€æ˜¯æŒ‡æ—¶é—´ä¸Šçš„å…ˆåã€‚ volatileå˜é‡è§„åˆ™ï¼šå¯¹ä¸€ä¸ªvolatileå˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œï¼Œè¿™é‡Œçš„â€œåé¢â€åŒæ ·æ˜¯æŒ‡æ—¶é—´ä¸Šçš„å…ˆåã€‚ çº¿ç¨‹å¯åŠ¨è§„åˆ™ï¼šThreadå¯¹è±¡çš„start()æ–¹æ³•å…ˆè¡Œå‘ç”Ÿäºæ­¤çº¿ç¨‹çš„æ¯ä¸€ä¸ªåŠ¨ä½œã€‚ çº¿ç¨‹ç»ˆæ­¢è§„åˆ™ï¼šçº¿ç¨‹ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½å…ˆè¡Œå‘ç”Ÿäºå¯¹æ­¤çº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Thread::join()æ–¹æ³•æ˜¯å¦ç»“æŸã€Thread::isAlive()çš„è¿”å›å€¼ç­‰æ‰‹æ®µæ£€æµ‹çº¿ç¨‹æ˜¯å¦å·²ç»ç»ˆæ­¢æ‰§è¡Œã€‚ çº¿ç¨‹ä¸­æ–­è§„åˆ™ï¼šå¯¹çº¿ç¨‹interrupt()æ–¹æ³•çš„è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘ç”Ÿï¼Œå¯ä»¥é€šè¿‡Thread::interrupted()æ–¹æ³•æ£€æµ‹åˆ°æ˜¯å¦æœ‰ä¸­æ–­å‘ç”Ÿã€‚ å¯¹è±¡ç»ˆç»“è§„åˆ™ï¼šä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆï¼ˆæ„é€ å‡½æ•°æ‰§è¡Œç»“æŸï¼‰å…ˆè¡Œå‘ç”Ÿäºå®ƒçš„ finalize()æ–¹æ³•çš„å¼€å§‹ã€‚ ä¼ é€’æ€§ï¼šå¦‚æœæ“ä½œAå…ˆè¡Œå‘ç”Ÿäºæ“ä½œBï¼Œæ“ä½œBå…ˆè¡Œå‘ç”Ÿäºæ“ä½œCï¼Œé‚£å°±å¯ä»¥å¾—å‡ºæ“ä½œAå…ˆè¡Œå‘ç”Ÿäºæ“ä½œCçš„ç»“è®ºã€‚ 3 Javaä¸çº¿ç¨‹3.1 çº¿ç¨‹çš„å®ç°ç›®å‰çº¿ç¨‹æ˜¯Javaé‡Œé¢è¿›è¡Œå¤„ç†å™¨èµ„æºè°ƒåº¦çš„æœ€åŸºæœ¬å•ä½ï¼Œä¸»æµçš„æ“ä½œç³»ç»Ÿéƒ½æä¾›äº†çº¿ç¨‹å®ç°ï¼ŒJavaè¯­è¨€åˆ™æä¾›äº†åœ¨ä¸åŒç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿå¹³å°ä¸‹å¯¹çº¿ç¨‹æ“ä½œçš„ç»Ÿä¸€å¤„ç†ï¼Œæ¯ä¸ªå·²ç»è°ƒç”¨è¿‡start()æ–¹æ³•ä¸”è¿˜æœªç»“æŸçš„java.lang.Threadç±»çš„å®ä¾‹å°±ä»£è¡¨ç€ä¸€ä¸ªçº¿ç¨‹ã€‚ å®ç°çº¿ç¨‹ä¸»è¦æœ‰ä¸‰ç§æ–¹å¼ï¼šä½¿ç”¨å†…æ ¸çº¿ç¨‹å®ç°ï¼ˆ1ï¼š1å®ç°ï¼‰ï¼Œä½¿ç”¨ç”¨æˆ·çº¿ç¨‹å®ç°ï¼ˆ1ï¼šNå®ç°ï¼‰ï¼Œä½¿ç”¨ç”¨æˆ·çº¿ç¨‹åŠ è½»é‡çº§è¿›ç¨‹æ··åˆå®ç°ï¼ˆNï¼šMå®ç°ï¼‰ã€‚ 3.1.1 å†…æ ¸çº¿ç¨‹å®ç°ä½¿ç”¨å†…æ ¸çº¿ç¨‹å®ç°çš„æ–¹å¼ä¹Ÿè¢«ç§°ä¸º1ï¼š1å®ç°ã€‚å†…æ ¸çº¿ç¨‹ï¼ˆKernel-Level Threadï¼ŒKLTï¼‰å°±æ˜¯ç›´æ¥ç”±æ“ä½œç³»ç»Ÿå†…æ ¸æ”¯æŒçš„çº¿ç¨‹ï¼Œè¿™ç§çº¿ç¨‹ç”±å†…æ ¸æ¥å®Œæˆçº¿ç¨‹åˆ‡æ¢ï¼Œå†…æ ¸é€šè¿‡æ“çºµè°ƒåº¦å™¨ï¼ˆSchedulerï¼‰å¯¹çº¿ç¨‹è¿›è¡Œè°ƒåº¦ï¼Œå¹¶è´Ÿè´£å°†çº¿ç¨‹çš„ä»»åŠ¡æ˜ å°„åˆ°å„ä¸ªå¤„ç†å™¨ä¸Šã€‚æ¯ä¸ªå†…æ ¸çº¿ç¨‹å¯ä»¥è§†ä¸ºå†…æ ¸çš„ä¸€ä¸ªåˆ†èº«ï¼Œè¿™æ ·æ“ä½œç³»ç»Ÿå°±æœ‰èƒ½åŠ›åŒæ—¶å¤„ç†å¤šä»¶äº‹æƒ…ï¼Œæ”¯æŒå¤šçº¿ç¨‹çš„å†…æ ¸å°±ç§°ä¸ºå¤šçº¿ç¨‹å†…æ ¸ã€‚ ç¨‹åºä¸€èˆ¬ä¸ä¼šç›´æ¥ä½¿ç”¨å†…æ ¸çº¿ç¨‹ï¼Œè€Œæ˜¯ä½¿ç”¨å†…æ ¸çº¿ç¨‹çš„ä¸€ç§é«˜çº§æ¥å£â€”â€”è½»é‡çº§è¿›ç¨‹ï¼ˆLightWeight Processï¼ŒLWPï¼‰ï¼Œè½»é‡çº§è¿›ç¨‹å°±æ˜¯æˆ‘ä»¬é€šå¸¸æ„ä¹‰ä¸Šæ‰€è®²çš„çº¿ç¨‹ï¼Œç”±äºæ¯ä¸ªè½»é‡çº§è¿›ç¨‹éƒ½ç”±ä¸€ä¸ªå†…æ ¸çº¿ç¨‹æ”¯æŒï¼Œå› æ­¤åªæœ‰å…ˆæ”¯æŒå†…æ ¸çº¿ç¨‹ï¼Œæ‰èƒ½æœ‰è½»é‡çº§è¿›ç¨‹ã€‚è¿™ç§è½»é‡çº§è¿›ç¨‹ä¸å†…æ ¸çº¿ç¨‹ä¹‹é—´1ï¼š1 çš„å…³ç³»ç§°ä¸ºä¸€å¯¹ä¸€çš„çº¿ç¨‹æ¨¡å‹ã€‚ ç”±äºå†…æ ¸çº¿ç¨‹çš„æ”¯æŒï¼Œæ¯ä¸ªè½»é‡çº§è¿›ç¨‹éƒ½æˆä¸ºä¸€ä¸ªç‹¬ç«‹çš„è°ƒåº¦å•å…ƒï¼Œå³ä½¿å…¶ä¸­æŸä¸€ä¸ªè½»é‡çº§è¿›ç¨‹åœ¨ç³»ç»Ÿè°ƒç”¨ä¸­è¢«é˜»å¡äº†ï¼Œä¹Ÿä¸ä¼šå½±å“æ•´ä¸ªè¿›ç¨‹ç»§ç»­å·¥ä½œã€‚è½»é‡çº§è¿›ç¨‹ä¹Ÿå…·æœ‰å®ƒçš„å±€é™æ€§ï¼šé¦–å…ˆï¼Œç”±äºæ˜¯åŸºäºå†…æ ¸çº¿ç¨‹å®ç°çš„ï¼Œæ‰€ä»¥å„ç§çº¿ç¨‹æ“ä½œï¼Œå¦‚åˆ›å»ºã€ææ„åŠåŒæ­¥ï¼Œéƒ½éœ€è¦è¿›è¡Œç³»ç»Ÿè°ƒç”¨ã€‚è€Œç³»ç»Ÿè°ƒç”¨çš„ä»£ä»·ç›¸å¯¹è¾ƒé«˜ï¼Œéœ€è¦åœ¨ç”¨æˆ·æ€ï¼ˆUser Modeï¼‰å’Œå†…æ ¸æ€ï¼ˆKernel Modeï¼‰ä¸­æ¥å›åˆ‡æ¢ã€‚å…¶æ¬¡ï¼Œæ¯ä¸ªè½»é‡çº§è¿›ç¨‹éƒ½éœ€è¦æœ‰ä¸€ä¸ªå†…æ ¸çº¿ç¨‹çš„æ”¯æŒï¼Œå› æ­¤è½»é‡çº§è¿›ç¨‹è¦æ¶ˆè€—ä¸€å®šçš„å†…æ ¸èµ„æºï¼ˆå¦‚å†…æ ¸çº¿ç¨‹çš„æ ˆç©ºé—´ï¼‰ï¼Œå› æ­¤ä¸€ä¸ªç³»ç»Ÿæ”¯æŒè½»é‡çº§è¿›ç¨‹çš„æ•°é‡æ˜¯æœ‰é™çš„ã€‚ 3.1.2 ç”¨æˆ·çº¿ç¨‹å®ç°å¹¿ä¹‰ä¸Šæ¥è®²ï¼Œä¸€ä¸ªçº¿ç¨‹åªè¦ä¸æ˜¯å†…æ ¸çº¿ç¨‹ï¼Œéƒ½å¯ä»¥è®¤ä¸ºæ˜¯ç”¨æˆ·çº¿ç¨‹ï¼ˆUser Threadï¼ŒUTï¼‰çš„ä¸€ç§ï¼Œå› æ­¤ä»è¿™ä¸ªå®šä¹‰ä¸Šçœ‹ï¼Œè½»é‡çº§è¿›ç¨‹ä¹Ÿå±äºç”¨æˆ·çº¿ç¨‹ï¼Œä½†è½»é‡çº§è¿›ç¨‹çš„å®ç°å§‹ç»ˆæ˜¯å»ºç«‹åœ¨å†…æ ¸ä¹‹ä¸Šçš„ï¼Œè®¸å¤šæ“ä½œéƒ½è¦è¿›è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œå› æ­¤æ•ˆç‡ä¼šå—åˆ°é™åˆ¶ï¼Œå¹¶ä¸å…·å¤‡é€šå¸¸æ„ä¹‰ä¸Šçš„ç”¨æˆ·çº¿ç¨‹çš„ä¼˜ç‚¹ã€‚ è€Œç‹­ä¹‰ä¸Šçš„ç”¨æˆ·çº¿ç¨‹æŒ‡çš„æ˜¯å®Œå…¨å»ºç«‹åœ¨ç”¨æˆ·ç©ºé—´çš„çº¿ç¨‹åº“ä¸Šï¼Œç³»ç»Ÿå†…æ ¸ä¸èƒ½æ„ŸçŸ¥åˆ°ç”¨æˆ·çº¿ç¨‹çš„å­˜åœ¨åŠå¦‚ä½•å®ç°çš„ã€‚ç”¨æˆ·çº¿ç¨‹çš„å»ºç«‹ã€åŒæ­¥ã€é”€æ¯å’Œè°ƒåº¦å®Œå…¨åœ¨ç”¨æˆ·æ€ä¸­å®Œæˆï¼Œä¸éœ€è¦å†…æ ¸çš„å¸®åŠ©ã€‚å¦‚æœç¨‹åºå®ç°å¾—å½“ï¼Œè¿™ç§çº¿ç¨‹ä¸éœ€è¦åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œå› æ­¤æ“ä½œå¯ä»¥æ˜¯éå¸¸å¿«é€Ÿä¸”ä½æ¶ˆè€—çš„ï¼Œä¹Ÿèƒ½å¤Ÿæ”¯æŒè§„æ¨¡æ›´å¤§çš„çº¿ç¨‹æ•°é‡ï¼Œéƒ¨åˆ†é«˜æ€§èƒ½æ•°æ®åº“ä¸­çš„å¤šçº¿ç¨‹å°±æ˜¯ç”±ç”¨æˆ·çº¿ç¨‹å®ç°çš„ã€‚è¿™ç§è¿›ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹ä¹‹é—´1ï¼šNçš„å…³ç³»ç§°ä¸ºä¸€å¯¹å¤šçš„çº¿ç¨‹æ¨¡å‹ã€‚ ç”¨æˆ·çº¿ç¨‹çš„ä¼˜åŠ¿åœ¨äºä¸éœ€è¦ç³»ç»Ÿå†…æ ¸æ”¯æ´ï¼Œä½†ä¹Ÿæ­£ç”±äºä¸ä¾èµ–äºç³»ç»Ÿå†…æ ¸ï¼Œåº”ç”¨ç¨‹åºå¾ˆéš¾ç‹¬ç«‹å®ç°çº¿ç¨‹çš„åˆ›å»ºã€é”€æ¯ã€åˆ‡æ¢å’Œè°ƒåº¦ç­‰æ“ä½œæˆ–è€…å®ç°èµ·æ¥è¾ƒä¸ºå¤æ‚ã€‚ 3.1.3 æ··åˆå®ç°çº¿ç¨‹é™¤äº†ä¾èµ–å†…æ ¸çº¿ç¨‹å®ç°å’Œå®Œå…¨ç”±ç”¨æˆ·ç¨‹åºè‡ªå·±å®ç°ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§å°†å†…æ ¸çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·ä½¿ç”¨çš„å®ç°æ–¹å¼ï¼Œè¢«ç§°ä¸ºNï¼šMå®ç°ã€‚åœ¨è¿™ç§æ··åˆå®ç°ä¸‹ï¼Œæ—¢å­˜åœ¨ç”¨æˆ·çº¿ç¨‹ï¼Œä¹Ÿå­˜åœ¨è½»é‡çº§è¿›ç¨‹ã€‚ç”¨æˆ·çº¿ç¨‹è¿˜æ˜¯å®Œå…¨å»ºç«‹åœ¨ç”¨æˆ·ç©ºé—´ä¸­ï¼Œå› æ­¤ç”¨æˆ·çº¿ç¨‹çš„åˆ›å»ºã€åˆ‡æ¢ã€ææ„ç­‰æ“ä½œä¾ç„¶å»‰ä»·ï¼Œå¹¶ä¸”å¯ä»¥æ”¯æŒå¤§è§„æ¨¡çš„ç”¨æˆ·çº¿ç¨‹å¹¶å‘ã€‚è€Œæ“ä½œç³»ç»Ÿæ”¯æŒçš„è½»é‡çº§è¿›ç¨‹åˆ™ä½œä¸ºç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çº¿ç¨‹ä¹‹é—´çš„æ¡¥æ¢ï¼Œè¿™æ ·å¯ä»¥ä½¿ç”¨å†…æ ¸æä¾›çš„çº¿ç¨‹è°ƒåº¦åŠŸèƒ½åŠå¤„ç†å™¨æ˜ å°„ï¼Œå¹¶ä¸”ç”¨æˆ·çº¿ç¨‹çš„ç³»ç»Ÿè°ƒç”¨è¦é€šè¿‡è½»é‡çº§è¿›ç¨‹æ¥å®Œæˆï¼Œè¿™å¤§å¤§é™ä½äº†æ•´ä¸ªè¿›ç¨‹è¢«å®Œå…¨é˜»å¡çš„é£é™©ã€‚åœ¨è¿™ç§æ··åˆæ¨¡å¼ä¸­ï¼Œç”¨æˆ·çº¿ç¨‹ä¸è½»é‡çº§è¿›ç¨‹çš„æ•°é‡æ¯”æ˜¯ä¸å®šçš„ï¼Œæ˜¯Nï¼šMçš„å…³ç³»ã€‚ 3.1.4 Javaçº¿ç¨‹çš„å®ç°Javaçº¿ç¨‹å¦‚ä½•å®ç°å¹¶ä¸å—Javaè™šæ‹Ÿæœºè§„èŒƒçš„çº¦æŸï¼Œè¿™æ˜¯ä¸€ä¸ªä¸å…·ä½“è™šæ‹Ÿæœºç›¸å…³çš„è¯é¢˜ã€‚ä»JDK 1.3èµ·ï¼Œâ€œä¸»æµâ€å¹³å°ä¸Šçš„â€œä¸»æµâ€å•†ç”¨Javaè™šæ‹Ÿæœºçš„çº¿ç¨‹æ¨¡å‹æ™®ééƒ½è¢«æ›¿æ¢ä¸ºåŸºäºæ“ä½œç³»ç»ŸåŸç”Ÿçº¿ç¨‹æ¨¡å‹æ¥å®ç°ï¼Œå³é‡‡ç”¨1ï¼š1çš„çº¿ç¨‹æ¨¡å‹ã€‚ ä»¥HotSpotä¸ºä¾‹ï¼Œå®ƒçš„æ¯ä¸€ä¸ªJavaçº¿ç¨‹éƒ½æ˜¯ç›´æ¥æ˜ å°„åˆ°ä¸€ä¸ªæ“ä½œç³»ç»ŸåŸç”Ÿçº¿ç¨‹æ¥å®ç°çš„ï¼Œè€Œä¸”ä¸­é—´æ²¡æœ‰é¢å¤–çš„é—´æ¥ç»“æ„ï¼Œæ‰€ä»¥HotSpotè‡ªå·±æ˜¯ä¸ä¼šå»å¹²æ¶‰çº¿ç¨‹è°ƒåº¦çš„ï¼ˆå¯ä»¥è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§ç»™æ“ä½œç³»ç»Ÿæä¾›è°ƒåº¦å»ºè®®ï¼‰ï¼Œå…¨æƒäº¤ç»™åº•ä¸‹çš„æ“ä½œç³»ç»Ÿå»å¤„ç†ï¼Œæ‰€ä»¥ä½•æ—¶å†»ç»“æˆ–å”¤é†’çº¿ç¨‹ã€è¯¥ç»™çº¿ç¨‹åˆ†é…å¤šå°‘å¤„ç†å™¨æ‰§è¡Œæ—¶é—´ã€è¯¥æŠŠçº¿ç¨‹å®‰æ’ç»™å“ªä¸ªå¤„ç†å™¨æ ¸å¿ƒå»æ‰§è¡Œç­‰ï¼Œéƒ½æ˜¯ç”±æ“ä½œç³»ç»Ÿå®Œæˆçš„ï¼Œä¹Ÿéƒ½æ˜¯ç”±æ“ä½œç³»ç»Ÿå…¨æƒå†³å®šçš„ã€‚ 3.2 Javaçº¿ç¨‹è°ƒåº¦çº¿ç¨‹è°ƒåº¦æ˜¯æŒ‡ç³»ç»Ÿä¸ºçº¿ç¨‹åˆ†é…å¤„ç†å™¨ä½¿ç”¨æƒçš„è¿‡ç¨‹ï¼Œè°ƒåº¦ä¸»è¦æ–¹å¼æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ååŒå¼çº¿ç¨‹è°ƒåº¦å’ŒæŠ¢å å¼çº¿ç¨‹è°ƒåº¦ã€‚ å¦‚æœä½¿ç”¨ååŒå¼è°ƒåº¦çš„å¤šçº¿ç¨‹ç³»ç»Ÿï¼Œçº¿ç¨‹çš„æ‰§è¡Œæ—¶é—´ç”±çº¿ç¨‹æœ¬èº«æ¥æ§åˆ¶ï¼Œçº¿ç¨‹æŠŠè‡ªå·±çš„å·¥ä½œæ‰§è¡Œå®Œäº†ä¹‹åï¼Œè¦ä¸»åŠ¨é€šçŸ¥ç³»ç»Ÿåˆ‡æ¢åˆ°å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸Šå»ã€‚ååŒå¼å¤šçº¿ç¨‹çš„æœ€å¤§å¥½å¤„æ˜¯å®ç°ç®€å•ï¼Œè€Œä¸”ç”±äºçº¿ç¨‹è¦æŠŠè‡ªå·±çš„äº‹æƒ…å¹²å®Œåæ‰ä¼šè¿›è¡Œçº¿ç¨‹åˆ‡æ¢ï¼Œåˆ‡æ¢æ“ä½œå¯¹çº¿ç¨‹è‡ªå·±æ˜¯å¯çŸ¥çš„ï¼Œæ‰€ä»¥ä¸€èˆ¬æ²¡æœ‰ä»€ä¹ˆçº¿ç¨‹åŒæ­¥çš„é—®é¢˜ã€‚å®ƒçš„åå¤„ä¹Ÿå¾ˆæ˜æ˜¾ï¼šçº¿ç¨‹æ‰§è¡Œæ—¶é—´ä¸å¯æ§åˆ¶ï¼Œç”šè‡³å¦‚æœä¸€ä¸ªçº¿ç¨‹çš„ä»£ç ç¼–å†™æœ‰é—®é¢˜ï¼Œä¸€ç›´ä¸å‘ŠçŸ¥ç³»ç»Ÿè¿›è¡Œçº¿ç¨‹åˆ‡æ¢ï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šä¸€ç›´é˜»å¡åœ¨é‚£é‡Œã€‚ å¦‚æœä½¿ç”¨æŠ¢å å¼è°ƒåº¦çš„å¤šçº¿ç¨‹ç³»ç»Ÿï¼Œé‚£ä¹ˆæ¯ä¸ªçº¿ç¨‹å°†ç”±ç³»ç»Ÿæ¥åˆ†é…æ‰§è¡Œæ—¶é—´ï¼Œçº¿ç¨‹çš„åˆ‡æ¢ä¸ç”±çº¿ç¨‹æœ¬èº«æ¥å†³å®šã€‚è­¬å¦‚åœ¨Javaä¸­ï¼Œæœ‰Thread::yield()æ–¹æ³•å¯ä»¥ä¸»åŠ¨è®©å‡ºæ‰§è¡Œæ—¶é—´ï¼Œä½†æ˜¯å¦‚æœæƒ³è¦ä¸»åŠ¨è·å–æ‰§è¡Œæ—¶é—´ï¼Œçº¿ç¨‹æœ¬èº«æ˜¯æ²¡æœ‰ä»€ä¹ˆåŠæ³•çš„ã€‚åœ¨è¿™ç§å®ç°çº¿ç¨‹è°ƒåº¦çš„æ–¹å¼ä¸‹ï¼Œçº¿ç¨‹çš„æ‰§è¡Œæ—¶é—´æ˜¯ç³»ç»Ÿå¯æ§çš„ï¼Œä¹Ÿä¸ä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¼è‡´æ•´ä¸ªè¿›ç¨‹ç”šè‡³æ•´ä¸ªç³»ç»Ÿé˜»å¡çš„é—®é¢˜ã€‚Javaä½¿ç”¨çš„çº¿ç¨‹è°ƒåº¦æ–¹å¼å°±æ˜¯æŠ¢å å¼è°ƒåº¦ã€‚ è™½ç„¶è¯´Javaçº¿ç¨‹è°ƒåº¦æ˜¯ç³»ç»Ÿè‡ªåŠ¨å®Œæˆçš„ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶å¯ä»¥â€œå»ºè®®â€æ“ä½œç³»ç»Ÿç»™æŸäº›çº¿ç¨‹å¤šåˆ†é…ä¸€ç‚¹æ‰§è¡Œæ—¶é—´ï¼Œå¦å¤–çš„ä¸€äº›çº¿ç¨‹åˆ™å¯ä»¥å°‘åˆ†é…ä¸€ç‚¹â€”â€”è¿™é¡¹æ“ä½œæ˜¯é€šè¿‡è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§æ¥å®Œæˆçš„ã€‚Java è¯­è¨€ä¸€å…±è®¾ç½®äº†10ä¸ªçº§åˆ«çš„çº¿ç¨‹ä¼˜å…ˆçº§ï¼ˆThread.MIN_PRIORITYè‡³Thread.MAX_PRIORITYï¼‰ã€‚ ä¸è¿‡ï¼Œçº¿ç¨‹ä¼˜å…ˆçº§å¹¶ä¸æ˜¯ä¸€é¡¹ç¨³å®šçš„è°ƒèŠ‚æ‰‹æ®µï¼Œçº¿ç¨‹è°ƒåº¦æœ€ç»ˆè¿˜æ˜¯ç”±æ“ä½œç³»ç»Ÿè¯´äº†ç®—ã€‚å¦‚æœæ“ä½œç³»ç»ŸåŸç”Ÿæä¾›çš„çº¿ç¨‹ä¼˜å…ˆçº§çš„æ•°é‡æ¯”Javaå°‘ï¼Œå°±ä¸å¾—ä¸å‡ºç°å‡ ä¸ªçº¿ç¨‹ä¼˜å…ˆçº§å¯¹åº”åˆ°åŒä¸€ä¸ªæ“ä½œç³»ç»Ÿä¼˜å…ˆçº§çš„æƒ…å†µï¼Œä¾‹å¦‚Windowsä¸­å°±åªæœ‰ä¸ƒç§ä¼˜å…ˆçº§ã€‚ 3.3 çŠ¶æ€è½¬æ¢Javaè¯­è¨€å®šä¹‰äº†6ç§çº¿ç¨‹çŠ¶æ€ï¼Œåœ¨ä»»æ„ä¸€ä¸ªæ—¶é—´ç‚¹ä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸”åªæœ‰å…¶ä¸­çš„ä¸€ç§çŠ¶æ€ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç‰¹å®šçš„æ–¹æ³•åœ¨ä¸åŒçŠ¶æ€ä¹‹é—´è½¬æ¢ã€‚è¿™6ç§çŠ¶æ€åˆ†åˆ«æ˜¯ï¼š æ–°å»ºï¼ˆNewï¼‰ï¼šåˆ›å»ºåå°šæœªå¯åŠ¨çš„çº¿ç¨‹å¤„äºè¿™ç§çŠ¶æ€ã€‚ è¿è¡Œï¼ˆRunnableï¼‰ï¼šåŒ…æ‹¬æ“ä½œç³»ç»Ÿçº¿ç¨‹çŠ¶æ€ä¸­çš„Runningå’ŒReadyï¼Œä¹Ÿå°±æ˜¯å¤„äºæ­¤çŠ¶æ€çš„çº¿ç¨‹æœ‰å¯èƒ½æ­£åœ¨æ‰§è¡Œï¼Œä¹Ÿæœ‰å¯èƒ½æ­£åœ¨ç­‰å¾…ç€æ“ä½œç³»ç»Ÿä¸ºå®ƒåˆ†é…æ‰§è¡Œæ—¶é—´ã€‚ æ— é™æœŸç­‰å¾…ï¼ˆWaitingï¼‰ï¼šå¤„äºè¿™ç§çŠ¶æ€çš„çº¿ç¨‹ä¸ä¼šè¢«åˆ†é…å¤„ç†å™¨æ‰§è¡Œæ—¶é—´ï¼Œå®ƒä»¬è¦ç­‰å¾…è¢«å…¶ä»–çº¿ç¨‹æ˜¾å¼å”¤é†’ã€‚ä»¥ä¸‹æ–¹æ³•ä¼šè®©çº¿ç¨‹é™·å…¥æ— é™æœŸçš„ç­‰å¾…çŠ¶æ€ï¼š æ²¡æœ‰è®¾ç½®Timeoutå‚æ•°çš„Thread::join()æ–¹æ³•ï¼› LockSupport::park()æ–¹æ³•ã€‚ é™æœŸç­‰å¾…ï¼ˆTimed Waitingï¼‰ï¼šå¤„äºè¿™ç§çŠ¶æ€çš„çº¿ç¨‹ä¹Ÿä¸ä¼šè¢«åˆ†é…å¤„ç†å™¨æ‰§è¡Œæ—¶é—´ï¼Œä¸è¿‡æ— é¡»ç­‰å¾…è¢«å…¶ä»–çº¿ç¨‹æ˜¾å¼å”¤é†’ï¼Œåœ¨ä¸€å®šæ—¶é—´ä¹‹åå®ƒä»¬ä¼šç”±ç³»ç»Ÿè‡ªåŠ¨å”¤é†’ã€‚ä»¥ä¸‹æ–¹æ³•ä¼šè®©çº¿ç¨‹è¿›å…¥é™æœŸç­‰å¾…çŠ¶æ€ï¼š Thread::sleep()æ–¹æ³•ï¼› è®¾ç½®äº†Timeoutå‚æ•°çš„Object::wait()æ–¹æ³•ï¼› è®¾ç½®äº†Timeoutå‚æ•°çš„Thread::join()æ–¹æ³•ï¼› LockSupport::parkNanos()æ–¹æ³•ï¼› LockSupport::parkUntil()æ–¹æ³•ã€‚ é˜»å¡ï¼ˆBlockedï¼‰ï¼šçº¿ç¨‹è¢«é˜»å¡äº†ï¼Œâ€œé˜»å¡çŠ¶æ€â€ä¸â€œç­‰å¾…çŠ¶æ€â€çš„åŒºåˆ«æ˜¯â€œé˜»å¡çŠ¶æ€â€åœ¨ç­‰å¾…ç€è·å–åˆ°ä¸€ä¸ªæ’å®ƒé”ï¼Œè¿™ä¸ªäº‹ä»¶å°†åœ¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹æ”¾å¼ƒè¿™ä¸ªé”çš„æ—¶å€™å‘ç”Ÿï¼›è€Œâ€œç­‰å¾…çŠ¶æ€â€åˆ™æ˜¯åœ¨ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œæˆ–è€…å”¤é†’åŠ¨ä½œçš„å‘ç”Ÿã€‚åœ¨ç¨‹åºç­‰å¾…è¿›å…¥åŒæ­¥åŒºåŸŸçš„æ—¶å€™ï¼Œçº¿ç¨‹å°†è¿›å…¥è¿™ç§çŠ¶æ€ã€‚ ç»“æŸï¼ˆTerminatedï¼‰ï¼šå·²ç»ˆæ­¢çº¿ç¨‹çš„çº¿ç¨‹çŠ¶æ€ï¼Œçº¿ç¨‹å·²ç»ç»“æŸæ‰§è¡Œã€‚ 4 Javaä¸åç¨‹4.1 å†…æ ¸çº¿ç¨‹çš„å±€é™ä»Šå¤©å¯¹Webåº”ç”¨çš„æœåŠ¡è¦æ±‚ï¼Œä¸è®ºæ˜¯åœ¨è¯·æ±‚æ•°é‡ä¸Šè¿˜æ˜¯åœ¨å¤æ‚åº¦ä¸Šï¼Œä¸åå¤šå¹´å‰ç›¸æ¯”å·²ä¸å¯åŒæ—¥è€Œè¯­ï¼Œè¿™ä¸€æ–¹é¢æ˜¯æºäºä¸šåŠ¡é‡çš„å¢é•¿ï¼Œå¦ä¸€æ–¹é¢æ¥è‡ªäºä¸ºäº†åº”å¯¹ä¸šåŠ¡å¤æ‚åŒ–è€Œä¸æ–­è¿›è¡Œçš„æœåŠ¡ç»†åˆ†ã€‚ Javaç›®å‰çš„å¹¶å‘ç¼–ç¨‹æœºåˆ¶äº§ç”Ÿäº†ä¸€äº›çŸ›ç›¾ï¼Œ1ï¼š1çš„å†…æ ¸çº¿ç¨‹æ¨¡å‹æ˜¯å¦‚ä»ŠJavaè™šæ‹Ÿæœºçº¿ç¨‹å®ç°çš„ä¸»æµé€‰æ‹©ï¼Œä½†æ˜¯è¿™ç§æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿä¸Šçš„çº¿ç¨‹å¤©ç„¶çš„ç¼ºé™·æ˜¯åˆ‡æ¢ã€è°ƒåº¦æˆæœ¬é«˜æ˜‚ï¼Œç³»ç»Ÿèƒ½å®¹çº³çš„çº¿ç¨‹æ•°é‡ä¹Ÿå¾ˆæœ‰é™ã€‚ä»¥å‰å¤„ç†ä¸€ä¸ªè¯·æ±‚å¯ä»¥å…è®¸èŠ±è´¹å¾ˆé•¿æ—¶é—´åœ¨å•ä½“åº”ç”¨ä¸­ï¼Œå…·æœ‰è¿™ç§çº¿ç¨‹åˆ‡æ¢çš„æˆæœ¬ä¹Ÿæ˜¯æ— ä¼¤å¤§é›…çš„ï¼Œä½†ç°åœ¨åœ¨æ¯ä¸ªè¯·æ±‚æœ¬èº«çš„æ‰§è¡Œæ—¶é—´å˜å¾—å¾ˆçŸ­ã€æ•°é‡å˜å¾—å¾ˆå¤šçš„å‰æä¸‹ï¼Œç”¨æˆ·çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ç”šè‡³å¯èƒ½ä¼šæ¥è¿‘ç”¨äºè®¡ç®—æœ¬èº«çš„å¼€é”€ï¼Œè¿™å°±ä¼šé€ æˆä¸¥é‡çš„æµªè´¹ã€‚ ä¼ ç»Ÿçš„Java WebæœåŠ¡å™¨çš„çº¿ç¨‹æ± çš„å®¹é‡é€šå¸¸åœ¨å‡ åä¸ªåˆ°ä¸¤ç™¾ä¹‹é—´ï¼Œå½“ç¨‹åºå‘˜æŠŠæ•°ä»¥ç™¾ä¸‡è®¡çš„è¯·æ±‚å¾€çº¿ç¨‹æ± é‡Œé¢çŒæ—¶ï¼Œç³»ç»Ÿå³ä½¿èƒ½å¤„ç†å¾—è¿‡æ¥ï¼Œä½†å…¶ä¸­çš„åˆ‡æ¢æŸè€—ä¹Ÿæ˜¯ç›¸å½“å¯è§‚çš„ã€‚ 4.2 åç¨‹çš„å¤è‹åç¨‹é‡‡ç”¨ååŒè°ƒåº¦ï¼Œé€šè¿‡åº”ç”¨æ¥æ¨¡æ‹Ÿå¤šçº¿ç¨‹ï¼Œåˆ†ä¸ºæœ‰æ ˆåç¨‹ã€æ— æ ˆåç¨‹ã€‚ å„ç§è¯­è¨€ä¸­çš„awaitã€asyncã€yieldè¿™ç±»å…³é”®å­—æ˜¯æ— æ ˆåç¨‹ï¼Œæ›´è½»é‡ï¼Œä½†åŠŸèƒ½ä¹Ÿç›¸å¯¹æœ‰é™ã€‚ 4.3 Javaçš„è§£å†³æ–¹æ¡ˆå¯¹äºæœ‰æ ˆåç¨‹ï¼Œæœ‰ä¸€ç§ç‰¹ä¾‹å®ç°åä¸ºçº¤ç¨‹ï¼ˆFiberï¼‰ï¼Œè¿™ä¸ªè¯æœ€æ—©æ˜¯æ¥è‡ªå¾®è½¯å…¬å¸ï¼Œåæ¥å¾®è½¯è¿˜æ¨å‡ºè¿‡ç³»ç»Ÿå±‚é¢çš„çº¤ç¨‹åŒ…æ¥æ–¹ä¾¿åº”ç”¨åšç°åœºä¿å­˜ã€æ¢å¤å’Œçº¤ç¨‹è°ƒåº¦ã€‚ OpenJDKåœ¨2018å¹´åˆ›å»ºäº†Loomé¡¹ç›®ï¼Œè¿™æ˜¯Javaç”¨æ¥åº”å¯¹æœ¬èŠ‚å¼€ç¯‡æ‰€åˆ—åœºæ™¯çš„å®˜æ–¹è§£å†³æ–¹æ¡ˆï¼Œæ ¹æ®ç›®å‰å…¬å¼€çš„ä¿¡æ¯ï¼Œå¦‚æ— æ„å¤–ï¼Œæ—¥åè¯¥é¡¹ç›®ä¸ºJavaè¯­è¨€å¼•å…¥çš„ã€ä¸ç°åœ¨çº¿ç¨‹æ¨¡å‹å¹³è¡Œçš„æ–°å¹¶å‘ç¼–ç¨‹æœºåˆ¶ä¸­åº”è¯¥ä¹Ÿä¼šé‡‡ç”¨â€œçº¤ç¨‹â€è¿™ä¸ªåå­—ã€‚ Loomé¡¹ç›®èƒŒåçš„æ„å›¾æ˜¯é‡æ–°æä¾›å¯¹ç”¨æˆ·çº¿ç¨‹çš„æ”¯æŒï¼Œä½†ä¸è¿‡å»çš„ç»¿è‰²çº¿ç¨‹ä¸åŒï¼Œè¿™äº›æ–°åŠŸèƒ½ä¸æ˜¯ä¸ºäº†å–ä»£å½“å‰åŸºäºæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹å®ç°ï¼Œè€Œæ˜¯ä¼šæœ‰ä¸¤ä¸ªå¹¶å‘ç¼–ç¨‹æ¨¡å‹åœ¨Javaè™šæ‹Ÿæœºä¸­å¹¶å­˜ï¼Œå¯ä»¥åœ¨ç¨‹åºä¸­åŒæ—¶ä½¿ç”¨ã€‚æ–°æ¨¡å‹æœ‰æ„åœ°ä¿æŒäº†ä¸ç›®å‰çº¿ç¨‹æ¨¡å‹ç›¸ä¼¼çš„APIè®¾è®¡ï¼Œå®ƒä»¬ç”šè‡³å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªå…±åŒçš„åŸºç±»ï¼Œè¿™æ ·ç°æœ‰çš„ä»£ç å°±ä¸éœ€è¦ä¸ºäº†ä½¿ç”¨çº¤ç¨‹è€Œè¿›è¡Œè¿‡å¤šæ”¹åŠ¨ï¼Œç”šè‡³ä¸éœ€è¦çŸ¥é“èƒŒåé‡‡ç”¨äº†å“ªä¸ªå¹¶å‘ç¼–ç¨‹æ¨¡å‹ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jvm","slug":"jvm","permalink":"https://www.codetool.top/tags/jvm/"}]},{"title":"leetcode402-ç§»æ‰Kä½æ•°å­—","slug":"leetcode402-ç§»æ‰Kä½æ•°å­—","date":"2020-01-28T19:44:58.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode402-ç§»æ‰Kä½æ•°å­—/","link":"","permalink":"https://www.codetool.top/article/leetcode402-%E7%A7%BB%E6%8E%89K%E4%BD%8D%E6%95%B0%E5%AD%97/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªä»¥å­—ç¬¦ä¸²è¡¨ç¤ºçš„éè´Ÿæ•´æ•° numï¼Œç§»é™¤è¿™ä¸ªæ•°ä¸­çš„ k ä½æ•°å­—ï¼Œä½¿å¾—å‰©ä¸‹çš„æ•°å­—æœ€å°ã€‚ æ³¨æ„ï¼š num çš„é•¿åº¦å°äº 10002 ä¸” â‰¥ kã€‚ num ä¸ä¼šåŒ…å«ä»»ä½•å‰å¯¼é›¶ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥: num = â€œ1432219â€, k = 3è¾“å‡º: â€œ1219â€è§£é‡Š: ç§»é™¤æ‰ä¸‰ä¸ªæ•°å­— 4, 3, å’Œ 2 å½¢æˆä¸€ä¸ªæ–°çš„æœ€å°çš„æ•°å­— 1219ã€‚ ç¤ºä¾‹ 2ï¼š è¾“å…¥: num = â€œ10200â€, k = 1è¾“å‡º: â€œ200â€è§£é‡Š: ç§»æ‰é¦–ä½çš„ 1 å‰©ä¸‹çš„æ•°å­—ä¸º 200. æ³¨æ„è¾“å‡ºä¸èƒ½æœ‰ä»»ä½•å‰å¯¼é›¶ã€‚789 ç¤ºä¾‹ 3 : è¾“å…¥: num = â€œ10â€, k = 2è¾“å‡º: â€œ0â€è§£é‡Š: ä»åŸæ•°å­—ç§»é™¤æ‰€æœ‰çš„æ•°å­—ï¼Œå‰©ä½™ä¸ºç©ºå°±æ˜¯0ã€‚ 2 è§£æ³•2.1 æ€æƒ³è¦åœ¨ä¸€ä¸ªé•¿åº¦ä¸ºlengthçš„å­—ç¬¦æ•°ç»„ä¸­å»æ‰kä½ï¼Œç•™ä¸‹ä¸€ä¸ªæœ€å°æ•°å­—ï¼Œåˆ™æ˜¯è¦ç•™ä¸‹ä¸€ä¸ªlength-kä½çš„æ•°å­—ï¼Œæˆ‘ä»¬æ¯ä¸€æ¬¡éƒ½è¦ä¿è¯åœ¨å‰©ä½™ä½æ•°å……è¶³çš„æƒ…å†µä¸‹é€‰æ‹©æœ€å°çš„æ•°å­—ã€‚ å¯¹äºç¤ºä¾‹ä¸€ï¼Œ&quot;1432219&quot;è¦é€‰å‡º7-3=4ä½æ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥ä¿ç•™æœ€åä¸‰ä½ï¼Œåœ¨å‰äº”ä½ä¸­é€‰å‡ºä¸€ä¸ªæœ€å°æ•°å­—1ï¼Œç„¶ååœ¨å‰©ä¸‹çš„&quot;432219&quot;ä¸­é€‰å‡º3ä½æ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥ä¿ç•™æœ€åä¸¤ä½ï¼Œåœ¨å‰å››ä½ä¸­é€‰å‡ºä¸€ä¸ªæœ€å°æ•°å­—2ï¼Œç„¶ååœ¨å‰©ä¸‹çš„&quot;219&quot;ä¸­é€‰å‡º2ä½æ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥ä¿ç•™æœ€åä¸€ä½ï¼Œåœ¨å‰ä¸¤ä½ä¸­é€‰å‡ºä¸€ä¸ªæœ€å°æ•°å­—1ï¼Œç„¶ååœ¨å‰©ä¸‹çš„&quot;9&quot;ä¸­é€‰å‡º1ä½æ•°å­—ï¼Œé€‰å–9ã€‚ å¾—åˆ°çš„ç»“æœå°±æ˜¯&quot;1219&quot; 2.2 ä»£ç class Solution { public String removeKdigits(String num, int k) { char[] nums = num.toCharArray(); int start = 0;//ä¸‹ä¸€æ¬¡é€‰å–æ•°å­—å¼€å§‹çš„ä½ç½® int min = 0; int origink = k; char[] result = new char[nums.length-k];//ä¿å­˜ç»“æœ while(k&lt;nums.length){ for(int i = start;i&lt;k+1;i++){//ä¿ç•™æœ‰é™ä½æ•°ï¼Œé€‰å–æœ€å°æ•°å­— if(nums[i]&lt;nums[min]){ min = i; } } result[k-origink] = nums[min]; k++; start = min+1; min = start; } for(int i = 0;i&lt;=result.length;i++){//å»é™¤å¼€å¤´çš„0 if(i==result.length) return \"0\"; if(result[i]!='0'){ result = Arrays.copyOfRange(result,i,result.length); break; } } return String.valueOf(result); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode385-è¿·ä½ è¯­æ³•åˆ†æå™¨","slug":"leetcode385-è¿·ä½ è¯­æ³•åˆ†æå™¨","date":"2020-01-27T18:14:31.000Z","updated":"2020-04-22T09:27:27.204Z","comments":true,"path":"article/leetcode385-è¿·ä½ è¯­æ³•åˆ†æå™¨/","link":"","permalink":"https://www.codetool.top/article/leetcode385-%E8%BF%B7%E4%BD%A0%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90%E5%99%A8/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªç”¨å­—ç¬¦ä¸²è¡¨ç¤ºçš„æ•´æ•°çš„åµŒå¥—åˆ—è¡¨ï¼Œå®ç°ä¸€ä¸ªè§£æå®ƒçš„è¯­æ³•åˆ†æå™¨ã€‚ åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ åªå¯èƒ½æ˜¯æ•´æ•°æˆ–æ•´æ•°åµŒå¥—åˆ—è¡¨ æç¤ºï¼š ä½ å¯ä»¥å‡å®šè¿™äº›å­—ç¬¦ä¸²éƒ½æ˜¯æ ¼å¼è‰¯å¥½çš„ï¼š å­—ç¬¦ä¸²éç©º å­—ç¬¦ä¸²ä¸åŒ…å«ç©ºæ ¼ å­—ç¬¦ä¸²åªåŒ…å«æ•°å­—0-9, [, - ,,, ] ç¤ºä¾‹ 1ï¼š ç»™å®š s = â€œ324â€, ä½ åº”è¯¥è¿”å›ä¸€ä¸ª NestedInteger å¯¹è±¡ï¼Œå…¶ä¸­åªåŒ…å«æ•´æ•°å€¼ 324ã€‚ ç¤ºä¾‹ 2ï¼š ç»™å®š s = â€œ[123,[456,[789]]]â€, è¿”å›ä¸€ä¸ª NestedInteger å¯¹è±¡åŒ…å«ä¸€ä¸ªæœ‰ä¸¤ä¸ªå…ƒç´ çš„åµŒå¥—åˆ—è¡¨ï¼š 1. ä¸€ä¸ª integer åŒ…å«å€¼ 1232. ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„åµŒå¥—åˆ—è¡¨ï¼š&nbsp;&nbsp;&nbsp;&nbsp;i. ä¸€ä¸ª integer åŒ…å«å€¼ 456&nbsp;&nbsp;&nbsp;&nbsp;ii. ä¸€ä¸ªåŒ…å«ä¸€ä¸ªå…ƒç´ çš„åµŒå¥—åˆ—è¡¨&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a. ä¸€ä¸ª integer åŒ…å«å€¼ 789 2 è§£æ³•2.1 æ€æƒ³è®¾å®šä¸€ä¸ªgetNest()å‡½æ•°ç”¨äºè¿”å›ä¸€ä¸ªåˆ—è¡¨ç±»å‹çš„NestedIntegerã€‚ ç›¸å½“äºæ¯ä¸ª[ ]ä¸­éƒ½ä»£è¡¨ä¸€æ¬¡é€’å½’å‡½æ•°è°ƒç”¨ã€‚ æœ€é‡è¦çš„æ€æƒ³æ˜¯é€šè¿‡ç±»çš„å…¨å±€å­—ç¬¦æ•°ç»„å’Œä¸€ä¸ªä¸‹æ ‡å€¼è®©æ¯æ¬¡è°ƒç”¨é€’å½’å‡½æ•°éƒ½çŸ¥é“è¦å¤„ç†å“ªä¸ªä½ç½®ã€‚ 2.2 ä»£ç class Solution { //é€’å½’å‡½æ•°é€šè¿‡å­—ç¬¦æ•°ç»„å’Œcurä¸‹æ ‡ç¡®å®šè¦å¤„ç†çš„ä½ç½® char[] chars; int cur = 0; public NestedInteger deserialize(String s) { chars = s.toCharArray(); //æœ¬èº«ä¸æ˜¯ä¸€ä¸ªé›†åˆè€Œæ˜¯ä¸€ä¸ªæ•´æ•°çš„æƒ…å†µ if(chars[0]!='[') return new NestedInteger(Integer.valueOf(s)); //è°ƒç”¨é€’å½’å‡½æ•°è¿”å›æ ¹é›†åˆ return getNest(); } public NestedInteger getNest(){ NestedInteger nest = new NestedInteger(); int num = 0;//numç”¨äºç¼“å­˜ç”¨é€—å·åˆ†å‰²çš„æ•´æ•°ç±»å‹çš„å€¼ boolean negative = false;//å½“å‰è®°å½•çš„æ•´æ•°æ˜¯ä¸æ˜¯è´Ÿæ•° while(cur!=chars.length-1){ cur ++; if(chars[cur]==',') continue; if(chars[cur]=='[') nest.add(getNest());//é‡åˆ°[é€’å½’è·å–å­é›†åˆ else if(chars[cur]==']') return nest; else if(chars[cur]=='-') negative = true; else{//æ˜¯æ•°å­—çš„æƒ…å†µ if(negative) num = 10*num - (chars[cur]-48); else num = 10*num + (chars[cur]-48); //å¦‚æœä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯,æˆ–è€…]è¯´æ˜å½“å‰æ•°å­—å·²ç»è®°å½•å®Œäº†ï¼Œéœ€è¦åŠ å…¥é›†åˆä¸­ if(chars[cur+1]==','||chars[cur+1]==']'){ nest.add(new NestedInteger(num)); num = 0; negative = false; } } } return null; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"}]},{"title":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°11","slug":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°11","date":"2020-01-27T12:32:40.000Z","updated":"2020-04-22T09:27:27.192Z","comments":true,"path":"article/æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°11/","link":"","permalink":"https://www.codetool.top/article/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%AC%AC%E4%B8%89%E7%89%88%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B011/","excerpt":"","text":"ä»¥ä¸‹æ˜¯ç¬¬åä¸€ç«  åç«¯ç¼–è¯‘ä¸ä¼˜åŒ–çš„å†…å®¹ æŠŠClassæ–‡ä»¶è½¬æ¢æˆä¸æœ¬åœ°åŸºç¡€è®¾æ–½ï¼ˆç¡¬ä»¶æŒ‡ä»¤é›†ã€æ“ä½œç³»ç»Ÿï¼‰ç›¸å…³çš„äºŒè¿›åˆ¶æœºå™¨ç å¯ä»¥è§†ä¸ºæ•´ä¸ªç¼–è¯‘è¿‡ç¨‹çš„åç«¯ã€‚ æœ€è¿‘å‡ å¹´æå‰ç¼–è¯‘ä¹Ÿå¼€å§‹å…´èµ·ï¼Œæˆ‘ä»¬åœ¨è¿™ç« æŠŠå®ƒå’Œå³æ—¶ç¼–è¯‘å…±ç§°ä¸ºåç«¯ç¼–è¯‘ã€‚ 1 å³æ—¶ç¼–è¯‘å™¨ç›®å‰ä¸»æµçš„ä¸¤æ¬¾å•†ç”¨Javaè™šæ‹Ÿæœºï¼ˆHotSpotã€OpenJ9ï¼‰é‡Œï¼ŒJavaç¨‹åºæœ€åˆéƒ½æ˜¯é€šè¿‡è§£é‡Šå™¨è¿›è¡Œè§£é‡Šæ‰§è¡Œçš„ï¼Œå½“è™šæ‹Ÿæœºå‘ç°æŸä¸ªæ–¹æ³•æˆ–ä»£ç å—çš„è¿è¡Œç‰¹åˆ«é¢‘ç¹ï¼Œå°±ä¼šæŠŠè¿™äº›ä»£ç è®¤å®šä¸ºâ€œçƒ­ç‚¹ä»£ç â€ï¼ˆHot Spot Codeï¼‰ï¼Œä¸ºäº†æé«˜çƒ­ç‚¹ä»£ç çš„æ‰§è¡Œæ•ˆç‡ï¼Œåœ¨è¿è¡Œæ—¶ï¼Œè™šæ‹Ÿæœºå°†ä¼šæŠŠè¿™äº›ä»£ç ç¼–è¯‘æˆæœ¬åœ°æœºå™¨ç ï¼Œå¹¶ä»¥å„ç§æ‰‹æ®µå°½å¯èƒ½åœ°è¿›è¡Œä»£ç ä¼˜åŒ–ï¼Œè¿è¡Œæ—¶å®Œæˆè¿™ä¸ªä»»åŠ¡çš„åç«¯ç¼–è¯‘å™¨è¢«ç§°ä¸ºå³æ—¶ç¼–è¯‘å™¨ã€‚ 1.1 è§£é‡Šå™¨ä¸ç¼–è¯‘å™¨ç›®å‰ä¸»æµçš„å•†ç”¨Javaè™šæ‹Ÿæœºå†…éƒ¨éƒ½åŒæ—¶åŒ…å«è§£é‡Šå™¨ä¸ç¼–è¯‘å™¨ã€‚è§£é‡Šå™¨ä¸ç¼–è¯‘å™¨ä¸¤è€…å„æœ‰ä¼˜åŠ¿ï¼šå½“ç¨‹åºéœ€è¦è¿…é€Ÿå¯åŠ¨å’Œæ‰§è¡Œçš„æ—¶å€™ï¼Œè§£é‡Šå™¨å¯ä»¥é¦–å…ˆå‘æŒ¥ä½œç”¨ï¼Œçœå»ç¼–è¯‘çš„æ—¶é—´ï¼Œç«‹å³è¿è¡Œã€‚å½“ç¨‹åºå¯åŠ¨åï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œç¼–è¯‘å™¨é€æ¸å‘æŒ¥ä½œç”¨ï¼ŒæŠŠè¶Šæ¥è¶Šå¤šçš„ä»£ç ç¼–è¯‘æˆæœ¬åœ°ä»£ç ï¼Œè¿™æ ·å¯ä»¥å‡å°‘è§£é‡Šå™¨çš„ä¸­é—´æŸè€—ï¼Œè·å¾—æ›´é«˜çš„æ‰§è¡Œæ•ˆç‡ã€‚ HotSpotè™šæ‹Ÿæœºä¸­å†…ç½®äº†ä¸¤ä¸ªï¼ˆæˆ–ä¸‰ä¸ªï¼‰å³æ—¶ç¼–è¯‘å™¨ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªç¼–è¯‘å™¨å­˜åœ¨å·²ä¹…ï¼Œåˆ†åˆ«è¢«ç§°ä¸ºâ€œå®¢æˆ·ç«¯ç¼–è¯‘å™¨â€ï¼ˆClient Compilerï¼‰å’Œâ€œæœåŠ¡ç«¯ç¼–è¯‘å™¨â€ï¼ˆServer Compilerï¼‰ï¼Œæˆ–è€…ç®€ç§°ä¸ºC1ç¼–è¯‘å™¨å’ŒC2ç¼–è¯‘å™¨,ç¬¬ä¸‰ä¸ªæ˜¯åœ¨JDK 10æ—¶æ‰å‡ºç°çš„ã€é•¿æœŸç›®æ ‡æ˜¯ä»£æ›¿C2çš„Graalç¼–è¯‘å™¨ã€‚ è§£é‡Šå™¨ä¸ç¼–è¯‘å™¨æ­é…ä½¿ç”¨çš„æ–¹å¼åœ¨è™šæ‹Ÿæœºä¸­è¢«ç§°ä¸ºâ€œæ··åˆæ¨¡å¼â€ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥ä½¿ç”¨å‚æ•°-Xintå¼ºåˆ¶è™šæ‹Ÿæœºè¿è¡Œäºâ€œè§£é‡Šæ¨¡å¼â€ã€‚å¦å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å‚æ•°-Xcompå¼ºåˆ¶è™šæ‹Ÿæœºè¿è¡Œäºâ€œç¼–è¯‘æ¨¡å¼â€ï¼Œè¿™æ—¶å€™å°†ä¼˜å…ˆé‡‡ç”¨ç¼–è¯‘æ–¹å¼æ‰§è¡Œç¨‹åºï¼Œä½†æ˜¯è§£é‡Šå™¨ä»ç„¶è¦åœ¨ç¼–è¯‘æ— æ³•è¿›è¡Œçš„æƒ…å†µä¸‹ä»‹å…¥æ‰§è¡Œè¿‡ç¨‹ã€‚ ç”±äºå³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æœ¬åœ°ä»£ç éœ€è¦å ç”¨ç¨‹åºè¿è¡Œæ—¶é—´ï¼Œé€šå¸¸è¦ç¼–è¯‘å‡ºä¼˜åŒ–ç¨‹åº¦è¶Šé«˜çš„ä»£ç ï¼Œæ‰€èŠ±è´¹çš„æ—¶é—´ä¾¿ä¼šè¶Šé•¿ï¼›è€Œä¸”æƒ³è¦ç¼–è¯‘å‡ºä¼˜åŒ–ç¨‹åº¦æ›´é«˜çš„ä»£ç ï¼Œè§£é‡Šå™¨å¯èƒ½è¿˜è¦æ›¿ç¼–è¯‘å™¨æ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼Œè¿™å¯¹è§£é‡Šæ‰§è¡Œé˜¶æ®µçš„é€Ÿåº¦ä¹Ÿæœ‰æ‰€å½±å“ã€‚ä¸ºäº†åœ¨ç¨‹åºå¯åŠ¨å“åº”é€Ÿåº¦ä¸è¿è¡Œæ•ˆç‡ä¹‹é—´è¾¾åˆ°æœ€ä½³å¹³è¡¡ï¼Œ HotSpotè™šæ‹Ÿæœºåœ¨ç¼–è¯‘å­ç³»ç»Ÿä¸­åŠ å…¥äº†åˆ†å±‚ç¼–è¯‘çš„åŠŸèƒ½ã€‚ åˆ†å±‚ç¼–è¯‘æ ¹æ®ç¼–è¯‘å™¨ç¼–è¯‘ã€ä¼˜åŒ–çš„è§„æ¨¡ä¸è€—æ—¶ï¼Œåˆ’åˆ†å‡ºä¸åŒçš„ç¼–è¯‘å±‚æ¬¡ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š ç¬¬0å±‚ã€‚ç¨‹åºçº¯è§£é‡Šæ‰§è¡Œï¼Œå¹¶ä¸”è§£é‡Šå™¨ä¸å¼€å¯æ€§èƒ½ç›‘æ§åŠŸèƒ½ï¼ˆProfilingï¼‰ã€‚ ç¬¬1å±‚ã€‚ä½¿ç”¨å®¢æˆ·ç«¯ç¼–è¯‘å™¨å°†å­—èŠ‚ç ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç æ¥è¿è¡Œï¼Œè¿›è¡Œç®€å•å¯é çš„ç¨³å®šä¼˜åŒ–ï¼Œä¸å¼€å¯æ€§èƒ½ç›‘æ§åŠŸèƒ½ã€‚ ç¬¬2å±‚ã€‚ä»ç„¶ä½¿ç”¨å®¢æˆ·ç«¯ç¼–è¯‘å™¨æ‰§è¡Œï¼Œä»…å¼€å¯æ–¹æ³•åŠå›è¾¹æ¬¡æ•°ç»Ÿè®¡ç­‰æœ‰é™çš„æ€§èƒ½ç›‘æ§åŠŸèƒ½ã€‚ ç¬¬3å±‚ã€‚ä»ç„¶ä½¿ç”¨å®¢æˆ·ç«¯ç¼–è¯‘å™¨æ‰§è¡Œï¼Œå¼€å¯å…¨éƒ¨æ€§èƒ½ç›‘æ§ï¼Œé™¤äº†ç¬¬2å±‚çš„ç»Ÿè®¡ä¿¡æ¯å¤–ï¼Œè¿˜ä¼šæ”¶é›†å¦‚åˆ†æ”¯è·³è½¬ã€è™šæ–¹æ³•è°ƒç”¨ç‰ˆæœ¬ç­‰å…¨éƒ¨çš„ç»Ÿè®¡ä¿¡æ¯ã€‚ ç¬¬4å±‚ã€‚ä½¿ç”¨æœåŠ¡ç«¯ç¼–è¯‘å™¨å°†å­—èŠ‚ç ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç ï¼Œç›¸æ¯”èµ·å®¢æˆ·ç«¯ç¼–è¯‘å™¨ï¼ŒæœåŠ¡ç«¯ç¼–è¯‘å™¨ä¼šå¯ç”¨æ›´å¤šç¼–è¯‘è€—æ—¶æ›´é•¿çš„ä¼˜åŒ–ï¼Œè¿˜ä¼šæ ¹æ®æ€§èƒ½ç›‘æ§ä¿¡æ¯è¿›è¡Œä¸€äº›ä¸å¯é çš„æ¿€è¿›ä¼˜åŒ–ã€‚ 1.2 ç¼–è¯‘å¯¹è±¡ä¸è§¦å‘æ¡ä»¶çƒ­ç‚¹ä»£ç ï¼š è¢«å¤šæ¬¡è°ƒç”¨çš„æ–¹æ³• è¢«å¤šæ¬¡æ‰§è¡Œçš„å¾ªç¯ä½“ å¯¹äºè¿™ä¸¤ç§æƒ…å†µï¼Œç¼–è¯‘çš„ç›®æ ‡å¯¹è±¡éƒ½æ˜¯æ•´ä¸ªæ–¹æ³•ä½“ï¼Œè€Œä¸ä¼šæ˜¯å•ç‹¬çš„å¾ªç¯ä½“ã€‚ è¦çŸ¥é“æŸæ®µä»£ç æ˜¯ä¸æ˜¯çƒ­ç‚¹ä»£ç ï¼Œç§°ä¸ºâ€œçƒ­ç‚¹æ¢æµ‹â€ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š åŸºäºé‡‡æ ·çš„çƒ­ç‚¹æ¢æµ‹ï¼šå‘¨æœŸæ€§åœ°æ£€æŸ¥å„ä¸ªçº¿ç¨‹çš„è°ƒç”¨æ ˆé¡¶ï¼Œå¦‚æœå‘ç°æŸä¸ªï¼ˆæˆ–æŸäº›ï¼‰æ–¹æ³•ç»å¸¸å‡ºç°åœ¨æ ˆé¡¶ï¼Œé‚£è¿™ä¸ªæ–¹æ³•å°±æ˜¯â€œçƒ­ç‚¹æ–¹æ³•â€ã€‚ åŸºäºè®¡æ•°å™¨çš„çƒ­ç‚¹æ¢æµ‹ï¼šä¸ºæ¯ä¸ªæ–¹æ³•ï¼ˆç”šè‡³æ˜¯ä»£ç å—ï¼‰å»ºç«‹è®¡æ•°å™¨ï¼Œç»Ÿè®¡æ–¹æ³•çš„æ‰§è¡Œæ¬¡æ•°ï¼Œå¦‚æœæ‰§è¡Œæ¬¡æ•°è¶…è¿‡ä¸€å®šçš„é˜ˆå€¼å°±è®¤ä¸ºå®ƒæ˜¯â€œçƒ­ç‚¹æ–¹æ³•â€ï¼Œæ›´ç²¾ç¡®ã€‚ HotSpotä½¿ç”¨äº†ç¬¬äºŒç§æ–¹æ³•ï¼Œä¸ºäº†å®ç°çƒ­ç‚¹è®¡æ•°ï¼ŒHotSpotä¸ºæ¯ä¸ªæ–¹æ³•å‡†å¤‡äº†ä¸¤ç±»è®¡æ•°å™¨ï¼šæ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ï¼ˆInvocation Counterï¼‰å’Œå›è¾¹è®¡æ•°å™¨ï¼ˆBack Edge Counterï¼Œâ€œå›è¾¹â€çš„æ„æ€å°±æ˜¯æŒ‡åœ¨å¾ªç¯è¾¹ç•Œå¾€å›è·³è½¬ï¼‰ã€‚å½“è™šæ‹Ÿæœºè¿è¡Œå‚æ•°ç¡®å®šçš„å‰æä¸‹ï¼Œè¿™ä¸¤ä¸ªè®¡æ•°å™¨éƒ½æœ‰ä¸€ä¸ªæ˜ç¡®çš„é˜ˆå€¼ï¼Œä¸€æ—¦æº¢å‡ºï¼Œå°±ä¼šè§¦å‘å³æ—¶ç¼–è¯‘ã€‚ æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨é»˜è®¤é˜ˆå€¼åœ¨å®¢æˆ·ç«¯æ¨¡å¼ä¸‹æ˜¯1500æ¬¡ï¼Œåœ¨æœåŠ¡ç«¯æ¨¡å¼ä¸‹æ˜¯10000æ¬¡ï¼Œè¿™ä¸ªé˜ˆå€¼å¯ä»¥é€šè¿‡è™šæ‹Ÿæœºå‚æ•°-XXï¼š CompileThresholdæ¥äººä¸ºè®¾å®šã€‚ åœ¨é»˜è®¤è®¾ç½®ä¸‹ï¼Œæ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ç»Ÿè®¡çš„å¹¶ä¸æ˜¯æ–¹æ³•è¢«è°ƒç”¨çš„ç»å¯¹æ¬¡æ•°ï¼Œè€Œæ˜¯ä¸€æ®µæ—¶é—´ä¹‹å†…æ–¹æ³•è¢«è°ƒç”¨çš„æ¬¡æ•°ã€‚å½“è¶…è¿‡ä¸€å®šçš„æ—¶é—´é™åº¦ï¼Œå¦‚æœæ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°ä»ç„¶ä¸è¶³ä»¥è®©å®ƒæäº¤ç»™å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘ï¼Œé‚£è¯¥æ–¹æ³•çš„è°ƒç”¨è®¡æ•°å™¨å°±ä¼šè¢«å‡å°‘ä¸€åŠï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºæ–¹æ³•è°ƒç”¨è®¡æ•°å™¨çƒ­åº¦çš„è¡°å‡ï¼Œè€Œè¿™æ®µæ—¶é—´å°±ç§°ä¸ºæ­¤æ–¹æ³•ç»Ÿè®¡çš„åŠè¡°å‘¨æœŸï¼Œè¿›è¡Œçƒ­åº¦è¡°å‡çš„åŠ¨ä½œæ˜¯åœ¨è™šæ‹Ÿæœºè¿›è¡Œåƒåœ¾æ”¶é›†æ—¶é¡ºä¾¿è¿›è¡Œçš„ï¼Œå¯ä»¥ä½¿ç”¨è™šæ‹Ÿæœºå‚æ•°-XXï¼š-UseCounterDecayæ¥å…³é—­çƒ­åº¦è¡°å‡ï¼Œè®©æ–¹æ³•è®¡æ•°å™¨ç»Ÿè®¡æ–¹æ³•è°ƒç”¨çš„ç»å¯¹æ¬¡æ•°ï¼Œè¿™æ ·åªè¦ç³»ç»Ÿè¿è¡Œæ—¶é—´è¶³å¤Ÿé•¿ï¼Œç¨‹åºä¸­ç»å¤§éƒ¨åˆ†æ–¹æ³•éƒ½ä¼šè¢«ç¼–è¯‘æˆæœ¬åœ°ä»£ç ã€‚å¦å¤–è¿˜å¯ä»¥ä½¿ç”¨-XXï¼šCounterHalfLifeTimeå‚æ•°è®¾ç½®åŠè¡°å‘¨æœŸçš„æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ã€‚ å›è¾¹è®¡æ•°å™¨ç»Ÿè®¡ä¸€ä¸ªæ–¹æ³•ä¸­å¾ªç¯ä½“ä»£ç æ‰§è¡Œçš„æ¬¡æ•°ï¼Œé˜ˆå€¼ä½¿ç”¨-XXï¼šOnStackReplacePercentageé—´æ¥è®¾ç½®ï¼š è™šæ‹Ÿæœºè¿è¡Œåœ¨å®¢æˆ·ç«¯æ¨¡å¼ä¸‹ï¼Œå›è¾¹è®¡æ•°å™¨é˜ˆå€¼è®¡ç®—å…¬å¼ä¸ºï¼šæ–¹æ³•è°ƒç”¨è®¡æ•°å™¨é˜ˆå€¼ï¼ˆ-XXï¼šCompileThresholdï¼‰ä¹˜ä»¥OSRæ¯”ç‡ï¼ˆ-XXï¼šOnStackReplacePercentageï¼‰é™¤ä»¥100ã€‚å…¶ä¸­-XXï¼šOnStackReplacePercentageé»˜è®¤å€¼ä¸º933ï¼Œå¦‚æœéƒ½å–é»˜è®¤å€¼ï¼Œé‚£å®¢æˆ·ç«¯æ¨¡å¼è™šæ‹Ÿæœºçš„å›è¾¹è®¡æ•°å™¨çš„é˜ˆå€¼ä¸º13995ã€‚ è™šæ‹Ÿæœºè¿è¡Œåœ¨æœåŠ¡ç«¯æ¨¡å¼ä¸‹ï¼Œå›è¾¹è®¡æ•°å™¨é˜ˆå€¼çš„è®¡ç®—å…¬å¼ä¸ºï¼šæ–¹æ³•è°ƒç”¨è®¡æ•°å™¨é˜ˆå€¼ï¼ˆ-XXï¼šCompileThresholdï¼‰ä¹˜ä»¥ï¼ˆOSRæ¯”ç‡ï¼ˆ-XXï¼šOnStackReplacePercentageï¼‰å‡å»è§£é‡Šå™¨ç›‘æ§æ¯”ç‡ï¼ˆ-XXï¼šInterpreterProfilePercentageï¼‰çš„å·®å€¼ï¼‰é™¤ä»¥100ã€‚å…¶ä¸­-XXï¼šOnStack ReplacePercentageé»˜è®¤å€¼ä¸º140ï¼ŒXXï¼šInterpreterProfilePercentageé»˜è®¤å€¼ä¸º33ï¼Œå¦‚æœéƒ½å–é»˜è®¤å€¼ï¼Œé‚£æœåŠ¡ç«¯æ¨¡å¼è™šæ‹Ÿæœºå›è¾¹è®¡æ•°å™¨çš„é˜ˆå€¼ä¸º10700ã€‚ ä¸æ–¹æ³•è®¡æ•°å™¨ä¸åŒï¼Œå›è¾¹è®¡æ•°å™¨æ²¡æœ‰è®¡æ•°çƒ­åº¦è¡°å‡çš„è¿‡ç¨‹ï¼Œå› æ­¤è¿™ä¸ªè®¡æ•°å™¨ç»Ÿè®¡çš„å°±æ˜¯è¯¥æ–¹æ³•å¾ªç¯æ‰§è¡Œçš„ç»å¯¹æ¬¡æ•°ã€‚å½“è®¡æ•°å™¨æº¢å‡ºçš„æ—¶å€™ï¼Œå®ƒè¿˜ä¼šæŠŠæ–¹æ³•è®¡æ•°å™¨çš„å€¼ä¹Ÿè°ƒæ•´åˆ°æº¢å‡ºçŠ¶æ€ï¼Œè¿™æ ·ä¸‹æ¬¡å†è¿›å…¥è¯¥æ–¹æ³•çš„æ—¶å€™å°±ä¼šæ‰§è¡Œæ ‡å‡†ç¼–è¯‘è¿‡ç¨‹ã€‚ 1.3 ç¼–è¯‘è¿‡ç¨‹åœ¨é»˜è®¤æ¡ä»¶ä¸‹ï¼Œç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œè™šæ‹Ÿæœºä»ç„¶å°†æŒ‰ç…§è§£é‡Šæ–¹å¼ç»§ç»­æ‰§è¡Œä»£ç ï¼Œç¼–è¯‘åŠ¨ä½œåˆ™åœ¨åå°çš„ç¼–è¯‘çº¿ç¨‹ä¸­è¿›è¡Œã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡å‚æ•°-XXï¼š-BackgroundCompilationæ¥ç¦æ­¢åå°ç¼–è¯‘ï¼Œåå°ç¼–è¯‘è¢«ç¦æ­¢åï¼Œç¼–è¯‘çš„æ—¶å€™å°†ä¼šä¸€ç›´é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°ç¼–è¯‘è¿‡ç¨‹å®Œæˆå†å¼€å§‹æ‰§è¡Œä»£ç ã€‚ æœåŠ¡ç«¯ç¼–è¯‘å™¨å’Œå®¢æˆ·ç«¯ç¼–è¯‘å™¨çš„ç¼–è¯‘è¿‡ç¨‹æ˜¯æœ‰æ‰€å·®åˆ«çš„ã€‚å¯¹äºå®¢æˆ·ç«¯ç¼–è¯‘å™¨æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•å¿«é€Ÿçš„ä¸‰æ®µå¼ç¼–è¯‘å™¨ï¼Œä¸»è¦çš„å…³æ³¨ç‚¹åœ¨äºå±€éƒ¨æ€§çš„ä¼˜åŒ–ï¼Œè€Œæ”¾å¼ƒäº†è®¸å¤šè€—æ—¶è¾ƒé•¿çš„å…¨å±€ä¼˜åŒ–æ‰‹æ®µã€‚ åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œä¸€ä¸ªå¹³å°ç‹¬ç«‹çš„å‰ç«¯å°†å­—èŠ‚ç æ„é€ æˆä¸€ç§é«˜çº§ä¸­é—´ä»£ç è¡¨ç¤ºï¼ˆHIRï¼Œå³ä¸ç›®æ ‡æœºå™¨æŒ‡ä»¤é›†æ— å…³çš„ä¸­é—´è¡¨ç¤ºï¼‰ã€‚HIRä½¿ç”¨é™æ€å•åˆ†é…ï¼ˆStatic Single Assignmentï¼ŒSSAï¼‰çš„å½¢å¼æ¥ä»£è¡¨ä»£ç å€¼ï¼Œè¿™å¯ä»¥ä½¿å¾—ä¸€äº›åœ¨HIRçš„æ„é€ è¿‡ç¨‹ä¹‹ä¸­å’Œä¹‹åè¿›è¡Œçš„ä¼˜åŒ–åŠ¨ä½œæ›´å®¹æ˜“å®ç°ã€‚åœ¨æ­¤ä¹‹å‰ç¼–è¯‘å™¨å·²ç»ä¼šåœ¨å­—èŠ‚ç ä¸Šå®Œæˆä¸€éƒ¨åˆ†åŸºç¡€ä¼˜åŒ–ï¼Œå¦‚æ–¹æ³•å†…è”ã€å¸¸é‡ä¼ æ’­ç­‰ä¼˜åŒ–å°†ä¼šåœ¨å­—èŠ‚ç è¢«æ„é€ æˆHIRä¹‹å‰å®Œæˆã€‚ åœ¨ç¬¬äºŒä¸ªé˜¶æ®µï¼Œä¸€ä¸ªå¹³å°ç›¸å…³çš„åç«¯ä»HIRä¸­äº§ç”Ÿä½çº§ä¸­é—´ä»£ç è¡¨ç¤ºï¼ˆLIRï¼Œå³ä¸ç›®æ ‡æœºå™¨æŒ‡ä»¤é›†ç›¸å…³çš„ä¸­é—´è¡¨ç¤ºï¼‰ï¼Œè€Œåœ¨æ­¤ä¹‹å‰ä¼šåœ¨HIRä¸Šå®Œæˆå¦å¤–ä¸€äº›ä¼˜åŒ–ï¼Œå¦‚ç©ºå€¼æ£€æŸ¥æ¶ˆé™¤ã€èŒƒå›´æ£€æŸ¥æ¶ˆé™¤ç­‰ï¼Œä»¥ä¾¿è®©HIRè¾¾åˆ°æ›´é«˜æ•ˆçš„ä»£ç è¡¨ç¤ºå½¢å¼ã€‚ æœ€åçš„é˜¶æ®µæ˜¯åœ¨å¹³å°ç›¸å…³çš„åç«¯ä½¿ç”¨çº¿æ€§æ‰«æç®—æ³•åœ¨LIRä¸Šåˆ†é…å¯„å­˜å™¨ï¼Œå¹¶åœ¨LIRä¸Šåšçª¥å­”ï¼ˆPeepholeï¼‰ä¼˜åŒ–ï¼Œç„¶åäº§ç”Ÿæœºå™¨ä»£ç ã€‚ è€ŒæœåŠ¡ç«¯ç¼–è¯‘å™¨åˆ™æ˜¯ä¸“é—¨é¢å‘æœåŠ¡ç«¯çš„å…¸å‹åº”ç”¨åœºæ™¯ï¼Œå¹¶ä¸ºæœåŠ¡ç«¯çš„æ€§èƒ½é…ç½®é’ˆå¯¹æ€§è°ƒæ•´è¿‡çš„ç¼–è¯‘å™¨ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªèƒ½å®¹å¿å¾ˆé«˜ä¼˜åŒ–å¤æ‚åº¦çš„é«˜çº§ç¼–è¯‘å™¨ï¼Œå‡ ä¹èƒ½è¾¾åˆ°GNU C++ç¼–è¯‘å™¨ä½¿ç”¨-O2å‚æ•°æ—¶çš„ä¼˜åŒ–å¼ºåº¦ã€‚å®ƒä¼šæ‰§è¡Œå¤§éƒ¨åˆ†ç»å…¸çš„ä¼˜åŒ–åŠ¨ä½œï¼Œå¦‚ï¼šæ— ç”¨ä»£ç æ¶ˆé™¤ã€å¾ªç¯å±•å¼€ã€å¾ªç¯è¡¨è¾¾å¼å¤–æã€æ¶ˆé™¤å…¬å…±å­è¡¨è¾¾å¼ã€å¸¸é‡ä¼ æ’­ã€åŸºæœ¬å—é‡æ’åºç­‰ï¼Œè¿˜ä¼šå®æ–½ä¸€äº›ä¸Javaè¯­è¨€ç‰¹æ€§å¯†åˆ‡ç›¸å…³çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œå¦‚èŒƒå›´æ£€æŸ¥æ¶ˆé™¤ã€ç©ºå€¼æ£€æŸ¥æ¶ˆé™¤ï¼ˆä¸è¿‡å¹¶éæ‰€æœ‰çš„ç©ºå€¼æ£€æŸ¥æ¶ˆé™¤éƒ½æ˜¯ä¾èµ–ç¼–è¯‘å™¨ä¼˜åŒ–çš„ï¼Œæœ‰ä¸€äº›æ˜¯ä»£ç è¿è¡Œè¿‡ç¨‹ä¸­è‡ªåŠ¨ä¼˜åŒ–äº†ï¼‰ç­‰ã€‚å¦å¤–ï¼Œè¿˜å¯èƒ½æ ¹æ®è§£é‡Šå™¨æˆ–å®¢æˆ·ç«¯ç¼–è¯‘å™¨æä¾›çš„æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼Œè¿›è¡Œä¸€äº›ä¸ç¨³å®šçš„é¢„æµ‹æ€§æ¿€è¿›ä¼˜åŒ–ï¼Œå¦‚å®ˆæŠ¤å†…è”ã€åˆ†æ”¯é¢‘ç‡é¢„æµ‹ç­‰ã€‚ 2 æå‰ç¼–è¯‘å™¨Androidä¸­çš„ARTï¼ˆAndroid Runtimeï¼‰å°±æ˜¯æå‰ç¼–è¯‘çš„ã€‚ 2.1 æå‰ç¼–è¯‘çš„ä¼˜åŠ£å¾—å¤±å­—èŠ‚è†¨èƒ€ï¼šæå‰ç¼–è¯‘çš„æœ¬åœ°äºŒè¿›åˆ¶ç çš„ä½“ç§¯ä¼šæ˜æ˜¾å¤§äºå­—èŠ‚ç çš„ä½“ç§¯ã€‚ åŠ¨æ€æ‰©å±•ï¼šæå‰ç¼–è¯‘é€šå¸¸è¦æ±‚ç¨‹åºæ˜¯å°é—­çš„ï¼Œä¸èƒ½åœ¨å¤–éƒ¨åŠ¨æ€åŠ è½½æ–°çš„å­—èŠ‚ç ã€‚ æå‰ç¼–è¯‘æœ‰ä¸¤ç§åˆ†æ”¯ï¼š åšä¸ä¼ ç»ŸCã€C++ç¼–è¯‘å™¨ç±»ä¼¼çš„ï¼Œåœ¨ç¨‹åºè¿è¡Œä¹‹å‰æŠŠç¨‹åºä»£ç ç¼–è¯‘æˆæœºå™¨ç çš„é™æ€ç¿»è¯‘å·¥ä½œ æŠŠåŸæœ¬å³æ—¶ç¼–è¯‘å™¨åœ¨è¿è¡Œæ—¶è¦åšçš„ç¼–è¯‘å·¥ä½œæå‰åšå¥½å¹¶ä¿å­˜ä¸‹æ¥ï¼Œä¸‹æ¬¡è¿è¡Œåˆ°è¿™äº›ä»£ç ï¼ˆè­¬å¦‚å…¬å…±åº“ä»£ç åœ¨è¢«åŒä¸€å°æœºå™¨å…¶ä»–Javaè¿›ç¨‹ä½¿ç”¨ï¼‰æ—¶ç›´æ¥æŠŠå®ƒåŠ è½½è¿›æ¥ä½¿ç”¨ã€‚ ç¬¬ä¸€æ¡æ˜¯ä¼ ç»Ÿçš„æå‰ç¼–è¯‘åº”ç”¨å½¢å¼ã€‚ç¼–è¯‘æœŸé—´éœ€è¦æ¶ˆè€—å¾ˆå¤šèµ„æºå’Œæ—¶é—´ç”¨æ¥ä¼˜åŒ–ï¼Œä¾‹å¦‚â€œè¿‡ç¨‹é—´åˆ†æâ€ï¼Œå°†å®ƒèŠ‚çœä¸‹æ¥ç»™è¿è¡Œèƒ½æ˜æ˜¾æé«˜æ•ˆç‡ã€‚ ç¬¬äºŒæ¡åˆ™æ˜¯ç»™å³æ—¶ç¼–è¯‘å™¨åšç¼“å­˜åŠ é€Ÿï¼Œå»æ”¹å–„Javaç¨‹åºçš„å¯åŠ¨æ—¶é—´ã€‚è¿™ç§æå‰ç¼–è¯‘è¢«ç§°ä¸ºåŠ¨æ€æå‰ç¼–è¯‘ï¼ˆDynamicAOTï¼‰æˆ–è€…ç´¢æ€§å°±å¤§å¤§æ–¹æ–¹åœ°ç›´æ¥å«å³æ—¶ç¼–è¯‘ç¼“å­˜ï¼ˆJIT Cachingï¼‰ã€‚ è€Œå³æ—¶ç¼–è¯‘å™¨çš„ä¼˜åŠ¿æœ‰ï¼š æ€§èƒ½åˆ†æåˆ¶å¯¼ä¼˜åŒ–ï¼šåœ¨è§£é‡Šå™¨æˆ–è€…å®¢æˆ·ç«¯ç¼–è¯‘å™¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šä¸æ–­æ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼Œæœ‰åŠ©äºåœ¨è¿è¡ŒæœŸåŠ¨æ€ä¼˜åŒ–ã€‚ æ¿€è¿›é¢„æµ‹æ€§ä¼˜åŒ–ï¼šæå‰ç¼–è¯‘åšçš„ä¼˜åŒ–è¾ƒä¸ºä¿å®ˆï¼Œéœ€è¦è€ƒè™‘ç¨‹åºå®é™…è¿è¡Œçš„æ•ˆæœä¸èƒ½æœ‰å·®é”™ï¼Œè€Œå³æ—¶ç¼–è¯‘å¯ä»¥å¤§èƒ†åœ°æŒ‰ç…§é«˜æ¦‚ç‡çš„å‡è®¾è¿›è¡Œä¼˜åŒ–ï¼Œä¸‡ä¸€çœŸçš„èµ°åˆ°ç½•è§åˆ†æ”¯ä¸Šï¼Œå¤§ä¸äº†é€€å›åˆ°ä½çº§ç¼–è¯‘å™¨ç”šè‡³è§£é‡Šå™¨ä¸Šå»æ‰§è¡Œã€‚ é“¾æ¥æ—¶ä¼˜åŒ–ï¼šJavaè¯­è¨€å¤©ç”Ÿå°±æ˜¯åŠ¨æ€é“¾æ¥çš„ï¼Œå¦‚æœè¦è¿æ¥çš„ä»£ç åœ¨è¿è¡Œå‰åœ¨ä¸åŒçš„æœºå™¨ã€ç¼–è¯‘å™¨ä¸Šè¿›è¡Œç¼–è¯‘ï¼Œæœ€åè¿æ¥å¯èƒ½ä¼šå‡ºç°è¾¹ç•Œéš”é˜‚ã€‚ 3 ç¼–è¯‘å™¨ä¼˜åŒ–æŠ€æœ¯3.1 ä¼˜åŒ–æŠ€æœ¯æ¦‚è§ˆå‚è€ƒåœ°å€ï¼šhttps://wiki.openjdk.java.net/display/HotSpot/PerformanceTacticIndex ç¼–è¯‘å™¨ç­–ç•¥ å»¶è¿Ÿç¼–è¯‘ åˆ†å±‚ç¼–è¯‘ æ ˆä¸Šæ›¿æ¢ å»¶è¿Ÿä¼˜åŒ– ç¨‹åºä¾èµ–å›¾è¡¨ç¤º é™æ€å•èµ‹å€¼è¡¨ç¤º åŸºäºæ€§èƒ½ç›‘æ§çš„ä¼˜åŒ–æŠ€æœ¯ ä¹è§‚ç©ºå€¼æ–­è¨€ ä¹è§‚ç±»å‹æ–­è¨€ ä¹è§‚ç±»å‹å¢å¼º ä¹è§‚æ•°ç»„é•¿åº¦åŠ å¼º è£å‰ªæœªè¢«é€‰æ‹©çš„åˆ†æ”¯ ä¹è§‚çš„å¤šæ€å†…è” åˆ†æ”¯é¢‘ç‡é¢„æµ‹ è°ƒç”¨é¢‘ç‡é¢„æµ‹ åŸºäºè¯æ®çš„ä¼˜åŒ–æŠ€æœ¯ ç²¾ç¡®ç±»å‹æ¨æ–­ å†…å­˜å€¼æ¨æ–­ å†…å­˜å€¼è·Ÿè¸ª å¸¸é‡æŠ˜å  é‡ç»„ æ“ä½œç¬¦é€€åŒ– ç©ºå€¼æ£€æŸ¥æ¶ˆé™¤ ç±»å‹æ£€æµ‹é€€åŒ– ç±»å‹æ£€æµ‹æ¶ˆé™¤ ä»£æ•°åŒ–ç®€ å…¬å…±å­è¡¨è¾¾å¼æ¶ˆé™¤ æ•°æ®æµæ•æ„Ÿé‡å†™ æ¡ä»¶å¸¸é‡ä¼ æ’­ åŸºäºæµæ‰¿è½½çš„ç±»å‹ç¼©å‡è½¬æ¢ æ— ç”¨ä»£ç æ¶ˆé™¤ è¯­è¨€ç›¸å…³çš„ä¼˜åŒ–æŠ€æœ¯ ç±»å‹ç»§æ‰¿å…³ç³»åˆ†æ å»è™šæ‹ŸæœºåŒ– ç¬¦å·å¸¸é‡ä¼ æ’­ è‡ªåŠ¨è£…ç®±æ¶ˆé™¤ é€ƒé€¸åˆ†æ é”æ¶ˆé™¤ é”è†¨èƒ€ æ¶ˆé™¤åå°„ å†…å­˜åŠä»£ç ä½ç½®å˜æ¢ è¡¨è¾¾å¼æå‡ è¡¨è¾¾å¼ä¸‹æ²‰ å†—ä½™å­˜å‚¨æ¶ˆé™¤ ç›¸é‚»å­˜å‚¨åˆå¹¶ äº¤æ±‡ç‚¹åˆ†ç¦» å¾ªç¯å˜æ¢ å¾ªç¯å±•å¼€ å¾ªç¯å‰¥ç¦» å®‰å…¨ç‚¹æ¶ˆé™¤ è¿­ä»£èŒƒå›´åˆ†ç¦» èŒƒå›´æ£€æŸ¥æ¶ˆé™¤ å¾ªç¯å‘é‡åŒ– å…¨å±€ä»£ç è°ƒæ•´ å†…è” å…¨å±€ä»£ç å¤–æ åŸºäºçƒ­åº¦çš„ä»£ç å¸ƒå±€ Switch è°ƒæ•´ æ§åˆ¶æµå›¾å˜æ¢ æœ¬åœ°ä»£ç ç¼–æ’ æœ¬åœ°ä»£ç å°åŒ… å»¶è¿Ÿæ§½å¡«å…… ç€è‰²å›¾å¯„å­˜å™¨åˆ†é… çº¿æ€§æ‰«æå¯„å­˜å™¨åˆ†é… å¤å†™èšåˆ å¸¸é‡åˆ†è£‚ å¤å†™ç§»é™¤ åœ°å€æ¨¡å¼åŒ¹é… ä¸‹é¢ä»‹ç»å››ç§ä¼˜åŒ–æŠ€æœ¯ï¼š æœ€é‡è¦çš„ä¼˜åŒ–æŠ€æœ¯ä¹‹ä¸€ï¼šæ–¹æ³•å†…è”ã€‚ æœ€å‰æ²¿çš„ä¼˜åŒ–æŠ€æœ¯ä¹‹ä¸€ï¼šé€ƒé€¸åˆ†æã€‚ è¯­è¨€æ— å…³çš„ç»å…¸ä¼˜åŒ–æŠ€æœ¯ä¹‹ä¸€ï¼šå…¬å…±å­è¡¨è¾¾å¼æ¶ˆé™¤ã€‚ è¯­è¨€ç›¸å…³çš„ç»å…¸ä¼˜åŒ–æŠ€æœ¯ä¹‹ä¸€ï¼šæ•°ç»„è¾¹ç•Œæ£€æŸ¥æ¶ˆé™¤ã€‚ 3.2 æ–¹æ³•å†…è”å†…è”ä¸ºé™¤äº†æ¶ˆé™¤æ–¹æ³•è°ƒç”¨çš„æˆæœ¬ä¹‹å¤–ï¼Œå®ƒæ›´é‡è¦çš„æ„ä¹‰æ˜¯ä¸ºå…¶ä»–ä¼˜åŒ–æ‰‹æ®µå»ºç«‹è‰¯å¥½çš„åŸºç¡€ã€‚ å†…è”å¯èƒ½ä¼šé‡åˆ°è™šæ–¹æ³•æ— æ³•ç¡®å®šçš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³è™šæ–¹æ³•çš„å†…è”é—®é¢˜ï¼ŒJavaè™šæ‹Ÿæœºé¦–å…ˆå¼•å…¥äº†ä¸€ç§åä¸ºç±»å‹ç»§æ‰¿å…³ç³»åˆ†æï¼ˆCHAï¼‰çš„æŠ€æœ¯ï¼Œç”¨äºç¡®å®šåœ¨ç›®å‰å·²åŠ è½½çš„ç±»ä¸­ï¼ŒæŸä¸ªæ¥å£æ˜¯å¦æœ‰å¤šäºä¸€ç§çš„å®ç°ã€æŸä¸ªç±»æ˜¯å¦å­˜åœ¨å­ç±»ã€æŸä¸ªå­ç±»æ˜¯å¦è¦†ç›–äº†çˆ¶ç±»çš„æŸä¸ªè™šæ–¹æ³•ç­‰ä¿¡æ¯ã€‚è¿™æ ·ï¼Œç¼–è¯‘å™¨åœ¨è¿›è¡Œå†…è”æ—¶ï¼Œå¦‚æœé‡åˆ°è™šæ–¹æ³•ï¼Œåˆ™ä¼šå‘CHAæŸ¥è¯¢æ­¤æ–¹æ³•åœ¨å½“å‰ç¨‹åºçŠ¶æ€ä¸‹æ˜¯å¦æœ‰å¤šä¸ªç›®æ ‡ç‰ˆæœ¬å¯ä¾›é€‰æ‹©ï¼Œå¦‚æœæŸ¥è¯¢åˆ°åªæœ‰ä¸€ä¸ªç‰ˆæœ¬ï¼Œé‚£å°±å¯ä»¥å‡è®¾â€œåº”ç”¨ç¨‹åºçš„å…¨è²Œå°±æ˜¯ç°åœ¨è¿è¡Œçš„è¿™ä¸ªæ ·å­â€æ¥è¿›è¡Œå†…è”ï¼Œè¿™ç§å†…è”è¢«ç§°ä¸ºå®ˆæŠ¤å†…è”ã€‚ä¸è¿‡ç”±äºåé¢å¯èƒ½ä¼šåŠ è½½å…¶ä»–ç±»ï¼Œè¿™å±äºæ¿€è¿›ä¼˜åŒ–ã€‚å¦‚æœåœ¨åé¢çš„åŠ è½½è¿‡ç¨‹åŠ è½½äº†å¯¼è‡´ç»§æ‰¿å…³ç³»å‘ç”Ÿå˜åŒ–çš„æ–°ç±»ï¼Œé‚£ä¹ˆå°±å¿…é¡»æŠ›å¼ƒå·²ç»ç¼–è¯‘çš„ä»£ç ï¼Œé€€å›åˆ°è§£é‡ŠçŠ¶æ€è¿›è¡Œæ‰§è¡Œï¼Œæˆ–è€…é‡æ–°è¿›è¡Œç¼–è¯‘ã€‚ å‡å¦‚å‘CHAæŸ¥è¯¢å‡ºæ¥çš„ç»“æœæ˜¯è¯¥æ–¹æ³•ç¡®å®æœ‰å¤šä¸ªç‰ˆæœ¬çš„ç›®æ ‡æ–¹æ³•å¯ä¾›é€‰æ‹©ï¼Œé‚£å³æ—¶ç¼–è¯‘å™¨è¿˜å°†è¿›è¡Œæœ€åä¸€æ¬¡åŠªåŠ›ï¼Œä½¿ç”¨å†…è”ç¼“å­˜çš„æ–¹å¼æ¥ç¼©å‡æ–¹æ³•è°ƒç”¨çš„å¼€é”€ã€‚ è¿™ç§çŠ¶æ€ä¸‹æ–¹æ³•è°ƒç”¨æ˜¯çœŸæ­£å‘ç”Ÿäº†çš„ï¼Œä½†æ˜¯æ¯”èµ·ç›´æ¥æŸ¥è™šæ–¹æ³•è¡¨è¿˜æ˜¯è¦å¿«ä¸€äº›ã€‚å†…è”ç¼“å­˜æ˜¯ä¸€ä¸ªå»ºç«‹åœ¨ç›®æ ‡æ–¹æ³•æ­£å¸¸å…¥å£ä¹‹å‰çš„ç¼“å­˜ï¼Œå®ƒçš„å·¥ä½œåŸç†å¤§è‡´ä¸ºï¼šåœ¨æœªå‘ç”Ÿæ–¹æ³•è°ƒç”¨ä¹‹å‰ï¼Œå†…è”ç¼“å­˜çŠ¶æ€ä¸ºç©ºï¼Œå½“ç¬¬ä¸€æ¬¡è°ƒç”¨å‘ç”Ÿåï¼Œç¼“å­˜è®°å½•ä¸‹æ–¹æ³•æ¥æ”¶è€…çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¹¶ä¸”æ¯æ¬¡è¿›è¡Œæ–¹æ³•è°ƒç”¨æ—¶éƒ½æ¯”è¾ƒæ¥æ”¶è€…çš„ç‰ˆæœ¬ã€‚å¦‚æœä»¥åè¿›æ¥çš„æ¯æ¬¡è°ƒç”¨çš„æ–¹æ³•æ¥æ”¶è€…ç‰ˆæœ¬éƒ½æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆè¿™æ—¶å®ƒå°±æ˜¯ä¸€ç§å•æ€å†…è”ç¼“å­˜ã€‚é€šè¿‡è¯¥ç¼“å­˜æ¥è°ƒç”¨ï¼Œæ¯”ç”¨ä¸å†…è”çš„éè™šæ–¹æ³•è°ƒç”¨ï¼Œä»…å¤šäº†ä¸€æ¬¡ç±»å‹åˆ¤æ–­çš„å¼€é”€è€Œå·²ã€‚ä½†å¦‚æœçœŸçš„å‡ºç°æ–¹æ³•æ¥æ”¶è€…ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå°±è¯´æ˜ç¨‹åºç”¨åˆ°äº†è™šæ–¹æ³•çš„å¤šæ€ç‰¹æ€§ï¼Œè¿™æ—¶å€™ä¼šé€€åŒ–æˆè¶…å¤šæ€å†…è”ç¼“å­˜ï¼Œå…¶å¼€é”€ç›¸å½“äºçœŸæ­£æŸ¥æ‰¾è™šæ–¹æ³•è¡¨æ¥è¿›è¡Œæ–¹æ³•åˆ†æ´¾ã€‚ 3.3 é€ƒé€¸åˆ†æé€ƒé€¸åˆ†æï¼ˆEscape Analysisï¼‰æ˜¯ç›®å‰Javaè™šæ‹Ÿæœºä¸­æ¯”è¾ƒå‰æ²¿çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œå®ƒä¸ç±»å‹ç»§æ‰¿å…³ç³»åˆ†æä¸€æ ·ï¼Œå¹¶ä¸æ˜¯ç›´æ¥ä¼˜åŒ–ä»£ç çš„æ‰‹æ®µï¼Œè€Œæ˜¯ä¸ºå…¶ä»–ä¼˜åŒ–æªæ–½æä¾›ä¾æ®çš„åˆ†ææŠ€æœ¯ã€‚ é€ƒé€¸åˆ†æçš„åŸºæœ¬åŸç†æ˜¯ï¼šåˆ†æå¯¹è±¡åŠ¨æ€ä½œç”¨åŸŸï¼Œå½“ä¸€ä¸ªå¯¹è±¡åœ¨æ–¹æ³•é‡Œé¢è¢«å®šä¹‰åï¼Œå®ƒå¯èƒ½è¢«å¤–éƒ¨æ–¹æ³•æ‰€å¼•ç”¨ï¼Œä¾‹å¦‚ä½œä¸ºè°ƒç”¨å‚æ•°ä¼ é€’åˆ°å…¶ä»–æ–¹æ³•ä¸­ï¼Œè¿™ç§ç§°ä¸ºæ–¹æ³•é€ƒé€¸ï¼›ç”šè‡³è¿˜æœ‰å¯èƒ½è¢«å¤–éƒ¨çº¿ç¨‹è®¿é—®åˆ°ï¼Œè­¬å¦‚èµ‹å€¼ç»™å¯ä»¥åœ¨å…¶ä»–çº¿ç¨‹ä¸­è®¿é—®çš„å®ä¾‹å˜é‡ï¼Œè¿™ç§ç§°ä¸ºçº¿ç¨‹é€ƒé€¸ï¼›ä»ä¸é€ƒé€¸ã€æ–¹æ³•é€ƒé€¸åˆ°çº¿ç¨‹é€ƒé€¸ï¼Œç§°ä¸ºå¯¹è±¡ç”±ä½åˆ°é«˜çš„ä¸åŒé€ƒé€¸ç¨‹åº¦ã€‚å¦‚æœèƒ½è¯æ˜ä¸€ä¸ªå¯¹è±¡ä¸ä¼šé€ƒé€¸åˆ°æ–¹æ³•æˆ–çº¿ç¨‹ä¹‹å¤–ï¼ˆæ¢å¥è¯è¯´æ˜¯åˆ«çš„æ–¹æ³•æˆ–çº¿ç¨‹æ— æ³•é€šè¿‡ä»»ä½•é€”å¾„è®¿é—®åˆ°è¿™ä¸ªå¯¹è±¡ï¼‰ï¼Œæˆ–è€…é€ƒé€¸ç¨‹åº¦æ¯”è¾ƒä½ï¼ˆåªé€ƒé€¸å‡ºæ–¹æ³•è€Œä¸ä¼šé€ƒé€¸å‡ºçº¿ç¨‹ï¼‰ï¼Œåˆ™å¯èƒ½ä¸ºè¿™ä¸ªå¯¹è±¡å®ä¾‹é‡‡å–ä¸åŒç¨‹åº¦çš„ä¼˜åŒ–ï¼Œå¦‚ï¼š æ ˆä¸Šåˆ†é…ï¼šæ ˆä¸Šåˆ†é…å˜é‡å¯ä»¥é¿å…å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œä»è€Œæé«˜æ•ˆç‡ï¼Œï¼ˆåŒæ—¶ï¼Œæ ˆä¸Šå­˜å‚¨çš„æ•°æ®ï¼Œå¾ˆå¤§æœºä¼šè¢«è™šæ‹Ÿæœºåˆ†é…è‡³ç‰©ç†æœºå™¨çš„é«˜é€Ÿå¯„å­˜å™¨ä¸­å­˜å‚¨ï¼‰æ ˆä¸Šåˆ†é…æ”¯æŒæ–¹æ³•é€ƒé€¸ï¼Œä½†ä¸èƒ½æ”¯æŒçº¿ç¨‹é€ƒé€¸ã€‚ æ ‡é‡æ›¿æ¢ï¼šä¸èƒ½åˆ†è§£çš„ï¼Œä¾‹å¦‚intã€longç­‰æ•°å€¼ç±»å‹åŠreferenceç±»å‹ç­‰ç§°ä¸ºæ ‡é‡ã€‚ç›¸å¯¹çš„ï¼Œå¯ä»¥ç»§ç»­åˆ†è§£ç§°ä¸ºèšåˆé‡ï¼Œä¾‹å¦‚Javaä¸­çš„å¯¹è±¡ã€‚å¦‚æœæŠŠä¸€ä¸ªJavaå¯¹è±¡æ‹†æ•£ï¼Œå°†å…¶ç”¨åˆ°çš„æˆå‘˜å˜é‡æ¢å¤ä¸ºåŸå§‹ç±»å‹æ¥è®¿é—®ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±ç§°ä¸ºæ ‡é‡æ›¿æ¢ã€‚å‡å¦‚é€ƒé€¸åˆ†æèƒ½å¤Ÿè¯æ˜ä¸€ä¸ªå¯¹è±¡ä¸ä¼šè¢«æ–¹æ³•å¤–éƒ¨è®¿é—®ï¼Œå¹¶ä¸”è¿™ä¸ªå¯¹è±¡å¯ä»¥è¢«æ‹†æ•£ï¼Œé‚£ä¹ˆç¨‹åºçœŸæ­£æ‰§è¡Œçš„æ—¶å€™å°†å¯èƒ½ä¸å»åˆ›å»ºè¿™ä¸ªå¯¹è±¡ï¼Œè€Œæ”¹ä¸ºç›´æ¥åˆ›å»ºå®ƒçš„è‹¥å¹²ä¸ªè¢«è¿™ä¸ªæ–¹æ³•ä½¿ç”¨çš„æˆå‘˜å˜é‡æ¥ä»£æ›¿ã€‚å°†å¯¹è±¡æ‹†åˆ†åï¼Œé™¤äº†å¯ä»¥è®©å¯¹è±¡çš„æˆå‘˜å˜é‡åœ¨æ ˆä¸Šåˆ†é…å’Œè¯»å†™ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä¸ºåç»­è¿›ä¸€æ­¥çš„ä¼˜åŒ–æ‰‹æ®µåˆ›å»ºæ¡ä»¶ã€‚æ ‡é‡æ›¿æ¢å¯ä»¥è§†ä½œæ ˆä¸Šåˆ†é…çš„ä¸€ç§ç‰¹ä¾‹ï¼Œå®ç°æ›´ç®€å•ï¼Œä½†å¯¹é€ƒé€¸ç¨‹åº¦çš„è¦æ±‚æ›´é«˜ï¼Œå®ƒä¸å…è®¸å¯¹è±¡é€ƒé€¸å‡ºæ–¹æ³•èŒƒå›´å†…ã€‚ åŒæ­¥æ¶ˆé™¤ï¼šçº¿ç¨‹åŒæ­¥æœ¬èº«æ˜¯ä¸€ä¸ªç›¸å¯¹è€—æ—¶çš„è¿‡ç¨‹ï¼Œå¦‚æœé€ƒé€¸åˆ†æèƒ½å¤Ÿç¡®å®šä¸€ä¸ªå˜é‡ä¸ä¼šé€ƒé€¸å‡ºçº¿ç¨‹ï¼Œæ— æ³•è¢«å…¶ä»–çº¿ç¨‹è®¿é—®ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡çš„è¯»å†™è‚¯å®šå°±ä¸ä¼šæœ‰ç«äº‰ï¼Œå¯¹è¿™ä¸ªå˜é‡å®æ–½çš„åŒæ­¥æªæ–½ä¹Ÿå°±å¯ä»¥å®‰å…¨åœ°æ¶ˆé™¤æ‰ã€‚ 3.4 å…¬å…±å­è¡¨è¾¾å¼æ¶ˆé™¤å¦‚æœä¸€ä¸ªè¡¨è¾¾å¼Eä¹‹å‰å·²ç»è¢«è®¡ç®—è¿‡äº†ï¼Œå¹¶ä¸”ä»å…ˆå‰çš„è®¡ç®—åˆ°ç°åœ¨Eä¸­æ‰€æœ‰å˜é‡çš„å€¼éƒ½æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆE çš„è¿™æ¬¡å‡ºç°å°±ç§°ä¸ºå…¬å…±å­è¡¨è¾¾å¼ã€‚å¯¹äºè¿™ç§è¡¨è¾¾å¼ï¼Œæ²¡æœ‰å¿…è¦èŠ±æ—¶é—´å†å¯¹å®ƒé‡æ–°è¿›è¡Œè®¡ç®—ï¼Œåªéœ€è¦ç›´æ¥ç”¨å‰é¢è®¡ç®—è¿‡çš„è¡¨è¾¾å¼ç»“æœä»£æ›¿Eã€‚ 3.5 æ•°ç»„è¾¹ç•Œæ£€æŸ¥æ¶ˆé™¤æœ‰äº›ä»£ç åœ¨ç¼–è¯‘çš„æ—¶å€™å°±å¯ä»¥ç¡®å®šè¿è¡Œçš„æ—¶å€™æ•°ç»„ä¸‹æ ‡ä¸€å®šä¸ä¼šè¶Šç•Œï¼Œé‚£ä¹ˆè¿è¡Œæ—¶å°±å¯ä»¥ä¸åšæ£€æŸ¥ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jvm","slug":"jvm","permalink":"https://www.codetool.top/tags/jvm/"}]},{"title":"leetcode341-æ‰å¹³åŒ–åµŒå¥—åˆ—è¡¨è¿­ä»£å™¨","slug":"leetcode341-æ‰å¹³åŒ–åµŒå¥—åˆ—è¡¨è¿­ä»£å™¨","date":"2020-01-26T18:18:33.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode341-æ‰å¹³åŒ–åµŒå¥—åˆ—è¡¨è¿­ä»£å™¨/","link":"","permalink":"https://www.codetool.top/article/leetcode341-%E6%89%81%E5%B9%B3%E5%8C%96%E5%B5%8C%E5%A5%97%E5%88%97%E8%A1%A8%E8%BF%AD%E4%BB%A3%E5%99%A8/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªåµŒå¥—çš„æ•´å‹åˆ—è¡¨ã€‚è®¾è®¡ä¸€ä¸ªè¿­ä»£å™¨ï¼Œä½¿å…¶èƒ½å¤Ÿéå†è¿™ä¸ªæ•´å‹åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ•´æ•°ã€‚ åˆ—è¡¨ä¸­çš„é¡¹æˆ–è€…ä¸ºä¸€ä¸ªæ•´æ•°ï¼Œæˆ–è€…æ˜¯å¦ä¸€ä¸ªåˆ—è¡¨ã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥: [[1,1],2,[1,1]]è¾“å‡º: [1,1,2,1,1]è§£é‡Š: é€šè¿‡é‡å¤è°ƒç”¨ next ç›´åˆ° hasNext è¿”å›falseï¼Œnext è¿”å›çš„å…ƒç´ çš„é¡ºåºåº”è¯¥æ˜¯: [1,1,2,1,1]ã€‚ ç¤ºä¾‹2ï¼š è¾“å…¥: 14è¾“å‡º: Falseè§£é‡Š: é€šè¿‡é‡å¤è°ƒç”¨ next ç›´åˆ° hasNext è¿”å›falseï¼Œnext è¿”å›çš„å…ƒç´ çš„é¡ºåºåº”è¯¥æ˜¯: [1,4,6]ã€‚ 2 è§£æ³•2.1 æ€æƒ³æ„é€ é€šè¿‡é€’å½’æ„é€ ï¼Œè·å–å…ƒç´ å°±æ˜¯é€šç”¨è¿­ä»£å™¨çš„æ–¹æ³•ã€‚ 2.2 ä»£ç public class NestedIterator implements Iterator&lt;Integer> { List&lt;Integer> list = new ArrayList&lt;>(); int cur = 0; public NestedIterator(List&lt;NestedInteger> nestedList) { addViaList(nestedList); } public void addViaList(List&lt;NestedInteger> nestedList){ for(NestedInteger i:nestedList){ if(i.isInteger()) list.add(i.getInteger()); else addViaList(i.getList()); } } @Override public Integer next() { return list.get(cur++); } @Override public boolean hasNext() { return cur&lt;list.size(); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode331-éªŒè¯äºŒå‰æ ‘çš„å‰åºåºåˆ—åŒ–","slug":"leetcode331-éªŒè¯äºŒå‰æ ‘çš„å‰åºåºåˆ—åŒ–","date":"2020-01-26T15:51:46.000Z","updated":"2020-01-26T16:14:19.038Z","comments":true,"path":"article/leetcode331-éªŒè¯äºŒå‰æ ‘çš„å‰åºåºåˆ—åŒ–/","link":"","permalink":"https://www.codetool.top/article/leetcode331-%E9%AA%8C%E8%AF%81%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E5%89%8D%E5%BA%8F%E5%BA%8F%E5%88%97%E5%8C%96/","excerpt":"","text":"1 åŸé¢˜åºåˆ—åŒ–äºŒå‰æ ‘çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨å‰åºéå†ã€‚å½“æˆ‘ä»¬é‡åˆ°ä¸€ä¸ªéç©ºèŠ‚ç‚¹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è®°å½•ä¸‹è¿™ä¸ªèŠ‚ç‚¹çš„å€¼ã€‚å¦‚æœå®ƒæ˜¯ä¸€ä¸ªç©ºèŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ ‡è®°å€¼è®°å½•ï¼Œä¾‹å¦‚ #ã€‚ _9_ / \\ 3 2 / \\ / \\ 4 1 # 6 / \\ / \\ / \\ # # # # # #ä¾‹å¦‚ï¼Œä¸Šé¢çš„äºŒå‰æ ‘å¯ä»¥è¢«åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸² &quot;9,3,4,#,#,1,#,#,2,#,6,#,#&quot;ï¼Œå…¶ä¸­ # ä»£è¡¨ä¸€ä¸ªç©ºèŠ‚ç‚¹ã€‚ ç»™å®šä¸€ä¸²ä»¥é€—å·åˆ†éš”çš„åºåˆ—ï¼ŒéªŒè¯å®ƒæ˜¯å¦æ˜¯æ­£ç¡®çš„äºŒå‰æ ‘çš„å‰åºåºåˆ—åŒ–ã€‚ç¼–å†™ä¸€ä¸ªåœ¨ä¸é‡æ„æ ‘çš„æ¡ä»¶ä¸‹çš„å¯è¡Œç®—æ³•ã€‚ æ¯ä¸ªä»¥é€—å·åˆ†éš”çš„å­—ç¬¦æˆ–ä¸ºä¸€ä¸ªæ•´æ•°æˆ–ä¸ºä¸€ä¸ªè¡¨ç¤º null æŒ‡é’ˆçš„ &#39;#&#39; ã€‚ ä½ å¯ä»¥è®¤ä¸ºè¾“å…¥æ ¼å¼æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œä¾‹å¦‚å®ƒæ°¸è¿œä¸ä¼šåŒ…å«ä¸¤ä¸ªè¿ç»­çš„é€—å·ï¼Œæ¯”å¦‚ &quot;1,,3&quot; ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: â€œ9,3,4,#,#,1,#,#,2,#,6,#,#â€è¾“å‡º: true ç¤ºä¾‹ 2: è¾“å…¥: â€œ1,#â€è¾“å‡º: false ç¤ºä¾‹ 3: è¾“å…¥: â€œ9,#,#,1â€è¾“å‡º: false 2 è§£æ³•2.1 æ€æƒ³å¯èƒ½å¯¼è‡´å‰åºåºåˆ—åŒ–éªŒè¯å¤±è´¥çš„æƒ…å†µæœ‰ï¼š nullåšç©ºèŠ‚ç‚¹ å­èŠ‚ç‚¹ä¸å®Œå…¨ # 1 / \\ / \\ 1 2 3å‡è®¾ä»»ä¸€çŠ¶æ€å¾…å¡«å……çš„èŠ‚ç‚¹æ•°ä¸ºcountï¼Œç¬¬ä¸€ç§æƒ…å†µä¼šå¯¼è‡´åœ¨æŸä¸€ä¸ªæ—¶åˆ»countå°äº0ï¼Œç¬¬äºŒç§æƒ…å†µä¼šå¯¼è‡´æœ€åcountå¤§äº0ã€‚è€Œè¿™ä¸¤ç§æƒ…å†µæ˜¯ä¸ä¼šåŒæ—¶å­˜åœ¨çš„ã€‚ æ¯æ¬¡é‡åˆ°ä¸€ä¸ªèŠ‚ç‚¹countçš„å€¼å‡ä¸€ï¼Œé‡åˆ°ä¸€ä¸ªénullçš„èŠ‚ç‚¹countçš„å€¼åŠ äºŒï¼Œæœ€åçœ‹countæ˜¯å¦ä¸º0ã€‚ 2.2 ä»£ç class Solution { public boolean isValidSerialization(String preorder) { String[] nodes = preorder.split(\",\"); int count = 1; for(String i:nodes){ count-=1; if(count&lt;0) return false; if(!i.equals(\"#\")) count+=2; } return count==0; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode224-åŸºæœ¬è®¡ç®—å™¨","slug":"leetcode224-åŸºæœ¬è®¡ç®—å™¨","date":"2020-01-25T19:07:56.000Z","updated":"2020-02-20T14:55:21.052Z","comments":true,"path":"article/leetcode224-åŸºæœ¬è®¡ç®—å™¨/","link":"","permalink":"https://www.codetool.top/article/leetcode224-%E5%9F%BA%E6%9C%AC%E8%AE%A1%E7%AE%97%E5%99%A8/","excerpt":"","text":"1 åŸé¢˜å®ç°ä¸€ä¸ªåŸºæœ¬çš„è®¡ç®—å™¨æ¥è®¡ç®—ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²è¡¨è¾¾å¼çš„å€¼ã€‚ å­—ç¬¦ä¸²è¡¨è¾¾å¼å¯ä»¥åŒ…å«å·¦æ‹¬å· ( ï¼Œå³æ‹¬å· )ï¼ŒåŠ å· + ï¼Œå‡å· -ï¼Œéè´Ÿæ•´æ•°å’Œç©ºæ ¼ ã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥: â€œ1 + 1â€è¾“å‡º: 2 ç¤ºä¾‹2ï¼š è¾“å…¥: â€œ 2-1 + 2 â€œè¾“å‡º: 3 ç¤ºä¾‹ 3: è¾“å…¥: â€œ(1+(4+5+2)-3)+(6+8)â€è¾“å‡º: 23 è¯´æ˜ï¼š ä½ å¯ä»¥å‡è®¾æ‰€ç»™å®šçš„è¡¨è¾¾å¼éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚ è¯·ä¸è¦ä½¿ç”¨å†…ç½®çš„åº“å‡½æ•° evalã€‚ 2 è§£æ³•2.1 æ€æƒ³æ“ä½œæ•°æ ˆçš„æ€æƒ³ 2.2 ä»£ç åŸæ¥ä»¥ä¸ºé€’å½’ä¼šå¾ˆå–å·§ï¼Œç»“æœé‡åˆ°äº†å¾ˆå¤šç»†èŠ‚é—®é¢˜ã€‚ class Solution { public int calculate(String s) { if(s.indexOf(\"(\")==-1){ int num = 0; int sum = 0; boolean negative = false; boolean hasNum = false; for(char i:s.toCharArray()){ if(i==' ') continue; if(i>='0'&amp;&amp;i&lt;='9') { hasNum = true; if(negative==false) num=(num*10)+(i-48); else num=(num*10)-(i-48); } if(i=='+'){ hasNum = false; sum+=num; num = 0; negative = false; }if(i=='-'){ if(hasNum == false) negative = !negative; else negative = true; hasNum = false; sum+=num; num = 0; } } sum+=num; return sum; } int lastLeft = s.lastIndexOf(\"(\"); int right = s.substring(lastLeft,s.length()).indexOf(\")\")+lastLeft; return calculate(s.substring(0,lastLeft)+calculate(s.substring(lastLeft+1,right))+s.substring(right+1)); } } æ ˆçš„æ–¹æ³•ï¼š class Solution { public int calculate(String s) { Deque&lt;Integer> signs = new ArrayDeque&lt;>(); int num = 0; int res = 0; int sign = 1; signs.push(sign); for (char c : s.toCharArray()) { if (Character.isDigit(c)) { num = num * 10 + (c - '0'); } else if (c == '(') { signs.push(sign); } else if (c == ')') { signs.pop(); } else if (c == '+' || c == '-') { res += sign * num; num = 0; sign = signs.peek() * (c == '+' ? 1 : -1); } } return res + sign * num; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°10","slug":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°10","date":"2020-01-25T13:15:55.000Z","updated":"2020-04-22T09:27:27.192Z","comments":true,"path":"article/æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°10/","link":"","permalink":"https://www.codetool.top/article/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%AC%AC%E4%B8%89%E7%89%88%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B010/","excerpt":"","text":"ä»¥ä¸‹æ˜¯ç¬¬åç«  å‰ç«¯ç¼–è¯‘ä¸ä¼˜åŒ–çš„å†…å®¹ Javaä¸­çš„ç¼–è¯‘å¯èƒ½æ˜¯æŒ‡ï¼š å‰ç«¯ç¼–è¯‘ï¼šæŠŠ*.javaæ–‡ä»¶è½¬å˜æˆ*.classæ–‡ä»¶çš„è¿‡ç¨‹ å³æ—¶ç¼–è¯‘ï¼ˆJITï¼‰ï¼šè¿è¡ŒæœŸæŠŠå­—èŠ‚ç è½¬å˜æˆæœ¬åœ°æœºå™¨ç çš„è¿‡ç¨‹ æå‰ç¼–è¯‘ï¼ˆAOTï¼‰ï¼šç›´æ¥æŠŠç¨‹åºç¼–è¯‘æˆä¸ç›®æ ‡æœºå™¨æŒ‡ä»¤é›†ç›¸å…³çš„äºŒè¿›åˆ¶ä»£ç çš„è¿‡ç¨‹ è¿™ä¸€ç« è®²çš„æ˜¯å‰ç«¯ç¼–è¯‘ 1 Javacç¼–è¯‘å™¨javacæ˜¯ä¸€ä¸ªç”±javaè¯­è¨€ç¼–å†™çš„ç¨‹åº 1.1 Javacçš„æºç ä¸è°ƒè¯•Java6ä»¥åï¼ŒJavacçš„æºç æ”¾åœ¨äº†JDK_SRC_HOME/langtools/src/share/classes/com/sun/tools/javac Javacçš„å·¥ä½œæµç¨‹ å‡†å¤‡è¿‡ç¨‹ï¼šåˆå§‹åŒ–æ’å…¥å¼æ³¨è§£å¤„ç†å™¨ã€‚ è§£æä¸å¡«å……ç¬¦å·è¡¨è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ï¼šÂ·è¯æ³•ã€è¯­æ³•åˆ†æã€‚å°†æºä»£ç çš„å­—ç¬¦æµè½¬å˜ä¸ºæ ‡è®°é›†åˆï¼Œæ„é€ å‡ºæŠ½è±¡è¯­æ³•æ ‘ã€‚Â·å¡«å……ç¬¦å·è¡¨ã€‚äº§ç”Ÿç¬¦å·åœ°å€å’Œç¬¦å·ä¿¡æ¯ã€‚ æ’å…¥å¼æ³¨è§£å¤„ç†å™¨çš„æ³¨è§£å¤„ç†è¿‡ç¨‹ï¼šæ’å…¥å¼æ³¨è§£å¤„ç†å™¨çš„æ‰§è¡Œé˜¶æ®µã€‚ åˆ†æä¸å­—èŠ‚ç ç”Ÿæˆè¿‡ç¨‹ï¼ŒåŒ…æ‹¬ï¼š æ ‡æ³¨æ£€æŸ¥ã€‚å¯¹è¯­æ³•çš„é™æ€ä¿¡æ¯è¿›è¡Œæ£€æŸ¥ã€‚ æ•°æ®æµåŠæ§åˆ¶æµåˆ†æã€‚å¯¹ç¨‹åºåŠ¨æ€è¿è¡Œè¿‡ç¨‹è¿›è¡Œæ£€æŸ¥ã€‚ è§£è¯­æ³•ç³–ã€‚å°†ç®€åŒ–ä»£ç ç¼–å†™çš„è¯­æ³•ç³–è¿˜åŸä¸ºåŸæœ‰çš„å½¢å¼ã€‚ å­—èŠ‚ç ç”Ÿæˆã€‚å°†å‰é¢å„ä¸ªæ­¥éª¤æ‰€ç”Ÿæˆçš„ä¿¡æ¯è½¬åŒ–æˆå­—èŠ‚ç ã€‚ æ‰§è¡Œæ’å…¥å¼æ³¨è§£æ—¶åˆå¯èƒ½ä¼šäº§ç”Ÿæ–°çš„ç¬¦å·ï¼Œå¦‚æœæœ‰æ–°çš„ç¬¦å·äº§ç”Ÿï¼Œå°±å¿…é¡»è½¬å›åˆ°ä¹‹å‰çš„è§£æã€å¡«å……ç¬¦å·è¡¨çš„è¿‡ç¨‹ä¸­é‡æ–°å¤„ç†è¿™äº›æ–°ç¬¦å·ã€‚ 2 Javaè¯­æ³•ç³–çš„å‘³é“2.1 æ³›å‹2.1.1 Javaä¸C#çš„æ³›å‹Javaæ˜¯ â€œç±»å‹æ“¦é™¤å¼æ³›å‹â€ï¼ŒC#æ˜¯ â€œå…·ç°åŒ–å¼æ³›å‹â€ã€‚ Javaè¯­è¨€ä¸­çš„æ³›å‹åªåœ¨ç¨‹åºæºç ä¸­å­˜åœ¨ï¼Œåœ¨ç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œå…¨éƒ¨æ³›å‹éƒ½è¢«æ›¿æ¢ä¸ºåŸæ¥çš„è£¸ç±»å‹ï¼Œå¹¶ä¸”åœ¨ç›¸åº”çš„åœ°æ–¹æ’å…¥äº†å¼ºåˆ¶è½¬å‹ä»£ç ã€‚ Javaçš„ç±»å‹æ“¦é™¤å¼æ³›å‹æ— è®ºåœ¨ä½¿ç”¨æ•ˆæœä¸Šè¿˜æ˜¯è¿è¡Œæ•ˆç‡ä¸Šï¼Œå‡ ä¹æ˜¯å…¨é¢è½åäºC#çš„å…·ç°åŒ–å¼æ³›å‹ï¼Œè€Œå®ƒçš„å”¯ä¸€ä¼˜åŠ¿æ˜¯åœ¨äºå®ç°è¿™ç§æ³›å‹çš„å½±å“èŒƒå›´ä¸Šã€‚ Javaé€‰æ‹©ç±»å‹æ“¦é™¤ä¸»è¦æ˜¯å› ä¸ºé—ç•™ä»£ç å¤šï¼Œå‘å‰å…¼å®¹ã€‚ 2.1.2 ç±»å‹æ“¦é™¤å®ç°ï¼šæ³›å‹ç±»åŸåœ°æ³›å‹åŒ–å˜æˆè£¸ç±»å‹ Javaæ˜¯ç®€å•ç²—æš´åœ°ç›´æ¥åœ¨ç¼–è¯‘æ—¶æŠŠArrayList&lt;Integer&gt;è¿˜åŸå›ArrayListï¼Œåªåœ¨å…ƒç´ è®¿é—®ã€ä¿®æ”¹æ—¶è‡ªåŠ¨æ’å…¥ä¸€äº›å¼ºåˆ¶ç±»å‹è½¬æ¢å’Œæ£€æŸ¥æŒ‡ä»¤ã€‚ ç±»å‹æ“¦é™¤çš„ç¼ºé™·ï¼š ä¸æ”¯æŒåŸºæœ¬ç±»å‹ï¼Œä¾‹å¦‚ArrayList&lt;int&gt;ï¼Œå› ä¸ºæ— æ³•å®ç°intå’ŒObjectäº’è½¬ï¼Œåªèƒ½è‡ªåŠ¨è£…ç®±ã€æ‹†ç®±ä½¿ç”¨Integerï¼Œå¯¼è‡´æ‰§è¡Œæ•ˆç‡ä½ã€‚ è¿è¡ŒæœŸæ— æ³•å–åˆ°æ³›å‹ç±»å‹ä¿¡æ¯ï¼Œå¯¼è‡´ä¸èƒ½å‡ºç°ä¸‹åˆ—æ“ä½œï¼š if (item instanceof E) { // ä¸åˆæ³•ï¼Œæ— æ³•å¯¹æ³›å‹è¿›è¡Œå®ä¾‹åˆ¤æ–­ E newItem = new E(); // ä¸åˆæ³•ï¼Œæ— æ³•ä½¿ç”¨æ³›å‹åˆ›å»ºå¯¹è±¡ E[] itemArray = new E[10]; // ä¸åˆæ³•ï¼Œæ— æ³•ä½¿ç”¨æ³›å‹åˆ›å»ºæ•°ç»„ æ–¹æ³•é‡è½½å³ä½¿æ˜¯ä¸åŒæ³›å‹ç±»å‹çš„å‚æ•°ä¹Ÿä¸èƒ½ä½œä¸ºä¸ä¸€æ ·çš„ç‰¹å¾ç­¾åã€‚ä½†æ˜¯è¿”å›å€¼ç±»å‹ä¸åŒå®é™…æ˜¯å¯ä»¥æ­£å¸¸è¿è¡Œçš„ï¼Œè™½ç„¶ç‰¹å¾ç­¾åè¿˜æ˜¯ä¸€è‡´ï¼Œä½†classæ–‡ä»¶æ”¯æŒä¸åŒæè¿°ç¬¦çš„æ–¹æ³•å…±å­˜ï¼Œåç»­JVMæœ‰ä¼˜åŒ–ã€‚ 2.1.3 å€¼ç±»å‹å’Œæœªæ¥çš„æ³›å‹åœ¨2014å¹´ï¼Œåˆšå¥½æ˜¯Javaæ³›å‹å‡ºç°çš„åå¹´ä¹‹åï¼ŒOracleå»ºç«‹äº†ä¸€ä¸ªåä¸ºValhallaçš„è¯­è¨€æ”¹è¿›é¡¹ç›®ï¼Œå¸Œæœ›æ”¹è¿›Javaè¯­è¨€ç•™ä¸‹çš„å„ç§ç¼ºé™·ï¼ˆè§£å†³æ³›å‹çš„ç¼ºé™·å°±æ˜¯é¡¹ç›®ä¸»è¦ç›®æ ‡å…¶ä¸­ä¹‹ä¸€ï¼‰ã€‚ åœ¨Valhallaé¡¹ç›®ä¸­è§„åˆ’äº†å‡ ç§ä¸åŒçš„æ–°æ³›å‹å®ç°æ–¹æ¡ˆï¼Œåœ¨è¿™äº›æ–°çš„æ³›å‹è®¾è®¡ä¸­ï¼Œæ³›å‹ç±»å‹æœ‰å¯èƒ½è¢«å…·ç°åŒ–ï¼Œä¹Ÿæœ‰å¯èƒ½ç»§ç»­ç»´æŒç±»å‹æ“¦é™¤ä»¥ä¿æŒå…¼å®¹ï¼ˆå–å†³äºé‡‡ç”¨å“ªç§å®ç°æ–¹æ¡ˆï¼‰ï¼Œå³ä½¿æ˜¯ç»§ç»­é‡‡ç”¨ç±»å‹æ“¦é™¤çš„æ–¹æ¡ˆï¼Œæ³›å‹çš„å‚æ•°åŒ–ç±»å‹ä¹Ÿå¯ä»¥é€‰æ‹©ä¸è¢«å®Œå…¨åœ°æ“¦é™¤æ‰ï¼Œè€Œæ˜¯ç›¸å¯¹å®Œæ•´åœ°è®°å½•åœ¨Classæ–‡ä»¶ä¸­ï¼Œèƒ½å¤Ÿåœ¨è¿è¡ŒæœŸè¢«ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šç¼–è¯‘å™¨é»˜è®¤è¦æ“¦é™¤å“ªäº›ç±»å‹ã€‚ç›¸å¯¹äºä½¿ç”¨ä¸åŒæ–¹å¼å®ç°æ³›å‹ï¼Œç›®å‰æ¯”è¾ƒæ˜ç¡®çš„æ˜¯æœªæ¥çš„Javaåº”è¯¥ä¼šæä¾›â€œå€¼ç±»å‹â€ï¼ˆValue Typeï¼‰çš„è¯­è¨€å±‚é¢çš„æ”¯æŒã€‚ å€¼ç±»å‹å¯ä»¥ä¸å¼•ç”¨ç±»å‹ä¸€æ ·ï¼Œå…·æœ‰æ„é€ å‡½æ•°ã€æ–¹æ³•æˆ–æ˜¯å±æ€§å­—æ®µï¼Œç­‰ç­‰ï¼Œè€Œå®ƒä¸å¼•ç”¨ç±»å‹çš„åŒºåˆ«åœ¨äºå®ƒåœ¨èµ‹å€¼çš„æ—¶å€™é€šå¸¸æ˜¯æ•´ä½“å¤åˆ¶ï¼Œè€Œä¸æ˜¯åƒå¼•ç”¨ç±»å‹é‚£æ ·ä¼ é€’å¼•ç”¨çš„ã€‚æ›´ä¸ºå…³é”®çš„æ˜¯ï¼Œå€¼ç±»å‹çš„å®ä¾‹å¾ˆå®¹æ˜“å®ç°åˆ†é…åœ¨æ–¹æ³•çš„è°ƒç”¨æ ˆä¸Šçš„ï¼Œè¿™æ„å‘³ç€å€¼ç±»å‹ä¼šéšç€å½“å‰æ–¹æ³•çš„é€€å‡ºè€Œè‡ªåŠ¨é‡Šæ”¾ï¼Œä¸ä¼šç»™åƒåœ¾æ”¶é›†å­ç³»ç»Ÿå¸¦æ¥ä»»ä½•å‹åŠ›ã€‚ åœ¨Valhallaé¡¹ç›®ä¸­ï¼ŒJavaçš„å€¼ç±»å‹æ–¹æ¡ˆè¢«ç§°ä¸ºâ€œå†…è”ç±»å‹â€ï¼Œè®¡åˆ’é€šè¿‡ä¸€ä¸ªæ–°çš„å…³é”®å­—inlineæ¥å®šä¹‰ã€‚ 2.2 æ¡ä»¶ç¼–è¯‘ä½¿ç”¨æ¡ä»¶ä¸ºå¸¸é‡çš„ifè¯­å¥ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æœŸé—´è¿‡æ»¤æ‰ä¸€äº›ä»£ç  public static void main(String[] args) { if (true) { System.out.println(\"block 1\"); } else { System.out.println(\"block 2\"); } } åç¼–è¯‘çš„ç»“æœ public static void main(String[] args) { System.out.println(\"block 1\"); } 2.3 å¯å˜å‚æ•°public void foo(String... args){} =&gt; public void foo(String[] args){} 2.4 switch-å­—ç¬¦ä¸²å’Œswitch-enum2.4.1 switch-å­—ç¬¦ä¸²é…åˆå­—ç¬¦ä¸²çš„å“ˆå¸Œå€¼ä½¿ç”¨ã€‚ String i = \"hello\"; switch (i){ case \"hello\": System.out.println(\"h\"); break; case \"world\": System.out.println(\"w\"); break; } åç¼–è¯‘å String i = \"hello\"; byte var3 = -1; switch(i.hashCode()) { case 99162322: if (i.equals(\"hello\")) { var3 = 0; } break; case 113318802: if (i.equals(\"world\")) { var3 = 1; } } switch(var3) { case 0: System.out.println(\"h\"); break; case 1: System.out.println(\"w\"); } 2.4.2 switch-enumenum Sex{ MALE,FEMALE } public static void foo(Sex sex){ switch (sex){ case MALE: System.out.println(\"ç”·\"); break; case FEMALE: System.out.println(\"å¥³\"); break; } } åç¼–è¯‘å /* *å®šä¹‰ä¸€ä¸ªåˆæˆç±»ï¼ˆä»…jvmä½¿ç”¨ï¼Œå¯¹æˆ‘ä»¬ä¸å¯è§ï¼‰ *ç”¨æ¥æ˜ å°„æšä¸¾çš„ordina1ä¸æ•°ç»„å…ƒç´ çš„å…³ç³» *æšä¸¾çš„ordinalè¡¨ç¤ºæšä¸¾å¯¹è±¡çš„åºå·ï¼Œä»0å¼€å§‹ *å³MALEçš„ordinal()=0ï¼ŒFEMALEçš„ordinal()=1 */ static class $MAP{ //æ•°ç»„å¤§å°å³ä¸ºæšä¸¾å…ƒç´ ä¸ªæ•°ï¼Œé‡Œé¢å­˜å‚¨caseç”¨æ¥å¯¹æ¯”çš„æ•°å­— static int[] map = new int[2]; static{ map[Sex.MALE.ordinal()]=1; map[Sex.FEMALE.ordinal()]=2; } } public static void foo(Sex sex) { int x = $MAP.map[sex.ordinal()]; switch(x){ case 1: System.out.println(\"ç”·\"ï¼‰; break; case 2: System.out.println(\"å¥³\"ï¼‰; break; } } 2.5 æšä¸¾enum Sex{ MALE,FEMALE } å®é™…ä¸Šæ˜¯ç¼–è¯‘æˆäº† public final class Sex extends Enum&lt;Sex>{ public static final Sex MALE; public static final Sex FEMALE; private static final Sex[] $VALUES; static{ MALE = new Sex(\"MALE\",0); FEMALE = new Sex(\"FEMALE\",1); $VALUES = new Sex[]{MALE,FEMALE}; } private Sex(String name,int ordinal){ super(name,ordinal); } public static Sex[] values(){ return $VALUES.clone(); } public static Sex valueOf(String name){ return Enum.valueOf(Sex.class,name); } } 2.6 try-with-resourcesJDK7å¼€å§‹æ–°å¢äº†å¯¹éœ€è¦å…³é—­çš„èµ„æºå¤„ç†çš„ç‰¹æ®Šè¯­æ³•try-with-resources: try(èµ„æºå˜é‡=åˆ›å»ºèµ„æºå¯¹è±¡){ }catch(){ } å…¶ä¸­èµ„æºå¯¹è±¡éœ€è¦å®ç°Autocloseableæ¥å£ï¼Œä¾‹å¦‚InputStreamã€OutputStreamã€Connectionã€Statementã€Resultsetç­‰æ¥å£éƒ½å®ç°äº†Autocloseableï¼Œä½¿ç”¨try-with-resourceså¯ä»¥ä¸ç”¨å†™finallyè¯­å¥å—ï¼Œç¼–è¯‘å™¨ä¼šå¸®åŠ©ç”Ÿæˆå…³é—­èµ„æºä»£ç ï¼Œä¾‹å¦‚ï¼š public static void main(String[]args){ try(InputStream is = new FileInputStream(\"d:\\\\1.txt\")){ System.out.println(is); }catch(IOException e){ e.printStackTrace(); } } åç¼–è¯‘åï¼š try { InputStream is = new FileInputStream(\"d:\\\\1.txt\"); Throwable var2 = null; try { System.out.println(is); } catch (Throwable var12) { var2 = var12; throw var12; } finally { if (is != null) { if (var2 != null) { try { is.close(); } catch (Throwable var11) { var2.addSuppressed(var11); } } else { is.close(); } } } } catch (IOException var14) { var14.printStackTrace(); }","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jvm","slug":"jvm","permalink":"https://www.codetool.top/tags/jvm/"}]},{"title":"leetcode103-äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚æ¬¡éå†","slug":"leetcode103-äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚æ¬¡éå†","date":"2020-01-24T18:52:24.000Z","updated":"2020-02-20T14:55:21.052Z","comments":true,"path":"article/leetcode103-äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚æ¬¡éå†/","link":"","permalink":"https://www.codetool.top/article/leetcode103-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%94%AF%E9%BD%BF%E5%BD%A2%E5%B1%82%E6%AC%A1%E9%81%8D%E5%8E%86/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼çš„é”¯é½¿å½¢å±‚æ¬¡éå†ã€‚ï¼ˆå³å…ˆä»å·¦å¾€å³ï¼Œå†ä»å³å¾€å·¦è¿›è¡Œä¸‹ä¸€å±‚éå†ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå±‚ä¸å±‚ä¹‹é—´äº¤æ›¿è¿›è¡Œï¼‰ã€‚ ä¾‹å¦‚:ç»™å®šäºŒå‰æ ‘: [3,9,20,null,null,15,7], &nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;/ \\&nbsp;&nbsp;9&nbsp;&nbsp;20&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;15&nbsp;&nbsp;&nbsp;7 è¿”å›é”¯é½¿å½¢å±‚æ¬¡éå†å¦‚ä¸‹ï¼š [&nbsp;&nbsp;[3],&nbsp;&nbsp;[20,9],&nbsp;&nbsp;[15,7]] 2 è§£æ³•2.1 æ€æƒ³ç”¨ä¸¤ä¸ªæ ˆæ¥äº¤æ›¿å­˜å‚¨æŸä¸€å±‚å’Œä¸‹ä¸€å±‚çš„èŠ‚ç‚¹: è¯»å–ç¬¬ä¸€ä¸ªæ ˆçš„æ—¶å€™ï¼Œä»å·¦å‘å³çš„è¯»å–èŠ‚ç‚¹ï¼Œå°†å®ƒä»¬çš„å­èŠ‚ç‚¹ä»å·¦å‘å³å…¥ç¬¬äºŒä¸ªæ ˆï¼Œèƒ½ä½¿è¯»å–ç¬¬äºŒä¸ªæ ˆçš„æ—¶å€™æ˜¯ä»¥ä»å³å‘å·¦çš„é¡ºåºå‡ºæ ˆçš„ã€‚ è¯»å–ç¬¬äºŒä¸ªæ ˆçš„æ—¶å€™ï¼Œä»å³å‘å·¦çš„è¯»å–èŠ‚ç‚¹ï¼Œå°†å®ƒä»¬çš„å­èŠ‚ç‚¹ä»å³å‘å·¦å…¥ç¬¬ä¸€ä¸ªæ ˆï¼Œèƒ½ä½¿è¯»å–ç¬¬ä¸€ä¸ªæ ˆçš„æ—¶å€™æ˜¯ä»¥ä»å·¦å‘å³çš„é¡ºåºå‡ºæ ˆçš„ã€‚ è¿™æ ·äº¤æ›¿ä½¿ç”¨ä¸¤ä¸ªæ ˆï¼Œå¯ä»¥å®ç°ä¸¤å±‚ä¹‹é—´çš„é¡ºåºåè½¬ã€‚ 2.2 ä»£ç class Solution { public List&lt;List&lt;Integer>> zigzagLevelOrder(TreeNode root) { List&lt;List&lt;Integer>> ans = new ArrayList&lt;>(); Stack&lt;TreeNode> first = new Stack&lt;>(); Stack&lt;TreeNode> second = new Stack&lt;>(); List&lt;Integer> cur; if(root == null) return ans; first.push(root); while(!first.isEmpty()||!second.isEmpty()){ //å½“å‰å±‚çš„èŠ‚ç‚¹æŒ‰ä»å·¦å‘å³çš„é¡ºåºä¾æ¬¡å‡ºæ ˆï¼Œå­èŠ‚ç‚¹æŒ‰ä»å·¦å‘å³çš„é¡ºåºå…¥secondæ ˆï¼Œå®ç°é¡ºåºé€†è½¬ cur = new ArrayList&lt;>(); while(!first.isEmpty()){ TreeNode node = first.pop(); cur.add(node.val); if(node.left!=null) second.push(node.left); if(node.right!=null) second.push(node.right); } ans.add(cur); //ä¸‹ä¸€å±‚çš„èŠ‚ç‚¹æŒ‰ä»å³å‘å·¦çš„é¡ºåºä¾æ¬¡å‡ºæ ˆï¼Œå­èŠ‚ç‚¹æŒ‰ä»å³å‘å·¦çš„é¡ºåºå…¥firstæ ˆï¼Œå®ç°é¡ºåºé€†è½¬ if(second.isEmpty()) break; cur = new ArrayList&lt;>(); while(!second.isEmpty()){ TreeNode node = second.pop(); cur.add(node.val); if(node.right!=null) first.push(node.right); if(node.left!=null) first.push(node.left); } ans.add(cur); } return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ„¿å¹¿å¤§å›½äººéƒ½èƒ½å¹³å®‰åº¦è¿‡è¿™ä¸ªæ˜¥èŠ‚","slug":"æ„¿å¹¿å¤§å›½äººéƒ½èƒ½å¹³å®‰åº¦è¿‡è¿™ä¸ªæ˜¥èŠ‚","date":"2020-01-24T16:30:44.000Z","updated":"2020-01-24T16:51:20.114Z","comments":true,"path":"article/æ„¿å¹¿å¤§å›½äººéƒ½èƒ½å¹³å®‰åº¦è¿‡è¿™ä¸ªæ˜¥èŠ‚/","link":"","permalink":"https://www.codetool.top/article/%E6%84%BF%E5%B9%BF%E5%A4%A7%E5%9B%BD%E4%BA%BA%E9%83%BD%E8%83%BD%E5%B9%B3%E5%AE%89%E5%BA%A6%E8%BF%87%E8%BF%99%E4%B8%AA%E6%98%A5%E8%8A%82/","excerpt":"","text":"ä»Šå¤©æ˜¯2020å¹´1æœˆ25æ—¥ï¼Œå†œå†æ­£æœˆåˆä¸€ï¼Œæ˜¯å’±ä»¬å›½å®¶çš„ä¼ ç»Ÿä½³èŠ‚â€”â€”æ˜¥èŠ‚ã€‚æˆ‘ä¸€ç›´è§‰å¾—æ˜¥èŠ‚æ˜¯ä¸­å›½å¾ˆé‡è¦çš„ä¸€ä¸ªæ–‡åŒ–ç¬¦å·ï¼Œæˆ‘ç›¸ä¿¡å¯¹äºæ‰€æœ‰åäººæ¥è¯´ï¼Œæ˜¥èŠ‚çš„ç‰¹æ®Šæ€§å·²ç»èäºè¡€æ¶²ä¹‹ä¸­ï¼Œæ˜¯ä¸å¯æ›¿ä»£çš„èŠ‚æ—¥ã€‚æˆ‘åœ¨è¿™é‡Œæ­ç¥æ‰€æœ‰åäººæ–°å¹´å¿«ä¹ï¼Œé¼ å¹´å¤§å‰ã€‚ åŒæ—¶æˆ‘ä¹Ÿå¸Œæœ›ï¼Œå¤§å®¶åº”æ—¶åˆ»æŠŠè‡ªå·±çš„å¥åº·å®‰å…¨æ”¾åœ¨ç¬¬ä¸€ä½ï¼Œåœ¨2019-nCoVï¼ˆæ­¦æ±‰è‚ºç‚ï¼‰è‚†è™ä¹‹é™…ï¼Œè¦æ—¶åˆ»æ³¨æ„æ¸…æ´å«ç”Ÿï¼Œå‡ºé—¨æˆ´å¥½å£ç½©ï¼Œè¿™æ®µæ—¶é—´å°½é‡é¿å…å’Œåˆ«äººæ¥è§¦ã€‚ æˆªè‡³ç›®å‰ï¼Œå¤§å¤šæ•°çœçº§è¡Œæ”¿åŒºéƒ½å¯åŠ¨äº†çªå‘å…¬å…±å«ç”Ÿäº‹ä»¶ä¸€çº§å“åº”ï¼Œè¿™ä»¶äº‹çš„é‡è¦ç¨‹åº¦ä¸è¨€è€Œå–»ï¼Œæˆ‘ä¹Ÿæœ‰åœ¨æŒç»­å…³æ³¨ç–«æƒ…çš„åŠ¨æ€ã€‚æˆ‘ç›¸ä¿¡åªè¦å¤§å®¶é½å¿ƒååŠ›ï¼Œæˆ‘ä»¬ä¸€å®šèƒ½æ‰“å¥½è¿™åœºæ”»åšæˆ˜ï¼Œæˆ‘ä»¬ä¹Ÿä¸ç”¨å¤ªè¿‡ææ…Œï¼Œä¿æŠ¤å¥½è‡ªå·±å°±æ˜¯æœ€é‡è¦çš„ã€‚ ç›®å‰å·²ç»å¯ä»¥çœ‹åˆ°å¾ˆå¤šå¸‚æ°‘çš„é˜²èŒƒæ„è¯†éƒ½æœ‰æé«˜ï¼Œæˆ‘è§‰å¾—æˆ‘ä»¬ç°åœ¨åšçš„ä¸€åˆ‡éƒ½åœ¨æ­¥å…¥æ­£è½¨ã€‚ å¸Œæœ›è¿™ä¸ªæ˜¥èŠ‚æ‰€æœ‰äººéƒ½å¹³å¹³å®‰å®‰ï¼æ­¦æ±‰åŠ æ²¹ï¼ä¸­å›½åŠ æ²¹ï¼","categories":[{"name":"æ—¥å¸¸/éšç¬”","slug":"æ—¥å¸¸-éšç¬”","permalink":"https://www.codetool.top/categories/%E6%97%A5%E5%B8%B8-%E9%9A%8F%E7%AC%94/"}],"tags":[{"name":"æ—¥å¸¸","slug":"æ—¥å¸¸","permalink":"https://www.codetool.top/tags/%E6%97%A5%E5%B8%B8/"}]},{"title":"leetcode85-æœ€å¤§çŸ©å½¢","slug":"leetcode85-æœ€å¤§çŸ©å½¢","date":"2020-01-24T05:19:04.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode85-æœ€å¤§çŸ©å½¢/","link":"","permalink":"https://www.codetool.top/article/leetcode85-%E6%9C%80%E5%A4%A7%E7%9F%A9%E5%BD%A2/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªä»…åŒ…å« 0 å’Œ 1 çš„äºŒç»´äºŒè¿›åˆ¶çŸ©é˜µï¼Œæ‰¾å‡ºåªåŒ…å« 1 çš„æœ€å¤§çŸ©å½¢ï¼Œå¹¶è¿”å›å…¶é¢ç§¯ã€‚ ç¤ºä¾‹ï¼š è¾“å…¥:[&nbsp;&nbsp;[â€œ1â€,â€0â€,â€1â€,â€0â€,â€0â€],&nbsp;&nbsp;[â€œ1â€,â€0â€,â€1â€,â€1â€,â€1â€],&nbsp;&nbsp;[â€œ1â€,â€1â€,â€1â€,â€1â€,â€1â€],&nbsp;&nbsp;[â€œ1â€,â€0â€,â€0â€,â€1â€,â€0â€]]è¾“å‡º: 6 2 è§£æ³•2.1 æ€æƒ³è¿™é“é¢˜å¯ä»¥åˆ†è§£æˆè‹¥å¹²leetcode84-æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢çš„å­é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•ã€‚ æˆ‘ä»¬ä»ä¸Šå¾€ä¸‹åŠ¨æ€è§„åˆ’äºŒç»´æ•°ç»„ï¼Œæ¯å¢åŠ ä¸€è¡Œå°±ä¼šå‡ºç°ä¸åŒçš„æŸ±çŠ¶åŒºåŸŸã€‚ ä»æ¯ä¸€æ¬¡å¾—åˆ°çš„æœ€å¤§çŸ©å½¢é¢ç§¯ä¸­è·å–æœ€å¤§å€¼ï¼Œå°±æ˜¯è¯¥é¢˜çš„ç­”æ¡ˆ 2.2 ä»£ç class Solution { public int largestRectangleArea(int[] heights) { int length = heights.length; if(length==0) return 0; int max = 0; int left[] = new int[length]; int right[] = new int[length]; left[0] = -1; right[length-1] = length; for(int i = 1;i&lt;length;i++){ //å¦‚æœå·¦è¾¹ä¸€åˆ—æ¯”å½“å‰åˆ—çŸ®ï¼Œåˆ™leftå°±ç­‰äºå·¦è¾¹ä¸€åˆ—çš„ä¸‹æ ‡ã€‚ if(heights[i]>heights[i-1]) left[i] = i-1; else{ //å¦åˆ™æ²¿ç€å·¦è¾¹è¿™åˆ—çš„leftä¸€ç›´æŸ¥æ‰¾è¿‡å»ï¼Œç›´åˆ°æ‰¾åˆ°æ¯”å½“å‰åˆ—ä½çš„ä¸€åˆ— left[i] = left[i-1]; while(left[i]!=-1&amp;&amp;heights[left[i]]>=heights[i]) left[i] = left[left[i]]; } } for(int i = length-2;i>=0;i--){ //å¦‚æœå³è¾¹ä¸€åˆ—æ¯”å½“å‰åˆ—çŸ®ï¼Œåˆ™rightå°±ç­‰äºå³è¾¹ä¸€åˆ—çš„ä¸‹æ ‡ã€‚ if(heights[i]>heights[i+1]) right[i] = i+1; else{ //å¦åˆ™æ²¿ç€å³è¾¹è¿™åˆ—çš„rightä¸€ç›´æŸ¥æ‰¾è¿‡å»ï¼Œç›´åˆ°æ‰¾åˆ°æ¯”å½“å‰åˆ—ä½çš„ä¸€åˆ— right[i] = right[i+1]; while(right[i]!=length&amp;&amp;heights[right[i]]>=heights[i]) right[i] = right[right[i]]; } } for(int i = 0;i&lt;length;i++){ int area = (right[i]-left[i]-1)*heights[i]; if(area>max) max = area; } return max; } public int maximalRectangle(char[][] matrix) { if(matrix.length == 0) return 0; int height[] = new int[matrix[0].length]; int max = 0; for(char[] line:matrix){ //æ¯å¢åŠ ä¸€è¡Œæ”¹å˜heightæ•°ç»„ for(int i=0;i&lt;line.length;i++){ if(line[i]=='0') height[i]=0; else height[i] += 1; } int area = largestRectangleArea(height); if(area>max) max=area; } return max; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode84-æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢","slug":"leetcode84-æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢","date":"2020-01-23T19:01:50.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode84-æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢/","link":"","permalink":"https://www.codetool.top/article/leetcode84-%E6%9F%B1%E7%8A%B6%E5%9B%BE%E4%B8%AD%E6%9C%80%E5%A4%A7%E7%9A%84%E7%9F%A9%E5%BD%A2/","excerpt":"","text":"1 åŸé¢˜ç»™å®š n ä¸ªéè´Ÿæ•´æ•°ï¼Œç”¨æ¥è¡¨ç¤ºæŸ±çŠ¶å›¾ä¸­å„ä¸ªæŸ±å­çš„é«˜åº¦ã€‚æ¯ä¸ªæŸ±å­å½¼æ­¤ç›¸é‚»ï¼Œä¸”å®½åº¦ä¸º 1 ã€‚ æ±‚åœ¨è¯¥æŸ±çŠ¶å›¾ä¸­ï¼Œèƒ½å¤Ÿå‹¾å‹’å‡ºæ¥çš„çŸ©å½¢çš„æœ€å¤§é¢ç§¯ã€‚ ä»¥ä¸Šæ˜¯æŸ±çŠ¶å›¾çš„ç¤ºä¾‹ï¼Œå…¶ä¸­æ¯ä¸ªæŸ±å­çš„å®½åº¦ä¸º 1ï¼Œç»™å®šçš„é«˜åº¦ä¸º [2,1,5,6,2,3]ã€‚ å›¾ä¸­é˜´å½±éƒ¨åˆ†ä¸ºæ‰€èƒ½å‹¾å‹’å‡ºçš„æœ€å¤§çŸ©å½¢é¢ç§¯ï¼Œå…¶é¢ç§¯ä¸º 10 ä¸ªå•ä½ã€‚ ç¤ºä¾‹ï¼š è¾“å…¥ï¼š [2,1,5,6,2,3]è¾“å‡ºï¼š 10 2 è§£æ³•2.1 æ€æƒ³è¿™é“é¢˜å’Œleetcode42-æ¥é›¨æ°´è¾ƒä¸ºç›¸ä¼¼ã€‚ å¯¹äºæ¯åˆ—æ¥è¯´ï¼Œä»¥å½“å‰åˆ—é«˜ä¸ºé«˜çš„æœ€å¤§çŸ©å½¢åŒºåŸŸçš„å®½åº¦åŒºåŸŸä¸ºè¢«å·¦è¾¹æœ€è¿‘è¾ƒçŸ®ä¸€åˆ—å’Œå³è¾¹æœ€è¿‘è¾ƒçŸ®ä¸€åˆ—å›´èµ·æ¥çš„å®½åº¦ã€‚ å¦‚æœä¸¤è¾¹æœ‰ä¸€è¾¹æ²¡æœ‰æ¯”å½“å‰åˆ—çŸ®çš„ä¸€åˆ—ï¼Œåˆ™å·¦è¾¹ç®—ä½œ-1ï¼Œå³è¾¹ç®—ä½œlengthã€‚ 2.2 ä»£ç class Solution { public int largestRectangleArea(int[] heights) { int length = heights.length; if(length==0) return 0; int max = 0; int left[] = new int[length]; int right[] = new int[length]; left[0] = -1; right[length-1] = length; for(int i = 1;i&lt;length;i++){ //å¦‚æœå·¦è¾¹ä¸€åˆ—æ¯”å½“å‰åˆ—çŸ®ï¼Œåˆ™leftå°±ç­‰äºå·¦è¾¹ä¸€åˆ—çš„ä¸‹æ ‡ã€‚ if(heights[i]>heights[i-1]) left[i] = i-1; else{ //å¦åˆ™æ²¿ç€å·¦è¾¹è¿™åˆ—çš„leftä¸€ç›´æŸ¥æ‰¾è¿‡å»ï¼Œç›´åˆ°æ‰¾åˆ°æ¯”å½“å‰åˆ—ä½çš„ä¸€åˆ— left[i] = left[i-1]; while(left[i]!=-1&amp;&amp;heights[left[i]]>=heights[i]) left[i] = left[left[i]]; } } for(int i = length-2;i>=0;i--){ //å¦‚æœå³è¾¹ä¸€åˆ—æ¯”å½“å‰åˆ—çŸ®ï¼Œåˆ™rightå°±ç­‰äºå³è¾¹ä¸€åˆ—çš„ä¸‹æ ‡ã€‚ if(heights[i]>heights[i+1]) right[i] = i+1; else{ //å¦åˆ™æ²¿ç€å³è¾¹è¿™åˆ—çš„rightä¸€ç›´æŸ¥æ‰¾è¿‡å»ï¼Œç›´åˆ°æ‰¾åˆ°æ¯”å½“å‰åˆ—ä½çš„ä¸€åˆ— right[i] = right[i+1]; while(right[i]!=length&amp;&amp;heights[right[i]]>=heights[i]) right[i] = right[right[i]]; } } for(int i = 0;i&lt;length;i++){ int area = (right[i]-left[i]-1)*heights[i]; if(area>max) max = area; } return max; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°09","slug":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°09","date":"2020-01-23T13:14:13.000Z","updated":"2020-04-22T09:27:27.218Z","comments":true,"path":"article/æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°09/","link":"","permalink":"https://www.codetool.top/article/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%AC%AC%E4%B8%89%E7%89%88%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B009/","excerpt":"","text":"ç»­æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°08 1 ç±»åŠ è½½å™¨é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–æè¿°è¯¥ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµç§°ä¸ºç±»åŠ è½½å™¨ã€‚ç±»åŠ è½½å™¨å¯ä»¥ç”¨æˆ·è‡ªå®šä¹‰ï¼Œæ˜¯javaè¯­è¨€æµè¡Œçš„ä¸€é¡¹åŸå›  1.1 ç±»ä¸ç±»åŠ è½½å™¨å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½å¿…é¡»ç”±åŠ è½½å®ƒçš„ç±»åŠ è½½å™¨å’Œè¿™ä¸ªç±»æœ¬èº«ä¸€èµ·å…±åŒç¡®ç«‹å…¶åœ¨Javaè™šæ‹Ÿæœºä¸­çš„å”¯ä¸€æ€§ï¼Œæ¯ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œéƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»åç§°ç©ºé—´ã€‚ æˆ–è€…è¯´ï¼šæ¯”è¾ƒä¸¤ä¸ªç±»æ˜¯å¦â€œç›¸ç­‰â€ï¼Œåªæœ‰åœ¨è¿™ä¸¤ä¸ªç±»æ˜¯ç”±åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„å‰æä¸‹æ‰æœ‰æ„ä¹‰ï¼Œå¦åˆ™ï¼Œå³ä½¿è¿™ä¸¤ä¸ªç±»æ¥æºäºåŒä¸€ä¸ªClassæ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªJavaè™šæ‹ŸæœºåŠ è½½ï¼Œåªè¦åŠ è½½å®ƒä»¬çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œé‚£è¿™ä¸¤ä¸ªç±»å°±å¿…å®šä¸ç›¸ç­‰ã€‚ è¿™é‡Œæ‰€æŒ‡çš„â€œç›¸ç­‰â€ï¼ŒåŒ…æ‹¬ä»£è¡¨ç±»çš„Classå¯¹è±¡çš„equals()æ–¹æ³•ã€isAssignableFrom()æ–¹æ³•ã€isInstance()æ–¹æ³•çš„è¿”å›ç»“æœï¼Œä¹ŸåŒ…æ‹¬äº†ä½¿ç”¨instanceofå…³é”®å­—åšå¯¹è±¡æ‰€å±å…³ç³»åˆ¤å®šç­‰å„ç§æƒ…å†µã€‚ 1.2 åŒäº²å§”æ´¾æ¨¡å‹ç«™åœ¨Javaè™šæ‹Ÿæœºçš„è§’åº¦æ¥çœ‹ï¼Œåªå­˜åœ¨ä¸¤ç§ä¸åŒçš„ç±»åŠ è½½å™¨ï¼šä¸€ç§æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrapClassLoaderï¼‰ï¼Œè¿™ä¸ªç±»åŠ è½½å™¨ä½¿ç”¨C++è¯­è¨€å®ç°ï¼Œæ˜¯è™šæ‹Ÿæœºè‡ªèº«çš„ä¸€éƒ¨åˆ†ï¼›å¦å¤–ä¸€ç§å°±æ˜¯å…¶ä»–æ‰€æœ‰çš„ç±»åŠ è½½å™¨ï¼Œè¿™äº›ç±»åŠ è½½å™¨éƒ½ç”±Javaè¯­è¨€å®ç°ï¼Œç‹¬ç«‹å­˜åœ¨äºè™šæ‹Ÿæœºå¤–éƒ¨ï¼Œå¹¶ä¸”å…¨éƒ½ç»§æ‰¿è‡ªæŠ½è±¡ç±» java.lang.ClassLoaderã€‚ è‡ªJDK 1.2ä»¥æ¥ï¼ŒJavaä¸€ç›´ä¿æŒç€ä¸‰å±‚ç±»åŠ è½½å™¨ã€åŒäº²å§”æ´¾çš„ç±»åŠ è½½æ¶æ„ã€‚ å¯¹äºJDK8åŠä¹‹å‰ç‰ˆæœ¬çš„Javaï¼Œç»å¤§å¤šæ•°ç¨‹åºéƒ½ä¼šä½¿ç”¨åˆ°ä»¥ä¸‹3ä¸ªç³»ç»Ÿæä¾›çš„ç±»åŠ è½½å™¨æ¥è¿›è¡ŒåŠ è½½ å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap Class Loaderï¼‰ï¼šè¿™ä¸ªç±»åŠ è½½å™¨è´Ÿè´£åŠ è½½å­˜æ”¾åœ¨ &lt;JAVA_HOME&gt;\\libç›®å½•ï¼Œæˆ–è€…è¢«-Xbootclasspathå‚æ•°æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­å­˜æ”¾çš„ï¼Œè€Œä¸”æ˜¯Javaè™šæ‹Ÿæœºèƒ½å¤Ÿè¯†åˆ«çš„ç±»åº“åŠ è½½åˆ°è™šæ‹Ÿæœºçš„å†…å­˜ä¸­ã€‚ç”¨æˆ·åœ¨ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¦‚æœéœ€è¦æŠŠåŠ è½½è¯·æ±‚å§”æ´¾ç»™å¼•å¯¼ç±»åŠ è½½å™¨å»å¤„ç†ï¼Œé‚£ç›´æ¥ä½¿ç”¨nullä»£æ›¿å³å¯ã€‚ æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension Class Loaderï¼‰ï¼šè¿™ä¸ªç±»åŠ è½½å™¨æ˜¯åœ¨ç±»sun.misc.Launcher$ExtClassLoaderä¸­ä»¥Javaä»£ç çš„å½¢å¼å®ç°çš„ã€‚å®ƒè´Ÿè´£åŠ è½½&lt;JAVA_HOME&gt;\\lib\\extç›®å½•ä¸­ï¼Œæˆ–è€…è¢«java.ext.dirsç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­æ‰€æœ‰çš„ç±»åº“ã€‚JDKçš„å¼€å‘å›¢é˜Ÿå…è®¸ç”¨æˆ·å°†å…·æœ‰é€šç”¨æ€§çš„ç±»åº“æ”¾ç½®åœ¨extç›®å½•é‡Œä»¥æ‰©å±•Java SEçš„åŠŸèƒ½ï¼Œåœ¨JDK 9ä¹‹åï¼Œè¿™ç§æ‰©å±•æœºåˆ¶è¢«æ¨¡å—åŒ–å¸¦æ¥çš„å¤©ç„¶çš„æ‰©å±•èƒ½åŠ›æ‰€å–ä»£ã€‚ç”±äºæ‰©å±•ç±»åŠ è½½å™¨æ˜¯ç”±Javaä»£ç å®ç°çš„ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥åœ¨ç¨‹åºä¸­ä½¿ç”¨æ‰©å±•ç±»åŠ è½½å™¨æ¥åŠ è½½Classæ–‡ä»¶ã€‚ åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆApplication Class Loaderï¼‰ï¼šè¿™ä¸ªç±»åŠ è½½å™¨ç”± sun.misc.Launcher$AppClassLoaderæ¥å®ç°ã€‚ç”±äºåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨æ˜¯ClassLoaderç±»ä¸­çš„getSystemClassLoader()æ–¹æ³•çš„è¿”å›å€¼ï¼Œæ‰€ä»¥æœ‰äº›åœºåˆä¸­ä¹Ÿç§°å®ƒä¸ºâ€œç³»ç»Ÿç±»åŠ è½½å™¨â€ã€‚å®ƒè´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆClassPathï¼‰ä¸Šæ‰€æœ‰çš„ç±»åº“ï¼Œå¼€å‘è€…åŒæ ·å¯ä»¥ç›´æ¥åœ¨ä»£ç ä¸­ä½¿ç”¨è¿™ä¸ªç±»åŠ è½½å™¨ã€‚å¦‚æœåº”ç”¨ç¨‹åºä¸­æ²¡æœ‰è‡ªå®šä¹‰è¿‡è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå°±æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚ åŒäº²å§”æ´¾æ¨¡å‹è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ã€‚ä¸è¿‡è¿™é‡Œç±»åŠ è½½å™¨ä¹‹é—´çš„çˆ¶å­å…³ç³»ä¸€èˆ¬ä¸æ˜¯ä»¥ç»§æ‰¿ï¼ˆInheritanceï¼‰çš„å…³ç³»æ¥å®ç°çš„ï¼Œè€Œæ˜¯é€šå¸¸ä½¿ç”¨ç»„åˆï¼ˆCompositionï¼‰å…³ç³»æ¥å¤ç”¨çˆ¶åŠ è½½å™¨çš„ä»£ç ã€‚ï¼ˆå­åŠ è½½å™¨å°†éƒ¨åˆ†åŠ¨ä½œå§”æ´¾ç»™çˆ¶åŠ è½½å™¨ï¼‰ åŒäº²å§”æ´¾æ¨¡å‹çš„å·¥ä½œè¿‡ç¨‹æ˜¯ï¼šå¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œæ¯ä¸€ä¸ªå±‚æ¬¡çš„ç±»åŠ è½½å™¨éƒ½æ˜¯å¦‚æ­¤ï¼Œå› æ­¤æ‰€æœ‰çš„åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ é€åˆ°æœ€é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ï¼Œåªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½è¯·æ±‚ï¼ˆå®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼‰æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»å®ŒæˆåŠ è½½ã€‚ å¥½å¤„æ˜¯Javaä¸­çš„ç±»éšç€å®ƒçš„ç±»åŠ è½½å™¨ä¸€èµ·å…·å¤‡äº†ä¸€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»ï¼Œä¾‹å¦‚ç±»java.lang.Objectéƒ½æ˜¯äº¤ç»™å¯åŠ¨ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œå› æ­¤Objectç±»åœ¨ç¨‹åºçš„å„ç§ç±»åŠ è½½å™¨ç¯å¢ƒä¸­éƒ½èƒ½å¤Ÿä¿è¯æ˜¯åŒä¸€ä¸ªç±»ã€‚ å®ç°åŒäº²å§”æ´¾æ¨¡å‹çš„ä»£ç ï¼š protected synchronized Class&lt;?> loadClass(String name, boolean resolve) throws ClassNotFoundException { // é¦–å…ˆï¼Œæ£€æŸ¥è¯·æ±‚çš„ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡äº† Class c = findLoadedClass(name); if (c == null) { try { if (parent != null) { c = parent.loadClass(name, false); } else {//ä»£è¡¨æ‰¾åˆ°äº†å¯åŠ¨ç±»åŠ è½½å™¨ c = findBootstrapClassOrNull(name); } } catch (ClassNotFoundException e) { // å¦‚æœçˆ¶ç±»åŠ è½½å™¨æŠ›å‡ºClassNotFoundException // è¯´æ˜çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®ŒæˆåŠ è½½è¯·æ±‚ } if (c == null) { // åœ¨çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½æ—¶ // å†è°ƒç”¨æœ¬èº«çš„findClassæ–¹æ³•æ¥è¿›è¡Œç±»åŠ è½½ c = findClass(name);//findClasså®ç°åŠ è½½è¿‡ç¨‹ } } if (resolve) { resolveClass(c); } return c; } 1.3 ç ´ååŒäº²å§”æ´¾æ¨¡å‹ä¸ºä»€ä¹ˆè¦ç ´ååŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ å¦‚æœåŸºç¡€ç±»å‹è¦è°ƒç”¨å›ç”¨æˆ·çš„ä»£ç ã€‚ å®ä¾‹ï¼š å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„DriverManageråœ¨loadInitialDriver()åŠ è½½com.mysql.jdbc.Driveråº”ç”¨ç¨‹åºç±» JNDIæœåŠ¡å¯¹èµ„æºè¿›è¡ŒæŸ¥æ‰¾å’Œé›†ä¸­ç®¡ç†ï¼Œå¯ä»¥é€šè¿‡æ¥å£åè·å–æ‰€æœ‰å®ç°ç±»ï¼Œéœ€è¦è°ƒç”¨ç”±å…¶ä»–å‚å•†å®ç°å¹¶éƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºçš„ClassPathä¸‹çš„JNDIæœåŠ¡æä¾›è€…æ¥å£ï¼ˆService Provider Interfaceï¼ŒSPIï¼‰çš„ä»£ç ã€‚ JDK9çš„æ¨¡å—åŒ–å®ç°çƒ­éƒ¨ç½²ã€‚ è§£å†³æ–¹æ¡ˆï¼š çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼ˆThread Context ClassLoaderï¼‰ã€‚è¿™ä¸ªç±»åŠ è½½å™¨å¯ä»¥é€šè¿‡java.lang.Threadç±»çš„setContextClassLoader()æ–¹æ³•è¿›è¡Œè®¾ç½®ï¼Œå¦‚æœåˆ›å»ºçº¿ç¨‹æ—¶è¿˜æœªè®¾ç½®ï¼Œå®ƒå°†ä¼šä»çˆ¶çº¿ç¨‹ä¸­ç»§æ‰¿ä¸€ä¸ªï¼Œå¦‚æœåœ¨åº”ç”¨ç¨‹åºçš„å…¨å±€èŒƒå›´å†…éƒ½æ²¡æœ‰è®¾ç½®è¿‡çš„è¯ï¼Œé‚£è¿™ä¸ªç±»åŠ è½½å™¨é»˜è®¤å°±æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ã€‚ ä½¿ç”¨Class.forName(String name, boolean initialize,ClassLoader loader)æ–¹æ³•ä½¿ç”¨æŒ‡å®šçš„ç±»åŠ è½½å™¨åŠ è½½ç±»ã€‚ 1.4 è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ç»§æ‰¿ClassLoaderçˆ¶ç±» è¦éµä»åŒäº²å§”æ´¾æ¨¡å‹ï¼Œé‡å†™findClassæ–¹æ³•ã€‚ è¯»å–ç±»æ–‡ä»¶çš„å­—èŠ‚ç  è°ƒç”¨çˆ¶ç±»çš„defineClassæ–¹æ³•æ¥åŠ è½½ç±» ä½¿ç”¨è€…è°ƒç”¨è¯¥ç±»åŠ è½½å™¨çš„loadClassæ–¹æ³• class MyClassLoader extends ClassLoader{ @Override protected Class&lt;?> findClass(String name) throws ClassNotFoundException { String path = \"e:\\\\mypath\\\\\" + name + \".class\"; try { ByteArrayOutputStream os = new ByteArrayOutputStream(); Files.copy(Paths.get(path),os); byte[] bytes = os.toByteArray(); return defineClass(name,bytes,0,bytes.length); }catch (IOException e){ e.printStackTrace(); throw new ClassNotFoundException(); } } } 1.5 è¡¥å…… Class.getClassLoader()å¯ä»¥è·å–ä¸€ä¸ªç±»çš„åŠ è½½å™¨ï¼Œå¯åŠ¨ç±»åŠ è½½å™¨æ˜¯null -Xbootclasspath/a:&lt;è¿½åŠ è·¯å¾„&gt;å¯ä»¥åœ¨JAVA_HOME/libçš„åŸºç¡€ä¸Šè¿½åŠ è·¯å¾„è®©å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jvm","slug":"jvm","permalink":"https://www.codetool.top/tags/jvm/"}]},{"title":"Javaå­—èŠ‚ç å®ä¾‹æ¢ç©¶","slug":"Javaå­—èŠ‚ç å®ä¾‹æ¢ç©¶","date":"2020-01-23T10:22:05.000Z","updated":"2020-02-13T05:25:32.096Z","comments":true,"path":"article/Javaå­—èŠ‚ç å®ä¾‹æ¢ç©¶/","link":"","permalink":"https://www.codetool.top/article/Java%E5%AD%97%E8%8A%82%E7%A0%81%E5%AE%9E%E4%BE%8B%E6%8E%A2%E7%A9%B6/","excerpt":"","text":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°06ä¸­ä»‹ç»äº†classæ–‡ä»¶ç»“æ„ï¼Œè¿™é‡Œæˆ‘ä»¬åŠ¨æ‰‹å®è·µï¼Œç¼–è¯‘ä¸€ä¸ªç±»æŸ¥çœ‹ä¸€ä¸‹å®ƒçš„å­—èŠ‚ç ã€‚ javaæºç ï¼š public class Main { private int i = 10; private static int j = 40000; public static String str = \"Hello World!\"; public static void main(String[] args){ System.out.println(str); } } è¿™ä¸ªç±»æœ‰æ–¹æ³•æœ‰å®ä¾‹å˜é‡æœ‰é™æ€å˜é‡ï¼Œåœ¨JDK8ç¯å¢ƒä¸‹ç¼–è¯‘åçš„å­—èŠ‚ç å¼€å¤´éƒ¨åˆ†å¦‚ä¸‹å›¾ï¼š æˆ‘ä»¬æ¥é€å­—èŠ‚åˆ†æï¼š 1 é­”æ•°ã€æ¬¡ç‰ˆæœ¬å·ã€ä¸»ç‰ˆæœ¬å·00~03ï¼šCA FE BA BEï¼Œé­”æ•°ã€‚ 04~05ï¼š00 00 Minor Versionï¼Œæ¬¡ç‰ˆæœ¬å·06~07ï¼š00 34 åè¿›åˆ¶52ï¼ŒMajor Versionï¼Œä¸»ç‰ˆæœ¬å·ï¼Œä¸¤è€…å¯¹åº”JDK8 2 å¸¸é‡æ± 08~09ï¼š00 2F åè¿›åˆ¶47ï¼Œä»£è¡¨å¸¸é‡æ± å†…é¡¹çš„æ•°é‡ã€‚ 10å¼€å§‹ä¸ºå¸¸é‡æ± ä¸­çš„å„è¡¨ï¼š #10Aï¼š0A åè¿›åˆ¶10ï¼Œä»£è¡¨CONSTANT_Methodref_infoç±»å‹ï¼Œ0B~0Eï¼š00 0A 00 1E #10ï¼Œ#30 #20Fï¼š09 åè¿›åˆ¶9ï¼Œä»£è¡¨CONSTANT_Fieldref_infoç±»å‹ï¼Œ10~13ï¼š00 09 00 1F #9ï¼Œ#31 #314ï¼š09 åè¿›åˆ¶9ï¼Œä»£è¡¨CONSTANT_Fieldref_infoç±»å‹ï¼Œ15~18ï¼š00 20 00 21 #32ï¼Œ#33 #419ï¼š09 åè¿›åˆ¶9ï¼Œä»£è¡¨CONSTANT_Fieldref_infoç±»å‹ï¼Œ1A~1Dï¼š00 09 00 22 #9ï¼Œ#34 #51Eï¼š0A åè¿›åˆ¶9ï¼Œä»£è¡¨CONSTANT_Methodref_infoç±»å‹ï¼Œ1F~22ï¼š00 23 00 24 #35ï¼Œ#36 #61Eï¼š03 åè¿›åˆ¶3ï¼Œä»£è¡¨CONSTANT_Integer_infoç±»å‹ï¼Œ15~18ï¼š00 00 9C 40 40000 #728ï¼š09 åè¿›åˆ¶9ï¼Œä»£è¡¨CONSTANT_Fieldref_infoç±»å‹ï¼Œ29~2Cï¼š00 09 00 25 #9ï¼Œ#37 #82Dï¼š08 åè¿›åˆ¶8ï¼Œä»£è¡¨CONSTANT_String_infoç±»å‹ï¼Œ2E~2Fï¼š00 26 #38 #930ï¼š07 åè¿›åˆ¶7ï¼Œä»£è¡¨CONSTANT_Class_infoç±»å‹ï¼Œ31~32ï¼š00 27 #39 #1033ï¼š07 åè¿›åˆ¶7ï¼Œä»£è¡¨CONSTANT_Class_infoç±»å‹ï¼Œ34~35ï¼š00 28 #40 #1136ï¼š01 åè¿›åˆ¶1ï¼Œä»£è¡¨CONSTANT_Utf8_infoç±»å‹ï¼Œ37~38ï¼š00 01ä»£è¡¨é•¿åº¦ä¸º1ï¼Œ39ï¼š69 ä»£è¡¨å­—ç¬¦&#39;i&#39; #123Aï¼š01 åè¿›åˆ¶1ï¼Œä»£è¡¨CONSTANT_Utf8_infoç±»å‹ï¼Œ3B~3Cï¼š00 01ä»£è¡¨é•¿åº¦ä¸º1ï¼Œ3Dï¼š49 ä»£è¡¨å­—ç¬¦&#39;I&#39; å‰©ä½™å¸¸é‡æ± çš„é¡¹æˆ‘ä»¬ç”¨javapå¾—åˆ°ï¼ˆå…¶å®ç´¯äº†ï¼‰ï¼š #13 = Utf8 j #14 = Utf8 str #15 = Utf8 Ljava/lang/String; #16 = Utf8 &lt;init&gt; #17 = Utf8 ()V #18 = Utf8 Code #19 = Utf8 LineNumberTable #20 = Utf8 LocalVariableTable #21 = Utf8 this #22 = Utf8 LMain; #23 = Utf8 main #24 = Utf8 ([Ljava/lang/String;)V #25 = Utf8 args #26 = Utf8 [Ljava/lang/String; #27 = Utf8 &lt;clinit&gt; #28 = Utf8 SourceFile #29 = Utf8 Main.java #30 = NameAndType #16:#17 // &quot;&lt;init&gt;&quot;:()V #31 = NameAndType #11:#12 // i:I #32 = Class #41 // java/lang/System #33 = NameAndType #42:#43 // out:Ljava/io/PrintStream; #34 = NameAndType #14:#15 // str:Ljava/lang/String; #35 = Class #44 // java/io/PrintStream #36 = NameAndType #45:#46 // println:(Ljava/lang/String;)V #37 = NameAndType #13:#12 // j:I #38 = Utf8 Hello World! #39 = Utf8 Main #40 = Utf8 java/lang/Object #41 = Utf8 java/lang/System #42 = Utf8 out #43 = Utf8 Ljava/io/PrintStream; #44 = Utf8 java/io/PrintStream #45 = Utf8 println #46 = Utf8 (Ljava/lang/String;)V3 è®¿é—®æ ‡å¿—ã€ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•é›†åˆè·³è¿‡å¸¸é‡æ± ï¼Œåˆ°äº†è®¿é—®æ ‡å¿—ï¼š 01C1~01C2ï¼š00 21ï¼Œä»£è¡¨ACC_SUPERï¼ˆ0x0020ï¼‰å’ŒACC_PUBLICï¼ˆ0x0001ï¼‰ã€‚ æ¥ç€æ˜¯ç±»ç´¢å¼•ï¼š 01C3~01C4ï¼š00 09 ä»£è¡¨å¸¸é‡æ± ä¸­#9ï¼Œ#9åˆæŒ‡å‘#39ï¼Œå¯ä»¥å¾—çŸ¥æ˜¯Mainï¼Œå³ç±»å çˆ¶ç±»ç´¢å¼•ï¼š 01C5~01C6ï¼š00 0A ä»£è¡¨å¸¸é‡æ± ä¸­#10ï¼Œ#10åˆæŒ‡å‘#40ï¼Œå¯ä»¥å¾—çŸ¥æ˜¯java/lang/Object æ¥å£ç´¢å¼•é›†åˆï¼š 01C7~01D8ï¼š00 00 ä»£è¡¨æ¥å£ç´¢å¼•é›†åˆä¸­æ²¡æœ‰æ•°æ®ï¼Œé•¿åº¦æ˜¯0 4 å­—æ®µè¡¨é›†åˆ01C9~01CA: 00 03 åè¿›åˆ¶3ï¼Œä»£è¡¨å­—æ®µè¡¨ä¸­æœ‰ä¸‰é¡¹æ•°æ®ï¼š ç¬¬ä¸€ä¸ªå­—æ®µï¼š 01CB~01CC: 00 02 ï¼Œè®¿é—®æ ‡å¿—ï¼Œä»£è¡¨ACC_PRIVATEï¼ˆ0x0002ï¼‰01CD~01CEï¼š00 0B ï¼Œname_indexï¼ŒæŒ‡å‘å¸¸é‡æ± #11ï¼Œ#11ä»£è¡¨&#39;i&#39;01CF~01D0ï¼š00 0C , discriptor_indexï¼ŒæŒ‡å‘å¸¸é‡æ± #12ï¼Œ#12ä»£è¡¨&#39;I&#39;ï¼ˆå³intç±»å‹ï¼‰01D1~01D2ï¼š00 00 , attributes_countï¼Œä»£è¡¨è¯¥å­—æ®µæ— å±æ€§è¡¨ã€‚ ç¬¬äºŒä¸ªå­—æ®µï¼š 01D3~01D4: 00 0A ï¼Œè®¿é—®æ ‡å¿—ï¼Œä»£è¡¨ACC_STATICï¼ˆ0x0008ï¼‰å’ŒACC_PRIVATEï¼ˆ0x0002ï¼‰01D5~01D6ï¼š00 0D ï¼Œname_indexï¼ŒæŒ‡å‘å¸¸é‡æ± #13ï¼Œ#13ä»£è¡¨&#39;j&#39;01D7~01D8ï¼š00 0C , discriptor_indexï¼ŒæŒ‡å‘å¸¸é‡æ± #12ï¼Œ#12ä»£è¡¨&#39;I&#39;ï¼ˆå³intç±»å‹ï¼‰01D9~01DAï¼š00 00 , attributes_countï¼Œä»£è¡¨è¯¥å­—æ®µæ— å±æ€§è¡¨ã€‚ ç¬¬ä¸‰ä¸ªå­—æ®µï¼š 01DB~01DC: 00 09 ï¼Œè®¿é—®æ ‡å¿—ï¼Œä»£è¡¨ACC_STATICï¼ˆ0x0008ï¼‰å’ŒACC_PUBLICï¼ˆ0x0001ï¼‰01DD~01DEï¼š00 0E ï¼Œname_indexï¼ŒæŒ‡å‘å¸¸é‡æ± #14ï¼Œ#14ä»£è¡¨&quot;str&quot;01DF~01E0ï¼š00 0F , discriptor_indexï¼ŒæŒ‡å‘å¸¸é‡æ± #15ï¼Œ#15ä»£è¡¨&quot;Ljava/lang/String;&quot;ï¼ˆå³Stringç±»å‹ï¼‰01E1~01E2ï¼š00 00 , attributes_countï¼Œä»£è¡¨è¯¥å­—æ®µæ— å±æ€§è¡¨ã€‚ 5 æ–¹æ³•è¡¨é›†åˆ01E3~01E4ï¼š00 03 ï¼Œåè¿›åˆ¶3ï¼Œä»£è¡¨æ–¹æ³•è¡¨ä¸­æœ‰ä¸‰é¡¹æ•°æ®ï¼š ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼š 01E5~01E6: 00 01 ï¼Œè®¿é—®æ ‡å¿—ï¼Œä»£è¡¨ACC_PUBLICï¼ˆ0x0001ï¼‰01E7~01E8ï¼š00 10 ï¼Œname_indexï¼ŒæŒ‡å‘å¸¸é‡æ± #16ï¼Œ#16ä»£è¡¨&quot;&lt;init&gt;&quot;ï¼ˆå³å¯¹è±¡æ„é€ å™¨ï¼‰01E9~01EAï¼š00 11 , discriptor_indexï¼ŒæŒ‡å‘å¸¸é‡æ± #17ï¼Œ#17ä»£è¡¨&quot;()V&quot;ï¼ˆå³æ— å‚ã€æ— è¿”å›å€¼ï¼‰01EB~01ECï¼š00 01 , attributes_countï¼Œä»£è¡¨å±æ€§è¡¨ä¸­æœ‰ä¸€é¡¹æ•°æ®ã€‚01ED~01EE: 00 12 ï¼Œattribute_name_indexï¼ŒæŒ‡å‘å¸¸é‡æ± #18ï¼Œ#18ä»£è¡¨&quot;Code&quot;ï¼ˆå³Codeå±æ€§ï¼‰01EF~01F2ï¼š00 00 00 39ï¼Œä»£è¡¨Codeå†…å®¹é•¿åº¦ä¸º57ä¸ªå­—èŠ‚ã€‚ æ¥ä¸‹æ¥57ä¸ªå­—èŠ‚æˆ‘ä»¬ä¸æŸ¥è¡¨é€ä¸€ç¿»è¯‘ï¼ŒæŸ¥çœ‹javapæä¾›çš„å†…å®¹ï¼š 01F3~022B Code: stack=2, locals=1, args_size=1 0: aload_0 1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 4: aload_0 5: bipush 10 7: putfield #2 // Field i:I 10: return LineNumberTable: line 7: 0 line 8: 4 LocalVariableTable: Start Length Slot Name Signature 0 11 0 this LMain;æˆ‘ä»¬æ¥è§£é‡Šä¸€ä¸‹å®ƒçš„å­—èŠ‚ç æŒ‡ä»¤ï¼š aload_0 å°†å±€éƒ¨å˜é‡è¡¨slot 0åŠ è½½åˆ°æ“ä½œæ•°æ ˆï¼Œé‚£ä¹ˆå±€éƒ¨å˜é‡è¡¨slot 0åŸæ¥å­˜æ”¾çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿéé™æ€æ–¹æ³•å±€éƒ¨å˜é‡è¡¨0ä½ç½®ä¸€å¼€å§‹éƒ½æ˜¯å­˜æ”¾çš„thisï¼Œå³è°ƒç”¨æ–¹æ³•çš„å½“å‰å¯¹è±¡ã€‚è¿™å¥è¯å°±æ˜¯æŠŠthiså…¥æ“ä½œæ•°æ ˆã€‚ invokespecial #1 thisè°ƒç”¨#1ä»£è¡¨çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æŸ¥å¸¸é‡è¡¨#1ï¼Œ#1åˆæŒ‡å‘#10å’Œ#30ï¼Œ#10æŒ‡å‘#40ï¼Œæ˜¯java/lang/Objectï¼Œ#30æ˜¯&quot;&lt;init&gt;&quot;:()Vï¼Œå³è°ƒç”¨çˆ¶ç±»Objectçš„æ„é€ æ–¹æ³•ã€‚ aload_0 å†æ¬¡åŠ è½½this bipush 10 å°†å¸¸é‡10å‹å…¥æ“ä½œæ•°æ ˆã€‚ putfield #2 putfieldæ˜¯è®¾ç½®å¯¹è±¡çš„å­—æ®µå€¼ï¼Œé€šè¿‡æŸ¥å¸¸é‡è¡¨ï¼Œ#2ä»£è¡¨Mainä¸­çš„i:Iï¼Œè¿™å¥è¯å°±æŠŠæ ˆé‡Œçš„ä¸¤ä¸ªæ“ä½œæ•°ï¼š10è®¾ç½®ç»™this.i return è¿”å› ç¬¬äºŒä¸ªæ–¹æ³•ï¼š 022C~022D: 00 09 ï¼Œè®¿é—®æ ‡å¿—ï¼Œä»£è¡¨ACC_PUBLICï¼ˆ0x0001ï¼‰å’ŒACC_STATICï¼ˆ0x0008ï¼‰022E~022Fï¼š00 17 ï¼Œname_indexï¼ŒæŒ‡å‘å¸¸é‡æ± #23ï¼Œ#23ä»£è¡¨&quot;main&quot;0230~0231ï¼š00 18 , discriptor_indexï¼ŒæŒ‡å‘å¸¸é‡æ± #24ï¼Œ#24ä»£è¡¨&quot;([Ljava/lang/String;)V&quot;ï¼ˆå³å‚æ•°ä¸ºStringæ•°ç»„ã€æ— è¿”å›å€¼ï¼‰0232~0233ï¼š00 01 , attributes_countï¼Œä»£è¡¨å±æ€§è¡¨ä¸­æœ‰ä¸€é¡¹æ•°æ®ã€‚0234~0235: 00 12 ï¼Œattribute_name_indexï¼ŒæŒ‡å‘å¸¸é‡æ± #18ï¼Œ#18ä»£è¡¨&quot;Code&quot;ï¼ˆå³Codeå±æ€§ï¼‰0236~0239ï¼š00 00 00 38ï¼Œä»£è¡¨Codeå†…å®¹é•¿åº¦ä¸º56ä¸ªå­—èŠ‚ã€‚ æ¥ä¸‹æ¥56ä¸ªå­—èŠ‚æˆ‘ä»¬ä¸æŸ¥è¡¨é€ä¸€ç¿»è¯‘ï¼ŒæŸ¥çœ‹javapæä¾›çš„å†…å®¹ï¼š 023A~0271 Code: stack=2, locals=1, args_size=1 0: getstatic #3 // Field java/lang/System.out:Ljava/io/PrintStream; 3: getstatic #4 // Field str:Ljava/lang/String; 6: invokevirtual #5 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 9: return LineNumberTable: line 12: 0 line 13: 9 LocalVariableTable: Start Length Slot Name Signature 0 10 0 args [Ljava/lang/String;æˆ‘ä»¬æ¥è§£é‡Šä¸€ä¸‹å®ƒçš„å­—èŠ‚ç æŒ‡ä»¤ï¼š getstatic #3 è·å–ä¸€ä¸ªç±»çš„é™æ€å­—æ®µï¼Œé€šè¿‡æŸ¥å¸¸é‡è¡¨å¯çŸ¥#3æ˜¯java/lang/Systemçš„out:Ljava/io/PrintStream;å³è·å–System.out getstatic #4 è·å–ä¸€ä¸ªç±»çš„é™æ€å­—æ®µï¼Œé€šè¿‡æŸ¥å¸¸é‡è¡¨å¯çŸ¥#4æ˜¯Mainçš„str:Ljava/lang/String;å³è·å–strå­—æ®µã€‚ invokevirtual #5 è°ƒç”¨#5æ–¹æ³•ï¼Œé€šè¿‡æŸ¥å¸¸é‡è¡¨å¯çŸ¥#5æ˜¯java/io/PrintStreamçš„println:(Ljava/lang/String;)Vï¼Œå³åœ¨æ“ä½œæ ˆçš„åŸºç¡€ä¸Šè°ƒç”¨System.out.println(str) return è¿”å› ç¬¬ä¸‰ä¸ªæ–¹æ³•ï¼š 0272~0273: 00 08 ï¼Œè®¿é—®æ ‡å¿—ï¼Œä»£è¡¨ACC_STATICï¼ˆ0x0008ï¼‰0274~0275ï¼š00 1B ï¼Œname_indexï¼ŒæŒ‡å‘å¸¸é‡æ± #27ï¼Œ#27ä»£è¡¨&quot;&lt;clinit&gt;&quot;ï¼ˆå³ç±»æ„é€ å™¨ï¼‰0276~0277ï¼š00 11 , discriptor_indexï¼ŒæŒ‡å‘å¸¸é‡æ± #17ï¼Œ#17ä»£è¡¨&quot;()V&quot;ï¼ˆå³æ— å‚æ— è¿”å›å€¼ï¼‰0278~0279ï¼š00 01 , attributes_countï¼Œä»£è¡¨å±æ€§è¡¨ä¸­æœ‰ä¸€é¡¹æ•°æ®ã€‚027A~027B: 00 12 ï¼Œattribute_name_indexï¼ŒæŒ‡å‘å¸¸é‡æ± #18ï¼Œ#18ä»£è¡¨&quot;Code&quot;ï¼ˆå³Codeå±æ€§ï¼‰027C~027Fï¼š00 00 00 27ï¼Œä»£è¡¨Codeå†…å®¹é•¿åº¦ä¸º39ä¸ªå­—èŠ‚ã€‚ æ¥ä¸‹æ¥39ä¸ªå­—èŠ‚æˆ‘ä»¬ä¸æŸ¥è¡¨é€ä¸€ç¿»è¯‘ï¼ŒæŸ¥çœ‹javapæä¾›çš„å†…å®¹ï¼š 0280~02A6 Code: stack=1, locals=0, args_size=0 0: ldc #6 // int 40000 2: putstatic #7 // Field j:I 5: ldc #8 // String Hello World! 7: putstatic #4 // Field str:Ljava/lang/String; 10: return LineNumberTable: line 9: 0 line 10: 5æˆ‘ä»¬æ¥è§£é‡Šä¸€ä¸‹å®ƒçš„å­—èŠ‚ç æŒ‡ä»¤ï¼š ldc #6 æŠŠä¸€ä¸ªå¸¸é‡#6åŠ è½½åˆ°æ“ä½œæ•°æ ˆï¼Œé€šè¿‡æŸ¥å¸¸é‡è¡¨å¯çŸ¥#6æ˜¯40000ã€‚ putstatic #7 è®¾ç½®ä¸€ä¸ªç±»çš„é™æ€å­—æ®µï¼Œé€šè¿‡æŸ¥å¸¸é‡è¡¨å¯çŸ¥#7æ˜¯Mainçš„j:Iï¼Œå³è®¾ç½®jçš„å€¼ä¸º40000ã€‚ï¼ˆæ³¨æ„è¿™é‡Œä¸ç¬¬ä¸€ä¸ªæ–¹æ³•ä¸åŒçš„æ˜¯ï¼Œè®¾ç½®å°äºç­‰äºshortæœ€å¤§å€¼çš„å€¼çš„æ—¶å€™å¸¸æ•°æ”¾åœ¨å­—èŠ‚ç ä¸­ï¼Œè€Œå¤§äºshortæœ€å¤§å€¼çš„å¸¸é‡æ”¾åœ¨å¸¸é‡è¡¨ä¸­ï¼‰ ldc #8 æŠŠä¸€ä¸ªå¸¸é‡#8åŠ è½½åˆ°æ“ä½œæ•°æ ˆï¼Œé€šè¿‡æŸ¥å¸¸é‡è¡¨å¯çŸ¥#8æ˜¯&quot;Hello World!&quot;ã€‚ putstatic #4 è®¾ç½®ä¸€ä¸ªç±»çš„é™æ€å­—æ®µï¼Œé€šè¿‡æŸ¥å¸¸é‡è¡¨å¯çŸ¥#4æ˜¯Mainçš„str:Ljava/lang/String;ï¼Œå³å°†strçš„å€¼è®¾ç½®ä¸º&quot;Hello World!&quot;ã€‚ return è¿”å› 6 å±æ€§è¡¨02A7~02A8ï¼š00 01 attributes_countï¼Œä»£è¡¨å±æ€§è¡¨ä¸­æœ‰ä¸€é¡¹æ•°æ®02A9~02AAï¼š00 1C attribute_name_indexï¼ŒæŒ‡å‘å¸¸é‡æ± #28ï¼Œ#28ä»£è¡¨&quot;SourceFile&quot;ï¼ˆè®°å½•æºæ–‡ä»¶åç§°ï¼‰02AB~02AE: 00 00 00 02 ä»£è¡¨å±æ€§å†…å®¹é•¿åº¦ä¸º2ä¸ªå­—èŠ‚ã€‚02AF~02B0: 00 1D ä»£è¡¨å±æ€§çš„å€¼ï¼ŒæŒ‡å‘å¸¸é‡æ± #29ï¼Œ#29ä»£è¡¨&quot;Main.java&quot; åˆ°æ­¤ï¼Œè¯¥classæ–‡ä»¶çš„å­—èŠ‚ç å…¨éƒ¨åˆ†æå®Œ","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jvm","slug":"jvm","permalink":"https://www.codetool.top/tags/jvm/"}]},{"title":"leetcode71-ç®€åŒ–è·¯å¾„","slug":"leetcode71-ç®€åŒ–è·¯å¾„","date":"2020-01-23T06:40:01.000Z","updated":"2020-02-20T14:55:21.053Z","comments":true,"path":"article/leetcode71-ç®€åŒ–è·¯å¾„/","link":"","permalink":"https://www.codetool.top/article/leetcode71-%E7%AE%80%E5%8C%96%E8%B7%AF%E5%BE%84/","excerpt":"","text":"1 åŸé¢˜ä»¥ Unix é£æ ¼ç»™å‡ºä¸€ä¸ªæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œä½ éœ€è¦ç®€åŒ–å®ƒã€‚æˆ–è€…æ¢å¥è¯è¯´ï¼Œå°†å…¶è½¬æ¢ä¸ºè§„èŒƒè·¯å¾„ã€‚ åœ¨ Unix é£æ ¼çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªç‚¹ï¼ˆ.ï¼‰è¡¨ç¤ºå½“å‰ç›®å½•æœ¬èº«ï¼›æ­¤å¤–ï¼Œä¸¤ä¸ªç‚¹ ï¼ˆ..ï¼‰ è¡¨ç¤ºå°†ç›®å½•åˆ‡æ¢åˆ°ä¸Šä¸€çº§ï¼ˆæŒ‡å‘çˆ¶ç›®å½•ï¼‰ï¼›ä¸¤è€…éƒ½å¯ä»¥æ˜¯å¤æ‚ç›¸å¯¹è·¯å¾„çš„ç»„æˆéƒ¨åˆ†ã€‚æ›´å¤šä¿¡æ¯è¯·å‚é˜…ï¼šLinux / Unixä¸­çš„ç»å¯¹è·¯å¾„ vs ç›¸å¯¹è·¯å¾„ è¯·æ³¨æ„ï¼Œè¿”å›çš„è§„èŒƒè·¯å¾„å¿…é¡»å§‹ç»ˆä»¥æ–œæ  / å¼€å¤´ï¼Œå¹¶ä¸”ä¸¤ä¸ªç›®å½•åä¹‹é—´å¿…é¡»åªæœ‰ä¸€ä¸ªæ–œæ  /ã€‚æœ€åä¸€ä¸ªç›®å½•åï¼ˆå¦‚æœå­˜åœ¨ï¼‰ä¸èƒ½ä»¥ / ç»“å°¾ã€‚æ­¤å¤–ï¼Œè§„èŒƒè·¯å¾„å¿…é¡»æ˜¯è¡¨ç¤ºç»å¯¹è·¯å¾„çš„æœ€çŸ­å­—ç¬¦ä¸²ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥ï¼š â€œ/home/â€œè¾“å‡ºï¼š â€œ/homeâ€è§£é‡Šï¼š æ³¨æ„ï¼Œæœ€åä¸€ä¸ªç›®å½•ååé¢æ²¡æœ‰æ–œæ ã€‚ ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼š â€œ/../â€œè¾“å‡ºï¼š â€œ/â€œè§£é‡Šï¼š ä»æ ¹ç›®å½•å‘ä¸Šä¸€çº§æ˜¯ä¸å¯è¡Œçš„ï¼Œå› ä¸ºæ ¹æ˜¯ä½ å¯ä»¥åˆ°è¾¾çš„æœ€é«˜çº§ã€‚ ç¤ºä¾‹ 3ï¼š è¾“å…¥ï¼š â€œ/home//foo/â€œè¾“å‡ºï¼š â€œ/home/fooâ€è§£é‡Šï¼š åœ¨è§„èŒƒè·¯å¾„ä¸­ï¼Œå¤šä¸ªè¿ç»­æ–œæ éœ€è¦ç”¨ä¸€ä¸ªæ–œæ æ›¿æ¢ã€‚ ç¤ºä¾‹ 4ï¼š è¾“å…¥ï¼š â€œ/a/./b/../../c/â€œè¾“å‡ºï¼š â€œ/câ€ ç¤ºä¾‹ 5ï¼š è¾“å…¥ï¼š â€œ/a/../../b/../c//.//â€œè¾“å‡ºï¼š â€œ/câ€ ç¤ºä¾‹ 6ï¼š è¾“å…¥ï¼š â€œ/a//b////c/d//././/..â€è¾“å‡ºï¼š â€œ/a/b/câ€ 2 è§£æ³•2.1 æ€æƒ³ä½¿ç”¨æ ˆçš„æ€æƒ³æ¥è§£å†³è¯¥é—®é¢˜ï¼Œå°†ç»™å®šçš„å­—ç¬¦ä¸²ä½¿ç”¨&quot;/&quot;åˆ†å‰²ï¼Œä¼šå¾—åˆ°ç”±ç©ºå­—ç¬¦ä¸²ã€&quot;.&quot;ã€&quot;..&quot;ã€ç›®å½•åç»„æˆçš„å­—ç¬¦ä¸²æ•°ç»„ï¼Œç„¶åæ ¹æ®å®ƒä»¬çš„ç‰¹ç‚¹å¯¹å…ƒç´ è¿›è¡Œå…¥æ ˆå‡ºæ ˆç­‰æ“ä½œã€‚ 2.2 ä»£ç class Solution { public String simplifyPath(String path) { StringBuilder sb = new StringBuilder(); //å› ä¸ºæœ€åè¦éå†æ ˆï¼Œè¿™é‡Œç”¨ArrayListæ¥æ¨¡æ‹Ÿæ ˆ List&lt;String> stack = new ArrayList&lt;>(); String[] dirs = path.split(\"/\"); for(String i:dirs){ //ç©ºå­—ç¬¦ä¸²å’Œ\".\"éƒ½è¡¨ç¤ºå½“å‰ç›®å½• if(i.equals(\"\") || i.equals(\".\")) continue; //\"..\"è¡¨ç¤ºä¸Šä¸€çº§ç›®å½•ï¼Œå‡ºæ ˆä¸€ä¸ªå…ƒç´  if(i.equals(\"..\")){ if(stack.size()!=0) stack.remove(stack.size()-1); } //å…¶ä»–ç›®å½•åå…¥æ ˆ else stack.add(i); } if(stack.size()==0) return \"/\"; //é€šè¿‡\"/\"è¿æ¥èµ·æ¥ for(String i:stack){ sb.append(\"/\"); sb.append(i); } return sb.toString(); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode42-æ¥é›¨æ°´","slug":"leetcode42-æ¥é›¨æ°´","date":"2020-01-22T17:09:42.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode42-æ¥é›¨æ°´/","link":"","permalink":"https://www.codetool.top/article/leetcode42-%E6%8E%A5%E9%9B%A8%E6%B0%B4/","excerpt":"","text":"1 åŸé¢˜ç»™å®š n ä¸ªéè´Ÿæ•´æ•°è¡¨ç¤ºæ¯ä¸ªå®½åº¦ä¸º 1 çš„æŸ±å­çš„é«˜åº¦å›¾ï¼Œè®¡ç®—æŒ‰æ­¤æ’åˆ—çš„æŸ±å­ï¼Œä¸‹é›¨ä¹‹åèƒ½æ¥å¤šå°‘é›¨æ°´ã€‚ ä¸Šé¢æ˜¯ç”±æ•°ç»„ [0,1,0,2,1,0,1,3,2,1,2,1] è¡¨ç¤ºçš„é«˜åº¦å›¾ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æ¥ 6 ä¸ªå•ä½çš„é›¨æ°´ï¼ˆè“è‰²éƒ¨åˆ†è¡¨ç¤ºé›¨æ°´ï¼‰ã€‚ ç¤ºä¾‹ï¼š è¾“å…¥ï¼š [0,1,0,2,1,0,1,3,2,1,2,1]è¾“å‡ºï¼š 6 2 è§£æ³•2.1 æ€æƒ³æ¯ä¸€åˆ—èƒ½å­˜ä¸‹çš„é›¨æ°´å•ä½ç­‰äºå·¦å³æœ€é«˜ä¸¤åˆ—å½“ä¸­çš„è¾ƒçŸ®ä¸€åˆ—ä¸å½“å‰é«˜åº¦çš„é«˜åº¦å·®ã€‚ å¦‚å›¾ï¼Œç¬¬äº”åˆ—çš„ç§¯é›¨æ°´é‡ï¼Œç­‰äºå·¦è¾¹æœ€é«˜ä¸€åˆ—ï¼ˆç¬¬å››åˆ—leftï¼‰å’Œå³è¾¹æœ€é«˜ä¸€åˆ—ï¼ˆç¬¬å…«åˆ—rightï¼‰çš„è¾ƒçŸ®ä¸€åˆ—ï¼ˆleftï¼‰ä¸å½“å‰åˆ—é«˜åº¦çš„é«˜åº¦å·®ï¼ˆ2-1=1ï¼‰ å¦‚æœä¸¤è¾¹æœ‰ä¸€è¾¹æ²¡æœ‰æ¯”å½“å‰åˆ—é«˜çš„åˆ—ï¼Œåˆ™å½“å‰åˆ—ä¸ä¼šç§¯æ°´ã€‚ 2.2 ä»£ç æˆ‘ä¸€å¼€å§‹æ˜¯è¿™æ ·å†™çš„ï¼š class Solution { public int trap(int[] height) { int total = 0; int count = height.length; Integer[] left = new Integer[count]; Integer[] right = new Integer[count]; for(int i = 0;i&lt;count;i++){ for(int j = 1;j&lt;=i;j++){//æ›´æ–°å·¦è¾¹æ‰€æœ‰åˆ—çš„right if(right[j]==null||height[i]>right[j]) right[j] = height[i]; } for(int j = i;j&lt;count-1;j++){//æ›´æ–°å³è¾¹æ‰€æœ‰åˆ—çš„left if(left[j]==null||height[i]>left[j]) left[j] = height[i]; } } for(int i = 0;i&lt;count;i++){ if(left[i]==null || right[i] == null) continue; total += (Math.min(left[i],right[i])-height[i]); } return total; } } æ—¶é—´å¤æ‚åº¦è¾¾åˆ°äº†N2çº§åˆ«ï¼Œé‚£ä¹ˆå¦‚ä½•ä¼˜åŒ–å‘¢ï¼Ÿ ä¸å¿…ä½¿ç”¨nullæ¥è¡¨ç¤ºæ²¡æœ‰æ¯”å½“å‰åˆ—é«˜çš„åˆ—ï¼Œå³ä½¿ä¸¤åˆ—ç›¸ç­‰ï¼Œé«˜åº¦å·®ä¹Ÿæ˜¯0ï¼Œç›¸å½“äºä¸ç§¯æ°´ã€‚ åˆ©ç”¨åŠ¨æ€è§„åˆ’çš„æ€æƒ³ï¼Œå¦‚æœå‰ä¸€åˆ—çš„leftæ¯”å½“å‰åˆ—é«˜ï¼Œåˆ™å½“å‰åˆ—çš„leftä¹Ÿç­‰äºå‰ä¸€åˆ—çš„leftã€‚å¯¹äºrightä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ ä¼˜åŒ–åï¼š class Solution { public int trap(int[] height) { int total = 0; int count = height.length; if(count==0) return 0; Integer[] left = new Integer[count]; Integer[] right = new Integer[count]; left[0] = height[0]; right[count-1] = height[count-1]; for(int i = 1;i&lt;count;i++){//ä»å·¦å‘å³æ›´æ–°left if(height[i]>left[i-1]) left[i] = height[i]; else left[i] = left[i-1]; } for(int i = count-2;i>=0;i--){//ä»å³å‘å·¦æ›´æ–°right if(height[i]>right[i+1]) right[i] = height[i]; else right[i] = right[i+1]; } for(int i = 0;i&lt;count;i++){ total += (Math.min(left[i],right[i])-height[i]); } return total; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode95-ä¸åŒçš„äºŒå‰æœç´¢æ ‘II","slug":"leetcode95-ä¸åŒçš„äºŒå‰æœç´¢æ ‘II","date":"2020-01-22T15:12:01.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode95-ä¸åŒçš„äºŒå‰æœç´¢æ ‘II/","link":"","permalink":"https://www.codetool.top/article/leetcode95-%E4%B8%8D%E5%90%8C%E7%9A%84%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91II/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ•´æ•° nï¼Œæ±‚ä»¥ 1 â€¦ n ä¸ºèŠ‚ç‚¹ç»„æˆçš„äºŒå‰æœç´¢æ ‘æœ‰å¤šå°‘ç§ï¼Ÿ ç¤ºä¾‹: è¾“å…¥: 3è¾“å‡º:[&nbsp;&nbsp;[1,null,3,2],&nbsp;&nbsp;[3,2,null,1],&nbsp;&nbsp;[3,1,null,null,2],&nbsp;&nbsp;[2,1,3],&nbsp;&nbsp;[1,null,2,null,3]]è§£é‡Š:ä»¥ä¸Šçš„è¾“å‡ºå¯¹åº”ä»¥ä¸‹ 5 ç§ä¸åŒç»“æ„çš„äºŒå‰æœç´¢æ ‘ï¼š&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;\\ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;\\ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3 2 è§£æ³•2.1 æ€æƒ³è¿™é“é¢˜çš„æ€æƒ³å’Œleetcode96-ä¸åŒçš„äºŒå‰æœç´¢æ ‘ç±»ä¼¼ï¼Œé€šè¿‡å„ç§å·¦å³ç»„åˆæƒ…å†µå¾—åˆ°ä¸ºä¸€ä¸ªlistè¿”å›ã€‚ 2.2 ä»£ç class Solution { public List&lt;TreeNode> generateTrees(int n) { if(n==0) return new ArrayList&lt;TreeNode>(); return nodesInRange(1,n); } public List&lt;TreeNode> nodesInRange(int start,int end){ List&lt;TreeNode> list = new ArrayList&lt;>(); if(start>end){//è¿”å›ä¸€ä¸ªåŒ…å«nullçš„listä½¿å¾—foråµŒå¥—èƒ½æ­£å¸¸å·¥ä½œ list.add(null); return list; } if(start==end){//è¿”å›ä¸€ä¸ªåŒ…å«æœ¬æ•°å­—çš„list list.add(new TreeNode(start)); return list; } for(int i = start;i&lt;=end;i++){ //è‡ªç”±ç»„åˆå·¦å­æ ‘å’Œå³å­æ ‘çš„æƒ…å†µ for(TreeNode left:nodesInRange(start,i-1)){ for(TreeNode right:nodesInRange(i+1,end)){ TreeNode root = new TreeNode(i); root.left = left; root.right = right; list.add(root); } } } return list; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode96-ä¸åŒçš„äºŒå‰æœç´¢æ ‘","slug":"leetcode96-ä¸åŒçš„äºŒå‰æœç´¢æ ‘","date":"2020-01-22T14:15:52.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode96-ä¸åŒçš„äºŒå‰æœç´¢æ ‘/","link":"","permalink":"https://www.codetool.top/article/leetcode96-%E4%B8%8D%E5%90%8C%E7%9A%84%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ•´æ•° nï¼Œæ±‚ä»¥ 1 â€¦ n ä¸ºèŠ‚ç‚¹ç»„æˆçš„äºŒå‰æœç´¢æ ‘æœ‰å¤šå°‘ç§ï¼Ÿ ç¤ºä¾‹: è¾“å…¥: 3è¾“å‡º: 5è§£é‡Š: ç»™å®š n = 3, ä¸€å…±æœ‰ 5 ç§ä¸åŒç»“æ„çš„äºŒå‰æœç´¢æ ‘: &nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;\\ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;\\ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3 2 è§£æ³•2.1 æ€æƒ³å¯¹äºæ¯ä¸€ä¸ªnå¯¹åº”çš„æ•°é‡åº”è¯¥æ˜¯ç›¸åŒçš„ï¼Œæˆ‘ä»¬ä»1~nä¸­ä»»é€‰ä¸€ä¸ªåšæ ¹èŠ‚ç‚¹ï¼ˆå‡è®¾æ˜¯ç¬¬iä¸ªï¼‰ï¼Œé‚£ä¹ˆå·¦å³ä¸¤è¾¹å„æœ‰F(i-1)å’ŒF(n-i)ä¸­æƒ…å†µï¼Œå°†å®ƒä»¬ç›¸ä¹˜å°±æ˜¯æ­¤æ—¶ç¬¬iä¸ªå…ƒç´ åšæ ¹èŠ‚ç‚¹çš„æƒ…å†µã€‚å¦‚æ­¤é€’å½’è®¡ç®—æ€»æ•°é‡ã€‚ 2.2 ä»£ç æˆ‘ä¸€å¼€å§‹çš„å†™æ³•ï¼š class Solution { public int numTrees(int n) { return kindsCount(1,n); } public int kindsCount(int start,int end){ if(start >= end) return 1; int count = 0; for(int i = start;i&lt;=end;i++){ count += kindsCount(start,i-1)*kindsCount(i+1,end); } return count; } } ä½†æ˜¯å‘ç°è¿™æ ·å†™æ¶ˆè€—éå¸¸å¤šæ—¶é—´ï¼Œleetcodeæ‰§è¡Œç”¨æ—¶1700 msã€‚ ä¼˜åŒ–çš„æ€è·¯ä¸»è¦æ˜¯ï¼š endå’Œstartå¹¶ä¸å…³é”®ï¼Œåªè¦start-endï¼ˆå³èŒƒå›´å†…çš„æ•°å­—æ•°é‡,ç”¨nè¡¨ç¤ºï¼‰ç›¸åŒï¼Œå¯¹åº”çš„å€¼å°±ç›¸åŒã€‚ å‡å¦‚ä¼˜åŒ–ä¸Šæ¡ï¼Œå¾ˆå¤šF(n)å•å…ƒä¼šè¢«é‡å¤è®¡ç®—ï¼Œå¯ä»¥ä½¿ç”¨æ•°ç»„åšç¼“å­˜ã€‚ ä¼˜åŒ–åï¼š class Solution { Integer[] cache; public int numTrees(int n) { cache = new Integer[n+1]; return kindsCount(n); } public int kindsCount(int n){ if(n &lt;= 1) return 1; if(cache[n]!=null) return cache[n]; int count = 0; for(int i = 1;i&lt;=n;i++){ count += kindsCount(i-1)*kindsCount(n-i); } cache[n] = count; return count; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°08","slug":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°08","date":"2020-01-22T08:54:44.000Z","updated":"2020-04-22T09:27:27.192Z","comments":true,"path":"article/æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°08/","link":"","permalink":"https://www.codetool.top/article/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%AC%AC%E4%B8%89%E7%89%88%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B008/","excerpt":"","text":"ä»¥ä¸‹æ˜¯ç¬¬ä¸ƒç«  è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶çš„å†…å®¹ 1 æ¦‚è¿°Javaè™šæ‹ŸæœºæŠŠæè¿°ç±»çš„æ•°æ®ä»Classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒã€è½¬æ¢è§£æå’Œåˆå§‹åŒ–ï¼Œæœ€ç»ˆå½¢æˆå¯ä»¥è¢«è™šæ‹Ÿæœºç›´æ¥ä½¿ç”¨çš„Javaç±»å‹ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä½œè™šæ‹Ÿæœºçš„ç±»åŠ è½½æœºåˆ¶ã€‚åœ¨Javaè¯­è¨€é‡Œé¢ï¼Œç±»å‹çš„åŠ è½½ã€è¿æ¥å’Œåˆå§‹åŒ–è¿‡ç¨‹éƒ½æ˜¯åœ¨ç¨‹åºè¿è¡ŒæœŸé—´å®Œæˆçš„ï¼Œè¿™ç§ç­–ç•¥è®©Javaè¯­è¨€è¿›è¡Œæå‰ç¼–è¯‘ä¼šé¢ä¸´é¢å¤–çš„å›°éš¾ï¼Œä¹Ÿä¼šè®©ç±»åŠ è½½æ—¶ç¨å¾®å¢åŠ ä¸€äº›æ€§èƒ½å¼€é”€ï¼Œä½†æ˜¯å´ä¸ºJavaåº”ç”¨æä¾›äº†æé«˜çš„æ‰©å±•æ€§å’Œçµæ´»æ€§ã€‚ 2 ç±»åŠ è½½çš„æ—¶æœºä¸€ä¸ªç±»å‹ä»è¢«åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­å¼€å§‹ï¼Œåˆ°å¸è½½å‡ºå†…å­˜ä¸ºæ­¢ï¼Œå®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå°†ä¼šç»å†åŠ è½½ï¼ˆLoadingï¼‰ã€éªŒè¯ï¼ˆVerificationï¼‰ã€å‡†å¤‡ï¼ˆPreparationï¼‰ã€è§£æï¼ˆResolutionï¼‰ã€åˆå§‹åŒ–ï¼ˆInitializationï¼‰ã€ä½¿ç”¨ï¼ˆUsingï¼‰å’Œå¸è½½ï¼ˆUnloadingï¼‰ä¸ƒä¸ªé˜¶æ®µï¼Œå…¶ä¸­éªŒè¯ã€å‡†å¤‡ã€è§£æä¸‰ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºè¿æ¥ï¼ˆLinkingï¼‰ã€‚ åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€åˆå§‹åŒ–å’Œå¸è½½è¿™äº”ä¸ªé˜¶æ®µçš„é¡ºåºæ˜¯ç¡®å®šçš„ï¼Œç±»å‹çš„åŠ è½½è¿‡ç¨‹å¿…é¡»æŒ‰ç…§è¿™ç§é¡ºåºæŒ‰éƒ¨å°±ç­åœ°å¼€å§‹ï¼Œè€Œè§£æé˜¶æ®µåˆ™ä¸ä¸€å®šï¼šå®ƒåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥åœ¨åˆå§‹åŒ–é˜¶æ®µä¹‹åå†å¼€å§‹ï¼Œè¿™æ˜¯ä¸ºäº†æ”¯æŒJavaè¯­è¨€çš„è¿è¡Œæ—¶ç»‘å®šç‰¹æ€§ã€‚ åŠ è½½é˜¶æ®µå¹¶æ²¡æœ‰ä¸¥æ ¼è§„å®šå¼€å§‹çš„æ—¶æœºï¼Œè€Œæœ‰ä¸”åªæœ‰å…­ç§æƒ…å†µå¿…é¡»ç«‹å³å¯¹ç±»è¿›è¡Œâ€œåˆå§‹åŒ–â€ï¼š é‡åˆ°newã€getstaticã€putstaticæˆ–invokestaticè¿™å››æ¡å­—èŠ‚ç æŒ‡ä»¤ ä½¿ç”¨java.lang.reflectåŒ…çš„æ–¹æ³•å¯¹ç±»å‹è¿›è¡Œåå°„è°ƒç”¨ å½“åˆå§‹åŒ–ç±»çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°å…¶çˆ¶ç±»è¿˜æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚ å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼ˆåŒ…å«main()æ–¹æ³•çš„é‚£ä¸ªç±»ï¼‰ï¼Œè™šæ‹Ÿæœºä¼šå…ˆåˆå§‹åŒ–è¿™ä¸ªä¸»ç±»ã€‚ å½“ä½¿ç”¨JDK 7æ–°åŠ å…¥çš„åŠ¨æ€è¯­è¨€æ”¯æŒæ—¶ï¼Œå¦‚æœä¸€ä¸ªjava.lang.invoke.MethodHandleå®ä¾‹æœ€åçš„è§£æç»“æœä¸ºREF_getStaticã€REF_putStaticã€REF_invokeStaticã€REF_newInvokeSpecialå››ç§ç±»å‹çš„æ–¹æ³•å¥æŸ„ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•å¥æŸ„å¯¹åº”çš„ç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚ å½“ä¸€ä¸ªæ¥å£ä¸­å®šä¹‰äº†JDK 8æ–°åŠ å…¥çš„é»˜è®¤æ–¹æ³•ï¼ˆè¢«defaultå…³é”®å­—ä¿®é¥°çš„æ¥å£æ–¹æ³•ï¼‰æ—¶ï¼Œå¦‚æœæœ‰è¿™ä¸ªæ¥å£çš„å®ç°ç±»å‘ç”Ÿäº†åˆå§‹åŒ–ï¼Œé‚£è¯¥æ¥å£è¦åœ¨å…¶ä¹‹å‰è¢«åˆå§‹åŒ–ã€‚ è¿™å…­ç§æ“ä½œç§°ä¸ºä¸»åŠ¨å¼•ç”¨ï¼Œå…¶ä»–å¼•ç”¨ç§°ä¸ºè¢«åŠ¨å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘åˆå§‹åŒ–ã€‚ æ¥å£çš„åˆå§‹åŒ–ç¨æœ‰ä¸åŒï¼šå¯¹äºç¬¬ä¸‰ç‚¹ï¼Œæ¥å£åªæœ‰çœŸæ­£ç”¨åˆ°çˆ¶æ¥å£çš„æ—¶å€™æ‰ä¼šä½¿çˆ¶æ¥å£åˆå§‹åŒ–ã€‚ 3 ç±»åŠ è½½çš„è¿‡ç¨‹3.1 åŠ è½½åœ¨åŠ è½½é˜¶æ®µï¼ŒJavaè™šæ‹Ÿæœºéœ€è¦å®Œæˆä»¥ä¸‹ä¸‰ä»¶äº‹æƒ…ï¼š é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚ å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚ åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£ã€‚ å…¶ä¸­ç¬¬ä¸€æ­¥è‡ªç”±åº¦å°±å¾ˆé«˜ï¼Œä»ZIPå‹ç¼©åŒ…ä¸­è¯»å–ã€ä»ç½‘ç»œä¸­è·å–ã€è¿è¡Œæ—¶è®¡ç®—ç”Ÿæˆç­‰ç­‰ã€‚ åŠ è½½é˜¶æ®µæ—¢å¯ä»¥ä½¿ç”¨Javaè™šæ‹Ÿæœºé‡Œå†…ç½®çš„å¼•å¯¼ç±»åŠ è½½å™¨æ¥å®Œæˆï¼Œä¹Ÿå¯ä»¥ç”±ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨å»å®Œæˆï¼Œå¼€å‘äººå‘˜é€šè¿‡å®šä¹‰è‡ªå·±çš„ç±»åŠ è½½å™¨å»æ§åˆ¶å­—èŠ‚æµçš„è·å–æ–¹å¼ï¼ˆé‡å†™ä¸€ä¸ªç±»åŠ è½½å™¨çš„findClass()æˆ–loadClass()æ–¹æ³•ï¼‰ï¼Œå®ç°æ ¹æ®è‡ªå·±çš„æƒ³æ³•æ¥èµ‹äºˆåº”ç”¨ç¨‹åºè·å–è¿è¡Œä»£ç çš„åŠ¨æ€æ€§ã€‚ æ•°ç»„ç±»æœ¬èº«ä¸é€šè¿‡ç±»åŠ è½½å™¨åˆ›å»ºï¼Œå®ƒæ˜¯ç”±Javaè™šæ‹Ÿæœºç›´æ¥åœ¨å†…å­˜ä¸­åŠ¨æ€æ„é€ å‡ºæ¥çš„ã€‚ä½†æ•°ç»„ç±»ä¸ç±»åŠ è½½å™¨ä»ç„¶æœ‰å¾ˆå¯†åˆ‡çš„å…³ç³»ï¼Œå› ä¸ºæ•°ç»„ç±»çš„å…ƒç´ ç±»å‹ï¼ˆæŒ‡çš„æ˜¯æ•°ç»„å»æ‰æ‰€æœ‰ç»´åº¦çš„ç±»å‹ï¼‰æœ€ç»ˆè¿˜æ˜¯è¦é ç±»åŠ è½½å™¨æ¥å®ŒæˆåŠ è½½ï¼Œä¸€ä¸ªæ•°ç»„ç±»ï¼ˆä¸‹é¢ç®€ç§°ä¸ºCï¼‰åˆ›å»ºè¿‡ç¨‹éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š å¦‚æœæ•°ç»„çš„ç»„ä»¶ç±»å‹ï¼ˆæŒ‡çš„æ˜¯æ•°ç»„å»æ‰ä¸€ä¸ªç»´åº¦çš„ç±»å‹ï¼‰æ˜¯å¼•ç”¨ç±»å‹ï¼Œé‚£å°±é€’å½’é‡‡ç”¨æœ¬èŠ‚ä¸­å®šä¹‰çš„åŠ è½½è¿‡ç¨‹å»åŠ è½½è¿™ä¸ªç»„ä»¶ç±»å‹ï¼Œæ•°ç»„Cå°†è¢«æ ‡è¯†åœ¨åŠ è½½è¯¥ç»„ä»¶ç±»å‹çš„ç±»åŠ è½½å™¨çš„ç±»åç§°ç©ºé—´ä¸Šã€‚ å¦‚æœæ•°ç»„çš„ç»„ä»¶ç±»å‹ä¸æ˜¯å¼•ç”¨ç±»å‹ï¼ˆä¾‹å¦‚int[]æ•°ç»„çš„ç»„ä»¶ç±»å‹ä¸ºintï¼‰ï¼ŒJavaè™šæ‹Ÿæœºå°†ä¼šæŠŠæ•°ç»„Cæ ‡è®°ä¸ºä¸å¼•å¯¼ç±»åŠ è½½å™¨å…³è”ã€‚ æ•°ç»„ç±»çš„å¯è®¿é—®æ€§ä¸å®ƒçš„ç»„ä»¶ç±»å‹çš„å¯è®¿é—®æ€§ä¸€è‡´ï¼Œå¦‚æœç»„ä»¶ç±»å‹ä¸æ˜¯å¼•ç”¨ç±»å‹ï¼Œå®ƒçš„æ•°ç»„ç±»çš„å¯è®¿é—®æ€§å°†é»˜è®¤ä¸ºpublicï¼Œå¯è¢«æ‰€æœ‰çš„ç±»å’Œæ¥å£è®¿é—®åˆ°ã€‚ åŠ è½½é˜¶æ®µä¸è¿æ¥é˜¶æ®µçš„éƒ¨åˆ†åŠ¨ä½œï¼ˆå¦‚ä¸€éƒ¨åˆ†å­—èŠ‚ç æ–‡ä»¶æ ¼å¼éªŒè¯åŠ¨ä½œï¼‰æ˜¯äº¤å‰è¿›è¡Œçš„ï¼Œä½†åŠ è½½é˜¶æ®µæå‰å¼€å§‹äºè¿æ¥é˜¶æ®µã€‚ 3.2 éªŒè¯è¿™ä¸€é˜¶æ®µçš„ç›®çš„æ˜¯ç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹çš„å…¨éƒ¨çº¦æŸè¦æ±‚ï¼Œä¿è¯è¿™äº›ä¿¡æ¯è¢«å½“ä½œä»£ç è¿è¡Œåä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚ å°½ç®¡Javaä»£ç ç¼–è¯‘æ—¶ä¼šæ‹’ç»ç¼–è¯‘ä¸€äº›è‡´å‘½é”™è¯¯ï¼Œä½†å­—èŠ‚ç å¯ä»¥è¢«è½»æ˜“ä¿®æ”¹ï¼Œå­—èŠ‚ç æ£€æŸ¥ä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„ã€‚ 3.2.1 æ–‡ä»¶æ ¼å¼éªŒè¯ æ˜¯å¦ä»¥é­”æ•°0xCAFEBABEå¼€å¤´ã€‚ ä¸»ã€æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰Javaè™šæ‹Ÿæœºæ¥å—èŒƒå›´ä¹‹å†…ã€‚ å¸¸é‡æ± çš„å¸¸é‡ä¸­æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒçš„å¸¸é‡ç±»å‹ï¼ˆæ£€æŸ¥å¸¸é‡tagæ ‡å¿—ï¼‰ã€‚ æŒ‡å‘å¸¸é‡çš„å„ç§ç´¢å¼•å€¼ä¸­æ˜¯å¦æœ‰æŒ‡å‘ä¸å­˜åœ¨çš„å¸¸é‡æˆ–ä¸ç¬¦åˆç±»å‹çš„å¸¸é‡ã€‚ CONSTANT_Utf8_infoå‹çš„å¸¸é‡ä¸­æ˜¯å¦æœ‰ä¸ç¬¦åˆUTF-8ç¼–ç çš„æ•°æ®ã€‚ Classæ–‡ä»¶ä¸­å„ä¸ªéƒ¨åˆ†åŠæ–‡ä»¶æœ¬èº«æ˜¯å¦æœ‰è¢«åˆ é™¤çš„æˆ–é™„åŠ çš„å…¶ä»–ä¿¡æ¯ã€‚ â€¦â€¦ è¯¥éªŒè¯é˜¶æ®µçš„ä¸»è¦ç›®çš„æ˜¯ä¿è¯è¾“å…¥çš„å­—èŠ‚æµèƒ½æ­£ç¡®åœ°è§£æå¹¶å­˜å‚¨äºæ–¹æ³•åŒºä¹‹å†…ï¼Œæ ¼å¼ä¸Šç¬¦åˆæè¿°ä¸€ä¸ªJavaç±»å‹ä¿¡æ¯çš„è¦æ±‚ã€‚è¿™é˜¶æ®µçš„éªŒè¯æ˜¯åŸºäºäºŒè¿›åˆ¶å­—èŠ‚æµè¿›è¡Œçš„ï¼Œåªæœ‰é€šè¿‡äº†è¿™ä¸ªé˜¶æ®µçš„éªŒè¯ä¹‹åï¼Œè¿™æ®µå­—èŠ‚æµæ‰è¢«å…è®¸è¿›å…¥Javaè™šæ‹Ÿæœºå†…å­˜çš„æ–¹æ³•åŒºä¸­è¿›è¡Œå­˜å‚¨ã€‚ 3.2.2 å…ƒæ•°æ®éªŒè¯ è¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»ï¼ˆé™¤äº†java.lang.Objectä¹‹å¤–ï¼Œæ‰€æœ‰çš„ç±»éƒ½åº”å½“æœ‰çˆ¶ç±»ï¼‰ã€‚ è¿™ä¸ªç±»çš„çˆ¶ç±»æ˜¯å¦ç»§æ‰¿äº†ä¸å…è®¸è¢«ç»§æ‰¿çš„ç±»ï¼ˆè¢«finalä¿®é¥°çš„ç±»ï¼‰ã€‚ å¦‚æœè¿™ä¸ªç±»ä¸æ˜¯æŠ½è±¡ç±»ï¼Œæ˜¯å¦å®ç°äº†å…¶çˆ¶ç±»æˆ–æ¥å£ä¹‹ä¸­è¦æ±‚å®ç°çš„æ‰€æœ‰æ–¹æ³•ã€‚ ç±»ä¸­çš„å­—æ®µã€æ–¹æ³•æ˜¯å¦ä¸çˆ¶ç±»äº§ç”ŸçŸ›ç›¾ï¼ˆä¾‹å¦‚è¦†ç›–äº†çˆ¶ç±»çš„finalå­—æ®µï¼Œæˆ–è€…å‡ºç°ä¸ç¬¦åˆè§„åˆ™çš„æ–¹æ³•é‡è½½ï¼Œä¾‹å¦‚æ–¹æ³•å‚æ•°éƒ½ä¸€è‡´ï¼Œä½†è¿”å›å€¼ç±»å‹å´ä¸åŒç­‰ï¼‰ã€‚ â€¦â€¦ ç¬¬äºŒé˜¶æ®µçš„ä¸»è¦ç›®çš„æ˜¯å¯¹ç±»çš„å…ƒæ•°æ®ä¿¡æ¯è¿›è¡Œè¯­ä¹‰æ ¡éªŒï¼Œä¿è¯ä¸å­˜åœ¨ä¸ã€ŠJavaè¯­è¨€è§„èŒƒã€‹å®šä¹‰ç›¸æ‚–çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚ 3.2.3 å­—èŠ‚ç éªŒè¯ ä¿è¯ä»»æ„æ—¶åˆ»æ“ä½œæ•°æ ˆçš„æ•°æ®ç±»å‹ä¸æŒ‡ä»¤ä»£ç åºåˆ—éƒ½èƒ½é…åˆå·¥ä½œï¼Œä¾‹å¦‚ä¸ä¼šå‡ºç°ç±»ä¼¼äºâ€œåœ¨æ“ä½œæ ˆæ”¾ç½®äº†ä¸€ä¸ªintç±»å‹çš„æ•°æ®ï¼Œä½¿ç”¨æ—¶å´æŒ‰longç±»å‹æ¥åŠ è½½å…¥æœ¬åœ°å˜é‡è¡¨ä¸­â€è¿™æ ·çš„æƒ…å†µã€‚ ä¿è¯ä»»ä½•è·³è½¬æŒ‡ä»¤éƒ½ä¸ä¼šè·³è½¬åˆ°æ–¹æ³•ä½“ä»¥å¤–çš„å­—èŠ‚ç æŒ‡ä»¤ä¸Šã€‚ ä¿è¯æ–¹æ³•ä½“ä¸­çš„ç±»å‹è½¬æ¢æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œä¾‹å¦‚å¯ä»¥æŠŠä¸€ä¸ªå­ç±»å¯¹è±¡èµ‹å€¼ç»™çˆ¶ç±»æ•°æ®ç±»å‹ï¼Œè¿™æ˜¯å®‰å…¨çš„ï¼Œä½†æ˜¯æŠŠçˆ¶ç±»å¯¹è±¡èµ‹å€¼ç»™å­ç±»æ•°æ®ç±»å‹ï¼Œç”šè‡³æŠŠå¯¹è±¡èµ‹å€¼ç»™ä¸å®ƒæ¯«æ— ç»§æ‰¿å…³ç³»ã€å®Œå…¨ä¸ç›¸å¹²çš„ä¸€ä¸ªæ•°æ®ç±»å‹ï¼Œåˆ™æ˜¯å±é™©å’Œä¸åˆæ³•çš„ã€‚ ç›®çš„æ˜¯é€šè¿‡æ•°æ®æµåˆ†æå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„ï¼Œä¸ä¼šå±å®³è™šæ‹Ÿæœºå®‰å…¨ã€‚ 3.2.4 ç¬¦å·å¼•ç”¨éªŒè¯æœ€åä¸€ä¸ªé˜¶æ®µçš„æ ¡éªŒè¡Œä¸ºå‘ç”Ÿåœ¨è™šæ‹Ÿæœºå°†ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨çš„æ—¶å€™ï¼Œè¿™ä¸ªè½¬åŒ–åŠ¨ä½œåœ¨è§£æé˜¶æ®µä¸­å‘ç”Ÿã€‚ç¬¦å·å¼•ç”¨éªŒè¯å¯ä»¥çœ‹ä½œæ˜¯å¯¹ç±»è‡ªèº«ä»¥å¤–ï¼ˆå¸¸é‡æ± ä¸­çš„å„ç§ç¬¦å·å¼•ç”¨ï¼‰çš„å„ç±»ä¿¡æ¯è¿›è¡ŒåŒ¹é…æ€§æ ¡éªŒï¼Œé€šä¿—æ¥è¯´å°±æ˜¯ï¼Œè¯¥ç±»æ˜¯å¦ç¼ºå°‘æˆ–è€…è¢«ç¦æ­¢è®¿é—®å®ƒä¾èµ–çš„æŸäº›å¤–éƒ¨ç±»ã€æ–¹æ³•ã€å­—æ®µç­‰èµ„æºã€‚ ç¬¦å·å¼•ç”¨ä¸­é€šè¿‡å­—ç¬¦ä¸²æè¿°çš„å…¨é™å®šåæ˜¯å¦èƒ½æ‰¾åˆ°å¯¹åº”çš„ç±»ã€‚ åœ¨æŒ‡å®šç±»ä¸­æ˜¯å¦å­˜åœ¨ç¬¦åˆæ–¹æ³•çš„å­—æ®µæè¿°ç¬¦åŠç®€å•åç§°æ‰€æè¿°çš„æ–¹æ³•å’Œå­—æ®µã€‚ ç¬¦å·å¼•ç”¨ä¸­çš„ç±»ã€å­—æ®µã€æ–¹æ³•çš„å¯è®¿é—®æ€§ï¼ˆprivateã€protectedã€publicã€&lt;package&gt;ï¼‰æ˜¯å¦å¯è¢«å½“å‰ç±»è®¿é—®ã€‚ â€¦â€¦ ç¬¦å·å¼•ç”¨éªŒè¯çš„ä¸»è¦ç›®çš„æ˜¯ç¡®ä¿è§£æè¡Œä¸ºèƒ½æ­£å¸¸æ‰§è¡Œï¼Œå¦‚æœæ— æ³•é€šè¿‡ç¬¦å·å¼•ç”¨éªŒè¯ï¼ŒJavaè™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ªjava.lang.IncompatibleClassChangeErrorçš„å­ç±»å¼‚å¸¸ï¼Œå…¸å‹çš„å¦‚ï¼šjava.lang.IllegalAccessErrorã€java.lang.NoSuchFieldErrorã€java.lang.NoSuchMethodErrorç­‰ã€‚ éªŒè¯é˜¶æ®µä¸æ˜¯å¿…éœ€çš„ï¼Œå¦‚æœç¨‹åºè¿è¡Œä½¿ç”¨çš„æ‰€æœ‰å­—èŠ‚ç éƒ½æ˜¯å®‰å…¨çš„ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨-Xverifyï¼šnoneå‚æ•°æ¥å…³é—­å¤§éƒ¨åˆ†çš„ç±»éªŒè¯æªæ–½ï¼Œä»¥ç¼©çŸ­è™šæ‹Ÿæœºç±»åŠ è½½çš„æ—¶é—´ã€‚ 3.3 å‡†å¤‡å‡†å¤‡é˜¶æ®µæ˜¯æ­£å¼ä¸ºç±»ä¸­å®šä¹‰çš„å˜é‡ï¼ˆå³é™æ€å˜é‡ï¼Œè¢«staticä¿®é¥°çš„å˜é‡ï¼‰åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼çš„é˜¶æ®µã€‚ï¼ˆåˆå§‹å€¼æŒ‡çš„æ˜¯é›¶å€¼ï¼Œç±»åˆå§‹åŒ–é˜¶æ®µä¸­è°ƒç”¨ç±»æ„é€ å™¨æ–¹æ³•æ‰ä¼šå¯¹ç±»å˜é‡èµ‹å€¼ï¼‰ ç‰¹æ®Šæƒ…å†µï¼šå¦‚æœå­—æ®µå­˜åœ¨ConstantValueå±æ€§ï¼ˆå£°æ˜ä¸ºfinalï¼Œä¼šåœ¨å­—æ®µè¡¨çš„å±æ€§è¡¨ä¸­å¢åŠ ä¸€é¡¹ConstantValueå±æ€§ï¼‰ï¼Œé‚£åœ¨å‡†å¤‡é˜¶æ®µå˜é‡å€¼å°±ä¼šè¢«åˆå§‹åŒ–ä¸ºConstantValueå±æ€§æ‰€æŒ‡å®šçš„åˆå§‹å€¼ã€‚ 3.4 è§£æè§£æé˜¶æ®µæ˜¯Javaè™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚ ç›´æ¥å¼•ç”¨æ˜¯å¯ä»¥ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–è€…æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚ç›´æ¥å¼•ç”¨æ˜¯å’Œè™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€ç›´æ¥ç›¸å…³çš„ï¼ŒåŒä¸€ä¸ªç¬¦å·å¼•ç”¨åœ¨ä¸åŒè™šæ‹Ÿæœºå®ä¾‹ä¸Šç¿»è¯‘å‡ºæ¥çš„ç›´æ¥å¼•ç”¨ä¸€èˆ¬ä¸ä¼šç›¸åŒã€‚å¦‚æœæœ‰äº†ç›´æ¥å¼•ç”¨ï¼Œé‚£å¼•ç”¨çš„ç›®æ ‡å¿…å®šå·²ç»åœ¨è™šæ‹Ÿæœºçš„å†…å­˜ä¸­å­˜åœ¨ã€‚ è€Œç¬¦å·å¼•ç”¨åªæ˜¯èƒ½æ— æ­§ä¹‰å®šä½åˆ°ç›®æ ‡çš„ä¸€å¥—è‡ªå®šç¬¦å·è¡¨è¿°ã€‚ è§£æé˜¶æ®µå‘ç”Ÿçš„å…·ä½“æ—¶é—´å¹¶æœªå¼ºåˆ¶è§„å®šï¼Œåªè¦æ±‚äº†åœ¨æ‰§è¡Œane-warrayã€checkcastã€getfieldã€getstaticã€instanceofã€invokedynamicã€invokeinterfaceã€invoke-specialã€invokestaticã€invokevirtualã€ldcã€ldc_wã€ldc2_wã€multianewarrayã€newã€putfieldå’Œputstaticè¿™17ä¸ªç”¨äºæ“ä½œç¬¦å·å¼•ç”¨çš„å­—èŠ‚ç æŒ‡ä»¤ä¹‹å‰ï¼Œå…ˆå¯¹å®ƒä»¬æ‰€ä½¿ç”¨çš„ç¬¦å·å¼•ç”¨è¿›è¡Œè§£æã€‚ å¯¹åŒä¸€ä¸ªç¬¦å·å¼•ç”¨å¯ä»¥è¿›è¡Œå¤šæ¬¡è§£æè¯·æ±‚ï¼Œè™šæ‹Ÿæœºä¹Ÿå¯ä»¥ç¼“å­˜è§£æçš„ç»“æœï¼Œä½†å¯¹äºinvokedynamicæŒ‡ä»¤ä¸èƒ½ç¼“å­˜ï¼Œæ‰§è¡Œåˆ°è¯¥æ¡æŒ‡ä»¤æ—¶æ‰èƒ½è§£æï¼Œå®ƒå¯¹åº”çš„å¼•ç”¨ç§°ä¸ºâ€œåŠ¨æ€è°ƒç”¨ç‚¹é™å®šç¬¦â€ã€‚ invokedynamicæœ¬æ˜¯ä¸ºäº†æ”¯æŒå¦‚JRubyã€ Scalaç­‰åŠ¨æ€è¯­è¨€ï¼ŒJDK8åLambdaè¡¨è¾¾å¼å’Œæ¥å£çš„é»˜è®¤æ–¹æ³•çš„åº•å±‚ä¹Ÿä¼šç”¨åˆ°invokedynamicã€‚ 3.4.1 ç±»æˆ–æ¥å£çš„è§£æå°†ç¬¦å·ä»£è¡¨çš„ç±»çš„å…¨é™å®šåäº¤ç»™å½“å‰ç±»çš„ç±»åŠ è½½å™¨æ¥åŠ è½½ï¼Œå¦‚æœæ˜¯æ•°ç»„ç±»å‹ï¼Œåˆ™æ˜¯åŠ è½½å®ƒçš„æ•°ç»„å…ƒç´ ç±»å‹ï¼Œå†ç”±è™šæ‹Ÿæœºç”Ÿæˆå¯¹åº”çš„æ•°ç»„ç±»å‹ã€‚ ä¹‹åï¼ŒéªŒè¯å½“å‰ç±»æ˜¯å¦å…·æœ‰å¯¹è¯¥ç±»çš„è®¿é—®æƒé™ï¼Œè‹¥æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸java.lang.IllegalAccessError 3.4.2 å­—æ®µè§£æè¦è§£æä¸€ä¸ªæœªè¢«è§£æè¿‡çš„å­—æ®µç¬¦å·å¼•ç”¨ï¼Œä¼šå…ˆæ‰¾åˆ°å­—æ®µè¡¨ä¸­å¯¹åº”çš„æ‰€å±ç±»å¹¶è§£æã€‚ å¦‚æœè¯¥ç±»æœ¬èº«å°±åŒ…å«äº†ç®€å•åç§°å’Œå­—æ®µæè¿°ç¬¦éƒ½ä¸ç›®æ ‡ç›¸åŒ¹é…çš„å­—æ®µï¼Œåˆ™è¿”å›è¿™ä¸ªå­—æ®µçš„ç›´æ¥å¼•ç”¨ï¼ŒæŸ¥æ‰¾ç»“æŸã€‚ å¦åˆ™ï¼Œå¦‚æœè¯¥ç±»å®ç°äº†æ¥å£ï¼Œå°†ä¼šæŒ‰ç…§ç»§æ‰¿å…³ç³»ä»ä¸‹å¾€ä¸Šé€’å½’æœç´¢å„ä¸ªæ¥å£å’Œå®ƒçš„çˆ¶æ¥å£ï¼Œå¦‚æœæ¥å£ä¸­åŒ…å«äº†ç®€å•åç§°å’Œå­—æ®µæè¿°ç¬¦éƒ½ä¸ç›®æ ‡ç›¸åŒ¹é…çš„å­—æ®µï¼Œåˆ™è¿”å›è¿™ä¸ªå­—æ®µçš„ç›´æ¥å¼•ç”¨ï¼ŒæŸ¥æ‰¾ç»“æŸã€‚ å¦åˆ™ã€‚å¦‚æœè¯¥ç±»ä¸æ˜¯java.lang.Objectçš„è¯ï¼Œå°†ä¼šæŒ‰ç…§ç»§æ‰¿å…³ç³»ä»ä¸‹å¾€ä¸Šé€’å½’æœç´¢å…¶çˆ¶ç±»ï¼Œå¦‚æœåœ¨çˆ¶ç±»ä¸­åŒ…å«äº†ç®€å•åç§°å’Œå­—æ®µæè¿°ç¬¦éƒ½ä¸ç›®æ ‡ç›¸åŒ¹é…çš„å­—æ®µï¼Œåˆ™è¿”å›è¿™ä¸ªå­—æ®µçš„ç›´æ¥å¼•ç”¨ï¼ŒæŸ¥æ‰¾ç»“æŸã€‚ å¦åˆ™ï¼ŒæŸ¥æ‰¾å¤±è´¥ï¼ŒæŠ›å‡ºjava.lang.NoSuchFieldErrorå¼‚å¸¸ã€‚ å¦‚æœæŸ¥æ‰¾è¿‡ç¨‹æˆåŠŸè¿”å›äº†å¼•ç”¨ï¼Œå°†ä¼šå¯¹è¿™ä¸ªå­—æ®µè¿›è¡Œæƒé™éªŒè¯ï¼Œå¦‚æœå‘ç°ä¸å…·å¤‡å¯¹å­—æ®µçš„è®¿é—®æƒé™ï¼Œå°†æŠ›å‡ºjava.lang.IllegalAccessErrorå¼‚å¸¸ã€‚ å¦‚æœä¸€ä¸ªå­—æ®µå…·æœ‰å¤šä¹‰æ€§ï¼ˆå¦‚æœä¸ä¸¥æ ¼æŒ‰ç…§é¡ºåºå¯èƒ½å¤šç§æ–¹å¼éƒ½èƒ½æ‰¾åˆ°ï¼‰ï¼Œjavacå¯èƒ½ä¼šæ‹’ç»ç¼–è¯‘ã€‚ 3.4.3 æ–¹æ³•è§£ææ–¹æ³•è§£æä¹Ÿä¼šå…ˆæ‰¾åˆ°æ–¹æ³•è¡¨ä¸­å¯¹åº”çš„æ‰€å±ç±»å¹¶è§£æã€‚ ç±»çš„æ–¹æ³•å’Œæ¥å£çš„æ–¹æ³•ç¬¦å·å¼•ç”¨çš„å¸¸é‡ç±»å‹å®šä¹‰æ˜¯åˆ†å¼€çš„ï¼Œå¦‚æœå‘ç°è¯¥ç±»æ˜¯ä¸ªæ¥å£çš„è¯ï¼Œé‚£å°±ç›´æ¥æŠ›å‡ºjava.lang.IncompatibleClassChangeError å¼‚å¸¸ã€‚ å¦‚æœé€šè¿‡äº†ç¬¬ä¸€æ­¥ï¼Œåœ¨è¯¥ç±»ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰ç®€å•åç§°å’Œæè¿°ç¬¦éƒ½ä¸ç›®æ ‡ç›¸åŒ¹é…çš„æ–¹æ³•ï¼Œå¦‚æœæœ‰åˆ™è¿”å›è¿™ä¸ªæ–¹æ³•çš„ç›´æ¥å¼•ç”¨ï¼ŒæŸ¥æ‰¾ç»“æŸã€‚ å¦åˆ™ï¼Œåœ¨è¯¥ç±»çš„çˆ¶ç±»ä¸­é€’å½’æŸ¥æ‰¾æ˜¯å¦æœ‰ç®€å•åç§°å’Œæè¿°ç¬¦éƒ½ä¸ç›®æ ‡ç›¸åŒ¹é…çš„æ–¹æ³•ï¼Œå¦‚æœæœ‰åˆ™è¿”å›è¿™ä¸ªæ–¹æ³•çš„ç›´æ¥å¼•ç”¨ï¼ŒæŸ¥æ‰¾ç»“æŸã€‚ å¦åˆ™ï¼Œåœ¨è¯¥ç±»å®ç°çš„æ¥å£åˆ—è¡¨åŠå®ƒä»¬çš„çˆ¶æ¥å£ä¹‹ä¸­é€’å½’æŸ¥æ‰¾æ˜¯å¦æœ‰ç®€å•åç§°å’Œæè¿°ç¬¦éƒ½ä¸ç›®æ ‡ç›¸åŒ¹é…çš„æ–¹æ³•ï¼Œå¦‚æœå­˜åœ¨åŒ¹é…çš„æ–¹æ³•ï¼Œè¯´æ˜è¯¥ç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè¿™æ—¶å€™æŸ¥æ‰¾ç»“æŸï¼ŒæŠ›å‡º java.lang.AbstractMethodErrorå¼‚å¸¸ã€‚ å¦åˆ™ï¼Œå®£å‘Šæ–¹æ³•æŸ¥æ‰¾å¤±è´¥ï¼ŒæŠ›å‡ºjava.lang.NoSuchMethodErrorã€‚ æœ€åï¼Œå¦‚æœæŸ¥æ‰¾è¿‡ç¨‹æˆåŠŸè¿”å›äº†ç›´æ¥å¼•ç”¨ï¼Œå°†ä¼šå¯¹è¿™ä¸ªæ–¹æ³•è¿›è¡Œæƒé™éªŒè¯ï¼Œå¦‚æœå‘ç°ä¸å…·å¤‡å¯¹æ­¤æ–¹æ³•çš„è®¿é—®æƒé™ï¼Œå°†æŠ›å‡ºjava.lang.IllegalAccessErrorå¼‚å¸¸ã€‚ 3.4.4 æ¥å£æ–¹æ³•è§£ææ¥å£æ–¹æ³•è§£æä¹Ÿä¼šå…ˆæ‰¾åˆ°æ–¹æ³•è¡¨ä¸­å¯¹åº”çš„æ‰€å±ç±»å¹¶è§£æã€‚ ä¸ç±»çš„æ–¹æ³•è§£æç›¸åï¼Œå¦‚æœå‘ç°è¯¥ç±»æ˜¯ä¸ªç±»è€Œä¸æ˜¯æ¥å£ï¼Œé‚£ä¹ˆå°±ç›´æ¥æŠ›å‡ºjava.lang.IncompatibleClassChangeErrorå¼‚å¸¸ã€‚ å¦åˆ™ï¼Œåœ¨è¯¥æ¥å£ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰ç®€å•åç§°å’Œæè¿°ç¬¦éƒ½ä¸ç›®æ ‡ç›¸åŒ¹é…çš„æ–¹æ³•ï¼Œå¦‚æœæœ‰åˆ™è¿”å›è¿™ä¸ªæ–¹æ³•çš„ç›´æ¥å¼•ç”¨ï¼ŒæŸ¥æ‰¾ç»“æŸã€‚ å¦åˆ™ï¼Œåœ¨è¯¥æ¥å£çš„çˆ¶æ¥å£ä¸­é€’å½’æŸ¥æ‰¾ï¼Œç›´åˆ°java.lang.Objectç±»ï¼ˆæ¥å£æ–¹æ³•çš„æŸ¥æ‰¾èŒƒå›´ä¹Ÿä¼šåŒ…æ‹¬Objectç±»ä¸­çš„æ–¹æ³•ï¼‰ä¸ºæ­¢ï¼Œçœ‹æ˜¯å¦æœ‰ç®€å•åç§°å’Œæè¿°ç¬¦éƒ½ä¸ç›®æ ‡ç›¸åŒ¹é…çš„æ–¹æ³•ï¼Œå¦‚æœæœ‰åˆ™è¿”å›è¿™ä¸ªæ–¹æ³•çš„ç›´æ¥å¼•ç”¨ï¼ŒæŸ¥æ‰¾ç»“æŸã€‚ å¦‚æœå¤šé‡ç»§æ‰¿å¤šä¸ªçˆ¶æ¥å£éƒ½æœ‰è¯¥æ–¹æ³•ï¼Œå¯èƒ½ä¼šè¿”å›å…¶ä¸­ä¸€ä¸ªæ–¹æ³•çš„ç›´æ¥å¼•ç”¨ï¼Œåœ¨ç¼–è¯‘æœŸé—´javacä¹Ÿå¯èƒ½æ‹’ç»ç¼–è¯‘ã€‚ å¦åˆ™ï¼Œå®£å‘Šæ–¹æ³•æŸ¥æ‰¾å¤±è´¥ï¼ŒæŠ›å‡ºjava.lang.NoSuchMethodErrorå¼‚å¸¸ã€‚ JDK9æ¨¡å—åŒ–ä¹‹åä¹Ÿå¯èƒ½æŠ›å‡ºjava.lang.IllegalAccessErrorå¼‚å¸¸ã€‚ 3.5 åˆå§‹åŒ–åˆå§‹åŒ–é˜¶æ®µå°±æ˜¯æ‰§è¡Œç±»æ„é€ å™¨&lt;clinit&gt;()æ–¹æ³•çš„è¿‡ç¨‹ã€‚&lt;clinit&gt;()å¹¶ä¸æ˜¯ç¨‹åºå‘˜åœ¨Javaä»£ç ä¸­ç›´æ¥ç¼–å†™çš„æ–¹æ³•ï¼Œå®ƒæ˜¯Javacç¼–è¯‘å™¨çš„è‡ªåŠ¨ç”Ÿæˆç‰©ã€‚ &lt;clinit&gt;()æ–¹æ³•æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€è¯­å¥å—ï¼ˆstatic{}å—ï¼‰ä¸­çš„è¯­å¥åˆå¹¶äº§ç”Ÿçš„ï¼Œé¡ºåºä¸ºå‡ºç°çš„é¡ºåºã€‚ Javaè™šæ‹Ÿæœºä¼šä¿è¯åœ¨å­ç±»çš„&lt;clinit&gt;()æ–¹æ³•æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„&lt;clinit&gt;()æ–¹æ³•å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚å› æ­¤åœ¨Javaè™šæ‹Ÿæœºä¸­ç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œçš„&lt;clinit&gt;()æ–¹æ³•çš„ç±»å‹è‚¯å®šæ˜¯java.lang.Objectã€‚ è¿™ä¸ªæ–¹æ³•ä¸æ˜¯å¿…éœ€çš„ï¼Œå¦‚æœä¸€ä¸ªç±»ä¸­æ²¡æœ‰é™æ€è¯­å¥å—ï¼Œä¹Ÿæ²¡æœ‰å¯¹å˜é‡çš„èµ‹å€¼æ“ä½œï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å¯ä»¥ä¸ä¸ºè¿™ä¸ªç±»ç”Ÿæˆ&lt;clinit&gt;()æ–¹æ³•ã€‚ åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶å»åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆåªä¼šæœ‰å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªç±»çš„&lt;clinit&gt;()æ–¹æ³•ï¼Œå…¶ä»–çº¿ç¨‹éƒ½éœ€è¦é˜»å¡ç­‰å¾…ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jvm","slug":"jvm","permalink":"https://www.codetool.top/tags/jvm/"}]},{"title":"leetcode779-ç¬¬Kä¸ªè¯­æ³•ç¬¦å·","slug":"leetcode779-ç¬¬Kä¸ªè¯­æ³•ç¬¦å·","date":"2020-01-21T18:06:24.000Z","updated":"2020-04-22T09:27:27.192Z","comments":true,"path":"article/leetcode779-ç¬¬Kä¸ªè¯­æ³•ç¬¦å·/","link":"","permalink":"https://www.codetool.top/article/leetcode779-%E7%AC%ACK%E4%B8%AA%E8%AF%AD%E6%B3%95%E7%AC%A6%E5%8F%B7/","excerpt":"","text":"1 åŸé¢˜åœ¨ç¬¬ä¸€è¡Œæˆ‘ä»¬å†™ä¸Šä¸€ä¸ª 0ã€‚æ¥ä¸‹æ¥çš„æ¯ä¸€è¡Œï¼Œå°†å‰ä¸€è¡Œä¸­çš„0æ›¿æ¢ä¸º01ï¼Œ1æ›¿æ¢ä¸º10ã€‚ ç»™å®šè¡Œæ•° N å’Œåºæ•° Kï¼Œè¿”å›ç¬¬ N è¡Œä¸­ç¬¬ Kä¸ªå­—ç¬¦ã€‚ï¼ˆKä»1å¼€å§‹ï¼‰ ä¾‹å­ï¼š è¾“å…¥: N = 1, K = 1è¾“å‡º: 0 è¾“å…¥: N = 2, K = 1è¾“å‡º: 0 è¾“å…¥: N = 2, K = 2è¾“å‡º: 1 è¾“å…¥: N = 4, K = 5è¾“å‡º: 1 è§£é‡Š:ç¬¬ä¸€è¡Œ: 0ç¬¬äºŒè¡Œ: 01ç¬¬ä¸‰è¡Œ: 0110ç¬¬å››è¡Œ: 01101001 æ³¨æ„: N çš„èŒƒå›´ [1, 30]. K çš„èŒƒå›´ [1, 2^(N-1)]. 2 è§£æ³•2.1 æ€æƒ³é€’å½’åˆ†æè¦æŸ¥æ‰¾çš„å­—ç¬¦æ˜¯ä¸Šä¸€è¡Œçš„å“ªä¸ªæ•°å­—å¾—åˆ°çš„ï¼Œç„¶åæ ¹æ®å¥‡å¶æ€§å¾—åˆ°ç›®æ ‡å­—ç¬¦ 2.2 ä»£ç class Solution { public int kthGrammar(int N, int K) { if(N==0) return 0; if(K%2 == 1){ if(kthGrammar(N-1,(K+1)/2)==0) return 0; else return 1; }else{ if(kthGrammar(N-1,(K+1)/2)==0) return 1; else return 0; } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode70-çˆ¬æ¥¼æ¢¯","slug":"leetcode70-çˆ¬æ¥¼æ¢¯","date":"2020-01-21T05:58:10.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode70-çˆ¬æ¥¼æ¢¯/","link":"","permalink":"https://www.codetool.top/article/leetcode70-%E7%88%AC%E6%A5%BC%E6%A2%AF/","excerpt":"","text":"1 åŸé¢˜å‡è®¾ä½ æ­£åœ¨çˆ¬æ¥¼æ¢¯ã€‚éœ€è¦ n é˜¶ä½ æ‰èƒ½åˆ°è¾¾æ¥¼é¡¶ã€‚ æ¯æ¬¡ä½ å¯ä»¥çˆ¬ 1 æˆ– 2 ä¸ªå°é˜¶ã€‚ä½ æœ‰å¤šå°‘ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶å‘¢ï¼Ÿ æ³¨æ„ï¼š ç»™å®š n æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥ï¼š 2è¾“å‡ºï¼š 2è§£é‡Šï¼š æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶ã€‚1. 1 é˜¶ + 1 é˜¶2. 2 é˜¶ ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼š 3è¾“å‡ºï¼š 2è§£é‡Šï¼š æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶ã€‚1. 1 é˜¶ + 1 é˜¶ + 1 é˜¶2. 1 é˜¶ + 2 é˜¶3. 2 é˜¶ + 1 é˜¶ 2 è§£æ³•2.1 æ€æƒ³å®é™…ä¸Šæ˜¯æ–æ³¢é‚£å¥‘æ•°é—®é¢˜ï¼š å‡è®¾ç°åœ¨è¦èµ°ä¸‰é˜¶æ¥¼æ¢¯ï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡èµ°ä¸€é˜¶æ¥¼æ¢¯æ—¶ï¼Œè¿˜æœ‰f(2)ç§å¯èƒ½æ€§ï¼Œç¬¬ä¸€æ¬¡èµ°ä¸¤é˜¶æ¥¼æ¢¯æ—¶ï¼Œè¿˜æœ‰f(1)ç§å¯èƒ½æ€§ï¼Œåˆ™f(3)=f(2)+f(1)ï¼Œä»¥æ­¤ç±»æ¨ã€‚ 2.2 ä»£ç class Solution { Map&lt;Integer,Integer> map = new HashMap&lt;>(); public int climbStairs(int n) { if(n == 1) return 1; if(n == 2) return 2; if(map.containsKey(n)){ return map.get(n); } int ans = climbStairs(n-1)+climbStairs(n-2); map.put(n,ans); return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode509-æ–æ³¢é‚£å¥‘æ•°","slug":"leetcode509-æ–æ³¢é‚£å¥‘æ•°","date":"2020-01-20T18:39:37.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode509-æ–æ³¢é‚£å¥‘æ•°/","link":"","permalink":"https://www.codetool.top/article/leetcode509-%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0/","excerpt":"","text":"1 åŸé¢˜æ–æ³¢é‚£å¥‘æ•°ï¼Œé€šå¸¸ç”¨ F(n) è¡¨ç¤ºï¼Œå½¢æˆçš„åºåˆ—ç§°ä¸ºæ–æ³¢é‚£å¥‘æ•°åˆ—ã€‚è¯¥æ•°åˆ—ç”± 0 å’Œ 1 å¼€å§‹ï¼Œåé¢çš„æ¯ä¸€é¡¹æ•°å­—éƒ½æ˜¯å‰é¢ä¸¤é¡¹æ•°å­—çš„å’Œã€‚ä¹Ÿå°±æ˜¯ï¼š F(0) = 0, F(1) = 1F(N) = F(N - 1) + F(N - 2), å…¶ä¸­ N &gt; 1. ç»™å®š Nï¼Œè®¡ç®— F(N)ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥ï¼š 2è¾“å‡ºï¼š 1è§£é‡Šï¼š F(2) = F(1) + F(0) = 1 + 0 = 1. ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼š 3è¾“å‡ºï¼š 2è§£é‡Šï¼š F(3) = F(2) + F(1) = 1 + 1 = 2. ç¤ºä¾‹ 3ï¼š è¾“å…¥ï¼š 4è¾“å‡ºï¼š 3è§£é‡Šï¼š F(4) = F(3) + F(2) = 2 + 1 = 3. æç¤ºï¼š 0 â‰¤ N â‰¤ 30 2 è§£æ³•2.1 æ€æƒ³é€’å½’ï¼Œç”±äºå¾ˆå¤šé€’å½’å•å…ƒä¼šè¢«é‡å¤è®¡ç®—ï¼Œéœ€è¦åšç¼“å­˜ã€‚ 2.2 ä»£ç class Solution { Integer[] cache = new Integer[30]; public int fib(int N) { if(N == 0) return 0; if(N == 1) return 1; if(cache[N-1]!=null){ return cache[N-1]; } int ans = fib(N-1)+fib(N-2); cache[N-1] = ans; return ans; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°07","slug":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°07","date":"2020-01-20T17:41:55.000Z","updated":"2020-04-22T09:27:27.192Z","comments":true,"path":"article/æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°07/","link":"","permalink":"https://www.codetool.top/article/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%AC%AC%E4%B8%89%E7%89%88%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B007/","excerpt":"","text":"é™„ï¼š Javaè™šæ‹Ÿæœºè§„èŒƒ-Javaè™šæ‹ŸæœºæŒ‡ä»¤é›†ï¼šJDK8 Javaè™šæ‹Ÿæœºè§„èŒƒ-Javaè™šæ‹ŸæœºæŒ‡ä»¤é›†ï¼šJDK13 ç»­æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°06 1 å­—èŠ‚ç æŒ‡ä»¤ç®€ä»‹Javaè™šæ‹Ÿæœºçš„æŒ‡ä»¤ç”±ä¸€ä¸ªå­—èŠ‚é•¿åº¦çš„ã€ä»£è¡¨ç€æŸç§ç‰¹å®šæ“ä½œå«ä¹‰çš„æ•°å­—ï¼ˆç§°ä¸ºæ“ä½œç ï¼ŒOpcodeï¼‰ä»¥åŠè·Ÿéšå…¶åçš„é›¶è‡³å¤šä¸ªä»£è¡¨æ­¤æ“ä½œæ‰€éœ€çš„å‚æ•°ï¼ˆç§°ä¸ºæ“ä½œæ•°ï¼ŒOperandï¼‰æ„æˆã€‚ 1.1 å­—èŠ‚ç æ•°æ®ç±»å‹å­—èŠ‚ç æŒ‡ä»¤é›†ä¸­å­˜åœ¨å¤§é‡ä¸æ•°æ®ç±»å‹ç›¸å…³çš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œå®ƒä»¬çš„æ“ä½œç åŠ©è®°ç¬¦ä¸­éƒ½æœ‰ç‰¹æ®Šçš„å­—ç¬¦æ¥è¡¨æ˜ä¸“é—¨ä¸ºå“ªç§æ•°æ®ç±»å‹æœåŠ¡ï¼šiä»£è¡¨å¯¹intç±»å‹çš„æ•°æ®æ“ä½œï¼Œlä»£è¡¨longï¼Œsä»£è¡¨shortï¼Œbä»£è¡¨byteï¼Œcä»£è¡¨charï¼Œfä»£è¡¨floatï¼Œdä»£è¡¨doubleï¼Œaä»£è¡¨referenceã€‚ å› ä¸ºæ“ä½œç ä¸€å­—èŠ‚çš„é™åˆ¶ï¼Œå¹¶éæ¯ç§æ•°æ®ç±»å‹å’Œæ¯ä¸€ç§æ“ä½œéƒ½æœ‰å¯¹åº”çš„æŒ‡ä»¤ï¼Œæœ‰ä¸€äº›å•ç‹¬çš„æŒ‡ä»¤å¯ä»¥åœ¨å¿…è¦çš„æ—¶å€™ç”¨æ¥å°†ä¸€äº›ä¸æ”¯æŒçš„ç±»å‹è½¬æ¢ä¸ºå¯è¢«æ”¯æŒçš„ç±»å‹ã€‚ ä¸‹è¡¨åˆ—ä¸¾äº†Javaè™šæ‹Ÿæœºæ‰€æ”¯æŒçš„ä¸æ•°æ®ç±»å‹ç›¸å…³çš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œé€šè¿‡ä½¿ç”¨æ•°æ®ç±»å‹åˆ—æ‰€ä»£è¡¨çš„ç‰¹æ®Šå­—ç¬¦æ›¿æ¢opcodeåˆ—çš„æŒ‡ä»¤æ¨¡æ¿ä¸­çš„Tï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå…·ä½“çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚å¦‚æœåœ¨è¡¨ä¸­æŒ‡ä»¤æ¨¡æ¿ä¸æ•°æ®ç±»å‹ä¸¤åˆ—å…±åŒç¡®å®šçš„æ ¼ä¸ºç©ºï¼Œåˆ™è¯´æ˜è™šæ‹Ÿæœºä¸æ”¯æŒå¯¹è¿™ç§æ•°æ®ç±»å‹æ‰§è¡Œè¿™é¡¹æ“ä½œï¼š opcode byte short int long float double char reference Tipush bipush sipush Tconst iconst lconst fconst dconst aconst Tload iload lload fload dload aload Tstore istore lstore fstore dstore astore Taload baload saload iaload laload faload daload caload aaload Tastore bastore sastore iastore lastore fastore dastore castore aastore Tadd iadd ladd fadd dadd Tsub isub lsub fsub dsub Tmul imul lmul fmul dmul Tdiv idiv ldiv fdiv ddiv Tneg ineg lneg fneg dneg Tshl ishl lshl Tshr ishr lshr Tushr iushr lushr Tand iand land Tor ior lor Txor ixor lxor i2T i2b i2s i2l i2f i2d 12T 12i 12f 12d f2T f2i f2l f2d d2T d2i d2l d2f Tcmp lcmp Tcmpl fcmpl dcmpl Tcmpg fcmpg dcmpg if_TempOP if_icmpOP if_acmpOP Treturn ireturn lreturn fretun dretun areturn å¤§éƒ¨åˆ†æŒ‡ä»¤éƒ½æ²¡æœ‰æ”¯æŒæ•´æ•°ç±»å‹byteã€charå’Œshortï¼Œç”šè‡³æ²¡æœ‰ä»»ä½•æŒ‡ä»¤æ”¯æŒbooleanç±»å‹ã€‚ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸæˆ–è¿è¡ŒæœŸå°†byteå’Œshortç±»å‹çš„æ•°æ®å¸¦ç¬¦å·æ‰©å±•ï¼ˆSign-Extendï¼‰ä¸ºç›¸åº”çš„intç±»å‹æ•°æ®ï¼Œå°†booleanå’Œcharç±»å‹æ•°æ®é›¶ä½æ‰©å±•ï¼ˆZero-Extendï¼‰ä¸ºç›¸åº”çš„intç±»å‹æ•°æ®ã€‚ä¸ä¹‹ç±»ä¼¼ï¼Œåœ¨å¤„ç†booleanã€byteã€shortå’Œcharç±»å‹çš„æ•°ç»„æ—¶ï¼Œä¹Ÿä¼šè½¬æ¢ä¸ºä½¿ç”¨å¯¹åº”çš„intç±»å‹çš„å­—èŠ‚ç æŒ‡ä»¤æ¥å¤„ç†ã€‚ 1.2 åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤ç”¨äºå°†æ•°æ®åœ¨æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆä¹‹é—´æ¥å›ä¼ è¾“ï¼Œè¿™ç±»æŒ‡ä»¤åŒ…æ‹¬ï¼š å°†ä¸€ä¸ªå±€éƒ¨å˜é‡åŠ è½½åˆ°æ“ä½œæ•°æ ˆï¼šiloadã€iload_&lt;n&gt;ã€lloadã€lload_&lt;n&gt;ã€floadã€fload_&lt;n&gt;ã€dloadã€ dload_&lt;n&gt;ã€aloadã€aload_&lt;n&gt; å°†ä¸€ä¸ªæ•°å€¼ä»æ“ä½œæ•°æ ˆå­˜å‚¨åˆ°å±€éƒ¨å˜é‡è¡¨ï¼šistoreã€istore_&lt;n&gt;ã€lstoreã€lstore_&lt;n&gt;ã€fstoreã€ fstore_&lt;n&gt;ã€dstoreã€dstore_&lt;n&gt;ã€astoreã€astore_&lt;n&gt; å°†ä¸€ä¸ªå¸¸é‡åŠ è½½åˆ°æ“ä½œæ•°æ ˆï¼šbipushã€sipushã€ldcã€ldc_wã€ldc2_wã€aconst_nullã€iconst_m1ã€ iconst_&lt;i&gt;ã€lconst_&lt;l&gt;ã€fconst_&lt;f&gt;ã€dconst_&lt;d&gt; æ‰©å……å±€éƒ¨å˜é‡è¡¨çš„è®¿é—®ç´¢å¼•çš„æŒ‡ä»¤ï¼šwide å­˜å‚¨æ•°æ®çš„æ“ä½œæ•°æ ˆå’Œå±€éƒ¨å˜é‡è¡¨ä¸»è¦ç”±åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤è¿›è¡Œæ“ä½œï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å°‘é‡æŒ‡ä»¤ï¼Œå¦‚è®¿é—®å¯¹è±¡çš„å­—æ®µæˆ–æ•°ç»„å…ƒç´ çš„æŒ‡ä»¤ä¹Ÿä¼šå‘æ“ä½œæ•°æ ˆä¼ è¾“æ•°æ®ã€‚ ä¸Šé¢æ‰€åˆ—ä¸¾çš„æŒ‡ä»¤åŠ©è®°ç¬¦ä¸­ï¼Œæœ‰ä¸€éƒ¨åˆ†æ˜¯ä»¥å°–æ‹¬å·ç»“å°¾çš„ï¼ˆä¾‹å¦‚iload_ï¼‰ï¼Œè¿™äº›æŒ‡ä»¤åŠ©è®°ç¬¦å®é™…ä¸Šä»£è¡¨äº†ä¸€ç»„æŒ‡ä»¤ï¼ˆä¾‹å¦‚iload_ï¼Œå®ƒä»£è¡¨äº†iload_0ã€iload_1ã€iload_2å’Œiload_3è¿™å‡ æ¡æŒ‡ä»¤ï¼‰ã€‚è¿™å‡ ç»„æŒ‡ä»¤éƒ½æ˜¯æŸä¸ªå¸¦æœ‰ä¸€ä¸ªæ“ä½œæ•°çš„é€šç”¨æŒ‡ä»¤ï¼ˆä¾‹å¦‚iloadï¼‰çš„ç‰¹æ®Šå½¢å¼ï¼Œå¯¹äºè¿™å‡ ç»„ç‰¹æ®ŠæŒ‡ä»¤ï¼Œå®ƒä»¬çœç•¥æ‰äº†æ˜¾å¼çš„æ“ä½œæ•°ï¼Œä¸éœ€è¦è¿›è¡Œå–æ“ä½œæ•°çš„åŠ¨ä½œï¼Œå› ä¸ºå®é™…ä¸Šæ“ä½œæ•°å°±éšå«åœ¨æŒ‡ä»¤ä¸­ã€‚é™¤äº†è¿™ç‚¹ä¸åŒä»¥å¤–ï¼Œå®ƒä»¬çš„è¯­ä¹‰ä¸åŸç”Ÿçš„é€šç”¨æŒ‡ä»¤æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼ˆä¾‹å¦‚iload_0çš„è¯­ä¹‰ä¸æ“ä½œæ•°ä¸º0æ—¶çš„iloadæŒ‡ä»¤è¯­ä¹‰å®Œå…¨ä¸€è‡´ï¼‰ã€‚ 1.3 è¿ç®—æŒ‡ä»¤ç®—æœ¯æŒ‡ä»¤ç”¨äºå¯¹ä¸¤ä¸ªæ“ä½œæ•°æ ˆä¸Šçš„å€¼è¿›è¡ŒæŸç§ç‰¹å®šè¿ç®—ï¼Œå¹¶æŠŠç»“æœé‡æ–°å­˜å…¥åˆ°æ“ä½œæ ˆé¡¶ã€‚ å¤§ä½“ä¸Šè¿ç®—æŒ‡ä»¤å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šå¯¹æ•´å‹æ•°æ®è¿›è¡Œè¿ç®—çš„æŒ‡ä»¤ä¸å¯¹æµ®ç‚¹å‹æ•°æ®è¿›è¡Œè¿ç®—çš„æŒ‡ä»¤ã€‚æ•´æ•°ä¸æµ®ç‚¹æ•°çš„ç®—æœ¯æŒ‡ä»¤åœ¨æº¢å‡ºå’Œè¢«é›¶é™¤çš„æ—¶å€™ä¹Ÿæœ‰å„è‡ªä¸åŒçš„è¡Œä¸ºè¡¨ç°ã€‚ åŠ æ³•æŒ‡ä»¤ï¼šiaddã€laddã€faddã€dadd å‡æ³•æŒ‡ä»¤ï¼šisubã€lsubã€fsubã€dsub ä¹˜æ³•æŒ‡ä»¤ï¼šimulã€lmulã€fmulã€dmul é™¤æ³•æŒ‡ä»¤ï¼šidivã€ldivã€fdivã€ddiv æ±‚ä½™æŒ‡ä»¤ï¼širemã€lremã€fremã€drem å–åæŒ‡ä»¤ï¼šinegã€lnegã€fnegã€dneg ä½ç§»æŒ‡ä»¤ï¼šishlã€ishrã€iushrã€lshlã€lshrã€lushr æŒ‰ä½æˆ–æŒ‡ä»¤ï¼šiorã€lor æŒ‰ä½ä¸æŒ‡ä»¤ï¼šiandã€land æŒ‰ä½å¼‚æˆ–æŒ‡ä»¤ï¼šixorã€lxor å±€éƒ¨å˜é‡è‡ªå¢æŒ‡ä»¤ï¼šiinc æ¯”è¾ƒæŒ‡ä»¤ï¼šdcmpgã€dcmplã€fcmpgã€fcmplã€lcmp éç²¾ç¡®çš„ç»“æœå¿…é¡»èˆå…¥ä¸ºå¯è¢«è¡¨ç¤ºçš„æœ€æ¥è¿‘çš„ç²¾ç¡®å€¼ï¼›å¦‚æœæœ‰ä¸¤ç§å¯è¡¨ç¤ºçš„å½¢å¼ä¸è¯¥å€¼ä¸€æ ·æ¥è¿‘ï¼Œé‚£å°†ä¼˜å…ˆé€‰æ‹©æœ€ä½æœ‰æ•ˆä½ä¸ºé›¶çš„ï¼Œç§°ä¸ºå‘æœ€æ¥è¿‘æ•°èˆå…¥æ¨¡å¼ã€‚è€Œåœ¨æŠŠæµ®ç‚¹æ•°è½¬æ¢ä¸ºæ•´æ•°æ—¶ï¼Œä½¿ç”¨å‘é›¶èˆå…¥æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼çš„èˆå…¥ç»“æœä¼šå¯¼è‡´æ•°å­—è¢«æˆªæ–­ï¼Œæ‰€æœ‰å°æ•°éƒ¨åˆ†çš„æœ‰æ•ˆå­—èŠ‚éƒ½ä¼šè¢«ä¸¢å¼ƒæ‰ã€‚å‘é›¶èˆå…¥æ¨¡å¼å°†åœ¨ç›®æ ‡æ•°å€¼ç±»å‹ä¸­é€‰æ‹©ä¸€ä¸ªæœ€æ¥è¿‘ï¼Œä½†æ˜¯ä¸å¤§äºåŸå€¼çš„æ•°å­—æ¥ä½œä¸ºæœ€ç²¾ç¡®çš„èˆå…¥ç»“æœã€‚ åœ¨å¯¹longç±»å‹æ•°å€¼è¿›è¡Œæ¯”è¾ƒæ—¶ï¼ŒJavaè™šæ‹Ÿæœºé‡‡ç”¨å¸¦ç¬¦å·çš„æ¯”è¾ƒæ–¹å¼ï¼Œè€Œå¯¹æµ®ç‚¹æ•°å€¼è¿›è¡Œæ¯”è¾ƒæ—¶ï¼ˆdcmpgã€dcmplã€fcmpgã€fcmplï¼‰ï¼Œè™šæ‹Ÿæœºä¼šé‡‡ç”¨IEEE 754è§„èŒƒæ‰€å®šä¹‰çš„æ— ä¿¡å·æ¯”è¾ƒï¼ˆNonsignaling Comparisonï¼‰æ–¹å¼è¿›è¡Œã€‚ iincç›´æ¥åœ¨å±€éƒ¨å˜é‡æ§½slotä¸Šè¿ç®—ã€‚ 1.4 ç±»å‹è½¬æ¢æŒ‡ä»¤ç±»å‹è½¬æ¢æŒ‡ä»¤å¯ä»¥å°†ä¸¤ç§ä¸åŒçš„æ•°å€¼ç±»å‹ç›¸äº’è½¬æ¢ï¼Œè¿™äº›è½¬æ¢æ“ä½œä¸€èˆ¬ç”¨äºå®ç°ç”¨æˆ·ä»£ç ä¸­çš„æ˜¾å¼ç±»å‹è½¬æ¢æ“ä½œï¼Œæˆ–è€…ç”¨æ¥å¤„ç†å­—èŠ‚ç æŒ‡ä»¤é›†ä¸­æ•°æ®ç±»å‹ç›¸å…³æŒ‡ä»¤æ— æ³•ä¸æ•°æ®ç±»å‹ä¸€ä¸€å¯¹åº”çš„é—®é¢˜ã€‚ Javaè™šæ‹Ÿæœºç›´æ¥æ”¯æŒï¼ˆå³è½¬æ¢æ—¶æ— é¡»æ˜¾å¼çš„è½¬æ¢æŒ‡ä»¤ï¼‰ä»¥ä¸‹æ•°å€¼ç±»å‹çš„å®½åŒ–ç±»å‹è½¬æ¢ï¼ˆWideningNumeric Conversionï¼Œå³å°èŒƒå›´ç±»å‹å‘å¤§èŒƒå›´ç±»å‹çš„å®‰å…¨è½¬æ¢ï¼‰ï¼š intç±»å‹åˆ°longã€floatæˆ–è€…doubleç±»å‹ longç±»å‹åˆ°floatã€doubleç±»å‹ floatç±»å‹åˆ°doubleç±»å‹ ä¸ä¹‹ç›¸å¯¹çš„ï¼Œå¤„ç†çª„åŒ–ç±»å‹è½¬æ¢ï¼ˆNarrowing Numeric Conversionï¼‰æ—¶ï¼Œå°±å¿…é¡»æ˜¾å¼åœ°ä½¿ç”¨è½¬æ¢æŒ‡ä»¤æ¥å®Œæˆï¼Œè¿™äº›è½¬æ¢æŒ‡ä»¤åŒ…æ‹¬i2bã€i2cã€i2sã€l2iã€f2iã€f2lã€d2iã€d2lå’Œd2fã€‚çª„åŒ–ç±»å‹è½¬æ¢å¯èƒ½ä¼šå¯¼è‡´è½¬æ¢ç»“æœäº§ç”Ÿä¸åŒçš„æ­£è´Ÿå·ã€ä¸åŒçš„æ•°é‡çº§çš„æƒ…å†µï¼Œè½¬æ¢è¿‡ç¨‹å¾ˆå¯èƒ½ä¼šå¯¼è‡´æ•°å€¼çš„ç²¾åº¦ä¸¢å¤±ã€‚ 1.5 å¯¹è±¡åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤è™½ç„¶ç±»å®ä¾‹å’Œæ•°ç»„éƒ½æ˜¯å¯¹è±¡ï¼Œä½†Javaè™šæ‹Ÿæœºå¯¹ç±»å®ä¾‹å’Œæ•°ç»„çš„åˆ›å»ºä¸æ“ä½œä½¿ç”¨äº†ä¸åŒçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚å¯¹è±¡åˆ›å»ºåï¼Œå°±å¯ä»¥é€šè¿‡å¯¹è±¡è®¿é—®æŒ‡ä»¤è·å–å¯¹è±¡å®ä¾‹æˆ–è€…æ•°ç»„å®ä¾‹ä¸­çš„å­—æ®µæˆ–è€…æ•°ç»„å…ƒç´ ï¼Œè¿™äº›æŒ‡ä»¤åŒ…æ‹¬ï¼š åˆ›å»ºç±»å®ä¾‹çš„æŒ‡ä»¤ï¼šnew åˆ›å»ºæ•°ç»„çš„æŒ‡ä»¤ï¼šnewarrayã€anewarrayã€multianewarray è®¿é—®ç±»å­—æ®µï¼ˆstaticå­—æ®µï¼Œæˆ–è€…ç§°ä¸ºç±»å˜é‡ï¼‰å’Œå®ä¾‹å­—æ®µï¼ˆéstaticå­—æ®µï¼Œæˆ–è€…ç§°ä¸ºå®ä¾‹å˜é‡ï¼‰çš„æŒ‡ä»¤ï¼šgetfieldã€putfieldã€getstaticã€putstatic æŠŠä¸€ä¸ªæ•°ç»„å…ƒç´ åŠ è½½åˆ°æ“ä½œæ•°æ ˆçš„æŒ‡ä»¤ï¼šbaloadã€caloadã€saloadã€ialoadã€laloadã€faloadã€ daloadã€aaload å°†ä¸€ä¸ªæ“ä½œæ•°æ ˆçš„å€¼å‚¨å­˜åˆ°æ•°ç»„å…ƒç´ ä¸­çš„æŒ‡ä»¤ï¼šbastoreã€castoreã€sastoreã€iastoreã€fastoreã€ dastoreã€aastore å–æ•°ç»„é•¿åº¦çš„æŒ‡ä»¤ï¼šarraylength æ£€æŸ¥ç±»å®ä¾‹ç±»å‹çš„æŒ‡ä»¤ï¼šinstanceofã€checkcast 1.6 æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤Javaè™šæ‹Ÿæœºæä¾›äº†ä¸€äº›ç”¨äºç›´æ¥æ“ä½œæ“ä½œæ•°æ ˆçš„æŒ‡ä»¤ï¼ŒåŒ…æ‹¬ï¼š å°†æ“ä½œæ•°æ ˆçš„æ ˆé¡¶ä¸€ä¸ªæˆ–ä¸¤ä¸ªå…ƒç´ å‡ºæ ˆï¼špopã€pop2 å¤åˆ¶æ ˆé¡¶ä¸€ä¸ªæˆ–ä¸¤ä¸ªæ•°å€¼å¹¶å°†å¤åˆ¶å€¼æˆ–åŒä»½çš„å¤åˆ¶å€¼é‡æ–°å‹å…¥æ ˆé¡¶ï¼šdupã€dup2ã€dup_x1ã€ dup2_x1ã€dup_x2ã€dup2_x2 å°†æ ˆæœ€é¡¶ç«¯çš„ä¸¤ä¸ªæ•°å€¼äº’æ¢ï¼šswap 1.7 æ§åˆ¶è½¬ç§»æŒ‡ä»¤æ§åˆ¶è½¬ç§»æŒ‡ä»¤å¯ä»¥è®©Javaè™šæ‹Ÿæœºæœ‰æ¡ä»¶æˆ–æ— æ¡ä»¶åœ°ä»æŒ‡å®šä½ç½®æŒ‡ä»¤ï¼ˆè€Œä¸æ˜¯æ§åˆ¶è½¬ç§»æŒ‡ä»¤ï¼‰çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ç»§ç»­æ‰§è¡Œç¨‹åºï¼Œä»æ¦‚å¿µæ¨¡å‹ä¸Šç†è§£ï¼Œå¯ä»¥è®¤ä¸ºæ§åˆ¶æŒ‡ä»¤å°±æ˜¯åœ¨æœ‰æ¡ä»¶æˆ–æ— æ¡ä»¶åœ°ä¿®æ”¹PCå¯„å­˜å™¨çš„å€¼ã€‚æ§åˆ¶è½¬ç§»æŒ‡ä»¤åŒ…æ‹¬ï¼šÂ·æ¡ä»¶åˆ†æ”¯ï¼šifeqã€ifltã€ifleã€ifneã€ifgtã€ifgeã€ifnullã€ifnonnullã€if_icmpeqã€if_icmpneã€if_icmpltã€ if_icmpgtã€if_icmpleã€if_icmpgeã€if_acmpeqå’Œif_acmpneÂ·å¤åˆæ¡ä»¶åˆ†æ”¯ï¼štableswitchã€lookupswitchÂ·æ— æ¡ä»¶åˆ†æ”¯ï¼šgotoã€goto_wã€jsrã€jsr_wã€ret 1.8 æ–¹æ³•è°ƒç”¨å’Œè¿”å›æŒ‡ä»¤ invokevirtualæŒ‡ä»¤ï¼šç”¨äºè°ƒç”¨å¯¹è±¡çš„å®ä¾‹æ–¹æ³•ï¼Œæ ¹æ®å¯¹è±¡çš„å®é™…ç±»å‹è¿›è¡Œåˆ†æ´¾ï¼ˆè™šæ–¹æ³•åˆ†æ´¾ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯Javaè¯­è¨€ä¸­æœ€å¸¸è§çš„æ–¹æ³•åˆ†æ´¾æ–¹å¼ã€‚ invokeinterfaceæŒ‡ä»¤ï¼šç”¨äºè°ƒç”¨æ¥å£æ–¹æ³•ï¼Œå®ƒä¼šåœ¨è¿è¡Œæ—¶æœç´¢ä¸€ä¸ªå®ç°äº†è¿™ä¸ªæ¥å£æ–¹æ³•çš„å¯¹è±¡ï¼Œæ‰¾å‡ºé€‚åˆçš„æ–¹æ³•è¿›è¡Œè°ƒç”¨ã€‚ invokespecialæŒ‡ä»¤ï¼šç”¨äºè°ƒç”¨ä¸€äº›éœ€è¦ç‰¹æ®Šå¤„ç†çš„å®ä¾‹æ–¹æ³•ï¼ŒåŒ…æ‹¬å®ä¾‹åˆå§‹åŒ–æ–¹æ³•ã€ç§æœ‰æ–¹æ³•å’Œçˆ¶ç±»æ–¹æ³•ã€‚ invokestaticæŒ‡ä»¤ï¼šç”¨äºè°ƒç”¨ç±»é™æ€æ–¹æ³•ï¼ˆstaticæ–¹æ³•ï¼‰ã€‚ invokedynamicæŒ‡ä»¤ï¼šç”¨äºåœ¨è¿è¡Œæ—¶åŠ¨æ€è§£æå‡ºè°ƒç”¨ç‚¹é™å®šç¬¦æ‰€å¼•ç”¨çš„æ–¹æ³•ã€‚å¹¶æ‰§è¡Œè¯¥æ–¹æ³•ã€‚å‰é¢å››æ¡è°ƒç”¨æŒ‡ä»¤çš„åˆ†æ´¾é€»è¾‘éƒ½å›ºåŒ–åœ¨Javaè™šæ‹Ÿæœºå†…éƒ¨ï¼Œç”¨æˆ·æ— æ³•æ”¹å˜ï¼Œè€ŒinvokedynamicæŒ‡ä»¤çš„åˆ†æ´¾é€»è¾‘æ˜¯ç”±ç”¨æˆ·æ‰€è®¾å®šçš„å¼•å¯¼æ–¹æ³•å†³å®šçš„ã€‚ æ–¹æ³•è°ƒç”¨æŒ‡ä»¤ä¸æ•°æ®ç±»å‹æ— å…³ï¼Œè€Œæ–¹æ³•è¿”å›æŒ‡ä»¤æ˜¯æ ¹æ®è¿”å›å€¼çš„ç±»å‹åŒºåˆ†çš„ï¼ŒåŒ…æ‹¬ireturnï¼ˆå½“è¿”å›å€¼æ˜¯booleanã€byteã€charã€shortå’Œintç±»å‹æ—¶ä½¿ç”¨ï¼‰ã€lreturnã€freturnã€dreturnå’Œareturnï¼Œå¦å¤–è¿˜æœ‰ä¸€æ¡returnæŒ‡ä»¤ä¾›å£°æ˜ä¸ºvoidçš„æ–¹æ³•ã€å®ä¾‹åˆå§‹åŒ–æ–¹æ³•ã€ç±»å’Œæ¥å£çš„ç±»åˆå§‹åŒ–æ–¹æ³•ä½¿ç”¨ã€‚ 1.9 å¼‚å¸¸å¤„ç†æŒ‡ä»¤åœ¨Javaç¨‹åºä¸­æ˜¾å¼æŠ›å‡ºå¼‚å¸¸çš„æ“ä½œï¼ˆthrowè¯­å¥ï¼‰éƒ½ç”±athrowæŒ‡ä»¤æ¥å®ç°ï¼Œé™¤äº†ç”¨throwè¯­å¥æ˜¾å¼æŠ›å‡ºå¼‚å¸¸çš„æƒ…å†µä¹‹å¤–ï¼Œã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹è¿˜è§„å®šäº†è®¸å¤šè¿è¡Œæ—¶å¼‚å¸¸ä¼šåœ¨å…¶ä»–Javaè™šæ‹ŸæœºæŒ‡ä»¤æ£€æµ‹åˆ°å¼‚å¸¸çŠ¶å†µæ—¶è‡ªåŠ¨æŠ›å‡ºã€‚ä¾‹å¦‚å‰é¢ä»‹ç»æ•´æ•°è¿ç®—ä¸­ï¼Œå½“é™¤æ•°ä¸ºé›¶æ—¶ï¼Œè™šæ‹Ÿæœºä¼šåœ¨idivæˆ–ldivæŒ‡ä»¤ä¸­æŠ›å‡ºArithmeticExceptionå¼‚å¸¸ã€‚ è€Œåœ¨Javaè™šæ‹Ÿæœºä¸­ï¼Œå¤„ç†å¼‚å¸¸ï¼ˆcatchè¯­å¥ï¼‰ä¸æ˜¯ç”±å­—èŠ‚ç æŒ‡ä»¤æ¥å®ç°çš„ï¼ˆå¾ˆä¹…ä¹‹å‰æ›¾ç»ä½¿ç”¨jsrå’ŒretæŒ‡ä»¤æ¥å®ç°ï¼Œç°åœ¨å·²ç»ä¸ç”¨äº†ï¼‰ï¼Œè€Œæ˜¯é‡‡ç”¨å¼‚å¸¸è¡¨æ¥å®Œæˆã€‚ 1.10 åŒæ­¥æŒ‡ä»¤Javaè™šæ‹Ÿæœºå¯ä»¥æ”¯æŒæ–¹æ³•çº§çš„åŒæ­¥å’Œæ–¹æ³•å†…éƒ¨ä¸€æ®µæŒ‡ä»¤åºåˆ—çš„åŒæ­¥ï¼Œè¿™ä¸¤ç§åŒæ­¥ç»“æ„éƒ½æ˜¯ä½¿ç”¨ç®¡ç¨‹ï¼ˆMonitorï¼Œæ›´å¸¸è§çš„æ˜¯ç›´æ¥å°†å®ƒç§°ä¸ºâ€œé”â€ï¼‰æ¥å®ç°çš„ã€‚ æ–¹æ³•çº§çš„åŒæ­¥æ˜¯éšå¼çš„ï¼Œæ— é¡»é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥æ§åˆ¶ï¼Œå®ƒå®ç°åœ¨æ–¹æ³•è°ƒç”¨å’Œè¿”å›æ“ä½œä¹‹ä¸­ã€‚è™šæ‹Ÿæœºå¯ä»¥ä»æ–¹æ³•å¸¸é‡æ± ä¸­çš„æ–¹æ³•è¡¨ç»“æ„ä¸­çš„ACC_SYNCHRONIZEDè®¿é—®æ ‡å¿—å¾—çŸ¥ä¸€ä¸ªæ–¹æ³•æ˜¯å¦è¢«å£°æ˜ä¸ºåŒæ­¥æ–¹æ³•ã€‚å½“æ–¹æ³•è°ƒç”¨æ—¶ï¼Œè°ƒç”¨æŒ‡ä»¤å°†ä¼šæ£€æŸ¥æ–¹æ³•çš„ACC_SYNCHRONIZEDè®¿é—®æ ‡å¿—æ˜¯å¦è¢«è®¾ç½®ï¼Œå¦‚æœè®¾ç½®äº†ï¼Œæ‰§è¡Œçº¿ç¨‹å°±è¦æ±‚å…ˆæˆåŠŸæŒæœ‰ç®¡ç¨‹ï¼Œç„¶åæ‰èƒ½æ‰§è¡Œæ–¹æ³•ï¼Œæœ€åå½“æ–¹æ³•å®Œæˆï¼ˆæ— è®ºæ˜¯æ­£å¸¸å®Œæˆè¿˜æ˜¯éæ­£å¸¸å®Œæˆï¼‰æ—¶é‡Šæ”¾ç®¡ç¨‹ã€‚åœ¨æ–¹æ³•æ‰§è¡ŒæœŸé—´ï¼Œæ‰§è¡Œçº¿ç¨‹æŒæœ‰äº†ç®¡ç¨‹ï¼Œå…¶ä»–ä»»ä½•çº¿ç¨‹éƒ½æ— æ³•å†è·å–åˆ°åŒä¸€ä¸ªç®¡ç¨‹ã€‚å¦‚æœä¸€ä¸ªåŒæ­¥æ–¹æ³•æ‰§è¡ŒæœŸé—´æŠ›å‡ºäº†å¼‚å¸¸ï¼Œå¹¶ä¸”åœ¨æ–¹æ³•å†…éƒ¨æ— æ³•å¤„ç†æ­¤å¼‚å¸¸ï¼Œé‚£è¿™ä¸ªåŒæ­¥æ–¹æ³•æ‰€æŒæœ‰çš„ç®¡ç¨‹å°†åœ¨å¼‚å¸¸æŠ›åˆ°åŒæ­¥æ–¹æ³•è¾¹ç•Œä¹‹å¤–æ—¶è‡ªåŠ¨é‡Šæ”¾ã€‚ åŒæ­¥ä¸€æ®µæŒ‡ä»¤é›†åºåˆ—é€šå¸¸æ˜¯ç”±Javaè¯­è¨€ä¸­çš„synchronizedè¯­å¥å—æ¥è¡¨ç¤ºçš„ï¼ŒJavaè™šæ‹Ÿæœºçš„æŒ‡ä»¤é›†ä¸­æœ‰monitorenterå’Œmonitorexitä¸¤æ¡æŒ‡ä»¤æ¥æ”¯æŒsynchronizedå…³é”®å­—çš„è¯­ä¹‰ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jvm","slug":"jvm","permalink":"https://www.codetool.top/tags/jvm/"}]},{"title":"leetcode24-ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹","slug":"leetcode24-ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹","date":"2020-01-20T12:55:44.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode24-ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹/","link":"","permalink":"https://www.codetool.top/article/leetcode24-%E4%B8%A4%E4%B8%A4%E4%BA%A4%E6%8D%A2%E9%93%BE%E8%A1%A8%E4%B8%AD%E7%9A%84%E8%8A%82%E7%82%B9/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œä¸¤ä¸¤äº¤æ¢å…¶ä¸­ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œå¹¶è¿”å›äº¤æ¢åçš„é“¾è¡¨ã€‚ ä½ ä¸èƒ½åªæ˜¯å•çº¯çš„æ”¹å˜èŠ‚ç‚¹å†…éƒ¨çš„å€¼ï¼Œè€Œæ˜¯éœ€è¦å®é™…çš„è¿›è¡ŒèŠ‚ç‚¹äº¤æ¢ã€‚ ç¤ºä¾‹: ç»™å®š 1-&gt;2-&gt;3-&gt;4, ä½ åº”è¯¥è¿”å› 2-&gt;1-&gt;4-&gt;3.2 è§£æ³•2.1 æ€æƒ³é€’å½’ï¼Œè‡ªåº•å‘ä¸Š ç»ˆæ­¢ç‚¹ï¼š headä¸ºnullï¼Œè¿”å›null headçš„nextä¸ºnullï¼Œä»£è¡¨æ­¤æ—¶æ˜¯å€’æ•°ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆé“¾è¡¨èŠ‚ç‚¹æ˜¯å¥‡æ•°ä¸ªï¼‰ï¼Œç›´æ¥è¿”å›head å¦åˆ™ï¼Œç›´æ¥äº¤æ¢å½“å‰èŠ‚ç‚¹å’Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„nextä½¿ç”¨swapPairs()è®¡ç®— 2.2 ä»£ç class Solution { public ListNode swapPairs(ListNode head) { if(head==null) return null; if(head.next == null) return head; ListNode next = head.next; head.next = swapPairs(next.next); next.next = head; return next; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode559-Nå‰æ ‘çš„æœ€å¤§æ·±åº¦","slug":"leetcode559-Nå‰æ ‘çš„æœ€å¤§æ·±åº¦","date":"2020-01-20T12:39:39.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode559-Nå‰æ ‘çš„æœ€å¤§æ·±åº¦/","link":"","permalink":"https://www.codetool.top/article/leetcode559-N%E5%8F%89%E6%A0%91%E7%9A%84%E6%9C%80%E5%A4%A7%E6%B7%B1%E5%BA%A6/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ª N å‰æ ‘ï¼Œæ‰¾åˆ°å…¶æœ€å¤§æ·±åº¦ã€‚ æœ€å¤§æ·±åº¦æ˜¯æŒ‡ä»æ ¹èŠ‚ç‚¹åˆ°æœ€è¿œå¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ€»æ•°ã€‚ ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ª 3å‰æ ‘ : æˆ‘ä»¬åº”è¿”å›å…¶æœ€å¤§æ·±åº¦ï¼Œ3ã€‚ è¯´æ˜: æ ‘çš„æ·±åº¦ä¸ä¼šè¶…è¿‡ 1000ã€‚ æ ‘çš„èŠ‚ç‚¹æ€»ä¸ä¼šè¶…è¿‡ 5000ã€‚ 2 è§£æ³•2.1 æ€æƒ³ è‡ªåº•å‘ä¸Šï¼Œæ¯ä¸ªèŠ‚ç‚¹æ˜¯æ‰€æœ‰å­©å­èŠ‚ç‚¹çš„æ·±åº¦çš„æœ€å¤§å€¼+1 è‡ªé¡¶å‘ä¸‹ï¼Œä¾æ¬¡æ›´æ–°æœ€å¤§é«˜åº¦ 2.2 ä»£ç è‡ªåº•å‘ä¸Šï¼š class Solution { public int maxDepth(Node root) { return depth(root,0); } public int depth(Node root,int depth){ if(root == null) return depth; int max = 0; for(Node node:root.children){ int level = depth(node,depth+1); if(level>max) max = level; } return max+1; } } è‡ªé¡¶å‘ä¸‹ï¼š class Solution { int depth = 0; public int maxDepth(Node root) { depth(root,1); return depth; } public void depth(Node root,int cur){ if(root == null) return; if(cur>depth) depth = cur; for(Node node:root.children) depth(node,cur+1); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode429-Nå‰æ ‘çš„å±‚åºéå†","slug":"leetcode429-Nå‰æ ‘çš„å±‚åºéå†","date":"2020-01-19T18:36:06.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode429-Nå‰æ ‘çš„å±‚åºéå†/","link":"","permalink":"https://www.codetool.top/article/leetcode429-N%E5%8F%89%E6%A0%91%E7%9A%84%E5%B1%82%E5%BA%8F%E9%81%8D%E5%8E%86/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ª N å‰æ ‘ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼çš„å±‚åºéå†ã€‚ (å³ä»å·¦åˆ°å³ï¼Œé€å±‚éå†)ã€‚ ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ª 3å‰æ ‘ : è¿”å›å…¶å±‚åºéå†: [ [1], [3,2,4], [5,6] ]è¯´æ˜: æ ‘çš„æ·±åº¦ä¸ä¼šè¶…è¿‡ 1000ã€‚ æ ‘çš„èŠ‚ç‚¹æ€»æ•°ä¸ä¼šè¶…è¿‡ 5000ã€‚ 2 è§£æ³•2.1 æ€æƒ³ç±»ä¼¼leetcode102-äºŒå‰æ ‘çš„å±‚æ¬¡éå†ï¼Œé€šè¿‡DFSæˆ–BFSå®ç°ã€‚ 2.2 ä»£ç è¿­ä»£ï¼ˆBFSï¼‰ï¼š class Solution { public List&lt;List&lt;Integer>> levelOrder(Node root) { Queue&lt;Node> queue = new LinkedList&lt;>(); List&lt;List&lt;Integer>> ans = new ArrayList&lt;>(); List&lt;Integer> cur = new ArrayList&lt;>(); if(root == null) return new ArrayList&lt;List&lt;Integer>>(); queue.offer(root); queue.offer(null);//ä»¥nullä½œä¸ºæ¯å±‚ç»“æŸçš„æ ‡å¿—ç¬¦ while(!queue.isEmpty()){ Node node = queue.poll(); if(node == null){ if(cur.size()!=0) ans.add(cur); cur = new ArrayList&lt;>(); }else{ cur.add(node.val); for(Node child:node.children){ if(child!=null) queue.offer(child); } //è‹¥é˜Ÿé¦–ä¸ºnullè¯´æ˜è¿™ä¸€å±‚çš„èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å·²ç»å…¨éƒ¨åŠ å…¥é˜Ÿåˆ—äº†ï¼Œéœ€è¦åŠ å…¥ä¸€ä¸ªnull if(queue.peek()==null) queue.offer(null); } } return ans; } } é€’å½’ï¼ˆDFSï¼‰ï¼š class Solution { List&lt;List&lt;Integer>> ans = new ArrayList&lt;>(); public List&lt;List&lt;Integer>> levelOrder(Node root) { if(root==null) return ans; DFS(root,0); return ans; } public void DFS(Node root,int level){ if(ans.size()==level) ans.add(new ArrayList&lt;Integer>()); ans.get(level).add(root.val); for(Node node:root.children){ if(node!=null) DFS(node,level+1); } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode590-Nå‰æ ‘çš„ååºéå†","slug":"leetcode590-Nå‰æ ‘çš„ååºéå†","date":"2020-01-19T18:23:52.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode590-Nå‰æ ‘çš„ååºéå†/","link":"","permalink":"https://www.codetool.top/article/leetcode590-N%E5%8F%89%E6%A0%91%E7%9A%84%E5%90%8E%E5%BA%8F%E9%81%8D%E5%8E%86/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ª N å‰æ ‘ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼çš„ååºéå†ã€‚ ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ª 3å‰æ ‘ : è¿”å›å…¶å‰åºéå†: [5,6,3,2,4,1]. è¯´æ˜: é€’å½’æ³•å¾ˆç®€å•ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿­ä»£æ³•å®Œæˆæ­¤é¢˜å—? 2 è§£æ³•2.1 æ€æƒ³ç±»ä¼¼äºŒå‰æ ‘çš„ååºéå†ï¼Œé€’å½’å›æº¯æ—¶å°†æ ¹èŠ‚ç‚¹åŠ å…¥é›†åˆä¸­ã€‚ 2.2 ä»£ç class Solution { List&lt;Integer> list; public List&lt;Integer> postorder(Node root) { list = new ArrayList&lt;>(); recursion(root); return list; } public void recursion(Node root){ if(root == null) return; for(Node node:root.children){ recursion(node); } list.add(root.val); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode589-Nå‰æ ‘çš„å‰åºéå†","slug":"leetcode589-Nå‰æ ‘çš„å‰åºéå†","date":"2020-01-18T18:52:50.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode589-Nå‰æ ‘çš„å‰åºéå†/","link":"","permalink":"https://www.codetool.top/article/leetcode589-N%E5%8F%89%E6%A0%91%E7%9A%84%E5%89%8D%E5%BA%8F%E9%81%8D%E5%8E%86/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ª N å‰æ ‘ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼çš„å‰åºéå†ã€‚ ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ª 3å‰æ ‘ : è¿”å›å…¶å‰åºéå†: [1,3,5,6,2,4]ã€‚ è¯´æ˜: é€’å½’æ³•å¾ˆç®€å•ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿­ä»£æ³•å®Œæˆæ­¤é¢˜å—? 2 è§£æ³•2.1 æ€æƒ³ç±»ä¼¼äºŒå‰æ ‘çš„å‰åºéå†ï¼Œé€’å½’å°†æ ¹èŠ‚ç‚¹åŠ å…¥é›†åˆä¸­ã€‚ 2.2 ä»£ç class Solution { List&lt;Integer> list; public List&lt;Integer> preorder(Node root) { list = new ArrayList&lt;>(); recursion(root); return list; } public void recursion(Node root){ if(root == null) return; list.add(root.val); for(Node node:root.children){ recursion(node); } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°06","slug":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°06","date":"2020-01-18T14:12:50.000Z","updated":"2020-04-22T09:27:27.192Z","comments":true,"path":"article/æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°06/","link":"","permalink":"https://www.codetool.top/article/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%AC%AC%E4%B8%89%E7%89%88%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B006/","excerpt":"","text":"é™„ï¼š Javaè™šæ‹Ÿæœºè§„èŒƒ-Classæ–‡ä»¶æ ¼å¼ï¼šJDK8 Javaè™šæ‹Ÿæœºè§„èŒƒ-Classæ–‡ä»¶æ ¼å¼ï¼šJDK13 ä»¥ä¸‹æ˜¯ç¬¬å…­ç«  ç±»æ–‡ä»¶ç»“æ„çš„å†…å®¹ 1 Classç±»æ–‡ä»¶çš„ç»“æ„Classæ–‡ä»¶æ˜¯ä¸€ç»„ä»¥8ä¸ªå­—èŠ‚ä¸ºåŸºç¡€å•ä½çš„äºŒè¿›åˆ¶æµï¼Œå„ä¸ªæ•°æ®é¡¹éƒ½æ˜¯ç´§å‡‘æ’åˆ—çš„ï¼Œå¦‚æœæœ‰éœ€è¦å ç”¨8ä¸ªå­—èŠ‚ä»¥ä¸Šçš„æ•°æ®é¡¹æ—¶ï¼Œä¼šæŒ‰ç…§é«˜ä½åœ¨å‰çš„æ–¹å¼åˆ†å‰²æˆå¤šä¸ª8å­—èŠ‚è¿›è¡Œå­˜å‚¨ã€‚ Classæ–‡ä»¶æ ¼å¼é‡‡ç”¨ä¸€ç§ç±»ä¼¼äºCè¯­è¨€ç»“æ„ä½“çš„ä¼ªç»“æ„æ¥å­˜å‚¨æ•°æ®ï¼Œè¿™ç§ä¼ªç»“æ„ä¸­åªæœ‰ä¸¤ç§æ•°æ®ç±»å‹â€”â€”â€œæ— ç¬¦å·æ•°â€å’Œâ€œè¡¨â€ï¼š æ— ç¬¦å·æ•°ï¼šåŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä»¥u1ã€u2ã€u4ã€u8æ¥åˆ†åˆ«ä»£è¡¨1ä¸ªå­—èŠ‚ã€2ä¸ªå­—èŠ‚ã€4ä¸ªå­—èŠ‚å’Œ8ä¸ªå­—èŠ‚çš„æ— ç¬¦å·æ•°ï¼Œæ— ç¬¦å·æ•°å¯ä»¥ç”¨æ¥æè¿°æ•°å­—ã€ç´¢å¼•å¼•ç”¨ã€æ•°é‡å€¼æˆ–è€…æŒ‰ç…§UTF-8ç¼–ç æ„æˆå­—ç¬¦ä¸²å€¼ã€‚ è¡¨ï¼šç”±å¤šä¸ªæ— ç¬¦å·æ•°æˆ–è€…å…¶ä»–è¡¨ä½œä¸ºæ•°æ®é¡¹æ„æˆçš„å¤åˆæ•°æ®ç±»å‹ï¼Œä¸ºäº†ä¾¿äºåŒºåˆ†ï¼Œæ‰€æœ‰è¡¨çš„å‘½åéƒ½ä¹ æƒ¯æ€§åœ°ä»¥â€œ_infoâ€ç»“å°¾ã€‚ Classæ–‡ä»¶ç”±ä»¥ä¸‹è¿™äº›æ•°æ®é¡¹ç»„æˆï¼š ç±»å‹ åç§° æ•°é‡ u4 magic 1 u2 minor_version 1 u2 major_version 1 u2 constant_pool_count 1 cp_info constant_pool constant_pool_count-1 u2 access_flags 1 u2 this_class 1 u2 super_class 1 u2 interfaces_count 1 u2 interfaces interfaces_count u2 fields_count 1 field_info fields fields_count u2 methods_count 1 method_info methods methods_count u2 attributes_count 1 attribute_info attributes attributes_count 1.1 é­”æ•°ä¸Classæ–‡ä»¶çš„ç‰ˆæœ¬æ¯ä¸ªClassæ–‡ä»¶çš„å¤´4ä¸ªå­—èŠ‚è¢«ç§°ä¸ºé­”æ•°ï¼ˆMagic Numberï¼‰ï¼Œå®ƒçš„å”¯ä¸€ä½œç”¨æ˜¯ç¡®å®šè¿™ä¸ªæ–‡ä»¶æ˜¯å¦ä¸ºä¸€ä¸ªèƒ½è¢«è™šæ‹Ÿæœºæ¥å—çš„Classæ–‡ä»¶ã€‚å¾ˆå¤šæ–‡ä»¶æ ¼å¼æ ‡å‡†éƒ½ä¼šç”¨é­”æ•°æ¥ç¡®è®¤æ–‡ä»¶æ ¼å¼ï¼Œä½¿ç”¨é­”æ•°è€Œä¸æ˜¯æ‰©å±•åæ¥è¿›è¡Œè¯†åˆ«ä¸»è¦æ˜¯åŸºäºå®‰å…¨è€ƒè™‘ï¼Œå› ä¸ºæ–‡ä»¶æ‰©å±•åå¯ä»¥éšæ„æ”¹åŠ¨ã€‚Classæ–‡ä»¶çš„é­”æ•°å€¼ä¸º0xCAFEBABEï¼ˆå’–å•¡å®è´ï¼‰ã€‚ ç´§æ¥ç€é­”æ•°çš„4ä¸ªå­—èŠ‚å­˜å‚¨çš„æ˜¯Classæ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼šç¬¬5å’Œç¬¬6ä¸ªå­—èŠ‚æ˜¯æ¬¡ç‰ˆæœ¬å·ï¼ˆMinor Versionï¼‰ï¼Œç¬¬7å’Œç¬¬8ä¸ªå­—èŠ‚æ˜¯ä¸»ç‰ˆæœ¬å·ï¼ˆMajor Versionï¼‰ã€‚Javaçš„ä¸»ç‰ˆæœ¬å·æ˜¯ä»45å¼€å§‹çš„ï¼ŒJDK 1.1ä¹‹åçš„æ¯ä¸ªJDKå¤§ç‰ˆæœ¬å‘å¸ƒä¸»ç‰ˆæœ¬å·å‘ä¸ŠåŠ 1ï¼ˆJDK 1.0ï½1.1ä½¿ç”¨äº†45.0ï½45.3çš„ç‰ˆæœ¬å·ï¼‰ï¼Œé«˜ç‰ˆæœ¬çš„JDKèƒ½å‘ä¸‹å…¼å®¹ä»¥å‰ç‰ˆæœ¬çš„Classæ–‡ä»¶ï¼Œä½†ä¸èƒ½è¿è¡Œä»¥åç‰ˆæœ¬çš„Classæ–‡ä»¶ã€‚ Java1ï¼š45Java4ï¼š48Java5ï¼š49Java8ï¼š52ä»¥æ­¤ç±»æ¨ å…³äºæ¬¡ç‰ˆæœ¬å·ï¼Œæ›¾ç»åœ¨Java 2å‡ºç°å‰è¢«çŸ­æš‚ä½¿ç”¨è¿‡ï¼Œä»JDK 1.2ä»¥åï¼Œç›´åˆ°JDK 12ä¹‹å‰æ¬¡ç‰ˆæœ¬å·å‡æœªä½¿ç”¨ï¼Œå…¨éƒ¨å›ºå®šä¸ºé›¶ã€‚è€Œåˆ°äº†JDK 12æ—¶æœŸï¼Œç”±äºJDKæä¾›çš„åŠŸèƒ½é›†å·²ç»éå¸¸åºå¤§ï¼Œæœ‰ä¸€äº›å¤æ‚çš„æ–°ç‰¹æ€§éœ€è¦ä»¥â€œå…¬æµ‹â€çš„å½¢å¼æ”¾å‡ºï¼Œæ‰€ä»¥è®¾è®¡è€…é‡æ–°å¯ç”¨äº†å‰¯ç‰ˆæœ¬å·ï¼Œå°†å®ƒç”¨äºæ ‡è¯†â€œæŠ€æœ¯é¢„è§ˆç‰ˆâ€åŠŸèƒ½ç‰¹æ€§çš„æ”¯æŒã€‚å¦‚æœClassæ–‡ä»¶ä¸­ä½¿ç”¨äº†è¯¥ç‰ˆæœ¬JDKå°šæœªåˆ—å…¥æ­£å¼ç‰¹æ€§æ¸…å•ä¸­çš„é¢„è§ˆåŠŸèƒ½ï¼Œåˆ™å¿…é¡»æŠŠæ¬¡ç‰ˆæœ¬å·æ ‡è¯†ä¸º65535ï¼Œä»¥ä¾¿Javaè™šæ‹Ÿæœºåœ¨åŠ è½½ç±»æ–‡ä»¶æ—¶èƒ½å¤ŸåŒºåˆ†å‡ºæ¥ã€‚ JDKç‰ˆæœ¬ -targetå‚æ•° -sourceå‚æ•° ç‰ˆæœ¬å· JDK 1.1.8 ä¸æ”¯æŒtargetå‚æ•° ä¸æ”¯æŒsourceå‚æ•° 45.3 JDK 1.2.2 ä¸å¸¦ï¼ˆé»˜è®¤ä¸º-target 1.1ï¼‰ 1.1~1.2 45.3 JDK 1.2.2 -target 1.2 1.1~1.2 46.0 JDK 1.3.1_19 ä¸å¸¦ï¼ˆé»˜è®¤ä¸º-target 1.1) 1.1~1.3 45.3 JDK 1.3.1_19 -target 1.3 1.1~1.3 47.0 JDK 1.4.2_10 ä¸å¸¦ï¼ˆé»˜è®¤ä¸º-target 1.2ï¼‰ 1.1~1.4 46.0 JDK 1.4.2_10 -target 1.4 1.1~1.4 48.0 JDK 5.0_11 ä¸å¸¦ï¼ˆé»˜è®¤ä¸º-target 1.5ï¼‰ï¼Œåç»­ç‰ˆæœ¬ä¸å¸¦targetå‚æ•°é»˜è®¤ç¼–è¯‘çš„Classæ–‡ä»¶å‡ä¸å…¶JDKç‰ˆæœ¬ç›¸åŒ 11ï½15 49.0 JDK 5.0_11 -target 1.4 -source 1.4 1.1~1.5 48.0 JDK 6 ä¸å¸¦ï¼ˆé»˜è®¤ä¸º-target 6ï¼‰ 1.1~6 50.0 JDK 7 ä¸å¸¦ï¼ˆé»˜è®¤ä¸º-target 7ï¼‰ 1.1ï½7 51.0 JDK 8 ä¸å¸¦ï¼ˆé»˜è®¤ä¸º-target 8) 1.1~8 52.0 JDK 9 ä¸å¸¦ï¼ˆé»˜è®¤ä¸º-target 9ï¼‰ 6ï½9 53.0 JDK 10 ä¸å¸¦ï¼ˆé»˜è®¤ä¸º-target 10ï¼‰ 6~10 54.0 JDK 11 ä¸å¸¦ï¼ˆé»˜è®¤ä¸º-target 11ï¼‰ 6~11 55.0 JDK 12 ä¸å¸¦ï¼ˆé»˜è®¤ä¸º-target 12ï¼‰ 6~12 56.0 JDK 13 ä¸å¸¦ï¼ˆé»˜è®¤ä¸º-target 13ï¼‰ 6~13 57.0 1.2 å¸¸é‡æ± 8~9å­—èŠ‚æ˜¯ä¸€é¡¹u2ç±»å‹çš„æ•°æ®ï¼Œä»£è¡¨å¸¸é‡æ± å®¹é‡è®¡æ•°å€¼ï¼ˆå¸¸é‡æ± æœ‰å¤šå°‘é¡¹ï¼‰ï¼Œè¿™ä¸ªå®¹é‡è®¡æ•°æ˜¯ä»1è€Œä¸æ˜¯0å¼€å§‹çš„ã€‚ å¸¸é‡æ± ä¸­ä¸»è¦å­˜æ”¾ä¸¤å¤§ç±»å¸¸é‡ï¼šå­—é¢é‡ï¼ˆLiteralï¼‰å’Œç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referencesï¼‰ã€‚å­—é¢é‡æ¯”è¾ƒæ¥è¿‘äºJavaè¯­è¨€å±‚é¢çš„å¸¸é‡æ¦‚å¿µï¼Œå¦‚æ–‡æœ¬å­—ç¬¦ä¸²ã€è¢«å£°æ˜ä¸ºfinalçš„å¸¸é‡å€¼ç­‰ã€‚è€Œç¬¦å·å¼•ç”¨åˆ™å±äºç¼–è¯‘åŸç†æ–¹é¢çš„æ¦‚å¿µï¼Œä¸»è¦åŒ…æ‹¬ä¸‹é¢å‡ ç±»å¸¸é‡ï¼š è¢«æ¨¡å—å¯¼å‡ºæˆ–è€…å¼€æ”¾çš„åŒ…ï¼ˆPackageï¼‰ ç±»å’Œæ¥å£çš„å…¨é™å®šåï¼ˆFully Qualified Nameï¼‰ å­—æ®µçš„åç§°å’Œæè¿°ç¬¦ï¼ˆDescriptorï¼‰ æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦ æ–¹æ³•å¥æŸ„å’Œæ–¹æ³•ç±»å‹ï¼ˆMethod Handleã€Method Typeã€Invoke Dynamicï¼‰ åŠ¨æ€è°ƒç”¨ç‚¹å’ŒåŠ¨æ€å¸¸é‡ï¼ˆDynamically-Computed Call Siteã€Dynamically-Computed Constantï¼‰ æœ€åˆå¸¸é‡è¡¨ä¸­å…±æœ‰11ç§ç»“æ„å„ä¸ç›¸åŒçš„è¡¨ç»“æ„æ•°æ®ï¼Œåæ¥ä¸ºäº†æ›´å¥½åœ°æ”¯æŒåŠ¨æ€è¯­è¨€è°ƒç”¨ï¼Œé¢å¤–å¢åŠ äº†4ç§åŠ¨æ€è¯­è¨€ç›¸å…³çš„å¸¸é‡ï¼Œä¸ºäº†æ”¯æŒJavaæ¨¡å—åŒ–ç³»ç»Ÿï¼ˆJigsawï¼‰ï¼ŒåˆåŠ å…¥äº†CONSTANT_Module_infoå’ŒCONSTANT_Package_infoä¸¤ä¸ªå¸¸é‡ï¼Œæ‰€ä»¥æˆªè‡³JDK13ï¼Œå¸¸é‡è¡¨ä¸­åˆ†åˆ«æœ‰17ç§ä¸åŒç±»å‹çš„å¸¸é‡ã€‚ è¿™17ç±»è¡¨éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼Œè¡¨ç»“æ„èµ·å§‹çš„ç¬¬ä¸€ä½æ˜¯ä¸ªu1ç±»å‹çš„æ ‡å¿—ä½ï¼ˆtagï¼Œå–å€¼è§ä¸‹è¡¨æ ‡å¿—åˆ—ï¼‰ï¼Œä»£è¡¨ç€å½“å‰å¸¸é‡å±äºå“ªç§å¸¸é‡ç±»å‹ã€‚17ç§å¸¸é‡ç±»å‹æ‰€ä»£è¡¨çš„å…·ä½“å«ä¹‰å¦‚è¡¨æ‰€ç¤ºã€‚ ç±»å‹ æ ‡å¿— æè¿° CONSTANT_Utf8_info 1 UTF-8ç¼–ç çš„å­—ç¬¦ä¸² CONSTANT_Integer_info 3 æ•´å‹å­—é¢é‡ CONSTANT_Float_info 4 æµ®ç‚¹å‹å­—é¢é‡ CONSTANT_Long_info 5 é•¿æ•´å‹å­—é¢é‡ CONSTANT_Double_info 6 åŒç²¾åº¦æµ®ç‚¹å‹å­—é¢é‡ CONSTANT_Class_info 7 ç±»æˆ–æ¥å£çš„ç¬¦å·å¼•ç”¨ CONSTANT_String_info 8 å­—ç¬¦ä¸²ç±»å‹å­—é¢é‡ CONSTANT_Fieldref_info 9 å­—æ®µçš„ç¬¦å·å¼•ç”¨ CONSTANT_Methodref_info 10 ç±»ä¸­æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ CONSTANT_InterfaceMethodref_info 11 æ¥å£ä¸­æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ CONSTANT_NameAndType_info 12 å­—æ®µæˆ–æ–¹æ³•çš„éƒ¨åˆ†ç¬¦å·å¼•ç”¨ CONSTANT_MethodHandle_info 15 è¡¨ç¤ºæ–¹æ³•å¥æŸ„ CONSTANT_MethodType_info 16 è¡¨ç¤ºæ–¹æ³•ç±»å‹ CONSTANT_Dynamic_info 17 è¡¨ç¤ºä¸€ä¸ªåŠ¨æ€è®¡ç®—å¸¸é‡ CONSTANT_InvokeDynamic_info 18 è¡¨ç¤ºä¸€ä¸ªåŠ¨æ€æ–¹æ³•è°ƒç”¨ç‚¹ CONSTANT_Module_info 19 è¡¨ç¤ºä¸€ä¸ªæ¨¡å— CONSTANT_Package_info 20 è¡¨ç¤ºä¸€ä¸ªæ¨¡å—ä¸­å¼€æ”¾æˆ–è€…å¯¼å‡ºçš„åŒ…ã€‚ å¸¸é‡æ± ä¸­çš„17ç§æ•°æ®ç±»å‹çš„ç»“æ„æ€»è¡¨ï¼š å¸¸é‡ é¡¹ç›® ç±»å‹ æè¿° CONSTANT_Utf8_info tag u1 å€¼ä¸º1 length&nbsp; u2 UTF-8ç¼–ç çš„å­—ç¬¦ä¸²å ç”¨çš„å­—èŠ‚æ•° bytes&nbsp; u1 é•¿åº¦ä¸ºlengthçš„UTF-8ç¼–ç çš„å­—ç¬¦ä¸² CONSTANT_Integer_info tag u1 å€¼ä¸º3 bytes&nbsp; u4 æŒ‰ç…§é«˜ä½åœ¨å‰å­˜å‚¨çš„intå€¼ CONSTANT_Float_info tag u1 å€¼ä¸º4 bytes&nbsp; u4 æŒ‰ç…§é«˜ä½åœ¨å‰å­˜å‚¨çš„floatå€¼ CONSTANT_Long_info tag u1 å€¼ä¸º5 bytes&nbsp; u8 æŒ‰ç…§é«˜ä½åœ¨å‰å­˜å‚¨çš„longå€¼ CONSTANT_Double_info tag u1 å€¼ä¸º6 bytes&nbsp; u8 æŒ‰ç…§é«˜ä½åœ¨å‰å­˜å‚¨çš„doubleå€¼ CONSTANT_Class_info tag u1 å€¼ä¸º7 index u2 æŒ‡å‘å…¨é™å®šåå¸¸é‡é¡¹çš„ç´¢å¼• CONSTANT_String_info tag u1 å€¼ä¸º8 index u2 æŒ‡å‘å­—ç¬¦ä¸²å­—é¢é‡çš„ç´¢å¼• CONSTANT_Fieldref_info tag u1 å€¼ä¸º9 index u2 æŒ‡å‘å£°æ˜å­—æ®µçš„ç±»æˆ–è€…æ¥å£æè¿°ç¬¦CONSTANT_Class_infoçš„ç´¢å¼•é¡¹ index u2 æŒ‡å‘å­—æ®µæè¿°ç¬¦CONSTANT_NameAndTypeçš„ç´¢å¼•é¡¹ CONSTANT_Methodref_info tag u1 å€¼ä¸º10 index u2 æŒ‡å‘å£°æ˜æ–¹æ³•çš„ç±»æè¿°ç¬¦CONSTANT_Class_infoçš„ç´¢å¼•é¡¹ index u2 æŒ‡å‘åç§°åŠç±»å‹æè¿°ç¬¦CONSTANT_NameAndTypeçš„ç´¢å¼•é¡¹ CONSTANT_InterfaceMethodref_info tag u1 å€¼ä¸º11 index u2 æŒ‡å‘å£°æ˜æ–¹æ³•çš„æ¥å£æè¿°ç¬¦CONSTANT_Class_infoçš„ç´¢å¼•é¡¹ index u2 æŒ‡å‘åç§°åŠç±»å‹æè¿°ç¬¦CONSTANT_NameAndTypeçš„ç´¢å¼•é¡¹ CONSTANT_NameAndType_info tag u1 å€¼ä¸º12 index u2 æŒ‡å‘è¯¥å­—æ®µæˆ–æ–¹æ³•åç§°å¸¸é‡é¡¹çš„ç´¢å¼• index u2 æŒ‡å‘è¯¥å­—æ®µæˆ–æ–¹æ³•æè¿°ç¬¦å¸¸é‡é¡¹çš„ç´¢å¼• CONSTANT_MethodHandle_info tag u1 å€¼ä¸º15 reference_kind u1 å€¼å¿…é¡»åœ¨1è‡³9ä¹‹é—´ï¼ˆåŒ…æ‹¬1å’Œ9ï¼‰ï¼Œå®ƒå†³å®šäº†æ–¹æ³•å¥æŸ„çš„ç±»å‹ã€‚æ–¹æ³•å¥æŸ„ç±»å‹çš„å€¼è¡¨ç¤ºæ–¹æ³•å¥æŸ„çš„å­—èŠ‚ç è¡Œä¸º reference_index u2 å€¼å¿…é¡»æ˜¯å¯¹å¸¸é‡æ± çš„æœ‰æ•ˆç´¢å¼• CONSTANT_MethodType_info tag u1 å€¼ä¸º16 descriptor_index u2 å€¼å¿…é¡»æ˜¯å¯¹å¸¸é‡æ± çš„æœ‰æ•ˆç´¢å¼•ï¼Œå¸¸é‡æ± åœ¨è¯¥ç´¢å¼•å¤„çš„é¡¹å¿…é¡»æ˜¯CONSTANT_Utf8_infoç»“æ„ï¼Œè¡¨ç¤ºæ–¹æ³•çš„æè¿°ç¬¦ CONSTANT_Dynamic_info tag u1 å€¼ä¸º17 bootstrap_method_attr_ index u2 å€¼å¿…é¡»æ˜¯å¯¹å½“å‰Classæ–‡ä»¶ä¸­å¼•å¯¼æ–¹æ³•è¡¨çš„bootstrap_methods[]æ•°ç»„çš„æœ‰æ•ˆç´¢å¼• name_and_type_index u2 å€¼å¿…é¡»æ˜¯å¯¹å½“å‰å¸¸é‡æ± çš„æœ‰æ•ˆç´¢å¼•ï¼Œå¸¸é‡æ± åœ¨è¯¥ç´¢å¼•å¤„çš„é¡¹å¿…é¡»æ˜¯CONSTANT_NameAndType_infoç»“æ„ï¼Œè¡¨ç¤ºæ–¹æ³•åå’Œæ–¹æ³•æè¿°ç¬¦ã€‚ CONSTANT_InvokeDynamic_info tag u1 å€¼ä¸º18 bootstrap_method_attr_ index u2 å€¼å¿…é¡»æ˜¯å¯¹å½“å‰Classæ–‡ä»¶ä¸­å¼•å¯¼æ–¹æ³•è¡¨çš„bootstrap_methods[]æ•°ç»„çš„æœ‰æ•ˆç´¢å¼• name_and_type_index u2 å€¼å¿…é¡»æ˜¯å¯¹å½“å‰å¸¸é‡æ± çš„æœ‰æ•ˆç´¢å¼•ï¼Œå¸¸é‡æ± åœ¨è¯¥ç´¢å¼•å¤„çš„é¡¹å¿…é¡»æ˜¯CONSTANT_NameAndType_infoç»“æ„ï¼Œè¡¨ç¤ºæ–¹æ³•åå’Œæ–¹æ³•æè¿°ç¬¦ã€‚ CONSTANT_Module_info tag u1 å€¼ä¸º19 name_index u2 å€¼å¿…é¡»æ˜¯å¯¹å¸¸é‡æ± çš„æœ‰æ•ˆç´¢å¼•ï¼Œå¸¸é‡æ± åœ¨è¯¥ç´¢å¼•å¤„çš„é¡¹å¿…é¡»æ˜¯CONSTANT_Utf8_infoç»“æ„ï¼Œè¡¨ç¤ºæ¨¡å—åå­— CONSTANT_Package_info tag u1 å€¼ä¸º20 name_index u2 å€¼å¿…é¡»æ˜¯å¯¹å¸¸é‡æ± çš„æœ‰æ•ˆç´¢å¼•ï¼Œå¸¸é‡æ± åœ¨è¯¥ç´¢å¼•å¤„çš„é¡¹å¿…é¡»æ˜¯CONSTANT_Utf8_infoç»“æ„ï¼Œè¡¨ç¤ºåŒ…åç§° 1.3 è®¿é—®æ ‡å¿—åœ¨å¸¸é‡æ± ç»“æŸä¹‹åï¼Œç´§æ¥ç€çš„2ä¸ªå­—èŠ‚ä»£è¡¨è®¿é—®æ ‡å¿—ï¼ˆaccess_flagsï¼‰ï¼Œè¿™ä¸ªæ ‡å¿—ç”¨äºè¯†åˆ«ä¸€äº›ç±»æˆ–è€…æ¥å£å±‚æ¬¡çš„è®¿é—®ä¿¡æ¯ æ ‡å¿—åç§° æ ‡å¿—å€¼ å«ä¹‰ ACC_PUBLIC 0x0001 æ˜¯å¦ä¸ºpublicç±»å‹ ACC_FINAL 0x0010 æ˜¯å¦è¢«å£°æ˜ä¸ºfinalï¼Œåªæœ‰ç±»å¯è®¾ç½® ACC_SUPER 0x0020 æ˜¯å¦å…è®¸ä½¿ç”¨invokespecialå­—èŠ‚ç æŒ‡ä»¤çš„æ–°è¯­ä¹‰ï¼ŒinvokespecialæŒ‡ä»¤çš„è¯­ä¹‰åœ¨JDK1.0.2å‘ç”Ÿè¿‡æ”¹å˜ï¼Œä¸ºäº†åŒºåˆ«è¿™æ¡æŒ‡ä»¤ä½¿ç”¨å“ªç§è¯­ä¹‰ï¼ŒJDK1.0.2ä¹‹åç¼–è¯‘å‡ºæ¥çš„ç±»çš„è¿™ä¸ªæ ‡å¿—éƒ½å¿…é¡»ä¸ºçœŸ ACC_INTERFACE 0X0200 æ ‡è¯†è¿™æ˜¯ä¸€ä¸ªæ¥å£ ACC_ABSTRACT 0X0400 æ˜¯å¦ä¸ºabstractç±»å‹ï¼Œå¯¹äºæ¥å£æˆ–è€…æŠ½è±¡ç±»æ¥è¯´ï¼Œæ­¤æ ‡å¿—å€¼ä¸ºçœŸï¼Œå…¶ä»–ç±»å‹å€¼ä¸ºå‡ ACC_SYNTHETIC 0x1000 æ ‡è¯†è¿™ä¸ªç±»å¹¶éç”±ç”¨æˆ·ä»£ç äº§ç”Ÿçš„ ACC_ANNOTATION 0X2000 æ ‡è¯†è¿™æ˜¯ä¸€ä¸ªæ³¨è§£ ACC_ENUM 0x4000 æ ‡è¯†è¿™æ˜¯ä¸€ä¸ªæšä¸¾ ACC_MODULE 0x8000 æ ‡è¯†è¿™æ˜¯ä¸€ä¸ªæ¨¡å— access_flagsä¸­ä¸€å…±æœ‰16ä¸ªæ ‡å¿—ä½å¯ä»¥ä½¿ç”¨ï¼Œå½“å‰åªå®šä¹‰äº†å…¶ä¸­9ä¸ªï¼Œæ²¡æœ‰ä½¿ç”¨åˆ°çš„æ ‡å¿—ä½è¦æ±‚ä¸€å¾‹ä¸ºé›¶ã€‚ 1.4 ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ä¸æ¥å£ç´¢å¼•é›†åˆè·Ÿåœ¨è®¿é—®æ ‡å¿—åé¢çš„ï¼Œåˆ†åˆ«æ˜¯ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•å’Œæ¥å£ç´¢å¼•é›†åˆã€‚ç±»ç´¢å¼•ï¼ˆthis_classï¼‰å’Œçˆ¶ç±»ç´¢å¼•ï¼ˆsuper_classï¼‰éƒ½æ˜¯ä¸€ä¸ªu2ç±»å‹çš„æ•°æ®ï¼Œè€Œæ¥å£ç´¢å¼•é›†åˆï¼ˆinterfacesï¼‰æ˜¯ä¸€ç»„u2ç±»å‹çš„æ•°æ®çš„é›†åˆï¼ŒClassæ–‡ä»¶ä¸­ç”±è¿™ä¸‰é¡¹æ•°æ®æ¥ç¡®å®šè¯¥ç±»å‹çš„ç»§æ‰¿å…³ç³»ã€‚ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„å…¨é™å®šåï¼Œçˆ¶ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„çˆ¶ç±»çš„å…¨é™å®šåã€‚é™¤äº†java.lang.Objectå¤–ï¼Œæ‰€æœ‰Javaç±»çš„çˆ¶ç±»ç´¢å¼•éƒ½ä¸ä¸º0ã€‚æ¥å£ç´¢å¼•é›†åˆå°±ç”¨æ¥æè¿°è¿™ä¸ªç±»å®ç°äº†å“ªäº›æ¥å£ï¼Œè¿™äº›è¢«å®ç°çš„æ¥å£å°†æŒ‰implementså…³é”®å­—åçš„æ¥å£é¡ºåºä»å·¦åˆ°å³æ’åˆ—åœ¨æ¥å£ç´¢å¼•é›†åˆä¸­ã€‚ ç±»ç´¢å¼•å’Œçˆ¶ç±»ç´¢å¼•ç”¨ä¸¤ä¸ªu2ç±»å‹çš„ç´¢å¼•å€¼è¡¨ç¤ºï¼Œå®ƒä»¬å„è‡ªæŒ‡å‘ä¸€ä¸ªç±»å‹ä¸ºCONSTANT_Class_infoçš„ç±»æè¿°ç¬¦å¸¸é‡ï¼Œé€šè¿‡CONSTANT_Class_infoç±»å‹çš„å¸¸é‡ä¸­çš„ç´¢å¼•å€¼å¯ä»¥æ‰¾åˆ°å®šä¹‰åœ¨CONSTANT_Utf8_infoç±»å‹çš„å¸¸é‡ä¸­çš„å…¨é™å®šåå­—ç¬¦ä¸²ã€‚ æ¥å£ç´¢å¼•é›†åˆçš„å…¥å£çš„ç¬¬ä¸€é¡¹u2ç±»å‹çš„æ•°æ®ä¸ºæ¥å£è®¡æ•°å™¨ï¼ˆinterfaces_countï¼‰ï¼Œè¡¨ç¤ºç´¢å¼•è¡¨çš„å®¹é‡ã€‚ 1.5 å­—æ®µè¡¨é›†åˆå­—æ®µè¡¨ï¼ˆfield_infoï¼‰ç”¨äºæè¿°æ¥å£æˆ–è€…ç±»ä¸­å£°æ˜çš„å˜é‡ï¼ŒåŒ…æ‹¬ç±»çº§å˜é‡ä»¥åŠå®ä¾‹çº§å˜é‡ã€‚ å­—æ®µè¡¨ç»“æ„: ç±»å‹ åç§° æ•°é‡ u2 access_flags 1 u2 name_index 1 u2 discriptor_index 1 u2 attributes_count 1 attribute_info attributes attributes_count å…¶ä¸­access_flagsä»£è¡¨å­—æ®µä¿®é¥°ç¬¦ï¼Œå«ä¹‰å¦‚ä¸‹ æ ‡å¿—åç§° æ ‡å¿—å€¼ å«ä¹‰ ACC_PUBLIC 0x0001 å­—æ®µæ˜¯å¦public ACC_PRIVATE 0x0002 å­—æ®µæ˜¯å¦private ACC_PROTECTED 0x0004 å­—æ®µæ˜¯å¦protected ACC_STATIC 0x0008 å­—æ®µæ˜¯å¦static ACC_FINAL 0x0010 å­—æ®µæ˜¯å¦final ACC_VOLATILE 0x0040 å­—æ®µæ˜¯å¦volatile ACC_TRANSIENT 0x0080 å­—æ®µæ˜¯å¦transient ACC_SYNTHETIC 0x1000 å­—æ®µæ˜¯å¦ç”±ç¼–è¯‘å™¨è‡ªåŠ¨äº§ç”Ÿ ACC_ENUM 0x4000 å­—æ®µæ˜¯å¦enum è·Ÿéšaccess_flagsæ ‡å¿—çš„æ˜¯ä¸¤é¡¹ç´¢å¼•å€¼ï¼šname_indexå’Œdescriptor_indexã€‚å®ƒä»¬éƒ½æ˜¯å¯¹å¸¸é‡æ± é¡¹çš„å¼•ç”¨ï¼Œåˆ†åˆ«ä»£è¡¨ç€å­—æ®µçš„ç®€å•åç§°ä»¥åŠå­—æ®µå’Œæ–¹æ³•çš„æè¿°ç¬¦ã€‚ æ¦‚å¿µè§£æï¼š å…¨é™å®šåï¼šâ€org/fenixsoft/clazz/TestClassâ€ï¼ŒæŠŠç±»å…¨åä¸­çš„â€.â€æ›¿æ¢æˆäº†â€/â€œï¼Œæœ€åä¸€èˆ¬ä¼šåŠ å…¥ä¸€ä¸ªâ€œ;â€å·è¡¨ç¤ºå…¨é™å®šåç»“æŸ ç®€å•åç§°ï¼šæ²¡æœ‰ç±»å‹å’Œå‚æ•°ä¿®é¥°çš„æ–¹æ³•æˆ–è€…å­—æ®µåç§° æè¿°ç¬¦ï¼šæè¿°å­—æ®µçš„æ•°æ®ç±»å‹ã€æ–¹æ³•çš„å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹ä»¥åŠä»£è¡¨æ— è¿”å›å€¼çš„voidç±»å‹éƒ½ç”¨ä¸€ä¸ªå¤§å†™å­—ç¬¦æ¥è¡¨ç¤ºï¼Œè€Œå¯¹è±¡ç±»å‹åˆ™ç”¨å­—ç¬¦LåŠ å¯¹è±¡çš„å…¨é™å®šåæ¥è¡¨ç¤ºï¼š æ ‡è¯†å­—ç¬¦ å«ä¹‰ B åŸºæœ¬ç±»å‹byte C åŸºæœ¬ç±»å‹char D åŸºæœ¬ç±»å‹double F åŸºæœ¬ç±»å‹float I åŸºæœ¬ç±»å‹int J åŸºæœ¬ç±»å‹long S åŸºæœ¬ç±»å‹short Z åŸºæœ¬ç±»å‹boolean V ç‰¹æ®Šç±»å‹void L å¯¹è±¡ç±»å‹ï¼Œå¦‚Ljava/lang/Object; å¯¹äºæ•°ç»„ç±»å‹ï¼Œæ¯ä¸€ç»´åº¦å°†ä½¿ç”¨ä¸€ä¸ªå‰ç½®çš„â€[â€œå­—ç¬¦æ¥æè¿°ï¼Œå¦‚ä¸€ä¸ªå®šä¹‰ä¸ºâ€java.lang.String[][]â€ç±»å‹çš„äºŒç»´æ•°ç»„å°†è¢«è®°å½•æˆâ€[[Ljava/lang/String;â€œ ç”¨æè¿°ç¬¦æ¥æè¿°æ–¹æ³•æ—¶ï¼ŒæŒ‰ç…§å…ˆå‚æ•°åˆ—è¡¨ã€åè¿”å›å€¼çš„é¡ºåºæè¿°ï¼Œå‚æ•°åˆ—è¡¨æŒ‰ç…§å‚æ•°çš„ä¸¥æ ¼é¡ºåºæ”¾åœ¨ä¸€ç»„å°æ‹¬å·â€œ()â€ä¹‹å†…ã€‚å¦‚æ–¹æ³•void inc()çš„æè¿°ç¬¦ä¸ºâ€œ()Vâ€ï¼Œæ–¹æ³•java.lang.String toString()çš„æè¿°ç¬¦ä¸ºâ€œ()Ljava/lang/String;â€ã€‚ å­—æ®µè¡¨é›†åˆä¸­ä¸ä¼šåˆ—å‡ºä»çˆ¶ç±»æˆ–è€…çˆ¶æ¥å£ä¸­ç»§æ‰¿è€Œæ¥çš„å­—æ®µï¼Œä½†æœ‰å¯èƒ½å‡ºç°åŸæœ¬Javaä»£ç ä¹‹ä¸­ä¸å­˜åœ¨çš„å­—æ®µï¼Œè­¬å¦‚åœ¨å†…éƒ¨ç±»ä¸­ä¸ºäº†ä¿æŒå¯¹å¤–éƒ¨ç±»çš„è®¿é—®æ€§ï¼Œç¼–è¯‘å™¨å°±ä¼šè‡ªåŠ¨æ·»åŠ æŒ‡å‘å¤–éƒ¨ç±»å®ä¾‹çš„å­—æ®µã€‚ 1.6 æ–¹æ³•è¡¨é›†åˆClassæ–‡ä»¶ä¸­æ–¹æ³•è¡¨çš„ç»“æ„åŒå­—æ®µè¡¨å®Œå…¨ä¸€è‡´ï¼š ç±»å‹ åç§° æ•°é‡ u2 access_flags 1 u2 name_index 1 u2 discriptor_index 1 u2 attributes_count 1 attribute_info attributes attributes_count è®¿é—®æ ‡å¿—çš„å†…å®¹æœ‰æ‰€åŒºåˆ«ï¼š æ ‡å¿—åç§° æ ‡å¿—å€¼ å«ä¹‰ ACC_PUBLIC 0x0001 å­—æ®µæ˜¯å¦public ACC_PRIVATE 0x0002 å­—æ®µæ˜¯å¦private ACC_PROTECTED 0x0004 å­—æ®µæ˜¯å¦protected ACC_STATIC 0x0008 å­—æ®µæ˜¯å¦static ACC_FINAL 0x0010 å­—æ®µæ˜¯å¦final ACC_SYNCHRONIZED 0x0020 æ–¹æ³•æ˜¯å¦ä¸ºsynchronized ACC_BRIDGE 0x0040 æ–¹æ³•æ˜¯ä¸æ˜¯ç”±ç¼–è¯‘å™¨äº§ç”Ÿçš„æ¡¥æ¥æ–¹æ³• ACC_VARARGS 0x0080 æ–¹æ³•æ˜¯å¦æ¥å—ä¸å®šå‚æ•° ACC_NATIVE 0x0100 æ–¹æ³•æ˜¯å¦ä¸ºnative ACC_ABSTRACT 0x0400 æ–¹æ³•æ˜¯å¦ä¸ºabstract ACC_STRICT 0X0800 æ–¹æ³•æ˜¯å¦ä¸ºstrictfp ACC_SYNTHETIC 0x1000 æ–¹æ³•æ˜¯å¦ç”±ç¼–è¯‘å™¨è‡ªåŠ¨äº§ç”Ÿ æ–¹æ³•é‡Œçš„Javaä»£ç ï¼Œç»è¿‡Javacç¼–è¯‘å™¨ç¼–è¯‘æˆå­—èŠ‚ç æŒ‡ä»¤ä¹‹åï¼Œå­˜æ”¾åœ¨æ–¹æ³•å±æ€§è¡¨é›†åˆä¸­ä¸€ä¸ªåä¸ºâ€œCodeâ€çš„å±æ€§é‡Œé¢ 1.7 å±æ€§è¡¨é›†åˆClassæ–‡ä»¶ã€å­—æ®µè¡¨ã€æ–¹æ³•è¡¨éƒ½å¯ä»¥æºå¸¦è‡ªå·±çš„å±æ€§è¡¨é›†åˆï¼Œä»¥æè¿°æŸäº›åœºæ™¯ä¸“æœ‰çš„ä¿¡æ¯ã€‚ å±æ€§è¡¨ä¸å†è¦æ±‚å„ä¸ªå±æ€§è¡¨å…·æœ‰ä¸¥æ ¼é¡ºåºï¼Œç”šè‡³åªè¦ä¸ä¸å·²æœ‰å±æ€§åé‡å¤ï¼Œä»»ä½•äººå®ç°çš„ç¼–è¯‘å™¨éƒ½å¯ä»¥å‘å±æ€§è¡¨ä¸­å†™å…¥è‡ªå·±å®šä¹‰çš„å±æ€§ä¿¡æ¯ã€‚ ä¸ºäº†èƒ½æ­£ç¡®è§£æClassæ–‡ä»¶ï¼Œã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹æœ€åˆåªé¢„å®šä¹‰äº†9é¡¹æ‰€æœ‰Javaè™šæ‹Ÿæœºå®ç°éƒ½åº”å½“èƒ½è¯†åˆ«çš„å±æ€§ï¼Œè€Œåœ¨æœ€æ–°çš„ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹çš„Java SE 12ç‰ˆæœ¬ä¸­ï¼Œé¢„å®šä¹‰å±æ€§å·²ç»å¢åŠ åˆ°29é¡¹ï¼š å±æ€§åç§° ä½¿ç”¨ä½ç½® å«ä¹‰ Code æ–¹æ³•è¡¨ Javaä»£ç ç¼–è¯‘æˆçš„å­—èŠ‚ç æŒ‡ä»¤ Constant Value å­—æ®µè¡¨ ç”±finalå…³é”®å­—å®šä¹‰çš„å¸¸é‡å€¼ Deprecated ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨ è¢«å£°æ˜ä¸ºdeprecatedçš„æ–¹æ³•å’Œå­—æ®µ Exceptions æ–¹æ³•è¡¨ æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸åˆ—è¡¨ EnclosingMethod ç±»æ–‡ä»¶ ä»…å½“ä¸€ä¸ªç±»ä¸ºå±€éƒ¨ç±»æˆ–è€…åŒ¿åç±»æ—¶æ‰èƒ½æ‹¥æœ‰è¿™ä¸ªå±æ€§ï¼Œè¿™ä¸ªå±æ€§ç”¨äºæ ‡ç¤ºè¿™ä¸ªç±»æ‰€åœ¨çš„å¤–å›´æ–¹æ³• InnerClasses ç±»æ–‡ä»¶ å†…éƒ¨ç±»åˆ—è¡¨ LineNumberTable Codeå±æ€§ Javaæºç çš„è¡Œå·ä¸å­—èŠ‚ç æŒ‡ä»¤çš„å¯¹åº”å…³ç³» LocalVariableTable Codeå±æ€§ æ–¹æ³•çš„å±€éƒ¨å˜é‡æè¿° StackMapTable Codeå±æ€§ JDK 6ä¸­æ–°å¢çš„å±æ€§ï¼Œä¾›æ–°çš„ç±»å‹æ£€æŸ¥éªŒè¯å™¨ï¼ˆType Checker)æ£€æŸ¥å’Œå¤„ç†ç›®æ ‡æ–¹æ³•çš„å±€éƒ¨å˜é‡å’Œæ“ä½œæ•°æ ˆæ‰€éœ€è¦çš„ç±»å‹æ˜¯å¦åŒ¹é… Signature ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨ JDK 5ä¸­æ–°å¢çš„å±æ€§ï¼Œç”¨äºæ”¯æŒèŒƒå‹æƒ…å†µä¸‹çš„æ–¹æ³•ç­¾åã€‚åœ¨Javaè¯­è¨€ä¸­ï¼Œä»»ä½•ç±»ã€æ¥å£ã€åˆå§‹åŒ–æ–¹æ³•æˆ–æˆå‘˜çš„æ³›å‹ç­¾åå¦‚æœåŒ…å«äº†ç±»å‹å˜é‡ï¼ˆTypeVariables)æˆ–å‚æ•°åŒ–ç±»å‹ï¼ˆParameterized Types)ï¼Œåˆ™Signatureå±æ€§ä¼šä¸ºå®ƒè®°å½•æ³›å‹ç­¾åä¿¡æ¯ã€‚ç”±äºJavaçš„èŒƒå‹é‡‡ç”¨æ“¦é™¤æ³•å®ç°ï¼Œä¸ºäº†é¿å…ç±»å‹ä¿¡æ¯è¢«æ“¦é™¤åå¯¼è‡´ç­¾åæ··ä¹±ï¼Œéœ€è¦è¿™ä¸ªå±æ€§è®°å½•èŒƒå‹ä¸­çš„ç›¸å…³ä¿¡æ¯ SourceFile ç±»æ–‡ä»¶ è®°å½•æºæ–‡ä»¶åç§° SourceDebugExtension ç±»æ–‡ä»¶ JDK 5ä¸­æ–°å¢çš„å±æ€§ï¼Œç”¨äºå­˜å‚¨é¢å¤–çš„è°ƒè¯•ä¿¡æ¯ã€‚è­¬å¦‚åœ¨è¿›è¡ŒJSPæ–‡ä»¶è°ƒè¯•æ—¶ï¼Œæ— æ³•é€šè¿‡Javaå †æ ˆæ¥å®šä½åˆ°JSPæ–‡ä»¶çš„è¡Œå·ï¼ŒJSR45ææ¡ˆä¸ºè¿™äº›éJavaè¯­è¨€ç¼–å†™ï¼Œå´éœ€è¦ç¼–è¯‘æˆå­—èŠ‚ç å¹¶è¿è¡Œåœ¨Javaè™šæ‹Ÿæœºä¸­çš„ç¨‹åºæä¾›äº†ä¸€ä¸ªè¿›è¡Œè°ƒè¯•çš„æ ‡å‡†æœºåˆ¶ï¼Œä½¿ç”¨è¯¥å±æ€§å°±å¯ä»¥ç”¨äºå­˜å‚¨è¿™ä¸ªæ ‡å‡†æ‰€æ–°åŠ å…¥çš„è°ƒè¯•ä¿¡æ¯ Synthetic ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨ æ ‡è¯†æ–¹æ³•æˆ–å­—æ®µä¸ºç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„ LocalVariableTypeTable ç±» JDK 5ä¸­æ–°å¢çš„å±æ€§ï¼Œå®ƒä½¿ç”¨ç‰¹å¾ç­¾åä»£æ›¿æè¿°ç¬¦ï¼Œæ˜¯ä¸ºäº†å¼•å…¥æ³›å‹è¯­æ³•ä¹‹åèƒ½æè¿°æ³›å‹å‚æ•°åŒ–ç±»å‹è€Œæ·»åŠ  RuntimeVisibleAnnotations ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨ JDK 5ä¸­æ–°å¢çš„å±æ€§ï¼Œä¸ºåŠ¨æ€æ³¨è§£æä¾›æ”¯æŒã€‚è¯¥å±æ€§ç”¨äºæŒ‡æ˜å“ªäº›æ³¨è§£æ˜¯è¿è¡Œæ—¶ï¼ˆå®é™…ä¸Šè¿è¡Œæ—¶å°±æ˜¯è¿›è¡Œåå°„è°ƒç”¨ï¼‰å¯è§çš„ RuntimeInvisibleAnnotations ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨ JDK 5ä¸­æ–°å¢çš„å±æ€§ï¼Œä¸RuntimeVisibleAnnotationså±æ€§ä½œç”¨åˆšå¥½ç›¸åï¼Œç”¨äºæŒ‡æ˜å“ªäº›æ³¨è§£æ˜¯è¿è¡Œæ—¶ä¸å¯è§çš„ RuntimeVisibleParameterAnnotations æ–¹æ³•è¡¨ JDK 5ä¸­æ–°å¢çš„å±æ€§ï¼Œä½œç”¨ä¸RuntimeVisibleAnnotationså±æ€§ç±»ä¼¼ï¼Œåªä¸è¿‡ä½œç”¨å¯¹è±¡ä¸ºæ–¹æ³•å‚æ•° RuntimeInvisibleParameterAnnotations æ–¹æ³•è¡¨ JDK 5ä¸­æ–°å¢çš„å±æ€§ï¼Œä½œç”¨ä¸RuntimeInvisibleAnnotationså±æ€§ç±»ä¼¼ï¼Œåªä¸è¿‡ä½œç”¨å¯¹è±¡ä¸ºæ–¹æ³•å‚æ•° AnnotationDefault æ–¹æ³•è¡¨ JDK 5ä¸­æ–°å¢çš„å±æ€§ï¼Œç”¨äºè®°å½•æ³¨è§£ç±»å…ƒç´ çš„é»˜è®¤å€¼ BootstrapMethods ç±»æ–‡ä»¶ JDK 7ä¸­æ–°å¢çš„å±æ€§ï¼Œç”¨äºä¿å­˜invokedynamicæŒ‡ä»¤å¼•ç”¨çš„å¼•å¯¼æ–¹æ³•é™å®šç¬¦ RuntimeVisibleTypeAnnotations ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨ï¼ŒCodeå±æ€§ JDK 8ä¸­æ–°å¢çš„å±æ€§ï¼Œä¸ºå®ç°JSR 308ä¸­æ–°å¢çš„ç±»å‹æ³¨è§£æä¾›çš„æ”¯æŒï¼Œç”¨äºæŒ‡æ˜å“ªäº›ç±»æ³¨è§£æ˜¯è¿è¡Œæ—¶ï¼ˆå®é™…ä¸Šè¿è¡Œæ—¶å°±æ˜¯è¿›è¡Œåå°„è°ƒç”¨ï¼‰å¯è§çš„ RuntimeInvisibleTypeAnnotations ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨ï¼ŒCodeå±æ€§ JDK 8ä¸­æ–°å¢çš„å±æ€§ï¼Œä¸ºå®ç°JSR 308ä¸­æ–°å¢çš„ç±»å‹æ³¨è§£æä¾›çš„æ”¯æŒï¼Œä¸RuntimeVisibleTypeAnnotationså±æ€§ä½œç”¨åˆšå¥½ç›¸åï¼Œç”¨äºæŒ‡æ˜å“ªäº›æ³¨è§£æ˜¯è¿è¡Œæ—¶ä¸å¯è§çš„ MethodParameters æ–¹æ³•è¡¨ JDK 8ä¸­æ–°å¢çš„å±æ€§ï¼Œç”¨äºæ”¯æŒï¼ˆç¼–è¯‘æ—¶åŠ ä¸Š-parameterså‚æ•°)å°†æ–¹æ³•åç§°ç¼–è¯‘è¿›Classæ–‡ä»¶ä¸­ï¼Œå¹¶å¯è¿è¡Œæ—¶è·å–ã€‚æ­¤å‰è¦è·å–æ–¹æ³•åç§°ï¼ˆå…¸å‹çš„å¦‚IDEçš„ä»£ç æç¤ºï¼‰åªèƒ½é€šè¿‡JavaDocä¸­å¾—åˆ° Module ç±» JDK 9ä¸­æ–°å¢çš„å±æ€§ï¼Œç”¨äºè®°å½•ä¸€ä¸ªModuleçš„åç§°ä»¥åŠç›¸å…³ä¿¡æ¯ï¼ˆrequiresã€exportsã€opensã€usesã€provides) ModulePackages ç±» JDK 9ä¸­æ–°å¢çš„å±æ€§ï¼Œç”¨äºè®°å½•ä¸€ä¸ªæ¨¡å—ä¸­æ‰€æœ‰è¢«exportsæˆ–è€…opensçš„åŒ… ModuleMainClass ç±» JDK 9ä¸­æ–°å¢çš„å±æ€§ï¼Œç”¨äºæŒ‡å®šä¸€ä¸ªæ¨¡å—çš„ä¸»ç±» NestHost ç±» JDK 11ä¸­æ–°å¢çš„å±æ€§ï¼Œç”¨äºæ”¯æŒåµŒå¥—ç±»ï¼ˆJavaä¸­çš„å†…éƒ¨ç±»)çš„åå°„å’Œè®¿é—®æ§åˆ¶çš„APIï¼Œä¸€ä¸ªå†…éƒ¨ç±»é€šè¿‡è¯¥å±æ€§å¾—çŸ¥è‡ªå·±çš„å®¿ä¸»ç±» NestMembers ç±» JDK 11ä¸­æ–°å¢çš„å±æ€§ï¼Œç”¨äºæ”¯æŒåµŒå¥—ç±»ï¼ˆJavaä¸­çš„å†…éƒ¨ç±»)çš„åå°„å’Œè®¿é—®æ§åˆ¶çš„APIï¼Œä¸€ä¸ªå®¿ä¸»ç±»é€šè¿‡è¯¥å±æ€§å¾—çŸ¥è‡ªå·±æœ‰å“ªäº›å†…éƒ¨ç±» å¯¹äºæ¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒçš„åç§°éƒ½è¦ä»å¸¸é‡æ± ä¸­å¼•ç”¨ä¸€ä¸ªCONSTANT_Utf8_infoç±»å‹çš„å¸¸é‡æ¥è¡¨ç¤ºï¼Œè€Œå±æ€§å€¼çš„ç»“æ„åˆ™æ˜¯å®Œå…¨è‡ªå®šä¹‰çš„ï¼Œåªéœ€è¦é€šè¿‡ä¸€ä¸ªu4çš„é•¿åº¦å±æ€§å»è¯´æ˜å±æ€§å€¼æ‰€å ç”¨çš„ä½æ•°å³å¯ã€‚ä¸€ä¸ªç¬¦åˆè§„åˆ™çš„å±æ€§è¡¨åº”è¯¥æ»¡è¶³ä¸‹è¡¨æ‰€å®šä¹‰çš„ç»“æ„ï¼š ç±»å‹ åç§° æ•°é‡ u2 attribute_name_index 1 u4 attribute_length 1 u1 info attribute_length 1.7.1 Codeå±æ€§Javaç¨‹åºæ–¹æ³•ä½“é‡Œé¢çš„ä»£ç ç»è¿‡Javacç¼–è¯‘å™¨å¤„ç†ä¹‹åï¼Œæœ€ç»ˆå˜ä¸ºå­—èŠ‚ç æŒ‡ä»¤å­˜å‚¨åœ¨Codeå±æ€§å†…ã€‚ç»“æ„å¦‚ä¸‹è¡¨ï¼š ç±»å‹ åç§° æ•°é‡ u2 attribute_name_index 1 u4 attribute_length 1 u2 max_stack 1 u2 max_ locals 1 u4 code_length 1 u1 code code_length u2 exception_table_length 1 exception_info exception_table exception_table_length u2 attributes_count 1 attribute_info attributes attributes_count attribute_name_indexæŒ‡å‘å›ºå®šå¸¸é‡â€œCodeâ€ï¼Œå®ƒä»£è¡¨äº†è¯¥å±æ€§çš„å±æ€§åç§° attribute_lengthæŒ‡ç¤ºäº†å±æ€§å€¼çš„æ€»é•¿åº¦ï¼Œä¸åŒ…æ‹¬attribute_name_indexå’Œattribute_lengthçš„é•¿åº¦ã€‚ max_stackä»£è¡¨äº†æ“ä½œæ•°æ ˆæ·±åº¦çš„æœ€å¤§å€¼ã€‚è™šæ‹Ÿæœºè¿è¡Œçš„æ—¶å€™éœ€è¦æ ¹æ®è¿™ä¸ªå€¼æ¥åˆ†é…æ ˆå¸§ä¸­çš„æ“ä½œæ ˆæ·±åº¦ã€‚ max_localsä»£è¡¨äº†å±€éƒ¨å˜é‡è¡¨æ‰€éœ€çš„å­˜å‚¨ç©ºé—´ã€‚å•ä½æ˜¯å˜é‡æ§½ï¼ˆSlotï¼‰ï¼Œå¯¹äºbyteã€charã€floatã€intã€shortã€booleanå’ŒreturnAddressç­‰é•¿åº¦ä¸è¶…è¿‡32ä½çš„æ•°æ®ç±»å‹ï¼Œæ¯ä¸ªå±€éƒ¨å˜é‡å ç”¨ä¸€ä¸ªå˜é‡æ§½ï¼Œè€Œdoubleå’Œlongè¿™ä¸¤ç§64ä½çš„æ•°æ®ç±»å‹åˆ™éœ€è¦ä¸¤ä¸ªå˜é‡æ§½æ¥å­˜æ”¾ã€‚ code_lengthå’Œcodeç”¨æ¥å­˜å‚¨Javaæºç¨‹åºç¼–è¯‘åç”Ÿæˆçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚code_lengthä»£è¡¨å­—èŠ‚ç é•¿åº¦ï¼Œcodeæ˜¯ç”¨äºå­˜å‚¨å­—èŠ‚ç æŒ‡ä»¤çš„ä¸€ç³»åˆ—å­—èŠ‚æµã€‚ å…³äºcode_lengthï¼Œè™½ç„¶å®ƒæ˜¯ä¸€ä¸ªu4ç±»å‹çš„é•¿åº¦å€¼ï¼Œç†è®ºä¸Šæœ€å¤§å€¼å¯ä»¥è¾¾åˆ°2çš„32æ¬¡å¹‚ï¼Œä½†æ˜¯ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­æ˜ç¡®é™åˆ¶äº†ä¸€ä¸ªæ–¹æ³•ä¸å…è®¸è¶…è¿‡65535æ¡å­—èŠ‚ç æŒ‡ä»¤ï¼Œå³å®ƒå®é™…åªä½¿ç”¨äº†u2çš„é•¿åº¦ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªé™åˆ¶ï¼ŒJavacç¼–è¯‘å™¨å°±ä¼šæ‹’ç»ç¼–è¯‘ã€‚ codeä¸­æ¯ä¸ªæŒ‡ä»¤å°±æ˜¯ä¸€ä¸ªu1ç±»å‹çš„å•å­—èŠ‚ã€‚æ¯è¯»å–ä¸€ä¸ªå­—èŠ‚ä¾¿å¯çŸ¥é“æŒ‡ä»¤æ˜¯ä»€ä¹ˆã€åé¢æ˜¯å¦è·Ÿç€å‚æ•°ã€‚ é€šè¿‡javapå¯ä»¥æŸ¥çœ‹å­—èŠ‚ç æŒ‡ä»¤ å¦‚æœå­˜åœ¨å¼‚å¸¸è¡¨ï¼Œå®ƒçš„æ ¼å¼å¦‚ä¸‹è¡¨æ‰€ç¤º ç±»å‹ åç§° æ•°é‡ u2 start_pc 1 u2 end_pc 1 u2 handler_pc 1 u2 catch_type 1 å¦‚æœå½“å­—èŠ‚ç ä»ç¬¬start_pcè¡Œåˆ°ç¬¬end_pcè¡Œä¹‹é—´ï¼ˆä¸å«ç¬¬end_pcè¡Œï¼‰å‡ºç°äº†ç±»å‹ä¸ºcatch_typeæˆ–è€…å…¶å­ç±»çš„å¼‚å¸¸ï¼ˆcatch_typeä¸ºæŒ‡å‘ä¸€ä¸ªCONSTANT_Class_infoå‹å¸¸é‡çš„ç´¢å¼•ï¼‰ï¼Œåˆ™è½¬åˆ°ç¬¬handler_pcè¡Œç»§ç»­å¤„ç†ã€‚å½“catch_typeçš„å€¼ä¸º0æ—¶ï¼Œä»£è¡¨ä»»æ„å¼‚å¸¸æƒ…å†µéƒ½éœ€è¦è½¬åˆ°handler_pcå¤„è¿›è¡Œå¤„ç†ã€‚ å°½ç®¡å­—èŠ‚ç ä¸­æœ‰æœ€åˆä¸ºå¤„ç†å¼‚å¸¸è€Œè®¾è®¡çš„è·³è½¬æŒ‡ä»¤ï¼Œä½†ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­æ˜ç¡®è¦æ±‚Javaè¯­è¨€çš„ç¼–è¯‘å™¨åº”å½“é€‰æ‹©ä½¿ç”¨å¼‚å¸¸è¡¨è€Œä¸æ˜¯é€šè¿‡è·³è½¬æŒ‡ä»¤æ¥å®ç°Javaå¼‚å¸¸åŠfinallyå¤„ç†æœºåˆ¶ã€‚ 1.7.2 LineNumberTableå±æ€§LineNumberTableå±æ€§ç”¨äºæè¿°Javaæºç è¡Œå·ä¸å­—èŠ‚ç è¡Œå·ï¼ˆå­—èŠ‚ç çš„åç§»é‡ï¼‰ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚å®ƒå¹¶ä¸æ˜¯è¿è¡Œæ—¶å¿…éœ€çš„å±æ€§ï¼Œä½†é»˜è®¤ä¼šç”Ÿæˆåˆ°Classæ–‡ä»¶ä¹‹ä¸­ï¼Œå¯ä»¥åœ¨Javacä¸­ä½¿ç”¨-gï¼šnoneæˆ–-gï¼šlinesé€‰é¡¹æ¥å–æ¶ˆæˆ–è¦æ±‚ç”Ÿæˆè¿™é¡¹ä¿¡æ¯ã€‚å¦‚æœé€‰æ‹©ä¸ç”ŸæˆLineNumberTableå±æ€§ï¼Œå¯¹ç¨‹åºè¿è¡Œäº§ç”Ÿçš„æœ€ä¸»è¦å½±å“å°±æ˜¯å½“æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œå †æ ˆä¸­å°†ä¸ä¼šæ˜¾ç¤ºå‡ºé”™çš„è¡Œå·ï¼Œå¹¶ä¸”åœ¨è°ƒè¯•ç¨‹åºçš„æ—¶å€™ï¼Œä¹Ÿæ— æ³•æŒ‰ç…§æºç è¡Œæ¥è®¾ç½®æ–­ç‚¹ã€‚ ç±»å‹ åç§° æ•°é‡ u2 attribute_name_index 1 u4 attribute_length 1 u2 line_number_table_length 1 line_number_info line_number_table line_number_table_length line_number_tableæ˜¯ä¸€ä¸ªæ•°é‡ä¸ºline_number_table_lengthã€ç±»å‹ä¸ºline_number_infoçš„é›†åˆï¼Œline_number_infoè¡¨åŒ…å«start_pcå’Œline_numberä¸¤ä¸ªu2ç±»å‹çš„æ•°æ®é¡¹ï¼Œå‰è€…æ˜¯å­—èŠ‚ç è¡Œå·ï¼Œåè€…æ˜¯Javaæºç è¡Œå·ã€‚ 1.7.3 LocalVariableTableåŠLocalVariableTypeTableå±æ€§LocalVariableTableå±æ€§ç”¨äºæè¿°æ ˆå¸§ä¸­å±€éƒ¨å˜é‡è¡¨çš„å˜é‡ä¸Javaæºç ä¸­å®šä¹‰çš„å˜é‡ä¹‹é—´çš„å…³ç³»ï¼Œå®ƒä¹Ÿä¸æ˜¯è¿è¡Œæ—¶å¿…éœ€çš„å±æ€§ï¼Œä½†é»˜è®¤ä¼šç”Ÿæˆåˆ°Classæ–‡ä»¶ä¹‹ä¸­ï¼Œå¯ä»¥åœ¨Javacä¸­ä½¿ç”¨-gï¼šnoneæˆ–-gï¼švarsé€‰é¡¹æ¥å–æ¶ˆæˆ–è¦æ±‚ç”Ÿæˆè¿™é¡¹ä¿¡æ¯ã€‚å¦‚æœæ²¡æœ‰ç”Ÿæˆè¿™é¡¹å±æ€§ï¼Œæœ€å¤§çš„å½±å“å°±æ˜¯å½“å…¶ä»–äººå¼•ç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œæ‰€æœ‰çš„å‚æ•°åç§°éƒ½å°†ä¼šä¸¢å¤±ï¼Œè­¬å¦‚IDEå°†ä¼šä½¿ç”¨è¯¸å¦‚arg0ã€arg1ä¹‹ç±»çš„å ä½ç¬¦ä»£æ›¿åŸæœ‰çš„å‚æ•°åï¼Œè¿™å¯¹ç¨‹åºè¿è¡Œæ²¡æœ‰å½±å“ï¼Œä½†æ˜¯ä¼šå¯¹ä»£ç ç¼–å†™å¸¦æ¥è¾ƒå¤§ä¸ä¾¿ï¼Œè€Œä¸”åœ¨è°ƒè¯•æœŸé—´æ— æ³•æ ¹æ®å‚æ•°åç§°ä»ä¸Šä¸‹æ–‡ä¸­è·å¾—å‚æ•°å€¼ã€‚ ç±»å‹ åç§° æ•°é‡ u2 attribute_name_index 1 u4 attribute_length 1 u2 local variable table length 1 local_ variable_info local_variable_table local_variable_table_length å…¶ä¸­local_variable_infoé¡¹ç›®ä»£è¡¨äº†ä¸€ä¸ªæ ˆå¸§ä¸æºç ä¸­çš„å±€éƒ¨å˜é‡çš„å…³è”: ç±»å‹ åç§° æ•°é‡ u2 start_pe 1 u2 length 1 u2 name index 1 u2 descriptor_index 1 u2 index 1 start_pcå’Œlengthå±æ€§åˆ†åˆ«ä»£è¡¨äº†è¿™ä¸ªå±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸå¼€å§‹çš„å­—èŠ‚ç åç§»é‡åŠå…¶ä½œç”¨èŒƒå›´è¦†ç›–çš„é•¿åº¦ï¼Œä¸¤è€…ç»“åˆèµ·æ¥å°±æ˜¯è¿™ä¸ªå±€éƒ¨å˜é‡åœ¨å­—èŠ‚ç ä¹‹ä¸­çš„ä½œç”¨åŸŸèŒƒå›´ã€‚ name_indexå’Œdescriptor_indexéƒ½æ˜¯æŒ‡å‘å¸¸é‡æ± ä¸­CONSTANT_Utf8_infoå‹å¸¸é‡çš„ç´¢å¼•ï¼Œåˆ†åˆ«ä»£è¡¨äº†å±€éƒ¨å˜é‡çš„åç§°ä»¥åŠè¿™ä¸ªå±€éƒ¨å˜é‡çš„æè¿°ç¬¦ã€‚ indexæ˜¯è¿™ä¸ªå±€éƒ¨å˜é‡åœ¨æ ˆå¸§çš„å±€éƒ¨å˜é‡è¡¨ä¸­å˜é‡æ§½çš„ä½ç½®ã€‚å½“è¿™ä¸ªå˜é‡æ•°æ®ç±»å‹æ˜¯64ä½ç±»å‹æ—¶ï¼ˆdoubleå’Œlongï¼‰ï¼Œå®ƒå ç”¨çš„å˜é‡æ§½ä¸ºindexå’Œindex+1ä¸¤ä¸ªã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jvm","slug":"jvm","permalink":"https://www.codetool.top/tags/jvm/"}]},{"title":"leetcode108-å°†æœ‰åºæ•°ç»„è½¬æ¢ä¸ºäºŒå‰æœç´¢æ ‘","slug":"leetcode108-å°†æœ‰åºæ•°ç»„è½¬æ¢ä¸ºäºŒå‰æœç´¢æ ‘","date":"2020-01-17T16:59:42.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode108-å°†æœ‰åºæ•°ç»„è½¬æ¢ä¸ºäºŒå‰æœç´¢æ ‘/","link":"","permalink":"https://www.codetool.top/article/leetcode108-%E5%B0%86%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E8%BD%AC%E6%8D%A2%E4%B8%BA%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/","excerpt":"","text":"1 åŸé¢˜å°†ä¸€ä¸ªæŒ‰ç…§å‡åºæ’åˆ—çš„æœ‰åºæ•°ç»„ï¼Œè½¬æ¢ä¸ºä¸€æ£µé«˜åº¦å¹³è¡¡äºŒå‰æœç´¢æ ‘ã€‚ æœ¬é¢˜ä¸­ï¼Œä¸€ä¸ªé«˜åº¦å¹³è¡¡äºŒå‰æ ‘æ˜¯æŒ‡ä¸€ä¸ªäºŒå‰æ ‘æ¯ä¸ªèŠ‚ç‚¹ çš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡ 1ã€‚ ç¤ºä¾‹: ç»™å®šæœ‰åºæ•°ç»„: [-10,-3,0,5,9], ä¸€ä¸ªå¯èƒ½çš„ç­”æ¡ˆæ˜¯ï¼š[0,-3,9,-10,null,5]ï¼Œå®ƒå¯ä»¥è¡¨ç¤ºä¸‹é¢è¿™ä¸ªé«˜åº¦å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼š 0 / \\ -3 9 / / -10 52 è§£æ³•2.1 æ€æƒ³ç±»ä¼¼äºäºŒåˆ†æŸ¥æ‰¾ï¼Œæ¯æ¬¡é€’å½’ä½¿ç”¨æ•°ç»„çš„ä¸­é—´å…ƒç´ ä½œä¸ºæ ¹èŠ‚ç‚¹ã€‚å°±èƒ½æœ€å¤§åŒ–åˆ©ç”¨å·¦å³èŠ‚ç‚¹ç©ºé—´ï¼Œä½¿ä¹‹å¹³è¡¡ã€‚ 2.2 ä»£ç class Solution { public TreeNode sortedArrayToBST(int[] nums) { return sortedArrayToBST(nums, 0, nums.length); } private TreeNode sortedArrayToBST(int[] nums, int start, int end) { if (start == end) { return null; } int mid = (start + end) >>> 1; TreeNode root = new TreeNode(nums[mid]); root.left = sortedArrayToBST(nums, start, mid); root.right = sortedArrayToBST(nums, mid + 1, end); return root; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode110-å¹³è¡¡äºŒå‰æ ‘","slug":"leetcode110-å¹³è¡¡äºŒå‰æ ‘","date":"2020-01-17T15:30:21.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode110-å¹³è¡¡äºŒå‰æ ‘/","link":"","permalink":"https://www.codetool.top/article/leetcode110-%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦æ˜¯é«˜åº¦å¹³è¡¡çš„äºŒå‰æ ‘ã€‚ æœ¬é¢˜ä¸­ï¼Œä¸€æ£µé«˜åº¦å¹³è¡¡äºŒå‰æ ‘å®šä¹‰ä¸ºï¼š ä¸€ä¸ªäºŒå‰æ ‘æ¯ä¸ªèŠ‚ç‚¹ çš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ã€‚ ç¤ºä¾‹ 1:ç»™å®šäºŒå‰æ ‘ [3,9,20,null,null,15,7] 3 / \\ 9 20 / \\ 15 7è¿”å› true ã€‚ ç¤ºä¾‹ 2: ç»™å®šäºŒå‰æ ‘ [1,2,2,3,3,null,null,4,4] 1 / \\ 2 2 / \\ 3 3 / \\ 4 4è¿”å› false ã€‚ 2 è§£æ³•2.1 æ€æƒ³è‡ªé¡¶å‘ä¸‹ï¼šæ¯ä¸ªèŠ‚ç‚¹è·å–å·¦å³ä¸¤æ£µå­æ ‘çš„é«˜åº¦ï¼Œå¹¶æ¯”è¾ƒé«˜åº¦å·®æ˜¯å¦å¤§äº1ï¼Œè·å–é«˜åº¦é€šè¿‡é€’å½’å®ç°ã€‚ è‡ªåº•å‘ä¸Šï¼šå›æº¯æ—¶æ¯”è¾ƒå·¦å³èŠ‚ç‚¹çš„é«˜åº¦ï¼Œå¦‚æœæœ‰ä»»æ„èŠ‚ç‚¹å·¦å³å­æ ‘é«˜åº¦å·®å¤§äº1ï¼Œåˆ™è¯´æ˜ä¸æ˜¯å¹³è¡¡æ ‘ã€‚ 2.2 ä»£ç è‡ªé¡¶å‘ä¸‹ï¼š class Solution { public boolean isBalanced(TreeNode root) { if(root == null) return true; if(Math.abs(Height(root.left)-Height(root.right))>1) return false; return isBalanced(root.left)&amp;&amp;isBalanced(root.right); } public int Height(TreeNode root){ if(root == null) return 0; int left = Height(root.left); int right = Height(root.right); if(left>=right) return left+1; else return right+1; } } è‡ªåº•å‘ä¸Šï¼š public class BalancedBinaryTree { boolean res = true; public boolean isBalanced(TreeNode root) { helper(root); return res; } private int helper(TreeNode root) { if (root == null) return 0; int left = helper(root.left) + 1; int right = helper(root.right) + 1; if (Math.abs(right - left) > 1) res = false; return Math.max(left, right); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode235-äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ","slug":"leetcode235-äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ","date":"2020-01-17T13:03:36.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode235-äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ/","link":"","permalink":"https://www.codetool.top/article/leetcode235-%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E7%9A%84%E6%9C%80%E8%BF%91%E5%85%AC%E5%85%B1%E7%A5%96%E5%85%88/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªäºŒå‰äºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚ ç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªç»“ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªç»“ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚â€ ä¾‹å¦‚ï¼Œç»™å®šå¦‚ä¸‹äºŒå‰æœç´¢æ ‘: root = [6,2,8,0,4,7,9,null,null,3,5] ç¤ºä¾‹1ï¼š è¾“å…¥: root = [6,2,8,0,4,7,9,null,null,3,5], p = 2, q = 8è¾“å‡º: 6è§£é‡Š: èŠ‚ç‚¹ 2 å’ŒèŠ‚ç‚¹ 8 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯ 6ã€‚ ç¤ºä¾‹2ï¼š è¾“å…¥: root = [6,2,8,0,4,7,9,null,null,3,5], p = 2, q = 4è¾“å‡º: 2è§£é‡Š: èŠ‚ç‚¹ 2 å’ŒèŠ‚ç‚¹ 4 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯ 2, å› ä¸ºæ ¹æ®å®šä¹‰æœ€è¿‘å…¬å…±ç¥–å…ˆèŠ‚ç‚¹å¯ä»¥ä¸ºèŠ‚ç‚¹æœ¬èº«ã€‚ è¯´æ˜: æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚ pã€q ä¸ºä¸åŒèŠ‚ç‚¹ä¸”å‡å­˜åœ¨äºç»™å®šçš„äºŒå‰æœç´¢æ ‘ä¸­ã€‚ 2 è§£æ³•2.1 æ€æƒ³åˆ©ç”¨äºŒå‰æœç´¢æ ‘çš„æ€§è´¨ï¼Œä¸¤ä¸ªèŠ‚ç‚¹pã€qå¯ä»¥æœ‰ä¸¤ç§åˆ†å¸ƒæƒ…å†µï¼š åˆ†åˆ«ä½äºå…¬å…±ç¥–å…ˆçš„å·¦ã€å³å­æ ‘ã€‚ å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯å…¬å…±ç¥–å…ˆï¼Œå¦ä¸€ä¸ªèŠ‚ç‚¹ä½äºå­æ ‘ä¸Šã€‚ å¦‚æ­¤é€’å½’æŸ¥æ‰¾ã€‚ 2.2 ä»£ç class Solution { public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) { if(root.val>p.val &amp;&amp; root.val>q.val) return lowestCommonAncestor(root.left, p, q); if(root.val&lt;p.val &amp;&amp; root.val&lt;q.val) return lowestCommonAncestor(root.right,p,q); return root; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode450-åˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„èŠ‚ç‚¹","slug":"leetcode450-åˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„èŠ‚ç‚¹","date":"2020-01-16T11:35:34.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode450-åˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„èŠ‚ç‚¹/","link":"","permalink":"https://www.codetool.top/article/leetcode450-%E5%88%A0%E9%99%A4%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E4%B8%AD%E7%9A%84%E8%8A%82%E7%82%B9/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ root å’Œä¸€ä¸ªå€¼ keyï¼Œåˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„ key å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¹¶ä¿è¯äºŒå‰æœç´¢æ ‘çš„æ€§è´¨ä¸å˜ã€‚è¿”å›äºŒå‰æœç´¢æ ‘ï¼ˆæœ‰å¯èƒ½è¢«æ›´æ–°ï¼‰çš„æ ¹èŠ‚ç‚¹çš„å¼•ç”¨ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œåˆ é™¤èŠ‚ç‚¹å¯åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š é¦–å…ˆæ‰¾åˆ°éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼› å¦‚æœæ‰¾åˆ°äº†ï¼Œåˆ é™¤å®ƒã€‚ è¯´æ˜ï¼š è¦æ±‚ç®—æ³•æ—¶é—´å¤æ‚åº¦ä¸º O(h)ï¼Œh ä¸ºæ ‘çš„é«˜åº¦ã€‚ ç¤ºä¾‹: root = [5,3,6,2,4,null,7]key = 3 &nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;/&nbsp;\\&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;6&nbsp;/&nbsp;\\ &nbsp;&nbsp;&nbsp;\\2&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;7 ç»™å®šéœ€è¦åˆ é™¤çš„èŠ‚ç‚¹å€¼æ˜¯ 3ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆæ‰¾åˆ° 3 è¿™ä¸ªèŠ‚ç‚¹ï¼Œç„¶ååˆ é™¤å®ƒã€‚ ä¸€ä¸ªæ­£ç¡®çš„ç­”æ¡ˆæ˜¯ [5,4,6,2,null,null,7], å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ &nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;/&nbsp;\\&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;6&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7 å¦ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆæ˜¯ [5,2,6,null,4,null,7]ã€‚ &nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;/&nbsp;\\&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;\\ &nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;7 2 è§£æ³•2.1 æ€æƒ³åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥æœ‰ä¸‰ç§æƒ…å†µï¼š å®ƒæ²¡æœ‰å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆç›´æ¥åˆ é™¤ã€‚ å®ƒæ‹¥æœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆç›´æ¥ç”¨å­èŠ‚ç‚¹æ›¿æ¢å®ƒ å®ƒæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ™å¯ä»¥ï¼š å°†å®ƒçš„å³å­èŠ‚ç‚¹é™„åœ¨å·¦å­èŠ‚ç‚¹çš„æœ€å³è¾¹ï¼š æˆ–ï¼Œå°†å®ƒçš„å·¦å­èŠ‚ç‚¹é™„åœ¨å³å­èŠ‚ç‚¹çš„æœ€å·¦è¾¹ï¼š å®é™…å°±æ˜¯è®©æœç´¢æ ‘çº¿æ€§åŒ–ï¼Œè¿™æ ·æ“ä½œä¼šè®©æœç´¢æ ‘çš„é«˜åº¦é€æ¸å¤±è¡¡ï¼Œæ‰€ä»¥å¹¶ä¸æ¨èä½œä¸ºä¸€ä¸ªæ•°æ®ç»“æ„è¿™æ ·å®ç°ã€‚ æ›´å¥½çš„åˆ é™¤æ–¹æ³•å¯ä»¥å‚è€ƒå®˜æ–¹é¢˜è§£ï¼š https://leetcode-cn.com/problems/delete-node-in-a-bst/solution/shan-chu-er-cha-sou-suo-shu-zhong-de-jie-dian-by-l/ 2.2 ä»£ç class Solution { public TreeNode deleteNode(TreeNode root, int key) { if(root == null) return null; if(root.val == key) {//æ ¹èŠ‚ç‚¹å°±æ˜¯è¦åˆ é™¤çš„èŠ‚ç‚¹ if(root.left==null &amp;&amp; root.right==null) return null; else if(root.left!=null){ TreeNode node = root.left; while(node.right!=null){ node = node.right; } node.right = root.right; return root.left; }else return root.right; } if(root.left!=null&amp;&amp;root.left.val==key){//å·¦å­èŠ‚ç‚¹æ˜¯è¦åˆ é™¤çš„èŠ‚ç‚¹ if(root.left.left==null &amp;&amp; root.left.right==null) root.left = null; else if(root.left.left!=null){ TreeNode node = root.left.left; while(node.right!=null){ node = node.right; } node.right = root.left.right; root.left = root.left.left; }else root.left = root.left.right; }else if(root.right!=null&amp;&amp;root.right.val==key){//å³å­èŠ‚ç‚¹æ˜¯è¦åˆ é™¤çš„èŠ‚ç‚¹ if(root.right.left==null &amp;&amp; root.right.right==null) root.right = null; else if(root.right.right!=null){ TreeNode node = root.right.right; while(node.left!=null){ node = node.left; } node.left = root.right.left; root.left = root.right.right; }else root.right = root.right.left; }else { deleteNode(root.left,key); deleteNode(root.right,key); } return root; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode701-äºŒå‰æœç´¢æ ‘ä¸­çš„æ’å…¥æ“ä½œ","slug":"leetcode701-äºŒå‰æœç´¢æ ‘ä¸­çš„æ’å…¥æ“ä½œ","date":"2020-01-16T09:52:36.000Z","updated":"2020-04-22T09:27:27.160Z","comments":true,"path":"article/leetcode701-äºŒå‰æœç´¢æ ‘ä¸­çš„æ’å…¥æ“ä½œ/","link":"","permalink":"https://www.codetool.top/article/leetcode701-%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E4%B8%AD%E7%9A%84%E6%8F%92%E5%85%A5%E6%93%8D%E4%BD%9C/","excerpt":"","text":"1 åŸé¢˜ç»™å®šäºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰çš„æ ¹èŠ‚ç‚¹å’Œè¦æ’å…¥æ ‘ä¸­çš„å€¼ï¼Œå°†å€¼æ’å…¥äºŒå‰æœç´¢æ ‘ã€‚ è¿”å›æ’å…¥åäºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚ ä¿è¯åŸå§‹äºŒå‰æœç´¢æ ‘ä¸­ä¸å­˜åœ¨æ–°å€¼ã€‚ æ³¨æ„ï¼Œå¯èƒ½å­˜åœ¨å¤šç§æœ‰æ•ˆçš„æ’å…¥æ–¹å¼ï¼Œåªè¦æ ‘åœ¨æ’å…¥åä»ä¿æŒä¸ºäºŒå‰æœç´¢æ ‘å³å¯ã€‚ ä½ å¯ä»¥è¿”å›ä»»æ„æœ‰æ•ˆçš„ç»“æœã€‚ ä¾‹å¦‚, ç»™å®šäºŒå‰æœç´¢æ ‘: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;3 å’Œ æ’å…¥çš„å€¼: 5 ä½ å¯ä»¥è¿”å›è¿™ä¸ªäºŒå‰æœç´¢æ ‘: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;\\ &nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;3&nbsp;5 æˆ–è€…è¿™ä¸ªæ ‘ä¹Ÿæ˜¯æœ‰æ•ˆçš„: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4 2 è§£æ³•2.1 æ€æƒ³ä¸æœç´¢æ“ä½œç±»ä¼¼ï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬å°†ï¼š æ ¹æ®èŠ‚ç‚¹å€¼ä¸ç›®æ ‡èŠ‚ç‚¹å€¼çš„å…³ç³»ï¼Œæœç´¢å·¦å­æ ‘æˆ–å³å­æ ‘ï¼› é‡å¤æ­¥éª¤ 1 ç›´åˆ°åˆ°è¾¾å¤–éƒ¨èŠ‚ç‚¹ï¼› æ ¹æ®èŠ‚ç‚¹çš„å€¼ä¸ç›®æ ‡èŠ‚ç‚¹çš„å€¼çš„å…³ç³»ï¼Œå°†æ–°èŠ‚ç‚¹æ·»åŠ ä¸ºå…¶å·¦ä¾§æˆ–å³ä¾§çš„å­èŠ‚ç‚¹ã€‚ å¦‚æ­¤é€’å½’ã€‚ 2.2 ä»£ç class Solution { public TreeNode insertIntoBST(TreeNode root, int val) { if(val&lt;root.val){ if(root.left==null) root.left = new TreeNode(val); else insertIntoBST(root.left,val); } if(val>root.val){ if(root.right==null) root.right = new TreeNode(val); else insertIntoBST(root.right,val); } return root; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode700-äºŒå‰æœç´¢æ ‘ä¸­çš„æœç´¢","slug":"leetcode700-äºŒå‰æœç´¢æ ‘ä¸­çš„æœç´¢","date":"2020-01-16T05:45:31.000Z","updated":"2020-04-22T09:10:42.803Z","comments":true,"path":"article/leetcode700-äºŒå‰æœç´¢æ ‘ä¸­çš„æœç´¢/","link":"","permalink":"https://www.codetool.top/article/leetcode700-%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E4%B8%AD%E7%9A%84%E6%90%9C%E7%B4%A2/","excerpt":"","text":"1 åŸé¢˜ç»™å®šäºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰çš„æ ¹èŠ‚ç‚¹å’Œä¸€ä¸ªå€¼ã€‚ ä½ éœ€è¦åœ¨BSTä¸­æ‰¾åˆ°èŠ‚ç‚¹å€¼ç­‰äºç»™å®šå€¼çš„èŠ‚ç‚¹ã€‚ è¿”å›ä»¥è¯¥èŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘ã€‚ å¦‚æœèŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› NULLã€‚ ä¾‹å¦‚ï¼Œ ç»™å®šäºŒå‰æœç´¢æ ‘: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;3 å’Œå€¼: 2 ä½ åº”è¯¥è¿”å›å¦‚ä¸‹å­æ ‘: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;3 åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œå¦‚æœè¦æ‰¾çš„å€¼æ˜¯ 5ï¼Œä½†å› ä¸ºæ²¡æœ‰èŠ‚ç‚¹å€¼ä¸º 5ï¼Œæˆ‘ä»¬åº”è¯¥è¿”å› NULLã€‚ 2 è§£æ³•2.1 æ€æƒ³æ ¹æ®BSTçš„ç‰¹æ€§ï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼š å¦‚æœç›®æ ‡å€¼ç­‰äºèŠ‚ç‚¹çš„å€¼ï¼Œåˆ™è¿”å›èŠ‚ç‚¹; å¦‚æœç›®æ ‡å€¼å°äºèŠ‚ç‚¹çš„å€¼ï¼Œåˆ™ç»§ç»­åœ¨å·¦å­æ ‘ä¸­æœç´¢; å¦‚æœç›®æ ‡å€¼å¤§äºèŠ‚ç‚¹çš„å€¼ï¼Œåˆ™ç»§ç»­åœ¨å³å­æ ‘ä¸­æœç´¢ã€‚ å¦‚æ­¤é€’å½’æœç´¢ã€‚ 2.2 ä»£ç class Solution { public TreeNode searchBST(TreeNode root, int val) { if(root==null)return null; if(root.val == val) return root; else if(root.val &lt; val) return searchBST(root.right,val); else return searchBST(root.left,val); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode173-äºŒå‰æœç´¢æ ‘è¿­ä»£å™¨","slug":"leetcode173-äºŒå‰æœç´¢æ ‘è¿­ä»£å™¨","date":"2020-01-15T17:05:07.000Z","updated":"2020-04-22T09:10:33.707Z","comments":true,"path":"article/leetcode173-äºŒå‰æœç´¢æ ‘è¿­ä»£å™¨/","link":"","permalink":"https://www.codetool.top/article/leetcode173-%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E8%BF%AD%E4%BB%A3%E5%99%A8/","excerpt":"","text":"1 åŸé¢˜å®ç°ä¸€ä¸ªäºŒå‰æœç´¢æ ‘è¿­ä»£å™¨ã€‚ä½ å°†ä½¿ç”¨äºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹åˆå§‹åŒ–è¿­ä»£å™¨ã€‚ è°ƒç”¨ next() å°†è¿”å›äºŒå‰æœç´¢æ ‘ä¸­çš„ä¸‹ä¸€ä¸ªæœ€å°çš„æ•°ã€‚ ç¤ºä¾‹ï¼š BSTIterator iterator = new BSTIterator(root);iterator.next(); // è¿”å› 3iterator.next(); // è¿”å› 7iterator.hasNext(); // è¿”å› trueiterator.next(); // è¿”å› 9iterator.hasNext(); // è¿”å› trueiterator.next(); // è¿”å› 15iterator.hasNext(); // è¿”å› trueiterator.next(); // è¿”å› 20iterator.hasNext(); // è¿”å› false æç¤ºï¼š next() å’Œ hasNext() æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼Œå¹¶ä½¿ç”¨ O(h) å†…å­˜ï¼Œå…¶ä¸­ h æ˜¯æ ‘çš„é«˜åº¦ã€‚ ä½ å¯ä»¥å‡è®¾ next() è°ƒç”¨æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“è°ƒç”¨ next() æ—¶ï¼ŒBST ä¸­è‡³å°‘å­˜åœ¨ä¸€ä¸ªä¸‹ä¸€ä¸ªæœ€å°çš„æ•°ã€‚ 2 è§£æ³•2.1 æ€æƒ³ç†è§£äºŒå‰æœç´¢æ ‘çš„æ•°æ®ç»“æ„ï¼ŒåƒäºŒå‰æ ‘çš„ä¸­åºéå†é‚£æ ·æ„é€ ä¸€ä¸ªlistã€‚ 2.2 ä»£ç class BSTIterator { List&lt;TreeNode> list; int cur; public BSTIterator(TreeNode root) { list = new ArrayList&lt;>(); cur = -1; buildList(root); } public void buildList(TreeNode root){ if(root == null) return; buildList(root.left); list.add(root); buildList(root.right); } /** @return the next smallest number */ public int next() { cur++; return list.get(cur).val; } /** @return whether we have a next smallest number */ public boolean hasNext() { if(cur&lt;list.size()-1) return true; return false; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"}]},{"title":"JDK8u20å­—ç¬¦ä¸²å»é‡","slug":"JDK8u20å­—ç¬¦ä¸²å»é‡","date":"2020-01-15T11:54:37.000Z","updated":"2020-01-15T12:54:11.995Z","comments":true,"path":"article/JDK8u20å­—ç¬¦ä¸²å»é‡/","link":"","permalink":"https://www.codetool.top/article/JDK8u20%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8E%BB%E9%87%8D/","excerpt":"","text":"ä¼˜ç‚¹ï¼šèŠ‚çœå¤§é‡å†…å­˜ ç¼ºç‚¹ï¼šç•¥å¾®å¤šå ç”¨cpuæ—¶é—´ï¼Œæ–°ç”Ÿä»£å›æ”¶æ—¶é—´ç•¥å¾®å¢åŠ  -XX:+UseStringDeduplication String s1 = new String(\"hello\");//char[] {'h','e','l','l','o'} String s2 = new String(\"hello\");//char[] {'h','e','l','l','o'} å°†æ‰€æœ‰æ–°åˆ†é…çš„å­—ç¬¦ä¸²æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ— å½“æ–°ç”Ÿä»£å›æ”¶æ—¶ï¼ŒG1å¹¶å‘æ£€æŸ¥æ˜¯å¦æœ‰å­—ç¬¦ä¸²é‡å¤ å¦‚æœå®ƒä»¬å€¼ä¸€æ ·ï¼Œè®©å®ƒä»¬å¼•ç”¨åŒä¸€ä¸ªchar[] æ³¨æ„ï¼Œä¸String.intern()ä¸ä¸€æ · String.intern()å…³æ³¨çš„æ˜¯å­—ç¬¦ä¸²å¯¹è±¡ è€Œå­—ç¬¦ä¸²å»é‡å…³æ³¨çš„æ˜¯char[] åœ¨JVMå†…éƒ¨ï¼Œä½¿ç”¨äº†ä¸åŒçš„å­—ç¬¦ä¸²è¡¨","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jvm","slug":"jvm","permalink":"https://www.codetool.top/tags/jvm/"},{"name":"ä¼˜åŒ–","slug":"ä¼˜åŒ–","permalink":"https://www.codetool.top/tags/%E4%BC%98%E5%8C%96/"}]},{"title":"leetcode98-éªŒè¯äºŒå‰æœç´¢æ ‘","slug":"leetcode98-éªŒè¯äºŒå‰æœç´¢æ ‘","date":"2020-01-15T08:20:17.000Z","updated":"2020-04-22T09:09:37.436Z","comments":true,"path":"article/leetcode98-éªŒè¯äºŒå‰æœç´¢æ ‘/","link":"","permalink":"https://www.codetool.top/article/leetcode98-%E9%AA%8C%E8%AF%81%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œåˆ¤æ–­å…¶æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„äºŒå‰æœç´¢æ ‘ã€‚ å‡è®¾ä¸€ä¸ªäºŒå‰æœç´¢æ ‘å…·æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š èŠ‚ç‚¹çš„å·¦å­æ ‘åªåŒ…å«å°äºå½“å‰èŠ‚ç‚¹çš„æ•°ã€‚ èŠ‚ç‚¹çš„å³å­æ ‘åªåŒ…å«å¤§äºå½“å‰èŠ‚ç‚¹çš„æ•°ã€‚ æ‰€æœ‰å·¦å­æ ‘å’Œå³å­æ ‘è‡ªèº«å¿…é¡»ä¹Ÿæ˜¯äºŒå‰æœç´¢æ ‘ã€‚ ç¤ºä¾‹ 1: è¾“å…¥:&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;/&nbsp;\\&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;3è¾“å‡º: true ç¤ºä¾‹ 2: è¾“å…¥:&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;/&nbsp;\\&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;6è¾“å‡º: falseè§£é‡Š: è¾“å…¥ä¸º: [5,1,4,null,null,3,6]ã€‚ æ ¹èŠ‚ç‚¹çš„å€¼ä¸º 5 ï¼Œä½†æ˜¯å…¶å³å­èŠ‚ç‚¹å€¼ä¸º 4 ã€‚ 2 è§£æ³•2.1 æ€æƒ³é€’å½’ï¼Œè¦è€ƒè™‘æ•´ä¸ªå·¦å­æ ‘çš„æœ€å¤§å€¼å°äºæ ¹èŠ‚ç‚¹ï¼Œæ•´ä¸ªå³å­æ ‘çš„æœ€å°å€¼å¤§äºæ ¹èŠ‚ç‚¹ã€‚é€šè¿‡ä¼ å‚æ¥è·å–è¿™äº›ä¿¡æ¯ã€‚ 2.2 ä»£ç class Solution { public boolean isValidBST(TreeNode root) { return recursion(root, null, null); } private boolean recursion(TreeNode root, Integer up, Integer low) { if (root == null) { return true; } if (up != null &amp;&amp; root.val >= up) { return false; } if (low != null &amp;&amp; root.val &lt;= low) { return false; } return recursion(root.left, root.val, low) &amp;&amp; recursion(root.right, up, root.val); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode297-äºŒå‰æ ‘çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–","slug":"leetcode297-äºŒå‰æ ‘çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–","date":"2020-01-14T18:29:14.000Z","updated":"2020-04-22T09:10:51.999Z","comments":true,"path":"article/leetcode297-äºŒå‰æ ‘çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–/","link":"","permalink":"https://www.codetool.top/article/leetcode297-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","excerpt":"","text":"1 åŸé¢˜åºåˆ—åŒ–æ˜¯å°†ä¸€ä¸ªæ•°æ®ç»“æ„æˆ–è€…å¯¹è±¡è½¬æ¢ä¸ºè¿ç»­çš„æ¯”ç‰¹ä½çš„æ“ä½œï¼Œè¿›è€Œå¯ä»¥å°†è½¬æ¢åçš„æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶æˆ–è€…å†…å­˜ä¸­ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡ç½‘ç»œä¼ è¾“åˆ°å¦ä¸€ä¸ªè®¡ç®—æœºç¯å¢ƒï¼Œé‡‡å–ç›¸åæ–¹å¼é‡æ„å¾—åˆ°åŸæ•°æ®ã€‚ è¯·è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥å®ç°äºŒå‰æ ‘çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚è¿™é‡Œä¸é™å®šä½ çš„åºåˆ— / ååºåˆ—åŒ–ç®—æ³•æ‰§è¡Œé€»è¾‘ï¼Œä½ åªéœ€è¦ä¿è¯ä¸€ä¸ªäºŒå‰æ ‘å¯ä»¥è¢«åºåˆ—åŒ–ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²å¹¶ä¸”å°†è¿™ä¸ªå­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸ºåŸå§‹çš„æ ‘ç»“æ„ã€‚ ç¤ºä¾‹ï¼š ä½ å¯ä»¥å°†ä»¥ä¸‹äºŒå‰æ ‘ï¼š &nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;/&nbsp;\\&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;5 åºåˆ—åŒ–ä¸º â€œ[1,2,3,null,null,4,5]â€ æç¤º: è¿™ä¸ LeetCode ç›®å‰ä½¿ç”¨çš„æ–¹å¼ä¸€è‡´ï¼Œè¯¦æƒ…è¯·å‚é˜… LeetCode åºåˆ—åŒ–äºŒå‰æ ‘çš„æ ¼å¼ã€‚ä½ å¹¶éå¿…é¡»é‡‡å–è¿™ç§æ–¹å¼ï¼Œä½ ä¹Ÿå¯ä»¥é‡‡ç”¨å…¶ä»–çš„æ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ è¯´æ˜: ä¸è¦ä½¿ç”¨ç±»çš„æˆå‘˜ / å…¨å±€ / é™æ€å˜é‡æ¥å­˜å‚¨çŠ¶æ€ï¼Œä½ çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç®—æ³•åº”è¯¥æ˜¯æ— çŠ¶æ€çš„ã€‚ 2 è§£æ³•2.1 æ€æƒ³BFSï¼Œå®Œå…¨ç”¨é˜Ÿåˆ—å®ç°å°±å¥½ï¼Œæˆ‘è¿™é‡Œä¼šå½¢æˆ1,2,3,null,null,4,5,null,null,null,null,è¿™æ ·çš„å­—ç¬¦ä¸²ã€‚ 2.2 ä»£ç public class Codec { // Encodes a tree to a single string. public String serialize(TreeNode root) { Queue&lt;TreeNode> queue = new LinkedList&lt;>(); StringBuilder sb = new StringBuilder(); queue.offer(root); while(!queue.isEmpty()){ TreeNode node = queue.poll(); if(node == null) sb.append(\"null\"); else{ sb.append(node.val); queue.offer(node.left); queue.offer(node.right); } sb.append(\",\"); } return sb.toString(); } // Decodes your encoded data to tree. public TreeNode deserialize(String data) { if(data.equals(\"null,\")) return null; Queue&lt;TreeNode> queue = new LinkedList&lt;>(); String[] datas = data.split(\",\"); int count = 0; TreeNode root = new TreeNode(Integer.valueOf(datas[0])); queue.offer(root); while(!queue.isEmpty()){ TreeNode node = queue.poll(); TreeNode left = null; if(!datas[count+1].equals(\"null\")){ left = new TreeNode(Integer.valueOf(datas[count+1])); queue.offer(left); } TreeNode right = null; if(!datas[count+2].equals(\"null\")){ right = new TreeNode(Integer.valueOf(datas[count+2])); queue.offer(right); } node.left = left; node.right = right; count+=2; } return root; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode236-äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ","slug":"leetcode236-äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ","date":"2020-01-14T16:54:05.000Z","updated":"2020-04-22T09:27:27.204Z","comments":true,"path":"article/leetcode236-äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ/","link":"","permalink":"https://www.codetool.top/article/leetcode236-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E6%9C%80%E8%BF%91%E5%85%AC%E5%85%B1%E7%A5%96%E5%85%88/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚ ç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªç»“ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªç»“ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚â€ ä¾‹å¦‚ï¼Œç»™å®šå¦‚ä¸‹äºŒå‰æ ‘: root = [3,5,1,6,2,0,8,null,null,7,4] ç¤ºä¾‹1ï¼š è¾“å…¥: root = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 1è¾“å‡º: 3è§£é‡Š: èŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 1 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 3ã€‚ ç¤ºä¾‹2ï¼š è¾“å…¥: root = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 4è¾“å‡º: 5è§£é‡Š: èŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 4 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 5ã€‚å› ä¸ºæ ¹æ®å®šä¹‰æœ€è¿‘å…¬å…±ç¥–å…ˆèŠ‚ç‚¹å¯ä»¥ä¸ºèŠ‚ç‚¹æœ¬èº«ã€‚ 2 è§£æ³•2.1 æ€æƒ³æˆ‘é¦–å…ˆçš„æ€è·¯å°±æ˜¯è¦æœ‰ä¸€ä¸ªreachå‡½æ•°ï¼Œå¯ä»¥åˆ¤æ–­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸æ˜¯æŒ‡å®šèŠ‚ç‚¹çš„ç¥–å…ˆï¼Œé€šè¿‡dfså®ç°ï¼Œè¿”å›ä¸€ä¸ªboolå€¼ã€‚é‚£ä¹ˆè¿™é“é¢˜è¦å¯»æ‰¾ç¦»pã€qæœ€è¿‘çš„ç¥–å…ˆèŠ‚ç‚¹ï¼Œå°±å¯ä»¥å†ä½¿ç”¨ä¸€ä¸ªdfsï¼Œæˆ‘ä»¬éƒ½çŸ¥é“dfså›æº¯çš„æ—¶å€™æ˜¯ä»ä¸‹å¾€ä¸Šçš„ï¼Œé‚£ä¹ˆåªè¦è°ƒç”¨å‡½æ•°æœ€æ—©å¯¹å‚æ•°pã€qéƒ½è¿”å›trueçš„èŠ‚ç‚¹å°±æ˜¯è¦å¾—åˆ°çš„ç­”æ¡ˆäº†ï¼Œç„¶åæ²¿ç€å›æº¯è¿”å›å€¼é“¾ä¼ å›è¿™ä¸ªèŠ‚ç‚¹ã€‚ 2.2 ä»£ç class Solution { public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) { if(root == null) return null; TreeNode left = lowestCommonAncestor(root.left,p,q); if(left!=null) return left; TreeNode right = lowestCommonAncestor(root.right,p,q); if(right!=null) return right; if(reach(root,p.val)==true&amp;&amp;reach(root,q.val)==true) return root; return null; } public boolean reach(TreeNode root,int value){ if(root == null) return false; if(root.val == value) return true; return reach(root.left,value) || reach(root.right,value); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode117-å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆII","slug":"leetcode117-å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆII","date":"2020-01-14T13:45:48.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode117-å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆII/","link":"","permalink":"https://www.codetool.top/article/leetcode117-%E5%A1%AB%E5%85%85%E6%AF%8F%E4%B8%AA%E8%8A%82%E7%82%B9%E7%9A%84%E4%B8%8B%E4%B8%80%E4%B8%AA%E5%8F%B3%E4%BE%A7%E8%8A%82%E7%82%B9%E6%8C%87%E9%92%88II/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ struct Node {&nbsp;&nbsp;int val;&nbsp;&nbsp;Node *left;&nbsp;&nbsp;Node *right;&nbsp;&nbsp;Node *next;} å¡«å……å®ƒçš„æ¯ä¸ª next æŒ‡é’ˆï¼Œè®©è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å…¶ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ã€‚å¦‚æœæ‰¾ä¸åˆ°ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ï¼Œåˆ™å°† next æŒ‡é’ˆè®¾ç½®ä¸º NULLã€‚ åˆå§‹çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰ next æŒ‡é’ˆéƒ½è¢«è®¾ç½®ä¸º NULLã€‚ è¿›é˜¶ï¼š ä½ åªèƒ½ä½¿ç”¨å¸¸é‡çº§é¢å¤–ç©ºé—´ã€‚ ä½¿ç”¨é€’å½’è§£é¢˜ä¹Ÿç¬¦åˆè¦æ±‚ï¼Œæœ¬é¢˜ä¸­é€’å½’ç¨‹åºå ç”¨çš„æ ˆç©ºé—´ä¸ç®—åšé¢å¤–çš„ç©ºé—´å¤æ‚åº¦ã€‚ ç¤ºä¾‹ï¼š è¾“å…¥ï¼š root = [1,2,3,4,5,null,7]è¾“å‡ºï¼š[1,#,2,3,#,4,5,7,#]è§£é‡Šï¼š ç»™å®šäºŒå‰æ ‘å¦‚å›¾ A æ‰€ç¤ºï¼Œä½ çš„å‡½æ•°åº”è¯¥å¡«å……å®ƒçš„æ¯ä¸ª next æŒ‡é’ˆï¼Œä»¥æŒ‡å‘å…¶ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ï¼Œå¦‚å›¾ B æ‰€ç¤ºã€‚ æç¤ºï¼š æ ‘ä¸­çš„èŠ‚ç‚¹æ•°å°äº 6000 -100 &lt;= node.val &lt;= 100 2 è§£æ³•2.1 æ€æƒ³æˆ‘åœ¨leetcode116-å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆç”¨çš„æ–¹æ³•ä»é€‚ç”¨äºè¯¥é¢˜ 2.2 ä»£ç class Solution { List&lt;Node> list; public Node connect(Node root) { list = new ArrayList&lt;Node>(); dfs(root,0); return root; } public void dfs(Node root,int depth){ if(root == null) return; if(list.size()>depth){ Node node = list.get(depth); node.next = root; list.set(depth,root); } else list.add(root); dfs(root.left,depth+1); dfs(root.right,depth+1); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode116-å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ","slug":"leetcode116-å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ","date":"2020-01-14T12:23:22.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode116-å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ/","link":"","permalink":"https://www.codetool.top/article/leetcode116-%E5%A1%AB%E5%85%85%E6%AF%8F%E4%B8%AA%E8%8A%82%E7%82%B9%E7%9A%84%E4%B8%8B%E4%B8%80%E4%B8%AA%E5%8F%B3%E4%BE%A7%E8%8A%82%E7%82%B9%E6%8C%87%E9%92%88/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªå®Œç¾äºŒå‰æ ‘ï¼Œå…¶æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚ï¼Œæ¯ä¸ªçˆ¶èŠ‚ç‚¹éƒ½æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ã€‚äºŒå‰æ ‘å®šä¹‰å¦‚ä¸‹ï¼š struct Node {&nbsp;&nbsp;int val;&nbsp;&nbsp;Node *left;&nbsp;&nbsp;Node *right;&nbsp;&nbsp;Node *next;} å¡«å……å®ƒçš„æ¯ä¸ª next æŒ‡é’ˆï¼Œè®©è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å…¶ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ã€‚å¦‚æœæ‰¾ä¸åˆ°ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ï¼Œåˆ™å°† next æŒ‡é’ˆè®¾ç½®ä¸º NULLã€‚ åˆå§‹çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰ next æŒ‡é’ˆéƒ½è¢«è®¾ç½®ä¸º NULLã€‚ ç¤ºä¾‹ï¼š è¾“å…¥ï¼š{â€œ$idâ€:â€1â€,â€leftâ€:{â€œ$idâ€:â€2â€,â€leftâ€:{â€œ$idâ€:â€3â€,â€leftâ€:null,â€nextâ€:null,â€rightâ€:null,â€valâ€:4},â€nextâ€:null,â€rightâ€:{â€œ$idâ€:â€4â€,â€leftâ€:null,â€nextâ€:null,â€rightâ€:null,â€valâ€:5},â€valâ€:2},â€nextâ€:null,â€rightâ€:{â€œ$idâ€:â€5â€,â€leftâ€:{â€œ$idâ€:â€6â€,â€leftâ€:null,â€nextâ€:null,â€rightâ€:null,â€valâ€:6},â€nextâ€:null,â€rightâ€:{â€œ$idâ€:â€7â€,â€leftâ€:null,â€nextâ€:null,â€rightâ€:null,â€valâ€:7},â€valâ€:3},â€valâ€:1}è¾“å‡ºï¼š {â€œ$idâ€:â€1â€,â€leftâ€:{â€œ$idâ€:â€2â€,â€leftâ€:{â€œ$idâ€:â€3â€,â€leftâ€:null,â€nextâ€:{â€œ$idâ€:â€4â€,â€leftâ€:null,â€nextâ€:{â€œ$idâ€:â€5â€,â€leftâ€:null,â€nextâ€:{â€œ$idâ€:â€6â€,â€leftâ€:null,â€nextâ€:null,â€rightâ€:null,â€valâ€:7},â€rightâ€:null,â€valâ€:6},â€rightâ€:null,â€valâ€:5},â€rightâ€:null,â€valâ€:4},â€nextâ€:{â€œ$idâ€:â€7â€,â€leftâ€:{â€œ$refâ€:â€5â€},â€nextâ€:null,â€rightâ€:{â€œ$refâ€:â€6â€},â€valâ€:3},â€rightâ€:{â€œ$refâ€:â€4â€},â€valâ€:2},â€nextâ€:null,â€rightâ€:{â€œ$refâ€:â€7â€},â€valâ€:1}è§£é‡Šï¼š ç»™å®šäºŒå‰æ ‘å¦‚å›¾ A æ‰€ç¤ºï¼Œä½ çš„å‡½æ•°åº”è¯¥å¡«å……å®ƒçš„æ¯ä¸ª next æŒ‡é’ˆï¼Œä»¥æŒ‡å‘å…¶ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ï¼Œå¦‚å›¾ B æ‰€ç¤ºã€‚ æç¤ºï¼š ä½ åªèƒ½ä½¿ç”¨å¸¸é‡çº§é¢å¤–ç©ºé—´ã€‚ ä½¿ç”¨é€’å½’è§£é¢˜ä¹Ÿç¬¦åˆè¦æ±‚ï¼Œæœ¬é¢˜ä¸­é€’å½’ç¨‹åºå ç”¨çš„æ ˆç©ºé—´ä¸ç®—åšé¢å¤–çš„ç©ºé—´å¤æ‚åº¦ã€‚ 2 è§£æ³•2.1 æ€æƒ³DFSæœç´¢ï¼Œç”¨ä¸€ä¸ªlistå­˜æ”¾æ¯å±‚å‰ä¸€ä¸ªéå†çš„èŠ‚ç‚¹ï¼Œå†æ¬¡éå†åˆ°è¯¥å±‚çš„æ—¶å€™ä»listä¸­å–å‡ºä¸Šä¸€ä¸ªå…ƒç´ å¹¶ä¿®æ”¹nextæŒ‡é’ˆã€‚ 2.2 ä»£ç class Solution { List&lt;Node> list; public Node connect(Node root) { list = new ArrayList&lt;Node>(); dfs(root,0); return root; } public void dfs(Node root,int depth){ if(root == null) return; if(list.size()>depth){ Node node = list.get(depth); node.next = root; list.set(depth,root); } else list.add(root); dfs(root.left,depth+1); dfs(root.right,depth+1); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode105-ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘","slug":"leetcode105-ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘","date":"2020-01-12T18:50:27.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode105-ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘/","link":"","permalink":"https://www.codetool.top/article/leetcode105-%E4%BB%8E%E5%89%8D%E5%BA%8F%E4%B8%8E%E4%B8%AD%E5%BA%8F%E9%81%8D%E5%8E%86%E5%BA%8F%E5%88%97%E6%9E%84%E9%80%A0%E4%BA%8C%E5%8F%89%E6%A0%91/","excerpt":"","text":"1 åŸé¢˜æ ¹æ®ä¸€æ£µæ ‘çš„å‰åºéå†ä¸ä¸­åºéå†æ„é€ äºŒå‰æ ‘ã€‚ æ³¨æ„:ä½ å¯ä»¥å‡è®¾æ ‘ä¸­æ²¡æœ‰é‡å¤çš„å…ƒç´ ã€‚ ä¾‹å¦‚ï¼Œç»™å‡º å‰åºéå† preorder = [3,9,20,15,7]ä¸­åºéå† inorder = [9,3,15,20,7] è¿”å›å¦‚ä¸‹çš„äºŒå‰æ ‘ï¼š &nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;/ \\&nbsp;&nbsp;9&nbsp;&nbsp;20&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;15&nbsp;&nbsp;&nbsp;7 2 è§£æ³•2.1 æ€æƒ³æ ¹æ®å‰åºéå†ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ ¹ã€ä¸­åºéå†ä»¥æ ¹ä¸ºä¸­å¿ƒåˆ’åˆ†å·¦å­æ ‘å’Œå³å­æ ‘çš„ç‰¹ç‚¹ï¼Œé€’å½’æ„é€ å·¦å­æ ‘å’Œå³å­æ ‘ã€‚ ç®—æ³•ä¼˜åŒ–è¿‡ç¨‹è§ï¼šleetcode106-ä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘ 2.2 ä»£ç class Solution { int[] preorderGlobal; Map&lt;Integer,Integer> map; public TreeNode buildTree(int[] preorder, int[] inorder) { preorderGlobal = preorder; map = new HashMap&lt;>(); for(int i = 0;i &lt; inorder.length; i++) map.put(inorder[i], i); if(preorder.length == 0) return null; TreeNode root = getUnit(0,preorder.length,0,inorder.length); return root; } public TreeNode getUnit(int preorderStart,int preorderEnd,int inorderStart,int inorderEnd){ if(preorderStart==preorderEnd) return null; TreeNode root = new TreeNode(preorderGlobal[preorderStart]); int index = map.get(preorderGlobal[preorderStart]); int leftCount = index - inorderStart; root.left = getUnit(preorderStart+1,preorderStart+leftCount+1,inorderStart,index); root.right = getUnit(preorderStart+leftCount+1,preorderEnd,index+1,inorderEnd); return root; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode106-ä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘","slug":"leetcode106-ä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘","date":"2020-01-12T18:43:49.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode106-ä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘/","link":"","permalink":"https://www.codetool.top/article/leetcode106-%E4%BB%8E%E4%B8%AD%E5%BA%8F%E4%B8%8E%E5%90%8E%E5%BA%8F%E9%81%8D%E5%8E%86%E5%BA%8F%E5%88%97%E6%9E%84%E9%80%A0%E4%BA%8C%E5%8F%89%E6%A0%91/","excerpt":"","text":"1 åŸé¢˜æ ¹æ®ä¸€æ£µæ ‘çš„ä¸­åºéå†ä¸ååºéå†æ„é€ äºŒå‰æ ‘ã€‚ æ³¨æ„:ä½ å¯ä»¥å‡è®¾æ ‘ä¸­æ²¡æœ‰é‡å¤çš„å…ƒç´ ã€‚ ä¾‹å¦‚ï¼Œç»™å‡º ä¸­åºéå† inorder = [9,3,15,20,7]ååºéå† postorder = [9,15,7,20,3] è¿”å›å¦‚ä¸‹çš„äºŒå‰æ ‘ï¼š &nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;/ \\&nbsp;&nbsp;9&nbsp;&nbsp;20&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;15&nbsp;&nbsp;&nbsp;7 2 è§£æ³•2.1 æ€æƒ³æ ¹æ®ååºéå†æœ€åä¸€ä¸ªå…ƒç´ æ˜¯æ ¹ã€ä¸­åºéå†ä»¥æ ¹ä¸ºä¸­å¿ƒåˆ’åˆ†å·¦å­æ ‘å’Œå³å­æ ‘çš„ç‰¹ç‚¹ï¼Œé€’å½’æ„é€ å·¦å­æ ‘å’Œå³å­æ ‘ã€‚ 2.2 ä»£ç æˆ‘ä»¬é€æ¸æ¥ä¼˜åŒ–æ—¶é—´å¤æ‚åº¦ï¼š ç¬¬ä¸€ç‰ˆï¼Œè¾ƒå¥½æ‡‚ï¼š class Solution { public int indexOf(int target,int[] order){ for(int i = 0;i&lt;order.length;i++){ if(order[i] == target) return i; } return -1; } public TreeNode buildTree(int[] inorder, int[] postorder) { if(postorder.length == 0) return null; TreeNode root = getUnit(inorder,postorder); return root; } public TreeNode getUnit(int[] inorder,int[] postorder){ if(postorder.length == 0) return null; TreeNode root = new TreeNode(postorder[postorder.length-1]); int index = indexOf(postorder[postorder.length-1],inorder); int[] leftpartInorder = Arrays.copyOfRange(inorder,0,index); int[] rightpartInorder = Arrays.copyOfRange(inorder,index+1,inorder.length); int leftCount = leftpartInorder.length; int[] leftpartPostorder = Arrays.copyOfRange(postorder,0,leftCount); int[] rightpartPostorder = Arrays.copyOfRange(postorder,leftCount,postorder.length-1); root.left = getUnit(leftpartInorder,leftpartPostorder); root.right = getUnit(rightpartInorder,rightpartPostorder); return root; } } ç¬¬äºŒç‰ˆï¼Œä¸ç”¨å†å¤åˆ¶æ•°ç»„ï¼Œç›´æ¥åœ¨åŸæ•°ç»„ä¸Šæ“ä½œï¼š class Solution { int[] inorderGlobal; int[] postorderGlobal; public int indexOf(int target,int start,int end){ for(int i = 0;i&lt;end-start;i++){ if(inorderGlobal[i+start] == target) return i+start; } return -1; } public TreeNode buildTree(int[] inorder, int[] postorder) { inorderGlobal = inorder; postorderGlobal = postorder; if(postorder.length == 0) return null; TreeNode root = getUnit(0,inorder.length,0,postorder.length); return root; } public TreeNode getUnit(int inorderStart,int inorderEnd,int postorderStart,int postorderEnd){ if(postorderEnd==postorderStart) return null; TreeNode root = new TreeNode(postorderGlobal[postorderEnd-1]); int index = indexOf(postorderGlobal[postorderEnd-1],inorderStart,inorderEnd); int leftCount = index-inorderStart; root.left = getUnit(inorderStart,index,postorderStart,leftCount+postorderStart); root.right = getUnit(index+1,inorderEnd,postorderStart+leftCount,postorderEnd-1); return root; } } ç¬¬ä¸‰ç‰ˆï¼Œæ—¢ç„¶ç»å¸¸è¦ç”¨æŸ¥æ‰¾å…ƒç´ åœ¨ä¸­åºéå†ä¸­çš„ä½ç½®ï¼Œå¯ä»¥ä¸éœ€è¦ä½¿ç”¨indexOfå‡½æ•°ï¼Œè€Œæ˜¯ä¸€å¼€å§‹åˆ™å°†å¯¹åº”å…³ç³»ä¿å­˜åœ¨å“ˆå¸Œè¡¨ä¸­ï¼š class Solution { int[] postorderGlobal; Map&lt;Integer,Integer> map; public TreeNode buildTree(int[] inorder, int[] postorder) { postorderGlobal = postorder; map = new HashMap&lt;>(); for(int i = 0;i &lt; inorder.length; i++) map.put(inorder[i], i); if(postorder.length == 0) return null; TreeNode root = getUnit(0,inorder.length,0,postorder.length); return root; } public TreeNode getUnit(int inorderStart,int inorderEnd,int postorderStart,int postorderEnd){ if(postorderEnd==postorderStart) return null; TreeNode root = new TreeNode(postorderGlobal[postorderEnd-1]); int index = map.get(postorderGlobal[postorderEnd-1]); int leftCount = index-inorderStart; root.left = getUnit(inorderStart,index,postorderStart,leftCount+postorderStart); root.right = getUnit(index+1,inorderEnd,postorderStart+leftCount,postorderEnd-1); return root; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode112-è·¯å¾„æ€»å’Œ","slug":"leetcode112-è·¯å¾„æ€»å’Œ","date":"2020-01-11T16:31:56.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode112-è·¯å¾„æ€»å’Œ/","link":"","permalink":"https://www.codetool.top/article/leetcode112-%E8%B7%AF%E5%BE%84%E6%80%BB%E5%92%8C/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªäºŒå‰æ ‘å’Œä¸€ä¸ªç›®æ ‡å’Œï¼Œåˆ¤æ–­è¯¥æ ‘ä¸­æ˜¯å¦å­˜åœ¨æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ï¼Œè¿™æ¡è·¯å¾„ä¸Šæ‰€æœ‰èŠ‚ç‚¹å€¼ç›¸åŠ ç­‰äºç›®æ ‡å’Œã€‚ è¯´æ˜: å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚ ç¤ºä¾‹:ç»™å®šå¦‚ä¸‹äºŒå‰æ ‘ï¼Œä»¥åŠç›®æ ‡å’Œ sum = 22ï¼Œ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;/&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;13&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;\\ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;7&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 è¿”å› true, å› ä¸ºå­˜åœ¨ç›®æ ‡å’Œä¸º 22 çš„æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ 5-&gt;4-&gt;11-&gt;2ã€‚ 2 è§£æ³•2.1 æ€æƒ³DFSæœç´¢ï¼Œæ¯ç»è¿‡ä¸€ä¸ªèŠ‚ç‚¹å‡å»å¯¹åº”èŠ‚ç‚¹çš„å€¼ï¼Œåˆ°å¶å­èŠ‚ç‚¹çš„æ—¶å€™æŸ¥çœ‹æ˜¯å¦ä¸º0ã€‚ 2.2 ä»£ç class Solution { public boolean hasPathSum(TreeNode root, int sum) { if(root == null) return false; int left = sum-root.val; if(left == 0 &amp;&amp; root.left==null &amp;&amp; root.right == null) return true; return hasPathSum(root.left,left)||hasPathSum(root.right,left); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°05","slug":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°05","date":"2020-01-11T16:07:31.000Z","updated":"2020-04-22T09:27:27.204Z","comments":true,"path":"article/æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°05/","link":"","permalink":"https://www.codetool.top/article/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%AC%AC%E4%B8%89%E7%89%88%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B005/","excerpt":"","text":"ç»­æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°04 1 HotSpotçš„ç®—æ³•ç»†èŠ‚å®ç°1.1 æ ¹èŠ‚ç‚¹æšä¸¾å¦‚ä½•é«˜æ•ˆçš„æ‰¾å‡ºæ‰€æœ‰GC Rootsï¼Ÿ è¿„ä»Šä¸ºæ­¢ï¼Œæ‰€æœ‰æ”¶é›†å™¨åœ¨æ ¹èŠ‚ç‚¹æšä¸¾è¿™ä¸€æ­¥éª¤æ—¶éƒ½æ˜¯å¿…é¡»æš‚åœç”¨æˆ·çº¿ç¨‹çš„ï¼Œæšä¸¾æ—¶å¿…é¡»åœ¨ä¸€ä¸ªä¿éšœä¸€è‡´æ€§çš„å¿«ç…§ä¸­æ‰èƒ½è¿›è¡Œã€‚ ç›®å‰ä¸»æµJavaè™šæ‹Ÿæœºä½¿ç”¨çš„éƒ½æ˜¯å‡†ç¡®å¼åƒåœ¾æ”¶é›†ï¼Œåœ¨HotSpotçš„è§£å†³æ–¹æ¡ˆé‡Œï¼Œæ˜¯ä½¿ç”¨ä¸€ç»„ç§°ä¸ºOopMapçš„æ•°æ®ç»“æ„æ¥è·å–é‚£äº›åœ°æ–¹å­˜æ”¾ç€å¯¹è±¡å¼•ç”¨ï¼Œä¸€æ—¦ç±»åŠ è½½åŠ¨ä½œå®Œæˆçš„æ—¶å€™ï¼ŒHotSpotå°±ä¼šæŠŠå¯¹è±¡å†…ä»€ä¹ˆåç§»é‡ä¸Šæ˜¯ä»€ä¹ˆç±»å‹çš„æ•°æ®è®¡ç®—å‡ºæ¥ï¼Œåœ¨å³æ—¶ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šåœ¨ç‰¹å®šçš„ä½ç½®è®°å½•ä¸‹æ ˆé‡Œå’Œå¯„å­˜å™¨é‡Œå“ªäº›ä½ç½®æ˜¯å¼•ç”¨ã€‚è¿™æ ·æ”¶é›†å™¨åœ¨æ‰«ææ—¶å°±å¯ä»¥ç›´æ¥å¾—çŸ¥è¿™äº›ä¿¡æ¯äº†ï¼Œå¹¶ä¸éœ€è¦çœŸæ­£ä¸€ä¸ªä¸æ¼åœ°ä»æ–¹æ³•åŒºç­‰GC Rootså¼€å§‹æŸ¥æ‰¾ã€‚ 1.2 å®‰å…¨ç‚¹å¦‚æœå¯¼è‡´å¼•ç”¨å…³ç³»å˜åŒ–ï¼Œæˆ–è€…è¯´å¯¼è‡´OopMapå†…å®¹å˜åŒ–çš„æŒ‡ä»¤éå¸¸å¤šï¼Œä¸ºæ¯ä¸€æ¡æŒ‡ä»¤éƒ½ç”Ÿæˆå¯¹åº”çš„OopMapï¼Œé‚£å°†ä¼šéœ€è¦å¤§é‡çš„é¢å¤–å­˜å‚¨ç©ºé—´ã€‚ å®é™…ä¸ŠHotSpotä¹Ÿçš„ç¡®æ²¡æœ‰ä¸ºæ¯æ¡æŒ‡ä»¤éƒ½ç”ŸæˆOopMapï¼Œåªæ˜¯åœ¨â€œç‰¹å®šçš„ä½ç½®â€è®°å½•äº†è¿™äº›ä¿¡æ¯ï¼Œè¿™äº›ä½ç½®è¢«ç§°ä¸ºå®‰å…¨ç‚¹ã€‚åªæœ‰ç”¨æˆ·ç¨‹åºæ‰§è¡Œåˆ°è¾¾å®‰å…¨ç‚¹æ‰èƒ½åœä¸‹æ¥è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚ å¯¹äºå®‰å…¨ç‚¹ï¼Œå¦å¤–ä¸€ä¸ªéœ€è¦è€ƒè™‘çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•åœ¨åƒåœ¾æ”¶é›†å‘ç”Ÿæ—¶è®©æ‰€æœ‰çº¿ç¨‹ï¼ˆè¿™é‡Œå…¶å®ä¸åŒ…æ‹¬æ‰§è¡ŒJNIè°ƒç”¨çš„çº¿ç¨‹ï¼‰éƒ½è·‘åˆ°æœ€è¿‘çš„å®‰å…¨ç‚¹ï¼Œç„¶ååœé¡¿ä¸‹æ¥ã€‚æœ‰ä¸¤ç§æ–¹æ³•ï¼š æŠ¢å…ˆå¼ä¸­æ–­ æŠ¢å…ˆå¼ä¸­æ–­ä¸éœ€è¦çº¿ç¨‹çš„æ‰§è¡Œä»£ç ä¸»åŠ¨å»é…åˆï¼Œåœ¨åƒåœ¾æ”¶é›†å‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿé¦–å…ˆæŠŠæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹å…¨éƒ¨ä¸­æ–­ï¼Œå¦‚æœå‘ç°æœ‰ç”¨æˆ·çº¿ç¨‹ä¸­æ–­çš„åœ°æ–¹ä¸åœ¨å®‰å…¨ç‚¹ä¸Šï¼Œå°±æ¢å¤è¿™æ¡çº¿ç¨‹æ‰§è¡Œï¼Œè®©å®ƒä¸€ä¼šå†é‡æ–°ä¸­æ–­ï¼Œç›´åˆ°è·‘åˆ°å®‰å…¨ç‚¹ä¸Šã€‚ ç°åœ¨å‡ ä¹æ²¡æœ‰è™šæ‹Ÿæœºå®ç°é‡‡ç”¨æŠ¢å…ˆå¼ä¸­æ–­æ¥æš‚åœçº¿ç¨‹å“åº”GCäº‹ä»¶ã€‚ ä¸»åŠ¨å¼ä¸­æ–­ å½“åƒåœ¾æ”¶é›†éœ€è¦ä¸­æ–­çº¿ç¨‹çš„æ—¶å€™ï¼Œä¸ç›´æ¥å¯¹çº¿ç¨‹æ“ä½œï¼Œä»…ä»…ç®€å•åœ°è®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½ï¼Œå„ä¸ªçº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹æ—¶ä¼šä¸åœåœ°ä¸»åŠ¨å»è½®è¯¢è¿™ä¸ªæ ‡å¿—ï¼Œä¸€æ—¦å‘ç°ä¸­æ–­æ ‡å¿—ä¸ºçœŸæ—¶å°±è‡ªå·±åœ¨æœ€è¿‘çš„å®‰å…¨ç‚¹ä¸Šä¸»åŠ¨ä¸­æ–­æŒ‚èµ·ã€‚ è½®è¯¢æ ‡å¿—çš„åœ°æ–¹å’Œå®‰å…¨ç‚¹æ˜¯é‡åˆçš„ï¼Œå¦å¤–è¿˜è¦åŠ ä¸Šæ‰€æœ‰åˆ›å»ºå¯¹è±¡å’Œå…¶ä»–éœ€è¦åœ¨Javaå †ä¸Šåˆ†é…å†…å­˜çš„åœ°æ–¹ï¼Œè¿™æ˜¯ä¸ºäº†æ£€æŸ¥æ˜¯å¦å³å°†è¦å‘ç”Ÿåƒåœ¾æ”¶é›†ï¼Œé¿å…æ²¡æœ‰è¶³å¤Ÿå†…å­˜åˆ†é…æ–°å¯¹è±¡ã€‚ ç”±äºè½®è¯¢æ“ä½œåœ¨ä»£ç ä¸­ä¼šé¢‘ç¹å‡ºç°ï¼Œè¿™è¦æ±‚å®ƒå¿…é¡»è¶³å¤Ÿé«˜æ•ˆã€‚HotSpotä½¿ç”¨å†…å­˜ä¿æŠ¤é™·é˜±çš„æ–¹å¼ï¼ŒæŠŠè½®è¯¢æ“ä½œç²¾ç®€è‡³åªæœ‰ä¸€æ¡æ±‡ç¼–æŒ‡ä»¤çš„ç¨‹åº¦ã€‚ä¸‹é¢ä»£ç ä¸­çš„testæŒ‡ä»¤å°±æ˜¯HotSpotç”Ÿæˆçš„è½®è¯¢æŒ‡ä»¤ï¼Œå½“éœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹æ—¶ï¼Œè™šæ‹ŸæœºæŠŠ0x160100çš„å†…å­˜é¡µè®¾ç½®ä¸ºä¸å¯è¯»ï¼Œé‚£çº¿ç¨‹æ‰§è¡Œåˆ°testæŒ‡ä»¤æ—¶å°±ä¼šäº§ç”Ÿä¸€ä¸ªè‡ªé™·å¼‚å¸¸ä¿¡å·ï¼Œç„¶ååœ¨é¢„å…ˆæ³¨å†Œçš„å¼‚å¸¸å¤„ç†å™¨ä¸­æŒ‚èµ·çº¿ç¨‹å®ç°ç­‰å¾…ï¼Œè¿™æ ·ä»…é€šè¿‡ä¸€æ¡æ±‡ç¼–æŒ‡ä»¤ä¾¿å®Œæˆå®‰å…¨ç‚¹è½®è¯¢å’Œè§¦å‘çº¿ç¨‹ä¸­æ–­äº†ã€‚ 0x01b6d627: call 0x01b2b210 ; OopMap{[60]=Oop off=460} ; *invokeinterface size ; - Client1::main@113 (line 23) ; {virtual_call} 0x01b6d62c: nop ; OopMap{[60]=Oop off=461} ; *if_icmplt ; - Client1::main@118 (line 23) 0x01b6d62d: test %eax,0x160100 ; {poll} 0x01b6d633: mov 0x50(%esp),%esi 0x01b6d637: cmp %eax,%esi1.3 å®‰å…¨åŒºåŸŸå¦‚æœç¨‹åºæ²¡æœ‰åˆ†é…å¤„ç†å™¨æ—¶é—´ï¼Œå…¸å‹çš„åœºæ™¯ä¾¿æ˜¯ç”¨æˆ·çº¿ç¨‹å¤„äºSleepçŠ¶æ€æˆ–è€…BlockedçŠ¶æ€ï¼Œè¿™æ—¶å€™çº¿ç¨‹æ— æ³•å“åº”è™šæ‹Ÿæœºçš„ä¸­æ–­è¯·æ±‚ï¼Œä¸èƒ½å†èµ°åˆ°å®‰å…¨çš„åœ°æ–¹å»ä¸­æ–­æŒ‚èµ·è‡ªå·±ã€‚æ­¤æ—¶å¿…é¡»å¼•å…¥å®‰å…¨åŒºåŸŸæ¥è§£å†³ã€‚ å®‰å…¨åŒºåŸŸæ˜¯æŒ‡èƒ½å¤Ÿç¡®ä¿åœ¨æŸä¸€æ®µä»£ç ç‰‡æ®µä¹‹ä¸­ï¼Œå¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤ï¼Œåœ¨è¿™ä¸ªåŒºåŸŸä¸­ä»»æ„åœ°æ–¹å¼€å§‹åƒåœ¾æ”¶é›†éƒ½æ˜¯å®‰å…¨çš„ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠå®‰å…¨åŒºåŸŸçœ‹ä½œè¢«æ‰©å±•æ‹‰ä¼¸äº†çš„å®‰å…¨ç‚¹ã€‚ å½“ç”¨æˆ·çº¿ç¨‹æ‰§è¡Œåˆ°å®‰å…¨åŒºåŸŸé‡Œé¢çš„ä»£ç æ—¶ï¼Œé¦–å…ˆä¼šæ ‡è¯†è‡ªå·±å·²ç»è¿›å…¥äº†å®‰å…¨åŒºåŸŸï¼Œé‚£æ ·å½“è¿™æ®µæ—¶é—´é‡Œè™šæ‹Ÿæœºè¦å‘èµ·åƒåœ¾æ”¶é›†æ—¶å°±ä¸å¿…å»ç®¡è¿™äº›å·²å£°æ˜è‡ªå·±åœ¨å®‰å…¨åŒºåŸŸå†…çš„çº¿ç¨‹äº†ã€‚å½“çº¿ç¨‹è¦ç¦»å¼€å®‰å…¨åŒºåŸŸæ—¶ï¼Œå®ƒè¦æ£€æŸ¥è™šæ‹Ÿæœºæ˜¯å¦å·²ç»å®Œæˆäº†æ ¹èŠ‚ç‚¹æšä¸¾ï¼ˆæˆ–è€…åƒåœ¾æ”¶é›†è¿‡ç¨‹ä¸­å…¶ä»–éœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹çš„é˜¶æ®µï¼‰ï¼Œå¦‚æœå®Œæˆäº†ï¼Œé‚£çº¿ç¨‹å°±å½“ä½œæ²¡äº‹å‘ç”Ÿè¿‡ï¼Œç»§ç»­æ‰§è¡Œï¼›å¦åˆ™å®ƒå°±å¿…é¡»ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°æ”¶åˆ°å¯ä»¥ç¦»å¼€å®‰å…¨åŒºåŸŸçš„ä¿¡å·ä¸ºæ­¢ã€‚ 1.4 è®°å¿†é›†ä¸å¡è¡¨ä¸ºè§£å†³å¯¹è±¡è·¨ä»£å¼•ç”¨æ‰€å¸¦æ¥çš„é—®é¢˜ï¼Œåƒåœ¾æ”¶é›†å™¨åœ¨æ–°ç”Ÿä»£ä¸­å»ºç«‹äº†åä¸ºè®°å¿†é›†ï¼ˆRemembered Setï¼‰çš„æ•°æ®ç»“æ„ï¼Œç”¨ä»¥é¿å…æŠŠæ•´ä¸ªè€å¹´ä»£åŠ è¿›GC Rootsæ‰«æèŒƒå›´ã€‚äº‹å®ä¸Šå¹¶ä¸åªæ˜¯æ–°ç”Ÿä»£ã€è€å¹´ä»£ä¹‹é—´æ‰æœ‰è·¨ä»£å¼•ç”¨çš„é—®é¢˜ï¼Œæ‰€æœ‰æ¶‰åŠéƒ¨åˆ†åŒºåŸŸæ”¶é›†ï¼ˆPartial GCï¼‰è¡Œä¸ºçš„åƒåœ¾æ”¶é›†å™¨ï¼Œå…¸å‹çš„å¦‚G1ã€ZGCå’ŒShenandoahæ”¶é›†å™¨ï¼Œéƒ½ä¼šé¢ä¸´ç›¸åŒçš„é—®é¢˜ã€‚ è®°å¿†é›†æ˜¯ä¸€ç§ç”¨äºè®°å½•ä»éæ”¶é›†åŒºåŸŸæŒ‡å‘æ”¶é›†åŒºåŸŸçš„æŒ‡é’ˆé›†åˆçš„æŠ½è±¡æ•°æ®ç»“æ„ã€‚å¦‚æœæˆ‘ä»¬ä¸è€ƒè™‘æ•ˆç‡å’Œæˆæœ¬çš„è¯ï¼Œæœ€ç®€å•çš„å®ç°å¯ä»¥ç”¨éæ”¶é›†åŒºåŸŸä¸­æ‰€æœ‰å«è·¨ä»£å¼•ç”¨çš„å¯¹è±¡æ•°ç»„æ¥å®ç°è¿™ä¸ªæ•°æ®ç»“æ„ï¼š Class RememberedSet { Object[] set[OBJECT_INTERGENERATIONAL_REFERENCE_SIZE]; }è¿™ç§è®°å½•å…¨éƒ¨å«è·¨ä»£å¼•ç”¨å¯¹è±¡çš„å®ç°æ–¹æ¡ˆï¼Œæ— è®ºæ˜¯ç©ºé—´å ç”¨è¿˜æ˜¯ç»´æŠ¤æˆæœ¬éƒ½ç›¸å½“é«˜æ˜‚ã€‚è€Œåœ¨åƒåœ¾æ”¶é›†çš„åœºæ™¯ä¸­ï¼Œæ”¶é›†å™¨åªéœ€è¦é€šè¿‡è®°å¿†é›†åˆ¤æ–­å‡ºæŸä¸€å—éæ”¶é›†åŒºåŸŸæ˜¯å¦å­˜åœ¨æœ‰æŒ‡å‘äº†æ”¶é›†åŒºåŸŸçš„æŒ‡é’ˆå°±å¯ä»¥äº†ï¼Œå¹¶ä¸éœ€è¦äº†è§£è¿™äº›è·¨ä»£æŒ‡é’ˆçš„å…¨éƒ¨ç»†èŠ‚ã€‚é‚£è®¾è®¡è€…åœ¨å®ç°è®°å¿†é›†çš„æ—¶å€™ï¼Œä¾¿å¯ä»¥é€‰æ‹©æ›´ä¸ºç²—çŠ·çš„è®°å½•ç²’åº¦æ¥èŠ‚çœè®°å¿†é›†çš„å­˜å‚¨å’Œç»´æŠ¤æˆæœ¬ï¼Œä¸‹é¢æ˜¯ä¸€äº›å¯ä¾›é€‰æ‹©çš„è®°å½•ç²¾åº¦ï¼š å­—é•¿ç²¾åº¦ï¼šæ¯ä¸ªè®°å½•ç²¾ç¡®åˆ°ä¸€ä¸ªæœºå™¨å­—é•¿ï¼ˆå°±æ˜¯å¤„ç†å™¨çš„å¯»å€ä½æ•°ï¼Œå¦‚å¸¸è§çš„32ä½æˆ–64ä½ï¼Œè¿™ä¸ªç²¾åº¦å†³å®šäº†æœºå™¨è®¿é—®ç‰©ç†å†…å­˜åœ°å€çš„æŒ‡é’ˆé•¿åº¦ï¼‰ï¼Œè¯¥å­—åŒ…å«è·¨ä»£æŒ‡é’ˆã€‚ å¯¹è±¡ç²¾åº¦ï¼šæ¯ä¸ªè®°å½•ç²¾ç¡®åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡é‡Œæœ‰å­—æ®µå«æœ‰è·¨ä»£æŒ‡é’ˆã€‚ å¡ç²¾åº¦ï¼šæ¯ä¸ªè®°å½•ç²¾ç¡®åˆ°ä¸€å—å†…å­˜åŒºåŸŸï¼Œè¯¥åŒºåŸŸå†…æœ‰å¯¹è±¡å«æœ‰è·¨ä»£æŒ‡é’ˆã€‚ å…¶ä¸­ï¼Œç¬¬ä¸‰ç§â€œå¡ç²¾åº¦â€æ‰€æŒ‡çš„æ˜¯ç”¨ä¸€ç§ç§°ä¸ºâ€œå¡è¡¨â€ï¼ˆCard Tableï¼‰çš„æ–¹å¼å»å®ç°è®°å¿†é›†ï¼Œè¿™ä¹Ÿæ˜¯ç›®å‰æœ€å¸¸ç”¨çš„ä¸€ç§è®°å¿†é›†å®ç°å½¢å¼ å¡è¡¨æœ€ç®€å•çš„å½¢å¼å¯ä»¥åªæ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œè€ŒHotSpotè™šæ‹Ÿæœºç¡®å®ä¹Ÿæ˜¯è¿™æ ·åšçš„ã€‚ä»¥ä¸‹è¿™è¡Œä»£ç æ˜¯HotSpoté»˜è®¤çš„å¡è¡¨æ ‡è®°é€»è¾‘ï¼š CARD_TABLE [this address &gt;&gt; 9] = 0;å­—èŠ‚æ•°ç»„CARD_TABLEçš„ æ¯ä¸€ä¸ªå…ƒç´ éƒ½å¯¹åº”ç€å…¶æ ‡è¯†çš„å†…å­˜åŒºåŸŸä¸­ä¸€å—ç‰¹å®šå¤§å°çš„å†…å­˜å—ï¼Œè¿™ä¸ªå†…å­˜å—è¢«ç§°ä½œâ€œå¡é¡µâ€ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œå¡é¡µå¤§å°éƒ½æ˜¯ä»¥2çš„Næ¬¡å¹‚çš„å­—èŠ‚æ•°ï¼Œé€šè¿‡ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºHotSpotä¸­ä½¿ç”¨çš„å¡é¡µæ˜¯2çš„9æ¬¡å¹‚ï¼Œå³512å­—èŠ‚ã€‚ ä¸€ä¸ªå¡é¡µçš„å†…å­˜ä¸­é€šå¸¸åŒ…å«ä¸æ­¢ä¸€ä¸ªå¯¹è±¡ï¼Œ åªè¦å¡é¡µå†…æœ‰ä¸€ä¸ªï¼ˆæˆ–æ›´å¤šï¼‰å¯¹è±¡çš„å­—æ®µå­˜åœ¨ç€è·¨ä»£æŒ‡é’ˆï¼Œé‚£å°±å°†å¯¹åº”å¡è¡¨çš„æ•°ç»„å…ƒç´ çš„å€¼æ ‡è¯†ä¸º1ï¼Œç§°ä¸ºè¿™ä¸ªå…ƒç´ å˜è„ï¼Œæ²¡æœ‰åˆ™æ ‡è¯†ä¸º0ã€‚ åœ¨åƒåœ¾æ”¶é›†å‘ç”Ÿæ—¶ï¼Œåªè¦ç­›é€‰å‡ºå¡è¡¨ä¸­å˜è„çš„å…ƒç´ ï¼Œå°±èƒ½è½»æ˜“å¾—å‡ºå“ªäº›å¡é¡µå†…å­˜å—ä¸­åŒ…å«è·¨ä»£æŒ‡é’ˆï¼ŒæŠŠå®ƒä»¬åŠ å…¥GC Rootsä¸­ä¸€å¹¶æ‰«æã€‚ 1.5 å†™å±éšœå¡è¡¨å…ƒç´ ä½•æ—¶å˜è„ã€è°æ¥æŠŠå®ƒä»¬å˜è„ï¼Ÿ å¡è¡¨å…ƒç´ ä½•æ—¶å˜è„çš„ç­”æ¡ˆæ˜¯å¾ˆæ˜ç¡®çš„â€”â€”æœ‰å…¶ä»–åˆ†ä»£åŒºåŸŸä¸­å¯¹è±¡å¼•ç”¨äº†æœ¬åŒºåŸŸå¯¹è±¡æ—¶ï¼Œå…¶å¯¹åº”çš„å¡è¡¨å…ƒç´ å°±åº”è¯¥å˜è„ï¼Œå˜è„æ—¶é—´ç‚¹åŸåˆ™ä¸Šåº”è¯¥å‘ç”Ÿåœ¨å¼•ç”¨ç±»å‹å­—æ®µèµ‹å€¼çš„é‚£ä¸€åˆ»ã€‚ä½†é—®é¢˜æ˜¯å¦‚ä½•å˜è„ï¼Œå³å¦‚ä½•åœ¨å¯¹è±¡èµ‹å€¼çš„é‚£ä¸€åˆ»å»æ›´æ–°ç»´æŠ¤å¡è¡¨å‘¢ï¼Ÿå‡å¦‚æ˜¯è§£é‡Šæ‰§è¡Œçš„å­—èŠ‚ç ï¼Œé‚£ç›¸å¯¹å¥½å¤„ç†ï¼Œè™šæ‹Ÿæœºè´Ÿè´£æ¯æ¡å­—èŠ‚ç æŒ‡ä»¤çš„æ‰§è¡Œï¼Œæœ‰å……åˆ†çš„ä»‹å…¥ç©ºé—´ï¼›ä½†åœ¨ç¼–è¯‘æ‰§è¡Œçš„åœºæ™¯ä¸­å‘¢ï¼Ÿç»è¿‡å³æ—¶ç¼–è¯‘åçš„ä»£ç å·²ç»æ˜¯çº¯ç²¹çš„æœºå™¨æŒ‡ä»¤æµäº†ï¼Œè¿™å°±å¿…é¡»æ‰¾åˆ°ä¸€ä¸ªåœ¨æœºå™¨ç å±‚é¢çš„æ‰‹æ®µï¼ŒæŠŠç»´æŠ¤å¡è¡¨çš„åŠ¨ä½œæ”¾åˆ°æ¯ä¸€ä¸ªèµ‹å€¼æ“ä½œä¹‹ä¸­ã€‚ å†™å±éšœå¯ä»¥çœ‹ä½œåœ¨è™šæ‹Ÿæœºå±‚é¢å¯¹â€œå¼•ç”¨ç±»å‹å­—æ®µèµ‹å€¼â€è¿™ä¸ªåŠ¨ä½œçš„AOPåˆ‡é¢ï¼Œåœ¨å¼•ç”¨å¯¹è±¡èµ‹å€¼æ—¶ä¼šäº§ç”Ÿä¸€ä¸ªç¯å½¢é€šçŸ¥ï¼Œä¾›ç¨‹åºæ‰§è¡Œé¢å¤–çš„åŠ¨ä½œï¼Œä¹Ÿå°±æ˜¯è¯´èµ‹å€¼çš„å‰åéƒ½åœ¨å†™å±éšœçš„è¦†ç›–èŒƒç•´å†…ã€‚åœ¨èµ‹å€¼å‰çš„éƒ¨åˆ†çš„å†™å±éšœå«ä½œå†™å‰å±éšœï¼Œåœ¨èµ‹å€¼åçš„åˆ™å«ä½œå†™åå±éšœã€‚HotSpotè™šæ‹Ÿæœºçš„è®¸å¤šæ”¶é›†å™¨ä¸­éƒ½æœ‰ä½¿ç”¨åˆ°å†™å±éšœï¼Œä½†ç›´è‡³G1æ”¶é›†å™¨å‡ºç°ä¹‹å‰ï¼Œå…¶ä»–æ”¶é›†å™¨éƒ½åªç”¨åˆ°äº†å†™åå±éšœã€‚ ä¸‹é¢è¿™æ®µä»£ç æ˜¯ä¸€æ®µæ›´æ–°å¡è¡¨çŠ¶æ€çš„ç®€åŒ–é€»è¾‘ï¼š void oop_field_store(oop* field, oop new_value) { // å¼•ç”¨å­—æ®µèµ‹å€¼æ“ä½œ *field = new_value; // å†™åå±éšœï¼Œåœ¨è¿™é‡Œå®Œæˆå¡è¡¨çŠ¶æ€æ›´æ–° post_write_barrier(field, new_value); } åº”ç”¨å†™å±éšœåï¼Œè™šæ‹Ÿæœºå°±ä¼šä¸ºæ‰€æœ‰èµ‹å€¼æ“ä½œç”Ÿæˆç›¸åº”çš„æŒ‡ä»¤ï¼Œä¸€æ—¦æ”¶é›†å™¨åœ¨å†™å±éšœä¸­å¢åŠ äº†æ›´æ–°å¡è¡¨æ“ä½œï¼Œæ— è®ºæ›´æ–°çš„æ˜¯ä¸æ˜¯è€å¹´ä»£å¯¹æ–°ç”Ÿä»£å¯¹è±¡çš„å¼•ç”¨ï¼Œæ¯æ¬¡åªè¦å¯¹å¼•ç”¨è¿›è¡Œæ›´æ–°ï¼Œå°±ä¼šäº§ç”Ÿé¢å¤–çš„å¼€é”€ï¼Œä¸è¿‡å¼€é”€è¾ƒå°ã€‚ å¡è¡¨åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹è¿˜é¢ä¸´ç€â€œä¼ªå…±äº«â€é—®é¢˜ï¼Œç°ä»£ä¸­å¤®å¤„ç†å™¨çš„ç¼“å­˜ç³»ç»Ÿä¸­æ˜¯ä»¥ç¼“å­˜è¡Œï¼ˆCache Lineï¼‰ä¸ºå•ä½å­˜å‚¨çš„ï¼Œå½“å¤šçº¿ç¨‹ä¿®æ”¹äº’ç›¸ç‹¬ç«‹çš„å˜é‡æ—¶ï¼Œå¦‚æœè¿™äº›å˜é‡æ°å¥½å…±äº«åŒä¸€ä¸ªç¼“å­˜è¡Œï¼Œå°±ä¼šå½¼æ­¤å½±å“ï¼ˆå†™å›ã€æ— æ•ˆåŒ–æˆ–è€…åŒæ­¥ï¼‰è€Œå¯¼è‡´æ€§èƒ½é™ä½ã€‚ ä¸€ç§ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¸é‡‡ç”¨æ— æ¡ä»¶çš„å†™å±éšœï¼Œè€Œæ˜¯å…ˆæ£€æŸ¥å¡è¡¨æ ‡è®°ï¼Œåªæœ‰å½“è¯¥å¡è¡¨å…ƒç´ æœªè¢«æ ‡è®°è¿‡æ—¶æ‰å°†å…¶æ ‡è®°ä¸ºå˜è„ã€‚ åœ¨JDK 7ä¹‹åï¼ŒHotSpotè™šæ‹Ÿæœºå¢åŠ äº†ä¸€ä¸ªæ–°çš„å‚æ•°-XXï¼š+UseCondCardMarkï¼Œç”¨æ¥å†³å®šæ˜¯å¦å¼€å¯å¡è¡¨æ›´æ–°çš„æ¡ä»¶åˆ¤æ–­ã€‚å¼€å¯ä¼šå¢åŠ ä¸€æ¬¡é¢å¤–åˆ¤æ–­çš„å¼€é”€ï¼Œä½†èƒ½å¤Ÿé¿å…ä¼ªå…±äº«é—®é¢˜ï¼Œä¸¤è€…å„æœ‰æ€§èƒ½æŸè€—ï¼Œæ˜¯å¦æ‰“å¼€è¦æ ¹æ®åº”ç”¨å®é™…è¿è¡Œæƒ…å†µæ¥è¿›è¡Œæµ‹è¯•æƒè¡¡ã€‚ 1.6 å¹¶å‘çš„å¯è¾¾æ€§åˆ†æå¯è¾¾æ€§åˆ†æç®—æ³•ç†è®ºä¸Šè¦æ±‚å…¨è¿‡ç¨‹éƒ½åŸºäºä¸€ä¸ªèƒ½ä¿éšœä¸€è‡´æ€§çš„å¿«ç…§ä¸­æ‰èƒ½å¤Ÿè¿›è¡Œåˆ†æï¼Œè¿™æ„å‘³ç€å¿…é¡»å…¨ç¨‹å†»ç»“ç”¨æˆ·çº¿ç¨‹çš„è¿è¡Œã€‚ å¦‚æœè¿‡ç¨‹å‰åä¸ä¸€è‡´å¯èƒ½å‡ºç°ä¸¤ç§åæœï¼šä¸€ç§æ˜¯æŠŠåŸæœ¬æ¶ˆäº¡çš„å¯¹è±¡é”™è¯¯æ ‡è®°ä¸ºå­˜æ´»ï¼Œè¿™å…¶å®æ˜¯å¯ä»¥å®¹å¿çš„ï¼Œåªä¸è¿‡äº§ç”Ÿäº†ä¸€ç‚¹é€ƒè¿‡æœ¬æ¬¡æ”¶é›†çš„æµ®åŠ¨åƒåœ¾è€Œå·²ï¼Œä¸‹æ¬¡æ”¶é›†æ¸…ç†æ‰å°±å¥½ã€‚å¦ä¸€ç§æ˜¯æŠŠåŸæœ¬å­˜æ´»çš„å¯¹è±¡é”™è¯¯æ ‡è®°ä¸ºå·²æ¶ˆäº¡ï¼Œè¿™å°±æ˜¯éå¸¸è‡´å‘½çš„åæœäº†ã€‚ æˆ‘ä»¬å¼•å…¥ä¸‰è‰²æ ‡è®°ä½œä¸ºå·¥å…·æ¥è¾…åŠ©æ¨å¯¼ï¼ŒæŠŠéå†å¯¹è±¡å›¾è¿‡ç¨‹ä¸­é‡åˆ°çš„å¯¹è±¡ï¼ŒæŒ‰ç…§â€œæ˜¯å¦è®¿é—®è¿‡â€è¿™ä¸ªæ¡ä»¶æ ‡è®°æˆä»¥ä¸‹ä¸‰ç§é¢œè‰²ï¼š ç™½è‰²ï¼šè¡¨ç¤ºå¯¹è±¡å°šæœªè¢«åƒåœ¾æ”¶é›†å™¨è®¿é—®è¿‡ã€‚æ˜¾ç„¶åœ¨å¯è¾¾æ€§åˆ†æåˆšåˆšå¼€å§‹çš„é˜¶æ®µï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯ç™½è‰²çš„ï¼Œè‹¥åœ¨åˆ†æç»“æŸçš„é˜¶æ®µï¼Œä»ç„¶æ˜¯ç™½è‰²çš„å¯¹è±¡ï¼Œå³ä»£è¡¨ä¸å¯è¾¾ã€‚ é»‘è‰²ï¼šè¡¨ç¤ºå¯¹è±¡å·²ç»è¢«åƒåœ¾æ”¶é›†å™¨è®¿é—®è¿‡ï¼Œä¸”è¿™ä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½å·²ç»æ‰«æè¿‡ã€‚é»‘è‰²çš„å¯¹è±¡ä»£è¡¨å·²ç»æ‰«æè¿‡ï¼Œå®ƒæ˜¯å®‰å…¨å­˜æ´»çš„ï¼Œå¦‚æœæœ‰å…¶ä»–å¯¹è±¡å¼•ç”¨æŒ‡å‘äº†é»‘è‰²å¯¹è±¡ï¼Œæ— é¡»é‡æ–°æ‰«æä¸€éã€‚é»‘è‰²å¯¹è±¡ä¸å¯èƒ½ç›´æ¥ï¼ˆä¸ç»è¿‡ç°è‰²å¯¹è±¡ï¼‰æŒ‡å‘æŸä¸ªç™½è‰²å¯¹è±¡ã€‚ ç°è‰²ï¼šè¡¨ç¤ºå¯¹è±¡å·²ç»è¢«åƒåœ¾æ”¶é›†å™¨è®¿é—®è¿‡ï¼Œä½†è¿™ä¸ªå¯¹è±¡ä¸Šè‡³å°‘å­˜åœ¨ä¸€ä¸ªå¼•ç”¨è¿˜æ²¡æœ‰è¢«æ‰«æè¿‡ã€‚ å½“ä¸”ä»…å½“ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³æ—¶ï¼Œä¼šäº§ç”Ÿâ€œå¯¹è±¡æ¶ˆå¤±â€çš„é—®é¢˜ï¼Œå³åŸæœ¬åº”è¯¥æ˜¯é»‘è‰²çš„å¯¹è±¡è¢«è¯¯æ ‡ä¸ºç™½è‰²ï¼š èµ‹å€¼å™¨æ’å…¥äº†ä¸€æ¡æˆ–å¤šæ¡ä»é»‘è‰²å¯¹è±¡åˆ°ç™½è‰²å¯¹è±¡çš„æ–°å¼•ç”¨ï¼› èµ‹å€¼å™¨åˆ é™¤äº†å…¨éƒ¨ä»ç°è‰²å¯¹è±¡åˆ°è¯¥ç™½è‰²å¯¹è±¡çš„ç›´æ¥æˆ–é—´æ¥å¼•ç”¨ã€‚ è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»…éœ€ç ´åå…¶ä¸­ä»»ä¸€æ¡ä»¶ï¼Œç”±æ­¤åˆ†åˆ«äº§ç”Ÿäº†ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼šå¢é‡æ›´æ–°å’ŒåŸå§‹å¿«ç…§ã€‚ å¢é‡æ›´æ–°ï¼šå½“é»‘è‰²å¯¹è±¡æ’å…¥æ–°çš„æŒ‡å‘ç™½è‰²å¯¹è±¡çš„å¼•ç”¨å…³ç³»æ—¶ï¼Œå°±å°†è¿™ä¸ªæ–°æ’å…¥çš„å¼•ç”¨è®°å½•ä¸‹æ¥ï¼Œç­‰å¹¶å‘æ‰«æç»“æŸä¹‹åï¼Œå†å°†è¿™äº›è®°å½•è¿‡çš„å¼•ç”¨å…³ç³»ä¸­çš„é»‘è‰²å¯¹è±¡ä¸ºæ ¹ï¼Œé‡æ–°æ‰«æä¸€æ¬¡ã€‚è¿™å¯ä»¥ç®€åŒ–ç†è§£ä¸ºï¼Œé»‘è‰²å¯¹è±¡ä¸€æ—¦æ–°æ’å…¥äº†æŒ‡å‘ç™½è‰²å¯¹è±¡çš„å¼•ç”¨ä¹‹åï¼Œå®ƒå°±å˜å›ç°è‰²å¯¹è±¡äº†ã€‚ åŸå§‹å¿«ç…§ï¼šå½“ç°è‰²å¯¹è±¡è¦åˆ é™¤æŒ‡å‘ç™½è‰²å¯¹è±¡çš„å¼•ç”¨å…³ç³»æ—¶ï¼Œå°±å°†è¿™ä¸ªè¦åˆ é™¤çš„å¼•ç”¨è®°å½•ä¸‹æ¥ï¼Œåœ¨å¹¶å‘æ‰«æç»“æŸä¹‹åï¼Œå†å°†è¿™äº›è®°å½•è¿‡çš„å¼•ç”¨å…³ç³»ä¸­çš„ç°è‰²å¯¹è±¡ä¸ºæ ¹ï¼Œé‡æ–°æ‰«æä¸€æ¬¡ã€‚è¿™ä¹Ÿå¯ä»¥ç®€åŒ–ç†è§£ä¸ºï¼Œæ— è®ºå¼•ç”¨å…³ç³»åˆ é™¤ä¸å¦ï¼Œéƒ½ä¼šæŒ‰ç…§åˆšåˆšå¼€å§‹æ‰«æé‚£ä¸€åˆ»çš„å¯¹è±¡å›¾å¿«ç…§æ¥è¿›è¡Œæœç´¢ã€‚ åœ¨HotSpotè™šæ‹Ÿæœºä¸­ï¼Œå¢é‡æ›´æ–°å’ŒåŸå§‹å¿«ç…§è¿™ä¸¤ç§è§£å†³æ–¹æ¡ˆéƒ½æœ‰å®é™…åº”ç”¨ï¼Œè­¬å¦‚ï¼ŒCMSæ˜¯åŸºäºå¢é‡æ›´æ–°æ¥åšå¹¶å‘æ ‡è®°çš„ï¼ŒG1ã€Shenandoahåˆ™æ˜¯ç”¨åŸå§‹å¿«ç…§æ¥å®ç°ã€‚ 2 ç»å…¸åƒåœ¾æ”¶é›†å™¨ è¿™é‡Œå±•ç¤ºäº†ä¸ƒç§ä½œç”¨äºä¸åŒåˆ†ä»£çš„æ”¶é›†å™¨ï¼Œå¦‚æœä¸¤ä¸ªæ”¶é›†å™¨ä¹‹é—´å­˜åœ¨è¿çº¿ï¼Œå°±è¯´æ˜å®ƒä»¬å¯ä»¥æ­é…ä½¿ç”¨ã€‚é‡ç‚¹åˆ†æCMSå’ŒG1è¿™ä¸¤æ¬¾ç›¸å¯¹å¤æ‚è€Œåˆå¹¿æ³›ä½¿ç”¨çš„æ”¶é›†å™¨ã€‚ JAVA9å–æ¶ˆäº†å¯¹Serial+CMSã€ParNew+Serial Oldçš„æ”¯æŒã€‚ 2.1 Serailæ”¶é›†å™¨-XX:+UseSerialGC=Serial+SerialOld Serialæ”¶é›†å™¨æ˜¯æœ€åŸºç¡€ã€å†å²æœ€æ‚ ä¹…çš„æ”¶é›†å™¨ã€‚è¿™æ˜¯ä¸€ä¸ªå•çº¿ç¨‹å·¥ä½œçš„æ”¶é›†å™¨ï¼Œå®ƒè¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œä¸ä»…åªä¼šä½¿ç”¨ä¸€ä¸ªå¤„ç†å™¨æˆ–ä¸€æ¡æ”¶é›†çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œï¼Œè€Œä¸”å¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰å·¥ä½œçº¿ç¨‹ï¼Œç›´åˆ°å®ƒæ”¶é›†ç»“æŸã€‚ å¯¹äºâ€œStop The Worldâ€ï¼Œä»JDK 1.3å¼€å§‹ï¼Œä¸€ç›´åˆ°ç°åœ¨æœ€æ–°çš„JDK 13ï¼ŒHotSpotè™šæ‹Ÿæœºå¼€å‘å›¢é˜Ÿä¸ºæ¶ˆé™¤æˆ–è€…é™ä½ç”¨æˆ·çº¿ç¨‹å› åƒåœ¾æ”¶é›†è€Œå¯¼è‡´åœé¡¿çš„åŠªåŠ›ä¸€ç›´æŒç»­è¿›è¡Œç€ï¼Œä»Serialæ”¶é›†å™¨åˆ°Parallelæ”¶é›†å™¨ï¼Œå†åˆ°Concurrent Mark Sweepï¼ˆCMSï¼‰å’ŒGarbage Firstï¼ˆG1ï¼‰æ”¶é›†å™¨ï¼Œæœ€ç»ˆè‡³ç°åœ¨åƒåœ¾æ”¶é›†å™¨çš„æœ€å‰æ²¿æˆæœShenandoahå’ŒZGCç­‰ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªä¸ªè¶Šæ¥è¶Šæ„æ€ç²¾å·§ï¼Œè¶Šæ¥è¶Šä¼˜ç§€ï¼Œä¹Ÿè¶Šæ¥è¶Šå¤æ‚çš„åƒåœ¾æ”¶é›†å™¨ä¸æ–­æ¶Œç°ï¼Œç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´åœ¨æŒç»­ç¼©çŸ­ï¼Œä½†æ˜¯ä»ç„¶æ²¡æœ‰åŠæ³•å½»åº•æ¶ˆé™¤ã€‚ è¿„ä»Šä¸ºæ­¢ï¼Œå®ƒä¾ç„¶æ˜¯HotSpotè™šæ‹Ÿæœºè¿è¡Œåœ¨å®¢æˆ·ç«¯æ¨¡å¼ä¸‹çš„é»˜è®¤æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œæœ‰ç€ä¼˜äºå…¶ä»–æ”¶é›†å™¨çš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯ç®€å•è€Œé«˜æ•ˆã€‚å®ƒæ˜¯æ‰€æœ‰æ”¶é›†å™¨é‡Œé¢å¤–å†…å­˜æ¶ˆè€—æœ€å°çš„ï¼Œå¯¹äºå•æ ¸å¤„ç†å™¨æˆ–å¤„ç†å™¨æ ¸å¿ƒæ•°è¾ƒå°‘çš„ç¯å¢ƒæ¥è¯´ï¼ŒSerialæ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œä¸“å¿ƒåšåƒåœ¾æ”¶é›†è‡ªç„¶å¯ä»¥è·å¾—æœ€é«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ã€‚ 2.2 ParNewæ”¶é›†å™¨-XXï¼š+/-UseParNewGC ParNewæ”¶é›†å™¨å®è´¨ä¸Šæ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹å¹¶è¡Œç‰ˆæœ¬ï¼Œé™¤äº†åŒæ—¶ä½¿ç”¨å¤šæ¡çº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†ä¹‹å¤–ï¼Œå…¶ä½™çš„è¡Œä¸ºåŒ…æ‹¬Serialæ”¶é›†å™¨å¯ç”¨çš„æ‰€æœ‰æ§åˆ¶å‚æ•°ï¼ˆä¾‹å¦‚ï¼š-XXï¼šSurvivorRatioã€-XXï¼šPretenureSizeThresholdã€-XXï¼šHandlePromotionFailureç­‰ï¼‰ã€æ”¶é›†ç®—æ³•ã€Stop The Worldã€å¯¹è±¡åˆ†é…è§„åˆ™ã€å›æ”¶ç­–ç•¥ç­‰éƒ½ä¸Serialæ”¶é›†å™¨å®Œå…¨ä¸€è‡´ ParNewæ”¶é›†å™¨é™¤äº†æ”¯æŒå¤šçº¿ç¨‹å¹¶è¡Œæ”¶é›†ä¹‹å¤–ï¼Œå…¶ä»–ä¸Serialæ”¶é›†å™¨ç›¸æ¯”å¹¶æ²¡æœ‰å¤ªå¤šåˆ›æ–°ä¹‹å¤„ï¼Œä½†å®ƒå´æ˜¯ä¸å°‘è¿è¡Œåœ¨æœåŠ¡ç«¯æ¨¡å¼ä¸‹çš„HotSpotè™šæ‹Ÿæœºï¼Œå°¤å…¶æ˜¯JDK 7ä¹‹å‰çš„é—ç•™ç³»ç»Ÿä¸­é¦–é€‰çš„æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªä¸åŠŸèƒ½ã€æ€§èƒ½æ— å…³ä½†å…¶å®å¾ˆé‡è¦çš„åŸå› æ˜¯ï¼šé™¤äº†Serialæ”¶é›†å™¨å¤–ï¼Œç›®å‰åªæœ‰å®ƒèƒ½ä¸CMSæ”¶é›†å™¨é…åˆå·¥ä½œã€‚ éšç€æ›´å…ˆè¿›çš„G1æ”¶é›†å™¨å¸¦ç€CMSç»§æ‰¿è€…å’Œæ›¿ä»£è€…çš„å…‰ç¯ç™»åœºï¼Œä»JDK 9å¼€å§‹,ParNewå’ŒCMSä»æ­¤åªèƒ½äº’ç›¸æ­é…ä½¿ç”¨ï¼Œå†ä¹Ÿæ²¡æœ‰å…¶ä»–æ”¶é›†å™¨èƒ½å¤Ÿå’Œå®ƒä»¬é…åˆäº†ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºä»æ­¤ä»¥åï¼ŒParNewåˆå¹¶å…¥CMSï¼Œæˆä¸ºå®ƒä¸“é—¨å¤„ç†æ–°ç”Ÿä»£çš„ç»„æˆéƒ¨åˆ†ã€‚ å¯ä»¥ä½¿ç”¨-XXï¼šParallelGCThreadså‚æ•°æ¥é™åˆ¶åƒåœ¾æ”¶é›†çš„çº¿ç¨‹æ•°ã€‚ 2.3 Parallel Scavengeæ”¶é›†å™¨-XX:+UseParallelGC -XX:+UseParallelOldGC Parallel Scavengeæ”¶é›†å™¨ä¹Ÿæ˜¯ä¸€æ¬¾æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå®ƒåŒæ ·æ˜¯åŸºäºæ ‡è®°-å¤åˆ¶ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œä¹Ÿæ˜¯èƒ½å¤Ÿå¹¶è¡Œæ”¶é›†çš„å¤šçº¿ç¨‹æ”¶é›†å™¨ã€‚ Parallel Scavengeæ”¶é›†å™¨çš„ç‰¹ç‚¹æ˜¯å®ƒçš„å…³æ³¨ç‚¹ä¸å…¶ä»–æ”¶é›†å™¨ä¸åŒï¼ŒCMSç­‰æ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ˜¯å°½å¯èƒ½åœ°ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼Œè€ŒParallel Scavengeæ”¶é›†å™¨çš„ç›®æ ‡åˆ™æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ï¼ˆThroughputï¼‰ã€‚æ‰€è°“ååé‡å°±æ˜¯å¤„ç†å™¨ç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸å¤„ç†å™¨æ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ã€‚ Parallel Scavengeæ”¶é›†å™¨æä¾›äº†ä¸¤ä¸ªå‚æ•°ç”¨äºç²¾ç¡®æ§åˆ¶ååé‡ï¼Œåˆ†åˆ«æ˜¯æ§åˆ¶æœ€å¤§åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´çš„-XXï¼šMaxGCPauseMilliså‚æ•°ä»¥åŠç›´æ¥è®¾ç½®ååé‡å¤§å°çš„-XXï¼šGCTimeRatioå‚æ•°ã€‚ -XXï¼šGCTimeRatioå‚æ•°çš„å€¼åˆ™åº”å½“æ˜¯ä¸€ä¸ªå¤§äº0å°äº100çš„æ•´æ•°ï¼Œä¹Ÿå°±æ˜¯åƒåœ¾æ”¶é›†æ—¶é—´å æ€»æ—¶é—´çš„æ¯”ç‡ï¼Œç›¸å½“äºååé‡çš„å€’æ•°ã€‚è­¬å¦‚æŠŠæ­¤å‚æ•°è®¾ç½®ä¸º19ï¼Œé‚£å…è®¸çš„æœ€å¤§åƒåœ¾æ”¶é›†æ—¶é—´å°±å æ€»æ—¶é—´çš„5%ï¼ˆå³1/(1+19)ï¼‰ï¼Œé»˜è®¤å€¼ä¸º99ï¼Œå³å…è®¸æœ€å¤§1%ï¼ˆå³1/(1+99)ï¼‰çš„åƒåœ¾æ”¶é›†æ—¶é—´ã€‚ å‚æ•°-XXï¼š+UseAdaptiveSizePolicyï¼šå½“è¿™ä¸ªå‚æ•°è¢«æ¿€æ´»ä¹‹åï¼Œå°±ä¸éœ€è¦äººå·¥æŒ‡å®šæ–°ç”Ÿä»£çš„å¤§å°ï¼ˆ-Xmnï¼‰ã€Edenä¸SurvivoråŒºçš„æ¯”ä¾‹ï¼ˆ-XXï¼šSurvivorRatioï¼‰ã€æ™‹å‡è€å¹´ä»£å¯¹è±¡å¤§å°ï¼ˆ-XXï¼šPretenureSizeThresholdï¼‰ç­‰ç»†èŠ‚å‚æ•°äº†ï¼Œè™šæ‹Ÿæœºä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´è¿™äº›å‚æ•°ä»¥æä¾›æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–è€…æœ€å¤§çš„ååé‡ã€‚è¿™ç§è°ƒèŠ‚æ–¹å¼ç§°ä¸ºåƒåœ¾æ”¶é›†çš„è‡ªé€‚åº”çš„è°ƒèŠ‚ç­–ç•¥ã€‚ 2.4 Serial Oldæ”¶é›†å™¨Serial Oldæ˜¯Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚ è¿™ä¸ªæ”¶é›†å™¨çš„ä¸»è¦æ„ä¹‰ä¹Ÿæ˜¯ä¾›å®¢æˆ·ç«¯æ¨¡å¼ä¸‹çš„HotSpotè™šæ‹Ÿæœºä½¿ç”¨ã€‚å¦‚æœåœ¨æœåŠ¡ç«¯æ¨¡å¼ä¸‹ï¼Œå®ƒä¹Ÿå¯èƒ½æœ‰ä¸¤ç§ç”¨é€”ï¼š åœ¨JDK 5ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ä¸Parallel Scavengeæ”¶é›†å™¨æ­é…ä½¿ç”¨ ä½œä¸ºCMSæ”¶é›†å™¨å‘ç”Ÿå¤±è´¥æ—¶çš„åå¤‡é¢„æ¡ˆï¼Œåœ¨å¹¶å‘æ”¶é›†å‘ç”ŸConcurrent Mode Failureæ—¶ä½¿ç”¨ã€‚ 2.5 Parallel Oldæ”¶é›†å™¨Parallel Oldæ˜¯Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œæ”¯æŒå¤šçº¿ç¨‹å¹¶å‘æ”¶é›†ï¼ŒåŸºäºæ ‡è®°-æ•´ç†ç®—æ³•å®ç°ã€‚è¿™ä¸ªæ”¶é›†å™¨æ˜¯ç›´åˆ°JDK 6æ—¶æ‰å¼€å§‹æä¾›çš„ï¼Œé…åˆParallel Scavengeæœ‰ç€è‰¯å¥½çš„â€œååé‡ä¼˜å…ˆâ€çš„è¡¨ç°ã€‚ 2.6 CMSæ”¶é›†å™¨CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ä¸€ç§ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ã€‚ç›®å‰å¾ˆå¤§ä¸€éƒ¨åˆ†çš„Javaåº”ç”¨é›†ä¸­åœ¨äº’è”ç½‘ç½‘ç«™æˆ–è€…åŸºäºæµè§ˆå™¨çš„B/Sç³»ç»Ÿçš„æœåŠ¡ç«¯ä¸Šï¼Œè¿™ç±»åº”ç”¨é€šå¸¸éƒ½ä¼šè¾ƒä¸ºå…³æ³¨æœåŠ¡çš„å“åº”é€Ÿåº¦ï¼Œå¸Œæœ›ç³»ç»Ÿåœé¡¿æ—¶é—´å°½å¯èƒ½çŸ­ï¼Œä»¥ç»™ç”¨æˆ·å¸¦æ¥è‰¯å¥½çš„äº¤äº’ä½“éªŒã€‚CMSæ”¶é›†å™¨å°±éå¸¸ç¬¦åˆè¿™ç±»åº”ç”¨çš„éœ€æ±‚ã€‚ CMSæ”¶é›†å™¨æ˜¯åŸºäºæ ‡è®°-æ¸…é™¤ç®—æ³•å®ç°çš„ï¼Œå®ƒçš„è¿ä½œè¿‡ç¨‹ç›¸å¯¹äºå‰é¢å‡ ç§æ”¶é›†å™¨æ¥è¯´è¦æ›´å¤æ‚ä¸€äº›ï¼Œæ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼ŒåŒ…æ‹¬ï¼š åˆå§‹æ ‡è®°ï¼ˆCMS initial markï¼‰ å¹¶å‘æ ‡è®°ï¼ˆCMS concurrent markï¼‰ é‡æ–°æ ‡è®°ï¼ˆCMS remarkï¼‰ å¹¶å‘æ¸…é™¤ï¼ˆCMS concurrent sweepï¼‰ å…¶ä¸­åˆå§‹æ ‡è®°ã€é‡æ–°æ ‡è®°è¿™ä¸¤ä¸ªæ­¥éª¤ä»ç„¶éœ€è¦â€œStop The Worldâ€ã€‚åˆå§‹æ ‡è®°ä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼›å¹¶å‘æ ‡è®°é˜¶æ®µå°±æ˜¯ä»GC Rootsçš„ç›´æ¥å…³è”å¯¹è±¡å¼€å§‹éå†æ•´ä¸ªå¯¹è±¡å›¾çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹è€—æ—¶è¾ƒé•¿ä½†æ˜¯ä¸éœ€è¦åœé¡¿ç”¨æˆ·çº¿ç¨‹ï¼Œå¯ä»¥ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸€èµ·å¹¶å‘è¿è¡Œï¼›è€Œé‡æ–°æ ‡è®°é˜¶æ®µåˆ™æ˜¯ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´ï¼Œå› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´é€šå¸¸ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µç¨é•¿ä¸€äº›ï¼Œä½†ä¹Ÿè¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µçš„æ—¶é—´çŸ­ï¼›æœ€åæ˜¯å¹¶å‘æ¸…é™¤é˜¶æ®µï¼Œæ¸…ç†åˆ é™¤æ‰æ ‡è®°é˜¶æ®µåˆ¤æ–­çš„å·²ç»æ­»äº¡çš„å¯¹è±¡ï¼Œç”±äºä¸éœ€è¦ç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œæ‰€ä»¥è¿™ä¸ªé˜¶æ®µä¹Ÿæ˜¯å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å¹¶å‘çš„ã€‚ ç”±äºåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿çš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤é˜¶æ®µä¸­ï¼Œåƒåœ¾æ”¶é›†å™¨çº¿ç¨‹éƒ½å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œï¼Œæ‰€ä»¥ä»æ€»ä½“ä¸Šæ¥è¯´ï¼ŒCMSæ”¶é›†å™¨çš„å†…å­˜å›æ”¶è¿‡ç¨‹æ˜¯ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å¹¶å‘æ‰§è¡Œçš„ã€‚ CMSæ”¶é›†å™¨çš„ç¼ºç‚¹ï¼š 1) CMSæ”¶é›†å™¨å¯¹å¤„ç†å™¨èµ„æºéå¸¸æ•æ„Ÿã€‚CMSé»˜è®¤å¯åŠ¨çš„å›æ”¶çº¿ç¨‹æ•°æ˜¯ï¼ˆå¤„ç†å™¨æ ¸å¿ƒæ•°é‡+3ï¼‰/4ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå¤„ç†å™¨æ ¸å¿ƒæ•°åœ¨å››ä¸ªæˆ–ä»¥ä¸Šï¼Œå¹¶å‘å›æ”¶æ—¶åƒåœ¾æ”¶é›†çº¿ç¨‹åªå ç”¨ä¸è¶…è¿‡25%çš„å¤„ç†å™¨è¿ç®—èµ„æºï¼Œå¹¶ä¸”ä¼šéšç€å¤„ç†å™¨æ ¸å¿ƒæ•°é‡çš„å¢åŠ è€Œä¸‹é™ã€‚ä½†æ˜¯å½“å¤„ç†å™¨æ ¸å¿ƒæ•°é‡ä¸è¶³å››ä¸ªæ—¶ï¼ŒCMSå¯¹ç”¨æˆ·ç¨‹åºçš„å½±å“å°±å¯èƒ½å˜å¾—å¾ˆå¤§ã€‚ä¸ºäº†ç¼“è§£è¿™ç§æƒ…å†µï¼Œè™šæ‹Ÿæœºæä¾›äº†ä¸€ç§ç§°ä¸ºâ€œå¢é‡å¼å¹¶å‘æ”¶é›†å™¨â€ï¼ˆIncremental Concurrent Mark Sweep/i-CMSï¼‰çš„CMSæ”¶é›†å™¨å˜ç§ï¼Œæ‰€åšçš„äº‹æƒ…å’Œä»¥å‰å•æ ¸å¤„ç†å™¨å¹´ä»£PCæœºæ“ä½œç³»ç»Ÿé æŠ¢å å¼å¤šä»»åŠ¡æ¥æ¨¡æ‹Ÿå¤šæ ¸å¹¶è¡Œå¤šä»»åŠ¡çš„æ€æƒ³ä¸€æ ·ï¼Œæ˜¯åœ¨å¹¶å‘æ ‡è®°ã€æ¸…ç†çš„æ—¶å€™è®©æ”¶é›†å™¨çº¿ç¨‹ã€ç”¨æˆ·çº¿ç¨‹äº¤æ›¿è¿è¡Œï¼Œå°½é‡å‡å°‘åƒåœ¾æ”¶é›†çº¿ç¨‹çš„ç‹¬å èµ„æºçš„æ—¶é—´ï¼Œè¿™æ ·æ•´ä¸ªåƒåœ¾æ”¶é›†çš„è¿‡ç¨‹ä¼šæ›´é•¿ï¼Œä½†å¯¹ç”¨æˆ·ç¨‹åºçš„å½±å“å°±ä¼šæ˜¾å¾—è¾ƒå°‘ä¸€äº›ï¼Œç›´è§‚æ„Ÿå—æ˜¯é€Ÿåº¦å˜æ…¢çš„æ—¶é—´æ›´å¤šäº†ï¼Œä½†é€Ÿåº¦ä¸‹é™å¹…åº¦å°±æ²¡æœ‰é‚£ä¹ˆæ˜æ˜¾ã€‚å®è·µè¯æ˜å¢é‡å¼çš„CMSæ”¶é›†å™¨æ•ˆæœå¾ˆä¸€èˆ¬ï¼Œä» JDK 7å¼€å§‹ï¼Œi-CMSæ¨¡å¼å·²ç»è¢«å£°æ˜ä¸ºâ€œdeprecatedâ€ï¼Œå³å·²è¿‡æ—¶ä¸å†æå€¡ç”¨æˆ·ä½¿ç”¨ï¼Œåˆ°JDK 9å‘å¸ƒåi-CMSæ¨¡å¼è¢«å®Œå…¨åºŸå¼ƒã€‚ 2) CMSæ”¶é›†å™¨æ— æ³•å¤„ç†â€œæµ®åŠ¨åƒåœ¾â€,æœ‰å¯èƒ½å‡ºç°â€œConcurrent Mode Failureâ€å¤±è´¥è¿›è€Œå¯¼è‡´å¦ä¸€æ¬¡å®Œå…¨â€œStop The Worldâ€çš„Full GCçš„äº§ç”Ÿã€‚åœ¨CMSçš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…ç†é˜¶æ®µï¼Œç”¨æˆ·çº¿ç¨‹æ˜¯è¿˜åœ¨ç»§ç»­è¿è¡Œçš„ï¼Œç¨‹åºåœ¨è¿è¡Œè‡ªç„¶å°±è¿˜ä¼šä¼´éšæœ‰æ–°çš„åƒåœ¾å¯¹è±¡ä¸æ–­äº§ç”Ÿï¼Œä½†è¿™ä¸€éƒ¨åˆ†åƒåœ¾å¯¹è±¡æ˜¯å‡ºç°åœ¨æ ‡è®°è¿‡ç¨‹ç»“æŸä»¥åï¼ŒCMSæ— æ³•åœ¨å½“æ¬¡æ”¶é›†ä¸­å¤„ç†æ‰å®ƒä»¬ï¼Œåªå¥½ç•™å¾…ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†æ—¶å†æ¸…ç†æ‰ã€‚è¿™ä¸€éƒ¨åˆ†åƒåœ¾å°±ç§°ä¸ºâ€œæµ®åŠ¨åƒåœ¾â€ã€‚åŒæ ·ä¹Ÿæ˜¯ç”±äºåœ¨åƒåœ¾æ”¶é›†é˜¶æ®µç”¨æˆ·çº¿ç¨‹è¿˜éœ€è¦æŒç»­è¿è¡Œï¼Œé‚£å°±è¿˜éœ€è¦é¢„ç•™è¶³å¤Ÿå†…å­˜ç©ºé—´æä¾›ç»™ç”¨æˆ·çº¿ç¨‹ä½¿ç”¨ï¼Œå› æ­¤CMSæ”¶é›†å™¨ä¸èƒ½åƒå…¶ä»–æ”¶é›†å™¨é‚£æ ·ç­‰å¾…åˆ°è€å¹´ä»£å‡ ä¹å®Œå…¨è¢«å¡«æ»¡äº†å†è¿›è¡Œæ”¶é›†ï¼Œå¿…é¡»é¢„ç•™ä¸€éƒ¨åˆ†ç©ºé—´ä¾›å¹¶å‘æ”¶é›†æ—¶çš„ç¨‹åºè¿ä½œä½¿ç”¨ã€‚åœ¨JDK 5çš„é»˜è®¤è®¾ç½®ä¸‹ï¼ŒCMSæ”¶é›†å™¨å½“è€å¹´ä»£ä½¿ç”¨äº†68%çš„ç©ºé—´åå°±ä¼šè¢«æ¿€æ´»ï¼Œè¿™æ˜¯ä¸€ä¸ªåä¿å®ˆçš„è®¾ç½®ï¼Œå¦‚æœåœ¨å®é™…åº”ç”¨ä¸­è€å¹´ä»£å¢é•¿å¹¶ä¸æ˜¯å¤ªå¿«ï¼Œå¯ä»¥é€‚å½“è°ƒé«˜å‚æ•°-XXï¼šCMSInitiatingOccupancyFractionçš„å€¼æ¥æé«˜CMSçš„è§¦å‘ç™¾åˆ†æ¯”ï¼Œé™ä½å†…å­˜å›æ”¶é¢‘ç‡ï¼Œè·å–æ›´å¥½çš„æ€§èƒ½ã€‚åˆ°äº†JDK 6æ—¶ï¼ŒCMSæ”¶é›†å™¨çš„å¯åŠ¨é˜ˆå€¼å°±å·²ç»é»˜è®¤æå‡è‡³92%ã€‚ä½†è¿™åˆä¼šæ›´å®¹æ˜“é¢ä¸´å¦ä¸€ç§é£é™©ï¼šè¦æ˜¯CMSè¿è¡ŒæœŸé—´é¢„ç•™çš„å†…å­˜æ— æ³•æ»¡è¶³ç¨‹åºåˆ†é…æ–°å¯¹è±¡çš„éœ€è¦ï¼Œå°±ä¼šå‡ºç°ä¸€æ¬¡â€œå¹¶å‘å¤±è´¥â€ï¼ˆConcurrent Mode Failureï¼‰ï¼Œè¿™æ—¶å€™è™šæ‹Ÿæœºå°†ä¸å¾—ä¸å¯åŠ¨åå¤‡é¢„æ¡ˆï¼šå†»ç»“ç”¨æˆ·çº¿ç¨‹çš„æ‰§è¡Œï¼Œä¸´æ—¶å¯ç”¨Serial Oldæ”¶é›†å™¨æ¥é‡æ–°è¿›è¡Œè€å¹´ä»£çš„åƒåœ¾æ”¶é›†ï¼Œä½†è¿™æ ·åœé¡¿æ—¶é—´å°±å¾ˆé•¿äº†ã€‚æ‰€ä»¥å‚æ•°-XXï¼šCMSInitiatingOccupancyFractionè®¾ç½®å¾—å¤ªé«˜å°†ä¼šå¾ˆå®¹æ˜“å¯¼è‡´å¤§é‡çš„å¹¶å‘å¤±è´¥äº§ç”Ÿï¼Œæ€§èƒ½åè€Œé™ä½ï¼Œç”¨æˆ·åº”åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ ¹æ®å®é™…åº”ç”¨æƒ…å†µæ¥æƒè¡¡è®¾ç½®ã€‚ 3) CMSæ˜¯ä¸€æ¬¾åŸºäºâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨,æ”¶é›†ç»“æŸæ—¶ä¼šæœ‰å¤§é‡ç©ºé—´ç¢ç‰‡äº§ç”Ÿ,ç©ºé—´ç¢ç‰‡è¿‡å¤šæ—¶ï¼Œå°†ä¼šç»™å¤§å¯¹è±¡åˆ†é…å¸¦æ¥å¾ˆå¤§éº»çƒ¦ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒCMSæ”¶é›†å™¨æä¾›äº†ä¸€ä¸ª-XXï¼š+UseCMSCompactAtFullCollectionå¼€å…³å‚æ•°ï¼ˆé»˜è®¤æ˜¯å¼€å¯çš„ï¼Œæ­¤å‚æ•°ä» JDK 9å¼€å§‹åºŸå¼ƒï¼‰ï¼Œç”¨äºåœ¨CMSæ”¶é›†å™¨ä¸å¾—ä¸è¿›è¡ŒFull GCæ—¶å¼€å¯å†…å­˜ç¢ç‰‡çš„åˆå¹¶æ•´ç†è¿‡ç¨‹ï¼Œç”±äºè¿™ä¸ªå†…å­˜æ•´ç†å¿…é¡»ç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œï¼ˆåœ¨Shenandoahå’ŒZGCå‡ºç°å‰ï¼‰æ˜¯æ— æ³•å¹¶å‘çš„ã€‚è¿™æ ·ç©ºé—´ç¢ç‰‡é—®é¢˜æ˜¯è§£å†³äº†ï¼Œä½†åœé¡¿æ—¶é—´åˆä¼šå˜é•¿ï¼Œå› æ­¤è™šæ‹Ÿæœºè®¾è®¡è€…ä»¬è¿˜æä¾›äº†å¦å¤–ä¸€ä¸ªå‚æ•°-XXï¼šCMSFullGCsBeforeCompactionï¼ˆæ­¤å‚æ•°ä»JDK 9å¼€å§‹åºŸå¼ƒï¼‰ï¼Œè¿™ä¸ªå‚æ•°çš„ä½œç”¨æ˜¯è¦æ±‚CMSæ”¶é›†å™¨åœ¨æ‰§è¡Œè¿‡è‹¥å¹²æ¬¡ï¼ˆæ•°é‡ç”±å‚æ•°å€¼å†³å®šï¼‰ä¸æ•´ç†ç©ºé—´çš„Full GCä¹‹åï¼Œä¸‹ä¸€æ¬¡è¿›å…¥Full GCå‰ä¼šå…ˆè¿›è¡Œç¢ç‰‡æ•´ç†ï¼ˆé»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºæ¯æ¬¡è¿›å…¥Full GCæ—¶éƒ½è¿›è¡Œç¢ç‰‡æ•´ç†ï¼‰ã€‚ 2.7 Garbage Firstæ”¶é›†å™¨ï¼ˆG1ï¼‰-XX:+UseG1GC Garbage Firstï¼ˆç®€ç§°G1ï¼‰å¼€åˆ›äº†æ”¶é›†å™¨é¢å‘å±€éƒ¨æ”¶é›†çš„è®¾è®¡æ€è·¯å’ŒåŸºäºRegionçš„å†…å­˜å¸ƒå±€å½¢å¼ã€‚ G1æ˜¯ä¸€æ¬¾ä¸»è¦é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„åƒåœ¾æ”¶é›†å™¨ã€‚æœ€åˆæœŸæœ›å¯ä»¥æ›¿æ¢æ‰CMSæ”¶é›†å™¨ã€‚JDK 9å‘å¸ƒä¹‹åä»£æ›¿Parallel ScavengeåŠ Parallel Oldæˆä¸ºæœåŠ¡ç«¯æ¨¡å¼ä¸‹çš„é»˜è®¤åƒåœ¾æ”¶é›†å™¨ï¼Œè€ŒCMSåˆ™æ²¦è½è‡³è¢«å£°æ˜ä¸ºä¸æ¨èä½¿ç”¨ï¼ˆDeprecateï¼‰çš„æ”¶é›†å™¨ã€‚ ç›®æ ‡ï¼š æ”¯æŒå¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹â€”â€”èƒ½å¤Ÿæ”¯æŒæŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸ºMæ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨åƒåœ¾æ”¶é›†ä¸Šçš„æ—¶é—´å¤§æ¦‚ç‡ä¸è¶…è¿‡Næ¯«ç§’ï¼Œè¿™å‡ ä¹å·²ç»æ˜¯å®æ—¶Javaï¼ˆRTSJï¼‰çš„ä¸­è½¯å®æ—¶åƒåœ¾æ”¶é›†å™¨ç‰¹å¾äº†ã€‚ é‚£å…·ä½“è¦æ€ä¹ˆåšæ‰èƒ½å®ç°è¿™ä¸ªç›®æ ‡å‘¢ï¼Ÿ G1å¯ä»¥é¢å‘å †å†…å­˜ä»»ä½•éƒ¨åˆ†æ¥ç»„æˆå›æ”¶é›†ï¼ˆCollection Setï¼Œä¸€èˆ¬ç®€ç§°CSetï¼‰è¿›è¡Œå›æ”¶ï¼Œè¡¡é‡æ ‡å‡†ä¸å†æ˜¯å®ƒå±äºå“ªä¸ªåˆ†ä»£ï¼Œè€Œæ˜¯å“ªå—å†…å­˜ä¸­å­˜æ”¾çš„åƒåœ¾æ•°é‡æœ€å¤šï¼Œå›æ”¶æ”¶ç›Šæœ€å¤§ï¼Œè¿™å°±æ˜¯G1æ”¶é›†å™¨çš„Mixed GCæ¨¡å¼ã€‚ G1ä¸å†åšæŒå›ºå®šå¤§å°ä»¥åŠå›ºå®šæ•°é‡çš„åˆ†ä»£åŒºåŸŸåˆ’åˆ†ï¼Œè€Œæ˜¯æŠŠè¿ç»­çš„Javaå †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼Œæ¯ä¸€ä¸ªRegionéƒ½å¯ä»¥æ ¹æ®éœ€è¦ï¼Œæ‰®æ¼”æ–°ç”Ÿä»£çš„Edenç©ºé—´ã€Survivorç©ºé—´ï¼Œæˆ–è€…è€å¹´ä»£ç©ºé—´ã€‚æ”¶é›†å™¨èƒ½å¤Ÿå¯¹æ‰®æ¼”ä¸åŒè§’è‰²çš„Regioné‡‡ç”¨ä¸åŒçš„ç­–ç•¥å»å¤„ç†ï¼Œè¿™æ ·æ— è®ºæ˜¯æ–°åˆ›å»ºçš„å¯¹è±¡è¿˜æ˜¯å·²ç»å­˜æ´»äº†ä¸€æ®µæ—¶é—´ã€ç†¬è¿‡å¤šæ¬¡æ”¶é›†çš„æ—§å¯¹è±¡éƒ½èƒ½è·å–å¾ˆå¥½çš„æ”¶é›†æ•ˆæœã€‚ -XX:G1HeapRegionSize=sizeè®¾å®šregionå¤§å°ï¼Œå–å€¼èŒƒå›´ä¸º1MBï½32MBï¼Œä¸”åº”ä¸º2çš„Næ¬¡å¹‚ã€‚ Regionä¸­è¿˜æœ‰ä¸€ç±»ç‰¹æ®Šçš„HumongousåŒºåŸŸï¼Œä¸“é—¨ç”¨æ¥å­˜å‚¨å¤§å¯¹è±¡ã€‚ G1è®¤ä¸ºåªè¦å¤§å°è¶…è¿‡äº†ä¸€ä¸ªRegionå®¹é‡ä¸€åŠçš„å¯¹è±¡å³å¯åˆ¤å®šä¸ºå¤§å¯¹è±¡ã€‚è€Œå¯¹äºé‚£äº›è¶…è¿‡äº†æ•´ä¸ªRegionå®¹é‡çš„è¶…çº§å¤§å¯¹è±¡ï¼Œå°†ä¼šè¢«å­˜æ”¾åœ¨Nä¸ªè¿ç»­çš„Humongous Regionä¹‹ä¸­ï¼ŒG1çš„å¤§å¤šæ•°è¡Œä¸ºéƒ½æŠŠHumongous Regionä½œä¸ºè€å¹´ä»£çš„ä¸€éƒ¨åˆ†æ¥è¿›è¡Œçœ‹å¾…ã€‚ è™½ç„¶G1ä»ç„¶ä¿ç•™æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¦‚å¿µï¼Œä½†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸å†æ˜¯å›ºå®šçš„äº†ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸€ç³»åˆ—åŒºåŸŸï¼ˆä¸éœ€è¦è¿ç»­ï¼‰çš„åŠ¨æ€é›†åˆã€‚G1æ”¶é›†å™¨ä¹‹æ‰€ä»¥èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œæ˜¯å› ä¸ºå®ƒå°†Regionä½œä¸ºå•æ¬¡å›æ”¶çš„æœ€å°å•å…ƒï¼Œå³æ¯æ¬¡æ”¶é›†åˆ°çš„å†…å­˜ç©ºé—´éƒ½æ˜¯Regionå¤§å°çš„æ•´æ•°å€ï¼Œè¿™æ ·å¯ä»¥æœ‰è®¡åˆ’åœ°é¿å…åœ¨æ•´ä¸ªJavaå †ä¸­è¿›è¡Œå…¨åŒºåŸŸçš„åƒåœ¾æ”¶é›†ã€‚æ›´å…·ä½“çš„å¤„ç†æ€è·¯æ˜¯è®©G1æ”¶é›†å™¨å»è·Ÿè¸ªå„ä¸ªRegioné‡Œé¢çš„åƒåœ¾å †ç§¯çš„â€œä»·å€¼â€å¤§å°ï¼Œä»·å€¼å³å›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°ä»¥åŠå›æ”¶æ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼ï¼Œç„¶ååœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆçº§åˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®ç”¨æˆ·è®¾å®šå…è®¸çš„æ”¶é›†åœé¡¿æ—¶é—´ï¼Œä¼˜å…ˆå¤„ç†å›æ”¶ä»·å€¼æ”¶ç›Šæœ€å¤§çš„é‚£äº›Regionï¼Œè¿™ä¹Ÿå°±æ˜¯â€œGarbage Firstâ€åå­—çš„ç”±æ¥ã€‚è¿™ç§ä½¿ç”¨Regionåˆ’åˆ†å†…å­˜ç©ºé—´ï¼Œä»¥åŠå…·æœ‰ä¼˜å…ˆçº§çš„åŒºåŸŸå›æ”¶æ–¹å¼ï¼Œä¿è¯äº†G1æ”¶é›†å™¨åœ¨æœ‰é™çš„æ—¶é—´å†…è·å–å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡ã€‚ -XXï¼šMaxGCPauseMillisæŒ‡å®šç”¨æˆ·æœŸæœ›çš„æ”¶é›†åœé¡¿æ—¶é—´ï¼Œé»˜è®¤å€¼æ˜¯200æ¯«ç§’ï¼Œè®¾ç½®æˆä¸€ç™¾æˆ–è€…ä¸¤ä¸‰ç™¾æ˜¯è¾ƒä¸ºåˆç†çš„ã€‚ è§£å†³çš„ç»†èŠ‚é—®é¢˜ï¼š å°†Javaå †åˆ†æˆå¤šä¸ªç‹¬ç«‹Regionåï¼ŒRegioné‡Œé¢å­˜åœ¨çš„è·¨Regionå¼•ç”¨å¯¹è±¡å¦‚ä½•è§£å†³ï¼Ÿå®ƒçš„æ¯ä¸ªRegionéƒ½ç»´æŠ¤æœ‰è‡ªå·±çš„è®°å¿†é›†ï¼Œè¿™äº›è®°å¿†é›†ä¼šè®°å½•ä¸‹åˆ«çš„Region æŒ‡å‘è‡ªå·±çš„æŒ‡é’ˆï¼Œå¹¶æ ‡è®°è¿™äº›æŒ‡é’ˆåˆ†åˆ«åœ¨å“ªäº›å¡é¡µçš„èŒƒå›´ä¹‹å†…ã€‚G1çš„è®°å¿†é›†åœ¨å­˜å‚¨ç»“æ„çš„æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å“ˆå¸Œè¡¨ï¼ŒKeyæ˜¯åˆ«çš„Regionçš„èµ·å§‹åœ°å€ï¼ŒValueæ˜¯ä¸€ä¸ªé›†åˆï¼Œé‡Œé¢å­˜å‚¨çš„å…ƒç´ æ˜¯å¡è¡¨çš„ç´¢å¼•å·ã€‚è¿™ç§â€œåŒå‘â€çš„å¡è¡¨ç»“æ„ï¼ˆå¡è¡¨æ˜¯â€œæˆ‘æŒ‡å‘è°â€ï¼Œè¿™ç§ç»“æ„è¿˜è®°å½•äº†â€œè°æŒ‡å‘æˆ‘â€ï¼‰æ¯”åŸæ¥çš„å¡è¡¨å®ç°èµ·æ¥æ›´å¤æ‚ï¼ŒåŒæ—¶ç”±äºRegionæ•°é‡æ¯”ä¼ ç»Ÿæ”¶é›†å™¨çš„åˆ†ä»£æ•°é‡æ˜æ˜¾è¦å¤šå¾—å¤šï¼Œå› æ­¤G1æ”¶é›†å™¨è¦æ¯”å…¶ä»–çš„ä¼ ç»Ÿåƒåœ¾æ”¶é›†å™¨æœ‰ç€æ›´é«˜çš„å†…å­˜å ç”¨è´Ÿæ‹…ã€‚æ ¹æ®ç»éªŒï¼ŒG1è‡³å°‘è¦è€—è´¹å¤§çº¦ç›¸å½“äºJavaå †å®¹é‡10%è‡³20%çš„é¢å¤–å†…å­˜æ¥ç»´æŒæ”¶é›†å™¨å·¥ä½œã€‚ åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µå¦‚ä½•ä¿è¯æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹äº’ä¸å¹²æ‰°åœ°è¿è¡Œï¼ŸCMSæ”¶é›†å™¨é‡‡ç”¨å¢é‡æ›´æ–°ç®—æ³•å®ç°ï¼Œè€ŒG1 æ”¶é›†å™¨åˆ™æ˜¯é€šè¿‡åŸå§‹å¿«ç…§ç®—æ³•æ¥å®ç°çš„ã€‚G1ä¸ºæ¯ä¸€ä¸ªRegionè®¾è®¡äº†ä¸¤ä¸ªåä¸ºTAMSï¼ˆTop at Mark Startï¼‰çš„æŒ‡é’ˆï¼ŒæŠŠRegionä¸­çš„ä¸€éƒ¨åˆ†ç©ºé—´åˆ’åˆ†å‡ºæ¥ç”¨äºå¹¶å‘å›æ”¶è¿‡ç¨‹ä¸­çš„æ–°å¯¹è±¡åˆ†é…ï¼Œå¹¶å‘å›æ”¶æ—¶æ–°åˆ†é…çš„å¯¹è±¡åœ°å€éƒ½å¿…é¡»è¦åœ¨è¿™ä¸¤ä¸ªæŒ‡é’ˆä½ç½®ä»¥ä¸Šã€‚G1æ”¶é›†å™¨é»˜è®¤åœ¨è¿™ä¸ªåœ°å€ä»¥ä¸Šçš„å¯¹è±¡æ˜¯è¢«éšå¼æ ‡è®°è¿‡çš„ï¼Œå³é»˜è®¤å®ƒä»¬æ˜¯å­˜æ´»çš„ï¼Œä¸çº³å…¥å›æ”¶èŒƒå›´ã€‚ä¸CMSä¸­çš„â€œConcurrent Mode Failureâ€å¤±è´¥ä¼šå¯¼è‡´Full GCç±»ä¼¼ï¼Œå¦‚æœå†…å­˜å›æ”¶çš„é€Ÿåº¦èµ¶ä¸ä¸Šå†…å­˜åˆ†é…çš„é€Ÿåº¦ï¼ŒG1æ”¶é›†å™¨ä¹Ÿè¦è¢«è¿«å†»ç»“ç”¨æˆ·çº¿ç¨‹æ‰§è¡Œï¼Œå¯¼è‡´Full GCè€Œäº§ç”Ÿé•¿æ—¶é—´â€œStop The Worldâ€ã€‚ æ€æ ·å»ºç«‹èµ·å¯é çš„åœé¡¿é¢„æµ‹æ¨¡å‹ï¼ŸG1æ”¶é›†å™¨çš„åœé¡¿é¢„æµ‹æ¨¡å‹æ˜¯ä»¥è¡°å‡å‡å€¼ï¼ˆDecaying Averageï¼‰ä¸ºç†è®ºåŸºç¡€æ¥å®ç°çš„ï¼Œåœ¨åƒåœ¾æ”¶é›†è¿‡ç¨‹ä¸­ï¼ŒG1æ”¶é›†å™¨ä¼šè®°å½•æ¯ä¸ªRegionçš„å›æ”¶è€—æ—¶ã€æ¯ä¸ªRegionè®°å¿†é›†é‡Œçš„è„å¡æ•°é‡ç­‰å„ä¸ªå¯æµ‹é‡çš„æ­¥éª¤èŠ±è´¹çš„æˆæœ¬ï¼Œå¹¶åˆ†æå¾—å‡ºå¹³å‡å€¼ã€æ ‡å‡†åå·®ã€ç½®ä¿¡åº¦ç­‰ç»Ÿè®¡ä¿¡æ¯ã€‚ G1æ”¶é›†å™¨çš„è¿ä½œè¿‡ç¨‹å¤§è‡´å¯åˆ’åˆ†ä¸ºä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š åˆå§‹æ ‡è®°ï¼šä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¿®æ”¹TAMSæŒ‡é’ˆçš„å€¼ï¼Œè®©ä¸‹ä¸€é˜¶æ®µç”¨æˆ·çº¿ç¨‹å¹¶å‘è¿è¡Œæ—¶ï¼Œèƒ½æ­£ç¡®åœ°åœ¨å¯ç”¨çš„Regionä¸­åˆ†é…æ–°å¯¹è±¡ã€‚è¿™ä¸ªé˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†è€—æ—¶å¾ˆçŸ­ï¼Œè€Œä¸”æ˜¯å€Ÿç”¨è¿›è¡ŒMinor GCçš„æ—¶å€™åŒæ­¥å®Œæˆçš„ï¼Œæ‰€ä»¥G1æ”¶é›†å™¨åœ¨è¿™ä¸ªé˜¶æ®µå®é™…å¹¶æ²¡æœ‰é¢å¤–çš„åœé¡¿ã€‚ å¹¶å‘æ ‡è®°ï¼šä»GC Rootå¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œé€’å½’æ‰«ææ•´ä¸ªå †é‡Œçš„å¯¹è±¡å›¾ï¼Œæ‰¾å‡ºè¦å›æ”¶çš„å¯¹è±¡ï¼Œè¿™é˜¶æ®µè€—æ—¶è¾ƒé•¿ï¼Œä½†å¯ä¸ç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚å½“å¯¹è±¡å›¾æ‰«æå®Œæˆä»¥åï¼Œè¿˜è¦é‡æ–°å¤„ç†SATBè®°å½•ä¸‹çš„åœ¨å¹¶å‘æ—¶æœ‰å¼•ç”¨å˜åŠ¨çš„å¯¹è±¡ã€‚ æœ€ç»ˆæ ‡è®°ï¼šå¯¹ç”¨æˆ·çº¿ç¨‹åšå¦ä¸€ä¸ªçŸ­æš‚çš„æš‚åœï¼Œç”¨äºå¤„ç†å¹¶å‘é˜¶æ®µç»“æŸåä»é—ç•™ä¸‹æ¥çš„æœ€åé‚£å°‘é‡çš„SATBè®°å½•ã€‚ ç­›é€‰å›æ”¶ï¼šè´Ÿè´£æ›´æ–°Regionçš„ç»Ÿè®¡æ•°æ®ï¼Œå¯¹å„ä¸ªRegionçš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„åœé¡¿æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ï¼Œå¯ä»¥è‡ªç”±é€‰æ‹©ä»»æ„å¤šä¸ªRegion æ„æˆå›æ”¶é›†ï¼Œç„¶åæŠŠå†³å®šå›æ”¶çš„é‚£ä¸€éƒ¨åˆ†Regionçš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°ç©ºçš„Regionä¸­ï¼Œå†æ¸…ç†æ‰æ•´ä¸ªæ—§Regionçš„å…¨éƒ¨ç©ºé—´ã€‚è¿™é‡Œçš„æ“ä½œæ¶‰åŠå­˜æ´»å¯¹è±¡çš„ç§»åŠ¨ï¼Œæ˜¯å¿…é¡»æš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç”±å¤šæ¡æ”¶é›†å™¨çº¿ç¨‹å¹¶è¡Œå®Œæˆçš„ã€‚ G1æ”¶é›†å™¨é™¤äº†å¹¶å‘æ ‡è®°å¤–ï¼Œå…¶ä½™é˜¶æ®µä¹Ÿæ˜¯è¦å®Œå…¨æš‚åœç”¨æˆ·çº¿ç¨‹çš„ï¼Œæ¢è¨€ä¹‹ï¼Œå®ƒå¹¶éçº¯ç²¹åœ°è¿½æ±‚ä½å»¶è¿Ÿï¼Œå®˜æ–¹ç»™å®ƒè®¾å®šçš„ç›®æ ‡æ˜¯åœ¨å»¶è¿Ÿå¯æ§çš„æƒ…å†µä¸‹è·å¾—å°½å¯èƒ½é«˜çš„ååé‡ã€‚ G1æ”¶é›†å™¨å¸¸ä¼šè¢«æ‹¿æ¥ä¸CMSæ”¶é›†å™¨äº’ç›¸æ¯”è¾ƒï¼Œæ¯•ç«Ÿå®ƒä»¬éƒ½éå¸¸å…³æ³¨åœé¡¿æ—¶é—´çš„æ§åˆ¶ï¼š ä¸CMSçš„â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸åŒï¼ŒG1ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œä½†ä»å±€éƒ¨ï¼ˆä¸¤ä¸ªRegionä¹‹é—´ï¼‰ä¸Šçœ‹åˆæ˜¯åŸºäºâ€œæ ‡è®°-å¤åˆ¶â€ç®—æ³•å®ç°ï¼Œæ— è®ºå¦‚ä½•ï¼Œè¿™ä¸¤ç§ç®—æ³•éƒ½æ„å‘³ç€G1è¿ä½œæœŸé—´ä¸ä¼šäº§ç”Ÿå†…å­˜ç©ºé—´ç¢ç‰‡ï¼Œåƒåœ¾æ”¶é›†å®Œæˆä¹‹åèƒ½æä¾›è§„æ•´çš„å¯ç”¨å†…å­˜ã€‚ åœ¨ç”¨æˆ·ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒG1æ— è®ºæ˜¯ä¸ºäº†åƒåœ¾æ”¶é›†äº§ç”Ÿçš„å†…å­˜å ç”¨ï¼ˆFootprintï¼‰è¿˜æ˜¯ç¨‹åºè¿è¡Œæ—¶çš„é¢å¤–æ‰§è¡Œè´Ÿè½½ï¼ˆOverloadï¼‰éƒ½è¦æ¯”CMSè¦é«˜ã€‚ å°±å†…å­˜å ç”¨æ¥è¯´ï¼Œè™½ç„¶G1å’ŒCMSéƒ½ä½¿ç”¨å¡è¡¨æ¥å¤„ç†è·¨ä»£æŒ‡é’ˆï¼Œä½†G1çš„å¡è¡¨å®ç°æ›´ä¸ºå¤æ‚ï¼Œè€Œä¸”å †ä¸­æ¯ä¸ªRegionï¼Œæ— è®ºæ‰®æ¼”çš„æ˜¯æ–°ç”Ÿä»£è¿˜æ˜¯è€å¹´ä»£è§’è‰²ï¼Œéƒ½å¿…é¡»æœ‰ä¸€ä»½å¡è¡¨ï¼Œè¿™å¯¼è‡´G1çš„è®°å¿†é›†ï¼ˆå’Œå…¶ä»–å†…å­˜æ¶ˆè€—ï¼‰å¯èƒ½ä¼šå æ•´ä¸ªå †å®¹é‡çš„20%ä¹ƒè‡³æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼›ç›¸æ¯”èµ·æ¥CMSçš„å¡è¡¨å°±ç›¸å½“ç®€å•ï¼Œåªæœ‰å”¯ä¸€ä¸€ä»½ï¼Œè€Œä¸”åªéœ€è¦å¤„ç†è€å¹´ä»£åˆ°æ–°ç”Ÿä»£çš„å¼•ç”¨ï¼Œåè¿‡æ¥åˆ™ä¸éœ€è¦ã€‚ åœ¨æ‰§è¡Œè´Ÿè½½çš„è§’åº¦ä¸Šï¼ŒåŒæ ·ç”±äºä¸¤ä¸ªæ”¶é›†å™¨å„è‡ªçš„ç»†èŠ‚å®ç°ç‰¹ç‚¹å¯¼è‡´äº†ç”¨æˆ·ç¨‹åºè¿è¡Œæ—¶çš„è´Ÿè½½ä¼šæœ‰ä¸åŒï¼Œè­¬å¦‚å®ƒä»¬éƒ½ä½¿ç”¨åˆ°å†™å±éšœï¼ŒCMSç”¨å†™åå±éšœæ¥æ›´æ–°ç»´æŠ¤å¡è¡¨ï¼›è€ŒG1é™¤äº†ä½¿ç”¨å†™åå±éšœæ¥è¿›è¡ŒåŒæ ·çš„å¡è¡¨ç»´æŠ¤æ“ä½œå¤–ï¼Œä¸ºäº†å®ç°åŸå§‹å¿«ç…§æœç´¢ï¼ˆSATBï¼‰ç®—æ³•ï¼Œè¿˜éœ€è¦ä½¿ç”¨å†™å‰å±éšœæ¥è·Ÿè¸ªå¹¶å‘æ—¶çš„æŒ‡é’ˆå˜åŒ–æƒ…å†µã€‚ç›¸æ¯”èµ·å¢é‡æ›´æ–°ç®—æ³•ï¼ŒåŸå§‹å¿«ç…§æœç´¢èƒ½å¤Ÿå‡å°‘å¹¶å‘æ ‡è®°å’Œé‡æ–°æ ‡è®°é˜¶æ®µçš„æ¶ˆè€—ï¼Œé¿å…CMSé‚£æ ·åœ¨æœ€ç»ˆæ ‡è®°é˜¶æ®µåœé¡¿æ—¶é—´è¿‡é•¿çš„ç¼ºç‚¹ï¼Œä½†æ˜¯åœ¨ç”¨æˆ·ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ç¡®å®ä¼šäº§ç”Ÿç”±è·Ÿè¸ªå¼•ç”¨å˜åŒ–å¸¦æ¥çš„é¢å¤–è´Ÿæ‹…ã€‚ç”±äºG1å¯¹å†™å±éšœçš„å¤æ‚æ“ä½œè¦æ¯”CMSæ¶ˆè€—æ›´å¤šçš„è¿ç®—èµ„æºï¼Œæ‰€ä»¥CMSçš„å†™å±éšœå®ç°æ˜¯ç›´æ¥çš„åŒæ­¥æ“ä½œï¼Œè€ŒG1å°±ä¸å¾—ä¸å°†å…¶å®ç°ä¸ºç±»ä¼¼äºæ¶ˆæ¯é˜Ÿåˆ—çš„ç»“æ„ï¼ŒæŠŠå†™å‰å±éšœå’Œå†™åå±éšœä¸­è¦åšçš„äº‹æƒ…éƒ½æ”¾åˆ°é˜Ÿåˆ—é‡Œï¼Œç„¶åå†å¼‚æ­¥å¤„ç†ã€‚ 3 ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨è¡¡é‡åƒåœ¾æ”¶é›†å™¨çš„ä¸‰é¡¹æœ€é‡è¦çš„æŒ‡æ ‡æ˜¯ï¼šå†…å­˜å ç”¨ï¼ˆFootprintï¼‰ã€ååé‡ï¼ˆThroughputï¼‰å’Œå»¶è¿Ÿï¼ˆLatencyï¼‰,åœ¨è¿™ä¸‰é¡¹æŒ‡æ ‡é‡Œï¼Œå»¶è¿Ÿçš„é‡è¦æ€§æ—¥ç›Šå‡¸æ˜¾ï¼Œè¶Šå‘å¤‡å—å…³æ³¨ã€‚å…¶åŸå› æ˜¯éšç€è®¡ç®—æœºç¡¬ä»¶çš„å‘å±•ã€æ€§èƒ½çš„æå‡ï¼Œæˆ‘ä»¬è¶Šæ¥è¶Šèƒ½å®¹å¿æ”¶é›†å™¨å¤šå ç”¨ä¸€ç‚¹ç‚¹å†…å­˜ï¼Œç¡¬ä»¶çš„è§„æ ¼å’Œæ€§èƒ½è¶Šé«˜ï¼Œååé‡ä¹Ÿä¼šè¶Šé«˜ï¼Œä½†å¯¹å»¶è¿Ÿåè€Œä¼šå¸¦æ¥è´Ÿé¢çš„æ•ˆæœã€‚ æµ…è‰²é˜¶æ®µè¡¨ç¤ºå¿…é¡»æŒ‚èµ·ç”¨æˆ·çº¿ç¨‹ï¼Œæ·±è‰²è¡¨ç¤ºæ”¶é›†å™¨çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹æ˜¯å¹¶å‘å·¥ä½œçš„ã€‚å¯ä»¥çœ‹å‡ºï¼ŒShenandoahå’ŒZGCï¼Œå‡ ä¹æ•´ä¸ªå·¥ä½œè¿‡ç¨‹å…¨éƒ¨éƒ½æ˜¯å¹¶å‘çš„ï¼Œåªæœ‰åˆå§‹æ ‡è®°ã€æœ€ç»ˆæ ‡è®°è¿™äº›é˜¶æ®µæœ‰çŸ­æš‚çš„åœé¡¿ï¼Œè¿™éƒ¨åˆ†åœé¡¿çš„æ—¶é—´åŸºæœ¬ä¸Šæ˜¯å›ºå®šçš„ï¼Œä¸å †çš„å®¹é‡ã€å †ä¸­å¯¹è±¡çš„æ•°é‡æ²¡æœ‰æ­£æ¯”ä¾‹å…³ç³»ã€‚å®é™…ä¸Šï¼Œå®ƒä»¬éƒ½å¯ä»¥åœ¨ä»»æ„å¯ç®¡ç†çš„å †å®¹é‡ä¸‹ï¼Œå®ç°åƒåœ¾æ”¶é›†çš„åœé¡¿éƒ½ä¸è¶…è¿‡åæ¯«ç§’ã€‚ 3.1 Shenandoahæ”¶é›†å™¨Shenandoahæ˜¯ç”±RedHaté¢†å¯¼å¼€å‘çš„ï¼Œå—åˆ°äº†Oracleçš„æŠµåˆ¶ã€‚Oracleæ˜ç¡®æ‹’ç»åœ¨OracleJDK 12ä¸­æ”¯æŒShenandoahæ”¶é›†å™¨ï¼ŒShenandoahæ˜¯ä¸€æ¬¾åªæœ‰OpenJDKæ‰ä¼šåŒ…å«ï¼Œè€ŒOracleJDKé‡Œåè€Œä¸å­˜åœ¨çš„æ”¶é›†å™¨ã€‚ Shenandoahå’ŒG1æœ‰ç€ç›¸ä¼¼çš„å †å†…å­˜å¸ƒå±€ï¼Œåœ¨åˆå§‹æ ‡è®°ã€å¹¶å‘æ ‡è®°ç­‰è®¸å¤šé˜¶æ®µçš„å¤„ç†æ€è·¯ä¸Šéƒ½é«˜åº¦ä¸€è‡´ï¼Œç”šè‡³è¿˜ç›´æ¥å…±äº«äº†ä¸€éƒ¨åˆ†å®ç°ä»£ç ã€‚ ä¸åŒä¹‹å¤„ï¼š æ”¯æŒå¹¶å‘çš„æ•´ç†ç®—æ³• é»˜è®¤ä¸ä½¿ç”¨åˆ†ä»£æ”¶é›†ï¼Œä¸ä¼šæœ‰æ–°ç”Ÿä»£Regionå’Œè€å¹´ä»£Region æ‘’å¼ƒäº†è®°å¿†é›†ï¼Œæ”¹ç”¨åä¸º â€œè¿æ¥çŸ©é˜µâ€ çš„å…¨å±€æ•°æ®ç»“æ„æ¥è®°å½•è·¨Regionçš„å¼•ç”¨å…³ç³» è¿æ¥çŸ©é˜µå¯ä»¥ç®€å•ç†è§£ä¸ºä¸€å¼ äºŒç»´è¡¨æ ¼ï¼Œå¦‚æœRegion Næœ‰å¯¹è±¡æŒ‡å‘Region Mï¼Œå°±åœ¨è¡¨æ ¼çš„Nè¡ŒMåˆ—ä¸­æ‰“ä¸Šä¸€ä¸ªæ ‡è®°ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œå¦‚æœRegion 5ä¸­çš„å¯¹è±¡Bazå¼•ç”¨äº†Region 3çš„Fooï¼ŒFooåˆå¼•ç”¨äº†Region 1çš„Barï¼Œé‚£è¿æ¥çŸ©é˜µä¸­çš„5è¡Œ3åˆ—ã€3è¡Œ1åˆ—å°±åº”è¯¥è¢«æ‰“ä¸Šæ ‡è®°ã€‚åœ¨å›æ”¶æ—¶é€šè¿‡è¿™å¼ è¡¨æ ¼å°±å¯ä»¥å¾—å‡ºå“ªäº›Regionä¹‹é—´äº§ç”Ÿäº†è·¨ä»£å¼•ç”¨ã€‚ Shenandoahæ”¶é›†å™¨çš„å·¥ä½œè¿‡ç¨‹å¤§è‡´å¯ä»¥åˆ’åˆ†ä¸ºä»¥ä¸‹ä¹ä¸ªé˜¶æ®µ: åˆå§‹æ ‡è®°ï¼šä¸G1ä¸€æ ·ï¼Œé¦–å…ˆæ ‡è®°ä¸GC Rootsç›´æ¥å…³è”çš„å¯¹è±¡ï¼Œè¿™ä¸ªé˜¶æ®µä»æ˜¯â€œStop The Worldâ€çš„ï¼Œä½†åœé¡¿æ—¶é—´ä¸å †å¤§å°æ— å…³ï¼Œåªä¸GC Rootsçš„æ•°é‡ç›¸å…³ã€‚ å¹¶å‘æ ‡è®°ï¼šä¸G1ä¸€æ ·ï¼Œéå†å¯¹è±¡å›¾ï¼Œæ ‡è®°å‡ºå…¨éƒ¨å¯è¾¾çš„å¯¹è±¡ï¼Œè¿™ä¸ªé˜¶æ®µæ˜¯ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å¹¶å‘çš„ï¼Œæ—¶é—´é•¿çŸ­å–å†³äºå †ä¸­å­˜æ´»å¯¹è±¡çš„æ•°é‡ä»¥åŠå¯¹è±¡å›¾çš„ç»“æ„å¤æ‚ç¨‹åº¦ã€‚ æœ€ç»ˆæ ‡è®°ï¼šä¸G1ä¸€æ ·ï¼Œå¤„ç†å‰©ä½™çš„SATBæ‰«æï¼Œå¹¶åœ¨è¿™ä¸ªé˜¶æ®µç»Ÿè®¡å‡ºå›æ”¶ä»·å€¼æœ€é«˜çš„Regionï¼Œå°†è¿™äº›Regionæ„æˆä¸€ç»„å›æ”¶é›†ã€‚æœ€ç»ˆæ ‡è®°é˜¶æ®µä¹Ÿä¼šæœ‰ä¸€å°æ®µçŸ­æš‚çš„åœé¡¿ã€‚ å¹¶å‘æ¸…ç†ï¼šè¿™ä¸ªé˜¶æ®µç”¨äºæ¸…ç†é‚£äº›æ•´ä¸ªåŒºåŸŸå†…è¿ä¸€ä¸ªå­˜æ´»å¯¹è±¡éƒ½æ²¡æœ‰æ‰¾åˆ°çš„Regionï¼ˆè¿™ç±»Regionè¢«ç§°ä¸ºImmediate Garbage Regionï¼‰ã€‚ å¹¶å‘å›æ”¶ï¼šå¹¶å‘å›æ”¶é˜¶æ®µæ˜¯Shenandoahä¸ä¹‹å‰HotSpotä¸­å…¶ä»–æ”¶é›†å™¨çš„æ ¸å¿ƒå·®å¼‚ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒShenandoahè¦æŠŠå›æ”¶é›†é‡Œé¢çš„å­˜æ´»å¯¹è±¡å…ˆå¤åˆ¶ä¸€ä»½åˆ°å…¶ä»–æœªè¢«ä½¿ç”¨çš„Regionä¹‹ä¸­ã€‚å¤åˆ¶å¯¹è±¡è¿™ä»¶äº‹æƒ…å¦‚æœå°†ç”¨æˆ·çº¿ç¨‹å†»ç»“èµ·æ¥å†åšé‚£æ˜¯ç›¸å½“ç®€å•çš„ï¼Œä½†å¦‚æœä¸¤è€…å¿…é¡»è¦åŒæ—¶å¹¶å‘è¿›è¡Œçš„è¯ï¼Œå°±å˜å¾—å¤æ‚èµ·æ¥äº†ã€‚å…¶å›°éš¾ç‚¹æ˜¯åœ¨ç§»åŠ¨å¯¹è±¡çš„åŒæ—¶ï¼Œç”¨æˆ·çº¿ç¨‹ä»ç„¶å¯èƒ½ä¸åœå¯¹è¢«ç§»åŠ¨çš„å¯¹è±¡è¿›è¡Œè¯»å†™è®¿é—®ï¼Œç§»åŠ¨å¯¹è±¡æ˜¯ä¸€æ¬¡æ€§çš„è¡Œä¸ºï¼Œä½†ç§»åŠ¨ä¹‹åæ•´ä¸ªå†…å­˜ä¸­æ‰€æœ‰æŒ‡å‘è¯¥å¯¹è±¡çš„å¼•ç”¨éƒ½è¿˜æ˜¯æ—§å¯¹è±¡çš„åœ°å€ï¼Œè¿™æ˜¯å¾ˆéš¾ä¸€ç¬é—´å…¨éƒ¨æ”¹å˜è¿‡æ¥çš„ã€‚å¯¹äºå¹¶å‘å›æ”¶é˜¶æ®µé‡åˆ°çš„è¿™äº›å›°éš¾ï¼ŒShenandoahå°†ä¼šé€šè¿‡è¯»å±éšœå’Œè¢«ç§°ä¸ºâ€œBrooks Pointersâ€çš„è½¬å‘æŒ‡é’ˆæ¥è§£å†³ã€‚å¹¶å‘å›æ”¶é˜¶æ®µè¿è¡Œçš„æ—¶é—´é•¿çŸ­å–å†³äºå›æ”¶é›†çš„å¤§å°ã€‚ åˆå§‹å¼•ç”¨æ›´æ–°ï¼šå¹¶å‘å›æ”¶é˜¶æ®µå¤åˆ¶å¯¹è±¡ç»“æŸåï¼Œè¿˜éœ€è¦æŠŠå †ä¸­æ‰€æœ‰æŒ‡å‘æ—§å¯¹è±¡çš„å¼•ç”¨ä¿®æ­£åˆ°å¤åˆ¶åçš„æ–°åœ°å€ï¼Œè¿™ä¸ªæ“ä½œç§°ä¸ºå¼•ç”¨æ›´æ–°ã€‚å¼•ç”¨æ›´æ–°çš„åˆå§‹åŒ–é˜¶æ®µå®é™…ä¸Šå¹¶æœªåšä»€ä¹ˆå…·ä½“çš„å¤„ç†ï¼Œè®¾ç«‹è¿™ä¸ªé˜¶æ®µåªæ˜¯ä¸ºäº†å»ºç«‹ä¸€ä¸ªçº¿ç¨‹é›†åˆç‚¹ï¼Œç¡®ä¿æ‰€æœ‰å¹¶å‘å›æ”¶é˜¶æ®µä¸­è¿›è¡Œçš„æ”¶é›†å™¨çº¿ç¨‹éƒ½å·²å®Œæˆåˆ†é…ç»™å®ƒä»¬çš„å¯¹è±¡ç§»åŠ¨ä»»åŠ¡è€Œå·²ã€‚åˆå§‹å¼•ç”¨æ›´æ–°æ—¶é—´å¾ˆçŸ­ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªéå¸¸çŸ­æš‚çš„åœé¡¿ã€‚ å¹¶å‘å¼•ç”¨æ›´æ–°ï¼šçœŸæ­£å¼€å§‹è¿›è¡Œå¼•ç”¨æ›´æ–°æ“ä½œï¼Œè¿™ä¸ªé˜¶æ®µæ˜¯ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å¹¶å‘çš„ï¼Œæ—¶é—´é•¿çŸ­å–å†³äºå†…å­˜ä¸­æ¶‰åŠçš„å¼•ç”¨æ•°é‡çš„å¤šå°‘ã€‚å¹¶å‘å¼•ç”¨æ›´æ–°ä¸å¹¶å‘æ ‡è®°ä¸åŒï¼Œå®ƒä¸å†éœ€è¦æ²¿ç€å¯¹è±¡å›¾æ¥æœç´¢ï¼Œåªéœ€è¦æŒ‰ç…§å†…å­˜ç‰©ç†åœ°å€çš„é¡ºåºï¼Œçº¿æ€§åœ°æœç´¢å‡ºå¼•ç”¨ç±»å‹ï¼ŒæŠŠæ—§å€¼æ”¹ä¸ºæ–°å€¼å³å¯ã€‚ æœ€ç»ˆå¼•ç”¨æ›´æ–°ï¼šè§£å†³äº†å †ä¸­çš„å¼•ç”¨æ›´æ–°åï¼Œè¿˜è¦ä¿®æ­£å­˜åœ¨äºGC Roots ä¸­çš„å¼•ç”¨ã€‚è¿™ä¸ªé˜¶æ®µæ˜¯Shenandoahçš„æœ€åä¸€æ¬¡åœé¡¿ï¼Œåœé¡¿æ—¶é—´åªä¸GC Rootsçš„æ•°é‡ç›¸å…³ã€‚ å¹¶å‘æ¸…ç†ï¼šç»è¿‡å¹¶å‘å›æ”¶å’Œå¼•ç”¨æ›´æ–°ä¹‹åï¼Œæ•´ä¸ªå›æ”¶é›†ä¸­æ‰€æœ‰çš„Regionå·²å†æ— å­˜æ´»å¯¹è±¡ï¼Œè¿™äº›Regionéƒ½å˜æˆImmediate Garbage Regionsäº†ï¼Œæœ€åå†è°ƒç”¨ä¸€æ¬¡å¹¶å‘æ¸…ç†è¿‡ç¨‹æ¥å›æ”¶è¿™äº›Regionçš„å†…å­˜ç©ºé—´ï¼Œä¾›ä»¥åæ–°å¯¹è±¡åˆ†é…ä½¿ç”¨ã€‚ åŸä¹¦è¿˜æœ‰å…³äºè½¬å‘æŒ‡é’ˆåŸç†çš„è®²è§£ï¼Œè¿™é‡Œæš‚æ—¶ç•¥å»ã€‚ 3.2 ZGCæ”¶é›†å™¨ZGCæ”¶é›†å™¨æ˜¯ä¸€æ¬¾åŸºäºRegionå†…å­˜å¸ƒå±€çš„ï¼Œï¼ˆæš‚æ—¶ï¼‰ä¸è®¾åˆ†ä»£çš„ï¼Œä½¿ç”¨äº†è¯»å±éšœã€æŸ“è‰²æŒ‡é’ˆå’Œå†…å­˜å¤šé‡æ˜ å°„ç­‰æŠ€æœ¯æ¥å®ç°å¯å¹¶å‘çš„æ ‡è®°-æ•´ç†ç®—æ³•çš„ï¼Œä»¥ä½å»¶è¿Ÿä¸ºé¦–è¦ç›®æ ‡çš„ä¸€æ¬¾åƒåœ¾æ”¶é›†å™¨ã€‚ ZGCä¹Ÿé‡‡ç”¨åŸºäºRegionçš„å †å†…å­˜å¸ƒå±€ï¼Œä½†ä¸å®ƒä»¬ä¸åŒçš„æ˜¯ï¼ŒZGCçš„Regionï¼ˆä¸€äº›å®˜æ–¹èµ„æ–™ä¸­å°†å®ƒç§°ä¸ºPageæˆ–è€…ZPageï¼‰å…·æœ‰åŠ¨æ€æ€§â€”â€”åŠ¨æ€åˆ›å»ºå’Œé”€æ¯ï¼Œä»¥åŠåŠ¨æ€çš„åŒºåŸŸå®¹é‡å¤§å°ã€‚åœ¨x64ç¡¬ä»¶å¹³å°ä¸‹ï¼ŒZGCçš„Regionå¯ä»¥å…·æœ‰å¤§ã€ä¸­ã€å°ä¸‰ç±»å®¹é‡ï¼š å°å‹Regionï¼ˆSmall Regionï¼‰ï¼šå®¹é‡å›ºå®šä¸º2MBï¼Œç”¨äºæ”¾ç½®å°äº256KBçš„å°å¯¹è±¡ã€‚ ä¸­å‹Regionï¼ˆMedium Regionï¼‰ï¼šå®¹é‡å›ºå®šä¸º32MBï¼Œç”¨äºæ”¾ç½®å¤§äºç­‰äº256KBä½†å°äº4MBçš„å¯¹è±¡ã€‚ å¤§å‹Regionï¼ˆLarge Regionï¼‰ï¼šå®¹é‡ä¸å›ºå®šï¼Œå¯ä»¥åŠ¨æ€å˜åŒ–ï¼Œä½†å¿…é¡»ä¸º2MBçš„æ•´æ•°å€ï¼Œç”¨äºæ”¾ç½®4MBæˆ–ä»¥ä¸Šçš„å¤§å¯¹è±¡ã€‚æ¯ä¸ªå¤§å‹Regionä¸­åªä¼šå­˜æ”¾ä¸€ä¸ªå¤§å¯¹è±¡ï¼Œè¿™ä¹Ÿé¢„ç¤ºç€è™½ç„¶åå­—å«ä½œâ€œå¤§å‹ Regionâ€ï¼Œä½†å®ƒçš„å®é™…å®¹é‡å®Œå…¨æœ‰å¯èƒ½å°äºä¸­å‹Regionï¼Œæœ€å°å®¹é‡å¯ä½è‡³4MBã€‚å¤§å‹Regionåœ¨ZGCçš„å®ç°ä¸­æ˜¯ä¸ä¼šè¢«é‡åˆ†é…ï¼ˆé‡åˆ†é…æ˜¯ZGCçš„ä¸€ç§å¤„ç†åŠ¨ä½œï¼Œç”¨äºå¤åˆ¶å¯¹è±¡çš„æ”¶é›†å™¨é˜¶æ®µï¼‰çš„ï¼Œå› ä¸ºå¤åˆ¶ä¸€ä¸ªå¤§å¯¹è±¡çš„ä»£ä»·éå¸¸é«˜æ˜‚ã€‚ æ¥ä¸‹æ¥æ˜¯ZGCçš„æ ¸å¿ƒé—®é¢˜â€”â€”å¹¶å‘æ•´ç†ç®—æ³•çš„å®ç°ã€‚Shenandoahä½¿ç”¨è½¬å‘æŒ‡é’ˆå’Œè¯»å±éšœæ¥å®ç°å¹¶å‘æ•´ç†ï¼ŒZGCè™½ç„¶åŒæ ·ç”¨åˆ°äº†è¯»å±éšœï¼Œä½†ç”¨çš„å´æ˜¯ä¸€æ¡ä¸Shenandoahå®Œå…¨ä¸åŒï¼Œæ›´åŠ å¤æ‚ç²¾å·§çš„è§£é¢˜æ€è·¯â€”â€”æŸ“è‰²æŒ‡é’ˆã€‚ åŸä¹¦è¿˜æœ‰å…³äºæŸ“è‰²æŒ‡é’ˆåŸç†çš„è®²è§£ï¼Œè¿™é‡Œæš‚æ—¶ç•¥å»ã€‚ 4 é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†å™¨4.1 Epsilonæ”¶é›†å™¨JDK11ä¸­ï¼Œå‡ºç°äº†ä¸€æ¬¾ä»¥ä¸èƒ½å¤Ÿè¿›è¡Œåƒåœ¾æ”¶é›†ä¸ºâ€œå–ç‚¹â€çš„åƒåœ¾æ”¶é›†å™¨ã€‚è¿™é‡Œç§°è¿™ç§â€œåƒåœ¾æ”¶é›†å™¨â€ä¸ºâ€œè‡ªåŠ¨å†…å­˜ç®¡ç†å­ç³»ç»Ÿâ€ã€‚ä¸€ä¸ªåƒåœ¾æ”¶é›†å™¨é™¤äº†åƒåœ¾æ”¶é›†è¿™ä¸ªæœ¬èŒå·¥ä½œä¹‹å¤–ï¼Œå®ƒè¿˜è¦è´Ÿè´£å †çš„ç®¡ç†ä¸å¸ƒå±€ã€å¯¹è±¡çš„åˆ†é…ã€ä¸è§£é‡Šå™¨çš„åä½œã€ä¸ç¼–è¯‘å™¨çš„åä½œã€ä¸ç›‘æ§å­ç³»ç»Ÿåä½œç­‰èŒè´£ã€‚ ä¼ ç»ŸJavaæœ‰ç€å†…å­˜å ç”¨è¾ƒå¤§ï¼Œåœ¨å®¹å™¨ä¸­å¯åŠ¨æ—¶é—´é•¿ï¼Œå³æ—¶ç¼–è¯‘éœ€è¦ç¼“æ…¢ä¼˜åŒ–ç­‰ç‰¹ç‚¹ï¼Œè¿™å¯¹å¤§å‹åº”ç”¨æ¥è¯´å¹¶ä¸æ˜¯ä»€ä¹ˆå¤ªå¤§çš„é—®é¢˜ï¼Œä½†å¯¹çŸ­æ—¶é—´ã€å°è§„æ¨¡çš„æœåŠ¡å½¢å¼å°±æœ‰è¯¸å¤šä¸é€‚ã€‚ä¸ºäº†åº”å¯¹æ–°çš„æŠ€æœ¯æ½®æµï¼Œæœ€è¿‘å‡ ä¸ªç‰ˆæœ¬çš„JDKé€æ¸åŠ å…¥äº†æå‰ç¼–è¯‘ã€é¢å‘åº”ç”¨çš„ç±»æ•°æ®å…±äº«ç­‰æ”¯æŒã€‚Epsilonä¹Ÿæ˜¯æœ‰ç€ç±»ä¼¼çš„ç›®æ ‡ï¼Œå¦‚æœè¯»è€…çš„åº”ç”¨åªè¦è¿è¡Œæ•°åˆ†é’Ÿç”šè‡³æ•°ç§’ï¼Œåªè¦Javaè™šæ‹Ÿæœºèƒ½æ­£ç¡®åˆ†é…å†…å­˜ï¼Œåœ¨å †è€—å°½ä¹‹å‰å°±ä¼šé€€å‡ºï¼Œé‚£æ˜¾ç„¶è¿è¡Œè´Ÿè½½æå°ã€æ²¡æœ‰ä»»ä½•å›æ”¶è¡Œä¸ºçš„Epsilonä¾¿æ˜¯å¾ˆæ°å½“çš„é€‰æ‹©ã€‚ 4.2 æ”¶é›†å™¨çš„æƒè¡¡å¦‚ä½•é€‰æ‹©ä¸€æ¬¾é€‚åˆè‡ªå·±åº”ç”¨çš„æ”¶é›†å™¨å‘¢ï¼Ÿ åº”ç”¨ç¨‹åºçš„ä¸»è¦å…³æ³¨ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœæ˜¯æ•°æ®åˆ†æã€ç§‘å­¦è®¡ç®—ç±»çš„ä»»åŠ¡ï¼Œç›®æ ‡æ˜¯èƒ½å°½å¿«ç®—å‡ºç»“æœï¼Œé‚£ååé‡å°±æ˜¯ä¸»è¦å…³æ³¨ç‚¹ï¼›å¦‚æœæ˜¯SLAåº”ç”¨ï¼Œé‚£åœé¡¿æ—¶é—´ç›´æ¥å½±å“æœåŠ¡è´¨é‡ï¼Œä¸¥é‡çš„ç”šè‡³ä¼šå¯¼è‡´äº‹åŠ¡è¶…æ—¶ï¼Œè¿™æ ·å»¶è¿Ÿå°±æ˜¯ä¸»è¦å…³æ³¨ç‚¹ï¼›è€Œå¦‚æœæ˜¯å®¢æˆ·ç«¯åº”ç”¨æˆ–è€…åµŒå…¥å¼åº”ç”¨ï¼Œé‚£åƒåœ¾æ”¶é›†çš„å†…å­˜å ç”¨åˆ™æ˜¯ä¸å¯å¿½è§†çš„ã€‚ è¿è¡Œåº”ç”¨çš„åŸºç¡€è®¾æ–½å¦‚ä½•ï¼Ÿè­¬å¦‚ç¡¬ä»¶è§„æ ¼ï¼Œè¦æ¶‰åŠçš„ç³»ç»Ÿæ¶æ„æ˜¯x86-32/64ã€SPARCè¿˜æ˜¯ARM/Aarch64ï¼›å¤„ç†å™¨çš„æ•°é‡å¤šå°‘ï¼Œåˆ†é…å†…å­˜çš„å¤§å°ï¼›é€‰æ‹©çš„æ“ä½œç³»ç»Ÿæ˜¯Linuxã€Solarisè¿˜æ˜¯Windowsç­‰ã€‚ ä½¿ç”¨JDKçš„å‘è¡Œå•†æ˜¯ä»€ä¹ˆï¼Ÿç‰ˆæœ¬å·æ˜¯å¤šå°‘ï¼Ÿæ˜¯ZingJDK/Zuluã€OracleJDKã€Open-JDKã€OpenJ9æŠ‘æˆ–æ˜¯å…¶ä»–å…¬å¸çš„å‘è¡Œç‰ˆï¼Ÿè¯¥JDKå¯¹åº”äº†ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹çš„å“ªä¸ªç‰ˆæœ¬ï¼Ÿ 4.3 è™šæ‹ŸæœºåŠåƒåœ¾æ”¶é›†å™¨æ—¥å¿—åœ¨JDK 9ä»¥å‰ï¼ŒHotSpotå¹¶æ²¡æœ‰æä¾›ç»Ÿä¸€çš„æ—¥å¿—å¤„ç†æ¡†æ¶ï¼Œè™šæ‹Ÿæœºå„ä¸ªåŠŸèƒ½æ¨¡å—çš„æ—¥å¿—å¼€å…³åˆ†å¸ƒåœ¨ä¸åŒçš„å‚æ•°ä¸Šï¼Œæ—¥å¿—çº§åˆ«ã€å¾ªç¯æ—¥å¿—å¤§å°ã€è¾“å‡ºæ ¼å¼ã€é‡å®šå‘ç­‰è®¾ç½®åœ¨ä¸åŒåŠŸèƒ½ä¸Šéƒ½è¦å•ç‹¬è§£å†³ã€‚ç›´åˆ°JDK 9ï¼Œè¿™ç§æ··ä¹±ä¸å ªçš„å±€é¢æ‰ç»ˆäºæ¶ˆå¤±ï¼ŒHotSpotæ‰€æœ‰åŠŸèƒ½çš„æ—¥å¿—éƒ½æ”¶å½’åˆ°äº†â€œ-Xlogâ€å‚æ•°ä¸Šï¼Œè¿™ä¸ªå‚æ•°çš„èƒ½åŠ›ä¹Ÿç›¸åº”è¢«æå¤§æ‹“å±•äº†ã€‚ -Xlog[:[selector][:[output][:[decorators][:output-options]]]]è¿™é‡Œä¸è¯¦ç»†åˆ—ä¸¾ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jvm","slug":"jvm","permalink":"https://www.codetool.top/tags/jvm/"}]},{"title":"leetcode101-å¯¹ç§°äºŒå‰æ ‘","slug":"leetcode101-å¯¹ç§°äºŒå‰æ ‘","date":"2020-01-11T11:05:17.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode101-å¯¹ç§°äºŒå‰æ ‘/","link":"","permalink":"https://www.codetool.top/article/leetcode101-%E5%AF%B9%E7%A7%B0%E4%BA%8C%E5%8F%89%E6%A0%91/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ£€æŸ¥å®ƒæ˜¯å¦æ˜¯é•œåƒå¯¹ç§°çš„ã€‚ ä¾‹å¦‚ï¼ŒäºŒå‰æ ‘ [1,2,2,3,4,4,3] æ˜¯å¯¹ç§°çš„ã€‚ &nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;/&nbsp;\\&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;2&nbsp;/&nbsp;\\ /&nbsp;\\3&nbsp;&nbsp;4&nbsp;4&nbsp;&nbsp;3 ä½†æ˜¯ä¸‹é¢è¿™ä¸ª [1,2,2,null,3,null,3] åˆ™ä¸æ˜¯é•œåƒå¯¹ç§°çš„: &nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;/&nbsp;\\&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;\\ &nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;3 è¯´æ˜: å¦‚æœä½ å¯ä»¥è¿ç”¨é€’å½’å’Œè¿­ä»£ä¸¤ç§æ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¼šå¾ˆåŠ åˆ†ã€‚ 2 è§£æ³•2.1 æ€æƒ³ è¿­ä»£ï¼Œè‡ªé¡¶å‘ä¸‹æ¯”è¾ƒå¯¹ç§°ä½ç½®çš„èŠ‚ç‚¹ã€‚ é€’å½’ï¼Œå®é™…ä¸Šæ˜¯æ¨¡æ‹Ÿè¿­ä»£ï¼Œå°†å¯¹ç§°ä½ç½®çš„èŠ‚ç‚¹å‰åé¡ºåºå…¥é˜Ÿåˆ—ï¼Œæ¯æ¬¡ä»é˜Ÿåˆ—ä¸­å–å‡ºä¸¤ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚ 2.2 ä»£ç é€’å½’ï¼š class Solution { public boolean isSymmetric(TreeNode root) { if(root == null) return true; return isSymetricUnit(root.left,root.right); } public boolean isSymmetricUnit(TreeNode node1,TreeNode node2){ if(node1 == null &amp;&amp; node2 == null) return true; if(node1 == null || node2 == null) return false; if(node1.val != node2.val) return false; return isSymmetricUnit(node1.left,node2.right) &amp;&amp; isSymmetricUnit(node1.right,node2.left); } } è¿­ä»£ï¼š public boolean isSymmetric(TreeNode root) { Queue&lt;TreeNode> q = new LinkedList&lt;>(); q.add(root); q.add(root); while (!q.isEmpty()) { TreeNode t1 = q.poll(); TreeNode t2 = q.poll(); if (t1 == null &amp;&amp; t2 == null) continue; if (t1 == null || t2 == null) return false; if (t1.val != t2.val) return false; q.add(t1.left); q.add(t2.right); q.add(t1.right); q.add(t2.left); } return true; }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode104-äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦","slug":"leetcode104-äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦","date":"2020-01-11T09:15:31.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode104-äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦/","link":"","permalink":"https://www.codetool.top/article/leetcode104-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E6%9C%80%E5%A4%A7%E6%B7%B1%E5%BA%A6/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å¤§æ·±åº¦ã€‚ äºŒå‰æ ‘çš„æ·±åº¦ä¸ºæ ¹èŠ‚ç‚¹åˆ°æœ€è¿œå¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°ã€‚ è¯´æ˜: å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚ ç¤ºä¾‹ï¼šç»™å®šäºŒå‰æ ‘ [3,9,20,null,null,15,7]ï¼Œ &nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;/ \\&nbsp;&nbsp;9&nbsp;&nbsp;20&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;15&nbsp;&nbsp;&nbsp;7 è¿”å›å®ƒçš„æœ€å¤§æ·±åº¦ 3 ã€‚ 2 è§£æ³•2.1 æ€æƒ³ è‡ªåº•å‘ä¸Šï¼Œæ¯ä¸ªèŠ‚ç‚¹æ˜¯å·¦å³ä¸¤ä¸ªå­©å­èŠ‚ç‚¹çš„æ·±åº¦çš„æœ€å¤§å€¼+1 è‡ªé¡¶å‘ä¸‹ï¼Œä¾æ¬¡æ›´æ–°æœ€å¤§é«˜åº¦ 2.2 ä»£ç è‡ªåº•å‘ä¸Šï¼š class Solution { public int maxDepth(TreeNode root) { return depth(root); } public int depth(TreeNode root){ if(root == null) return 0; if(root.left == null &amp;&amp; root.right == null) return 1; return Math.max(depth(root.left),depth(root.right))+1; } } è‡ªé¡¶å‘ä¸‹ï¼š class Solution { int depth = 0; public int maxDepth(TreeNode root) { depth(root,1); return depth; } public void depth(TreeNode root,int cur){ if(root == null) return; if(cur>depth) depth = cur; depth(root.left,cur+1); depth(root.right,cur+1); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode102-äºŒå‰æ ‘çš„å±‚æ¬¡éå†","slug":"leetcode102-äºŒå‰æ ‘çš„å±‚æ¬¡éå†","date":"2020-01-11T08:33:52.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode102-äºŒå‰æ ‘çš„å±‚æ¬¡éå†/","link":"","permalink":"https://www.codetool.top/article/leetcode102-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E5%B1%82%E6%AC%A1%E9%81%8D%E5%8E%86/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œè¿”å›å…¶æŒ‰å±‚æ¬¡éå†çš„èŠ‚ç‚¹å€¼ã€‚ ï¼ˆå³é€å±‚åœ°ï¼Œä»å·¦åˆ°å³è®¿é—®æ‰€æœ‰èŠ‚ç‚¹ï¼‰ã€‚ ä¾‹å¦‚:ç»™å®šäºŒå‰æ ‘: [3,9,20,null,null,15,7], &nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;/ \\&nbsp;&nbsp;9&nbsp;&nbsp;20&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;15&nbsp;&nbsp;&nbsp;7 è¿”å›å…¶å±‚æ¬¡éå†ç»“æœï¼š [&nbsp;&nbsp;[3],&nbsp;&nbsp;[9,20],&nbsp;&nbsp;[15,7]] 2 è§£æ³•2.1 æ€æƒ³ è¿­ä»£ï¼Œå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼Œä½†éœ€è¦è®°å½•å…ƒç´ æ˜¯å“ªä¸€å±‚çš„ã€‚ é€’å½’ï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œå°†å…ƒç´ åŠ è¿›æ¯å±‚å¯¹åº”çš„Listä¸­ 2.2 ä»£ç è¿­ä»£ï¼š class Solution { public List&lt;List&lt;Integer>> levelOrder(TreeNode root) { Queue&lt;TreeNode> queue = new LinkedList&lt;>(); List&lt;List&lt;Integer>> ans = new ArrayList&lt;>(); List&lt;Integer> cur = new ArrayList&lt;>(); if(root == null) return new ArrayList&lt;List&lt;Integer>>(); queue.offer(root); queue.offer(null);//ä»¥nullä½œä¸ºæ¯å±‚ç»“æŸçš„æ ‡å¿—ç¬¦ while(!queue.isEmpty()){ TreeNode node = queue.poll(); if(node == null){ if(cur.size()!=0) ans.add(cur); cur = new ArrayList&lt;>(); }else{ cur.add(node.val); if(node.left!=null) queue.offer(node.left); if(node.right!=null) queue.offer(node.right); //è‹¥é˜Ÿé¦–ä¸ºnullè¯´æ˜è¿™ä¸€å±‚çš„èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å·²ç»å…¨éƒ¨åŠ å…¥é˜Ÿåˆ—äº†ï¼Œéœ€è¦åŠ å…¥ä¸€ä¸ªnull if(queue.peek()==null) queue.offer(null); } } return ans; } } é€’å½’ï¼š class Solution { List&lt;List&lt;Integer>> ans = new ArrayList&lt;>(); public List&lt;List&lt;Integer>> levelOrder(TreeNode root) { if(root==null) return ans; DFS(root,0); return ans; } public void DFS(TreeNode root,int level){ if(ans.size()==level) ans.add(new ArrayList&lt;Integer>()); ans.get(level).add(root.val); if(root.left!=null) DFS(root.left,level+1); if(root.right!=null) DFS(root.right,level+1); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"StringTableæ€§èƒ½è°ƒä¼˜","slug":"stringtableæ€§èƒ½è°ƒä¼˜","date":"2020-01-10T14:55:10.000Z","updated":"2020-02-20T14:55:21.052Z","comments":true,"path":"article/stringtableæ€§èƒ½è°ƒä¼˜/","link":"","permalink":"https://www.codetool.top/article/stringtable%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/","excerpt":"","text":"StringTableæ˜¯jvmè¿è¡Œæ—¶å¸¸é‡æ± è¡¨ä¸­çš„å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°02æœ‰ç›¸å…³çš„ä»‹ç»ã€‚ æ— è®ºæ˜¯è¿è¡Œæ—¶å¸¸é‡è¡¨è¿˜æ˜¯StringTableï¼Œä»–ä»¬å†…éƒ¨éƒ½æ˜¯é€šè¿‡å“ˆå¸Œè¡¨æ¥ä¿è¯å­—ç¬¦ä¸²å¸¸é‡çš„å”¯ä¸€æ€§ï¼Œå¯ä»¥é€šè¿‡é…ç½®jvmå‚æ•°-XX:+PrintStringTableStatisticsæ¥æŸ¥çœ‹å¸¸é‡è¡¨çš„è¯¦ç»†ä¿¡æ¯ã€‚ 1 éªŒè¯StringTableçš„åƒåœ¾å›æ”¶é¦–å…ˆæˆ‘ä»¬è¿è¡Œä¸‹é¢è¿™æ®µä»£ç ï¼šä½¿ç”¨è™šæ‹Ÿæœºå‚æ•°ï¼š-XX:+PrintGCDetails -XX:+PrintStringTableStatistics public static void main(String[] args) throws IOException { for(int i = 0;i&lt;10000;i++){ String.valueOf(i).intern(); } } æˆªå–éƒ¨åˆ†è¾“å‡ºï¼š StringTable statistics: Number of buckets : 60013 = 480104 bytes, avg 8.000 Number of entries : 11695 = 280680 bytes, avg 24.000 Number of literals : 11695 = 635176 bytes, avg 54.312å¯è§StringTableæ€»å…±æœ‰60013ä¸ªæ¡¶ï¼Œ10000ä¸ªå­—ç¬¦ä¸²å…¨éƒ¨è¿›å…¥å¸¸é‡æ± ï¼Œä¸”æ²¡æœ‰åƒåœ¾å›æ”¶çš„ä¿¡æ¯è¾“å‡ºã€‚ é‚£æˆ‘ä»¬è®©è¿›å…¥å †çš„å†…å­˜é€‚åº¦å‡å°ï¼Œè®©å®ƒæœ‰å¯èƒ½å‘ç”Ÿå †ç©ºé—´ä¸è¶³çš„æƒ…å†µï¼š ä½¿ç”¨è™šæ‹Ÿæœºå‚æ•°ï¼š-Xmx10m -XX:+PrintGCDetails -XX:+PrintStringTableStatisticså†æ¬¡è¿è¡Œä¸Šé¢é‚£æ®µä»£ç  æˆªå–éƒ¨åˆ†è¾“å‡ºï¼š [GC (Allocation Failure) [PSYoungGen: 2048K-&gt;504K(2560K)] 2048K-&gt;720K(9728K), 0.0014597 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] Number of buckets : 60013 = 480104 bytes, avg 8.000 Number of entries : 7981 = 191544 bytes, avg 24.000 Number of literals : 7981 = 456584 bytes, avg 57.209å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ¬¡10000ä¸ªå­—ç¬¦ä¸²å¹¶æ²¡æœ‰å…¨éƒ¨è¿›å…¥å¸¸é‡æ± ï¼Œä¸€éƒ¨åˆ†è¢«å›æ”¶æ‰äº†ã€‚ 2 è°ƒæ•´æ¡¶çš„ä¸ªæ•°æˆ‘ä»¬éƒ½çŸ¥é“å“ˆå¸Œè¡¨çš„å­˜å–æ•ˆç‡å’Œæ¡¶çš„ä¸ªæ•°æ˜¯ç´§å¯†ç›¸å…³çš„ï¼Œæ¡¶çš„ä¸ªæ•°å¤ªå¤§åˆ™ç©ºé—´æœ‰å¯èƒ½æµªè´¹ï¼Œå¤ªå°åˆ™å¯èƒ½æ•ˆç‡è¿‡ä½ã€‚ æˆ‘ä»¬è¿è¡Œè¿™æ®µä»£ç ï¼šä½¿ç”¨è™šæ‹Ÿæœºå‚æ•°-XX:+PrintStringTableStatistics public static void main(String[] args) throws IOException { long start = System.nanoTime(); List&lt;String> list = new ArrayList&lt;>(); for(int i = 0;i&lt;500000;i++){ list.add(String.valueOf(i).intern()); } System.out.println(\"cost:\"+(System.nanoTime()-start)/1000000000.0 + \"s\"); } æˆªå–éƒ¨åˆ†è¾“å‡ºï¼š cost:0.0997132sStringTable statistics: Number of buckets : 60013 = 480104 bytes, avg 8.000 Number of entries : 501704 = 12040896 bytes, avg 24.000 Number of literals : 501704 = 28075720 bytes, avg 55.961æˆ‘ä»¬ä½¿ç”¨è™šæ‹Ÿæœºå‚æ•°æ¥è°ƒæ•´æ¡¶çš„ä¸ªæ•°ï¼šä½¿ç”¨è™šæ‹Ÿæœºå‚æ•°-XX:StringTableSize=1009 -XX:+PrintStringTableStatistics cost:3.1234771s Number of buckets : 1009 = 8072 bytes, avg 8.000 Number of entries : 503097 = 12074328 bytes, avg 24.000 Number of literals : 503097 = 28176912 bytes, avg 56.007å¯è§æ¶ˆè€—æ—¶é—´æ˜æ˜¾å¢å¤§ æˆ‘ä»¬å†å°†æ¡¶çš„ä¸ªæ•°è°ƒè‡³æ›´å¤§ï¼šä½¿ç”¨è™šæ‹Ÿæœºå‚æ•°-XX:StringTableSize=1009 -XX:+PrintStringTableStatistics æˆªå–éƒ¨åˆ†è¾“å‡ºï¼š cost:0.0879392sStringTable statistics: Number of buckets : 1000000 = 8000000 bytes, avg 8.000 Number of entries : 501704 = 12040896 bytes, avg 24.000 Number of literals : 501704 = 28075720 bytes, avg 55.961å¯è§æ¶ˆè€—æ—¶é—´æœ‰æ‰€å‡å°‘ 3 æ˜¯å¦è¯¥ä½¿ç”¨internæ–¹æ³•å°†å­—ç¬¦ä¸²å…¥æ± æˆ‘ä»¬è¿è¡Œä¸‹é¢è¿™æ®µä»£ç ï¼Œä½¿ç”¨jvisualvmæŸ¥çœ‹å †å†…å­˜çš„å˜åŒ–æƒ…å†µï¼š public static void main(String[] args) throws IOException { System.in.read(); List&lt;String> list = new ArrayList&lt;>(); for(int n = 0;n&lt;10;n++){//æ¯ä¸ªå­—ç¬¦ä¸²æå‡º10æ¬¡ for(int i = 0;i&lt;500000;i++){ list.add(String.valueOf(i)); } System.out.println(\"part \"+n+\" has done\"); } System.in.read(); } å¯è§Stringå’Œchar[]å ç”¨äº†æé«˜å†…å­˜ï¼ˆæ¥è¿‘300Mï¼‰ æˆ‘ä»¬åœ¨åŸæ¥ä»£ç çš„åŸºç¡€ä¸Šä½¿ç”¨internæ–¹æ³•ï¼š public static void main(String[] args) throws IOException { System.in.read(); List&lt;String> list = new ArrayList&lt;>(); for(int n = 0;n&lt;10;n++){//æ¯ä¸ªå­—ç¬¦ä¸²æå‡º10æ¬¡ for(int i = 0;i&lt;500000;i++){ list.add(String.valueOf(i).intern()); } System.out.println(\"part \"+n+\" has done\"); } System.in.read(); } å†æ¬¡æŸ¥çœ‹è¿è¡Œç»“æŸåçš„å†…å­˜å ç”¨ï¼š å¯è§è¿™æ¬¡Stringå’Œchar[]å ç”¨çš„å†…å­˜æ¥è¿‘100Mï¼Œç›¸æ¯”å‡å°‘å¾ˆå¤šã€‚ æ‰€ä»¥å½“javaç¨‹åºå¯èƒ½å¼•ç”¨å¾ˆå¤šç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œæœ€å¥½å°†å­—ç¬¦ä¸²å…¥æ± ï¼Œèƒ½æœ‰æ•ˆå‡è½»å†…å­˜è´Ÿæ‹…ï¼Œæ‰€å¢å¼€é”€ä»…æ˜¯internæ–¹æ³•å†…éƒ¨å¼€é”€ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"jvm","slug":"jvm","permalink":"https://www.codetool.top/tags/jvm/"},{"name":"ä¼˜åŒ–","slug":"ä¼˜åŒ–","permalink":"https://www.codetool.top/tags/%E4%BC%98%E5%8C%96/"}]},{"title":"leetcode145-äºŒå‰æ ‘çš„ååºéå†","slug":"leetcode145-äºŒå‰æ ‘çš„ååºéå†","date":"2020-01-10T08:03:17.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode145-äºŒå‰æ ‘çš„ååºéå†/","link":"","permalink":"https://www.codetool.top/article/leetcode145-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E5%90%8E%E5%BA%8F%E9%81%8D%E5%8E%86/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œè¿”å›å®ƒçš„ ååº éå†ã€‚ ç¤ºä¾‹: è¾“å…¥: [1,null,2,3]&nbsp;1&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;/&nbsp;3è¾“å‡º: [3,2,1] è¿›é˜¶: é€’å½’ç®—æ³•å¾ˆç®€å•ï¼Œä½ å¯ä»¥é€šè¿‡è¿­ä»£ç®—æ³•å®Œæˆå—ï¼Ÿ 2 è§£æ³•2.1 æ€æƒ³ é€’å½’ è¿­ä»£ï¼ˆä¸åŒäºå‰åºéå†å’Œä¸­åºéå†ï¼Œååºéå†è¿­ä»£æ›´éº»çƒ¦ï¼‰ é€†è½¬å‰åºéå† 2.2 ä»£ç é€’å½’ï¼š /** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */ class Solution { List&lt;Integer> ans = new ArrayList&lt;>(); public List&lt;Integer> postorderTraversal(TreeNode root) { if(root!=null){ postorderTraversal(root.left); postorderTraversal(root.right); ans.add(root.val); } return ans; } } è¿­ä»£ï¼š public List&lt;Integer> postorderTraversal(TreeNode root) { List&lt;Integer> list = new ArrayList&lt;>(); Stack&lt;TreeNode> stack = new Stack&lt;>(); TreeNode cur = root; TreeNode last = null; while (cur != null || !stack.isEmpty()) { if (cur != null) { stack.push(cur); cur = cur.left; } else { TreeNode temp = stack.peek(); //æ˜¯å¦å˜åˆ°å³å­æ ‘ if (temp.right != null &amp;&amp; temp.right != last) { cur = temp.right; } else { list.add(temp.val); last = temp; stack.pop(); } } } return list; } é€†è½¬å‰åºéå†ï¼šï¼ˆæ¥æºleetcodeå®˜æ–¹ï¼‰ class Solution { public List&lt;Integer> postorderTraversal(TreeNode root) { LinkedList&lt;TreeNode> stack = new LinkedList&lt;>(); LinkedList&lt;Integer> output = new LinkedList&lt;>(); if (root == null) { return output; } stack.add(root); while (!stack.isEmpty()) { TreeNode node = stack.pollLast(); output.addFirst(node.val); if (node.left != null) { stack.add(node.left); } if (node.right != null) { stack.add(node.right); } } return output; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode144-äºŒå‰æ ‘çš„å‰åºéå†","slug":"leetcode144-äºŒå‰æ ‘çš„å‰åºéå†","date":"2020-01-10T07:37:59.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode144-äºŒå‰æ ‘çš„å‰åºéå†/","link":"","permalink":"https://www.codetool.top/article/leetcode144-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E5%89%8D%E5%BA%8F%E9%81%8D%E5%8E%86/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œè¿”å›å®ƒçš„ å‰åº éå†ã€‚ ç¤ºä¾‹: è¾“å…¥: [1,null,2,3]&nbsp;1&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;/&nbsp;3è¾“å‡º: [1,2,3] è¿›é˜¶: é€’å½’ç®—æ³•å¾ˆç®€å•ï¼Œä½ å¯ä»¥é€šè¿‡è¿­ä»£ç®—æ³•å®Œæˆå—ï¼Ÿ 2 è§£æ³•2.1 æ€æƒ³é€’å½’ã€è¿­ä»£ï¼Œç±»ä¼¼ leetcode94-äºŒå‰æ ‘çš„ä¸­åºéå† 2.2 ä»£ç é€’å½’ï¼š /** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */ class Solution { List&lt;Integer> ans = new ArrayList&lt;>(); public List&lt;Integer> preorderTraversal(TreeNode root) { if(root!=null){ ans.add(root.val); preorderTraversal(root.left); preorderTraversal(root.right); } return ans; } } è¿­ä»£ï¼š public class Solution { public List &lt;Integer> inorderTraversal(TreeNode root) { List &lt;Integer> res = new ArrayList&lt;>(); Stack &lt;TreeNode> stack = new Stack&lt;>(); TreeNode curr = root; while (curr != null || !stack.isEmpty()) { while (curr != null) { stack.push(curr); res.add(curr.val); curr = curr.left; } curr = stack.pop(); curr = curr.right; } return res; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode410-åˆ†å‰²æ•°ç»„çš„æœ€å¤§å€¼","slug":"leetcode410-åˆ†å‰²æ•°ç»„çš„æœ€å¤§å€¼","date":"2020-01-09T13:58:22.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode410-åˆ†å‰²æ•°ç»„çš„æœ€å¤§å€¼/","link":"","permalink":"https://www.codetool.top/article/leetcode410-%E5%88%86%E5%89%B2%E6%95%B0%E7%BB%84%E7%9A%84%E6%9C%80%E5%A4%A7%E5%80%BC/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„å’Œä¸€ä¸ªæ•´æ•° mï¼Œä½ éœ€è¦å°†è¿™ä¸ªæ•°ç»„åˆ†æˆ m ä¸ªéç©ºçš„è¿ç»­å­æ•°ç»„ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•ä½¿å¾—è¿™ m ä¸ªå­æ•°ç»„å„è‡ªå’Œçš„æœ€å¤§å€¼æœ€å°ã€‚ æ³¨æ„:æ•°ç»„é•¿åº¦ n æ»¡è¶³ä»¥ä¸‹æ¡ä»¶: 1 â‰¤ n â‰¤ 1000 1 â‰¤ m â‰¤ min(50, n) ç¤ºä¾‹ï¼š è¾“å…¥:nums = [7,2,5,10,8]m = 2 è¾“å‡º:18 è§£é‡Š:ä¸€å…±æœ‰å››ç§æ–¹æ³•å°†numsåˆ†å‰²ä¸º2ä¸ªå­æ•°ç»„ã€‚å…¶ä¸­æœ€å¥½çš„æ–¹å¼æ˜¯å°†å…¶åˆ†ä¸º[7,2,5] å’Œ [10,8]ï¼Œå› ä¸ºæ­¤æ—¶è¿™ä¸¤ä¸ªå­æ•°ç»„å„è‡ªçš„å’Œçš„æœ€å¤§å€¼ä¸º18ï¼Œåœ¨æ‰€æœ‰æƒ…å†µä¸­æœ€å°ã€‚ 2 è§£æ³•2.1 æ€æƒ³äºŒåˆ†æŸ¥æ‰¾ã€‚è¦åˆ†æˆè¿ç»­å­æ•°ç»„ï¼Œå­æ•°ç»„çš„å’Œçš„ä¸‹é™å’Œä¸Šé™åˆ†åˆ«æ˜¯å€¼æœ€å¤§çš„å…ƒç´ å’Œæ‰€æœ‰å…ƒç´ ä¹‹å’Œï¼Œæ ¹æ®å’Œä¸å¤§äºmidçš„å­æ•°ç»„ä¸ªæ•°æ¥é€¼è¿‘ä¸€ä¸ªå€¼ï¼Œå°±æ˜¯åˆ†å‰²æ•°ç»„çš„æœ€å¤§å€¼ã€‚ 2.2 ä»£ç class Solution { public int splitArray(int[] nums, int m) { int max = nums[0]; int sum = 0; for(int i:nums){ if(i>max) max = i; sum += i; } long start = max, end = sum; while(start&lt;end){ long mid = (start + end)/2; long temp = 0; int count = 1; for(int i:nums) { temp += i; if(temp>mid) { temp = i; ++count; } } if(count>m) start = mid + 1; else end = mid; } return (int)start; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode4-å¯»æ‰¾ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„ä¸­ä½æ•°","slug":"leetcode4-å¯»æ‰¾ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„ä¸­ä½æ•°","date":"2020-01-09T09:20:24.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode4-å¯»æ‰¾ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„ä¸­ä½æ•°/","link":"","permalink":"https://www.codetool.top/article/leetcode4-%E5%AF%BB%E6%89%BE%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E7%9A%84%E4%B8%AD%E4%BD%8D%E6%95%B0/","excerpt":"","text":"è¿™é“é¢˜æˆ‘æ²¡æƒ³å‡ºç¬¦åˆæ¡ä»¶çš„æ€è·¯ 1 åŸé¢˜ç»™å®šä¸¤ä¸ªå¤§å°ä¸º m å’Œ n çš„æœ‰åºæ•°ç»„ nums1 å’Œ nums2ã€‚ è¯·ä½ æ‰¾å‡ºè¿™ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„ä¸­ä½æ•°ï¼Œå¹¶ä¸”è¦æ±‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(log(m + n))ã€‚ ä½ å¯ä»¥å‡è®¾ nums1 å’Œ nums2 ä¸ä¼šåŒæ—¶ä¸ºç©ºã€‚ ç¤ºä¾‹1ï¼š nums1 = [1, 3]nums2 = [2] åˆ™ä¸­ä½æ•°æ˜¯ 2.0 ç¤ºä¾‹2ï¼š nums1 = [1, 2]nums2 = [3, 4] åˆ™ä¸­ä½æ•°æ˜¯ (2 + 3)/2 = 2.5 2 è§£æ³•2.1 æ€æƒ³äºŒåˆ†æŸ¥æ‰¾åˆå¹¶åçš„æ•°ç»„ä¸­ç¬¬k/2ä¸ªæ•°ï¼Œæ’é™¤æ³•,å‚è€ƒ https://leetcode-cn.com/problems/median-of-two-sorted-arrays/solution/xiang-xi-tong-su-de-si-lu-fen-xi-duo-jie-fa-by-w-2/ 2.2 ä»£ç class Solution { public double findMedianSortedArrays(int[] nums1, int[] nums2) { int n = nums1.length; int m = nums2.length; int left = (n + m + 1) / 2; int right = (n + m + 2) / 2; //å°†å¶æ•°å’Œå¥‡æ•°çš„æƒ…å†µåˆå¹¶ï¼Œå¦‚æœæ˜¯å¥‡æ•°ï¼Œä¼šæ±‚ä¸¤æ¬¡åŒæ ·çš„ k ã€‚ return (getKth(nums1, 0, n - 1, nums2, 0, m - 1, left) + getKth(nums1, 0, n - 1, nums2, 0, m - 1, right)) * 0.5; } private int getKth(int[] nums1, int start1, int end1, int[] nums2, int start2, int end2, int k) { int len1 = end1 - start1 + 1; int len2 = end2 - start2 + 1; //è®© len1 çš„é•¿åº¦å°äº len2ï¼Œè¿™æ ·å°±èƒ½ä¿è¯å¦‚æœæœ‰æ•°ç»„ç©ºäº†ï¼Œä¸€å®šæ˜¯ len1 if (len1 > len2) return getKth(nums2, start2, end2, nums1, start1, end1, k); if (len1 == 0) return nums2[start2 + k - 1]; if (k == 1) return Math.min(nums1[start1], nums2[start2]); int i = start1 + Math.min(len1, k / 2) - 1; int j = start2 + Math.min(len2, k / 2) - 1; if (nums1[i] > nums2[j]) { return getKth(nums1, start1, end1, nums2, j + 1, end2, k - (j - start2 + 1)); } else { return getKth(nums1, i + 1, end1, nums2, start2, end2, k - (i - start1 + 1)); } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°04","slug":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°04","date":"2020-01-08T14:45:04.000Z","updated":"2020-04-22T09:27:27.192Z","comments":true,"path":"article/æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°04/","link":"","permalink":"https://www.codetool.top/article/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%AC%AC%E4%B8%89%E7%89%88%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B004/","excerpt":"","text":"ä»¥ä¸‹æ˜¯ç¬¬ä¸‰ç«  åƒåœ¾æ”¶é›†å™¨ä¸å†…å­˜åˆ†é…ç­–ç•¥çš„å†…å®¹ 1 æ¦‚è¿°ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç‹¬æœ‰çš„ï¼Œæ ˆå¸§æ›´æ˜¯éšæ–¹æ³•ç»“æŸè€Œæ¶ˆäº¡ï¼Œä¸éœ€è¦åƒåœ¾å›æ”¶ã€‚è€Œå †å’Œæ–¹æ³•åŒºåˆ™éœ€è¦ç»è¿‡åƒåœ¾å›æ”¶çš„è®¾è®¡ 2 å¯¹è±¡å·²æ­»ï¼Ÿ2.1 å¼•ç”¨è®¡æ•°ç®—æ³•åœ¨å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒæ—¶ï¼Œè®¡æ•°å™¨å€¼å°±åŠ ä¸€ï¼›å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å€¼å°±å‡ä¸€ï¼›ä»»ä½•æ—¶åˆ»è®¡æ•°å™¨ä¸ºé›¶çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚ ç‰¹ç‚¹ï¼šè™½ç„¶å ç”¨äº†ä¸€äº›é¢å¤–çš„å†…å­˜ç©ºé—´æ¥è¿›è¡Œè®¡æ•°ï¼Œä½†å®ƒçš„åŸç†ç®€å•ï¼Œåˆ¤å®šæ•ˆç‡ä¹Ÿå¾ˆé«˜ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å®ƒéƒ½æ˜¯ä¸€ä¸ªä¸é”™çš„ç®—æ³•ã€‚ä½†æ˜¯ï¼Œåœ¨Java é¢†åŸŸï¼Œè‡³å°‘ä¸»æµçš„Javaè™šæ‹Ÿæœºé‡Œé¢éƒ½æ²¡æœ‰é€‰ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•æ¥ç®¡ç†å†…å­˜ï¼Œä¸»è¦åŸå› æ˜¯ï¼Œè¿™ä¸ªçœ‹ä¼¼ç®€å•çš„ç®—æ³•æœ‰å¾ˆå¤šä¾‹å¤–æƒ…å†µè¦è€ƒè™‘ï¼Œå¿…é¡»è¦é…åˆå¤§é‡é¢å¤–å¤„ç†æ‰èƒ½ä¿è¯æ­£ç¡®åœ°å·¥ä½œï¼Œè­¬å¦‚å•çº¯çš„å¼•ç”¨è®¡æ•°å°±å¾ˆéš¾è§£å†³å¯¹è±¡ä¹‹é—´ç›¸äº’å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚ 2.2 å¯è¾¾æ€§åˆ†æç®—æ³•è¿™ä¸ªç®—æ³•çš„åŸºæœ¬æ€è·¯å°±æ˜¯é€šè¿‡ä¸€ç³»åˆ—ç§°ä¸º â€œGC Rootsâ€ çš„æ ¹å¯¹è±¡ä½œä¸ºèµ·å§‹èŠ‚ç‚¹é›†ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹ï¼Œæ ¹æ®å¼•ç”¨å…³ç³»å‘ä¸‹æœç´¢ï¼Œæœç´¢è¿‡ç¨‹æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºâ€œå¼•ç”¨é“¾â€ï¼Œå¦‚æœæŸä¸ªå¯¹è±¡åˆ°GC Rootsé—´æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿ï¼Œæˆ–è€…ç”¨å›¾è®ºçš„è¯æ¥è¯´å°±æ˜¯ä»GC Rootsåˆ°è¿™ä¸ªå¯¹è±¡ä¸å¯è¾¾æ—¶ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚ å¦‚å›¾æ‰€ç¤ºï¼Œå¯¹è±¡object 5ã€object 6ã€object 7è™½ç„¶äº’æœ‰å…³è”ï¼Œä½†æ˜¯å®ƒä»¬åˆ°GC Rootsæ˜¯ä¸å¯è¾¾çš„ï¼Œå› æ­¤å®ƒä»¬å°†ä¼šè¢«åˆ¤å®šä¸ºå¯å›æ”¶çš„å¯¹è±¡ã€‚ å›ºå®šå¯ä½œä¸ºGC Rootsçš„å¯¹è±¡åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š åœ¨è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ï¼Œè­¬å¦‚å„ä¸ªçº¿ç¨‹è¢«è°ƒç”¨çš„æ–¹æ³•å †æ ˆä¸­ä½¿ç”¨åˆ°çš„å‚æ•°ã€å±€éƒ¨å˜é‡ã€ä¸´æ—¶å˜é‡ç­‰ã€‚ åœ¨æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ï¼Œè­¬å¦‚Javaç±»çš„å¼•ç”¨ç±»å‹é™æ€å˜é‡ã€‚ åœ¨æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ï¼Œè­¬å¦‚å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Tableï¼‰é‡Œçš„å¼•ç”¨ã€‚ Â·åœ¨æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIï¼ˆå³é€šå¸¸æ‰€è¯´çš„Nativeæ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡ã€‚ Javaè™šæ‹Ÿæœºå†…éƒ¨çš„å¼•ç”¨ï¼Œå¦‚åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„Classå¯¹è±¡ï¼Œä¸€äº›å¸¸é©»çš„å¼‚å¸¸å¯¹è±¡ï¼ˆæ¯”å¦‚NullPointExcepitonã€OutOfMemoryErrorï¼‰ç­‰ï¼Œè¿˜æœ‰ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚ æ‰€æœ‰è¢«åŒæ­¥é”ï¼ˆsynchronizedå…³é”®å­—ï¼‰æŒæœ‰çš„å¯¹è±¡ã€‚ åæ˜ Javaè™šæ‹Ÿæœºå†…éƒ¨æƒ…å†µçš„JMXBeanã€JVMTIä¸­æ³¨å†Œçš„å›è°ƒã€æœ¬åœ°ä»£ç ç¼“å­˜ç­‰ã€‚ 2.3 å†è°ˆå¼•ç”¨éœ€æ±‚ï¼šæœ‰ä¸€ç±»å¯¹è±¡ï¼Œå½“å†…å­˜ç©ºé—´è¿˜è¶³å¤Ÿæ—¶ï¼Œèƒ½ä¿ç•™åœ¨å†…å­˜ä¹‹ä¸­ï¼Œå¦‚æœå†…å­˜ç©ºé—´åœ¨è¿›è¡Œåƒåœ¾æ”¶é›†åä»ç„¶éå¸¸ç´§å¼ ï¼Œé‚£å°±å¯ä»¥æŠ›å¼ƒè¿™äº›å¯¹è±¡â€”â€”å¾ˆå¤šç³»ç»Ÿçš„ç¼“å­˜åŠŸèƒ½éƒ½ç¬¦åˆè¿™æ ·çš„åº”ç”¨åœºæ™¯ã€‚ åœ¨JDK 1.2ç‰ˆä¹‹åï¼ŒJavaå¯¹å¼•ç”¨çš„æ¦‚å¿µè¿›è¡Œäº†æ‰©å……ï¼Œå°†å¼•ç”¨åˆ†ä¸ºå¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨4ç§ï¼Œè¿™4ç§å¼•ç”¨å¼ºåº¦ä¾æ¬¡é€æ¸å‡å¼±ã€‚ å¼ºå¼•ç”¨ï¼šä¼ ç»Ÿçš„å¼•ç”¨å…³ç³»ï¼Œæ— è®ºä»»ä½•æƒ…å†µä¸‹ï¼Œåªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜å­˜åœ¨ï¼Œåƒåœ¾æ”¶é›†å™¨å°±æ°¸è¿œä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ è½¯å¼•ç”¨ï¼šè¿˜æœ‰ç”¨ï¼Œä½†éå¿…é¡»çš„å¯¹è±¡ã€‚åœ¨ç³»ç»Ÿå°†è¦å‘ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸å‰ï¼Œä¼šæŠŠè¿™äº›å¯¹è±¡åˆ—è¿›å›æ”¶èŒƒå›´ä¹‹ä¸­è¿›è¡Œç¬¬äºŒæ¬¡å›æ”¶ï¼Œåœ¨JDK 1.2ç‰ˆä¹‹åæä¾›äº†SoftReferenceç±»æ¥å®ç°è½¯å¼•ç”¨ã€‚ å¼±å¼•ç”¨ï¼šéå¿…é¡»å¯¹è±¡ï¼Œä½†æ˜¯å®ƒçš„å¼ºåº¦æ¯”è½¯å¼•ç”¨æ›´å¼±ä¸€äº›ã€‚å½“åƒåœ¾æ”¶é›†å™¨å¼€å§‹å·¥ä½œï¼Œæ— è®ºå½“å‰å†…å­˜æ˜¯å¦è¶³å¤Ÿï¼Œéƒ½ä¼šå›æ”¶æ‰åªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚åœ¨JDK 1.2ç‰ˆä¹‹åæä¾›äº†WeakReferenceç±»æ¥å®ç°å¼±å¼•ç”¨ è™šå¼•ç”¨ï¼šä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´æ„æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥å–å¾—ä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„åªæ˜¯ä¸ºäº†èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚åœ¨JDK 1.2ç‰ˆä¹‹åæä¾›äº†PhantomReferenceç±»æ¥å®ç°è™šå¼•ç”¨ã€‚ 2.4 ç”Ÿå­˜è¿˜æ˜¯æ­»äº¡ï¼Ÿå³ä½¿åœ¨å¯è¾¾æ€§åˆ†æç®—æ³•ä¸­åˆ¤å®šä¸ºä¸å¯è¾¾çš„å¯¹è±¡ï¼Œä¹Ÿä¸æ˜¯â€œéæ­»ä¸å¯â€çš„ï¼Œè¿™æ—¶å€™å®ƒä»¬æš‚æ—¶è¿˜å¤„äºâ€œç¼“åˆ‘â€é˜¶æ®µï¼Œè¦çœŸæ­£å®£å‘Šä¸€ä¸ªå¯¹è±¡æ­»äº¡ï¼Œè‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ï¼šå¦‚æœå¯¹è±¡åœ¨è¿›è¡Œå¯è¾¾æ€§åˆ†æåå‘ç°æ²¡æœ‰ä¸GC Rootsç›¸è¿æ¥çš„å¼•ç”¨é“¾ï¼Œé‚£å®ƒå°†ä¼šè¢«ç¬¬ä¸€æ¬¡æ ‡è®°ï¼Œéšåè¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼Œç­›é€‰çš„æ¡ä»¶æ˜¯æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•ã€‚å‡å¦‚å¯¹è±¡æ²¡æœ‰è¦†ç›–finalize()æ–¹æ³•ï¼Œæˆ–è€…finalize()æ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°†è¿™ä¸¤ç§æƒ…å†µéƒ½è§†ä¸ºâ€œæ²¡æœ‰å¿…è¦æ‰§è¡Œâ€ã€‚ å¦‚æœè¿™ä¸ªå¯¹è±¡è¢«åˆ¤å®šä¸ºç¡®æœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å°†ä¼šè¢«æ”¾ç½®åœ¨ä¸€ä¸ªåä¸ºF-Queueçš„é˜Ÿåˆ—ä¹‹ä¸­ï¼Œå¹¶åœ¨ç¨åç”±ä¸€æ¡ç”±è™šæ‹Ÿæœºè‡ªåŠ¨å»ºç«‹çš„ã€ä½è°ƒåº¦ä¼˜å…ˆçº§çš„Finalizerçº¿ç¨‹å»æ‰§è¡Œå®ƒä»¬çš„finalize()æ–¹æ³•ã€‚ ç½‘ä¸Šæœ‰ç§°è¿™ç§é‡å†™äº†finalizeæ–¹æ³•çš„å¯¹è±¡ä¸ºç»ˆç»“å™¨å¼•ç”¨ã€‚ finalize()æ˜¯è§£æ•‘ä¸€ä¸ªå¯¹è±¡çš„æœ€åæœºä¼š 2.5 å›æ”¶æ–¹æ³•åŒºè™šæ‹Ÿæœºè§„èŒƒä¸å¼ºåˆ¶è¦æ±‚å®ç°æ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶æ€§ä»·æ¯”è¾ƒä½ã€‚æ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ä¸»è¦å›æ”¶ä¸¤éƒ¨åˆ†å†…å®¹ï¼šåºŸå¼ƒçš„å¸¸é‡å’Œä¸å†ä½¿ç”¨çš„ç±»å‹ã€‚ è¦åˆ¤å®šä¸€ä¸ªç±»å‹æ˜¯å¦å±äºâ€œä¸å†è¢«ä½¿ç”¨çš„ç±»â€éœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸‰ä¸ªæ¡ä»¶ï¼š è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯Javaå †ä¸­ä¸å­˜åœ¨è¯¥ç±»åŠå…¶ä»»ä½•æ´¾ç”Ÿå­ç±»çš„å®ä¾‹ã€‚ åŠ è½½è¯¥ç±»çš„ç±»åŠ è½½å™¨å·²ç»è¢«å›æ”¶ï¼Œè¿™ä¸ªæ¡ä»¶é™¤éæ˜¯ç»è¿‡ç²¾å¿ƒè®¾è®¡çš„å¯æ›¿æ¢ç±»åŠ è½½å™¨çš„åœºæ™¯ï¼Œå¦‚OSGiã€JSPçš„é‡åŠ è½½ç­‰ï¼Œå¦åˆ™é€šå¸¸æ˜¯å¾ˆéš¾è¾¾æˆçš„ã€‚ è¯¥ç±»å¯¹åº”çš„java.lang.Classå¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚ ç„¶è€Œæ»¡è¶³äº†ä¸Šé¢ä¸‰ä¸ªæ¡ä»¶ä¹Ÿä¸ä¸€å®šè¦å›æ”¶ï¼Œ-Xnoclassgcå‚æ•°å¯ä»¥æŒ‡å®šæ˜¯å¦è¦è¿›è¡Œç±»å‹å›æ”¶ã€‚ -verbose:classã€-XX:+TraceClassLoadingå¯ä»¥è¾“å‡ºç±»åŠ è½½ä¿¡æ¯ã€‚-XX:+TraceClassUnLoadingå¯ä»¥è¾“å‡ºç±»å¸è½½ä¿¡æ¯ã€‚ 3 åƒåœ¾æ”¶é›†ç®—æ³•ä»å¦‚ä½•åˆ¤å®šå¯¹è±¡æ¶ˆäº¡çš„è§’åº¦å‡ºå‘ï¼Œåƒåœ¾æ”¶é›†ç®—æ³•å¯ä»¥åˆ’åˆ†ä¸ºâ€œå¼•ç”¨è®¡æ•°å¼åƒåœ¾æ”¶é›†â€å’Œâ€œè¿½è¸ªå¼åƒåœ¾æ”¶é›†â€ä¸¤å¤§ç±»ï¼Œè¿™é‡Œä»‹ç»çš„éƒ½æ˜¯â€œè¿½è¸ªå¼åƒåœ¾æ”¶é›†â€ã€‚ 3.1 åˆ†ä»£æ”¶é›†ç†è®ºåˆ†ä»£æ”¶é›†ç†è®ºå®é™…æ˜¯å®è´¨æ˜¯ä¸€å¥—ç¬¦åˆå¤§å¤šæ•°ç¨‹åºè¿è¡Œå®é™…æƒ…å†µçš„ç»éªŒæ³•åˆ™ï¼Œå®ƒå»ºç«‹åœ¨ä¸¤ä¸ªåˆ†ä»£å‡è¯´ä¸Šï¼š å¼±åˆ†ä»£å‡è¯´ï¼šç»å¤§å¤šæ•°å¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•ç­çš„ã€‚ å¼ºåˆ†ä»£å‡è¯´ï¼šç†¬è¿‡è¶Šå¤šæ¬¡åƒåœ¾æ”¶é›†è¿‡ç¨‹çš„å¯¹è±¡å°±è¶Šéš¾ä»¥æ¶ˆäº¡ã€‚ å¤šæ¬¾å¸¸ç”¨åƒåœ¾æ”¶é›†å™¨çš„ä¸€è‡´çš„è®¾è®¡åŸåˆ™ï¼šæ”¶é›†å™¨åº”è¯¥å°†Javaå †åˆ’åˆ†å‡ºä¸åŒçš„åŒºåŸŸï¼Œç„¶åå°†å›æ”¶å¯¹è±¡ä¾æ®å…¶å¹´é¾„ï¼ˆå¹´é¾„å³å¯¹è±¡ç†¬è¿‡åƒåœ¾æ”¶é›†è¿‡ç¨‹çš„æ¬¡æ•°ï¼‰åˆ†é…åˆ°ä¸åŒçš„åŒºåŸŸä¹‹ä¸­å­˜å‚¨ã€‚ åœ¨Javaå †åˆ’åˆ†å‡ºä¸åŒçš„åŒºåŸŸä¹‹åï¼Œåƒåœ¾æ”¶é›†å™¨æ‰å¯ä»¥æ¯æ¬¡åªå›æ”¶å…¶ä¸­æŸä¸€ä¸ªæˆ–è€…æŸäº›éƒ¨åˆ†çš„åŒºåŸŸâ€”â€”å› è€Œæ‰æœ‰äº† â€œMinor GCâ€ â€œMajor GCâ€ â€œFull GCâ€ è¿™æ ·çš„å›æ”¶ç±»å‹çš„åˆ’åˆ†ï¼›ä¹Ÿæ‰èƒ½å¤Ÿé’ˆå¯¹ä¸åŒçš„åŒºåŸŸå®‰æ’ä¸é‡Œé¢å­˜å‚¨å¯¹è±¡å­˜äº¡ç‰¹å¾ç›¸åŒ¹é…çš„åƒåœ¾æ”¶é›†ç®—æ³•â€”â€”å› è€Œå‘å±•å‡ºäº†â€œæ ‡è®°-å¤åˆ¶ç®—æ³•â€â€œæ ‡è®°-æ¸…é™¤ç®—æ³•â€â€œæ ‡è®°-æ•´ç†ç®—æ³•â€ç­‰é’ˆå¯¹æ€§çš„åƒåœ¾æ”¶é›†ç®—æ³•ã€‚ ç°åœ¨çš„å•†ç”¨Javaè™šæ‹Ÿæœºä¸€èˆ¬è‡³å°‘ä¼šæŠŠJavaå †åˆ’åˆ†ä¸ºæ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰å’Œè€å¹´ä»£ï¼ˆOld Generationï¼‰ä¸¤ä¸ªåŒºåŸŸã€‚é¡¾åæ€ä¹‰ï¼Œåœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæ¯æ¬¡åƒåœ¾æ”¶é›†æ—¶éƒ½å‘ç°æœ‰å¤§æ‰¹å¯¹è±¡æ­»å»ï¼Œè€Œæ¯æ¬¡å›æ”¶åå­˜æ´»çš„å°‘é‡å¯¹è±¡ï¼Œå°†ä¼šé€æ­¥æ™‹å‡åˆ°è€å¹´ä»£ä¸­å­˜æ”¾ã€‚ ä¸€ä¸ªæ˜æ˜¾çš„å›°éš¾ï¼šå¯¹è±¡ä¸æ˜¯å­¤ç«‹çš„ï¼Œå¯¹è±¡ä¹‹é—´ä¼šå­˜åœ¨è·¨ä»£å¼•ç”¨ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦å¯¹åˆ†ä»£æ”¶é›†ç†è®ºæ·»åŠ ç¬¬ä¸‰æ¡ç»éªŒæ³•åˆ™ï¼šè·¨ä»£å¼•ç”¨å‡è¯´ï¼šè·¨ä»£å¼•ç”¨ç›¸å¯¹äºåŒä»£å¼•ç”¨æ¥è¯´ä»…å æå°‘æ•°ã€‚ï¼ˆå­˜åœ¨äº’ç›¸å¼•ç”¨å…³ç³»çš„ä¸¤ä¸ªå¯¹è±¡ï¼Œæ˜¯åº”è¯¥å€¾å‘äºåŒæ—¶ç”Ÿå­˜æˆ–è€…åŒæ—¶æ¶ˆäº¡çš„ã€‚ï¼‰ è§£å†³æ–¹æ¡ˆï¼šåœ¨æ–°ç”Ÿä»£ä¸Šå»ºç«‹ä¸€ä¸ªå…¨å±€çš„æ•°æ®ç»“æ„ï¼ˆè¯¥ç»“æ„è¢«ç§°ä¸º â€œè®°å¿†é›†â€ï¼‰ï¼Œè¿™ä¸ªç»“æ„æŠŠè€å¹´ä»£åˆ’åˆ†æˆè‹¥å¹²å°å—ï¼Œæ ‡è¯†å‡ºè€å¹´ä»£çš„å“ªä¸€å—å†…å­˜ä¼šå­˜åœ¨è·¨ä»£å¼•ç”¨ã€‚æ­¤åå½“å‘ç”ŸMinor GCæ—¶ï¼Œåªæœ‰åŒ…å«äº†è·¨ä»£å¼•ç”¨çš„å°å—å†…å­˜é‡Œçš„å¯¹è±¡æ‰ä¼šè¢«åŠ å…¥åˆ°GC Rootsè¿›è¡Œæ‰«æã€‚ åè¯è§£é‡Šï¼š éƒ¨åˆ†æ”¶é›†ï¼ˆPartial GCï¼‰ï¼šæŒ‡ç›®æ ‡ä¸æ˜¯å®Œæ•´æ”¶é›†æ•´ä¸ªJavaå †çš„åƒåœ¾æ”¶é›†ï¼Œå…¶ä¸­åˆåˆ†ä¸ºï¼š æ–°ç”Ÿä»£æ”¶é›†ï¼ˆMinor GC/Young GCï¼‰ï¼šæŒ‡ç›®æ ‡åªæ˜¯æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†ã€‚ è€å¹´ä»£æ”¶é›†ï¼ˆMajor GC/Old GCï¼‰ï¼šæŒ‡ç›®æ ‡åªæ˜¯è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚ç›®å‰åªæœ‰CMSæ”¶é›†å™¨ä¼šæœ‰å•ç‹¬æ”¶é›†è€å¹´ä»£çš„è¡Œä¸ºã€‚â€œMajor GCâ€è¿™ä¸ªè¯´æ³•ç°åœ¨æœ‰ç‚¹æ··æ·†,å¯èƒ½æ˜¯æŒ‡è€å¹´ä»£çš„æ”¶é›†æˆ–æ˜¯æ•´å †æ”¶é›†ã€‚ æ··åˆæ”¶é›†ï¼ˆMixed GCï¼‰ï¼šæŒ‡ç›®æ ‡æ˜¯æ”¶é›†æ•´ä¸ªæ–°ç”Ÿä»£ä»¥åŠéƒ¨åˆ†è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚ç›®å‰åªæœ‰G1æ”¶é›†å™¨ä¼šæœ‰è¿™ç§è¡Œä¸ºã€‚ æ•´å †æ”¶é›†ï¼ˆFull GCï¼‰ï¼šæ”¶é›†æ•´ä¸ªJavaå †å’Œæ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ã€‚ ç›¸å…³VMå‚æ•°ï¼š å«ä¹‰ å‚æ•° å †åˆå§‹å¤§å° -Xms å †æœ€å¤§å¤§å° -Xmxæˆ–-XX:MaxHeapSize=size æ–°ç”Ÿä»£å¤§å° -Xmnæˆ–ï¼ˆ-XX:NewSize=size + -XX:MaxNewSize=sizeï¼‰ å¹¸å­˜åŒºæ¯”ä¾‹ï¼ˆåŠ¨æ€ï¼‰ -XX:InitialSurvivorRatio=ratioå’Œ-XX:UseAdaptiveSizePolicy å¹¸å­˜åŒºæ¯”ä¾‹ -XX:SurvivorRatio=ratio æ™‹å‡é˜ˆå€¼ -XX:MaxTenuringThreshold=threshold æ™‹å‡è¯¦æƒ… -XX:+PrintTenuringDistribution GCè¯¦æƒ… -XX:+PrintGCDetails -verbose:gc FullGCå‰å…ˆMinorGC -XX:+ScavengeBeforeFullGC 3.2 æ ‡è®°-æ¸…é™¤ç®—æ³•åˆ†ä¸ºâ€œæ ‡è®°â€å’Œâ€œæ¸…é™¤â€ä¸¤ä¸ªé˜¶æ®µï¼šé¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®Œæˆåï¼Œç»Ÿä¸€å›æ”¶æ‰æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚ ä¸»è¦ç¼ºç‚¹ï¼š æ‰§è¡Œæ•ˆç‡ä¸ç¨³å®šï¼Œå¦‚æœJavaå †ä¸­åŒ…å«å¤§é‡å¯¹è±¡ï¼Œè€Œä¸”å…¶ä¸­å¤§éƒ¨åˆ†æ˜¯éœ€è¦è¢«å›æ”¶çš„ï¼Œè¿™æ—¶å¿…é¡»è¿›è¡Œå¤§é‡æ ‡è®°å’Œæ¸…é™¤çš„åŠ¨ä½œï¼Œå¯¼è‡´æ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªè¿‡ç¨‹çš„æ‰§è¡Œæ•ˆç‡éƒ½éšå¯¹è±¡æ•°é‡å¢é•¿è€Œé™ä½ å†…å­˜ç©ºé—´çš„ç¢ç‰‡åŒ–é—®é¢˜ï¼Œæ ‡è®°ã€æ¸…é™¤ä¹‹åä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼Œç©ºé—´ç¢ç‰‡å¤ªå¤šå¯èƒ½ä¼šå¯¼è‡´å½“ä»¥ååœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦åˆ†é…è¾ƒå¤§å¯¹è±¡æ—¶æ— æ³•æ‰¾åˆ°è¶³å¤Ÿçš„è¿ç»­å†…å­˜è€Œä¸å¾—ä¸æå‰è§¦å‘å¦ä¸€æ¬¡åƒåœ¾æ”¶é›†åŠ¨ä½œ 3.3 æ ‡è®°-å¤åˆ¶ç®—æ³•å°†å¯ç”¨å†…å­˜æŒ‰å®¹é‡åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—ã€‚å½“è¿™ä¸€å—çš„å†…å­˜ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€å—ä¸Šé¢ï¼Œç„¶åå†æŠŠå·²ä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ã€‚ é€‚ç”¨äºå¤šæ•°å¯¹è±¡æ˜¯å¯å›æ”¶çš„ï¼Œç¼ºç‚¹æ˜¯å¯ç”¨å†…å­˜ç¼©å°ä¸ºäº†åŸæ¥çš„ä¸€åŠï¼Œç©ºé—´æµªè´¹å¤ªå¤šã€‚ ç°åœ¨çš„å•†ç”¨Javaè™šæ‹Ÿæœºå¤§å¤šéƒ½ä¼˜å…ˆé‡‡ç”¨äº†è¿™ç§æ”¶é›†ç®—æ³•å»å›æ”¶æ–°ç”Ÿä»£ã€‚ ä¸€ç§æ›´ä¼˜åŒ–çš„åŠåŒºå¤åˆ¶åˆ†ä»£ç­–ç•¥:â€œAppelå¼å›æ”¶â€ï¼ŒHotSpotè™šæ‹Ÿæœºçš„Serialã€ParNewç­‰æ–°ç”Ÿä»£æ”¶é›†å™¨å‡é‡‡ç”¨äº†è¿™ç§ç­–ç•¥æ¥è®¾è®¡æ–°ç”Ÿä»£çš„å†…å­˜å¸ƒå±€ï¼š æŠŠæ–°ç”Ÿä»£åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„Edenç©ºé—´å’Œä¸¤å—è¾ƒå°çš„Survivorç©ºé—´ï¼Œæ¯æ¬¡åˆ†é…å†…å­˜åªä½¿ç”¨Edenå’Œå…¶ä¸­ä¸€å—Survivorã€‚å‘ç”Ÿåƒåœ¾æœé›†æ—¶ï¼Œå°†Edenå’ŒSurvivorä¸­ä»ç„¶å­˜æ´»çš„å¯¹è±¡ä¸€æ¬¡æ€§å¤åˆ¶åˆ°å¦å¤–ä¸€å—Survivorç©ºé—´ä¸Šï¼Œç„¶åç›´æ¥æ¸…ç†æ‰Edenå’Œå·²ç”¨è¿‡çš„é‚£å—Survivorç©ºé—´ã€‚HotSpotè™šæ‹Ÿæœºé»˜è®¤Edenå’ŒSurvivorçš„å¤§å°æ¯”ä¾‹æ˜¯8âˆ¶1ï¼Œä¹Ÿå³æ¯æ¬¡æ–°ç”Ÿä»£ä¸­å¯ç”¨å†…å­˜ç©ºé—´ä¸ºæ•´ä¸ªæ–°ç”Ÿä»£å®¹é‡çš„90%ï¼ˆEdençš„80%åŠ ä¸Šä¸€ä¸ªSurvivorçš„10%ï¼‰ï¼Œåªæœ‰ä¸€ä¸ªSurvivorç©ºé—´ï¼Œå³10%çš„æ–°ç”Ÿä»£æ˜¯ä¼šè¢«â€œæµªè´¹â€çš„ã€‚è¿˜æœ‰ä¸€ä¸ªå……å½“ç½•è§æƒ…å†µçš„â€œé€ƒç”Ÿé—¨â€çš„å®‰å…¨è®¾è®¡ï¼Œå½“Survivorç©ºé—´ä¸è¶³ä»¥å®¹çº³ä¸€æ¬¡Minor GCä¹‹åå­˜æ´»çš„å¯¹è±¡æ—¶ï¼Œå°±éœ€è¦ä¾èµ–å…¶ä»–å†…å­˜åŒºåŸŸï¼ˆå®é™…ä¸Šå¤§å¤šå°±æ˜¯è€å¹´ä»£ï¼‰è¿›è¡Œåˆ†é…æ‹…ä¿ã€‚ 3.4 æ ‡è®°-æ•´ç†ç®—æ³•é’ˆå¯¹è€å¹´ä»£çš„å­˜äº¡ç‰¹å¾è®¾è®¡çš„ï¼Œå…¶ä¸­çš„æ ‡è®°è¿‡ç¨‹ä»ç„¶ä¸â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸€æ ·ï¼Œä½†åç»­æ­¥éª¤ä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡è¿›è¡Œæ¸…ç†ï¼Œè€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘å†…å­˜ç©ºé—´ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚ å¦‚æœç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œå°¤å…¶æ˜¯åœ¨è€å¹´ä»£è¿™ç§æ¯æ¬¡å›æ”¶éƒ½æœ‰å¤§é‡å¯¹è±¡å­˜æ´»åŒºåŸŸï¼Œç§»åŠ¨å­˜æ´»å¯¹è±¡å¹¶æ›´æ–°æ‰€æœ‰å¼•ç”¨è¿™äº›å¯¹è±¡çš„åœ°æ–¹å°†ä¼šæ˜¯ä¸€ç§æä¸ºè´Ÿé‡çš„æ“ä½œï¼Œè€Œä¸”è¿™ç§å¯¹è±¡ç§»åŠ¨æ“ä½œå¿…é¡»å…¨ç¨‹æš‚åœç”¨æˆ·åº”ç”¨ç¨‹åºæ‰èƒ½è¿›è¡Œï¼ˆæœ€æ–°çš„ZGCå’ŒShenandoahæ”¶é›†å™¨ä½¿ç”¨è¯»å±éšœæŠ€æœ¯å®ç°äº†æ•´ç†è¿‡ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹çš„å¹¶å‘æ‰§è¡Œï¼‰ï¼›ä½†å¦‚æœè·Ÿæ ‡è®°-æ¸…é™¤ç®—æ³•é‚£æ ·å®Œå…¨ä¸è€ƒè™‘ç§»åŠ¨å’Œæ•´ç†å­˜æ´»å¯¹è±¡çš„è¯ï¼Œå¼¥æ•£äºå †ä¸­çš„å­˜æ´»å¯¹è±¡å¯¼è‡´çš„ç©ºé—´ç¢ç‰‡åŒ–é—®é¢˜å°±åªèƒ½ä¾èµ–æ›´ä¸ºå¤æ‚çš„å†…å­˜åˆ†é…å™¨å’Œå†…å­˜è®¿é—®å™¨æ¥è§£å†³ã€‚ ç§»åŠ¨åˆ™å†…å­˜å›æ”¶æ—¶ä¼šæ›´å¤æ‚ï¼Œä¸ç§»åŠ¨åˆ™å†…å­˜åˆ†é…æ—¶ä¼šæ›´å¤æ‚ã€‚HotSpotè™šæ‹Ÿæœºé‡Œé¢å…³æ³¨ååé‡çš„Parallel Scavengeæ”¶é›†å™¨æ˜¯åŸºäºæ ‡è®°-æ•´ç†ç®—æ³•çš„ï¼Œè€Œå…³æ³¨å»¶è¿Ÿçš„CMSæ”¶é›†å™¨åˆ™æ˜¯åŸºäºæ ‡è®°-æ¸…é™¤ç®—æ³•çš„ã€‚ è¿˜æœ‰ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯è®©è™šæ‹Ÿæœºå¹³æ—¶å¤šæ•°æ—¶é—´éƒ½é‡‡ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œæš‚æ—¶å®¹å¿å†…å­˜ç¢ç‰‡çš„å­˜åœ¨ï¼Œç›´åˆ°å†…å­˜ç©ºé—´çš„ç¢ç‰‡åŒ–ç¨‹åº¦å·²ç»å¤§åˆ°å½±å“å¯¹è±¡åˆ†é…æ—¶ï¼Œå†é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•æ”¶é›†ä¸€æ¬¡ï¼Œä»¥è·å¾—è§„æ•´çš„å†…å­˜ç©ºé—´ã€‚åŸºäºæ ‡è®°-æ¸…é™¤ç®—æ³•çš„CMSæ”¶é›†å™¨é¢ä¸´ç©ºé—´ç¢ç‰‡è¿‡å¤šæ—¶é‡‡ç”¨çš„å°±æ˜¯è¿™ç§å¤„ç†åŠæ³•ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jvm","slug":"jvm","permalink":"https://www.codetool.top/tags/jvm/"}]},{"title":"leetcode287-å¯»æ‰¾é‡å¤æ•°","slug":"leetcode287-å¯»æ‰¾é‡å¤æ•°","date":"2020-01-07T05:07:59.000Z","updated":"2020-02-20T14:55:21.052Z","comments":true,"path":"article/leetcode287-å¯»æ‰¾é‡å¤æ•°/","link":"","permalink":"https://www.codetool.top/article/leetcode287-%E5%AF%BB%E6%89%BE%E9%87%8D%E5%A4%8D%E6%95%B0/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªåŒ…å« n + 1 ä¸ªæ•´æ•°çš„æ•°ç»„ nums ï¼Œå…¶æ•°å­—éƒ½åœ¨ 1 åˆ° n ä¹‹é—´ï¼ˆåŒ…æ‹¬ 1 å’Œ nï¼‰ï¼Œå¯çŸ¥è‡³å°‘å­˜åœ¨ä¸€ä¸ªé‡å¤çš„æ•´æ•°ã€‚å‡è®¾åªæœ‰ä¸€ä¸ªé‡å¤çš„æ•´æ•°ï¼Œæ‰¾å‡ºè¿™ä¸ªé‡å¤çš„æ•°ã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥: [1,3,4,2,2]è¾“å‡º: 2 ç¤ºä¾‹2ï¼š è¾“å…¥: [3,1,3,4,2]è¾“å‡º: 3 è¯´æ˜ï¼š ä¸èƒ½æ›´æ”¹åŸæ•°ç»„ï¼ˆå‡è®¾æ•°ç»„æ˜¯åªè¯»çš„ï¼‰ã€‚ åªèƒ½ä½¿ç”¨é¢å¤–çš„ O(1) çš„ç©ºé—´ã€‚ æ—¶é—´å¤æ‚åº¦å°äº O(n2) ã€‚ æ•°ç»„ä¸­åªæœ‰ä¸€ä¸ªé‡å¤çš„æ•°å­—ï¼Œä½†å®ƒå¯èƒ½ä¸æ­¢é‡å¤å‡ºç°ä¸€æ¬¡ã€‚ 2 è§£æ³•2.1 æ€æƒ³æœ‰æ’åºå’Œå“ˆå¸Œé›†çš„æ–¹æ³•ï¼Œä½†è¦æ»¡è¶³4ç‚¹é™åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æˆ–å¿«æ…¢æŒ‡é’ˆï¼š äºŒåˆ†æŸ¥æ‰¾ï¼Œå‚è€ƒ https://leetcode-cn.com/problems/find-the-duplicate-number/solution/er-fen-fa-si-lu-ji-dai-ma-python-by-liweiwei1419/ å¿«æ…¢æŒ‡é’ˆï¼Œå°†indexçœ‹æˆæœ‰å‘å›¾é‡Œçš„èŠ‚ç‚¹ï¼Œå°†å¯¹åº”çš„valueçœ‹æˆèŠ‚ç‚¹æŒ‡å‘çš„èŠ‚ç‚¹ã€‚é‚£ä¹ˆæœ‰é‡å¤å…ƒç´ å¿…ç„¶ä¼šå½¢æˆç¯ã€‚å¦‚å›¾ï¼š é‚£ä¹ˆå…¥ç¯çš„èŠ‚ç‚¹å€¼å°±æ˜¯é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨leetcode142-ç¯å½¢é“¾è¡¨IIçš„åŒæŒ‡é’ˆæ³•æ¥æ‰¾å‡ºå…¥ç¯çš„å…ƒç´ ã€‚ 2.2 ä»£ç å“ˆå¸Œé›†ï¼š class Solution { public int findDuplicate(int[] nums) { HashSet&lt;Integer> set = new HashSet&lt;>(); for(int i:nums){ if(set.contains(i)) return i; set.add(i); } return -1; } } äºŒåˆ†æŸ¥æ‰¾ï¼š public class Solution { public int findDuplicate(int[] nums) { int len = nums.length; int left = 1; int right = len - 1; while (left &lt; right) { // int mid = left + (right - left) / 2; int mid = (left + right) >>> 1; int counter = 0; for (int num : nums) { if (num &lt;= mid) { counter += 1; } } if (counter > mid) { right = mid; } else { left = mid + 1; } } return left; } } å¿«æ…¢æŒ‡é’ˆï¼š class Solution { public int findDuplicate(int[] nums) { int slow = nums[0]; int fast = nums[0]; do{ slow = nums[slow]; //ç›¸å½“äºèµ°ä¸€æ­¥ fast = nums[nums[fast]]; //ç›¸å½“äºèµ°ä¸¤æ­¥ } while (slow!=fast); slow = nums[0]; while (slow != fast){ slow = nums[slow]; fast = nums[fast]; } return slow; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode154-å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼II","slug":"leetcode154-å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼II","date":"2020-01-07T04:29:31.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode154-å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼II/","link":"","permalink":"https://www.codetool.top/article/leetcode154-%E5%AF%BB%E6%89%BE%E6%97%8B%E8%BD%AC%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E6%9C%80%E5%B0%8F%E5%80%BCII/","excerpt":"","text":"1 åŸé¢˜å‡è®¾æŒ‰ç…§å‡åºæ’åºçš„æ•°ç»„åœ¨é¢„å…ˆæœªçŸ¥çš„æŸä¸ªç‚¹ä¸Šè¿›è¡Œäº†æ—‹è½¬ã€‚ ( ä¾‹å¦‚ï¼Œæ•°ç»„ [0,1,2,4,5,6,7] å¯èƒ½å˜ä¸º [4,5,6,7,0,1,2] )ã€‚ è¯·æ‰¾å‡ºå…¶ä¸­æœ€å°çš„å…ƒç´ ã€‚ æ³¨æ„æ•°ç»„ä¸­å¯èƒ½å­˜åœ¨é‡å¤çš„å…ƒç´ ã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥ï¼š [1,3,5]è¾“å‡ºï¼š 1 ç¤ºä¾‹2ï¼š è¾“å…¥ï¼š [2,2,2,0,1]è¾“å‡ºï¼š 0 è¯´æ˜ï¼š è¿™é“é¢˜æ˜¯ å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ çš„å»¶ä¼¸é¢˜ç›®ã€‚ å…è®¸é‡å¤ä¼šå½±å“ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å—ï¼Ÿä¼šå¦‚ä½•å½±å“ï¼Œä¸ºä»€ä¹ˆï¼Ÿ 2 è§£æ³•2.1 æ€æƒ³ çº¿æ€§æŸ¥æ‰¾ äºŒåˆ†æŸ¥æ‰¾,å‚è€ƒ https://leetcode-cn.com/problems/find-minimum-in-rotated-sorted-array-ii/solution/154-find-minimum-in-rotated-sorted-array-ii-by-jyd/ 2.2 ä»£ç  çº¿æ€§æŸ¥æ‰¾ class Solution { public int findMin(int[] nums) { int min = nums[0]; for(int i:nums){ if(i&lt;min){ min=i; break; } } return min; } } äºŒåˆ†æŸ¥æ‰¾ class Solution { public int findMin(int[] nums) { int left = 0, right = nums.length - 1; while (left &lt; right) { int mid = (left + right) / 2; if (nums[mid] > nums[right]) left = mid + 1; else if (nums[mid] &lt; nums[right]) right = mid; else right = right - 1; } return nums[left]; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°03","slug":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°03","date":"2020-01-06T08:36:25.000Z","updated":"2020-04-22T09:27:27.204Z","comments":true,"path":"article/æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°03/","link":"","permalink":"https://www.codetool.top/article/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%AC%AC%E4%B8%89%E7%89%88%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B003/","excerpt":"","text":"ç»­æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°02 1 HotSpotè™šæ‹Ÿæœºå¯¹è±¡æ¢ç§˜1.1 å¯¹è±¡çš„åˆ›å»º å½“Javaè™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡å­—èŠ‚ç newæŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆå°†å»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°ä¸€ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«åŠ è½½ã€è§£æå’Œåˆå§‹åŒ–è¿‡ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£å¿…é¡»å…ˆæ‰§è¡Œç›¸åº”çš„ç±»åŠ è½½è¿‡ç¨‹ ç±»åŠ è½½æ£€æŸ¥é€šè¿‡åï¼Œä¸ºæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜ã€‚æœ‰ä¸¤ç§æ–¹æ³•ï¼š å‡è®¾Javaå †ä¸­å†…å­˜æ˜¯ç»å¯¹è§„æ•´çš„ï¼Œæ‰€æœ‰è¢«ä½¿ç”¨è¿‡çš„å†…å­˜éƒ½è¢«æ”¾åœ¨ä¸€è¾¹ï¼Œç©ºé—²çš„å†…å­˜è¢«æ”¾åœ¨å¦ä¸€è¾¹ï¼Œä¸­é—´æ”¾ç€ä¸€ä¸ªæŒ‡é’ˆä½œä¸ºåˆ†ç•Œç‚¹çš„æŒ‡ç¤ºå™¨ï¼Œé‚£æ‰€åˆ†é…å†…å­˜å°±ä»…ä»…æ˜¯æŠŠé‚£ä¸ªæŒ‡é’ˆå‘ç©ºé—²ç©ºé—´æ–¹å‘æŒªåŠ¨ä¸€æ®µä¸å¯¹è±¡å¤§å°ç›¸ç­‰çš„è·ç¦»ï¼Œè¿™ç§åˆ†é…æ–¹å¼ç§°ä¸º â€œæŒ‡é’ˆç¢°æ’â€ å¦‚æœJavaå †ä¸­çš„å†…å­˜å¹¶ä¸æ˜¯è§„æ•´çš„ï¼Œå·²è¢«ä½¿ç”¨çš„å†…å­˜å’Œç©ºé—²çš„å†…å­˜ç›¸äº’äº¤é”™åœ¨ä¸€èµ·ï¼Œé‚£å°±æ²¡æœ‰åŠæ³•ç®€å•åœ°è¿›è¡ŒæŒ‡é’ˆç¢°æ’äº†ï¼Œè™šæ‹Ÿæœºå°±å¿…é¡»ç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨ï¼Œè®°å½•ä¸Šå“ªäº›å†…å­˜å—æ˜¯å¯ç”¨çš„ï¼Œåœ¨åˆ†é…çš„æ—¶å€™ä»åˆ—è¡¨ä¸­æ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºé—´åˆ’åˆ†ç»™å¯¹è±¡å®ä¾‹ï¼Œå¹¶æ›´æ–°åˆ—è¡¨ä¸Šçš„è®°å½•ï¼Œè¿™ç§åˆ†é…æ–¹å¼ç§°ä¸ºâ€œç©ºé—²åˆ—è¡¨â€ åŒæ­¥é—®é¢˜ï¼šä»…ä»…ä¿®æ”¹ä¸€ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„ä½ç½®ï¼Œåœ¨å¹¶å‘æƒ…å†µä¸‹ä¹Ÿå¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯èƒ½å‡ºç°æ­£åœ¨ç»™å¯¹è±¡Aåˆ†é…å†…å­˜ï¼ŒæŒ‡é’ˆè¿˜æ²¡æ¥å¾—åŠä¿®æ”¹ï¼Œå¯¹è±¡BåˆåŒæ—¶ä½¿ç”¨äº†åŸæ¥çš„æŒ‡é’ˆæ¥åˆ†é…å†…å­˜çš„æƒ…å†µã€‚è§£å†³æ–¹æ³•ï¼š å¯¹åˆ†é…å†…å­˜ç©ºé—´çš„åŠ¨ä½œè¿›è¡ŒåŒæ­¥å¤„ç†ï¼ˆå®é™…ä¸Šè™šæ‹Ÿæœºæ˜¯é‡‡ç”¨CASé…ä¸Šå¤±è´¥é‡è¯•çš„æ–¹å¼ä¿è¯æ›´æ–°æ“ä½œçš„åŸå­æ€§ï¼‰ æŠŠå†…å­˜åˆ†é…çš„åŠ¨ä½œæŒ‰ç…§çº¿ç¨‹åˆ’åˆ†åœ¨ä¸åŒçš„ç©ºé—´ä¹‹ä¸­è¿›è¡Œï¼Œå³æ¯ä¸ªçº¿ç¨‹åœ¨Javaå †ä¸­é¢„å…ˆåˆ†é…ä¸€å°å—å†…å­˜ï¼Œç§°ä¸ºæœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å†²ï¼ˆTLABï¼‰ï¼Œæ˜¯å¦å¯ç”¨TLABå¯ä»¥é€šè¿‡-XXï¼š+/-UseTLABå‚æ•°æ¥è®¾å®šã€‚ å°†åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´ï¼ˆä½†ä¸åŒ…æ‹¬å¯¹è±¡å¤´ï¼‰éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼ å¯¹å¯¹è±¡è¿›è¡Œå¿…è¦çš„è®¾ç½®ï¼Œä¾‹å¦‚è¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€å¦‚ä½•æ‰èƒ½æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„å“ˆå¸Œç ï¼ˆå®é™…ä¸Šå¯¹è±¡çš„å“ˆå¸Œç ä¼šå»¶ååˆ°çœŸæ­£è°ƒç”¨Object::hashCode()æ–¹æ³•æ—¶æ‰è®¡ç®—ï¼‰ã€å¯¹è±¡çš„GCåˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ã€‚ æ‰§è¡Œ ()æ–¹æ³•ï¼ˆæ„é€ å‡½æ•°ï¼‰ 1.2 å¯¹è±¡çš„å†…å­˜å¸ƒå±€åœ¨HotSpotè™šæ‹Ÿæœºé‡Œï¼Œå¯¹è±¡åœ¨å †å†…å­˜ä¸­çš„å­˜å‚¨å¸ƒå±€å¯ä»¥åˆ’åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šå¯¹è±¡å¤´ï¼ˆHeaderï¼‰ã€å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰å’Œå¯¹é½å¡«å……ï¼ˆPaddingï¼‰ã€‚ 1.2.1 å¯¹è±¡å¤´Markword:å­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚å“ˆå¸Œç ï¼ˆHashCodeï¼‰ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹IDã€åå‘æ—¶é—´æˆ³ç­‰ï¼Œè¿™éƒ¨åˆ†æ•°æ®çš„é•¿åº¦åœ¨32ä½å’Œ64ä½çš„è™šæ‹Ÿæœºï¼ˆæœªå¼€å¯å‹ç¼©æŒ‡é’ˆï¼‰ä¸­åˆ†åˆ«ä¸º32ä¸ªæ¯”ç‰¹å’Œ64ä¸ªæ¯”ç‰¹ã€‚ ç±»å‹æŒ‡é’ˆï¼Œå³å¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å‹å…ƒæ•°æ®çš„æŒ‡é’ˆï¼ŒJavaè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¯¥å¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚å¹¶ä¸æ˜¯æ‰€æœ‰çš„è™šæ‹Ÿæœºå®ç°éƒ½å¿…é¡»åœ¨å¯¹è±¡æ•°æ®ä¸Šä¿ç•™ç±»å‹æŒ‡é’ˆï¼Œè¿™éƒ¨åˆ†æ•°æ®çš„é•¿åº¦åœ¨32ä½å’Œ64ä½çš„è™šæ‹Ÿæœºï¼ˆæœªå¼€å¯å‹ç¼©æŒ‡é’ˆï¼‰ä¸­åˆ†åˆ«ä¸º32ä¸ªæ¯”ç‰¹å’Œ64ä¸ªæ¯”ç‰¹ï¼Œå¦‚æœå¼€å¯æŒ‡é’ˆå‹ç¼©ï¼Œå¯ä»¥åœ¨64ä½æœºä¸Šä¹Ÿå˜æˆ32æ¯”ç‰¹ã€‚ å¼€å¯æŒ‡é’ˆå‹ç¼©ï¼š-XX:+UseCompressedOops æ•°ç»„é•¿åº¦ï¼š å¦‚æœå¯¹è±¡æ˜¯ä¸€ä¸ªJavaæ•°ç»„ï¼Œé‚£åœ¨å¯¹è±¡å¤´ä¸­è¿˜å¿…é¡»æœ‰ä¸€å—ç”¨äºè®°å½•æ•°ç»„é•¿åº¦çš„æ•°æ®ï¼Œè¿™éƒ¨åˆ†æ•°æ®çš„é•¿åº¦æ˜¯32æ¯”ç‰¹ã€‚ 1.2.2 å®ä¾‹æ•°æ®å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ï¼Œå³æˆ‘ä»¬åœ¨ç¨‹åºä»£ç é‡Œé¢æ‰€å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µå†…å®¹ï¼Œæ— è®ºæ˜¯ä»çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„ï¼Œè¿˜æ˜¯åœ¨å­ç±»ä¸­å®šä¹‰çš„å­—æ®µéƒ½å¿…é¡»è®°å½•èµ·æ¥ã€‚ è¿™éƒ¨åˆ†çš„å­˜å‚¨é¡ºåºä¼šå—åˆ°è™šæ‹Ÿæœºåˆ†é…ç­–ç•¥å‚æ•°ï¼ˆ-XXï¼šFieldsAllocationStyleå‚æ•°ï¼‰å’Œå­—æ®µåœ¨Javaæºç ä¸­å®šä¹‰é¡ºåºçš„å½±å“ã€‚ 1.2.3 å¯¹é½å¡«å……ç”±äºHotSpotè™šæ‹Ÿæœºçš„è‡ªåŠ¨å†…å­˜ç®¡ç†ç³»ç»Ÿè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼Œå› æ­¤å¦‚æœå¯¹è±¡å®ä¾‹æ•°æ®éƒ¨åˆ†æ²¡æœ‰å¯¹é½çš„è¯ï¼Œå°±éœ€è¦é€šè¿‡å¯¹é½å¡«å……æ¥è¡¥å…¨ã€‚ 1.3 å¯¹è±¡çš„è®¿é—®å®šä½Javaç¨‹åºä¼šé€šè¿‡æ ˆä¸Šçš„referenceæ•°æ®æ¥æ“ä½œå †ä¸Šçš„å…·ä½“å¯¹è±¡ã€‚å¯¹è±¡è®¿é—®æ–¹å¼æ˜¯ç”±è™šæ‹Ÿæœºå®ç°è€Œå®šçš„ï¼Œä¸»æµçš„è®¿é—®æ–¹å¼ä¸»è¦æœ‰ä½¿ç”¨å¥æŸ„å’Œç›´æ¥æŒ‡é’ˆä¸¤ç§ï¼š å¥æŸ„è®¿é—®ï¼šå¯èƒ½ä¼šåˆ’åˆ†å‡ºä¸€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± ï¼Œreferenceä¸­å­˜å‚¨çš„å°±æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œè€Œå¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡å®ä¾‹æ•°æ®ä¸ç±»å‹æ•°æ®å„è‡ªå…·ä½“çš„åœ°å€ä¿¡æ¯ï¼Œå…¶ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š å¥½å¤„ï¼šå¥½å¤„å°±æ˜¯referenceä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šå¥æŸ„åœ°å€ï¼Œåœ¨å¯¹è±¡è¢«ç§»åŠ¨ï¼ˆåƒåœ¾æ”¶é›†æ—¶ç§»åŠ¨å¯¹è±¡æ˜¯éå¸¸æ™®éçš„è¡Œä¸ºï¼‰æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­çš„å®ä¾‹æ•°æ®æŒ‡é’ˆï¼Œè€Œreferenceæœ¬èº«ä¸éœ€è¦è¢«ä¿®æ”¹ã€‚ ç›´æ¥æŒ‡é’ˆè®¿é—®:Javaå †ä¸­å¯¹è±¡çš„å†…å­˜å¸ƒå±€å°±å¿…é¡»è€ƒè™‘å¦‚ä½•æ”¾ç½®è®¿é—®ç±»å‹æ•°æ®çš„ç›¸å…³ä¿¡æ¯ï¼Œreferenceä¸­å­˜å‚¨çš„ç›´æ¥å°±æ˜¯å¯¹è±¡åœ°å€ï¼Œå¦‚æœåªæ˜¯è®¿é—®å¯¹è±¡æœ¬èº«çš„è¯ï¼Œå°±ä¸éœ€è¦å¤šä¸€æ¬¡é—´æ¥è®¿é—®çš„å¼€é”€ï¼Œå¦‚å›¾æ‰€ç¤º: å¥½å¤„ï¼šé€Ÿåº¦æ›´å¿«ï¼Œå®ƒèŠ‚çœäº†ä¸€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€ï¼Œç”±äºå¯¹è±¡è®¿é—®åœ¨Javaä¸­éå¸¸é¢‘ç¹ï¼Œå› æ­¤è¿™ç±»å¼€é”€ç§¯å°‘æˆå¤šä¹Ÿæ˜¯ä¸€é¡¹æä¸ºå¯è§‚çš„æ‰§è¡Œæˆæœ¬ï¼ŒHotSpotæ˜¯ä½¿ç”¨çš„è¿™ç§æ–¹å¼ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jvm","slug":"jvm","permalink":"https://www.codetool.top/tags/jvm/"}]},{"title":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°02","slug":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°02","date":"2020-01-05T12:08:33.000Z","updated":"2020-04-22T09:27:27.204Z","comments":true,"path":"article/æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°02/","link":"","permalink":"https://www.codetool.top/article/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%AC%AC%E4%B8%89%E7%89%88%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B002/","excerpt":"","text":"ä»¥ä¸‹æ˜¯ç¬¬äºŒç«  Javaå†…å­˜åŒºåŸŸä¸å†…å­˜æº¢å‡ºå¼‚å¸¸çš„å†…å®¹ 1 è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ 1.1 ç¨‹åºè®¡æ•°å™¨1.1.1 ç‰¹ç‚¹ ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚ ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œçº¿ç¨‹è½®æ¢ä¹‹åé€šè¿‡ç¨‹åºè®¡æ•°å™¨ç¡®å®šè¦æ‰§è¡Œçš„æŒ‡ä»¤ä½ç½®ã€‚ ä¸å­˜åœ¨å†…å­˜æº¢å‡ºã€‚ 1.2 Javaè™šæ‹Ÿæœºæ ˆ1.2.1 ç‰¹ç‚¹ Javaè™šæ‹Ÿæœºæ ˆä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„,å®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒã€‚ è™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„çº¿ç¨‹å†…å­˜æ¨¡å‹ï¼šæ¯ä¸ªæ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™ï¼ŒJavaè™šæ‹Ÿæœºéƒ½ä¼šåŒæ­¥åˆ›å»ºä¸€ä¸ªæ ˆå¸§ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€è¿æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚æ ˆå¸§çš„å…¥æ ˆå‡ºæ ˆå¯¹åº”ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨ã€‚ å±€éƒ¨å˜é‡è¡¨å­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§Javaè™šæ‹ŸæœºåŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡å¼•ç”¨å’Œè¿”å›åœ°å€ã€‚ å±€éƒ¨å˜é‡è¡¨ä¸­çš„å­˜å‚¨ç©ºé—´ä»¥ å±€éƒ¨å˜é‡æ§½ï¼ˆSlotï¼‰ æ¥è¡¨ç¤ºï¼Œå…¶ä¸­64ä½é•¿åº¦çš„longå’Œdoubleç±»å‹çš„æ•°æ®ä¼šå ç”¨ä¸¤ä¸ªå˜é‡æ§½ï¼Œå…¶ä½™çš„æ•°æ®ç±»å‹åªå ç”¨ä¸€ä¸ªã€‚å±€éƒ¨å˜é‡è¡¨æ‰€éœ€çš„å†…å­˜ç©ºé—´åœ¨ç¼–è¯‘æœŸé—´å®Œæˆåˆ†é…ã€‚ 1.2.2 å¼‚å¸¸ å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ·±åº¦ï¼Œå°†æŠ›å‡ºStackOverflowErrorå¼‚å¸¸ï¼Œå¯èƒ½ä¼šæœ‰è¿™ä¸¤ç§æƒ…å†µï¼š æ ˆå¸§è¿‡å¤š æ ˆå¸§è¿‡å¤§ å¦‚æœJavaè™šæ‹Ÿæœºæ ˆå®¹é‡å¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œå½“æ ˆæ‰©å±•æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚ï¼ˆHotSpotè™šæ‹Ÿæœºçš„æ ˆå®¹é‡æ˜¯ä¸å¯ä»¥åŠ¨æ€æ‰©å±•çš„ï¼Œä¹Ÿä¸ä¼šå¯¼è‡´è¿™ç§å¼‚å¸¸ï¼‰ ä»£ç æ¼”ç¤ºï¼šé€šè¿‡-Xsså‚æ•°æ¥è®¾å®šæ ˆçš„å¤§å° ï¼ˆæ— é™é€’å½’å¯¼è‡´æ ˆå¸§è¿‡å¤šï¼‰ /** * VM Argsï¼š-Xss128k * @author zzm */ public class JavaVMStackSOF { private int stackLength = 1; public void stackLeak() { stackLength++; stackLeak(); } public static void main(String[] args) throws Throwable { JavaVMStackSOF oom = new JavaVMStackSOF(); try { oom.stackLeak(); } catch (Throwable e) { System.out.println(\"stack length:\" + oom.stackLength); throw e; } } } ï¼ˆæ ˆå¸§å¤ªå¤§ï¼‰ /** * @author zzm */ public class JavaVMStackSOF { private static int stackLength = 0; public static void test() { long unused1, unused2, unused3, unused4, unused5, unused6, unused7, unused8, unused9, unused10, unused11, unused12, unused13, unused14, unused15, unused16, unused17, unused18, unused19, unused20, unused21, unused22, unused23, unused24, unused25, unused26, unused27, unused28, unused29, unused30, unused31, unused32, unused33, unused34, unused35, unused36, unused37, unused38, unused39, unused40, unused41, unused42, unused43, unused44, unused45, unused46, unused47, unused48, unused49, unused50, unused51, unused52, unused53, unused54, unused55, unused56, unused57, unused58, unused59, unused60, unused61, unused62, unused63, unused64, unused65, unused66, unused67, unused68, unused69, unused70, unused71, unused72, unused73, unused74, unused75, unused76, unused77, unused78, unused79, unused80, unused81, unused82, unused83, unused84, unused85, unused86, unused87, unused88, unused89, unused90, unused91, unused92, unused93, unused94, unused95, unused96, unused97, unused98, unused99, unused100; stackLength ++; test(); unused1 = unused2 = unused3 = unused4 = unused5 = unused6 = unused7 = unused8 = unused9 = unused10 = unused11 = unused12 = unused13 = unused14 = unused15 = unused16 = unused17 = unused18 = unused19 = unused20 = unused21 = unused22 = unused23 = unused24 = unused25 = unused26 = unused27 = unused28 = unused29 = unused30 = unused31 = unused32 = unused33 = unused34 = unused35 = unused36 = unused37 = unused38 = unused39 = unused40 = unused41 = unused42 = unused43 = unused44 = unused45 = unused46 = unused47 = unused48 = unused49 = unused50 = unused51 = unused52 = unused53 = unused54 = unused55 = unused56 = unused57 = unused58 = unused59 = unused60 = unused61 = unused62 = unused63 = unused64 = unused65 = unused66 = unused67 = unused68 = unused69 = unused70 = unused71 = unused72 = unused73 = unused74 = unused75 = unused76 = unused77 = unused78 = unused79 = unused80 = unused81 = unused82 = unused83 = unused84 = unused85 = unused86 = unused87 = unused88 = unused89 = unused90 = unused91 = unused92 = unused93 = unused94 = unused95 = unused96 = unused97 = unused98 = unused99 = unused100 = 0; } public static void main(String[] args) { try { test(); }catch (Error e){ System.out.println(\"stack length:\" + stackLength); throw e; } } } 1.3 æœ¬åœ°æ–¹æ³•æ ˆæ˜¯javaè™šæ‹Ÿæœºæ ˆçš„nativeæ–¹æ³•ç‰ˆã€‚HotSpotè™šæ‹Ÿæœºä¸­å¹¶ä¸åŒºåˆ†è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆ 1.4 Javaå †1.4.1 ç‰¹ç‚¹ æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ã€‚ æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½åº”å½“åœ¨å †ä¸Šåˆ†é…ï¼Œæ—¥åå¯èƒ½å‡ºç°å€¼ç±»å‹çš„æ”¯æŒã€‚ Javaå †ä¸­å¯ä»¥åˆ’åˆ†å‡ºå¤šä¸ªçº¿ç¨‹ç§æœ‰çš„åˆ†é…ç¼“å†²åŒºï¼Œä»¥æå‡å¯¹è±¡åˆ†é…æ—¶çš„æ•ˆç‡ã€‚ Javaå †æ—¢å¯ä»¥è¢«å®ç°æˆå›ºå®šå¤§å°çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯æ‰©å±•çš„ï¼Œä¸è¿‡å½“å‰ä¸»æµçš„Javaè™šæ‹Ÿæœºéƒ½æ˜¯æŒ‰ç…§å¯æ‰©å±•æ¥å®ç°çš„ï¼ˆé€šè¿‡å‚æ•°-Xmxå’Œ-Xmsè®¾å®šï¼‰ã€‚ 1.4.2 å¼‚å¸¸å¦‚æœåœ¨Javaå †ä¸­æ²¡æœ‰å†…å­˜å®Œæˆå®ä¾‹åˆ†é…ï¼Œå¹¶ä¸”å †ä¹Ÿæ— æ³•å†æ‰©å±•æ—¶ï¼ŒJavaè™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚ ä»£ç æ¼”ç¤ºï¼š(å°†å †çš„æœ€å°å€¼-Xmså‚æ•°ä¸æœ€å¤§å€¼-Xmxå‚æ•°è®¾ç½®ä¸ºä¸€æ ·å³å¯é¿å…å †è‡ªåŠ¨æ‰©å±•ï¼Œé€šè¿‡å‚æ•°-XXï¼š+HeapDumpOnOutOf-MemoryErrorå¯ä»¥è®©è™šæ‹Ÿæœºåœ¨å‡ºç°å†…å­˜æº¢å‡ºå¼‚å¸¸çš„æ—¶å€™Dumpå‡ºå½“å‰çš„å†…å­˜å †è½¬å‚¨å¿«ç…§ä»¥ä¾¿è¿›è¡Œäº‹ååˆ†æ) /**Â· * VM Argsï¼š-Xms20m -Xmx20m -XX:+HeapDumpOnOutOfMemoryError * @author zzm */ public class HeapOOM { static class OOMObject { } public static void main(String[] args) { List&lt;OOMObject> list = new ArrayList&lt;OOMObject>(); while (true) { list.add(new OOMObject()); } } } 1.5 æ–¹æ³•åŒº1.5.1 ç‰¹ç‚¹ æ˜¯å„ä¸ªè¿›ç¨‹å…±äº«çš„ã€‚ å®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»å‹ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ç­‰æ•°æ®ã€‚ JAVA8ä»¥å‰HotSpotä½¿ç”¨æ°¸ä¹…ä»£å®ç°æ–¹æ³•åŒºï¼ŒæŠŠå †çš„åƒåœ¾å›æ”¶æœºåˆ¶å»¶ç”³è‡³æ–¹æ³•åŒºï¼ŒJAVA8å¼€å§‹ä½¿ç”¨ä½äºæœ¬åœ°å†…å­˜ä¸­çš„å…ƒç©ºé—´å®ç°æ–¹æ³•åŒºã€‚ JAVAè™šæ‹Ÿæœºè§„èŒƒä¸è¦æ±‚å®ç°åƒåœ¾å›æ”¶ã€‚ -XXï¼šMaxMetaspaceSizeï¼šè®¾ç½®å…ƒç©ºé—´æœ€å¤§å€¼ï¼Œé»˜è®¤æ˜¯-1ï¼Œå³ä¸é™åˆ¶ï¼Œæˆ–è€…è¯´åªå—é™äºæœ¬åœ°å†…å­˜å¤§å°ã€‚ -XXï¼šMetaspaceSizeï¼šæŒ‡å®šå…ƒç©ºé—´çš„åˆå§‹ç©ºé—´å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œè¾¾åˆ°è¯¥å€¼å°±ä¼šè§¦å‘åƒåœ¾æ”¶é›†è¿›è¡Œç±»å‹å¸è½½ï¼ŒåŒæ—¶æ”¶é›†å™¨ä¼šå¯¹è¯¥å€¼è¿›è¡Œè°ƒæ•´ï¼šå¦‚æœé‡Šæ”¾äº†å¤§é‡çš„ç©ºé—´ï¼Œå°±é€‚å½“é™ä½è¯¥å€¼ï¼›å¦‚æœé‡Šæ”¾äº†å¾ˆå°‘çš„ç©ºé—´ï¼Œé‚£ä¹ˆåœ¨ä¸è¶…è¿‡-XXï¼šMaxMetaspaceSizeï¼ˆå¦‚æœè®¾ç½®äº†çš„è¯ï¼‰çš„æƒ…å†µä¸‹ï¼Œé€‚å½“æé«˜è¯¥å€¼ã€‚ -XXï¼šMinMetaspaceFreeRatioï¼šä½œç”¨æ˜¯åœ¨åƒåœ¾æ”¶é›†ä¹‹åæ§åˆ¶æœ€å°çš„å…ƒç©ºé—´å‰©ä½™å®¹é‡çš„ç™¾åˆ†æ¯”ï¼Œå¯å‡å°‘å› ä¸ºå…ƒç©ºé—´ä¸è¶³å¯¼è‡´çš„åƒåœ¾æ”¶é›†çš„é¢‘ç‡ã€‚ç±»ä¼¼çš„è¿˜æœ‰-XXï¼šMax-MetaspaceFreeRatioï¼Œç”¨äºæ§åˆ¶æœ€å¤§çš„å…ƒç©ºé—´å‰©ä½™å®¹é‡çš„ç™¾åˆ†æ¯”ã€‚ 1.5.2 å¼‚å¸¸å¦‚æœæ–¹æ³•åŒºæ— æ³•æ»¡è¶³æ–°çš„å†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼Œå°†æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚(ç”±äºJAVA8åæ–¹æ³•åŒºä½äºæœ¬åœ°å†…å­˜ä¸­ï¼Œå¾ˆå°‘å‡ºç°è¿™ç§æƒ…å†µï¼Œä¸€èˆ¬æ˜¯æ¶‰åŠåˆ°åŠ¨æ€åŠ è½½è¿‡å¤šç±») 1.6 è¿è¡Œæ—¶å¸¸é‡æ±  è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚ ç±»çš„å­—èŠ‚ç ä¸­æœ‰ä¸€é¡¹ä¿¡æ¯æ˜¯å¸¸é‡æ± è¡¨ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„ç±»åã€æ–¹æ³•åã€å‚æ•°ç±»å‹ä¸å­—é¢é‡ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åå­˜æ”¾åˆ°æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ã€‚ Javaè¯­è¨€å¹¶ä¸è¦æ±‚å¸¸é‡ä¸€å®šåªæœ‰ç¼–è¯‘æœŸæ‰èƒ½äº§ç”Ÿï¼ŒStringç±»çš„internæ–¹æ³•å¯ä»¥å°†å­—ç¬¦ä¸²å¸¸é‡æ”¾è¿›å­—ç¬¦ä¸²å¸¸é‡æ± è¡¨ã€‚ 1.6.1 å¼‚å¸¸å¸¸é‡æ± æ— æ³•å†ç”³è¯·åˆ°å†…å­˜æ—¶ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚ 1.6.2 internæ–¹æ³•æœ‰æ„æ€çš„ç‚¹public class RuntimeConstantPoolOOM { public static void main(String[] args) { String str1 = new StringBuilder(\"è®¡ç®—æœº\").append(\"è½¯ä»¶\").toString(); System.out.println(str1.intern() == str1); String str2 = new StringBuilder(\"ja\").append(\"va\").toString(); System.out.println(str2.intern() == str2); } } è¿™æ®µä»£ç åœ¨JDK 6ä¸­è¿è¡Œï¼Œä¼šå¾—åˆ°ä¸¤ä¸ªfalseï¼Œè€Œåœ¨JDK 7ä¸­è¿è¡Œï¼Œä¼šå¾—åˆ°ä¸€ä¸ªtrueå’Œä¸€ä¸ªfalseã€‚äº§ç”Ÿå·®å¼‚çš„åŸå› æ˜¯ï¼Œåœ¨JDK 6ä¸­ï¼Œintern()æ–¹æ³•ä¼šæŠŠé¦–æ¬¡é‡åˆ°çš„å­—ç¬¦ä¸²å®ä¾‹å¤åˆ¶åˆ°æ°¸ä¹…ä»£çš„å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­˜å‚¨ï¼Œè¿”å›çš„ä¹Ÿæ˜¯æ°¸ä¹…ä»£é‡Œé¢è¿™ä¸ªå­—ç¬¦ä¸²å®ä¾‹çš„å¼•ç”¨ï¼Œè€Œç”±StringBuilderåˆ›å»ºçš„å­—ç¬¦ä¸²å¯¹è±¡å®ä¾‹åœ¨ Javaå †ä¸Šï¼Œæ‰€ä»¥å¿…ç„¶ä¸å¯èƒ½æ˜¯åŒä¸€ä¸ªå¼•ç”¨ï¼Œç»“æœå°†è¿”å›falseã€‚ è€ŒJDK 7ï¼ˆä»¥åŠéƒ¨åˆ†å…¶ä»–è™šæ‹Ÿæœºï¼Œä¾‹å¦‚JRockitï¼‰çš„intern()æ–¹æ³•å®ç°å°±ä¸éœ€è¦å†æ‹·è´å­—ç¬¦ä¸²çš„å®ä¾‹åˆ°æ°¸ä¹…ä»£äº†ï¼Œæ—¢ç„¶å­—ç¬¦ä¸²å¸¸é‡æ± å·²ç»ç§»åˆ°Javaå †ä¸­ï¼Œé‚£åªéœ€è¦åœ¨å¸¸é‡æ± é‡Œè®°å½•ä¸€ä¸‹é¦–æ¬¡å‡ºç°çš„å®ä¾‹å¼•ç”¨å³å¯ï¼Œå› æ­¤intern()è¿”å›çš„å¼•ç”¨å’Œç”±StringBuilderåˆ›å»ºçš„é‚£ä¸ªå­—ç¬¦ä¸²å®ä¾‹å°±æ˜¯åŒä¸€ä¸ªã€‚è€Œå¯¹str2æ¯”è¾ƒè¿”å›falseï¼Œè¿™æ˜¯å› ä¸ºâ€œjavaâ€è¿™ä¸ªå­—ç¬¦ä¸²åœ¨æ‰§è¡ŒString-Builder.toString()ä¹‹å‰å°±å·²ç»å‡ºç°è¿‡äº†ï¼ˆsun.misc.Versionç±»ä¸­åŠ è½½ï¼‰ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å·²ç»æœ‰å®ƒçš„å¼•ç”¨ï¼Œä¸ç¬¦åˆintern()æ–¹æ³•è¦æ±‚â€œé¦–æ¬¡é‡åˆ°â€çš„åŸåˆ™ï¼Œâ€œè®¡ç®—æœºè½¯ä»¶â€è¿™ä¸ªå­—ç¬¦ä¸²åˆ™æ˜¯é¦–æ¬¡å‡ºç°çš„ï¼Œå› æ­¤ç»“æœè¿”å›trueã€‚ 1.7 ç›´æ¥å†…å­˜1.7.1 ç‰¹ç‚¹ ç›´æ¥å†…å­˜å°±æ˜¯æœºå™¨çš„å†…å­˜ï¼ŒJDK1.4ä¸­çš„NIOå¯ä»¥ä½¿ç”¨Nativeå‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ åˆ†é…å›æ”¶æˆæœ¬è¾ƒé«˜ï¼Œä½†è¯»å†™æ€§èƒ½é«˜ ä¸å—JVMå†…å­˜å›æ”¶ç®¡ç† -XXï¼šMaxDirectMemorySizeæŒ‡å®šå¯ä½¿ç”¨çš„ç›´æ¥å†…å­˜å¤§å°ï¼Œå¦‚æœä¸å»æŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸Javaå †æœ€å¤§å€¼ï¼ˆç”±-XmxæŒ‡å®šï¼‰ä¸€è‡´ 1.7.2 åˆ†é…ä¸å›æ”¶ ä½¿ç”¨äº†Unsafeå¯¹è±¡å®Œæˆç›´æ¥å†…å­˜çš„åˆ†é…å›æ”¶,å¹¶ä¸”å›æ”¶éœ€è¦ä¸»åŠ¨è°ƒç”¨freeMemoryæ–¹æ³• ByteBufferçš„å®ç°ç±»å†…éƒ¨,ä½¿ç”¨äº†Cleaner(è™šå¼•ç”¨)æ¥ç›‘æµ‹ByteBufferå¯¹è±¡,ä¸€æ—¦ByteBufferå¯¹è±¡è¢«åƒåœ¾å›æ”¶,é‚£ä¹ˆå°±ä¼šç”±ReferenceHandlerçº¿ç¨‹é€šè¿‡Cleanerçš„cleanæ–¹æ³•è°ƒç”¨freeMemoryæ¥é‡Šæ”¾ç›´æ¥å†…å­˜","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jvm","slug":"jvm","permalink":"https://www.codetool.top/tags/jvm/"}]},{"title":"leetcode744-å¯»æ‰¾æ¯”ç›®æ ‡å­—æ¯å¤§çš„æœ€å°å­—æ¯","slug":"leetcode744-å¯»æ‰¾æ¯”ç›®æ ‡å­—æ¯å¤§çš„æœ€å°å­—æ¯","date":"2020-01-05T09:31:46.000Z","updated":"2020-04-22T09:27:27.192Z","comments":true,"path":"article/leetcode744-å¯»æ‰¾æ¯”ç›®æ ‡å­—æ¯å¤§çš„æœ€å°å­—æ¯/","link":"","permalink":"https://www.codetool.top/article/leetcode744-%E5%AF%BB%E6%89%BE%E6%AF%94%E7%9B%AE%E6%A0%87%E5%AD%97%E6%AF%8D%E5%A4%A7%E7%9A%84%E6%9C%80%E5%B0%8F%E5%AD%97%E6%AF%8D/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªåªåŒ…å«å°å†™å­—æ¯çš„æœ‰åºæ•°ç»„letters å’Œä¸€ä¸ªç›®æ ‡å­—æ¯ targetï¼Œå¯»æ‰¾æœ‰åºæ•°ç»„é‡Œé¢æ¯”ç›®æ ‡å­—æ¯å¤§çš„æœ€å°å­—æ¯ã€‚ æ•°ç»„é‡Œå­—æ¯çš„é¡ºåºæ˜¯å¾ªç¯çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœç›®æ ‡å­—æ¯target = &#39;z&#39; å¹¶ä¸”æœ‰åºæ•°ç»„ä¸º letters = [&#39;a&#39;, &#39;b&#39;]ï¼Œåˆ™ç­”æ¡ˆè¿”å› &#39;a&#39;ã€‚ ç¤ºä¾‹ï¼š è¾“å…¥:letters = [â€œcâ€, â€œfâ€, â€œjâ€]target = â€œaâ€è¾“å‡º: â€œcâ€è¾“å…¥:letters = [â€œcâ€, â€œfâ€, â€œjâ€]target = â€œcâ€è¾“å‡º: â€œfâ€è¾“å…¥:letters = [â€œcâ€, â€œfâ€, â€œjâ€]target = â€œdâ€è¾“å‡º: â€œfâ€è¾“å…¥:letters = [â€œcâ€, â€œfâ€, â€œjâ€]target = â€œgâ€è¾“å‡º: â€œjâ€è¾“å…¥:letters = [â€œcâ€, â€œfâ€, â€œjâ€]target = â€œjâ€è¾“å‡º: â€œcâ€è¾“å…¥:letters = [â€œcâ€, â€œfâ€, â€œjâ€]target = â€œkâ€è¾“å‡º: â€œcâ€ æ³¨: lettersé•¿åº¦èŒƒå›´åœ¨[2, 10000]åŒºé—´å†…ã€‚ letters ä»…ç”±å°å†™å­—æ¯ç»„æˆï¼Œæœ€å°‘åŒ…å«ä¸¤ä¸ªä¸åŒçš„å­—æ¯ã€‚ ç›®æ ‡å­—æ¯target æ˜¯ä¸€ä¸ªå°å†™å­—æ¯ã€‚ 2 è§£æ³•2.1 æ€æƒ³äºŒåˆ†æŸ¥æ‰¾ã€‚ 2.2 ä»£ç class Solution { public char nextGreatestLetter(char[] letters, char target) { int start = 0; int end = letters.length-1; while(start&lt;end){ int mid = start + (end-start)/2; if(letters[mid]&lt;=target) start = mid+1; else end = mid; } if(letters[start] &lt;= target) return letters[0]; return letters[start]; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode367-æœ‰æ•ˆçš„å®Œå…¨å¹³æ–¹æ•°","slug":"leetcode367-æœ‰æ•ˆçš„å®Œå…¨å¹³æ–¹æ•°","date":"2020-01-05T08:52:03.000Z","updated":"2020-04-22T09:27:27.206Z","comments":true,"path":"article/leetcode367-æœ‰æ•ˆçš„å®Œå…¨å¹³æ–¹æ•°/","link":"","permalink":"https://www.codetool.top/article/leetcode367-%E6%9C%89%E6%95%88%E7%9A%84%E5%AE%8C%E5%85%A8%E5%B9%B3%E6%96%B9%E6%95%B0/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ­£æ•´æ•° num*ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœ *num æ˜¯ä¸€ä¸ªå®Œå…¨å¹³æ–¹æ•°ï¼Œåˆ™è¿”å› Trueï¼Œå¦åˆ™è¿”å› Falseã€‚ è¯´æ˜ï¼š ä¸è¦ä½¿ç”¨ä»»ä½•å†…ç½®çš„åº“å‡½æ•°ï¼Œå¦‚ sqrtã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥: 16è¾“å‡º: True ç¤ºä¾‹2ï¼š è¾“å…¥: 14è¾“å‡º: False 2 è§£æ³•2.1 æ€æƒ³äºŒåˆ†æŸ¥æ‰¾ã€‚ç”±äºå¹³æ–¹åå¯èƒ½ä¼šè¶…å‡ºintèŒƒå›´è¦æ³¨æ„longçš„ä½¿ç”¨ã€‚ 2.2 ä»£ç class Solution { public boolean isPerfectSquare(int num) { if(num == 1) return true; long start = 1; long end = num/2; while(start&lt;=end){ long mid = start + (end-start)/2; if(mid*mid == num) return true; if(mid*mid > num) end = mid-1; else if(mid*mid &lt;num) start = mid + 1; } return false; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode50-Pow(x,n)","slug":"leetcode50-Pow-x-n","date":"2020-01-05T08:10:49.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode50-Pow-x-n/","link":"","permalink":"https://www.codetool.top/article/leetcode50-Pow-x-n/","excerpt":"","text":"1 åŸé¢˜å®ç° pow(x, n) ï¼Œå³è®¡ç®— x çš„ n æ¬¡å¹‚å‡½æ•°ã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥ï¼š 2.00000, 10è¾“å‡ºï¼š 1024.00000 ç¤ºä¾‹2ï¼š è¾“å…¥ï¼š 2.10000, 3è¾“å‡ºï¼š 9.26100 ç¤ºä¾‹3ï¼š è¾“å…¥ï¼š 2.00000, -2è¾“å‡ºï¼š 0.25000è§£é‡Šï¼š 2-2 = 1/22 = 1/4 = 0.25 2 è§£æ³•2.1 æ€æƒ³è¿™é“é¢˜ä½¿ç”¨æš´åŠ›è§£æ³•ä¼šè¶…å‡ºæ—¶é—´é™åˆ¶ã€‚ è‡ªåº•å‘ä¸Šï¼Œå¿«é€Ÿå¹‚ã€‚ç”±xn = (xn/2)2å¾—åˆ°ã€‚ 2.2 ä»£ç class Solution { public double myPow(double x, int n) { if (n == 0) return 1; if (n == 1) return x; if (n == -1) return 1 / x; double half = myPow(x, n / 2); double rest = myPow(x, n % 2); return half * half * rest; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°01","slug":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°01","date":"2020-01-04T12:54:41.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆè¯»ä¹¦ç¬”è®°01/","link":"","permalink":"https://www.codetool.top/article/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%AC%AC%E4%B8%89%E7%89%88%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B001/","excerpt":"","text":"1 åšç¬”è®°ä¹‹å‰çš„æ„Ÿè¨€è°ˆåˆ°ã€Šæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºã€‹ï¼Œåœ¨ä¸šå†…å¯å¤ªæœ‰åäº†ï¼Œæ˜¯å›½å†…çš„ä¸€ä½å¤§ç¥å†™çš„ä¸€æœ¬å…³äºjavaè™šæ‹Ÿæœºçš„ç•…é”€ä¹¦ï¼ŒåŸºæœ¬ä¸Šå¯¹javaç¨æœ‰æ·±å…¥çš„ç¨‹åºå‘˜éƒ½å¬è¯´è¿‡è¿™æœ¬ä¹¦ã€‚ä¸è¿‡é—æ†¾çš„æ˜¯ï¼Œè¿™æœ¬ä¹¦ç¬¬äºŒç‰ˆçš„åˆ›ä½œèƒŒæ™¯æ˜¯java7ï¼Œè€Œåœ¨è¿‡äº†è¿™ä¹ˆå¤šå¹´javaçš„æ›´æ–°ä¹‹åï¼Œjvmå†…éƒ¨ä¹Ÿå‘ç”Ÿäº†è®¸å¤šå˜åŒ–ï¼Œæœ€è¿‘å¬é—»è¿™æœ¬ä¹¦çš„ç¬¬ä¸‰ç‰ˆå‡ºæ¥äº†ï¼Œèµ¶ç´§ä¹°äº†ä¸€æœ¬æ¥çœ‹ã€‚ ä»¥ä¸‹æ˜¯ç¬¬ä¸€ç«  èµ°è¿›Javaçš„å†…å®¹ 2 javaæŠ€æœ¯ä½“ç³»ä»å¹¿ä¹‰ä¸Šè®²ï¼ŒKotlinã€Clojureã€JRubyã€Groovyç­‰è¿è¡ŒäºJavaè™šæ‹Ÿæœºä¸Šçš„ç¼–ç¨‹è¯­è¨€åŠå…¶ç›¸å…³çš„ç¨‹åºéƒ½å±äºJavaæŠ€æœ¯ä½“ç³»ä¸­çš„ä¸€å‘˜ã€‚å¦‚æœä»…ä»ä¼ ç»Ÿæ„ä¹‰ä¸Šæ¥çœ‹ï¼ŒJCPå®˜æ–¹æ‰€å®šä¹‰çš„JavaæŠ€æœ¯ä½“ç³»åŒ…æ‹¬äº†ä»¥ä¸‹å‡ ä¸ªç»„æˆéƒ¨åˆ†ï¼š Javaç¨‹åºè®¾è®¡è¯­è¨€ å„ç§ç¡¬ä»¶å¹³å°ä¸Šçš„Javaè™šæ‹Ÿæœºå®ç° Classæ–‡ä»¶æ ¼å¼ Javaç±»åº“API æ¥è‡ªå•†ä¸šæœºæ„å’Œå¼€æºç¤¾åŒºçš„ç¬¬ä¸‰æ–¹Javaç±»åº“ JavaEEä¸­å¯¹JavaSEä¸­çš„é’ˆå¯¹æ€§è¡¥å……ä¸€èˆ¬ä»¥javax.*ä½œä¸ºåŒ…åã€‚ 3 javaå‘å±•å² 1995å¹´5æœˆ23æ—¥ï¼ŒOakè¯­è¨€æ”¹åä¸ºJavaï¼Œå¹¶ä¸”åœ¨SunWorldå¤§ä¼šä¸Šæ­£å¼å‘å¸ƒJava 1.0ç‰ˆæœ¬ã€‚Javaè¯­è¨€ç¬¬ä¸€æ¬¡æå‡ºäº†â€œWrite Onceï¼ŒRun Anywhereâ€çš„å£å·ã€‚ JDK 1.0ç‰ˆæœ¬çš„ä»£è¡¨æŠ€æœ¯åŒ…æ‹¬ï¼šJavaè™šæ‹Ÿæœºã€Appletã€AWTç­‰ã€‚ JDK 1.1ç‰ˆçš„æŠ€æœ¯ä»£è¡¨æœ‰ï¼šJARæ–‡ä»¶æ ¼å¼ã€JDBCã€JavaBeansã€RMIç­‰ã€‚Javaè¯­è¨€çš„è¯­æ³•ä¹Ÿæœ‰äº†ä¸€å®šçš„å¢å¼ºï¼Œå¦‚å†…éƒ¨ç±»ï¼ˆInner Classï¼‰å’Œåå°„ï¼ˆReflectionï¼‰éƒ½æ˜¯åœ¨è¿™æ—¶å€™å‡ºç°çš„ã€‚ JDK 1.4åŒæ ·å¸¦æ¥äº†å¾ˆå¤šæ–°çš„æŠ€æœ¯ç‰¹æ€§ï¼Œå¦‚æ­£åˆ™è¡¨è¾¾å¼ã€å¼‚å¸¸é“¾ã€NIOã€æ—¥å¿—ç±»ã€XMLè§£æå™¨å’ŒXSLTè½¬æ¢å™¨ã€‚ JDK 5åœ¨Javaè¯­æ³•æ˜“ç”¨æ€§ä¸Šåšå‡ºäº†éå¸¸å¤§çš„æ”¹è¿›ã€‚å¦‚ï¼šè‡ªåŠ¨è£…ç®±ã€æ³›å‹ã€åŠ¨æ€æ³¨è§£ã€æšä¸¾ã€å¯å˜é•¿å‚æ•°ã€éå†å¾ªç¯ï¼ˆforeachå¾ªç¯ï¼‰ç­‰è¯­æ³•ç‰¹æ€§éƒ½æ˜¯åœ¨JDK 5ä¸­åŠ å…¥çš„ã€‚åœ¨è™šæ‹Ÿæœºå’ŒAPIå±‚é¢ä¸Šï¼Œè¿™ä¸ªç‰ˆæœ¬æ”¹è¿›äº†Javaçš„å†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼ŒJMMï¼‰ã€æä¾›äº†java.util.concurrentå¹¶å‘åŒ…ç­‰ã€‚ JDK 6çš„æ”¹è¿›åŒ…æ‹¬ï¼šæä¾›åˆæ­¥çš„åŠ¨æ€è¯­è¨€æ”¯æŒï¼ˆé€šè¿‡å†…ç½®Mozilla JavaScriptRhinoå¼•æ“å®ç°ï¼‰ã€æä¾›ç¼–è¯‘æœŸæ³¨è§£å¤„ç†å™¨å’Œå¾®å‹HTTPæœåŠ¡å™¨APIï¼Œç­‰ç­‰ã€‚åŒæ—¶ï¼Œè¿™ä¸ªç‰ˆæœ¬å¯¹Javaè™šæ‹Ÿæœºå†…éƒ¨åšäº†å¤§é‡æ”¹è¿›ï¼ŒåŒ…æ‹¬é”ä¸åŒæ­¥ã€åƒåœ¾æ”¶é›†ã€ç±»åŠ è½½ç­‰æ–¹é¢çš„å®ç°éƒ½æœ‰ç›¸å½“å¤šçš„æ”¹åŠ¨ã€‚ JDK 7åŒ…å«çš„æ”¹è¿›æœ‰ï¼šæä¾›æ–°çš„G1æ”¶é›†å™¨ã€åŠ å¼ºå¯¹éJavaè¯­è¨€çš„è°ƒç”¨æ”¯æŒï¼ˆJSR-292ï¼Œè¿™é¡¹ç‰¹æ€§åœ¨åˆ°JDK 11è¿˜æœ‰æ”¹åŠ¨ï¼‰ã€å¯å¹¶è¡Œçš„ç±»åŠ è½½æ¶æ„ç­‰ã€‚ JDK 8æä¾›äº†é‚£äº›æ›¾åœ¨JDK 7ä¸­è§„åˆ’è¿‡ï¼Œä½†æœ€ç»ˆæœªèƒ½åœ¨JDK 7ä¸­å®Œæˆçš„åŠŸèƒ½ï¼Œä¸»è¦åŒ…æ‹¬ï¼šå¯¹Lambdaè¡¨è¾¾å¼çš„æ”¯æŒï¼Œè¿™è®©Javaè¯­è¨€æ‹¥æœ‰äº†æµç•…çš„å‡½æ•°å¼è¡¨è¾¾èƒ½åŠ›ã€å†…ç½®Nashorn JavaScriptå¼•æ“çš„æ”¯æŒã€æ–°çš„æ—¶é—´ã€æ—¥æœŸAPIã€å½»åº•ç§»é™¤HotSpotçš„æ°¸ä¹…ä»£ã€‚ é™¤äº†Jigsawå¤–ï¼ŒJDK 9è¿˜å¢å¼ºäº†è‹¥å¹²å·¥å…·ï¼ˆJS Shellã€JLinkã€JHSDBç­‰ï¼‰ï¼Œæ•´é¡¿äº†HotSpotå„ä¸ªæ¨¡å—å„è‡ªä¸ºæˆ˜çš„æ—¥å¿—ç³»ç»Ÿï¼Œæ”¯æŒHTTP 2å®¢æˆ·å•APIç­‰91ä¸ªJEPã€‚ JDK 11å‘å¸ƒï¼Œè¿™æ˜¯ä¸€ä¸ªLTSç‰ˆæœ¬çš„JDKï¼ŒåŒ…å«17ä¸ªJEPï¼Œå…¶ä¸­æœ‰ZGCè¿™æ ·çš„é©å‘½æ€§çš„åƒåœ¾æ”¶é›†å™¨å‡ºç°ã€‚ JDK 12å‘å¸ƒï¼ŒåªåŒ…å«8ä¸ªJEPï¼Œå…¶ä¸­ä¸»è¦æœ‰Switchè¡¨è¾¾å¼ã€Javaå¾®æµ‹è¯•å¥—ä»¶ï¼ˆJMHï¼‰ç­‰æ–°åŠŸèƒ½ï¼Œæœ€å¼•äººæ³¨ç›®çš„ç‰¹æ€§æ— ç–‘æ˜¯åŠ å…¥äº†ç”±RedHaté¢†å¯¼å¼€å‘çš„Shen-andoahåƒåœ¾æ”¶é›†å™¨ã€‚ 4 javaè™šæ‹Ÿæœºå®¶æ—è™šæ‹Ÿæœºå§‹ç¥–ï¼šSun Classic/Exact VM 5 javaæŠ€æœ¯çš„æœªæ¥5.1 æ— è¯­è¨€å€¾å‘2018å¹´4æœˆï¼ŒOracle Labsæ–°å…¬å¼€äº†ä¸€é¡¹é»‘ç§‘æŠ€ï¼šGraal VM Graal VMè¢«å®˜æ–¹ç§°ä¸ºâ€œUniversal VMâ€å’Œâ€œPolyglot VMâ€ï¼Œè¿™æ˜¯ä¸€ä¸ªåœ¨HotSpotè™šæ‹ŸæœºåŸºç¡€ä¸Šå¢å¼ºè€Œæˆçš„è·¨è¯­è¨€å…¨æ ˆè™šæ‹Ÿæœºï¼Œå¯ä»¥ä½œä¸ºâ€œä»»ä½•è¯­è¨€â€çš„è¿è¡Œå¹³å°ä½¿ç”¨ï¼Œè¿™é‡Œâ€œä»»ä½•è¯­è¨€â€åŒ…æ‹¬äº†Javaã€Scalaã€Groovyã€Kotlinç­‰åŸºäºJavaè™šæ‹Ÿæœºä¹‹ä¸Šçš„è¯­è¨€ï¼Œè¿˜åŒ…æ‹¬äº†Cã€C++ã€Rustç­‰åŸºäºLLVMçš„è¯­è¨€ï¼ŒåŒæ—¶æ”¯æŒå…¶ä»–åƒJavaScriptã€Rubyã€Pythonå’ŒRè¯­è¨€ç­‰ã€‚Graal VMå¯ä»¥æ— é¢å¤–å¼€é”€åœ°æ··åˆä½¿ç”¨è¿™äº›ç¼–ç¨‹è¯­è¨€ï¼Œæ”¯æŒä¸åŒè¯­è¨€ä¸­æ··ç”¨å¯¹æ–¹çš„æ¥å£å’Œå¯¹è±¡ï¼Œä¹Ÿèƒ½å¤Ÿæ”¯æŒè¿™äº›è¯­è¨€ä½¿ç”¨å·²ç»ç¼–å†™å¥½çš„æœ¬åœ°åº“æ–‡ä»¶ã€‚ 5.2 æ–°ä¸€ä»£å³æ—¶ç¼–è¯‘å™¨HotSpotè™šæ‹Ÿæœºä¸­å«æœ‰ä¸¤ä¸ªå³æ—¶ç¼–è¯‘å™¨ï¼Œåˆ†åˆ«æ˜¯ç¼–è¯‘è€—æ—¶çŸ­ä½†è¾“å‡ºä»£ç ä¼˜åŒ–ç¨‹åº¦è¾ƒä½çš„å®¢æˆ·ç«¯ç¼–è¯‘å™¨ï¼ˆç®€ç§°ä¸ºC1ï¼‰ä»¥åŠç¼–è¯‘è€—æ—¶é•¿ä½†è¾“å‡ºä»£ç ä¼˜åŒ–è´¨é‡ä¹Ÿæ›´é«˜çš„æœåŠ¡ç«¯ç¼–è¯‘å™¨ï¼ˆç®€ç§°ä¸ºC2ï¼‰ï¼Œé€šå¸¸å®ƒä»¬ä¼šåœ¨åˆ†å±‚ç¼–è¯‘æœºåˆ¶ä¸‹ä¸è§£é‡Šå™¨äº’ç›¸é…åˆæ¥å…±åŒæ„æˆHotSpotè™šæ‹Ÿæœºçš„æ‰§è¡Œå­ç³»ç»Ÿ è‡ªJDK 10èµ·ï¼ŒHotSpotä¸­åˆåŠ å…¥äº†ä¸€ä¸ªå…¨æ–°çš„å³æ—¶ç¼–è¯‘å™¨ï¼šGraalç¼–è¯‘å™¨ï¼Œçœ‹åå­—å°±å¯ä»¥è”æƒ³åˆ°å®ƒæ˜¯æ¥è‡ªäºå‰ä¸€èŠ‚æåˆ°çš„Graal VMã€‚Graalç¼–è¯‘å™¨æ˜¯ä»¥C2ç¼–è¯‘å™¨æ›¿ä»£è€…çš„èº«ä»½ç™»åœºçš„ã€‚C2çš„å†å²å·²ç»éå¸¸é•¿äº†ï¼Œå¯ä»¥è¿½æº¯åˆ°Cliff Clickå¤§ç¥è¯»åšå£«æœŸé—´çš„ä½œå“ï¼Œè¿™ä¸ªç”±C++å†™æˆçš„ç¼–è¯‘å™¨å°½ç®¡ç›®å‰ä¾ç„¶æ•ˆæœæ‹”ç¾¤ï¼Œä½†å·²ç»å¤æ‚åˆ°è¿Cliff Clickæœ¬äººéƒ½ä¸æ„¿æ„ç»§ç»­ç»´æŠ¤çš„ç¨‹åº¦ã€‚è€ŒGraalç¼–è¯‘å™¨æœ¬èº«å°±æ˜¯ç”±Javaè¯­è¨€å†™æˆï¼Œå®ç°æ—¶åˆåˆ»æ„ä¸C2é‡‡ç”¨äº†åŒä¸€ç§åä¸ºâ€œSea-of-Nodesâ€çš„é«˜çº§ä¸­é—´è¡¨ç¤ºï¼ˆHigh IRï¼‰å½¢å¼ï¼Œä½¿å…¶èƒ½å¤Ÿæ›´å®¹æ˜“å€Ÿé‰´C2çš„ä¼˜ç‚¹ã€‚Graalç¼–è¯‘å™¨æ¯”C2ç¼–è¯‘å™¨æ™šäº†è¶³è¶³äºŒåå¹´é¢ä¸–ï¼Œæœ‰ç€æå…¶å……æ²›çš„åå‘ä¼˜åŠ¿ï¼Œåœ¨ä¿æŒè¾“å‡ºç›¸è¿‘è´¨é‡çš„ç¼–è¯‘ä»£ç çš„åŒæ—¶ï¼Œå¼€å‘æ•ˆç‡å’Œæ‰©å±•æ€§ä¸Šéƒ½è¦æ˜¾è‘—ä¼˜äºC2ç¼–è¯‘å™¨ï¼Œè¿™å†³å®šäº†C2ç¼–è¯‘å™¨ä¸­ä¼˜ç§€çš„ä»£ç ä¼˜åŒ–æŠ€æœ¯å¯ä»¥è½»æ˜“åœ°ç§»æ¤åˆ°Graalç¼–è¯‘å™¨ä¸Šï¼Œä½†æ˜¯åè¿‡æ¥Graalç¼–è¯‘å™¨ä¸­è¡Œä¹‹æœ‰æ•ˆçš„ä¼˜åŒ–åœ¨ C2ç¼–è¯‘å™¨é‡Œå®ç°èµ·æ¥åˆ™å¼‚å¸¸è‰°éš¾ã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒGraalçš„ç¼–è¯‘æ•ˆæœçŸ­çŸ­å‡ å¹´é—´è¿…é€Ÿè¿½å¹³äº†C2ï¼Œç”šè‡³æŸäº›æµ‹è¯•é¡¹ä¸­å¼€å§‹é€æ¸åè¶…C2ç¼–è¯‘å™¨ã€‚Graalèƒ½å¤Ÿåšæ¯”C2æ›´åŠ å¤æ‚çš„ä¼˜åŒ–ï¼Œå¦‚â€œéƒ¨åˆ†é€ƒé€¸åˆ†æâ€ï¼ˆPartial Escape Analysisï¼‰ï¼Œä¹Ÿæ‹¥æœ‰æ¯”C2æ›´å®¹æ˜“ä½¿ç”¨æ¿€è¿›é¢„æµ‹æ€§ä¼˜åŒ–ï¼ˆAggressive Speculative Optimizationï¼‰çš„ç­–ç•¥ï¼Œæ”¯æŒè‡ªå®šä¹‰çš„é¢„æµ‹æ€§å‡è®¾ç­‰ã€‚ 5.3 å‘Nativeè¿ˆè¿›å¾®æœåŠ¡æ¶æ„çš„å…´èµ·ä¿ƒè¿›javaæå‰ç¼–è¯‘æŠ€æœ¯çš„å‘å±• Substrate VMæ˜¯åœ¨Graal VM 0.20ç‰ˆæœ¬é‡Œæ–°å‡ºç°çš„ä¸€ä¸ªæå°å‹çš„è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒ…æ‹¬äº†ç‹¬ç«‹çš„å¼‚å¸¸å¤„ç†ã€åŒæ­¥è°ƒåº¦ã€çº¿ç¨‹ç®¡ç†ã€å†…å­˜ç®¡ç†ï¼ˆåƒåœ¾æ”¶é›†ï¼‰å’ŒJNIè®¿é—®ç­‰ç»„ä»¶ï¼Œç›®æ ‡æ˜¯ä»£æ›¿HotSpotç”¨æ¥æ”¯æŒæå‰ç¼–è¯‘åçš„ç¨‹åºæ‰§è¡Œã€‚å®ƒè¿˜åŒ…å«äº†ä¸€ä¸ªæœ¬åœ°é•œåƒçš„æ„é€ å™¨ï¼ˆNative Image Generatorï¼‰ï¼Œç”¨äºä¸ºç”¨æˆ·ç¨‹åºå»ºç«‹åŸºäºSubstrate VM çš„æœ¬åœ°è¿è¡Œæ—¶é•œåƒã€‚è¿™ä¸ªæ„é€ å™¨é‡‡ç”¨æŒ‡é’ˆåˆ†æï¼ˆPoints-To Analysisï¼‰æŠ€æœ¯ï¼Œä»ç”¨æˆ·æä¾›çš„ç¨‹åºå…¥å£å‡ºå‘ï¼Œæœç´¢æ‰€æœ‰å¯è¾¾çš„ä»£ç ã€‚åœ¨æœç´¢çš„åŒæ—¶ï¼Œå®ƒè¿˜å°†æ‰§è¡Œåˆå§‹åŒ–ä»£ç ï¼Œå¹¶åœ¨æœ€ç»ˆç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œå°†å·²åˆå§‹åŒ–çš„å †ä¿å­˜è‡³ä¸€ä¸ªå †å¿«ç…§ä¹‹ä¸­ã€‚è¿™æ ·ä¸€æ¥ï¼ŒSubstrate VMå°±å¯ä»¥ç›´æ¥ä»ç›®æ ‡ç¨‹åºå¼€å§‹è¿è¡Œï¼Œè€Œæ— é¡»é‡å¤è¿›è¡ŒJavaè™šæ‹Ÿæœºçš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚ä½†ç›¸åº”åœ°ï¼ŒåŸç†ä¸Šä¹Ÿå†³å®šäº†Substrate VMå¿…é¡»è¦æ±‚ç›®æ ‡ç¨‹åºæ˜¯å®Œå…¨å°é—­çš„ï¼Œå³ä¸èƒ½åŠ¨æ€åŠ è½½å…¶ä»–ç¼–è¯‘å™¨ä¸å¯çŸ¥çš„ä»£ç å’Œç±»åº“ã€‚åŸºäºè¿™ä¸ªå‡è®¾ï¼ŒSubstrate VMæ‰èƒ½æ¢ç´¢æ•´ä¸ªç¼–è¯‘ç©ºé—´ï¼Œå¹¶é€šè¿‡é™æ€åˆ†ææ¨ç®—å‡ºæ‰€æœ‰è™šæ–¹æ³•è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•ã€‚ 5.4 çµæ´»çš„èƒ–å­ç»è¿‡ä¸€ç³»åˆ—çš„é‡æ„ä¸å¼€æ”¾ï¼ŒHotSpotè™šæ‹Ÿæœºé€æ¸ä»æ—¶é—´çš„ä¾µèš€ä¸­æŒ£è„±å‡ºæ¥ï¼Œè™½ç„¶ä»£ç å¤æ‚åº¦è¿˜åœ¨å¢é•¿ï¼Œä½“ç§¯ä»åœ¨å˜å¤§ï¼Œä½†å…¶æ¶æ„å¹¶æœªè€æœ½ï¼Œè€Œæ˜¯æ‹¥æœ‰äº†è¶Šæ¥è¶Šå¤šçš„å¼€æ”¾æ€§å’Œæ‰©å±•æ€§ï¼Œä½¿å¾—HotSpotæˆä¸ºä¸€ä¸ªèƒ½å¤Ÿè”åŠ¨å¤–éƒ¨åŠŸèƒ½ï¼Œèƒ½å¤Ÿåº”å¯¹å„ç§åœºæ™¯ï¼Œèƒ½å¤Ÿå­¦ä¼šåå…«èˆ¬æ­¦è‰ºçš„èº«æ‰‹çµæ´»æ•æ·çš„â€œèƒ–å­â€ã€‚ 5.5 è¯­è¨€è¯­æ³•æŒç»­å¢å¼ºéšç€Javaæ¯åŠå¹´æ›´æ–°ä¸€æ¬¡çš„èŠ‚å¥ï¼Œæ–°ç‰ˆæœ¬çš„Javaä¸­ä¼šå‡ºç°è¶Šæ¥è¶Šå¤šå…¶ä»–è¯­è¨€é‡Œå·²æœ‰çš„ä¼˜ç§€ç‰¹æ€§ï¼Œç›¸ä¿¡åšé‡‡ä¼—é•¿çš„Javaï¼Œè¿˜èƒ½ç»§ç»­ä¿æŒç°åœ¨çš„å‹ƒå‹ƒç”Ÿæœºç›¸å½“é•¿æ—¶é—´ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jvm","slug":"jvm","permalink":"https://www.codetool.top/tags/jvm/"}]},{"title":"leetcode658-æ‰¾åˆ°Kä¸ªæœ€æ¥è¿‘çš„å…ƒç´ ","slug":"leetcode658-æ‰¾åˆ°Kä¸ªæœ€æ¥è¿‘çš„å…ƒç´ ","date":"2020-01-04T12:08:07.000Z","updated":"2020-04-22T09:27:27.160Z","comments":true,"path":"article/leetcode658-æ‰¾åˆ°Kä¸ªæœ€æ¥è¿‘çš„å…ƒç´ /","link":"","permalink":"https://www.codetool.top/article/leetcode658-%E6%89%BE%E5%88%B0K%E4%B8%AA%E6%9C%80%E6%8E%A5%E8%BF%91%E7%9A%84%E5%85%83%E7%B4%A0/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ’åºå¥½çš„æ•°ç»„ï¼Œä¸¤ä¸ªæ•´æ•° k å’Œ xï¼Œä»æ•°ç»„ä¸­æ‰¾åˆ°æœ€é è¿‘ xï¼ˆä¸¤æ•°ä¹‹å·®æœ€å°ï¼‰çš„ k ä¸ªæ•°ã€‚è¿”å›çš„ç»“æœå¿…é¡»è¦æ˜¯æŒ‰å‡åºæ’å¥½çš„ã€‚å¦‚æœæœ‰ä¸¤ä¸ªæ•°ä¸ x çš„å·®å€¼ä¸€æ ·ï¼Œä¼˜å…ˆé€‰æ‹©æ•°å€¼è¾ƒå°çš„é‚£ä¸ªæ•°ã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥: [1,2,3,4,5], k=4, x=3è¾“å‡º: [1,2,3,4] ç¤ºä¾‹2ï¼š è¾“å…¥: [1,2,3,4,5], k=4, x=-1è¾“å‡º: [1,2,3,4] è¯´æ˜: k çš„å€¼ä¸ºæ­£æ•°ï¼Œä¸”æ€»æ˜¯å°äºç»™å®šæ’åºæ•°ç»„çš„é•¿åº¦ã€‚ æ•°ç»„ä¸ä¸ºç©ºï¼Œä¸”é•¿åº¦ä¸è¶…è¿‡ 104 æ•°ç»„é‡Œçš„æ¯ä¸ªå…ƒç´ ä¸ x çš„ç»å¯¹å€¼ä¸è¶…è¿‡ 104 2 è§£æ³•2.1 æ€æƒ³ æŒ‰ç…§å·®å€¼æ’åº åŒæŒ‡é’ˆ 2.2 ä»£ç  æ’åº public List&lt;Integer> findClosestElements(List&lt;Integer> arr, int k, int x) { Collections.sort(arr, (a,b) -> a == b ? a - b : Math.abs(a-x) - Math.abs(b-x)); arr = arr.subList(0, k); Collections.sort(arr); return arr; } åŒæŒ‡é’ˆï¼ˆä½œè€…ï¼šliweiwei1419ï¼‰ public class Solution { public List&lt;Integer> findClosestElements(int[] arr, int k, int x) { int size = arr.length; int left = 0; int right = size - 1; int removeNums = size - k; while (removeNums > 0) { if (x - arr[left] &lt;= arr[right] - x) { right--; } else { left++; } removeNums--; } List&lt;Integer> res = new ArrayList&lt;>(); for (int i = left; i &lt; left + k; i++) { res.add(arr[i]); } return res; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode34--åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®","slug":"leetcode34-åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®","date":"2020-01-03T09:58:04.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode34-åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®/","link":"","permalink":"https://www.codetool.top/article/leetcode34-%E5%9C%A8%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E6%9F%A5%E6%89%BE%E5%85%83%E7%B4%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%92%8C%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E4%BD%8D%E7%BD%AE/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæŒ‰ç…§å‡åºæ’åˆ—çš„æ•´æ•°æ•°ç»„ numsï¼Œå’Œä¸€ä¸ªç›®æ ‡å€¼ targetã€‚æ‰¾å‡ºç»™å®šç›®æ ‡å€¼åœ¨æ•°ç»„ä¸­çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚ ä½ çš„ç®—æ³•æ—¶é—´å¤æ‚åº¦å¿…é¡»æ˜¯ O(log n) çº§åˆ«ã€‚ å¦‚æœæ•°ç»„ä¸­ä¸å­˜åœ¨ç›®æ ‡å€¼ï¼Œè¿”å› [-1, -1]ã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥ï¼š nums = [5,7,7,8,8,10], target = 8è¾“å‡ºï¼š [3,4] ç¤ºä¾‹2ï¼š è¾“å…¥ï¼š nums = [5,7,7,8,8,10], target = 6è¾“å‡ºï¼š [-1,-1] 2 è§£æ³•2.1 æ€æƒ³äºŒåˆ†æŸ¥æ‰¾ï¼Œæ‰¾åˆ°ä¸€ä¸ªç›®æ ‡å€¼æ—¶å‘ä¸¤è¾¹ç»§ç»­æŸ¥æ‰¾æœ€åˆå’Œæœ€æœ«å‡ºç°çš„åœ°æ–¹ã€‚ 2.2 ä»£ç class Solution { public int[] searchRange(int[] nums, int target) { int[] pos = new int[2]; int start = 0; int end = nums.length - 1; if(end == -1) return new int[]{-1,-1}; int mid = start + (end-start)/2; while(nums[mid]!=target &amp;&amp;start&lt;=end){ mid = start + (end-start)/2; if(nums[mid]&lt;target) start = mid + 1; else if(nums[mid] > target) end = mid -1; } if(nums[mid]!=target) return new int[]{-1,-1}; int mid_cache = mid; int end_cache = end; end = mid; while(start&lt;end){ mid = start + (end-start)/2; if(nums[mid] == target) end = mid; else if(nums[mid] &lt; target) start = mid+1; } pos[0] = start; start = mid_cache; end = end_cache; while(start&lt;end){ mid = start + (end-start+1)/2; if(nums[mid] == target) start = mid; else if(nums[mid] > target) end = mid-1; } pos[1] = end; return pos; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode153-å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼","slug":"leetcode153-å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼","date":"2020-01-03T07:59:23.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode153-å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼/","link":"","permalink":"https://www.codetool.top/article/leetcode153-%E5%AF%BB%E6%89%BE%E6%97%8B%E8%BD%AC%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E6%9C%80%E5%B0%8F%E5%80%BC/","excerpt":"","text":"1 åŸé¢˜å‡è®¾æŒ‰ç…§å‡åºæ’åºçš„æ•°ç»„åœ¨é¢„å…ˆæœªçŸ¥çš„æŸä¸ªç‚¹ä¸Šè¿›è¡Œäº†æ—‹è½¬ã€‚ ( ä¾‹å¦‚ï¼Œæ•°ç»„ [0,1,2,4,5,6,7] å¯èƒ½å˜ä¸º [4,5,6,7,0,1,2] )ã€‚ æœç´¢ä¸€ä¸ªç»™å®šçš„ç›®æ ‡å€¼ï¼Œå¦‚æœæ•°ç»„ä¸­å­˜åœ¨è¿™ä¸ªç›®æ ‡å€¼ï¼Œåˆ™è¿”å›å®ƒçš„ç´¢å¼•ï¼Œå¦åˆ™è¿”å› -1 ã€‚ è¯·æ‰¾å‡ºå…¶ä¸­æœ€å°çš„å…ƒç´ ã€‚ ä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸­ä¸å­˜åœ¨é‡å¤å…ƒç´ ã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥ï¼š [3,4,5,1,2]è¾“å‡ºï¼š 1 ç¤ºä¾‹2ï¼š è¾“å…¥ï¼š [4,5,6,7,0,1,2]è¾“å‡ºï¼š 0 2 è§£æ³•2.1 æ€æƒ³ çº¿æ€§æŸ¥æ‰¾ äºŒåˆ†æŸ¥æ‰¾ï¼Œæ‰¾å‡ºæ—‹è½¬ç‚¹ 2.2 ä»£ç  çº¿æ€§æŸ¥æ‰¾ class Solution { public int findMin(int[] nums) { int min = nums[0]; for(int i:nums){ if(i&lt;min){ min=i; break; } } return min; } } äºŒåˆ†æŸ¥æ‰¾ class Solution { public int findMin(int[] nums) { int head = nums[0]; int start = 0; int end = nums.length-1; while(start&lt;end){ int mid = start + (end-start)/2; if(nums[mid] >= head) start = mid+1; else if(nums[mid] &lt; head) end = mid; } if(nums[start]>head) return head; return nums[start]; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode162-å¯»æ‰¾å³°å€¼","slug":"leetcode162-å¯»æ‰¾å³°å€¼","date":"2020-01-03T07:22:04.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode162-å¯»æ‰¾å³°å€¼/","link":"","permalink":"https://www.codetool.top/article/leetcode162-%E5%AF%BB%E6%89%BE%E5%B3%B0%E5%80%BC/","excerpt":"","text":"1 åŸé¢˜å³°å€¼å…ƒç´ æ˜¯æŒ‡å…¶å€¼å¤§äºå·¦å³ç›¸é‚»å€¼çš„å…ƒç´ ã€‚ ç»™å®šä¸€ä¸ªè¾“å…¥æ•°ç»„ numsï¼Œå…¶ä¸­ nums[i] â‰  nums[i+1]ï¼Œæ‰¾åˆ°å³°å€¼å…ƒç´ å¹¶è¿”å›å…¶ç´¢å¼•ã€‚ æ•°ç»„å¯èƒ½åŒ…å«å¤šä¸ªå³°å€¼ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿”å›ä»»ä½•ä¸€ä¸ªå³°å€¼æ‰€åœ¨ä½ç½®å³å¯ã€‚ ä½ å¯ä»¥å‡è®¾ nums[-1] = nums[n] = -âˆã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥: nums = [1,2,3,1]è¾“å‡º: 2è§£é‡Š: 3 æ˜¯å³°å€¼å…ƒç´ ï¼Œä½ çš„å‡½æ•°åº”è¯¥è¿”å›å…¶ç´¢å¼• 2ã€‚ ç¤ºä¾‹2ï¼š è¾“å…¥: nums = [1,2,1,3,5,6,4]è¾“å‡º: 1 æˆ– 5è§£é‡Š: ä½ çš„å‡½æ•°å¯ä»¥è¿”å›ç´¢å¼• 1ï¼Œå…¶å³°å€¼å…ƒç´ ä¸º 2ï¼› æˆ–è€…è¿”å›ç´¢å¼• 5ï¼Œ å…¶å³°å€¼å…ƒç´ ä¸º 6ã€‚ 2 è§£æ³•2.1 æ€æƒ³ çº¿æ€§æŸ¥æ‰¾ï¼Œä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œç¬¬ä¸€ä¸ªæ‰“ç ´å•è°ƒé€’å¢çš„å…ƒç´ ã€‚ äºŒåˆ†æŸ¥æ‰¾ï¼Œçœ‹ä¸­é—´å…ƒç´ å€¼çš„çš„è¶‹åŠ¿ï¼ˆæ–œç‡ï¼‰ 2.2 ä»£ç  çº¿æ€§æŸ¥æ‰¾ class Solution { public int findPeakElement(int[] nums) { int n = 1; int cache = nums[0]; while(n&lt;nums.length &amp;&amp;nums[n]>=cache){ cache = nums[n]; n++; } return n-1; } } äºŒåˆ†æŸ¥æ‰¾ï¼ˆæ¥æºï¼šleetcodeå®˜æ–¹ï¼‰ public class Solution { public int findPeakElement(int[] nums) { int l = 0, r = nums.length - 1; while (l &lt; r) { int mid = (l + r) / 2; if (nums[mid] > nums[mid + 1]) r = mid; else l = mid + 1; } return l; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode278-ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬","slug":"leetcode278-ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬","date":"2020-01-02T13:17:40.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode278-ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬/","link":"","permalink":"https://www.codetool.top/article/leetcode278-%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%94%99%E8%AF%AF%E7%9A%84%E7%89%88%E6%9C%AC/","excerpt":"","text":"1 åŸé¢˜ä½ æ˜¯äº§å“ç»ç†ï¼Œç›®å‰æ­£åœ¨å¸¦é¢†ä¸€ä¸ªå›¢é˜Ÿå¼€å‘æ–°çš„äº§å“ã€‚ä¸å¹¸çš„æ˜¯ï¼Œä½ çš„äº§å“çš„æœ€æ–°ç‰ˆæœ¬æ²¡æœ‰é€šè¿‡è´¨é‡æ£€æµ‹ã€‚ç”±äºæ¯ä¸ªç‰ˆæœ¬éƒ½æ˜¯åŸºäºä¹‹å‰çš„ç‰ˆæœ¬å¼€å‘çš„ï¼Œæ‰€ä»¥é”™è¯¯çš„ç‰ˆæœ¬ä¹‹åçš„æ‰€æœ‰ç‰ˆæœ¬éƒ½æ˜¯é”™çš„ã€‚ å‡è®¾ä½ æœ‰ n ä¸ªç‰ˆæœ¬ [1, 2, ..., n]ï¼Œä½ æƒ³æ‰¾å‡ºå¯¼è‡´ä¹‹åæ‰€æœ‰ç‰ˆæœ¬å‡ºé”™çš„ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬ã€‚ ä½ å¯ä»¥é€šè¿‡è°ƒç”¨ bool isBadVersion(version) æ¥å£æ¥åˆ¤æ–­ç‰ˆæœ¬å· version æ˜¯å¦åœ¨å•å…ƒæµ‹è¯•ä¸­å‡ºé”™ã€‚å®ç°ä¸€ä¸ªå‡½æ•°æ¥æŸ¥æ‰¾ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬ã€‚ä½ åº”è¯¥å°½é‡å‡å°‘å¯¹è°ƒç”¨ API çš„æ¬¡æ•°ã€‚ ç¤ºä¾‹ï¼š ç»™å®š n = 5ï¼Œå¹¶ä¸” version = 4 æ˜¯ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬ã€‚è°ƒç”¨ isBadVersion(3) -&gt; falseè°ƒç”¨ isBadVersion(5) -&gt; trueè°ƒç”¨ isBadVersion(4) -&gt; trueæ‰€ä»¥ï¼Œ4 æ˜¯ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬ã€‚ 2 è§£æ³•2.1 æ€æƒ³äºŒåˆ†æŸ¥æ‰¾ã€‚ 2.2 ä»£ç /* The isBadVersion API is defined in the parent class VersionControl. boolean isBadVersion(int version); */ public class Solution extends VersionControl { public int firstBadVersion(int n) { int start = 1; int end = n; int mid; while(start&lt;end){ mid = start + (end-start)/2; if(isBadVersion(mid)) end = mid; else start = mid+1; } return start; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode33-æœç´¢æ—‹è½¬æ’åºæ•°ç»„","slug":"leetcode33-æœç´¢æ—‹è½¬æ’åºæ•°ç»„","date":"2020-01-01T14:03:54.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode33-æœç´¢æ—‹è½¬æ’åºæ•°ç»„/","link":"","permalink":"https://www.codetool.top/article/leetcode33-%E6%90%9C%E7%B4%A2%E6%97%8B%E8%BD%AC%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84/","excerpt":"","text":"1 åŸé¢˜å‡è®¾æŒ‰ç…§å‡åºæ’åºçš„æ•°ç»„åœ¨é¢„å…ˆæœªçŸ¥çš„æŸä¸ªç‚¹ä¸Šè¿›è¡Œäº†æ—‹è½¬ã€‚ ( ä¾‹å¦‚ï¼Œæ•°ç»„ [0,1,2,4,5,6,7] å¯èƒ½å˜ä¸º [4,5,6,7,0,1,2] )ã€‚ æœç´¢ä¸€ä¸ªç»™å®šçš„ç›®æ ‡å€¼ï¼Œå¦‚æœæ•°ç»„ä¸­å­˜åœ¨è¿™ä¸ªç›®æ ‡å€¼ï¼Œåˆ™è¿”å›å®ƒçš„ç´¢å¼•ï¼Œå¦åˆ™è¿”å› -1 ã€‚ ä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸­ä¸å­˜åœ¨é‡å¤çš„å…ƒç´ ã€‚ ä½ çš„ç®—æ³•æ—¶é—´å¤æ‚åº¦å¿…é¡»æ˜¯ O(log n) çº§åˆ«ã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥ï¼š nums = [4,5,6,7,0,1,2], target = 0è¾“å‡ºï¼š 4 ç¤ºä¾‹2ï¼š è¾“å…¥ï¼š nums = [4,5,6,7,0,1,2], target = 3è¾“å‡ºï¼š -1 2 è§£æ³•2.1 æ€æƒ³äºŒåˆ†æŸ¥æ‰¾ï¼Œéœ€è¦æ³¨æ„ã€åŒºåˆ†ä¸€äº›æƒ…å†µã€‚ 2.2 ä»£ç class Solution { public int search(int[] nums, int target) { if(nums.length == 0) return -1; int head = nums[0]; if(target == head) return 0; int start = 0; int end = nums.length-1; int mid = 0; while(start&lt;=end){ mid = start + (end-start)/2; if(nums[mid] == target) return mid; if(nums[mid]>target){//midæ¯”targetå¤§ if(target>head){//targetåœ¨å·¦è¾¹ if(nums[mid]>=head) end = mid-1;//midåœ¨å·¦è¾¹ else start = mid+1; }else{//targetåœ¨å³è¾¹ if(nums[mid]>=head) start = mid+1;//midåœ¨å·¦è¾¹ else end = mid-1; } }else if(nums[mid]&lt;target){//midæ¯”targetå° if(target>head){//targetåœ¨å·¦è¾¹ if(nums[mid]>=head) start = mid+1;//midåœ¨å·¦è¾¹ else end = mid-1; }else{//targetåœ¨å³è¾¹ start = mid+1; } } } return -1; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"2019å¹´çš„æœ€åä¸€å¤©ï¼Œæˆ‘æƒ³è¯´äº›ä»€ä¹ˆ","slug":"2019å¹´çš„æœ€åä¸€å¤©ï¼Œæˆ‘æƒ³è¯´äº›ä»€ä¹ˆ","date":"2019-12-31T11:22:37.000Z","updated":"2020-01-01T10:39:44.969Z","comments":true,"path":"article/2019å¹´çš„æœ€åä¸€å¤©ï¼Œæˆ‘æƒ³è¯´äº›ä»€ä¹ˆ/","link":"","permalink":"https://www.codetool.top/article/2019%E5%B9%B4%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E5%A4%A9%EF%BC%8C%E6%88%91%E6%83%B3%E8%AF%B4%E4%BA%9B%E4%BB%80%E4%B9%88/","excerpt":"","text":"é¦–å…ˆï¼Œç¥æ‰€æœ‰æœ‹å‹ä»¬æ–°å¹´å¿«ä¹â™¥ æ—¶é—´è¿‡å¾—æŒºå¿«çš„ï¼Œæˆ‘æ˜¯2018å¹´8æœˆ19æ—¥åˆ›ç«‹çš„åšå®¢ï¼Œåˆ°ç°åœ¨ä¹Ÿæœ‰ä¸€å¹´å¤šçš„æ—¶é—´äº†ã€‚ çœ‹ç€å¹´é¾„éšå¹´ä»½çš„å¢é•¿æ˜¯ä¸€ä»¶å¾ˆå¥‡å¦™çš„äº‹æƒ…ï¼Œæˆ‘æ˜¯00å¹´å‡ºç”Ÿçš„ï¼Œè¿™æ„å‘³ç€ï¼Œæˆ‘æ°¸è¿œä¸éœ€è¦è¿›è¡Œå¹´é¾„çš„è®¡ç®—ï¼Œåˆ°äº†2020å¹´ä¹Ÿå°±20å²äº†ã€‚å¦‚æœæ˜¯åå¹´å‰çš„æˆ‘ï¼Œå¯¹å¤§å­¦é˜¶æ®µä¸æ˜¯å¾ˆäº†è§£ï¼Œæˆ‘ä¼šè§‰å¾—20å²çœŸå¥½å•Šï¼Œå¤§æ¦‚å·²ç»å¼€å§‹å·¥ä½œï¼Œä¸å†å¿å—æ¯å¤©ç¹é‡çš„ä½œä¸šä»»åŠ¡äº†ã€‚ å¯æ˜¯å®é™…ä¸Šï¼Œæˆ‘å¯¹20å²æ„Ÿåˆ°æŒºææƒ§çš„ã€‚è¿™ç§ææƒ§ï¼Œæˆ–è®¸æ˜¯æ¥æºäºä¸çŸ¥å¤§å››çš„æˆ‘ä¼šæœ‰ä»€ä¹ˆå»å‘ï¼Œä¸çŸ¥é“æˆ‘æ˜¯å¦æœ‰èƒ½åŠ›å»èƒœä»»ä¸€ä»½å·¥ä½œï¼ŒæœªçŸ¥æ°¸è¿œæ˜¯éª‡äººçš„ã€‚åˆæˆ–è®¸æ˜¯ï¼Œæˆ‘æ˜ç™½è‡ªå·±å·²ç»ä¸ä¼šå†å¹´è½»äº†ã€‚ æœ€è¿‘æœ‰ä¸€å¥è¯åœ¨ç½‘ä¸Šå¾ˆç«ï¼šâ€œæˆ‘çš„é’æ˜¥åˆå›æ¥äº†â€ã€‚å¤§æ¦‚æ¶‰è¶³ä¸åŒåœˆå­çš„äººæœ‰ä¸åŒçš„ç†è§£ï¼Œå¯¹äºçƒ­çˆ±lolçš„æˆ‘æ¥è¯´ï¼Œå¦‚æœæœ‰é‚£ä¹ˆä¸€ç¬é—´ä¼šè®©æˆ‘æ„Ÿåˆ°â€œæˆ‘çš„é’æ˜¥åˆå›æ¥äº†â€ï¼Œå¤§æ¦‚å°±æ˜¯æœ€è¿‘å¾·ç›è¥¿äºšæ¯å†³èµ›ä¸Šâ€œçŒªç‹—å¤§æˆ˜â€çš„é‚£åœºBO5ã€‚è¿™ä¹ˆè¯´æˆ–è®¸æœ‰ç‚¹ç¦»è°±ï¼Œæ¯•ç«Ÿæˆ‘åˆå…¥LOLå‘æ˜¯åœ¨é«˜ä¸€é‚£ä¸€å¹´ï¼Œé‚£ä¸€å¹´æ˜¯è‹±é›„è”ç›Ÿçš„S5ï¼Œæ˜¯EDGçš„è¾‰ç…Œå¹´ä»½ã€‚æ‰€ä»¥å½“çœ‹åˆ°è“æ–¹å’Œçº¢æ–¹åˆ†åˆ«ä¸ºEDGå’ŒRNGçš„æ—¶å€™ï¼Œæˆ‘ä¸ç¦æœ‰äº›ææƒšï¼Œä¼¼ä¹å›åˆ°äº†S5çš„LPLï¼Œæ­£ç››çš„EDGå’Œç²‰ä¸ä¼—å¤šçš„RNGå¼€æˆ˜ä¸€åˆ»ã€‚ ä½†â€œé’æ˜¥å›æ¥â€çš„æ—¶åˆ»æ°¸è¿œæ˜¯é‚£ä¹ˆçŸ­æš‚ï¼Œæ€»æ˜¯æœ‰é‚£ä¹ˆå¤šä¸€ç¬æé†’æˆ‘â€œé’æ˜¥å°†ä¸å†å›æ¥äº†â€ï¼Œä½œä¸ºä¸€ä¸ªçŒªä»”ï¼Œå‚é•¿ä»Šå¹´ä¼‘èµ›æœŸä»ç°å½¹é€‰æ‰‹ä½ä¸Šæ·¡å‡ºè½¬ä¸ºä¸»æ•™ç»ƒä»¤æˆ‘é¢‡ä¸ºæ„Ÿæ…¨ï¼Œå‚é•¿çš„è‹±é›„è”ç›Ÿä¹‹è·¯æ¯”æˆ‘é•¿å¾—å¤šã€‚ä»–æ˜¯LPLçš„ä¸€å·é€‰æ‰‹ï¼Œä¹Ÿæ˜¯EDGçš„çµé­‚äººç‰©ï¼ŒS5åˆ°S9ï¼Œä¸ä»…æ˜¯é€‰æ‰‹ä¸€æ‰¹ä¸€æ‰¹åœ°æ›´æ›¿ï¼Œæˆ˜é˜Ÿä¹Ÿå‡ºç°äº†è®¸å¤šæˆ‘ä¸è®¤è¯†çš„æˆ˜é˜Ÿã€‚ç„¶è€Œæˆ‘æ°¸è¿œçŸ¥é“EDGçš„å‚é•¿ä¼šä¸€ç›´åœ¨åœºï¼Œä¸€ç›´æ‰“ä¸‹å»ï¼Œå› ä¸ºä»–è¦è¿½é€ä»–çš„ç”µç«æ¢¦ã€‚â€œä¸€ä»£äººç»ˆå°†è€å»ï¼Œä½†æ€»æœ‰äººæ­£å¹´è½»â€ã€‚ æˆ‘é«˜äºŒé«˜ä¸‰æ—¶å°¤å…¶å–œæ¬¢ç©è‹±é›„è”ç›Ÿï¼Œç°åœ¨å´ä¹Ÿä¸æ€ä¹ˆæ¥è§¦äº†ï¼Œä¸»è¦æ˜¯æ²¡äººä¸€èµ·ç©ï¼Œå°‘äº†å¾ˆå¤šä¹è¶£ï¼Œå¶å°”å’Œé«˜ä¸­åŒå­¦ä¸€èµ·äº”é»‘ï¼Œåˆèƒ½å›å¿†èµ·å½“å¹´ç½‘å§äº”è¿åçš„æ¿€æƒ…ï¼Œåªæ˜¯æŠ€æœ¯å·²å¤§ä¸å¦‚å‰ã€‚æˆ‘ç‰¹åˆ«å–œæ¬¢æˆ‘çš„é«˜ä¸­æ—¶æœŸï¼Œè™½ç„¶é‚£æ—¶çš„æˆ‘å¹¶ä¸è½»æ¾ï¼Œå´å¸¦æœ‰æŠ¹ä¸å»çš„é’æ˜¥æ°”æ¯ã€‚ å›åˆ°ç°åœ¨ï¼Œæˆ‘å¸¸å¸¸æƒ³ï¼Œå½“åˆåˆ›ç«‹è¿™ä¸ªåšå®¢çš„åˆå¿ƒæ˜¯ä»€ä¹ˆå‘¢ã€‚æˆ‘è®°å¾—ï¼Œä»å…¥è¿™ä¸ªä¸“ä¸šèµ·ï¼Œæˆ‘å¾ˆæ—©å°±å¼€å§‹æ£é¼“æœåŠ¡å™¨äº†ï¼Œä»ä½¿ç”¨ç®€å•çš„wordpresså¼€å§‹æ­å»ºç½‘ç«™ï¼Œé‚£æ—¶ä¸ºäº†é¿å…å¤‡æ¡ˆä½¿ç”¨äº†å›½å¤–çš„æœåŠ¡å™¨ï¼Œå› æ­¤ç½‘é€Ÿä¹Ÿéå¸¸çš„æ…¢ï¼Œæˆ‘å´ä¹æ­¤ä¸å½¼åœ°ç ”ç©¶ç€ä¸€ä¸ªä¸ªçš„å¯ä»¥ç”¨æœåŠ¡å™¨å®ç°çš„æœ‰è¶£çš„åŠŸèƒ½ã€‚2018å¹´8æœˆ19æ—¥ï¼Œæˆ‘å†³å®šæä¸€ä¸ªä¸ªäººçš„ç¼–ç¨‹ç›¸å…³çš„åšå®¢ï¼Œæˆ‘æƒ³ï¼Œé‚£æ—¶çš„æˆ‘åªæ˜¯ä¸‰åˆ†é’Ÿçƒ­åº¦ï¼Œå¯¼è‡´å†™äº†å‡ ç¯‡åšå®¢ä¹‹åå°±å¾ˆä¹…ä¸€æ®µæ—¶é—´æ²¡æœ‰æ›´æ–°ã€‚2019å¹´11æœˆ8æ—¥ï¼Œæˆ‘ä»åŒå­¦å¤„å¬è¯´äº†Hexoè¿™ä¸ªæ¡†æ¶ï¼Œå‡ºäºæŠŠæˆ‘çš„åšå®¢ç»§ç»­æä¸‹å»çš„å¿µå¤´ï¼Œæˆ‘ä½¿ç”¨hexoé‡æ–°æ­å»ºäº†è¿™ä¸ªç½‘ç«™ï¼Œç°åœ¨ä¸€ç›´ä¿æŒä¸€å¤©å¤§äºä¸€æ›´çš„å†™æ–‡ç« é€Ÿåº¦ï¼Œæˆ‘è§‰å¾—è¿™æ—¢æ˜¯å¯¹æˆ‘å­¦ä¹ æˆæœçš„ä¸€ç§æ€»ç»“ï¼Œä¹Ÿæ˜¯ç£ä¿ƒæˆ‘å­¦ä¹ çš„ä¸€ç§æ–¹å¼ã€‚ çœ‹ç€æˆ‘çš„åšå®¢çš„æ–‡ç« æ•°ç›®è¶Šæ¥è¶Šå¤šï¼Œæˆ‘æ˜¯éå¸¸æ¬£å–œçš„ï¼Œç„¶è€Œæˆ‘çŸ¥é“æˆ‘è¿˜æœ‰è®¸å¤šçš„çŸ¥è¯†éœ€è¦å­¦ä¹ ï¼Œå¤§å››çš„é€¼è¿‘æ—¶å¸¸è®©æˆ‘èµ¶åˆ°å‹åŠ›ï¼Œæˆ‘æ²¡æœ‰è¿‡è€ƒç ”çš„æ‰“ç®—ï¼Œæ‰€ä»¥æ˜å¹´çš„ç§‹æ‹›æˆ‘åªèƒ½æ”¾æ‰‹ä¸€æï¼Œå¯æ˜¯æˆ‘éå¸¸æ‹…å¿ƒæˆ‘çš„èƒ½åŠ›ä¸å¤Ÿï¼Œéšç€æœ€è¿‘äº†è§£javaæ¶æ„è¶Šå¤šï¼Œè¶Šæ„Ÿåˆ°è‡ªå·±æ‰€å­¦çš„é‚£ç‚¹çŸ¥è¯†çš„åŒ®ä¹ç¨‹åº¦ï¼Œæ·±æ·±æ„Ÿåˆ°äº†è‡ªå·±çš„æ— åŠ›æ„Ÿã€‚ ä»Šå¤©å°±è¯´åˆ°è¿™ï¼Œå†™çš„æŒºæ‚çš„ï¼Œä¸ç®¡æ€æ ·ï¼Œ2020å†²å†²å†²ï¼ï¼ï¼","categories":[{"name":"æ—¥å¸¸/éšç¬”","slug":"æ—¥å¸¸-éšç¬”","permalink":"https://www.codetool.top/categories/%E6%97%A5%E5%B8%B8-%E9%9A%8F%E7%AC%94/"}],"tags":[{"name":"æ—¥å¸¸","slug":"æ—¥å¸¸","permalink":"https://www.codetool.top/tags/%E6%97%A5%E5%B8%B8/"}]},{"title":"leetcode374-çŒœæ•°å­—å¤§å°","slug":"leetcode374-çŒœæ•°å­—å¤§å°","date":"2019-12-31T11:17:27.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode374-çŒœæ•°å­—å¤§å°/","link":"","permalink":"https://www.codetool.top/article/leetcode374-%E7%8C%9C%E6%95%B0%E5%AD%97%E5%A4%A7%E5%B0%8F/","excerpt":"","text":"1 åŸé¢˜æˆ‘ä»¬æ­£åœ¨ç©ä¸€ä¸ªçŒœæ•°å­—æ¸¸æˆã€‚ æ¸¸æˆè§„åˆ™å¦‚ä¸‹ï¼šæˆ‘ä» 1 åˆ° n é€‰æ‹©ä¸€ä¸ªæ•°å­—ã€‚ ä½ éœ€è¦çŒœæˆ‘é€‰æ‹©äº†å“ªä¸ªæ•°å­—ã€‚æ¯æ¬¡ä½ çŒœé”™äº†ï¼Œæˆ‘ä¼šå‘Šè¯‰ä½ è¿™ä¸ªæ•°å­—æ˜¯å¤§äº†è¿˜æ˜¯å°äº†ã€‚ä½ è°ƒç”¨ä¸€ä¸ªé¢„å…ˆå®šä¹‰å¥½çš„æ¥å£ guess(int num)ï¼Œå®ƒä¼šè¿”å› 3 ä¸ªå¯èƒ½çš„ç»“æœï¼ˆ-1ï¼Œ1 æˆ– 0ï¼‰ï¼š -1 : æˆ‘çš„æ•°å­—æ¯”è¾ƒå° 1 : æˆ‘çš„æ•°å­—æ¯”è¾ƒå¤§ 0 : æ­å–œï¼ä½ çŒœå¯¹äº†ï¼ ç¤ºä¾‹ : è¾“å…¥ï¼š n = 10, pick = 6è¾“å‡ºï¼š 6 2 è§£æ³•2.1 æ€æƒ³äºŒåˆ†æŸ¥æ‰¾ï¼Œæ³¨æ„æ±‚ä¸­ä½æ•°çš„å…¬å¼ä¸è¦ç”¨(start+end)/2å®¹æ˜“æº¢å‡ºï¼Œåº”è¯¥ç”¨start+(end-start)/2 2.2 ä»£ç /* The guess API is defined in the parent class GuessGame. @param num, your guess @return -1 if my number is lower, 1 if my number is higher, otherwise return 0 int guess(int num); */ public class Solution extends GuessGame { public int guessNumber(int n) { int start = 1; int end = n; int mid = 1; while(start&lt;end){ mid = start+(end-start)/2; if(guess(mid)==0) return mid; if(guess(mid)==-1) end = mid-1; else if(guess(mid)==1) start = mid+1; } return start; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode69-xçš„å¹³æ–¹æ ¹","slug":"leetcode69-xçš„å¹³æ–¹æ ¹","date":"2019-12-30T11:58:11.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode69-xçš„å¹³æ–¹æ ¹/","link":"","permalink":"https://www.codetool.top/article/leetcode69-x%E7%9A%84%E5%B9%B3%E6%96%B9%E6%A0%B9/","excerpt":"","text":"1 åŸé¢˜å®ç° int sqrt(int x) å‡½æ•°ã€‚ è®¡ç®—å¹¶è¿”å› x çš„å¹³æ–¹æ ¹ï¼Œå…¶ä¸­ x æ˜¯éè´Ÿæ•´æ•°ã€‚ ç”±äºè¿”å›ç±»å‹æ˜¯æ•´æ•°ï¼Œç»“æœåªä¿ç•™æ•´æ•°çš„éƒ¨åˆ†ï¼Œå°æ•°éƒ¨åˆ†å°†è¢«èˆå»ã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥ï¼š 4è¾“å‡ºï¼š 2 ç¤ºä¾‹2ï¼š è¾“å…¥ï¼š 8è¾“å‡ºï¼š 2è¯´æ˜ï¼š 8 çš„å¹³æ–¹æ ¹æ˜¯ 2.82842â€¦, ç”±äºè¿”å›ç±»å‹æ˜¯æ•´æ•°ï¼Œå°æ•°éƒ¨åˆ†å°†è¢«èˆå»ã€‚ 2 è§£æ³•2.1 æ€æƒ³äºŒåˆ†æ³• 2.2 ä»£ç class Solution { public int mySqrt(int x) { //ä¸ºäº†é˜²æ­¢end * end è¶…è¿‡intèŒƒå›´ï¼Œè¿™é‡Œç»Ÿä¸€ä½¿ç”¨ä½¿ç”¨long long longx = x; long start = 0; long end = x/2; long mid; while(start&lt;=end){ mid = (end+start)/2; if(mid*mid == longx) return (int)mid; if(mid*mid &lt; longx) { start = mid + 1; if(start*start>longx) return (int)mid; } else if(mid*mid > longx) { end = mid - 1; if(end*end&lt;longx) return (int)end; } } return (int)start; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode704-äºŒåˆ†æŸ¥æ‰¾","slug":"leetcode704-äºŒåˆ†æŸ¥æ‰¾","date":"2019-12-29T12:04:34.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode704-äºŒåˆ†æŸ¥æ‰¾/","link":"","permalink":"https://www.codetool.top/article/leetcode704-%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ª n ä¸ªå…ƒç´ æœ‰åºçš„ï¼ˆå‡åºï¼‰æ•´å‹æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ target ï¼Œå†™ä¸€ä¸ªå‡½æ•°æœç´¢ nums ä¸­çš„ targetï¼Œå¦‚æœç›®æ ‡å€¼å­˜åœ¨è¿”å›ä¸‹æ ‡ï¼Œå¦åˆ™è¿”å› -1ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š nums = [-1,0,3,5,9,12], target = 9è¾“å‡ºï¼š 4è§£é‡Šï¼š 9 å‡ºç°åœ¨ nums ä¸­å¹¶ä¸”ä¸‹æ ‡ä¸º 4 ç¤ºä¾‹2: è¾“å…¥ï¼š nums = [-1,0,3,5,9,12], target = 2è¾“å‡ºï¼š -1è§£é‡Šï¼š 2 ä¸å­˜åœ¨ nums ä¸­å› æ­¤è¿”å› -1 æç¤ºï¼š ä½ å¯ä»¥å‡è®¾ nums ä¸­çš„æ‰€æœ‰å…ƒç´ æ˜¯ä¸é‡å¤çš„ã€‚ n å°†åœ¨ [1, 10000]ä¹‹é—´ã€‚ nums çš„æ¯ä¸ªå…ƒç´ éƒ½å°†åœ¨ [-9999, 9999]ä¹‹é—´ã€‚ 2 è§£æ³•2.1 æ€æƒ³äºŒåˆ†æŸ¥æ‰¾æ€æƒ³ 2.2 ä»£ç class Solution { public int search(int[] nums, int target) { int start = 0; int end = nums.length-1; while(start&lt;end){ int middle = start + (end-start)/2; if(nums[middle]==target) return middle; if(nums[middle]>target) end = middle-1; else if(nums[middle]&lt;target) start = middle+1; } if(nums[start]==target) return start; return -1; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode380-å¸¸æ•°æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´ ","slug":"leetcode380-å¸¸æ•°æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´ ","date":"2019-12-28T14:44:41.000Z","updated":"2019-12-31T11:57:39.433Z","comments":true,"path":"article/leetcode380-å¸¸æ•°æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´ /","link":"","permalink":"https://www.codetool.top/article/leetcode380-%E5%B8%B8%E6%95%B0%E6%97%B6%E9%97%B4%E6%8F%92%E5%85%A5%E3%80%81%E5%88%A0%E9%99%A4%E5%92%8C%E8%8E%B7%E5%8F%96%E9%9A%8F%E6%9C%BA%E5%85%83%E7%B4%A0/","excerpt":"","text":"1 åŸé¢˜è®¾è®¡ä¸€ä¸ªæ”¯æŒåœ¨å¹³å‡ æ—¶é—´å¤æ‚åº¦ O(1) ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œçš„æ•°æ®ç»“æ„ã€‚ insert(val)ï¼šå½“å…ƒç´  val ä¸å­˜åœ¨æ—¶ï¼Œå‘é›†åˆä¸­æ’å…¥è¯¥é¡¹ã€‚ remove(val)ï¼šå…ƒç´  val å­˜åœ¨æ—¶ï¼Œä»é›†åˆä¸­ç§»é™¤è¯¥é¡¹ã€‚ getRandomï¼šéšæœºè¿”å›ç°æœ‰é›†åˆä¸­çš„ä¸€é¡¹ã€‚æ¯ä¸ªå…ƒç´ åº”è¯¥æœ‰ç›¸åŒçš„æ¦‚ç‡è¢«è¿”å›ã€‚ ç¤ºä¾‹ï¼š // åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„é›†åˆã€‚RandomizedSet randomSet = new RandomizedSet();// å‘é›†åˆä¸­æ’å…¥ 1 ã€‚è¿”å› true è¡¨ç¤º 1 è¢«æˆåŠŸåœ°æ’å…¥ã€‚randomSet.insert(1);// è¿”å› false ï¼Œè¡¨ç¤ºé›†åˆä¸­ä¸å­˜åœ¨ 2 ã€‚randomSet.remove(2);// å‘é›†åˆä¸­æ’å…¥ 2 ã€‚è¿”å› true ã€‚é›†åˆç°åœ¨åŒ…å« [1,2] ã€‚randomSet.insert(2);// getRandom åº”éšæœºè¿”å› 1 æˆ– 2 ã€‚randomSet.getRandom();// ä»é›†åˆä¸­ç§»é™¤ 1 ï¼Œè¿”å› true ã€‚é›†åˆç°åœ¨åŒ…å« [2] ã€‚randomSet.remove(1);// 2 å·²åœ¨é›†åˆä¸­ï¼Œæ‰€ä»¥è¿”å› false ã€‚randomSet.insert(2);// ç”±äº 2 æ˜¯é›†åˆä¸­å”¯ä¸€çš„æ•°å­—ï¼ŒgetRandom æ€»æ˜¯è¿”å› 2 ã€‚randomSet.getRandom(); 2 è§£æ³•2.1 æ€æƒ³ åˆå§‹æƒ³æ³• å“ˆå¸Œè¡¨çš„æ’å…¥åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ï¼Œè·å–çš„æ—¶å€™å¯ä»¥é€šè¿‡EntrySetã€‚æ‰€ä»¥è¿™é“é¢˜æ˜¯ä¸èƒ½ç”¨HashSetçš„ã€‚ è¿™æ ·è™½ç„¶è·å–éšæœºå…ƒç´ çš„æ—¶å€™æ—¶é—´å¤æ‚åº¦æœ€é«˜å¯èƒ½æ˜¯O(n)ï¼Œä½†ä»æ¯”éå†ä¸€éSetè½¬ArrayListå¥½å¾ˆå¤šã€‚ æ­£ç¡®è§£æ³• å“ˆå¸Œè¡¨æ’å…¥å’Œåˆ é™¤éƒ½æ˜¯O(1)ï¼Œè€Œé¡ºåºè¡¨éšæœºè®¿é—®åˆ™æ˜¯O(1)ï¼Œå¯ä»¥ä½¿ç”¨ArrayListæ¥å­˜å‚¨æ‰€æœ‰çš„æ•°æ®ã€‚ä½†æ˜¯å¿…é¡»è§£å†³ArrayListåˆ é™¤å…ƒç´ çš„O(n)é—®é¢˜ã€‚ äºæ˜¯å¯ä»¥ï¼š åœ¨å“ˆå¸Œè¡¨ä¸­ç”¨value-indexæ¥è®°å½•å€¼å’Œåœ¨listä¸­çš„ä¸‹æ ‡çš„å¯¹åº”å…³ç³»ï¼Œå¦‚å›¾æ‰€ç¤º å½“åˆ é™¤å…ƒç´ æ—¶ï¼Œsizeå‡ä¸€ï¼Œç”¨listä¸­æœ€åé‚£ä¸ªå…ƒç´ æ›¿æ¢è¦åˆ é™¤çš„é‚£ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”å°†å“ˆå¸Œè¡¨ä¸­çš„å¯¹åº”å…³ç³»æ”¹è¿‡æ¥ï¼ˆç”¨è¦åˆ é™¤çš„å…ƒç´ çš„indexæ›¿æ¢listä¸­æœ€åé‚£ä¸ªå…ƒç´ å¯¹åº”çš„indexï¼‰ï¼š æ­¤æ—¶è‹¥è¦éšæœºè®¿é—®å…ƒç´ ï¼Œåªéœ€è·å–listä¸­å‰3(size)ä¸ªå…ƒç´ ä¸­çš„ä¸€ä¸ªã€‚ é‚£ä¹ˆå¦‚æœéœ€è¦ç»§ç»­æ’å…¥å…ƒç´ ï¼Œåªéœ€ä»listä¸­ä¸‹æ ‡ä¸º3(size)å¤„æ›¿æ¢æ‰åé¢é‚£ä¸ªå…ƒç´ æˆ–æ˜¯åœ¨åé¢é‚£ä¸ªå…ƒç´ ä¹‹å‰æ’å…¥ï¼ˆè¿™é‡Œå¦‚æœç”¨æ’å…¥æ˜¯ä½¿ç”¨add(index,value)æ–¹æ³•ï¼Œä¸ªäººè§‰å¾—æ¯”èµ·setä¼šå¢åŠ æ—¶é—´å¤æ‚åº¦ï¼Œå› ä¸ºä½¿ç”¨addåé¢çš„å…ƒç´ éƒ½éœ€è¦å‘åç§»åŠ¨ï¼Œè™½ç„¶jdkæºç ä¸­ä½¿ç”¨äº†System.arraycopyå³å†…å­˜æ‹·è´æ¥ä¼˜åŒ–ï¼Œä½†æ˜¯ä¹Ÿæ¯”ç›´æ¥æ›¿æ¢çš„æ—¶é—´å¤æ‚åº¦æ›´é«˜ï¼‰ï¼š å¦‚æœä¸æ˜¯æ›¿æ¢å…ƒç´ è€Œæ˜¯addæ“ä½œï¼Œè¿™é‡Œä¼šå˜æˆ1-4-2-8-4ã€‚ 2.2 ä»£ç  åˆå§‹æƒ³æ³• class RandomizedSet { Object none = new Object(); HashMap&lt;Integer,Object> map; Random random; /** Initialize your data structure here. */ public RandomizedSet() { map = new HashMap&lt;>(); random = new Random(); } /** Inserts a value to the set. Returns true if the set did not already contain the specified element. */ public boolean insert(int val) { if(map.containsKey(val)) return false; map.put(val,none); return true; } /** Removes a value from the set. Returns true if the set contained the specified element. */ public boolean remove(int val) { if(!map.containsKey(val)) return false; map.remove(val); return true; } /** Get a random element from the set. */ public int getRandom() { int ran = random.nextInt(map.size()); int n = 0; for(Map.Entry&lt;Integer,Object> i:map.entrySet()){ if(n==ran) return i.getKey(); n++; } return 0; } } /** * Your RandomizedSet object will be instantiated and called as such: * RandomizedSet obj = new RandomizedSet(); * boolean param_1 = obj.insert(val); * boolean param_2 = obj.remove(val); * int param_3 = obj.getRandom(); */ æ­£ç¡®è§£æ³•ï¼ˆæ¥æºï¼šleetcodeç”¨æˆ·ï¼Œæ·»åŠ å…ƒç´ æ—¶æ˜¯ç›´æ¥æ’å…¥ï¼‰ class RandomizedSet { Map&lt;Integer,Integer> map; // å­˜æ”¾å€¼å’Œåœ¨ list çš„ä¸‹æ ‡ä½ç½®çš„æ˜ å°„ List&lt;Integer> list; // å­˜æ”¾è¦æ’å…¥æ•°æ®çš„ç»“æ„ int size; // æ•°æ®çš„é•¿åº¦ /** Initialize your data structure here. */ public RandomizedSet() { map = new HashMap&lt;>(); list = new ArrayList&lt;>(); size = 0; } /** Inserts a value to the set. Returns true if the set did not already contain the specified element. */ public boolean insert(int val) { if(map.containsKey(val)) return false; else{ // æ’å…¥æ•°æ®ï¼Œå¹¶æ›´æ–° map çš„æ˜ å°„åå°†é•¿åº¦åŠ ä¸€ list.add(size,val); map.put(val,size++); return true; } } /** Removes a value from the set. Returns true if the set contained the specified element. */ public boolean remove(int val) { if(!map.containsKey(val)) return false; else if( size == 0 ){ map.remove(val);} else{ // å–åˆ° list æœ«å°¾çš„æ•°æ® int tailKey = list.get(size-1); // ç„¶åå°†è¦åŸå…ˆ map ä¸­å¾— val-index æ˜ å°„æ”¹ä¸º tailKey-index map.put(tailKey,map.get(val)); // åœ¨ map ä¸­å–å¾— val åœ¨ list çš„ä½ç½®ï¼Œç„¶åæ ¹æ®è¿™ä¸ªä½ç½®ç”¨æœ«å°¾å…ƒç´  tailKey æ›¿ä»£ list.set(map.get(val),tailKey); // åœ¨ map ä¸­åˆ é™¤ val çš„æ˜ å°„ map.remove(val); size--; } return true; } /** Get a random element from the set. */ public int getRandom() { Random rand = new Random(); // rand.nextInt(size) äº§ç”Ÿçš„æ˜¯ 0 åˆ° sizeï¼ˆä¸åŒ…æ‹¬ sizeï¼‰ çš„æ•°æ® return list.get(rand.nextInt(size)); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"}]},{"title":"leetcode347-å‰Kä¸ªé«˜é¢‘å…ƒç´ ","slug":"leetcode347-å‰Kä¸ªé«˜é¢‘å…ƒç´ ","date":"2019-12-28T13:39:09.000Z","updated":"2020-02-20T14:55:21.053Z","comments":true,"path":"article/leetcode347-å‰Kä¸ªé«˜é¢‘å…ƒç´ /","link":"","permalink":"https://www.codetool.top/article/leetcode347-%E5%89%8DK%E4%B8%AA%E9%AB%98%E9%A2%91%E5%85%83%E7%B4%A0/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªéç©ºçš„æ•´æ•°æ•°ç»„ï¼Œè¿”å›å…¶ä¸­å‡ºç°é¢‘ç‡å‰ k é«˜çš„å…ƒç´ ã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥ï¼š nums = [1,1,1,2,2,3], k = 2è¾“å‡ºï¼š [1,2] ç¤ºä¾‹2ï¼š è¾“å…¥ï¼š nums = [1], k = 1è¾“å‡ºï¼š [1] è¯´æ˜: ä½ å¯ä»¥å‡è®¾ç»™å®šçš„ k æ€»æ˜¯åˆç†çš„ï¼Œä¸” 1 â‰¤ k â‰¤ æ•°ç»„ä¸­ä¸ç›¸åŒçš„å…ƒç´ çš„ä¸ªæ•°ã€‚ ä½ çš„ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å¿…é¡»ä¼˜äº O(n log n) , n æ˜¯æ•°ç»„çš„å¤§å°ã€‚ 2 è§£æ³•2.1 æ€æƒ³å¯ä»¥ç”¨å“ˆå¸Œè¡¨è®°å½•ä¸‹å‡ºç°çš„æ¬¡æ•°ï¼Œç„¶åå°†å“ˆå¸Œè¡¨æŒ‰å€¼æ’åºã€‚ï¼ˆè·å–entryListç”¨Collectionsæ¥æ’åºï¼‰ 2.2 ä»£ç class Solution { public List&lt;Integer> topKFrequent(int[] nums, int k) { Map&lt;Integer,Integer> map = new HashMap&lt;>(); List&lt;Integer> list = new ArrayList&lt;>(); for(int i:nums){ map.put(i,map.getOrDefault(i,0)+1); } List&lt;Map.Entry&lt;Integer,Integer>> entryList = new ArrayList&lt;>(map.entrySet()); entryList.sort((entry1, entry2) -> entry2.getValue() - entry1.getValue()); int n = 0; for(Map.Entry&lt;Integer,Integer> i:entryList){ if(n>=k) break; list.add(i.getKey()); n ++; } return list; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode454-å››æ•°ç›¸åŠ II","slug":"leetcode454-å››æ•°ç›¸åŠ II","date":"2019-12-27T12:45:57.000Z","updated":"2020-02-20T14:55:21.053Z","comments":true,"path":"article/leetcode454-å››æ•°ç›¸åŠ II/","link":"","permalink":"https://www.codetool.top/article/leetcode454-%E5%9B%9B%E6%95%B0%E7%9B%B8%E5%8A%A0II/","excerpt":"","text":"1 åŸé¢˜ç»™å®šå››ä¸ªåŒ…å«æ•´æ•°çš„æ•°ç»„åˆ—è¡¨ A , B , C , D ,è®¡ç®—æœ‰å¤šå°‘ä¸ªå…ƒç»„ (i, j, k, l) ï¼Œä½¿å¾— A[i] + B[j] + C[k] + D[l] = 0ã€‚ ä¸ºäº†ä½¿é—®é¢˜ç®€å•åŒ–ï¼Œæ‰€æœ‰çš„ A, B, C, D å…·æœ‰ç›¸åŒçš„é•¿åº¦ Nï¼Œä¸” 0 â‰¤ N â‰¤ 500 ã€‚æ‰€æœ‰æ•´æ•°çš„èŒƒå›´åœ¨ -228 åˆ° 228 - 1 ä¹‹é—´ï¼Œæœ€ç»ˆç»“æœä¸ä¼šè¶…è¿‡ 231 - 1 ã€‚ ä¾‹å¦‚: è¾“å…¥ï¼šA = [ 1, 2]B = [-2,-1]C = [-1, 2]D = [ 0, 2] è¾“å‡ºï¼š2 è§£é‡Š:ä¸¤ä¸ªå…ƒç»„å¦‚ä¸‹: (0, 0, 0, 1) -&gt; A[0] + B[0] + C[0] + D[1] = 1 + (-2) + (-1) + 2 = 0 (1, 1, 0, 0) -&gt; A[1] + B[1] + C[0] + D[0] = 2 + (-1) + (-1) + 0 = 0 2 è§£æ³•2.1 æ€æƒ³ æš´åŠ›ï¼ˆè¶…å‡ºæ—¶é—´é™åˆ¶ï¼‰ï¼šæš´åŠ›çš„é—®é¢˜æ˜¯ï¼Œåªè¦æ•°ç»„çš„æ•°ç›®è¶…è¿‡ä¸¤ä¸ªï¼Œä¾¿ä¼šé‡å¤è®¡ç®—å¾ˆå¤šå•å…ƒï¼Œæ¯”å¦‚A1+B1+C2å’ŒA2+B1+C2å…¶ä¸­B1+C2å°±è¢«åå¤è®¡ç®—äº†ï¼Œä»–çš„æ—¶é—´å¤æ‚åº¦ä¼šæˆnNçš„å½¢åŠ¿å¢é•¿ã€‚ ä¸ºäº†è§£å†³æš´åŠ›çš„æ—¶é—´å¤æ‚æ€§å¹‚å¢é•¿ï¼Œå¯ä»¥å°†å…¶é™ç»´ï¼Œä¸¤ä¸ªä¸¤ä¸ªåˆ†ç»„ï¼Œç„¶åä½œæŸ¥æ‰¾è¡¨é…å¯¹æ€»å’Œä¸º0çš„æƒ…å†µã€‚ 2.2 ä»£ç  æš´åŠ› class Solution { public int fourSumCount(int[] A, int[] B, int[] C, int[] D) { int count = 0; int len = A.length; if(len == 0) return 0; for(int a = 0;a&lt;len;a++){ for(int b = 0;b&lt;len;b++){ for(int c = 0;c&lt;len;c++){ for(int d = 0;d&lt;len;d++){ if(A[a]+B[b]+C[c]+D[d]==0) count ++; } } } } return count; } } æŸ¥æ‰¾è¡¨ class Solution { public int fourSumCount(int[] A, int[] B, int[] C, int[] D) { if(A.length == 0)return 0; int count = 0; Map&lt;Integer,Integer> map = new HashMap&lt;>(); for(int i:A){ for(int j:B){ //è®°å½•ä¸‹-(i+j)å¯ä»¥å¯¹åº”çš„æ¬¡æ•°ã€‚ map.put(-i-j,map.getOrDefault(-i-j,0)+1); } } for(int i:C){ for(int j:D){ count += map.getOrDefault(i+j,0); } } return count; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode3-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²","slug":"leetcode3-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²","date":"2019-12-26T14:18:21.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode3-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²/","link":"","permalink":"https://www.codetool.top/article/leetcode3-%E6%97%A0%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%90%E4%B8%B2/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ æœ€é•¿å­ä¸² çš„é•¿åº¦ã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥ï¼š â€œabcabcbbâ€è¾“å‡ºï¼š 3è§£é‡Šï¼š å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ â€œabcâ€ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚ ç¤ºä¾‹2ï¼š è¾“å…¥ï¼š â€œbbbbbâ€è¾“å‡ºï¼š 1è§£é‡Šï¼š å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ â€œbâ€ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 1ã€‚ ç¤ºä¾‹3ï¼š è¾“å…¥ï¼š â€œpwwkewâ€è¾“å‡ºï¼š 3è§£é‡Šï¼š å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ â€œwkeâ€ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚ è¯·æ³¨æ„ï¼Œä½ çš„ç­”æ¡ˆå¿…é¡»æ˜¯ å­ä¸² çš„é•¿åº¦ï¼Œâ€pwkeâ€ æ˜¯ä¸€ä¸ªå­åºåˆ—ï¼Œä¸æ˜¯å­ä¸²ã€‚ 2 è§£æ³•2.1 æ€æƒ³æ»‘åŠ¨çª—å£ï¼Œå°†å‡ºç°çš„å­—ç¬¦å’Œä¸‹æ ‡åœ¨å“ˆå¸Œè¡¨ä¸­å¯¹åº”èµ·æ¥ã€‚ è¯¥é—®é¢˜çš„å…³é”®æ˜¯è·å–æ‰€æœ‰ä¸é‡å¤å­—ç¬¦å­ä¸²çš„é•¿åº¦ï¼Œæ¯”è¾ƒå‡ºæœ€å¤§çš„é•¿åº¦ï¼Œæˆ‘ä»¬ç”¨lastè®°å½•å½“å‰è®¡ç®—çš„å­ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä½ç½®ã€‚ é‚£ä¹ˆä¸é‡å¤å­—ç¬¦å­ä¸²çš„é•¿åº¦çš„è®¡ç®—æ–¹æ³•å°±æ˜¯ï¼š å‡è®¾ä»lastå¼€å§‹éƒ½æ˜¯ä¸é‡å¤å­—ç¬¦ï¼Œå¦‚æœé‡åˆ°ä¸€ä¸ªåœ¨å“ˆå¸Œé›†ä¸­å‡ºç°è¿‡çš„å­—ç¬¦å¹¶ä¸”æ˜¯lastæˆ–lastä¹‹åçš„ï¼Œè¯´æ˜é‡åˆ°äº†é‡å¤å­—ç¬¦ï¼Œå¦‚ä¸‹å›¾çš„dï¼Œåˆ™æ­¤æ—¶çš„ä¸é‡å¤å­—ç¬¦å­ä¸²advçš„é•¿åº¦ä¸ºç¬¬äºŒä¸ªdä¹‹å‰çš„é•¿åº¦3-0=3ã€‚ç„¶åå°†lastç§»åˆ°vä¸Šï¼ˆç¬¬ä¸€ä¸ªdåé¢çš„é‚£ä¸ªå…ƒç´ ï¼Œè¿™æ ·æ–°å­ä¸²ä¸­å°±ä¸ä¼šæœ‰ä¸¤ä¸ªdäº†ï¼‰ï¼Œä¾¿å¯ç»§ç»­è¿›è¡Œæ“ä½œã€‚ è¿™æ ·ä¾æ¬¡è¿›è¡Œæ— é‡å¤å­—ç¬¦å­ä¸²çš„é•¿åº¦è®¡ç®—ï¼Œå½“æœ€åéå†åˆ°æœ€åä¸€ä¸ªå­—ç¬¦cçš„æ—¶å€™ï¼Œéƒ½å’Œlastä»¥åŠlastä¹‹åå‡ºç°çš„å­—ç¬¦æ— é‡å¤ï¼Œé‚£ä¹ˆæ­¤æ—¶æœ€åè®¡ç®—çš„å­ä¸²vdfcçš„é•¿åº¦æ˜¯5-2+1=4ï¼ˆå› ä¸ºcæ˜¯è®¡å…¥å­ä¸²çš„ï¼‰ é‚£ä¹ˆå‡è®¾æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯vï¼Œå½“æœ€åéå†åˆ°æœ€åä¸€ä¸ªå­—ç¬¦vçš„æ—¶å€™ï¼Œå’Œå½“å‰å­ä¸²ä¸­çš„vé‡å¤äº†(vdfv)ï¼Œé‚£ä¹ˆå’Œä¹‹å‰è®¡ç®—å­ä¸²é•¿åº¦çš„æ–¹æ³•ä¸€æ ·æ˜¯5-2=3ï¼ˆæœ€åä¸€ä¸ªvä¸è®¡å…¥é•¿åº¦ï¼‰ 2.2 ä»£ç class Solution { public int lengthOfLongestSubstring(String s) { Map&lt;Character,Integer> map = new HashMap&lt;>(); int max = 0; int last = 0; char[] chars = s.toCharArray(); for(int i = 0;i&lt;chars.length;i++){ if(map.containsKey(chars[i])&amp;&amp;map.get(chars[i])>=last){ if(i-last>=max) max = i-last; last = map.get(chars[i]) + 1; }else if(i == chars.length-1&amp;&amp;i-last+1>=max){ max = i-last+1; } map.put(chars[i],i); } return max; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode771-å®çŸ³ä¸çŸ³å¤´","slug":"leetcode771-å®çŸ³ä¸çŸ³å¤´","date":"2019-12-26T14:13:37.000Z","updated":"2020-02-20T14:55:21.052Z","comments":true,"path":"article/leetcode771-å®çŸ³ä¸çŸ³å¤´/","link":"","permalink":"https://www.codetool.top/article/leetcode771-%E5%AE%9D%E7%9F%B3%E4%B8%8E%E7%9F%B3%E5%A4%B4/","excerpt":"","text":"1 åŸé¢˜ç»™å®šå­—ç¬¦ä¸²J ä»£è¡¨çŸ³å¤´ä¸­å®çŸ³çš„ç±»å‹ï¼Œå’Œå­—ç¬¦ä¸² Sä»£è¡¨ä½ æ‹¥æœ‰çš„çŸ³å¤´ã€‚ S ä¸­æ¯ä¸ªå­—ç¬¦ä»£è¡¨äº†ä¸€ç§ä½ æ‹¥æœ‰çš„çŸ³å¤´çš„ç±»å‹ï¼Œä½ æƒ³çŸ¥é“ä½ æ‹¥æœ‰çš„çŸ³å¤´ä¸­æœ‰å¤šå°‘æ˜¯å®çŸ³ã€‚ J ä¸­çš„å­—æ¯ä¸é‡å¤ï¼ŒJ å’Œ Sä¸­çš„æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯å­—æ¯ã€‚å­—æ¯åŒºåˆ†å¤§å°å†™ï¼Œå› æ­¤&quot;a&quot;å’Œ&quot;A&quot;æ˜¯ä¸åŒç±»å‹çš„çŸ³å¤´ã€‚ ç¤ºä¾‹ 1: è¾“å…¥ï¼š J = â€œaAâ€, S = â€œaAAbbbbâ€è¾“å‡ºï¼š 3 ç¤ºä¾‹ 2: è¾“å…¥ï¼š J = â€œzâ€, S = â€œZZâ€è¾“å‡ºï¼š 0 æ³¨æ„ï¼š S å’Œ J æœ€å¤šå«æœ‰50ä¸ªå­—æ¯ã€‚ J ä¸­çš„å­—ç¬¦ä¸é‡å¤ã€‚ 2 è§£æ³•2.1 æ€æƒ³å°†ä»£è¡¨å®çŸ³çš„å­—ç¬¦å­˜æ”¾åœ¨å“ˆå¸Œé›†ä¸­ã€‚ 2.2 ä»£ç class Solution { public int numJewelsInStones(String J, String S) { Set&lt;Character> set = new HashSet&lt;>(); for(char i:J.toCharArray()){ set.add(i); } int count = 0; for(char i:S.toCharArray()){ if(set.contains(i)) count++; } return count; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode652-å¯»æ‰¾é‡å¤çš„å­æ ‘","slug":"leetcode652-å¯»æ‰¾é‡å¤çš„å­æ ‘","date":"2019-12-26T05:52:10.000Z","updated":"2020-02-20T14:55:21.053Z","comments":true,"path":"article/leetcode652-å¯»æ‰¾é‡å¤çš„å­æ ‘/","link":"","permalink":"https://www.codetool.top/article/leetcode652-%E5%AF%BB%E6%89%BE%E9%87%8D%E5%A4%8D%E7%9A%84%E5%AD%90%E6%A0%91/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€æ£µäºŒå‰æ ‘ï¼Œè¿”å›æ‰€æœ‰é‡å¤çš„å­æ ‘ã€‚å¯¹äºåŒä¸€ç±»çš„é‡å¤å­æ ‘ï¼Œä½ åªéœ€è¦è¿”å›å…¶ä¸­ä»»æ„ä¸€æ£µçš„æ ¹ç»“ç‚¹å³å¯ã€‚ ä¸¤æ£µæ ‘é‡å¤æ˜¯æŒ‡å®ƒä»¬å…·æœ‰ç›¸åŒçš„ç»“æ„ä»¥åŠç›¸åŒçš„ç»“ç‚¹å€¼ã€‚ ç¤ºä¾‹1: 1 / \\ 2 3 / / \\ 4 2 4 / 4 ä¸‹é¢æ˜¯ä¸¤ä¸ªé‡å¤çš„å­æ ‘ï¼š 2 / 4 å’Œ 4 å› æ­¤ï¼Œä½ éœ€è¦ä»¥åˆ—è¡¨çš„å½¢å¼è¿”å›ä¸Šè¿°é‡å¤å­æ ‘çš„æ ¹ç»“ç‚¹ã€‚ 2 è§£æ³•2.1 æ€æƒ³å°†å­æ ‘æŒ‰ç…§æŸç§ç®—æ³•éå†åºåˆ—åŒ–æˆå­—ç¬¦ä¸²ï¼Œä½œä¸ºå“ˆå¸Œè¡¨çš„é”®ã€‚ 2.2 ä»£ç /** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */ class Solution { Map&lt;String,Integer> map; List&lt;TreeNode> list; public String LRD(TreeNode node){ StringBuilder sb = new StringBuilder(); dfs(sb,node); return sb.toString(); } public void dfs(StringBuilder str,TreeNode node){ if(node == null){ str.append('n'); return; } dfs(str,node.left); dfs(str,node.right); str.append(String.valueOf(node.val)); return; } public List&lt;TreeNode> findDuplicateSubtrees(TreeNode root) { map = new HashMap&lt;>(); list = new ArrayList&lt;>(); dfsFindSubtrees(root); return list; } public void dfsFindSubtrees(TreeNode root){ if(root == null) return; dfsFindSubtrees(root.left); dfsFindSubtrees(root.right); String LRD = LRD(root); if(map.containsKey(LRD)){ if(map.get(LRD)==1){ list.add(root); map.put(LRD,0); } }else{ map.put(LRD,1); } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode36-æœ‰æ•ˆçš„æ•°ç‹¬","slug":"leetcode36-æœ‰æ•ˆçš„æ•°ç‹¬","date":"2019-12-26T05:25:23.000Z","updated":"2020-02-20T14:55:21.056Z","comments":true,"path":"article/leetcode36-æœ‰æ•ˆçš„æ•°ç‹¬/","link":"","permalink":"https://www.codetool.top/article/leetcode36-%E6%9C%89%E6%95%88%E7%9A%84%E6%95%B0%E7%8B%AC/","excerpt":"","text":"1 åŸé¢˜åˆ¤æ–­ä¸€ä¸ª 9x9 çš„æ•°ç‹¬æ˜¯å¦æœ‰æ•ˆã€‚åªéœ€è¦æ ¹æ®ä»¥ä¸‹è§„åˆ™ï¼ŒéªŒè¯å·²ç»å¡«å…¥çš„æ•°å­—æ˜¯å¦æœ‰æ•ˆå³å¯ã€‚ æ•°å­— 1-9 åœ¨æ¯ä¸€è¡Œåªèƒ½å‡ºç°ä¸€æ¬¡ã€‚ æ•°å­— 1-9 åœ¨æ¯ä¸€åˆ—åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚ æ•°å­— 1-9 åœ¨æ¯ä¸€ä¸ªä»¥ç²—å®çº¿åˆ†éš”çš„ 3x3 å®«å†…åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚ ä¸Šå›¾æ˜¯ä¸€ä¸ªéƒ¨åˆ†å¡«å……çš„æœ‰æ•ˆçš„æ•°ç‹¬ã€‚ æ•°ç‹¬éƒ¨åˆ†ç©ºæ ¼å†…å·²å¡«å…¥äº†æ•°å­—ï¼Œç©ºç™½æ ¼ç”¨ &#39;.&#39; è¡¨ç¤ºã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥ï¼š[ [â€œ5â€,â€3â€,â€.â€,â€.â€,â€7â€,â€.â€,â€.â€,â€.â€,â€.â€], [â€œ6â€,â€.â€,â€.â€,â€1â€,â€9â€,â€5â€,â€.â€,â€.â€,â€.â€], [â€œ.â€,â€9â€,â€8â€,â€.â€,â€.â€,â€.â€,â€.â€,â€6â€,â€.â€], [â€œ8â€,â€.â€,â€.â€,â€.â€,â€6â€,â€.â€,â€.â€,â€.â€,â€3â€], [â€œ4â€,â€.â€,â€.â€,â€8â€,â€.â€,â€3â€,â€.â€,â€.â€,â€1â€], [â€œ7â€,â€.â€,â€.â€,â€.â€,â€2â€,â€.â€,â€.â€,â€.â€,â€6â€], [â€œ.â€,â€6â€,â€.â€,â€.â€,â€.â€,â€.â€,â€2â€,â€8â€,â€.â€], [â€œ.â€,â€.â€,â€.â€,â€4â€,â€1â€,â€9â€,â€.â€,â€.â€,â€5â€], [â€œ.â€,â€.â€,â€.â€,â€.â€,â€8â€,â€.â€,â€.â€,â€7â€,â€9â€]]è¾“å‡ºï¼š true ç¤ºä¾‹1ï¼š è¾“å…¥ï¼š[ [â€œ8â€,â€3â€,â€.â€,â€.â€,â€7â€,â€.â€,â€.â€,â€.â€,â€.â€], [â€œ6â€,â€.â€,â€.â€,â€1â€,â€9â€,â€5â€,â€.â€,â€.â€,â€.â€], [â€œ.â€,â€9â€,â€8â€,â€.â€,â€.â€,â€.â€,â€.â€,â€6â€,â€.â€], [â€œ8â€,â€.â€,â€.â€,â€.â€,â€6â€,â€.â€,â€.â€,â€.â€,â€3â€], [â€œ4â€,â€.â€,â€.â€,â€8â€,â€.â€,â€3â€,â€.â€,â€.â€,â€1â€], [â€œ7â€,â€.â€,â€.â€,â€.â€,â€2â€,â€.â€,â€.â€,â€.â€,â€6â€], [â€œ.â€,â€6â€,â€.â€,â€.â€,â€.â€,â€.â€,â€2â€,â€8â€,â€.â€], [â€œ.â€,â€.â€,â€.â€,â€4â€,â€1â€,â€9â€,â€.â€,â€.â€,â€5â€], [â€œ.â€,â€.â€,â€.â€,â€.â€,â€8â€,â€.â€,â€.â€,â€7â€,â€9â€]]è¾“å‡ºï¼š falseè§£é‡Šï¼š é™¤äº†ç¬¬ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªæ•°å­—ä» 5 æ”¹ä¸º 8 ä»¥å¤–ï¼Œç©ºæ ¼å†…å…¶ä»–æ•°å­—å‡ä¸ ç¤ºä¾‹1 ç›¸åŒã€‚ ä½†ç”±äºä½äºå·¦ä¸Šè§’çš„ 3x3 å®«å†…æœ‰ä¸¤ä¸ª 8 å­˜åœ¨, å› æ­¤è¿™ä¸ªæ•°ç‹¬æ˜¯æ— æ•ˆçš„ã€‚ è¯´æ˜: ä¸€ä¸ªæœ‰æ•ˆçš„æ•°ç‹¬ï¼ˆéƒ¨åˆ†å·²è¢«å¡«å……ï¼‰ä¸ä¸€å®šæ˜¯å¯è§£çš„ã€‚ åªéœ€è¦æ ¹æ®ä»¥ä¸Šè§„åˆ™ï¼ŒéªŒè¯å·²ç»å¡«å…¥çš„æ•°å­—æ˜¯å¦æœ‰æ•ˆå³å¯ã€‚ ç»™å®šæ•°ç‹¬åºåˆ—åªåŒ…å«æ•°å­— 1-9 å’Œå­—ç¬¦ &#39;.&#39; ã€‚ ç»™å®šæ•°ç‹¬æ°¸è¿œæ˜¯ 9x9 å½¢å¼çš„ã€‚ 2 è§£æ³•2.1 æ€æƒ³è¡Œã€åˆ—ã€å®«åˆ†åˆ«åˆ†é…ä¸€ä¸ªå“ˆå¸Œé›†è®°å½•å‡ºç°çš„æ•°å­—ã€‚ 2.2 ä»£ç class Solution { char[][] globalBoard; //è¡Œ:0-8,åˆ—:9-17,å®«:18-26 Set&lt;Character>[] sets = new Set[27]; public boolean isValidSudoku(char[][] board) { for(int i = 0;i&lt;27;i++){ sets[i] = new HashSet&lt;>(); } globalBoard = board; for(int x = 0 ; x &lt; 9 ; x ++){ for(int y = 0;y&lt;9;y++){ if(isValidSingle(x,y)==false) return false; } } return true; } public boolean isValidSingle(int x,int y){ if(globalBoard[x][y]=='.') return true; if(sets[x].contains(globalBoard[x][y])) return false; sets[x].add(globalBoard[x][y]); if(sets[9+y].contains(globalBoard[x][y])) return false; sets[9+y].add(globalBoard[x][y]); if(sets[18+y/3*3+x/3].contains(globalBoard[x][y])) return false; sets[18+y/3*3+x/3].add(globalBoard[x][y]); return true; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode49-å­—æ¯å¼‚ä½è¯åˆ†ç»„","slug":"leetcode49-å­—æ¯å¼‚ä½è¯åˆ†ç»„","date":"2019-12-25T14:27:42.000Z","updated":"2020-02-20T14:55:21.056Z","comments":true,"path":"article/leetcode49-å­—æ¯å¼‚ä½è¯åˆ†ç»„/","link":"","permalink":"https://www.codetool.top/article/leetcode49-%E5%AD%97%E6%AF%8D%E5%BC%82%E4%BD%8D%E8%AF%8D%E5%88%86%E7%BB%84/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œå°†å­—æ¯å¼‚ä½è¯ç»„åˆåœ¨ä¸€èµ·ã€‚å­—æ¯å¼‚ä½è¯æŒ‡å­—æ¯ç›¸åŒï¼Œä½†æ’åˆ—ä¸åŒçš„å­—ç¬¦ä¸²ã€‚ ç¤ºä¾‹ï¼š è¾“å…¥ï¼š [â€œeatâ€, â€œteaâ€, â€œtanâ€, â€œateâ€, â€œnatâ€, â€œbatâ€]è¾“å‡ºï¼š[ [â€œateâ€,â€eatâ€,â€teaâ€], [â€œnatâ€,â€tanâ€], [â€œbatâ€]] è¯´æ˜ï¼š æ‰€æœ‰è¾“å…¥å‡ä¸ºå°å†™å­—æ¯ã€‚ ä¸è€ƒè™‘ç­”æ¡ˆè¾“å‡ºçš„é¡ºåºã€‚ 2 è§£æ³•2.1 æ€æƒ³å°†å­—ç¬¦ä¸²æŒ‰å­—å…¸é¡ºåºæ’åºä½œä¸ºé”®ï¼Œå­˜å‚¨å¯¹åº”çš„å¼‚ä½å­—ç¬¦ä¸²çš„Listä½œä¸ºå€¼ã€‚ 2.2 ä»£ç class Solution { public List&lt;List&lt;String>> groupAnagrams(String[] strs) { Map&lt;String,List&lt;String>> map = new HashMap&lt;>(); List&lt;List&lt;String>> list = new ArrayList&lt;>(); for(String i:strs){ char[] chars = i.toCharArray(); Arrays.sort(chars); if(map.containsKey(String.valueOf(chars))){ map.get(String.valueOf(chars)).add(i); }else{ List&lt;String> newList = new ArrayList&lt;>(); newList.add(i); map.put(String.valueOf(chars),newList); list.add(newList); } } return list; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode219-å­˜åœ¨é‡å¤å…ƒç´ II","slug":"leetcode219-å­˜åœ¨é‡å¤å…ƒç´ II","date":"2019-12-24T14:46:27.000Z","updated":"2020-02-20T14:55:21.053Z","comments":true,"path":"article/leetcode219-å­˜åœ¨é‡å¤å…ƒç´ II/","link":"","permalink":"https://www.codetool.top/article/leetcode219-%E5%AD%98%E5%9C%A8%E9%87%8D%E5%A4%8D%E5%85%83%E7%B4%A0II/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„å’Œä¸€ä¸ªæ•´æ•° kï¼Œåˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨ä¸¤ä¸ªä¸åŒçš„ç´¢å¼• i å’Œ jï¼Œä½¿å¾— nums [i] = nums [j]ï¼Œå¹¶ä¸” i å’Œ j çš„å·®çš„ç»å¯¹å€¼æœ€å¤§ä¸º kã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥ï¼š nums = [1,2,3,1], k = 3è¾“å‡ºï¼š true ç¤ºä¾‹2ï¼š è¾“å…¥ï¼š nums = [1,0,1,1], k = 1è¾“å‡ºï¼š true ç¤ºä¾‹3ï¼š è¾“å…¥ï¼š nums = [1,2,3,1,2,3], k = 2è¾“å‡ºï¼š false 2 è§£æ³•2.1 æ€æƒ³å“ˆå¸Œè¡¨ï¼Œå°†å…ƒç´ å’Œæœ€åå‡ºç°çš„ä¸‹æ ‡å¯¹åº”èµ·æ¥ï¼Œåé¢éå†åˆ°ç›¸åŒå…ƒç´ æ—¶çœ‹ä¸‹æ ‡ä¹‹å·®æ˜¯å¦å°äºç­‰äºk 2.2 ä»£ç class Solution { public boolean containsNearbyDuplicate(int[] nums, int k) { Map&lt;Integer,Integer> map = new HashMap&lt;>(); for(int i = 0;i&lt;nums.length;i++){ if(map.containsKey(nums[i])){ if(i-map.get(nums[i])&lt;=k) return true; } map.put(nums[i],i); } return false; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode350-ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†II","slug":"leetcode350-ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†II","date":"2019-12-23T14:35:59.000Z","updated":"2020-02-20T14:55:21.053Z","comments":true,"path":"article/leetcode350-ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†II/","link":"","permalink":"https://www.codetool.top/article/leetcode350-%E4%B8%A4%E4%B8%AA%E6%95%B0%E7%BB%84%E7%9A%84%E4%BA%A4%E9%9B%86II/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸¤ä¸ªæ•°ç»„ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å®ƒä»¬çš„äº¤é›†ã€‚ è¾“å…¥ï¼š nums1 = [1,2,2,1], nums2 = [2,2]è¾“å‡ºï¼š [2,2] ç¤ºä¾‹2ï¼š è¾“å…¥ï¼š nums1 = [4,9,5], nums2 = [9,4,9,8,4]è¾“å‡ºï¼š [4,9] è¯´æ˜ï¼š è¾“å‡ºç»“æœä¸­æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œåº”ä¸å…ƒç´ åœ¨ä¸¤ä¸ªæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°ä¸€è‡´ã€‚ æˆ‘ä»¬å¯ä»¥ä¸è€ƒè™‘è¾“å‡ºç»“æœçš„é¡ºåºã€‚ è¿›é˜¶: å¦‚æœç»™å®šçš„æ•°ç»„å·²ç»æ’å¥½åºå‘¢ï¼Ÿä½ å°†å¦‚ä½•ä¼˜åŒ–ä½ çš„ç®—æ³•ï¼Ÿ å¦‚æœ nums1 çš„å¤§å°æ¯” nums2 å°å¾ˆå¤šï¼Œå“ªç§æ–¹æ³•æ›´ä¼˜ï¼Ÿ å¦‚æœ nums2 çš„å…ƒç´ å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œç£ç›˜å†…å­˜æ˜¯æœ‰é™çš„ï¼Œå¹¶ä¸”ä½ ä¸èƒ½ä¸€æ¬¡åŠ è½½æ‰€æœ‰çš„å…ƒç´ åˆ°å†…å­˜ä¸­ï¼Œä½ è¯¥æ€ä¹ˆåŠï¼Ÿ 2 è§£æ³•2.1 æ€æƒ³å“ˆå¸Œè¡¨ï¼Œéå†ç¬¬ä¸€ä¸ªæ•°ç»„çš„æ—¶å€™æŠŠå€¼å’Œå‡ºç°çš„æ¬¡æ•°å¯¹åº”èµ·æ¥ï¼Œéå†ç¬¬äºŒä¸ªæ•°ç»„çš„æ—¶å€™å¯ä»¥å¾—å‡ºå¹¶é›†ã€‚ 2.2 ä»£ç class Solution { public int[] intersect(int[] nums1, int[] nums2) { Map&lt;Integer,Integer> map = new HashMap&lt;>(); for(int i:nums1){ if(map.containsKey(i)){ map.put(i,map.get(i)+1); }else map.put(i,1); } int length = 0; for(int i:nums2){ if(map.containsKey(i)){ if(map.get(i)-1 == 0){ map.remove(i); }else map.put(i,map.get(i)-1); nums1[length] = i; length++; } } int[] ret = new int[length]; System.arraycopy(nums1,0,ret,0,length); return ret; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode387-å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€ä¸ªå”¯ä¸€å­—ç¬¦","slug":"leetcode387-å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€ä¸ªå”¯ä¸€å­—ç¬¦","date":"2019-12-22T14:32:40.000Z","updated":"2020-02-20T14:55:21.053Z","comments":true,"path":"article/leetcode387-å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€ä¸ªå”¯ä¸€å­—ç¬¦/","link":"","permalink":"https://www.codetool.top/article/leetcode387-%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%94%AF%E4%B8%80%E5%AD%97%E7%AC%A6/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰¾åˆ°å®ƒçš„ç¬¬ä¸€ä¸ªä¸é‡å¤çš„å­—ç¬¦ï¼Œå¹¶è¿”å›å®ƒçš„ç´¢å¼•ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å› -1ã€‚ æ¡ˆä¾‹: s = â€œleetcodeâ€è¿”å› 0.s = â€œloveleetcodeâ€,è¿”å› 2. æ³¨æ„äº‹é¡¹ï¼š æ‚¨å¯ä»¥å‡å®šè¯¥å­—ç¬¦ä¸²åªåŒ…å«å°å†™å­—æ¯ã€‚ 2 è§£æ³•2.1 æ€æƒ³éå†ä¸¤æ¬¡æ•°ç»„ï¼Œç¬¬ä¸€æ¬¡å°†å­—æ¯å’Œå‡ºç°çš„æ¬¡æ•°æ”¾åœ¨å“ˆå¸Œè¡¨ä¸­å¯¹åº”èµ·æ¥ï¼Œç¬¬äºŒéæ‰¾å‡ºå“ˆå¸Œè¡¨ä¸­å€¼ä¸º1çš„å­—æ¯ã€‚ 2.2 ä»£ç class Solution { public int firstUniqChar(String s) { Map&lt;Character,Integer> map = new HashMap&lt;>(); int n = 0; char[] chars = s.toCharArray(); for(char i:chars){ if(map.containsKey(i)){ map.put(i,map.get(i)+1); }else{ map.put(i,1); } n++; } n = 0; for (char i:chars) { if(map.get(i)==1) return n; n++; } return -1; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode599-ä¸¤ä¸ªåˆ—è¡¨çš„æœ€å°ç´¢å¼•æ€»å’Œ","slug":"leetcode599-ä¸¤ä¸ªåˆ—è¡¨çš„æœ€å°ç´¢å¼•æ€»å’Œ","date":"2019-12-22T12:58:42.000Z","updated":"2020-02-20T14:55:21.053Z","comments":true,"path":"article/leetcode599-ä¸¤ä¸ªåˆ—è¡¨çš„æœ€å°ç´¢å¼•æ€»å’Œ/","link":"","permalink":"https://www.codetool.top/article/leetcode599-%E4%B8%A4%E4%B8%AA%E5%88%97%E8%A1%A8%E7%9A%84%E6%9C%80%E5%B0%8F%E7%B4%A2%E5%BC%95%E6%80%BB%E5%92%8C/","excerpt":"","text":"1 åŸé¢˜å‡è®¾Andyå’ŒDorisæƒ³åœ¨æ™šé¤æ—¶é€‰æ‹©ä¸€å®¶é¤å…ï¼Œå¹¶ä¸”ä»–ä»¬éƒ½æœ‰ä¸€ä¸ªè¡¨ç¤ºæœ€å–œçˆ±é¤å…çš„åˆ—è¡¨ï¼Œæ¯ä¸ªé¤å…çš„åå­—ç”¨å­—ç¬¦ä¸²è¡¨ç¤ºã€‚ ä½ éœ€è¦å¸®åŠ©ä»–ä»¬ç”¨æœ€å°‘çš„ç´¢å¼•å’Œæ‰¾å‡ºä»–ä»¬å…±åŒå–œçˆ±çš„é¤å…ã€‚ å¦‚æœç­”æ¡ˆä¸æ­¢ä¸€ä¸ªï¼Œåˆ™è¾“å‡ºæ‰€æœ‰ç­”æ¡ˆå¹¶ä¸”ä¸è€ƒè™‘é¡ºåºã€‚ ä½ å¯ä»¥å‡è®¾æ€»æ˜¯å­˜åœ¨ä¸€ä¸ªç­”æ¡ˆã€‚ ç¤ºä¾‹1: è¾“å…¥:[â€œShogunâ€, â€œTapioca Expressâ€, â€œBurger Kingâ€, â€œKFCâ€][â€œPiattiâ€, â€œThe Grill at Torrey Pinesâ€, â€œHungry Hunter Steakhouseâ€, â€œShogunâ€]è¾“å‡º: [â€œShogunâ€]è§£é‡Š: ä»–ä»¬å”¯ä¸€å…±åŒå–œçˆ±çš„é¤å…æ˜¯â€œShogunâ€ã€‚ ç¤ºä¾‹2: è¾“å…¥:[â€œShogunâ€, â€œTapioca Expressâ€, â€œBurger Kingâ€, â€œKFCâ€][â€œKFCâ€, â€œShogunâ€, â€œBurger Kingâ€]è¾“å‡º: [â€œShogunâ€]è§£é‡Š: ä»–ä»¬å…±åŒå–œçˆ±ä¸”å…·æœ‰æœ€å°ç´¢å¼•å’Œçš„é¤å…æ˜¯â€œShogunâ€ï¼Œå®ƒæœ‰æœ€å°çš„ç´¢å¼•å’Œ1(0+1)ã€‚ æç¤º: ä¸¤ä¸ªåˆ—è¡¨çš„é•¿åº¦èŒƒå›´éƒ½åœ¨ [1, 1000]å†…ã€‚ ä¸¤ä¸ªåˆ—è¡¨ä¸­çš„å­—ç¬¦ä¸²çš„é•¿åº¦å°†åœ¨[1ï¼Œ30]çš„èŒƒå›´å†…ã€‚ ä¸‹æ ‡ä»0å¼€å§‹ï¼Œåˆ°åˆ—è¡¨çš„é•¿åº¦å‡1ã€‚ ä¸¤ä¸ªåˆ—è¡¨éƒ½æ²¡æœ‰é‡å¤çš„å…ƒç´ ã€‚ 2 è§£æ³•2.1 æ€æƒ³å“ˆå¸Œè¡¨ï¼Œå°†ç¬¬ä¸€ä¸ªåˆ—è¡¨ä¸­çš„å­—ç¬¦ä¸²å’Œä¸‹æ ‡å¯¹åº”èµ·æ¥ï¼Œç„¶åéå†ç¬¬äºŒä¸ªåˆ—è¡¨æ‰¾æœ€å°ä¸‹æ ‡ä¹‹å’Œã€‚ 2.2 ä»£ç class Solution { public String[] findRestaurant(String[] list1, String[] list2) { Map&lt;String,Integer> map = new HashMap&lt;>(); int newLength = 0; int minSum = 2000; for(int i = 0;i&lt;list1.length;i++){ map.put(list1[i],i); } for(int i = 0;i&lt;list2.length;i++){ if(map.containsKey(list2[i])){ int n = i + map.get(list2[i]); if(n&lt;minSum){ list1[0] = list2[i]; newLength = 1; minSum = n; }else if(n == minSum){ list1[newLength] = list2[i]; newLength++; } } } String[] ret = new String[newLength]; System.arraycopy(list1,0,ret,0,newLength); return ret; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"å¯¹è±¡çš„è¾“å…¥è¾“å‡º-javaåºåˆ—åŒ–æœºåˆ¶","slug":"å¯¹è±¡çš„è¾“å…¥è¾“å‡º-javaåºåˆ—åŒ–æœºåˆ¶","date":"2019-12-21T14:54:22.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/å¯¹è±¡çš„è¾“å…¥è¾“å‡º-javaåºåˆ—åŒ–æœºåˆ¶/","link":"","permalink":"https://www.codetool.top/article/%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA-java%E5%BA%8F%E5%88%97%E5%8C%96%E6%9C%BA%E5%88%B6/","excerpt":"","text":"å¯¹è±¡åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œåœ¨javaä¸­ä½“ç°ä¸ºä¸¤ç§å­—èŠ‚æµï¼š ObjectInputStreamã€ObjectOutputStream 1 åºåˆ—åŒ–çš„æ¦‚å¿µæŒ‡å †å†…å­˜ä¸­çš„javaå¯¹è±¡æ•°æ®ï¼Œé€šè¿‡æŸç§æ–¹å¼å­˜å‚¨åˆ°ç£ç›˜æ–‡ä»¶ä¸­ï¼Œæˆ–è€…ä¼ é€’ç»™å…¶ä»–ç½‘ç»œèŠ‚ç‚¹ï¼ˆç½‘ç»œä¼ è¾“ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºåºåˆ—åŒ–ï¼Œé€šå¸¸æ˜¯æŒ‡å°†æ•°æ®ç»“æ„æˆ–å¯¹è±¡è½¬åŒ–æˆäºŒè¿›åˆ¶çš„è¿‡ç¨‹ã€‚ ååºåˆ—åŒ–ï¼Œé¡¾åæ€ä¹‰ï¼Œåˆ™æ˜¯å°†äºŒè¿›åˆ¶å­—èŠ‚æµè½¬åŒ–å›javaå¯¹è±¡çš„è¿‡ç¨‹ã€‚ javaåºåˆ—åŒ–æ˜¯å¹³å°æ— å…³çš„ã€‚ 2 åºåˆ—åŒ–çš„ä½œç”¨ å¯¹è±¡æŒä¹…åŒ– ç½‘ç»œä¼ è¾“å¯¹è±¡ è¿›ç¨‹é—´ä¼ é€’å¯¹è±¡ 3 å¦‚ä½•åºåˆ—åŒ–3.1 é»˜è®¤åºåˆ—åŒ– ä¸ºç±»å®ç°ä¸€ä¸ªSerializableæ¥å£ï¼Œè¿™æ˜¯ä¸€ä¸ªç©ºæ¥å£ï¼Œæ²¡æœ‰éœ€è¦å®ç°çš„æ–¹æ³•ã€‚ å¯ä»¥è°ƒç”¨ObjectOutputStream.writeObjectæ–¹æ³•æ¥åºåˆ—åŒ–äº†ã€‚ è°ƒç”¨ObjectInputStream.readObjectæ¥ååºåˆ—åŒ– 3.2 è‡ªå®šä¹‰åºåˆ—åŒ–è¿‡ç¨‹å®ç°Serializableæ¥å£ä¹‹åï¼Œé‡å†™ writeObject(ObjectOutputStream) ã€ readObject(ObjectInputStream) æ–¹æ³•ã€‚ 4 åºåˆ—åŒ–IDé€šå¸¸å¯åºåˆ—åŒ–çš„ç±»ä¼šä½¿ç”¨ä¸€ä¸ªåºåˆ—åŒ–IDï¼š private static final long serialVersionUID = 1L; javaçš„åºåˆ—åŒ–æœºåˆ¶æ˜¯é€šè¿‡åˆ¤æ–­è¿è¡Œæ—¶ç±»çš„serialVersionUIDæ¥éªŒè¯ç‰ˆæœ¬ä¸€è‡´æ€§çš„ï¼Œåœ¨è¿›è¡Œååºåˆ—åŒ–æ—¶ï¼ŒJVMä¼šæŠŠä¼ è¿›æ¥çš„å­—èŠ‚æµä¸­çš„serialVersionUIDä¸æœ¬åœ°å®ä½“ç±»ä¸­çš„serialVersionUIDè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒåˆ™è®¤ä¸ºæ˜¯ä¸€è‡´çš„ï¼Œä¾¿å¯ä»¥è¿›è¡Œååºåˆ—åŒ–ï¼Œå¦åˆ™å°±ä¼šæŠ¥åºåˆ—åŒ–ç‰ˆæœ¬ä¸ä¸€è‡´çš„å¼‚å¸¸InvalidClassExceptionã€‚ 5 åºåˆ—åŒ–ä¹‹åçš„å­—èŠ‚æµæ ¼å¼æˆ‘ä»¬ç”¨è¿™æ ·ä¸€æ®µä»£ç åšå®éªŒï¼š class SerializableObject implements Serializable{ } public class Main { public static void main(String[] args) throws IOException { ObjectOutputStream out = new ObjectOutputStream(System.out); Object obj = new SerializableObject(); out.writeObject(obj); } } å¾—åˆ°çš„ç»“æœä¸º: aced 0005 7372 0012 5365 7269 616c 697a 6162 6c65 4f62 6a65 6374 0b8e b091 7d68 738d 0200 0078 70å‰ä¸¤ä¸ªå­—èŠ‚å›ºå®šï¼š ac ed ç´§æ¥çš„æ˜¯å¯¹è±¡åºåˆ—åŒ–æ ¼å¼çš„ç‰ˆæœ¬å·ï¼š 00 05 æ¥ä¸‹æ¥ï¼Œ73 ä»£è¡¨æ¥ä¸‹æ¥è¯»å–åˆ°çš„å°†æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œ72 ä»£è¡¨è¯¥å¯¹è±¡æ˜¯ä¸€ä¸ªå¯¹ç±»çš„æè¿°ï¼š73 72 æ¥ä¸‹æ¥çš„ä¸¤å­—èŠ‚æè¿°ç±»åé•¿åº¦ï¼š00 12ï¼Œå¯¹åº”18ä¸ªå­—èŠ‚çš„å…¨é™å®šç±»åã€‚ äºæ˜¯æ¥ä¸‹æ¥çš„18å­—èŠ‚å°±æ˜¯ç±»åçš„UTFç¼–ç ï¼š5365 7269 616c 697a 6162 6c65 4f62 6a65 6374ï¼Œå°±æ˜¯ç±»åSerializableObjectã€‚ æ¥ä¸‹æ¥å…«ä¸ªå­—èŠ‚æ˜¯åºåˆ—åŒ–ç‰ˆæœ¬IDï¼š0b8e b091 7d68 738d æ¥ä¸‹æ¥ä¸€ä¸ªå­—èŠ‚02ä»£è¡¨äº†åºåˆ—åŒ–ä¸­æ ‡è¯†ç±»ç‰ˆæœ¬ã€‚ ç»§ç»­å¾€ä¸‹ä¸¤ä¸ªå­—èŠ‚å°±æ˜¯ 00 00 , ä»£è¡¨è¯¥ç±»ä¸­å­—æ®µçš„ä¸ªæ•°ï¼Œç”±äºæˆ‘è¿™ä¸ªç±»å†…éƒ¨ä¸ºç©ºæ²¡æœ‰å­—æ®µï¼Œæ‰€ä»¥è¿™é‡Œå°±æ˜¯0ã€‚ ç„¶åæ˜¯å®ƒåŒ…å«çš„å­—æ®µåºåˆ—ç±»å‹æè¿°,å…¶é¡ºåºå³å®ƒä»¬å­˜å‚¨çš„é¡ºåº. åŸºæœ¬ç±»å‹çš„ç»„æˆä¸ºï¼šä¸€å­—èŠ‚ç±»å‹æè¿°ç¬¦ ä¸¤å­—èŠ‚å­—æ®µåç§°é•¿åº¦ å­—æ®µåç§° ç±»å‹æè¿°ç¬¦ï¼š è§£ç å­—ç¬¦ ä»£è¡¨ç±»å‹ B byte C char D double F float I int J long L å¯¹è±¡ S short Z boolean [ æ•°ç»„ å­—æ®µåºåˆ—ç±»å‹æè¿°ç»“æŸåé™„åŠ ä¸¤ä¸ªå­—èŠ‚æ˜¯å›ºå®šçš„78 70 æœ€åæ˜¯å­—æ®µä¿¡æ¯ï¼ˆå†…å®¹ï¼‰çš„æè¿°ï¼Œè¿™é‡Œéƒ½æ²¡æœ‰ã€‚ 6 ç‰¹æ®Šæƒ…å†µ é™æ€å˜é‡ä¸ä¼šè¢«åºåˆ—åŒ–(static)ï¼Œtransientåˆ™å¯ä»¥é™å®šå­—æ®µä¸å‚ä¸åºåˆ—åŒ–ã€‚ å½“ä¸€ä¸ªçˆ¶ç±»å®ç°åºåˆ—åŒ–ï¼Œå­ç±»è‡ªåŠ¨å®ç°åºåˆ—åŒ–ï¼Œä¸éœ€è¦æ˜¾å¼å®ç°Serializableæ¥å£ã€‚ å½“ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹å˜é‡å¼•ç”¨å…¶ä»–å¯¹è±¡ï¼Œåºåˆ—åŒ–è¯¥å¯¹è±¡æ—¶ä¹ŸæŠŠå¼•ç”¨å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://www.codetool.top/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"},{"name":"IO","slug":"IO","permalink":"https://www.codetool.top/tags/IO/"}]},{"title":"leetcode205-åŒæ„å­—ç¬¦ä¸²","slug":"leetcode205-åŒæ„å­—ç¬¦ä¸²","date":"2019-12-21T05:00:29.000Z","updated":"2020-02-20T14:55:21.053Z","comments":true,"path":"article/leetcode205-åŒæ„å­—ç¬¦ä¸²/","link":"","permalink":"https://www.codetool.top/article/leetcode205-%E5%90%8C%E6%9E%84%E5%AD%97%E7%AC%A6%E4%B8%B2/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ tï¼Œåˆ¤æ–­å®ƒä»¬æ˜¯å¦æ˜¯åŒæ„çš„ã€‚ å¦‚æœ s ä¸­çš„å­—ç¬¦å¯ä»¥è¢«æ›¿æ¢å¾—åˆ° t ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯åŒæ„çš„ã€‚ æ‰€æœ‰å‡ºç°çš„å­—ç¬¦éƒ½å¿…é¡»ç”¨å¦ä¸€ä¸ªå­—ç¬¦æ›¿æ¢ï¼ŒåŒæ—¶ä¿ç•™å­—ç¬¦çš„é¡ºåºã€‚ä¸¤ä¸ªå­—ç¬¦ä¸èƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªå­—ç¬¦ä¸Šï¼Œä½†å­—ç¬¦å¯ä»¥æ˜ å°„è‡ªå·±æœ¬èº«ã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥ï¼š s = â€œeggâ€, t = â€œaddâ€è¾“å‡ºï¼š true ç¤ºä¾‹2ï¼š è¾“å…¥ï¼š s = â€œfooâ€, t = â€œbarâ€è¾“å‡ºï¼š false ç¤ºä¾‹3ï¼š è¾“å…¥ï¼š s = â€œpaperâ€, t = â€œtitleâ€è¾“å‡ºï¼š true 2 è§£æ³•2.1 æ€æƒ³ ç›¸åŒçš„å­—ç¬¦è¦å¯¹åº”ç›¸åŒçš„å­—ç¬¦ï¼Œé‚£ä¹ˆç›¸åŒå­—ç¬¦å¤„äºåä½ç½®çš„å­—ç¬¦çš„ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®å°±åº”è¯¥ç›¸åŒã€‚ å“ˆå¸Œè¡¨è®°å½•å¯¹åº”å…³ç³» 2.2 ä»£ç  indexOf ï¼ˆä½œè€…:hao-fei-haoï¼‰ class Solution { public boolean isIsomorphic(String s, String t) { char[] ch1 = s.toCharArray(); char[] ch2 = t.toCharArray(); int len = s.length(); for (int i = 0; i &lt; len; i++) { if(s.indexOf(ch1[i]) != t.indexOf(ch2[i])){ return false; } } return true; } } å“ˆå¸Œè¡¨ class Solution { public boolean isIsomorphic(String s, String t) { Map&lt;Character,Character> map = new HashMap&lt;>(); Map&lt;Character,Character> mapB = new HashMap&lt;>(); for(int i = 0;i&lt;s.length();i++){ if(map.containsKey(s.charAt(i))){ if(t.charAt(i)!=map.get(s.charAt(i))) return false; } if(mapB.containsKey(t.charAt(i))){ if(s.charAt(i)!=mapB.get(t.charAt(i))) return false; } map.put(s.charAt(i),t.charAt(i)); mapB.put(t.charAt(i),s.charAt(i)); } return true; } } æˆ– class Solution { public boolean isIsomorphic(String s, String t) { HashMap&lt;Character,Character> map=new HashMap&lt;>(); for (int i=0;i&lt;s.length();i++){ if (map.containsKey(s.charAt(i))) { if (map.get(s.charAt(i))!=t.charAt(i)) return false; }else{ //ä¸å­˜åœ¨å¯¹åº”çš„é”®ä½†æ˜¯å­˜åœ¨å¯¹åº”çš„å€¼ if (map.containsValue(t.charAt(i))) return false; else map.put(s.charAt(i),t.charAt(i)); } } return true; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode1-ä¸¤æ•°ä¹‹å’Œ","slug":"leetcode1-ä¸¤æ•°ä¹‹å’Œ","date":"2019-12-20T13:41:49.000Z","updated":"2020-02-20T14:55:21.057Z","comments":true,"path":"article/leetcode1-ä¸¤æ•°ä¹‹å’Œ/","link":"","permalink":"https://www.codetool.top/article/leetcode1-%E4%B8%A4%E6%95%B0%E4%B9%8B%E5%92%8C/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡ºå’Œä¸ºç›®æ ‡å€¼çš„é‚£ ä¸¤ä¸ª æ•´æ•°ï¼Œå¹¶è¿”å›ä»–ä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚ ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œä½ ä¸èƒ½é‡å¤åˆ©ç”¨è¿™ä¸ªæ•°ç»„ä¸­åŒæ ·çš„å…ƒç´ ã€‚ ç¤ºä¾‹: ç»™å®š nums = [2, 7, 11, 15], target = 9å› ä¸º nums[0] + nums[1] = 2 + 7 = 9æ‰€ä»¥è¿”å› [0, 1] 2 è§£æ³•2.1 æ€æƒ³éå†ä¸€æ¬¡æ•°ç»„ï¼Œæ¯æ¬¡åœ¨å“ˆå¸Œè¡¨ä¸­å°†target-å½“å‰æ•°çš„å€¼å’Œå½“å‰ä¸‹æ ‡å…³è”èµ·æ¥ï¼Œåˆ™ä¹‹åé‡åˆ°çš„å€¼å¦‚æœåœ¨å“ˆå¸Œè¡¨ä¸­å­˜åœ¨ï¼Œå°±èƒ½å¾—åˆ°å‰é¢çš„ä¸‹æ ‡ã€‚ 2.2 ä»£ç class Solution { public int[] twoSum(int[] nums, int target) { Map&lt;Integer,Integer> map = new HashMap&lt;>(); for(int i = 0;i&lt;nums.length;i++){ if(map.containsKey(nums[i])) { return new int[]{map.get(nums[i]),i}; } map.put(target-nums[i],i); } return null; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"ä»Šå¤©æ˜¯æˆ‘å†™åšå®¢å†å²ä¸Šæœ€é»‘æš—çš„ä¸€å¤©","slug":"ä»Šå¤©æ˜¯æˆ‘å†™åšå®¢å†å²ä¸Šæœ€é»‘æš—çš„ä¸€å¤©","date":"2019-12-19T08:27:09.000Z","updated":"2019-12-19T08:44:32.468Z","comments":true,"path":"article/ä»Šå¤©æ˜¯æˆ‘å†™åšå®¢å†å²ä¸Šæœ€é»‘æš—çš„ä¸€å¤©/","link":"","permalink":"https://www.codetool.top/article/%E4%BB%8A%E5%A4%A9%E6%98%AF%E6%88%91%E5%86%99%E5%8D%9A%E5%AE%A2%E5%8E%86%E5%8F%B2%E4%B8%8A%E6%9C%80%E9%BB%91%E6%9A%97%E7%9A%84%E4%B8%80%E5%A4%A9/","excerpt":"","text":"ç”±äºæˆ‘åšå®¢ä¸­çš„å›¾ç‰‡ä¸€ç›´æ˜¯æ”¾åœ¨äº†ä¸€ä¸ªå…¬å…±å›¾åºŠä¸Šï¼Œè¿™å‡ å¤©æˆ‘è¿™è¾¹åŠ è½½åšå®¢ä¸­çš„å›¾ç‰‡æœ‰ç‚¹åŠ è½½ä¸å‡ºæ¥ï¼Œå†åŠ ä¸Šå„ç§å› ç´ è€ƒè™‘ï¼Œæ‰“ç®—å°†æˆ‘åšå®¢ä¸­çš„å›¾ç‰‡å…¨éƒ¨è½¬åˆ°æˆ‘è‡ªå·±æœåŠ¡å™¨é‡Œé¢æ¥ã€‚ å½“ç„¶ï¼Œæ‰‹åŠ¨ä¸€ç¯‡ä¸€ç¯‡æ‰¾åšå®¢ä¸­çš„å›¾ç‰‡é“¾æ¥ï¼Œç„¶åä¸Šä¼ åˆ°è‡ªå·±çš„æœåŠ¡å™¨çš„å·¥ä½œé‡è‚¯å®šæ˜¯éå¸¸å¤§çš„ã€‚äºæ˜¯æˆ‘æƒ³åˆ°äº†ç”¨pythonè¿™ä¸ªå°åŠ©æ‰‹ï¼ˆç¡®å®æ²¡æƒ³åˆ°åæ¥æˆ‘çš„å·¥ä½œé‡æ›´å¤§äº†ğŸ˜€ï¼‰ æˆ‘çš„ä¸»è¦éœ€æ±‚å°±æ˜¯ï¼Œæ‰¾å‡ºæˆ‘åšå®¢ç›®å½•ä¸‹æ‰€æœ‰markdownæ–‡ä»¶ä¸­ä¿å­˜åœ¨å…¬å…±å›¾åºŠä¸Šçš„å›¾ç‰‡é“¾æ¥ï¼Œç„¶åä¸Šä¼ åˆ°è‡ªå·±çš„æœåŠ¡å™¨ï¼Œè·å–å›¾ç‰‡é“¾æ¥ï¼Œç„¶åæ›¿æ¢æ‰åŸæ¥çš„é“¾æ¥ã€‚ æœ€åå†™å‡ºæ¥åº”è¯¥æ˜¯è¿™æ ·çš„ï¼ˆä¸ºäº†æˆ‘çš„apiå®‰å…¨å°±ä¸å±•ç¤ºæ‰€æœ‰ä»£ç äº†ï¼‰ import os import re url = ''# æˆ‘çš„å›¾åºŠapi pattern = re.compile(r'https://s2\\S+\\.png')# æ­£åˆ™åŒ¹é…æˆ‘åŸæ¥çš„å›¾åºŠé“¾æ¥ for dirName, subdirList, fileList in os.walk(\"./\"): print('Folder: %s' % dirName) for fname in fileList: if fname != '': # æ’é™¤æ‰ä¸€äº›æ–‡ä»¶ï¼Œæˆ–åªé€‰æ‹©mdæ–‡ä»¶ print(\"æ­£åœ¨å¤„ç†\"+fname+\"æ–‡ä»¶\") fp = open(dirName+\"/\"+fname,\"r+\",encoding='utf-8') content = fp.read() result = re.findall(pattern,content) for imgUrl in result: print(\"æ£€æµ‹åˆ°å›¾ç‰‡ï¼š\"+imgUrl) # # # replaceUrl = '' # ä¸Šä¼ åˆ°è‡ªå·±æœåŠ¡å™¨ï¼Œè·å–replaceUrl content = content.replace(imgUrl,replaceUrl) fp = open(dirName + \"/\" + fname, \"w+\", encoding='utf-8') fp.write(content) print(\"æ›¿æ¢æˆåŠŸ\") é‚£ä¹ˆï¼Œæˆ‘çŠ¯äº†ä¸ªä»€ä¹ˆé”™è¯¯å‘¢ğŸ˜€ for fname in fileList: if fname != '': print(\"æ­£åœ¨å¤„ç†\"+fname+\"æ–‡ä»¶\") fp = open(dirName+\"/\"+fname,\"w+\",encoding='utf-8') # w+å“¦ content = fp.read() æ²¡é”™å°±æ˜¯è¦è¯»çš„æ—¶å€™æ‰“å¼€çš„æ–¹å¼å†™æˆäº†w+ ç„¶åå°±ç›´æ¥è¿è¡Œäº†ğŸ˜€ åæœå°±æ˜¯å“ˆéº»æ‰¹æˆ‘markdownæºæ–‡ä»¶å…¨å˜æˆç©ºç™½çš„äº†ã€‚ ç„¶åæˆ‘å°±èŠ±äº†å‡ ä¸ªå°æ—¶ä»æˆ‘ç½‘ç«™ä¸Šä¸€ä¸ªä¸€ä¸ªç½‘é¡µåœ°æŠŠä»–ä»¬å†™å›markdownæºæ–‡ä»¶ã€‚ å¦‚æœç°åœ¨æŸç¯‡åšå®¢é‡Œæœ‰ä»€ä¹ˆé”™è¯¯ï¼Œå¾ˆæœ‰å¯èƒ½å°±æ˜¯æˆ‘æ²¡ä»”ç»†æ£€æŸ¥ã€‚ çœŸæ˜¯å†™åšå®¢å†å²ä¸Šæœ€é»‘æš—çš„ä¸€å¤©ğŸ˜€","categories":[{"name":"æ—¥å¸¸/éšç¬”","slug":"æ—¥å¸¸-éšç¬”","permalink":"https://www.codetool.top/categories/%E6%97%A5%E5%B8%B8-%E9%9A%8F%E7%AC%94/"}],"tags":[{"name":"æ—¥å¸¸","slug":"æ—¥å¸¸","permalink":"https://www.codetool.top/tags/%E6%97%A5%E5%B8%B8/"}]},{"title":"leetcode136-åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—","slug":"leetcode136-åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—","date":"2019-12-18T10:05:23.000Z","updated":"2020-02-20T14:55:21.056Z","comments":true,"path":"article/leetcode136-åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—/","link":"","permalink":"https://www.codetool.top/article/leetcode136-%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E6%95%B0%E5%AD%97/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªéç©ºæ•´æ•°æ•°ç»„ï¼Œé™¤äº†æŸä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ä»¥å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ã€‚ è¯´æ˜ï¼š ä½ çš„ç®—æ³•åº”è¯¥å…·æœ‰çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚ ä½ å¯ä»¥ä¸ä½¿ç”¨é¢å¤–ç©ºé—´æ¥å®ç°å—ï¼Ÿ è¾“å…¥ï¼š [2,2,1]è¾“å‡ºï¼š 1 ç¤ºä¾‹2ï¼š è¾“å…¥ï¼š [4,1,2,1,2]è¾“å‡ºï¼š 4 2 è§£æ³•2.1 æ€æƒ³ å“ˆå¸Œé›†ç¬¬ä¸€æ¬¡å‡ºç°åŠ åˆ°é›†åˆä¸­ï¼Œç¬¬äºŒæ¬¡å‡ºç°ä»é›†åˆä¸­åˆ é™¤ï¼Œæœ€åé›†åˆä¸­å‰©ä¸‹çš„é‚£ä¸ªå…ƒç´ å³ä¸ºåªå‡ºç°ä¸€æ¬¡çš„æ•°ã€‚ äº¦æˆ– ä¸¤ä¸ªç›¸åŒçš„æ•°äº¦æˆ–çš„ç»“æœä¸º0 0å’Œnäº¦æˆ–çš„ç»“æœä¸ºn=&gt; åˆ™æ‰€æœ‰æ•°äº¦æˆ–çš„ç»“æœå³ä¸ºåªå‡ºç°ä¸€æ¬¡çš„æ•°ã€‚ 2.2 ä»£ç  å“ˆå¸Œé›† class Solution { public int singleNumber(int[] nums) { Set&lt;Integer> set = new HashSet&lt;>(); for(int i:nums){ if(set.contains(i)) set.remove(i); else set.add(i); } for(int i:nums){ if(set.contains(i)) return i; } return 0; } } äº¦æˆ– class Solution { public int singleNumber(int[] nums) { int i,res=0; for(i=0;i&lt;nums.length;i++){ res=res^nums[i]; } return res; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode202-å¿«ä¹æ•°","slug":"leetcode202-å¿«ä¹æ•°","date":"2019-12-18T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode202-å¿«ä¹æ•°/","link":"","permalink":"https://www.codetool.top/article/leetcode202-%E5%BF%AB%E4%B9%90%E6%95%B0/","excerpt":"","text":"1 åŸé¢˜ç¼–å†™ä¸€ä¸ªç®—æ³•æ¥åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯â€œå¿«ä¹æ•°â€ã€‚ ä¸€ä¸ªâ€œå¿«ä¹æ•°â€å®šä¹‰ä¸ºï¼šå¯¹äºä¸€ä¸ªæ­£æ•´æ•°ï¼Œæ¯ä¸€æ¬¡å°†è¯¥æ•°æ›¿æ¢ä¸ºå®ƒæ¯ä¸ªä½ç½®ä¸Šçš„æ•°å­—çš„å¹³æ–¹å’Œï¼Œç„¶åé‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°è¿™ä¸ªæ•°å˜ä¸º 1ï¼Œä¹Ÿå¯èƒ½æ˜¯æ— é™å¾ªç¯ä½†å§‹ç»ˆå˜ä¸åˆ° 1ã€‚å¦‚æœå¯ä»¥å˜ä¸º 1ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å°±æ˜¯å¿«ä¹æ•°ã€‚ ç¤ºä¾‹ï¼š è¾“å…¥ï¼š 19è¾“å‡ºï¼š trueè§£é‡Š:12 + 92 = 8282 + 22 = 6862 + 82 = 10012 + 02 + 02 = 1 2 è§£æ³•2.1 æ€æƒ³é€’å½’æ±‚è§£ï¼Œå½“æ¯ä¸€ä½ä¸Šçš„æ•°å­—çš„å¹³æ–¹ä¹‹å’Œä¸º1æ—¶è¿”å›trueï¼Œå¦åˆ™é€’å½’è®¡ç®—å…¶å’Œã€‚ä¸æ˜¯1çš„å’Œå¯ä»¥è®¡å…¥å“ˆå¸Œé›†ä¸­ï¼Œé¿å…é‡å¤é‡åˆ°ã€‚ 2.2 ä»£ç class Solution { Set&lt;Integer> set = new HashSet&lt;>(); public boolean isHappy(int n) { int sum = 0; char[] nums = String.valueOf(n).toCharArray(); int num = 0; for(char i:nums){ //è·å–æ¯ä¸€ä½ä¸Šçš„æ•°å­— num = i-48; sum += num * num; } if(sum==1) return true; if(set.contains(sum)) return false; set.add(sum); return isHappy(sum); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode217-å­˜åœ¨é‡å¤å…ƒç´ ","slug":"leetcode217-å­˜åœ¨é‡å¤å…ƒç´ ","date":"2019-12-18T10:05:23.000Z","updated":"2020-02-20T14:55:21.053Z","comments":true,"path":"article/leetcode217-å­˜åœ¨é‡å¤å…ƒç´ /","link":"","permalink":"https://www.codetool.top/article/leetcode217-%E5%AD%98%E5%9C%A8%E9%87%8D%E5%A4%8D%E5%85%83%E7%B4%A0/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨é‡å¤å…ƒç´ ã€‚ å¦‚æœä»»ä½•å€¼åœ¨æ•°ç»„ä¸­å‡ºç°è‡³å°‘ä¸¤æ¬¡ï¼Œå‡½æ•°è¿”å› trueã€‚å¦‚æœæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ éƒ½ä¸ç›¸åŒï¼Œåˆ™è¿”å› falseã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥ï¼š [1,2,3,1]è¾“å‡ºï¼š true ç¤ºä¾‹2ï¼š è¾“å…¥ï¼š [1,2,3,4]è¾“å‡ºï¼š false ç¤ºä¾‹3ï¼š è¾“å…¥ï¼š [1,1,1,3,3,4,3,2,4,2]è¾“å‡ºï¼š true 2 è§£æ³•2.1 æ€æƒ³å“ˆå¸Œé›† 2.2 ä»£ç class Solution { public boolean containsDuplicate(int[] nums) { Set&lt;Integer> set = new HashSet&lt;>(); for(int i:nums){ if(set.contains(i)) return true; set.add(i); } return false; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode705-è®¾è®¡å“ˆå¸Œé›†åˆ","slug":"leetcode705-è®¾è®¡å“ˆå¸Œé›†åˆ","date":"2019-12-18T10:05:23.000Z","updated":"2020-02-20T14:55:21.052Z","comments":true,"path":"article/leetcode705-è®¾è®¡å“ˆå¸Œé›†åˆ/","link":"","permalink":"https://www.codetool.top/article/leetcode705-%E8%AE%BE%E8%AE%A1%E5%93%88%E5%B8%8C%E9%9B%86%E5%90%88/","excerpt":"","text":"1 åŸé¢˜ä¸ä½¿ç”¨ä»»ä½•å†…å»ºçš„å“ˆå¸Œè¡¨åº“è®¾è®¡ä¸€ä¸ªå“ˆå¸Œé›†åˆ å…·ä½“åœ°è¯´ï¼Œä½ çš„è®¾è®¡åº”è¯¥åŒ…å«ä»¥ä¸‹çš„åŠŸèƒ½ add(value)ï¼šå‘å“ˆå¸Œé›†åˆä¸­æ’å…¥ä¸€ä¸ªå€¼ã€‚ contains(value) ï¼šè¿”å›å“ˆå¸Œé›†åˆä¸­æ˜¯å¦å­˜åœ¨è¿™ä¸ªå€¼ã€‚ remove(value)ï¼šå°†ç»™å®šå€¼ä»å“ˆå¸Œé›†åˆä¸­åˆ é™¤ã€‚å¦‚æœå“ˆå¸Œé›†åˆä¸­æ²¡æœ‰è¿™ä¸ªå€¼ï¼Œä»€ä¹ˆä¹Ÿä¸åšã€‚ ç¤ºä¾‹ï¼š MyHashSet hashSet = new MyHashSet();hashSet.add(1);hashSet.add(2);hashSet.contains(1); // è¿”å› truehashSet.contains(3); // è¿”å› false (æœªæ‰¾åˆ°)hashSet.add(2);hashSet.contains(2); // è¿”å› truehashSet.remove(2);hashSet.contains(2); // è¿”å› false (å·²ç»è¢«åˆ é™¤) æ³¨æ„: æ‰€æœ‰çš„å€¼éƒ½åœ¨ [0, 1000000]çš„èŒƒå›´å†…ã€‚ æ“ä½œçš„æ€»æ•°ç›®åœ¨[1, 10000]èŒƒå›´å†…ã€‚ ä¸è¦ä½¿ç”¨å†…å»ºçš„å“ˆå¸Œé›†åˆåº“ã€‚ 2 è§£æ³•2.1 æ€æƒ³å·æ‡’ï¼Œå·²çŸ¥å€¼çš„èŒƒå›´ï¼Œç›´æ¥å°†æ•´æ•°å€¼æ˜ å°„ä¸ºå“ˆå¸Œå€¼ï¼Œæœ‰å¤šå°‘ä¸ªå“ˆå¸Œå€¼å»ºå¤šå°‘ä¸ªæ¡¶ï¼Œç”¨ç©ºé—´æ¢æ—¶é—´ã€‚ 2.2 ä»£ç class MyHashSet { boolean[] exist; /** Initialize your data structure here. */ public MyHashSet() { exist = new boolean[1000001]; } public void add(int key) { exist[key] = true; } public void remove(int key) { exist[key] = false; } /** Returns true if this set contains the specified element */ public boolean contains(int key) { return exist[key]; } } /** * Your MyHashSet object will be instantiated and called as such: * MyHashSet obj = new MyHashSet(); * obj.add(key); * obj.remove(key); * boolean param_3 = obj.contains(key); */","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"}]},{"title":"leetcode706-è®¾è®¡å“ˆå¸Œæ˜ å°„","slug":"leetcode706-è®¾è®¡å“ˆå¸Œæ˜ å°„","date":"2019-12-18T10:05:23.000Z","updated":"2020-02-20T14:55:21.052Z","comments":true,"path":"article/leetcode706-è®¾è®¡å“ˆå¸Œæ˜ å°„/","link":"","permalink":"https://www.codetool.top/article/leetcode706-%E8%AE%BE%E8%AE%A1%E5%93%88%E5%B8%8C%E6%98%A0%E5%B0%84/","excerpt":"","text":"1 åŸé¢˜ä¸ä½¿ç”¨ä»»ä½•å†…å»ºçš„å“ˆå¸Œè¡¨åº“è®¾è®¡ä¸€ä¸ªå“ˆå¸Œæ˜ å°„ å…·ä½“åœ°è¯´ï¼Œä½ çš„è®¾è®¡åº”è¯¥åŒ…å«ä»¥ä¸‹çš„åŠŸèƒ½ put(key, value)ï¼šå‘å“ˆå¸Œæ˜ å°„ä¸­æ’å…¥(é”®,å€¼)çš„æ•°å€¼å¯¹ã€‚å¦‚æœé”®å¯¹åº”çš„å€¼å·²ç»å­˜åœ¨ï¼Œæ›´æ–°è¿™ä¸ªå€¼ã€‚ get(key)ï¼šè¿”å›ç»™å®šçš„é”®æ‰€å¯¹åº”çš„å€¼ï¼Œå¦‚æœæ˜ å°„ä¸­ä¸åŒ…å«è¿™ä¸ªé”®ï¼Œè¿”å›-1ã€‚ remove(key)ï¼šå¦‚æœæ˜ å°„ä¸­å­˜åœ¨è¿™ä¸ªé”®ï¼Œåˆ é™¤è¿™ä¸ªæ•°å€¼å¯¹ã€‚ ç¤ºä¾‹ï¼š MyHashMap hashMap = new MyHashMap();hashMap.put(1, 1);hashMap.put(2, 2);hashMap.get(1); // è¿”å› 1hashMap.get(3); // è¿”å› -1 (æœªæ‰¾åˆ°)hashMap.put(2, 1); // æ›´æ–°å·²æœ‰çš„å€¼hashMap.get(2); // è¿”å› 1hashMap.remove(2); // åˆ é™¤é”®ä¸º2çš„æ•°æ®hashMap.get(2); // è¿”å› -1 (æœªæ‰¾åˆ°) æ³¨æ„: æ‰€æœ‰çš„å€¼éƒ½åœ¨ [0, 1000000]çš„èŒƒå›´å†…ã€‚ æ“ä½œçš„æ€»æ•°ç›®åœ¨[1, 10000]èŒƒå›´å†…ã€‚ ä¸è¦ä½¿ç”¨å†…å»ºçš„å“ˆå¸Œåº“ã€‚ 2 è§£æ³•2.1 æ€æƒ³å·æ‡’ï¼Œå·²çŸ¥å€¼çš„èŒƒå›´ï¼Œç›´æ¥å°†æ•´æ•°å€¼æ˜ å°„ä¸ºå“ˆå¸Œå€¼ï¼Œæœ‰å¤šå°‘ä¸ªå“ˆå¸Œå€¼å»ºå¤šå°‘ä¸ªæ¡¶ï¼Œç”¨ç©ºé—´æ¢æ—¶é—´ã€‚ï¼ˆè¿™é‡Œæ—¶é—´ä¹Ÿæ¢ä¸äº†äº†ï¼Œæ¯•ç«Ÿç»™1000000ä¸ªå…ƒç´ èµ‹åˆå€¼è¿˜æ˜¯æŒºè€—æ—¶é—´çš„ï¼‰ 2.2 ä»£ç class MyHashMap { int[] values; /** Initialize your data structure here. */ public MyHashMap() { values = new int[1000001]; Arrays.fill(values, -1); } /** value will always be non-negative. */ public void put(int key, int value) { values[key] = value; } /** Returns the value to which the specified key is mapped, or -1 if this map contains no mapping for the key */ public int get(int key) { return values[key]; } /** Removes the mapping of the specified value key if this map contains a mapping for the key */ public void remove(int key) { values[key] = -1; } } /** * Your MyHashMap object will be instantiated and called as such: * MyHashMap obj = new MyHashMap(); * obj.put(key,value); * int param_2 = obj.get(key); * obj.remove(key); */","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"}]},{"title":"leetcode138-å¤åˆ¶å¸¦éšæœºæŒ‡é’ˆçš„é“¾è¡¨","slug":"leetcode138-å¤åˆ¶å¸¦éšæœºæŒ‡é’ˆçš„é“¾è¡¨","date":"2019-12-17T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode138-å¤åˆ¶å¸¦éšæœºæŒ‡é’ˆçš„é“¾è¡¨/","link":"","permalink":"https://www.codetool.top/article/leetcode138-%E5%A4%8D%E5%88%B6%E5%B8%A6%E9%9A%8F%E6%9C%BA%E6%8C%87%E9%92%88%E7%9A%84%E9%93%BE%E8%A1%A8/","excerpt":"","text":"è¿™é“é¢˜å’Œleetcode133-å…‹éš†å›¾æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ã€‚ 1 åŸé¢˜ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªé¢å¤–å¢åŠ çš„éšæœºæŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆå¯ä»¥æŒ‡å‘é“¾è¡¨ä¸­çš„ä»»ä½•èŠ‚ç‚¹æˆ–ç©ºèŠ‚ç‚¹ã€‚ è¦æ±‚è¿”å›è¿™ä¸ªé“¾è¡¨çš„æ·±æ‹·è´ã€‚ ç¤ºä¾‹ï¼š è¾“å…¥:{â€œ$idâ€:â€1â€,â€nextâ€:{â€œ$idâ€:â€2â€,â€nextâ€:null,â€randomâ€:{â€œ$refâ€:â€2â€},â€valâ€:2},â€randomâ€:{â€œ$refâ€:â€2â€},â€valâ€:1} è§£é‡Š:èŠ‚ç‚¹ 1 çš„å€¼æ˜¯ 1ï¼Œå®ƒçš„ä¸‹ä¸€ä¸ªæŒ‡é’ˆå’ŒéšæœºæŒ‡é’ˆéƒ½æŒ‡å‘èŠ‚ç‚¹ 2 ã€‚èŠ‚ç‚¹ 2 çš„å€¼æ˜¯ 2ï¼Œå®ƒçš„ä¸‹ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ nullï¼ŒéšæœºæŒ‡é’ˆæŒ‡å‘å®ƒè‡ªå·±ã€‚ æç¤º: ä½ å¿…é¡»è¿”å›ç»™å®šå¤´çš„æ‹·è´ä½œä¸ºå¯¹å…‹éš†åˆ—è¡¨çš„å¼•ç”¨ã€‚ 2 è§£æ³•2.1 æ€æƒ³å’Œleetcode133-å…‹éš†å›¾çš„è§£æ³•ä¸€è‡´ï¼Œç”šè‡³åªéœ€è¦æ”¹å‡ è¡Œä»£ç ã€‚ 2.2 ä»£ç /* // Definition for a Node. class Node { public int val; public Node next; public Node random; public Node() {} public Node(int _val,Node _next,Node _random) { val = _val; next = _next; random = _random; } }; */ class Solution { //hashmapç»´æŒåŸé“¾è¡¨å’Œå…‹éš†é“¾è¡¨ä¹‹é—´èŠ‚ç‚¹çš„å¯¹åº”å…³ç³» Map&lt;Node, Node> lookup; public Node copyRandomList(Node head) { lookup = new HashMap&lt;>(); return dfs(head); } private Node dfs(Node node) { if (node == null) return null; //å­˜åœ¨å¯¹åº”çš„å…‹éš†èŠ‚ç‚¹ç›´æ¥è¿”å› if (lookup.containsKey(node)) return lookup.get(node); //å…ˆåˆ›å»ºå¯¹åº”çš„å…‹éš†èŠ‚ç‚¹ï¼Œnextå’Œrandomåœ¨é€’å½’è¿”å›çš„æ—¶å€™æ·»åŠ ã€‚ Node clone = new Node(node.val,null,null); lookup.put(node, clone); clone.next = dfs(node.next); clone.random = dfs(node.random); return clone; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode2-ä¸¤æ•°ç›¸åŠ ","slug":"leetcode2-ä¸¤æ•°ç›¸åŠ ","date":"2019-12-17T10:05:23.000Z","updated":"2020-02-20T14:55:21.057Z","comments":true,"path":"article/leetcode2-ä¸¤æ•°ç›¸åŠ /","link":"","permalink":"https://www.codetool.top/article/leetcode2-%E4%B8%A4%E6%95%B0%E7%9B%B8%E5%8A%A0/","excerpt":"","text":"1 åŸé¢˜ç»™å‡ºä¸¤ä¸ª éç©º çš„é“¾è¡¨ç”¨æ¥è¡¨ç¤ºä¸¤ä¸ªéè´Ÿçš„æ•´æ•°ã€‚å…¶ä¸­ï¼Œå®ƒä»¬å„è‡ªçš„ä½æ•°æ˜¯æŒ‰ç…§ é€†åº çš„æ–¹å¼å­˜å‚¨çš„ï¼Œå¹¶ä¸”å®ƒä»¬çš„æ¯ä¸ªèŠ‚ç‚¹åªèƒ½å­˜å‚¨ ä¸€ä½ æ•°å­—ã€‚ å¦‚æœï¼Œæˆ‘ä»¬å°†è¿™ä¸¤ä¸ªæ•°ç›¸åŠ èµ·æ¥ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ªæ–°çš„é“¾è¡¨æ¥è¡¨ç¤ºå®ƒä»¬çš„å’Œã€‚ æ‚¨å¯ä»¥å‡è®¾é™¤äº†æ•°å­— 0 ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªæ•°éƒ½ä¸ä¼šä»¥ 0 å¼€å¤´ã€‚ ç¤ºä¾‹ï¼š è¾“å…¥ï¼š (2 -&gt; 4 -&gt; 3) + (5 -&gt; 6 -&gt; 4)è¾“å‡ºï¼š 7 -&gt; 0 -&gt; 8åŸå› ï¼š 342 + 465 = 807 2 è§£æ³•2.1 æ€æƒ³æ¨¡æ‹Ÿæ•°å­¦è§„åˆ™ï¼Œå°†æ¯ä¸€ä½å¯¹åº”çš„å€¼å’Œè¿›ä½ç›¸åŠ ï¼Œå°†nullä¸€èˆ¬åŒ–ä¸º0ã€‚ 2.2 ä»£ç /** * Definition for singly-linked list. * public class ListNode { * int val; * ListNode next; * ListNode(int x) { val = x; } * } */ class Solution { public ListNode addTwoNumbers(ListNode l1, ListNode l2) { ListNode preHead = new ListNode(0); int val1,val2,sum = 0; int carry = 0; ListNode cur = preHead; while(l1!=null || l2!=null || carry != 0){ val1 = l1==null?0:l1.val; val2 = l2==null?0:l2.val; sum = val1+val2+carry; if(sum>=10) { carry = 1; sum -= 10; }else carry = 0; cur.next = new ListNode(sum); cur = cur.next; l1 = l1 == null?null:l1.next; l2 = l2 == null?null:l2.next; } return preHead.next; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode21-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨","slug":"leetcode21-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨","date":"2019-12-17T10:05:23.000Z","updated":"2020-02-20T14:55:21.056Z","comments":true,"path":"article/leetcode21-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨/","link":"","permalink":"https://www.codetool.top/article/leetcode21-%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E9%93%BE%E8%A1%A8/","excerpt":"","text":"1 åŸé¢˜å°†ä¸¤ä¸ªæœ‰åºé“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„æœ‰åºé“¾è¡¨å¹¶è¿”å›ã€‚æ–°é“¾è¡¨æ˜¯é€šè¿‡æ‹¼æ¥ç»™å®šçš„ä¸¤ä¸ªé“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆçš„ã€‚ ç¤ºä¾‹ï¼š è¾“å…¥ï¼š 1-&gt;2-&gt;4, 1-&gt;3-&gt;4è¾“å‡ºï¼š 1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4 2 è§£æ³•2.1 æ€æƒ³æ¯”è¾ƒä¸¤ä¸ªæœ‰åºé“¾è¡¨çš„å¤´æŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼Œå–å…¶ä¸­å€¼æ›´å°çš„è¿æ¥åˆ°ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹åé¢ï¼Œç„¶åè¯¥é“¾è¡¨çš„å¤´æŒ‡é’ˆå‘åç§»ä¸€æ ¼ï¼Œç»§ç»­å’Œå¦ä¸€ä¸ªèŠ‚ç‚¹çš„å¤´æŒ‡é’ˆæ¯”è¾ƒã€‚ 2.2 ä»£ç /** * Definition for singly-linked list. * public class ListNode { * int val; * ListNode next; * ListNode(int x) { val = x; } * } */ class Solution { public ListNode mergeTwoLists(ListNode l1, ListNode l2) { ListNode virtualHead = new ListNode(0); ListNode cur = virtualHead; ListNode min; while(l1!=null || l2 != null){ min = null; if(l1==null || l2!=null&amp;&amp;l1.val>=l2.val){ min = l2; l2 = l2.next; } else if(l2==null || l1!=null&amp;&amp;l2.val>l1.val){ min = l1; l1 = l1.next; } cur.next = min; cur = cur.next; } return virtualHead.next; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode430-æ‰å¹³åŒ–å¤šçº§åŒå‘é“¾è¡¨","slug":"leetcode430-æ‰å¹³åŒ–å¤šçº§åŒå‘é“¾è¡¨","date":"2019-12-17T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode430-æ‰å¹³åŒ–å¤šçº§åŒå‘é“¾è¡¨/","link":"","permalink":"https://www.codetool.top/article/leetcode430-%E6%89%81%E5%B9%B3%E5%8C%96%E5%A4%9A%E7%BA%A7%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8/","excerpt":"","text":"1 åŸé¢˜æ‚¨å°†è·å¾—ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œé™¤äº†ä¸‹ä¸€ä¸ªå’Œå‰ä¸€ä¸ªæŒ‡é’ˆä¹‹å¤–ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªå­æŒ‡é’ˆï¼Œå¯èƒ½æŒ‡å‘å•ç‹¬çš„åŒå‘é“¾è¡¨ã€‚è¿™äº›å­åˆ—è¡¨å¯èƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè‡ªå·±çš„å­é¡¹ï¼Œä¾æ­¤ç±»æ¨ï¼Œç”Ÿæˆå¤šçº§æ•°æ®ç»“æ„ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤ºã€‚ æ‰å¹³åŒ–åˆ—è¡¨ï¼Œä½¿æ‰€æœ‰ç»“ç‚¹å‡ºç°åœ¨å•çº§åŒé“¾è¡¨ä¸­ã€‚æ‚¨å°†è·å¾—åˆ—è¡¨ç¬¬ä¸€çº§çš„å¤´éƒ¨ã€‚ ç¤ºä¾‹ï¼š è¾“å…¥ï¼š1â€”2â€”3â€”4â€”5â€”6â€“NULL | 7â€”8â€”9â€”10â€“NULL | 11â€“12â€“NULL è¾“å‡ºï¼š1-2-3-7-8-11-12-9-10-4-5-6-NULL ä»¥ä¸Šç¤ºä¾‹çš„è¯´æ˜: ç»™å‡ºä»¥ä¸‹å¤šçº§åŒå‘é“¾è¡¨: æˆ‘ä»¬åº”è¯¥è¿”å›å¦‚ä¸‹æ‰€ç¤ºçš„æ‰å¹³åŒå‘é“¾è¡¨: 2 è§£æ³•2.1 æ€æƒ³æ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œå°†æ¯æ¬¡æœ€åä¸€ä¸ªæœç´¢åˆ°èŠ‚ç‚¹è®°å½•ä¸‹æ¥ï¼Œå›æº¯çš„æ—¶å€™èƒ½ç»§ç»­é™„åŠ åœ¨ä¸Šä¸€ä¸ªèŠ‚ç‚¹ä¹‹åã€‚ 2.2 ä»£ç /* // Definition for a Node. class Node { public int val; public Node prev; public Node next; public Node child; }; */ class Solution { Node pre = null; public Node flatten(Node head) { dfs(head); return head; } public void dfs(Node node){ if(node==null) return; Node child = node.child; Node next = node.next; node.child = null; if(pre != null){ pre.next = node; node.prev = pre; } pre = node; dfs(child); dfs(next); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode61-æ—‹è½¬é“¾è¡¨","slug":"leetcode61-æ—‹è½¬é“¾è¡¨","date":"2019-12-17T10:05:23.000Z","updated":"2020-02-20T14:55:21.057Z","comments":true,"path":"article/leetcode61-æ—‹è½¬é“¾è¡¨/","link":"","permalink":"https://www.codetool.top/article/leetcode61-%E6%97%8B%E8%BD%AC%E9%93%BE%E8%A1%A8/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œæ—‹è½¬é“¾è¡¨ï¼Œå°†é“¾è¡¨æ¯ä¸ªèŠ‚ç‚¹å‘å³ç§»åŠ¨ k ä¸ªä½ç½®ï¼Œå…¶ä¸­ k æ˜¯éè´Ÿæ•°ã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥ï¼š 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL, k = 2è¾“å‡ºï¼š 4-&gt;5-&gt;1-&gt;2-&gt;3-&gt;NULLè§£é‡Š:å‘å³æ—‹è½¬ 1 æ­¥: 5-&gt;1-&gt;2-&gt;3-&gt;4-&gt;NULLå‘å³æ—‹è½¬ 2 æ­¥: 4-&gt;5-&gt;1-&gt;2-&gt;3-&gt;NULL ç¤ºä¾‹2ï¼š è¾“å…¥ï¼š 0-&gt;1-&gt;2-&gt;NULL, k = 4è¾“å‡ºï¼š 2-&gt;0-&gt;1-&gt;NULLè§£é‡Š:å‘å³æ—‹è½¬ 1 æ­¥: 2-&gt;0-&gt;1-&gt;NULLå‘å³æ—‹è½¬ 2 æ­¥: 1-&gt;2-&gt;0-&gt;NULLå‘å³æ—‹è½¬ 3 æ­¥: 0-&gt;1-&gt;2-&gt;NULLå‘å³æ—‹è½¬ 4 æ­¥: 2-&gt;0-&gt;1-&gt;NULL 2 è§£æ³•2.1 æ€æƒ³è¿æ¥æˆç¯ï¼Œæ‰¾åˆ°æ–°èµ·ç‚¹å’Œç»ˆç‚¹ã€‚ 2.2 ä»£ç /** * Definition for singly-linked list. * public class ListNode { * int val; * ListNode next; * ListNode(int x) { val = x; } * } */ class Solution { public ListNode rotateRight(ListNode head, int k) { if(head == null) return null; ListNode cur = head; int size = 1; //æ‰¾åˆ°å°¾èŠ‚ç‚¹ while(cur.next!=null){ size++; cur = cur.next; } //è¿æ¥æˆç¯ cur.next = head; //æ‰¾åˆ°æ–°çš„å°¾èŠ‚ç‚¹ for(int i = 0;i&lt;size-(k%size);i++){ cur = cur.next; } //æ–°çš„å¤´èŠ‚ç‚¹ ListNode result = cur.next; cur.next = null; return result; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode203-ç§»é™¤é“¾è¡¨å…ƒç´ ","slug":"leetcode203-ç§»é™¤é“¾è¡¨å…ƒç´ ","date":"2019-12-16T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode203-ç§»é™¤é“¾è¡¨å…ƒç´ /","link":"","permalink":"https://www.codetool.top/article/leetcode203-%E7%A7%BB%E9%99%A4%E9%93%BE%E8%A1%A8%E5%85%83%E7%B4%A0/","excerpt":"","text":"1 åŸé¢˜åˆ é™¤é“¾è¡¨ä¸­ç­‰äºç»™å®šå€¼ val çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚ ç¤ºä¾‹ï¼š è¾“å…¥ï¼š 1-&gt;2-&gt;6-&gt;3-&gt;4-&gt;5-&gt;6, val = 6è¾“å‡ºï¼š 1-&gt;2-&gt;3-&gt;4-&gt;5 2 è§£æ³•2.1 æ€æƒ³preæŒ‡é’ˆåœç•™åœ¨valå‡ºç°ä¹‹å‰ï¼ŒcuræŒ‡é’ˆè¶Šè¿‡valï¼Œè®©preçš„nextæŒ‡å‘curã€‚ä¸ºäº†å¤„ç†å‡ºç°å¤´èŠ‚ç‚¹è¢«åˆ é™¤çš„ç‰¹æ®Šæƒ…å†µï¼Œå¢åŠ ä¸€ä¸ªè™šæ‹Ÿå¤´èŠ‚ç‚¹ã€‚ 2.2 ä»£ç /** * Definition for singly-linked list. * public class ListNode { * int val; * ListNode next; * ListNode(int x) { val = x; } * } */ class Solution { public ListNode removeElements(ListNode head, int val) { ListNode newHead = new ListNode(0); newHead.next = head; ListNode cur = head; ListNode pre = newHead; while(cur!=null){ if(cur.val!=val){ pre.next = cur; pre = cur; } cur = cur.next; } pre.next = cur; return newHead.next; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode206-åè½¬é“¾è¡¨","slug":"leetcode206-åè½¬é“¾è¡¨","date":"2019-12-16T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode206-åè½¬é“¾è¡¨/","link":"","permalink":"https://www.codetool.top/article/leetcode206-%E5%8F%8D%E8%BD%AC%E9%93%BE%E8%A1%A8/","excerpt":"","text":"1 åŸé¢˜åè½¬ä¸€ä¸ªå•é“¾è¡¨ã€‚ ç¤ºä¾‹ï¼š è¾“å…¥ï¼š 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULLè¾“å‡ºï¼š 5-&gt;4-&gt;3-&gt;2-&gt;1-&gt;NULL è¿›é˜¶ï¼š ä½ å¯ä»¥è¿­ä»£æˆ–é€’å½’åœ°åè½¬é“¾è¡¨ã€‚ä½ èƒ½å¦ç”¨ä¸¤ç§æ–¹æ³•è§£å†³è¿™é“é¢˜ï¼Ÿ 2 è§£æ³•2.1 æ€æƒ³ è¿­ä»£ï¼ˆä¸¤ç§è§£æ³•ï¼‰ åŒæŒ‡é’ˆ æ—‹è½¬å‰åŠéƒ¨åˆ†curå…¶å®å°±æ˜¯head é€’å½’ä»æœ€åä¸€ä¸ªèŠ‚ç‚¹å¼€å§‹å›æº¯ï¼Œå°†ç®­å¤´å€’ç½®ã€‚ 2.2 ä»£ç è¿­ä»£ï¼š åŒæŒ‡é’ˆ(ä½œè€…ï¼šç‹å°¼ç›) class Solution { public ListNode reverseList(ListNode head) { //ç”³è¯·èŠ‚ç‚¹ï¼Œpreå’Œ curï¼ŒpreæŒ‡å‘null ListNode pre = null; ListNode cur = head; ListNode tmp = null; while(cur!=null) { //è®°å½•å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ tmp = cur.next; //ç„¶åå°†å½“å‰èŠ‚ç‚¹æŒ‡å‘pre cur.next = pre; //preå’ŒcurèŠ‚ç‚¹éƒ½å‰è¿›ä¸€ä½ pre = cur; cur = tmp; } return pre; } } æ—‹è½¬å‰åŠéƒ¨åˆ† /** * Definition for singly-linked list. * public class ListNode { * int val; * ListNode next; * ListNode(int x) { val = x; } * } */ class Solution { public ListNode reverseList(ListNode head) { ListNode newHead = head; ListNode cur = head; if(head == null) return null; while(cur.next != null){ //è®°å½•ä¸åŠ¨çš„èŠ‚ç‚¹ ListNode follow = cur.next.next; //å‰åŠéƒ¨åˆ†è¿æˆç¯ cur.next.next = newHead; newHead = cur.next; //å°†curè¿åˆ°ååŠéƒ¨åˆ†ä¸Š cur.next = follow; } return newHead; } } é€’å½’ï¼š /** * Definition for singly-linked list. * public class ListNode { * int val; * ListNode next; * ListNode(int x) { val = x; } * } */ class Solution { public ListNode reverseList(ListNode head) { //ä»æœ€åä¸€ä¸ªèŠ‚ç‚¹å›æº¯ if(head==null||head.next==null){ return head; } ListNode node = reverseList(head.next); //å°†headå’Œhead.nextä¹‹é—´çš„ç®­å¤´åè½¬ head.next.next = head; head.next = null; return node; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode234-å›æ–‡é“¾è¡¨","slug":"leetcode234-å›æ–‡é“¾è¡¨","date":"2019-12-16T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode234-å›æ–‡é“¾è¡¨/","link":"","permalink":"https://www.codetool.top/article/leetcode234-%E5%9B%9E%E6%96%87%E9%93%BE%E8%A1%A8/","excerpt":"","text":"1 åŸé¢˜è¯·åˆ¤æ–­ä¸€ä¸ªé“¾è¡¨æ˜¯å¦ä¸ºå›æ–‡é“¾è¡¨ã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥ï¼š 1-&gt;2è¾“å‡ºï¼š false ç¤ºä¾‹2ï¼š è¾“å…¥ï¼š 1-&gt;2-&gt;2-&gt;1è¾“å‡ºï¼š true è¿›é˜¶: ä½ èƒ½å¦ç”¨ O(n) æ—¶é—´å¤æ‚åº¦å’Œ O(1) ç©ºé—´å¤æ‚åº¦è§£å†³æ­¤é¢˜ï¼Ÿ 2 è§£æ³•2.1 æ€æƒ³åŒæŒ‡é’ˆè§£æ³•ï¼šä¸€ä¸ªå¿«æŒ‡é’ˆä¸€ä¸ªæ…¢æŒ‡é’ˆï¼Œå¿«æŒ‡é’ˆæ¯æ¬¡ç§»ä¸¤æ­¥ï¼Œæ…¢æŒ‡é’ˆæ¯æ¬¡ç§»ä¸€æ­¥ï¼Œè¿™æ ·å¿«æŒ‡é’ˆçš„è½ç‚¹æœ‰ä¸¤ç§æƒ…å†µï¼š è½åœ¨æœ€åä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ­¤æ—¶é“¾è¡¨èŠ‚ç‚¹ä¸ºå¥‡æ•°ä¸ªï¼Œæ…¢æŒ‡é’ˆè½åœ¨ä¸­é—´èŠ‚ç‚¹ä¸Šã€‚ è½åœ¨æœ€åä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘çš„nullä¸Šï¼Œæ­¤æ—¶é“¾è¡¨èŠ‚ç‚¹ä¸ºå¶æ•°ä¸ªï¼Œæ…¢æŒ‡é’ˆè½åœ¨ä¸­é—´é å³ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚ æ…¢æŒ‡é’ˆå°†é“¾è¡¨åˆ†æˆäº†ä¸¤åŠï¼Œå°†å‰åŠéƒ¨åˆ†åè½¬ï¼Œå†ä¸ååŠéƒ¨åˆ†æ¯”è¾ƒï¼Œå³å¯è·å–ç»“æœ 2.2 ä»£ç /** * Definition for singly-linked list. * public class ListNode { * int val; * ListNode next; * ListNode(int x) { val = x; } * } */ public boolean isPalindrome(ListNode head) { if(head == null || head.next == null) { return true; } ListNode slow = head, fast = head; ListNode pre = head, prepre = null; while(fast != null &amp;&amp; fast.next != null) { pre = slow; slow = slow.next; fast = fast.next.next; pre.next = prepre; prepre = pre; } //é“¾è¡¨èŠ‚ç‚¹ä¸ªæ•°ä¸ºå¥‡æ•° if(fast != null) { slow = slow.next; } while(pre != null &amp;&amp; slow != null) { if(pre.val != slow.val) { return false; } pre = pre.next; slow = slow.next; } return true; }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode328-å¥‡å¶é“¾è¡¨","slug":"leetcode328-å¥‡å¶é“¾è¡¨","date":"2019-12-16T10:05:23.000Z","updated":"2020-02-20T14:55:21.053Z","comments":true,"path":"article/leetcode328-å¥‡å¶é“¾è¡¨/","link":"","permalink":"https://www.codetool.top/article/leetcode328-%E5%A5%87%E5%81%B6%E9%93%BE%E8%A1%A8/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªå•é“¾è¡¨ï¼ŒæŠŠæ‰€æœ‰çš„å¥‡æ•°èŠ‚ç‚¹å’Œå¶æ•°èŠ‚ç‚¹åˆ†åˆ«æ’åœ¨ä¸€èµ·ã€‚è¯·æ³¨æ„ï¼Œè¿™é‡Œçš„å¥‡æ•°èŠ‚ç‚¹å’Œå¶æ•°èŠ‚ç‚¹æŒ‡çš„æ˜¯èŠ‚ç‚¹ç¼–å·çš„å¥‡å¶æ€§ï¼Œè€Œä¸æ˜¯èŠ‚ç‚¹çš„å€¼çš„å¥‡å¶æ€§ã€‚ è¯·å°è¯•ä½¿ç”¨åŸåœ°ç®—æ³•å®Œæˆã€‚ä½ çš„ç®—æ³•çš„ç©ºé—´å¤æ‚åº¦åº”ä¸º O(1)ï¼Œæ—¶é—´å¤æ‚åº¦åº”ä¸º O(nodes)ï¼Œnodes ä¸ºèŠ‚ç‚¹æ€»æ•°ã€‚ ç¤ºä¾‹1ï¼š è¾“å…¥ï¼š 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULLè¾“å‡ºï¼š 1-&gt;3-&gt;5-&gt;2-&gt;4-&gt;NULL ç¤ºä¾‹2ï¼š è¾“å…¥ï¼š 2-&gt;1-&gt;3-&gt;5-&gt;6-&gt;4-&gt;7-&gt;NULLè¾“å‡ºï¼š 2-&gt;3-&gt;6-&gt;7-&gt;1-&gt;5-&gt;4-&gt;NULL è¯´æ˜: åº”å½“ä¿æŒå¥‡æ•°èŠ‚ç‚¹å’Œå¶æ•°èŠ‚ç‚¹çš„ç›¸å¯¹é¡ºåºã€‚ é“¾è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹è§†ä¸ºå¥‡æ•°èŠ‚ç‚¹ï¼Œç¬¬äºŒä¸ªèŠ‚ç‚¹è§†ä¸ºå¶æ•°èŠ‚ç‚¹ï¼Œä»¥æ­¤ç±»æ¨ã€‚ 2 è§£æ³•2.1 æ€æƒ³1åé¢åªè¿æ¥å¥‡æ•°ï¼Œ2åé¢åªè¿æ¥å¶æ•°ï¼Œæœ€ååˆäºŒä¸ºä¸€ã€‚ 2.2 ä»£ç /** * Definition for singly-linked list. * public class ListNode { * int val; * ListNode next; * ListNode(int x) { val = x; } * } */ class Solution { public ListNode oddEvenList(ListNode head) { if(head == null || head.next == null) return head; ListNode oddCur=head; ListNode evenCur=head.next; ListNode evenHead = head.next; ListNode cur=evenCur.next; while(cur!=null){ oddCur.next = cur; oddCur = cur; if(cur.next!=null){ evenCur.next = cur.next; evenCur = cur.next; cur = cur.next.next; }else break; } evenCur.next = null; oddCur.next = evenHead; return head; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode19-åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹","slug":"leetcode19-åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹","date":"2019-12-15T10:05:23.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode19-åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹/","link":"","permalink":"https://www.codetool.top/article/leetcode19-%E5%88%A0%E9%99%A4%E9%93%BE%E8%A1%A8%E7%9A%84%E5%80%92%E6%95%B0%E7%AC%ACN%E4%B8%AA%E8%8A%82%E7%82%B9/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œåˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ n ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”è¿”å›é“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚ ç¤ºä¾‹: ç»™å®šä¸€ä¸ªé“¾è¡¨: 1-&gt;2-&gt;3-&gt;4-&gt;5, å’Œ n = 2. å½“åˆ é™¤äº†å€’æ•°ç¬¬äºŒä¸ªèŠ‚ç‚¹åï¼Œé“¾è¡¨å˜ä¸º 1-&gt;2-&gt;3-&gt;5. è¯´æ˜: ç»™å®šçš„ n ä¿è¯æ˜¯æœ‰æ•ˆçš„ã€‚ è¿›é˜¶: ä½ èƒ½å°è¯•ä½¿ç”¨ä¸€è¶Ÿæ‰«æå®ç°å—ï¼Ÿ 2 è§£æ³•2.1 æ€æƒ³ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆï¼Œè®©å¿«æŒ‡é’ˆä¸€å¼€å§‹å’Œæ…¢æŒ‡é’ˆä¿æŒnçš„è·ç¦»ï¼Œä¸¤è€…ä¸€èµ·ä»¥åŒæ ·é€Ÿåº¦ç§»åŠ¨ï¼Œåˆ™å½“å¿«æŒ‡é’ˆæŒ‡å‘é“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œæ…¢æŒ‡é’ˆçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯è¦åˆ é™¤çš„èŠ‚ç‚¹ã€‚ 2.2 ä»£ç HashSetï¼š /** * Definition for singly-linked list. * public class ListNode { * int val; * ListNode next; * ListNode(int x) { val = x; } * } */ class Solution { public ListNode removeNthFromEnd(ListNode head, int n) { ListNode slow; ListNode fast; slow = fast = head; for(int i = 0;i&lt;n;i++){ fast = fast.next; } //è¿™ç§æƒ…å†µéœ€è¦åˆ é™¤å¤´èŠ‚ç‚¹ if(fast == null) return head.next; while(fast.next!=null){ fast = fast.next; slow = slow.next; } slow.next = slow.next.next; return head; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode141-ç¯å½¢é“¾è¡¨","slug":"leetcode141-ç¯å½¢é“¾è¡¨","date":"2019-12-14T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode141-ç¯å½¢é“¾è¡¨/","link":"","permalink":"https://www.codetool.top/article/leetcode141-%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚ å¦‚æœ pos æ˜¯ -1ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚ ç¤ºä¾‹1: è¾“å…¥: head = [3,2,0,-4], pos = 1è¾“å‡º: trueè§£é‡Š: é“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚ ç¤ºä¾‹2: è¾“å…¥: head = [1,2], pos = 0è¾“å‡º: trueè§£é‡Š: é“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ ç¤ºä¾‹3: è¾“å…¥: head = [1], pos = -1è¾“å‡º: falseè§£é‡Š: é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚ è¿›é˜¶ï¼š ä½ èƒ½ç”¨ O(1)ï¼ˆå³ï¼Œå¸¸é‡ï¼‰å†…å­˜è§£å†³æ­¤é—®é¢˜å—ï¼Ÿ 2 è§£æ³•2.1 æ€æƒ³ HashSetä¾æ¬¡å°†è·å–åˆ°çš„é“¾è¡¨å…ƒç´ æ’å…¥ä¸€ä¸ªHashSetä¸­ï¼Œçœ‹æ˜¯å¦æœ‰ç›¸åŒå…ƒç´ ã€‚ åŒæŒ‡é’ˆä¸€ä¸ªå¿«æŒ‡é’ˆä¸€ä¸ªæ…¢æŒ‡é’ˆï¼Œå¦‚æœæœ‰ç¯å¿«æŒ‡é’ˆæ€»ä¼šèµ¶ä¸Šæ…¢æŒ‡é’ˆã€‚ 2.2 ä»£ç HashSetï¼š /** * Definition for singly-linked list. * class ListNode { * int val; * ListNode next; * ListNode(int x) { * val = x; * next = null; * } * } */ public class Solution { public boolean hasCycle(ListNode head) { if(head == null) return false; Set&lt;ListNode> set = new HashSet&lt;>(); ListNode cur = head; while(cur.next!=null){ if(set.contains(cur)) return true; set.add(cur); cur = cur.next; } return false; } } åŒæŒ‡é’ˆï¼š /** * Definition for singly-linked list. * class ListNode { * int val; * ListNode next; * ListNode(int x) { * val = x; * next = null; * } * } */ public class Solution { public boolean hasCycle(ListNode head) { if(head == null){ return false; } ListNode slow = head; ListNode fast = head; while (slow!=null &amp;&amp; fast!=null &amp;&amp; fast.next!=null){ slow = slow.next; fast = fast.next.next; if(slow == fast){ return true; } } return false; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode142-ç¯å½¢é“¾è¡¨II","slug":"leetcode142-ç¯å½¢é“¾è¡¨II","date":"2019-12-14T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode142-ç¯å½¢é“¾è¡¨II/","link":"","permalink":"https://www.codetool.top/article/leetcode142-%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8II/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œè¿”å›é“¾è¡¨å¼€å§‹å…¥ç¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ å¦‚æœé“¾è¡¨æ— ç¯ï¼Œåˆ™è¿”å› nullã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚ å¦‚æœ pos æ˜¯ -1ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚ è¯´æ˜ï¼š ä¸å…è®¸ä¿®æ”¹ç»™å®šçš„é“¾è¡¨ã€‚ ç¤ºä¾‹1: è¾“å…¥: head = [3,2,0,-4], pos = 1è¾“å‡º: tail connects to node index 1è§£é‡Š: é“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚ ç¤ºä¾‹2: è¾“å…¥: head = [1,2], pos = 0è¾“å‡º: tail connects to node index 0è§£é‡Š: é“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ ç¤ºä¾‹3: è¾“å…¥: head = [1], pos = -1è¾“å‡º: no cycleè§£é‡Š: é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚ è¿›é˜¶ï¼š ä½ æ˜¯å¦å¯ä»¥ä¸ç”¨é¢å¤–ç©ºé—´è§£å†³æ­¤é¢˜ï¼Ÿ 2 è§£æ³•2.1 æ€æƒ³ HashSetä¾æ¬¡å°†è·å–åˆ°çš„é“¾è¡¨å…ƒç´ æ’å…¥ä¸€ä¸ªHashSetä¸­ï¼Œè¿”å›ç¬¬ä¸€ä¸ªé‡å¤çš„èŠ‚ç‚¹ã€‚ åŒæŒ‡é’ˆç†è®ºä¸Šæ…¢æŒ‡é’ˆå’Œå¿«æŒ‡é’ˆåœ¨ç¯ä¸­ç›¸é‡çš„ä½ç½®æ˜¯æœ‰è§„å¾‹å¯å¾ªçš„ï¼šè®¾ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å…¥ç¯çš„è·ç¦»ä¸ºxï¼Œç¯çš„é•¿åº¦ä¸ºyï¼Œåˆ™å¿«æŒ‡é’ˆæ¯æ¬¡èµ°ä¸¤æ­¥ï¼Œæ…¢æŒ‡é’ˆæ¯æ¬¡èµ°ä¸€æ­¥ï¼Œç¬¬ä¸€æ¬¡ç›¸é‡ç»è¿‡çš„æ¬¡æ•°ä¸ºt,åˆ™æœ‰ï¼š(t-x)%y = (2t-x)%yå®ƒç­‰ä»·äºï¼š(2t-x)-(t-x) = ny(nä¸ºè‡ªç„¶æ•°ï¼Œä»£è¡¨ç¬¬å‡ æ¬¡ç›¸é‡)ä¹Ÿå°±å¯ä»¥å¾—å‡ºt = nyå†é€šè¿‡ç¬¬ä¸€æ¬¡ç›¸é‡çš„ç¯ä¸Šåæ ‡ä¸º(t-x)%yï¼Œå°†t = yä»£å…¥ï¼Œå¾—ç¬¬ä¸€æ¬¡ç›¸é‡çš„ç¯ä¸Šåæ ‡ä¸ºy-xã€‚æ­¤æ—¶ï¼Œç›¸é‡ç‚¹å’Œå‡ºå‘ç‚¹è·å…¥ç¯ç‚¹çš„è·ç¦»éƒ½æ˜¯xã€‚äºæ˜¯è®©å¿«æŒ‡é’ˆå›åˆ°å‡ºå‘ç‚¹ï¼Œä¸¤æŒ‡é’ˆéƒ½ä»¥é€Ÿåº¦ä¸º1ç»§ç»­è¡Œèµ°ï¼Œç›´åˆ°ç›¸é‡å°±æ˜¯å…¥ç¯ç‚¹ã€‚ 2.2 ä»£ç HashSetï¼š /** * Definition for singly-linked list. * class ListNode { * int val; * ListNode next; * ListNode(int x) { * val = x; * next = null; * } * } */ public class Solution { public ListNode detectCycle(ListNode head) { if(head == null) return null; Set&lt;ListNode> set = new HashSet&lt;>(); ListNode cur = head; while(cur.next!=null){ if(set.contains(cur)) return cur; set.add(cur); cur = cur.next; } return null; } } åŒæŒ‡é’ˆï¼š /** * Definition for singly-linked list. * class ListNode { * int val; * ListNode next; * ListNode(int x) { * val = x; * next = null; * } * } */ public class Solution { public ListNode detectCycle(ListNode head){ ListNode fast = head, slow = head; boolean flag = false; while (fast != null &amp;&amp; fast.next != null){ fast = fast.next.next; slow = slow.next; if (fast == slow){ flag = true; break; } } if (!flag) return null; fast = head; while (fast != slow){ fast = fast.next; slow = slow.next; } return fast; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode160-ç›¸äº¤é“¾è¡¨","slug":"leetcode160-ç›¸äº¤é“¾è¡¨","date":"2019-12-14T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode160-ç›¸äº¤é“¾è¡¨/","link":"","permalink":"https://www.codetool.top/article/leetcode160-%E7%9B%B8%E4%BA%A4%E9%93%BE%E8%A1%A8/","excerpt":"","text":"1 åŸé¢˜ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œæ‰¾åˆ°ä¸¤ä¸ªå•é“¾è¡¨ç›¸äº¤çš„èµ·å§‹èŠ‚ç‚¹ã€‚ å¦‚ä¸‹é¢çš„ä¸¤ä¸ªé“¾è¡¨ï¼š åœ¨èŠ‚ç‚¹ c1 å¼€å§‹ç›¸äº¤ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥ï¼š intersectVal = 8, listA = [4,1,8,4,5], listB = [5,0,1,8,4,5], skipA = 2, skipB = 3è¾“å‡ºï¼š Reference of the node with value = 8è¾“å…¥è§£é‡Šï¼š ç›¸äº¤èŠ‚ç‚¹çš„å€¼ä¸º 8 ï¼ˆæ³¨æ„ï¼Œå¦‚æœä¸¤ä¸ªåˆ—è¡¨ç›¸äº¤åˆ™ä¸èƒ½ä¸º 0ï¼‰ã€‚ä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [4,1,8,4,5]ï¼Œé“¾è¡¨ B ä¸º [5,0,1,8,4,5]ã€‚åœ¨ A ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 2 ä¸ªèŠ‚ç‚¹ï¼›åœ¨ B ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 3 ä¸ªèŠ‚ç‚¹ã€‚ ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼š intersectVal = 2, listA = [0,9,1,2,4], listB = [3,2,4], skipA = 3, skipB = 1è¾“å‡ºï¼š Reference of the node with value = 2è¾“å…¥è§£é‡Šï¼š ç›¸äº¤èŠ‚ç‚¹çš„å€¼ä¸º 2 ï¼ˆæ³¨æ„ï¼Œå¦‚æœä¸¤ä¸ªåˆ—è¡¨ç›¸äº¤åˆ™ä¸èƒ½ä¸º 0ï¼‰ã€‚ä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [0,9,1,2,4]ï¼Œé“¾è¡¨ B ä¸º [3,2,4]ã€‚åœ¨ A ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 3 ä¸ªèŠ‚ç‚¹ï¼›åœ¨ B ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 1 ä¸ªèŠ‚ç‚¹ã€‚ ç¤ºä¾‹ 3ï¼š è¾“å…¥ï¼š intersectVal = 0, listA = [2,6,4], listB = [1,5], skipA = 3, skipB = 2è¾“å‡ºï¼š nullè¾“å…¥è§£é‡Šï¼š ä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [2,6,4]ï¼Œé“¾è¡¨ B ä¸º [1,5]ã€‚ç”±äºè¿™ä¸¤ä¸ªé“¾è¡¨ä¸ç›¸äº¤ï¼Œæ‰€ä»¥ intersectVal å¿…é¡»ä¸º 0ï¼Œè€Œ skipA å’Œ skipB å¯ä»¥æ˜¯ä»»æ„å€¼ã€‚è§£é‡Šï¼šè¿™ä¸¤ä¸ªé“¾è¡¨ä¸ç›¸äº¤ï¼Œå› æ­¤è¿”å› nullã€‚ æ³¨æ„ï¼š å¦‚æœä¸¤ä¸ªé“¾è¡¨æ²¡æœ‰äº¤ç‚¹ï¼Œè¿”å› null. åœ¨è¿”å›ç»“æœåï¼Œä¸¤ä¸ªé“¾è¡¨ä»é¡»ä¿æŒåŸæœ‰çš„ç»“æ„ã€‚ å¯å‡å®šæ•´ä¸ªé“¾è¡¨ç»“æ„ä¸­æ²¡æœ‰å¾ªç¯ã€‚ ç¨‹åºå°½é‡æ»¡è¶³ O(n) æ—¶é—´å¤æ‚åº¦ï¼Œä¸”ä»…ç”¨ O(1) å†…å­˜ã€‚ 2 è§£æ³•2.1 æ€æƒ³ HashSetä¾æ¬¡å°†è·å–åˆ°çš„é“¾è¡¨å…ƒç´ æ’å…¥ä¸€ä¸ªHashSetä¸­ï¼Œè¿”å›ç¬¬ä¸€ä¸ªé‡å¤çš„èŠ‚ç‚¹ã€‚ åŒæŒ‡é’ˆä¸¤ä¸ªæŒ‡é’ˆä»å¤´èµ°åˆ°å°¾çš„è·¯å¾„é•¿åº¦ä¹‹å·®å°±æ˜¯ä¸¤æ¡è·¯å¾„ç›¸äº¤ç‚¹å‰çš„é•¿åº¦ä¹‹å·®ï¼Œè·å–äº†è¿™ä¸ªå·®ä¹‹åå°±å¯ä»¥è·¯å¾„çŸ­çš„è®©è·¯å¾„é•¿çš„å…ˆèµ°å‡ æ­¥ï¼Œç„¶ååŒæ—¶å‡ºå‘ï¼Œåœ¨ç›¸äº¤ç‚¹ç›¸é‡ã€‚ 2.2 ä»£ç HashSetï¼š /** * Definition for singly-linked list. * public class ListNode { * int val; * ListNode next; * ListNode(int x) { * val = x; * next = null; * } * } */ public class Solution { public ListNode getIntersectionNode(ListNode headA, ListNode headB) { if(headA==null || headB==null) return null; Set&lt;ListNode> set = new HashSet&lt;ListNode>(); ListNode curA = headA; ListNode curB = headB; while(curA!=null){ set.add(curA); curA = curA.next; } while(curB!=null){ if(set.contains(curB)) return curB; set.add(curB); curB = curB.next; } return null; } } åŒæŒ‡é’ˆï¼š /** * Definition for singly-linked list. * public class ListNode { * int val; * ListNode next; * ListNode(int x) { * val = x; * next = null; * } * } */ public class Solution { public ListNode getIntersectionNode(ListNode headA, ListNode headB) { if(headA == null || headB == null) return null; if(headA == headB) return headA; ListNode curA = headA; ListNode curB = headB; int countA = 0; int countB = 0; //ä¸¤ä¸ªæŒ‡é’ˆå…ˆä¸€èµ·èµ°ä¸€é while(curA!=curB &amp;&amp; (curA.next!=null || curB.next!=null)){ if(curA.next!=null){ curA = curA.next; countA++; } if(curB.next!=null){ curB = curB.next; countB++; } } if(curA != curB) return null; //è·å–ä¸¤æ¡è·¯å¾„çš„é•¿åº¦åªå·® int step; ListNode longer; ListNode near; if(countA>=countB){ step = countA-countB; longer = headA; near = headB; }else{ step = countB-countA; longer = headB; near = headA; } //è¿‘çš„è®©è¿œçš„å…ˆèµ° while(longer != near){ longer = longer.next; if(step==0) near = near.next; else step --; } return longer; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode349-ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†","slug":"leetcode349-ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†","date":"2019-12-14T10:05:23.000Z","updated":"2020-02-20T14:55:21.053Z","comments":true,"path":"article/leetcode349-ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†/","link":"","permalink":"https://www.codetool.top/article/leetcode349-%E4%B8%A4%E4%B8%AA%E6%95%B0%E7%BB%84%E7%9A%84%E4%BA%A4%E9%9B%86/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸¤ä¸ªæ•°ç»„ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å®ƒä»¬çš„äº¤é›†ã€‚ è¾“å…¥ï¼š nums1 = [1,2,2,1], nums2 = [2,2]è¾“å‡ºï¼š [2] ç¤ºä¾‹2ï¼š è¾“å…¥ï¼š nums1 = [4,9,5], nums2 = [9,4,9,8,4]è¾“å‡ºï¼š [9,4] 2 è§£æ³•2.1 æ€æƒ³å“ˆå¸Œé›†ï¼Œç¬¬ä¸€ä¸ªæ•°ç»„ä¸­å‡ºç°çš„æ•°åŠ å…¥åˆ°é›†åˆä¸­ï¼Œç¬¬äºŒä¸ªæ•°ç»„ä¸­å­˜åœ¨é›†åˆä¸­çš„æ•°åˆ™åŠ å…¥åˆ°ä¸€ä¸ªæ–°çš„é›†åˆä¸­ï¼Œæœ€åæŠŠç¬¬äºŒä¸ªé›†åˆå˜æˆæ•°ç»„è¿”å›ã€‚ 2.2 ä»£ç è¿™ç§å†™æ³•æ²¡æœ‰ç”¨ç¬¬äºŒä¸ªé›†åˆï¼Œä½†æ˜¯æ€æƒ³æ˜¯ä¸€æ ·çš„ï¼Œè®¡ç®—å¹¶é›†å¤§å°çš„è¿‡ç¨‹ä¸­ä¸è¦æµªè´¹æ—¶é—´ï¼Œå¯ä»¥å°†å¹¶é›†å…ƒç´ æåœ¨ä¸€å—åŒºåŸŸï¼Œç„¶åå¤åˆ¶åœ°å€ç©ºé—´è¿”å›ã€‚ class Solution { public int[] intersection(int[] nums1, int[] nums2) { Set&lt;Integer> set = new HashSet&lt;>(); int size = 0; for(int i:nums1){ set.add(i); } for(int i = 0;i&lt;nums2.length;i++){ if(set.contains(nums2[i])){ nums1[size] = nums2[i]; set.remove(nums2[i]); size++; } } int[] result = new int[size]; System.arraycopy(nums1,0,result,0,size); return result; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode707-è®¾è®¡é“¾è¡¨","slug":"leetcode707-è®¾è®¡é“¾è¡¨","date":"2019-12-14T10:05:23.000Z","updated":"2020-02-20T14:55:21.053Z","comments":true,"path":"article/leetcode707-è®¾è®¡é“¾è¡¨/","link":"","permalink":"https://www.codetool.top/article/leetcode707-%E8%AE%BE%E8%AE%A1%E9%93%BE%E8%A1%A8/","excerpt":"","text":"1 åŸé¢˜è®¾è®¡é“¾è¡¨çš„å®ç°ã€‚æ‚¨å¯ä»¥é€‰æ‹©ä½¿ç”¨å•é“¾è¡¨æˆ–åŒé“¾è¡¨ã€‚å•é“¾è¡¨ä¸­çš„èŠ‚ç‚¹åº”è¯¥å…·æœ‰ä¸¤ä¸ªå±æ€§ï¼šval å’Œ nextã€‚val æ˜¯å½“å‰èŠ‚ç‚¹çš„å€¼ï¼Œnext æ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆ/å¼•ç”¨ã€‚å¦‚æœè¦ä½¿ç”¨åŒå‘é“¾è¡¨ï¼Œåˆ™è¿˜éœ€è¦ä¸€ä¸ªå±æ€§ prev ä»¥æŒ‡ç¤ºé“¾è¡¨ä¸­çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ã€‚å‡è®¾é“¾è¡¨ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯ 0-index çš„ã€‚ åœ¨é“¾è¡¨ç±»ä¸­å®ç°è¿™äº›åŠŸèƒ½ï¼š get(index)ï¼šè·å–é“¾è¡¨ä¸­ç¬¬ index ä¸ªèŠ‚ç‚¹çš„å€¼ã€‚å¦‚æœç´¢å¼•æ— æ•ˆï¼Œåˆ™è¿”å›-1ã€‚ addAtHead(val)ï¼šåœ¨é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¹‹å‰æ·»åŠ ä¸€ä¸ªå€¼ä¸º val çš„èŠ‚ç‚¹ã€‚æ’å…¥åï¼Œæ–°èŠ‚ç‚¹å°†æˆä¸ºé“¾è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ addAtTail(val)ï¼šå°†å€¼ä¸º val çš„èŠ‚ç‚¹è¿½åŠ åˆ°é“¾è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚ addAtIndex(index,val)ï¼šåœ¨é“¾è¡¨ä¸­çš„ç¬¬ index ä¸ªèŠ‚ç‚¹ä¹‹å‰æ·»åŠ å€¼ä¸º val çš„èŠ‚ç‚¹ã€‚å¦‚æœ index ç­‰äºé“¾è¡¨çš„é•¿åº¦ï¼Œåˆ™è¯¥èŠ‚ç‚¹å°†é™„åŠ åˆ°é“¾è¡¨çš„æœ«å°¾ã€‚å¦‚æœ index å¤§äºé“¾è¡¨é•¿åº¦ï¼Œåˆ™ä¸ä¼šæ’å…¥èŠ‚ç‚¹ã€‚å¦‚æœindexå°äº0ï¼Œåˆ™åœ¨å¤´éƒ¨æ’å…¥èŠ‚ç‚¹ã€‚ deleteAtIndex(index)ï¼šå¦‚æœç´¢å¼• index æœ‰æ•ˆï¼Œåˆ™åˆ é™¤é“¾è¡¨ä¸­çš„ç¬¬ index ä¸ªèŠ‚ç‚¹ã€‚ ç¤ºä¾‹ï¼š MyLinkedList linkedList = new MyLinkedList();linkedList.addAtHead(1);linkedList.addAtTail(3);linkedList.addAtIndex(1,2); //é“¾è¡¨å˜ä¸º1-&gt; 2-&gt; 3linkedList.get(1); //è¿”å›2linkedList.deleteAtIndex(1); //ç°åœ¨é“¾è¡¨æ˜¯1-&gt; 3linkedList.get(1); //è¿”å›3 æç¤º: æ‰€æœ‰valå€¼éƒ½åœ¨ [1, 1000] ä¹‹å†…ã€‚ æ“ä½œæ¬¡æ•°å°†åœ¨ [1, 1000] ä¹‹å†…ã€‚ è¯·ä¸è¦ä½¿ç”¨å†…ç½®çš„ LinkedList åº“ã€‚ 2 è§£æ³•2.1 æ€æƒ³é“¾è¡¨çš„æ•°æ®ç»“æ„ï¼ï¼ ä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ªsizeå’Œä¸€ä¸ªheadï¼Œç‰¹åˆ«æ³¨æ„å¦‚æœæœ‰tailæ¶‰åŠåˆ°å¯èƒ½æ›´æ”¹tailçš„åœ°æ–¹ä¸€å®šè¦æ³¨æ„æ›´æ”¹tailã€‚ï¼ˆæˆ‘è°ƒè¯•è¿™ä¸ªbugè°ƒè¯•äº†ä¸€ä¸ªä¸‹åˆğŸ˜­ï¼‰ 2.2 ä»£ç class MyLinkedList { private class Node{ public int val; public Node next; } private int size; private Node head; private Node tail; /** Initialize your data structure here. */ public MyLinkedList() { size = 0; head = tail = null; } /** Get the value of the index-th node in the linked list. If the index is invalid, return -1. */ public int get(int index) { if(index>=size || index&lt;0) return -1; Node cur = head; for(int i = 0;i&lt;index;i++) cur = cur.next; return cur.val; } /** Add a node of value val before the first element of the linked list. After the insertion, the new node will be the first node of the linked list. */ public void addAtHead(int val) { Node newHead = new Node(); newHead.val = val; newHead.next = head; if(size==0) tail = newHead; head = newHead; size++; } /** Append a node of value val to the last element of the linked list. */ public void addAtTail(int val) { Node newTail = new Node(); newTail.val = val; newTail.next = null; if(size==0) head = newTail; else tail.next = newTail; tail = newTail; size++; } /** Add a node of value val before the index-th node in the linked list. If index equals to the length of linked list, the node will be appended to the end of linked list. If index is greater than the length, the node will not be inserted. */ public void addAtIndex(int index, int val) { if(index>size) return; if(index &lt;= 0) { addAtHead(val); return; } if(index == size){ addAtTail(val); return; } Node node = new Node(); node.val = val; Node cur = head; for(int i = 0;i&lt;index-1;i++) cur = cur.next; node.next = cur.next; cur.next = node; size++; } /** Delete the index-th node in the linked list, if the index is valid. */ public void deleteAtIndex(int index) { if(index>=size || index &lt;0) return; size--; if(index == 0) { head = head.next; return; } Node cur = head; for(int i = 0;i&lt;index-1;i++) cur = cur.next; cur.next = cur.next.next; //è¿™ä¸ªåœ°æ–¹ï¼ï¼ï¼ è€ƒè™‘åˆ°å¯èƒ½ä¼šæŠŠtailåˆ é™¤ï¼ï¼ï¼ if(index == size){ tail = cur; } } } /** * Your MyLinkedList object will be instantiated and called as such: * MyLinkedList obj = new MyLinkedList(); * int param_1 = obj.get(index); * obj.addAtHead(val); * obj.addAtTail(val); * obj.addAtIndex(index,val); * obj.deleteAtIndex(index); */","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"}]},{"title":"leetcode232-ç”¨æ ˆå®ç°é˜Ÿåˆ—","slug":"leetcode232-ç”¨æ ˆå®ç°é˜Ÿåˆ—","date":"2019-12-13T10:05:23.000Z","updated":"2020-02-20T14:55:21.053Z","comments":true,"path":"article/leetcode232-ç”¨æ ˆå®ç°é˜Ÿåˆ—/","link":"","permalink":"https://www.codetool.top/article/leetcode232-%E7%94%A8%E6%A0%88%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97/","excerpt":"","text":"1 åŸé¢˜ä½¿ç”¨æ ˆå®ç°é˜Ÿåˆ—çš„ä¸‹åˆ—æ“ä½œï¼š push(x) â€“ å°†ä¸€ä¸ªå…ƒç´ æ”¾å…¥é˜Ÿåˆ—çš„å°¾éƒ¨ã€‚ pop() â€“ ä»é˜Ÿåˆ—é¦–éƒ¨ç§»é™¤å…ƒç´ ã€‚ peek() â€“ è¿”å›é˜Ÿåˆ—é¦–éƒ¨çš„å…ƒç´ ã€‚ empty() â€“ è¿”å›é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºã€‚ ç¤ºä¾‹: MyQueue queue = new MyQueue();queue.push(1);queue.push(2);queue.peek(); // è¿”å› 1queue.pop(); // è¿”å› 1queue.empty(); // è¿”å› false è¯´æ˜: ä½ åªèƒ½ä½¿ç”¨æ ‡å‡†çš„æ ˆæ“ä½œ â€“ ä¹Ÿå°±æ˜¯åªæœ‰ push to top, peek/pop from top, size, å’Œ is empty æ“ä½œæ˜¯åˆæ³•çš„ã€‚ ä½ æ‰€ä½¿ç”¨çš„è¯­è¨€ä¹Ÿè®¸ä¸æ”¯æŒæ ˆã€‚ä½ å¯ä»¥ä½¿ç”¨ list æˆ–è€… dequeï¼ˆåŒç«¯é˜Ÿåˆ—ï¼‰æ¥æ¨¡æ‹Ÿä¸€ä¸ªæ ˆï¼Œåªè¦æ˜¯æ ‡å‡†çš„æ ˆæ“ä½œå³å¯ã€‚ å‡è®¾æ‰€æœ‰æ“ä½œéƒ½æ˜¯æœ‰æ•ˆçš„ ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªç©ºçš„é˜Ÿåˆ—ä¸ä¼šè°ƒç”¨ pop æˆ–è€… peek æ“ä½œï¼‰ã€‚ 2 è§£æ³•2.1 æ€æƒ³ç”¨ä¸€ä¸ªæ ˆè¿›è¡Œæ’å…¥æ“ä½œï¼Œè¦å¾—åˆ°æ ˆçš„ç¬¬ä¸€ä¸ªæ’å…¥çš„å…ƒç´ éœ€è¦å†ç”¨ä¸€ä¸ªæ ˆå°†ç¬¬ä¸€ä¸ªæ ˆä¸­çš„å…ƒç´ æ¬¡åºç¿»è½¬è¿‡æ¥ï¼Œå¾—åˆ°ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå†ä¾æ¬¡å‹æ ˆå›å»ã€‚ 2.2 ä»£ç class MyQueue { public Stack&lt;Integer> stack; public Stack&lt;Integer> reverse; /** Initialize your data structure here. */ public MyQueue() { stack = new Stack&lt;>(); reverse = new Stack&lt;>(); } /** Push element x to the back of queue. */ public void push(int x) { stack.push(x); } /** Removes the element from in front of queue and returns that element. */ public int pop() { while(!stack.empty()){ reverse.push(stack.pop()); } int result = reverse.pop(); while(!reverse.empty()){ stack.push(reverse.pop()); } return result; } /** Get the front element. */ public int peek() { while(!stack.empty()){ reverse.push(stack.pop()); } int result = reverse.peek(); while(!reverse.empty()){ stack.push(reverse.pop()); } return result; } /** Returns whether the queue is empty. */ public boolean empty() { return stack.empty(); } } /** * Your MyQueue object will be instantiated and called as such: * MyQueue obj = new MyQueue(); * obj.push(x); * int param_2 = obj.pop(); * int param_3 = obj.peek(); * boolean param_4 = obj.empty(); */","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"}]},{"title":"leetcode225--ç”¨é˜Ÿåˆ—å®ç°æ ˆ","slug":"leetcode225-ç”¨é˜Ÿåˆ—å®ç°æ ˆ","date":"2019-12-13T10:05:23.000Z","updated":"2020-02-20T14:55:21.053Z","comments":true,"path":"article/leetcode225-ç”¨é˜Ÿåˆ—å®ç°æ ˆ/","link":"","permalink":"https://www.codetool.top/article/leetcode225-%E7%94%A8%E9%98%9F%E5%88%97%E5%AE%9E%E7%8E%B0%E6%A0%88/","excerpt":"","text":"1 åŸé¢˜ä½¿ç”¨é˜Ÿåˆ—å®ç°æ ˆçš„ä¸‹åˆ—æ“ä½œï¼š push(x) â€“ å…ƒç´  x å…¥æ ˆ pop() â€“ ç§»é™¤æ ˆé¡¶å…ƒç´  top() â€“ è·å–æ ˆé¡¶å…ƒç´  empty() â€“ è¿”å›æ ˆæ˜¯å¦ä¸ºç©º æ³¨æ„: ä½ åªèƒ½ä½¿ç”¨é˜Ÿåˆ—çš„åŸºæœ¬æ“ä½œâ€“ ä¹Ÿå°±æ˜¯ push to back, peek/pop from front, size, å’Œ is empty è¿™äº›æ“ä½œæ˜¯åˆæ³•çš„ã€‚ ä½ æ‰€ä½¿ç”¨çš„è¯­è¨€ä¹Ÿè®¸ä¸æ”¯æŒé˜Ÿåˆ—ã€‚ ä½ å¯ä»¥ä½¿ç”¨ list æˆ–è€… dequeï¼ˆåŒç«¯é˜Ÿåˆ—ï¼‰æ¥æ¨¡æ‹Ÿä¸€ä¸ªé˜Ÿåˆ— , åªè¦æ˜¯æ ‡å‡†çš„é˜Ÿåˆ—æ“ä½œå³å¯ã€‚ ä½ å¯ä»¥å‡è®¾æ‰€æœ‰æ“ä½œéƒ½æ˜¯æœ‰æ•ˆçš„ï¼ˆä¾‹å¦‚, å¯¹ä¸€ä¸ªç©ºçš„æ ˆä¸ä¼šè°ƒç”¨ pop æˆ–è€… top æ“ä½œï¼‰ã€‚ 2 è§£æ³•2.1 æ€æƒ³ç”¨ä¸€ä¸ªé˜Ÿåˆ—è¿›è¡Œæ’å…¥æ“ä½œï¼Œè¦å¾—åˆ°é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªæ’å…¥çš„å…ƒç´ å¯ä»¥å°†å…¶ä»–çš„å…ƒç´ å…ˆæ’å…¥ç¬¬äºŒä¸ªé˜Ÿåˆ—ï¼Œå¾—åˆ°æœ€åä¸€ä¸ªå…ƒç´ ä¹‹åå†æŠŠå…ƒç´ æ’å…¥å›æ¥ã€‚ 2.2 ä»£ç class MyStack { Queue&lt;Integer> queue; Queue&lt;Integer> buffer; /** Initialize your data structure here. */ public MyStack() { queue = new LinkedList&lt;>(); buffer = new LinkedList&lt;>(); } /** Push element x onto stack. */ public void push(int x) { queue.offer(x); } /** Removes the element on top of the stack and returns that element. */ public int pop() { while(queue.size()!=1){ buffer.offer(queue.poll()); } int result = queue.poll(); while(!buffer.isEmpty()){ queue.offer(buffer.poll()); } return result; } /** Get the top element. */ public int top() { while(queue.size()!=1){ buffer.offer(queue.poll()); } int result = queue.poll(); buffer.offer(result); while(!buffer.isEmpty()){ queue.offer(buffer.poll()); } return result; } /** Returns whether the stack is empty. */ public boolean empty() { return queue.isEmpty(); } } /** * Your MyStack object will be instantiated and called as such: * MyStack obj = new MyStack(); * obj.push(x); * int param_2 = obj.pop(); * int param_3 = obj.top(); * boolean param_4 = obj.empty(); */","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"}]},{"title":"leetcode394-å­—ç¬¦ä¸²è§£ç ","slug":"leetcode394-å­—ç¬¦ä¸²è§£ç ","date":"2019-12-13T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode394-å­—ç¬¦ä¸²è§£ç /","link":"","permalink":"https://www.codetool.top/article/leetcode394-%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A7%A3%E7%A0%81/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªç»è¿‡ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œè¿”å›å®ƒè§£ç åçš„å­—ç¬¦ä¸²ã€‚ ç¼–ç è§„åˆ™ä¸º: k[encoded_string]ï¼Œè¡¨ç¤ºå…¶ä¸­æ–¹æ‹¬å·å†…éƒ¨çš„ encoded_string æ­£å¥½é‡å¤ k æ¬¡ã€‚æ³¨æ„ k ä¿è¯ä¸ºæ­£æ•´æ•°ã€‚ ä½ å¯ä»¥è®¤ä¸ºè¾“å…¥å­—ç¬¦ä¸²æ€»æ˜¯æœ‰æ•ˆçš„ï¼›è¾“å…¥å­—ç¬¦ä¸²ä¸­æ²¡æœ‰é¢å¤–çš„ç©ºæ ¼ï¼Œä¸”è¾“å…¥çš„æ–¹æ‹¬å·æ€»æ˜¯ç¬¦åˆæ ¼å¼è¦æ±‚çš„ã€‚ æ­¤å¤–ï¼Œä½ å¯ä»¥è®¤ä¸ºåŸå§‹æ•°æ®ä¸åŒ…å«æ•°å­—ï¼Œæ‰€æœ‰çš„æ•°å­—åªè¡¨ç¤ºé‡å¤çš„æ¬¡æ•° k ï¼Œä¾‹å¦‚ä¸ä¼šå‡ºç°åƒ 3a æˆ– 2[4] çš„è¾“å…¥ã€‚ ç¤ºä¾‹: s = â€œ3[a]2[bc]â€, è¿”å› â€œaaabcbcâ€.s = â€œ3[a2[c]]â€, è¿”å› â€œaccaccaccâ€.s = â€œ2[abc]3[cd]efâ€, è¿”å› â€œabcabccdcdcdefâ€. 2 è§£æ³•2.1 æ€æƒ³DFSï¼Œåªå¤„ç†å­—ç¬¦ä¸²ä¸­ä¸åŒ…å«æ‹¬å·çš„ï¼Œé‡åˆ°å¸¦æ‹¬å·çš„å°†å…¶åˆ†è§£ã€‚ 2.2 ä»£ç class Solution { public String decodeString(String s) { return multify(1,s); } public String multify(int repeat,String s){ StringBuilder sb = new StringBuilder(); //å­—ç¬¦ä¸²ä¸­ä¸å¸¦æ‹¬å· if(s.indexOf('[') == -1){ for(int i = 0;i&lt;repeat;i++){ sb.append(s); } return sb.toString(); }else{ //æœªåŒ¹é…æ‹¬å·çš„ä¸ªæ•° int count = 0; //ç¬¬ä¸€ä¸ªæ•°å­—å‡ºç°çš„index int firstNumberIndex = 0; //ç¬¬ä¸€ä¸ªå·¦æ‹¬å·å‡ºç°çš„index int firstLeftIndex = 0; boolean firstNumberHasShown = false; for(int i = 0;i&lt;s.length();i++){ //å¦‚æœæ˜¯æ•°å­—è®°å½•ç¬¬ä¸€ä¸ªæ•°å­—å‡ºç°çš„index if(s.charAt(i)>='0'&amp;&amp;s.charAt(i)&lt;='9'){ if(firstNumberHasShown == false){ firstNumberIndex = i; firstNumberHasShown = true; } } //å¦‚æœæ˜¯å·¦æ‹¬å·è®°å½•ç¬¬ä¸€ä¸ªå·¦æ‹¬å·å‡ºç°çš„index else if(s.charAt(i) == '['){ if(count == 0) firstLeftIndex = i; count ++; } //å¦‚æœæ˜¯å³æ‹¬å·åˆ™æœªåŒ¹é…çš„å·¦æ‹¬å·æ•°é‡å‡ä¸€ï¼Œå¦‚æœå…¨éƒ¨åŒ¹é…å®Œåˆ™æŠŠrepeatå’Œsubstringé€’å½’å¤„ç†ã€‚ else if(s.charAt(i) == ']'){ count --; if(count == 0) { firstNumberHasShown = false; int repeatNum = Integer.valueOf(s.substring(firstNumberIndex,firstLeftIndex)); String subString = s.substring(firstLeftIndex+1,i); sb.append(multify(repeatNum,subString)); } } else if(count==0){ sb.append(s.charAt(i)); } } } return multify(repeat,sb.toString()); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode542-01çŸ©é˜µ","slug":"leetcode542-01çŸ©é˜µ","date":"2019-12-13T10:05:23.000Z","updated":"2020-04-15T06:09:04.999Z","comments":true,"path":"article/leetcode542-01çŸ©é˜µ/","link":"","permalink":"https://www.codetool.top/article/leetcode542-01%E7%9F%A9%E9%98%B5/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªç”± 0 å’Œ 1 ç»„æˆçš„çŸ©é˜µï¼Œæ‰¾å‡ºæ¯ä¸ªå…ƒç´ åˆ°æœ€è¿‘çš„ 0 çš„è·ç¦»ã€‚ ä¸¤ä¸ªç›¸é‚»å…ƒç´ é—´çš„è·ç¦»ä¸º 1 ã€‚ ç¤ºä¾‹1: è¾“å…¥: 0 0 00 1 00 0 0 è¾“å‡º: 0 0 00 1 00 0 0 ç¤ºä¾‹2: è¾“å…¥: 0 0 00 1 01 1 1 è¾“å‡º: 0 0 00 1 01 2 1 æ³¨æ„: ç»™å®šçŸ©é˜µçš„å…ƒç´ ä¸ªæ•°ä¸è¶…è¿‡ 10000ã€‚ ç»™å®šçŸ©é˜µä¸­è‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ æ˜¯ 0ã€‚ çŸ©é˜µä¸­çš„å…ƒç´ åªåœ¨å››ä¸ªæ–¹å‘ä¸Šç›¸é‚»: ä¸Šã€ä¸‹ã€å·¦ã€å³ã€‚ 2 è§£æ³•2.1 æ€æƒ³ BFSï¼šå…ˆå°†æ‰€æœ‰0æ ‡è®°å‡ºï¼Œç„¶åç´§æŒ¨0æœªè¢«æ ‡è®°å‡ºçš„å°±æ˜¯1ï¼Œæ ‡è®°æ‰€æœ‰1ï¼Œç´§æŒ¨1æœªè¢«æ ‡è®°å‡ºçš„å°±æ˜¯2â€¦â€¦ åŠ¨æ€è§„åˆ’ï¼šä¾æ¬¡éå†æ¯ä¸ªå…ƒç´ ï¼Œå¦‚æœå››å‘¨æœ‰0å°±æ˜¯1ï¼Œå¦‚æœæ²¡æœ‰ä¹Ÿä¸æ˜¯0å°±æ ¹æ®æ‰€æœ‰ç›¸é‚»å…ƒç´ å¯¹åº”çš„å€¼ä¸­çš„æœ€å°å€¼+1è·å¾—ã€‚ 2.2 ä»£ç BFSï¼š class Point{ public int x; public int y; public Point(int x,int y){ this.x = x; this.y = y; } } class Solution { public int[][] updateMatrix(int[][] matrix) { int height = matrix.length; int width = matrix[0].length; int[][] marked = new int[height][width]; int[][] ans = new int[height][width]; Queue&lt;Point> queue = new LinkedList&lt;>(); //å°†åŸäºŒç»´æ•°ç»„ä¸­æ‰€æœ‰0ç­”æ¡ˆè®¾ä¸º0 for(int i = 0;i&lt;height;i++){ for(int j = 0;j&lt;width;j++){ if(matrix[i][j] == 0){ marked[i][j] = 1; ans[i][j] = 0; queue.offer(new Point(i,j)); } } } while(!queue.isEmpty()){ Point point = queue.poll(); if(point.x!=0 &amp;&amp; marked[point.x-1][point.y]!=1){ ans[point.x-1][point.y] = ans[point.x][point.y]+1; marked[point.x-1][point.y] = 1; queue.offer(new Point(point.x-1,point.y)); } if(point.x!=height-1 &amp;&amp; marked[point.x+1][point.y]!=1){ ans[point.x+1][point.y] = ans[point.x][point.y]+1; marked[point.x+1][point.y] = 1; queue.offer(new Point(point.x+1,point.y)); } if(point.y!=0 &amp;&amp; marked[point.x][point.y-1]!=1){ ans[point.x][point.y-1] = ans[point.x][point.y]+1; marked[point.x][point.y-1] = 1; queue.offer(new Point(point.x,point.y-1)); } if(point.y!=width-1 &amp;&amp; marked[point.x][point.y+1]!=1){ ans[point.x][point.y+1] = ans[point.x][point.y]+1; marked[point.x][point.y+1] = 1; queue.offer(new Point(point.x,point.y+1)); } } return ans; } } åŠ¨æ€è§„åˆ’ï¼š class Solution { public int[][] updateMatrix(int[][] matrix) { int m = matrix.length ; int n = matrix[0].length; int[][] dp = new int[m][n]; for(int i = 0;i &lt; m; i++){ for(int j = 0; j &lt; n; j++){ dp[i][j] = dfs(matrix, dp, i, j); } } return dp; } public static int dfs(int[][] matrix,int[][] dp, int i, int j){ int m = matrix.length ; int n = matrix[0].length; if(i&lt;0 || i>m-1 || j &lt; 0 || j > n-1) return 9999; // å¦‚æœè‡ªèº«æ˜¯0 if(matrix[i][j] == 0) return 0; // å¦‚æœå››å‘¨æœ‰0 if(i > 0 &amp;&amp; matrix[i-1][j] == 0) return 1; if(j &lt; n-1 &amp;&amp; matrix[i][j+1] == 0) return 1; if(i &lt; m-1 &amp;&amp; matrix[i+1][j] == 0) return 1; if(j>0 &amp;&amp; matrix[i][j-1] == 0) return 1; // å¦‚æœå››å‘¨æ²¡æœ‰0æ ¹æ®å››å‘¨çš„dpæœ€å°å€¼+1è·å– int left,bottom,right,top; left=top=9999; if(i > 0 &amp;&amp; dp[i-1][j] != 0){ top = dp[i-1][j]; } if(j> 0 &amp;&amp; dp[i][j-1] != 0){ left = dp[i][j-1]; } bottom = dfs(matrix, dp,i+1, j); right = dfs(matrix, dp,i,j+1); return Math.min(Math.min(left, right), Math.min(top,bottom))+1; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode733-å›¾åƒæ¸²æŸ“","slug":"leetcode733-å›¾åƒæ¸²æŸ“","date":"2019-12-13T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode733-å›¾åƒæ¸²æŸ“/","link":"","permalink":"https://www.codetool.top/article/leetcode733-%E5%9B%BE%E5%83%8F%E6%B8%B2%E6%9F%93/","excerpt":"","text":"1 åŸé¢˜æœ‰ä¸€å¹…ä»¥äºŒç»´æ•´æ•°æ•°ç»„è¡¨ç¤ºçš„å›¾ç”»ï¼Œæ¯ä¸€ä¸ªæ•´æ•°è¡¨ç¤ºè¯¥å›¾ç”»çš„åƒç´ å€¼å¤§å°ï¼Œæ•°å€¼åœ¨ 0 åˆ° 65535 ä¹‹é—´ã€‚ ç»™ä½ ä¸€ä¸ªåæ ‡ (sr, sc) è¡¨ç¤ºå›¾åƒæ¸²æŸ“å¼€å§‹çš„åƒç´ å€¼ï¼ˆè¡Œ ï¼Œåˆ—ï¼‰å’Œä¸€ä¸ªæ–°çš„é¢œè‰²å€¼ newColorï¼Œè®©ä½ é‡æ–°ä¸Šè‰²è¿™å¹…å›¾åƒã€‚ ä¸ºäº†å®Œæˆä¸Šè‰²å·¥ä½œï¼Œä»åˆå§‹åæ ‡å¼€å§‹ï¼Œè®°å½•åˆå§‹åæ ‡çš„ä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘ä¸Šåƒç´ å€¼ä¸åˆå§‹åæ ‡ç›¸åŒçš„ç›¸è¿åƒç´ ç‚¹ï¼Œæ¥ç€å†è®°å½•è¿™å››ä¸ªæ–¹å‘ä¸Šç¬¦åˆæ¡ä»¶çš„åƒç´ ç‚¹ä¸ä»–ä»¬å¯¹åº”å››ä¸ªæ–¹å‘ä¸Šåƒç´ å€¼ä¸åˆå§‹åæ ‡ç›¸åŒçš„ç›¸è¿åƒç´ ç‚¹ï¼Œâ€¦â€¦ï¼Œé‡å¤è¯¥è¿‡ç¨‹ã€‚å°†æ‰€æœ‰æœ‰è®°å½•çš„åƒç´ ç‚¹çš„é¢œè‰²å€¼æ”¹ä¸ºæ–°çš„é¢œè‰²å€¼ã€‚ æœ€åè¿”å›ç»è¿‡ä¸Šè‰²æ¸²æŸ“åçš„å›¾åƒã€‚ ç¤ºä¾‹1: è¾“å…¥:image = [[1,1,1],[1,1,0],[1,0,1]]sr = 1, sc = 1, newColor = 2è¾“å‡º: [[2,2,2],[2,2,0],[2,0,1]]è§£æ:åœ¨å›¾åƒçš„æ­£ä¸­é—´ï¼Œ(åæ ‡(sr,sc)=(1,1)),åœ¨è·¯å¾„ä¸Šæ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„åƒç´ ç‚¹çš„é¢œè‰²éƒ½è¢«æ›´æ”¹æˆ2ã€‚æ³¨æ„ï¼Œå³ä¸‹è§’çš„åƒç´ æ²¡æœ‰æ›´æ”¹ä¸º2ï¼Œå› ä¸ºå®ƒä¸æ˜¯åœ¨ä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘ä¸Šä¸åˆå§‹ç‚¹ç›¸è¿çš„åƒç´ ç‚¹ã€‚ æ³¨æ„: image å’Œ image[0] çš„é•¿åº¦åœ¨èŒƒå›´ [1, 50] å†…ã€‚ ç»™å‡ºçš„åˆå§‹ç‚¹å°†æ»¡è¶³ 0 &lt;= sr &lt; image.length å’Œ 0 &lt;= sc &lt; image[0].lengthã€‚ image[i][j] å’Œ newColor è¡¨ç¤ºçš„é¢œè‰²å€¼åœ¨èŒƒå›´ [0, 65535]å†…ã€‚ 2 è§£æ³•2.1 æ€æƒ³å›¾çš„BFS 2.2 ä»£ç class Solution { class Point{ public int x; public int y; public Point(int x,int y){ this.x = x; this.y = y; } } public int[][] floodFill(int[][] image, int sr, int sc, int newColor) { Queue&lt;Point> queue = new LinkedList&lt;>(); queue.offer(new Point(sr,sc)); int origin = image[sr][sc]; int height = image.length; int width = image[0].length; if(newColor == origin) return image; while(!queue.isEmpty()){ Point point = queue.poll(); image[point.x][point.y] = newColor; if(point.x!=height-1 &amp;&amp; image[point.x+1][point.y] == origin){ queue.offer(new Point(point.x+1,point.y)); } if(point.x!=0 &amp;&amp; image[point.x-1][point.y] == origin){ queue.offer(new Point(point.x-1,point.y)); } if(point.y!=width-1 &amp;&amp; image[point.x][point.y+1] == origin){ queue.offer(new Point(point.x,point.y+1)); } if(point.y!= 0&amp;&amp; image[point.x][point.y-1] == origin){ queue.offer(new Point(point.x,point.y-1)); } } return image; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode841-é’¥åŒ™å’Œæˆ¿é—´","slug":"leetcode841-é’¥åŒ™å’Œæˆ¿é—´","date":"2019-12-13T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode841-é’¥åŒ™å’Œæˆ¿é—´/","link":"","permalink":"https://www.codetool.top/article/leetcode841-%E9%92%A5%E5%8C%99%E5%92%8C%E6%88%BF%E9%97%B4/","excerpt":"","text":"1 åŸé¢˜æœ‰ N ä¸ªæˆ¿é—´ï¼Œå¼€å§‹æ—¶ä½ ä½äº 0 å·æˆ¿é—´ã€‚æ¯ä¸ªæˆ¿é—´æœ‰ä¸åŒçš„å·ç ï¼š0ï¼Œ1ï¼Œ2ï¼Œ...ï¼ŒN-1ï¼Œå¹¶ä¸”æˆ¿é—´é‡Œå¯èƒ½æœ‰ä¸€äº›é’¥åŒ™èƒ½ä½¿ä½ è¿›å…¥ä¸‹ä¸€ä¸ªæˆ¿é—´ã€‚ åœ¨å½¢å¼ä¸Šï¼Œå¯¹äºæ¯ä¸ªæˆ¿é—´ i éƒ½æœ‰ä¸€ä¸ªé’¥åŒ™åˆ—è¡¨ rooms[i]ï¼Œæ¯ä¸ªé’¥åŒ™ rooms[i][j] ç”± [0,1ï¼Œ...ï¼ŒN-1] ä¸­çš„ä¸€ä¸ªæ•´æ•°è¡¨ç¤ºï¼Œå…¶ä¸­ N = rooms.lengthã€‚ é’¥åŒ™ rooms[i][j] = v å¯ä»¥æ‰“å¼€ç¼–å·ä¸º v çš„æˆ¿é—´ã€‚ æœ€åˆï¼Œé™¤ 0 å·æˆ¿é—´å¤–çš„å…¶ä½™æ‰€æœ‰æˆ¿é—´éƒ½è¢«é”ä½ã€‚ ä½ å¯ä»¥è‡ªç”±åœ°åœ¨æˆ¿é—´ä¹‹é—´æ¥å›èµ°åŠ¨ã€‚ å¦‚æœèƒ½è¿›å…¥æ¯ä¸ªæˆ¿é—´è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚ ç¤ºä¾‹ 1: è¾“å…¥: [[1],[2],[3],[]]è¾“å‡ºï¼š trueè§£é‡Šï¼šæˆ‘ä»¬ä» 0 å·æˆ¿é—´å¼€å§‹ï¼Œæ‹¿åˆ°é’¥åŒ™ 1ã€‚ä¹‹åæˆ‘ä»¬å» 1 å·æˆ¿é—´ï¼Œæ‹¿åˆ°é’¥åŒ™ 2ã€‚ç„¶åæˆ‘ä»¬å» 2 å·æˆ¿é—´ï¼Œæ‹¿åˆ°é’¥åŒ™ 3ã€‚æœ€åæˆ‘ä»¬å»äº† 3 å·æˆ¿é—´ã€‚ç”±äºæˆ‘ä»¬èƒ½å¤Ÿè¿›å…¥æ¯ä¸ªæˆ¿é—´ï¼Œæˆ‘ä»¬è¿”å› trueã€‚ ç¤ºä¾‹ 2: è¾“å…¥: [[1,3],[3,0,1],[2],[0]]è¾“å‡ºï¼š falseè§£é‡Šï¼š æˆ‘ä»¬ä¸èƒ½è¿›å…¥ 2 å·æˆ¿é—´ã€‚ æç¤ºï¼š 1 &lt;= rooms.length &lt;= 1000 0 &lt;= rooms[i].length &lt;= 1000 æ‰€æœ‰æˆ¿é—´ä¸­çš„é’¥åŒ™æ•°é‡æ€»è®¡ä¸è¶…è¿‡ 3000ã€‚ 2 è§£æ³•2.1 æ€æƒ³BFSæœç´¢ï¼Œè®°å½•å»è¿‡å“ªäº›æˆ¿é—´ã€‚ 2.2 ä»£ç class Solution { public boolean canVisitAllRooms(List&lt;List&lt;Integer>> rooms) { int size = rooms.size(); int[] mark = new int[size]; mark[0] = 1; Queue&lt;List&lt;Integer>> queue = new LinkedList&lt;>(); queue.offer(rooms.get(0)); while(!queue.isEmpty()){ List&lt;Integer> room = queue.poll(); for(int i:room){ if(mark[i]==0){ queue.offer(rooms.get(i)); mark[i] = 1; } } } for(int i:mark){ if(i==0) return false; } return true; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode133-å…‹éš†å›¾","slug":"leetcode133-å…‹éš†å›¾","date":"2019-12-12T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode133-å…‹éš†å›¾/","link":"","permalink":"https://www.codetool.top/article/leetcode133-%E5%85%8B%E9%9A%86%E5%9B%BE/","excerpt":"","text":"1 åŸé¢˜ç»™å®šæ— å‘è¿é€šå›¾ä¸­ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ï¼Œè¿”å›è¯¥å›¾çš„æ·±æ‹·è´ï¼ˆå…‹éš†ï¼‰ã€‚å›¾ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«å®ƒçš„å€¼ valï¼ˆIntï¼‰ å’Œå…¶é‚»å±…çš„åˆ—è¡¨ï¼ˆlist[Node]ï¼‰ã€‚ ç¤ºä¾‹: è¾“å…¥: {&quot;$id&quot;:&quot;1&quot;,&quot;neighbors&quot;:[{&quot;$id&quot;:&quot;2&quot;,&quot;neighbors&quot;:[{&quot;$ref&quot;:&quot;1&quot;},{&quot;$id&quot;:&quot;3&quot;,&quot;neighbors&quot;:[{&quot;$ref&quot;:&quot;2&quot;},{&quot;$id&quot;:&quot;4&quot;,&quot;neighbors&quot;:[{&quot;$ref&quot;:&quot;3&quot;},{&quot;$ref&quot;:&quot;1&quot;}],&quot;val&quot;:4}],&quot;val&quot;:3}],&quot;val&quot;:2},{&quot;$ref&quot;:&quot;4&quot;}],&quot;val&quot;:1}è§£é‡Š:èŠ‚ç‚¹ 1 çš„å€¼æ˜¯ 1ï¼Œå®ƒæœ‰ä¸¤ä¸ªé‚»å±…ï¼šèŠ‚ç‚¹ 2 å’Œ 4 ã€‚èŠ‚ç‚¹ 2 çš„å€¼æ˜¯ 2ï¼Œå®ƒæœ‰ä¸¤ä¸ªé‚»å±…ï¼šèŠ‚ç‚¹ 1 å’Œ 3 ã€‚èŠ‚ç‚¹ 3 çš„å€¼æ˜¯ 3ï¼Œå®ƒæœ‰ä¸¤ä¸ªé‚»å±…ï¼šèŠ‚ç‚¹ 2 å’Œ 4 ã€‚èŠ‚ç‚¹ 4 çš„å€¼æ˜¯ 4ï¼Œå®ƒæœ‰ä¸¤ä¸ªé‚»å±…ï¼šèŠ‚ç‚¹ 1 å’Œ 3 ã€‚ 2 è§£æ³•2.1 æ€æƒ³Hashmapç»´æŒåŸå›¾èŠ‚ç‚¹å’Œå…‹éš†èŠ‚ç‚¹çš„å¯¹åº”å…³ç³»ï¼Œå¦‚æœç»™é‚»å±…èŠ‚ç‚¹èµ‹å€¼çš„æ—¶å€™ä¸å­˜åœ¨å¯¹åº”çš„å…‹éš†èŠ‚ç‚¹åˆ™è·å–å¯¹åº”çš„å…‹éš†èŠ‚ç‚¹ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„é‚»å±…èŠ‚ç‚¹çš„å…‹éš†èŠ‚ç‚¹éƒ½å­˜åœ¨äºmapä¸­ã€‚ 2.2 ä»£ç /* // Definition for a Node. class Node { public int val; public List&lt;Node> neighbors; public Node() {} public Node(int _val,List&lt;Node> _neighbors) { val = _val; neighbors = _neighbors; } }; */ class Solution { //hashmapç»´æŒåŸå›¾å’Œå…‹éš†å›¾ä¹‹é—´èŠ‚ç‚¹çš„å¯¹åº”å…³ç³» Map&lt;Node, Node> lookup; public Node cloneGraph(Node node) { lookup = new HashMap&lt;>(); return dfs(node); } //æ¯ä¸€æ¬¡dfsæ“ä½œå®é™…ä¸Šå°±æ˜¯ç¡®ä¿å­˜åœ¨nodeèŠ‚ç‚¹çš„å¤åˆ¶èŠ‚ç‚¹ private Node dfs(Node node) { if (node == null) return null; //å­˜åœ¨å¯¹åº”çš„å…‹éš†èŠ‚ç‚¹ç›´æ¥è¿”å› if (lookup.containsKey(node)) return lookup.get(node); //å…ˆåˆ›å»ºå¯¹åº”çš„å…‹éš†èŠ‚ç‚¹ï¼Œé‚»å±…åˆ—è¡¨åœ¨é€’å½’è¿”å›çš„æ—¶å€™æ·»åŠ ã€‚ Node clone = new Node(node.val, new ArrayList&lt;>()); lookup.put(node, clone); for (Node n : node.neighbors) //æ·»åŠ nçš„å…‹éš†èŠ‚ç‚¹ clone.neighbors.add(dfs(n)); return clone; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode150-é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼","slug":"leetcode150-é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼","date":"2019-12-12T10:05:23.000Z","updated":"2020-02-20T14:55:21.057Z","comments":true,"path":"article/leetcode150-é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼/","link":"","permalink":"https://www.codetool.top/article/leetcode150-%E9%80%86%E6%B3%A2%E5%85%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B1%82%E5%80%BC/","excerpt":"","text":"1 åŸé¢˜æ ¹æ®é€†æ³¢å…°è¡¨ç¤ºæ³•ï¼Œæ±‚è¡¨è¾¾å¼çš„å€¼ã€‚ æœ‰æ•ˆçš„è¿ç®—ç¬¦åŒ…æ‹¬ +, -, *, / ã€‚æ¯ä¸ªè¿ç®—å¯¹è±¡å¯ä»¥æ˜¯æ•´æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯å¦ä¸€ä¸ªé€†æ³¢å…°è¡¨è¾¾å¼ã€‚ è¯´æ˜ï¼š æ•´æ•°é™¤æ³•åªä¿ç•™æ•´æ•°éƒ¨åˆ†ã€‚ ç»™å®šé€†æ³¢å…°è¡¨è¾¾å¼æ€»æ˜¯æœ‰æ•ˆçš„ã€‚æ¢å¥è¯è¯´ï¼Œè¡¨è¾¾å¼æ€»ä¼šå¾—å‡ºæœ‰æ•ˆæ•°å€¼ä¸”ä¸å­˜åœ¨é™¤æ•°ä¸º 0 çš„æƒ…å†µã€‚ ç¤ºä¾‹1: è¾“å…¥: [â€œ2â€, â€œ1â€, â€œ+â€, â€œ3â€, â€œâ€]*è¾“å‡º:** 9è§£é‡Š: ((2 + 1) * 3) = 9 ç¤ºä¾‹2: è¾“å…¥: [â€œ4â€, â€œ13â€, â€œ5â€, â€œ/â€œ, â€œ+â€]è¾“å‡º: 6è§£é‡Š: (4 + (13 / 5)) = 6 ç¤ºä¾‹3: è¾“å…¥: [â€œ10â€, â€œ6â€, â€œ9â€, â€œ3â€, â€œ+â€, â€œ-11â€, â€œâ€, â€œ/â€œ, â€œâ€, â€œ17â€, â€œ+â€, â€œ5â€, â€œ+â€]è¾“å‡º: 22è§£é‡Š: ((10 * (6 / ((9 + 3) * -11))) + 17) + 5= ((10 * (6 / (12 * -11))) + 17) + 5= ((10 * (6 / -132)) + 17) + 5= ((10 * 0) + 17) + 5= (0 + 17) + 5= 17 + 5= 22 2 è§£æ³•2.1 æ€æƒ³æœ€åº•å±‚å¿…æ˜¯ä¸€ä¸ªèƒ½è¿ç®—çš„æœ€å°å•å…ƒï¼Œåªè¦å°†ååºéå†çš„ç»“æœä¾æ¬¡å…¥æ ˆï¼Œé‡åˆ°ä¸€ä¸ªè¿ç®—ç¬¦åˆ™è®©ä¸¤ä¸ªæ•°å­—å‡ºæ ˆï¼Œè®¡ç®—ç»“æœä¹‹åå†å°†ç»“æœå…¥æ ˆï¼Œå¦‚æ­¤å¾ªç¯æœ€åå°±èƒ½å¾—åˆ°ç­”æ¡ˆã€‚ 2.2 ä»£ç class Solution { public int evalRPN(String[] tokens) { Stack&lt;Integer> stack = new Stack&lt;>(); for(String i:tokens){ if(i.equals(\"+\")){ int num1 = Integer.valueOf(stack.pop()); int num2 = Integer.valueOf(stack.pop()); stack.push(num1+num2); }else if(i.equals(\"-\")){ int num1 = Integer.valueOf(stack.pop()); int num2 = Integer.valueOf(stack.pop()); stack.push(num2-num1); }else if(i.equals(\"*\")){ int num1 = Integer.valueOf(stack.pop()); int num2 = Integer.valueOf(stack.pop()); stack.push(num1*num2); }else if(i.equals(\"/\")){ int num1 = Integer.valueOf(stack.pop()); int num2 = Integer.valueOf(stack.pop()); stack.push(num2/num1); }else{ stack.push(Integer.valueOf(i)); } } return stack.peek(); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode494-ç›®æ ‡å’Œ","slug":"leetcode494-ç›®æ ‡å’Œ","date":"2019-12-12T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode494-ç›®æ ‡å’Œ/","link":"","permalink":"https://www.codetool.top/article/leetcode494-%E7%9B%AE%E6%A0%87%E5%92%8C/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ï¼Œa1, a2, â€¦, an, å’Œä¸€ä¸ªç›®æ ‡æ•°ï¼ŒSã€‚ç°åœ¨ä½ æœ‰ä¸¤ä¸ªç¬¦å· + å’Œ -ã€‚å¯¹äºæ•°ç»„ä¸­çš„ä»»æ„ä¸€ä¸ªæ•´æ•°ï¼Œä½ éƒ½å¯ä»¥ä» + æˆ– -ä¸­é€‰æ‹©ä¸€ä¸ªç¬¦å·æ·»åŠ åœ¨å‰é¢ã€‚ è¿”å›å¯ä»¥ä½¿æœ€ç»ˆæ•°ç»„å’Œä¸ºç›®æ ‡æ•° S çš„æ‰€æœ‰æ·»åŠ ç¬¦å·çš„æ–¹æ³•æ•°ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: nums: [1, 1, 1, 1, 1], S: 3è¾“å‡º: 5è§£é‡Š:-1+1+1+1+1 = 3+1-1+1+1+1 = 3+1+1-1+1+1 = 3+1+1+1-1+1 = 3+1+1+1+1-1 = 3ä¸€å…±æœ‰5ç§æ–¹æ³•è®©æœ€ç»ˆç›®æ ‡å’Œä¸º3ã€‚ æ³¨æ„: æ•°ç»„éç©ºï¼Œä¸”é•¿åº¦ä¸ä¼šè¶…è¿‡20ã€‚ åˆå§‹çš„æ•°ç»„çš„å’Œä¸ä¼šè¶…è¿‡1000ã€‚ ä¿è¯è¿”å›çš„æœ€ç»ˆç»“æœèƒ½è¢«32ä½æ•´æ•°å­˜ä¸‹ã€‚ 2 è§£æ³•2.1 æ€æƒ³DFSæ¯”è¾ƒæš´åŠ›ï¼Œè¿½æ±‚æ—¶é—´å¿«å¯ä»¥ç”¨01èƒŒåŒ…é—®é¢˜çš„åŠ¨æ€è§„åˆ’æ€æƒ³ï¼Œä»¥åæ›´ã€‚ 2.2 ä»£ç class Solution { public int[] numsArray; public int target; public int findTargetSumWays(int[] nums, int S) { numsArray = nums; target = S; return dfs(0,0); } public int dfs(int index,int sum){ if(index == numsArray.length){ if(sum == target) return 1; else return 0; } return dfs(index+1,sum+numsArray[index])+dfs(index+1,sum-numsArray[index]); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode94-äºŒå‰æ ‘çš„ä¸­åºéå†","slug":"leetcode94-äºŒå‰æ ‘çš„ä¸­åºéå†","date":"2019-12-12T10:05:23.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/leetcode94-äºŒå‰æ ‘çš„ä¸­åºéå†/","link":"","permalink":"https://www.codetool.top/article/leetcode94-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E4%B8%AD%E5%BA%8F%E9%81%8D%E5%8E%86/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œè¿”å›å®ƒçš„ ä¸­åº éå†ã€‚ ç¤ºä¾‹: è¾“å…¥: [1,null,2,3]&nbsp;1&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;/&nbsp;3è¾“å‡º: [1,3,2] è¿›é˜¶: é€’å½’ç®—æ³•å¾ˆç®€å•ï¼Œä½ å¯ä»¥é€šè¿‡è¿­ä»£ç®—æ³•å®Œæˆå—ï¼Ÿ 2 è§£æ³•2.1 æ€æƒ³DFSï¼Œé€’å½’æ–¹æ³•ç€å®å¾ˆç®€å•ï¼Œè¿­ä»£å¾ˆæŠ½è±¡ã€‚ 2.2 ä»£ç é€’å½’ï¼š /** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */ class Solution { List&lt;Integer> ans = new ArrayList&lt;>(); public List&lt;Integer> inorderTraversal(TreeNode root) { if(root!=null){ inorderTraversal(root.left); ans.add(root.val); inorderTraversal(root.right); } return ans; } } è¿­ä»£ï¼Œæˆ‘ä¸€å¼€å§‹è¿™ä¹ˆå†™çš„ï¼Œç”¨ä¸€ä¸ªHashSetè®°å½•æ ˆå­˜å‚¨è¿‡çš„èŠ‚ç‚¹ï¼š class Solution { public List&lt;Integer> inorderTraversal(TreeNode root) { Stack&lt;TreeNode> stack = new Stack&lt;>(); List&lt;Integer> ans = new ArrayList&lt;>(); Set&lt;TreeNode> set = new HashSet&lt;>(); stack.push(root); if(root == null) return ans; while(!stack.empty()){ TreeNode node = stack.peek(); if(null!=node.left &amp;&amp; !set.contains(node.left)) { stack.push(node.left); set.add(node.left); } else{ ans.add(node.val); stack.pop(); if(null!=node.right) stack.push(node.right); node = null; } } return ans; } } ç„¶åçœ‹åˆ°å®˜æ–¹çš„å†™æ³•ï¼Œè¿™æ‰æ˜¯é€’å½’è½¬åŒ–è¿‡æ¥çš„å†™æ³•ï¼š public class Solution { public List &lt;Integer> inorderTraversal(TreeNode root) { List &lt;Integer> res = new ArrayList&lt;>(); Stack &lt;TreeNode> stack = new Stack&lt;>(); TreeNode curr = root; while (curr != null || !stack.isEmpty()) { while (curr != null) { stack.push(curr); curr = curr.left; } curr = stack.pop(); res.add(curr.val); curr = curr.right; } return res; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode155-æœ€å°æ ˆ","slug":"leetcode155-æœ€å°æ ˆ","date":"2019-12-11T10:05:23.000Z","updated":"2020-02-20T14:55:21.056Z","comments":true,"path":"article/leetcode155-æœ€å°æ ˆ/","link":"","permalink":"https://www.codetool.top/article/leetcode155-%E6%9C%80%E5%B0%8F%E6%A0%88/","excerpt":"","text":"1 åŸé¢˜è®¾è®¡ä¸€ä¸ªæ”¯æŒ pushï¼Œpopï¼Œtop æ“ä½œï¼Œå¹¶èƒ½åœ¨å¸¸æ•°æ—¶é—´å†…æ£€ç´¢åˆ°æœ€å°å…ƒç´ çš„æ ˆã€‚ push(x) â€“ å°†å…ƒç´  x æ¨å…¥æ ˆä¸­ã€‚ pop() â€“ åˆ é™¤æ ˆé¡¶çš„å…ƒç´ ã€‚ top() â€“ è·å–æ ˆé¡¶å…ƒç´ ã€‚ getMin() â€“ æ£€ç´¢æ ˆä¸­çš„æœ€å°å…ƒç´ ã€‚ ç¤ºä¾‹: MinStack minStack = new MinStack();minStack.push(-2);minStack.push(0);minStack.push(-3);minStack.getMin(); â€“&gt; è¿”å› -3.minStack.pop();minStack.top(); â€“&gt; è¿”å› 0.minStack.getMin(); â€“&gt; è¿”å› -2. 2 è§£æ³•2.1 æ€æƒ³ç”¨listå®ç°æ ˆï¼Œå†ç”¨ä¸€ä¸ªstackä¿å­˜ç€å…¥æ ˆæœŸé—´å‡ºç°è¿‡çš„æ‰€æœ‰æœ€å°æ•°ã€‚ï¼ˆæ ˆé¦–å…ƒç´ è¡¨ç¤ºåœ¨æŸä¸ªæ—¶åˆ»listä¸­æœ€å°çš„æ•°ï¼‰ã€‚ 2.2 ä»£ç class MinStack { public List&lt;Integer> list; public Stack&lt;Integer> stack; /** initialize your data structure here. */ public MinStack() { list = new ArrayList&lt;>(); stack = new Stack&lt;>(); } public void push(int x) { //æ·»åŠ å…ƒç´ æ—¶ï¼Œå¦‚æœæœ€å°æ•°æ ˆæ˜¯ç©ºçš„æˆ–è€…è¯¥å…ƒç´ æ¯”æ ˆé¦–å…ƒç´ è¦å°ï¼Œåˆ™å…¥æ ˆ if(stack.empty()||x&lt;=stack.peek()) stack.push(x); list.add(x); } public void pop() { //ç§»é™¤å…ƒç´ æ—¶ï¼Œå¦‚æœç§»é™¤çš„å…ƒç´ æ˜¯æœ€å°æ•°æ ˆçš„æ ˆé¦–å…ƒç´ ï¼Œé‚£ä¹ˆæ ˆé¦–å…ƒç´ ä¹Ÿè¦å‡ºæ ˆ if(stack.peek().equals(list.get(list.size()-1))) stack.pop(); list.remove(list.size()-1); } public int top() { return list.get(list.size()-1); } public int getMin() { //æœ€å°æ•°æ ˆçš„æ ˆé¦–å…ƒç´  return stack.peek(); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"}]},{"title":"leetcode20-æœ‰æ•ˆçš„æ‹¬å·","slug":"leetcode20-æœ‰æ•ˆçš„æ‹¬å·","date":"2019-12-11T10:05:23.000Z","updated":"2020-02-20T14:55:21.062Z","comments":true,"path":"article/leetcode20-æœ‰æ•ˆçš„æ‹¬å·/","link":"","permalink":"https://www.codetool.top/article/leetcode20-%E6%9C%89%E6%95%88%E7%9A%84%E6%8B%AC%E5%8F%B7/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªåªåŒ…æ‹¬ &#39;(&#39;ï¼Œ&#39;)&#39;ï¼Œ&#39;{&#39;ï¼Œ&#39;}&#39;ï¼Œ&#39;[&#39;ï¼Œ&#39;]&#39; çš„å­—ç¬¦ä¸²ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆã€‚ æœ‰æ•ˆå­—ç¬¦ä¸²éœ€æ»¡è¶³ï¼š å·¦æ‹¬å·å¿…é¡»ç”¨ç›¸åŒç±»å‹çš„å³æ‹¬å·é—­åˆã€‚ å·¦æ‹¬å·å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºé—­åˆã€‚ æ³¨æ„ç©ºå­—ç¬¦ä¸²å¯è¢«è®¤ä¸ºæ˜¯æœ‰æ•ˆå­—ç¬¦ä¸²ã€‚ ç¤ºä¾‹1: è¾“å…¥: â€œ()â€è¾“å‡º: true ç¤ºä¾‹2: è¾“å…¥: â€œ()[]{}â€è¾“å‡º: true ç¤ºä¾‹3: è¾“å…¥: â€œ(]â€è¾“å‡º: false ç¤ºä¾‹4: è¾“å…¥: â€œ([)]â€è¾“å‡º: false ç¤ºä¾‹5: è¾“å…¥: â€œ{[]}â€è¾“å‡º: true 2 è§£æ³•2.1 æ€æƒ³å·¦æ‹¬å·å…¨éƒ¨å…¥æ ˆï¼Œå¦‚æœæ˜¯å³æ‹¬å·å¯»æ‰¾æ ˆé¦–æ˜¯å¦ä¸ºå¯¹åº”çš„å·¦æ‹¬å·ï¼Œå­˜åœ¨å°±å°†å·¦æ‹¬å·å‡ºæ ˆï¼Œç›´åˆ°æ ˆå…ƒç´ å…¨éƒ¨æ¸…ç©ºã€‚ 2.2 ä»£ç class Solution { public boolean isValid(String s) { if(s.equals(\"\")) return true; Stack&lt;Character> stack = new Stack&lt;>(); for(char c:s.toCharArray()){ if(c=='('||c=='['||c=='{'){ stack.push(c); } if(c == ')'){ if(!stack.empty()&amp;&amp;stack.peek().equals('(')) stack.pop(); else return false; } if(c == ']'){ if(!stack.empty()&amp;&amp;stack.peek().equals('[')) stack.pop(); else return false; } if(c == '}'){ if(!stack.empty()&amp;&amp;stack.peek().equals('{')) stack.pop(); else return false; } } if(stack.empty()) return true; return false; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode279-å®Œå…¨å¹³æ–¹æ•°","slug":"leetcode279-å®Œå…¨å¹³æ–¹æ•°","date":"2019-12-11T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode279-å®Œå…¨å¹³æ–¹æ•°/","link":"","permalink":"https://www.codetool.top/article/leetcode279-%E5%AE%8C%E5%85%A8%E5%B9%B3%E6%96%B9%E6%95%B0/","excerpt":"","text":"1 åŸé¢˜ç»™å®šæ­£æ•´æ•° nï¼Œæ‰¾åˆ°è‹¥å¹²ä¸ªå®Œå…¨å¹³æ–¹æ•°ï¼ˆæ¯”å¦‚ 1, 4, 9, 16, â€¦ï¼‰ä½¿å¾—å®ƒä»¬çš„å’Œç­‰äº nã€‚ä½ éœ€è¦è®©ç»„æˆå’Œçš„å®Œå…¨å¹³æ–¹æ•°çš„ä¸ªæ•°æœ€å°‘ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: n = 12è¾“å‡º: 3è§£é‡Š: 12 = 4 + 4 + 4. ç¤ºä¾‹ 2: è¾“å…¥: n = 13è¾“å‡º: 2è§£é‡Š: 13 = 4 + 9. 2 è§£æ³•2.1 æ€æƒ³ä»¥12ä¸ºä¾‹ã€‚ è¿™é“é¢˜ç¡®å®å¯¹æ—¶é—´è¦æ±‚æ¯”è¾ƒä¸¥æ ¼ï¼Œå¦‚æœä¸è¿‡æ»¤æ‰é‡å¤è®¡ç®—çš„éƒ¨åˆ†ä¼šæ— æ³•é€šè¿‡ã€‚ ä»ç›®æ ‡æ•°å‡ºå‘è‡ªé¡¶å‘ä¸‹ï¼š ç”±å·²çŸ¥çš„ç›®æ ‡æ•°å‡ºå‘ï¼Œå‡å»æ¯”å®ƒå°çš„å¹³æ–¹æ•°ï¼Œè¿™æ ·ä¸€å±‚ä¸€å±‚å‡ä¸‹å»ï¼Œç›´åˆ°è·å¾—0çš„é‚£ä¸€å±‚çš„å±‚æ•°å°±æ˜¯ç­”æ¡ˆã€‚ éœ€è¦è¿‡æ»¤æ‰æ•°å€¼é‡å¤çš„èŠ‚ç‚¹ï¼Œæ¯”å¦‚11-4å’Œ8-1ã€‚ ä»å¹³æ–¹æ•°å‡ºå‘è‡ªåº•å‘ä¸Šï¼š ç”±æ¯”å·²çŸ¥ç›®æ ‡æ•°å°çš„æ‰€æœ‰å¹³æ–¹æ•°å‡ºå‘ï¼Œæ¯å±‚åšä¸€ä¸ªç»„åˆåŠ æ³•ï¼Œä½†æ˜¯æœ‰ä¸€äº›åœ°æ–¹éœ€è¦å¤„ç†ï¼š é‡åˆ°æ•°å€¼ç›¸ç­‰çš„èŠ‚ç‚¹ï¼Œå¦‚1+4å’Œ4+1ï¼Œè·³è¿‡è¯¥èŠ‚ç‚¹ã€‚ åœ¨ç»„åˆçš„æ—¶å€™é‡åˆ°ä»ä¸€ä¸ªæ•°å¼€å§‹ï¼ŒåŠ ä¸Šå®ƒå°±ä¼šå¤§äºç›®æ ‡æ•°ï¼Œé‚£ä¹ˆå®ƒä¹‹åçš„å¹³æ–¹æ•°éƒ½å¯ä»¥ä¸åšç»„åˆäº†ï¼Œå› ä¸ºéƒ½æ¯”å®ƒå¤§ã€‚ 2.2 ä»£ç è‡ªé¡¶å‘ä¸‹ï¼š class Node{ public int value; public int depth; public Node(int value,int depth){ this.value = value; this.depth = depth; } } class Solution { public int numSquares(int n) { int mark[] = new int[n]; if(n&lt;4) return n; Queue&lt;Node> queue = new LinkedList&lt;>(); queue.offer(new Node(n,0)); while(!queue.isEmpty()){ Node node = queue.poll(); if(node.value==0) return node.depth; int sqrt = (int)Math.sqrt(node.value); for(int i = sqrt; i > 0 ; i--){ if(mark[node.value-i*i]==0){ queue.offer(new Node(node.value-i*i,node.depth+1)); mark[node.value-i*i] = 1; } } } return -1; } } è‡ªåº•å‘ä¸Š class Node{ public int value; public int depth; public Node(int value,int depth){ this.value = value; this.depth = depth; } } class Solution { public int numSquares(int n) { Queue&lt;Node> queue = new LinkedList&lt;>(); int a = (int)Math.sqrt(n); int[] mark = new int[n+1]; for(int i = a;i>a/2;i--){ queue.offer(new Node(i*i,1)); mark[i*i] = 1; } while(!queue.isEmpty()){ Node node = queue.poll(); int value = node.value; if(value==n) return node.depth; for(int i = 1;i&lt;=a;i++){ if(value+i*i>n) break; if(mark[value+i*i]==1) continue; queue.offer(new Node(value+i*i,node.depth+1)); mark[value+i*i] = 1; } } return -1; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode739-æ¯æ—¥æ¸©åº¦","slug":"leetcode739-æ¯æ—¥æ¸©åº¦","date":"2019-12-11T10:05:23.000Z","updated":"2020-02-20T14:55:21.052Z","comments":true,"path":"article/leetcode739-æ¯æ—¥æ¸©åº¦/","link":"","permalink":"https://www.codetool.top/article/leetcode739-%E6%AF%8F%E6%97%A5%E6%B8%A9%E5%BA%A6/","excerpt":"","text":"1 åŸé¢˜æ ¹æ®æ¯æ—¥ æ°”æ¸© åˆ—è¡¨ï¼Œè¯·é‡æ–°ç”Ÿæˆä¸€ä¸ªåˆ—è¡¨ï¼Œå¯¹åº”ä½ç½®çš„è¾“å…¥æ˜¯ä½ éœ€è¦å†ç­‰å¾…å¤šä¹…æ¸©åº¦æ‰ä¼šå‡é«˜è¶…è¿‡è¯¥æ—¥çš„å¤©æ•°ã€‚å¦‚æœä¹‹åéƒ½ä¸ä¼šå‡é«˜ï¼Œè¯·åœ¨è¯¥ä½ç½®ç”¨ 0 æ¥ä»£æ›¿ã€‚ ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ªåˆ—è¡¨ temperatures = [73, 74, 75, 71, 69, 72, 76, 73]ï¼Œä½ çš„è¾“å‡ºåº”è¯¥æ˜¯ [1, 1, 4, 2, 1, 1, 0, 0]ã€‚ æç¤ºï¼š æ°”æ¸© åˆ—è¡¨é•¿åº¦çš„èŒƒå›´æ˜¯ [1, 30000]ã€‚æ¯ä¸ªæ°”æ¸©çš„å€¼çš„å‡ä¸ºåæ°åº¦ï¼Œéƒ½æ˜¯åœ¨ [30, 100] èŒƒå›´å†…çš„æ•´æ•°ã€‚ 2 è§£æ³•2.1 æ€æƒ³ åŸºç¡€æ ˆè§£æ³•ï¼šæ—¶é—´å¤æ‚åº¦O(nlog n)å°†æ•°ç»„å…ƒç´ ä¾æ¬¡å…¥æ ˆï¼Œå¦‚æœå½“å‰å…ƒç´ æ¯”æ ˆé¦–å…ƒç´ å¤§åˆ™å°†æ ˆé¦–å…ƒç´ å‡ºæ ˆï¼Œå¹¶çŸ¥é“äº†å’Œæ ˆé¦–å…ƒç´ ä¹‹é—´çš„è·ç¦»ã€‚å†æ¬¡å’Œä¸‹ä¸€ä¸ªæ ˆé¦–å…ƒç´ æ¯”è¾ƒï¼Œå¦‚æ­¤å¾ªç¯ã€‚ é€†åºè·³è·ƒï¼šæ—¶é—´å¤æ‚åº¦O(n)https://leetcode-cn.com/problems/daily-temperatures/solution/jie-ti-si-lu-by-pulsaryu/ 2.2 ä»£ç  åŸºç¡€æ ˆ class Node{ public int value; public int pos; public Node(int value,int pos){ this.value = value; this.pos = pos; } } class Solution { public int[] dailyTemperatures(int[] T) { Stack&lt;Node> stack = new Stack&lt;>(); int[] ans = new int[T.length]; for(int i = 0;i&lt;T.length;i++){ while(!stack.empty()&amp;&amp;T[i]>stack.peek().value){ Node node = stack.pop(); ans[node.pos] = i - node.pos; } stack.push(new Node(T[i],i)); } while(!stack.empty()){ Node node = stack.pop(); ans[node.pos] = 0; } return ans; } } é€†åºè·³è·ƒï¼ˆä½œè€…ï¼špulsaryuï¼‰ public int[] dailyTemperatures(int[] T) { int length = T.length; int[] result = new int[length]; //ä»å³å‘å·¦éå† for (int i = length - 2; i >= 0; i--) { // j+= result[j]æ˜¯åˆ©ç”¨å·²ç»æœ‰çš„ç»“æœè¿›è¡Œè·³è·ƒ for (int j = i + 1; j &lt; length; j+= result[j]) { if (T[j] > T[i]) { result[i] = j - i; break; } else if (result[j] == 0) { //é‡åˆ°0è¡¨ç¤ºåé¢ä¸ä¼šæœ‰æ›´å¤§çš„å€¼ï¼Œé‚£å½“ç„¶å½“å‰å€¼å°±åº”è¯¥ä¹Ÿä¸º0 result[i] = 0; break; } } } return result; }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"ç”¨hexoçš„live2dæ’ä»¶åšäº†ä¸€ä¸ªå¯ä»¥èŠå¤©çš„å°å® ç‰©","slug":"ç”¨hexoçš„live2dæ’ä»¶åšäº†ä¸€ä¸ªå¯ä»¥èŠå¤©çš„å°å® ç‰©","date":"2019-12-10T10:05:23.000Z","updated":"2019-12-19T08:20:11.867Z","comments":true,"path":"article/ç”¨hexoçš„live2dæ’ä»¶åšäº†ä¸€ä¸ªå¯ä»¥èŠå¤©çš„å°å® ç‰©/","link":"","permalink":"https://www.codetool.top/article/%E7%94%A8hexo%E7%9A%84live2d%E6%8F%92%E4%BB%B6%E5%81%9A%E4%BA%86%E4%B8%80%E4%B8%AA%E5%8F%AF%E4%BB%A5%E8%81%8A%E5%A4%A9%E7%9A%84%E5%B0%8F%E5%AE%A0%E7%89%A9/","excerpt":"","text":"ä»Šå¤©è§‰å¾—æˆ‘çš„åšå®¢æœ‰ç‚¹å°å°çš„ç®€é™‹ï¼Œå°±åšäº†ä¸€ç‚¹ç¾åŒ–å·¥ä½œ ä¸»è¦ä½¿ç”¨hexoçš„live2dæ’ä»¶ï¼ˆæ„Ÿè°¢ä½œè€…ï¼‰ï¼Œæ­é…ä¸Šæœºå™¨äººå¯¹è¯apiï¼Œåšäº†ä¸€ä¸ªå¯ä»¥èŠå¤©çš„å°å® ç‰©ã€‚ æœ¬æ¥æ˜¯åœ¨live2dçš„githubä¸»é¡µä¸Šçœ‹åˆ°äº†æœ‰dialogè¿™ä¸ªé…ç½®é€‰é¡¹ï¼Œä¸€å¼€å§‹ä»¥ä¸ºå°±æ˜¯å¯ä»¥é…ç½®ä¸€ä¸ªäº¤äº’å¼çš„èŠå¤©çª—å£ã€‚ dialogé…ç½® ç„¶åå‘ç°ä½¿ç”¨ä¸€è¨€apiåªæ˜¯è¿‡ä¸ªå‡ ç§’é’Ÿç»™ä½ å¼¹ä¸€å¥è¯çœ‹çœ‹ï¼Œä¹Ÿæ²¡æœ‰å…¶ä»–çš„apié€‰é¡¹å¯ä»¥é…ç½®ï¼Œåœ¨ç™¾åº¦ä¸Šä¸€æœå¥½åƒä¹Ÿæ²¡æœ‰å¤šå°‘äººå†™è¿‡å…³äºè¿™ä¸ªdialogçš„ç”¨æ³•ã€‚ ç„¶åæˆ‘çœ‹äº†ä¸‹å®ƒç”Ÿæˆçš„æºç ï¼š ç»„ä»¶ç»“æ„ live2d-widgetæ˜¯æ•´ä¸ªç»„ä»¶çš„divï¼Œé‡Œé¢æœ‰ä¸€ä¸ªlive2d-widget-dialogå°±æ˜¯å¡é€šå½¢è±¡ä¸Šé¢çš„é‚£ä¸ªå¯¹è¯æ¡†ï¼Œlive2dcanvaså°±æ˜¯ç”»å¡é€šå½¢è±¡çš„ç”»å¸ƒã€‚å¦‚æœè¦è®©å¯¹è¯æ¡†æ˜¾ç¤ºæ–‡å­—ï¼Œå°±æ˜¯ä¿®æ”¹classåä¸ºlive2d-widget-dialogçš„divçš„innerHtmlã€‚ æ—¢ç„¶æ²¡æœ‰æä¾›ç›¸å…³çš„å¯¹è¯apiï¼Œé‚£å°±æ‰‹åŠ¨åšä¸€ä¸ªå§ã€‚ 1 live2då®‰è£…ä½ æ—¢ç„¶çœ‹åˆ°äº†è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å°±å‡è®¾ä½ çŸ¥é“live2dæ˜¯ä»€ä¹ˆ (çœ‹æ¿å¨˜) ã€‚åœ¨hexoå®‰è£…live2dæ’ä»¶çš„æ–¹å¼å¾ˆç®€å•ï¼š npm install --save hexo-helper-live2d ç„¶åé€‰ä¸€ä¸ªå¿ƒä»ªçš„æ¨¡å‹å®‰è£…ï¼Œæ¨¡å‹çš„é¢„è§ˆå¯ä»¥å‚è€ƒæ’ä»¶ä½œè€…çš„åšå®¢ï¼š https://huaji8.top/post/live2d-plugin-2.0/ æ¨¡å‹çš„åç§°å‚è€ƒï¼š https://github.com/xiazeyu/live2d-widget-models npm install --save æ¨¡å‹åç§° ç„¶ååœ¨hexoæ ¹ç›®å½•ä¸‹çš„_config.ymlä¸­é…ç½®live2dï¼š #live2d live2d: enable: true scriptFrom: local model: use: live2d-widget-model-wanko #æ¨¡å‹é€‰æ‹© display: position: right #æ¨¡å‹ä½ç½® width: 200 #æ¨¡å‹å®½åº¦ height: 200 #æ¨¡å‹é«˜åº¦ hOffset: 20 #æ°´å¹³åç§» vOffset: 100 #å‚ç›´åç§» mobile: show: false #æ˜¯å¦åœ¨æ‰‹æœºç«¯æ˜¾ç¤º dialog: enable: true #å¯ç”¨å¯¹è¯æ¡† hitokoto: false å…·ä½“çš„é…ç½®å¯ä»¥å‚è€ƒï¼š https://l2dwidget.js.org/docs/class/src/index.js~L2Dwidget.html#instance-method-init 2 ç»„ä»¶æ”¹é€ 2.1 åœ¨æ¨¡å‹ä¸‹æ–¹å¢åŠ ä¸€ä¸ªinputè¾“å…¥æ¡†å› ä¸ºæˆ‘æŠŠæ¨¡å‹æ”¾åœ¨äº†å³è¾¹ï¼Œå¹¶ä¸”æ°´å¹³åç§»å’Œå‚ç›´åç§»éƒ½æ˜¯å·²çŸ¥çš„ã€‚è¦åœ¨å®ƒçš„ä¸‹æ–¹å¢åŠ ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œæ‰¾åˆ°hexoä¸­/themes/ä½ çš„ä¸»é¢˜/layout/layout.ejsæ–‡ä»¶ï¼Œåœ¨é‡Œé¢bodyæ ‡ç­¾ä¸­æœ«å°¾æ·»åŠ ï¼š &lt;div id=\"chat_input\"> &lt;input id=\"question\" type=\"text\" placeholder=\"é™ªæˆ‘èŠèŠå¤©å§\" onkeypress=\"return onKeyPress(event)\"/> &lt;/div> ç„¶ååœ¨æ–‡ä»¶å°¾éƒ¨é…ç½®å®ƒçš„æ ·å¼ï¼š &lt;style> #chat_input{ width: 200px; height: 40px; position: fixed; bottom: 80px; right: 20px; } #question{ border: none;/*å–æ¶ˆè¾“å…¥æ¡†è¾¹æ¡†*/ border-bottom: 1px #aaaaaa solid;/*è®¾ç½®ä¸‹è¾¹æ¡†*/ background-color: transparent;/*èƒŒæ™¯é€æ˜*/ padding: 5px; } /*æ‰‹æœºç«¯ä¸æ˜¾ç¤º*/ @media screen and (max-width: 480px) { #chat_input{ display: none; } #live2d-widget{ display: none; } } &lt;/style> è¾“å…¥æ¡†å°±åšå¥½äº†ã€‚ 2.2 èŠå¤©é€»è¾‘å®ç°è¦åšåˆ°æ™ºèƒ½èŠå¤©éœ€è¦ä¸€ä¸ªèŠå¤©æœºå™¨äººçš„apiï¼Œæœ‰å›¾çµæœºå™¨äººã€å°iæœºå™¨äººç­‰å¯ä»¥é€‰æ‹©ã€‚ æˆ‘è¿™é‡Œç”¨çš„æ˜¯èŒ‰è‰æœºå™¨äººï¼Œå°±ä¸æ¨èå¤§å®¶ä½¿ç”¨äº†ï¼Œå°å°åæ§½ä¸€ä¸‹è¿™ä¸ªå¼€å‘è€…å¥½åƒä¸æ˜¯å¾ˆæ‡‚åç«¯apiï¼Œé‰´æƒæ–¹å¼æœ‰ç‚¹å¥‡æ€ª (äººé—´è¿·æƒ‘è¡Œä¸ºå¤§èµ)ã€‚ è·å–äº†apiä¹‹åå°±å¯ä»¥åšè¾“å…¥æ¡†çš„äº‹ä»¶å¤„ç†ï¼šï¼ˆå› ä¸ºæˆ‘çš„ä¸»é¢˜ä¸åŒ…å«jQueryæˆ‘ä¹Ÿæ‡’å¾—å¼•ï¼Œå°±ç”¨çš„åŸç”Ÿjsï¼‰ //åœ¨èŠå¤©æ¡†æŒ‰ä¸‹å›è½¦äº‹ä»¶å¤„ç† function onKeyPress(e){ var keyCode = null; if(e.which) keyCode = e.which; else if(e.keyCode) keyCode = e.keyCode; //å¦‚æœæŒ‰ä¸‹å›è½¦ if(keyCode == 13) { // è·å–è¾“å…¥æ¡†ä¸­çš„é—®é¢˜ var question_box = document.getElementById('question') var question = question_box.value //æ¸…ç©ºè¾“å…¥æ¡†å†…å®¹å¹¶ç¦ç”¨è¾“å…¥æ¡† question_box.value = \"\" question_box.setAttribute(\"disabled\",\"disabled\") //ä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆä¸éšè—è¿™ä¸ª:ï¼‰ var api_key = \"78c33a07808c7b9e1905c89c88b3be14\" var api_secret = \"q707tevnk00f\" // é€šè¿‡XHRå‘é€ä¸€ä¸ªGETè¯·æ±‚ var xhr = new XMLHttpRequest() xhr.open('GET','http://i.itpk.cn/api.php?question='+encodeURIComponent(question)+\"&amp;api_key=\"+api_key+\"&amp;api_secret=\"+api_secret) xhr.onload = function(){ //å¯ç”¨è¾“å…¥æ¡† question_box.removeAttribute('disabled'); //è·å–å¯¹è¯æ¡† var live2d_dialog = document.getElementsByClassName(\"live2d-widget-dialog\")[0] //æ˜¾ç¤ºå¯¹è¯æ¡†å¹¶æŠŠè·å–åˆ°çš„å†…å®¹æ˜¾ç¤ºåœ¨å¯¹è¯æ¡†ä¸Š live2d_dialog.style.opacity=1 live2d_dialog.innerHTML = this.responseText //äº”ç§’åéšè—å¯¹è¯æ¡† window.setTimeout(()=>{ live2d_dialog.style.opacity=0 }, 5000); } } éœ€è¦æ³¨æ„çš„æ˜¯ï¼š ä¸€èˆ¬apiéƒ½ä¸å…è®¸jsè·¨åŸŸï¼Œéœ€è¦ç”¨è‡ªå·±çš„æœåŠ¡å™¨ä»£ç†ä¸€ä¸‹æˆ–è€…åšä¸€ä¸‹ä¸­é—´å¤„ç†ï¼ˆæŠŠè®¤è¯çš„ä¸œè¥¿æ”¾è‡ªå·±æœåŠ¡å™¨ä¸Šï¼‰ æˆ‘è¿™é‡Œæ²¡æŠŠè®¤è¯keyå’Œsecretæ”¾è‡ªå·±æœåŠ¡å™¨çš„åŸå› æ˜¯ã€‚ã€‚ã€‚è¿™ä¸ªapiçœ‹ä¸Šå»å°±å¾ˆä¸å®‰å…¨å•Šï¼Œæ²¡å¿…è¦å¤šæ­¤ä¸€ä¸¾ã€‚ ä¸€èˆ¬apiç”¨çš„æ˜¯POSTè¯·æ±‚å¹¶ä¸”éœ€è¦è§£æè¿”å›çš„JSONæ•°æ®ï¼Œæˆ‘è¿™é‡Œæ²¡æœ‰å¤§å®¶æ‡‚çš„éƒ½æ‡‚: ) 20:43è¡¥å……ï¼š è°çŸ¥é“æˆ‘æœ€åè¿˜æ˜¯ç”¨äº†è‡ªå·±çš„æœåŠ¡å™¨ä»£ç†ğŸ˜€ï¼Œå› ä¸ºæˆ‘å‘ç°httpsç½‘ç«™å‘é€ä¸äº†httpè¯·æ±‚ã€‚ å˜»å˜»ï¼Œè¯´ä¸å®šå“ªå¤©æˆ‘å°±æ¢ä¸ªapiç”¨äº†ã€‚","categories":[{"name":"æ—¥å¸¸/éšç¬”","slug":"æ—¥å¸¸-éšç¬”","permalink":"https://www.codetool.top/categories/%E6%97%A5%E5%B8%B8-%E9%9A%8F%E7%AC%94/"}],"tags":[{"name":"ç½‘ç«™æ—¥å¿—","slug":"ç½‘ç«™æ—¥å¿—","permalink":"https://www.codetool.top/tags/%E7%BD%91%E7%AB%99%E6%97%A5%E5%BF%97/"},{"name":"JavaScript","slug":"JavaScript","permalink":"https://www.codetool.top/tags/JavaScript/"},{"name":"hexo","slug":"hexo","permalink":"https://www.codetool.top/tags/hexo/"}]},{"title":"leetcode752-æ‰“å¼€è½¬ç›˜é”","slug":"leetcode752-æ‰“å¼€è½¬ç›˜é”","date":"2019-12-09T10:05:23.000Z","updated":"2020-04-30T05:51:12.344Z","comments":true,"path":"article/leetcode752-æ‰“å¼€è½¬ç›˜é”/","link":"","permalink":"https://www.codetool.top/article/leetcode752-%E6%89%93%E5%BC%80%E8%BD%AC%E7%9B%98%E9%94%81/","excerpt":"","text":"1 åŸé¢˜ä½ æœ‰ä¸€ä¸ªå¸¦æœ‰å››ä¸ªåœ†å½¢æ‹¨è½®çš„è½¬ç›˜é”ã€‚æ¯ä¸ªæ‹¨è½®éƒ½æœ‰10ä¸ªæ•°å­—ï¼š &#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;ã€‚æ¯ä¸ªæ‹¨è½®å¯ä»¥è‡ªç”±æ—‹è½¬ï¼šä¾‹å¦‚æŠŠ&#39;9&#39; å˜ä¸º &#39;0&#39;ï¼Œ&#39;0&#39;å˜ä¸º &#39;9&#39; ã€‚æ¯æ¬¡æ—‹è½¬éƒ½åªèƒ½æ—‹è½¬ä¸€ä¸ªæ‹¨è½®çš„ä¸€ä½æ•°å­—ã€‚ é”çš„åˆå§‹æ•°å­—ä¸º &#39;0000&#39; ï¼Œä¸€ä¸ªä»£è¡¨å››ä¸ªæ‹¨è½®çš„æ•°å­—çš„å­—ç¬¦ä¸²ã€‚ åˆ—è¡¨ deadends åŒ…å«äº†ä¸€ç»„æ­»äº¡æ•°å­—ï¼Œä¸€æ—¦æ‹¨è½®çš„æ•°å­—å’Œåˆ—è¡¨é‡Œçš„ä»»ä½•ä¸€ä¸ªå…ƒç´ ç›¸åŒï¼Œè¿™ä¸ªé”å°†ä¼šè¢«æ°¸ä¹…é”å®šï¼Œæ— æ³•å†è¢«æ—‹è½¬ã€‚ å­—ç¬¦ä¸² target ä»£è¡¨å¯ä»¥è§£é”çš„æ•°å­—ï¼Œä½ éœ€è¦ç»™å‡ºæœ€å°çš„æ—‹è½¬æ¬¡æ•°ï¼Œå¦‚æœæ— è®ºå¦‚ä½•ä¸èƒ½è§£é”ï¼Œè¿”å› -1ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: deadends = [â€œ0201â€,â€0101â€,â€0102â€,â€1212â€,â€2002â€], target = â€œ0202â€è¾“å‡ºï¼š 6è§£é‡Šï¼šå¯èƒ½çš„ç§»åŠ¨åºåˆ—ä¸º â€œ0000â€ -&gt; â€œ1000â€ -&gt; â€œ1100â€ -&gt; â€œ1200â€ -&gt; â€œ1201â€ -&gt; â€œ1202â€ -&gt; â€œ0202â€ã€‚æ³¨æ„ â€œ0000â€ -&gt; â€œ0001â€ -&gt; â€œ0002â€ -&gt; â€œ0102â€ -&gt; â€œ0202â€ è¿™æ ·çš„åºåˆ—æ˜¯ä¸èƒ½è§£é”çš„ï¼Œå› ä¸ºå½“æ‹¨åŠ¨åˆ° â€œ0102â€ æ—¶è¿™ä¸ªé”å°±ä¼šè¢«é”å®šã€‚ ç¤ºä¾‹ 2: è¾“å…¥: deadends = [â€œ8888â€], target = â€œ0009â€è¾“å‡ºï¼š 1è§£é‡Šï¼šæŠŠæœ€åä¸€ä½åå‘æ—‹è½¬ä¸€æ¬¡å³å¯ â€œ0000â€ -&gt; â€œ0009â€ã€‚ ç¤ºä¾‹ 3: è¾“å…¥: deadends = [â€œ8887â€,â€8889â€,â€8878â€,â€8898â€,â€8788â€,â€8988â€,â€7888â€,â€9888â€], target = â€œ8888â€è¾“å‡ºï¼š -1è§£é‡Šï¼šæ— æ³•æ—‹è½¬åˆ°ç›®æ ‡æ•°å­—ä¸”ä¸è¢«é”å®šã€‚ ç¤ºä¾‹ 4: è¾“å…¥: deadends = [â€œ0000â€], target = â€œ8888â€è¾“å‡ºï¼š -1 æç¤ºï¼š æ­»äº¡åˆ—è¡¨ deadends çš„é•¿åº¦èŒƒå›´ä¸º [1, 500]ã€‚ ç›®æ ‡æ•°å­— target ä¸ä¼šåœ¨ deadends ä¹‹ä¸­ã€‚ æ¯ä¸ª deadends å’Œ target ä¸­çš„å­—ç¬¦ä¸²çš„æ•°å­—ä¼šåœ¨ 10,000 ä¸ªå¯èƒ½çš„æƒ…å†µ â€˜0000â€™ åˆ° â€˜9999â€™ ä¸­äº§ç”Ÿã€‚ 2 è§£æ³•2.1 æ€æƒ³å…¶å®æ˜¯ä¸€ä¸ªæ ‘çš„BFSæœç´¢é—®é¢˜ï¼š ç”¨Queueæ¥å¾—åˆ°æ¯å±‚çš„èŠ‚ç‚¹ã€‚ ä¸»è¦éœ€è¦æ³¨æ„çš„åœ°æ–¹æœ‰ï¼š ä¸ºäº†é¿å…é‡å¤çš„èŠ‚ç‚¹è¿›å…¥é˜Ÿåˆ—ï¼Œå¯ä»¥ä½¿ç”¨æ•°ç»„è®°å½•æ˜¯å¦å‡ºç°è¿‡ï¼Œæˆ–æ˜¯ç”¨HashSetè®°å½•å‡ºç°è¿‡çš„èŠ‚ç‚¹ã€‚ å½“é‡åˆ°æ­»äº¡æ•°å­—æ•°ç»„ä¸­çš„å…ƒç´ æ—¶ä¹Ÿä¸èƒ½å°†è¯¥å…ƒç´ æ·»åŠ è‡³é˜Ÿåˆ—ä¸­ã€‚ å½“æœç´¢åˆ°é¢˜ç›®è¦æ±‚çš„å…ƒç´ æ—¶ï¼Œä¸ºäº†å¾—åˆ°å½“å‰å±‚æ•°ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š ç”¨ä¸€ä¸ªæ•°æ®ç»“æ„è¡¨ç¤ºèŠ‚ç‚¹ï¼Œè®°å½•èŠ‚ç‚¹çš„å€¼å’Œå±‚æ•°ã€‚ æ¯å±‚å…ƒç´ å…¥é˜Ÿåˆ—ä¹‹åå†åŠ å…¥ä¸€ä¸ªnullå…ƒç´ ï¼Œæ¯æ¬¡éå†åˆ°nullå…ƒç´ å³å¯çŸ¥é“éå†å®Œäº†äº†ä¸€å±‚ã€‚ 2.2 ä»£ç æˆ‘ä¸€å¼€å§‹æ˜¯è¿™æ ·å†™çš„ï¼š //èŠ‚ç‚¹çš„æ•°æ®ç»“æ„ï¼Œéœ€è¦è®°å½•å±‚æ•° class Node{ public String value; public int count; public Node(String value,int count){ this.value = value; this.count = count; } } class Solution { public int openLock(String[] deadends, String target) { //å¦‚æœæ­»äº¡æ•°ç»„ä¸­å­˜åœ¨0000ç›´æ¥è¿”å›-1 if(arrayContains(deadends,\"0000\")) return -1; //æ ‡è®°æ•°ç»„ç”¨äºè®°å½•å“ªäº›æ•°å­—å‡ºç°è¿‡ int[] mark = new int[10000]; //0000å‡ºç°è¿‡ mark[0] = 1; Queue&lt;Node> queue = new LinkedList&lt;Node>(); queue.offer(new Node(\"0000\",0)); while(!queue.isEmpty()){ //è·å–é˜Ÿåˆ—å¤´ Node node = queue.poll(); if(node.value.equals(target)) return node.count; else { char[] charArray = node.value.toCharArray(); for(int i = 0;i&lt;4;i++) { //ä½äºç¬¬iä½çš„æ•°å­—+1ï¼Œå¦‚æœæ˜¯9å˜æˆ0 char[] plusOneCharArray = Arrays.copyOf(charArray,charArray.length); plusOneCharArray[i] = (char) (charArray[i]=='9'?'0':charArray[i]+1); String plusOne = String.valueOf(plusOneCharArray); if(plusOne.equals(target)) return node.count+1; //æ²¡æœ‰å‡ºç°è¿‡ä¸”ä¸åœ¨æ­»äº¡æ•°å­—ä¸­æ‰æ·»åŠ è‡³é˜Ÿåˆ—ä¸­ if((!arrayContains(deadends, plusOne))&amp;&amp;mark[Integer.valueOf(plusOne)]==0) { queue.offer(new Node(plusOne,node.count+1)); mark[Integer.valueOf(plusOne)] = 1; } //ä½äºç¬¬iä½çš„æ•°å­—-1ï¼Œå¦‚æœæ˜¯0å˜æˆ9 char[] minusOneCharArray = Arrays.copyOf(charArray,charArray.length); minusOneCharArray[i] = (char) (charArray[i]=='0'?'9':charArray[i]-1); String minusOne = String.valueOf(minusOneCharArray); if(minusOne.equals(target)) return node.count+1; //æ²¡æœ‰å‡ºç°è¿‡ä¸”ä¸åœ¨æ­»äº¡æ•°å­—ä¸­æ‰æ·»åŠ è‡³é˜Ÿåˆ—ä¸­ if((!arrayContains(deadends, minusOne))&amp;&amp;mark[Integer.valueOf(minusOne)]==0) { queue.offer(new Node(minusOne,node.count+1)); mark[Integer.valueOf(minusOne)] = 1; } } } } return -1; } //éå†æ•°ç»„ï¼Œç”¨äºæ£€æµ‹æ­»äº¡æ•°å­—ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„æ•°å­— public boolean arrayContains(String[] stringArray,String toFind) { for(String i:stringArray) { if(i.equals(toFind)) return true; } return false; } } ç„¶åå‘ç°ä¸Šé¢è¿™ç§æ–¹æ³•éœ€è¦çš„æ—¶é—´è´¼ä¹…ï¼Œæœ€åå¼ºè¡Œç†è§£äº†ä¸€ä¸‹å‘ç°é—®é¢˜ä¸»è¦å‡ºåœ¨æ£€æµ‹æ­»äº¡æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šæ•°å­—çš„æ—¶å€™ï¼Œæ—¶é—´å¼€é”€å¤ªé«˜äº†ã€‚ æœ€åè¿˜æ˜¯æ¢æˆäº†ç”¨HashSetæ£€æµ‹æ­»äº¡æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„æ•°å­—ï¼š class Node{ public String value; public int count; public Node(String value,int count){ this.value = value; this.count = count; } } class Solution { public int openLock(String[] deadends, String target) { //å°†æ­»äº¡æ•°å­—å…¨éƒ¨åŠ è¿›ä¸€ä¸ªHashSetä¸­ Set&lt;String> set = new HashSet&lt;String>(); for(String i:deadends) { if(i.equals(\"0000\")) return -1; set.add(i); } int[] mark = new int[10000]; mark[0] = 1; Queue&lt;Node> queue = new LinkedList&lt;Node>(); queue.offer(new Node(\"0000\",0)); while(!queue.isEmpty()){ Node node = queue.poll(); if(node.value.equals(target)) return node.count; else { char[] charArray = node.value.toCharArray(); for(int i = 0;i&lt;4;i++) { char[] plusOneCharArray = Arrays.copyOf(charArray,charArray.length); plusOneCharArray[i] = (char) (charArray[i]=='9'?'0':charArray[i]+1); String plusOne = String.valueOf(plusOneCharArray); if(plusOne.equals(target)) return node.count+1; if((!set.contains(plusOne))&amp;&amp;mark[Integer.valueOf(plusOne)]==0) { queue.offer(new Node(plusOne,node.count+1)); mark[Integer.valueOf(plusOne)] = 1; } char[] minusOneCharArray = Arrays.copyOf(charArray,charArray.length); minusOneCharArray[i] = (char) (charArray[i]=='0'?'9':charArray[i]-1); String minusOne = String.valueOf(minusOneCharArray); if(minusOne.equals(target)) return node.count+1; if((!set.contains(minusOne))&amp;&amp;mark[Integer.valueOf(minusOne)]==0) { queue.offer(new Node(minusOne,node.count+1)); mark[Integer.valueOf(minusOne)] = 1; } } } } return -1; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"è°ˆè°ˆjavaä¸­çš„Iterator","slug":"è°ˆè°ˆIteratorå’Œå‰è¾ˆEnumeration","date":"2019-12-06T10:05:23.000Z","updated":"2020-02-20T14:55:21.057Z","comments":true,"path":"article/è°ˆè°ˆIteratorå’Œå‰è¾ˆEnumeration/","link":"","permalink":"https://www.codetool.top/article/%E8%B0%88%E8%B0%88Iterator%E5%92%8C%E5%89%8D%E8%BE%88Enumeration/","excerpt":"","text":"1 æ‘˜è¦ Iteratorçš„ä½œç”¨ï¼Ÿ Iteratorå’ŒEnumerationçš„åŒºåˆ«ï¼Ÿ Iteratorå’ŒListIteratorçš„åŒºåˆ«ï¼Ÿ Iteratorå’Œforeachçš„å…³è”ï¼Ÿ 2 Iteratorçš„ä½œç”¨Iteratorï¼Œä¸­æ–‡è¯‘ä½œè¿­ä»£å™¨ï¼Œæ˜¯ä¸€ç§æ£€æŸ¥å®¹å™¨å†…å…ƒç´ å¹¶éå†å…ƒç´ çš„æ•°æ®ç±»å‹ã€‚å®ƒèƒ½ä½¿ä½¿ç”¨è€…ä¸å¿…å…³å¿ƒéå†å…ƒç´ çš„è¿‡ç¨‹ï¼Œç»Ÿä¸€äº†å¯¹å…ƒç´ çš„è®¿é—®æ–¹å¼ã€‚ åœ¨JDK1.8ä¸­ï¼ŒIteratoræ¥å£åŒ…å«ä¸‹é¢è¿™äº›æ–¹æ³•ï¼š //æ˜¯å¦æœ‰ä¸‹ä¸ªå…ƒç´  boolean hasNext(); //è·å–ä¸‹ä¸ªå…ƒç´  E next(); //ç§»é™¤è¿­ä»£å™¨å½“å‰æŒ‡å‘çš„å…ƒç´ ï¼Œè¿™ä¸ªåŠŸèƒ½ä¸å¼ºåˆ¶å®ç°ï¼Œå¯ä»¥æŠ›å‡ºUnsupportedOperationExceptionå¼‚å¸¸ void remove(); //æ¯ä¸ªå…ƒç´ ä½œä¸ºå‚æ•°ä¼ é€’ç»™Consumeræ¥å£çš„accept void forEachRemaining(Consumer&lt;? super E> action); 3 Iteratorå’ŒEnumerationçš„åŒºåˆ«Iteratoræ˜¯JDK1.2åæ‰å‡ºç°çš„æ¥å£ï¼Œç›®çš„æ˜¯ä¸ºäº†å–ä»£Enumerationã€‚ Enumerationçš„ä½œç”¨å’ŒIteratorç›¸ä¼¼ï¼Œå®ƒåŒ…å«ä¸‹é¢çš„æ–¹æ³•ï¼š //æ˜¯å¦å­˜åœ¨æ›´å¤šå…ƒç´  boolean hasMoreElements(); //è·å–ä¸‹ä¸€ä¸ªå…ƒç´  E nextElement(); Iteratorï¼š ç®€åŒ–äº†æ–¹æ³•åç§° å¢åŠ äº†ç§»é™¤å…ƒç´ çš„æ“ä½œ 4 Iteratorå’ŒListIteratorçš„åŒºåˆ«Listæ¥å£ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•listIterator()ç”¨äºè¿”å›ä¸€ä¸ªListè¿­ä»£å™¨ï¼ŒArrayListåœ¨å†…éƒ¨ç±»ä¸­å®ç°äº†è¿™ä¸ªè¿­ä»£å™¨ï¼Œè°ƒç”¨listIterator()æ—¶é€šè¿‡æ„é€ æ–¹æ³•æ„é€ å‡ºä¸€ä¸ªListIteratorå¯¹è±¡å¹¶è¿”å›ã€‚ é‚£ä¹ˆIteratorå’ŒListIteratoræœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ ListIteratoræ˜¯Iteratorçš„æ‰©å…… ListIteratoræ¥å£ä¸­é™¤äº†ç»§æ‰¿è‡ªIteratorä¸­çš„æ–¹æ³•ï¼Œè¿˜æœ‰ï¼š //æ˜¯å¦æœ‰ä¸Šä¸€ä¸ªå…ƒç´  boolean hasPrevious(); //è·å–ä¸Šä¸€ä¸ªå…ƒç´  E previous(); //ä¸‹ä¸€ä¸ªå…ƒç´ çš„index int nextIndex(); //ä¸Šä¸€ä¸ªå…ƒç´ çš„index int previousIndex(); //ç”¨ä¸€ä¸ªå…ƒç´ æ›¿æ¢å½“å‰æŒ‡å‘çš„å…ƒç´  void set(E e); //åœ¨å½“å‰ä½ç½®æ’å…¥ä¸€ä¸ªå…ƒç´  void add(E e); 5 Iteratorå’Œforeachçš„å…³è”ï¼Ÿforeachåªæ”¯æŒæ•°ç»„æˆ–å®ç°äº†Iterableæ¥å£çš„ç±»ã€‚ Iterableæ¥å£å¼ºåˆ¶è¦æ±‚å®ç°iterator()æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œforeachè¯­å¥åº•å±‚è¿˜æ˜¯é€šè¿‡iteratorçš„éå†å®ç°çš„ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://www.codetool.top/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}]},{"title":"Javaè‡ªåŠ¨è£…ç®±ç¼“å­˜æœºåˆ¶","slug":"Javaè‡ªåŠ¨è£…ç®±ç¼“å­˜æœºåˆ¶","date":"2019-12-05T10:05:23.000Z","updated":"2020-03-30T11:54:40.297Z","comments":true,"path":"article/Javaè‡ªåŠ¨è£…ç®±ç¼“å­˜æœºåˆ¶/","link":"","permalink":"https://www.codetool.top/article/Java%E8%87%AA%E5%8A%A8%E8%A3%85%E7%AE%B1%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6/","excerpt":"","text":"å°è¯•è¿è¡Œè¿™æ®µä»£ç ï¼š ç›¸ä¼¼çš„ä¸¤æ®µä»£ç ï¼Œå¾—åˆ°çš„ç»“æœå´å®Œå…¨ä¸ç›¸åŒã€‚ é¦–å…ˆè¦çŸ¥é“åœ¨javaä¸­==æ¯”è¾ƒçš„æ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼Œä»ç›´è§‰å‡ºå‘ï¼Œæ— è®ºæ˜¯integer1ã€integer2è¿˜æ˜¯integer3ã€integer4éƒ½æ˜¯ä¸åŒçš„å¼•ç”¨ï¼Œç»“æœéƒ½åº”è¯¥æ˜¯ä¸ç­‰çš„ã€‚ é€ æˆè¿™ä¸ªç»“æœçš„åŸå› æ˜¯JDK1.5å¼•å…¥çš„åŒ…è£…ç±»è‡ªåŠ¨è£…ç®±æ—¶çš„ç¼“å­˜æœºåˆ¶ è‡ªåŠ¨è£…ç®±çš„æ¦‚å¿µï¼š Integer a = 10; //è‡ªåŠ¨è£…ç®±ï¼Œç›¸å½“äºä¸‹é¢è¿™å¥ Integer a = Integer.valueOf(10); è€Œçœ‹çœ‹Integerä¸­valueOf(int)çš„æºç ï¼š public static Integer valueOf(int i) { if (i >= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high) return IntegerCache.cache[i + (-IntegerCache.low)];//è¿™å¥å°±æ˜¯æˆ‘ä»¬è¦ç ”ç©¶çš„é‡ç‚¹ return new Integer(i); } IntegerCacheæ˜¯ä¸€ä¸ªç¼“å­˜ç±»ï¼Œå®ƒçš„å†…éƒ¨æœ‰ä¸€ä¸ªé™æ€çš„Integer cache[]æ•°ç»„ï¼Œåœ¨è¿™ä¸ªç±»ç¬¬ä¸€æ¬¡è¢«åŠ è½½æ—¶ï¼Œä¼šç”¨æ•´æ•°å€¼åœ¨-128~127ä¹‹é—´çš„Integerå®ä¾‹å¯¹è±¡å¡«å……è¿™ä¸ªæ•°ç»„ï¼Œå¦‚æœè°ƒç”¨valueOfæ–¹æ³•çš„æ—¶å€™å‚æ•°å€¼åœ¨è¿™ä¸ªèŒƒå›´å†…ï¼Œå°±ä¼šä»IntegerCacheä¸­çš„cacheæ•°ç»„å»å–å‡ºè¿™æ ·ä¸€ä¸ªå…±äº«å¯¹è±¡ã€‚ è¿™æ ·å°±èƒ½å›ç­”ä¸€å¼€å§‹çš„ç¨‹åºinteger1ã€integer2ä¸ºä»€ä¹ˆç›¸ç­‰äº†ï¼Œå› ä¸ºä»–ä»¬éƒ½æ˜¯ä»cacheæ•°ç»„ä¸­å–å‡ºæ¥çš„åŒä¸€ä¸ªå¼•ç”¨ã€‚ è€Œ300è¿™ä¸ªæ•°æ˜¯ä¸åœ¨-128~127ä¹‹é—´çš„ï¼Œç¼“å­˜æ•°ç»„ä¸­ä¸å­˜åœ¨è¿™æ ·çš„å¯¹è±¡ï¼Œæœ€ç»ˆæ˜¯è°ƒç”¨äº†æ„é€ æ–¹æ³•åˆ›å»ºäº†ä¸¤ä¸ªä¸åŒçš„Integerå¯¹è±¡ã€‚ æ‹“å±•ï¼šIntegerCacheçš„é™æ€ä»£ç å— static { // ç¼“å­˜çš„æ•°æ®èŒƒå›´å¯ä»¥ç”±ç”¨æˆ·è®¾ç½®ï¼Œè¿™é‡Œä»é…ç½®ä¸­è·å–äº†ç”¨æˆ·è®¾ç½®çš„ç¼“å­˜èŒƒå›´ int h = 127; String integerCacheHighPropValue = sun.misc.VM.getSavedProperty(\"java.lang.Integer.IntegerCache.high\"); if (integerCacheHighPropValue != null) { try { int i = parseInt(integerCacheHighPropValue); i = Math.max(i, 127); // Maximum array size is Integer.MAX_VALUE h = Math.min(i, Integer.MAX_VALUE - (-low) -1); } catch( NumberFormatException nfe) { // If the property cannot be parsed into an int, ignore it. } } high = h; cache = new Integer[(high - low) + 1]; int j = low; // è¿™é‡Œå¾ªç¯æ„é€ Integerå¯¹è±¡å¡«å……cacheæ•°ç»„ for(int k = 0; k &lt; cache.length; k++) cache[k] = new Integer(j++); // range [-128, 127] must be interned (JLS7 5.1.7) assert IntegerCache.high >= 127; }","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://www.codetool.top/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}]},{"title":"WinFormæˆªå›¾OCRå°é¡¹ç›®çš„å¼€å‘-ç¥è§çŸ¥è¯†çš„èä¼šè´¯é€š","slug":"winformæˆªå›¾OCRå°é¡¹ç›®çš„å¼€å‘-ç¥è§çŸ¥è¯†çš„èä¼šè´¯é€š","date":"2019-12-04T10:05:23.000Z","updated":"2020-03-25T04:40:05.296Z","comments":true,"path":"article/winformæˆªå›¾OCRå°é¡¹ç›®çš„å¼€å‘-ç¥è§çŸ¥è¯†çš„èä¼šè´¯é€š/","link":"","permalink":"https://www.codetool.top/article/winform%E6%88%AA%E5%9B%BEOCR%E5%B0%8F%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%BC%80%E5%8F%91-%E7%9E%A5%E8%A7%81%E7%9F%A5%E8%AF%86%E7%9A%84%E8%9E%8D%E4%BC%9A%E8%B4%AF%E9%80%9A/","excerpt":"","text":"æœ€è¿‘å› ä¸ºæœ‰ä¸ªéœ€è¦æˆªå›¾OCRçš„éœ€æ±‚ï¼Œå†åŠ ä¸Šéœ€è¦äº¤ä¸€ä¸ªC#å¤§ä½œä¸šï¼Œå°±åšäº†ä¸€ä¸ªWinFormæˆªå›¾OCRå°é¡¹ç›®å‡ºæ¥ã€‚ï¼ˆä¸è¿‡åæ¥å‘ç°QQæˆªå›¾å¥½åƒå·²ç»æœ‰è¿™åŠŸèƒ½äº†ğŸŒšï¼‰ è¿è¡Œæˆªå›¾ï¼š è°ˆä¸€è°ˆæŒºæœ‰æ„æ€çš„ä¸€äº›çŸ¥è¯†ç‚¹ï¼š 1 Httpè¯·æ±‚1.1 Delegateå§”æ‰˜å›è°ƒæˆ‘å°è£…äº†ä¸€ä¸ªPOSTè¯·æ±‚çš„å‡½æ•°ï¼šéœ€è¦ä¸‹è½½ä¸€ä¸ªNewtonsoft.Jsonç”¨äºå¤„ç†å“åº”çš„JSONæ•°æ®è¿™ç§æ–¹å¼æ˜¯ä½¿ç”¨äº†ä¸€ä¸ªå§”æ‰˜å›è°ƒï¼Œç±»ä¼¼äºJavaScriptä¸­çš„å›è°ƒå‡½æ•°ï¼ŒC#ä¸­å«Delegateå›è°ƒ delegate void AfterRequest(JObject data); class HttpUtil { /// &lt;summary> /// å‘å‡ºPOSTè¯·æ±‚ /// &lt;/summary> /// &lt;param name=\"url\">è¯·æ±‚çš„url&lt;/param> /// &lt;param name=\"requestBody\">urlå‚æ•°æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œå¦‚\"key1=value1&amp;key2=value2\",éœ€è¦ç»è¿‡urlencodeå¤„ç†&lt;/param> /// &lt;param name=\"function\">å›è°ƒå‡½æ•°,dataæ˜¯ä¸€ä¸ªjsonè½¬æ¢ä¸ºçš„ä¸€ä¸ªJObjectå¯¹è±¡&lt;/param> public static void PostAsync(String url, string requestBody, AfterRequest function) { try { string responseBody = null; HttpClient httpClient = new HttpClient(); //StringContent content = new StringContent(requestBody,System.Text.Encoding.UTF8, \"application/x-www-form-urlencoded\"); StringContent content = new StringContent(requestBody); content.Headers.ContentType = new System.Net.Http.Headers.MediaTypeHeaderValue(\"application/x-www-form-urlencoded\"); HttpResponseMessage response = null; response = httpClient.PostAsync(url, content).Result; response.EnsureSuccessStatusCode(); if (response.IsSuccessStatusCode) { responseBody = response.Content.ReadAsStringAsync().Result; } JObject data = JObject.Parse(responseBody); function(data); } catch (Exception e) { Console.WriteLine(\"\\nException Caught!\"); Console.WriteLine(\"Message :{0} \", e.Message); } } } 1.2 Async/Awaitå®é™…ä¸Šè¿˜æœ‰ä¸€ç§èƒ½ä½¿ä»£ç æ›´æ¸…æ™°ã€ç®€æ´çš„æ–¹æ³•ï¼Œå¹¶ä¸”è¿™ç§æ–¹æ³•æ›´å—C#æ¨èï¼šAsync/Await class HttpUtil { /// &lt;summary> /// å‘å‡ºPOSTè¯·æ±‚ /// &lt;/summary> /// &lt;param name=\"url\">è¯·æ±‚çš„url&lt;/param> /// &lt;param name=\"requestBody\">urlå‚æ•°æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œå¦‚\"key1=value1&amp;key2=value2\",éœ€è¦ç»è¿‡urlencodeå¤„ç†&lt;/param> public static async Task&lt;JObject> PostAsync(String url, string requestBody) { try { string responseBody = null; HttpClient httpClient = new HttpClient(); //StringContent content = new StringContent(requestBody,System.Text.Encoding.UTF8, \"application/x-www-form-urlencoded\"); StringContent content = new StringContent(requestBody); content.Headers.ContentType = new System.Net.Http.Headers.MediaTypeHeaderValue(\"application/x-www-form-urlencoded\"); HttpResponseMessage response = null; response = await httpClient.PostAsync(url, content); response.EnsureSuccessStatusCode(); if (response.IsSuccessStatusCode) { responseBody = await response.Content.ReadAsStringAsync(); } JObject data = JObject.Parse(responseBody); return data; } catch (Exception e) { Console.WriteLine(\"\\nException Caught!\"); Console.WriteLine(\"Message :{0} \", e.Message); } return null; } } ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œèƒ½é¿å…å›è°ƒåœ°ç‹±ï¼Œè®©è°ƒç”¨æ—¶ä»£ç ä¸ä¼šå¤šå±‚åµŒå¥—ã€‚ç”šè‡³ES7ä¹Ÿæ”¯æŒäº†è¿™ç§æ–¹æ³•ï¼Œè¯­æ³•å’ŒC#ç±»ä¼¼ã€‚ åŸç†ï¼š å‡½æ•°æ‰§è¡Œæ—¶ï¼Œä¸€æ—¦é‡åˆ°awaitå°±ä¼šè¿”å›ã€‚ç­‰åˆ°è§¦å‘çš„å¼‚æ­¥æ“ä½œå®Œæˆï¼ˆå¹¶ä¸”è°ƒç”¨æ ˆæ¸…ç©ºï¼‰ï¼Œå†æ¥ç€æ‰§è¡Œå‡½æ•°ä½“å†…åé¢çš„è¯­å¥ å®é™…ä¸Šasync/awaitåªæ˜¯ä¸ªè¯­æ³•ç³–ï¼Œå†…éƒ¨æ‰§è¡Œé¡ºåºå’Œå›è°ƒå‡½æ•°å¹¶æ— åŒºåˆ«ã€‚ 2 APIé‰´æƒå› ä¸ºåšè¿™ä¸ªåº”ç”¨å»è°ƒç”¨äº†ç™¾åº¦äº‘å’Œè…¾è®¯äº‘æä¾›çš„OCR apiï¼Œæ°å·§å‘ç°ä¸¤å®¶çš„apié‰´æƒæœºåˆ¶æ­£æ˜¯ç›®å‰ä¸»æµéªŒè¯æ–¹å¼ä¹‹ä¸­å…·æœ‰ä»£è¡¨æ€§çš„ä¸¤ç§ã€‚ 2.1 ç™¾åº¦äº‘ï¼šTokençœ‹çœ‹ç™¾åº¦äº‘çš„Tokenè·å–æ–¹æ³•ï¼š å‘æˆæƒæœåŠ¡åœ°å€https://aip.baidubce.com/oauth/2.0/tokenå‘é€è¯·æ±‚ï¼ˆæ¨èä½¿ç”¨POSTï¼‰ï¼Œå¹¶åœ¨URLä¸­å¸¦ä¸Šä»¥ä¸‹å‚æ•°ï¼š grant_typeï¼š å¿…é¡»å‚æ•°ï¼Œå›ºå®šä¸ºclient_credentialsï¼› client_idï¼š å¿…é¡»å‚æ•°ï¼Œåº”ç”¨çš„API Keyï¼› client_secretï¼š å¿…é¡»å‚æ•°ï¼Œåº”ç”¨çš„Secret Keyï¼› tokenéªŒè¯æ–¹å¼å°±æ˜¯ç»™æ¯ä¸ªç”¨æˆ·åˆ†é…ä¸€å¥—è´¦å·å’Œå¯†ç ï¼ˆè¿™é‡Œæ˜¯client_idå’Œclient_secretï¼‰ï¼ŒæœåŠ¡å™¨èƒ½é€šè¿‡è¿™å¥—è®¤è¯ä¿¡æ¯è·å–ç”¨æˆ·çš„æƒé™ï¼Œç”Ÿæˆä¸€ä¸ªtokenå­—ç¬¦ä¸²ï¼Œä¿å­˜åœ¨æœ¬åœ°å¹¶è¿”å›ç»™ç”¨æˆ·ï¼Œç”¨æˆ·è¯·æ±‚apiçš„æ—¶å€™å°±è¦å¸¦ä¸Šè¿™ä¸ªtokenï¼ˆå¯ä»¥æ˜¯æ”¾åœ¨è¯·æ±‚ä½“æˆ–è¯·æ±‚å¤´ä¸­ï¼‰ï¼ŒæœåŠ¡å™¨å°±èƒ½é€šè¿‡tokenéªŒè¯ç”¨æˆ·çš„èº«ä»½ã€‚ å®‰å…¨éšæ‚£ï¼š Tokenè¢«åŠ«æŒï¼Œä¼ªé€ è¯·æ±‚å’Œç¯¡æ”¹å‚æ•°ã€‚ 2.2 è…¾è®¯äº‘ï¼šç­¾åéªŒè¯å¯ä»¥çœ‹çœ‹è…¾è®¯äº‘æä¾›çš„è®¡ç®—ç­¾åçš„æ­¥éª¤ï¼š å°†&lt;key, value&gt;è¯·æ±‚å‚æ•°å¯¹æŒ‰keyè¿›è¡Œå­—å…¸å‡åºæ’åºï¼Œå¾—åˆ°æœ‰åºçš„å‚æ•°å¯¹åˆ—è¡¨N å°†åˆ—è¡¨Nä¸­çš„å‚æ•°å¯¹æŒ‰URLé”®å€¼å¯¹çš„æ ¼å¼æ‹¼æ¥æˆå­—ç¬¦ä¸²ï¼Œå¾—åˆ°å­—ç¬¦ä¸²Tï¼ˆå¦‚ï¼škey1=value1&amp;key2=value2ï¼‰ï¼ŒURLé”®å€¼æ‹¼æ¥è¿‡ç¨‹valueéƒ¨åˆ†éœ€è¦URLç¼–ç ï¼ŒURLç¼–ç ç®—æ³•ç”¨å¤§å†™å­—æ¯ï¼Œä¾‹å¦‚%E8ï¼Œè€Œä¸æ˜¯å°å†™%e8 å°†åº”ç”¨å¯†é’¥ä»¥app_keyä¸ºé”®åï¼Œç»„æˆURLé”®å€¼æ‹¼æ¥åˆ°å­—ç¬¦ä¸²Tæœ«å°¾ï¼Œå¾—åˆ°å­—ç¬¦ä¸²Sï¼ˆå¦‚ï¼škey1=value1&amp;key2=value2&amp;app_key=å¯†é’¥) å¯¹å­—ç¬¦ä¸²Sè¿›è¡ŒMD5è¿ç®—ï¼Œå°†å¾—åˆ°çš„MD5å€¼æ‰€æœ‰å­—ç¬¦è½¬æ¢æˆå¤§å†™ï¼Œå¾—åˆ°æ¥å£è¯·æ±‚ç­¾å å¯ä»¥çœ‹å‡ºè…¾è®¯äº‘çš„éªŒè¯æœºåˆ¶æ›´ä¸ºå¤æ‚ï¼Œåœ¨è®¡ç®—ç­¾åçš„æ—¶å€™éœ€è¦ç”¨åˆ°å½“å‰æ—¶é—´æˆ³ã€ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²å’Œç”¨æˆ·çš„app_keyï¼Œè¿™æ ·å¾—åˆ°çš„ç­¾åæ¯æ¬¡è¯·æ±‚çš„æ—¶å€™éƒ½æ˜¯ä¸åŒçš„ï¼Œå³ä½¿ä¸­é—´è€…åŠ«æŒäº†ç­¾åä¹Ÿæ— æ³•åˆ©ç”¨ç­¾åè¿›è¡Œç¬¬äºŒæ¬¡é‡å¤è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚å‚æ•°è¢«ç¯¡æ”¹ä¹Ÿèƒ½è¯†åˆ«å‡ºã€‚ Tokenå’Œç­¾åéªŒè¯å¹¶ä¸å†²çªï¼Œç­¾åéªŒè¯æ˜¯åœ¨èº«ä»½è®¤è¯çš„åŸºç¡€ä¸Šé˜²æ­¢è¯·æ±‚é‡æ”¾ã€å‚æ•°ç¯¡æ”¹ç­‰æ”»å‡»ã€‚ç™¾åº¦äº‘è¿™ç§åŠ å¯†æœºåˆ¶ä¹Ÿå¯ä»¥ä½¿ç”¨æŸç§å¯†é’¥å°†å¸¦æœ‰tokençš„å‚æ•°å­—ç¬¦ä¸²ç”Ÿæˆç­¾åè¿›è¡ŒéªŒè¯ã€‚ 3 æ€»ç»“è¦çœ‹åˆ°çŸ¥è¯†çš„èä¼šè´¯é€šä¹‹å¤„ï¼Œå­¦ä¹ JSç›¸å…³çš„å¼‚æ­¥æ€æƒ³ï¼Œåç«¯çš„éªŒè¯æœºåˆ¶ã€‚è¦å–„äºæ€è€ƒï¼Œä»¥è¡Œä¿ƒå­¦ã€‚","categories":[{"name":"é¡¹ç›®/ç¼–ç¨‹ç†è®º","slug":"é¡¹ç›®-ç¼–ç¨‹ç†è®º","permalink":"https://www.codetool.top/categories/%E9%A1%B9%E7%9B%AE-%E7%BC%96%E7%A8%8B%E7%90%86%E8%AE%BA/"}],"tags":[{"name":"é¡¹ç›®","slug":"é¡¹ç›®","permalink":"https://www.codetool.top/tags/%E9%A1%B9%E7%9B%AE/"},{"name":"C#","slug":"C","permalink":"https://www.codetool.top/tags/C/"}]},{"title":"HashSetæºç åˆ†æ","slug":"HashSetæºç åˆ†æ","date":"2019-12-02T10:05:23.000Z","updated":"2020-04-22T09:27:27.159Z","comments":true,"path":"article/HashSetæºç åˆ†æ/","link":"","permalink":"https://www.codetool.top/article/HashSet%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","excerpt":"","text":"Setå®¶æ—ä¸€è§ˆï¼š 1 HashSetç®€ä»‹Setæ˜¯Collectionä¸‰å¤§æ¥å£å…¶ä¸­ä¹‹ä¸€ï¼Œæ„ä¸ºé›†åˆï¼Œä¸”å…ƒç´ ä¸èƒ½é‡å¤ã€‚Setæ¥å£ä¸­çš„æ–¹æ³•å’ŒCollectionä¸­çš„æ–¹æ³•å®Œå…¨ä¸€è‡´ï¼Œåªæ˜¯èµ·åˆ°ä¸€ä¸ªæ ‡è®°åçš„ä½œç”¨ã€‚ HashSetæ˜¯å“ˆå¸Œé›†çš„æ„æ€ï¼Œå°±æ˜¯é€šè¿‡hashcodeæ¥å®ç°setä¸èƒ½å‡ºç°é‡å¤å…ƒç´ çš„ä¸€ä¸ªå®ç°ç±»ã€‚ å†…éƒ¨å…¶å®æ˜¯é€šè¿‡å“ˆå¸Œè¡¨HashMapæ¥å®ç°çš„ï¼Œå®é™…ä¸Šsetä¸­å­˜æ”¾çš„å…ƒç´ æ˜¯å†…éƒ¨hashmapä¸­çš„é”®ï¼š private transient HashMap&lt;E,Object> map; private static final Object PRESENT = new Object();//æ‰€æœ‰çš„é”®å¯¹åº”çš„å€¼éƒ½æ˜¯ä¸€ä¸ªå†—ä½™çš„Objectå¯¹è±¡ åœ¨æ„é€ æ–¹æ³•ä¸­åˆå§‹åŒ–å“ˆå¸Œè¡¨ï¼š public HashSet() { map = new HashMap&lt;>(); } æµªè´¹æ—¶é—´è­¦å‘Šï¼šè¿™æ˜¯ä¸€ä¸ªçº¯HashMapå®ç°çš„ç±» 2 é‡è½½çš„æ„é€ æ–¹æ³•2.1 public HashSet(Collection&lt;? extends E&gt; c)é€šè¿‡ä¸€ä¸ªé›†åˆæ¥æ„é€ HashSetï¼Œé»˜è®¤å“ˆå¸Œè¡¨çš„å®¹é‡æ˜¯é›†åˆçš„å®¹é‡*4/3 + 1å’Œ16ä¸­çš„æœ€å¤§å€¼ public HashSet(Collection&lt;? extends E> c) { map = new HashMap&lt;>(Math.max((int) (c.size()/.75f) + 1, 16)); addAll(c); } 2.2 public HashSet(int initialCapacity, float loadFactor)è¿™ä¸ªå®é™…ä¸Šå°±æ˜¯æä¾›ä¸¤ä¸ªæ„é€ HashMapçš„å‚æ•°ï¼Œä¸€ä¸ªæ˜¯åˆå§‹å¤§å°ï¼Œä¸€ä¸ªæ˜¯è´Ÿè½½å› å­ã€‚ public HashSet(int initialCapacity, float loadFactor) { map = new HashMap&lt;>(initialCapacity, loadFactor); } 2.3 public HashSet(int initialCapacity)è¿™ä¸ªå°±æ˜¯æä¾›HashMapçš„åˆå§‹å¤§å°ã€‚ public HashSet(int initialCapacity) { map = new HashMap&lt;>(initialCapacity); } 3 é‡è¦æ–¹æ³•3.1 public int size()HashMapçš„size public int size() { return map.size(); } 3.2 public boolean contains(Object o)HashMapä¸­æ˜¯å¦æœ‰å¯¹åº”çš„é”®ã€‚ public boolean contains(Object o) { return map.containsKey(o); } 3.3 public boolean add(E e)å°†ä¸€ä¸ªè®°å½•æ’å…¥HashMap public boolean add(E e) { return map.put(e, PRESENT)==null; } 3.4 public boolean remove(Object o)public boolean remove(Object o) { return map.remove(o)==PRESENT; } 4 æ€»ç»“è¿™æ˜¯ä¸€ä¸ªçº¯ä½¿ç”¨HashMapå®ç°çš„æ•°æ®ç»“æ„ã€‚ä»”ç»†çœ‹äº†ä¸€ä¸‹TreeSetä¹Ÿæ˜¯ç”¨TreeMapå®ç°çš„ï¼Œé‚£æˆ‘å°±ä¸æTreeSetäº†ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jdk","slug":"jdk","permalink":"https://www.codetool.top/tags/jdk/"},{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://www.codetool.top/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"}]},{"title":"LinkedListæºç åˆ†æ","slug":"LinkedListæºç åˆ†æ","date":"2019-12-02T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/LinkedListæºç åˆ†æ/","link":"","permalink":"https://www.codetool.top/article/LinkedList%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","excerpt":"","text":"ç›¸å…³æ–‡ç« ï¼šArrayListæºç åˆ†æ Listå®¶æ—ä¸€è§ˆï¼š 1 LinkedListç®€ä»‹ LinkedListçš„è¶…ç±»æœ‰Listã€Queueï¼Œè¯´æ˜å®ƒæ—¢æœ‰Listçš„æ€§è´¨ä¹Ÿæœ‰Queueçš„æ€§è´¨ï¼Œå®ƒç›´æ¥å®ç°äºDequeï¼Œè¯´æ˜å®ƒä½“ç°æ›´å¤šçš„æ˜¯åŒå‘é“¾è¡¨çš„æ€§è´¨ã€‚ä¸è¿‡é€šå¸¸å°†å®ƒå½“ä½œæ™®é€šçš„Queueä½¿ç”¨ï¼š Queue queue = new LinkedList&lt;>(); å®ƒçš„å†…éƒ¨å­—æ®µï¼š transient int size = 0; transient Node&lt;E> first;//ä»£è¡¨å¤´èŠ‚ç‚¹ transient Node&lt;E> last;//ä»£è¡¨å°¾èŠ‚ç‚¹ 2 é‡è¦çš„å†…éƒ¨ç±»2.1 Nodeè¿™æ˜¯ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œä»£è¡¨ç€LinkedListä¸­å­˜æ”¾æ•°æ®çš„èŠ‚ç‚¹ã€‚ private static class Node&lt;E> { E item; Node&lt;E> next; Node&lt;E> prev; Node(Node&lt;E> prev, E element, Node&lt;E> next) { this.item = element; this.next = next; this.prev = prev; } } 3 é‡è¦çš„å†…éƒ¨æ–¹æ³•3.1 void linkLast(E e)offerä¾èµ–çš„æ–¹æ³• void linkLast(E e) { final Node&lt;E> l = last; final Node&lt;E> newNode = new Node&lt;>(l, e, null); last = newNode; if (l == null) first = newNode; else l.next = newNode; size++; modCount++; } 3.2 private E unlinkFirst(Node f)pollå’Œremoveä¾èµ–çš„æ–¹æ³• private E unlinkFirst(Node&lt;E> f) { // assert f == first &amp;&amp; f != null; final E element = f.item; final Node&lt;E> next = f.next; f.item = null; f.next = null; // help GC first = next; if (next == null) last = null; else next.prev = null; size--; modCount++; return element; } 3.3 Node node(int index)è·å–å¤„äºindexä¸Šçš„èŠ‚ç‚¹ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºæ”¯æŒéšæœºè®¿é—®ï¼Œç‰¹åˆ«æ˜¯Listä¸­å®šä¹‰çš„getï¼Œsetç­‰æ–¹æ³•ã€‚å¯è§ï¼Œè¯¥æ–¹æ³•ä¼šæ ¹æ®indexæ‰€å¤„ä½ç½®çš„ä¸åŒåˆ†ä¸ºä»å¤´æŸ¥æ‰¾æˆ–æ˜¯ä»å°¾æŸ¥æ‰¾ã€‚ Node&lt;E> node(int index) { // assert isElementIndex(index); if (index &lt; (size >> 1)) { Node&lt;E> x = first; for (int i = 0; i &lt; index; i++) x = x.next; return x; } else { Node&lt;E> x = last; for (int i = size - 1; i > index; i--) x = x.prev; return x; } } 4 æ€»ç»“å¯ä»¥è¯´ï¼ŒLinkedListçš„å®ç°è¿˜æ˜¯æŒºç®€å•çš„ï¼Œç”±äºæ˜¯é“¾è¡¨å®ç°ä¸éœ€è¦è€ƒè™‘é‚£ä¹ˆå¤šå…³äºç©ºé—´çš„é—®é¢˜ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jdk","slug":"jdk","permalink":"https://www.codetool.top/tags/jdk/"},{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://www.codetool.top/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"}]},{"title":"tomcatæ•´ä½“æ¶æ„","slug":"tomcatæ•´ä½“æ¶æ„","date":"2019-11-29T10:05:23.000Z","updated":"2020-02-21T14:38:07.517Z","comments":true,"path":"article/tomcatæ•´ä½“æ¶æ„/","link":"","permalink":"https://www.codetool.top/article/tomcat%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/","excerpt":"","text":"1 tomcatæ•´ä½“æ¶æ„Tomcat HttpæœåŠ¡å™¨ä¸ç›´æ¥è°ƒç”¨ä¸šåŠ¡ç±»ï¼Œè€Œæ˜¯å°†è¯·æ±‚è½¬å‘ç»™Servletå®¹å™¨ï¼ŒServletåŠ è½½ä¸šåŠ¡ç±»å¤„ç†è¯·æ±‚ã€‚ æ ¸å¿ƒç»„ä»¶ï¼š è¿æ¥å™¨ Connector å®¹å™¨ Container è¿æ¥å™¨å¤„ç†Socketè¯·æ±‚ï¼Œå®¹å™¨è¿›è¡Œservletçš„è°ƒç”¨ã€‚ 2 è¿æ¥å™¨ CoyoteCoyote æ˜¯ Tomcatçš„è¿æ¥å™¨æ¡†æ¶çš„åç§°ï¼Œæ˜¯TomcatæœåŠ¡å™¨æä¾›çš„ä¾›å®¢æˆ·ç«¯è®¿é—®çš„å¤–éƒ¨æ¥å£ã€‚å®¢æˆ·ç«¯é€šè¿‡Coyoteä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€å‘é€è¯·æ±‚å¹¶æ¥å—ç›¸åº”ã€‚ Coyoteå°è£…äº†åº•å±‚çš„ç½‘ç»œé€šä¿¡ï¼ˆSocketè¯·æ±‚åŠç›¸åº”å¤„ç†ï¼‰ï¼Œä¸ºCatalinaå®¹å™¨æä¾›äº†ç»Ÿä¸€çš„æ¥å£ï¼Œä½¿Catalinaå®¹å™¨ä¸å…·ä½“çš„è¯·æ±‚åè®®åŠIOæ“ä½œæ–¹å¼å®Œå…¨è§£è€¦ã€‚Coyoteå°†Socketè¾“å…¥è½¬æ¢å°è£…ä¸ºRequestå¯¹è±¡ï¼Œäº¤ç”±Catalinaå®¹å™¨è¿›è¡Œå¤„ç†ï¼Œå¤„ç†è¯·æ±‚å®Œæˆåï¼ŒCatalinaé€šè¿‡Coyoteæä¾›çš„Responseå¯¹è±¡å°†ç»“æœå†™å…¥è¾“å‡ºæµã€‚ Coyoteä½œä¸ºç‹¬ç«‹çš„æ¨¡å—ï¼Œåªè´Ÿè´£å…·ä½“åè®®å’ŒIOçš„ç›¸å…³æ“ä½œï¼Œä¸Servletè§„èŒƒå®ç°æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œå› æ­¤å³ä½¿æ˜¯Requestå’ŒResponseå¯¹è±¡ä¹Ÿå¹¶æœªå®ç°Servletè§„èŒƒå¯¹åº”çš„æ¥å£ï¼Œè€Œæ˜¯åœ¨Catalinaä¸­å°†ä»–ä»¬è¿›ä¸€æ­¥å°è£…ä¸ºServletRequestå’ŒServletResponseã€‚ 2.1 IOæ¨¡å‹ä¸åè®®åœ¨Coyoteä¸­ï¼ŒTomcatæ”¯æŒçš„å¤šç§I/Oæ¨¡å‹å’Œåº”ç”¨å±‚åè®®ï¼š Tomcatæ”¯æŒçš„IOæ¨¡å‹ï¼ˆ8.0å‰é»˜è®¤æ˜¯BIOï¼Œè‡ª8.5/9.0ç‰ˆæœ¬èµ·ï¼Œtomcatç§»é™¤äº†å¯¹BIOçš„æ”¯æŒï¼‰ï¼š IOæ¨¡å‹ æè¿° NIO éé˜»å¡I/Oï¼Œé‡‡ç”¨Java NIOç±»åº“å®ç°ã€‚ NIO2 å¼‚æ­¥I/Oï¼Œé‡‡ç”¨JDK7æœ€æ–°çš„NIO2ç±»åº“å®ç°ã€‚ APR é‡‡ç”¨Apacheå¯ç§»æ¤è¿è¡Œåº“å®ç°ï¼Œæ˜¯C/C++ç¼–å†™çš„æœ¬åœ°åº“ã€‚å¦‚æœé€‰æ‹©è¯¥æ–¹æ¡ˆï¼Œéœ€è¦å•ç‹¬å®‰è£…APRåº“ã€‚ Tomcatæ”¯æŒçš„åº”ç”¨å±‚åè®®ï¼š åº”ç”¨å±‚åè®® æè¿° HTTP/1.1 è¿™æ˜¯å¤§éƒ¨åˆ†Webåº”ç”¨é‡‡ç”¨çš„è®¿é—®åè®®ã€‚ AJP ç”¨äºå’ŒWebæœåŠ¡å™¨é›†æˆï¼ˆå¦‚Apacheï¼‰ï¼Œä»¥å®ç°å¯¹é™æ€èµ„æºçš„ä¼˜åŒ–ä»¥åŠé›†ç¾¤éƒ¨ç½²ï¼Œå½“å‰æ”¯æŒAJP/1.3ã€‚ HTTP/2 HTTP2.0å¤§å¹…åº¦åœ°æå‡äº†Webæ€§èƒ½ã€‚ä¸‹ä¸€ä»£HTTPåè®®ï¼Œè‡ª8.5ä»¥åŠ9.0ç‰ˆæœ¬ä¹‹åæ”¯æŒã€‚ 2.2 è¿æ¥å™¨ç»„ä»¶ EndPoint Processor Adapter ProtocolHandler 2.2.1 EndPoint Coyoteé€šä¿¡ç«¯ç‚¹ï¼Œå³é€šä¿¡ç›‘å¬çš„æ¥å£ï¼Œæ˜¯å…·ä½“Socketæ¥æ”¶å’Œå‘é€å¤„ç†å™¨ï¼Œæ˜¯å¯¹ä¼ è¾“å±‚çš„æŠ½è±¡ï¼Œå› æ­¤EndPointç”¨æ¥å®ç°TCP/IPåè®®çš„ã€‚ Tomcatå¹¶æ²¡æœ‰EndPointæ¥å£ï¼Œè€Œæ˜¯æä¾›äº†ä¸€ä¸ªæŠ½è±¡ç±»AbstractEndPointï¼Œé‡Œé¢å®šä¹‰äº†ä¸¤ä¸ªå†…éƒ¨ç±»ï¼šAcceptorå’ŒSocketProcessorã€‚Acceptorç”¨äºç›‘å¬Socketè¿æ¥è¯·æ±‚ã€‚SocketProcessorç”¨äºå¤„ç†æ¥æ”¶åˆ°çš„Socketè¯·æ±‚ï¼Œå®ƒå®ç°Runnableæ¥å£ï¼Œåœ¨Runæ–¹æ³•é‡Œè°ƒç”¨åè®®å¤„ç†ç»„ä»¶Processorè¿›è¡Œå¤„ç†ã€‚ä¸ºäº†æé«˜å¤„ç†èƒ½åŠ›ï¼ŒSocketProcessorè¢«æäº¤åˆ°çº¿ç¨‹æ± æ¥æ‰§è¡Œã€‚è€Œè¿™ä¸ªçº¿ç¨‹æ± å«æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰ã€‚ 2.2.2 ProcessorCoyoteåè®®å¤„ç†æ¥å£ï¼Œå¦‚æœè¯´EndPointæ˜¯ç”¨æ¥å®ç°TCP/IPåè®®çš„ï¼Œé‚£ä¹ˆProcessorç”¨æ¥å®ç°HTTPåè®®ï¼ŒProcessoræ¥æ”¶æ¥è‡ªEndPointçš„Socketï¼Œè¯»å–å­—èŠ‚æµè§£ææˆTomcat Recuestå’ŒResponseå¯¹è±¡,å¹¶é€šè¿‡Adapterå°†å…¶æäº¤åˆ°å®¹å™¨å¤„ç†, Processoræ˜¯å¯¹åº”ç”¨å±‚åè®®çš„æŠ½è±¡ã€‚ 2.2.3 ProtocolHandlerCoyote åè®®æ¥å£ï¼Œé€šè¿‡Endpointå’ŒProcessorï¼Œå®ç°é’ˆå¯¹å…·ä½“åè®®çš„å¤„ç†èƒ½åŠ›ã€‚TomcatæŒ‰ç…§åè®®å’ŒI/Oæä¾›äº†6ä¸ªå®ç°ç±»ï¼šAjpNioProtocolï¼ŒAjpAprProtocol,AjpNio2Protocol,Http11NioProtocol,Http11Nio2Protocol,Http11AprProtocolã€‚æˆ‘ä»¬åœ¨é…ç½®tomcat/conf/server.xmlæ—¶ï¼Œè‡³å°‘è¦æŒ‡å®šå…·ä½“çš„ProtocolHandler,å½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®šåè®®åç§°ï¼Œå¦‚ï¼šHTTP/1.1ï¼Œå¦‚æœå®‰è£…äº†APRï¼Œé‚£ä¹ˆå°†ä½¿ç”¨Http11AprProtocolï¼Œå¦åˆ™ä½¿ç”¨ Http11NioProtocolã€‚ 2.2.4 Adapterç”±äºåè®®ä¸åŒï¼Œå®¢æˆ·ç«¯å‘è¿‡æ¥çš„è¯·æ±‚ä¿¡æ¯ä¹Ÿä¸å°½ç›¸åŒï¼ŒTomcatå®šä¹‰äº†è‡ªå·±çš„Requestç±»æ¥â€œå­˜æ”¾â€è¿™äº›è¯·æ±‚ä¿¡æ¯ã€‚ProtocolHandleræ¥å£è´Ÿè´£è§£æè¯·æ±‚å¹¶ç”ŸæˆTomcat Requestç±»ã€‚ä½†æ˜¯è¿™ä¸ªRequestå¯¹è±¡ä¸æ˜¯æ ‡å‡†çš„ServletRequestï¼Œä¹Ÿå°±æ„å‘³ç€ï¼Œä¸èƒ½ç”¨Tomcat Requestä½œä¸ºå‚æ•°æ¥è°ƒç”¨å®¹å™¨ã€‚Tomcatè®¾è®¡è€…çš„è§£å†³æ–¹æ¡ˆæ˜¯å¼•å…¥CoyoteAdapterï¼Œè¿™æ˜¯é€‚é…å™¨æ¨¡å¼çš„ç»å…¸è¿ç”¨ï¼Œè¿æ¥å™¨è°ƒç”¨CoyoteAdapterçš„Seviceæ–¹æ³•ï¼Œä¼ å…¥çš„æ˜¯Tomcat Requestå¯¹è±¡ï¼ŒCoyoteAdapterè´Ÿè´£å°†Tomcat Requestè½¬æˆServletRequestï¼Œå†è°ƒç”¨å®¹å™¨çš„Serviceæ–¹æ³•ã€‚ 3 å®¹å™¨ Catalina3.1 Tomcatçš„æ¨¡å—åˆ†å±‚å›¾ å’Œorg.apacheåŒ…ä¸‹çš„åŒ…ä¸€ä¸€å¯¹åº” 3.2 å®¹å™¨ç»„ä»¶ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒCatalinaè´Ÿè´£ç®¡ç†Serverï¼Œè€ŒServerè¡¨ç¤ºç€æ•´ä¸ªæœåŠ¡å™¨ã€‚Serverä¸‹é¢æœ‰å¤šä¸ªæœåŠ¡Serviceï¼Œæ¯ä¸ªæœåŠ¡éƒ½åŒ…å«ç€å¤šä¸ªè¿æ¥å™¨ç»„ä»¶Connectorï¼ˆCoyote å®ç°ï¼‰å’Œä¸€ä¸ªå®¹å™¨ç»„ä»¶Containerã€‚åœ¨Tomcatå¯åŠ¨çš„æ—¶å€™ï¼Œä¼šåˆå§‹åŒ–ä¸€ä¸ªCatalinaçš„å®ä¾‹ã€‚ Catalinaå„ä¸ªç»„ä»¶çš„èŒè´£ï¼š ç»„ä»¶ èŒè´£ Catalina è´Ÿè´£è§£æTomcatçš„é…ç½®æ–‡ä»¶ï¼Œä»¥æ­¤æ¥åˆ›å»ºæœåŠ¡å™¨Serverç»„ä»¶ï¼Œå¹¶æ ¹æ®å‘½ä»¤æ¥å¯¹å…¶è¿›è¡Œç®¡ç†ã€‚ Server æœåŠ¡å™¨è¡¨ç¤ºæ•´ä¸ªCatalina Servletå®¹å™¨ä»¥åŠå…¶å®ƒç»„ä»¶ï¼Œè´Ÿè´£ç»„è£…å¹¶å¯åŠ¨Servletå¼•æ“ï¼ŒTomcatè¿æ¥å™¨ã€‚Serveré€šè¿‡å®ç°Lifecycleæ¥å£ï¼Œæä¾›äº†ä¸€ç§ä¼˜é›…çš„å¯åŠ¨å’Œå…³é—­æ•´ä¸ªç³»ç»Ÿçš„æ–¹å¼ã€‚ Service æœåŠ¡æ˜¯Serverå†…éƒ¨çš„ç»„ä»¶ï¼Œä¸€ä¸ªServeråŒ…å«å¤šä¸ªServiceã€‚å®ƒå°†è‹¥å¹²ä¸ªConnectorç»„ä»¶ç»‘å®šåˆ°ä¸€ä¸ªContainer(Engine)ä¸Š Connector è¿æ¥å™¨ï¼Œå¤„ç†ä¸å®¢æˆ·ç«¯çš„é€šä¿¡ï¼Œå®ƒè´Ÿè´£æ¥æ”¶å®¢æˆ·è¯·æ±‚ï¼Œç„¶åè½¬ç»™ç›¸å…³çš„å®¹å™¨å¤„ç†ï¼Œæœ€åå‘å®¢æˆ·è¿”å›å“åº”ç»“æœ Container å®¹å™¨ï¼Œè´Ÿè´£å¤„ç†ç”¨æˆ·çš„servletè¯·æ±‚ï¼Œå¹¶è¿”å›å¯¹è±¡ç»™webç”¨æˆ·çš„æ¨¡å—ã€‚ 3.3 Containerç»“æ„Tomcatè®¾è®¡äº†4ç§å®¹å™¨ï¼Œåˆ†åˆ«æ˜¯Engineã€Hostã€Contextå’ŒWrapperã€‚è¿™4ç§å®¹å™¨ä¸æ˜¯å¹³è¡Œå…³ç³»ï¼Œè€Œæ˜¯çˆ¶å­å…³ç³»ï¼ŒTomcaté€šè¿‡ä¸€ç§åˆ†å±‚çš„æ¶æ„ï¼Œä½¿å¾—Servletå®¹å™¨å…·æœ‰å¾ˆå¥½çš„çµæ´»æ€§ã€‚ ç»„ä»¶ èŒè´£ Engine è¡¨ç¤ºæ•´ä¸ªCatalinaçš„Servletå¼•æ“,ç”¨æ¥ç®¡ç†å¤šä¸ªè™šæ‹Ÿç«™ç‚¹ï¼Œä¸€ä¸ªServiceæœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªEngine ,ä½†æ˜¯ä¸€ä¸ªå¼•æ“å¯åŒ…å«å¤šä¸ªHostã€‚ Host ä»£è¡¨ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œ æˆ–è€…è¯´ä¸€ä¸ªç«™ç‚¹ï¼Œå¯ä»¥ç»™Tomcaté…ç½®å¤šä¸ªè™šæ‹Ÿä¸»æœºåœ°å€ï¼Œè€Œä¸€ä¸ªè™šæ‹Ÿä¸»æœºä¸‹å¯åŒ…å«å¤šä¸ªContextã€‚ Context è¡¨ç¤ºä¸€ä¸ªwebåº”ç”¨ç¨‹åºï¼Œä¸€ä¸ªWebåº”ç”¨å¯åŒ…å«å¤šä¸ªWrapperã€‚ Wrapper è¡¨ç¤ºä¸€ä¸ªServletï¼ŒWrapperä½œä¸ºå®¹å™¨ä¸­çš„æœ€åº•å±‚ã€‚ ä¸èƒ½åŒ…å«å­å®¹å™¨ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥å†é€šè¿‡Tomcatçš„server.xmlé…ç½®æ–‡ä»¶æ¥åŠ æ·±å¯¹Tomcatå®¹å™¨çš„ç†è§£ã€‚Tomcaté‡‡ç”¨äº†ç»„ä»¶åŒ–çš„è®¾è®¡ï¼Œå®ƒçš„æ„æˆç»„ä»¶éƒ½æ˜¯å¯é…ç½®çš„ï¼Œå…¶ä¸­æœ€å¤–å±‚çš„æ˜¯Serverï¼Œå…¶ä»–ç»„ä»¶æŒ‰ç…§ä¸€å®šçš„æ ¼å¼è¦æ±‚é…ç½®åœ¨è¿™ä¸ªé¡¶å±‚å®¹å™¨ä¸­ã€‚ &lt;Server> &lt;Service> &lt;Connector/> &lt;Connector/> &lt;Engine> &lt;Host> &lt;Context>&lt;/Context> &lt;/Host> &lt;/Engine> &lt;/Service> &lt;/Server> é‚£ä¹ˆï¼ŒTomcatæ˜¯æ€ä¹ˆç®¡ç†è¿™äº›å®¹å™¨çš„å‘¢ï¼Ÿä½ ä¼šå‘ç°è¿™äº›å®¹å™¨å…·æœ‰çˆ¶å­å…³ç³»ï¼Œå½¢æˆä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œä½ å¯èƒ½é©¬ä¸Šå°±æƒ³åˆ°äº†è®¾è®¡æ¨¡å¼ä¸­çš„ç»„åˆæ¨¡å¼ã€‚æ²¡é”™ï¼ŒTomcatå°±æ˜¯ç”¨ç»„åˆæ¨¡å¼æ¥ç®¡ç†è¿™äº›å®¹å™¨çš„ã€‚å…·ä½“å®ç°æ–¹æ³•æ˜¯ï¼Œæ‰€æœ‰å®¹å™¨ç»„ä»¶éƒ½å®ç°äº†Containeræ¥å£ï¼Œå› æ­¤ç»„åˆæ¨¡å¼å¯ä»¥ä½¿å¾—ç”¨æˆ·å¯¹å•å®¹å™¨å¯¹è±¡å’Œç»„åˆå®¹å™¨å¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚è¿™é‡Œå•å®¹å™¨å¯¹è±¡æŒ‡çš„æ˜¯æœ€åº•å±‚çš„Wrapperï¼Œç»„åˆå®¹å™¨å¯¹è±¡æŒ‡çš„æ˜¯ä¸Šé¢çš„Contextã€Hostæˆ–è€…Engineã€‚ LifeCycleæ¥å£ç”¨äºç»Ÿä¸€ç®¡ç†å„ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"tomcat","slug":"tomcat","permalink":"https://www.codetool.top/tags/tomcat/"}]},{"title":"ä½¿ç”¨mavenæ–¹å¼ç¼–è¯‘tomcatæºç ","slug":"ä½¿ç”¨mavenæ–¹å¼ç¼–è¯‘tomcatæºç ","date":"2019-11-28T14:09:23.000Z","updated":"2020-02-21T14:38:07.517Z","comments":true,"path":"article/ä½¿ç”¨mavenæ–¹å¼ç¼–è¯‘tomcatæºç /","link":"","permalink":"https://www.codetool.top/article/%E4%BD%BF%E7%94%A8maven%E6%96%B9%E5%BC%8F%E7%BC%96%E8%AF%91tomcat%E6%BA%90%E7%A0%81/","excerpt":"","text":"1 Tomcatæºç ä¸‹è½½å®˜ç½‘ä¸‹è½½ï¼š https://tomcat.apache.org/download-80.cgi é¡µé¢ä¸‹æ–¹çš„Source Code Distributionï¼Œä¸‹è½½zipæ–‡ä»¶ã€‚ 2 Ideaç”¨mavenæ–¹å¼ç¼–è¯‘æºç åœ¨æºç æ–‡ä»¶å¤¹å†…åˆ›å»ºä¸€ä¸ªhome/ç›®å½•ï¼Œå°†webapp/å’Œconf/ç§»åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹ã€‚ åœ¨æ ¹ç›®å½•æ·»åŠ pom.xmlï¼š &lt;?xml version=\"1.0\" encoding=\"utf-8\"?> &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"> &lt;modelVersion>4.0.0&lt;/modelVersion> &lt;groupId>org.apache.tomcat&lt;/groupId> &lt;artifactId>Tomcat8.5&lt;/artifactId> &lt;name>Tomcat8.5&lt;/name> &lt;version>8.5&lt;/version> &lt;build> &lt;finalName>Tomcat8.5&lt;/finalName> &lt;!-- æŒ‡å®šæºæ–‡ä»¶ä¸ºjava ã€test --> &lt;sourceDirectory>java&lt;/sourceDirectory> &lt;!-- &lt;testSourceDirectory>test&lt;/testSourceDirectory>--> &lt;resources> &lt;resource> &lt;directory>java&lt;/directory> &lt;/resource> &lt;/resources> &lt;testResources> &lt;testResource> &lt;directory>test&lt;/directory> &lt;/testResource> &lt;/testResources> &lt;plugins> &lt;plugin> &lt;groupId>org.apache.maven.plugins&lt;/groupId> &lt;artifactId>maven-compiler-plugin&lt;/artifactId> &lt;version>2.3&lt;/version> &lt;configuration> &lt;encoding>UTF-8&lt;/encoding> &lt;!-- æŒ‡å®šjdk ç¼–è¯‘ ç‰ˆæœ¬ ï¼Œæ²¡è£…jdk 1.7çš„å¯ä»¥å˜æ›´ä¸º1.6 --> &lt;source>1.8&lt;/source> &lt;target>1.8&lt;/target> &lt;/configuration> &lt;/plugin> &lt;/plugins> &lt;/build> &lt;!-- æ·»åŠ tomcat8 æ‰€éœ€jaråŒ…ä¾èµ– --> &lt;dependencies> &lt;dependency> &lt;groupId>junit&lt;/groupId> &lt;artifactId>junit&lt;/artifactId> &lt;version>4.12&lt;/version> &lt;scope>test&lt;/scope> &lt;/dependency> &lt;dependency> &lt;groupId>ant&lt;/groupId> &lt;artifactId>ant&lt;/artifactId> &lt;version>1.7.0&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>wsdl4j&lt;/groupId> &lt;artifactId>wsdl4j&lt;/artifactId> &lt;version>1.6.2&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>javax.xml&lt;/groupId> &lt;artifactId>jaxrpc&lt;/artifactId> &lt;version>1.1&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.easymock&lt;/groupId> &lt;artifactId>easymock&lt;/artifactId> &lt;version>3.3&lt;/version> &lt;/dependency> &lt;dependency> &lt;groupId>org.eclipse.jdt.core.compiler&lt;/groupId> &lt;artifactId>ecj&lt;/artifactId> &lt;version>4.6.1&lt;/version> &lt;/dependency> &lt;/dependencies> &lt;/project> åœ¨ideaä¸­å¯¼å…¥è¯¥mavené¡¹ç›®ï¼Œç­‰å¾…mavenæ„å»ºã€‚ ideaçš„é¡¹ç›®è¿è¡Œé…ç½®ï¼ˆEdit Configurationsï¼‰ï¼š Edit Configurations-&gt; + -&gt; Application -&gt; Main Classé€‰æ‹©org.apache.catalina.startup.Bootstrap -&gt; VM Optionså¡«å…¥ï¼š -Dcatalina.home=D:/Tomcat/apache-tomcat-8.5.49-src/home -Dcatalina.base=D:/Tomcat/apache-tomcat-8.5.49-src/home -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djava.util.logging.config.file=D:/Tomcat/apache-tomcat-8.5.49-src/home/conf/logging.propertiesD:/Tomcat/apache-tomcat-8.5.49-src/æ˜¯æˆ‘ç”µè„‘ä¸Šçš„æºç çš„å­˜æ”¾ä½ç½® ç„¶åå°±å¯ä»¥å°è¯•ç¼–è¯‘äº†ã€‚è¿˜ä¼šå‡ºç°ä¸€äº›é”™è¯¯ï¼Œå¯ä»¥å‚è€ƒï¼š @Version@é”™è¯¯ tomcaté¡µé¢æ‰“ä¸å¼€500,jspæ²¡æœ‰åˆå§‹åŒ–é”™è¯¯","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"tomcat","slug":"tomcat","permalink":"https://www.codetool.top/tags/tomcat/"},{"name":"maven","slug":"maven","permalink":"https://www.codetool.top/tags/maven/"}]},{"title":"servlet4.0åˆè¯†æ€»ç»“","slug":"servlet4-0åˆå­¦æ€»ç»“","date":"2019-11-28T10:05:23.000Z","updated":"2020-02-20T14:42:11.238Z","comments":true,"path":"article/servlet4-0åˆå­¦æ€»ç»“/","link":"","permalink":"https://www.codetool.top/article/servlet4-0%E5%88%9D%E5%AD%A6%E6%80%BB%E7%BB%93/","excerpt":"","text":"1 JavaEE8JavaEE8,æ˜¯è‡ª2013å¹´6æœˆJavaä¼ä¸šç‰ˆçš„é¦–æ¬¡æ›´æ–°ã€‚JAVAEE8æä¾›äº†ä¸€äº›æ–°çš„APIï¼Œæä¾›äº†å¯¹HTTP/2çš„æ–°æ”¯æŒã€‚ 2 Servlet4.0Servlet APIæ˜¯JAVAå¼€å‘äººå‘˜æœ€ç†Ÿæ‚‰çš„APIä¹‹ä¸€ã€‚ Servletåœ¨JAVAwebçš„å¼€å‘ä¸­å‘æŒ¥ç€é‡è¦çš„ä½œç”¨ã€‚JAVAEE8å¯¹Servletè¿›è¡Œäº†é‡è¦çš„æ›´æ–°ï¼š æœåŠ¡å™¨æ¨é€ æä¾›äº†å¯¹Servletæ˜ å°„çš„è¿è¡Œæ—¶å‘ç°ã€‚ ç®€åŒ–äº†Filterçš„å¼€å‘ã€‚ å…¶ä¸­æœåŠ¡å™¨æ¨é€æ˜¯æœ€ä¸»è¦çš„æ›´æ–° é…ç½®éœ€è¦ï¼š jdk8+ tomcat9ï¼ˆæ”¯æŒHTTP/2ï¼‰ tomcat-native openssl 2.1 é…ç½®tomcatç¼–è¾‘server.xmlï¼Œå°†åŸæ¥çš„port=&quot;8080&quot; HTTP/1.1æ›¿æ¢æˆ: &lt;Connector port=\"8443\" protocol=\"org.apache.coyote.http11.Http11AprProtocol\" maxThreads=\"150\" SSLEnabled=\"true\" > &lt;UpgradeProtocol className=\"org.apache.coyote.http2.Http2Protocol\" /> &lt;SSLHostConfig> &lt;Certificate certificateKeyFile=\"conf/localhost-rsa-key.pem\" certificateFile=\"conf/localhost-rsa-cert.pem\" type=\"RSA\" /> &lt;/SSLHostConfig> &lt;/Connector> 2.2 ç”ŸæˆSSLè¯ä¹¦ç”Ÿæˆç§é’¥å’Œè¯ä¹¦æ–‡ä»¶åœ¨tomcat-nativeç›®å½•ä¸‹ï¼š OpenSSL&gt; genrsa -out localhost-rsa-key.pem 2048 OpenSSL&gt; req -new -x509 -key localhost-rsa-key.pem -out localhost-rsa-cert.pem -days 3650å°†localhost-rsa-key.pemå’Œlocalhost-rsa-cert.pemå¤åˆ¶åˆ°tomcatçš„conf/æ–‡ä»¶å¤¹ä¸‹ã€‚ å°†tomcat-nativeä¸­bin/(x64/)ä¸‹çš„tcnative-1.dllå’Œtcnative-1-src.pdbå¤åˆ¶åˆ°JAVA_HOMEçš„/binç›®å½•ä¸‹ ç„¶åé‡å¯tomcatå°±èƒ½ç”¨HTTP/2æ¥è¿æ¥äº†ã€‚ 2.3 æœåŠ¡å™¨æ¨é€å°†ç”¨æˆ·æ‰€éœ€çš„WEBèµ„æºæå‰æ¨é€åˆ°ç”¨æˆ·çš„æµè§ˆå™¨ç¼“å­˜ä¸­ï¼Œå½“ç”¨æˆ·ä½¿ç”¨æµè§ˆå™¨è®¿é—®æ‰€éœ€WEBèµ„æºæ—¶ï¼Œç”¨æˆ·ä¸éœ€è¦å†æ¬¡ä¸‹è½½æ‰€éœ€çš„WEBèµ„æºï¼Œå› ä¸ºç”¨æˆ·æ‰€éœ€çš„WEBèµ„æºå·²ç»å­˜åœ¨äºç”¨æˆ·çš„æµè§ˆå™¨ç¼“å­˜ä¸­ã€‚ è·å–ï¼š request.newPushBuilder();æ–¹æ³•ï¼š PushBuilder.path()è®¾ç½®è¦æ¨é€èµ„æºçš„è·¯å¾„ã€‚PushBuilder.push()æ¨é€WEBèµ„æºåˆ°ç”¨æˆ·çš„æµè§ˆå™¨ç¼“å­˜ä¸­ã€‚ protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { PushBuilder pb = request.newPushBuilder(); pb.path(\"pic01.jpg\"); pb.push(); } ç®€åŒ–ï¼š PushBuilder pb = request.newPushBuilder(); pb.path(\"pic01.jpg\").push(); pb.path(\"pic02.jpg\").push(); 2.4 HttpServletMappingåœ¨è¿è¡Œæ—¶è·å–Servletçš„æ˜ å°„ä¿¡æ¯ï¼ˆåå°„æœºåˆ¶ï¼‰ è·å–ï¼š request.getHttpServletMapping();æ–¹æ³•ï¼š getMappingMatch() è¯·æ±‚è·¯å¾„çš„ç±»å‹getMatchValue() æ˜ å°„çš„èµ„æºågetPattern() è¿”å›Servletæ˜ å°„çš„è·¯å¾„getServletName() è¿”å›Servletçš„åç§° protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { HttpServletMapping mapping = request.getHttpServletMapping(); MappingMatch match = mapping.getMappingMatch(); System.out.println(match); String value = mapping.getMatchValue(); System.out.println(value); String pattern = mapping.getPattern(); System.out.println(pattern); String name = mapping.getServletName(); System.out.println(name); } 2.5 HttpFilterFilterçš„å®ç°ç±»ï¼š GenericFilter HttpFilterï¼Œæ˜¯GenericFilterçš„å­ç±»ã€‚ é€šè¿‡ç»§æ‰¿HttpFilteræ¥å®ç°Filterï¼š @WebFilter(filterName = \"FilterDemo\",urlPatterns = \"/*\") public class FilterDemo extends HttpFilter { @Override protected void doFilter(HttpServletRequest request, HttpServletResponse response, FilterChain chain) throws IOException, ServletException { request.setCharacterEncoding(\"UTF-8\"); response.setContentType(\"text/html;charset=UTF-8\"); System.out.println(\"FilterDemo:æ”¾è¡Œå‰\"); chain.doFilter(request,response); System.out.println(\"FilterDemo:æ”¾è¡Œå\"); } }","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"javaweb","slug":"javaweb","permalink":"https://www.codetool.top/tags/javaweb/"}]},{"title":"nginx+keepalivedé«˜å¯ç”¨çš„å¹¶å‘è§£å†³æ–¹æ¡ˆ","slug":"nginx-keepalivedé«˜å¯ç”¨çš„å¹¶å‘è§£å†³æ–¹æ¡ˆ","date":"2019-11-27T10:05:23.000Z","updated":"2020-02-21T14:38:07.516Z","comments":true,"path":"article/nginx-keepalivedé«˜å¯ç”¨çš„å¹¶å‘è§£å†³æ–¹æ¡ˆ/","link":"","permalink":"https://www.codetool.top/article/nginx-keepalived%E9%AB%98%E5%8F%AF%E7%94%A8%E7%9A%84%E5%B9%B6%E5%8F%91%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/","excerpt":"","text":"1 nginxnginxæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„HTTPå’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªé‚®ä»¶æœåŠ¡å™¨ï¼Œæ”¯æŒè´Ÿè½½å‡è¡¡å’Œé«˜å¹¶å‘ã€‚ 2 Keepalived Keepalivedæ˜¯ä¸€ä¸ªåŸºäºVRRPåè®®æ¥å®ç°çš„æœåŠ¡é«˜å¯ç”¨æ–¹æ¡ˆï¼Œå¯ä»¥åˆ©ç”¨å…¶æ¥é¿å…IPå•ç‚¹æ•…éšœï¼Œç±»ä¼¼çš„å·¥å…·è¿˜æœ‰heartbeatã€corosyncã€pacemakerã€‚ä½†æ˜¯å®ƒä¸€èˆ¬ä¸ä¼šå•ç‹¬å‡ºç°ï¼Œè€Œæ˜¯ä¸å…¶å®ƒè´Ÿè½½å‡è¡¡æŠ€æœ¯ï¼ˆå¦‚lvsã€haproxyã€nginxï¼‰ä¸€èµ·å·¥ä½œæ¥è¾¾åˆ°é›†ç¾¤çš„é«˜å¯ç”¨ã€‚ 3 Nginx+keepalivedæ¶æ„å¯¹äºä¸€å°è½®è¯¢çš„nginxæœåŠ¡å™¨ï¼Œå¦‚æœå®•æœºï¼Œåˆ™æ•´ä¸ªé›†ç¾¤éƒ½ä¸èƒ½æ”¶åˆ°è¯·æ±‚ã€‚æ‰€ä»¥é€šå¸¸å³ä½¿åªæ˜¯ç”¨ä½œè½®è¯¢çš„æœåŠ¡å™¨ï¼Œä¹Ÿè¦æœ‰åå¤‡æœåŠ¡å™¨ã€‚ åœ¨è¿™ç§æ¶æ„ä¸­ï¼Œå¤–ç•Œç”¨æˆ·è®¿é—®çš„æ˜¯è™šæ‹ŸIPï¼Œkeepalivedä¸»æœºï¼ˆmasterï¼‰ä¼šå ç”¨è¿™ä¸ªipåœ°å€ï¼Œå…¶ä»–åå¤‡æœåŠ¡å™¨å¾…å‘½ã€‚å¦‚æœmasteræœåŠ¡å™¨å®•æœºï¼ŒbackupæœåŠ¡å™¨èƒ½æ„ŸçŸ¥åˆ°å¹¶åŠæ—¶æ¥ç®¡è¿™ä¸ªè™šæ‹ŸIPã€‚","categories":[{"name":"ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶","slug":"ä¸­é—´ä»¶-å·¥å…·-æ¡†æ¶","permalink":"https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"https://www.codetool.top/tags/nginx/"},{"name":"é«˜å¹¶å‘","slug":"é«˜å¹¶å‘","permalink":"https://www.codetool.top/tags/%E9%AB%98%E5%B9%B6%E5%8F%91/"}]},{"title":"javaåŸºç¡€æŸ¥ç¼ºè¡¥æ¼01","slug":"javaåŸºç¡€æŸ¥ç¼ºè¡¥æ¼01","date":"2019-11-26T10:05:23.000Z","updated":"2020-02-14T18:02:52.309Z","comments":true,"path":"article/javaåŸºç¡€æŸ¥ç¼ºè¡¥æ¼01/","link":"","permalink":"https://www.codetool.top/article/java%E5%9F%BA%E7%A1%80%E6%9F%A5%E7%BC%BA%E8%A1%A5%E6%BC%8F01/","excerpt":"","text":"æŸäº›ç‚¹ä¼šåœ¨ä¸è¿œçš„å°†æ¥æ·±æŒ–ã€‚ &gt;&gt;æ˜¯é€»è¾‘å³ç§»ï¼Œ&gt;&gt;&gt;æ˜¯ç®—æœ¯å³ç§» JDK6 å¯ä»¥ä½¿ç”¨Console.readPasswordä»æ§åˆ¶å°ä¸­è¯»å–å¯†ç ï¼Œç”¨æˆ·è¾“å…¥çš„è¿‡ç¨‹ä¸­å¯†ç æ˜¯ä¸å¯è§çš„ã€‚ public static void main(String[] args) { Console cs = System.console(); String username = cs.readLine(\"User name: \"); char[] passwd = cs.readPassword(\"Password: \"); } printfæ ¼å¼åŒ–è¾“å‡ºä¸­çš„%sè½¬æ¢ç¬¦èƒ½æ ¼å¼åŒ–ä»»æ„çš„å¯¹è±¡ï¼Œå¯¹äºå®ç°äº†Formattableæ¥å£çš„å¯¹è±¡å°†è°ƒç”¨formatToæ–¹æ³•ï¼Œå¦åˆ™å°†è°ƒç”¨ToStringæ–¹æ³•ã€‚ Javaçš„æ–‡ä»¶è¯»å–ï¼šé€šè¿‡Fileæ„é€ ä¸€ä¸ªScannerå¯¹è±¡ï¼›å†™å…¥æ–‡ä»¶ï¼šæ„é€ ä¸€ä¸ªPrintWriterå¯¹è±¡ Scanner in = new Scanner(Paths.get(\"myfile.txt\",\"UTF-8\"); PrintWriter out = new PrintWriter(\"myfile.txt\",\"UTF-8\"); Mathä¸­çš„BigIntegerå’ŒBigDecimalå¯ä»¥æ»¡è¶³é«˜ç²¾åº¦çš„è¿ç®—éœ€è¦ã€‚ åŒ¿åæ•°ç»„çš„å†™æ³•ï¼šnew int[]{17,19,23,29,31,37} finalizeæ–¹æ³•ï¼šç›¸å½“äºææ„æ–¹æ³•ï¼Œåœ¨åƒåœ¾å›æ”¶å™¨æ¸…é™¤å¯¹è±¡ä¹‹å‰è°ƒç”¨ã€‚ä½†ä¸æ¨èä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå› ä¸ºå¾ˆéš¾ç¡®å®šè¿™ä¸ªæ–¹æ³•åœ¨ä»€ä¹ˆæ—¶å€™æ‰èƒ½è¢«è°ƒç”¨ã€‚ import staticæ˜¯é™æ€å¯¼å…¥ï¼Œå¯ä»¥å¯¼å…¥æŸä¸ªç±»ä¸­çš„é™æ€æ–¹æ³•å’Œé™æ€å­—æ®µã€‚ å¯å˜å‚æ•°åˆ—è¡¨ï¼šfunction(Object... values)ï¼Œåœ¨å‡½æ•°å†…éƒ¨å¯ä»¥æŠŠvaluesçœ‹æˆä¸€ä¸ªå‚æ•°æ•°ç»„ã€‚ java8æ–¹æ³•å¼•ç”¨ï¼š å¯¹è±¡çš„æ–¹æ³•å¼•ç”¨ object::instanceMethod ç±»çš„é™æ€æ–¹æ³•å¼•ç”¨ Class::staticMethod ä»»æ„ç±»çš„ä»»æ„å¯¹è±¡çš„æ–¹æ³•å¼•ç”¨ï¼šClass::instanceMethodï¼Œå®ƒåªèƒ½è¢«è¯¥ç±»çš„å®ä¾‹å¯¹è±¡è°ƒç”¨ã€‚ ç±»çš„æ„é€ å™¨è°ƒç”¨ Class::new å†…éƒ¨ç±»ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å†…éƒ¨ç±» å†…éƒ¨ç±»æ–¹æ³•å¯ä»¥è®¿é—®è¯¥ç±»å®šä¹‰æ‰€åœ¨çš„ä½œç”¨åŸŸä¸­çš„æ•°æ®ï¼ŒåŒ…æ‹¬ç§æœ‰çš„æ•°æ®ã€‚ å†…éƒ¨ç±»å¯ä»¥å¯¹åŒä¸€ä¸ªåŒ…ç§çš„å…¶ä»–ç±»éšè—èµ·æ¥ã€‚ å½“æƒ³è¦å®šä¹‰ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸”ä¸æƒ³ç¼–å†™å¤§é‡ä»£ç æ—¶ï¼Œä½¿ç”¨åŒ¿åå†…éƒ¨ç±»æ¯”è¾ƒä¾¿æ·ã€‚ å†…éƒ¨ç±»ç±»å‹ æ™®é€šå†…éƒ¨ç±» å±€éƒ¨å†…éƒ¨ç±»ï¼ˆåœ¨æ–¹æ³•ä¸­å®šä¹‰çš„å†…éƒ¨ç±»ï¼Œä¸èƒ½æœ‰è®¿é—®ä¿®é¥°ç¬¦ï¼Œä¸èƒ½æ˜¯staticï¼‰å±€éƒ¨å†…éƒ¨ç±»å¯ä»¥è®¿é—®å½“å‰ä»£ç å—çš„å¸¸é‡ï¼Œå’Œæ­¤å¤–å›´ç±»çš„æ‰€æœ‰æˆå‘˜ã€‚ é™æ€å†…éƒ¨ç±»ï¼ˆå£°æ˜ä¸ºstaticï¼Œä¸ä¾èµ–äºå¤–éƒ¨ç±»çš„å¯¹è±¡å­˜åœ¨ï¼Œå®é™…ä¸Šæˆä¸ºäº†ä¸€ä¸ªé¡¶çº§ç±»ï¼‰ åŒ¿åå†…éƒ¨ç±»ï¼ˆç«‹åˆ»ä½¿ç”¨ï¼Œä»£ç çŸ­å°ï¼Œåªç”¨åˆ°ä¸€ä¸ªå®ä¾‹ï¼‰è¯­æ³•ï¼šnew SuperType(construction parameter){inner class methods and data} å†…éƒ¨ç±»åº•å±‚å®ç°ï¼ˆæ™®é€šå†…éƒ¨ç±»ï¼‰ï¼š ç¼–è¯‘å™¨è‡ªåŠ¨ä¸ºå†…éƒ¨ç±»æ·»åŠ ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œè¯¥æˆå‘˜å˜é‡çš„ç±»å‹å’Œå¤–éƒ¨ç±»çš„ç±»å‹ç›¸åŒï¼Œè¿™ä¸ªæˆå‘˜å˜é‡å°±æ˜¯æŒ‡å‘å¤–éƒ¨ç±»å¯¹è±¡å¼•ç”¨ã€‚ ç¼–è¯‘å™¨è‡ªåŠ¨ä¸ºå†…éƒ¨ç±»çš„æ„é€ æ–¹æ³•æ·»åŠ ä¸€ä¸ªå‚æ•°ï¼Œå‚æ•°çš„ç±»å‹æ˜¯å¤–éƒ¨ç±»çš„ç±»å‹ï¼Œåœ¨æ„é€ æ–¹æ³•å†…éƒ¨ä½¿ç”¨è¿™ä¸ªå‚æ•°ä¸º1ä¸­æ·»åŠ çš„æˆå‘˜å˜é‡èµ‹å€¼ã€‚ åœ¨è°ƒç”¨å†…éƒ¨ç±»çš„æ„é€ å‡½æ•°åˆå§‹åŒ–å†…éƒ¨ç±»å¯¹è±¡æ—¶ï¼Œä¼šé»˜è®¤ä¼ å…¥å¤–éƒ¨ç±»çš„å¼•ç”¨ã€‚ JavaåŠ¨æ€ä»£ç†ï¼šhttps://www.jianshu.com/p/95970b089360 Throwableåˆ†å±‚ï¼šErrorç±»å±‚æ¬¡ç»“æ„æè¿°äº†Javaè¿è¡Œæ—¶ç³»ç»Ÿçš„å†…éƒ¨é”™è¯¯å’Œèµ„æºè€—å°½é”™è¯¯ã€‚åº”ç”¨ç¨‹åºä¸åº”è¯¥æŠ›å‡ºè¿™ç§ç±»å‹çš„å¯¹è±¡ã€‚Javaè¯­è¨€è§„èŒƒå°†æ´¾ç”ŸäºErrorç±»æˆ–RuntimeExceptionç±»çš„æ‰€æœ‰å¼‚å¸¸ç§°ä¸ºéå—æŸ¥å¼‚å¸¸(éå—æŸ¥å¼‚å¸¸åœ¨è¿è¡Œä¹‹å‰ä¸ä¼šçŸ¥é“æœ‰é”™è¯¯)ï¼Œæ‰€æœ‰å…¶ä»–çš„å¼‚å¸¸ç§°ä¸ºå—æŸ¥å¼‚å¸¸ï¼ˆå—æŸ¥å¼‚å¸¸åœ¨ç¼–è¯‘ä¹‹å‰å°±èƒ½çŸ¥é“ï¼Œå¿…é¡»ç”¨try/catchæ•è·ï¼‰ã€‚ æ–­è¨€ï¼š assert æ¡ä»¶; assert æ¡ä»¶:è¡¨è¾¾å¼;å¦‚æœç»“æœæ˜¯falseï¼ŒæŠ›å‡ºä¸€ä¸ªAssertionErrorå¼‚å¸¸ï¼Œç¬¬äºŒç§å½¢å¼ä½¿ç”¨è¡¨è¾¾å¼æ„é€ AssertionErrorï¼Œè½¬æ¢æˆæ¶ˆæ¯å­—ç¬¦ä¸²ã€‚ å¯ä»¥åœ¨æ™®é€šç±»é‡Œé¢å®šä¹‰æ³›å‹æ–¹æ³•ï¼šT function(T... param)ä»£è¡¨Tæ˜¯BoundingTypeçš„å­ç±»ã€‚ä»£è¡¨Tæ˜¯BoundingTypeçš„è¶…ç±»ã€‚BoundingTypeå¯ä»¥æ˜¯ç”¨â€&amp;â€åˆ†éš”çš„å¤šä¸ªç±»javaæ³›å‹-ç±»å‹æ“¦é™¤ï¼šhttps://www.cnblogs.com/joeblackzqq/p/10813143.html javaå…³é”®å­—volatileï¼šç¡®ä¿æœ¬æ¡æŒ‡ä»¤ä¸ä¼šå› ç¼–è¯‘å™¨çš„ä¼˜åŒ–è€Œçœç•¥ï¼Œä¸”è¦æ±‚æ¯æ¬¡ç›´æ¥è¯»å€¼ javaå…³é”®å­—transient: æ ‡è®°çš„æˆå‘˜å˜é‡ä¸å‚ä¸åºåˆ—åŒ–è¿‡ç¨‹","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://www.codetool.top/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}]},{"title":"ä»Šæ—¥ipv4åœ°å€æ­£å¼è€—å°½","slug":"ä»Šæ—¥ipv4åœ°å€æ­£å¼è€—å°½","date":"2019-11-26T10:05:23.000Z","updated":"2019-12-19T08:16:26.318Z","comments":true,"path":"article/ä»Šæ—¥ipv4åœ°å€æ­£å¼è€—å°½/","link":"","permalink":"https://www.codetool.top/article/%E4%BB%8A%E6%97%A5ipv4%E5%9C%B0%E5%9D%80%E6%AD%A3%E5%BC%8F%E8%80%97%E5%B0%BD/","excerpt":"","text":"æ’æ’­ä¸€æ¡ç§‘æŠ€å¿«è®¯ï¼š åŒ—äº¬æ—¶é—´11æœˆ26æ—¥ä¸‹åˆæ¶ˆæ¯ï¼Œæ®å›½å¤–åª’ä½“æŠ¥é“ï¼Œè´Ÿè´£è‹±å›½ã€æ¬§æ´²ã€ä¸­ä¸œå’Œéƒ¨åˆ†ä¸­äºšåœ°åŒºäº’è”ç½‘èµ„æºåˆ†é…çš„æ¬§æ´²ç½‘ç»œåè°ƒä¸­å¿ƒï¼ˆRIPE NCCï¼‰ä»Šæ—¥å®£å¸ƒï¼š å…¨çƒæ‰€æœ‰43äº¿ä¸ªIPv4åœ°å€å·²å…¨éƒ¨åˆ†é…å®Œæ¯•ï¼Œè¿™æ„å‘³ç€æ²¡æœ‰æ›´å¤šçš„IPv4åœ°å€å¯ä»¥åˆ†é…ç»™ISPï¼ˆç½‘ç»œæœåŠ¡æä¾›å•†ï¼‰å’Œå…¶ä»–å¤§å‹ç½‘ç»œåŸºç¡€è®¾æ–½æä¾›å•†ã€‚ ä¸€æƒ³æƒ³æˆ‘æ‰‹ä¸Šä¸¤å°æœåŠ¡å™¨æœ‰ä¸¤ä¸ªç‹¬ç«‹çš„ipv4åœ°å€è¿˜æœ‰ç‚¹å°æ¿€åŠ¨å‘¢ã€‚ çæƒœIPv4åœ°å€,å‰ç¥¥å·ç ï¼Œå…¨çƒå”¯ä¸€ï¼Œé”™è¿‡ä»Šæ—¥ï¼Œæ¯ä¸€ç”Ÿã€‚","categories":[{"name":"æ—¥å¸¸/éšç¬”","slug":"æ—¥å¸¸-éšç¬”","permalink":"https://www.codetool.top/categories/%E6%97%A5%E5%B8%B8-%E9%9A%8F%E7%AC%94/"}],"tags":[{"name":"æ—¥å¸¸","slug":"æ—¥å¸¸","permalink":"https://www.codetool.top/tags/%E6%97%A5%E5%B8%B8/"}]},{"title":"AVLæ ‘-è‡ªå¹³è¡¡çš„äºŒå‰æœç´¢æ ‘","slug":"AVLæ ‘-è‡ªå¹³è¡¡çš„äºŒå‰æœç´¢æ ‘","date":"2019-11-25T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/AVLæ ‘-è‡ªå¹³è¡¡çš„äºŒå‰æœç´¢æ ‘/","link":"","permalink":"https://www.codetool.top/article/AVL%E6%A0%91-%E8%87%AA%E5%B9%B3%E8%A1%A1%E7%9A%84%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/","excerpt":"","text":"æœ¬æ–‡å›¾ç‰‡æ¥æºï¼šæ‰‹æŠŠæ‰‹æ•™ï¼Œæ‰‹å†™AVLæ ‘ - ä¸æ­¢æ˜¯ç¼–ç¨‹ - åšå®¢å›­ 1 AVLæ ‘çš„æ¦‚å¿µ1.1 è‡ªå¹³è¡¡å½“äºŒå‰æœç´¢æ ‘å¤„äºå¹³è¡¡çŠ¶æ€çš„æ—¶å€™ï¼Œå…¶æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸ºO(logN)ï¼Œä½†å½“äºŒå‰æœç´¢æ ‘æ˜¯å•æ”¯æ ‘çš„æ—¶å€™ï¼Œå…¶æœç´¢æ•ˆç‡åˆ™ä¸ºO(N)ã€‚å¯è§ï¼ŒäºŒå‰æœç´¢æ ‘çš„å¹³è¡¡æ€§æ˜¯å½±å“å…¶æ“ä½œæ•ˆç‡çš„å…³é”®ã€‚ç”±æ­¤å‡ºå‘ï¼Œå­¦è€…ä»¬è®¾è®¡äº†ç¬¬ä¸€ä¸ªå¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼Œå³AVLæ ‘ã€‚AVLæ ‘ä½œä¸ºç¬¬ä¸€ä¸ªå¹³è¡¡çš„äºŒå‰æœç´¢æ ‘ï¼Œå…¶å½±å“éå¸¸æ·±è¿œï¼Œåæ¥çš„å¾ˆå¤šå¹³è¡¡ç»“æ„éƒ½å€Ÿé‰´äº†AVLæ ‘çš„è®¾è®¡æ€æƒ³ã€‚ 1.2 AVLæ ‘çš„å®šä¹‰ä¸€æ£µAVLæ ‘æˆ–è€…æ˜¯ç©ºæ ‘ï¼Œæˆ–è€…æ˜¯å…·æœ‰ä¸‹åˆ—æ€§è´¨çš„äºŒå‰æœç´¢æ ‘ï¼š å®ƒçš„å·¦å­æ ‘å’Œå³å­æ ‘éƒ½æ˜¯AVLæ ‘ã€‚ å·¦å­æ ‘å’Œå³å­æ ‘çš„é«˜åº¦ä¹‹å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ã€‚ è¦æ³¨æ„ï¼ŒAVLçš„å¹³è¡¡æ€§æ˜¯ä¸€ç§ç›¸å¯¹çš„å¹³è¡¡ï¼Œå¹¶éä¸€ç§ç»å¯¹çš„å¹³è¡¡ã€‚å®ƒä¸è¦æ±‚å·¦å­æ ‘å’Œå³å­æ ‘çš„é«˜åº¦ç»å¯¹ç›¸ç­‰ï¼Œè€Œä»…ä»…æ˜¯å·¦å­æ ‘å’Œå³å­æ ‘çš„é«˜åº¦ä¹‹å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1å³å¯ã€‚å› ä¸ºç»å¯¹çš„å¹³è¡¡éš¾ä»¥å®ç°ã€‚ å¦‚æœç»™AVLæ ‘ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½é™„åŠ ä¸€ä¸ªæ•°å­—ï¼Œè¯¥æ•°å­—æŒ‡ç¤ºè¯¥èŠ‚ç‚¹å³å­æ ‘çš„é«˜åº¦å‡å»å·¦å­æ ‘çš„é«˜åº¦æ‰€å¾—çš„é«˜åº¦å·®ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å­—å³ä¸ºè¯¥èŠ‚ç‚¹çš„å¹³è¡¡å› å­ã€‚æ ¹æ®AVLæ ‘çš„å®šä¹‰ï¼Œä»»ä¸€èŠ‚ç‚¹çš„å¹³è¡¡å› å­åªèƒ½å–-1ã€0æˆ–1ã€‚ 1.3 AVLæ ‘çš„æ—‹è½¬åœ¨ä¸€ä¸ªå¹³è¡¡çš„äºŒå‰æœç´¢æ ‘ä¸­æ’å…¥ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œå°±ä¼šé€ æˆå…¶å¤±è¡¡ï¼Œéœ€è¦ä»æ’å…¥ä½ç½®æ²¿é€šå‘æ ¹çš„è·¯å¾„å›æº¯ï¼Œæ£€æŸ¥å„èŠ‚ç‚¹çš„å¹³è¡¡å› å­ï¼Œåœ¨æŸä¸€èŠ‚ç‚¹å‘ç°é«˜åº¦ä¸å¹³è¡¡ï¼Œåˆ™åœæ­¢å›æº¯ã€‚ç„¶åä»å‘ç”Ÿä¸å¹³è¡¡çš„èŠ‚ç‚¹èµ·ï¼Œå¾€ä¸‹å–ä¸‰å±‚ï¼Œå¯ä»¥å½’çº³ä¸ºå››ç§æƒ…å†µï¼š å‘æŸèŠ‚ç‚¹çš„å·¦å­æ ‘ä¸­æ’å…¥ä¸€ä¸ªå·¦å­©å­ã€‚ å‘æŸèŠ‚ç‚¹çš„å³å­æ ‘ä¸­æ’å…¥ä¸€ä¸ªå³å­©å­ã€‚ å‘æŸèŠ‚ç‚¹çš„å·¦å­æ ‘ä¸­æ’å…¥ä¸€ä¸ªå³å­©å­ã€‚ å‘æŸèŠ‚ç‚¹çš„å³å­æ ‘ä¸­æ’å…¥ä¸€ä¸ªå·¦å­©å­ã€‚ å¯¹åº”çš„å¤„ç†æ–¹å¼ï¼š 1.3.1 å•æ—‹ å³æ—‹æ“ä½œ ä»¥ä¸­é—´èŠ‚ç‚¹ä¸ºè½´ï¼Œè¿›è¡Œé¡ºæ—¶é’ˆæ—‹è½¬ï¼Œè¯¥ä¸­é—´èŠ‚ç‚¹çš„åŸçˆ¶èŠ‚ç‚¹å°†å˜æˆè¯¥èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ï¼Œè¯¥ä¸­é—´èŠ‚ç‚¹çš„å³å­æ ‘åˆ™å˜æˆå…¶åŸçˆ¶èŠ‚ç‚¹çš„å·¦å­æ ‘ã€‚ å·¦æ—‹æ“ä½œ å¯¹åº”çš„ï¼Œå·¦æ—‹çš„æ–¹æ³•æ˜¯ä»¥ä¸‰ä¸ªå‘ˆç›´çº¿æ’åˆ—çš„èŠ‚ç‚¹çš„ä¸­é—´èŠ‚ç‚¹ä¸ºè½´ï¼Œè¿›è¡Œé€†æ—¶é’ˆæ—‹è½¬ã€‚è¯¥ä¸­é—´èŠ‚ç‚¹çš„åŸçˆ¶èŠ‚ç‚¹å°†å˜æˆè¯¥èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ï¼Œè¯¥ä¸­é—´èŠ‚ç‚¹çš„å·¦å­æ ‘åˆ™å˜æˆå…¶åŸçˆ¶èŠ‚ç‚¹çš„å³å­æ ‘ 1.3.2 åŒæ—‹ å…ˆå·¦åå³åŒæ—‹è½¬ ä»¥3ä¸ªæˆæŠ˜çº¿æ’åˆ—çš„èŠ‚ç‚¹ä¸­çš„æœ«èŠ‚ç‚¹ä¸ºè½´ï¼Œè¿›è¡Œé€†æ—¶é’ˆæ—‹è½¬ã€‚ä½¿æœ«èŠ‚ç‚¹ä»£æ›¿ä¸­é—´èŠ‚ç‚¹çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è®©æœ«èŠ‚ç‚¹æˆä¸ºåŸä¸­é—´èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œè¿™æ—¶ï¼Œä¸‰ä¸ªèŠ‚ç‚¹å°†æˆä¸€ç›´çº¿æ’åˆ—ï¼Œå†ä»¥æ–°çš„ä¸­é—´èŠ‚ç‚¹ä¸ºæ—‹è½¬è½´åšå³æ—‹æ“ä½œï¼Œå³å¯å®Œæˆå¹³è¡¡åŒ–æ“ä½œã€‚ åŸºæœ¬æƒ…å†µ å¤æ‚æƒ…å†µ å…ˆå³åå·¦åŒæ—‹è½¬ ä»¥3ä¸ªæˆæŠ˜çº¿æ’åˆ—çš„èŠ‚ç‚¹ä¸­çš„ä¸­é—´èŠ‚ç‚¹ä¸ºè½´ï¼Œè¿›è¡Œé¡ºæ—¶é’ˆæ—‹è½¬ã€‚ä½¿æœ«èŠ‚ç‚¹ä»£æ›¿ä¸­é—´èŠ‚ç‚¹çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è®©æœ«èŠ‚ç‚¹æˆä¸ºåŸä¸­é—´èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œè¿™æ—¶ï¼Œä¸‰ä¸ªèŠ‚ç‚¹å°†æˆä¸€ç›´çº¿æ’åˆ—ï¼Œå†ä»¥æ–°çš„ä¸­é—´èŠ‚ç‚¹ä¸ºæ—‹è½¬è½´åšå·¦æ—‹æ“ä½œï¼Œå³å¯å®Œæˆå¹³è¡¡åŒ–æ“ä½œã€‚","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"è¯¦è§£javaä¸­çš„unicodeç¼–ç ï¼ˆç ç‚¹ï¼‰","slug":"è¯¦è§£javaä¸­çš„unicodeç¼–ç ï¼ˆç ç‚¹ï¼‰","date":"2019-11-25T10:05:23.000Z","updated":"2020-04-09T06:00:49.056Z","comments":true,"path":"article/è¯¦è§£javaä¸­çš„unicodeç¼–ç ï¼ˆç ç‚¹ï¼‰/","link":"","permalink":"https://www.codetool.top/article/%E8%AF%A6%E8%A7%A3java%E4%B8%AD%E7%9A%84unicode%E7%BC%96%E7%A0%81%EF%BC%88%E7%A0%81%E7%82%B9%EF%BC%89/","excerpt":"","text":"è‡´è°¢ï¼š æœ¬æ–‡å‚è€ƒç½‘é¡µï¼šUnicodeå­—ç¬¦é›†ä»¥åŠUTF-8ï¼ŒUTF-16ç¼–ç çš„æ€»ç»“ - vcj1009784814çš„åšå®¢ - CSDNåšå®¢ 1 Unicodeunicodeçš„ç ç‚¹ä»U+0000åˆ°U+10FFFFï¼Œå³å…±æœ‰2^20+2^16-1=1114111ä¸ªç ç‚¹ã€‚é€šå¸¸æ¥è¯´ï¼Œå¸¸è§å­—ç¬¦å¯ä»¥ç”¨2ä¸ªå­—èŠ‚ï¼ˆ16ä½ï¼‰æ¥è¡¨ç¤ºã€‚ä½†è¿˜æœ‰å¾ˆå¤šå…¶ä»–è¡¨æ„å­—ç¬¦ã€è¾…åŠ©å­—ç¬¦éœ€è¦è¡¨ç¤ºã€‚ Unicodeå°†æ‰€æœ‰ç ç‚¹åˆ†æˆäº†17ä¸ªä»£ç çº§åˆ«ï¼Œåˆç§°å¹³é¢ã€‚ å…¶ä¸­ç¬¬ä¸€ä¸ªå¹³é¢ç§°ä¸ºåŸºæœ¬çš„å¤šè¯­è¨€çº§åˆ«ï¼ˆbasic multilingual plane, BMPï¼‰ï¼Œå…¶ä»–çš„ç»Ÿç§°ä¸ºè¾…åŠ©å¹³é¢ 1.1 utf-8ç”±äºunicodeä¼šæœ‰1ä¸ªå­—èŠ‚-4ä¸ªå­—èŠ‚ä¸ç­‰ï¼Œå¦‚æœå®šé•¿å­˜å‚¨æ¯ä¸ªå­—ç¬¦éƒ½éœ€è¦å ç”¨å››ä¸ªå­—èŠ‚ï¼Œååˆ†æµªè´¹ç©ºé—´ï¼Œutf-8æ˜¯ä¸€ç§å˜é•¿å­˜å‚¨æ–¹å¼ï¼Œå…·ä½“ç¼–ç æ–¹å¼å¦‚ä¸‹ï¼š ç¬¬ä¸€ä¸ªå­—èŠ‚æç¤ºäº†è¿™ä¸ªunicodeç¼–ç ç”±å‡ ä¸ªå­—èŠ‚ç»„æˆ é¦–å­—èŠ‚ä»¥0å¼€å¤´ï¼Œè¡¨ç¤ºå•å­—èŠ‚ç¼–ç  é¦–å­—èŠ‚ä»¥110å¼€å¤´ï¼Œè¡¨ç¤ºåŒå­—èŠ‚ç¼–ç ï¼Œåç»­å­—èŠ‚ä»¥10å¼€å¤´ é¦–å­—èŠ‚ä»¥1110å¼€å¤´ï¼Œè¡¨ç¤ºä¸‰å­—èŠ‚ç¼–ç ï¼Œåç»­å­—èŠ‚ä»¥10å¼€å¤´ é¦–å­—èŠ‚ä»¥11110å¼€å¤´ï¼Œè¡¨ç¤ºå››å­—èŠ‚ç¼–ç ï¼Œåç»­å­—èŠ‚ä»¥10å¼€å¤´ æœ‰æ•ˆä½å¯¹åº”çš„å­—èŠ‚æ•° 1.2 utf-16UTF-16æºäºUCS-2ï¼ŒUCS-2å°†å­—ç¬¦ç ç‚¹ç›´æ¥æ˜ å°„ä¸ºå­—ç¬¦ç¼–ç ï¼Œä¸­é—´æ— ç‰¹åˆ«çš„ç¼–ç ç®—æ³•ã€‚ UCS-2ç¼–ç æ–¹å¼å›ºå®š2å­—èŠ‚ç¼–ç ï¼Œåªè¦†ç›–äº†BMPçš„ç ç‚¹ï¼Œå¯¹äºSMPçš„ç ç‚¹ï¼Œ2å­—èŠ‚çš„16ä½äºŒè¿›åˆ¶æ•°æ˜¯ä¸è¶³ä»¥è¡¨ç¤ºçš„ã€‚ è€ŒUTF-16æ‰©å±•äº†åŸæ¥çš„UCS-2ç¼–ç ï¼Œè§£å†³äº†è¾…åŠ©å¹³é¢ç ç‚¹çš„å­—ç¬¦æ— æ³•è¡¨ç¤ºçš„é—®é¢˜ï¼š BMPä¸­çš„æœ‰æ•ˆç ç‚¹ï¼Œç”¨å›ºå®š2å­—èŠ‚16ä½æ¥ä¸ºå…¶ç¼–ç ï¼Œæ•°å€¼ç­‰äºå¯¹åº”çš„ç ç‚¹ï¼ŒåŒUCS-2 è¾…åŠ©å¹³é¢ä¸­çš„æœ‰æ•ˆç ç‚¹ï¼Œä½¿ç”¨ä»£ç†å¯¹è¿›è¡Œç¼–ç ã€‚åœ¨BMPä¸­ï¼Œæœ‰ä¸€ä¸ªèŒƒå›´çš„ç ç‚¹æ˜¯æœªå®šä¹‰çš„ï¼Œè¢«ç§°ä¸ºä»£ç†åŒºï¼Œå…¶ç ç‚¹èŒƒå›´æ˜¯0xD800~0xDFFFï¼Œå…±211ä¸ªç ç‚¹ï¼Œä»£ç†åŒºåˆè¢«åˆ†ä¸ºé«˜ä»£ç†ç ç‚¹å’Œä½ä»£ç†ç ç‚¹ï¼Œå…¶ä¸­é«˜ä»£ç†ç ç‚¹èŒƒå›´æ˜¯0xD800~0XDBFFï¼Œä½ä»£ç†ç ç‚¹èŒƒå›´æ˜¯0xDC00~0XDFFFï¼Œé«˜ä»£ç†ç ç‚¹å’Œä½ä»£ç†ç ç‚¹ç»“åˆåœ¨ä¸€èµ·ï¼Œå°±è¡¨ç¤ºä¸€ä¸ªè¾…åŠ©å¹³é¢ä¸­çš„å­—ç¬¦ã€‚ç”±äºè¾…åŠ©å¹³é¢ä¸­çš„å­—ç¬¦å…±æœ‰220ä¸ªï¼ˆ0x10000~0x10FFFFï¼‰ï¼Œé«˜ä»£ç†ç ç‚¹å’Œä½ä»£ç†ç ç‚¹çš†æœ‰210ä¸ªå–å€¼ï¼Œä¸¤è€…ç»“åˆï¼Œæ°å¥½æœ‰220ç§ä¸åŒçš„ç»„åˆã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒUTF-16å¯ä»¥è¡¨ç¤ºå®Œunicodeä¸­çš„å­—ç¬¦ï¼ŒBMPä¸­çš„å­—ç¬¦éœ€è¦ä¸¤ä¸ªå­—èŠ‚ï¼Œå…¶ä»–çš„éœ€è¦å››ä¸ªå­—èŠ‚ã€‚ 2 javaä¸­çš„unicodeè¿™é‡Œä½¿ç”¨åˆ°ä¸€ä¸ªå·¥å…·ï¼šUnicodeç¼–ç è½¬æ¢ï¼ŒUTFç¼–ç è½¬æ¢ï¼ˆUTF-8ã€UTF-16ã€UTF-32ï¼‰ 2.1 charjavaä¸­çš„charæ˜¯å®šé•¿ä»¥16ä½ï¼ˆä¸¤ä¸ªå­—èŠ‚å­˜å‚¨çš„ï¼‰ï¼Œå¹¶ä¸”å†…éƒ¨ç¼–ç ä¸ºutf-16ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªcharåªèƒ½è¡¨ç¤ºBMPä¸­çš„å­—ç¬¦ï¼Œè‹¥è¦è¡¨ç¤ºä¸€ä¸ªè¾…åŠ©å¹³é¢å†…çš„å­—ç¬¦ï¼Œéœ€è¦ä¸¤ä¸ªcharã€‚ æ¥çœ‹ä¸€ä¸ªBMPä¸­çš„å­—ç¬¦ï¼šâ€æˆ‘â€ Unicodeç¼–ç ï¼šU+6211UTF8ç¼–ç ï¼šE68891UTF16BEç¼–ç ï¼šFEFF6211UTF16LEç¼–ç ï¼šFFFE1162 UTF16BEã€UTF16LEåˆ†åˆ«æŒ‡çš„æ˜¯æœºå™¨ä¸­çš„å¤§ç«¯è¡¨ç¤ºå’Œå°ç«¯è¡¨ç¤ºï¼Œå‰é¢çš„FEFFæˆ–FFFEç¼–è¯‘å™¨ä¼šå¸®æˆ‘ä»¬è¿‡æ»¤æ‰ï¼Œæˆ‘ä»¬è¿™é‡Œåªçœ‹å¤§ç«¯è¡¨ç¤ºã€‚ å¯¹äºUTF-8è¡¨ç¤ºï¼Œå…ˆå°†6211è½¬æ¢ä¸ºäºŒè¿›åˆ¶ç¼–ç 110 001000 010001ï¼Œæ˜¯15ä¸ªæœ‰æ•ˆä½ã€‚å¯¹ç…§utf-8ç¼–ç è¡¨ï¼Œå¯çŸ¥éœ€è¦ç”¨ä¸‰ä¸ªå­—èŠ‚(1110xxxx 10xxxxxxxx 10xxxxxxxx)æ¥è¡¨ç¤ºï¼Œå°†æœ‰æ•ˆä½å¡«å…¥ï¼Œå¾—utf-8ç¼–ç ï¼š11100110 10001000 10010001ï¼Œè½¬æ¢ä¸º16è¿›åˆ¶ï¼Œå°±æ˜¯E68891ã€‚ å¯¹äºUTF-16è¡¨ç¤ºï¼Œ6211æ˜¯å¯ä»¥ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºå®Œçš„ï¼Œæ‰€ä»¥UTF-16çš„ç¼–ç å°±æ˜¯6621ã€‚ éªŒè¯ï¼š 2.2 Stringå¯¹äºè¾…åŠ©å¹³é¢å†…çš„å­—ç¬¦ï¼Œä¸€ä¸ªcharå¯ä¸å¤Ÿç”¨äº†ï¼Œéœ€è¦ç”±ä¸¤ä¸ªcharæ¥å­˜å‚¨ï¼Œæˆ–æ˜¯ç”¨Stringæ¥è¡¨ç¤ºã€‚ æ¥çœ‹ä¸€ä¸ªemojiå­—ç¬¦ï¼šâ€ğŸ‘‰â€ Unicodeç¼–ç ï¼šU+1F449UTF8ç¼–ç ï¼šF09F9189UTF16BEç¼–ç ï¼šFEFFD83DDC49UTF16LEç¼–ç ï¼šFFFE3DD849DC å¯¹äºUTF-8è¡¨ç¤ºï¼Œå…ˆå°†1F449è½¬æ¢ä¸ºäºŒè¿›åˆ¶ç¼–ç 11111 010001 001001ï¼Œæ˜¯17ä¸ªæœ‰æ•ˆä½ã€‚å¯¹ç…§utf-8ç¼–ç è¡¨ï¼Œå¯çŸ¥éœ€è¦ç”¨å››ä¸ªå­—èŠ‚(11110xxx 10xxxxxxxx 10xxxxxxxx 10xxxxxx)æ¥è¡¨ç¤ºï¼Œå°†æœ‰æ•ˆä½å¡«å…¥ï¼Œå¾—utf-8ç¼–ç ï¼š11110000 10011111 10010001 10001001ï¼Œè½¬æ¢ä¸º16è¿›åˆ¶ï¼Œå°±æ˜¯F09F9189ã€‚ å¯¹äºUTF-16è¡¨ç¤ºï¼Œéœ€è¦ç”¨åˆ°ä»£ç†å¯¹è¿›è¡Œç¼–ç ï¼šé¦–å…ˆç”¨1F449-10000å¾—åˆ°F449ï¼Œå°†F449è½¬æ¢ä¸º20ä½äºŒè¿›åˆ¶0000111101 0001001001ï¼Œé«˜10ä½è½¬æˆåå…­è¿›åˆ¶å¾—3D,åŠ ä¸ŠD800å¾—D83Dï¼Œå10ä½è½¬æˆåå…­è¿›åˆ¶å¾—49ï¼ŒåŠ ä¸ŠDC00å¾—DC49,æ‰€ä»¥å®ƒçš„utf-16ç¼–ç ä¸ºD83D DC49ã€‚ éªŒè¯ï¼š é—®é¢˜ï¼šString.length()ä¼šå°†ä¸€ä¸ªébmpä¸­çš„å­—ç¬¦ç®—ä¸º1è¿˜æ˜¯ç®—ä¸º2å‘¢ï¼Ÿæµ‹è¯•â†“ å¯è§ï¼Œå¦‚æœStringä¸­å­˜åœ¨ébmpä¸­çš„å­—ç¬¦ï¼ŒStringä¼šå°†å®ƒç®—æˆä¸¤ä¸ªå­—ç¬¦é•¿åº¦ã€‚çœ‹String.length()çš„æºç ä¹Ÿå¯çŸ¥é“è¿™ç‚¹ï¼š public int length() { return value.length; } valueæ˜¯Stringå†…éƒ¨çš„ä¸€ä¸ªå­—ç¬¦æ•°ç»„ã€‚ 2.3 javaå¯¹ç ç‚¹è®¡ç®—çš„æ”¯æŒå…¶å®Stringä¸­ä¹Ÿæä¾›äº†è®¡ç®—ç ç‚¹çš„æ–¹æ³•ï¼šString.codePointCount(int beginIndex, int endIndex) åˆ©ç”¨çš„æ˜¯Characterç±»èƒ½åˆ¤æ–­ä¸€ä¸ªç ç‚¹æ˜¯å¦ä¸ºä»£ç†ç ç‚¹ï¼šCharacter.isHighSurrogateï¼šæ˜¯å¦ä¸ºé«˜ä½ä»£ç†ç ç‚¹ public static boolean isHighSurrogate(char ch) { // Help VM constant-fold; MAX_HIGH_SURROGATE + 1 == MIN_LOW_SURROGATE return ch >= MIN_HIGH_SURROGATE &amp;&amp; ch &lt; (MAX_HIGH_SURROGATE + 1); } å…¶ä¸­MIN_HIGH_SURROGATE=\\uD800å’ŒMAX_HIGH_SURROGATE=\\uDBFFï¼Œæ³¨æ˜äº†é«˜ä½ä»£ç†ç ç‚¹çš„å€¼è¾¹ç•Œã€‚ Character.isLowSurrogateï¼šæ˜¯å¦ä¸ºä½ä½ä»£ç†ç ç‚¹ public static boolean isLowSurrogate(char ch) { return ch >= MIN_LOW_SURROGATE &amp;&amp; ch &lt; (MAX_LOW_SURROGATE + 1); } å…¶ä¸­MIN_HIGH_SURROGATE=\\uDC00å’ŒMAX_HIGH_SURROGATE=\\uDFFFï¼Œæ³¨æ˜äº†é«˜ä½ä»£ç†ç ç‚¹çš„å€¼è¾¹ç•Œã€‚ è¦åˆ¤æ–­å­—ç¬¦ä¸²å†…æœ‰æ²¡æœ‰ä»£ç†ç ç‚¹ï¼Œåªéœ€ç¡®å®šè¿ç»­çš„ä¸¤ä¸ªç ç‚¹ä¸€ä¸ªæ˜¯é«˜ä½ä»£ç†ç ç‚¹ä¸€ä¸ªæ˜¯ä½ä½ä»£ç†ç ç‚¹å°±è¡Œäº†ã€‚ String.codePointCountä¾èµ–çš„æ–¹æ³•Character.codePointCountImplæºç ï¼š static int codePointCountImpl(char[] a, int offset, int count) { int endIndex = offset + count; int n = count; for (int i = offset; i &lt; endIndex; ) { if (isHighSurrogate(a[i++]) &amp;&amp; i &lt; endIndex &amp;&amp; isLowSurrogate(a[i])) { n--; i++; } } return n; } å¦‚æœè¦éå†ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ï¼Œå¯èƒ½éœ€è¦è€ƒè™‘æ˜¯å¦æœ‰ékmpä¸­çš„å­—ç¬¦çš„æƒ…å†µã€‚é‚£ä¹ˆå°±éœ€è¦ç”¨ç ç‚¹ä¸ºå•ä½æ¥å¤„ç†ï¼š åä¾‹ï¼š æ­£ç¡®å¤„ç†æ–¹å¼ï¼š String.codePoints()å¾—åˆ°ä¸€ä¸ªintç±»å‹çš„æµï¼Œä»£è¡¨è¿™ä¸ªç ç‚¹çš„unicodeç¼–ç ï¼Œç”¨System.out.printf()ä¸­çš„%cæ ¼å¼åŒ–è¾“å‡ºå®ƒï¼Œå°±å¯ä»¥çœ‹åˆ°è¿™ä¸ªå­—ç¬¦ã€‚","categories":[{"name":"è®¡ç®—æœºç›¸å…³","slug":"è®¡ç®—æœºç›¸å…³","permalink":"https://www.codetool.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://www.codetool.top/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}]},{"title":"leetcode200-å²›å±¿æ•°é‡","slug":"leetcode200-å²›å±¿æ•°é‡","date":"2019-11-24T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode200-å²›å±¿æ•°é‡/","link":"","permalink":"https://www.codetool.top/article/leetcode200-%E5%B2%9B%E5%B1%BF%E6%95%B0%E9%87%8F/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªç”± &#39;1&#39;ï¼ˆé™†åœ°ï¼‰å’Œ &#39;0&#39;ï¼ˆæ°´ï¼‰ç»„æˆçš„çš„äºŒç»´ç½‘æ ¼ï¼Œè®¡ç®—å²›å±¿çš„æ•°é‡ã€‚ä¸€ä¸ªå²›è¢«æ°´åŒ…å›´ï¼Œå¹¶ä¸”å®ƒæ˜¯é€šè¿‡æ°´å¹³æ–¹å‘æˆ–å‚ç›´æ–¹å‘ä¸Šç›¸é‚»çš„é™†åœ°è¿æ¥è€Œæˆçš„ã€‚ä½ å¯ä»¥å‡è®¾ç½‘æ ¼çš„å››ä¸ªè¾¹å‡è¢«æ°´åŒ…å›´ã€‚ ç¤ºä¾‹1: è¾“å…¥:11110110101100000000 è¾“å‡º: 1 ç¤ºä¾‹2: è¾“å…¥:11000110000010000011 è¾“å‡º: 3 2 è§£æ³•2.1 æ€æƒ³çº¿æ€§æ‰«ææ•´ä¸ªäºŒç»´ç½‘æ ¼ï¼Œå¦‚æœä¸€ä¸ªç»“ç‚¹åŒ…å« 1ï¼Œåˆ™ä»¥å…¶ä¸ºæ ¹ç»“ç‚¹å¯åŠ¨å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼Œæˆ–æ·±åº¦ä¼˜å…ˆæœç´¢ã€‚æœç´¢åˆ°çš„å€¼è®¾ä¸º 0 ä»¥æ ‡è®°è®¿é—®è¿‡è¯¥ç»“ç‚¹ï¼Œæ¯ç»å†è¿‡ä¸€æ¬¡æœç´¢è¯´æ˜å²›çš„æ•°é‡+1ã€‚ç›´åˆ°æ•´ä¸ªäºŒç»´æ•°ç»„éƒ½å˜æˆ0ã€‚ 2.2 ä»£ç ä¸å«Œéº»çƒ¦çš„å¯ä»¥å»ºä¸€ä¸ªå­˜å‚¨äºŒç»´æ•°ç»„xã€yä½ç½®çš„æ•°æ®ç»“æ„ç±»ã€‚ä¸ç„¶åªèƒ½å­˜å‚¨å…ƒç´ çš„åç§»åœ°å€æ‰‹åŠ¨ç®—xå’Œyã€‚ class Solution { public int numIslands(char[][] grid) { int count = 0; int height = grid.length; if(height==0) return 0; int width = grid[0].length; Queue&lt;Integer> queue = new LinkedList&lt;Integer>(); for(int i = 0;i&lt;height;i++){ for(int j = 0;j&lt;width;j++){ if(grid[i][j]=='1'){ grid[i][j] = '0'; queue.offer(i*width+j); while(!queue.isEmpty()){ int index = queue.poll(); int index_x = index/width; int index_y = index%width; if(index_x!=height-1 &amp;&amp; grid[index_x+1][index_y]=='1'){ queue.offer((index_x+1)*width+index_y); grid[index_x+1][index_y] = '0'; } if(index_x!=0 &amp;&amp; grid[index_x-1][index_y]=='1'){ queue.offer((index_x-1)*width+index_y); grid[index_x-1][index_y] = '0'; } if(index_y!=0 &amp;&amp; grid[index_x][index_y-1]=='1'){ queue.offer(index_x*width+index_y-1); grid[index_x][index_y-1] = '0'; } if(index_y!=width-1 &amp;&amp; grid[index_x][index_y+1]=='1'){ queue.offer(index_x*width+index_y+1); grid[index_x][index_y+1] = '0'; } } count++; } } } return count; } } åœ¨BFSçš„åŸºç¡€ä¸Šæ”¹ä¸€ä¸‹å°±æˆäº†DFSï¼š class Solution { public int numIslands(char[][] grid) { int count = 0; int height = grid.length; if(height==0) return 0; int width = grid[0].length; Stack&lt;Integer> stack = new Stack&lt;>(); for(int i = 0;i&lt;height;i++){ for(int j = 0;j&lt;width;j++){ if(grid[i][j]=='1'){ grid[i][j] = '0'; stack.push(i*width+j); while(!stack.empty()){ int index = stack.peek(); int index_x = index/width; int index_y = index%width; if(index_x!=height-1 &amp;&amp; grid[index_x+1][index_y]=='1'){ stack.push((index_x+1)*width+index_y); grid[index_x+1][index_y] = '0'; continue; } if(index_x!=0 &amp;&amp; grid[index_x-1][index_y]=='1'){ stack.push((index_x-1)*width+index_y); grid[index_x-1][index_y] = '0'; continue; } if(index_y!=0 &amp;&amp; grid[index_x][index_y-1]=='1'){ stack.push(index_x*width+index_y-1); grid[index_x][index_y-1] = '0'; continue; } if(index_y!=width-1 &amp;&amp; grid[index_x][index_y+1]=='1'){ stack.push(index_x*width+index_y+1); grid[index_x][index_y+1] = '0'; continue; }else{ stack.pop(); } } count++; } } } return count; } } å½“ç„¶DFSè¿˜å¯ä»¥ç”¨é€’å½’çš„ç³»ç»Ÿè°ƒç”¨æ ˆï¼šï¼ˆä½œè€…ï¼šLeetCodeï¼‰ class Solution { void dfs(char[][] grid, int r, int c) { int nr = grid.length; int nc = grid[0].length; if (r &lt; 0 || c &lt; 0 || r >= nr || c >= nc || grid[r][c] == '0') { return; } grid[r][c] = '0'; dfs(grid, r - 1, c); dfs(grid, r + 1, c); dfs(grid, r, c - 1); dfs(grid, r, c + 1); } public int numIslands(char[][] grid) { if (grid == null || grid.length == 0) { return 0; } int nr = grid.length; int nc = grid[0].length; int num_islands = 0; for (int r = 0; r &lt; nr; ++r) { for (int c = 0; c &lt; nc; ++c) { if (grid[r][c] == '1') { ++num_islands; dfs(grid, r, c); } } } return num_islands; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode622-è®¾è®¡å¾ªç¯é˜Ÿåˆ—","slug":"leetcode622-è®¾è®¡å¾ªç¯é˜Ÿåˆ—","date":"2019-11-24T10:05:23.000Z","updated":"2020-02-20T14:42:31.679Z","comments":true,"path":"article/leetcode622-è®¾è®¡å¾ªç¯é˜Ÿåˆ—/","link":"","permalink":"https://www.codetool.top/article/leetcode622-%E8%AE%BE%E8%AE%A1%E5%BE%AA%E7%8E%AF%E9%98%9F%E5%88%97/","excerpt":"","text":"è®¾è®¡ä½ çš„å¾ªç¯é˜Ÿåˆ—å®ç°ã€‚ å¾ªç¯é˜Ÿåˆ—æ˜¯ä¸€ç§çº¿æ€§æ•°æ®ç»“æ„ï¼Œå…¶æ“ä½œè¡¨ç°åŸºäº FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰åŸåˆ™å¹¶ä¸”é˜Ÿå°¾è¢«è¿æ¥åœ¨é˜Ÿé¦–ä¹‹åä»¥å½¢æˆä¸€ä¸ªå¾ªç¯ã€‚å®ƒä¹Ÿè¢«ç§°ä¸ºâ€œç¯å½¢ç¼“å†²å™¨â€ã€‚ å¾ªç¯é˜Ÿåˆ—çš„ä¸€ä¸ªå¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªé˜Ÿåˆ—ä¹‹å‰ç”¨è¿‡çš„ç©ºé—´ã€‚åœ¨ä¸€ä¸ªæ™®é€šé˜Ÿåˆ—é‡Œï¼Œä¸€æ—¦ä¸€ä¸ªé˜Ÿåˆ—æ»¡äº†ï¼Œæˆ‘ä»¬å°±ä¸èƒ½æ’å…¥ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå³ä½¿åœ¨é˜Ÿåˆ—å‰é¢ä»æœ‰ç©ºé—´ã€‚ä½†æ˜¯ä½¿ç”¨å¾ªç¯é˜Ÿåˆ—ï¼Œæˆ‘ä»¬èƒ½ä½¿ç”¨è¿™äº›ç©ºé—´å»å­˜å‚¨æ–°çš„å€¼ã€‚ ä½ çš„å®ç°åº”è¯¥æ”¯æŒå¦‚ä¸‹æ“ä½œï¼š MyCircularQueue(k): æ„é€ å™¨ï¼Œè®¾ç½®é˜Ÿåˆ—é•¿åº¦ä¸º k ã€‚ Front: ä»é˜Ÿé¦–è·å–å…ƒç´ ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œè¿”å› -1 ã€‚ Rear: è·å–é˜Ÿå°¾å…ƒç´ ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œè¿”å› -1 ã€‚ enQueue(value): å‘å¾ªç¯é˜Ÿåˆ—æ’å…¥ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœæˆåŠŸæ’å…¥åˆ™è¿”å›çœŸã€‚ deQueue(): ä»å¾ªç¯é˜Ÿåˆ—ä¸­åˆ é™¤ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœæˆåŠŸåˆ é™¤åˆ™è¿”å›çœŸã€‚ isEmpty(): æ£€æŸ¥å¾ªç¯é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºã€‚ isFull(): æ£€æŸ¥å¾ªç¯é˜Ÿåˆ—æ˜¯å¦å·²æ»¡ã€‚ ç¤ºä¾‹: MyCircularQueue circularQueue = new MycircularQueue(3); // è®¾ç½®é•¿åº¦ä¸º 3 circularQueue.enQueue(1); // è¿”å› true circularQueue.enQueue(2); // è¿”å› true circularQueue.enQueue(3); // è¿”å› true circularQueue.enQueue(4); // è¿”å› falseï¼Œé˜Ÿåˆ—å·²æ»¡ circularQueue.Rear(); // è¿”å› 3 circularQueue.isFull(); // è¿”å› true circularQueue.deQueue(); // è¿”å› true circularQueue.enQueue(4); // è¿”å› true circularQueue.Rear(); // è¿”å› 4 æç¤º: æ‰€æœ‰çš„å€¼éƒ½åœ¨ 0 è‡³ 1000 çš„èŒƒå›´å†…ï¼› æ“ä½œæ•°å°†åœ¨ 1 è‡³ 1000 çš„èŒƒå›´å†…ï¼› è¯·ä¸è¦ä½¿ç”¨å†…ç½®çš„é˜Ÿåˆ—åº“ã€‚ 1 è§£æ³•1.1 æ€æƒ³æ ¹æ®å¾ªç¯é˜Ÿåˆ—çš„å®šä¹‰æ¥å®ç°ï¼Œç†è§£headæŒ‡é’ˆå’ŒtailæŒ‡é’ˆæŒ‡å‘çš„ä½ç½®ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼šæ·»åŠ å…ƒç´ ï¼Œtail++ã€‚åˆ é™¤å…ƒç´ ï¼Œhead++ã€‚å½“tailæˆ–headå¤„äºæ•°ç»„çš„æœ€æœ«ç«¯çš„æ—¶å€™ï¼šæ“ä½œä¹‹ååº”è¯¥æŒ‡å‘ä¸‹æ ‡0ã€‚å½“æ•°ç»„ä¸ºç©ºï¼šä¸èƒ½ç§»é™¤å…ƒç´ ã€‚å½“æ•°ç»„æ»¡äº†ï¼šä¸èƒ½æ·»åŠ å…ƒç´ ã€‚ 1.2 ä»£ç class MyCircularQueue { int[] queue; int head; int tail; int size; /** Initialize your data structure here. Set the size of the queue to be k. */ public MyCircularQueue(int k) { queue = new int[k]; size = 0; head = -1; tail = -1; } /** Insert an element into the circular queue. Return true if the operation is successful. */ public boolean enQueue(int value) { if(isFull()) return false; if(tail == queue.length-1) { tail = 0; queue[0] = value; } else queue[++tail] = value; size++; if(head==-1) head = 0; return true; } /** Delete an element from the circular queue. Return true if the operation is successful. */ public boolean deQueue() { if(isEmpty()) return false; if(size==1){ tail = -1; head = -1; }else if(head == queue.length-1){ head = 0; }else{ head++; } size--; return true; } /** Get the front item from the queue. */ public int Front() { if(head==-1) return -1; return queue[head]; } /** Get the last item from the queue. */ public int Rear() { if(tail==-1) return -1; return queue[tail]; } /** Checks whether the circular queue is empty or not. */ public boolean isEmpty() { return size == 0; } /** Checks whether the circular queue is full or not. */ public boolean isFull() { return size == queue.length; } } /** * Your MyCircularQueue object will be instantiated and called as such: * MyCircularQueue obj = new MyCircularQueue(k); * boolean param_1 = obj.enQueue(value); * boolean param_2 = obj.deQueue(); * int param_3 = obj.Front(); * int param_4 = obj.Rear(); * boolean param_5 = obj.isEmpty(); * boolean param_6 = obj.isFull(); */","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"}]},{"title":"leetcode26-åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹","slug":"leetcode26-åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹","date":"2019-11-23T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode26-åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹/","link":"","permalink":"https://www.codetool.top/article/leetcode26-%E5%88%A0%E9%99%A4%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ’åºæ•°ç»„ï¼Œä½ éœ€è¦åœ¨åŸåœ°åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿å¾—æ¯ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ï¼Œè¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚ ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„å¹¶åœ¨ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚ ç¤ºä¾‹ 1: ç»™å®šæ•°ç»„ nums = [1,1,2],å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 2, å¹¶ä¸”åŸæ•°ç»„ nums çš„å‰ä¸¤ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 1, 2ã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚ ç¤ºä¾‹ 2: ç»™å®š nums = [0,0,1,1,1,2,2,3,3,4],å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 5, å¹¶ä¸”åŸæ•°ç»„ nums çš„å‰äº”ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 0, 1, 2, 3, 4ã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚ è¯´æ˜: ä¸ºä»€ä¹ˆè¿”å›æ•°å€¼æ˜¯æ•´æ•°ï¼Œä½†è¾“å‡ºçš„ç­”æ¡ˆæ˜¯æ•°ç»„å‘¢? è¯·æ³¨æ„ï¼Œè¾“å…¥æ•°ç»„æ˜¯ä»¥â€œå¼•ç”¨â€æ–¹å¼ä¼ é€’çš„ï¼Œè¿™æ„å‘³ç€åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚ ä½ å¯ä»¥æƒ³è±¡å†…éƒ¨æ“ä½œå¦‚ä¸‹: // nums æ˜¯ä»¥â€œå¼•ç”¨â€æ–¹å¼ä¼ é€’çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯¹å®å‚åšä»»ä½•æ‹·è´int len = removeDuplicates(nums); // åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚// æ ¹æ®ä½ çš„å‡½æ•°è¿”å›çš„é•¿åº¦, å®ƒä¼šæ‰“å°å‡ºæ•°ç»„ä¸­è¯¥é•¿åº¦èŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ ã€‚for (int i = 0; i &lt; len; i++) {print(nums[i]);} 2 è§£æ³•2.1 æ€æƒ³åŒæŒ‡é’ˆè§£æ³•ï¼Œiå§‹ç»ˆåœç•™åœ¨ç¬¬ä¸€ä¸ªå‡ºç°çš„é‡å¤å…ƒç´ ä¸Šï¼Œjä¸€æ—¦é‡åˆ°ä¸é‡å¤çš„å…ƒç´ ï¼Œi++ï¼Œç„¶åå°†ä¸é‡å¤çš„å…ƒç´ èµ‹ç»™nums[i]ã€‚ 2.2 ä»£ç class Solution { public int removeDuplicates(int[] nums) { int i = 0; int j = 0; int count = 0; while(j&lt;nums.length-1){ j++; if(nums[j]!=nums[i]) nums[++i] = nums[j]; } return i+1; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode283-ç§»åŠ¨é›¶","slug":"leetcode283-ç§»åŠ¨é›¶","date":"2019-11-23T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode283-ç§»åŠ¨é›¶/","link":"","permalink":"https://www.codetool.top/article/leetcode283-%E7%A7%BB%E5%8A%A8%E9%9B%B6/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ•°ç»„ numsï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°å°†æ‰€æœ‰ 0 ç§»åŠ¨åˆ°æ•°ç»„çš„æœ«å°¾ï¼ŒåŒæ—¶ä¿æŒéé›¶å…ƒç´ çš„ç›¸å¯¹é¡ºåºã€‚ ç¤ºä¾‹: è¾“å…¥: [0,1,0,3,12]è¾“å‡º: [1,3,12,0,0] è¯´æ˜: å¿…é¡»åœ¨åŸæ•°ç»„ä¸Šæ“ä½œï¼Œä¸èƒ½æ‹·è´é¢å¤–çš„æ•°ç»„ã€‚ å°½é‡å‡å°‘æ“ä½œæ¬¡æ•°ã€‚ 2 è§£æ³•2.1 æ€æƒ³åŒæŒ‡é’ˆè§£æ³•ï¼Œiå§‹ç»ˆä¸ç»è¿‡0ï¼Œå¦‚æœjéå†åˆ°äº†é0å…ƒç´ ï¼Œi++ï¼Œå¹¶æŠŠé0å…ƒç´ èµ‹å€¼ç»™iã€‚ 2.2 ä»£ç class Solution { public void moveZeroes(int[] nums) { int i=0; for(int j=0;j&lt;nums.length;j++){ if (nums[j]!=0) { nums[i++]=nums[j]; } } for (int j=i;j&lt;nums.length;j++){ nums[j]=0; } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode557-åè½¬å­—ç¬¦ä¸²ä¸­çš„å•è¯III","slug":"leetcode557-åè½¬å­—ç¬¦ä¸²ä¸­çš„å•è¯III","date":"2019-11-23T10:05:23.000Z","updated":"2020-02-20T14:42:31.679Z","comments":true,"path":"article/leetcode557-åè½¬å­—ç¬¦ä¸²ä¸­çš„å•è¯III/","link":"","permalink":"https://www.codetool.top/article/leetcode557-%E5%8F%8D%E8%BD%AC%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%9A%84%E5%8D%95%E8%AF%8DIII/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½ éœ€è¦åè½¬å­—ç¬¦ä¸²ä¸­æ¯ä¸ªå•è¯çš„å­—ç¬¦é¡ºåºï¼ŒåŒæ—¶ä»ä¿ç•™ç©ºæ ¼å’Œå•è¯çš„åˆå§‹é¡ºåºã€‚ ç¤ºä¾‹1: è¾“å…¥: â€œLetâ€™s take LeetCode contestâ€è¾“å‡º: â€œsâ€™teL ekat edoCteeL tsetnocâ€ æ³¨æ„ï¼š åœ¨å­—ç¬¦ä¸²ä¸­ï¼Œæ¯ä¸ªå•è¯ç”±å•ä¸ªç©ºæ ¼åˆ†éš”ï¼Œå¹¶ä¸”å­—ç¬¦ä¸²ä¸­ä¸ä¼šæœ‰ä»»ä½•é¢å¤–çš„ç©ºæ ¼ã€‚ 2 è§£æ³•2.1 æ€æƒ³ç¿»è½¬å­—ç¬¦ä¸²å¯ä»¥ç”¨StringBufferçš„reverseæ–¹æ³•ã€‚ 2.2 ä»£ç class Solution { public String reverseWords(String s) { String[] words = s.split(\" \"); StringBuilder sb = new StringBuilder(); for(String word:words){ sb.append(new StringBuffer(word).reverse().toString()); sb.append(\" \"); } return sb.toString().trim(); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"ArrayListæºç åˆ†æ","slug":"ArrayListæºç åˆ†æ","date":"2019-11-22T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/ArrayListæºç åˆ†æ/","link":"","permalink":"https://www.codetool.top/article/ArrayList%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","excerpt":"","text":"1 æ€»ç»“æ€»ç»“æ”¾å‰é¢é˜²æ­¢å¤ªé•¿ä¸çœ‹ï¼š ArrayListå†…éƒ¨æ˜¯ç”¨æ•°ç»„å®ç°çš„ã€‚ å¦‚æœä½¿ç”¨æ— å‚æ„é€ å‡½æ•°å»ºç«‹ArrayListï¼Œåœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ä¼šåˆ†é…10ä¸ªå…ƒç´ çš„ç©ºé—´ã€‚ ArrayListçš„æ‰©å®¹æ˜¯ä»¥1.5å€ä¸ºåŸºå‡†çš„ã€‚ ArrayListæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œæœ‰fail-fastæœºåˆ¶ä½œæ”¹åŠ¨ä¿éšœã€‚ 2 å±‚æ¬¡å›¾ArrayListçš„Hierarchyï¼š å…ˆæ¥çœ‹çœ‹Listæ¥å£ï¼š 3 Listæ¥å£Listä»£è¡¨æœ‰åºé›†åˆï¼Œå…ƒç´ å¯ä»¥é‡å¤ã€‚ Listå®¶æ—ä¸€è§ˆï¼š é»˜è®¤å®ç°æ–¹æ³•ï¼š 3.1 default void replaceAll(UnaryOperator operator);ä»¥æŒ‡å®šçš„æ–¹æ³•æ›¿æ¢Listä¸­çš„æ‰€æœ‰å…ƒç´ ï¼ŒUnaryOperatoræ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œè¾“å…¥ä¸€ä¸ªç±»å‹å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªåŒç±»å‹å¯¹è±¡ã€‚ default void replaceAll(UnaryOperator&lt;E> operator) { Objects.requireNonNull(operator); final ListIterator&lt;E> li = this.listIterator(); while (li.hasNext()) { li.set(operator.apply(li.next())); } } ç¤ºä¾‹ï¼š List&lt;Integer> list = new ArrayList&lt;Integer>(); list.add(1); list.add(3); list.add(5); list.replaceAll(a->a+1); //list = [2,4,6] 3.2 default void sort(Comparator&lt;? super E&gt; c);æ ¹æ®æ’åºæ–¹æ³•æ’åºã€‚è¿˜æ˜¯å…ˆè½¬ä¸ºäº†Arrayå†ä½¿ç”¨Arraysçš„sortæ–¹æ³•è¿›è¡Œæ’åºã€‚ default void sort(Comparator&lt;? super E> c) { Object[] a = this.toArray(); Arrays.sort(a, (Comparator) c); ListIterator&lt;E> i = this.listIterator(); for (Object e : a) { i.next(); i.set((E) e); } } 4 AbstractListæ¥å£AbstractListæ¥å£ç»§æ‰¿è‡ªAbstractCollectionï¼Œä¸ºä»€ä¹ˆè¦æå®ƒå‘¢ï¼Œå› ä¸ºé‡Œé¢æœ‰ä¸ªé‡è¦çš„å­—æ®µmodCountï¼Œç”¨äºè¿­ä»£å™¨éå†å…ƒç´ æ—¶æ£€æŸ¥åˆ—è¡¨ä¸­çš„å…ƒç´ æ˜¯å¦å‘ç”Ÿç»“æ„æ€§å˜åŒ–ã€‚ å‚è€ƒä¸‹é¢â€œé‡è¦çš„å†…éƒ¨ç±»â€ä¸­è¿­ä»£å™¨é‡Œnextæ–¹æ³•çš„å®ç°ã€‚ 5 é‡è¦çš„å­—æ®µtransient Object[] elementData;ArrayListçš„å…ƒç´ å­˜å‚¨åœ¨è¿™ä¸ªæ•°ç»„ä¸­ã€‚ private int size;è®°å½•ç©ºé—´å¤§å°ã€‚ 6 é‡è¦çš„å†…éƒ¨ç±»Itrå®ç°äº†è¿­ä»£å™¨Iteratorï¼ŒListItrå®ç°äº†é›†åˆè¿­ä»£å™¨ListIterator ä¸¤è€…çš„ä»‹ç»ï¼š è°ˆè°ˆjavaä¸­çš„Iterator nextçš„å®ç°ï¼š public E next() { checkForComodification(); int i = cursor; if (i >= size) throw new NoSuchElementException(); Object[] elementData = ArrayList.this.elementData; if (i >= elementData.length) throw new ConcurrentModificationException(); cursor = i + 1; return (E) elementData[lastRet = i]; }jav å…¶ä¸­çš„checkForComodification()ï¼š final void checkForComodification() { if (modCount != expectedModCount) throw new ConcurrentModificationException(); } modCountåœ¨ArrayListæ¯æ¬¡addæˆ–è€…removeå®ƒçš„å€¼éƒ½ä¼šåŠ 1ã€‚åœ¨åˆå§‹åŒ–è¿­ä»£å™¨çš„æ—¶å€™ï¼Œä»¤expectedModCount = modCountï¼Œåœ¨è¿­ä»£å™¨è¿­ä»£çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœmodCountè¢«æ”¹å˜äº†ï¼Œå°±ä¼šé€ æˆexpectedModCountä¸ç­‰äºmodCountï¼ŒæŠ›å‡ºConcurrentModificationExceptionè­¦å‘Šã€‚ æ¯”å¦‚ä¸‹é¢è¿™æ®µç¨‹åºå°±ä¼šæŠ›å‡ºè­¦å‘Šï¼š ä¸ºä»€ä¹ˆåœ¨è¿­ä»£å™¨å¾ªç¯çš„æ—¶å€™ä¸è®©ä½¿ç”¨list.removeä¿®æ”¹å…ƒç´ å‘¢ï¼Ÿ æœ‰å¤šçº¿ç¨‹ä¸‹è¢«å½±å“çš„è€ƒè™‘ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå¼ºåˆ¶äº†åœ¨è¿­ä»£å™¨è¿­ä»£çš„æ—¶å€™åªèƒ½ä½¿ç”¨iterator.removeç§»é™¤å…ƒç´ . æ¯”å¦‚ä¸Šé¢è¿™æ®µç¨‹åºåº”è¯¥æ”¹æˆï¼š 7 æ„é€ æ–¹æ³•å·²çŸ¥ArrayListçš„å…ƒç´ æ˜¯å­˜æ”¾äºä¸€ä¸ªæ•°ç»„ä¸­ï¼Œé‚£ä¹ˆåœ¨åˆå§‹åŒ–ä¸€ä¸ªArrayListå¯¹è±¡çš„æ—¶å€™ä¼šåˆ†é…ä¸€ä¸ªå¤šå¤§çš„æ•°ç»„ï¼Ÿ å…ˆçœ‹ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼š public ArrayList() { this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;} å…¶ä¸­å¸¸é‡DEFAULTCAPACITY_EMPTY_ELEMENTDATAæ˜¯ä¸€ä¸ªç©ºæ•°ç»„ï¼š private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {}; public ArrayList(int initialCapacity) { if (initialCapacity > 0) { this.elementData = new Object[initialCapacity]; } else if (initialCapacity == 0) { this.elementData = EMPTY_ELEMENTDATA; } else { throw new IllegalArgumentException(\"Illegal Capacity: \"+ initialCapacity); } } ä½¿ç”¨ä¸€ä¸ªåˆå§‹å®¹é‡åˆå§‹åŒ–ArrayListã€‚å¦‚æœä¼ å…¥çš„å‚æ•°å¤§äº0ï¼Œåˆ™åˆ†é…ä¸€ä¸ªè¿™ä¹ˆå¤§çš„æ•°ç»„ã€‚æ³¨æ„åˆ°å¦‚æœè¿™é‡Œçš„initialCapacityç­‰äº0ï¼Œä»¤å…¶ç­‰äºå¸¸é‡EMPTY_ELEMENTDATAä¹Ÿæ˜¯ä¸€ä¸ªç©ºæ•°ç»„ã€‚ é‚£ä¸ºä»€ä¹ˆè¦åŒºåˆ†EMPTY_ELEMENTDATAå’ŒDEFAULTCAPACITY_EMPTY_ELEMENTDATAå‘¢ï¼Ÿ å› ä¸ºä»–ä»¬æ˜¯ä¸¤ä¸ªä¸åŒå¯¹è±¡çš„å¼•ç”¨ï¼ŒArrayListé€šè¿‡è¿™ä¸ªåŒºåˆ†å½“å‰å¯¹è±¡æ˜¯ç”¨æ— å‚æ„é€ æ–¹æ³•åˆ›å»ºçš„è¿˜æ˜¯ç”±ArrayList(0)è¿™æ ·ä¸€ä¸ªæ„é€ æ–¹æ³•åˆ›å»ºçš„ åœ¨åæ–‡â€œé‡è¦çš„å†…éƒ¨æ–¹æ³•â€ä¸­çš„calculateCapacityæ–¹æ³•ï¼Œå½“ç¬¬ä¸€ä¸ªå…ƒç´ è¢«åŠ è¿›æ¥çš„æ—¶å€™å°±èƒ½çŸ¥é“åº”è¯¥æ‰©å®¹å¤šå°‘ã€‚ 8 é‡è¦çš„å†…éƒ¨æ–¹æ³•8.1 ç©ºé—´åˆ†é…ç›¸å…³8.1.1 private static int calculateCapacity(Object[] elementData, int minCapacity);private static int calculateCapacity(Object[] elementData, int minCapacity) { if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) { return Math.max(DEFAULT_CAPACITY, minCapacity); } return minCapacity; } è¿™ä¸ªæ–¹æ³•ç”¨äºè®¡ç®—ï¼š å½“åŸæ¥æ•°ç»„ä¸ºç©ºï¼Œç¬¬ä¸€æ¬¡æ’å…¥å…ƒç´ çš„æ—¶å€™ï¼Œæ•°ç»„åº”è¯¥åˆ†é…å¤šå°‘ç©ºé—´ï¼ŒDEFAULTCAPACITY_EMPTY_ELEMENTDATAå‘¼åº”äº†ä¸Šé¢æ„é€ æ–¹æ³•ä¸­çš„æ— å‚æ„é€ æ–¹æ³•ï¼Œå¸¸é‡DEFAULT_CAPACITY=10ã€‚ è¿™è¯´æ˜ï¼šå¦‚æœArrayListæ˜¯ä»¥æ— å‚æ„é€ æ–¹æ³•å»ºç«‹çš„ï¼Œåœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶ä¼šç›´æ¥åˆ†é…10ä¸ªå…ƒç´ çš„ç©ºé—´ã€‚ 8.1.2 private void grow(int minCapacity);private void grow(int minCapacity) { // overflow-conscious code int oldCapacity = elementData.length; //å³newCapacity = 1.5*oldCapacity int newCapacity = oldCapacity + (oldCapacity >> 1); if (newCapacity - minCapacity &lt; 0) newCapacity = minCapacity; if (newCapacity - MAX_ARRAY_SIZE > 0) newCapacity = hugeCapacity(minCapacity); // minCapacity is usually close to size, so this is a win: elementData = Arrays.copyOf(elementData, newCapacity); } å¯ä»¥çœ‹å‡ºæ•°ç»„æ˜¯ä»¥1.5å€ä¸ºåŸºå‡†æ‰©å®¹çš„ï¼Œå¦‚æœ1.5å€åå¤§äºMAX_ARRAY_SIZE (Integer.MAX_VALUE - 8)ï¼Œåˆ™ä½¿ç”¨hugeCapacity(minCapacity)ç¡®è®¤ï¼ˆsizeæ˜¯intç±»å‹ï¼Œä¸èƒ½è¶…è¿‡intèŒƒå›´çš„æœ€å¤§å€¼ï¼‰ã€‚ 8.2 å…ƒç´ è·å–ã€å¢æ”¹ç›¸å…³8.2.1 E elementData(int index);E elementData(int index) { return (E) elementData[index]; } å–å…ƒç´ ,å°±æ˜¯ä»æ•°ç»„ä¸­è·å–å…ƒç´ ï¼Œæ˜¯getç­‰æ–¹æ³•çš„ä¾èµ–ã€‚ 8.2.2 private void rangeCheck(int index);private void rangeCheck(int index) { if (index >= size) throw new IndexOutOfBoundsException(outOfBoundsMsg(index)); } è¾¹ç•Œæ£€æŸ¥ã€‚ rangeCheckæ–¹æ³•æ˜¯æä¾›ç»™get,removeï¼Œsetä¹‹ç±»çš„æ–¹æ³•æ£€æŸ¥çš„,æ˜¯ç»™å·²ç»å­˜åœ¨å…ƒç´ çš„é›†åˆæ“ä½œçš„ï¼ŒèŒƒå›´0è‡³size-1,è¿™ä¸ªæ–¹æ³•æŠŠæ£€æŸ¥è´Ÿè´£çš„èŒè´£äº¤ç»™äº†æ•°ç»„çš„è®¿é—®,åƒget(-1)æ—¶ä¼šæŠ¥å¼‚å¸¸ArrayIndexOutOfBoundsExceptionã€‚ 8.2.3 private void rangeCheckForAdd(int index);private void rangeCheckForAdd(int index) { if (index > size || index &lt; 0) throw new IndexOutOfBoundsException(outOfBoundsMsg(index)); } è¿™ä¸ªæ–¹æ³•æ˜¯æä¾›ç»™addå’ŒaddAllçš„ï¼Œä¼šæ£€æŸ¥è´Ÿæ•°ã€‚å› ä¸ºå¦‚æœæ‰©å®¹äº†æ•°ç»„å†æŠ›å‡ºå¼‚å¸¸å°±ç™½æ‰©å®¹äº†ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jdk","slug":"jdk","permalink":"https://www.codetool.top/tags/jdk/"},{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://www.codetool.top/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"}]},{"title":"leetcode119-æ¨è¾‰ä¸‰è§’II","slug":"leetcode119-æ¨è¾‰ä¸‰è§’II","date":"2019-11-22T10:05:23.000Z","updated":"2020-02-20T14:42:31.679Z","comments":true,"path":"article/leetcode119-æ¨è¾‰ä¸‰è§’II/","link":"","permalink":"https://www.codetool.top/article/leetcode119-%E6%9D%A8%E8%BE%89%E4%B8%89%E8%A7%92II/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªéè´Ÿç´¢å¼• kï¼Œå…¶ä¸­ k â‰¤ 33ï¼Œè¿”å›æ¨è¾‰ä¸‰è§’çš„ç¬¬ k è¡Œã€‚åœ¨æ¨è¾‰ä¸‰è§’ä¸­ï¼Œæ¯ä¸ªæ•°æ˜¯å®ƒå·¦ä¸Šæ–¹å’Œå³ä¸Šæ–¹çš„æ•°çš„å’Œã€‚ ç¤ºä¾‹: è¾“å…¥: 3è¾“å‡º: [1,3,3,1] è¿›é˜¶ï¼š ä½ å¯ä»¥ä¼˜åŒ–ä½ çš„ç®—æ³•åˆ° O(k) ç©ºé—´å¤æ‚åº¦å—ï¼Ÿ 2 è§£æ³•2.1 æ€æƒ³å¯ä»¥åˆ©ç”¨leetcode118-æ¨è¾‰ä¸‰è§’ä¸­çš„å‡½æ•°æ¥è§£å†³ã€‚ 2.2 ä»£ç class Solution { public List&lt;Integer> getRow(int rowIndex) { List&lt;Integer> list = new ArrayList(); list.add(1); if(rowIndex == 0) return list; return getRowByPrev(rowIndex,getRow(rowIndex-1)); } //é€šè¿‡ä¸Šä¸€è¡Œè®¡ç®—ç¬¬nè¡Œ public List&lt;Integer> getRowByPrev(int n,List&lt;Integer> nums){ List&lt;Integer> ret = new ArrayList(); ret.add(1); for(int i=1;i&lt;(n+2)/2;i++){ ret.add(nums.get(i-1)+nums.get(i)); } int size = (n+1)/2; for(int i=0;i&lt;size;i++){ ret.add(ret.get(size-i-1)); } return ret; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode151-ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯","slug":"leetcode151-ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯","date":"2019-11-22T10:05:23.000Z","updated":"2020-02-20T14:42:31.680Z","comments":true,"path":"article/leetcode151-ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯/","link":"","permalink":"https://www.codetool.top/article/leetcode151-%E7%BF%BB%E8%BD%AC%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%87%8C%E7%9A%84%E5%8D%95%E8%AF%8D/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€ä¸ªç¿»è½¬å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå•è¯ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: â€œthe sky is blueâ€è¾“å‡º: â€œblue is sky theâ€ ç¤ºä¾‹ 2: è¾“å…¥: â€œ hello world! â€è¾“å‡º: â€œworld! helloâ€è§£é‡Š: è¾“å…¥å­—ç¬¦ä¸²å¯ä»¥åœ¨å‰é¢æˆ–è€…åé¢åŒ…å«å¤šä½™çš„ç©ºæ ¼ï¼Œä½†æ˜¯åè½¬åçš„å­—ç¬¦ä¸èƒ½åŒ…æ‹¬ã€‚ ç¤ºä¾‹ 3: è¾“å…¥: â€œa good exampleâ€è¾“å‡º: â€œexample good aâ€è§£é‡Š: å¦‚æœä¸¤ä¸ªå•è¯é—´æœ‰å¤šä½™çš„ç©ºæ ¼ï¼Œå°†åè½¬åå•è¯é—´çš„ç©ºæ ¼å‡å°‘åˆ°åªå«ä¸€ä¸ªã€‚ è¯´æ˜: æ— ç©ºæ ¼å­—ç¬¦æ„æˆä¸€ä¸ªå•è¯ã€‚ è¾“å…¥å­—ç¬¦ä¸²å¯ä»¥åœ¨å‰é¢æˆ–è€…åé¢åŒ…å«å¤šä½™çš„ç©ºæ ¼ï¼Œä½†æ˜¯åè½¬åçš„å­—ç¬¦ä¸èƒ½åŒ…æ‹¬ã€‚ å¦‚æœä¸¤ä¸ªå•è¯é—´æœ‰å¤šä½™çš„ç©ºæ ¼ï¼Œå°†åè½¬åå•è¯é—´çš„ç©ºæ ¼å‡å°‘åˆ°åªå«ä¸€ä¸ªã€‚ 2 è§£æ³•2.1 æ€æƒ³ç›´æ¥ä½¿ç”¨jdkä¸­Stringçš„trim()å’Œsplit()æ–¹æ³•å¾—åˆ°å•è¯çš„æ•°ç»„ï¼Œæˆ–è€…éå†å­—ç¬¦ä¸²å­—ç¬¦ï¼Œè®°å½•å•è¯æ•°ç»„ã€‚å†åå‘éå†è¾“å‡ºã€‚ 2.2 ä»£ç class Solution { public String reverseWords(String s) { //\"\\\\s+\"ä»£è¡¨æ­£åˆ™è¡¨è¾¾å¼1ä¸ªæˆ–å¤šä¸ªç©ºç™½å­—ç¬¦ String[] words = s.trim().split(\"\\\\s+\"); int size = words.length; StringBuilder str = new StringBuilder(); for(int i = 0;i&lt;size;i++){ str.append(words[size-1-i]); if(i!=size-1) str.append(\" \"); } return str.toString(); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode189-æ—‹è½¬æ•°ç»„","slug":"leetcode189-æ—‹è½¬æ•°ç»„","date":"2019-11-22T10:05:23.000Z","updated":"2020-02-20T14:42:31.679Z","comments":true,"path":"article/leetcode189-æ—‹è½¬æ•°ç»„/","link":"","permalink":"https://www.codetool.top/article/leetcode189-%E6%97%8B%E8%BD%AC%E6%95%B0%E7%BB%84/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå°†æ•°ç»„ä¸­çš„å…ƒç´ å‘å³ç§»åŠ¨ k ä¸ªä½ç½®ï¼Œå…¶ä¸­ k æ˜¯éè´Ÿæ•°ã€‚ ç¤ºä¾‹1: è¾“å…¥: [1,2,3,4,5,6,7] å’Œ k = 3è¾“å‡º: [5,6,7,1,2,3,4]è§£é‡Š:å‘å³æ—‹è½¬ 1 æ­¥: [7,1,2,3,4,5,6]å‘å³æ—‹è½¬ 2 æ­¥: [6,7,1,2,3,4,5]å‘å³æ—‹è½¬ 3 æ­¥: [5,6,7,1,2,3,4] ç¤ºä¾‹2: è¾“å…¥: [-1,-100,3,99] å’Œ k = 2è¾“å‡º: [3,99,-1,-100]è§£é‡Š:å‘å³æ—‹è½¬ 1 æ­¥: [99,-1,-100,3]å‘å³æ—‹è½¬ 2 æ­¥: [3,99,-1,-100] è¯´æ˜: å°½å¯èƒ½æƒ³å‡ºæ›´å¤šçš„è§£å†³æ–¹æ¡ˆï¼Œè‡³å°‘æœ‰ä¸‰ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ è¦æ±‚ä½¿ç”¨ç©ºé—´å¤æ‚åº¦ä¸º O(1) çš„ åŸåœ° ç®—æ³•ã€‚ 2 è§£æ³•2.1 æ€æƒ³å°†æ—‹è½¬ç‚¹å‰åçš„éƒ¨åˆ†äº¤æ¢ã€‚æ³¨æ„å½“kå¤§äºæ•°ç»„å¤§å°sizeçš„æƒ…å†µç›¸å½“äºk=k%sizeçš„æƒ…å†µ 2.2 ä»£ç class Solution { public void rotate(int[] nums, int k) { int size = nums.length; if(k==size) return; //kå¤§äºsizeçš„æƒ…å†µ if(k>size) k = k%size; //ç”¨å¦ä¸€ä¸ªæ•°ç»„æš‚æ—¶å­˜æ”¾ç»“æœ int[] rotate = new int[size]; //å°†æ—‹è½¬ç‚¹åé¢çš„éƒ¨åˆ†ç§»åˆ°æ–°æ•°ç»„å‰é¢æ¥ for(int i = 0;i&lt;k;i++){ rotate[i] = nums[size-k+i]; } //å°†æ—‹è½¬ç‚¹å‰é¢çš„éƒ¨åˆ†ç§»åˆ°æ–°æ•°ç»„åé¢å» for(int i = k;i&lt;size;i++){ rotate[i] = nums[i-k]; } //å°†æ–°æ•°ç»„ä¸­çš„å€¼èµ‹å€¼å›åŸæ•°ç»„ for(int i = 0;i&lt;size;i++){ nums[i] = rotate[i]; } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode167-ä¸¤æ•°ä¹‹å’ŒII-è¾“å…¥æœ‰åºæ•°ç»„","slug":"leetcode167-ä¸¤æ•°ä¹‹å’ŒII-è¾“å…¥æœ‰åºæ•°ç»„","date":"2019-11-20T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode167-ä¸¤æ•°ä¹‹å’ŒII-è¾“å…¥æœ‰åºæ•°ç»„/","link":"","permalink":"https://www.codetool.top/article/leetcode167-%E4%B8%A4%E6%95%B0%E4%B9%8B%E5%92%8CII-%E8%BE%93%E5%85%A5%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªå·²æŒ‰ç…§ å‡åºæ’åˆ— çš„æœ‰åºæ•°ç»„ï¼Œæ‰¾åˆ°ä¸¤ä¸ªæ•°ä½¿å¾—å®ƒä»¬ç›¸åŠ ä¹‹å’Œç­‰äºç›®æ ‡æ•°ã€‚ å‡½æ•°åº”è¯¥è¿”å›è¿™ä¸¤ä¸ªä¸‹æ ‡å€¼index1å’Œindex2ï¼Œå…¶ä¸­index1å¿…é¡»å°äºindex2ã€‚ è¯´æ˜: è¿”å›çš„ä¸‹æ ‡å€¼ï¼ˆindex1 å’Œ index2ï¼‰ä¸æ˜¯ä»é›¶å¼€å§‹çš„ã€‚ ä½ å¯ä»¥å‡è®¾æ¯ä¸ªè¾“å…¥åªå¯¹åº”å”¯ä¸€çš„ç­”æ¡ˆï¼Œè€Œä¸”ä½ ä¸å¯ä»¥é‡å¤ä½¿ç”¨ç›¸åŒçš„å…ƒç´ ã€‚ ç¤ºä¾‹: è¾“å…¥: numbers = [2, 7, 11, 15], target = 9è¾“å‡º: [1,2]è§£é‡Š 2 ä¸ 7 ä¹‹å’Œç­‰äºç›®æ ‡æ•° 9 ã€‚å› æ­¤ index1 = 1, index2 = 2 ã€‚ 2 è§£æ³•2.1 æ€æƒ³å› ä¸ºç»™çš„æ•°ç»„æ˜¯æœ‰åºçš„ï¼Œå¯ä»¥ä½¿ç”¨åŒæŒ‡é’ˆé€¼è¿‘ç›®æ ‡æ•°ã€‚ 2.2 ä»£ç class Solution { public int[] twoSum(int[] numbers, int target) { int[] index = new int[2]; int index1 = 0; int index2 = numbers.length - 1; while (index1 &lt; index2) { if (numbers[index1] + numbers[index2] > target) index2--; else if (numbers[index1] + numbers[index2] &lt; target) index1++; //æ‰¾åˆ°äº† else { index[0] = index1 + 1; index[1] = index2 + 1; break; } } return index; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode209-é•¿åº¦æœ€å°çš„å­æ•°ç»„","slug":"leetcode209-é•¿åº¦æœ€å°çš„å­æ•°ç»„","date":"2019-11-20T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode209-é•¿åº¦æœ€å°çš„å­æ•°ç»„/","link":"","permalink":"https://www.codetool.top/article/leetcode209-%E9%95%BF%E5%BA%A6%E6%9C%80%E5%B0%8F%E7%9A%84%E5%AD%90%E6%95%B0%E7%BB%84/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªå«æœ‰ n ä¸ªæ­£æ•´æ•°çš„æ•°ç»„å’Œä¸€ä¸ªæ­£æ•´æ•° s ï¼Œæ‰¾å‡ºè¯¥æ•°ç»„ä¸­æ»¡è¶³å…¶å’Œ â‰¥ s çš„é•¿åº¦æœ€å°çš„è¿ç»­å­æ•°ç»„ã€‚å¦‚æœä¸å­˜åœ¨ç¬¦åˆæ¡ä»¶çš„è¿ç»­å­æ•°ç»„ï¼Œè¿”å› 0ã€‚ ç¤ºä¾‹: è¾“å…¥: s = 7, nums = [2,3,1,2,4,3]è¾“å‡º: 2è§£é‡Š: å­æ•°ç»„ [4,3] æ˜¯è¯¥æ¡ä»¶ä¸‹çš„é•¿åº¦æœ€å°çš„è¿ç»­å­æ•°ç»„ã€‚ è¿›é˜¶: å¦‚æœä½ å·²ç»å®Œæˆäº†O(n) æ—¶é—´å¤æ‚åº¦çš„è§£æ³•, è¯·å°è¯• O(n log n) æ—¶é—´å¤æ‚åº¦çš„è§£æ³•ã€‚ 2 è§£æ³•2.1 æ€æƒ³ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆiã€jä»ä¸‹æ ‡ä¸º0å¤„å¼€å§‹éå†ã€‚å¦‚æœi-jå†…çš„æ€»æ•°å°äºsï¼Œå°†jå‘åç§»åŠ¨ï¼Œå¦‚æœi-jå†…çš„æ€»æ•°å¤§äºsï¼Œå°†iå‘åç§»åŠ¨ï¼Œç›´åˆ°è·å–æ‰€æœ‰å­æ•°ç»„çš„é•¿åº¦ï¼Œå¹¶æ¯”è¾ƒå‡ºæœ€çŸ­é•¿åº¦ã€‚ 2.2 ä»£ç class Solution { public int minSubArrayLen(int s, int[] nums) { int i = 0; int j = -1; int size = nums.length; int sum = 0; int min = 0; while(i&lt;size&amp;&amp;j&lt;size){ if(sum>=s){ if(min==0) min = j-i+1; else min = j-i+1&lt;min?j-i+1:min; sum -= nums[i++]; }else{ if(j==size-1) return min; sum += nums[++j]; } } return min; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode27-ç§»é™¤å…ƒç´ ","slug":"leetcode27-ç§»é™¤å…ƒç´ ","date":"2019-11-20T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode27-ç§»é™¤å…ƒç´ /","link":"","permalink":"https://www.codetool.top/article/leetcode27-%E7%A7%BB%E9%99%A4%E5%85%83%E7%B4%A0/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ•°ç»„ nums å’Œä¸€ä¸ªå€¼ val*ï¼Œä½ éœ€è¦åŸåœ°ç§»é™¤æ‰€æœ‰æ•°å€¼ç­‰äº *val çš„å…ƒç´ ï¼Œè¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚ ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„å¹¶åœ¨ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚ å…ƒç´ çš„é¡ºåºå¯ä»¥æ”¹å˜ã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚ ç¤ºä¾‹ 1: ç»™å®š nums = [3,2,2,3], val = 3,å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 2, å¹¶ä¸” nums ä¸­çš„å‰ä¸¤ä¸ªå…ƒç´ å‡ä¸º 2ã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚ ç¤ºä¾‹ 2: ç»™å®š nums = [0,1,2,2,3,0,4,2], val = 2,å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 5, å¹¶ä¸” nums ä¸­çš„å‰äº”ä¸ªå…ƒç´ ä¸º 0, 1, 3, 0, 4ã€‚æ³¨æ„è¿™äº”ä¸ªå…ƒç´ å¯ä¸ºä»»æ„é¡ºåºã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚ è¯´æ˜: ä¸ºä»€ä¹ˆè¿”å›æ•°å€¼æ˜¯æ•´æ•°ï¼Œä½†è¾“å‡ºçš„ç­”æ¡ˆæ˜¯æ•°ç»„å‘¢? è¯·æ³¨æ„ï¼Œè¾“å…¥æ•°ç»„æ˜¯ä»¥ â€œå¼•ç”¨â€ æ–¹å¼ä¼ é€’çš„ï¼Œè¿™æ„å‘³ç€åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚ ä½ å¯ä»¥æƒ³è±¡å†…éƒ¨æ“ä½œå¦‚ä¸‹: // nums æ˜¯ä»¥â€œå¼•ç”¨â€æ–¹å¼ä¼ é€’çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯¹å®å‚ä½œä»»ä½•æ‹·è´int len = removeElement(nums, val); // åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚// æ ¹æ®ä½ çš„å‡½æ•°è¿”å›çš„é•¿åº¦, å®ƒä¼šæ‰“å°å‡ºæ•°ç»„ä¸­è¯¥é•¿åº¦èŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ ã€‚for (int i = 0; i &lt; len; i++) {print(nums[i]);} 2 è§£æ³•2.1 æ€æƒ³æˆ‘ä»¬ç»§ç»­ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆï¼šä¸€ä¸ªä»ç„¶ç”¨äºè¿­ä»£ï¼Œè€Œç¬¬äºŒä¸ªæŒ‡é’ˆæ€»æ˜¯æŒ‡å‘ä¸‹ä¸€æ¬¡æ·»åŠ çš„ä½ç½®ã€‚ 2.2 ä»£ç class Solution { public int removeElement(int[] nums, int val) { int k = 0; for(int i = 0;i&lt;nums.length;i++){ if(nums[i]!=val){ nums[k] = nums[i]; k++; } } return k; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode28-å®ç°strStr()","slug":"leetcode28-å®ç°strStr","date":"2019-11-20T10:05:23.000Z","updated":"2020-02-20T14:42:31.680Z","comments":true,"path":"article/leetcode28-å®ç°strStr/","link":"","permalink":"https://www.codetool.top/article/leetcode28-%E5%AE%9E%E7%8E%B0strStr/","excerpt":"","text":"1 åŸé¢˜å®ç° strStr() å‡½æ•°ã€‚ ç»™å®šä¸€ä¸ª haystack å­—ç¬¦ä¸²å’Œä¸€ä¸ª needle å­—ç¬¦ä¸²ï¼Œåœ¨ haystack å­—ç¬¦ä¸²ä¸­æ‰¾å‡º needle å­—ç¬¦ä¸²å‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½® (ä»0å¼€å§‹)ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å› -1ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: haystack = â€œhelloâ€, needle = â€œllâ€è¾“å‡º: 2 ç¤ºä¾‹ 2: è¾“å…¥: haystack = â€œaaaaaâ€, needle = â€œbbaâ€è¾“å‡º: -1 è¯´æ˜: å½“ needle æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶ï¼Œæˆ‘ä»¬åº”å½“è¿”å›ä»€ä¹ˆå€¼å‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ªåœ¨é¢è¯•ä¸­å¾ˆå¥½çš„é—®é¢˜ã€‚ å¯¹äºæœ¬é¢˜è€Œè¨€ï¼Œå½“ needle æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶æˆ‘ä»¬åº”å½“è¿”å› 0 ã€‚è¿™ä¸Cè¯­è¨€çš„ strstr() ä»¥åŠ Javaçš„ indexOf() å®šä¹‰ç›¸ç¬¦ã€‚ 2 è§£æ³•2.1 JDK APIåœ¨leetcodeä¸Šï¼Œå½“ç„¶å¯ä»¥æŠ•æœºå–å·§åœ°ä½¿ç”¨String.indexof()æ–¹æ³•ï¼Œä¸ç”¨é‡å¤é€ è½®å­ï¼š class Solution { public int strStr(String haystack, String needle) { return haystack.indexOf(needle); } } ä½†è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„å­—ç¬¦ä¸²ç²¾å‡†æ¨¡å¼åŒ¹é…é—®é¢˜ï¼Œå†å²ä¸Šå‡ºç°è¿‡å¾ˆå¤šè§£å†³è¿™ä¸ªé—®é¢˜çš„ç®—æ³•ï¼ŒæŒæ¡å®ƒä»¬çš„æ€æƒ³è¿˜æ˜¯æœ‰å¿…è¦çš„ï¼š 2.2 BFç®—æ³•ï¼ˆæœ´ç´ ç®—æ³•ï¼‰2.2.1 æ€æƒ³è¿™æ˜¯æœ€ç›´è§‚ã€æœ€ç®€å•çš„ç®—æ³•ã€‚ä»ä¸»ä¸²çš„ç¬¬startä¸ªå­—ç¬¦èµ·å’Œæ¨¡å¼çš„ç¬¬1ä¸ªå­—ç¬¦æ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ç»§ç»­é€ä¸ªæ¯”è¾ƒåç»­å­—ç¬¦ã€‚æ¯”è¾ƒè¿‡ç¨‹ä¸­ä¸€æ—¦å‘ç°ä¸ç›¸ç­‰çš„æƒ…å†µï¼Œåˆ™å›æº¯è‡³ä¸»ä¸²ä¸­çš„ç¬¬start+1ä¸ªå­—ç¬¦ä½ç½®å¤„ï¼Œé‡æ–°ä¸æ¨¡å¼Pçš„å­—ç¬¦è¿›è¡Œæ¯”è¾ƒã€‚è¯¥ç®—æ³•æ•ˆç‡è¾ƒä½ã€‚ 2.2.2 ä»£ç class Solution { public int strStr(String haystack, String needle) { int mainLen = haystack.length(); int subLen = needle.length(); if(needle.equals(\"\")) return 0;//æ³¨æ„æ¨¡å¼å­—ç¬¦ä¸²ä¸ºç©ºçš„æƒ…å†µ for(int i=0;i&lt;mainLen;i++){ for(int j =0;j&lt;subLen;j++){ if(!(i+j&lt;mainLen)) return -1;//ä¸»ä¸²ä¸‹æ ‡è¶…å‡º if(!(haystack.charAt(i+j)==needle.charAt(j))) break; else if(j == subLen-1) return i;//å®Œå…¨åŒ¹é…ï¼Œè¿”å›ä¸»ä¸²ä¸‹æ ‡ } } return -1; } } ç®—æ³•çš„å¤æ‚åº¦ä¸ºO[(i-j)j] 2.3 MPç®—æ³•2.3.1 æ€è·¯ æŒ‡é’ˆä¸å›æº¯ï¼Œåˆ©ç”¨å·²å¾—åˆ°çš„â€œéƒ¨åˆ†åŒ¹é…â€ç»“æœï¼Œå°†æ¨¡å¼å‘å³â€œæ»‘åŠ¨â€è‹¥å¹²ä½ç½®åç»§ç»­æ¯”è¾ƒã€‚ å‚è€ƒä¸‹é¢ç»™å‡ºçš„ç¤ºä¾‹ï¼šhaystack ï¼š&quot;cdnidnidsm&quot;needleï¼š&quot;nidsm&quot;æŒ‰ç…§BFç®—æ³•çš„æ€æƒ³ï¼Œåœ¨æ¯”è¾ƒhaystack[2]å’Œneedle[0]æ—¶ï¼Œä¸¤ä¸ªå­—ç¬¦ç›¸ç­‰ï¼Œç„¶è€Œæ¯”è¾ƒåˆ°haystack[5]å’Œneedle[3]çš„æ—¶å€™ä¸¤ä¸ªå­—ç¬¦ä¸ç­‰ï¼Œäºæ˜¯å›æº¯ç»§ç»­å‘åæ¯”è¾ƒhaystack[3]å’Œneedle[0]ã€‚å¯æ˜¯æ—¢ç„¶èƒ½ç¡®å®šhaystack[2]-haystack[4]ä¸needle[0]-needle[2]æ˜¯å®Œå…¨å¯¹åº”çš„ã€‚é‚£ä¹ˆæ¯”è¾ƒhaystack[3]å’Œneedle[0]å®é™…ä¸Šç›¸å½“äºæ¯”è¾ƒneedle[1]å’Œneedle[0]ã€‚å¹¶ä¸”æˆ‘ä»¬çŸ¥é“needleä¸­å‰ä¸‰ä¸ªå­—ç¬¦éƒ½æ˜¯ä¸åŒçš„ã€‚æ‰€ä»¥åªéœ€è¦ä»haystack[5]å¤„ç»§ç»­è·Ÿneedle[0]æ¯”è¾ƒå°±è¡Œäº†ã€‚å¹¶ä¸”needleä¸­å­—ç¬¦çš„è¿™äº›å…³ç³»å®Œå…¨æ˜¯ä¸€å¼€å§‹å°±å¯ä»¥ç¡®å®šçš„ã€‚ æˆ‘ä»¬ç§°è®°å½•æ¨¡å¼å­—ç¬¦ä¸²ä¸­å„ä¸ªå­—ç¬¦ä¹‹é—´å…³ç³»çš„å‡½æ•°ä¸ºå¤±æ•ˆå‡½æ•°ã€‚å¤±æ•ˆå‡½æ•°çš„å®šä¹‰åŸŸæ˜¯æ¨¡å¼å­—ç¬¦ä¸²åœ¨â€œå¤±é…â€å‰åŒ¹é…çš„å­—ç¬¦ä¸²ä¸ªæ•°ã€‚å–å€¼jå±äº0~Len(P)-1 è·å–å¤±æ•ˆå‡½æ•°çš„æ–¹æ³•ï¼š å¤±æ•ˆå‡½æ•°çš„å–å€¼kæ»¡è¶³P0P1â€¦Pk = Pj-kPj-k+1â€¦Pjã€‚å¦‚æœä¸å­˜åœ¨è¿™ä¸ªkå€¼ï¼Œå–-1ã€‚ ç›´è§‚çš„çœ‹kå°±æ˜¯æ¨¡å¼å­—ç¬¦ä¸²å‰jä¸ªå­—ç¬¦æ˜¯å¦å­˜åœ¨å‰k+1ä½ç­‰äºåk+1ä½ã€‚ nidsmçš„å¤±æ•ˆå‡½æ•°ä¸ºï¼š j 0 1 2 3 4 p(j) n i d s m k -1 -1 -1 -1 -1 å†ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œcaatcatçš„å¤±æ•ˆå‡½æ•°ä¸ºï¼š j 0 1 2 3 4 5 6 p(j) c a a t c a t k -1 -1 -1 -1 0 1 -1 å¾—åˆ°äº†å¤±æ•ˆå‡½æ•°åï¼Œå³å¯ä½¿ç”¨MPç®—æ³•è¿›è¡ŒåŒ¹é…ã€‚å‡è®¾åœ¨æŸä¸€è½®æ¯”è¾ƒä¸­ï¼Œå¤±é…çš„æƒ…å†µå‘ç”Ÿåœ¨æ¨¡å¼Pçš„ç¬¬jä½ï¼Œå¦‚æœj=0ï¼Œè¿›è¡Œä¸‹ä¸€è½®æ¯”è¾ƒæ—¶ï¼Œç›®æ ‡æŒ‡é’ˆå‘åç§»åŠ¨ä¸€ä½ï¼Œæ¨¡å¼çš„èµ·å§‹æ¯”è¾ƒåœ°å€å›åˆ°P0ï¼Œå…¶ä»–æƒ…å†µè¿›è¡Œä¸‹ä¸€è½®æ¯”è¾ƒæ—¶ï¼Œç›®æ ‡æŒ‡é’ˆä¸å‘ç”Ÿå›æº¯ï¼Œè€Œæ¨¡å¼Pçš„èµ·å§‹æ¯”è¾ƒåœ°å€ä¸ºj-1å¯¹åº”çš„å¤±æ•ˆå‡½æ•°çš„å€¼+1ã€‚ å½“ç„¶ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªå€¼æå‰ç®—å‡ºæ¥ä¾¿æˆä¸ºäº†Next()å‡½æ•°ï¼š j 0 1 2 3 4 5 6 7 p(j) c a a t c a t Next(j) -1 0 0 0 0 1 2 0 Next(7)å¯ä»¥ç”¨äºç»§ç»­åŒ¹é…ï¼ˆå¯èƒ½è¦æ±‚æ‰¾å‡ºæ‰€æœ‰åŒ¹é…çš„å­å­—ç¬¦ä¸²ï¼‰ã€‚ 2.3.2 ä»£ç class Solution { //è·å–nextå‡½æ•° public int[] next(String needle){ int len = needle.length(); int i = 0; int j = -1; int[] next = new int[len+1]; next[0] = -1; while(i &lt; len){ while( j > -1 &amp;&amp; needle.charAt(i)!=needle.charAt(j)) j = next[j];//jä¼šæœ‰ä¸€ä¸ªä¼ é€’çš„æ•ˆæœï¼Œå¿…é¡»å‰ä¸€ä¸ªiå¯¹åº”çš„jæ˜¯1ï¼Œä¸‹ä¸€ä¸ªiå¯¹åº”çš„jæ‰èƒ½æ˜¯2ã€‚å¦‚æœé‡åˆ°ä¸åŒçš„å­—ç¬¦åˆ™jæ¸…é›¶ next[++i] = ++j; } return next; } public int strStr(String haystack, String needle) { int mainLen = haystack.length(); int subLen = needle.length(); if(needle.equals(\"\")) return 0;//æ³¨æ„æ¨¡å¼å­—ç¬¦ä¸²ä¸ºç©ºçš„æƒ…å†µ if(mainLen&lt;subLen) return -1; int[] next = next(needle); int i = 0; int j = 0; while(j &lt; mainLen){ while(i>-1 &amp;&amp; needle.charAt(i) != haystack.charAt(j)) i = next[i]; i++; j++; if(i >= subLen){ return j-i; } } return -1; } } 2.4 KMPç®—æ³•2.4.1 æ€è·¯åœ¨MPç®—æ³•çš„åŸºç¡€ä¸Šï¼Œè¿˜è¦é¿å…æœ€é•¿å‰ç¼€ä¹‹åçš„é‚£ä¸ªå­—ç¬¦ä¸ç­‰äºåŸæ¥å¤±é…çš„é‚£ä¸ªå­—ç¬¦ã€‚ä¸‹é¢åœ¨å·²çŸ¥mpNextè¡¨çš„æƒ…å†µä¸‹ï¼Œç»™å‡ºå»ºç«‹kmpNextè¡¨çš„è§„åˆ™ã€‚è¿™ä¸ªè§„åˆ™åˆ†ä¸ºå››ç§æƒ…å†µï¼š å¦‚æœmpNext[j] = 0ä¸”Pj = P0ï¼Œåˆ™ä»¤kmpNext[j] = -1ã€‚ å¦‚æœmpNext[j] = 0ä¸”Pj â‰  P0ï¼Œåˆ™ä»¤kmpNext[j] = 0ã€‚ å¦‚æœmpNext[j] â‰  0ä¸”Pj â‰  PmpNext[j]ï¼Œåˆ™ä»¤kmpNext[j] = mpNext[j]ã€‚ å¦‚æœmpNext[j] â‰  0ä¸”Pj = PmpNext[j]ï¼Œåˆ™ç”¨mpNext[j]çš„å€¼æ›¿æ¢åŸæ¥mpNext[j]ä¸­çš„jå€¼ï¼Œç›´åˆ°æƒ…å†µè½¬æ¢ä¸ºå‰3ç§æƒ…å†µçš„ä¸€ç§ï¼Œè¿›è€Œé€’å½’åœ°æ±‚è§£kmpNext[j]ã€‚ j 0 1 2 3 4 5 6 7 p(j) c a a t c a t mpNext(j) -1 0 0 0 0 1 2 0 kmpNext(j) -1 0 0 0 -1 0 2 0 2.4.2 ä»£ç class Solution { //è·å–kmpNextæ•°ç»„ public int[] next(String needle){ int len = needle.length(); int i = 0; int j = -1; int[] next = new int[len+1]; next[0] = -1; while(i &lt; len-1){ while( j > -1 &amp;&amp; needle.charAt(i)!=needle.charAt(j)) j = next[j]; i++; j++; if(needle.charAt(i) == needle.charAt(j)) next[i] = next[j]; else next[i] = j; } return next; } public int strStr(String haystack, String needle) { int mainLen = haystack.length(); int subLen = needle.length(); if(needle.equals(\"\")) return 0;//æ³¨æ„æ¨¡å¼å­—ç¬¦ä¸²ä¸ºç©ºçš„æƒ…å†µ if(mainLen&lt;subLen) return -1; int[] next = next(needle); int i = 0; int j = 0; while(j &lt; mainLen){ while(i>-1 &amp;&amp; needle.charAt(i) != haystack.charAt(j)) i = next[i]; i++; j++; if(i >= subLen){ return j-i; } } return -1; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode485-æœ€å¤§è¿ç»­1çš„ä¸ªæ•°","slug":"leetcode485-æœ€å¤§è¿ç»­1çš„ä¸ªæ•°","date":"2019-11-20T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode485-æœ€å¤§è¿ç»­1çš„ä¸ªæ•°/","link":"","permalink":"https://www.codetool.top/article/leetcode485-%E6%9C%80%E5%A4%A7%E8%BF%9E%E7%BB%AD1%E7%9A%84%E4%B8%AA%E6%95%B0/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªäºŒè¿›åˆ¶æ•°ç»„ï¼Œ è®¡ç®—å…¶ä¸­æœ€å¤§è¿ç»­1çš„ä¸ªæ•°ã€‚ ç¤ºä¾‹ 1: è¾“å…¥ï¼š [1,1,0,1,1,1]è¾“å‡ºï¼š 3è§£é‡Šï¼š å¼€å¤´çš„ä¸¤ä½å’Œæœ€åçš„ä¸‰ä½éƒ½æ˜¯è¿ç»­1ï¼Œæ‰€ä»¥æœ€å¤§è¿ç»­1çš„ä¸ªæ•°æ˜¯ 3. æ³¨æ„ï¼š è¾“å…¥çš„æ•°ç»„åªåŒ…å«0å’Œ1ã€‚ è¾“å…¥æ•°ç»„çš„é•¿åº¦æ˜¯æ­£æ•´æ•°ï¼Œä¸”ä¸è¶…è¿‡ 10,000ã€‚ 2 è§£æ³•2.1 æ€æƒ³ä½¿ç”¨ä¸€ä¸ªæ•°éå†æ•°ç»„ï¼Œå¦ä¸€ä¸ªæ•°è®°å½•é‡åˆ°çš„è¿ç»­çš„1çš„ä¸ªæ•°ï¼Œè®°å½•æœ€å¤§å€¼ã€‚ 2.2 ä»£ç class Solution { public int findMaxConsecutiveOnes(int[] nums) { int j=0; int max=0; for(int i:nums){ if(i==1){ j++; }else{ if(j>max) max=j; j=0; } } if(j>max) max=j; return max; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"AbstractCollectioné»˜è®¤é›†åˆç±»","slug":"AbstractCollectionæºç åˆ†æ","date":"2019-11-18T14:39:59.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/AbstractCollectionæºç åˆ†æ/","link":"","permalink":"https://www.codetool.top/article/AbstractCollection%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","excerpt":"","text":"AbstractCollectionç”¨äºå®ç°åŸºæœ¬çš„Collectionç»“æ„ï¼Œæä¾›ç»™æ™®é€šç”¨æˆ·ç»§æ‰¿ä½¿ç”¨ã€‚ä¹Ÿæ˜¯JDKé›†åˆç±»çš„çˆ¶ç±»ï¼Œéƒ¨åˆ†æ–¹æ³•æ˜¯æ²¡æœ‰è¢«é‡è½½çš„ã€‚ ç›¸æ¯”Collectionæ¥å£å¹¶æ²¡æœ‰æ–°å¢å…¬å¼€æ–¹æ³•ï¼Œä½†å®ƒæä¾›äº†è®¸å¤šæ–¹æ³•çš„é»˜è®¤å®ç°ã€‚ 0.1 public boolean contains(Object o);æä¾›äº†ä¸€ä¸ªé»˜è®¤å®ç°ï¼š public boolean contains(Object o) { Iterator&lt;E> it = iterator(); if (o==null) { while (it.hasNext()) if (it.next()==null) return true; } else { while (it.hasNext()) if (o.equals(it.next())) return true; } return false; } å¾ˆå®¹æ˜“ç†è§£ï¼Œä¹Ÿå¾ˆä¾èµ–äºiterator()å’Œequals()æ–¹æ³•çš„å®ç° 0.2 public boolean isEmpty();public boolean isEmpty() { return size() == 0; } ä¾èµ–äºsize()æ–¹æ³•çš„å®ç° 0.3 public Object[] toArray();public Object[] toArray() { // Estimate size of array; be prepared to see more or fewer elements Object[] r = new Object[size()]; Iterator&lt;E> it = iterator(); for (int i = 0; i &lt; r.length; i++) { if (! it.hasNext()) // fewer elements than expected return Arrays.copyOf(r, i); r[i] = it.next(); } return it.hasNext() ? finishToArray(r, it) : r; } æ³¨æ„è¯¥å®ç°åˆ¤æ–­äº†iteratoréå†çš„å…ƒç´ ä¸ªæ•°å¯èƒ½è·Ÿsize()çš„ç»“æœä¸åŒçš„æƒ…å†µã€‚å¹¶ä¸”ä»¥iteratoréå†çš„æ‰€æœ‰å…ƒç´ ä¸ºå‡†ã€‚ 0.3.1 private static T[] finishToArray(T[] r, Iterator&lt;?&gt; it);æ˜¯toArray()å‡½æ•°è°ƒç”¨çš„ä¸€ä¸ªç§å¯†é™æ€æ–¹æ³•ï¼Œå®ƒå°†itè¿­ä»£å™¨éå†çš„æ‰€æœ‰å…ƒç´ å­˜å…¥ä¸€ä¸ªæ•°ç»„ï¼Œå¹¶ä¸”ä¸ä¾èµ–size()çš„å®ç°ï¼Œå¯ä»¥ç»™ä¼ å…¥çš„æ•°ç»„æ‰©å®¹ã€‚ private static &lt;T> T[] finishToArray(T[] r, Iterator&lt;?> it) { int i = r.length; while (it.hasNext()) { int cap = r.length;//å®¹é‡capacityçš„æ¦‚å¿µ if (i == cap) { int newCap = cap + (cap >> 1) + 1;// n+n/2+1æ‰©å®¹ // overflow-conscious code if (newCap - MAX_ARRAY_SIZE > 0) newCap = hugeCapacity(cap + 1); //æ–°å®¹é‡ç­‰äºInteger.MAX_VALUEæˆ–MAX_ARRAY_SIZE r = Arrays.copyOf(r, newCap); } r[i++] = (T)it.next(); } // trim if overallocated return (i == r.length) ? r : Arrays.copyOf(r, i); } 0.3.2 private static int hugeCapacity(int minCapacity);æ˜¯finishToArray()å‡½æ•°è°ƒç”¨çš„ç”¨äºå®¹é‡é€¼è¿‘Integer.MAX_VALUEç»™æ•°ç»„æ‰©å®¹çš„æ–¹æ³• private static int hugeCapacity(int minCapacity) { //è¶…å‡ºintèŒƒå›´ if (minCapacity &lt; 0) // overflow throw new OutOfMemoryError (\"Required array size too large\"); return (minCapacity > MAX_ARRAY_SIZE) ? Integer.MAX_VALUE : MAX_ARRAY_SIZE; } 0.4 public boolean add(E e);public boolean add(E e) { throw new UnsupportedOperationException(); } ä¸å…è®¸å•ä¸ªæ·»åŠ å…ƒç´ ã€‚ 0.5 public boolean remove(Object o);public boolean remove(Object o) { Iterator&lt;E> it = iterator(); if (o==null) { while (it.hasNext()) { if (it.next()==null) { it.remove(); return true; } } } else { while (it.hasNext()) { if (o.equals(it.next())) { it.remove(); return true; } } } return false; } æ³¨æ„nullè¦åˆ†å¼€æ¥åˆ¤æ–­ï¼Œå› ä¸ºnullä¸èƒ½è¢«equals()è°ƒç”¨åˆ é™¤çš„æ–¹å¼æ˜¯é€šè¿‡è¿­ä»£å™¨çš„remove()æ–¹æ³• 0.6 public boolean containsAll(Collection&lt;?&gt; c);public boolean containsAll(Collection&lt;?> c) { for (Object e : c) if (!contains(e)) return false; return true; } å¾ªç¯è°ƒç”¨contains()æ–¹æ³•åˆ¤æ–­ 0.7 public boolean addAll(Collection&lt;? extends E&gt; c)public boolean addAll(Collection&lt;? extends E> c) { boolean modified = false; for (E e : c) if (add(e)) modified = true; return modified; } è¿™ä¸ªæ“ä½œä¸èƒ½ä¿è¯æ‰€æœ‰å…ƒç´ éƒ½è¢«æ·»åŠ æˆåŠŸäº†ï¼Œè¿™ä¾èµ–äºadd()æ–¹æ³•çš„å®ç°ï¼Œä½†åªè¦æœ‰ä¸€ä¸ªå…ƒç´ è¢«æ·»åŠ æˆåŠŸäº†ï¼Œå°±è¿”å›trueã€‚ 0.8 public boolean removeAll(Collection&lt;?&gt; c)public boolean removeAll(Collection&lt;?&gt; c) { Objects.requireNonNull(c); boolean modified = false; Iterator&lt;?&gt; it = iterator(); while (it.hasNext()) { if (c.contains(it.next())) { it.remove(); modified = true; } } return modified; }åŒç†ï¼Œè¯¥æ“ä½œä¹Ÿä¸èƒ½ä¿è¯æ‰€æœ‰å…ƒç´ éƒ½è¢«ç§»é™¤æˆåŠŸäº†ï¼Œä½†åªè¦æœ‰ä¸€ä¸ªå…ƒç´ è¢«ç§»é™¤æˆåŠŸäº†ï¼Œå°±è¿”å›trueã€‚ 0.9 public boolean retainAll(Collection&lt;?&gt; c)public boolean retainAll(Collection&lt;?> c) { Objects.requireNonNull(c); boolean modified = false; Iterator&lt;E> it = iterator(); while (it.hasNext()) { if (!c.contains(it.next())) { it.remove(); modified = true; } } return modified; } å’ŒremoveAll()çš„å®ç°ç›¸åï¼Œå°†cä¸­å«æœ‰çš„å…ƒç´ ä¿ç•™äº†ä¸‹æ¥ã€‚ 0.10 public void clear();public void clear() { Iterator&lt;E> it = iterator(); while (it.hasNext()) { it.next(); it.remove(); } } ç§»é™¤æ‰€æœ‰å…ƒç´ ã€‚ 0.11 public String toString()public String toString() { Iterator&lt;E> it = iterator(); if (! it.hasNext()) return \"[]\"; StringBuilder sb = new StringBuilder();//sb sb.append('['); for (;;) { E e = it.next(); sb.append(e == this ? \"(this Collection)\" : e); if (! it.hasNext()) return sb.append(']').toString(); sb.append(',').append(' '); } } ä»¥[*,*,*...]çš„å½¢å¼è¾“å‡ºå­—ç¬¦ä¸²ï¼Œè¿˜è€ƒè™‘åˆ°äº†å…ƒç´ å¯èƒ½æ˜¯å®ƒæœ¬èº«çš„æƒ…å†µ","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jdk","slug":"jdk","permalink":"https://www.codetool.top/tags/jdk/"}]},{"title":"leetcode14-æœ€é•¿å…¬å…±å‰ç¼€","slug":"leetcode14-æœ€é•¿å…¬å…±å‰ç¼€","date":"2019-11-18T10:05:23.000Z","updated":"2020-02-20T14:42:31.680Z","comments":true,"path":"article/leetcode14-æœ€é•¿å…¬å…±å‰ç¼€/","link":"","permalink":"https://www.codetool.top/article/leetcode14-%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%89%8D%E7%BC%80/","excerpt":"","text":"1 åŸé¢˜ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥æŸ¥æ‰¾å­—ç¬¦ä¸²æ•°ç»„ä¸­çš„æœ€é•¿å…¬å…±å‰ç¼€ã€‚ å¦‚æœä¸å­˜åœ¨å…¬å…±å‰ç¼€ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸² â€œâ€ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: [â€œflowerâ€,â€flowâ€,â€flightâ€]è¾“å‡º: â€œflâ€ ç¤ºä¾‹ 2: è¾“å…¥: [â€œdogâ€,â€racecarâ€,â€carâ€]è¾“å‡º: â€œâ€è§£é‡Š: è¾“å…¥ä¸å­˜åœ¨å…¬å…±å‰ç¼€ã€‚ è¯´æ˜: æ‰€æœ‰è¾“å…¥åªåŒ…å«å°å†™å­—æ¯ a-z ã€‚ 2 è§£æ³•2.1 æ€æƒ³ä»¥ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ¯ä¸€ä¸ªä½ç½®ä¸Šçš„å­—ç¬¦ä¸ºåŸºå‡†ï¼Œä¾æ¬¡æ¯”å¯¹å…¶ä½™å­—ç¬¦ä¸²å¯¹åº”ä½ç½®ä¸Šçš„å­—ç¬¦ï¼Œå¦‚æœæ¯ä¸ªå­—ç¬¦ä¸²å¯¹åº”çš„ä½ç½®ä¸Šéƒ½æ˜¯è¿™ä¸ªå­—ç¬¦ï¼Œåˆ™å°†å…¶appendåˆ°ç»“æœä¸Šï¼Œä¸€æ—¦é‡åˆ°ä¸€ä¸ªå­—ç¬¦ä¸æ˜¯å…¬æœ‰çš„ç«‹åˆ»å°†ç»“æœè¿”å›ã€‚ 2.2 ä»£ç class Solution { public String longestCommonPrefix(String[] strs) { int size = strs.length; if(size==0) return \"\"; if(size==1) return strs[0];//ä¸€ä¸ªå­—ç¬¦ä¸²ç›´æ¥è¿”å›æœ¬èº« StringBuilder str = new StringBuilder();//ä¸ºäº†é¿å…javaè¿æ¥å­—ç¬¦ä¸²çš„ä½æ•ˆç‡ä½¿ç”¨StringBuilder for(int i = 0;i &lt; strs[0].length();i++){ char letter = strs[0].charAt(i); for(int j = 1;j &lt; size;j++){ //ä¾æ¬¡æ£€æŸ¥å…¶ä½™å­—ç¬¦ä¸²å„ä¸ªå­—ç¬¦æ˜¯å¦å¯¹åº”ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ //ä¸ºäº†é¿å…å…¶ä»–å­—ç¬¦ä¸²çš„é•¿åº¦å°äºç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½¿ç”¨tryæ•è·å¼‚å¸¸ try{ if(strs[j].charAt(i)!=letter) return str.toString(); }catch(Exception e){ return str.toString();} } str.append(letter); } return str.toString(); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode344-åè½¬å­—ç¬¦ä¸²","slug":"leetcode344-åè½¬å­—ç¬¦ä¸²","date":"2019-11-18T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode344-åè½¬å­—ç¬¦ä¸²/","link":"","permalink":"https://www.codetool.top/article/leetcode344-%E5%8F%8D%E8%BD%AC%E5%AD%97%E7%AC%A6%E4%B8%B2/","excerpt":"","text":"1 åŸé¢˜ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯å°†è¾“å…¥çš„å­—ç¬¦ä¸²åè½¬è¿‡æ¥ã€‚è¾“å…¥å­—ç¬¦ä¸²ä»¥å­—ç¬¦æ•°ç»„char[]çš„å½¢å¼ç»™å‡ºã€‚ ä¸è¦ç»™å¦å¤–çš„æ•°ç»„åˆ†é…é¢å¤–çš„ç©ºé—´ï¼Œä½ å¿…é¡»åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„ã€ä½¿ç”¨ O(1) çš„é¢å¤–ç©ºé—´è§£å†³è¿™ä¸€é—®é¢˜ã€‚ ä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸­çš„æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯ ASCII ç è¡¨ä¸­çš„å¯æ‰“å°å­—ç¬¦ã€‚ ç¤ºä¾‹ 1: è¾“å…¥ï¼š[â€œhâ€,â€eâ€,â€lâ€,â€lâ€,â€oâ€]è¾“å‡ºï¼š[â€œoâ€,â€lâ€,â€lâ€,â€eâ€,â€hâ€] ç¤ºä¾‹ 2: è¾“å…¥ï¼š[â€œHâ€,â€aâ€,â€nâ€,â€nâ€,â€aâ€,â€hâ€]è¾“å‡ºï¼š[â€œhâ€,â€aâ€,â€nâ€,â€nâ€,â€aâ€,â€Hâ€] 2 è§£æ³•2.1 æ€æƒ³å°†ç¬¬ä¸€ä¸ªå…ƒç´ ä¸æœ«å°¾è¿›è¡Œäº¤æ¢ï¼Œå†å‘å‰ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä¸æ–­åœ°äº¤æ¢ï¼Œç›´åˆ°å®ƒåˆ°è¾¾ä¸­é—´ä½ç½®ã€‚ æˆ‘ä»¬å¯ä»¥åŒæ—¶ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆæ¥å®Œæˆè¿­ä»£ï¼šä¸€ä¸ªä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œå¦ä¸€ä¸ªä»æœ€åä¸€ä¸ªå…ƒç´ å¼€å§‹ã€‚æŒç»­äº¤æ¢å®ƒä»¬æ‰€æŒ‡å‘çš„å…ƒç´ ï¼Œç›´åˆ°è¿™ä¸¤ä¸ªæŒ‡é’ˆç›¸é‡ã€‚ 2.2 ä»£ç class Solution { public void reverseString(char[] s) { char temp; int i = 0; int j = s.length-1; while(i&lt;=j){ temp = s[i]; s[i] = s[j]; s[j] = temp; i++; j--; } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode561-æ•°ç»„æ‹†åˆ†I","slug":"leetcode561-æ•°ç»„æ‹†åˆ†I","date":"2019-11-18T10:05:23.000Z","updated":"2020-02-20T14:42:31.679Z","comments":true,"path":"article/leetcode561-æ•°ç»„æ‹†åˆ†I/","link":"","permalink":"https://www.codetool.top/article/leetcode561-%E6%95%B0%E7%BB%84%E6%8B%86%E5%88%86I/","excerpt":"","text":"1 åŸé¢˜ç»™å®šé•¿åº¦ä¸º 2n çš„æ•°ç»„, ä½ çš„ä»»åŠ¡æ˜¯å°†è¿™äº›æ•°åˆ†æˆ n å¯¹, ä¾‹å¦‚ (a1, b1), (a2, b2), â€¦, (an, bn) ï¼Œä½¿å¾—ä»1 åˆ° n çš„ min(ai, bi) æ€»å’Œæœ€å¤§ã€‚ ç¤ºä¾‹ 1: è¾“å…¥ï¼š[1,4,3,2]è¾“å‡ºï¼š 4è§£é‡Š: n ç­‰äº 2, æœ€å¤§æ€»å’Œä¸º 4 = min(1, 2) + min(3, 4). æç¤º: n æ˜¯æ­£æ•´æ•°,èŒƒå›´åœ¨ [1, 10000]. æ•°ç»„ä¸­çš„å…ƒç´ èŒƒå›´åœ¨ [-10000, 10000]. 2 è§£æ³•2.1 æ€æƒ³é€šè¿‡è§‚å¯Ÿå‘ç°ï¼Œæœ€åæ€»å’Œåº”è¯¥æ˜¯æ‰€æœ‰æ•°æ’å®Œåºåå¶æ•°ä¸‹æ ‡çš„å…ƒç´ çš„å€¼çš„æ€»å’Œã€‚ 2.2 ä»£ç class Solution { public int arrayPairSum(int[] nums) { Arrays.sort(nums); int i = 0; int sum = 0; while(i&lt;nums.length){ sum+=nums[i]; i+=2; } return sum; } } è¿˜æœ‰ä¸€ç§æ’åºæ–¹æ³•ï¼šå› ä¸ºå·²çŸ¥æ•°çš„èŒƒå›´éƒ½æ˜¯åœ¨[-10000, 10000]ä¸­ï¼Œå¯ä»¥åˆ©ç”¨é¢å¤–çš„ç©ºé—´æ’åºã€‚è¿™ç§æ–¹æ³•ç”±äºæ’åºæ›´å¿«ï¼Œæ—¶é—´å¤æ‚åº¦è¾ƒä½ï¼Œä½†åªé€‚ç”¨äºæ•°å€¼èŒƒå›´å·²çŸ¥ä¸”å¯¹ç©ºé—´å¤æ‚åº¦è¦æ±‚ä¸é«˜çš„æƒ…å†µã€‚ public class Solution { public int arrayPairSum(int[] nums) { int[] arr = new int[20001]; int lim = 10000; for (int num: nums) arr[num + lim]++; int d = 0, sum = 0; for (int i = -10000; i &lt;= 10000; i++) { sum += (arr[i + lim] + 1 - d) / 2 * i; d = (2 + arr[i + lim] - d) % 2; } return sum; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode118-æ¨è¾‰ä¸‰è§’","slug":"leetcode118-æ¨è¾‰ä¸‰è§’","date":"2019-11-15T10:05:23.000Z","updated":"2020-02-20T14:42:31.679Z","comments":true,"path":"article/leetcode118-æ¨è¾‰ä¸‰è§’/","link":"","permalink":"https://www.codetool.top/article/leetcode118-%E6%9D%A8%E8%BE%89%E4%B8%89%E8%A7%92/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•° numRowsï¼Œç”Ÿæˆæ¨è¾‰ä¸‰è§’çš„å‰ numRows è¡Œã€‚åœ¨æ¨è¾‰ä¸‰è§’ä¸­ï¼Œæ¯ä¸ªæ•°æ˜¯å®ƒå·¦ä¸Šæ–¹å’Œå³ä¸Šæ–¹çš„æ•°çš„å’Œã€‚ ç¤ºä¾‹: è¾“å…¥: 5è¾“å‡º:[ [1], [1,1], [1,2,1], [1,3,3,1],[1,4,6,4,1]] 2 è§£æ³•2.1 æ€æƒ³æ ¹æ®ä¸Šä¸€è¡Œç”Ÿæˆä¸‹ä¸€è¡Œï¼Œé¿å…é‡å¤è®¡ç®— 2.2 ä»£ç class Solution { public List&lt;List&lt;Integer>> generate(int numRows) { List&lt;Integer> row = new ArrayList(); List&lt;List&lt;Integer>> ret = new ArrayList&lt;List&lt;Integer>>(); for(int n = 0;n&lt;numRows;n++){ row = getRow(n+1,row); ret.add(row); } return ret; } //n:ç¬¬nè¡Œï¼Œnumsï¼šä¸Šä¸€è¡Œï¼ˆn-1è¡Œï¼‰çš„åˆ—è¡¨ public List&lt;Integer> getRow(int n,List&lt;Integer> nums){ List&lt;Integer> ret = new ArrayList(); ret.add(1);//ç¬¬ä¸€ä¸ª1ä¸éœ€è¦è®¡ç®— if(n==1){//ç¬¬ä¸€è¡Œç›´æ¥è¿”å› return ret; } for(int i=1;i&lt;(n+1)/2;i++){//ç”±ä¸Šä¸€è¡Œçš„æ•°ç›¸åŠ å¾—åˆ°ç»“æœ ret.add(nums.get(i-1)+nums.get(i)); } int size = n/2; for(int i=0;i&lt;size;i++){//é•œåƒå¤„ç† ret.add(ret.get(size-i-1)); } return ret; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode54-èºæ—‹çŸ©é˜µ","slug":"leetcode54-èºæ—‹çŸ©é˜µ","date":"2019-11-15T10:05:23.000Z","updated":"2020-02-20T14:42:31.679Z","comments":true,"path":"article/leetcode54-èºæ—‹çŸ©é˜µ/","link":"","permalink":"https://www.codetool.top/article/leetcode54-%E8%9E%BA%E6%97%8B%E7%9F%A9%E9%98%B5/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªåŒ…å« m x n ä¸ªå…ƒç´ çš„çŸ©é˜µï¼ˆm è¡Œ, n åˆ—ï¼‰ï¼Œè¯·æŒ‰ç…§é¡ºæ—¶é’ˆèºæ—‹é¡ºåºï¼Œè¿”å›çŸ©é˜µä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ ç¤ºä¾‹ 1: è¾“å…¥:[[ 1, 2, 3 ],[ 4, 5, 6 ],[ 7, 8, 9 ]]è¾“å‡º: [1,2,3,6,9,8,7,4,5] ç¤ºä¾‹ 2: è¾“å…¥:[[1, 2, 3, 4],[5, 6, 7, 8],[9,10,11,12]]è¾“å‡º: [1,2,3,6,9,8,7,4,5] 2 è§£æ³•2.1 æ€æƒ³æ‰¾æ‹ç‚¹è§„å¾‹å’Œç§»åŠ¨è§„å¾‹ï¼š å½“æ¨ªåæ ‡xç­‰äºçºµåæ ‡y+1æ—¶ï¼Œä¸”ä¹‹å‰æ˜¯å‘ä¸Šç§»åŠ¨çš„ï¼Œæ‹ç‚¹å‘å³ã€‚ å½“æ¨ªåæ ‡xåŠ çºµåæ ‡yç­‰äºåˆ—æ•°å‡ä¸€ï¼Œä¸”ä¹‹å‰æ˜¯å‘å³ç§»åŠ¨çš„ï¼Œæ‹ç‚¹å‘ä¸‹ã€‚ å½“è¡Œæ•°å’Œæ¨ªåæ ‡xä¹‹å·®ç­‰äºåˆ—æ•°ä¸çºµåæ ‡yä¹‹å·®æ—¶ï¼Œä¸”ä¹‹å‰æ˜¯å‘ä¸‹ç§»åŠ¨çš„ï¼Œæ‹ç‚¹å‘å·¦ã€‚ å½“æ¨ªåæ ‡xåŠ çºµåæ ‡yç­‰äºè¡Œæ•°å‡ä¸€ï¼Œä¸”ä¹‹å‰æ˜¯å‘å·¦ç§»åŠ¨çš„ï¼Œæ‹ç‚¹å‘ä¸Šã€‚ å½“ä¸æ»¡è¶³ä¸Šè¿°æ‹ç‚¹æƒ…å†µæ—¶ï¼Œåæ ‡ä¼šéšç€ä¹‹å‰çš„è¿åŠ¨æ–¹å‘ç»§ç»­è¿åŠ¨ã€‚å¯ä»¥è®¾ç½®ä»£è¡¨å››ä¸ªæ–¹å‘è¿åŠ¨çŠ¶æ€çš„å¸ƒå°”å€¼æ¥è®°å½•è¿åŠ¨çŠ¶æ€ã€‚ 2.2 ä»£ç class Solution { public List&lt;Integer> spiralOrder(int[][] matrix) { if(matrix==null) return null; int x = matrix.length; List&lt;Integer> ret = new ArrayList&lt;Integer>(); if(x==0) return ret; int y = matrix[0].length;//è·å–äºŒç»´æ•°ç»„çš„è¡Œæ•°å’Œåˆ—æ•°ï¼Œæ’é™¤nullå’Œç©ºæƒ…å†µã€‚ int x_now=0,y_now=0; int size = x*y; //ä»£è¡¨å‘å„ä¸ªæ–¹å‘ç§»åŠ¨çš„å¸ƒå°”å€¼ã€‚ boolean toRight=true,toLeft=false,toTop=false,toBottom=false; for(int i=0;i&lt;size;i++) { ret.add(matrix[x_now][y_now]); if(x_now==y_now+1&amp;&amp;toTop) {//æ‹å‘å³ toRight=true; toTop=false; }else if(y_now==y-x_now-1&amp;&amp;toRight) {//æ‹å‘ä¸‹ toBottom=true; toRight=false; }else if(x-x_now==y-y_now&amp;&amp;toBottom){//æ‹å‘å·¦ toLeft=true; toBottom=false; }else if(x_now==x-y_now-1&amp;&amp;toLeft) {//æ‹å‘ä¸Š toTop=true; toLeft=false; } //ç§»åŠ¨åæ ‡ if(toRight) y_now++; if(toLeft) y_now--; if(toTop) x_now--; if(toBottom) x_now++; } return ret; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode67-äºŒè¿›åˆ¶æ±‚å’Œ","slug":"leetcode67-äºŒè¿›åˆ¶æ±‚å’Œ","date":"2019-11-15T10:05:23.000Z","updated":"2020-02-20T14:42:31.680Z","comments":true,"path":"article/leetcode67-äºŒè¿›åˆ¶æ±‚å’Œ/","link":"","permalink":"https://www.codetool.top/article/leetcode67-%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%B1%82%E5%92%8C/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸¤ä¸ªäºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œè¿”å›ä»–ä»¬çš„å’Œï¼ˆç”¨äºŒè¿›åˆ¶è¡¨ç¤ºï¼‰ã€‚ è¾“å…¥ä¸ºéç©ºå­—ç¬¦ä¸²ä¸”åªåŒ…å«æ•°å­— 1 å’Œ 0ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: a = â€œ11â€, b = â€œ1â€è¾“å‡º: â€œ100â€ ç¤ºä¾‹ 2: è¾“å…¥: a = â€œ1010â€, b = â€œ1011â€è¾“å‡º: â€œ10101â€ 2 è§£æ³•2.1 æ€æƒ³é€šè¿‡åŠ æ³•è§„åˆ™å®ç°ï¼Œåº”æ³¨æ„è¿›ä½çš„å¤„ç†å’Œå­—ç¬¦çš„å¤„ç†ã€‚ä¸ç¡®å®šæœ€åçš„ç»“æœæ˜¯å¦ä¼šå¤šå‡ºä¸€ä½è¿›ä½ï¼Œæ‰€ä»¥ä¼šæœ‰ 2 ç§å¤„ç†æ–¹å¼ï¼š ç¬¬ä¸€ç§ï¼Œåœ¨è¿›è¡Œè®¡ç®—æ—¶ç›´æ¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªåå‘å­—ç¬¦ï¼Œéœ€è¦æœ€åå†è¿›è¡Œç¿»è½¬ ç¬¬äºŒç§ï¼ŒæŒ‰ç…§ä½ç½®ç»™ç»“æœå­—ç¬¦èµ‹å€¼ï¼Œæœ€åå¦‚æœæœ‰è¿›ä½ï¼Œåˆ™åœ¨å‰æ–¹è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥æ·»åŠ è¿›ä½ 2.2 ä»£ç  copyäº†@çµé­‚ç”»å¸ˆç‰§ç ï¼ˆguanpengchnï¼‰çš„æ€è·¯ï¼š class Solution { public String addBinary(String a, String b) { StringBuilder ans = new StringBuilder(); int ca = 0;//è¿›ä½å€¼ for(int i = a.length() - 1, j = b.length() - 1;i >= 0 || j >= 0; i--, j--) { int sum = ca; //å°†æ•°ç»„é•¿åº¦ä¸å¤Ÿçš„æƒ…å†µä¸€èˆ¬åŒ–ï¼Œè´Ÿæ•°ä¸‹æ ‡å¯¹åº”çš„å€¼ç”¨0è®¡ç®—ã€‚ sum += i >= 0 ? a.charAt(i) - '0' : 0; sum += j >= 0 ? b.charAt(j) - '0' : 0; ans.append(sum % 2); ca = sum / 2;//å¾—åˆ°è¿›ä½ } ans.append(ca == 1 ? ca : \"\");//å¦‚æœæœ€åè¿›ä½å€¼è¿˜ä¸º1åˆ™æ·»åŠ ä¸€ä½ return ans.reverse().toString();//åè½¬å­—ç¬¦ä¸² } } è‡ªå·±åšçš„å‡Œä¹±çš„æ€è·¯ï¼š class Solution { public String addBinary(String a, String b) { //è·å–ä¸¤ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦å’Œæœ€å¤§å€¼æœ€å°å€¼ int len_a = a.length(); int len_b = b.length(); int max,min; boolean carry = false;//è¿›ä½æ ‡å¿— if( len_a &lt;= len_b ){ max = len_b; min = len_a; }else{ max = len_a; min = len_b; } char[] ret = new char[max]; for( int i = 0 ; i &lt; max ; i++ ){ char a_now = i&lt;len_a?a.charAt(len_a-1-i):'0'; char b_now = i&lt;len_b?b.charAt(len_b-1-i):'0'; //åˆ—ä¸¾æ‰€æœ‰æƒ…å†µæ‰‹åŠ¨è®¡ç®— if(a_now=='1'&amp;&amp;b_now=='1'){ ret[max-i-1] = carry?'1':'0'; carry = true; if(i==max-1){ return \"1\"+ String.valueOf(ret);//å¦‚æœå½“å‰ä¸ºé¦–ä½åˆ™åœ¨å‰é¢è¿æ¥ä¸€ä¸ª1 } }else if(a_now=='1'&amp;&amp;b_now=='0'||b_now=='1'&amp;&amp;a_now=='0'){ if(carry){ ret[max-i-1] = '0'; if(i==max-1){ return \"1\"+ String.valueOf(ret); } }else{ ret[max-i-1] = '1'; } }else if(a_now=='0'&amp;&amp;b_now=='0'){ ret[max-i-1] = carry?'1':'0'; carry = false; } } return String.valueOf(ret); } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode498-å¯¹è§’çº¿éå†","slug":"leetcode498-å¯¹è§’çº¿éå†","date":"2019-11-14T10:05:23.000Z","updated":"2020-02-20T14:42:31.679Z","comments":true,"path":"article/leetcode498-å¯¹è§’çº¿éå†/","link":"","permalink":"https://www.codetool.top/article/leetcode498-%E5%AF%B9%E8%A7%92%E7%BA%BF%E9%81%8D%E5%8E%86/","excerpt":"","text":"è¿™æ˜¯ä¸€ä¸ªZå­—å½¢ç¼–æ’é—®é¢˜ï¼ŒJEPGçš„ç¼–ç è¿‡ç¨‹ä¸­ä¹Ÿä¼šç”¨åˆ°ã€‚ 1 åŸé¢˜ç»™å®šä¸€ä¸ªå«æœ‰ M x N ä¸ªå…ƒç´ çš„çŸ©é˜µï¼ˆM è¡Œï¼ŒN åˆ—ï¼‰ï¼Œè¯·ä»¥å¯¹è§’çº¿éå†çš„é¡ºåºè¿”å›è¿™ä¸ªçŸ©é˜µä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå¯¹è§’çº¿éå†å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ç¤ºä¾‹: è¾“å…¥:[[ 1, 2, 3 ],[ 4, 5, 6 ],[ 7, 8, 9 ]]è¾“å‡º: [1,2,4,7,5,3,6,8,9]è§£é‡Š: è¯´æ˜: ç»™å®šçŸ©é˜µä¸­çš„å…ƒç´ æ€»æ•°ä¸ä¼šè¶…è¿‡ 100000 ã€‚ 2 è§£æ³•2.1 æ€æƒ³æ‰¾æ‹ç‚¹çš„è§„å¾‹ï¼š å½“æ¨ªåæ ‡xä¸º0ï¼Œçºµåæ ‡yæ˜¯å¶æ•°ï¼Œä¸”yä¸æ˜¯æœ€åä¸€åˆ—çš„æ—¶å€™ï¼Œæ‹ç‚¹å‘å³ã€‚ å½“æ¨ªåæ ‡xä¸ºæœ€åä¸€è¡Œï¼Œè‹¥è¡Œæ•°ä¸ºå¶æ•°ä¸”çºµåæ ‡yä¸ºå¥‡æ•°æˆ–è¡Œæ•°ä¸ºå¥‡æ•°ä½†çºµåæ ‡yä¸ºå¶æ•°æ—¶ï¼Œæ‹ç‚¹å‘å³ã€‚ å½“çºµåæ ‡yä¸º0ï¼Œæ¨ªåæ ‡xæ˜¯å¥‡æ•°ï¼Œä¸”xä¸æ˜¯æœ€åä¸€è¡Œçš„æ—¶å€™ï¼Œæ‹ç‚¹å‘ä¸‹ã€‚ å½“çºµåæ ‡yä¸ºæœ€åä¸€åˆ—ï¼Œè‹¥åˆ—æ•°ä¸ºå¶æ•°ä¸”æ¨ªåæ ‡xä¸ºå¶æ•°æˆ–åˆ—æ•°ä¸ºå¥‡æ•°ä½†æ¨ªåæ ‡xä¸ºå¥‡æ•°æ—¶ï¼Œæ‹ç‚¹å‘å³ã€‚ å…¶ä»–æƒ…å†µï¼Œå½“æ¨ªåæ ‡xä¸ºå¶æ•°ä¸”çºµåæ ‡yä¸ºå¥‡æ•°æˆ–xä¸ºå¥‡æ•°ä¸”yä¸ºå¶æ•°çš„æ—¶å€™ï¼Œæ‹ç‚¹å‘å·¦ä¸‹ å½“æ¨ªåæ ‡xä¸ºå¶æ•°ä¸”çºµåæ ‡yä¸ºå¶æ•°æˆ–xä¸ºå¥‡æ•°ä¸”yä¸ºå¥‡æ•°çš„æ—¶å€™ï¼Œæ‹ç‚¹å‘å³ä¸Š 2.2 ä»£ç class Solution { public int[] findDiagonalOrder(int[][] matrix) { //è·å–äºŒç»´æ•°ç»„çš„é•¿å®½ã€å¤§å° int x = matrix.length; if(x == 0) return new int[0]; int y = matrix[0].length; int size = x*y; int x_now=0,y_now=0;//è½ç‚¹ä½ç½® int[] ret = new int[size];//ç”¨äºå­˜å‚¨å¹¶è¿”å›çš„ä¸€ç»´æ•°ç»„ int i = 0; while( x_now &lt; x &amp;&amp; y_now &lt; y ){ ret[i] = matrix[x_now][y_now]; //å­˜å…¥å…ƒç´  i++; if((x_now==0&amp;&amp;y_now%2==0&amp;&amp;y_now!=y-1)||(x_now == x-1&amp;&amp;(y_now+x)%2==0)){//å‘å³ y_now += 1; }else if((y_now==0&amp;&amp;x_now%2==1&amp;&amp;x_now!=x-1)||(y_now == y-1&amp;&amp;(x_now+y)%2==1)){//å‘ä¸‹ x_now += 1; } else if((x_now+y_now)%2==0){//å‘å³ä¸Š y_now +=1; x_now -=1; }else if((x_now+y_now)%2==1){//å‘å·¦ä¸‹ y_now -=1; x_now +=1; } } return ret; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"leetcode66-åŠ ä¸€","slug":"leetcode66-åŠ ä¸€","date":"2019-11-14T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/leetcode66-åŠ ä¸€/","link":"","permalink":"https://www.codetool.top/article/leetcode66-%E5%8A%A0%E4%B8%80/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªç”±æ•´æ•°ç»„æˆçš„éç©ºæ•°ç»„æ‰€è¡¨ç¤ºçš„éè´Ÿæ•´æ•°ï¼Œåœ¨è¯¥æ•°çš„åŸºç¡€ä¸ŠåŠ ä¸€ã€‚ æœ€é«˜ä½æ•°å­—å­˜æ”¾åœ¨æ•°ç»„çš„é¦–ä½ï¼Œ æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ åªå­˜å‚¨å•ä¸ªæ•°å­—ã€‚ ä½ å¯ä»¥å‡è®¾é™¤äº†æ•´æ•° 0 ä¹‹å¤–ï¼Œè¿™ä¸ªæ•´æ•°ä¸ä¼šä»¥é›¶å¼€å¤´ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: [1,2,3]è¾“å‡º: [1,2,4]è§£é‡Š: è¾“å…¥æ•°ç»„è¡¨ç¤ºæ•°å­—123ã€‚ ç¤ºä¾‹ 2: è¾“å…¥: [4,3,2,1]è¾“å‡º: [4,3,2,2]è§£é‡Š: è¾“å…¥æ•°ç»„è¡¨ç¤ºæ•°å­—4321ã€‚ 2 è§£æ³•2.1 æ€æƒ³æ ¹æ®åŠ æ³•è§„åˆ™è¿›è¡Œè®¡ç®—ï¼Œåº”æ³¨æ„è¿›ä½çš„å¤„ç†å’Œå…¨æ˜¯9çš„ç‰¹æ®Šæƒ…å†µ 2.2 ä»£ç  è¿­ä»£ class Solution { public int[] plusOne(int[] digits) { for(int i = digits.length-1;i>=0;i--){ if(digits[i]!=9) {//ä¸éœ€è¿›ä½ digits[i] += 1; break;//ä»€ä¹ˆæ—¶å€™ä¸éœ€è¿›ä½å³å¯é€€å‡º }else { if (i == 0) {//é¦–ä½éœ€è¿›ä½çš„ç‰¹æ®Šæƒ…å†µï¼Œéœ€åˆ†é…ä¸€ä¸ªå¤§ä¸€ä½çš„æ•°ç»„ int[] ret = new int[digits.length+1]; ret[0] = 1; return ret; } digits[i] = 0;//ä¸æ˜¯é¦–ä½ï¼Œéœ€è¿›ä½ } } return digits; } } é€’å½’ class Solution { public int[] plusOne(int[] digits) { return addOneAtPos(digits, digits.length-1); } private int[] addOneAtPos(int[] num, int pos){//åœ¨posä½ä¸ŠåŠ ä¸€ if(num[pos]!=9){//ä¸éœ€è¿›ä½ num[pos]+=1; return num;//ä»€ä¹ˆæ—¶å€™ä¸éœ€è¿›ä½å³å¯è¿”å› } else if(pos>0){//ä¸æ˜¯é¦–ä½ï¼Œéœ€è¿›ä½ num[pos]=0; return addOneAtPos(num, pos-1); } else {//é¦–ä½éœ€è¿›ä½çš„ç‰¹æ®Šæƒ…å†µï¼Œéœ€åˆ†é…ä¸€ä¸ªå¤§ä¸€ä½çš„æ•°ç»„ int length = num.length; int[] newNum = new int[length+1]; newNum[0]=1; return newNum; } } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"Collectionæ¥å£ç ”ç©¶","slug":"Collectionæ¥å£ç ”ç©¶","date":"2019-11-13T10:05:23.000Z","updated":"2020-04-22T09:27:27.158Z","comments":true,"path":"article/Collectionæ¥å£ç ”ç©¶/","link":"","permalink":"https://www.codetool.top/article/Collection%E6%8E%A5%E5%8F%A3%E7%A0%94%E7%A9%B6/","excerpt":"","text":"ä»¥ä¸‹å†…å®¹åŸºäºjdk1.8 1 æ¥å£Collectionåˆ†æ img è¯¥æ¥å£å®ç°äº†æ¥å£Iterable æ–¹æ³•ï¼š 1.1 int size();è¿”å›å…ƒç´ çš„ä¸ªæ•° 1.2 boolean isEmpty();è¿”å›æ˜¯å¦ä¸ºç©º 1.3 boolean contains(Object o);è¿”å›æ˜¯å¦åŒ…å«æŸä¸ªå¯¹è±¡æŠ›å‡ºå¼‚å¸¸ï¼š @throws ClassCastException å‚æ•°ä¸å…¼å®¹ @throws NullPointerException å‚æ•°æ˜¯nullï¼Œå¹¶ä¸”å®¹å™¨ä¸å…è®¸åŒ…å«nullå…ƒç´  1.4 Object[] toArray();è¿”å›æ‰€æœ‰å…ƒç´ ç»„æˆçš„ä¸€ä¸ªæ•°ç»„æ•°ç»„æ˜¯é‡æ–°åˆ†é…ç©ºé—´å¹¶åˆ›å»ºçš„ï¼Œå®ƒçš„å…ƒç´ ä¸ä¼šç”±è¯¥å®¹å™¨ç»´æŠ¤ï¼ŒåŸæ–‡ï¼š The returned array will be â€œsafeâ€ in that no references to it are maintained by this collection. (In other words, this method must allocate a new array even if this collection is backed by an array). The caller is thus free to modify the returned array. 1.5 T[] toArray(T[] a);å¦‚æœç»™å®šçš„æ•°ç»„å¤§å°èƒ½å®¹çº³è¯¥å®¹å™¨æ‰€æœ‰å…ƒç´ ï¼Œåˆ™è¿”å›åˆ°ç»™å®šæ•°ç»„ä¸­ï¼Œå¦åˆ™ä¼šæ–°åˆ†é…ä¸€ä¸ªå¯ä»¥å®¹çº³æ‰€æœ‰å…ƒç´ çš„æ•°ç»„å¹¶è¿”å›ã€‚ List&lt;Integer> list = new ArrayList&lt;Integer>(); Integer[] a = new Integer[2]; list.add(3); list.add(5); list.toArray(a); // a = {3,5} æŠ›å‡ºå¼‚å¸¸ï¼š @throws ArrayStoreException ç»™å®šçš„æ•°ç»„è¿è¡Œç±»å‹ä¸æ˜¯è¯¥å®¹å™¨è¿è¡Œç±»å‹çš„è¶…ç±» @throws NullPointerException ç»™å®šçš„æ•°ç»„æ˜¯null 1.6 boolean add(E e);ç¡®ä¿è¯¥å®¹å™¨åŒ…å«è¯¥æŒ‡å®šçš„å…ƒç´ ï¼Œå¦‚æœå› ä¸ºè¿™ä¸ªæ“ä½œæ”¹å˜äº†å®¹å™¨å†…çš„å…ƒç´ è¿”å›trueï¼Œå¦‚æœè¯¥å®¹å™¨å·²ç»æœ‰äº†è¯¥å…ƒç´ ä¸”ä¸å…è®¸åŒ…å«é‡å¤çš„å…ƒç´ åˆ™è¿”å›false æŠ›å‡ºå¼‚å¸¸ï¼š @throws UnsupportedOperationException è¯¥å®¹å™¨ä¸æ”¯æŒè¿™ä¸ªæ“ä½œ @throws ClassCastException ç»™å®šçš„å…ƒç´ ä¸èƒ½æ·»åŠ è¿›å®¹å™¨ä¸­ @throws NullPointerException å‚æ•°æ˜¯nullï¼Œå¹¶ä¸”å®¹å™¨ä¸å…è®¸åŒ…å«nullå…ƒç´  @throws IllegalArgumentException ç»™å®šçš„å…ƒç´ çš„æŸäº›å±æ€§å†³å®šäº†å®ƒä¸èƒ½è¢«æ·»åŠ è¿›è¯¥å®¹å™¨ä¸­ @throws IllegalStateException ç”±äºæŸäº›é™åˆ¶è¯¥æ—¶é—´ä¸èƒ½æ·»åŠ è¯¥å…ƒç´  1.7 boolean remove(Object o);ç§»é™¤æŸä¸ªå…ƒç´ æŠ›å‡ºå¼‚å¸¸ï¼š @throws ClassCastException @throws NullPointerException @throws UnsupportedOperationException 1.8 boolean containsAll(Collection&lt;?&gt; c)å¦‚æœè¯¥å®¹å™¨åŒ…å«ç»™å®šçš„å®¹å™¨ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œè¿”å›trueæŠ›å‡ºå¼‚å¸¸ï¼š @throws ClassCastException @throws NullPointerException 1.9 boolean addAll(Collection&lt;? extends E&gt; c)å°†ç»™å®šå®¹å™¨ä¸­çš„æ‰€æœ‰å…ƒç´ æ’å…¥åˆ°è¯¥å®¹å™¨ä¸­æŠ›å‡ºå¼‚å¸¸ï¼š @throws UnsupportedOperationException @throws ClassCastException @throws NullPointerException @throws IllegalArgumentException @throws IllegalStateException 1.10 boolean removeAll(Collection&lt;?&gt; c)å°†è¯¥å®¹å™¨å’Œç»™å®šå®¹å™¨ä¸­å…±æœ‰çš„å…ƒç´ ä»è¯¥å®¹å™¨ä¸­åˆ é™¤æŠ›å‡ºå¼‚å¸¸ï¼š @throws UnsupportedOperationException @throws ClassCastException @throws NullPointerException 1.11 default boolean removeIf(Predicate&lt;? super E&gt; filter)Predicateæ˜¯JAVA8æ–°å¢çš„ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼ˆæŒ‡å¦‚æœå¡«å†™lambdaè¡¨è¾¾å¼åˆ™é»˜è®¤å®ç°Predicateçš„testæ–¹æ³•ï¼‰ï¼Œè¿™ä¸ªæ–¹æ³•åˆ é™¤æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œå¦‚æœæˆåŠŸè¿”å›true? super EæŒ‡çš„æ˜¯Eæˆ–Eçš„çˆ¶ç±»é»˜è®¤å®ç°ï¼š default boolean removeIf(Predicate&lt;? super E> filter) { Objects.requireNonNull(filter); boolean removed = false; final Iterator&lt;E> each = iterator(); while (each.hasNext()) { if (filter.test(each.next())) { each.remove(); removed = true; } } return removed; } è°ƒç”¨å®ä¾‹ï¼š Integer[] nums = {1,2,3,4,5,6}; ArrayList&lt;Integer> list = new ArrayList&lt;Integer>(Arrays.asList(nums)); list.removeIf(num->num>3?true:false);//åˆ é™¤listä¸­å¤§äº3çš„å…ƒç´  //è¿™é‡Œçš„lambdaè¡¨è¾¾å¼æ˜¯ç®€åŒ–çš„å†™æ³•ï¼Œå°†lambdaè¡¨è¾¾å¼å®Œæ•´çš„å†™æ³•æ˜¯list.removeIf((Integer num)->{return num>3?true:false;}); æŠ›å‡ºå¼‚å¸¸ï¼š @throws NullPointerException @throws UnsupportedOperationException è¿™ä¸ªå…ƒç´ ä¸èƒ½è¢«åˆ é™¤ 1.12 boolean retainAll(Collection&lt;?&gt; c);ä»…ä¿ç•™ç»™å®šé›†åˆä¸­çš„å…ƒç´ ï¼Œåˆ é™¤å…¶ä»–å…ƒç´ ã€‚ æŠ›å‡ºå¼‚å¸¸ï¼š @throws UnsupportedOperationException @throws ClassCastException @throws NullPointerException 1.13 void clear();ç§»é™¤æ‰€æœ‰å…ƒç´ ã€‚ æŠ›å‡ºå¼‚å¸¸ï¼š @throws UnsupportedOperationException 1.14 default Stream stream();è¿”å›ä¸€ä¸ªåºåˆ—æµã€‚é»˜è®¤å®ç°ï¼š default Stream&lt;E> stream() { return StreamSupport.stream(spliterator(), false); } 1.15 default Stream parallelStream();è¿”å›ä¸€ä¸ªå¹¶è¡Œæµã€‚é»˜è®¤å®ç°ï¼š default Stream&lt;E> parallelStream() { return StreamSupport.stream(spliterator(), true); }","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"java","slug":"java","permalink":"https://www.codetool.top/tags/java/"},{"name":"jdk","slug":"jdk","permalink":"https://www.codetool.top/tags/jdk/"}]},{"title":"leetcode724-å¯»æ‰¾æ•°ç»„çš„ä¸­å¿ƒç´¢å¼•","slug":"leetcode724-å¯»æ‰¾æ•°ç»„çš„ä¸­å¿ƒç´¢å¼•","date":"2019-11-13T10:05:23.000Z","updated":"2020-02-20T14:42:31.679Z","comments":true,"path":"article/leetcode724-å¯»æ‰¾æ•°ç»„çš„ä¸­å¿ƒç´¢å¼•/","link":"","permalink":"https://www.codetool.top/article/leetcode724-%E5%AF%BB%E6%89%BE%E6%95%B0%E7%BB%84%E7%9A%84%E4%B8%AD%E5%BF%83%E7%B4%A2%E5%BC%95/","excerpt":"","text":"1 åŸé¢˜ç»™å®šä¸€ä¸ªæ•´æ•°ç±»å‹çš„æ•°ç»„numsï¼Œè¯·ç¼–å†™ä¸€ä¸ªèƒ½å¤Ÿè¿”å›æ•°ç»„â€œä¸­å¿ƒç´¢å¼•â€çš„æ–¹æ³•ã€‚ æˆ‘ä»¬æ˜¯è¿™æ ·å®šä¹‰æ•°ç»„ä¸­å¿ƒç´¢å¼•çš„ï¼šæ•°ç»„ä¸­å¿ƒç´¢å¼•çš„å·¦ä¾§æ‰€æœ‰å…ƒç´ ç›¸åŠ çš„å’Œç­‰äºå³ä¾§æ‰€æœ‰å…ƒç´ ç›¸åŠ çš„å’Œã€‚ å¦‚æœæ•°ç»„ä¸å­˜åœ¨ä¸­å¿ƒç´¢å¼•ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥è¿”å› -1ã€‚å¦‚æœæ•°ç»„æœ‰å¤šä¸ªä¸­å¿ƒç´¢å¼•ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥è¿”å›æœ€é è¿‘å·¦è¾¹çš„é‚£ä¸€ä¸ªã€‚ ç¤ºä¾‹ 1: è¾“å…¥:nums = [1, 7, 3, 6, 5, 6]è¾“å‡º: 3è§£é‡Š:ç´¢å¼•3 (nums[3] = 6) çš„å·¦ä¾§æ•°ä¹‹å’Œ(1 + 7 + 3 = 11)ï¼Œä¸å³ä¾§æ•°ä¹‹å’Œ(5 + 6 = 11)ç›¸ç­‰ã€‚åŒæ—¶, 3 ä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„ä¸­å¿ƒç´¢å¼•ã€‚ ç¤ºä¾‹ 2: è¾“å…¥:nums = [1, 2, 3]è¾“å‡º: -1è§£é‡Š:æ•°ç»„ä¸­ä¸å­˜åœ¨æ»¡è¶³æ­¤æ¡ä»¶çš„ä¸­å¿ƒç´¢å¼•ã€‚ è¯´æ˜: numsçš„é•¿åº¦èŒƒå›´ä¸º [0, 10000]ã€‚ ä»»ä½•ä¸€ä¸ª nums[i] å°†ä¼šæ˜¯ä¸€ä¸ªèŒƒå›´åœ¨ [-1000, 1000]çš„æ•´æ•°ã€‚ 2 è§£æ³•2.1 æ€æƒ³é¿å…é‡å¤è®¡ç®—ï¼Œå…ˆè®¡ç®—å®Œæ•°ç»„æ‰€æœ‰å…ƒç´ ä¹‹å’Œï¼Œå†åˆ’åˆ†ä¸ºä¸¤æ•°ä¹‹å’Œçš„é—®é¢˜ã€‚ 2.2 ä»£ç class Solution { public int pivotIndex(int[] nums) { int i; int frontRet = 0, endRet = 0; //è®¡ç®—æ‰€æœ‰å…ƒç´ æ€»å’Œ for (int k = 0; k &lt; nums.length; k++) { endRet += nums[k]; } //ä»å·¦å‘å³è¯•æ¢ï¼Œè®¡ç®—ä¸¤éƒ¨åˆ†çš„å€¼ for (i = 0; i &lt; nums.length; i++) { endRet -= nums[i]; if (frontRet == endRet) { break; } frontRet += nums[i]; } if ((i &lt; 0) || (i >= nums.length)) { i = -1; } return i; } }","categories":[{"name":"ç®—æ³•/æ•°æ®ç»“æ„","slug":"ç®—æ³•-æ•°æ®ç»“æ„","permalink":"https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"leetcode","slug":"leetcode","permalink":"https://www.codetool.top/tags/leetcode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"23ç§è®¾è®¡æ¨¡å¼å½’çº³","slug":"23ç§è®¾è®¡æ¨¡å¼å½’çº³","date":"2019-11-08T10:05:23.000Z","updated":"2020-02-21T14:38:05.956Z","comments":true,"path":"article/23ç§è®¾è®¡æ¨¡å¼å½’çº³/","link":"","permalink":"https://www.codetool.top/article/23%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%BD%92%E7%BA%B3/","excerpt":"","text":"1 å‚è€ƒæ–‡æ¡£ 23ç§è®¾è®¡æ¨¡å¼å…¨è§£æ - codeTao - åšå®¢å›­ è®¾è®¡æ¨¡å¼ï¼ˆåˆ›å»ºå‹ï¼‰ - å…«ä¸€é±¼ - åšå®¢å›­ è®¾è®¡æ¨¡å¼ï¼ˆç»“æ„å‹ï¼‰ - å…«ä¸€é±¼ - åšå®¢å›­ ä»£ç†æ¨¡å¼å’Œè£…é¥°è€…æ¨¡å¼çš„åŒºåˆ« - å¤œçš„ç¬¬å…«ç«  - åšå®¢å›­ ç®€è¯´è®¾è®¡æ¨¡å¼â€”â€”äº«å…ƒæ¨¡å¼ - JAdam - åšå®¢å›­ 2 è®¾è®¡æ¨¡å¼çš„åˆ†ç±» ç±»æ¨¡å¼å¤„ç†ç±»ä¸å­ç±»çš„å…³ç³»ï¼Œé€šè¿‡å¤„ç†è¿™äº›å…³ç³»æ¥å»ºç«‹ç»§æ‰¿ï¼Œå±äºé™æ€å…³ç³»ï¼Œåœ¨ç¼–è¯‘æ—¶å€™ç¡®å®šä¸‹æ¥ï¼›å¯¹è±¡æ¨¡å¼å¤„ç†å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼Œè¿è¡Œæ—¶å‘ç”Ÿå˜åŒ–ï¼Œå±äºåŠ¨æ€å…³ç³»ã€‚ 2.1 åˆ›å»ºå‹æ¨¡å¼ å·¥å‚æ–¹æ³•æ¨¡å¼ æŠ½è±¡å·¥å‚æ¨¡å¼ å•ä¾‹æ¨¡å¼ å»ºé€ è€…æ¨¡å¼ åŸå‹æ¨¡å¼ 2.2 ç»“æ„å‹æ¨¡å¼ é€‚é…å™¨æ¨¡å¼ è£…é¥°å™¨æ¨¡å¼ ä»£ç†æ¨¡å¼ å¤–è§‚æ¨¡å¼ æ¡¥æ¥æ¨¡å¼ ç»„åˆæ¨¡å¼ äº«å…ƒæ¨¡å¼ 2.3 è¡Œä¸ºå‹æ¨¡å¼ ç­–ç•¥æ¨¡å¼ æ¨¡æ¿æ–¹æ³•æ¨¡å¼ è§‚å¯Ÿè€…æ¨¡å¼ è¿­ä»£å™¨æ¨¡å¼ è´£ä»»é“¾æ¨¡å¼ å‘½ä»¤æ¨¡å¼ å¤‡å¿˜å½•æ¨¡å¼ çŠ¶æ€æ¨¡å¼ è®¿é—®è€…æ¨¡å¼ ä¸­ä»‹è€…æ¨¡å¼ è§£é‡Šå™¨æ¨¡å¼ 3 è®¾è®¡æ¨¡å¼éµå®ˆçš„è®¾è®¡åŸåˆ™ä¹Ÿæ˜¯ç±»çš„è®¾è®¡éµå®ˆçš„åŸåˆ™ 3.1 å•ä¸€èŒè´£åŸåˆ™SRPæ¯ä¸ªç±»åªåšä¸€ä»¶äº‹ï¼Œä½†è¯¥åŸåˆ™ä¹Ÿä¸é€‚ç”¨äºèšåˆç±»ã€‚ èšåˆç±»éœ€è¦ä¼˜å…ˆä½¿ç”¨å¯¹è±¡ç»„åˆï¼Œè€Œä¸æ˜¯ç±»ç»§æ‰¿ 3.2 é‡Œæ°æ›¿æ¢åŸåˆ™LSP å­ç±»çš„å¯¹è±¡æä¾›äº†çˆ¶ç±»çš„æ‰€æœ‰è¡Œä¸ºï¼Œä¸”åŠ ä¸Šå­ç±»é¢å¤–çš„ä¸€äº›ä¸œè¥¿ï¼ˆå¯ä»¥æ˜¯åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥æ˜¯å±æ€§ï¼‰ å½“ç¨‹åºåŸºäºçˆ¶ç±»å®ç°æ—¶ï¼Œå¦‚æœå°†å­ç±»æ›¿æ¢çˆ¶ç±»è€Œç¨‹åºä¸éœ€è¦ä¿®æ”¹ï¼Œåˆ™è¯´æ˜ç¬¦åˆLSPåŸåˆ™ å­ç±»å¿…é¡»èƒ½æ›¿æ¢æˆå®ƒä»¬çš„çˆ¶ç±» 3.3 ä¾èµ–å€’ç½®åŸåˆ™DIPä¹Ÿå«ä¾èµ–åè½¬åŸåˆ™ã€‚ é«˜å±‚æ¨¡å—ä¸åº”è¯¥ç›´æ¥ä¾èµ–ä½å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–æŠ½è±¡å±‚ã€‚ æŠ½è±¡ä¸èƒ½ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚å¿…é¡»ä¾èµ–æŠ½è±¡ã€‚ 3.4 æ¥å£éš”ç¦»åŸåˆ™ISP å®¢æˆ·ç«¯ä¸åº”è¯¥è¢«å¼ºè¿«å»ä¾èµ–å®ƒä»¬å¹¶ä¸éœ€è¦çš„æ¥å£ ä¸æ»¡è¶³ISPçš„ç±»åº”è¯¥æ‹†åˆ†æˆå¤šä¸ªæ¥å£ï¼Œ é€šè¿‡ä¸€ä¸ªæŠ½è±¡ç±»å»å®ç°å®ƒä»¬ï¼Œå†å»ç»§æ‰¿è¿™ä¸ªæŠ½è±¡çˆ¶ç±»ã€‚ 3.5 å¼€é—­åŸåˆ™ å¯¹æ‹“å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­ å¯¹ä½¿ç”¨è€…ä¿®æ”¹å…³é—­ï¼Œå¯¹æä¾›è€…æ‹“å±•å¼€æ”¾ 4 åˆ›å»ºå‹æ¨¡å¼è§£æ åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œåˆ›å»ºå‹æ¨¡å¼æ˜¯å¤„ç†å¯¹è±¡åˆ›å»ºçš„è®¾è®¡æ¨¡å¼ï¼Œè¯•å›¾æ ¹æ®å®é™…æƒ…å†µä½¿ç”¨åˆé€‚çš„æ–¹å¼åˆ›å»ºå¯¹è±¡ã€‚åŸºæœ¬çš„å¯¹è±¡åˆ›å»ºæ–¹å¼å¯èƒ½ä¼šå¯¼è‡´è®¾è®¡ä¸Šçš„é—®é¢˜ï¼Œæˆ–å¢åŠ è®¾è®¡çš„å¤æ‚åº¦ã€‚åˆ›å»ºå‹æ¨¡å¼é€šè¿‡ä»¥æŸç§æ–¹å¼æ§åˆ¶å¯¹è±¡çš„åˆ›å»ºæ¥è§£å†³é—®é¢˜ã€‚ 4.1 å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆç±»ï¼‰ åˆ›å»ºä¸€ä¸ªå·¥å‚æ¥å£å’Œåˆ›å»ºå¤šä¸ªå·¥å‚å®ç°ç±» 4.2 æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆå¯¹è±¡ï¼‰ åŒºåˆ«ï¼š å·¥å‚æ–¹æ³•æ¨¡å¼åªæœ‰ä¸€ä¸ªæŠ½è±¡äº§å“ç±»ï¼Œè€ŒæŠ½è±¡å·¥å‚æ¨¡å¼æœ‰å¤šä¸ªã€‚å·¥å‚æ–¹æ³•æ¨¡å¼çš„å…·ä½“å·¥å‚ç±»åªèƒ½åˆ›å»ºä¸€ä¸ªå…·ä½“äº§å“ç±»çš„å®ä¾‹ï¼Œè€ŒæŠ½è±¡å·¥å‚æ¨¡å¼å¯ä»¥åˆ›å»ºå¤šä¸ªã€‚å·¥å‚æ–¹æ³•åˆ›å»º â€œä¸€ç§â€ äº§å“ï¼Œä»–çš„ç€é‡ç‚¹åœ¨äºâ€æ€ä¹ˆåˆ›å»ºâ€ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ å¼€å‘ï¼Œä½ çš„å¤§é‡ä»£ç å¾ˆå¯èƒ½å›´ç»•ç€è¿™ç§äº§å“çš„æ„é€ ï¼Œåˆå§‹åŒ–è¿™äº›ç»†èŠ‚ä¸Šé¢ã€‚ä¹Ÿå› ä¸ºå¦‚æ­¤ï¼Œç±»ä¼¼çš„äº§å“ä¹‹é—´æœ‰å¾ˆå¤šå¯ä»¥å¤ç”¨çš„ç‰¹å¾ï¼Œæ‰€ä»¥ä¼šå’Œæ¨¡ç‰ˆæ–¹æ³•ç›¸éšã€‚ æŠ½è±¡å·¥å‚éœ€è¦åˆ›å»ºä¸€äº›åˆ—äº§å“ï¼Œç€é‡ç‚¹åœ¨äºâ€åˆ›å»ºå“ªäº›â€äº§å“ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ å¼€å‘ï¼Œä½ çš„ä¸»è¦ä»»åŠ¡æ˜¯åˆ’åˆ†ä¸åŒå·®å¼‚çš„äº§å“çº¿ï¼Œå¹¶ä¸”å°½é‡ä¿æŒæ¯æ¡äº§å“çº¿æ¥å£ä¸€è‡´ï¼Œä»è€Œå¯ä»¥ä»åŒä¸€ä¸ªæŠ½è±¡å·¥å‚ç»§æ‰¿ã€‚ æŠ½è±¡å·¥å‚æ¨¡å¼åŒ…å«å¦‚ä¸‹è§’è‰²ï¼š AbstractFactoryï¼šæŠ½è±¡å·¥å‚ ConcreteFactoryï¼šå…·ä½“å·¥å‚ AbstractProductï¼šæŠ½è±¡äº§å“ Productï¼šå…·ä½“äº§å“ 4.3 å•ä¾‹æ¨¡å¼ï¼ˆå¯¹è±¡ï¼‰ åœ¨ä¸€ä¸ªJVMä¸­ï¼Œè¯¥ç±»åªæœ‰ä¸€ä¸ªå¯¹è±¡å®ä¾‹å­˜åœ¨ã€‚ public class Singleton { /* æŒæœ‰ç§æœ‰é™æ€å®ä¾‹ï¼Œé˜²æ­¢è¢«å¼•ç”¨ï¼Œæ­¤å¤„èµ‹å€¼ä¸ºnullï¼Œç›®çš„æ˜¯å®ç°å»¶è¿ŸåŠ è½½ */ private static Singleton instance = null; /* ç§æœ‰æ„é€ æ–¹æ³•ï¼Œé˜²æ­¢è¢«å®ä¾‹åŒ– */ private Singleton() { } /* é™æ€å·¥ç¨‹æ–¹æ³•ï¼Œåˆ›å»ºå®ä¾‹ */ public static Singleton getInstance() { if (instance == null) { instance = new Singleton(); } return instance; } /* å¦‚æœè¯¥å¯¹è±¡è¢«ç”¨äºåºåˆ—åŒ–ï¼Œå¯ä»¥ä¿è¯å¯¹è±¡åœ¨åºåˆ—åŒ–å‰åä¿æŒä¸€è‡´ */ public Object readResolve() { return instance; } } å¤šçº¿ç¨‹ä¸‹çš„ä¼˜åŒ–ï¼š public class Singleton { /* ç§æœ‰æ„é€ æ–¹æ³•ï¼Œé˜²æ­¢è¢«å®ä¾‹åŒ– */ private Singleton() { } /* æ­¤å¤„ä½¿ç”¨ä¸€ä¸ªå†…éƒ¨ç±»æ¥ç»´æŠ¤å•ä¾‹ */ private static class SingletonFactory { private static Singleton instance = new Singleton(); } /* è·å–å®ä¾‹ */ public static Singleton getInstance() { return SingletonFactory.instance; } /* å¦‚æœè¯¥å¯¹è±¡è¢«ç”¨äºåºåˆ—åŒ–ï¼Œå¯ä»¥ä¿è¯å¯¹è±¡åœ¨åºåˆ—åŒ–å‰åä¿æŒä¸€è‡´ */ public Object readResolve() { return getInstance(); } } åŸç†ï¼š JVMå†…éƒ¨çš„æœºåˆ¶èƒ½å¤Ÿä¿è¯å½“ä¸€ä¸ªç±»è¢«åŠ è½½çš„æ—¶å€™ï¼Œè¿™ä¸ªç±»çš„åŠ è½½è¿‡ç¨‹æ˜¯çº¿ç¨‹äº’æ–¥çš„ã€‚è¿™æ ·å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡è°ƒç”¨getInstanceçš„æ—¶å€™ï¼ŒJVMèƒ½å¤Ÿå¸®æˆ‘ä»¬ä¿è¯instanceåªè¢«åˆ›å»ºä¸€æ¬¡ï¼Œå¹¶ä¸”ä¼šä¿è¯æŠŠèµ‹å€¼ç»™instanceçš„å†…å­˜åˆå§‹åŒ–å®Œæ¯• 4.4 å»ºé€ è€…æ¨¡å¼ï¼ˆå¯¹è±¡ï¼‰ åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œä¹Ÿå­˜åœ¨å¤§é‡ç±»ä¼¼æ±½è½¦ä¸€æ ·çš„å¤æ‚å¯¹è±¡ï¼Œå®ƒä»¬æ‹¥æœ‰ä¸€ç³»åˆ—æˆå‘˜å±æ€§ï¼Œè¿™äº›æˆå‘˜å±æ€§ä¸­æœ‰äº›æ˜¯å¼•ç”¨ç±»å‹çš„æˆå‘˜å¯¹è±¡ã€‚è€Œä¸”åœ¨è¿™äº›å¤æ‚å¯¹è±¡ä¸­ï¼Œè¿˜å¯èƒ½å­˜åœ¨ä¸€äº›é™åˆ¶æ¡ä»¶ï¼Œå¦‚æŸäº›å±æ€§æ²¡æœ‰èµ‹å€¼åˆ™å¤æ‚å¯¹è±¡ä¸èƒ½ä½œä¸ºä¸€ä¸ªå®Œæ•´çš„äº§å“ä½¿ç”¨ï¼›æœ‰äº›å±æ€§çš„èµ‹å€¼å¿…é¡»æŒ‰ç…§æŸä¸ªé¡ºåºï¼Œä¸€ä¸ªå±æ€§æ²¡æœ‰èµ‹å€¼ä¹‹å‰ï¼Œå¦ä¸€ä¸ªå±æ€§å¯èƒ½æ— æ³•èµ‹å€¼ç­‰ã€‚ å»ºé€ è€…æ¨¡å¼åŒ…å«å¦‚ä¸‹è§’è‰²ï¼š Builderï¼šæŠ½è±¡å»ºé€ è€… ConcreteBuilderï¼šå…·ä½“å»ºé€ è€… Directorï¼šæŒ‡æŒ¥è€… Productï¼šäº§å“è§’è‰² Directorçš„ä½œç”¨ï¼š éš”ç¦»å®¢æˆ·ä¸ç”Ÿäº§è¿‡ç¨‹ã€‚ è´Ÿè´£æ§åˆ¶äº§å“çš„ç”Ÿæˆè¿‡ç¨‹ã€‚ public class Meal { private String food; private String drink; public String getFood() { return food; } public void setFood(String food) { this.food = food; } public String getDrink() { return drink; } public void setDrink(String drink) { this.drink = drink; } } public abstract class MealBuilder { Meal meal = new Meal(); public abstract void buildFood(); public abstract void buildDrink(); public Meal getMeal(){ return meal; } } public class MealA extends MealBuilder{ public void buildDrink() { meal.setDrink(\"å¯ä¹\"); } public void buildFood() { meal.setFood(\"è–¯æ¡\"); } } public class KFCWaiter { private MealBuilder mealBuilder; public KFCWaiter(MealBuilder mealBuilder) { this.mealBuilder = mealBuilder; } public Meal construct(){ //å‡†å¤‡é£Ÿç‰© mealBuilder.buildFood(); //å‡†å¤‡é¥®æ–™ mealBuilder.buildDrink(); //å‡†å¤‡å®Œæ¯•ï¼Œè¿”å›ä¸€ä¸ªå®Œæ•´çš„å¥—é¤ç»™å®¢æˆ· return mealBuilder.getMeal(); } } 4.5 åŸå‹æ¨¡å¼ï¼ˆå¯¹è±¡ï¼‰ æœ‰äº›å¯¹è±¡æ˜¯éœ€è¦é¢‘ç¹åˆ›å»ºçš„ï¼Œç”¨åŸå‹å®ä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç±»å‹ï¼Œå¹¶ä¸”é€šè¿‡æ‹·è´è¿™ä¸ªåŸå‹æ¥åˆ›å»ºæ–°çš„åŒç±»å‹çš„å¯¹è±¡ï¼Œåˆ†ä¸ºæµ…å…‹éš†å’Œæ·±å…‹éš†ï¼Œæµ…å…‹éš†åªå¤åˆ¶æ‹·è´çš„å¯¹è±¡ï¼Œä¸å¤åˆ¶å¼•ç”¨çš„å¯¹è±¡ï¼Œå³æˆå‘˜å¯¹è±¡ä¸å¤åˆ¶ï¼›æ·±å…‹éš†ï¼Œå¼•ç”¨ä¹ŸåŒæ ·å¤åˆ¶ã€‚ public class Prototype implements Cloneable, Serializable { private static final long serialVersionUID = 1L; private String string; private SerializableObject obj; /* æµ…å¤åˆ¶ */ public Object clone() throws CloneNotSupportedException { Prototype proto = (Prototype) super.clone(); /* super.clone()æ˜¯æµ…å¤åˆ¶ */ return proto; } /* æ·±å¤åˆ¶ */ public Object deepClone() throws IOException, ClassNotFoundException { /* å†™å…¥å½“å‰å¯¹è±¡çš„äºŒè¿›åˆ¶æµ */ ByteArrayOutputStream bos = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(bos); oos.writeObject(this); /* è¯»å‡ºäºŒè¿›åˆ¶æµäº§ç”Ÿçš„æ–°å¯¹è±¡ */ ByteArrayInputStream bis = new ByteArrayInputStream(bos.toByteArray()); ObjectInputStream ois = new ObjectInputStream(bis); return ois.readObject(); } public String getString() { return string; } public void setString(String string) { this.string = string; } public SerializableObject getObj() { return obj; } public void setObj(SerializableObject obj) { this.obj = obj; } } class SerializableObject implements Serializable { private static final long serialVersionUID = 1L; } 5 ç»“æ„å‹æ¨¡å¼è§£æç»“æ„å‹æ¨¡å¼ä¸»è¦ç”¨äºå¤„ç†ç±»å’Œå¯¹è±¡çš„ç»„åˆ 5.1 é€‚é…å™¨æ¨¡å¼ï¼ˆç±»å’Œå¯¹è±¡ï¼‰ å°†ä¸€ä¸ªæ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œä»è€Œä½¿æ¥å£ä¸å…¼å®¹çš„é‚£äº›ç±»å¯ä»¥åœ¨ä¸€èµ·å·¥ä½œã€‚ 5.1.1 ç±»çš„é€‚é…å™¨æ¨¡å¼ é€šè¿‡ä¸€ä¸ªå…·ä½“çš„ç±»ï¼Œå°†é€‚é…è€…é€‚é…åˆ°ç›®æ ‡æ¥å£å½“ä¸­ public class Source { public void method1() { System.out.println(\"this is original method!\"); } } public interface Targetable { /* ä¸åŸç±»ä¸­çš„æ–¹æ³•ç›¸åŒ */ public void method1(); /* æ–°ç±»çš„æ–¹æ³• */ public void method2(); } public class Adapter extends Source implements Targetable { @Override public void method2() { System.out.println(\"this is the targetable method!\"); } } public class AdapterTest { public static void main(String[] args) { Targetable target = new Adapter(); target.method1(); target.method2(); } } 5.1.2 å¯¹è±¡çš„é€‚é…å™¨æ¨¡å¼ ä¸€ä¸ªé€‚é…å™¨å¯ä»¥å°†å¤šä¸ªä¸åŒçš„é€‚é…è€…é€‚é…åˆ°åŒä¸€ç›®æ ‡ public class Wrapper implements Targetable { private Source source; public Wrapper(Source source){ super(); this.source = source; } @Override public void method2() { System.out.println(\"this is the targetable method!\"); } @Override public void method1() { source.method1(); } } 5.2 è£…é¥°è€…æ¨¡å¼ï¼ˆå¯¹è±¡ï¼‰ ç»™ä¸€ä¸ªå¯¹è±¡å¢åŠ ä¸€äº›æ–°çš„åŠŸèƒ½ï¼Œè€Œä¸”æ˜¯åŠ¨æ€çš„ï¼Œè¦æ±‚è£…é¥°å¯¹è±¡å’Œè¢«è£…é¥°å¯¹è±¡å®ç°åŒä¸€ä¸ªæ¥å£ï¼Œè£…é¥°å¯¹è±¡æŒæœ‰è¢«è£…é¥°å¯¹è±¡çš„å®ä¾‹ //Sourceable public interface Sourceable { public void method(); } //Source public class Source implements Sourceable { @Override public void method() { System.out.println(\"the original method!\"); } } //Decorator public class Decorator implements Sourceable { private Sourceable source; public Decorator(Sourceable source){ super(); this.source = source; } @Override public void method() { System.out.println(\"before decorator!\"); source.method(); System.out.println(\"after decorator!\"); } } æˆ‘å¯»æ€æœ‰ç‚¹åƒservletçš„è¿‡æ»¤å™¨ 5.3 ä»£ç†æ¨¡å¼ï¼ˆå¯¹è±¡ï¼‰ å¤šä¸€ä¸ªä»£ç†ç±»å‡ºæ¥ï¼Œæ›¿åŸå¯¹è±¡è¿›è¡Œä¸€äº›æ“ä½œ public interface Sourceable { public void method(); } public class Source implements Sourceable { @Override public void method() { System.out.println(\"the original method!\"); } } public class Proxy implements Sourceable { private Source source; public Proxy(){ super(); this.source = new Source(); } @Override public void method() { before(); source.method(); atfer(); } private void atfer() { System.out.println(\"after proxy!\"); } private void before() { System.out.println(\"before proxy!\"); } } è£…é¥°è€…æ¨¡å¼å’Œä»£ç†æ¨¡å¼çš„åŒºåˆ«ï¼š è£…é¥°å™¨æ¨¡å¼å…³æ³¨äºåœ¨ä¸€ä¸ªå¯¹è±¡ä¸ŠåŠ¨æ€çš„æ·»åŠ æ–¹æ³•ï¼Œç„¶è€Œä»£ç†æ¨¡å¼å…³æ³¨äºæ§åˆ¶å¯¹å¯¹è±¡çš„è®¿é—®ã€‚æ¢å¥è¯è¯´ï¼Œç”¨ä»£ç†æ¨¡å¼ï¼Œä»£ç†ç±»ï¼ˆproxy classï¼‰å¯ä»¥å¯¹å®ƒçš„å®¢æˆ·éšè—ä¸€ä¸ªå¯¹è±¡çš„å…·ä½“ä¿¡æ¯ã€‚å› æ­¤ï¼Œå½“ä½¿ç”¨ä»£ç†æ¨¡å¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸¸å¸¸åœ¨ä¸€ä¸ªä»£ç†ç±»ä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ã€‚å¹¶ä¸”ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šå¸¸çš„åšæ³•æ˜¯å°†åŸå§‹å¯¹è±¡ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ ç»™è£…é¥°è€…çš„æ„é€ å™¨ã€‚ 5.4 å¤–è§‚æ¨¡å¼ï¼ˆå¯¹è±¡ï¼‰ å®šä¹‰ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªä¸€è‡´çš„å¤–è§‚ï¼Œä»è€Œç®€åŒ–äº†è¯¥å­ç³»ç»Ÿçš„ä½¿ç”¨ å¤–è§‚æ¨¡å¼åŒ…å«å¦‚ä¸‹è§’è‰²ï¼š Facade: å¤–è§‚è§’è‰² SubSystem:å­ç³»ç»Ÿè§’è‰² //CPU public class CPU { public void startup(){ System.out.println(\"cpu startup!\"); } public void shutdown(){ System.out.println(\"cpu shutdown!\"); } } //Memory public class Memory { public void startup(){ System.out.println(\"memory startup!\"); } public void shutdown(){ System.out.println(\"memory shutdown!\"); } } //Disk public class Disk { public void startup(){ System.out.println(\"disk startup!\"); } public void shutdown(){ System.out.println(\"disk shutdown!\"); } } //Facade public class Computer { private CPU cpu; private Memory memory; private Disk disk; public Computer(){ cpu = new CPU(); memory = new Memory(); disk = new Disk(); } public void startup(){ System.out.println(\"start the computer!\"); cpu.startup(); memory.startup(); disk.startup(); System.out.println(\"start computer finished!\"); } public void shutdown(){ System.out.println(\"begin to close the computer!\"); cpu.shutdown(); memory.shutdown(); disk.shutdown(); System.out.println(\"computer closed!\"); } } 5.5 æ¡¥æ¥æ¨¡å¼ï¼ˆå¯¹è±¡ï¼‰ æŠŠäº‹ç‰©å’Œå…¶å…·ä½“å®ç°åˆ†å¼€ï¼Œä½¿ä»–ä»¬å¯ä»¥å„è‡ªç‹¬ç«‹çš„å˜åŒ–ã€‚ å°†æŠ½è±¡åŒ–ä¸å®ç°åŒ–è§£è€¦ï¼Œä½¿å¾—äºŒè€…å¯ä»¥ç‹¬ç«‹å˜åŒ– public interface Sourceable { public void method(); } public class SourceSub1 implements Sourceable { @Override public void method() { System.out.println(\"this is the first sub!\"); } } public class SourceSub2 implements Sourceable { @Override public void method() { System.out.println(\"this is the second sub!\"); } } public abstract class Bridge { private Sourceable source; public void method(){ source.method(); } public Sourceable getSource() { return source; } public void setSource(Sourceable source) { this.source = source; } } public class MyBridge extends Bridge { public void method(){ getSource().method(); } } 5.6 ç»„åˆæ¨¡å¼ï¼ˆå¯¹è±¡ï¼‰ å°†å¤šä¸ªå¯¹è±¡ç»„åˆåœ¨ä¸€èµ·è¿›è¡Œæ“ä½œï¼Œå¸¸ç”¨äºè¡¨ç¤ºæ ‘å½¢ç»“æ„ä¸­ï¼Œä¾‹å¦‚äºŒå‰æ ‘ï¼Œæ ‘ç­‰ã€‚ public class TreeNode { private String name; private TreeNode parent; private Vector&lt;TreeNode> children = new Vector&lt;TreeNode>(); public TreeNode(String name){ this.name = name; } public String getName() { return name; } public void setName(String name) { this.name = name; } public TreeNode getParent() { return parent; } public void setParent(TreeNode parent) { this.parent = parent; } //æ·»åŠ å­©å­èŠ‚ç‚¹ public void add(TreeNode node){ children.add(node); } //åˆ é™¤å­©å­èŠ‚ç‚¹ public void remove(TreeNode node){ children.remove(node); } //å–å¾—å­©å­èŠ‚ç‚¹ public Enumeration&lt;TreeNode> getChildren(){ return children.elements(); } } public class Tree { TreeNode root = null; public Tree(String name) { root = new TreeNode(name); } public static void main(String[] args) { Tree tree = new Tree(\"A\"); TreeNode nodeB = new TreeNode(\"B\"); TreeNode nodeC = new TreeNode(\"C\"); nodeB.add(nodeC); tree.root.add(nodeB); System.out.println(\"build the tree finished!\"); } } 5.7 äº«å…ƒæ¨¡å¼ï¼ˆå¯¹è±¡ï¼‰ å®ç°å¯¹è±¡çš„å…±äº«ï¼Œå³å…±äº«æ± ï¼Œå½“ç³»ç»Ÿä¸­å¯¹è±¡å¤šçš„æ—¶å€™å¯ä»¥å‡å°‘å†…å­˜çš„å¼€é”€ï¼Œé€šå¸¸ä¸å·¥å‚æ¨¡å¼ä¸€èµ·ä½¿ç”¨ã€‚ å…¶ä¸­ï¼ŒFlyweightæ˜¯æŠ½è±¡äº«å…ƒè§’è‰²ã€‚å®ƒæ˜¯äº§å“çš„æŠ½è±¡ç±»ï¼ŒåŒæ—¶å®šä¹‰å‡ºå¯¹è±¡çš„å¤–éƒ¨çŠ¶æ€å’Œå†…éƒ¨çŠ¶æ€çš„æ¥å£æˆ–å®ç°ï¼›ConcreteFlyweightæ˜¯å…·ä½“äº«å…ƒè§’è‰²ï¼Œæ˜¯å…·ä½“çš„äº§å“ç±»ï¼Œå®ç°æŠ½è±¡è§’è‰²å®šä¹‰çš„ä¸šåŠ¡ï¼›UnsharedConcreteFlyweightæ˜¯ä¸å¯å…±äº«çš„äº«å…ƒè§’è‰²ï¼Œä¸€èˆ¬ä¸ä¼šå‡ºç°åœ¨äº«å…ƒå·¥å‚ä¸­ï¼›FlyweightFactoryæ˜¯äº«å…ƒå·¥å‚ï¼Œå®ƒç”¨äºæ„é€ ä¸€ä¸ªæ± å®¹å™¨ï¼ŒåŒæ—¶æä¾›ä»æ± ä¸­è·å¾—å¯¹è±¡çš„æ–¹æ³•ã€‚ public abstract class Flyweight { //å†…éƒ¨çŠ¶æ€ public String intrinsic; //å¤–éƒ¨çŠ¶æ€ protected final String extrinsic; //è¦æ±‚äº«å…ƒè§’è‰²å¿…é¡»æ¥å—å¤–éƒ¨çŠ¶æ€ public Flyweight(String extrinsic) { this.extrinsic = extrinsic; } //å®šä¹‰ä¸šåŠ¡æ“ä½œ public abstract void operate(int extrinsic); public String getIntrinsic() { return intrinsic; } public void setIntrinsic(String intrinsic) { this.intrinsic = intrinsic; } } public class ConcreteFlyweight extends Flyweight { //æ¥å—å¤–éƒ¨çŠ¶æ€ public ConcreteFlyweight(String extrinsic) { super(extrinsic); } //æ ¹æ®å¤–éƒ¨çŠ¶æ€è¿›è¡Œé€»è¾‘å¤„ç† @Override public void operate(int extrinsic) { System.out.println(\"å…·ä½“Flyweight:\" + extrinsic); } } public class UnsharedConcreteFlyweight extends Flyweight { public UnsharedConcreteFlyweight(String extrinsic) { super(extrinsic); } @Override public void operate(int extrinsic) { System.out.println(\"ä¸å…±äº«çš„å…·ä½“Flyweight:\" + extrinsic); } } public class FlyweightFactory { //å®šä¹‰ä¸€ä¸ªæ± å®¹å™¨ private static HashMap&lt;String, Flyweight> pool = new HashMap&lt;>(); //äº«å…ƒå·¥å‚ public static Flyweight getFlyweight(String extrinsic) { Flyweight flyweight = null; if(pool.containsKey(extrinsic)) { //æ± ä¸­æœ‰è¯¥å¯¹è±¡ flyweight = pool.get(extrinsic); System.out.print(\"å·²æœ‰ \" + extrinsic + \" ç›´æ¥ä»æ± ä¸­å–---->\"); } else { //æ ¹æ®å¤–éƒ¨çŠ¶æ€åˆ›å»ºäº«å…ƒå¯¹è±¡ flyweight = new ConcreteFlyweight(extrinsic); //æ”¾å…¥æ± ä¸­ pool.put(extrinsic, flyweight); System.out.print(\"åˆ›å»º \" + extrinsic + \" å¹¶ä»æ± ä¸­å–å‡º---->\"); } return flyweight; } } 6 è¡Œä¸ºå‹æ¨¡å¼è§£æè¡Œä¸ºå‹æ¨¡å¼ä¸»è¦ç”¨äºæè¿°ç±»æˆ–å¯¹è±¡çš„äº¤äº’ä»¥åŠèŒè´£åˆ†é… 6.1 è§£é‡Šå™¨æ¨¡å¼ï¼ˆç±»ï¼‰ ä¸»è¦åº”ç”¨åœ¨OOPå¼€å‘ä¸­çš„ç¼–è¯‘å™¨çš„å¼€å‘ä¸­ ç»™å®šä¸€ç§è¯­è¨€ï¼Œå®šä¹‰å®ƒçš„æ–‡æ³•è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¯¥è§£é‡Šå™¨ç”¨æ¥æ ¹æ®æ–‡æ³•è¡¨ç¤ºæ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­ â€‹ 6.2 æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆç±»ï¼‰ å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ï¼Œä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„å³å¯é‡æ–°å®šä¹‰ç®—æ³•ä¸­æŸäº›ç‰¹å®šæ­¥éª¤ 6.3 ç­–ç•¥æ¨¡å¼ï¼ˆå¯¹è±¡ï¼‰ å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼ŒæŠŠå®ƒä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿å®ƒä»¬ä¹‹é—´å¯ç›¸äº’æ›¿æ¢ï¼Œä»è€Œè®©ç®—æ³•å¯ä»¥ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„ç”¨æˆ·è€Œå˜åŒ– 6.4 è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆå¯¹è±¡ï¼‰ å®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–° public interface Observer { public void update(); } public class Observer1 implements Observer { @Override public void update() { System.out.println(\"observer1 has received!\"); } } public class Observer2 implements Observer { @Override public void update() { System.out.println(\"observer2 has received!\"); } } public interface Subject { /*å¢åŠ è§‚å¯Ÿè€…*/ public void add(Observer observer); /*åˆ é™¤è§‚å¯Ÿè€…*/ public void del(Observer observer); /*é€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…*/ public void notifyObservers(); /*è‡ªèº«çš„æ“ä½œ*/ public void operation(); } public abstract class AbstractSubject implements Subject { private Vector&lt;Observer> vector = new Vector&lt;Observer>(); @Override public void add(Observer observer) { vector.add(observer); } @Override public void del(Observer observer) { vector.remove(observer); } //æé†’åº”å½“åœ¨æŠ½è±¡ç±»ä¸­å°±å®ç° @Override public void notifyObservers() { Enumeration&lt;Observer> enumo = vector.elements(); while(enumo.hasMoreElements()){ enumo.nextElement().update(); } } } public class MySubject extends AbstractSubject { @Override public void operation() { System.out.println(\"update self!\"); notifyObservers(); } } 6.5 è¿­ä»£å™¨æ¨¡å¼ï¼ˆå¯¹è±¡ï¼‰ æä¾›ä¸€ç§æ–¹æ³•æ¥é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œè€Œä¸éœ€è¦æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚ 6.6 è´£ä»»é“¾æ¨¡å¼ï¼ˆå¯¹è±¡ï¼‰ æœ‰å¤šä¸ªå¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡æŒæœ‰å¯¹ä¸‹ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œè¿™æ ·å°±ä¼šå½¢æˆä¸€æ¡é“¾ï¼Œè¯·æ±‚åœ¨è¿™æ¡é“¾ä¸Šä¼ é€’ï¼Œç›´åˆ°æŸä¸€å¯¹è±¡å†³å®šå¤„ç†è¯¥è¯·æ±‚ã€‚ä½†æ˜¯å‘å‡ºè€…å¹¶ä¸æ¸…æ¥šåˆ°åº•æœ€ç»ˆé‚£ä¸ªå¯¹è±¡ä¼šå¤„ç†è¯¥è¯·æ±‚ public interface Handler { public void operator(); } public abstract class AbstractHandler { private Handler handler; public Handler getHandler() { return handler; } public void setHandler(Handler handler) { this.handler = handler; } } public class MyHandler extends AbstractHandler implements Handler { private String name; public MyHandler(String name) { this.name = name; } @Override public void operator() { System.out.println(name+\"deal!\"); if(getHandler()!=null){ getHandler().operator(); } } } 6.7 å‘½ä»¤æ¨¡å¼ï¼ˆå¯¹è±¡ï¼‰ å°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œå¯ç”¨ä¸åŒçš„è¯·æ±‚å¯¹å®¢æˆ·è¿›è¡Œå‚æ•°åŒ–ï¼Œå°†è¯·æ±‚æ’é˜Ÿæˆ–è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œæ”¯æŒå¯æ’¤é”€çš„æ“ä½œ public interface Command { public void exe(); } public class MyCommand implements Command { private Receiver receiver; public MyCommand(Receiver receiver) { this.receiver = receiver; } @Override public void exe() { receiver.action(); } } public class Receiver { public void action(){ System.out.println(\"command received!\"); } } public class Invoker { private Command command; public Invoker(Command command) { this.command = command; } public void action(){ command.exe(); } } 6.8 å¤‡å¿˜å½•æ¨¡å¼ï¼ˆå¯¹è±¡ï¼‰ åœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ï¼Œä»è€Œå¯ä»¥åœ¨ä»¥åå°†è¯¥å¯¹è±¡æ¢å¤åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€ public class Original { private String value; public String getValue() { return value; } public void setValue(String value) { this.value = value; } public Original(String value) { this.value = value; } public Memento createMemento(){ return new Memento(value); } public void restoreMemento(Memento memento){ this.value = memento.getValue(); } } public class Memento { private String value; public Memento(String value) { this.value = value; } public String getValue() { return value; } public void setValue(String value) { this.value = value; } } public class Storage { private Memento memento; public Storage(Memento memento) { this.memento = memento; } public Memento getMemento() { return memento; } public void setMemento(Memento memento) { this.memento = memento; } } 6.9 çŠ¶æ€æ¨¡å¼ï¼ˆå¯¹è±¡ï¼‰ å…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶èƒ½å¤Ÿæ”¹å˜å®ƒçš„è¡Œä¸º public class State { private String value; public String getValue() { return value; } public void setValue(String value) { this.value = value; } public void method1(){ System.out.println(\"execute the first opt!\"); } public void method2(){ System.out.println(\"execute the second opt!\"); } } public class Context { private State state; public Context(State state) { this.state = state; } public State getState() { return state; } public void setState(State state) { this.state = state; } public void method() { if (state.getValue().equals(\"state1\")) { state.method1(); } else if (state.getValue().equals(\"state2\")) { state.method2(); } } } 6.10 è®¿é—®è€…æ¨¡å¼ï¼ˆå¯¹è±¡ï¼‰ è¡¨ç¤ºä¸€ä¸ªä½œç”¨äºæŸå¯¹è±¡ç»“æ„ä¸­çš„å„å…ƒç´ çš„æ“ä½œï¼Œä½¿å¾—åœ¨ä¸æ”¹å˜å„å…ƒç´ çš„ç±»çš„å‰æä¸‹å®šä¹‰ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°æ“ä½œ é€‚ç”¨äºï¼šç»™ä¸€ä¸ªç±»æ·»åŠ æ–°åŠŸèƒ½ï¼Œä½†ä¸ºäº†å…¼å®¹æ€§è€ƒè™‘æˆ–å…¶ä»–åŸå› ä¸æƒ³ç ´åè¿™ä¸ªç±» public interface Visitor { public void visit(Subject sub); } public class MyVisitor implements Visitor { @Override public void visit(Subject sub) { System.out.println(\"visit the subjectï¼š\"+sub.getSubject()); } } public interface Subject { public void accept(Visitor visitor); public String getSubject(); } public class MySubject implements Subject { @Override public void accept(Visitor visitor) { visitor.visit(this); } @Override public String getSubject() { return \"love\"; } } 6.11 ä¸­ä»‹è€…æ¨¡å¼ï¼ˆå¯¹è±¡ï¼‰ ç”¨ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—çš„å¯¹è±¡äº¤äº’ã€‚å®ƒä½¿å„å¯¹è±¡ä¸éœ€è¦æ˜¾ç¤ºåœ°ç›¸äº’è°ƒç”¨ï¼Œä»è€Œè¾¾åˆ°ä½è€¦åˆï¼Œè¿˜å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å¯¹è±¡é—´çš„äº¤äº’ public interface Mediator { public void createMediator(); public void workAll(); } public class MyMediator implements Mediator { private User user1; private User user2; public User getUser1() { return user1; } public User getUser2() { return user2; } @Override public void createMediator() { user1 = new User1(this); user2 = new User2(this); } @Override public void workAll() { user1.work(); user2.work(); } } public abstract class User { private Mediator mediator; public Mediator getMediator(){ return mediator; } public User(Mediator mediator) { this.mediator = mediator; } public abstract void work(); } public class User1 extends User { public User1(Mediator mediator){ super(mediator); } @Override public void work() { System.out.println(\"user1 exe!\"); } } public class User2 extends User { public User2(Mediator mediator){ super(mediator); } @Override public void work() { System.out.println(\"user2 exe!\"); } } public class Test { public static void main(String[] args) { Mediator mediator = new MyMediator(); mediator.createMediator(); mediator.workAll(); } }","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://www.codetool.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://www.codetool.top/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"æˆ‘çš„åšå®¢æ¬å®¶å•¦","slug":"hello-world","date":"2019-11-08T10:05:23.000Z","updated":"2019-12-19T08:15:15.875Z","comments":true,"path":"article/hello-world/","link":"","permalink":"https://www.codetool.top/article/hello-world/","excerpt":"","text":"ä»Šå¤©å¼ƒäº†wordpressçš„å‘æ¬æ¥hexoå•¦ã€‚å’Œgitbookå·®ä¸å¤šçš„ç”¨æ³•ï¼Œå¾ˆå¿«å°±ä¸Šæ‰‹äº†å‘¢ã€‚å†ä¹Ÿä¸ç”¨å¿å—wordpressä¸€å †ä¸ä»…æ²¡ç”¨è¿˜åŠ è½½é¾Ÿé€Ÿçš„èµ„æºäº†å¥¥é‡Œç»™ï¼ï¼ï¼","categories":[{"name":"æ—¥å¸¸/éšç¬”","slug":"æ—¥å¸¸-éšç¬”","permalink":"https://www.codetool.top/categories/%E6%97%A5%E5%B8%B8-%E9%9A%8F%E7%AC%94/"}],"tags":[{"name":"ç½‘ç«™æ—¥å¿—","slug":"ç½‘ç«™æ—¥å¿—","permalink":"https://www.codetool.top/tags/%E7%BD%91%E7%AB%99%E6%97%A5%E5%BF%97/"}]},{"title":"åœ¨çº¿è¿è¡ŒC++ã€javaã€pythonä»£ç çš„å°é¡¹ç›®å®ç°","slug":"åœ¨çº¿è¿è¡ŒC++ã€javaã€pythonä»£ç çš„å°é¡¹ç›®å®ç°","date":"2019-08-13T12:06:57.000Z","updated":"2020-03-25T04:40:05.295Z","comments":true,"path":"article/åœ¨çº¿è¿è¡ŒC++ã€javaã€pythonä»£ç çš„å°é¡¹ç›®å®ç°/","link":"","permalink":"https://www.codetool.top/article/%E5%9C%A8%E7%BA%BF%E8%BF%90%E8%A1%8CC++%E3%80%81java%E3%80%81python%E4%BB%A3%E7%A0%81%E7%9A%84%E5%B0%8F%E9%A1%B9%E7%9B%AE%E5%AE%9E%E7%8E%B0/","excerpt":"","text":"æœ¬ç½‘ç«™åœ¨2019å¹´8æœˆ12æ—¥ä¹‹å‰ç”¨çš„ä»£ç æ¼”ç¤ºåŠŸèƒ½æ˜¯å€Ÿç”¨äº† https://tool.lu/coderunner/ çš„åœ¨çº¿è¿è¡Œä»£ç å·¥å…·ï¼Œåœ¨æ­¤è‡´è°¢ã€‚ æœ‰ä¸€æ®µæ—¶é—´è¿™ä¸ªå·¥å…·çªç„¶å¤±æ•ˆäº†ï¼Œæˆ‘å°±åœ¨æƒ³èƒ½ä¸èƒ½è‡ªå·±æ¨¡ä»¿ç€åšä¸€ä¸ªç±»ä¼¼çš„å‡ºæ¥ï¼Œç®€å•åˆ†æäº†ä¸€ä¸‹å°±æƒ³æŒ‘æˆ˜ä¸€ä¸‹è‡ªå·±ï¼Œç„¶åå°±å¼€å§‹åŠ¨æ‰‹äº†ã€‚ åšå‡ºæ¥çš„æˆæœé“¾æ¥ï¼šç‚¹å‡»æ­¤å¤„ åšçš„è¿‡ç¨‹ä¸­æŸ¥é˜…äº†å¾ˆå¤šç½‘ç»œèµ„æ–™ï¼Œç°æ•´ç†å¦‚ä¸‹ï¼š éœ€æ±‚åˆ†æï¼šå‰ç«¯ä¸ºä¸€ä¸ªå®ç”¨çš„ä»£ç ç¼–è¾‘å™¨ï¼Œé€šè¿‡ajaxè¯·æ±‚å°†å†™å¥½çš„ä»£ç æäº¤ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ç¼–è¯‘è¿è¡ŒåæŠŠè¾“å‡ºç»“æœé€å›å®¢æˆ·ç«¯æ˜¾ç¤ºã€‚ å…¶ä¸­ä½¿ç”¨çš„ä»£ç ç¼–è¾‘å™¨ï¼šCodeMirrorï¼Œç°åœ¨ç±»ä¼¼çš„å·¥å…·ä½¿ç”¨çš„åº”è¯¥éƒ½æ˜¯è¿™æ¬¾åŠŸèƒ½å¼ºå¤§ï¼Œå¯ä»¥è‡ªå®šæ ·å¼çš„ä»£ç ç¼–è¾‘å™¨ï¼Œå®˜ç½‘ï¼š https://codemirror.net/ 0.1 CodeMirroræ­å»ºå‰ç«¯ç•Œé¢å…ˆä»å®˜ç½‘ä¸‹è½½ä¸‹æ¥CodeMirrorçš„å‹ç¼©åŒ…ï¼Œè§£å‹ä¹‹åå¾—åˆ°ä¸‹å›¾ç›®å½• è¦åœ¨htmlä¸­åˆ›å»ºä¸€ä¸ªCodeMirrorç¼–è¾‘å™¨ï¼Œå¿…é¡»æ·»åŠ çš„csså’Œjsæ–‡ä»¶æ˜¯ &lt;link href=./codemirror-5.48.2/lib/codemirror.css rel=stylesheet/> &lt;script src=./codemirror-5.48.2/lib/codemirror.js>&lt;/script> (5.48.2ä¸ºç‰ˆæœ¬å·ï¼Œå› äººè€Œå¼‚) ç„¶åéœ€è¦æ·»åŠ éœ€è¦ç¼–è¾‘çš„è¯­è¨€ç›¸å…³çš„jsæ–‡ä»¶ï¼Œå¯ä»¥åœ¨modeç›®å½•ä¸‹æ‰¾åˆ°ï¼Œè¿™é‡Œæˆ‘ç”¨äº†ä¸¤ä¸ªæ–‡ä»¶ï¼š å®ç°JAVAå’ŒC++ä»£ç é«˜äº®ï¼ˆè¿™ä¸ªæ–‡ä»¶å¯ä»¥å®ç°Cï¼ŒC++ï¼ŒJAVAï¼ŒC#ç­‰è¯­è¨€ï¼‰ï¼š &lt;script src=./codemirror-5.48.2/mode/clike/clike.js>&lt;/script> å®ç°pythonçš„ä»£ç é«˜äº®ï¼š &lt;script src=./codemirror-5.48.2/mode/python/python.js>&lt;/script> éœ€è¦æ›´æ”¹ç¼–è¾‘å™¨ä¸»é¢˜æ ·å¼çš„å¯ä»¥åœ¨themeç›®å½•ä¸‹æ‰¾åˆ°å¯¹åº”çš„ä¸»é¢˜cssæ–‡ä»¶æ·»åŠ è¿›å»ï¼Œæˆ‘è§‰å¾—é»˜è®¤ä¸»é¢˜å°±å¾ˆå¥½çœ‹äº†å°±æ²¡ç”¨å…¶ä»–ä¸»é¢˜ã€‚ ä¸ºäº†å®ç°æ‹¬å·åŒ¹é…å’Œä»£ç æŠ˜å åŠŸèƒ½ï¼Œè¿˜è¦æ·»åŠ çš„æ–‡ä»¶æœ‰ï¼š &lt;link rel=stylesheet href=./codemirror-5.48.2/addon/fold/foldgutter.css/> &lt;script src=./codemirror-5.48.2/addon/fold/foldcode.js>&lt;/script> &lt;script src=./codemirror-5.48.2/addon/fold/foldgutter.js>&lt;/script> &lt;script src=./codemirror-5.48.2/addon/fold/brace-fold.js>&lt;/script> &lt;script src=./codemirror-5.48.2/addon/fold/comment-fold.js>&lt;/script> åˆ›å»ºç¼–è¾‘å™¨çš„è¿‡ç¨‹ï¼š åœ¨htmlä¸­ä½¿ç”¨ä¸€ä¸ªtextareaå ä½ï¼Œé…ç½®å¥½idï¼š &lt;textarea id=code name=code>&lt;/textarea> é€šè¿‡å¯¹åº”çš„jsä»£ç åˆ›å»ºç¼–è¾‘å™¨ï¼š var editor = CodeMirror.fromTextArea(document.getElementById(code), { mode: text/x-java, //å®ç°Javaä»£ç é«˜äº® //mode: text/x-c++src, //å®ç°C++ä»£ç é«˜äº® //mode: text/x-python, //å®ç°Pythonä»£ç é«˜äº® indentUnit:4,//ä»¥å››ä¸ªç©ºæ ¼çš„é•¿åº¦ç¼©è¿› indentWithTabs: true,//ä»¥tabä»£æ›¿ç©ºæ ¼ç¼©è¿› lineNumbers: true, //æ˜¾ç¤ºè¡Œå· lineWrapping: true, foldGutter: true, //ä»£ç æŠ˜å  gutters: [CodeMirror-linenumbers, CodeMirror-foldgutter], matchBrackets: true //æ‹¬å·åŒ¹é… }); è¿™é‡Œéœ€è¦ä»€ä¹ˆè¯­è¨€é«˜äº®éœ€è¦åœ¨å®˜ç½‘æ‰¾åˆ°å¯¹åº”è¯­è¨€çš„ MIME types ï¼Œå†™åœ¨modeå‚æ•°ä¸­ å…¶ä»–ç›¸å…³jså‡½æ•°ï¼š ç¼–è¾‘å™¨çš„å¤§å°é€šè¿‡ editor.setSize(width, height) æ–¹æ³•è®¾ç½® è·å–ç¼–è¾‘å™¨å†…çš„ä»£ç ï¼šeditor.getValue() è®¾ç½®ç¼–è¾‘å™¨å†…çš„ä»£ç ï¼šeditor.setValue() è®¾ç½®ç¼–è¾‘å™¨çš„é…ç½®é€‰é¡¹: editor.setOption() æœ€ç»ˆæ­é…ä¸Šbootstrapæ ·å¼åšå‡ºæ¥çš„æ•ˆæœæ˜¯è¿™æ ·çš„ï¼š 0.2 jså®ç°å‰ç«¯é€»è¾‘ä½¿ç”¨JQueryç®€åŒ–jsçš„å†™æ³• å…³é”®ä»£ç ï¼š åˆ‡æ¢è¯­è¨€äº‹ä»¶ //é€‰æ‹©è¯­è¨€äº‹ä»¶ $(\"#lang\").on('change', () => { lang = $(\"#lang\").val() if (lang == 'java') { editor.setOption(\"mode\", \"text/x-java\") editor.setValue(javacode) } else if (lang == \"cpp\") { editor.setOption(\"mode\", \"text/x-c++src\") editor.setValue(cppcode) } else if (lang == \"python\") { editor.setOption(\"mode\", \"text/x-python\") editor.setValue(pythoncode) } }) å‘é€POSTè¯·æ±‚ $(function(){ //ç‚¹å‡»è¿è¡ŒæŒ‰é’®åçš„äº‹ä»¶ $(\"#run\").on(\"click\",()=>{ var codesrc = editor.getValue(); //ç»™æºä»£ç ç¼–ç  var codeEncoded = encodeURIComponent(codesrc); $(\"output\").html = 'console>>' + 'æ­£åœ¨åŠªåŠ›æ‰§è¡Œä¸­...'; //å‘å‡ºpostè¯·æ±‚ $.post( \"/runcode.php\", { lang:lang,codesrc:codeEncoded }, (data)=>{ var outputs = data.output; var status1 = data.status1; var output = ''; //æ‹¼æ¥è¾“å‡ºç»“æœ if(status1 !== 1){ for(var i in outputs) { output = output + outputs[i] + '&lt;br/>'; }data }else{ var outputs1 = data.output1; for(var i in outputs1) { output = output + outputs1[i] + '&lt;br/>'; } } $(\"output\").html = 'console>>' + output; }, \"json\"); }) }); æ³¨ï¼š ç”±äºä»£ç ä¸­å¯èƒ½å‡ºç° + æˆ– &amp; ç­‰ç¬¦å·ï¼Œå…¶åœ¨postçš„è¯·æ±‚ä¸­ç»è¿‡urlencodeä¼šåˆ†åˆ«è¢«è§£æä¸ºç©ºæ ¼å’Œå‚æ•°è¿æ¥ç¬¦ï¼Œéœ€å…ˆå°†ä»£ç æºç ç”¨jsçš„encodeURIComponent()å‡½æ•°ç¼–ç ï¼Œä¼ é€’åˆ°phpåç«¯åå†ç”¨rawurldecode()å‡½æ•°è¿›è¡Œè§£ç æ“ä½œã€‚ 0.3 phpå®ç°åç«¯phpçš„ä»»åŠ¡æ˜¯åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä»£ç ï¼Œæ ¸å¿ƒçš„æ€æƒ³æ˜¯å°†æ¥æ”¶åˆ°çš„ä»£ç å†™å…¥æ–‡ä»¶ï¼Œä½¿ç”¨å„ç§ç¯å¢ƒå»æ‰§è¡Œï¼Œå¹¶è¿”å›ç»“æœ å…¶ä¸­ç”¨åˆ°äº†execå‡½æ•° å…·ä½“å‚é˜… ã€phpã€‘phpä½¿ç”¨execæ€»ç»“ åšçš„æ—¶å€™é‡åˆ°äº†ä¸ªé—®é¢˜ï¼šphpåœ¨è°ƒç”¨execæ‰§è¡Œgccå‘½ä»¤æ—¶ï¼Œä¼šå‡ºç°å„ç§æ¯›ç—…ï¼Œä¾‹å¦‚ldé“¾æ¥å™¨æ‰¾ä¸åˆ°ï¼Œåæ¥å‘ç°åŸå› æ˜¯phpä¸ä¼šä½¿ç”¨ç³»ç»Ÿè®¾ç½®çš„ç¯å¢ƒå˜é‡ï¼Œåœ¨phpæ–‡ä»¶å¼€å¤´æ·»åŠ è¿™æ ·ä¸€å¥è¯å°±èƒ½è§£å†³é—®é¢˜ï¼š putenv(PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin);//è®¾ç½®ç¯å¢ƒå˜é‡","categories":[{"name":"é¡¹ç›®/ç¼–ç¨‹ç†è®º","slug":"é¡¹ç›®-ç¼–ç¨‹ç†è®º","permalink":"https://www.codetool.top/categories/%E9%A1%B9%E7%9B%AE-%E7%BC%96%E7%A8%8B%E7%90%86%E8%AE%BA/"}],"tags":[{"name":"php","slug":"php","permalink":"https://www.codetool.top/tags/php/"},{"name":"CodeMirror","slug":"CodeMirror","permalink":"https://www.codetool.top/tags/CodeMirror/"},{"name":"é¡¹ç›®","slug":"é¡¹ç›®","permalink":"https://www.codetool.top/tags/%E9%A1%B9%E7%9B%AE/"}]}]}