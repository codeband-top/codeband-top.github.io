<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ä»£ç æ®µå°ç«™</title>
  <icon>https://www.gravatar.com/avatar/4c71a513a84e4d430b9f9aed224237fc</icon>
  <subtitle>CodeTool - ä¸ªäººè®¡ç®—æœºç±»ç»ƒæ‰‹å°åšå®¢</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.codetool.top/"/>
  <updated>2020-03-24T12:13:56.561Z</updated>
  <id>https://www.codetool.top/</id>
  
  <author>
    <name>Rhett Peng</name>
    <email>pctdyx@qq.net</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Sentinelä¸­çš„blockHandlerå’Œfallbackä»¥åŠè§„åˆ™æŒä¹…åŒ–é…ç½®</title>
    <link href="https://www.codetool.top/article/Sentinel%E4%B8%AD%E7%9A%84blockHandler%E5%92%8Cfallback%E4%BB%A5%E5%8F%8A%E8%A7%84%E5%88%99%E6%8C%81%E4%B9%85%E5%8C%96%E9%85%8D%E7%BD%AE/"/>
    <id>https://www.codetool.top/article/Sentinelä¸­çš„blockHandlerå’Œfallbackä»¥åŠè§„åˆ™æŒä¹…åŒ–é…ç½®/</id>
    <published>2020-03-24T12:13:38.000Z</published>
    <updated>2020-03-24T12:13:56.561Z</updated>
    
    <content type="html"><![CDATA[<h1 id="çƒ­ç‚¹è§„åˆ™">1 çƒ­ç‚¹è§„åˆ™</h1><p>ä½•ä¸ºçƒ­ç‚¹ï¼Ÿçƒ­ç‚¹å³ç»å¸¸è®¿é—®çš„æ•°æ®ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡æŸä¸ªçƒ­ç‚¹æ•°æ®ä¸­è®¿é—®é¢‘æ¬¡æœ€é«˜çš„ Top K æ•°æ®ï¼Œå¹¶å¯¹å…¶è®¿é—®è¿›è¡Œé™åˆ¶ã€‚æ¯”å¦‚ï¼š</p><ul><li>å•†å“ ID ä¸ºå‚æ•°ï¼Œç»Ÿè®¡ä¸€æ®µæ—¶é—´å†…æœ€å¸¸è´­ä¹°çš„å•†å“ ID å¹¶è¿›è¡Œé™åˆ¶</li><li>ç”¨æˆ· ID ä¸ºå‚æ•°ï¼Œé’ˆå¯¹ä¸€æ®µæ—¶é—´å†…é¢‘ç¹è®¿é—®çš„ç”¨æˆ· ID è¿›è¡Œé™åˆ¶</li></ul><p>çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµã€‚çƒ­ç‚¹å‚æ•°é™æµå¯ä»¥çœ‹åšæ˜¯ä¸€ç§ç‰¹æ®Šçš„æµé‡æ§åˆ¶ï¼Œä»…å¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨ç”Ÿæ•ˆã€‚</p><p><img src="https://api.codetool.top/img/15850178478179.png" alt></p><p>Sentinel åˆ©ç”¨ LRU ç­–ç•¥ç»Ÿè®¡æœ€è¿‘æœ€å¸¸è®¿é—®çš„çƒ­ç‚¹å‚æ•°ï¼Œç»“åˆä»¤ç‰Œæ¡¶ç®—æ³•æ¥è¿›è¡Œå‚æ•°çº§åˆ«çš„æµæ§ã€‚çƒ­ç‚¹å‚æ•°é™æµæ”¯æŒé›†ç¾¤æ¨¡å¼ã€‚</p><h2 id="å®ä¾‹">1.1 å®ä¾‹</h2><p>æˆ‘ä»¬åœ¨æ¨¡å—<code>cloudalibaba-sentinel-service8401</code>çš„controllerä¸­æ–°å»ºæ–¹æ³•ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/testHotKey"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"testHotKey"</span><span class="token punctuation">,</span> blockHandler <span class="token operator">=</span> <span class="token string">"dealTestHotKey"</span><span class="token punctuation">)</span><span class="token keyword">public</span> String <span class="token function">testHotKey</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"p1"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> String p1<span class="token punctuation">,</span>                            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"p2"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> String p2<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token string">"testHotKey -----"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> String <span class="token function">dealTestHotKey</span><span class="token punctuation">(</span>String p1<span class="token punctuation">,</span> String p2<span class="token punctuation">,</span> BlockException blockException<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token string">"dealTestHotKey---------"</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å®ƒçš„å«ä¹‰æ˜¯<code>/testHotKey</code>åœ¨sentinelä¸­çš„èµ„æºåä¸º<code>testHotKey</code>ï¼Œå¦‚æœè¢«é™æµï¼Œåˆ™ä½¿ç”¨dealTestHotKeyæ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p><p>ä¸‹é¢æ–°å»ºçƒ­ç‚¹è§„åˆ™ï¼š</p><p><img src="https://api.codetool.top/img/15850278802044.png" alt></p><p>è¿™é‡Œçš„å‚æ•°ç´¢å¼•å¯¹åº”çš„æ˜¯æ–¹æ³•ä¸­çš„å‚æ•°ç´¢å¼•ï¼Œå³p1ï¼Œè¯¥é…ç½®çš„å«ä¹‰ä¸ºï¼Œå¸¦p1å‚æ•°çš„è¯·æ±‚QPSä¸èƒ½è¶…è¿‡1ã€‚å¦åˆ™ä¼šä½¿ç”¨è‡ªå·±å®šä¹‰çš„<code>dealTestHotKey</code>æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p><p><img src="https://api.codetool.top/img/15850279959742.png" alt></p><h3 id="å‚æ•°ä¾‹å¤–é¡¹">1.1.1 å‚æ•°ä¾‹å¤–é¡¹</h3><p>å¦‚æœçƒ­ç‚¹keyçš„å–å€¼ä¸ºæŸä¸ªæŒ‡å®šçš„å–å€¼ï¼Œå¯ä»¥ç‰¹æ®Šåœ°è¿›è¡Œæ”¾è¡Œï¼Œå°†ä¸Šé¢é…ç½®çš„çƒ­ç‚¹è§„åˆ™è¿›è¡Œç¼–è¾‘ï¼Œé€‰æ‹©é«˜çº§é€‰é¡¹ï¼Œé…ç½®å¦‚ä¸‹å‚æ•°ä¾‹å¤–é¡¹ï¼š</p><p><img src="https://api.codetool.top/img/15850281122764.png" alt></p><p>è¯¥é…ç½®çš„å«ä¹‰ä¸ºï¼Œå¦‚æœp1çš„å–å€¼ä¸º5ï¼Œåˆ™QPSçš„é˜ˆå€¼å¯ä»¥æé«˜è‡³200ã€‚</p><h1 id="ç³»ç»Ÿè‡ªé€‚åº”é™æµ">2 ç³»ç»Ÿè‡ªé€‚åº”é™æµ</h1><p>Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä»æ•´ä½“ç»´åº¦å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚</p><p><img src="https://api.codetool.top/img/15850287415415.png" alt></p><p>ç³»ç»Ÿè§„åˆ™æ”¯æŒä»¥ä¸‹çš„æ¨¡å¼ï¼š</p><ul><li>Load è‡ªé€‚åº”ï¼ˆä»…å¯¹ Linux/Unix-like æœºå™¨ç”Ÿæ•ˆï¼‰ï¼šç³»ç»Ÿçš„ load1 ä½œä¸ºå¯å‘æŒ‡æ ‡ï¼Œè¿›è¡Œè‡ªé€‚åº”ç³»ç»Ÿä¿æŠ¤ã€‚å½“<strong>ç³»ç»Ÿ load1 è¶…è¿‡è®¾å®šçš„å¯å‘å€¼</strong>ï¼Œä¸”<strong>ç³»ç»Ÿå½“å‰çš„å¹¶å‘çº¿ç¨‹æ•°è¶…è¿‡ä¼°ç®—çš„ç³»ç»Ÿå®¹é‡</strong>æ—¶æ‰ä¼šè§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆBBR é˜¶æ®µï¼‰ã€‚ç³»ç»Ÿå®¹é‡ç”±ç³»ç»Ÿçš„ <code>maxQps * minRt</code> ä¼°ç®—å¾—å‡ºã€‚è®¾å®šå‚è€ƒå€¼ä¸€èˆ¬æ˜¯ <code>CPU cores * 2.5</code>ã€‚</li><li>å¹³å‡ RT(å“åº”æ—¶é—´)ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹³å‡ RT è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</li><li>å¹¶å‘çº¿ç¨‹æ•°ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹¶å‘çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</li><li>å…¥å£ QPSï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„ QPS è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</li><li>CPU ä½¿ç”¨ç‡ï¼ˆ1.5.0+ ç‰ˆæœ¬ï¼‰ï¼šå½“ç³»ç»Ÿ CPU ä½¿ç”¨ç‡è¶…è¿‡é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆå–å€¼èŒƒå›´ 0.0-1.0ï¼‰ï¼Œæ¯”è¾ƒçµæ•ã€‚</li></ul><p>è¯¥åŠŸèƒ½çš„é™æµç²’åº¦ä¸ºæ•´ä¸ªç³»ç»Ÿï¼Œéœ€è¦è°¨æ…é…ç½®ã€‚</p><h1 id="SentinelResourceæ³¨è§£">3 SentinelResourceæ³¨è§£</h1><p>å…³äº<code>@SentinelResource</code>ï¼Œæœ€åŸºæœ¬çš„ä½¿ç”¨å°±æ˜¯ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RateLimitController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/byResource"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"byResource"</span><span class="token punctuation">,</span> blockHandler <span class="token operator">=</span> <span class="token string">"handleException"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> CommonResult <span class="token function">byResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"æŒ‰èµ„æºåç§°é™æµæµ‹è¯•OK"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span>2020L<span class="token punctuation">,</span> IdUtil<span class="token punctuation">.</span><span class="token function">simpleUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> CommonResult <span class="token function">handleException</span><span class="token punctuation">(</span>BlockException blockException<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">,</span> blockException<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\tæœåŠ¡ä¸å¯ç”¨"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®ƒå®šä¹‰äº†èµ„æºåå’Œ<code>BlockException</code>çš„å¤„ç†å™¨ï¼Œè¿™ä¸ªè‡ªå®šä¹‰çš„å¤„ç†å™¨<strong>å‚æ•°ç±»å‹éœ€è¦å’ŒåŸæ–¹æ³•ç›¸åŒ¹é…å¹¶ä¸”æœ€ååŠ ä¸€ä¸ªé¢å¤–çš„å‚æ•°ï¼Œç±»å‹ä¸º <code>BlockException</code>ã€‚</strong></p><p>ç„¶è€Œè¿™æ ·çš„ä½¿ç”¨å­˜åœ¨ç€é—®é¢˜ï¼Œä¾‹å¦‚æ²¡æœ‰é»˜è®¤çš„å¤„ç†å™¨ï¼Œå¯¹æ¯ä¸ªæ–¹æ³•éƒ½å¾—é…ç½®ï¼Œå¦å¤–æ˜¯æŠŠé™çº§æ–¹æ³•å†™è¿›äº†controllerï¼Œé€ æˆè€¦åˆã€‚</p><h2 id="è‡ªå®šä¹‰é™æµå¤„ç†ç±»">3.1 è‡ªå®šä¹‰é™æµå¤„ç†ç±»</h2><p>å°†é™æµå¤„ç†çš„æ–¹æ³•æå‡ºæ¥å¯ä»¥è§£è€¦ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerBlockHandler</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> CommonResult <span class="token function">handlerException1</span><span class="token punctuation">(</span>BlockException exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">"å®¢æˆ·è‡ªå®šä¹‰ï¼Œglobal handlerException---1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> CommonResult <span class="token function">handlerException2</span><span class="token punctuation">(</span>BlockException exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">,</span> <span class="token string">"å®¢æˆ·è‡ªå®šä¹‰ï¼Œglobal handlerException---2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æ³¨æ„å†…éƒ¨çš„å¤„ç†æ–¹æ³•å¿…é¡»æ˜¯staticçš„ã€‚</p><p>é‚£ä¹ˆåœ¨controllerä¸­å¯ä»¥å†™ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RateLimitController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/byResource"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"byResource"</span><span class="token punctuation">,</span> blockHandlerClass <span class="token operator">=</span> CustomerBlockHandler<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> blockHandler <span class="token operator">=</span> <span class="token string">"handlerException1"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> CommonResult <span class="token function">byResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"æŒ‰èµ„æºåç§°é™æµæµ‹è¯•OK"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span>2020L<span class="token punctuation">,</span> IdUtil<span class="token punctuation">.</span><span class="token function">simpleUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="fallbackå’ŒdefaultFallback">3.2 fallbackå’ŒdefaultFallback</h2><p>blockHandleråªèƒ½å¤„ç†<code>BlockException</code>å¼‚å¸¸ï¼Œå³é€šè¿‡é™æµã€ç†”æ–­ã€é™çº§é…ç½®çš„è¯·æ±‚æ‹¦æˆªæŠ›å‡ºçš„å¼‚å¸¸ï¼Œè€Œå¯¹äºæœåŠ¡æœ¬èº«æŠ›å‡ºçš„å¼‚å¸¸ä¸ä¼šå¤„ç†ï¼Œ<strong>å¯ä»¥ä½¿ç”¨fallbackå‡½æ•°æ¥å¤„ç†æŸä¸ªæ–¹æ³•æŠ›å‡ºçš„æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸ï¼ˆåŒ…æ‹¬BlockExceptionï¼‰</strong></p><p>ç›¸å…³çš„<code>@SentinelResource</code>çš„ä¸‰ä¸ªå±æ€§ï¼š</p><ul><li>fallbackï¼šfallback å‡½æ•°åç§°ï¼Œå¯é€‰é¡¹ï¼Œç”¨äºåœ¨æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™æä¾› fallback å¤„ç†é€»è¾‘ã€‚fallback å‡½æ•°å¯ä»¥é’ˆå¯¹æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸ï¼ˆé™¤äº† <code>exceptionsToIgnore</code> é‡Œé¢æ’é™¤æ‰çš„å¼‚å¸¸ç±»å‹ï¼‰è¿›è¡Œå¤„ç†ã€‚fallback å‡½æ•°ç­¾åå’Œä½ç½®è¦æ±‚ï¼š<ul><li>è¿”å›å€¼ç±»å‹å¿…é¡»ä¸åŸå‡½æ•°è¿”å›å€¼ç±»å‹ä¸€è‡´ï¼›</li><li>æ–¹æ³•å‚æ•°åˆ—è¡¨éœ€è¦å’ŒåŸå‡½æ•°ä¸€è‡´ï¼Œæˆ–è€…å¯ä»¥é¢å¤–å¤šä¸€ä¸ª Throwable ç±»å‹çš„å‚æ•°ç”¨äºæ¥æ”¶å¯¹åº”çš„å¼‚å¸¸ã€‚</li><li>fallback å‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®š <code>fallbackClass</code> ä¸ºå¯¹åº”çš„ç±»çš„ Class å¯¹è±¡ï¼Œæ³¨æ„å¯¹åº”çš„å‡½æ•°å¿…éœ€ä¸º <code>static</code> å‡½æ•°ï¼Œå¦åˆ™æ— æ³•è§£æã€‚</li></ul></li><li><code>defaultFallback</code>ï¼š<strong>é»˜è®¤çš„ fallback å‡½æ•°åç§°</strong>ï¼Œå¯é€‰é¡¹ï¼Œé€šå¸¸ç”¨äºé€šç”¨çš„ fallback é€»è¾‘ï¼ˆå³å¯ä»¥ç”¨äºå¾ˆå¤šæœåŠ¡æˆ–æ–¹æ³•ï¼‰ã€‚é»˜è®¤ fallback å‡½æ•°å¯ä»¥é’ˆå¯¹æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸ï¼ˆé™¤äº† <code>exceptionsToIgnore</code> é‡Œé¢æ’é™¤æ‰çš„å¼‚å¸¸ç±»å‹ï¼‰è¿›è¡Œå¤„ç†ã€‚<strong>è‹¥åŒæ—¶é…ç½®äº† fallback å’Œ defaultFallbackï¼Œåˆ™åªæœ‰ fallback ä¼šç”Ÿæ•ˆã€‚</strong></li><li><code>exceptionsToIgnore</code>ï¼šç”¨äº<strong>æŒ‡å®šå“ªäº›å¼‚å¸¸è¢«æ’é™¤æ‰</strong>ï¼Œä¸ä¼šè®¡å…¥å¼‚å¸¸ç»Ÿè®¡ä¸­ï¼Œä¹Ÿ<strong>ä¸ä¼šè¿›å…¥ fallback é€»è¾‘ä¸­ï¼Œè€Œæ˜¯ä¼šåŸæ ·æŠ›å‡º</strong>ã€‚è¿™ä¸ªå±æ€§çš„å€¼æ˜¯ä¸€ä¸ªclasså¯¹è±¡çš„é›†åˆï¼š<code>exceptionsToIgnore={xxx.class,xxx.class}</code></li></ul><h1 id="è§„åˆ™æŒä¹…åŒ–">4 è§„åˆ™æŒä¹…åŒ–</h1><p>sentinelä¸­çš„æœåŠ¡å¦‚æœä¸€ä¸‹çº¿ï¼Œé…ç½®è¿‡çš„è§„åˆ™éƒ½ä¼šæ¶ˆå¤±ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦å°†é…ç½®è§„åˆ™è¿›è¡ŒæŒä¹…åŒ–ã€‚</p><p>å¦‚ä½•æŒä¹…åŒ–ï¼Ÿ</p><p>ä¸å¾—ä¸è¯´è¿™éƒ¨åˆ†ç¡®å®æœ‰ç‚¹è¿·ï¼Œå®˜æ–¹å¯¹è¿™éƒ¨åˆ†çš„æè¿°æ„Ÿè§‰è¿™ä¸ªåŠŸèƒ½ä¸æ˜¯å¾ˆæˆç†ŸğŸ˜”ã€‚</p><p>æˆ‘æ˜¯è¿™æ ·åšçš„ï¼š</p><p>é¦–å…ˆä¿è¯å¼•å…¥ä¾èµ–ï¼ˆä¹‹å‰å·²ç»å¼•å…¥ï¼‰ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>sentinel-datasource-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>ä¿®æ”¹é…ç½®ï¼šï¼ˆå¾…ä¼šä»nacosæ‹‰å–é…ç½®ï¼‰</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8401</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloudalibaba<span class="token punctuation">-</span>sentinel<span class="token punctuation">-</span>service  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>      <span class="token key atrule">transport</span><span class="token punctuation">:</span>        <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span>        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8719</span>      <span class="token key atrule">datasource</span><span class="token punctuation">:</span>        <span class="token key atrule">ds1</span><span class="token punctuation">:</span>          <span class="token key atrule">nacos</span><span class="token punctuation">:</span>            <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>            <span class="token key atrule">dataId</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span><span class="token punctuation">-</span>flow<span class="token punctuation">-</span>rules            <span class="token key atrule">groupId</span><span class="token punctuation">:</span> SENTINEL_GROUP            <span class="token key atrule">data-type</span><span class="token punctuation">:</span> json            <span class="token key atrule">rule-type</span><span class="token punctuation">:</span> flow<span class="token key atrule">management</span><span class="token punctuation">:</span>  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>    <span class="token key atrule">web</span><span class="token punctuation">:</span>      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">'*'</span></code></pre><p>å› ä¸ºè¦ç”¨pushæ¨¡å¼ï¼Œå¤§æ¦‚åŸç†æ˜¯sentinel-dashboardç›´æ¥æŠŠé…ç½®æ¨åˆ°nacosä¸Šé¢ï¼Œè€Œsentinelå®¢æˆ·ç«¯ç›‘å¬è¯¥é…ç½®çš„ä¿®æ”¹ï¼ŒåŠ¨æ€è·å–è¯¥é…ç½®ã€‚</p><p>æ‰€ä»¥è¿˜å¾—ä¿®æ”¹sentinel-dashboardï¼Œå…ˆå»githubä¸ŠæŠŠsentinelçš„æºç ä¸‹ä¸‹æ¥ï¼Œç„¶åå°†<br><code>sentinel-dashboard\src\test\java\com\alibaba\csp\sentinel\dashboard\rule\nacos</code>å¤åˆ¶åˆ°<code>sentinel-dashboard\src\main\java\com\alibaba\csp\sentinel\dashboard\rule</code>ä¸‹é¢ã€‚</p><p>ä¿®æ”¹<code>sentinel-dashboard\</code>ä¸‹é¢çš„pom.xmlæ–‡ä»¶ï¼Œå°†</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>sentinel-datasource-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>ä¸­çš„<code>&lt;scope&gt;test&lt;/scope&gt;</code>å»æ‰ã€‚</p><p>ç„¶åä¿®æ”¹<code>entinel-dashboard\src\main\java\com\alibaba\csp\sentinel\dashboard\controller\v2</code>ä¸‹é¢çš„<code>FlowControllerV2.java</code>ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span><span class="token comment" spellcheck="true">// @Qualifier("flowRuleDefaultProvider")ä¿®æ”¹ä¸º</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"flowRuleNacosProvider"</span><span class="token punctuation">)</span><span class="token keyword">private</span> DynamicRuleProvider<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>FlowRuleEntity<span class="token operator">>></span> ruleProvider<span class="token punctuation">;</span><span class="token annotation punctuation">@Autowired</span><span class="token comment" spellcheck="true">// @Qualifier("flowRuleDefaultPublisher")ä¿®æ”¹ä¸º</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"flowRuleNacosPublisher"</span><span class="token punctuation">)</span><span class="token keyword">private</span> DynamicRulePublisher<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>FlowRuleEntity<span class="token operator">>></span> rulePublisher<span class="token punctuation">;</span></code></pre><p>ç„¶åä¿®æ”¹<code>sentinel-dashboard\src\main\webapp\resources\app\scripts\directives\sidebar</code>ä¸‹é¢çš„<code>sidebar.html</code>æ–‡ä»¶ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">ui-sref-active</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>active<span class="token punctuation">"</span></span> <span class="token attr-name">ng-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>!entry.isGateway<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- &lt;a ui-sref="dashboard.flowV1({app: entry.app})"> ä¿®æ”¹ä¸º--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">ui-sref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dashboard.flow({app: entry.app})<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>glyphicon glyphicon-filter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span><span class="token entity" title="&nbsp;">&amp;nbsp;</span><span class="token entity" title="&nbsp;">&amp;nbsp;</span>æµæ§è§„åˆ™V2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></code></pre><p>ä¹‹åï¼Œè¿›å…¥<code>sentinel-dashbord</code>ç›®å½•ï¼Œé‡æ–°æ‰“åŒ…ï¼š</p><pre><code>mvn clean package</code></pre><p>ç„¶ååœ¨<code>target/</code>ç›®å½•ä¸‹è¿è¡Œé‡æ–°ç”Ÿæˆçš„åŒ…ï¼Œè¯•è¯•çœ‹é…ç½®èƒ½ä¸èƒ½æŒä¹…åŒ–ã€‚</p><p>é™„ä¸Šå®˜æ–¹æ–‡æ¡£ï¼š <a href="https://github.com/alibaba/Sentinel/wiki/Sentinel-%E6%8E%A7%E5%88%B6%E5%8F%B0%EF%BC%88%E9%9B%86%E7%BE%A4%E6%B5%81%E6%8E%A7%E7%AE%A1%E7%90%86%EF%BC%89#%E8%A7%84%E5%88%99%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener">https://github.com/alibaba/Sentinel/wiki/Sentinel-%E6%8E%A7%E5%88%B6%E5%8F%B0%EF%BC%88%E9%9B%86%E7%BE%A4%E6%B5%81%E6%8E%A7%E7%AE%A1%E7%90%86%EF%BC%89#%E8%A7%84%E5%88%99%E9%85%8D%E7%BD%AE</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;çƒ­ç‚¹è§„åˆ™&quot;&gt;1 çƒ­ç‚¹è§„åˆ™&lt;/h1&gt;&lt;p&gt;ä½•ä¸ºçƒ­ç‚¹ï¼Ÿçƒ­ç‚¹å³ç»å¸¸è®¿é—®çš„æ•°æ®ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡æŸä¸ªçƒ­ç‚¹æ•°æ®ä¸­è®¿é—®é¢‘æ¬¡æœ€é«˜çš„ Top K æ•°æ®ï¼Œå¹¶å¯¹å…¶è®¿é—®è¿›è¡Œé™åˆ¶ã€‚æ¯”å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å•†å“ ID ä¸ºå‚æ•°ï¼Œç»Ÿè®¡ä¸€æ®µæ—¶é—´å†…æœ€å¸¸è´­ä¹°çš„å•†å“ ID å¹¶è¿›è¡Œé™åˆ¶&lt;/
      
    
    </summary>
    
    
      <category term="ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶" scheme="https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="å¾®æœåŠ¡" scheme="https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="Sentinel" scheme="https://www.codetool.top/tags/Sentinel/"/>
    
  </entry>
  
  <entry>
    <title>Sentinelæµæ§è§„åˆ™ä¸é™çº§è§„åˆ™</title>
    <link href="https://www.codetool.top/article/Sentinel%E6%B5%81%E6%8E%A7%E8%A7%84%E5%88%99%E4%B8%8E%E9%99%8D%E7%BA%A7%E8%A7%84%E5%88%99/"/>
    <id>https://www.codetool.top/article/Sentinelæµæ§è§„åˆ™ä¸é™çº§è§„åˆ™/</id>
    <published>2020-03-24T02:40:47.000Z</published>
    <updated>2020-03-24T05:10:42.792Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Sentinelæ¦‚è¿°">1 Sentinelæ¦‚è¿°</h1><h2 id="Sentinel-æ˜¯ä»€ä¹ˆï¼Ÿ">1.1 Sentinel æ˜¯ä»€ä¹ˆï¼Ÿ</h2><blockquote><p>éšç€å¾®æœåŠ¡çš„æµè¡Œï¼ŒæœåŠ¡å’ŒæœåŠ¡ä¹‹é—´çš„ç¨³å®šæ€§å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚Sentinel ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§ã€‚</p></blockquote><p>Sentinelå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ul><li><strong>ä¸°å¯Œçš„åº”ç”¨åœºæ™¯ï¼š</strong> Sentinel æ‰¿æ¥äº†é˜¿é‡Œå·´å·´è¿‘ 10 å¹´çš„åŒåä¸€å¤§ä¿ƒæµé‡çš„æ ¸å¿ƒåœºæ™¯ï¼Œä¾‹å¦‚ç§’æ€ï¼ˆå³çªå‘æµé‡æ§åˆ¶åœ¨ç³»ç»Ÿå®¹é‡å¯ä»¥æ‰¿å—çš„èŒƒå›´ï¼‰ã€æ¶ˆæ¯å‰Šå³°å¡«è°·ã€é›†ç¾¤æµé‡æ§åˆ¶ã€å®æ—¶ç†”æ–­ä¸‹æ¸¸ä¸å¯ç”¨åº”ç”¨ç­‰ã€‚</li><li><strong>å®Œå¤‡çš„å®æ—¶ç›‘æ§ï¼š</strong> Sentinel åŒæ—¶æä¾›å®æ—¶çš„ç›‘æ§åŠŸèƒ½ã€‚æ‚¨å¯ä»¥åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°æ¥å…¥åº”ç”¨çš„å•å°æœºå™¨ç§’çº§æ•°æ®ï¼Œç”šè‡³ 500 å°ä»¥ä¸‹è§„æ¨¡çš„é›†ç¾¤çš„æ±‡æ€»è¿è¡Œæƒ…å†µã€‚</li><li><strong>å¹¿æ³›çš„å¼€æºç”Ÿæ€ï¼š</strong> Sentinel æä¾›å¼€ç®±å³ç”¨çš„ä¸å…¶å®ƒå¼€æºæ¡†æ¶/åº“çš„æ•´åˆæ¨¡å—ï¼Œä¾‹å¦‚ä¸ Spring Cloudã€Dubboã€gRPC çš„æ•´åˆã€‚æ‚¨åªéœ€è¦å¼•å…¥ç›¸åº”çš„ä¾èµ–å¹¶è¿›è¡Œç®€å•çš„é…ç½®å³å¯å¿«é€Ÿåœ°æ¥å…¥ Sentinelã€‚</li><li><strong>å®Œå–„çš„ SPI æ‰©å±•ç‚¹ï¼š</strong> Sentinel æä¾›ç®€å•æ˜“ç”¨ã€å®Œå–„çš„ SPI æ‰©å±•æ¥å£ã€‚æ‚¨å¯ä»¥é€šè¿‡å®ç°æ‰©å±•æ¥å£æ¥å¿«é€Ÿåœ°å®šåˆ¶é€»è¾‘ã€‚ä¾‹å¦‚å®šåˆ¶è§„åˆ™ç®¡ç†ã€é€‚é…åŠ¨æ€æ•°æ®æºç­‰ã€‚</li></ul><p><img src="https://api.codetool.top/img/15849747574114.png" alt></p><p>å¯ä»¥ä»£æ›¿Hystrixã€Sleuth</p><h1 id="ä¸‹è½½å’Œè¿è¡Œ">2 ä¸‹è½½å’Œè¿è¡Œ</h1><p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/alibaba/Sentinel/releases" target="_blank" rel="noopener">https://github.com/alibaba/Sentinel/releases</a></p><p>è¿™é‡Œé€‰æ‹© <code>sentinel-dashboard-1.7.1.jar</code> ä¸‹è½½</p><p>ä¸‹è½½æˆåŠŸåç›´æ¥è¿è¡Œï¼š</p><pre><code>java -jar .\sentinel-dashboard-1.7.1.jar</code></pre><p><img src="https://api.codetool.top/img/15849766257513.png" alt></p><p>å¯åŠ¨æˆåŠŸåç›´æ¥è®¿é—® <a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a> å³å¯çœ‹åˆ°ç®¡ç†ç•Œé¢ï¼Œé»˜è®¤ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯sentinelã€‚</p><h1 id="æ„å»ºæµ‹è¯•æ¨¡å—">3 æ„å»ºæµ‹è¯•æ¨¡å—</h1><p>æ–°å»ºæ¨¡å—<code>cloudalibaba-sentinel-service8401</code>ï¼Œä¾èµ–å¦‚ä¸‹ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--     sentinel-datasource-nacos åç»­æŒä¹…åŒ–ç”¨   --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>sentinel-datasource-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.rhett<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>yamlé…ç½®ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8401</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloudalibaba<span class="token punctuation">-</span>sentinel<span class="token punctuation">-</span>service  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">1111</span>    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>      <span class="token key atrule">transport</span><span class="token punctuation">:</span>        <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span>        <span class="token comment" spellcheck="true"># é»˜è®¤8719ç«¯å£ï¼Œå¦‚æœè¢«å ç”¨ä¼šä»8719å¼€å§‹ä¾æ¬¡+1æ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£</span>        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8719</span><span class="token key atrule">management</span><span class="token punctuation">:</span>  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>    <span class="token key atrule">web</span><span class="token punctuation">:</span>      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">'*'</span></code></pre><p>å¯åŠ¨ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableDiscoveryClient</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainApp8401</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>MainApp8401<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>controller:</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlowLimitController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/testA"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">testA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"testA-----"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/testB"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">testB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"...testB "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"testB   -----"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è‡³æ­¤è¯¥æ¨¡å—æ„å»ºå®Œæˆï¼Œè®¿é—®ä¸€æ¬¡ <a href="http://localhost:8401/testA" target="_blank" rel="noopener">http://localhost:8401/testA</a> ï¼Œå³è‡³å°‘è°ƒç”¨ä¸€æ¬¡è¯¥æœåŠ¡ï¼Œå°±å¯ä»¥åœ¨sentinelçš„æ§åˆ¶ç•Œé¢ä¸Šçœ‹åˆ°è¯¥æœåŠ¡äº†ã€‚</p><p><img src="https://api.codetool.top/img/15849779763713.png" alt></p><h1 id="å®æ—¶ç›‘æ§">4 å®æ—¶ç›‘æ§</h1><p><img src="https://api.codetool.top/img/15849783302548.png" alt></p><h1 id="æµæ§è§„åˆ™">5 æµæ§è§„åˆ™</h1><p><img src="https://api.codetool.top/img/15849786056398.png" alt></p><ul><li>èµ„æºåï¼šå”¯ä¸€åç§°,é»˜è®¤è¯·æ±‚è·¯å¾„</li><li>é’ˆå¯¹æ¥æº: Sentineå¯ä»¥<strong>é’ˆå¯¹è°ƒç”¨è€…è¿›è¡Œé™æµï¼Œå¡«å†™å¾®æœåŠ¡å</strong>,é»˜è®¤default (ä¸åŒºåˆ†æ¥æº)</li><li>é˜ˆå€¼ç±»å‹/å•æœºé˜ˆå€¼:<ul><li>QPS (æ¯ç§’é’Ÿçš„è¯·æ±‚æ•°é‡) :å½“è°ƒç”¨è¯¥apiçš„QPSè¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™,è¿›è¡Œé™æµ</li><li>çº¿ç¨‹æ•°:å½“è°ƒç”¨è¯¥apiçš„çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™ï¼Œè¿›è¡Œé™æµ</li></ul></li><li>æ˜¯å¦é›†ç¾¤ï¼šä¸éœ€è¦é›†ç¾¤</li><li>æµæ§æ¨¡å¼<ul><li>ç›´æ¥: apiè¾¾åˆ°é™æµæ¡ä»¶æ—¶ï¼Œç›´æ¥é™æµ</li><li>å…³è”: å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±</li><li>é“¾è·¯: åªè®°å½•æŒ‡å®šé“¾è·¯ä¸Šçš„æµé‡(æŒ‡å®šèµ„æºä»å…¥å£èµ„æºè¿›æ¥çš„æµé‡,å¦‚æœè¾¾åˆ°é˜ˆå€¼,å°±è¿›è¡Œé™æµ) ã€apiçº§åˆ«çš„é’ˆå¯¹æ¥æºã€‘</li></ul></li><li>æµæ§æ•ˆæœ:<ul><li>å¿«é€Ÿå¤±è´¥ï¼šç›´æ¥å¤±è´¥,æŠ›å¼‚å¸¸</li><li>Warm Upï¼šæ ¹æ®codeFactor(å†·åŠ è½½å› å­ï¼Œé»˜è®¤3)çš„å€¼ï¼Œä»é˜ˆå€¼/codeFactor, ç»è¿‡é¢„çƒ­æ—¶é•¿ï¼Œæ‰è¾¾åˆ°è®¾ç½®çš„QPSé˜ˆå€¼</li><li>æ’é˜Ÿç­‰å¾…ï¼šåŒ€é€Ÿæ’é˜Ÿ,è®©è¯·æ±‚ä»¥åŒ€é€Ÿçš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼ç±»å‹å¿…é¡»è®¾ç½®ä¸ºQPSï¼Œå¦åˆ™æ— æ•ˆ</li></ul></li></ul><h2 id="æµæ§æ¨¡å¼">5.1 æµæ§æ¨¡å¼</h2><h3 id="ç›´æ¥">5.1.1 ç›´æ¥</h3><p>æˆ‘ä»¬æ–°å»ºå¦‚ä¸‹æµæ§è§„åˆ™ï¼š</p><p><img src="https://api.codetool.top/img/15849790458189.png" alt></p><p>å³QPSæœ€é«˜ä¸º1ã€‚</p><p>è®¾ç½®å®Œæˆä¹‹åé¢‘ç¹è®¿é—® <a href="http://localhost:8401/testA" target="_blank" rel="noopener">http://localhost:8401/testA</a> å¯è§è¶…è¿‡QPSçš„è¯·æ±‚ç½‘é¡µå“åº”ï¼š</p><pre><code>Blocked by Sentinel (flow limiting)</code></pre><p>è€Œå¦‚æœè®¾ç½®é˜ˆå€¼ä¸ºçº¿ç¨‹æ•°æœ€é«˜ä¸º1ï¼Œå› ä¸ºè¯·æ±‚å¤„ç†çš„å¾ˆå¿«çœ‹ä¸å‡ºæ•ˆæœï¼Œå¯ä»¥åšå¦‚ä¸‹ä¿®æ”¹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/testA"</span><span class="token punctuation">)</span><span class="token keyword">public</span> String <span class="token function">testA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//ç­‰å¾…0.8ç§’</span>    TimeUnit<span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"testA-----"</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å†æ¬¡é¢‘ç¹è®¿é—®ç½‘é¡µï¼Œå°±å¯ä»¥çœ‹åˆ°éƒ¨åˆ†è¯·æ±‚è¢«é˜»æ‹¦ã€‚</p><h3 id="å…³è”">5.1.2 å…³è”</h3><p>å½“ä¸¤ä¸ªèµ„æºä¹‹é—´å…·æœ‰èµ„æºäº‰æŠ¢æˆ–è€…ä¾èµ–å…³ç³»çš„æ—¶å€™ï¼Œè¿™ä¸¤ä¸ªèµ„æºä¾¿å…·æœ‰äº†å…³è”ã€‚æ¯”å¦‚å¯¹æ•°æ®åº“åŒä¸€ä¸ªå­—æ®µçš„è¯»æ“ä½œå’Œå†™æ“ä½œå­˜åœ¨äº‰æŠ¢ï¼Œè¯»çš„é€Ÿåº¦è¿‡é«˜ä¼šå½±å“å†™å¾—é€Ÿåº¦ï¼Œå†™çš„é€Ÿåº¦è¿‡é«˜ä¼šå½±å“è¯»çš„é€Ÿåº¦ã€‚å¦‚æœæ”¾ä»»è¯»å†™æ“ä½œäº‰æŠ¢èµ„æºï¼Œåˆ™äº‰æŠ¢æœ¬èº«å¸¦æ¥çš„å¼€é”€ä¼šé™ä½æ•´ä½“çš„ååé‡ã€‚å¯ä½¿ç”¨å…³è”é™æµæ¥é¿å…å…·æœ‰å…³è”å…³ç³»çš„èµ„æºä¹‹é—´è¿‡åº¦çš„äº‰æŠ¢ã€‚</p><p>æ–°å»ºå¦‚ä¸‹æµæ§è§„åˆ™ï¼š</p><p><img src="https://api.codetool.top/img/15849799882974.png" alt></p><p>è¯¥æµæ§è§„åˆ™çš„æ„æ€æ˜¯ï¼Œå¦‚æœå¯¹<code>/testB</code>çš„QPSå¤§äº1ï¼Œåˆ™å¯¹<code>/testA</code>è¿›è¡Œé™æµ</p><p>è¯¥æµæ§è§„åˆ™é€šå¸¸ç”¨äºä¸¤ä¸ªèµ„æºå­˜åœ¨ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§ä½çš„ç»™ä¼˜å…ˆçº§é«˜çš„è®©èµ„æºã€‚</p><h3 id="é“¾è·¯">5.1.3 é“¾è·¯</h3><p>èµ„æºä¸­æ˜¯å­˜åœ¨ç€è°ƒç”¨å…³ç³»çš„ï¼ŒSentinel å…è®¸åªæ ¹æ®æŸä¸ªå…¥å£çš„ç»Ÿè®¡ä¿¡æ¯å¯¹èµ„æºé™æµã€‚æ¯”å¦‚ä¸‹é¢è¿™æ£µè°ƒç”¨æ ‘ï¼š</p><pre><code>                machine-root                 /       \                /         \            Entrance1     Entrance2              /             \             /               \    DefaultNode(nodeA)   DefaultNode(nodeA)</code></pre><p>nodeAèµ„æºå¯ä»¥é€šè¿‡<code>Entrance1</code>æˆ–è€…<code>Entrance2</code>èµ„æºå¾—åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹nodeAè¿›è¡Œé™æµï¼ŒæŒ‡å®šæµæ§è§„åˆ™ä¸ºé“¾è·¯ï¼Œå¹¶æŒ‡å®šå…¥å£èµ„æºä¸º<code>/Entrance1</code>ï¼Œå°±å¯ä»¥åªå¯¹æ¥è‡ª<code>/Entrance1</code>çš„è°ƒç”¨é™æµï¼Œè€Œä¸å¯¹æ¥è‡ª<code>/Entrance2</code>çš„è°ƒç”¨é™æµ</p><h2 id="æµæ§æ•ˆæœ">5.2 æµæ§æ•ˆæœ</h2><h3 id="warm-up">5.2.1 warm up</h3><p>ä¸Šé¢çš„æ¡ˆä¾‹ä¸­æˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨çš„æµæ§æ•ˆæœä¸­çš„å¿«é€Ÿå¤±è´¥ï¼Œè€Œæµæ§æ•ˆæœä¸­çš„warm upï¼Œå³é¢„çƒ­/å†·å¯åŠ¨æ–¹å¼ã€‚<strong>å½“ç³»ç»Ÿé•¿æœŸå¤„äºä½æ°´ä½çš„æƒ…å†µä¸‹ï¼Œå½“æµé‡çªç„¶å¢åŠ æ—¶ï¼Œç›´æ¥æŠŠç³»ç»Ÿæ‹‰å‡åˆ°é«˜æ°´ä½å¯èƒ½ç¬é—´æŠŠç³»ç»Ÿå‹å®ã€‚é€šè¿‡â€å†·å¯åŠ¨â€ï¼Œè®©é€šè¿‡çš„æµé‡ç¼“æ…¢å¢åŠ ï¼Œåœ¨ä¸€å®šæ—¶é—´å†…é€æ¸å¢åŠ åˆ°é˜ˆå€¼ä¸Šé™ï¼Œç»™å†·ç³»ç»Ÿä¸€ä¸ªé¢„çƒ­çš„æ—¶é—´ï¼Œé¿å…å†·ç³»ç»Ÿè¢«å‹å®ã€‚</strong>ï¼ˆé€šå¸¸å’Œæ­¤æ—¶ç³»ç»Ÿä¸­æ²¡æœ‰è¶³é‡çš„ç¼“å­˜æ•°æœ‰å…³ï¼‰</p><p>æ ¹æ®codeFactor(å†·åŠ è½½å› å­ï¼Œé»˜è®¤3)çš„å€¼ï¼Œè¯·æ±‚QPSä»<code>é˜ˆå€¼/codeFactor</code>å¼€å§‹, ç»è¿‡é¢„çƒ­æ—¶é•¿ï¼Œé€æ¸å‡è‡³è®¾ç½®çš„QPSé˜ˆå€¼ã€‚</p><p>æˆ‘ä»¬å»ºç«‹å¦‚ä¸‹é…ç½®ï¼š</p><p><img src="https://api.codetool.top/img/15849817817619.png" alt></p><p>å®ƒçš„æ„æ€åˆ™æ˜¯QPSä»<code>300/3=100</code>å¼€å§‹ï¼Œåœ¨10ç§’å†…é€æ¸å‡è‡³300</p><h3 id="æ’é˜Ÿç­‰å¾…">5.2.2 æ’é˜Ÿç­‰å¾…</h3><p>åŒ€é€Ÿæ’é˜Ÿæ–¹å¼ä¼šä¸¥æ ¼æ§åˆ¶è¯·æ±‚é€šè¿‡çš„é—´éš”æ—¶é—´ï¼Œä¹Ÿå³æ˜¯è®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œå¯¹åº”çš„æ˜¯æ¼æ¡¶ç®—æ³•ã€‚</p><p>è¯¥æ–¹å¼çš„ä½œç”¨å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://api.codetool.top/img/15850156146103.png" alt></p><p>æ’é˜Ÿç­‰å¾…å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼š</p><p><img src="https://api.codetool.top/img/15850157234989.png" alt></p><p>è¯¥è§„åˆ™çš„æ•ˆæœæ˜¯ï¼ŒQPSä¸Šé™ä¸º2ï¼Œè¶…è¿‡QPSçš„è¯·æ±‚æ’é˜Ÿç­‰å¾…ï¼Œæ’é˜Ÿæ—¶é—´è¶…è¿‡10ç§’åˆ™å¿«é€Ÿå¤±è´¥ã€‚</p><h1 id="é™çº§è§„åˆ™">6 é™çº§è§„åˆ™</h1><p>é€‰æ‹©æ–°å»ºé™çº§è§„åˆ™ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹é…ç½®çª—</p><p><img src="https://api.codetool.top/img/15850160889068.png" alt></p><p>å®ƒæ”¯æŒä¸‰ç§é™çº§ç­–ç•¥ï¼Œè€ŒHystrixä¼¼ä¹åªæœ‰å¼‚å¸¸æ¯”ä¾‹ã€‚</p><p>Sentinelæ–­è·¯å™¨æ²¡æœ‰åŠå¼€çŠ¶æ€ï¼Œæ—¶é—´çª—å£è¿‡äº†å°±ç›´æ¥æ‰“å¼€ã€‚ï¼ˆè€Œhystrixä¸­çš„æ—¶é—´çª—å£æ¦‚å¿µæ˜¯ä¸€ä¸ªç»Ÿè®¡å¤±è´¥ç‡çš„æ—¶é—´èŒƒå›´ï¼‰</p><h2 id="RT">6.1 RT</h2><p>RTï¼ˆå¹³å‡å“åº”æ—¶é—´ï¼‰ï¼šå½“ 1s å†…æŒç»­è¿›å…¥ 5 ä¸ªè¯·æ±‚ï¼Œå¯¹åº”æ—¶åˆ»çš„å¹³å‡å“åº”æ—¶é—´ï¼ˆç§’çº§ï¼‰å‡è¶…è¿‡é˜ˆå€¼ï¼ˆcountï¼Œä»¥ ms ä¸ºå•ä½ï¼‰ï¼Œé‚£ä¹ˆ<strong>åœ¨æ¥ä¸‹çš„æ—¶é—´çª—å£ä¹‹å†…ï¼Œå¯¹è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šè‡ªåŠ¨åœ°ç†”æ–­ï¼ˆæŠ›å‡º DegradeExceptionï¼‰ã€‚</strong>æ³¨æ„ Sentinel é»˜è®¤ç»Ÿè®¡çš„ RT ä¸Šé™æ˜¯ <code>4900 ms</code>ï¼Œè¶…å‡ºæ­¤é˜ˆå€¼çš„éƒ½ä¼šç®—ä½œ 4900 msï¼Œè‹¥éœ€è¦å˜æ›´æ­¤ä¸Šé™å¯ä»¥é€šè¿‡å¯åŠ¨é…ç½®é¡¹ <code>-Dcsp.sentinel.statistic.max.rt=xxx</code> æ¥é…ç½®ã€‚</p><h2 id="å¼‚å¸¸æ¯”ä¾‹">6.2 å¼‚å¸¸æ¯”ä¾‹</h2><p>å¼‚å¸¸æ¯”ä¾‹ï¼š<strong>å½“èµ„æºçš„æ¯ç§’è¯·æ±‚é‡ &gt;= 5ï¼Œå¹¶ä¸”æ¯ç§’å¼‚å¸¸æ€»æ•°å é€šè¿‡é‡çš„æ¯”å€¼è¶…è¿‡é˜ˆå€¼ï¼ˆDegradeRule ä¸­çš„ countï¼‰ä¹‹åï¼Œèµ„æºè¿›å…¥é™çº§çŠ¶æ€</strong>ï¼Œå³åœ¨æ¥ä¸‹çš„æ—¶é—´çª—å£ä¹‹å†…ï¼Œå¯¹è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šè‡ªåŠ¨åœ°è¿”å›ã€‚å¼‚å¸¸æ¯”ç‡çš„é˜ˆå€¼èŒƒå›´æ˜¯ [0.0, 1.0]ï¼Œä»£è¡¨ 0% - 100%ã€‚</p><h2 id="å¼‚å¸¸æ•°">6.3 å¼‚å¸¸æ•°</h2><p>å¼‚å¸¸æ•°ï¼š<strong>å½“èµ„æºè¿‘ 1 åˆ†é’Ÿçš„å¼‚å¸¸æ•°ç›®è¶…è¿‡é˜ˆå€¼ä¹‹åä¼šè¿›è¡Œç†”æ–­ã€‚</strong> æ³¨æ„ç”±äºç»Ÿè®¡æ—¶é—´çª—å£æ˜¯åˆ†é’Ÿçº§åˆ«çš„ï¼Œè‹¥ timeWindow å°äº 60sï¼Œåˆ™ç»“æŸç†”æ–­çŠ¶æ€åä»å¯èƒ½å†è¿›å…¥ç†”æ–­çŠ¶æ€ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Sentinelæ¦‚è¿°&quot;&gt;1 Sentinelæ¦‚è¿°&lt;/h1&gt;&lt;h2 id=&quot;Sentinel-æ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;1.1 Sentinel æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;éšç€å¾®æœåŠ¡çš„æµè¡Œï¼ŒæœåŠ¡å’ŒæœåŠ¡ä¹‹é—´çš„ç¨³å®šæ€§å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚Sentinel ä»¥æµé‡ä¸ºåˆ‡
      
    
    </summary>
    
    
      <category term="ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶" scheme="https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="å¾®æœåŠ¡" scheme="https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="Sentinel" scheme="https://www.codetool.top/tags/Sentinel/"/>
    
  </entry>
  
  <entry>
    <title>ç¨‹åºå‘˜é¢è¯•é‡‘å…¸17.16-æŒ‰æ‘©å¸ˆ</title>
    <link href="https://www.codetool.top/article/%E7%A8%8B%E5%BA%8F%E5%91%98%E9%9D%A2%E8%AF%95%E9%87%91%E5%85%B817.16-%E6%8C%89%E6%91%A9%E5%B8%88/"/>
    <id>https://www.codetool.top/article/ç¨‹åºå‘˜é¢è¯•é‡‘å…¸17.16-æŒ‰æ‘©å¸ˆ/</id>
    <published>2020-03-24T01:53:36.000Z</published>
    <updated>2020-03-24T01:59:04.198Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åŸé¢˜ï¼ˆæ¥æºLeetcodeï¼‰">1 åŸé¢˜ï¼ˆæ¥æºLeetcodeï¼‰</h1><p>ä¸€ä¸ªæœ‰åçš„æŒ‰æ‘©å¸ˆä¼šæ”¶åˆ°æºæºä¸æ–­çš„é¢„çº¦è¯·æ±‚ï¼Œæ¯ä¸ªé¢„çº¦éƒ½å¯ä»¥é€‰æ‹©æ¥æˆ–ä¸æ¥ã€‚åœ¨æ¯æ¬¡é¢„çº¦æœåŠ¡ä¹‹é—´è¦æœ‰ä¼‘æ¯æ—¶é—´ï¼Œå› æ­¤å¥¹ä¸èƒ½æ¥å—ç›¸é‚»çš„é¢„çº¦ã€‚ç»™å®šä¸€ä¸ªé¢„çº¦è¯·æ±‚åºåˆ—ï¼Œæ›¿æŒ‰æ‘©å¸ˆæ‰¾åˆ°æœ€ä¼˜çš„é¢„çº¦é›†åˆï¼ˆæ€»é¢„çº¦æ—¶é—´æœ€é•¿ï¼‰ï¼Œè¿”å›æ€»çš„åˆ†é’Ÿæ•°ã€‚</p><p><strong>æ³¨æ„ï¼š</strong> æœ¬é¢˜ç›¸å¯¹åŸé¢˜ç¨ä½œæ”¹åŠ¨</p><p><strong>ç¤ºä¾‹ 1:</strong></p><blockquote><p><strong>è¾“å…¥ï¼š</strong> [1,2,3,1]<br><strong>è¾“å‡ºï¼š</strong> 4<br><strong>è§£é‡Šï¼š</strong> é€‰æ‹© 1 å·é¢„çº¦å’Œ 3 å·é¢„çº¦ï¼Œæ€»æ—¶é•¿ = 1 + 3 = 4ã€‚</p></blockquote><p><strong>ç¤ºä¾‹ 2:</strong></p><blockquote><p><strong>è¾“å…¥:</strong> [2,7,9,3,1]<br><strong>è¾“å‡º:</strong> 12<br><strong>è§£é‡Š:</strong> é€‰æ‹© 1 å·é¢„çº¦ã€ 3 å·é¢„çº¦å’Œ 5 å·é¢„çº¦ï¼Œæ€»æ—¶é•¿ = 2 + 9 + 1 = 12ã€‚</p></blockquote><p><strong>ç¤ºä¾‹ 3:</strong></p><blockquote><p><strong>è¾“å…¥:</strong> [2,1,4,5,3,1,1,3]<br><strong>è¾“å‡º:</strong> 12<br><strong>è§£é‡Š:</strong> é€‰æ‹© 1 å·é¢„çº¦ã€ 3 å·é¢„çº¦ã€ 5 å·é¢„çº¦å’Œ 8 å·é¢„çº¦ï¼Œæ€»æ—¶é•¿ = 2 + 4 + 3 + 3 = 12ã€‚  </p></blockquote><h1 id="è§£æ³•">2 è§£æ³•</h1><h2 id="æ€æƒ³">2.1 æ€æƒ³</h2><p>åŠ¨æ€è§„åˆ’ï¼Œä¸ºäº†é¿å…é‡å¤è®¡ç®—ï¼Œå¯ä»¥ä½¿ç”¨è‡ªé¡¶å‘ä¸‹+è®°å¿†ï¼Œæˆ–è€…æ˜¯è‡ªåº•å‘ä¸Šã€‚</p><h2 id="ä»£ç ">2.2 ä»£ç </h2><p>è‡ªé¡¶å‘ä¸‹+è®°å¿†ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> numsGlo<span class="token punctuation">;</span>    Integer<span class="token punctuation">[</span><span class="token punctuation">]</span> dp<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">massage</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        numsGlo <span class="token operator">=</span> nums<span class="token punctuation">;</span>        dp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">[</span>nums<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">dp</span><span class="token punctuation">(</span>nums<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">dp</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>index <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> numsGlo<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token operator">!=</span>null<span class="token punctuation">)</span> <span class="token keyword">return</span> dp<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> result <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dp</span><span class="token punctuation">(</span>index<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span>numsGlo<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">dp</span><span class="token punctuation">(</span>index<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         dp<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> result<span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è‡ªåº•å‘ä¸Šï¼šï¼ˆä½œè€…ï¼šsweetieeï¼‰</p><pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">massage</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> n <span class="token operator">=</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>        dp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        dp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dp<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> dp<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è‡ªåº•å‘ä¸Šï¼Œä¸éœ€è¦å­˜å‚¨ï¼šï¼ˆä½œè€…ï¼šsweetieeï¼‰</p><pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">massage</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> c <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> a <span class="token operator">+</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            a <span class="token operator">=</span> b<span class="token punctuation">;</span>            b <span class="token operator">=</span> c<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> b<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;åŸé¢˜ï¼ˆæ¥æºLeetcodeï¼‰&quot;&gt;1 åŸé¢˜ï¼ˆæ¥æºLeetcodeï¼‰&lt;/h1&gt;&lt;p&gt;ä¸€ä¸ªæœ‰åçš„æŒ‰æ‘©å¸ˆä¼šæ”¶åˆ°æºæºä¸æ–­çš„é¢„çº¦è¯·æ±‚ï¼Œæ¯ä¸ªé¢„çº¦éƒ½å¯ä»¥é€‰æ‹©æ¥æˆ–ä¸æ¥ã€‚åœ¨æ¯æ¬¡é¢„çº¦æœåŠ¡ä¹‹é—´è¦æœ‰ä¼‘æ¯æ—¶é—´ï¼Œå› æ­¤å¥¹ä¸èƒ½æ¥å—ç›¸é‚»çš„é¢„çº¦ã€‚ç»™å®šä¸€ä¸ªé¢„çº¦è¯·æ±‚åºåˆ—ï¼Œæ›¿æŒ‰æ‘©å¸ˆæ‰¾åˆ°æœ€ä¼˜çš„é¢„çº¦é›†åˆï¼ˆæ€»é¢„çº¦
      
    
    </summary>
    
    
      <category term="ç®—æ³•/æ•°æ®ç»“æ„" scheme="https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
      <category term="leetcode" scheme="https://www.codetool.top/tags/leetcode/"/>
    
      <category term="ç®—æ³•" scheme="https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"/>
    
      <category term="åŠ¨æ€è§„åˆ’" scheme="https://www.codetool.top/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"/>
    
  </entry>
  
  <entry>
    <title>Nacosé›†ç¾¤æ­å»ºå®æ“</title>
    <link href="https://www.codetool.top/article/Nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E5%AE%9E%E6%93%8D/"/>
    <id>https://www.codetool.top/article/Nacosé›†ç¾¤æ­å»ºå®æ“/</id>
    <published>2020-03-23T13:57:00.000Z</published>
    <updated>2020-03-23T14:39:53.681Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å°†æ•°æ®å­˜å‚¨åˆ‡æ¢ä¸ºmysql">1 å°†æ•°æ®å­˜å‚¨åˆ‡æ¢ä¸ºmysql</h1><p>é»˜è®¤Nacosä½¿ç”¨åµŒå…¥å¼æ•°æ®åº“derbyå®ç°æ•°æ®çš„å­˜å‚¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœå¯åŠ¨å¤šä¸ªé»˜è®¤é…ç½®ä¸‹çš„NacosèŠ‚ç‚¹ï¼Œæ•°æ®å­˜å‚¨æ˜¯å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜çš„ã€‚<br>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒNacosé‡‡ç”¨äº†é›†ä¸­å¼å­˜å‚¨çš„æ–¹å¼æ¥æ”¯æŒé›†ç¾¤åŒ–éƒ¨ç½²,ç›®å‰åªæ”¯æŒMySQLçš„å­˜å‚¨ã€‚</p><p>åœ¨nacoså®‰è£…ç›®å½•ä¸‹çš„<code>conf/</code>æ–‡ä»¶å¤¹ä¸‹æœ‰ä¸€ä¸ª<code>nacos-mysql.sql</code>æ–‡ä»¶ï¼Œä½¿ç”¨mysqlæ‰§è¡Œè¯¥sqlæ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰å»ºdatabaseå¯ä»¥å…ˆæ–°å»ºdatabaseï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">database</span> nacos_config<span class="token punctuation">;</span><span class="token keyword">use</span> nacos_config<span class="token punctuation">;</span></code></pre><p>æ‰§è¡ŒæˆåŠŸä¹‹åå¯ä»¥çœ‹åˆ°ä¸‹é¢è¿™äº›è¡¨ï¼š</p><p><img src="https://api.codetool.top/img/15849642006561.png" alt></p><p>ç„¶åä¿®æ”¹<code>conf/application.properties</code>ï¼Œæ·»åŠ mysqlç›¸å…³é…ç½®ï¼š</p><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">spring.datasource.platform</span><span class="token punctuation">=</span><span class="token attr-value">mysql</span><span class="token attr-name">db.num</span><span class="token punctuation">=</span><span class="token attr-value">1</span><span class="token attr-name">db.url.0</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://localhost:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true</span><span class="token attr-name">db.user</span><span class="token punctuation">=</span><span class="token attr-value">root</span><span class="token attr-name">db.password</span><span class="token punctuation">=</span><span class="token attr-value">123456</span></code></pre><p>é‡å¯nacosï¼Œè¿›å…¥æ§åˆ¶é¡µé¢å¯ä»¥çœ‹åˆ°æ•°æ®å…¨éƒ¨æ²¡äº†ã€‚ã€‚</p><h1 id="é›†ç¾¤éƒ¨ç½²">2 é›†ç¾¤éƒ¨ç½²</h1><p>å¦‚æœæ›´æ”¹å®Œäº†æ•°æ®å­˜å‚¨åˆ°mysqlå°±å¯ä»¥å¼€å§‹éƒ¨ç½²é›†ç¾¤äº†ï¼Œè¿™é‡Œè¿˜æ˜¯æ­å»ºä¼ªé›†ç¾¤ï¼Œä½†æ˜¯ä¼šå¾ˆéº»çƒ¦ï¼Œæœ‰æœºå™¨æ¡ä»¶çš„å¯ä»¥ç›´æ¥å°è¯•çœŸåˆ€å®æªä¸Šé›†ç¾¤â€¦â€¦</p><h2 id="é¦–å…ˆè®©nacosèƒ½æŒ‡å®šç«¯å£å¯åŠ¨">2.1 é¦–å…ˆè®©nacosèƒ½æŒ‡å®šç«¯å£å¯åŠ¨</h2><p>ä¿®æ”¹<code>bin/startup.sh</code>ä¸­çš„ä¸‹é¢ä¸¤ä¸ªåœ°æ–¹ï¼š</p><pre class=" language-shell"><code class="language-shell">#################æ·»åŠ p:ï¼ˆå³å¯ä»¥å¸¦-på‚æ•°ï¼‰57 while getopts ":m:f:s:p:" opt58 do59     case $opt in60         m)61             MODE=$OPTARG;;62         f)63             FUNCTION_MODE=$OPTARG;;64         s)65             SERVER=$OPTARG;;################æ·»åŠ ä¸‹é¢ä¸¤è¡Œ66         p)67             PORT=$OPTARG;;</code></pre><pre class=" language-shell"><code class="language-shell">83 if [[ "${MODE}" == "standalone" ]]; then84     JAVA_OPT="${JAVA_OPT} -Xms512m -Xmx512m -Xmn256m"85     JAVA_OPT="${JAVA_OPT} -Dnacos.standalone=true"### é›†ç¾¤æ¨¡å¼æ·»åŠ jvmå¯åŠ¨å‚æ•°86 else87     JAVA_OPT="${JAVA_OPT} -server -Xms2g -Xmx2g -Xmn1g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m"88     JAVA_OPT="${JAVA_OPT} -XX:-OmitStackTraceInFastThrow -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=${BASE_DIR    }/logs/java_heapdump.hprof"89     JAVA_OPT="${JAVA_OPT} -XX:-UseLargePages"### æ·»åŠ è¿™ä¸€è¡Œ90     JAVA_OPT="${JAVA_OPT} -DServer.port=${PORT}"91 fi</code></pre><h2 id="ä¿®æ”¹é›†ç¾¤é…ç½®æ–‡ä»¶">2.2 ä¿®æ”¹é›†ç¾¤é…ç½®æ–‡ä»¶</h2><p>å°†<code>conf/cluster.conf.example</code>å¤åˆ¶å‡ºæ¥ï¼š</p><pre class=" language-shell"><code class="language-shell">cp cluster.conf.example cluster.conf</code></pre><p>ç„¶åä¿®æ”¹<code>cluster.conf</code>æ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢è¿™å‡ è¡Œï¼Œæ³¨æ„ipä¸èƒ½å¡«å†™127.0.0.1ï¼Œå¿…é¡»æ˜¯<code>hostname -i</code>æ˜¾ç¤ºçš„ipï¼ˆå› ä¸ºå†…éƒ¨raftæ˜¯é€šè¿‡ç½‘å¡ipè¿›è¡Œé€šä¿¡çš„ï¼‰</p><pre><code>192.168.91.1:3333192.168.91.1:4444192.168.91.1:5555</code></pre><h2 id="ä½¿ç”¨nginxåšè´Ÿè½½å‡è¡¡">2.3 ä½¿ç”¨nginxåšè´Ÿè½½å‡è¡¡</h2><p>nginx.confæ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p><pre><code>upstream cluster{    server 127.0.0.1:3333;    server 127.0.0.1:4444;    server 127.0.0.1:5555;}server{    listen 1111;    server_name localhost;    location / {        proxy_pass http://cluster;    }}</code></pre><h2 id="å¯åŠ¨é›†ç¾¤ï¼š">2.4 å¯åŠ¨é›†ç¾¤ï¼š</h2><p>å¯åŠ¨ä¸‰ä¸ªnacoså®ä¾‹å’Œnginxï¼š</p><pre><code>root@DESKTOP-TTLFG6F:~/nacos/bin# bash startup.sh -p 3333root@DESKTOP-TTLFG6F:~/nacos/bin# bash startup.sh -p 4444root@DESKTOP-TTLFG6F:~/nacos/bin# bash startup.sh -p 5555root@DESKTOP-TTLFG6F:/usr/sbin# ./nginx -c /etc/nginx/nginx.conf</code></pre><p>è®¿é—® <a href="http://192.168.91.1:1111/nacos" target="_blank" rel="noopener">http://192.168.91.1:1111/nacos</a> å³å¯çœ‹åˆ°ç†Ÿæ‚‰çš„nacosç•Œé¢äº†â€¦â€¦</p><h1 id="å¾®æœåŠ¡æ³¨å†Œè¿›nacosé›†ç¾¤">3 å¾®æœåŠ¡æ³¨å†Œè¿›nacosé›†ç¾¤</h1><p>æˆ‘ä»¬ä»¥æ¨¡å—<code>cloudalibaba-provider-payment9001</code>ä¸ºä¾‹ï¼Œç›´æ¥å°†é…ç½®æ–‡ä»¶ä¸­çš„<code>spring.cloud.nacos.discovery.addr</code> ä¿®æ”¹ä¸ºnginxä»£ç†çš„vip</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9001</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">1111</span><span class="token key atrule">management</span><span class="token punctuation">:</span>  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>    <span class="token key atrule">web</span><span class="token punctuation">:</span>      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">'*'</span></code></pre><p>ç„¶åå¯åŠ¨æœåŠ¡å°±å¯ä»¥æ­£å¸¸æ³¨å†Œäº†ã€‚</p><h1 id="ä¼ªé›†ç¾¤å¯èƒ½ä¼šè¸©çš„å‘">4 ä¼ªé›†ç¾¤å¯èƒ½ä¼šè¸©çš„å‘</h1><p>å› ä¸ºä¼ªé›†ç¾¤çš„åŸå› ï¼Œå¯èƒ½é€ æˆå®ä¾‹ä¹‹é—´æ— æ³•é€šä¿¡ï¼Œæ³¨å†ŒæœåŠ¡çš„æ—¶å€™å°±ä¼šçœ‹åˆ°è¿™ç§æƒ…å†µï¼š</p><pre><code>java.lang.IllegalStateException: failed to req API:/nacos/v1/ns/instance after all servers([192.168.91.1:1111]) tried        at com.alibaba.nacos.client.naming.net.NamingProxy.reqAPI(NamingProxy.java:335)        at com.alibaba.nacos.client.naming.net.NamingProxy.reqAPI(NamingProxy.java:267)        at com.alibaba.nacos.client.naming.net.NamingProxy.registerService(NamingProxy.java:167)        at com.alibaba.nacos.client.naming.NacosNamingService.registerInstance(NacosNamingService.java:170)        at org.springframework.cloud.alibaba.nacos.registry.NacosServiceRegistry.register(NacosServiceRegistry.java:56)        at org.springframework.cloud.alibaba.nacos.registry.NacosServiceRegistry.register(NacosServiceRegistry.java:29)</code></pre><p>ä½†nacosæœåŠ¡åå°ä¸‰å°æœºå™¨å‡å¯åŠ¨æˆåŠŸï¼Œä¸”åå°èƒ½æ­£å¸¸è¿›å…¥ï¼Œé€šè¿‡URLè®¿é—®/nacos/v1/ns/instanceï¼Œä¹Ÿæ˜¯èƒ½æ­£å¸¸è®¿é—®ã€‚</p><p>å®é™…ä¸Šæ˜¯è·Ÿé€šè¿‡ä¸»æœºåè·å–æœ¬æœºipåœ°å€çš„åŸå› æœ‰å…³ï¼ˆå› ä¸ºæˆ‘æ˜¯ç”¨çš„WSLå¯èƒ½ä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼‰ï¼Œè¿™ç§æƒ…å†µè¿˜æ˜¯ä¿®æ”¹<code>bin/startup.sh</code>ï¼ŒåŠ ä¸€ä¸ªè™šæ‹Ÿæœºå‚æ•°ï¼š</p><pre class=" language-shell"><code class="language-shell">83 if [[ "${MODE}" == "standalone" ]]; then84     JAVA_OPT="${JAVA_OPT} -Xms512m -Xmx512m -Xmn256m"85     JAVA_OPT="${JAVA_OPT} -Dnacos.standalone=true"86 else87     JAVA_OPT="${JAVA_OPT} -server -Xms2g -Xmx2g -Xmn1g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m"88     JAVA_OPT="${JAVA_OPT} -XX:-OmitStackTraceInFastThrow -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=${BASE_DIR    }/logs/java_heapdump.hprof"89     JAVA_OPT="${JAVA_OPT} -XX:-UseLargePages"90     JAVA_OPT="${JAVA_OPT} -DServer.port=${PORT}"### å°†cluster.confä¸­é…ç½®çš„ipåœ°å€åŠ ä¸Š91     JAVA_OPT="${JAVA_OPT} -Dnacos.server.ip=192.168.91.1"92 fi</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;å°†æ•°æ®å­˜å‚¨åˆ‡æ¢ä¸ºmysql&quot;&gt;1 å°†æ•°æ®å­˜å‚¨åˆ‡æ¢ä¸ºmysql&lt;/h1&gt;&lt;p&gt;é»˜è®¤Nacosä½¿ç”¨åµŒå…¥å¼æ•°æ®åº“derbyå®ç°æ•°æ®çš„å­˜å‚¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœå¯åŠ¨å¤šä¸ªé»˜è®¤é…ç½®ä¸‹çš„NacosèŠ‚ç‚¹ï¼Œæ•°æ®å­˜å‚¨æ˜¯å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜çš„ã€‚&lt;br&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒNacosé‡‡ç”¨äº†é›†ä¸­å¼å­˜å‚¨çš„æ–¹å¼
      
    
    </summary>
    
    
      <category term="ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶" scheme="https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="å¾®æœåŠ¡" scheme="https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="Nacos" scheme="https://www.codetool.top/tags/Nacos/"/>
    
  </entry>
  
  <entry>
    <title>Nacosä½œä¸ºé…ç½®ä¸­å¿ƒçš„ç®€å•ä½¿ç”¨</title>
    <link href="https://www.codetool.top/article/Nacos%E4%BD%9C%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <id>https://www.codetool.top/article/Nacosä½œä¸ºé…ç½®ä¸­å¿ƒçš„ç®€å•ä½¿ç”¨/</id>
    <published>2020-03-23T11:33:25.000Z</published>
    <updated>2020-03-23T11:33:51.498Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç®€å•å®ä¾‹">1 ç®€å•å®ä¾‹</h1><p>æ–°å»ºæ¨¡å—<code>cloudalibaba-config-nacos-client3377</code></p><h2 id="ä¾èµ–">1.1 ä¾èµ–</h2><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- nacos --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><h2 id="yamlé…ç½®">1.2 yamlé…ç½®</h2><p>NacosåŒspringcloud-configä¸€æ ·,åœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶ï¼Œè¦ä¿è¯å…ˆä»é…ç½®ä¸­å¿ƒè¿›è¡Œé…ç½®æ‹‰å–,æ‹‰å–é…ç½®ä¹‹åï¼Œæ‰èƒ½ä¿è¯é¡¹ç›®çš„æ­£å¸¸å¯åŠ¨ï¼Œæ‰€ä»¥è¿™é‡Œæœ¬åœ°çš„é…ç½®æ–‡ä»¶åè¿˜æ˜¯ä½¿ç”¨<code>bootstrap.yml</code>ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3377</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>config<span class="token punctuation">-</span>client  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848 </span><span class="token comment" spellcheck="true"># æ³¨å†Œä¸­å¿ƒ</span>      <span class="token key atrule">config</span><span class="token punctuation">:</span>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848 </span><span class="token comment" spellcheck="true"># é…ç½®ä¸­å¿ƒ</span>        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment" spellcheck="true"># è¿™é‡ŒæŒ‡å®šçš„æ–‡ä»¶æ ¼å¼éœ€è¦å’Œnacosä¸Šæ–°å»ºçš„é…ç½®æ–‡ä»¶åç¼€ç›¸åŒï¼Œå¦åˆ™è¯»ä¸åˆ°</span></code></pre><h3 id="dataIdçš„å‘½åè§„åˆ™">1.2.1 dataIdçš„å‘½åè§„åˆ™</h3><p>spring.application.nameæ˜¯æ„æˆ Nacos é…ç½®ç®¡ç† <code>dataId</code> å­—æ®µçš„ä¸€éƒ¨åˆ†ã€‚</p><p>åœ¨ Nacos Spring Cloud ä¸­ï¼ŒdataId çš„å®Œæ•´æ ¼å¼å¦‚ä¸‹ï¼š</p><p><code>${prefix}-${spring.profile.active}.${file-extension}</code></p><ul><li><code>prefix</code> é»˜è®¤ä¸º <code>spring.application.name</code> çš„å€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é…ç½®é¡¹ <code>spring.cloud.nacos.config.prefix</code> æ¥é…ç½®ã€‚</li><li><code>spring.profile.active</code> å³ä¸º<strong>å½“å‰ç¯å¢ƒå¯¹åº”çš„ profile</strong>ï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒ Spring Bootæ–‡æ¡£ã€‚ æ³¨æ„ï¼šå½“ spring.profile.active ä¸ºç©ºæ—¶ï¼Œå¯¹åº”çš„è¿æ¥ç¬¦ - ä¹Ÿå°†ä¸å­˜åœ¨ï¼ŒdataId çš„æ‹¼æ¥æ ¼å¼å˜æˆ ${prefix}.${file-extension}</li><li><code>file-exetension</code> ä¸ºé…ç½®å†…å®¹çš„æ•°æ®æ ¼å¼ï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹ <code>spring.cloud.nacos.config.file-extension</code> æ¥é…ç½®ã€‚ç›®å‰åªæ”¯æŒ properties å’Œ yaml ç±»å‹ã€‚</li></ul><p>ä¸ºäº†æŒ‡å®šé»˜è®¤profileï¼Œæˆ‘ä»¬è¿™é‡Œå†æ–°å»ºä¸€ä¸ªapplication.ymlï¼Œå†…å®¹ä¸ºï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev <span class="token comment" spellcheck="true"># å¼€å‘ç¯å¢ƒ</span></code></pre><p>æˆ‘ä»¬åœ¨nacosç•Œé¢ä¸Šé¢é€‰æ‹©æ–°å»ºé…ç½®ï¼ŒæŒ‰ä¸‹å›¾æ“ä½œ</p><p><img src="https://api.codetool.top/img/15849575492680.png" alt></p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">config</span><span class="token punctuation">:</span>    <span class="token key atrule">info</span><span class="token punctuation">:</span> <span class="token string">"config info for dev, from nacos config center"</span></code></pre><p>æ˜¯æˆ‘ä»¬ç”¨äºæµ‹è¯•çš„è¿œç¨‹é…ç½®</p><h2 id="å¯åŠ¨ç±»">1.3 å¯åŠ¨ç±»</h2><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableDiscoveryClient</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosConfigClientMain3377</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>NacosConfigClientMain3377<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="controller">1.4 controller</h2><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RefreshScope</span> <span class="token comment" spellcheck="true">// æ”¯æŒnacosçš„åŠ¨æ€åˆ·æ–°</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigClientController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${config.info}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String configInfo<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/config/info"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">getConfigInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> configInfo<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¿è¡Œæ¨¡å—ï¼Œè®¿é—® <a href="http://localhost:3377/config/info" target="_blank" rel="noopener">http://localhost:3377/config/info</a> å¯ä»¥çœ‹åˆ°é…ç½®è¢«æ­£å¸¸è¯»å–ã€‚</p><h1 id="åˆ†ç±»ç®¡ç†">2 åˆ†ç±»ç®¡ç†</h1><p>Nacosä¸Šé¢çš„é…ç½®æ–‡ä»¶ç”±namespaceï¼ˆå‘½åç©ºé—´ï¼‰+groupï¼ˆåˆ†ç»„ï¼‰+dataIdå”¯ä¸€ç¡®å®šã€‚</p><p>æœ€å¤–å±‚çš„namespaceæ˜¯å¯ä»¥ç”¨äºåŒºåˆ†éƒ¨ç½²ç¯å¢ƒçš„ï¼ŒGroupå’ŒDataIdé€»è¾‘ä¸ŠåŒºåˆ†ä¸¤ä¸ªç›®æ ‡å¯¹è±¡ã€‚</p><p>namespaceé»˜è®¤ä¸ºpublicï¼Œgroupé»˜è®¤ä¸ºDEFAULT_GROUP</p><p>æ¯”æ–¹è¯´æˆ‘ä»¬ç°åœ¨æœ‰ä¸‰ä¸ªç¯å¢ƒï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸‰ä¸ªNamespaceï¼Œä¸åŒçš„Namespaceä¹‹é—´æ˜¯éš”ç¦»çš„ã€‚</p><h2 id="dataIdæ–¹æ¡ˆ">2.1 dataIdæ–¹æ¡ˆ</h2><p>æˆ‘ä»¬å†åœ¨nacosä¸Šé»˜è®¤å‘½åç©ºé—´é»˜è®¤åˆ†ç»„æ–°å»ºä¸€ä¸ªé…ç½®<code>nacos-config-client-test.yaml</code>ï¼Œå†…å®¹ä¸º</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">config</span><span class="token punctuation">:</span>    <span class="token key atrule">info</span><span class="token punctuation">:</span> <span class="token string">"config info for test, from nacos config center"</span></code></pre><p>ç„¶åå°†application.ymlæ”¹ä¸º</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>    <span class="token key atrule">active</span><span class="token punctuation">:</span> test <span class="token comment" spellcheck="true"># æµ‹è¯•ç¯å¢ƒ</span></code></pre><p>æ¨¡å—é‡å¯ï¼Œå†æ¬¡è®¿é—® <a href="http://localhost:3377/config/info" target="_blank" rel="noopener">http://localhost:3377/config/info</a> ï¼Œå¯ä»¥çœ‹åˆ°å·²æ­£ç¡®è¯»å–<code>nacos-config-client-test.yaml</code>çš„é…ç½®ï¼Œå¹¶ä¸”å¯ä»¥å°è¯•ä¿®æ”¹<code>nacos-config-client-test.yaml</code>çš„å†…å®¹ï¼Œå¯ä»¥éªŒè¯nacosèƒ½åŠ¨æ€åˆ·æ–°è¯»å–é…ç½®ã€‚</p><h2 id="groupæ–¹æ¡ˆ">2.2 groupæ–¹æ¡ˆ</h2><p>æ–°å»ºé…ç½®æ–‡ä»¶ï¼ŒdataIdä¸º<code>nacos-config-client-info.yaml</code>ï¼Œgroupå¡«å†™<code>DEV_GROUP</code>ï¼Œå†…å®¹ä¸ºï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">config</span><span class="token punctuation">:</span>    <span class="token key atrule">info</span><span class="token punctuation">:</span> <span class="token string">"nacos-config-client-info.yaml, DEV_GROUP"</span></code></pre><p>å†æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼ŒdataIdä¹Ÿä¸º<code>nacos-config-client-info.yaml</code>ï¼Œgroupå¡«å†™<code>TEST_GROUP</code>ï¼Œå†…å®¹ä¸ºï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">config</span><span class="token punctuation">:</span>    <span class="token key atrule">info</span><span class="token punctuation">:</span> <span class="token string">"nacos-config-client-info.yaml, TEST_GROUP"</span></code></pre><p>ä¹‹åå¯ä»¥åœ¨bootstrap.ymlä¸­æŒ‡å®šgroupï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3377</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>config<span class="token punctuation">-</span>client  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848 </span><span class="token comment" spellcheck="true"># æ³¨å†Œä¸­å¿ƒ</span>      <span class="token key atrule">config</span><span class="token punctuation">:</span>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848 </span><span class="token comment" spellcheck="true"># é…ç½®ä¸­å¿ƒ</span>        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment" spellcheck="true"># è¿™é‡ŒæŒ‡å®šçš„æ–‡ä»¶æ ¼å¼éœ€è¦å’Œnacosä¸Šæ–°å»ºçš„é…ç½®æ–‡ä»¶åç¼€ç›¸åŒï¼Œå¦åˆ™è¯»ä¸åˆ°</span>        <span class="token key atrule">group</span><span class="token punctuation">:</span> TEST_GROUP <span class="token comment" spellcheck="true"># æŒ‡å®šgroup </span></code></pre><h2 id="å‘½åç©ºé—´æ–¹æ¡ˆ">2.3 å‘½åç©ºé—´æ–¹æ¡ˆ</h2><p>nacosç•Œé¢-&gt;å‘½åç©ºé—´-&gt;æ–°å»ºå‘½åç©ºé—´ã€‚æ–°å»ºä¸¤ä¸ªåä¸ºdevå’Œtestçš„å‘½åç©ºé—´ã€‚ç„¶åå¯ä»¥çœ‹åˆ°å®ƒä»¬çš„å‘½åç©ºé—´ID</p><p><img src="https://api.codetool.top/img/15849630826024.png" alt></p><p>ç„¶åå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®å‘½åç©ºé—´ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3377</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>config<span class="token punctuation">-</span>client  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848 </span><span class="token comment" spellcheck="true"># æ³¨å†Œä¸­å¿ƒ</span>      <span class="token key atrule">config</span><span class="token punctuation">:</span>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848 </span><span class="token comment" spellcheck="true"># é…ç½®ä¸­å¿ƒ</span>        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment" spellcheck="true"># è¿™é‡ŒæŒ‡å®šçš„æ–‡ä»¶æ ¼å¼éœ€è¦å’Œnacosä¸Šæ–°å»ºçš„é…ç½®æ–‡ä»¶åç¼€ç›¸åŒï¼Œå¦åˆ™è¯»ä¸åˆ°</span>        <span class="token key atrule">group</span><span class="token punctuation">:</span> TEST_GROUP <span class="token comment" spellcheck="true"># æŒ‡å®šgroup </span>        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> 4ccc4c4c<span class="token punctuation">-</span>51ec<span class="token punctuation">-</span>4bd1<span class="token punctuation">-</span>8280<span class="token punctuation">-</span>9e70942c0d0c  <span class="token comment" spellcheck="true"># æŒ‡å®šå‘½åç©ºé—´ID</span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ç®€å•å®ä¾‹&quot;&gt;1 ç®€å•å®ä¾‹&lt;/h1&gt;&lt;p&gt;æ–°å»ºæ¨¡å—&lt;code&gt;cloudalibaba-config-nacos-client3377&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;ä¾èµ–&quot;&gt;1.1 ä¾èµ–&lt;/h2&gt;&lt;pre class=&quot; language-xml&quot;&gt;&lt;cod
      
    
    </summary>
    
    
      <category term="ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶" scheme="https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="å¾®æœåŠ¡" scheme="https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="Nacos" scheme="https://www.codetool.top/tags/Nacos/"/>
    
  </entry>
  
  <entry>
    <title>Nacosä½œä¸ºæ³¨å†Œä¸­å¿ƒçš„ç®€å•ä½¿ç”¨</title>
    <link href="https://www.codetool.top/article/Nacos%E4%BD%9C%E4%B8%BA%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <id>https://www.codetool.top/article/Nacosä½œä¸ºæ³¨å†Œä¸­å¿ƒçš„ç®€å•ä½¿ç”¨/</id>
    <published>2020-03-23T09:38:58.000Z</published>
    <updated>2020-03-23T09:39:47.405Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spring-Cloud-Alibabaæ¦‚è¿°">1 Spring Cloud Alibabaæ¦‚è¿°</h1><p>2018.10.31, Spring Cloud Alibaba æ­£å¼å…¥é©»äº†Spring Cloudå®˜æ–¹å­µåŒ–å™¨ï¼Œå¹¶åœ¨Mavenä¸­å¤®ä»“åº“å‘å¸ƒäº†ç¬¬ä¸€ä¸ªç‰ˆæœ¬ã€‚</p><p>Spring Cloud Alibabaæ”¯æŒï¼š</p><ul><li>æœåŠ¡é™æµé™çº§ï¼šé»˜è®¤æ”¯æŒServletã€Feign. RestTemplateã€ Dubbo å’ŒRocketMQé™æµé™çº§åŠŸèƒ½çš„æ¥å…¥ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡æ§åˆ¶å°å®æ—¶ä¿®æ”¹é™æµé™çº§è§„åˆ™,è¿˜æ”¯æŒæŸ¥çœ‹é™æµé™çº§Metricsç›‘æ§ã€‚</li><li>æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼šé€‚é…Spring CloudæœåŠ¡æ³¨å†Œä¸å‘ç°æ ‡å‡†ï¼Œé»˜è®¤é›†æˆäº†Ribbonçš„æ”¯æŒã€‚</li><li>åˆ†å¸ƒå¼é…ç½®ç®¡ç†ï¼šæ”¯æŒåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤–éƒ¨åŒ–é…ç½®,é…ç½®æ›´æ”¹æ—¶è‡ªåŠ¨åˆ·æ–°ã€‚</li><li>æ¶ˆæ¯é©±åŠ¨èƒ½åŠ›ï¼šåŸºäºSpring Cloud Streamä¸ºå¾®æœåŠ¡åº”ç”¨æ„å»ºæ¶ˆæ¯é©±åŠ¨èƒ½åŠ›.</li><li>é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨ï¼šé˜¿é‡Œäº‘æä¾›çš„æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€å¯é çš„äº‘å­˜å‚¨æœåŠ¡ã€‚æ”¯æŒåœ¨ä»»ä½•åº”ç”¨ã€ä»»ä½•æ—¶é—´ã€ä»»ä½•åœ°ç‚¹å­˜å‚¨å’Œè®¿é—®ä»»æ„ç±»å‹çš„æ•°æ®ã€‚</li><li>åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ï¼šæä¾›ç§’çº§ã€ç²¾å‡†ã€å¯é é«˜å¯ç”¨çš„å®šæ—¶(åŸºäºCronè¡¨è¾¾å¼)ä»»åŠ¡è°ƒåº¦æœåŠ¡ã€‚åŒæ—¶æä¾›åˆ†å¸ƒå¼çš„ä»»åŠ¡æ‰§è¡Œæ¨¡å‹ï¼Œå¦‚ç½‘æ ¼ä»»åŠ¡ã€‚ç½‘æ ¼ä»»åŠ¡æ”¯æŒæµ·é‡å­ä»»åŠ¡å‡åŒ€åˆ†é…åˆ°æ‰€æœ‰Worker (schedulerx-client). ä¸Šæ‰§è¡Œã€‚</li></ul><h1 id="Nacosæ¦‚è¿°">2 Nacosæ¦‚è¿°</h1><p>ä¸ºä»€ä¹ˆå«Nacosï¼šå‰å››ä¸ªå­—æ¯åˆ†åˆ«ä¸ºNamingå’ŒConfigurationçš„å‰ä¸¤ä¸ªå­—æ¯ï¼Œæœ€åçš„sä¸ºServiceã€‚</p><p>æ˜¯ä¸€ä¸ªæœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å°ã€‚å¯ä»¥æ›¿ä»£eureka+config+bus</p><h2 id="å„æ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ">2.1 å„æ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ</h2><table><thead><tr><th>-</th><th>Nacos</th><th>Eureka</th><th>Consul</th><th>CoreDNS</th><th>ZooKeeper</th></tr></thead><tbody><tr><td>ä¸€è‡´æ€§åè®®</td><td>CP+AP</td><td>AP</td><td>CP</td><td>/</td><td>CP</td></tr><tr><td>å¥åº·æ£€æŸ¥</td><td>TCP/HTTP/MySQL/Client Beat</td><td>Client Beat</td><td>TCP/HTTP/gRPC/Cmd</td><td>/</td><td>Client Beat</td></tr><tr><td>è´Ÿè½½å‡è¡¡</td><td>æƒé‡/DSL/metadata/CMDB</td><td>Ribbon</td><td>Fabio</td><td>RR</td><td>/</td></tr><tr><td>é›ªå´©ä¿æŠ¤</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>è‡ªåŠ¨æ³¨é”€å®ä¾‹</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>è®¿é—®åè®®</td><td>HTTP/DNS/UDP</td><td>HTTP</td><td>HTTP/DNS</td><td>DNS</td><td>TCP</td></tr><tr><td>ç›‘å¬æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>å¤šæ•°æ®ä¸­å¿ƒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>è·¨æ³¨å†Œä¸­å¿ƒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>SpringCloudé›†æˆ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>Dubboé›†æˆ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>K8sé›†æˆ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr></tbody></table><h1 id="ä½¿ç”¨">3 ä½¿ç”¨</h1><h2 id="Nacos-serverä¸‹è½½å’Œè¿è¡Œ">3.1 Nacos serverä¸‹è½½å’Œè¿è¡Œ</h2><p>Nacos-serverä¸‹è½½ï¼š <a href="https://github.com/alibaba/nacos/releases" target="_blank" rel="noopener">https://github.com/alibaba/nacos/releases</a></p><p>è¿™é‡Œé€‰æ‹©nacos-server-1.1.4.tar.gzä¸‹è½½å¹¶è§£å‹ï¼š</p><pre class=" language-shell"><code class="language-shell">wget https://github.com/alibaba/nacos/releases/download/1.1.4/nacos-server-1.1.4.ziptar -xvf nacos-server-1.1.4.tar.gz</code></pre><p>å¯åŠ¨æœåŠ¡å™¨ï¼ˆéé›†ç¾¤æ¨¡å¼ï¼‰ï¼š</p><pre class=" language-shell"><code class="language-shell">cd nacos/binsh startup.sh -m standalone</code></pre><p>ubuntuå¯ä»¥ä½¿ç”¨ï¼š</p><pre class=" language-shell"><code class="language-shell">bash startup.sh -m standalone</code></pre><p>å¯åŠ¨æˆåŠŸåï¼Œè®¿é—® <a href="http://localhost:8848/nacos" target="_blank" rel="noopener">http://localhost:8848/nacos</a> å³å¯çœ‹åˆ°å›¾å½¢ç•Œé¢ï¼Œé»˜è®¤è´¦å·å’Œå¯†ç éƒ½æ˜¯nacos</p><h2 id="æ„å»ºæœåŠ¡æä¾›è€…æ¨¡å—">3.2 æ„å»ºæœåŠ¡æä¾›è€…æ¨¡å—</h2><p>æ–°å»ºæ¨¡å—<code>cloudalibaba-provider-payment9001</code>ï¼Œä¾èµ–ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- nacos-discovery --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>å› ä¸ºçˆ¶å·¥ç¨‹å·²ç»å¼•å…¥</p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--Spring cloud alibaba 2.1.0.RELEASE--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>${spring.cloud.alibaba.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">></span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>è¿™é‡Œä¸å†å¼•å…¥</p><p>yamlé…ç½®ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9002</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span><span class="token key atrule">management</span><span class="token punctuation">:</span>  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>    <span class="token key atrule">web</span><span class="token punctuation">:</span>      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">'*'</span></code></pre><p>å¯åŠ¨ç±»:</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableDiscoveryClient</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentMain9002</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>PaymentMain9002<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>controller:</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${server.port}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String serverPort<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/payment/nacos/{id}"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">getPayment</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Integer id<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"nacos registry, serverPort: "</span> <span class="token operator">+</span> serverPort<span class="token operator">+</span><span class="token string">"\t id:"</span> <span class="token operator">+</span>id<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¿è¡Œè¯¥æ¨¡å—ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°è¯¥æœåŠ¡è¢«æ³¨å†Œåˆ°nacosä¸Šé¢äº†ï¼Œå†å»ºç«‹ä¸€ä¸ªå†…å®¹ç›¸åŒçš„9002æ¨¡å—å¹¶å¯åŠ¨ï¼Œå¯ä»¥çœ‹åˆ°è¯¥æœåŠ¡å­˜åœ¨ä¸¤ä¸ªå®ä¾‹ï¼š</p><p><img src="https://api.codetool.top/img/15849428997279.png" alt></p><h2 id="æœåŠ¡è°ƒç”¨è€…æ¨¡å—æ­å»º">3.3 æœåŠ¡è°ƒç”¨è€…æ¨¡å—æ­å»º</h2><p>æ–°å»ºæ¨¡å—<code>cloudalibaba-consumer-nacos-order83</code>ï¼Œä¾èµ–ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.rhett<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>yamlé…ç½®ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">83</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>order<span class="token punctuation">-</span>consumer  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span><span class="token comment" spellcheck="true"># æ¶ˆè´¹è€…å°†è¦å»è®¿é—®çš„å¾®æœåŠ¡åç§°ï¼Œè¿™æ˜¯è‡ªå®šä¹‰é…ç½®é¡¹</span><span class="token key atrule">service-url</span><span class="token punctuation">:</span>  <span class="token key atrule">nacos-user-service</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//nacos<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider</code></pre><p>å¯åŠ¨ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableDiscoveryClient</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderNacosMain83</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>OrderNacosMain83<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>é…ç½®RestTemplateï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationContextConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token annotation punctuation">@LoadBalanced</span>    <span class="token keyword">public</span> RestTemplate <span class="token function">getRestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>controller:</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderNacosController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> RestTemplate restTemplate<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${service-url.nacos-user-service}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String serverUrl<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/consumer/payment/nacos/{id}"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">paymentInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Integer id<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>serverUrl <span class="token operator">+</span> <span class="token string">"/payment/nacos/"</span> <span class="token operator">+</span> id<span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è®¿é—® <a href="http://localhost:83/consumer/payment/nacos/13" target="_blank" rel="noopener">http://localhost:83/consumer/payment/nacos/13</a> å³å¯çœ‹åˆ°9001ã€9002äº¤æ›¿æä¾›æœåŠ¡ï¼Œæ˜¯å› ä¸ºnacoså·²ç»ç»§æ‰¿äº†ribbonè´Ÿè½½å‡è¡¡ï¼š</p><p><img src="https://api.codetool.top/img/15849440797948.png" alt></p><h1 id="Nacos-APå’ŒCPçš„åˆ‡æ¢">4 Nacos APå’ŒCPçš„åˆ‡æ¢</h1><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸éœ€è¦å­˜å‚¨æœåŠ¡çº§åˆ«çš„ä¿¡æ¯ä¸”æœåŠ¡å®ä¾‹æ˜¯é€šè¿‡nacos-clientæ³¨å†Œï¼Œå¹¶èƒ½å¤Ÿä¿æŒå¿ƒè·³ä¸ŠæŠ¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€‰æ‹©APæ¨¡å¼ã€‚å½“å‰ä¸»æµçš„æœåŠ¡å¦‚Spring cloudå’ŒDubboæœåŠ¡,éƒ½é€‚ç”¨äºAPæ¨¡å¼ï¼ŒAPæ¨¡å¼ä¸ºäº†æœåŠ¡çš„å¯èƒ½æ€§è€Œå‡å¼±äº†ä¸€è‡´æ€§ï¼Œ å› æ­¤APæ¨¡å¼ä¸‹åªæ”¯æŒæ³¨å†Œä¸´æ—¶å®ä¾‹ã€‚</p><p>å¦‚æœéœ€è¦åœ¨æœåŠ¡çº§åˆ«ç¼–è¾‘æˆ–è€…å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆCPæ˜¯å¿…é¡»ï¼ŒK8SæœåŠ¡å’ŒDNSæœåŠ¡åˆ™é€‚ç”¨äºCPæ¨¡å¼ã€‚CPæ¨¡å¼ä¸‹åˆ™æ”¯æŒæ³¨å†ŒæŒä¹…åŒ–å®ä¾‹ï¼Œæ­¤æ—¶åˆ™æ˜¯ä»¥Raftåè®®ä¸ºé›†ç¾¤è¿è¡Œæ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸‹æ³¨å†Œå®ä¾‹ä¹‹å‰å¿…é¡»å…ˆæ³¨å†ŒæœåŠ¡,å¦‚æœæœåŠ¡ä¸å­˜åœ¨,åˆ™ä¼šè¿”å›é”™è¯¯ã€‚</p><p>åˆ‡æ¢æ–¹æ³•ï¼šå‘ <code>$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode&amp;value=CP</code> å‘é€POSTè¯·æ±‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Spring-Cloud-Alibabaæ¦‚è¿°&quot;&gt;1 Spring Cloud Alibabaæ¦‚è¿°&lt;/h1&gt;&lt;p&gt;2018.10.31, Spring Cloud Alibaba æ­£å¼å…¥é©»äº†Spring Cloudå®˜æ–¹å­µåŒ–å™¨ï¼Œå¹¶åœ¨Mavenä¸­å¤®ä»“åº“å‘å¸ƒäº†ç¬¬ä¸€ä¸ªç‰ˆæœ¬ã€‚
      
    
    </summary>
    
    
      <category term="ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶" scheme="https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="å¾®æœåŠ¡" scheme="https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="Nacos" scheme="https://www.codetool.top/tags/Nacos/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼é“¾è·¯è·Ÿè¸ªè§£å†³æ–¹æ¡ˆ-SpringCloud Sleuth</title>
    <link href="https://www.codetool.top/article/%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-SpringCloud%20Sleuth/"/>
    <id>https://www.codetool.top/article/åˆ†å¸ƒå¼é“¾è·¯è·Ÿè¸ªè§£å†³æ–¹æ¡ˆ-SpringCloud Sleuth/</id>
    <published>2020-03-23T03:12:13.000Z</published>
    <updated>2020-03-23T03:14:04.699Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Sleuthæ¦‚è¿°">1 Sleuthæ¦‚è¿°</h1><p>åœ¨å¾®æœåŠ¡æ¡†æ¶ä¸­ï¼Œä¸€ä¸ªç”±å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚åœ¨åç«¯ç³»ç»Ÿä¸­ä¼šç»è¿‡å¤šä¸ªä¸åŒçš„çš„æœåŠ¡èŠ‚ç‚¹è°ƒç”¨æ¥ååŒäº§ç”Ÿæœ€åçš„è¯·æ±‚ç»“æœï¼Œæ¯ä¸€ä¸ªå‰æ®µè¯·æ±‚éƒ½ä¼šå½¢æˆä¸€æ¡å¤æ‚çš„åˆ†å¸ƒå¼æœåŠ¡è°ƒç”¨é“¾è·¯ï¼Œ é“¾è·¯ä¸­çš„ä»»ä½•ä¸€ç¯å‡ºç°é«˜å»¶æ—¶æˆ–é”™è¯¯éƒ½ä¼šå¼•èµ·æ•´ä¸ªè¯·æ±‚æœ€åçš„å¤±è´¥ã€‚</p><p>Spring Cloud Sleuthæä¾›äº†ä¸€å¥—å®Œæ•´çš„æœåŠ¡è·Ÿè¸ªçš„è§£å†³æ–¹æ¡ˆï¼Œå¹¶ä¸”å…¼å®¹æ”¯æŒäº†zipkin</p><h1 id="å®Œæ•´çš„è°ƒç”¨é“¾è·¯">2 å®Œæ•´çš„è°ƒç”¨é“¾è·¯</h1><p>ä¸€æ¡é“¾è·¯é€šè¿‡Trace Idå”¯ä¸€æ ‡è¯†ï¼ŒSpanæ ‡è¯†å‘èµ·çš„è¯·æ±‚ä¿¡æ¯</p><ul><li>Trace:ç±»ä¼¼äºæ ‘ç»“æ„çš„Spané›†åˆ,è¡¨ç¤ºä¸€æ¡è°ƒç”¨é“¾è·¯,å­˜åœ¨å”¯ä¸€æ ‡è¯†</li><li>span:è¡¨ç¤ºè°ƒç”¨é“¾è·¯æ¥æº,é€šä¿—çš„ç†è§£spanå°±æ˜¯ä¸€æ¬¡è¯·æ±‚ä¿¡æ¯</li></ul><p><img src="https://api.codetool.top/img/15849290755080.png" alt></p><p>å„spané€šè¿‡parent idå…³è”èµ·æ¥ï¼Œä¸‹å›¾å±•ç¤ºäº†spançš„çˆ¶å­å…³ç³»ï¼š</p><p><img src="https://api.codetool.top/img/15849291558396.png" alt></p><h1 id="ä½¿ç”¨ç¤ºä¾‹">3 ä½¿ç”¨ç¤ºä¾‹</h1><h2 id="zipkinçš„ä¸‹è½½å’Œè¿è¡Œ">3.1 zipkinçš„ä¸‹è½½å’Œè¿è¡Œ</h2><p>SpringCloudä»Fç‰ˆèµ·å·²ä¸éœ€è¦è‡ªå·±æ„å»ºZipkin Serveräº†ï¼Œåªéœ€è°ƒç”¨jaråŒ…å³å¯</p><p>ä¸‹è½½åœ°å€ï¼š <a href="https://dl.bintray.com/openzipkin/maven/io/zipkin/java/zipkin-server/" target="_blank" rel="noopener">https://dl.bintray.com/openzipkin/maven/io/zipkin/java/zipkin-server/</a></p><p>è¿™é‡Œé€‰æ‹©<code>2.12.9/zipkin-server-2.12.9-exec.jar</code>ä¸‹è½½ã€‚</p><p>ä¸‹è½½å®Œæˆä¹‹åç›´æ¥è¿è¡Œï¼š</p><p><img src="https://api.codetool.top/img/15849289118046.png" alt></p><p>è¿è¡ŒæˆåŠŸä¹‹åï¼Œæµè§ˆå™¨è®¿é—® <a href="http://localhost:9411/" target="_blank" rel="noopener">http://localhost:9411/</a> å°±èƒ½çœ‹åˆ°ç®¡ç†ç•Œé¢äº†</p><h2 id="åˆ›å»ºé¡¹ç›®">3.2 åˆ›å»ºé¡¹ç›®</h2><p>åœ¨ä¹‹å‰çš„<code>cloud-provider-payment8001</code>å’Œ<code>cloud-consumer-order80</code>ä¸­æ·»åŠ ä¾èµ–ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-zipkin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>ä¸¤ä¸ªæ¨¡å—é…ç½®æ·»åŠ ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">zipkin</span><span class="token punctuation">:</span>    <span class="token key atrule">base-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">9411</span>  <span class="token key atrule">sleuth</span><span class="token punctuation">:</span>    <span class="token key atrule">sampler</span><span class="token punctuation">:</span>      <span class="token comment" spellcheck="true"># é‡‡æ ·ç‡ï¼Œ1ä»£è¡¨å…¨éƒ¨é‡‡é›†</span>      <span class="token key atrule">probability</span><span class="token punctuation">:</span> <span class="token number">1</span></code></pre><p>8001æ·»åŠ ä¸€ä¸ªcontrolleræ–¹æ³•ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/payment/zipkin"</span><span class="token punctuation">)</span><span class="token keyword">public</span> String <span class="token function">paymentZipkin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token string">"payment zipkin invoke"</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>80æ·»åŠ ä¸€ä¸ªcontrolleræ–¹æ³•ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/consumer/payment/zipkin"</span><span class="token punctuation">)</span><span class="token keyword">public</span> String <span class="token function">paymentZipkin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>PAYMENT_URL<span class="token operator">+</span><span class="token string">"/payment/zipkin"</span><span class="token punctuation">,</span>String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>è®¿é—® <a href="http://localhost/consumer/payment/zipkin" target="_blank" rel="noopener">http://localhost/consumer/payment/zipkin</a> ï¼ŒæŸ¥çœ‹zipkinç•Œé¢æ˜¾ç¤º</p><p><img src="https://api.codetool.top/img/1584932861336.png" alt></p><p>å¯ä»¥æŸ¥çœ‹åˆ°ç›¸å…³çš„è°ƒç”¨ï¼Œå‘ç”Ÿé”™è¯¯çš„æƒ…å†µä¹Ÿèƒ½çœ‹åˆ°</p><p><img src="https://api.codetool.top/img/15849329241929.png" alt></p><p>æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼š</p><p><img src="https://api.codetool.top/img/15849330161456.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Sleuthæ¦‚è¿°&quot;&gt;1 Sleuthæ¦‚è¿°&lt;/h1&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¡†æ¶ä¸­ï¼Œä¸€ä¸ªç”±å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚åœ¨åç«¯ç³»ç»Ÿä¸­ä¼šç»è¿‡å¤šä¸ªä¸åŒçš„çš„æœåŠ¡èŠ‚ç‚¹è°ƒç”¨æ¥ååŒäº§ç”Ÿæœ€åçš„è¯·æ±‚ç»“æœï¼Œæ¯ä¸€ä¸ªå‰æ®µè¯·æ±‚éƒ½ä¼šå½¢æˆä¸€æ¡å¤æ‚çš„åˆ†å¸ƒå¼æœåŠ¡è°ƒç”¨é“¾è·¯ï¼Œ é“¾è·¯ä¸­çš„ä»»ä½•ä¸€ç¯å‡ºç°é«˜å»¶æ—¶æˆ–é”™è¯¯éƒ½ä¼šå¼•èµ·æ•´ä¸ªè¯·æ±‚
      
    
    </summary>
    
    
      <category term="ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶" scheme="https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="å¾®æœåŠ¡" scheme="https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="SpringCloud Sleuth" scheme="https://www.codetool.top/tags/SpringCloud-Sleuth/"/>
    
  </entry>
  
  <entry>
    <title>SpringCloud Streamçš„äº†è§£åŠä½¿ç”¨</title>
    <link href="https://www.codetool.top/article/SpringCloud%20Stream%E7%9A%84%E4%BA%86%E8%A7%A3%E5%8F%8A%E4%BD%BF%E7%94%A8/"/>
    <id>https://www.codetool.top/article/SpringCloud Streamçš„äº†è§£åŠä½¿ç”¨/</id>
    <published>2020-03-23T01:42:31.000Z</published>
    <updated>2020-03-23T01:43:40.910Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯SpringCloud-Stream">1 ä»€ä¹ˆæ˜¯SpringCloud Stream</h1><p>å®˜æ–¹å®šä¹‰Spring Cloud Streamæ˜¯ä¸€ä¸ªæ„å»ºæ¶ˆæ¯é©±åŠ¨å¾®æœåŠ¡çš„æ¡†æ¶ï¼Œå®ƒçš„ç›®æ ‡æ˜¯å±è”½åº•å±‚æ¶ˆæ¯ä¸­é—´ä»¶çš„å·®å¼‚,é™ä½åˆ‡æ¢æˆæœ¬ï¼Œç»Ÿä¸€æ¶ˆæ¯çš„ç¼–ç¨‹æ¨¡å‹ã€‚</p><p><strong>åº”ç”¨ç¨‹åºé€šè¿‡<code>inputs</code>æˆ–è€…<code>outputs</code>ä¸Spring Cloud Streamä¸­binderå¯¹è±¡äº¤äº’ã€‚</strong> é€šè¿‡æˆ‘ä»¬é…ç½®æ¥binding(ç»‘å®š)ï¼Œè€ŒSpring Cloud Streamçš„binderå¯¹è±¡è´Ÿè´£ä¸æ¶ˆæ¯ä¸­é—´ä»¶äº¤äº’ã€‚ç›®å‰ä»…æ”¯æŒRabbitMQã€Kafkaã€‚</p><p>æ‰€ä»¥,æˆ‘ä»¬åªéœ€è¦ææ¸…æ¥šå¦‚ä½•ä¸Spring Cloud Streamäº¤äº’å°±å¯ä»¥æ–¹ä¾¿ä½¿ç”¨æ¶ˆæ¯é©±åŠ¨çš„æ–¹å¼ã€‚é€šè¿‡ä½¿ç”¨<code>Spring Integration</code>æ¥è¿æ¥æ¶ˆæ¯ä»£ç†ä¸­é—´ä»¶ä»¥å®ç°æ¶ˆæ¯äº‹ä»¶é©±åŠ¨ã€‚</p><p>Spring Cloud Streamä¸ºä¸€äº›ä¾›åº”å•†çš„æ¶ˆæ¯ä¸­é—´ä»¶äº§å“æä¾›äº†ä¸ªæ€§åŒ–çš„è‡ªåŠ¨åŒ–é…ç½®å®ç°ï¼Œå¼•ç”¨äº†<strong>å‘å¸ƒ-è®¢é˜…ã€æ¶ˆè´¹ç»„ã€åˆ†åŒº</strong>çš„ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚</p><p><strong>ç›®å‰ä»…æ”¯æŒRabbitMQã€Kafka</strong></p><p><img src="https://api.codetool.top/img/15848860507579.png" alt></p><h1 id="ç¼–ç API">2 ç¼–ç API</h1><table><thead><tr><th>ç»„æˆ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Middleware</td><td>ä¸­é—´ä»¶ï¼Œç›®å‰åªæ”¯æŒRabbitMQå’ŒKafka</td></tr><tr><td>Binder</td><td>æ˜¯åº”ç”¨ä¸æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹é—´çš„å°è£…ï¼Œç›®å‰å®è¡Œäº†Kafkaå’ŒRabitMQçš„Binder,é€šè¿‡Binderå¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿æ¥ä¸­é—´ä»¶,å¯ä»¥åŠ¨æ€çš„æ”¹å˜æ¶ˆæ¯ç±»å‹(å¯¹åº”äºKafkaçš„topicï¼ŒRabitMQçš„exchange)ï¼Œè¿™äº›éƒ½å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥å®ç°</td></tr><tr><td>Channel</td><td>é€šé“,æ˜¯é˜Ÿåˆ—Queueçš„ä¸€ç§æŠ½è±¡,åœ¨æ¶ˆæ¯é€šè®¯ç³»ç»Ÿä¸­å°±æ˜¯å®ç°å­˜å‚¨å’Œè½¬å‘çš„åª’ä»‹,é€šè¿‡Channelå¯¹é˜Ÿåˆ—è¿›è¡Œé…ç½®</td></tr><tr><td>Sourceå’ŒSink</td><td>ç®€å•çš„å¯ç†è§£ä¸ºå‚è€ƒå¯¹è±¡æ˜¯Spring Cloud Streamçš„è‡ªèº«,ä»Streamå‘å¸ƒä¿¡æ¯å°±æ˜¯è¾“å‡º,æ¥å—æ¶ˆæ¯å°±æ˜¯è¾“å…¥</td></tr><tr><td>@Input</td><td>æ³¨è§£æ ‡è¯†è¾“å…¥é€šé“ï¼Œé€šè¿‡è¯¥è¾“å…¥é€šé“æ¥æ”¶åˆ°çš„æ¶ˆæ¯è¿›å…¥åº”ç”¨ç¨‹åº</td></tr><tr><td>@Output</td><td>æ³¨è§£æ ‡è¯†è¾“å‡ºé€šé“ï¼Œå‘å¸ƒçš„æ¶ˆæ¯å°†é€šè¿‡è¯¥é€šé“ç¦»å¼€åº”ç”¨ç¨‹åº</td></tr><tr><td>@StreamListener</td><td>ç›‘å¬é˜Ÿåˆ—ï¼Œç”¨äºæ¶ˆè´¹è€…çš„é˜Ÿåˆ—çš„æ¶ˆæ¯æ¥æ”¶</td></tr><tr><td>@EnableBinding</td><td>æŒ‡ä¿¡é“channelå’Œexchangeç»‘å®šåœ¨ä¸€èµ·</td></tr></tbody></table><h1 id="ç®€å•ä½¿ç”¨å®ä¾‹">3 ç®€å•ä½¿ç”¨å®ä¾‹</h1><h2 id="æ¶ˆæ¯ç”Ÿäº§è€…">3.1 æ¶ˆæ¯ç”Ÿäº§è€…</h2><p>æ–°å»ºæ¨¡å—<code>cloud-stream-rabbitmq-provider8801</code>ï¼Œä¾èµ–ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- spring-cloud-starter-stream-rabbit --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-stream-rabbit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>yamlé…ç½®ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8801</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>stream<span class="token punctuation">-</span>provider  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>    <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>    <span class="token key atrule">username</span><span class="token punctuation">:</span> guest    <span class="token key atrule">password</span><span class="token punctuation">:</span> guest  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">stream</span><span class="token punctuation">:</span>      <span class="token key atrule">binders</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">#åœ¨æ­¤é…ç½®è¦ç»‘å®šçš„rabbitmqçš„æœåŠ¡ä¿¡æ¯</span>        <span class="token key atrule">defaultRabbit</span><span class="token punctuation">:</span>          <span class="token key atrule">type</span><span class="token punctuation">:</span> rabbit <span class="token comment" spellcheck="true"># æ¶ˆæ¯ç»„ä»¶ç±»å‹</span>          <span class="token key atrule">environment</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># å¯å®ç°å¤šç¯å¢ƒé…ç½®</span>            <span class="token key atrule">spring</span><span class="token punctuation">:</span>              <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>                <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost                <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>                <span class="token key atrule">username</span><span class="token punctuation">:</span> guest                <span class="token key atrule">password</span><span class="token punctuation">:</span> guest      <span class="token key atrule">bindings</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">#æœåŠ¡çš„æ•´åˆå¤„ç†</span>        <span class="token key atrule">output</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">#è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§°</span>          <span class="token key atrule">destination</span><span class="token punctuation">:</span> studyExchange <span class="token comment" spellcheck="true"># è¡¨ç¤ºè¦ä½¿ç”¨çš„exchangeåç§°å®šä¹‰</span>          <span class="token key atrule">content-type</span><span class="token punctuation">:</span> application/json <span class="token comment" spellcheck="true"># è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸ºjsonï¼Œæ–‡æœ¬åˆ™è®¾ç½®â€œtext/plainâ€</span>          <span class="token key atrule">binder</span><span class="token punctuation">:</span> defaultRabbit<span class="token key atrule">eureka</span><span class="token punctuation">:</span>  <span class="token key atrule">client</span><span class="token punctuation">:</span>    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka7001.com<span class="token punctuation">:</span>7001/eureka  <span class="token key atrule">instance</span><span class="token punctuation">:</span>    <span class="token key atrule">lease-renewal-interval-in-seconds</span><span class="token punctuation">:</span> <span class="token number">2 </span><span class="token comment" spellcheck="true">#è®¾ç½®å¿ƒè·³çš„æ—¶é—´é—´éš”</span>    <span class="token key atrule">lease-expiration-duration-in-seconds</span><span class="token punctuation">:</span> <span class="token number">5 </span><span class="token comment" spellcheck="true"># å¦‚æœç°åœ¨è¶…è¿‡äº†5ç§’çš„é—´éš”</span>    <span class="token key atrule">instance-id</span><span class="token punctuation">:</span> send<span class="token punctuation">-</span>8801.com    <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true </span><span class="token comment" spellcheck="true">#è®¿é—®çš„è·¯å¾„å˜ä¸ºipåœ°å€</span></code></pre><p>å¯åŠ¨ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StreamMQMain8801</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>StreamMQMain8801<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å‘é€æ¶ˆæ¯æ¥å£ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IMessageProvider</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å®ç°ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> com<span class="token punctuation">.</span>rhett<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>service<span class="token punctuation">.</span>IMessageProvider<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>EnableBinding<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span>Source<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>integration<span class="token punctuation">.</span>support<span class="token punctuation">.</span>MessageBuilder<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span>MessageChannel<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Resource<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>UUID<span class="token punctuation">;</span><span class="token annotation punctuation">@EnableBinding</span><span class="token punctuation">(</span>Source<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//å®šä¹‰æ¶ˆæ¯çš„æ¨é€ç®¡é“</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageProviderImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IMessageProvider</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> MessageChannel output<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//æ¶ˆæ¯å‘é€ç®¡é“</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        String serial <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        output<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>MessageBuilder<span class="token punctuation">.</span><span class="token function">withPayload</span><span class="token punctuation">(</span>serial<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"*******serial:"</span><span class="token operator">+</span>serial<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>controller:</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendMessageController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> IMessageProvider messageProvider<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/sendMessage"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> messageProvider<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="æ¶ˆæ¯æ¶ˆè´¹è€…">3.2 æ¶ˆæ¯æ¶ˆè´¹è€…</h2><p>æ–°å»º<code>cloud-stream-rabbitmq-consumer8802</code>æ¨¡å—ï¼Œä¾èµ–å’Œ<code>cloud-stream-rabbitmq-provider8801</code>ä¸€æ ·ã€‚</p><p>yamlé…ç½®ä¹Ÿå¾ˆç±»ä¼¼ï¼š</p><pre class=" language-yml"><code class="language-yml">server:  port: 8802spring:  application:    name: cloud-stream-consumer  rabbitmq:    host: localhost    port: 5672    username: guest    password: guest  cloud:    stream:      binders: # åœ¨æ­¤å¤„é…ç½®è¦ç»‘å®šçš„rabbitMQçš„æœåŠ¡ä¿¡æ¯        defaultRabbit: # è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äºbindingçš„æ•´åˆ          type: rabbit # æ¶ˆæ¯ä¸­é—´ä»¶ç±»å‹          environment: # è®¾ç½®rabbitMQçš„ç›¸å…³ç¯å¢ƒé…ç½®            spring:              rabbitmq:                host: localhost                port: 5672                username: guest                password: guest      bindings: # æœåŠ¡çš„æ•´åˆå¤„ç†        input: # è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§°          destination: studyExchange # è¡¨ç¤ºè¦ä½¿ç”¨çš„exchangeåç§°å®šä¹‰          content-type: application/json # è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸ºjsonï¼Œæ–‡æœ¬åˆ™è®¾ä¸ºtext/plain          binder: defaultRabbit # è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½®eureka:  client:    service-url:      defaultZone: http://eureka7001.com:7001/eureka  instance:    lease-renewal-interval-in-seconds: 2 # è®¾ç½®å¿ƒè·³çš„é—´éš”æ—¶é—´ï¼Œé»˜è®¤30    lease-expiration-duration-in-seconds: 5 # è¶…è¿‡5ç§’é—´éš”ï¼Œé»˜è®¤90    instance-id: receive-8802.com    prefer-ip-address: true</code></pre><p>å¯åŠ¨ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StreamMQMain8802</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>StreamMQMain8802<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æ¶ˆè´¹æ¶ˆæ¯ä¸šåŠ¡ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@EnableBinding</span><span class="token punctuation">(</span>Sink<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReceiveMessageListenerController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${server.port}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String serverPort<span class="token punctuation">;</span>    <span class="token annotation punctuation">@StreamListener</span><span class="token punctuation">(</span>Sink<span class="token punctuation">.</span>INPUT<span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">input</span><span class="token punctuation">(</span>Message<span class="token operator">&lt;</span>String<span class="token operator">></span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆè´¹è€…1å·ï¼Œ----->æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š"</span><span class="token operator">+</span>message<span class="token punctuation">.</span><span class="token function">getPayload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\t port:"</span><span class="token operator">+</span>serverPort<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h1 id="åˆ†ç»„æ¶ˆè´¹">4 åˆ†ç»„æ¶ˆè´¹</h1><p>ä¸Šé¢æ­å»ºçš„ç®€å•ä½¿ç”¨å®ä¾‹ä»ç„¶å­˜åœ¨ç€é—®é¢˜ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªå†…å®¹å’Œ<code>cloud-stream-rabbitmq-consumer8802</code>ä¸€æ ·çš„æ¨¡å—<code>cloud-stream-rabbitmq-consumer8803</code>ï¼Œä½œä¸ºæ¶ˆæ¯çš„ç¬¬äºŒä¸ªæ¶ˆæ¯æ¶ˆè´¹è€…ã€‚è¿è¡Œ8801ã€8802ã€8803åå‘ç°ï¼Œ8801å‘é€ä¸€æ¡æ¶ˆæ¯åï¼Œ8802å’Œ8803éƒ½å¤„ç†äº†è¯¥æ¶ˆæ¯ï¼Œè¿™å°±æ˜¯é‡å¤æ¶ˆè´¹çš„é—®é¢˜ï¼ˆå®é™…ä¸Šå¹¶ä¸æ˜¯é‡å¤æ¶ˆè´¹ï¼Œè€Œæ˜¯<strong>å¯¹æ¯ä¸ªåˆ†ç»„éƒ½å­˜åœ¨ä¸€ä¸ªç»‘å®šåˆ°exchangeçš„é˜Ÿåˆ—ï¼Œæ¶ˆæ¯ä¼šè¢«å‘é€åˆ°æ¯æ¡é˜Ÿåˆ—</strong>ï¼‰ã€‚å¯ä»¥åˆ©ç”¨åˆ†ç»„çš„ç‰¹æ€§æ¥è§£å†³ã€‚åœ¨cloud streamä¸­å¤„äºåŒä¸€ä¸ªgroupä¸­çš„å¤šä¸ªæ¶ˆè´¹è€…æ˜¯ç«äº‰å…³ç³»ï¼ˆå³ç›‘å¬åŒä¸€æ¡é˜Ÿåˆ—ï¼‰ï¼Œå°±èƒ½å¤Ÿä¿è¯æ¶ˆæ¯åªä¼šè¢«å…¶ä¸­ä¸€ä¸ªåº”ç”¨æ¶ˆè´¹ä¸€æ¬¡ã€‚</p><p><img src="https://api.codetool.top/img/15849265108647.png" alt></p><p>å¹¶ä¸”æ³¨æ„åˆ°é»˜è®¤é…ç½®çš„é˜Ÿåˆ—å…·æœ‰AutoDeleteå±æ€§ï¼Œåœ¨æ¶ˆè´¹è€…åº”ç”¨åœæ­¢è¿è¡Œåå°±ä¼šè‡ªåŠ¨åˆ é™¤é˜Ÿåˆ—ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µã€‚</p><p>åœ¨8802ä¸­é…ç½®<code>spring.cloud.stream.bindings.input.group=spectrumrpcA</code>,8803é…ç½®<code>spring.cloud.stream.bindings.input.group=spectrumrpcB</code>ï¼Œå†æ¬¡æŸ¥çœ‹rabbitmqæ§åˆ¶ç•Œé¢ï¼Œå¯è§é˜Ÿåˆ—åå‘ç”Ÿå˜åŒ–</p><p><img src="https://api.codetool.top/img/15849269157417.png" alt></p><p><strong>å¹¶ä¸”è‡ªå®šä¹‰groupåç”Ÿæˆçš„é˜Ÿåˆ—å…·æœ‰durableå±æ€§ï¼Œå³é˜Ÿåˆ—æ˜¯æŒä¹…åŒ–çš„ï¼Œå³ä½¿æ¶ˆè´¹è€…åº”ç”¨é‡å¯ï¼Œä¹Ÿä¸ä¼šä¸¢å¤±æ¶ˆæ¯ã€‚</strong></p><p>æˆ‘ä»¬æŠŠ8802å’Œ8803çš„groupéƒ½é…ç½®æˆ<code>spectrumrpcA</code>ï¼Œå†æ¬¡è¿è¡Œåº”ç”¨ï¼Œæ¶ˆæ¯å°±ä¸ä¼šè¢«å¤šå¤„æ¶ˆè´¹äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ä»€ä¹ˆæ˜¯SpringCloud-Stream&quot;&gt;1 ä»€ä¹ˆæ˜¯SpringCloud Stream&lt;/h1&gt;&lt;p&gt;å®˜æ–¹å®šä¹‰Spring Cloud Streamæ˜¯ä¸€ä¸ªæ„å»ºæ¶ˆæ¯é©±åŠ¨å¾®æœåŠ¡çš„æ¡†æ¶ï¼Œå®ƒçš„ç›®æ ‡æ˜¯å±è”½åº•å±‚æ¶ˆæ¯ä¸­é—´ä»¶çš„å·®å¼‚,é™ä½åˆ‡æ¢æˆæœ¬ï¼Œç»Ÿä¸€æ¶ˆæ¯çš„ç¼–ç¨‹æ¨¡å‹ã€‚&lt;/p&gt;
      
    
    </summary>
    
    
      <category term="ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶" scheme="https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="å¾®æœåŠ¡" scheme="https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="SpringCloud Stream" scheme="https://www.codetool.top/tags/SpringCloud-Stream/"/>
    
  </entry>
  
  <entry>
    <title>leetcode876-é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹</title>
    <link href="https://www.codetool.top/article/leetcode876-%E9%93%BE%E8%A1%A8%E7%9A%84%E4%B8%AD%E9%97%B4%E7%BB%93%E7%82%B9/"/>
    <id>https://www.codetool.top/article/leetcode876-é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹/</id>
    <published>2020-03-23T00:51:39.000Z</published>
    <updated>2020-03-23T00:54:58.558Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åŸé¢˜">1 åŸé¢˜</h1><p>ç»™å®šä¸€ä¸ªå¸¦æœ‰å¤´ç»“ç‚¹ <code>head</code> çš„éç©ºå•é“¾è¡¨ï¼Œè¿”å›é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹ã€‚</p><p>å¦‚æœæœ‰ä¸¤ä¸ªä¸­é—´ç»“ç‚¹ï¼Œåˆ™è¿”å›ç¬¬äºŒä¸ªä¸­é—´ç»“ç‚¹ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><blockquote><p><strong>è¾“å…¥ï¼š</strong> [1,2,3,4,5]<br><strong>è¾“å‡ºï¼š</strong> æ­¤åˆ—è¡¨ä¸­çš„ç»“ç‚¹ 3 (åºåˆ—åŒ–å½¢å¼ï¼š[3,4,5])<br>è¿”å›çš„ç»“ç‚¹å€¼ä¸º 3 ã€‚ (æµ‹è¯„ç³»ç»Ÿå¯¹è¯¥ç»“ç‚¹åºåˆ—åŒ–è¡¨è¿°æ˜¯ [3,4,5])ã€‚<br>æ³¨æ„ï¼Œæˆ‘ä»¬è¿”å›äº†ä¸€ä¸ª ListNode ç±»å‹çš„å¯¹è±¡ ansï¼Œè¿™æ ·ï¼š<br>ans.val = 3, ans.next.val = 4, ans.next.next.val = 5, ä»¥åŠ ans.next.next.next = NULL.  </p></blockquote><p><strong>ç¤ºä¾‹ 2:</strong></p><blockquote><p><strong>è¾“å…¥ï¼š</strong> [1,2,3,4,5,6]<br><strong>è¾“å‡ºï¼š</strong> æ­¤åˆ—è¡¨ä¸­çš„ç»“ç‚¹ 4 (åºåˆ—åŒ–å½¢å¼ï¼š[4,5,6])<br>ç”±äºè¯¥åˆ—è¡¨æœ‰ä¸¤ä¸ªä¸­é—´ç»“ç‚¹ï¼Œå€¼åˆ†åˆ«ä¸º 3 å’Œ 4ï¼Œæˆ‘ä»¬è¿”å›ç¬¬äºŒä¸ªç»“ç‚¹ã€‚  </p></blockquote><p><strong>æç¤ºï¼š</strong></p><ul><li>ç»™å®šé“¾è¡¨çš„ç»“ç‚¹æ•°ä»‹äº <code>1</code> å’Œ <code>100</code> ä¹‹é—´ã€‚</li></ul><h1 id="è§£æ³•">2 è§£æ³•</h1><h2 id="æ€æƒ³">2.1 æ€æƒ³</h2><p>å¿«æ…¢æŒ‡é’ˆ</p><h2 id="ä»£ç ">2.2 ä»£ç </h2><pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> ListNode <span class="token function">middleNode</span><span class="token punctuation">(</span>ListNode head<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ListNode fast<span class="token punctuation">,</span>slow<span class="token punctuation">;</span>        fast <span class="token operator">=</span> slow <span class="token operator">=</span> head<span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>fast<span class="token operator">!=</span>null <span class="token operator">&amp;&amp;</span> fast<span class="token punctuation">.</span>next<span class="token operator">!=</span>null<span class="token punctuation">)</span><span class="token punctuation">{</span>            fast <span class="token operator">=</span> fast<span class="token punctuation">.</span>next<span class="token punctuation">.</span>next<span class="token punctuation">;</span>            slow <span class="token operator">=</span> slow<span class="token punctuation">.</span>next<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> slow<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;åŸé¢˜&quot;&gt;1 åŸé¢˜&lt;/h1&gt;&lt;p&gt;ç»™å®šä¸€ä¸ªå¸¦æœ‰å¤´ç»“ç‚¹ &lt;code&gt;head&lt;/code&gt; çš„éç©ºå•é“¾è¡¨ï¼Œè¿”å›é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæœ‰ä¸¤ä¸ªä¸­é—´ç»“ç‚¹ï¼Œåˆ™è¿”å›ç¬¬äºŒä¸ªä¸­é—´ç»“ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹ 1:&lt;/strong&gt;&lt;/p&gt;
&lt;blockq
      
    
    </summary>
    
    
      <category term="ç®—æ³•/æ•°æ®ç»“æ„" scheme="https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
      <category term="leetcode" scheme="https://www.codetool.top/tags/leetcode/"/>
    
      <category term="ç®—æ³•" scheme="https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨SpringCloud Buså®Œå–„Configçš„åŠ¨æ€åˆ·æ–°</title>
    <link href="https://www.codetool.top/article/%E4%BD%BF%E7%94%A8SpringCloud%20Bus%E5%AE%8C%E5%96%84Config%E7%9A%84%E5%8A%A8%E6%80%81%E5%88%B7%E6%96%B0/"/>
    <id>https://www.codetool.top/article/ä½¿ç”¨SpringCloud Buså®Œå–„Configçš„åŠ¨æ€åˆ·æ–°/</id>
    <published>2020-03-22T13:49:10.000Z</published>
    <updated>2020-03-22T13:50:17.880Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringCloud-Busæ¦‚è¿°">1 SpringCloud Busæ¦‚è¿°</h1><p>Spring Cloud Busæ˜¯å°†åˆ†å¸ƒå¼ç³»ç»Ÿçš„èŠ‚ç‚¹ä¸è½»é‡çº§æ¶ˆæ¯ç³»ç»Ÿé“¾æ¥èµ·æ¥çš„æ¡†æ¶ï¼Œå®ƒæ•´åˆäº†Javaçš„äº‹ä»¶å¤„ç†æœºåˆ¶å’Œæ¶ˆæ¯ä¸­é—´ä»¶çš„åŠŸèƒ½ã€‚</p><p><strong>Bus ç›®å‰åªæ”¯æŒRabbitMQå’ŒKafka</strong></p><h2 id="ä»€ä¹ˆæ˜¯æ€»çº¿">1.1 ä»€ä¹ˆæ˜¯æ€»çº¿</h2><p>åœ¨å¾®æœåŠ¡æ¶æ„çš„ç³»ç»Ÿä¸­ï¼Œé€šå¸¸ä¼š<strong>ä½¿ç”¨è½»é‡çº§çš„æ¶ˆæ¯ä»£ç†æ¥æ„å»ºä¸€ä¸ªå…±ç”¨çš„æ¶ˆæ¯ä¸»é¢˜, å¹¶è®©ç³»ç»Ÿä¸­æ‰€æœ‰å¾®æœåŠ¡å®ä¾‹éƒ½è¿æ¥ä¸Šæ¥</strong>ã€‚ç”±äºè¯¥ä¸»é¢˜ä¸­äº§ç”Ÿçš„æ¶ˆæ¯ä¼šè¢«æ‰€æœ‰å®ä¾‹ç›‘å¬å’Œæ¶ˆè´¹ï¼Œæ‰€ä»¥ç§°å®ƒä¸ºæ¶ˆæ¯æ€»çº¿ã€‚<strong>åœ¨æ€»çº¿ä¸Šçš„å„ä¸ªå®ä¾‹ï¼Œéƒ½å¯ä»¥æ–¹ä¾¿åœ°å¹¿æ’­ä¸€äº›éœ€è¦è®©å…¶ä»–è¿æ¥åœ¨è¯¥ä¸»é¢˜ä¸Šçš„å®ä¾‹éƒ½çŸ¥é“çš„æ¶ˆæ¯ã€‚</strong></p><h2 id="åŸºæœ¬åŸç†">1.2 åŸºæœ¬åŸç†</h2><p>ConfigClientå®ä¾‹éƒ½ç›‘å¬MQä¸­åŒä¸€ä¸ªtopic(é»˜è®¤æ˜¯<code>springCloudBus</code>)ã€‚ å½“-ä¸ªæœåŠ¡åˆ·æ–°æ•°æ®çš„æ—¶å€™,å®ƒä¼šæŠŠè¿™ä¸ªä¿¡æ¯æ”¾å…¥åˆ°Topicä¸­,è¿™æ ·å…¶å®ƒç›‘å¬åŒä¸€Topicçš„æœåŠ¡å°±èƒ½å¾—åˆ°é€šçŸ¥ï¼Œç„¶åå»æ›´æ–°è‡ªèº«çš„é…ç½®ã€‚</p><h1 id="ä½¿ç”¨SpringCloud-Busè§£å†³Configçš„åŠ¨æ€åˆ·æ–°é—®é¢˜">2 ä½¿ç”¨SpringCloud Busè§£å†³Configçš„åŠ¨æ€åˆ·æ–°é—®é¢˜</h1><p>åœ¨ä¸Šç¯‡æ–‡ç« <a href="../SpringCloud%20Configé…ç½®ä¸­å¿ƒçš„ä½¿ç”¨">SpringCloud Configé…ç½®ä¸­å¿ƒçš„ä½¿ç”¨</a>ä¸­ç•™ä¸‹äº†ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæœ‰å¤šä¸ªconfigçš„ä½¿ç”¨è€…ï¼Œå¦‚ä½•åœ¨é…ç½®ä¿®æ”¹çš„æ—¶å€™é€šçŸ¥å®ƒä»¬ï¼Ÿ</p><p>è®¾è®¡æ€è·¯ï¼š</p><ul><li>åˆ©ç”¨æ¶ˆæ¯æ€»çº¿è§¦å‘ä¸€ä¸ªå®¢æˆ·ç«¯<code>/bus/refresh</code>ï¼Œè€Œåˆ·æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„é…ç½®</li><li>åˆ©ç”¨æ¶ˆæ¯æ€»çº¿è§¦å‘ä¸€ä¸ªæœåŠ¡ç«¯ConfigServerçš„<code>/bus/refresh</code>ç«¯ç‚¹ï¼Œè€Œåˆ·æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„é…ç½®</li></ul><p>æ˜¾ç„¶ç¬¬äºŒç§æ€æƒ³ä¼šæ›´å¥½ï¼ŒåŸå› æœ‰ï¼š</p><ul><li>æ‰“ç ´äº†å¾®æœåŠ¡çš„èŒè´£å•ä¸€æ€§ï¼Œå› ä¸ºå¾®æœåŠ¡æœ¬èº«æ˜¯ä¸šåŠ¡æ¨¡å—ï¼Œå®ƒæœ¬ä¸åº”è¯¥æ‰¿æ‹…é…ç½®åˆ·æ–°çš„èŒè´£ã€‚</li><li>ç ´åäº†å¾®æœåŠ¡å„èŠ‚ç‚¹çš„å¯¹ç­‰æ€§ã€‚</li><li>æœ‰ä¸€å®šçš„å±€é™æ€§ã€‚ä¾‹å¦‚ï¼Œå¾®æœåŠ¡åœ¨è¿ç§»æ—¶ï¼Œå®ƒçš„ç½‘ç»œåœ°å€å¸¸å¸¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ­¤æ—¶å¦‚æœæƒ³è¦åšåˆ°è‡ªåŠ¨åˆ·æ–°ï¼Œé‚£å°±ä¼šå¢åŠ æ›´å¤šçš„ä¿®æ”¹</li></ul><p>æˆ‘ä»¬æ–°å»ºæ¨¡å—<code>cloud-config-client3366</code>ä½œä¸ºconfigçš„ç¬¬äºŒä¸ªä½¿ç”¨è€…ï¼Œå°†å®ƒå’Œ<code>cloud-config-client3355</code>çš„pomä¾èµ–éƒ½ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼ˆä¸ºconfigæœåŠ¡å™¨ä¹Ÿæ·»åŠ <code>spring-cloud-starter-bus-amqp</code>ä¾èµ–ï¼‰ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- æ·»åŠ rabbitmq æ€»çº¿æ”¯æŒ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-bus-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>yamlé…ç½®ï¼šï¼ˆæ–‡ä»¶åä¹Ÿè¦æ˜¯<code>bootstrap.yml</code>ï¼‰</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3366</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>client  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">config</span><span class="token punctuation">:</span>      <span class="token key atrule">label</span><span class="token punctuation">:</span> master <span class="token comment" spellcheck="true"># åˆ†æ”¯åç§°</span>      <span class="token key atrule">name</span><span class="token punctuation">:</span> config <span class="token comment" spellcheck="true"># é…ç½®æ–‡ä»¶åç§°</span>      <span class="token key atrule">profile</span><span class="token punctuation">:</span> dev <span class="token comment" spellcheck="true"># è¯»å–çš„profile</span>      <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">3344 </span><span class="token comment" spellcheck="true">#é…ç½®ä¸­å¿ƒçš„åœ°å€</span>  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">#rabbitmqç›¸å…³é…ç½®ï¼Œè¯·ä¸º3355ä¹Ÿæ·»åŠ è¿™ä¸€éƒ¨åˆ†</span>    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>    <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost    <span class="token key atrule">username</span><span class="token punctuation">:</span> guest    <span class="token key atrule">password</span><span class="token punctuation">:</span> guest<span class="token key atrule">eureka</span><span class="token punctuation">:</span>  <span class="token key atrule">client</span><span class="token punctuation">:</span>    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka7001.com<span class="token punctuation">:</span>7001/eureka</code></pre><p>å¯åŠ¨ç±»å’Œcontrollerçš„å†™æ³•å’Œ3355ä¸€æ ·ã€‚</p><p><code>cloud-config-center-3344</code>çš„yamlé…ç½®ä¿®æ”¹ä¸ºï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3344</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>config<span class="token punctuation">-</span>center  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">config</span><span class="token punctuation">:</span>      <span class="token key atrule">server</span><span class="token punctuation">:</span>        <span class="token key atrule">git</span><span class="token punctuation">:</span>          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//git.codetool.top/RhettPeng/springcloud<span class="token punctuation">-</span>config.git <span class="token comment" spellcheck="true"># ä»“åº“åœ°å€</span>          <span class="token key atrule">search-paths</span><span class="token punctuation">:</span>            <span class="token punctuation">-</span> springcloud<span class="token punctuation">-</span>config      <span class="token key atrule">label</span><span class="token punctuation">:</span> master   <span class="token comment" spellcheck="true"># è¯»å–åˆ†æ”¯</span>  <span class="token comment" spellcheck="true"># æ·»åŠ rabbitmqç›¸å…³</span>  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>    <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>    <span class="token key atrule">username</span><span class="token punctuation">:</span> guest    <span class="token key atrule">password</span><span class="token punctuation">:</span> guest<span class="token key atrule">eureka</span><span class="token punctuation">:</span>  <span class="token key atrule">client</span><span class="token punctuation">:</span>    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>7001/eureka<span class="token comment" spellcheck="true"># æš´éœ²busåˆ·æ–°çš„ç«¯ç‚¹</span><span class="token key atrule">management</span><span class="token punctuation">:</span>  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>    <span class="token key atrule">web</span><span class="token punctuation">:</span>      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">'bus-refresh'</span></code></pre><p>åˆ°æ­¤é…ç½®æˆåŠŸï¼Œåªè¦gitä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶ä¿®æ”¹çš„æ—¶å€™å‘ <a href="http://localhost:3344/actuator/bus-refresh" target="_blank" rel="noopener">http://localhost:3344/actuator/bus-refresh</a> å‘å‡ºpostè¯·æ±‚ï¼ˆå¯ä»¥ä½¿ç”¨webhookï¼‰ï¼Œå°±èƒ½é€šçŸ¥æ‰€æœ‰çš„é…ç½®ä½¿ç”¨è€…åˆ·æ–°é…ç½®ã€‚</p><p>æŸ¥çœ‹rabbitmqçš„exchangeï¼š</p><p><img src="https://api.codetool.top/img/15848841263639.png" alt></p><p><strong>è¡¥å……ï¼šå®šç‚¹é€šçŸ¥</strong></p><p>buså¯ä»¥æŒ‡å®šé€šçŸ¥å…·ä½“ä¸€ä¸ªå®ä¾‹è€Œä¸æ˜¯å…¨éƒ¨ã€‚åªéœ€è¦åœ¨ <a href="http://localhost:3344/actuator/bus-refresh" target="_blank" rel="noopener">http://localhost:3344/actuator/bus-refresh</a> åé¢åŠ ä¸Š <code>/destination</code>ï¼Œå…¶ä¸­destinationä¸ºæœåŠ¡IDã€‚ä¹‹å‰æœ‰ä»‹ç»å¯ä»¥é€šè¿‡<code>eureka.instance.instance-id</code>æŒ‡å®šã€‚</p><p>ä¾‹å¦‚post <a href="http://localhost:3344/actuator/bus-refresh/config-client:3355" target="_blank" rel="noopener">http://localhost:3344/actuator/bus-refresh/config-client:3355</a> å³å¯åªé€šçŸ¥3355ï¼Œè€Œä¸é€šçŸ¥å…¶ä»–ä½¿ç”¨è€…ã€‚ <img src="https://api.codetool.top/img/15848848825797.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;SpringCloud-Busæ¦‚è¿°&quot;&gt;1 SpringCloud Busæ¦‚è¿°&lt;/h1&gt;&lt;p&gt;Spring Cloud Busæ˜¯å°†åˆ†å¸ƒå¼ç³»ç»Ÿçš„èŠ‚ç‚¹ä¸è½»é‡çº§æ¶ˆæ¯ç³»ç»Ÿé“¾æ¥èµ·æ¥çš„æ¡†æ¶ï¼Œå®ƒæ•´åˆäº†Javaçš„äº‹ä»¶å¤„ç†æœºåˆ¶å’Œæ¶ˆæ¯ä¸­é—´ä»¶çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Bus
      
    
    </summary>
    
    
      <category term="ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶" scheme="https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="å¾®æœåŠ¡" scheme="https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="SpringCloud Bus" scheme="https://www.codetool.top/tags/SpringCloud-Bus/"/>
    
  </entry>
  
  <entry>
    <title>SpringCloud Configé…ç½®ä¸­å¿ƒçš„ä½¿ç”¨</title>
    <link href="https://www.codetool.top/article/SpringCloud%20Config%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>https://www.codetool.top/article/SpringCloud Configé…ç½®ä¸­å¿ƒçš„ä½¿ç”¨/</id>
    <published>2020-03-22T13:03:47.000Z</published>
    <updated>2020-03-22T13:04:36.360Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚è¿°">1 æ¦‚è¿°</h1><p>SpringCloud Configä¸ºå¾®æœåŠ¡æ¶æ„ä¸­çš„å¾®æœåŠ¡æä¾›é›†ä¸­åŒ–çš„å¤–éƒ¨é…ç½®æ”¯æŒï¼Œé…ç½®æœåŠ¡å™¨ä¸ºå„ä¸ªä¸åŒå¾®æœåŠ¡åº”ç”¨çš„æ‰€æœ‰ç¯å¢ƒæä¾›äº†ä¸€ä¸ªä¸­å¿ƒåŒ–çš„å¤–éƒ¨é…ç½®ã€‚</p><p>SpringCloud Configé»˜è®¤ä½¿ç”¨Gitæ¥å­˜å‚¨é…ç½®æ–‡ä»¶(ä¹Ÿæœ‰å…¶å®ƒæ–¹å¼,æ¯”å¦‚æ”¯æŒSVNå’Œæœ¬åœ°æ–‡ä»¶)ï¼Œ<br>ä½†æœ€æ¨èçš„è¿˜æ˜¯Gitï¼Œè€Œä¸”ä½¿ç”¨çš„æ˜¯http/httpsè®¿é—®çš„å½¢å¼</p><h2 id="ä½œç”¨">1.1 ä½œç”¨</h2><ul><li>é›†ä¸­ç®¡ç†é…ç½®æ–‡ä»¶</li><li>ä¸åŒç¯å¢ƒä¸åŒé…ç½®,åŠ¨æ€åŒ–çš„é…ç½®æ›´æ–°,åˆ†ç¯å¢ƒéƒ¨ç½²æ¯”å¦‚dev/test/prod/beta/release</li><li>è¿è¡ŒæœŸé—´åŠ¨æ€è°ƒæ•´é…ç½®ï¼Œä¸å†éœ€è¦åœ¨æ¯ä¸ªæœåŠ¡éƒ¨ç½²çš„æœºå™¨ä¸Šç¼–å†™é…ç½®æ–‡ä»¶ï¼ŒæœåŠ¡ä¼šå‘é…ç½®ä¸­å¿ƒç»Ÿä¸€æ‹‰å–é…ç½®è‡ªå·±çš„ä¿¡æ¯</li><li>å½“é…ç½®å‘ç”Ÿå˜åŠ¨æ—¶ï¼ŒæœåŠ¡ä¸éœ€è¦é‡å¯å³å¯æ„ŸçŸ¥åˆ°é…ç½®çš„å˜åŒ–å¹¶åº”ç”¨æ–°çš„é…ç½®</li><li>å°†é…ç½®ä¿¡æ¯ä»¥RESTæ¥å£çš„å½¢å¼æš´éœ²</li></ul><h1 id="ä½¿ç”¨">2 ä½¿ç”¨</h1><h2 id="é…ç½®ä¸­å¿ƒæœåŠ¡å™¨æ­å»º">2.1 é…ç½®ä¸­å¿ƒæœåŠ¡å™¨æ­å»º</h2><p>å…ˆå»ºä¸€ä¸ªgitä»“åº“ç”¨äºå­˜æ”¾é…ç½®ï¼Œå‚è€ƒä»“åº“åœ°å€ï¼š <a href="http://git.codetool.top/RhettPeng/springcloud-config" target="_blank" rel="noopener">http://git.codetool.top/RhettPeng/springcloud-config</a></p><p><img src="https://api.codetool.top/img/15848783464100.png" alt></p><p>æ–°å»ºæ¨¡å—<code>cloud-config-center-3344</code></p><p>ä¾èµ–ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- config server --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-config-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>yamlï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3344</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>config<span class="token punctuation">-</span>center  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">config</span><span class="token punctuation">:</span>      <span class="token key atrule">server</span><span class="token punctuation">:</span>        <span class="token key atrule">git</span><span class="token punctuation">:</span>          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//git.codetool.top/RhettPeng/springcloud<span class="token punctuation">-</span>config.git <span class="token comment" spellcheck="true"># ä»“åº“åœ°å€</span>          <span class="token key atrule">search-paths</span><span class="token punctuation">:</span>            <span class="token punctuation">-</span> springcloud<span class="token punctuation">-</span>config      <span class="token key atrule">label</span><span class="token punctuation">:</span> master   <span class="token comment" spellcheck="true"># è¯»å–åˆ†æ”¯</span><span class="token key atrule">eureka</span><span class="token punctuation">:</span>  <span class="token key atrule">client</span><span class="token punctuation">:</span>    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>7001/eureka</code></pre><p>å¯åŠ¨ç±»ï¼šè¿™é‡Œè¦ä½¿ç”¨<code>@EnableConfigServer</code></p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableConfigServer</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainAppConfigServer3344</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>MainAppConfigServer3344<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¿™æ ·ä¸€ä¸ªé…ç½®ä¸­å¿ƒæœåŠ¡å™¨å°±æ­å»ºå®Œäº†ï¼Œå¯ä»¥è¿›è¡Œæµ‹è¯•ã€‚</p><h2 id="urlæ˜ å°„è§„åˆ™">2.2 urlæ˜ å°„è§„åˆ™</h2><p>å¦‚ä½•é€šè¿‡é…ç½®ä¸­å¿ƒæœåŠ¡å™¨è®¿é—®gitä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶ï¼Ÿæ˜ å°„è§„åˆ™å¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li><code>/{application}/{profile}[/{label}]</code>(å¯çœç•¥æ‹“å±•åï¼Œä½†å“åº”çš„é…ç½®æ ¼å¼å¯èƒ½æ˜¯jsonå½¢å¼çš„ï¼Œå’Œæºæ–‡ä»¶ä¸ç›¸åŒ)</li><li><code>/{application}-{profile}.yml</code></li><li><code>/{label}/{application}-{profile}.yml</code>ï¼ˆlabelæŒ‡å®šåˆ†æ”¯ï¼Œ<code>spring.cloud.config.label</code>å¯é…ç½®é»˜è®¤åˆ†æ”¯ï¼‰</li><li><code>/{application}-{profile}.properties</code></li><li><code>/{label}/{application}-{profile}.properties</code></li></ul><p>ä»¥ä¸Šé¢æ­å»ºçš„é…ç½®ä¸­å¿ƒæœåŠ¡å™¨ä¸ºä¾‹ï¼Œå¯ä»¥è®¿é—® <a href="http://localhost:3344/master/config-dev.yml" target="_blank" rel="noopener">http://localhost:3344/master/config-dev.yml</a> æ¥è·å– <code>config-dev.yml</code> é…ç½®ã€‚è¿˜æœ‰å¦å¤–ä¸¤ç§å†™æ³•ï¼š</p><ul><li><code>http://localhost:3344/config-dev.yml</code>ï¼ˆå·²é…ç½®é»˜è®¤åˆ†æ”¯ï¼‰</li><li><code>http://localhost:3344/master/config-dev</code> (çœç•¥æ‹“å±•å)</li></ul><h2 id="åŠ è½½é¡ºåºå’Œåˆ†æ­§ç®¡ç†">2.3 åŠ è½½é¡ºåºå’Œåˆ†æ­§ç®¡ç†</h2><p><code>applicaiton.yml</code>æ˜¯ç”¨æˆ·çº§çš„èµ„æºé…ç½®é¡¹</p><p><code>bootstrap.yml</code>æ˜¯ç³»ç»Ÿçº§çš„ï¼Œä¼˜å…ˆçº§æ›´åŠ é«˜</p><p>Spring Cloudä¼šåˆ›å»ºä¸€ä¸ª<code>&quot;Bootstrap Context&quot;</code>ï¼Œä½œä¸ºSpringåº”ç”¨çš„Application Contextçš„çˆ¶ä¸Šä¸‹æ–‡ã€‚åˆå§‹åŒ–çš„æ—¶å€™ï¼Œ<code>Bootstrap Context</code>è´Ÿè´£ä»å¤–éƒ¨æºåŠ è½½é…ç½®å±æ€§å¹¶è§£æé…ç½®ã€‚è¿™ä¸¤ä¸ªä¸Šä¸‹æ–‡å…±äº«ä¸€ä¸ªä»å¤–éƒ¨è·å–çš„Environmentã€‚</p><p><strong>Bootstrapå±æ€§æœ‰é«˜ä¼˜å…ˆçº§ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬ä¸ä¼šè¢«æœ¬åœ°é…ç½®è¦†ç›–ã€‚</strong>Bootstrap contextå’ŒApplication Contextæœ‰ç€ä¸åŒçš„çº¦å®šï¼Œæ‰€ä»¥æ–°å¢äº†ä¸€ä¸ªbootstrap.ymlæ–‡ä»¶, ä¿è¯Bootstrap Contextå’ŒApplication Contexté…ç½®çš„åˆ†ç¦»ã€‚</p><p><strong>è¦å°†Clientæ¨¡å—ä¸‹çš„application.ymlæ–‡ä»¶æ”¹ä¸ºbootstrap.yml,è¿™æ˜¯å¾ˆå…³é”®çš„ã€‚</strong></p><p>å› ä¸º<code>bootstrap.yml</code>æ˜¯æ¯”<code>application.yml</code>å…ˆåŠ è½½çš„ã€‚<code>bootstrap.yml</code>ä¼˜å…ˆçº§é«˜äº<code>application.yml</code>ï¼ˆè®©æœ¬åœ°é…ç½®çš„ä¼˜å…ˆçº§æ›´é«˜ï¼‰</p><h2 id="æ­å»ºé…ç½®ä½¿ç”¨ç«¯">2.4 æ­å»ºé…ç½®ä½¿ç”¨ç«¯</h2><p>æ–°å»ºæ¨¡å—<code>cloud-config-client3355</code>ï¼Œä¾èµ–ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- config client --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>yamlé…ç½®ï¼šæ–‡ä»¶åä¸º<code>bootstrap.yml</code>ï¼Œè¿™é‡Œspring.cloud.configä¸‹é¢é…ç½®çš„æ˜¯è¯»å–å“ªä¸ªé…ç½®æ–‡ä»¶ï¼Œå¯¹åº”urlæ˜ å°„ä¸­çš„å‚æ•°ã€‚</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3355</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>client  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">config</span><span class="token punctuation">:</span>      <span class="token key atrule">label</span><span class="token punctuation">:</span> master <span class="token comment" spellcheck="true"># åˆ†æ”¯åç§°</span>      <span class="token key atrule">name</span><span class="token punctuation">:</span> config <span class="token comment" spellcheck="true"># é…ç½®æ–‡ä»¶åç§°</span>      <span class="token key atrule">profile</span><span class="token punctuation">:</span> dev <span class="token comment" spellcheck="true"># è¯»å–çš„profile</span>      <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">3344 </span><span class="token comment" spellcheck="true">#é…ç½®ä¸­å¿ƒçš„åœ°å€</span><span class="token key atrule">eureka</span><span class="token punctuation">:</span>  <span class="token key atrule">client</span><span class="token punctuation">:</span>    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka7001.com<span class="token punctuation">:</span>7001/eureka</code></pre><p>ç¼–å†™ä¸€ä¸ªå¯ä»¥è·å–é…ç½®çš„controlleræµ‹è¯•ï¼Œè¿™é‡Œçš„<code>config.info</code>æ˜¯åœ¨é…ç½®ä¸­å¿ƒä¸­çš„é…ç½®é¡¹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigClientController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${config.info}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String configInfo<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/configInfo"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">getConfigInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> configInfo<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å¯åŠ¨è¯¥æ¨¡å—ï¼Œè®¿é—® <a href="http://localhost:3355/configInfo" target="_blank" rel="noopener">http://localhost:3355/configInfo</a> ï¼Œå¯ä»¥çœ‹åˆ°æµè§ˆå™¨è¾“å‡ºï¼š</p><pre><code>master branch,springcloud-config/config-dev.yml version=1</code></pre><p>å¯¹åº”çš„å°±æ˜¯masterä¸‹çš„config-devé…ç½®æ–‡ä»¶</p><h2 id="å¦‚ä½•åŠ¨æ€è·å–é…ç½®ä¿®æ”¹">2.5 å¦‚ä½•åŠ¨æ€è·å–é…ç½®ä¿®æ”¹</h2><p>å¦‚æœgitä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶å‘ç”Ÿä¿®æ”¹ï¼Œé…ç½®ä¸­å¿ƒèƒ½ç«‹å³è·å¾—ä¿®æ”¹ï¼Œä½†é…ç½®ä½¿ç”¨ç«¯ç¡®æ— æ³•å¯¹ä¿®æ”¹çš„é…ç½®ç«‹å³ç”Ÿæ•ˆï¼Œé™¤éé‡å¯ã€‚é‚£ä¹ˆå¦‚ä½•è®©é…ç½®ä½¿ç”¨ç«¯åŠ¨æ€è·å–é…ç½®çš„ä¿®æ”¹ï¼Ÿ</p><p>é¦–å…ˆï¼Œä¿è¯é…ç½®ä½¿ç”¨ç«¯å¼•å…¥äº†actuatorä¾èµ–ï¼ˆä¸Šé¢å·²ç»å¼•å…¥ï¼‰ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>ç„¶åï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­æš´éœ²ç›‘æ§ç«¯ç‚¹ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>    <span class="token key atrule">web</span><span class="token punctuation">:</span>      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">"*"</span></code></pre><p>ç„¶åï¼Œåœ¨ä¸šåŠ¡ç±»ä¸ŠåŠ ä¸Š<code>@RefreshScope</code>æ³¨è§£ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RefreshScope</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigClientController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${config.info}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String configInfo<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/configInfo"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">getConfigInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> configInfo<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æ­¤åï¼Œå½“é…ç½®ä¿®æ”¹åï¼Œå¯ä»¥å‘ <a href="http://localhost:3355/actuator/refresh" target="_blank" rel="noopener">http://localhost:3355/actuator/refresh</a> å‘é€ä¸€ä¸ª POST è¯·æ±‚ï¼Œä½¿å¾—æ¨¡å—ä¸»åŠ¨åˆ·æ–°é…ç½®ï¼ˆè¿™ä¸ªè¯·æ±‚å¯ä»¥åˆ©ç”¨webhookå®ç°ï¼‰</p><p>ä½†æ˜¯ï¼Œå€˜è‹¥æœ‰å¤šä¸ªé…ç½®ä½¿ç”¨æ–¹ï¼Œéš¾é“éœ€è¦ç»™æ¯ä¸ªä¸»æœºå‘é€ä¸€ä¸ªPOSTè¯·æ±‚ï¼Ÿæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Ÿè¿™å°±éœ€è¦SpringCloud Busäº†ã€‚ã€‚ã€‚ï¼ˆè§ä¸‹ç¯‡ï¼‰</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;æ¦‚è¿°&quot;&gt;1 æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;SpringCloud Configä¸ºå¾®æœåŠ¡æ¶æ„ä¸­çš„å¾®æœåŠ¡æä¾›é›†ä¸­åŒ–çš„å¤–éƒ¨é…ç½®æ”¯æŒï¼Œé…ç½®æœåŠ¡å™¨ä¸ºå„ä¸ªä¸åŒå¾®æœåŠ¡åº”ç”¨çš„æ‰€æœ‰ç¯å¢ƒæä¾›äº†ä¸€ä¸ªä¸­å¿ƒåŒ–çš„å¤–éƒ¨é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;SpringCloud Configé»˜è®¤ä½¿ç”¨Gitæ¥å­˜å‚¨é…ç½®æ–‡ä»¶
      
    
    </summary>
    
    
      <category term="ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶" scheme="https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="å¾®æœåŠ¡" scheme="https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="SpringCloud Config" scheme="https://www.codetool.top/tags/SpringCloud-Config/"/>
    
  </entry>
  
  <entry>
    <title>æ–°ä¸€ä»£ç½‘å…³SpringCloud Gatewayæ¦‚è¿°å’Œç®€å•ä½¿ç”¨</title>
    <link href="https://www.codetool.top/article/%E6%96%B0%E4%B8%80%E4%BB%A3%E7%BD%91%E5%85%B3Spring%20Cloud%20Gateway%E6%A6%82%E8%BF%B0%E5%92%8C%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <id>https://www.codetool.top/article/æ–°ä¸€ä»£ç½‘å…³Spring Cloud Gatewayæ¦‚è¿°å’Œç®€å•ä½¿ç”¨/</id>
    <published>2020-03-22T02:40:36.000Z</published>
    <updated>2020-03-22T03:18:32.618Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Gatewayæ¦‚è¿°">1 Gatewayæ¦‚è¿°</h1><p>Gatewayæ˜¯åœ¨Springç”Ÿæ€ç³»ç»Ÿä¹‹ä¸Šæ„å»ºçš„APIç½‘å…³æœåŠ¡,åŸºäºSpring 5, Spring Boot 2å’ŒProject Reactorç­‰æŠ€æœ¯ã€‚</p><p>Gatewayæ—¨åœ¨æä¾›ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹å¼æ¥å¯¹APIè¿›è¡Œè·¯ç”±,ä»¥åŠåŸºäºFilteré“¾æä¾›ä¸€äº›å¼ºå¤§çš„è¿‡æ»¤å™¨åŠŸèƒ½ï¼Œä¾‹å¦‚ç†”æ–­ã€é™æµã€é‡è¯•ç­‰ã€‚</p><p>SpringCloud Gatewayä½œä¸ºSpring Cloudç”Ÿæ€ç³»ç»Ÿä¸­çš„ç½‘å…³ï¼Œç›®æ ‡æ˜¯æ›¿ä»£Zuulï¼Œåœ¨Spring Cloud 2.0ä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œæ²¡æœ‰å¯¹æ–°ç‰ˆæœ¬çš„Zuul 2.0ä»¥ä¸Šæœ€æ–°é«˜æ€§èƒ½ç‰ˆæœ¬è¿›è¡Œé›†æˆï¼Œä»ç„¶è¿˜æ˜¯ä½¿ç”¨çš„Zuul 1.xéReactoræ¨¡å¼çš„è€ç‰ˆæœ¬ã€‚è€Œä¸ºäº†æå‡ç½‘å…³çš„æ€§èƒ½ï¼Œ<strong>SpringCloud Gatewayæ˜¯åŸºäºWebFluxæ¡†æ¶å®ç°çš„ï¼Œè€ŒWebFluxæ¡†æ¶åº•å±‚åˆ™ä½¿ç”¨äº†é«˜æ€§èƒ½çš„Reactoræ¨¡å¼é€šä¿¡æ¡†æ¶Nettyã€‚</strong></p><h2 id="ä¸ºä»€ä¹ˆé€‰ç”¨Gatewayè€Œä¸æ˜¯zuul">1.1 ä¸ºä»€ä¹ˆé€‰ç”¨Gatewayè€Œä¸æ˜¯zuul</h2><p>ä¸€æ–¹é¢å› ä¸ºZuul1.0å·²ç»è¿›å…¥äº†ç»´æŠ¤é˜¶æ®µï¼Œä¸”Gatewayæ˜¯SpringCloudå›¢é˜Ÿç ”å‘çš„ï¼Œæ˜¯äº²å„¿å­äº§å“ï¼Œå€¼å¾—ä¿¡èµ–ã€‚è€Œä¸”å¾ˆå¤šåŠŸèƒ½Zuuléƒ½æ²¡æœ‰ï¼Œç”¨èµ·æ¥ä¹Ÿéå¸¸çš„ç®€å•ä¾¿æ·ã€‚</p><ul><li>Zuul 1.x, æ˜¯ä¸€ä¸ªåŸºäºé˜»å¡I/Oçš„API Gateway</li><li>Zuul 1.x <strong>åŸºäºServlet 2.5ä½¿ç”¨é˜»å¡æ¶æ„</strong> å®ƒä¸æ”¯æŒä»»ä½•é•¿è¿æ¥(å¦‚WebSocket) Zuulçš„è®¾è®¡æ¨¡å¼å’ŒNginxè¾ƒåƒï¼Œæ¯æ¬¡I/Oæ“ä½œéƒ½æ˜¯ä»å·¥ä½œçº¿ç¨‹ä¸­é€‰æ‹©ä¸€ä¸ªæ‰§è¡Œï¼Œè¯·æ±‚çº¿ç¨‹è¢«é˜»å¡åˆ°å·¥ä½œçº¿ç¨‹å®Œæˆï¼Œä½†æ˜¯å·®åˆ«æ˜¯Nginxç”¨C++å®ç°ï¼ŒZuulç”¨Javaå®ç°ï¼Œè€ŒJVMæœ¬èº«ä¼šæœ‰ç¬¬ä¸€æ¬¡åŠ è½½è¾ƒæ…¢çš„æƒ…å†µï¼Œä½¿å¾—Zuulçš„æ€§èƒ½ç›¸å¯¹è¾ƒå·®ã€‚</li><li>Zuul 2.x ç†å¿µæ›´å…ˆè¿›ï¼Œæƒ³åŸºäºNettyéé˜»å¡å’Œæ”¯æŒé•¿è¿æ¥ï¼Œä½†SpringCloudç›®å‰è¿˜æ²¡æœ‰æ•´åˆã€‚Zuul 2.xçš„æ€§èƒ½è¾ƒZuul 1.xåœ¨æ€§èƒ½æ–¹é¢æœ‰è¾ƒå¤§æå‡ï¼Œæ ¹æ®å®˜æ–¹æä¾›çš„åŸºå‡†æµ‹è¯•ï¼ŒSpring Cloud Gatewayçš„RPS (æ¯ç§’è¯·æ±‚æ•°)æ˜¯Zuulçš„1.6å€ã€‚</li></ul><p>Gatewayæ˜¯åŸºäºå¼‚æ­¥éé˜»å¡æ¨¡å‹ä¸Šè¿›è¡Œå¼€å‘çš„ï¼Œæ€§èƒ½æ–¹é¢ä¸éœ€è¦æ‹…å¿ƒã€‚è™½ç„¶Netflixæ—©å°±å‘å¸ƒäº†æœ€æ–°çš„Zuul 2.xï¼Œä½†Spring Cloudè²Œä¼¼æ²¡æœ‰æ•´åˆè®¡åˆ’ã€‚è€Œä¸”Netflixç›¸å…³ç»„ä»¶éƒ½å®£å¸ƒè¿›å…¥ç»´æŠ¤æœŸ; ä¸çŸ¥å‰æ™¯å¦‚ä½•?</p><p><strong>Gatewayç‰¹æ€§</strong></p><ul><li>åŸºäºSpring Framework 5, Project Reactorå’ŒSpring Boot 2.0è¿›è¡Œæ„å»º; </li><li>åŠ¨æ€è·¯ç”±ï¼šèƒ½å¤ŸåŒ¹é…ä»»ä½•è¯·æ±‚å±æ€§;</li><li>å¯ä»¥å¯¹è·¯ç”±æŒ‡å®šPredicate (æ–­è¨€)å’ŒFilter (è¿‡æ»¤å™¨) ;</li><li>é›†æˆHystrixçš„æ–­è·¯å™¨åŠŸèƒ½;</li><li>é›†æˆSpring CloudæœåŠ¡å‘ç°åŠŸèƒ½;</li><li>æ˜“äºç¼–å†™çš„Predicate (æ–­è¨€)å’ŒFilter (è¿‡æ»¤å™¨) ;</li><li>è¯·æ±‚é™æµåŠŸèƒ½;</li><li>æ”¯æŒè·¯å¾„é‡å†™ã€‚</li></ul><p>å¤šæ–¹é¢ç»¼åˆè€ƒè™‘Gatewayæ˜¯å¾ˆç†æƒ³çš„ç½‘å…³é€‰æ‹©ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯webflux">1.2 ä»€ä¹ˆæ˜¯webflux</h2><p>ä¼ ç»Ÿçš„Webæ¡†æ¶,æ­¤å¦‚è¯´: struts2, springmvcç­‰éƒ½æ˜¯åŸºäºServlet APIä¸Servletå®¹å™¨åŸºç¡€ä¹‹ä¸Šè¿è¡Œçš„ã€‚</p><p>ä½†æ˜¯:</p><p>åœ¨Servlet3.1ä¹‹åæœ‰äº†å¼‚æ­¥éé˜»å¡çš„æ”¯æŒã€‚è€ŒWebFluxæ˜¯ä¸€ä¸ªå…¸å‹éé˜»å¡å¼‚æ­¥çš„æ¡†æ¶ï¼Œå®ƒçš„æ ¸å¿ƒæ˜¯åŸºäºReactorçš„ç›¸å…³APIå®ç°çš„ã€‚ç›¸å¯¹äºä¼ ç»Ÿçš„webæ¡†æ¶æ¥è¯´ï¼Œå®ƒå¯ä»¥è¿è¡Œåœ¨è¯¸å¦‚Netty, UndertowåŠæ”¯æŒServlet3.1çš„å®¹å™¨ä¸Šã€‚éé˜»å¡å¼+å‡½æ•°å¼ç¼–ç¨‹ï¼ˆSpring5å¿…é¡»ä½¿ç”¨java8ï¼‰</p><p>Spring WebFluxæ˜¯Spring 5.0 å¼•å…¥çš„æ–°çš„å“åº”å¼æ¡†æ¶ï¼ŒåŒºåˆ«äºSpring MVC,å®ƒä¸éœ€è¦ä¾èµ–Servlet APIï¼Œå®ƒæ˜¯å®Œå…¨å¼‚æ­¥éé˜»å¡çš„ï¼Œå¹¶ä¸”åŸºäºReactoræ¥å®ç°å“åº”å¼æµè§„èŒƒã€‚</p><h2 id="ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ">1.3 ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ</h2><ul><li>Route(è·¯ç”±)ï¼šè·¯ç”±æ˜¯æ„å»ºç½‘å…³çš„åŸºæœ¬æ¨¡å—ï¼Œ<strong>å®ƒç”±IDã€ç›®æ ‡URIã€ä¸€ç³»åˆ—çš„æ–­è¨€å’Œè¿‡æ»¤å™¨ç»„æˆ</strong>,å¦‚æ–­è¨€ä¸ºtrueåˆ™åŒ¹é…è¯¥è·¯ç”±</li><li>Predicate(æ–­è¨€)ï¼šå‚è€ƒçš„æ˜¯Java8çš„<code>java.util.function.Predicate</code>ï¼Œå¼€å‘äººå‘˜å¯ä»¥åŒ¹é…HTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰å†…å®¹(ä¾‹å¦‚è¯·æ±‚å¤´æˆ–è¯·æ±‚å‚æ•°)ï¼Œ<strong>å¦‚æœè¯·æ±‚ä¸æ–­è¨€ç›¸åŒ¹é…åˆ™è¿›è¡Œè·¯ç”±</strong></li><li>Filter(è¿‡æ»¤)ï¼šæŒ‡çš„æ˜¯Springæ¡†æ¶ä¸­GatewayFilterçš„å®ä¾‹,ä½¿ç”¨è¿‡æ»¤å™¨,å¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±å‰æˆ–è€…ä¹‹å<strong>å¯¹è¯·æ±‚è¿›è¡Œä¿®æ”¹</strong></li></ul><h2 id="Gatewayå·¥ä½œæµç¨‹">1.4 Gatewayå·¥ä½œæµç¨‹</h2><p><img src="https://api.codetool.top/img/15848042562424.png" alt></p><p>å®¢æˆ·ç«¯å‘Spring Cloud Gatewayå‘å‡ºè¯·æ±‚ã€‚ç„¶å<strong>åœ¨Gateway Handler Mappingä¸­æ‰¾åˆ°ä¸è¯·æ±‚ç›¸åŒ¹é…çš„è·¯ç”±ï¼Œå°†å…¶å‘é€åˆ°Gateway Web Handlerã€‚</strong></p><p><strong>Handlerå†é€šè¿‡æŒ‡å®šçš„è¿‡æ»¤å™¨é“¾æ¥å°†è¯·æ±‚å‘é€åˆ°æˆ‘ä»¬å®é™…çš„æœåŠ¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘</strong>ï¼Œç„¶åè¿”å›ã€‚è¿‡æ»¤å™¨ä¹‹é—´ç”¨è™šçº¿åˆ†å¼€æ˜¯å› ä¸º<strong>è¿‡æ»¤å™¨å¯èƒ½ä¼šåœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰( â€œpreâ€ )æˆ–ä¹‹å( â€œpostâ€ )æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚</strong></p><p>Filteråœ¨â€preâ€ ç±»å‹çš„è¿‡æ»¤å™¨å¯ä»¥åšå‚æ•°æ ¡éªŒã€æƒé™æ ¡éªŒã€æµé‡ç›‘æ§ã€æ—¥å¿—è¾“å‡ºã€åè®®è½¬æ¢ç­‰,<br>åœ¨â€postâ€ç±»å‹çš„è¿‡æ»¤å™¨ä¸­å¯ä»¥åšå“åº”å†…å®¹ã€å“åº”å¤´çš„ä¿®æ”¹ï¼Œæ—¥å¿—çš„è¾“å‡ºï¼Œæµé‡ç›‘æ§ç­‰æœ‰ç€éå¸¸é‡è¦çš„ä½œç”¨ã€‚</p><h1 id="ä½¿ç”¨">2 ä½¿ç”¨</h1><h2 id="ä½¿ç”¨æ–‡ä»¶é…ç½®">2.1 ä½¿ç”¨æ–‡ä»¶é…ç½®</h2><p>æ–°å»ºæ¨¡å—<code>cloud-gateway-gateway9527</code>ï¼Œä¾èµ–ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--gatewayæ— éœ€webå’Œactuator--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.rhett<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span></code></pre><p>yamlé…ç½®ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9527</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>gateway  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>      <span class="token key atrule">routes</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> payment_routh           <span class="token comment" spellcheck="true"># è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span>          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">8001  </span><span class="token comment" spellcheck="true"># åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span>          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>            <span class="token punctuation">-</span> Path=/payment/**        <span class="token comment" spellcheck="true"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span>        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> payment_routh2          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">8001</span>          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>            <span class="token punctuation">-</span> Path=/payment/lb/**<span class="token key atrule">eureka</span><span class="token punctuation">:</span>  <span class="token key atrule">instance</span><span class="token punctuation">:</span>    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>gateway<span class="token punctuation">-</span>service  <span class="token key atrule">client</span><span class="token punctuation">:</span>    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka7001.com<span class="token punctuation">:</span>7001/eureka</code></pre><p>å¯åŠ¨ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableEurekaClient</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GatewayMain9527</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>GatewayMain9527<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å¯åŠ¨æ¨¡å—<code>cloud-eureka-server7001</code>ã€<code>cloud-provider-payment8001</code>ï¼Œå†å¯åŠ¨ç½‘å…³ï¼Œå°±èƒ½é€šè¿‡ <a href="http://localhost:9527/payment/1" target="_blank" rel="noopener">http://localhost:9527/payment/1</a> ã€ <a href="http://localhost:9527/payment/lb" target="_blank" rel="noopener">http://localhost:9527/payment/lb</a>  å»è®¿é—®8001ä¸Šçš„ payment serviceäº†ã€‚</p><h2 id="ç¼–ç é…ç½®">2.2 ç¼–ç é…ç½®</h2><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Gateway</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> RouteLocator <span class="token function">routes</span><span class="token punctuation">(</span>RouteLocatorBuilder builder<span class="token punctuation">)</span><span class="token punctuation">{</span>        RouteLocatorBuilder<span class="token punctuation">.</span>Builder routes <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        routes<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">"path_route_baidu"</span><span class="token punctuation">,</span>                r<span class="token operator">-</span><span class="token operator">></span>r<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/guonei"</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">"http://news.baidu.com/guonei"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> routes<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="åŠ¨æ€è·¯ç”±">2.3 åŠ¨æ€è·¯ç”±</h2><p>æ›´æ”¹ä¸ºä»¥ä¸‹é…ç½®ï¼Œå³å¯å®ç°ä»æ³¨å†Œä¸­å¿ƒåˆ›å»ºè·¯ç”±ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>gateway  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>        <span class="token key atrule">locator</span><span class="token punctuation">:</span>          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true               </span><span class="token comment" spellcheck="true"># å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”±</span>      <span class="token key atrule">routes</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> payment_routh           <span class="token comment" spellcheck="true"># è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span>          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//CLOUD<span class="token punctuation">-</span>PAYMENT<span class="token punctuation">-</span>SERVICE      <span class="token comment" spellcheck="true"># åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span>          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>            <span class="token punctuation">-</span> Path=/payment/**        <span class="token comment" spellcheck="true"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span>        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> payment_routh2          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//CLOUD<span class="token punctuation">-</span>PAYMENT<span class="token punctuation">-</span>SERVICE          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>            <span class="token punctuation">-</span> Path=/payment/lb/**<span class="token key atrule">eureka</span><span class="token punctuation">:</span>  <span class="token key atrule">instance</span><span class="token punctuation">:</span>    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>gateway<span class="token punctuation">-</span>service  <span class="token key atrule">client</span><span class="token punctuation">:</span>    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka7001.com<span class="token punctuation">:</span>7001/eureka</code></pre><h1 id="æ–­è¨€ã€è¿‡æ»¤å™¨">3 æ–­è¨€ã€è¿‡æ»¤å™¨</h1><h2 id="å¸¸ç”¨Predicate">3.1 å¸¸ç”¨Predicate</h2><p><img src="https://api.codetool.top/img/15848420974387.png" alt></p><p>å…·ä½“ä½¿ç”¨è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š <a href="https://cloud.spring.io/spring-cloud-gateway/reference/html/#gateway-request-predicates-factories" target="_blank" rel="noopener">https://cloud.spring.io/spring-cloud-gateway/reference/html/#gateway-request-predicates-factories</a></p><p>å¯¹äºBeforeã€Afterã€Betweenæ–­è¨€</p><p><code>- After=2017-01-20T17:42:47.789-07:00[America/Denver]</code> æ‰€ç”¨çš„æ—¶é—´å­—ç¬¦ä¸²æ˜¯Java8ä¸­<code>ZonedDateTime</code>ç”Ÿæˆçš„æ—¶é—´å­—ç¬¦ä¸²</p><h2 id="Filter">3.2 Filter</h2><p>å¯é…ç½®çš„è¿‡æ»¤å™¨å‚è§å®˜æ–¹æ–‡æ¡£ï¼š <a href="https://cloud.spring.io/spring-cloud-gateway/reference/html/#gatewayfilter-factories" target="_blank" rel="noopener">https://cloud.spring.io/spring-cloud-gateway/reference/html/#gatewayfilter-factories</a></p><p>è¿™é‡Œä¸»è¦æä¸€ä¸‹è‡ªå®šä¹‰è¿‡æ»¤å™¨çš„å†™æ³•ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyLogGatewayFilter</span> <span class="token keyword">implements</span> <span class="token class-name">GlobalFilter</span><span class="token punctuation">,</span> Ordered <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Mono<span class="token operator">&lt;</span>Void<span class="token operator">></span> <span class="token function">filter</span><span class="token punctuation">(</span>ServerWebExchange exchange<span class="token punctuation">,</span> GatewayFilterChain chain<span class="token punctuation">)</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"**********come in MyLogGatewayFilter:"</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        String uname <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">"uname"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>uname <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"*********ç”¨æˆ·åä¸ºnullï¼Œéæ³•ç”¨æˆ·"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span>HttpStatus<span class="token punctuation">.</span>NOT_ACCEPTABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Gatewayæ¦‚è¿°&quot;&gt;1 Gatewayæ¦‚è¿°&lt;/h1&gt;&lt;p&gt;Gatewayæ˜¯åœ¨Springç”Ÿæ€ç³»ç»Ÿä¹‹ä¸Šæ„å»ºçš„APIç½‘å…³æœåŠ¡,åŸºäºSpring 5, Spring Boot 2å’ŒProject Reactorç­‰æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;p&gt;Gatewayæ—¨åœ¨æä¾›ä¸€ç§ç®€å•è€Œæœ‰
      
    
    </summary>
    
    
      <category term="ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶" scheme="https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="å¾®æœåŠ¡" scheme="https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="Gateway" scheme="https://www.codetool.top/tags/Gateway/"/>
    
  </entry>
  
  <entry>
    <title>leetcode945-ä½¿æ•°ç»„å”¯ä¸€çš„æœ€å°å¢é‡</title>
    <link href="https://www.codetool.top/article/leetcode945-%E4%BD%BF%E6%95%B0%E7%BB%84%E5%94%AF%E4%B8%80%E7%9A%84%E6%9C%80%E5%B0%8F%E5%A2%9E%E9%87%8F/"/>
    <id>https://www.codetool.top/article/leetcode945-ä½¿æ•°ç»„å”¯ä¸€çš„æœ€å°å¢é‡/</id>
    <published>2020-03-22T00:41:07.000Z</published>
    <updated>2020-03-22T00:44:44.878Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åŸé¢˜">1 åŸé¢˜</h1><p>ç»™å®šæ•´æ•°æ•°ç»„ Aï¼Œæ¯æ¬¡ <em>move</em> æ“ä½œå°†ä¼šé€‰æ‹©ä»»æ„ <code>A[i]</code>ï¼Œå¹¶å°†å…¶é€’å¢ <code>1</code>ã€‚</p><p>è¿”å›ä½¿ <code>A</code> ä¸­çš„æ¯ä¸ªå€¼éƒ½æ˜¯å”¯ä¸€çš„æœ€å°‘æ“ä½œæ¬¡æ•°ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><blockquote><p><strong>è¾“å…¥ï¼š</strong> [1,2,2]<br><strong>è¾“å‡ºï¼š</strong> 1<br><strong>è§£é‡Šï¼š</strong> ç»è¿‡ä¸€æ¬¡ move æ“ä½œï¼Œæ•°ç»„å°†å˜ä¸º [1, 2, 3]ã€‚</p></blockquote><p><strong>ç¤ºä¾‹ 2:</strong></p><blockquote><p><strong>è¾“å…¥ï¼š</strong> [3,2,1,2,1,7]<br><strong>è¾“å‡ºï¼š</strong> 6<br><strong>è§£é‡Šï¼š</strong> ç»è¿‡ 6 æ¬¡ move æ“ä½œï¼Œæ•°ç»„å°†å˜ä¸º [3, 4, 1, 2, 5, 7]ã€‚<br>å¯ä»¥çœ‹å‡º 5 æ¬¡æˆ– 5 æ¬¡ä»¥ä¸‹çš„ move æ“ä½œæ˜¯ä¸èƒ½è®©æ•°ç»„çš„æ¯ä¸ªå€¼å”¯ä¸€çš„ã€‚</p></blockquote><p><strong>æç¤ºï¼š</strong></p><ol><li><code>0 &lt;= A.length &lt;= 40000</code></li><li><code>0 &lt;= A[i] &lt; 40000</code></li></ol><h1 id="è§£æ³•">2 è§£æ³•</h1><h2 id="æ€æƒ³">2.1 æ€æƒ³</h2><p>å…ˆæ’åºï¼Œç„¶åä¿è¯æ¯ä¸ªæ•°å­—éƒ½å¤§äºå‰é¢çš„æ•°å­—ã€‚</p><h2 id="ä»£ç ">2.2 ä»£ç </h2><pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">minIncrementForUnique</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> A<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>A<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        Arrays<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> last <span class="token operator">=</span> A<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>A<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&lt;=</span>last<span class="token punctuation">)</span><span class="token punctuation">{</span>                sum <span class="token operator">+=</span> last<span class="token operator">+</span><span class="token number">1</span><span class="token operator">-</span>A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>                last <span class="token operator">=</span> last<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                last <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> sum<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;åŸé¢˜&quot;&gt;1 åŸé¢˜&lt;/h1&gt;&lt;p&gt;ç»™å®šæ•´æ•°æ•°ç»„ Aï¼Œæ¯æ¬¡ &lt;em&gt;move&lt;/em&gt; æ“ä½œå°†ä¼šé€‰æ‹©ä»»æ„ &lt;code&gt;A[i]&lt;/code&gt;ï¼Œå¹¶å°†å…¶é€’å¢ &lt;code&gt;1&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿”å›ä½¿ &lt;code&gt;A&lt;/code&gt; ä¸­çš„æ¯ä¸ªå€¼éƒ½æ˜¯å”¯ä¸€çš„æœ€å°‘æ“ä½œæ¬¡
      
    
    </summary>
    
    
      <category term="ç®—æ³•/æ•°æ®ç»“æ„" scheme="https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
      <category term="leetcode" scheme="https://www.codetool.top/tags/leetcode/"/>
    
      <category term="ç®—æ³•" scheme="https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Hystrixå›¾å½¢åŒ–ç›‘æ§-dashboardç®€å•ä½¿ç”¨</title>
    <link href="https://www.codetool.top/article/Hystrix%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%9B%91%E6%8E%A7-dashboard%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <id>https://www.codetool.top/article/Hystrixå›¾å½¢åŒ–ç›‘æ§-dashboardç®€å•ä½¿ç”¨/</id>
    <published>2020-03-21T14:24:47.000Z</published>
    <updated>2020-03-21T14:30:49.321Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Hystrix-Dashboardæ¦‚è¿°">1 Hystrix Dashboardæ¦‚è¿°</h1><p>é™¤äº†éš”ç¦»ä¾èµ–æœåŠ¡çš„è°ƒç”¨ä»¥å¤–ï¼ŒHystrixè¿˜æä¾›äº†å‡†å®æ—¶çš„è°ƒç”¨ç›‘æ§(Hystrix Dashboard)ï¼ŒHystrixä¼šæŒç»­åœ°è®°å½•æ‰€æœ‰é€šè¿‡Hystrixå‘èµ·çš„è¯·æ±‚çš„æ‰§è¡Œä¿¡æ¯ï¼Œå¹¶<strong>ä»¥ç»Ÿè®¡æŠ¥è¡¨å’Œå›¾å½¢çš„å½¢å¼</strong>å±•ç¤ºç»™ç”¨æˆ·ï¼ŒåŒ…æ‹¬æ¯ç§’æ‰§è¡Œå¤šå°‘è¯·æ±‚å¤šå°‘æˆåŠŸï¼Œå¤šå°‘å¤±è´¥ç­‰ã€‚Netflixé€šè¿‡<code>hystrix-metrics-event-stream</code>é¡¹ç›®å®ç°äº†å¯¹ä»¥ä¸ŠæŒ‡æ ‡çš„ç›‘æ§ã€‚Spring Cloudä¹Ÿæä¾›äº†Hystrix Dashboardçš„æ•´åˆï¼Œå¯¹ç›‘æ§å†…å®¹è½¬åŒ–æˆå¯è§†åŒ–ç•Œé¢ã€‚</p><h1 id="æ­å»ºdashboardæ¨¡å—">2 æ­å»ºdashboardæ¨¡å—</h1><p>ä¾èµ–ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--hystrix dashboard--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-hystrix-dashboard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--actuatorç›‘æ§ä¿¡æ¯å®Œå–„--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--çƒ­éƒ¨ç½²--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>yamlé…ç½®ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9001</span></code></pre><p>å¯åŠ¨ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token comment" spellcheck="true">//å¼€å¯HystrixDashboard</span><span class="token annotation punctuation">@EnableHystrixDashboard</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HystrixDashboardMain9001</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>HystrixDashboardMain9001<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>åœ¨è¢«ç›‘æ§çš„hystrixæœåŠ¡æä¾›æ–¹åŠ ä¸Šé…ç½®ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/*** æ­¤é…ç½®æ˜¯ä¸ºäº†æœåŠ¡ç›‘æ§è€Œé…ç½®ï¼Œä¸æœåŠ¡å®¹é”™æœ¬èº«æ— è§‚ï¼ŒspringCloud å‡çº§ä¹‹åçš„å‘* ServletRegistrationBeanå› ä¸ºspringbootçš„é»˜è®¤è·¯å¾„ä¸æ˜¯/hystrix.stream* åªè¦åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­é…ç½®ä¸Šä¸‹é¢çš„servletå³å¯* @return*/</span><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> ServletRegistrationBean <span class="token function">getServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    HystrixMetricsStreamServlet streamServlet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HystrixMetricsStreamServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ServletRegistrationBean<span class="token operator">&lt;</span>HystrixMetricsStreamServlet<span class="token operator">></span> registrationBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletRegistrationBean</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>streamServlet<span class="token punctuation">)</span><span class="token punctuation">;</span>    registrationBean<span class="token punctuation">.</span><span class="token function">setLoadOnStartup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    registrationBean<span class="token punctuation">.</span><span class="token function">addUrlMappings</span><span class="token punctuation">(</span><span class="token string">"/hystrix.stream"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    registrationBean<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"HystrixMetricsStreamServlet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> registrationBean<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å¯åŠ¨ç›‘æ§æ–¹å’Œè¢«ç›‘æ§æ–¹ï¼Œè®¿é—®è¯¥åœ°å€å³å¯çœ‹åˆ°ç›‘æ§é¡µé¢ï¼š <a href="http://localhost:8001/hystrix.stream" target="_blank" rel="noopener">http://localhost:8001/hystrix.stream</a></p><p><img src="https://api.codetool.top/img/15848001208056.png" alt></p><h1 id="å¦‚ä½•çœ‹å›¾">3 å¦‚ä½•çœ‹å›¾</h1><h2 id="ä¸ƒè‰²">3.1 ä¸ƒè‰²</h2><p><span color="green">Success</span> | <span color="blue">Short-Circuited</span>  | <span color="00CC99">Bad Request</span> | <span color="#FF9900">Timeout</span> | <span color="purple">Rejected</span> | <span color="red">Failure </span>  | Error </p><h2 id="ä¸€åœˆ">3.2 ä¸€åœˆ</h2><p>å®å¿ƒåœ†:å…±æœ‰ä¸¤ç§å«ä¹‰ã€‚å®ƒé€šè¿‡é¢œè‰²çš„å˜åŒ–ä»£è¡¨äº†å®ä¾‹çš„å¥åº·ç¨‹åº¦ï¼Œå®ƒçš„å¥åº·åº¦ä»ç»¿è‰²&lt;é»„è‰²&lt;æ©™è‰²&lt;çº¢è‰²é€’å‡ã€‚</p><p>è¯¥å®å¿ƒåœ†é™¤äº†é¢œè‰²çš„å˜åŒ–ä¹‹å¤–,å®ƒçš„å¤§å°ä¹Ÿä¼šæ ¹æ®å®ä¾‹çš„è¯·æ±‚æµé‡å‘ç”Ÿå˜åŒ–,æµé‡è¶Šå¤§è¯¥å®å¿ƒåœ†å°±è¶Šå¤§ã€‚æ‰€ä»¥é€šè¿‡è¯¥å®å¿ƒåœ†çš„å±•ç¤ºï¼Œå°±å¯ä»¥åœ¨å¤§é‡çš„å®ä¾‹ä¸­å¿«é€Ÿçš„å‘ç°æ•…éšœå®ä¾‹å’Œé«˜å‹åŠ›å®ä¾‹ã€‚</p><h2 id="ä¸€çº¿">3.3 ä¸€çº¿</h2><p>æ›²çº¿:ç”¨æ¥è®°å½•2åˆ†é’Ÿå†…æµé‡çš„ç›¸å¯¹å˜åŒ–ï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥è§‚å¯Ÿåˆ°æµé‡çš„ä¸Šå‡å’Œä¸‹é™è¶‹åŠ¿ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Hystrix-Dashboardæ¦‚è¿°&quot;&gt;1 Hystrix Dashboardæ¦‚è¿°&lt;/h1&gt;&lt;p&gt;é™¤äº†éš”ç¦»ä¾èµ–æœåŠ¡çš„è°ƒç”¨ä»¥å¤–ï¼ŒHystrixè¿˜æä¾›äº†å‡†å®æ—¶çš„è°ƒç”¨ç›‘æ§(Hystrix Dashboard)ï¼ŒHystrixä¼šæŒç»­åœ°è®°å½•æ‰€æœ‰é€šè¿‡Hystrixå‘èµ·çš„è¯·æ±‚
      
    
    </summary>
    
    
      <category term="ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶" scheme="https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="å¾®æœåŠ¡" scheme="https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="Hystrix" scheme="https://www.codetool.top/tags/Hystrix/"/>
    
  </entry>
  
  <entry>
    <title>HystrixæœåŠ¡ç†”æ–­çš„ç”¨æ³•</title>
    <link href="https://www.codetool.top/article/Hystrix%E6%9C%8D%E5%8A%A1%E7%86%94%E6%96%AD%E7%9A%84%E7%94%A8%E6%B3%95/"/>
    <id>https://www.codetool.top/article/HystrixæœåŠ¡ç†”æ–­çš„ç”¨æ³•/</id>
    <published>2020-03-21T13:48:26.000Z</published>
    <updated>2020-03-21T13:48:39.758Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æœåŠ¡ç†”æ–­æ˜¯ä»€ä¹ˆ">1 æœåŠ¡ç†”æ–­æ˜¯ä»€ä¹ˆ</h1><p>ç†”æ–­æœºåˆ¶æ˜¯åº”å¯¹é›ªå´©æ•ˆåº”çš„ä¸€ç§å¾®æœåŠ¡é“¾è·¯ä¿æŠ¤æœºåˆ¶ã€‚å½“æ‰‡å‡ºé“¾è·¯çš„æŸä¸ªå¾®æœåŠ¡å‡ºé”™ä¸å¯ç”¨æˆ–è€…å“åº”æ—¶é—´å¤ªé•¿æ—¶,ä¼š<strong>è¿›è¡ŒæœåŠ¡çš„é™çº§,è¿›è€Œç†”æ–­è¯¥èŠ‚ç‚¹å¾®æœåŠ¡çš„è°ƒç”¨,å¿«é€Ÿè¿”å›é”™è¯¯çš„å“åº”ä¿¡æ¯ã€‚</strong>å½“æ£€æµ‹<strong>åˆ°è¯¥èŠ‚ç‚¹å¾®æœåŠ¡è°ƒç”¨å“åº”æ­£å¸¸åï¼Œæ¢å¤è°ƒç”¨é“¾è·¯ã€‚</strong></p><p>åœ¨Spring Cloudæ¡†æ¶é‡Œ,ç†”æ–­æœºåˆ¶é€šè¿‡Hystrixå®ç°ã€‚Hystrixä¼šç›‘æ§å¾®æœåŠ¡é—´è°ƒç”¨çš„çŠ¶å†µï¼Œå½“å¤±è´¥çš„è°ƒç”¨åˆ°ä¸€å®šé˜ˆå€¼ï¼Œç¼ºçœæ˜¯<strong>5ç§’å†…20æ¬¡è°ƒç”¨å¤±è´¥ï¼Œå¹¶ä¸”è¶…è¿‡è¯·æ±‚æ€»æ•°çš„50%</strong>,å°±ä¼šå¯åŠ¨ç†”æ–­æœºåˆ¶ã€‚ç†”æ–­æœºåˆ¶çš„æ³¨è§£æ˜¯<code>@HystrixCommand</code></p><p><img src="https://api.codetool.top/img/15847961805939.png" alt></p><p>Closedï¼šç†”æ–­å™¨å…³é—­çŠ¶æ€ï¼ˆæ‰€æœ‰è¯·æ±‚è¿”å›æˆåŠŸï¼‰</p><p>Openï¼šç†”æ–­å™¨æ‰“å¼€çŠ¶æ€ï¼ˆè°ƒç”¨æ¬¡æ•°ç´¯è®¡åˆ°è¾¾é˜ˆå€¼æˆ–è€…æ¯”ä¾‹ï¼Œç†”æ–­å™¨æ‰“å¼€ï¼ŒæœåŠ¡ç›´æ¥è¿”å›é”™è¯¯ï¼‰</p><p>Half Openï¼šç†”æ–­å™¨åŠå¼€çŠ¶æ€ï¼ˆé»˜è®¤æ—¶é—´è¿‡åï¼Œè¿›å…¥åŠç†”æ–­çŠ¶æ€ï¼Œå…è®¸å®šé‡æœåŠ¡è¯·æ±‚ï¼Œå¦‚æœè°ƒç”¨éƒ½æˆåŠŸï¼Œåˆ™è®¤ä¸ºæ¢å¤äº†ï¼Œåˆ™å…³é—­æ–­è·¯å™¨ï¼Œåä¹‹æ‰“å¼€æ–­è·¯å™¨ï¼‰</p><h1 id="ä½¿ç”¨">2 ä½¿ç”¨</h1><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//è¿™é‡Œå³10ç§’å†…10æ¬¡è¯·æ±‚ä¸­å¤±è´¥6æ¬¡åˆ™ç†”æ–­</span><span class="token annotation punctuation">@HystrixCommand</span><span class="token punctuation">(</span>    <span class="token comment" spellcheck="true">//æŒ‡å®šé™çº§æ–¹æ³•</span>    fallbackMethod <span class="token operator">=</span> <span class="token string">"paymentCircuitBreaker_fallback"</span><span class="token punctuation">,</span> commandProperties <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token annotation punctuation">@HystrixProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"circuitBreaker.enabled"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// æ˜¯å¦å¼€å¯æ–­è·¯å™¨</span>        <span class="token annotation punctuation">@HystrixProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"circuitBreaker.requestVolumeThreshold"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"10"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// è¯·æ±‚æ¬¡æ•°</span>        <span class="token annotation punctuation">@HystrixProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"circuitBreaker.sleepWindowInMilliseconds"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"10000"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// æ—¶é—´çª—å£æœŸ/æ—¶é—´èŒƒå›´</span>        <span class="token annotation punctuation">@HystrixProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"circuitBreaker.errorThresholdPercentage"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"60"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// å¤±è´¥ç‡è¾¾åˆ°å¤šå°‘åç†”æ–­</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">public</span> String <span class="token function">paymentCircuitBreaker</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Integer id<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"*****idä¸èƒ½æ˜¯è´Ÿæ•°"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    String serialNumber <span class="token operator">=</span> IdUtil<span class="token punctuation">.</span><span class="token function">simpleUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> <span class="token string">"è°ƒç”¨æˆåŠŸ,æµæ°´å·:"</span> <span class="token operator">+</span> serialNumber<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//é™çº§æ–¹æ³•</span><span class="token keyword">public</span> String <span class="token function">paymentCircuitBreaker_fallback</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Integer id<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token string">"id ä¸èƒ½è´Ÿæ•°,è¯·ç¨åé‡è¯•,o(â•¥ï¹â•¥)o id:"</span> <span class="token operator">+</span> id<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å…³äºæœåŠ¡ç†”æ–­ï¼Œé™¤äº†è¦å°†<code>circuitBreaker.enabled</code>è®¾ä¸º<code>true</code>ï¼Œè¿˜æœ‰ä¸‰ä¸ªé‡è¦çš„å‚æ•°ï¼š</p><table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>sleepWindowInMilliseconds</td><td>å¿«ç…§æ—¶é—´çª—:æ–­è·¯å™¨ç¡®å®šæ˜¯å¦æ‰“å¼€éœ€è¦ç»Ÿè®¡ä¸€äº›è¯·æ±‚å’Œé”™è¯¯æ•°æ®,è€Œç»Ÿè®¡çš„æ—¶é—´èŒƒå›´å°±æ˜¯å¿«ç…§æ—¶é—´çª—</td><td>5000</td></tr><tr><td>requestVolumeThreshold</td><td>è¯·æ±‚æ€»æ•°é˜€å€¼:åœ¨å¿«ç…§æ—¶é—´çª—å†…ï¼Œå¿…é¡»æ»¡è¶³è¯·æ±‚æ€»æ•°é˜€å€¼æ‰æœ‰èµ„æ ¼ç†”æ–­ã€‚</td><td>20</td></tr><tr><td>errorThresholdPercentage</td><td>é”™è¯¯ç™¾åˆ†æ¯”é˜€å€¼:å½“è¯·æ±‚æ€»æ•°åœ¨å¿«ç…§æ—¶é—´çª—å†…è¶…è¿‡äº†é˜€å€¼,æ¯”å¦‚å¯¹äº50%ï¼Œå‘ç”Ÿäº†30æ¬¡è°ƒç”¨ï¼Œå¦‚æœåœ¨è¿™30æ¬¡è°ƒç”¨ä¸­,æœ‰15æ¬¡å‘ç”Ÿäº†è¶…æ—¶å¼‚å¸¸,å°±ä¼šå°†æ–­è·¯å™¨æ‰“å¼€ã€‚</td><td>50</td></tr></tbody></table><p>ç„¶åä¿®æ”¹controllerè°ƒç”¨å®ƒï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/payment/circuit/{id}"</span><span class="token punctuation">)</span><span class="token keyword">public</span> String <span class="token function">paymentInfo_Timeout</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Integer id<span class="token punctuation">)</span><span class="token punctuation">{</span>    String result <span class="token operator">=</span> paymentService<span class="token punctuation">.</span><span class="token function">paymentCircuitBreaker</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"****result:"</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> result<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>æ­¤æ—¶å¯åŠ¨æœåŠ¡ï¼Œè‹¥è®¿é—® <a href="http://localhost:8001/payment/circuit/-30" target="_blank" rel="noopener">http://localhost:8001/payment/circuit/-30</a> ï¼ˆåªè¦ä¼ å…¥idä¸ºè´Ÿæ•°ï¼‰åœ¨10ç§’é’Ÿä¹‹å†…è¶…è¿‡10æ¬¡ï¼ˆæ­¤æ—¶çš„å¤±è´¥ç‡æ˜¯100%ï¼‰ï¼Œå°±ä¼šè§¦å‘ç†”æ–­ï¼Œåœ¨ç†”æ–­æœŸé—´å†…ï¼Œå³ä½¿å‘å‡ºæ­£å¸¸çš„è¯·æ±‚å¦‚ <a href="http://localhost:8001/payment/circuit/10" target="_blank" rel="noopener">http://localhost:8001/payment/circuit/10</a> ä¹Ÿä¸ä¼šå¾—åˆ°å›å¤</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;æœåŠ¡ç†”æ–­æ˜¯ä»€ä¹ˆ&quot;&gt;1 æœåŠ¡ç†”æ–­æ˜¯ä»€ä¹ˆ&lt;/h1&gt;&lt;p&gt;ç†”æ–­æœºåˆ¶æ˜¯åº”å¯¹é›ªå´©æ•ˆåº”çš„ä¸€ç§å¾®æœåŠ¡é“¾è·¯ä¿æŠ¤æœºåˆ¶ã€‚å½“æ‰‡å‡ºé“¾è·¯çš„æŸä¸ªå¾®æœåŠ¡å‡ºé”™ä¸å¯ç”¨æˆ–è€…å“åº”æ—¶é—´å¤ªé•¿æ—¶,ä¼š&lt;strong&gt;è¿›è¡ŒæœåŠ¡çš„é™çº§,è¿›è€Œç†”æ–­è¯¥èŠ‚ç‚¹å¾®æœåŠ¡çš„è°ƒç”¨,å¿«é€Ÿè¿”å›é”™è¯¯çš„å“åº”ä¿¡æ¯ã€‚&lt;/strong&gt;å½“æ£€æµ‹&lt;
      
    
    </summary>
    
    
      <category term="ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶" scheme="https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="å¾®æœåŠ¡" scheme="https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="Hystrix" scheme="https://www.codetool.top/tags/Hystrix/"/>
    
  </entry>
  
  <entry>
    <title>Hystrixæ¦‚è¿°ä¸æœåŠ¡é™çº§</title>
    <link href="https://www.codetool.top/article/Hystrix%E6%A6%82%E8%BF%B0%E4%B8%8E%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7/"/>
    <id>https://www.codetool.top/article/Hystrixæ¦‚è¿°ä¸æœåŠ¡é™çº§/</id>
    <published>2020-03-21T12:16:59.000Z</published>
    <updated>2020-03-21T14:32:16.811Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Hystrixæ¦‚è¿°">1 Hystrixæ¦‚è¿°</h1><h2 id="æœåŠ¡é›ªå´©">1.1 æœåŠ¡é›ªå´©</h2><p>å¤šä¸ªå¾®æœåŠ¡ä¹‹é—´è°ƒç”¨çš„æ—¶å€™ï¼Œå‡è®¾å¾®æœåŠ¡Aè°ƒç”¨å¾®æœåŠ¡Bå’Œå¾®æœåŠ¡C,å¾®æœåŠ¡Bå’Œå¾®æœåŠ¡Cåˆè°ƒç”¨å…¶å®ƒçš„å¾®æœåŠ¡ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€æ‰‡å‡ºâ€ã€‚</p><p><strong>å¦‚æœæ‰‡å‡ºçš„é“¾è·¯ä¸ŠæŸä¸ªå¾®æœåŠ¡çš„è°ƒç”¨å“åº”æ—¶é—´è¿‡é•¿æˆ–è€…ä¸å¯ç”¨ï¼Œå¯¹å¾®æœåŠ¡Açš„è°ƒç”¨å°±ä¼šå ç”¨è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿèµ„æºï¼Œè¿›è€Œå¼•èµ·ç³»ç»Ÿå´©æºƒ,æ‰€è°“çš„â€œé›ªå´©æ•ˆåº”â€</strong>ï¼Œå¯¹äºé«˜æµé‡çš„åº”ç”¨æ¥è¯´ï¼Œå•ä¸€çš„åç«¯ä¾èµ–å¯èƒ½ä¼šå¯¼è‡´æ‰€æœ‰æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰èµ„æºéƒ½åœ¨å‡ ç§’é’Ÿå†…é¥±å’Œã€‚æ¯”å¤±è´¥æ›´ç³Ÿç³•çš„æ˜¯,è¿™äº›åº”ç”¨ç¨‹åºè¿˜å¯èƒ½å¯¼è‡´æœåŠ¡ä¹‹é—´çš„å»¶è¿Ÿå¢åŠ ï¼Œå¤‡ä»½é˜Ÿåˆ—ï¼Œçº¿ç¨‹å’Œå…¶ä»–ç³»ç»Ÿèµ„æºç´§å¼ ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå‘ç”Ÿæ›´å¤šçš„çº§è”æ•…éšœã€‚è¿™äº›éƒ½è¡¨ç¤ºéœ€è¦å¯¹æ•…éšœå’Œå»¶è¿Ÿè¿›è¡Œéš”ç¦»å’Œç®¡ç†ï¼Œä»¥ä¾¿å•ä¸ªä¾èµ–å…³ç³»çš„å¤±è´¥ï¼Œä¸èƒ½å–æ¶ˆæ•´ä¸ªåº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿã€‚</p><h2 id="Hystixçš„ä½œç”¨">1.2 Hystixçš„ä½œç”¨</h2><p>Hystrixæ˜¯ä¸€ä¸ªç”¨äºå¤„ç†åˆ†å¸ƒå¼ç³»ç»Ÿçš„å»¶è¿Ÿå’Œå®¹é”™çš„å¼€æºåº“ï¼Œ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œ,è®¸å¤šä¾èµ–ä¸å¯é¿å…çš„ä¼šè°ƒç”¨å¤±è´¥ï¼Œæ¯”å¦‚è¶…æ—¶ã€å¼‚å¸¸ç­‰,</p><p>Hystrixèƒ½å¤Ÿä¿è¯åœ¨ä¸€ä¸ªä¾èµ–å‡ºé—®é¢˜çš„æƒ…å†µä¸‹ï¼Œ<strong>ä¸ä¼šå¯¼è‡´æ•´ä½“æœåŠ¡å¤±è´¥,é¿å…çº§è”æ•…éšœ,ä»¥æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼¹æ€§ã€‚</strong></p><ul><li>æœåŠ¡é™çº§(fallback)ï¼š æœåŠ¡é™çº§æ˜¯ä»æ•´ä¸ªç³»ç»Ÿçš„è´Ÿè·æƒ…å†µå‡ºå‘å’Œè€ƒè™‘çš„ï¼Œå¯¹æŸäº›è´Ÿè·ä¼šæ¯”è¾ƒé«˜çš„æƒ…å†µï¼Œä¸ºäº†é¢„é˜²æŸäº›åŠŸèƒ½ï¼ˆä¸šåŠ¡åœºæ™¯ï¼‰å‡ºç°è´Ÿè·è¿‡è½½æˆ–è€…å“åº”æ…¢çš„æƒ…å†µï¼Œ<strong>åœ¨å…¶å†…éƒ¨æš‚æ—¶èˆå¼ƒå¯¹ä¸€äº›éæ ¸å¿ƒçš„æ¥å£å’Œæ•°æ®çš„è¯·æ±‚ï¼Œè€Œç›´æ¥è¿”å›ä¸€ä¸ªæå‰å‡†å¤‡å¥½çš„fallbackï¼ˆé€€è·¯ï¼‰é”™è¯¯å¤„ç†ä¿¡æ¯ã€‚è¿™æ ·ï¼Œè™½ç„¶æä¾›çš„æ˜¯ä¸€ä¸ªæœ‰æŸçš„æœåŠ¡ï¼Œä½†å´ä¿è¯äº†æ•´ä¸ªç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚</strong></li><li>æœåŠ¡ç†”æ–­ï¼šå½“ä¸‹æ¸¸çš„æœåŠ¡å› ä¸ºæŸç§åŸå› çªç„¶å˜å¾—ä¸å¯ç”¨æˆ–å“åº”è¿‡æ…¢ï¼Œä¸Šæ¸¸æœåŠ¡ä¸ºäº†ä¿è¯è‡ªå·±æ•´ä½“æœåŠ¡çš„å¯ç”¨æ€§ï¼Œé€šå¸¸å…ˆæœåŠ¡é™çº§ï¼Œå¹¶ä¸å†ç»§ç»­è°ƒç”¨ç›®æ ‡æœåŠ¡ï¼Œç›´æ¥è¿”å›ï¼Œå¿«é€Ÿé‡Šæ”¾èµ„æºã€‚å¦‚æœç›®æ ‡æœåŠ¡æƒ…å†µå¥½è½¬åˆ™æ¢å¤è°ƒç”¨ã€‚</li><li>æœåŠ¡é™æµï¼šé™æµçš„ç›®çš„æ˜¯é€šè¿‡å¯¹å¹¶å‘è®¿é—®/è¯·æ±‚è¿›è¡Œé™é€Ÿæˆ–è€…ä¸€ä¸ªæ—¶é—´çª—å£å†…çš„çš„è¯·æ±‚è¿›è¡Œé™é€Ÿæ¥ä¿æŠ¤ç³»ç»Ÿï¼Œä¸€æ—¦è¾¾åˆ°é™åˆ¶é€Ÿç‡åˆ™å¯ä»¥æ‹’ç»æœåŠ¡ã€æ’é˜Ÿæˆ–ç­‰å¾…ã€é™çº§ã€‚</li></ul><p>å“ªäº›æƒ…å†µä¼šå‘ç”ŸæœåŠ¡é™çº§ï¼š</p><ul><li>ç¨‹åºè¿è¡Œå¼‚å¸¸</li><li>è¶…æ—¶</li><li>æœåŠ¡ç†”æ–­è§¦å‘æœåŠ¡é™çº§</li><li>çº¿ç¨‹æ± /ä¿¡å·é‡ä¹Ÿä¼šå¯¼è‡´æœåŠ¡é™çº§</li></ul><h1 id="HystrixæœåŠ¡é™çº§">2 HystrixæœåŠ¡é™çº§</h1><h2 id="æ¨¡æ‹Ÿä¸€ä¸ªé«˜å¹¶å‘è®¿é—®ç¼“æ…¢çš„æœåŠ¡">2.1 æ¨¡æ‹Ÿä¸€ä¸ªé«˜å¹¶å‘è®¿é—®ç¼“æ…¢çš„æœåŠ¡</h2><p>ç»§ç»­æ–°å»ºæ¨¡å—<code>cloud-provider-hystrix-payment8001</code>ï¼Œåœ¨æ¨¡å—<code>cloud-provider-payment8001</code>çš„åŸºç¡€ä¸Šæ·»åŠ ä¾èµ–ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-hystrix<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>yaml:</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8001</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>hystrix<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service<span class="token key atrule">eureka</span><span class="token punctuation">:</span>  <span class="token key atrule">client</span><span class="token punctuation">:</span>    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka7001.com<span class="token punctuation">:</span>7001/eureka<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka7002.com<span class="token punctuation">:</span>7002/eureka <span class="token comment" spellcheck="true">#é›†ç¾¤ç‰ˆ</span>    <span class="token comment" spellcheck="true"># å°†è‡ªå·±æ³¨å†Œè¿›eureka server</span>    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token comment" spellcheck="true"># æ˜¯å¦ä»eureka serveræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡</span>    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">instance</span><span class="token punctuation">:</span>    <span class="token key atrule">instance-id</span><span class="token punctuation">:</span> payment<span class="token punctuation">-</span>hystrix<span class="token punctuation">-</span><span class="token number">8001</span></code></pre><p>å¯åŠ¨ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableEurekaClient</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentHystrixMain8001</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>PaymentHystrixMain8001<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>service:</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentService</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> String <span class="token function">paymentInfo_OK</span><span class="token punctuation">(</span>Integer id<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"çº¿ç¨‹æ± ï¼š"</span><span class="token operator">+</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\t paymentInfo_OK,id:"</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">"\t ok"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">paymentInfo_Timeout</span><span class="token punctuation">(</span>Integer id<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">int</span> timeNumber <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>timeNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token string">"çº¿ç¨‹æ± ï¼š"</span><span class="token operator">+</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\t paymentInfo_Timeout,id:"</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">"\t okï¼Œè€—æ—¶"</span><span class="token operator">+</span>timeNumber<span class="token operator">+</span><span class="token string">"ç§’é’Ÿ"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>controller:</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> PaymentService paymentService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${server.port}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String serverPort<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/payment/hystrix/ok/{id}"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">paymentInfo_OK</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Integer id<span class="token punctuation">)</span><span class="token punctuation">{</span>        String result <span class="token operator">=</span> paymentService<span class="token punctuation">.</span><span class="token function">paymentInfo_OK</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"****result:"</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/payment/hystrix/timeout/{id}"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">paymentInfo_Timeout</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Integer id<span class="token punctuation">)</span><span class="token punctuation">{</span>        String result <span class="token operator">=</span> paymentService<span class="token punctuation">.</span><span class="token function">paymentInfo_Timeout</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"****result:"</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æˆ‘ä»¬ä½¿ç”¨Jmeteré€šè¿‡200ä¸ªçº¿ç¨‹å¾ªç¯è®¿é—® <a href="http://localhost:8001/payment/hystrix/ok/30" target="_blank" rel="noopener">http://localhost:8001/payment/hystrix/ok/30</a> ï¼Œå¹¶ä¸­é€”æ‰‹åŠ¨è®¿é—® <a href="http://localhost:8001/payment/hystrix/ok/2" target="_blank" rel="noopener">http://localhost:8001/payment/hystrix/ok/2</a> ï¼Œä¼šå‘ç°è€—æ—¶çŸ­çš„æœåŠ¡çš„å“åº”æ—¶é—´ä¹Ÿè¢«æ‹–æ…¢äº†ï¼Œä¸»è¦åŸå› æ˜¯å¤§é‡çš„è¯·æ±‚è€—å°½äº†tomcatçš„çº¿ç¨‹æ± èµ„æºã€‚</p><h2 id="æä¾›æ–¹é…ç½®æœåŠ¡é™çº§">2.2 æä¾›æ–¹é…ç½®æœåŠ¡é™çº§</h2><p>hystrixå¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè¶…æ—¶æ—¶é—´å†…æ­£å¸¸æœåŠ¡ï¼Œè¶…è¿‡è¶…æ—¶æ—¶é—´åšæœåŠ¡é™çº§fallbackã€‚</p><p>ä¸»é…ç½®ç±»æ·»åŠ æ³¨è§£<code>@EnableCircuitBreaker</code>ä½¿æ”¯æŒhystrixæ³¨è§£ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableEurekaClient</span><span class="token annotation punctuation">@EnableCircuitBreaker</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentHystrixMain8001</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>PaymentHystrixMain8001<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ä¿®æ”¹serviceï¼Œåœ¨éœ€è¦åšæœåŠ¡é™çº§çš„æ–¹æ³•ä¸Šæ·»åŠ <code>@HystrixCommand</code>å¹¶é…ç½®ç›¸å…³å±æ€§ï¼Œå†æ·»åŠ ä¸€ä¸ªç”¨äºè¶…æ—¶å¤„ç†çš„æ–¹æ³•ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentService</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> String <span class="token function">paymentInfo_OK</span><span class="token punctuation">(</span>Integer id<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"çº¿ç¨‹æ± ï¼š"</span><span class="token operator">+</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\t paymentInfo_OK,id:"</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">"\t ok"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//fallbackMethodæŒ‡å®šè¶…æ—¶å¤„ç†çš„æ–¹æ³•ï¼Œåœ¨commandPropertiesä¸­é…ç½®è¶…æ—¶æ—¶é—´</span>    <span class="token annotation punctuation">@HystrixCommand</span><span class="token punctuation">(</span>fallbackMethod <span class="token operator">=</span> <span class="token string">"paymentInfo_TimeOutHandler"</span><span class="token punctuation">,</span>commandProperties <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token annotation punctuation">@HystrixProperty</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"execution.isolation.thread.timeoutInMilliseconds"</span><span class="token punctuation">,</span>value <span class="token operator">=</span> <span class="token string">"3000"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">paymentInfo_Timeout</span><span class="token punctuation">(</span>Integer id<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">int</span> timeNumber <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>timeNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token string">"çº¿ç¨‹æ± ï¼š"</span><span class="token operator">+</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\t paymentInfo_Timeout,id:"</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">"\t okï¼Œè€—æ—¶"</span><span class="token operator">+</span>timeNumber<span class="token operator">+</span><span class="token string">"ç§’é’Ÿ"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">paymentInfo_TimeOutHandler</span><span class="token punctuation">(</span>Integer id<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"çº¿ç¨‹æ± ï¼š"</span><span class="token operator">+</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\t paymentInfo_TimeOutHandler,id:"</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">"\t redirect"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="æ¶ˆè´¹æ–¹é…ç½®æœåŠ¡é™çº§">2.3 æ¶ˆè´¹æ–¹é…ç½®æœåŠ¡é™çº§</h2><p>æœåŠ¡æä¾›æ–¹å¯ä»¥é…ç½®æœåŠ¡é™çº§ï¼Œæ¶ˆè´¹æ–¹ä¹Ÿå¯ä»¥ï¼Œå¹¶ä¸”é€šå¸¸Hystrixæ˜¯é…ç½®åœ¨æ¶ˆè´¹è€…æ–¹çš„ï¼Œè¿™é‡Œæ–°å»ºä¸€ä¸ªæ¶ˆè´¹ç«¯æ¨¡å—<code>cloud-consumer-feign-hystrix-order80</code>ï¼Œä¾èµ–ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--hystrix--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-hystrix<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--openfeign--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--eureka client--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.atguigu.springcloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>cloud-api-common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--ç›‘æ§--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--çƒ­éƒ¨ç½²--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span></code></pre><p>å¯åŠ¨ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableFeignClients</span><span class="token annotation punctuation">@EnableHystrix</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderHystrixMain80</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>OrderHystrixMain80<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>feign serviceæ¥å£:</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span><span class="token string">"CLOUD-HYSTRIX-PAYMENT-SERVICE"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PaymentHystrixService</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/payment/hystrix/ok/{id}"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">paymentInfo_OK</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Integer id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/payment/hystrix/timeout/{id}"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">paymentInfo_Timeout</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Integer id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>controllerï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderHystrixController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> PaymentHystrixService paymentHystrixService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/consumer/payment/hystrix/ok/{id}"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">paymentInfo_OK</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Integer id<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> paymentHystrixService<span class="token punctuation">.</span><span class="token function">paymentInfo_OK</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//è¶…æ—¶1.5såˆ™fallbackè‡³paymentTimeOutFallbackMethodæ–¹æ³•</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/consumer/payment/hystrix/timeout/{id}"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@HystrixCommand</span><span class="token punctuation">(</span>fallbackMethod <span class="token operator">=</span> <span class="token string">"paymentTimeOutFallbackMethod"</span><span class="token punctuation">,</span>commandProperties <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token annotation punctuation">@HystrixProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"execution.isolation.thread.timeoutInMilliseconds"</span><span class="token punctuation">,</span>value <span class="token operator">=</span> <span class="token string">"1500"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">paymentInfo_Timeout</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Integer id<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> paymentHystrixService<span class="token punctuation">.</span><span class="token function">paymentInfo_Timeout</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> String <span class="token function">paymentTimeOutFallbackMethod</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Integer id<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"æˆ‘æ˜¯æ¶ˆè´¹è€…80ï¼Œå¯¹æ–¹æ”¯ä»˜ç³»ç»Ÿç¹å¿™è¯·10ç§’é’Ÿåå†è¯•æˆ–è€…è‡ªå·±è¿è¡Œå‡ºé”™è¯·æ£€æŸ¥è‡ªå·±/(ã„’oã„’)/~~"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="é»˜è®¤é™çº§æ–¹æ³•">2.4 é»˜è®¤é™çº§æ–¹æ³•</h2><p>å¯ä»¥å°†ä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•é…ç½®ä¸€ä¸ªé»˜è®¤çš„é™çº§æ–¹æ³•ï¼Œé¿å…å¯¹æ¯ä¸ªæ–¹æ³•éƒ½é…ç½®ä¸€ä¸ªé™çº§æ–¹æ³•ï¼Œé€ æˆä»£ç è‡ƒè‚¿ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@Slf4j</span><span class="token comment" spellcheck="true">//æŒ‡å®šé»˜è®¤é™çº§æ–¹æ³•</span><span class="token annotation punctuation">@DefaultProperties</span><span class="token punctuation">(</span>defaultFallback <span class="token operator">=</span> <span class="token string">"paymentGlobalFallbackMethod"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderHystrixController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> PaymentHystrixService paymentHystrixService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/consumer/payment/hystrix/ok/{id}"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">paymentInfo_OK</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Integer id<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> paymentHystrixService<span class="token punctuation">.</span><span class="token function">paymentInfo_OK</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/consumer/payment/hystrix/timeout/{id}"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@HystrixCommand</span><span class="token punctuation">(</span>fallbackMethod <span class="token operator">=</span> <span class="token string">"paymentTimeOutFallbackMethod"</span><span class="token punctuation">,</span>commandProperties <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token annotation punctuation">@HystrixProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"execution.isolation.thread.timeoutInMilliseconds"</span><span class="token punctuation">,</span>value <span class="token operator">=</span> <span class="token string">"1500"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">paymentInfo_Timeout</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Integer id<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> paymentHystrixService<span class="token punctuation">.</span><span class="token function">paymentInfo_Timeout</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> String <span class="token function">paymentTimeOutFallbackMethod</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Integer id<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"æˆ‘æ˜¯æ¶ˆè´¹è€…80ï¼Œå¯¹æ–¹æ”¯ä»˜ç³»ç»Ÿç¹å¿™è¯·10ç§’é’Ÿåå†è¯•æˆ–è€…è‡ªå·±è¿è¡Œå‡ºé”™è¯·æ£€æŸ¥è‡ªå·±/(ã„’oã„’)/~~"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//ä¸‹é¢æ˜¯å…¨å±€fallback</span>    <span class="token keyword">public</span> String <span class="token function">paymentGlobalFallbackMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"Globalå¼‚å¸¸ä¿¡æ¯ï¼Œè¯·ç¨åå†è¯•â”­â”®ï¹â”­â”®"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="é™çº§æ–¹æ³•è§£è€¦">2.5 é™çº§æ–¹æ³•è§£è€¦</h2><p>é™çº§æ–¹æ³•å±äºå¼‚å¸¸å¤„ç†æ–¹æ³•ï¼Œä¸åº”è¯¥æ”¾å…¥æ­£å¸¸ä¸šåŠ¡ç±»ä¸­ï¼Œå¯ä»¥ä¸ºFeign Clientä½¿ç”¨çš„æ¥å£æ³¨å†Œä¸€ä¸ªå¯¹åº”çš„æœåŠ¡é™çº§å¤„ç†ç±»</p><p>åœ¨<code>@FeignClient</code>ä¸­æŒ‡å®šfallbackä¸ºä¸€ä¸ªé™çº§å¤„ç†ç±»</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"CLOUD-HYSTRIX-PAYMENT-SERVICE"</span><span class="token punctuation">,</span>fallback <span class="token operator">=</span> PaymentFallbackService<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PaymentHystrixService</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/payment/hystrix/ok/{id}"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">paymentInfo_OK</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Integer id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/payment/hystrix/timeout/{id}"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">paymentInfo_Timeout</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Integer id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ç¼–å†™è¿™ä¸ªç±»ï¼Œå®ƒä¸€å®šè¦å®ç°<code>PaymentHystrixService</code>æ¥å£</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentFallbackService</span> <span class="token keyword">implements</span> <span class="token class-name">PaymentHystrixService</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">paymentInfo_OK</span><span class="token punctuation">(</span>Integer id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"-----PaymentFallbackService fall back paymentInfo_OK"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">paymentInfo_Timeout</span><span class="token punctuation">(</span>Integer id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"-----PaymentFallbackService fall back paymentInfo_Timeout"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="è‡ªå®šä¹‰é…ç½®">2.6 è‡ªå®šä¹‰é…ç½®</h2><p>å‚è€ƒï¼š</p><p><a href="https://www.cnblogs.com/yinjihuan/p/10940403.html" target="_blank" rel="noopener">Hystrix è¶…æ—¶é…ç½®çš„Nç§ç©æ³• - çŒ¿å¤©åœ° - åšå®¢å›­</a></p><p><a href="http://www.imooc.com/article/76515" target="_blank" rel="noopener">Hystrix é…ç½®å‚æ•°å…¨è§£æ_æ…•è¯¾æ‰‹è®°</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Hystrixæ¦‚è¿°&quot;&gt;1 Hystrixæ¦‚è¿°&lt;/h1&gt;&lt;h2 id=&quot;æœåŠ¡é›ªå´©&quot;&gt;1.1 æœåŠ¡é›ªå´©&lt;/h2&gt;&lt;p&gt;å¤šä¸ªå¾®æœåŠ¡ä¹‹é—´è°ƒç”¨çš„æ—¶å€™ï¼Œå‡è®¾å¾®æœåŠ¡Aè°ƒç”¨å¾®æœåŠ¡Bå’Œå¾®æœåŠ¡C,å¾®æœåŠ¡Bå’Œå¾®æœåŠ¡Cåˆè°ƒç”¨å…¶å®ƒçš„å¾®æœåŠ¡ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€æ‰‡å‡ºâ€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;stron
      
    
    </summary>
    
    
      <category term="ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶" scheme="https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="å¾®æœåŠ¡" scheme="https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="Hystrix" scheme="https://www.codetool.top/tags/Hystrix/"/>
    
  </entry>
  
  <entry>
    <title>æ›´ä¼˜é›…çš„æœåŠ¡è°ƒç”¨-OpenFeignç®€å•ä½¿ç”¨</title>
    <link href="https://www.codetool.top/article/%E6%9B%B4%E4%BC%98%E9%9B%85%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8-openFeign%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <id>https://www.codetool.top/article/æ›´ä¼˜é›…çš„æœåŠ¡è°ƒç”¨-openFeignç®€å•ä½¿ç”¨/</id>
    <published>2020-03-21T07:50:59.000Z</published>
    <updated>2020-03-21T07:51:59.299Z</updated>
    
    <content type="html"><![CDATA[<h1 id="OpenFeignæ¦‚è¿°">1 OpenFeignæ¦‚è¿°</h1><p>Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼WebServiceå®¢æˆ·ç«¯ã€‚ ä½¿ç”¨Feignèƒ½è®©ç¼–å†™Web Serviceå®¢æˆ·ç«¯æ›´åŠ ç®€å•ã€‚å®ƒçš„ä½¿ç”¨æ–¹æ³•æ˜¯å®šä¹‰ä¸€ä¸ªæœåŠ¡æ¥å£ç„¶ååœ¨ä¸Šé¢æ·»åŠ æ³¨è§£ã€‚Feignä¹Ÿæ”¯æŒå¯æ‹”æ’å¼çš„ç¼–ç å™¨å’Œè§£ç å™¨ã€‚</p><p>Spring Cloudå¯¹Feignè¿›è¡Œäº†å°è£…ï¼Œä½¿å…¶æ”¯æŒäº†Spring MVCæ ‡å‡†æ³¨è§£å’Œ<code>HttpMessageConverters</code>ã€‚ Feignå¯ä»¥ä¸Eurekaå’ŒRibbonç»„åˆä½¿ç”¨ä»¥æ”¯æŒè´Ÿè½½å‡è¡¡ã€‚</p><h2 id="Feignèƒ½å¹²ä»€ä¹ˆ">1.1 Feignèƒ½å¹²ä»€ä¹ˆ</h2><p>Feignæ—¨åœ¨ä½¿ç¼–å†™Java Httpå®¢æˆ·ç«¯å˜å¾—æ›´å®¹æ˜“ã€‚</p><p>å‰é¢åœ¨ä½¿ç”¨<code>Ribbon+RestTemplate</code>æ—¶ï¼Œåˆ©ç”¨<code>RestTemplate</code>å¯¹httpè¯·æ±‚çš„å°è£…å¤„ç†ï¼Œå½¢æˆäº†ä¸€å¥—æ¨¡ç‰ˆåŒ–çš„è°ƒç”¨æ–¹æ³•ã€‚ä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­ï¼Œç”±äºå¯¹æœåŠ¡ä¾èµ–çš„è°ƒç”¨å¯èƒ½ä¸æ­¢ä¸€å¤„ï¼Œå¾€å¾€ä¸€ä¸ªæ¥å£ä¼šè¢«å¤šå¤„è°ƒç”¨ï¼Œ æ‰€ä»¥é€šå¸¸éƒ½ä¼šé’ˆå¯¹æ¯ä¸ªå¾®æœåŠ¡è‡ªè¡Œå°è£…ä¸€äº›å®¢æˆ·ç«¯ç±»æ¥åŒ…è£…è¿™äº›ä¾èµ–æœåŠ¡çš„è°ƒç”¨ã€‚æ‰€ä»¥ï¼ŒFeignåœ¨æ­¤åŸºç¡€ä¸Šåšäº†è¿›ä¸€æ­¥å°è£…ï¼Œ ç”±å®ƒæ¥å¸®åŠ©æˆ‘ä»¬å®šä¹‰å’Œå®ç°ä¾èµ–æœåŠ¡æ¥å£çš„å®šä¹‰ã€‚åœ¨Feignçš„å®ç°ä¸‹ï¼Œæˆ‘ä»¬åªéœ€åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶ä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ¥é…ç½®å®ƒ(ä»¥å‰æ˜¯Daoæ¥å£ä¸Šé¢æ ‡æ³¨Mapperæ³¨è§£,ç°åœ¨æ˜¯ä¸€ä¸ªå¾®æœåŠ¡æ¥å£ä¸Šé¢æ ‡æ³¨ä¸€ä¸ªFeignæ³¨è§£å³å¯ï¼Œå³å¯å®Œæˆå¯¹æœåŠ¡æä¾›æ–¹çš„æ¥å£ç»‘å®š,ç®€åŒ–äº†ä½¿ç”¨Spring cloud Ribbonæ—¶ï¼Œè‡ªåŠ¨å°è£…æœåŠ¡è°ƒç”¨å®¢æˆ·ç«¯çš„å¼€å‘é‡ã€‚</p><p>Feigné›†æˆäº†Ribbonï¼Œåˆ©ç”¨Ribbonç»´æŠ¤äº†Paymentçš„æœåŠ¡åˆ—è¡¨ä¿¡æ¯,å¹¶ä¸”é€šè¿‡è½®è¯¢å®ç°äº†å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡ã€‚è€Œä¸Ribbonä¸åŒçš„æ˜¯ï¼Œ é€šè¿‡feignåªéœ€è¦å®šä¹‰æœåŠ¡ç»‘å®šæ¥å£ä¸”ä»¥å£°æ˜å¼çš„æ–¹æ³•ï¼Œä¼˜é›…è€Œç®€å•çš„å®ç°äº†æœåŠ¡è°ƒç”¨</p><h2 id="Feignå’ŒOpenFeignçš„åŒºåˆ«">1.2 Feignå’ŒOpenFeignçš„åŒºåˆ«</h2><p>Feign</p><p>Feignæ˜¯Spring Cloudç»„ä»¶ä¸­çš„ä¸€ä¸ªè½»é‡çº§RESTfulçš„HTTPæœåŠ¡å®¢æˆ·ç«¯ã€‚<strong>Feignå†…ç½®äº†Ribbonï¼Œç”¨æ¥åšå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡</strong>ï¼Œå»è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ã€‚Feignçš„ä½¿ç”¨æ–¹å¼æ˜¯ï¼šä½¿ç”¨Feignçš„æ³¨è§£å®šä¹‰æ¥å£ï¼Œè°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå°±å¯ä»¥è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡</p><p>OpenFeign</p><p>OpenFeignæ˜¯Spring Cloudåœ¨Feignçš„åŸºç¡€ä¸Šæ”¯æŒäº†SpringMVCçš„æ³¨è§£ï¼Œå¦‚<code>@RequesMapping</code>ç­‰ç­‰ã€‚OpenFeignçš„<code>@FeignClient</code>å¯ä»¥è§£æSpringMVCçš„<code>@RequestMapping</code>æ³¨è§£ä¸‹çš„æ¥å£ï¼Œå¹¶é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼äº§ç”Ÿå®ç°ç±»,å®ç°ç±»ä¸­åšè´Ÿè½½å‡è¡¡å¹¶è°ƒç”¨å…¶ä»–æœåŠ¡ã€‚</p><h1 id="OpenFeignçš„ä½¿ç”¨">2 OpenFeignçš„ä½¿ç”¨</h1><p>æ–°å»ºè°ƒç”¨æ–¹æ¨¡å—<code>cloud-consumer-feign-order80</code>ï¼Œä¾èµ–ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--openfeign--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--eureka client--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.rhett<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--ç›‘æ§--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>yamlé…ç½®ï¼šï¼ˆä¸éœ€è¦é¢å¤–é…ç½®openfeignï¼‰</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span><span class="token key atrule">eureka</span><span class="token punctuation">:</span>  <span class="token key atrule">client</span><span class="token punctuation">:</span>    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka7001.com<span class="token punctuation">:</span>7001/eureka<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka7002.com<span class="token punctuation">:</span>7002/eureka <span class="token comment" spellcheck="true">#é›†ç¾¤ç‰ˆ</span></code></pre><p>å¯åŠ¨ç±»ï¼šæ·»åŠ <code>@EnableFeignClients</code>æ³¨è§£</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableFeignClients</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderFeignMain80</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>OrderFeignMain80<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ç¼–å†™ä¸€ä¸ªæœåŠ¡æ¥å£ï¼Œå®ƒä»£è¡¨è°ƒç”¨ä¸€ä¸ªè¿œç¨‹å¾®æœåŠ¡çš„è·å–ç»“æœï¼Œ<code>@FeignClient(&quot;CLOUD-PAYMENT-SERVICE&quot;)</code>ä¸ºæœåŠ¡å</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span><span class="token string">"CLOUD-PAYMENT-SERVICE"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PaymentFeignService</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/payment/{id}"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> CommonResult<span class="token operator">&lt;</span>Payment<span class="token operator">></span> <span class="token function">getPaymentById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Long id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ç¼–å†™controllerï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æ³¨å…¥çš„PaymentFeignServiceè°ƒç”¨æ¥å£æ–¹æ³•ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderFeignController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> PaymentFeignService paymentFeignService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"/consumer/payment/{id}"</span><span class="token punctuation">,</span>produces <span class="token operator">=</span> <span class="token string">"application/json"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> CommonResult<span class="token operator">&lt;</span>Payment<span class="token operator">></span> <span class="token function">getPaymentById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Long id<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> paymentFeignService<span class="token punctuation">.</span><span class="token function">getPaymentById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h1 id="è¶…æ—¶æ§åˆ¶">3 è¶…æ—¶æ§åˆ¶</h1><p>OpenFeign ribbonå¦‚æœåœ¨è°ƒç”¨è¿œç¨‹å¾®æœåŠ¡ç­‰å¾…è¶…è¿‡ä¸€å®šæ—¶é—´ä¼šæŠ¥Timeouté”™è¯¯è€Œä¸ä¼šç»§ç»­ç­‰å¾…æœåŠ¡è°ƒç”¨å®Œæˆï¼Œè¿™ä¸ªè¶…æ—¶æ—¶é—´é»˜è®¤ä¸º1sã€‚</p><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æµ‹è¯•ï¼š</p><p>æœåŠ¡æä¾›æ–¹</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/payment/feign/timeout"</span><span class="token punctuation">)</span><span class="token keyword">public</span> String <span class="token function">paymentFeignTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> serverPort<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>feignClientæœåŠ¡æ¥å£</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span><span class="token string">"CLOUD-PAYMENT-SERVICE"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PaymentFeignService</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/payment/{id}"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> CommonResult<span class="token operator">&lt;</span>Payment<span class="token operator">></span> <span class="token function">getPaymentById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Long id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/payment/feign/timeout"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">paymentFeignTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>controllerè°ƒç”¨ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderFeignController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> PaymentFeignService paymentFeignService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"/consumer/payment/{id}"</span><span class="token punctuation">,</span>produces <span class="token operator">=</span> <span class="token string">"application/json"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> CommonResult<span class="token operator">&lt;</span>Payment<span class="token operator">></span> <span class="token function">getPaymentById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Long id<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> paymentFeignService<span class="token punctuation">.</span><span class="token function">getPaymentById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//openfeignå®¢æˆ·ç«¯ä¸€èˆ¬é»˜è®¤ç­‰å¾…ä¸€ç§’é’Ÿ,æ­¤å¤„è¶…æ—¶</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/consumer/payment/feign/timeout"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">paymentFeignTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> paymentFeignService<span class="token punctuation">.</span><span class="token function">paymentFeignTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>åœ¨è®¿é—® <a href="http://localhost/consumer/payment/feign/timeout" target="_blank" rel="noopener">http://localhost/consumer/payment/feign/timeout</a> çš„æ—¶å€™å¯ä»¥çœ‹åˆ°è¶…æ—¶é”™è¯¯ï¼š</p><pre><code>There was an unexpected error (type=Internal Server Error, status=500).connect timed out executing GET http://CLOUD-PAYMENT-SERVICE/payment/feign/timeoutfeign.RetryableException: connect timed out executing GET http://CLOUD-PAYMENT-SERVICE/payment/feign/timeout...</code></pre><p>å¦‚æœéœ€è¦ä¿®æ”¹é»˜è®¤çš„è¶…æ—¶æ—¶é—´ï¼Œåœ¨yamlé…ç½®ä¸­ä¿®æ”¹å¦‚ä¸‹ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">ribbon</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´</span>    <span class="token key atrule">ReadTimeout</span><span class="token punctuation">:</span> <span class="token number">5000</span>    <span class="token comment" spellcheck="true"># æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´</span>    <span class="token key atrule">ConnectTimeout</span><span class="token punctuation">:</span> <span class="token number">5000</span></code></pre><h1 id="æ—¥å¿—å¢å¼º">4 æ—¥å¿—å¢å¼º</h1><p>æ—¥å¿—çº§åˆ«</p><ul><li>NONE: é»˜è®¤çš„ï¼Œä¸æ˜¾ç¤ºä»»ä½•æ—¥å¿—</li><li>BASIC: ä»…è®°å½•è¯·æ±‚æ–¹æ³•ã€URLã€å“åº”çŠ¶æ€ç åŠæ‰§è¡Œæ—¶é—´</li><li>HEADERS: é™¤äº†BASICä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯</li><li>FULL: é™¤äº†HEADERSä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„æ­£æ–‡åŠå…ƒæ•°æ®</li></ul><h2 id="å¦‚ä½•é…ç½®">4.1 å¦‚ä½•é…ç½®</h2><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FeignConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    Logger<span class="token punctuation">.</span>Level <span class="token function">feignLoggerLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> Logger<span class="token punctuation">.</span>Level<span class="token punctuation">.</span>FULL<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¿˜éœ€è¦åœ¨yamlä¸­é…ç½®ï¼ŒæŒ‡å®šfeignè°ƒç”¨çš„æ¥å£ï¼Œè¿™é‡Œçš„debugæ˜¯slf4jå±‚é¢çš„debugï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">logging</span><span class="token punctuation">:</span>  <span class="token key atrule">level</span><span class="token punctuation">:</span>    <span class="token key atrule">com.rhett.springcloud.service.PaymentFeignService</span><span class="token punctuation">:</span> debug</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;OpenFeignæ¦‚è¿°&quot;&gt;1 OpenFeignæ¦‚è¿°&lt;/h1&gt;&lt;p&gt;Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼WebServiceå®¢æˆ·ç«¯ã€‚ ä½¿ç”¨Feignèƒ½è®©ç¼–å†™Web Serviceå®¢æˆ·ç«¯æ›´åŠ ç®€å•ã€‚å®ƒçš„ä½¿ç”¨æ–¹æ³•æ˜¯å®šä¹‰ä¸€ä¸ªæœåŠ¡æ¥å£ç„¶ååœ¨ä¸Šé¢æ·»åŠ æ³¨è§£ã€‚Feignä¹Ÿæ”¯æŒå¯æ‹”æ’å¼çš„ç¼–ç å™¨å’Œ
      
    
    </summary>
    
    
      <category term="ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶" scheme="https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="å¾®æœåŠ¡" scheme="https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="OpenFeign" scheme="https://www.codetool.top/tags/OpenFeign/"/>
    
  </entry>
  
  <entry>
    <title>è´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨-Ribbonç®€å•ä½¿ç”¨</title>
    <link href="https://www.codetool.top/article/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8-Ribbon%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <id>https://www.codetool.top/article/è´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨-Ribbonç®€å•ä½¿ç”¨/</id>
    <published>2020-03-21T02:53:46.000Z</published>
    <updated>2020-03-21T02:56:03.653Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚è¿°">1 æ¦‚è¿°</h1><p>Spring Cloud Ribbonæ˜¯åŸºäºNetlix Ribbonå®ç°çš„ä¸€å¥—å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„å·¥å…·ã€‚</p><p>Ribbonæ˜¯Netflixå‘å¸ƒçš„å¼€æºé¡¹ç›®ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æä¾›å®¢æˆ·ç«¯çš„è½¯ä»¶è´Ÿè½½å‡è¡¡ç®—æ³•å’ŒæœåŠ¡è°ƒç”¨ã€‚Ribbonå®¢æˆ·ç«¯ç»„ä»¶æä¾›ä¸€ç³»åˆ—å®Œå–„çš„é…ç½®é¡¹å¦‚è¿æ¥è¶…æ—¶ï¼Œé‡è¯•ç­‰ã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­åˆ—å‡ºLoad Balancer (ç®€ç§°LB)åé¢æ‰€æœ‰çš„æœºå™¨ï¼ŒRibbonä¼šè‡ªåŠ¨çš„å¸®åŠ©ä½ åŸºäºæŸç§è§„åˆ™(å¦‚ç®€å•è½®è¯¢,éšæœºè¿æ¥ç­‰)å»è¿æ¥è¿™äº›æœºå™¨ã€‚æˆ‘ä»¬å¾ˆå®¹æ˜“ä½¿ç”¨Ribbonå®ç°è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚</p><h2 id="ribbonè´Ÿè½½å‡è¡¡å’ŒNginxè´Ÿè½½å‡è¡¡çš„åŒºåˆ«">1.1 ribbonè´Ÿè½½å‡è¡¡å’ŒNginxè´Ÿè½½å‡è¡¡çš„åŒºåˆ«</h2><p>Nginxæ˜¯æœåŠ¡å™¨è´Ÿè½½å‡è¡¡;å®¢æˆ·ç«¯æ‰€æœ‰è¯·æ±‚éƒ½ä¼šäº¤ç»™nginx,ç„¶åç”±nginxå®ç°è½¬å‘è¯·æ±‚ã€‚å³è´Ÿè½½å‡è¡¡æ˜¯ç”±æœåŠ¡ç«¯å®ç°çš„ã€‚</p><p>Ribbonæœ¬åœ°è´Ÿè½½å‡è¡¡ï¼Œåœ¨è°ƒç”¨å¾®æœåŠ¡æ¥å£æ—¶å€™ï¼Œä¼šåœ¨æ³¨å†Œä¸­å¿ƒä¸Šè·å–æ³¨å†Œä¿¡æ¯æœåŠ¡åˆ—è¡¨ä¹‹åç¼“å­˜åˆ°JVMæœ¬åœ°,ä»è€Œåœ¨æœ¬åœ°å®ç°RPCè¿œç¨‹æœåŠ¡è°ƒç”¨æŠ€æœ¯ã€‚</p><h2 id="é›†ä¸­å¼è´Ÿè½½å‡è¡¡å’Œè¿›ç¨‹å†…è´Ÿè½½å‡è¡¡">1.2 é›†ä¸­å¼è´Ÿè½½å‡è¡¡å’Œè¿›ç¨‹å†…è´Ÿè½½å‡è¡¡</h2><h3 id="é›†ä¸­å¼LB">1.2.1 é›†ä¸­å¼LB</h3><p>å³åœ¨æœåŠ¡çš„æ¶ˆè´¹æ–¹å’Œæä¾›æ–¹ä¹‹é—´ä½¿ç”¨ç‹¬ç«‹çš„LBè®¾æ–½ï¼ˆå¯ä»¥æ˜¯ç¡¬ä»¶ï¼Œå¦‚F5, ä¹Ÿå¯ä»¥æ˜¯è½¯ä»¶ï¼Œå¦‚nginxï¼‰, ç”±è¯¥è®¾æ–½è´Ÿè´£æŠŠè®¿é—®è¯·æ±‚é€šè¿‡æŸç§ç­–ç•¥è½¬å‘è‡³æœåŠ¡çš„æä¾›æ–¹ã€‚</p><h3 id="è¿›ç¨‹å†…LB">1.2.2 è¿›ç¨‹å†…LB</h3><p>å°†LBé€»è¾‘é›†æˆåˆ°æ¶ˆè´¹æ–¹ï¼Œæ¶ˆè´¹æ–¹ä»æœåŠ¡æ³¨å†Œä¸­å¿ƒè·çŸ¥æœ‰å“ªäº›åœ°å€å¯ç”¨ï¼Œç„¶åè‡ªå·±å†ä»è¿™äº›åœ°å€ä¸­é€‰æ‹©å‡ºä¸€ä¸ªåˆé€‚çš„æœåŠ¡å™¨ã€‚</p><p>Ribbonå°±å±äºè¿›ç¨‹å†…LBï¼Œå®ƒåªæ˜¯ä¸€ä¸ªåº“ï¼Œé›†æˆäºæ¶ˆè´¹æ–¹è¿›ç¨‹ï¼Œæ¶ˆè´¹æ–¹é€šè¿‡å®ƒæ¥è·å–åˆ°æœåŠ¡æä¾›æ–¹çš„åœ°å€ã€‚</p><h1 id="ä½¿ç”¨">2 ä½¿ç”¨</h1><p>Eureka Clientæœ¬èº«é›†æˆäº†Ribbonï¼Œä¹‹å‰åœ¨<a href="../æœåŠ¡æ³¨å†Œä¸å‘ç°-Eurekaæ¦‚è¿°ä¸ç®€å•ä½¿ç”¨">æœåŠ¡æ³¨å†Œä¸å‘ç°-Eurekaæ¦‚è¿°ä¸ç®€å•ä½¿ç”¨</a>ä¸­çš„å®ä¾‹å°±ç”¨åˆ°äº†ribbonçš„èƒ½åŠ›</p><p>Ribbonåœ¨å·¥ä½œæ—¶åˆ†æˆä¸¤æ­¥</p><p>ç¬¬ä¸€æ­¥å…ˆé€‰æ‹©Eureka Server ,å®ƒä¼˜å…ˆé€‰æ‹©åœ¨åŒä¸€ä¸ªåŒºåŸŸå†…è´Ÿè½½è¾ƒå°‘çš„server.</p><p>ç¬¬äºŒæ­¥å†æ ¹æ®ç”¨æˆ·æŒ‡å®šçš„ç­–ç•¥ï¼Œåœ¨ä»serverå–åˆ°çš„æœåŠ¡æ³¨å†Œåˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªåœ°å€ã€‚</p><p>å…¶ä¸­Ribbonæä¾›äº†å¤šç§ç­–ç•¥:æ¯”å¦‚è½®è¯¢ã€éšæœºå’Œæ ¹æ®å“åº”æ—¶é—´åŠ æƒã€‚</p><p>ä¾èµ–ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-ribbon<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>ä½¿ç”¨<code>@LoadBalance</code>å¾—åˆ°RestTemplate</p><h2 id="è´Ÿè½½å‡è¡¡ç®—æ³•æ¥å£IRule">2.1 è´Ÿè½½å‡è¡¡ç®—æ³•æ¥å£IRule</h2><p><img src="https://api.codetool.top/img/15847549222019.png" alt></p><ul><li>RoundRobinRule è½®è¯¢ï¼ˆé»˜è®¤ï¼‰</li><li>RandomRule éšæœº</li><li>RetryRule å…ˆæŒ‰ç…§RoundRobinRuleçš„ç­–ç•¥è·å–æœåŠ¡ï¼Œå¦‚æœæœåŠ¡å¤±è´¥åˆ™åœ¨æŒ‡å®šæ—¶é—´å†…é‡è¯•ï¼Œè·å–å¯ç”¨çš„æœåŠ¡</li><li>WeightedResponseTimeRule å¯¹RoundRobinRuleçš„æ‹“å±•ï¼Œå“åº”é€Ÿåº¦è¶Šå¿«çš„å®ä¾‹é€‰æ‹©æƒé‡è¶Šå¤§ï¼Œè¶Šå®¹æ˜“è¢«é€‰æ‹©</li><li>BestAvailableRule ä¼šå…ˆè¿‡æ»¤æ‰ç”±äºå¤šæ¬¡è®¿é—®æ•…éšœè€Œå¤„äºæ–­è·¯å™¨è·³é—¸çŠ¶æ€çš„æœåŠ¡ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªå¹¶å‘é‡æœ€å°çš„æœåŠ¡</li><li>AvailabilityFiltering ä¼šå…ˆè¿‡æ»¤æ‰æ•…éšœå®ä¾‹ï¼Œå†é€‰æ‹©å¹¶å‘é‡è¾ƒå°çš„å®ä¾‹</li><li>ZoneAvoidanceRule ç¬¦åˆåˆ¤æ–­serveræ‰€åœ¨åŒºåŸŸçš„æ€§èƒ½å’Œserverçš„å¯ç”¨æ€§é€‰æ‹©æœåŠ¡å™¨ </li></ul><p>ä½¿ç”¨ä¸åŒçš„ç®—æ³•ï¼šè‡ªå®šä¹‰IRuleæ³¨å…¥</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyselfRule</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> IRule <span class="token function">myRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RandomRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å¹¶ä½¿ç”¨<code>@RibbonClient</code>æŒ‡å®šé…ç½®ç±»ï¼Œè¿™ä¸ªè‡ªå®šä¹‰é…ç½®ç±»ä¸èƒ½æ”¾åœ¨<code>@ComponentScan</code>æ‰€æ‰«æçš„å½“å‰åŒ…ä¸‹ä»¥åŠå­åŒ…ä¸‹ï¼Œå¦åˆ™æˆ‘ä»¬è‡ªå®šä¹‰çš„è¿™ä¸ªé…ç½®ç±»å°±ä¼šè¢«æ‰€æœ‰çš„Ribbonå®¢æˆ·ç«¯æ‰€å…±äº«,è¾¾ä¸åˆ°ç‰¹æ®ŠåŒ–å®šåˆ¶çš„ç›®çš„äº†ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableEurekaClient</span><span class="token annotation punctuation">@RibbonClient</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"CLOUD-PAYMENT-SERVICE"</span><span class="token punctuation">,</span>configuration <span class="token operator">=</span> MyselfRule<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderMain80</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>OrderMain80<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="RoundRobinRuleæºç ">2.2 RoundRobinRuleæºç </h2><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RoundRobinRule</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractLoadBalancerRule</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> AtomicInteger nextServerCyclicCounter<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> AVAILABLE_ONLY_SERVERS <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> ALL_SERVERS <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> Logger log <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>RoundRobinRule<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">RoundRobinRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        nextServerCyclicCounter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token function">RoundRobinRule</span><span class="token punctuation">(</span>ILoadBalancer lb<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">setLoadBalancer</span><span class="token punctuation">(</span>lb<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> Server <span class="token function">choose</span><span class="token punctuation">(</span>ILoadBalancer lb<span class="token punctuation">,</span> Object key<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>lb <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"no load balancer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> null<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        Server server <span class="token operator">=</span> null<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//</span>        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>server <span class="token operator">==</span> null <span class="token operator">&amp;&amp;</span> count<span class="token operator">++</span> <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//é€šè¿‡LoadBalancerè·å–å¯ç”¨çš„æœåŠ¡å™¨</span>            List<span class="token operator">&lt;</span>Server<span class="token operator">></span> reachableServers <span class="token operator">=</span> lb<span class="token punctuation">.</span><span class="token function">getReachableServers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//é€šè¿‡LoadBalancerè·å–æ‰€æœ‰æœåŠ¡å™¨</span>            List<span class="token operator">&lt;</span>Server<span class="token operator">></span> allServers <span class="token operator">=</span> lb<span class="token punctuation">.</span><span class="token function">getAllServers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> upCount <span class="token operator">=</span> reachableServers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> serverCount <span class="token operator">=</span> allServers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>upCount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>serverCount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"No up servers available from load balancer: "</span> <span class="token operator">+</span> lb<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> null<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">//è·å–ä¸‹ä¸€ä¸ªè¦å–çš„æœåŠ¡å™¨ä¸‹æ ‡</span>            <span class="token keyword">int</span> nextServerIndex <span class="token operator">=</span> <span class="token function">incrementAndGetModulo</span><span class="token punctuation">(</span>serverCount<span class="token punctuation">)</span><span class="token punctuation">;</span>            server <span class="token operator">=</span> allServers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>nextServerIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>server <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">/* Transient. */</span>                Thread<span class="token punctuation">.</span><span class="token function">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>server<span class="token punctuation">.</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>server<span class="token punctuation">.</span><span class="token function">isReadyToServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// Next.</span>            server <span class="token operator">=</span> null<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">>=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"No available alive servers after 10 tries from load balancer: "</span>                    <span class="token operator">+</span> lb<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> server<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//CASæ”¹å˜ä¸‹ä¸€æ¬¡çš„ä¸‹æ ‡</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">incrementAndGetModulo</span><span class="token punctuation">(</span><span class="token keyword">int</span> modulo<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> current <span class="token operator">=</span> nextServerCyclicCounter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> next <span class="token operator">=</span> <span class="token punctuation">(</span>current <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> modulo<span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>nextServerCyclicCounter<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> next<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Server <span class="token function">choose</span><span class="token punctuation">(</span>Object key<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">choose</span><span class="token punctuation">(</span><span class="token function">getLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initWithNiwsConfig</span><span class="token punctuation">(</span>IClientConfig clientConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h1 id="ä¸ä½¿ç”¨ribbonå®ç°ä¸€ä¸ªè‡ªå®šä¹‰è´Ÿè½½å‡è¡¡">3 ä¸ä½¿ç”¨ribbonå®ç°ä¸€ä¸ªè‡ªå®šä¹‰è´Ÿè½½å‡è¡¡</h1><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">LoadBalancer</span> <span class="token punctuation">{</span>    ServiceInstance <span class="token function">chooseInstance</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>ServiceInstance<span class="token operator">></span> serviceInstances<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">myLB</span> <span class="token keyword">implements</span> <span class="token class-name">LoadBalancer</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> AtomicInteger atomicInteger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">int</span> current<span class="token punctuation">;</span>        <span class="token keyword">int</span> next<span class="token punctuation">;</span>        <span class="token keyword">do</span><span class="token punctuation">{</span>            current <span class="token operator">=</span> atomicInteger<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            next <span class="token operator">=</span> current <span class="token operator">==</span> Integer<span class="token punctuation">.</span>MAX_VALUE<span class="token operator">?</span><span class="token number">0</span><span class="token operator">:</span>current<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>atomicInteger<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"*******next: "</span><span class="token operator">+</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> next<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> ServiceInstance <span class="token function">chooseInstance</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>ServiceInstance<span class="token operator">></span> serviceInstances<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span>serviceInstances<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> serviceInstances<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>controllerï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> LoadBalancer loadBalancer<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> RestTemplate restTemplate<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ç¦ç”¨æ‰@loadbalance</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> DiscoveryClient discoveryClient<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/consumer/payment/lb"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">getPaymentLB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        List<span class="token operator">&lt;</span>ServiceInstance<span class="token operator">></span> instances <span class="token operator">=</span> discoveryClient<span class="token punctuation">.</span><span class="token function">getInstances</span><span class="token punctuation">(</span><span class="token string">"CLOUD-PAYMENT-SERVICE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>instances <span class="token operator">==</span> null <span class="token operator">||</span> instances<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> null<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        ServiceInstance serviceInstance <span class="token operator">=</span> loadBalancer<span class="token punctuation">.</span><span class="token function">chooseInstance</span><span class="token punctuation">(</span>instances<span class="token punctuation">)</span><span class="token punctuation">;</span>        URI uri <span class="token operator">=</span> serviceInstance<span class="token punctuation">.</span><span class="token function">getUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>uri<span class="token operator">+</span><span class="token string">"/payment/lb"</span><span class="token punctuation">,</span>String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;æ¦‚è¿°&quot;&gt;1 æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;Spring Cloud Ribbonæ˜¯åŸºäºNetlix Ribbonå®ç°çš„ä¸€å¥—å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;Ribbonæ˜¯Netflixå‘å¸ƒçš„å¼€æºé¡¹ç›®ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æä¾›å®¢æˆ·ç«¯çš„è½¯ä»¶è´Ÿè½½å‡è¡¡ç®—æ³•å’ŒæœåŠ¡è°ƒç”¨ã€‚Ribbonå®¢æˆ·ç«¯ç»„
      
    
    </summary>
    
    
      <category term="ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶" scheme="https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="å¾®æœåŠ¡" scheme="https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="Ribbon" scheme="https://www.codetool.top/tags/Ribbon/"/>
    
  </entry>
  
  <entry>
    <title>leetcode365-æ°´å£¶é—®é¢˜</title>
    <link href="https://www.codetool.top/article/leetcode365-%E6%B0%B4%E5%A3%B6%E9%97%AE%E9%A2%98/"/>
    <id>https://www.codetool.top/article/leetcode365-æ°´å£¶é—®é¢˜/</id>
    <published>2020-03-21T00:57:47.000Z</published>
    <updated>2020-03-22T13:57:29.616Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åŸé¢˜">1 åŸé¢˜</h1><p>æœ‰ä¸¤ä¸ªå®¹é‡åˆ†åˆ«ä¸º xå‡ å’Œ yå‡ çš„æ°´å£¶ä»¥åŠæ— é™å¤šçš„æ°´ã€‚è¯·åˆ¤æ–­èƒ½å¦é€šè¿‡ä½¿ç”¨è¿™ä¸¤ä¸ªæ°´å£¶ï¼Œä»è€Œå¯ä»¥å¾—åˆ°æ°å¥½ zå‡ çš„æ°´ï¼Ÿ</p><p>å¦‚æœå¯ä»¥ï¼Œæœ€åè¯·ç”¨ä»¥ä¸Šæ°´å£¶ä¸­çš„ä¸€æˆ–ä¸¤ä¸ªæ¥ç››æ”¾å–å¾—çš„ zå‡ æ°´ã€‚</p><p>ä½ å…è®¸ï¼š</p><ul><li>è£…æ»¡ä»»æ„ä¸€ä¸ªæ°´å£¶</li><li>æ¸…ç©ºä»»æ„ä¸€ä¸ªæ°´å£¶</li><li>ä»ä¸€ä¸ªæ°´å£¶å‘å¦å¤–ä¸€ä¸ªæ°´å£¶å€’æ°´ï¼Œç›´åˆ°è£…æ»¡æˆ–è€…å€’ç©º</li></ul><p><strong>ç¤ºä¾‹ 1:</strong>(From the famous â€œDie Hardâ€ example)</p><blockquote><p>è¾“å…¥: x = 3, y = 5, z = 4<br>è¾“å‡º: True</p></blockquote><p><strong>ç¤ºä¾‹ 2:</strong></p><blockquote><p>è¾“å…¥: x = 2, y = 6, z = 5<br>è¾“å‡º: False</p></blockquote><h1 id="è§£æ³•">2 è§£æ³•</h1><h2 id="æ€æƒ³">2.1 æ€æƒ³</h2><h3 id="DFS-BFS">2.1.1 DFS/BFS</h3><p>åœ¨ä»»æ„ä¸€ä¸ªæ—¶åˆ»ï¼Œæˆ‘ä»¬å¯ä»¥ä¸”ä»…å¯ä»¥é‡‡å–ä»¥ä¸‹å‡ ç§æ“ä½œï¼š</p><ul><li>æŠŠ X å£¶çš„æ°´çŒè¿› Y å£¶ï¼Œç›´è‡³çŒæ»¡æˆ–å€’ç©ºï¼›</li><li>æŠŠ Y å£¶çš„æ°´çŒè¿› X å£¶ï¼Œç›´è‡³çŒæ»¡æˆ–å€’ç©ºï¼›</li><li>æŠŠ X å£¶çŒæ»¡ï¼›</li><li>æŠŠ Y å£¶çŒæ»¡ï¼›</li><li>æŠŠ X å£¶å€’ç©ºï¼›</li><li>æŠŠ Y å£¶å€’ç©ºã€‚</li></ul><p>å¯ä»¥ä½¿ç”¨BFSæˆ–DFSï¼Œç„¶è€ŒJavaæ²¡æœ‰ç±»ä¼¼Pairçš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥è‡ªå·±å†™ä¸€ä¸ªç±»å‡ºæ¥ã€‚</p><h3 id="æ•°å­¦">2.1.2 æ•°å­¦</h3><p>å¦ä¸€ä¸ªæ–¹æ³•æ˜¯æ•°å­¦å®šç† <a href="https://baike.baidu.com/item/%E8%A3%B4%E8%9C%80%E5%AE%9A%E7%90%86/5186593" target="_blank" rel="noopener">è£´èœ€å®šç†_ç™¾åº¦ç™¾ç§‘</a></p><p>è‹¥ aï¼Œb ä¸ºæ•´æ•°ï¼Œä¸” gcd(a,b) = dï¼Œåˆ™å¯¹äºä»»æ„çš„æ•´æ•°xï¼Œyï¼Œax + byéƒ½ä¸€å®šæ˜¯ d çš„å€æ•°ã€‚ ç‰¹åˆ«åœ°ï¼Œä¸€å®šå­˜åœ¨æ•´æ•° xï¼Œyï¼Œä½¿å¾— ax + by = d æˆç«‹ã€‚ </p><h2 id="ä»£ç ">2.2 ä»£ç </h2><p>BFSï¼ˆæœ‰æ—¶é—´å›æ¥æ”¹å†™ï¼‰</p><pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">canMeasureWater</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> z<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> y <span class="token operator">&lt;</span> z<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> y <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> x <span class="token operator">==</span> z <span class="token operator">||</span> y <span class="token operator">==</span> z<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        Queue<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Integer<span class="token operator">>></span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Set<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Integer<span class="token operator">>></span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> list <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>        set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>queue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> temp <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> cur_x <span class="token operator">=</span> temp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> cur_y <span class="token operator">=</span> temp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>z <span class="token operator">==</span> cur_x <span class="token operator">||</span> z <span class="token operator">==</span> cur_y <span class="token operator">||</span> z <span class="token operator">==</span> cur_x <span class="token operator">+</span> cur_y<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">//1ã€ç»™xåŠ æ»¡æ°´</span>            List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> condition1 <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> cur_y<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>set<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>condition1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>condition1<span class="token punctuation">)</span><span class="token punctuation">;</span>                queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>condition1<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">//2ã€ç»™yåŠ æ»¡æ°´</span>            List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> condition2 <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>cur_x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>set<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>condition2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>condition2<span class="token punctuation">)</span><span class="token punctuation">;</span>                queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>condition2<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">//3ã€æ¸…ç©ºxçš„æ°´</span>            List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> condition3 <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> cur_y<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>set<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>condition3<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>condition3<span class="token punctuation">)</span><span class="token punctuation">;</span>                queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>condition3<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">//4ã€æ¸…ç©ºyçš„æ°´</span>            List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> condition4 <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>cur_x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>set<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>condition4<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>condition4<span class="token punctuation">)</span><span class="token punctuation">;</span>                queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>condition4<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">//5ã€xç»™yå€’æ°´</span>            List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> condition5 <span class="token operator">=</span> <span class="token punctuation">(</span>cur_x <span class="token operator">+</span> cur_y <span class="token operator">>=</span> y<span class="token punctuation">)</span> <span class="token operator">?</span>                    Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>cur_x <span class="token operator">+</span> cur_y <span class="token operator">-</span> y<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">:</span>                    Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> cur_x <span class="token operator">+</span> cur_y<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>set<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>condition5<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>condition5<span class="token punctuation">)</span><span class="token punctuation">;</span>                queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>condition5<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">//6ã€yç»™xå€’æ°´</span>            List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> condition6 <span class="token operator">=</span> <span class="token punctuation">(</span>cur_x <span class="token operator">+</span> cur_y <span class="token operator">>=</span> x<span class="token punctuation">)</span> <span class="token operator">?</span>                    Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> cur_x <span class="token operator">+</span> cur_y <span class="token operator">-</span> x<span class="token punctuation">)</span> <span class="token operator">:</span>                    Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>cur_x <span class="token operator">+</span> cur_y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>set<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>condition6<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>condition6<span class="token punctuation">)</span><span class="token punctuation">;</span>                queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>condition6<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è£´èœ€å®šç†ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">canMeasureWater</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> z<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> y <span class="token operator">&lt;</span> z<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> z <span class="token operator">||</span> y <span class="token operator">==</span> z <span class="token operator">||</span> x <span class="token operator">+</span> y <span class="token operator">==</span> z<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>z <span class="token operator">%</span> <span class="token function">gcd</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">gcd</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span><span class="token keyword">int</span> y<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>y <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> x<span class="token punctuation">;</span>        <span class="token keyword">int</span> r <span class="token operator">=</span> x <span class="token operator">%</span> y<span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">gcd</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;åŸé¢˜&quot;&gt;1 åŸé¢˜&lt;/h1&gt;&lt;p&gt;æœ‰ä¸¤ä¸ªå®¹é‡åˆ†åˆ«ä¸º xå‡ å’Œ yå‡ çš„æ°´å£¶ä»¥åŠæ— é™å¤šçš„æ°´ã€‚è¯·åˆ¤æ–­èƒ½å¦é€šè¿‡ä½¿ç”¨è¿™ä¸¤ä¸ªæ°´å£¶ï¼Œä»è€Œå¯ä»¥å¾—åˆ°æ°å¥½ zå‡ çš„æ°´ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¦‚æœå¯ä»¥ï¼Œæœ€åè¯·ç”¨ä»¥ä¸Šæ°´å£¶ä¸­çš„ä¸€æˆ–ä¸¤ä¸ªæ¥ç››æ”¾å–å¾—çš„ zå‡ æ°´ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å…è®¸ï¼š&lt;/p&gt;
&lt;u
      
    
    </summary>
    
    
      <category term="ç®—æ³•/æ•°æ®ç»“æ„" scheme="https://www.codetool.top/categories/%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
      <category term="leetcode" scheme="https://www.codetool.top/tags/leetcode/"/>
    
      <category term="ç®—æ³•" scheme="https://www.codetool.top/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>æ³¨å†Œä¸­å¿ƒConsulåŸºæœ¬ä½¿ç”¨</title>
    <link href="https://www.codetool.top/article/%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83Consul%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"/>
    <id>https://www.codetool.top/article/æ³¨å†Œä¸­å¿ƒConsulåŸºæœ¬ä½¿ç”¨/</id>
    <published>2020-03-20T15:06:36.000Z</published>
    <updated>2020-03-20T15:07:14.491Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Consulæ¦‚è¿°">1 Consulæ¦‚è¿°</h1><p>Consulæ˜¯ä¸€å¥—å¼€æºçš„åˆ†å¸ƒå¼æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†ç³»ç»Ÿï¼Œç”±HashiCorpå…¬å¸ç”¨Goè¯­è¨€å¼€å‘ã€‚</p><p>æä¾›äº†å¾®æœåŠ¡ç³»ç»Ÿä¸­çš„æœåŠ¡æ²»ç†ã€é…ç½®ä¸­å¿ƒã€æ§åˆ¶æ€»çº¿ç­‰åŠŸèƒ½ã€‚è¿™äº›åŠŸèƒ½ä¸­çš„æ¯ä¸€ä¸ªéƒ½å¯ä»¥æ ¹æ®éœ€è¦å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä¸€èµ·ä½¿ç”¨ä»¥æ„å»ºå…¨æ–¹ä½çš„æœåŠ¡ç½‘æ ¼,æ€»ä¹‹Consulæä¾›äº†ä¸€ç§å®Œæ•´çš„æœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆã€‚</p><p>å®ƒå…·æœ‰å¾ˆå¤šä¼˜ç‚¹ã€‚åŒ…æ‹¬:åŸºäºraftåè®®ï¼Œæ¯”è¾ƒç®€æ´ï¼›æ”¯æŒå¥åº·æ£€æŸ¥ï¼ŒåŒæ—¶æ”¯æŒHTTPå’ŒDNSåè®®ï¼Œæ”¯æŒè·¨æ•°æ®ä¸­å¿ƒçš„WANé›†ç¾¤ï¼Œæä¾›å›¾å½¢ç•Œé¢ï¼Œè·¨å¹³å°ï¼Œæ”¯æŒLinuxã€Macã€ Windows</p><p>ä¸‹è½½åœ°å€ï¼š <a href="https://www.consul.io/downloads.html" target="_blank" rel="noopener">https://www.consul.io/downloads.html</a></p><h1 id="ä½¿ç”¨">2 ä½¿ç”¨</h1><p>ä½¿ç”¨<code>consul agent -dev</code>å¼€å‘æ¨¡å¼å¯åŠ¨ï¼Œå¯åŠ¨æˆåŠŸè®¿é—® <a href="http://localhost:8500/" target="_blank" rel="noopener">http://localhost:8500/</a> åˆ™æœ‰å›¾å½¢åŒ–ç®¡ç†ç•Œé¢</p><h2 id="æœåŠ¡æ³¨å†Œ">2.1 æœåŠ¡æ³¨å†Œ</h2><p>æ–°å»º<code>cloud-providerconsul-payment8006</code>æ¨¡å—ï¼Œä¾èµ–ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--SpringCloud consul-server--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-consul-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.rhett<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>cloud-api-common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>yamlé…ç½®ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8006</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> consul<span class="token punctuation">-</span>provider<span class="token punctuation">-</span>payment<span class="token comment" spellcheck="true"># consul æ³¨å†Œä¸­å¿ƒåœ°å€</span>  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">consul</span><span class="token punctuation">:</span>      <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8500</span>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>        <span class="token key atrule">service-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span></code></pre><p>å¯åŠ¨ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableDiscoveryClient</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentMain8006</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>PaymentMain8006<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>controller:</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${server.port}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String serverPort<span class="token punctuation">;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/payment/consul"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">paymentConsul</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"SpringCloud with Consul: "</span><span class="token operator">+</span>serverPort<span class="token operator">+</span><span class="token string">"\t"</span><span class="token operator">+</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¿è¡Œè¯¥æ¨¡å—ï¼Œå³å¯çœ‹åˆ°æœåŠ¡è¢«æ³¨å†Œåˆ°consulä¸Šäº†</p><h2 id="æœåŠ¡æ¶ˆè´¹">2.2 æœåŠ¡æ¶ˆè´¹</h2><p>æ–°å»º<code>cloud-consumerconsul-order80</code>æ¨¡å—ï¼Œä¾èµ–ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--SpringCloud consul-server--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-consul-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.rhett<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>cloud-api-common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--ç›‘æ§--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--çƒ­éƒ¨ç½²--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>yamlé…ç½®ï¼Œä¹Ÿæ³¨å†Œåˆ°consulä¸Š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>consumer<span class="token punctuation">-</span>order  <span class="token comment" spellcheck="true"># consulæ³¨å†Œä¸­å¿ƒåœ°å€</span>  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">consul</span><span class="token punctuation">:</span>      <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8500</span>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>        <span class="token key atrule">service-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span></code></pre><p>è·å–RestTemplateçš„é…ç½®ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationContextConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token annotation punctuation">@LoadBalanced</span>    <span class="token keyword">public</span> RestTemplate <span class="token function">getRestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å¯åŠ¨ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableDiscoveryClient</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderConsulMain80</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>OrderConsulMain80<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>controllerï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderConsulController</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String INVOKE_URL <span class="token operator">=</span> <span class="token string">"http://consul-provider-payment"</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> RestTemplate restTemplate<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/consumer/payment/consul"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">getPayment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>INVOKE_URL<span class="token operator">+</span><span class="token string">"/payment/consul"</span><span class="token punctuation">,</span>String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ä¿æŒconsulè¿è¡Œï¼Œå¯åŠ¨æœåŠ¡æä¾›æ–¹å’Œæ¶ˆè´¹æ–¹ï¼Œè®¿é—® <a href="http://localhost/consumer/payment/consul" target="_blank" rel="noopener">http://localhost/consumer/payment/consul</a> å°±èƒ½çœ‹åˆ°ç»“æœäº†ã€‚</p><h1 id="ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹">3 ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹</h1><table><thead><tr><th>ç»„ä»¶å</th><th>è¯­è¨€</th><th>CAP</th><th>æœåŠ¡å¥åº·æ£€æŸ¥</th><th>å¯¹å¤–æš´éœ²æ¥å£</th><th>Spring Cloudé›†æˆ</th></tr></thead><tbody><tr><td>Eureka</td><td>Java</td><td>AP</td><td>å¯é…æ”¯æŒ</td><td>HTTP</td><td>å·²é›†æˆ</td></tr><tr><td>Consul</td><td>Go</td><td>CP</td><td>æ”¯æŒ</td><td>HTTP/DNS</td><td>å·²é›†æˆ</td></tr><tr><td>Zookeeper</td><td>Java</td><td>CP</td><td>æ”¯æŒ</td><td>å®¢æˆ·ç«¯</td><td>å·²é›†æˆ</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Consulæ¦‚è¿°&quot;&gt;1 Consulæ¦‚è¿°&lt;/h1&gt;&lt;p&gt;Consulæ˜¯ä¸€å¥—å¼€æºçš„åˆ†å¸ƒå¼æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†ç³»ç»Ÿï¼Œç”±HashiCorpå…¬å¸ç”¨Goè¯­è¨€å¼€å‘ã€‚&lt;/p&gt;
&lt;p&gt;æä¾›äº†å¾®æœåŠ¡ç³»ç»Ÿä¸­çš„æœåŠ¡æ²»ç†ã€é…ç½®ä¸­å¿ƒã€æ§åˆ¶æ€»çº¿ç­‰åŠŸèƒ½ã€‚è¿™äº›åŠŸèƒ½ä¸­çš„æ¯ä¸€ä¸ªéƒ½å¯ä»¥æ ¹æ®éœ€è¦å•ç‹¬ä½¿ç”¨ï¼Œ
      
    
    </summary>
    
    
      <category term="ä¸­é—´ä»¶/å·¥å…·/æ¡†æ¶" scheme="https://www.codetool.top/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6-%E5%B7%A5%E5%85%B7-%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="å¾®æœåŠ¡" scheme="https://www.codetool.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="Consul" scheme="https://www.codetool.top/tags/Consul/"/>
    
  </entry>
  
</feed>
